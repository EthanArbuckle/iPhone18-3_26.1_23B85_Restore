@interface SFPasswordSavingServiceViewController
- (SFPasswordSavingServiceViewController)initWithNibName:(id)name bundle:(id)bundle;
- (id)_messageStringForAccountModificationPrompt;
- (id)_titleStringForAccountModificationPrompt;
- (void)_addChangePasswordOnWebsiteActionToPrompt;
- (void)_addChangeToStrongPasswordActionToPrompt;
- (void)_addUpgradeToSignInWithAppleActionToPrompt;
- (void)_checkIfWarningStoreAlreadyContainsCredentialWithCompletionHandler:(id)handler;
- (void)_configureSecurityPromptActionsWithCompletionHandler:(id)handler;
- (void)_dismiss;
- (void)_initiateChangeToStrongPassword;
- (void)_initiateUpgradeToSignInWithApple;
- (void)_openPasswordManagerToChangePasswordOnWebsite;
- (void)_saveCredential:(id)credential;
- (void)_showAccountModificationPrompt;
- (void)_updateCredential:(id)credential;
- (void)credentialsSubmittedForWebsiteURL:(id)l user:(id)user password:(id)password passwordIsAutoGenerated:(BOOL)generated completionHandler:(id)handler;
- (void)showPromptWithToken:(id)token style:(int64_t)style;
@end

@implementation SFPasswordSavingServiceViewController

- (SFPasswordSavingServiceViewController)initWithNibName:(id)name bundle:(id)bundle
{
  v17.receiver = self;
  v17.super_class = SFPasswordSavingServiceViewController;
  v4 = [(SFPasswordSavingServiceViewController *)&v17 initWithNibName:name bundle:bundle];
  if (v4)
  {
    mEMORY[0x1E695A960] = [MEMORY[0x1E695A960] sharedManager];
    [mEMORY[0x1E695A960] addChangeObserver:v4];

    mEMORY[0x1E69C8A38] = [MEMORY[0x1E69C8A38] sharedStore];
    savedAccountStore = v4->_savedAccountStore;
    v4->_savedAccountStore = mEMORY[0x1E69C8A38];

    v8 = objc_alloc(MEMORY[0x1E69C8820]);
    safari_safariCoreBundle = [MEMORY[0x1E696AAE8] safari_safariCoreBundle];
    v10 = [safari_safariCoreBundle URLForResource:@"WBSAutoFillQuirks" withExtension:@"plist"];
    defaultManager = [MEMORY[0x1E696AC08] defaultManager];
    safari_autoFillQuirksDownloadDirectoryURL = [defaultManager safari_autoFillQuirksDownloadDirectoryURL];
    v13 = [v8 initWithBuiltInQuirksURL:v10 downloadsDirectoryURL:safari_autoFillQuirksDownloadDirectoryURL resourceName:@"AutoFillQuirks" resourceVersion:@"1" updateDateDefaultsKey:*MEMORY[0x1E69C8CF8] updateInterval:0.0];
    autoFillQuirksManager = v4->_autoFillQuirksManager;
    v4->_autoFillQuirksManager = v13;

    [(WBSAutoFillQuirksManager *)v4->_autoFillQuirksManager beginLoadingQuirksFromDisk];
    v15 = v4;
  }

  return v4;
}

- (void)credentialsSubmittedForWebsiteURL:(id)l user:(id)user password:(id)password passwordIsAutoGenerated:(BOOL)generated completionHandler:(id)handler
{
  userCopy = user;
  passwordCopy = password;
  handlerCopy = handler;
  v15 = MEMORY[0x1E696AFB0];
  lCopy = l;
  uUID = [v15 UUID];
  uUIDString = [uUID UUIDString];
  tokenForShowingPrompt = self->_tokenForShowingPrompt;
  self->_tokenForShowingPrompt = uUIDString;

  v20 = MEMORY[0x1E69C8E18];
  applicationIdentifier = [(SFPasswordServiceViewController *)self applicationIdentifier];
  v25[0] = MEMORY[0x1E69E9820];
  v25[1] = 3221225472;
  v25[2] = __131__SFPasswordSavingServiceViewController_credentialsSubmittedForWebsiteURL_user_password_passwordIsAutoGenerated_completionHandler___block_invoke;
  v25[3] = &unk_1E8494918;
  v25[4] = self;
  v26 = userCopy;
  generatedCopy = generated;
  v27 = passwordCopy;
  v28 = handlerCopy;
  v22 = handlerCopy;
  v23 = passwordCopy;
  v24 = userCopy;
  [v20 getAllowedActionForAppCredentialsWithAppID:applicationIdentifier websiteURL:lCopy user:v24 password:v23 completionHandler:v25];
}

void __131__SFPasswordSavingServiceViewController_credentialsSubmittedForWebsiteURL_user_password_passwordIsAutoGenerated_completionHandler___block_invoke(uint64_t a1, uint64_t a2, void *a3, void *a4, void *a5)
{
  v36 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  *(*(a1 + 32) + 1000) = a2;
  objc_storeStrong((*(a1 + 32) + 1016), a3);
  objc_storeStrong((*(a1 + 32) + 1008), a4);
  v13 = [MEMORY[0x1E695AC48] safari_credentialWithUser:*(a1 + 40) password:*(a1 + 48) persistence:3];
  v14 = *(a1 + 32);
  v15 = *(v14 + 1024);
  *(v14 + 1024) = v13;

  if (*(a1 + 64) != 1)
  {
    if (*(*(a1 + 32) + 1000) != 3)
    {
      (*(*(a1 + 56) + 16))();
      v21 = [MEMORY[0x1E695A960] sharedManager];
      [v21 removeChangeObserver:*(a1 + 32)];

      goto LABEL_23;
    }

    v16 = objc_alloc(MEMORY[0x1E69635F8]);
    v17 = [*(a1 + 32) _hostApplicationBundleIdentifier];
    v33 = 0;
    v18 = [v16 initWithBundleIdentifier:v17 allowPlaceholder:0 error:&v33];
    v19 = v33;

    if (v19)
    {
      v20 = WBS_LOG_CHANNEL_PREFIXAccountAuthenticationModificationExtension();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        __131__SFPasswordSavingServiceViewController_credentialsSubmittedForWebsiteURL_user_password_passwordIsAutoGenerated_completionHandler___block_invoke_cold_1(v20, v19);
      }
    }

    else if ([v18 shouldShowSecurityPromptsOnSignIn])
    {
      v23 = objc_alloc(MEMORY[0x1E69C89A8]);
      v24 = [MEMORY[0x1E69C8A38] sharedStore];
      v25 = [v23 initWithSavedAccountStore:v24 autoFillQuirksManager:*(*(a1 + 32) + 1048) userDefaults:0 highLevelDomainsProvider:0];

      v31[0] = MEMORY[0x1E69E9820];
      v31[1] = 3221225472;
      v31[2] = __131__SFPasswordSavingServiceViewController_credentialsSubmittedForWebsiteURL_user_password_passwordIsAutoGenerated_completionHandler___block_invoke_68;
      v31[3] = &unk_1E84948F0;
      v31[4] = *(a1 + 32);
      v32 = *(a1 + 56);
      [v25 getWarningForSavedAccount:v12 completionHandler:v31];

LABEL_22:
      goto LABEL_23;
    }

    if (v18 && ([v18 shouldShowSecurityPromptsOnSignIn] & 1) == 0)
    {
      v26 = MEMORY[0x1E69635E0];
      v27 = [*(a1 + 32) _hostApplicationBundleIdentifier];
      v28 = [v26 applicationProxyForIdentifier:v27];
      v29 = [v28 localizedNameForContext:0];

      v30 = WBS_LOG_CHANNEL_PREFIXAccountAuthenticationModificationExtension();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v35 = v29;
        _os_log_impl(&dword_1D4644000, v30, OS_LOG_TYPE_INFO, "%@ has opted out of security recommendation prompts on sign in.", buf, 0xCu);
      }
    }

    (*(*(a1 + 56) + 16))();
    [*(a1 + 32) _dismiss];
    goto LABEL_22;
  }

  if (a2 == 2)
  {
    [*(a1 + 32) _updateCredential:*(*(a1 + 32) + 1024)];
  }

  else if (a2 == 1)
  {
    [*(a1 + 32) _saveCredential:*(*(a1 + 32) + 1024)];
  }

  else
  {
    v22 = WBS_LOG_CHANNEL_PREFIXAppPasswordAutoFill();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      __131__SFPasswordSavingServiceViewController_credentialsSubmittedForWebsiteURL_user_password_passwordIsAutoGenerated_completionHandler___block_invoke_cold_2();
    }
  }

  (*(*(a1 + 56) + 16))();
  [*(a1 + 32) _dismiss];
LABEL_23:
}

void __131__SFPasswordSavingServiceViewController_credentialsSubmittedForWebsiteURL_user_password_passwordIsAutoGenerated_completionHandler___block_invoke_68(uint64_t a1, void *a2)
{
  v5 = a2;
  objc_storeStrong((*(a1 + 32) + 1056), a2);
  *(*(a1 + 32) + 1091) = ([*(*(a1 + 32) + 1056) issueTypes] & 0xC) != 0;
  *(*(a1 + 32) + 1090) = ([*(*(a1 + 32) + 1056) issueTypes] & 2) != 0;
  v4 = *(a1 + 32);
  if ((*(v4 + 1091) & 1) != 0 || *(v4 + 1090) == 1)
  {
    [v4 _checkIfWarningStoreAlreadyContainsCredentialWithCompletionHandler:*(a1 + 40)];
  }

  else
  {
    (*(*(a1 + 40) + 16))(*(a1 + 40), 0, *(v4 + 1032));
    [*(a1 + 32) _dismiss];
  }
}

- (void)_checkIfWarningStoreAlreadyContainsCredentialWithCompletionHandler:(id)handler
{
  v19[1] = *MEMORY[0x1E69E9840];
  handlerCopy = handler;
  savedAccountStore = self->_savedAccountStore;
  credential = self->_credential;
  firstObject = [(NSArray *)self->_protectionSpacesToUpdate firstObject];
  v8 = [(WBSSavedAccountStore *)savedAccountStore persistentIdentifierForCredential:credential protectionSpace:firstObject];

  if (v8)
  {
    v9 = self->_savedAccountStore;
    v19[0] = v8;
    v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v19 count:1];
    v11 = [(WBSSavedAccountStore *)v9 savedAccountsForPersistentIdentifiers:v10];
    firstObject2 = [v11 firstObject];

    if (([firstObject2 credentialTypes] & 2) != 0)
    {
      handlerCopy[2](handlerCopy, 0, self->_tokenForShowingPrompt);
      [(SFPasswordSavingServiceViewController *)self _dismiss];
    }

    else
    {
      objc_initWeak(&location, self);
      mEMORY[0x1E69C89B0] = [MEMORY[0x1E69C89B0] sharedStore];
      v15[0] = MEMORY[0x1E69E9820];
      v15[1] = 3221225472;
      v15[2] = __108__SFPasswordSavingServiceViewController__checkIfWarningStoreAlreadyContainsCredentialWithCompletionHandler___block_invoke;
      v15[3] = &unk_1E8491000;
      objc_copyWeak(&v17, &location);
      v16 = handlerCopy;
      [mEMORY[0x1E69C89B0] getContainsPersistentIdentifier:v8 completionHandler:v15];

      objc_destroyWeak(&v17);
      objc_destroyWeak(&location);
    }
  }

  else
  {
    v14 = WBS_LOG_CHANNEL_PREFIXAccountAuthenticationModificationExtension();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      [SFPasswordSavingServiceViewController _checkIfWarningStoreAlreadyContainsCredentialWithCompletionHandler:];
    }

    handlerCopy[2](handlerCopy, 0, self->_tokenForShowingPrompt);
    [(SFPasswordSavingServiceViewController *)self _dismiss];
  }
}

void __108__SFPasswordSavingServiceViewController__checkIfWarningStoreAlreadyContainsCredentialWithCompletionHandler___block_invoke(uint64_t a1, int a2)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = *(a1 + 32);
  v6 = WeakRetained;
  if (WeakRetained)
  {
    if (a2)
    {
      (*(v5 + 16))(v5, 0, WeakRetained[129]);
      [v6 _dismiss];
    }

    else
    {
      [WeakRetained _configureSecurityPromptActionsWithCompletionHandler:v5];
    }
  }

  else
  {
    (*(v5 + 16))(v5, 0, 0);
  }
}

- (void)_configureSecurityPromptActionsWithCompletionHandler:(id)handler
{
  handlerCopy = handler;
  objc_initWeak(&location, self);
  mEMORY[0x1E695A960] = [MEMORY[0x1E695A960] sharedManager];
  firstObject = [(NSArray *)self->_protectionSpacesToUpdate firstObject];
  host = [firstObject host];
  safari_highLevelDomainFromHost = [host safari_highLevelDomainFromHost];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __94__SFPasswordSavingServiceViewController__configureSecurityPromptActionsWithCompletionHandler___block_invoke;
  v10[3] = &unk_1E8494968;
  objc_copyWeak(&v12, &location);
  v9 = handlerCopy;
  v11 = v9;
  [mEMORY[0x1E695A960] extensionForDomain:safari_highLevelDomainFromHost completionHandler:v10];

  objc_destroyWeak(&v12);
  objc_destroyWeak(&location);
}

void __94__SFPasswordSavingServiceViewController__configureSecurityPromptActionsWithCompletionHandler___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v6 = WeakRetained;
  if (!WeakRetained)
  {
    v9 = *(*(a1 + 32) + 16);
LABEL_12:
    v9();
    goto LABEL_13;
  }

  if (!v4)
  {
LABEL_11:
    v9 = *(*(a1 + 32) + 16);
    goto LABEL_12;
  }

  objc_storeStrong(WeakRetained + 133, a2);
  v7 = [v4 attributes];
  if ([v7 safari_BOOLForKey:*MEMORY[0x1E69C8E38]])
  {
    v8 = [MEMORY[0x1E69C88B8] sharedMonitor];
    v6[1088] = [v8 isKeychainSyncEnabled];
  }

  else
  {
    v6[1088] = 0;
  }

  v10 = [MEMORY[0x1E695E000] pm_defaults];
  v11 = [v10 pm_passwordManagerIsInDemoMode];

  v12 = [v4 attributes];
  v13 = [v12 safari_BOOLForKey:*MEMORY[0x1E69C8E40]];
  v14 = v13;
  if (v11)
  {
    v6[1089] = v13;

    goto LABEL_11;
  }

  if ((v14 & 1) == 0)
  {
    goto LABEL_11;
  }

  v15 = objc_alloc_init(MEMORY[0x1E698DCE0]);
  v16 = [v6 _hostApplicationBundleIdentifier];
  v17[0] = MEMORY[0x1E69E9820];
  v17[1] = 3221225472;
  v17[2] = __94__SFPasswordSavingServiceViewController__configureSecurityPromptActionsWithCompletionHandler___block_invoke_2;
  v17[3] = &unk_1E8494940;
  objc_copyWeak(&v19, (a1 + 40));
  v18 = *(a1 + 32);
  [v15 getCredentialStateForClientID:v16 completion:v17];

  objc_destroyWeak(&v19);
LABEL_13:
}

void __94__SFPasswordSavingServiceViewController__configureSecurityPromptActionsWithCompletionHandler___block_invoke_2(uint64_t a1, uint64_t a2, uint64_t a3)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (a3)
    {
      v7 = WBS_LOG_CHANNEL_PREFIXAccountAuthenticationModificationExtension();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        __94__SFPasswordSavingServiceViewController__configureSecurityPromptActionsWithCompletionHandler___block_invoke_2_cold_1(WeakRetained, v7);
      }
    }

    WeakRetained[1089] = a2 == 2;
    v8 = *(*(a1 + 32) + 16);
  }

  else
  {
    v8 = *(*(a1 + 32) + 16);
  }

  v8();
}

- (void)_saveCredential:(id)credential
{
  domainForSavePasswordAction = self->_domainForSavePasswordAction;
  credentialCopy = credential;
  safari_bestURLForUserTypedString = [(NSString *)domainForSavePasswordAction safari_bestURLForUserTypedString];
  v5 = [MEMORY[0x1E695AC58] safari_HTMLFormProtectionSpaceForURL:safari_bestURLForUserTypedString];
  mEMORY[0x1E69C8A38] = [MEMORY[0x1E69C8A38] sharedStore];
  user = [credentialCopy user];
  password = [credentialCopy password];

  host = [v5 host];
  v10 = [mEMORY[0x1E69C8A38] saveUser:user password:password forProtectionSpace:v5 highLevelDomain:host groupID:*MEMORY[0x1E69C8C68]];
}

- (void)_updateCredential:(id)credential
{
  v19 = *MEMORY[0x1E69E9840];
  credentialCopy = credential;
  user = [credentialCopy user];
  password = [credentialCopy password];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v7 = self->_protectionSpacesToUpdate;
  v8 = [(NSArray *)v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      v11 = 0;
      do
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * v11);
        mEMORY[0x1E69C8A38] = [MEMORY[0x1E69C8A38] sharedStore];
        [mEMORY[0x1E69C8A38] updateAllSavedAccountsWithPasswordsWithUser:user protectionSpace:v12 withNewPassword:password];

        ++v11;
      }

      while (v9 != v11);
      v9 = [(NSArray *)v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }
}

- (void)showPromptWithToken:(id)token style:(int64_t)style
{
  if ([token isEqualToString:self->_tokenForShowingPrompt] && self->_action && (objc_msgSend(MEMORY[0x1E69C8880], "isPasswordsAppInstalled") & 1) != 0)
  {
    if (self->_action == 3)
    {

      [(SFPasswordSavingServiceViewController *)self _showAccountModificationPrompt];
    }

    else if (WBSCurrentPasswordSavingBehavior() == 1)
    {
      v6 = WBS_LOG_CHANNEL_PREFIXAutoFill();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_1D4644000, v6, OS_LOG_TYPE_DEFAULT, "Will not attempt to save credentials because user opted out of saving credentials when signing in", buf, 2u);
      }

      [(SFPasswordSavingServiceViewController *)self _dismiss];
    }

    else
    {
      if (self->_action == 1)
      {
        v7 = _WBSLocalizedString();
        v8 = _WBSLocalizedString();
        v9 = MEMORY[0x1E69DC648];
        v10 = _WBSLocalizedString();
        v32[0] = MEMORY[0x1E69E9820];
        v32[1] = 3221225472;
        v32[2] = __67__SFPasswordSavingServiceViewController_showPromptWithToken_style___block_invoke;
        v32[3] = &unk_1E848FBF8;
        v32[4] = self;
        v11 = [v9 actionWithTitle:v10 style:0 handler:v32];
      }

      else
      {
        v12 = MEMORY[0x1E69635E0];
        _hostApplicationBundleIdentifier = [(SFPasswordSavingServiceViewController *)self _hostApplicationBundleIdentifier];
        v14 = [v12 applicationProxyForIdentifier:_hostApplicationBundleIdentifier];
        v15 = [v14 localizedNameForContext:0];

        if (![v15 length])
        {
          v16 = WBS_LOG_CHANNEL_PREFIXAppPasswordAutoFill();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            __127__SFPasswordPickerServiceViewController__authenticateAndSetPresentCredentialsHandlerWithSavedAccountContext_completionHandler___block_invoke_165_cold_2();
          }
        }

        user = [(NSURLCredential *)self->_credential user];
        v18 = [user length];
        v19 = MEMORY[0x1E696AEC0];
        if (v18)
        {
          v20 = _WBSLocalizedString();
          [v19 localizedStringWithFormat:v20, user, v15];
        }

        else
        {
          v20 = _WBSLocalizedString();
          [v19 localizedStringWithFormat:v20, v15, v29];
        }
        v7 = ;

        v21 = MEMORY[0x1E69DC648];
        v22 = _WBSLocalizedString();
        v31[0] = MEMORY[0x1E69E9820];
        v31[1] = 3221225472;
        v31[2] = __67__SFPasswordSavingServiceViewController_showPromptWithToken_style___block_invoke_108;
        v31[3] = &unk_1E848FBF8;
        v31[4] = self;
        v11 = [v21 actionWithTitle:v22 style:0 handler:v31];

        v8 = 0;
      }

      v23 = [MEMORY[0x1E69DC650] alertControllerWithTitle:v7 message:v8 imageNamed:@"alert-passwords" preferredStyle:style];
      prompt = self->_prompt;
      self->_prompt = v23;

      [(UIAlertController *)self->_prompt addAction:v11];
      v25 = self->_prompt;
      v26 = MEMORY[0x1E69DC648];
      v27 = _WBSLocalizedString();
      v30[0] = MEMORY[0x1E69E9820];
      v30[1] = 3221225472;
      v30[2] = __67__SFPasswordSavingServiceViewController_showPromptWithToken_style___block_invoke_2;
      v30[3] = &unk_1E848FBF8;
      v30[4] = self;
      v28 = [v26 actionWithTitle:v27 style:1 handler:v30];
      [(UIAlertController *)v25 addAction:v28];

      [(SFPasswordSavingServiceViewController *)self presentViewController:self->_prompt animated:1 completion:0];
    }
  }

  else
  {

    [(SFPasswordSavingServiceViewController *)self _dismiss];
  }
}

uint64_t __67__SFPasswordSavingServiceViewController_showPromptWithToken_style___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _saveCredential:*(*(a1 + 32) + 1024)];
  v2 = *(a1 + 32);

  return [v2 _dismiss];
}

uint64_t __67__SFPasswordSavingServiceViewController_showPromptWithToken_style___block_invoke_108(uint64_t a1)
{
  [*(a1 + 32) _updateCredential:*(*(a1 + 32) + 1024)];
  v2 = *(a1 + 32);

  return [v2 _dismiss];
}

- (void)_dismiss
{
  tokenForShowingPrompt = self->_tokenForShowingPrompt;
  self->_tokenForShowingPrompt = 0;

  self->_action = 0;
  domainForSavePasswordAction = self->_domainForSavePasswordAction;
  self->_domainForSavePasswordAction = 0;

  protectionSpacesToUpdate = self->_protectionSpacesToUpdate;
  self->_protectionSpacesToUpdate = 0;

  _remoteViewControllerProxy = [(SFPasswordSavingServiceViewController *)self _remoteViewControllerProxy];
  [_remoteViewControllerProxy willDismissServiceViewController];

  mEMORY[0x1E695A960] = [MEMORY[0x1E695A960] sharedManager];
  [mEMORY[0x1E695A960] removeChangeObserver:self];
}

- (void)_showAccountModificationPrompt
{
  savedAccountStore = self->_savedAccountStore;
  credential = self->_credential;
  firstObject = [(NSArray *)self->_protectionSpacesToUpdate firstObject];
  v6 = [(WBSSavedAccountStore *)savedAccountStore persistentIdentifierForCredential:credential protectionSpace:firstObject];

  mEMORY[0x1E69C89B0] = [MEMORY[0x1E69C89B0] sharedStore];
  [mEMORY[0x1E69C89B0] addPersistentIdentifier:v6];

  v8 = MEMORY[0x1E69DC650];
  _titleStringForAccountModificationPrompt = [(SFPasswordSavingServiceViewController *)self _titleStringForAccountModificationPrompt];
  _messageStringForAccountModificationPrompt = [(SFPasswordSavingServiceViewController *)self _messageStringForAccountModificationPrompt];
  v11 = [v8 alertControllerWithTitle:_titleStringForAccountModificationPrompt message:_messageStringForAccountModificationPrompt imageNamed:@"alert-passwords" preferredStyle:_SFDeviceAlertStyle()];
  prompt = self->_prompt;
  self->_prompt = v11;

  if (self->_supportsUpgradeToSignInWithApple)
  {
    [(SFPasswordSavingServiceViewController *)self _addUpgradeToSignInWithAppleActionToPrompt];
  }

  if (self->_supportsUpgradeToStrongPassword)
  {
    [(SFPasswordSavingServiceViewController *)self _addChangeToStrongPasswordActionToPrompt];
  }

  else
  {
    [(SFPasswordSavingServiceViewController *)self _addChangePasswordOnWebsiteActionToPrompt];
  }

  v13 = self->_prompt;
  v14 = MEMORY[0x1E69DC648];
  v15 = _WBSLocalizedString();
  v17[0] = MEMORY[0x1E69E9820];
  v17[1] = 3221225472;
  v17[2] = __71__SFPasswordSavingServiceViewController__showAccountModificationPrompt__block_invoke;
  v17[3] = &unk_1E848FBF8;
  v17[4] = self;
  v16 = [v14 actionWithTitle:v15 style:1 handler:v17];
  [(UIAlertController *)v13 addAction:v16];

  [(SFPasswordSavingServiceViewController *)self presentViewController:self->_prompt animated:1 completion:0];
}

- (void)_addUpgradeToSignInWithAppleActionToPrompt
{
  prompt = self->_prompt;
  v4 = MEMORY[0x1E69DC648];
  v5 = _WBSLocalizedString();
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __83__SFPasswordSavingServiceViewController__addUpgradeToSignInWithAppleActionToPrompt__block_invoke;
  v7[3] = &unk_1E848FBF8;
  v7[4] = self;
  v6 = [v4 actionWithTitle:v5 style:0 handler:v7];
  [(UIAlertController *)prompt addAction:v6];
}

- (void)_addChangeToStrongPasswordActionToPrompt
{
  prompt = self->_prompt;
  v4 = MEMORY[0x1E69DC648];
  v5 = _WBSLocalizedString();
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __81__SFPasswordSavingServiceViewController__addChangeToStrongPasswordActionToPrompt__block_invoke;
  v7[3] = &unk_1E848FBF8;
  v7[4] = self;
  v6 = [v4 actionWithTitle:v5 style:0 handler:v7];
  [(UIAlertController *)prompt addAction:v6];
}

- (void)_addChangePasswordOnWebsiteActionToPrompt
{
  prompt = self->_prompt;
  v4 = MEMORY[0x1E69DC648];
  v5 = _WBSLocalizedString();
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __82__SFPasswordSavingServiceViewController__addChangePasswordOnWebsiteActionToPrompt__block_invoke;
  v7[3] = &unk_1E848FBF8;
  v7[4] = self;
  v6 = [v4 actionWithTitle:v5 style:0 handler:v7];
  [(UIAlertController *)prompt addAction:v6];
}

uint64_t __82__SFPasswordSavingServiceViewController__addChangePasswordOnWebsiteActionToPrompt__block_invoke(uint64_t a1)
{
  [*(a1 + 32) _openPasswordManagerToChangePasswordOnWebsite];
  v2 = *(a1 + 32);

  return [v2 _dismiss];
}

- (id)_titleStringForAccountModificationPrompt
{
  if (([(WBSPasswordWarning *)self->_passwordWarning issueTypes]& 8) != 0)
  {
    v4 = _WBSLocalizedString();
    v5 = [(WBSPasswordWarning *)self->_passwordWarning localizedLongDescriptionForClient:2];
    v6 = [MEMORY[0x1E696AEC0] stringWithFormat:@" %@", v4];
    v3 = [v5 stringByAppendingString:v6];
  }

  else
  {
    v3 = [(WBSPasswordWarning *)self->_passwordWarning localizedLongDescriptionForClient:2];
  }

  return v3;
}

- (id)_messageStringForAccountModificationPrompt
{
  v3 = MEMORY[0x1E69635E0];
  _hostApplicationBundleIdentifier = [(SFPasswordSavingServiceViewController *)self _hostApplicationBundleIdentifier];
  v5 = [v3 applicationProxyForIdentifier:_hostApplicationBundleIdentifier];
  v6 = [v5 localizedNameForContext:0];

  if (self->_supportsUpgradeToSignInWithApple)
  {
    [MEMORY[0x1E69C8880] isAppleAccountBrandingEnabled];
  }

  else
  {
    currentDevice = [MEMORY[0x1E69C8860] currentDevice];
    [currentDevice deviceClass];
  }

  v7 = MEMORY[0x1E696AEC0];
  v9 = _WBSLocalizedString();
  v10 = [v7 stringWithFormat:v9, v6];

  return v10;
}

- (void)_initiateUpgradeToSignInWithApple
{
  v3 = objc_alloc(MEMORY[0x1E695A920]);
  firstObject = [(NSArray *)self->_protectionSpacesToUpdate firstObject];
  host = [firstObject host];
  safari_highLevelDomainFromHost = [host safari_highLevelDomainFromHost];
  v7 = [v3 initWithIdentifier:safari_highLevelDomainFromHost type:0];

  _remoteViewControllerProxy = [(SFPasswordSavingServiceViewController *)self _remoteViewControllerProxy];
  if (objc_opt_respondsToSelector())
  {
    _remoteViewControllerProxy2 = [(SFPasswordSavingServiceViewController *)self _remoteViewControllerProxy];
    v10 = objc_alloc(MEMORY[0x1E695A938]);
    user = [(NSURLCredential *)self->_credential user];
    password = [(NSURLCredential *)self->_credential password];
    v13 = [v10 initWithUser:user password:password];
    [_remoteViewControllerProxy2 performUpgradeToSignInWithAppleForCredential:v13 serviceIdentifier:v7];
  }

  else
  {
    [_remoteViewControllerProxy willDismissServiceViewController];
    v14 = WBS_LOG_CHANNEL_PREFIXAccountAuthenticationModificationExtension();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      [SFPasswordSavingServiceViewController _initiateUpgradeToSignInWithApple];
    }
  }
}

- (void)_initiateChangeToStrongPassword
{
  v3 = objc_alloc(MEMORY[0x1E695A920]);
  firstObject = [(NSArray *)self->_protectionSpacesToUpdate firstObject];
  host = [firstObject host];
  safari_highLevelDomainFromHost = [host safari_highLevelDomainFromHost];
  v7 = [v3 initWithIdentifier:safari_highLevelDomainFromHost type:0];

  _remoteViewControllerProxy = [(SFPasswordSavingServiceViewController *)self _remoteViewControllerProxy];
  if (objc_opt_respondsToSelector())
  {
    _remoteViewControllerProxy2 = [(SFPasswordSavingServiceViewController *)self _remoteViewControllerProxy];
    v10 = objc_alloc(MEMORY[0x1E695A938]);
    user = [(NSURLCredential *)self->_credential user];
    password = [(NSURLCredential *)self->_credential password];
    v13 = [v10 initWithUser:user password:password];
    [_remoteViewControllerProxy2 performUpgradeToStrongPasswordForCredential:v13 serviceIdentifier:v7];
  }

  else
  {
    [_remoteViewControllerProxy willDismissServiceViewController];
    v14 = WBS_LOG_CHANNEL_PREFIXAccountAuthenticationModificationExtension();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      [SFPasswordSavingServiceViewController _initiateUpgradeToSignInWithApple];
    }
  }
}

- (void)_openPasswordManagerToChangePasswordOnWebsite
{
  v11[2] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E69C8978];
  v10[0] = *MEMORY[0x1E69C8C98];
  user = [(NSURLCredential *)self->_credential user];
  v11[0] = user;
  v10[1] = *MEMORY[0x1E69C8C90];
  firstObject = [(NSArray *)self->_protectionSpacesToUpdate firstObject];
  host = [firstObject host];
  v11[1] = host;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v11 forKeys:v10 count:2];
  v8 = [v3 passwordManagerURLWithDictionary:v7];

  defaultWorkspace = [MEMORY[0x1E6963608] defaultWorkspace];
  [defaultWorkspace openSensitiveURL:v8 withOptions:0];
}

void __131__SFPasswordSavingServiceViewController_credentialsSubmittedForWebsiteURL_user_password_passwordIsAutoGenerated_completionHandler___block_invoke_cold_1(void *a1, void *a2)
{
  v3 = a1;
  v4 = [a2 safari_privacyPreservingDescription];
  OUTLINED_FUNCTION_0_0(&dword_1D4644000, v5, v6, "Failed to find application record with error: %{public}@. Skipping security recommendation prompt.", v7, v8, v9, v10, 2u);
}

void __94__SFPasswordSavingServiceViewController__configureSecurityPromptActionsWithCompletionHandler___block_invoke_2_cold_1(uint64_t a1, void *a2)
{
  v2 = *(a1 + 1064);
  v3 = a2;
  v4 = [v2 _plugIn];
  v5 = [v4 localizedContainingName];
  OUTLINED_FUNCTION_0_0(&dword_1D4644000, v6, v7, "Failed to get Sign in with Apple authorization credential state for %@", v8, v9, v10, v11, 2u);
}

@end