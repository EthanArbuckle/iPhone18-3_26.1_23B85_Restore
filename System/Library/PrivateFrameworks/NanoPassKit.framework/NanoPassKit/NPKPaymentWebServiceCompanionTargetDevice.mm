@interface NPKPaymentWebServiceCompanionTargetDevice
+ (id)bridgedClientInfoHTTPHeader;
- (BOOL)_deviceIsConnected;
- (BOOL)_isAutoTopUpSupported;
- (BOOL)_isDynamicSESupported;
- (BOOL)_isParallelProvisioningSupported;
- (BOOL)_isRevokeCredentialsWithReaderIdentifiersSupported;
- (BOOL)_isSimultaneousSinglePollingAndGymKitSupported;
- (BOOL)_isSubcredentialArchivingWithRenamedConfigurationSupported;
- (BOOL)_isUnifiedAccessProvisioningSupported;
- (BOOL)_supportsFeaturesForWebService:(id)service;
- (BOOL)areUnifiedAccessPassesSupported;
- (BOOL)canAddToCompanionPrecheckForegroundConnectivity;
- (BOOL)deviceSupportMultipleExpressPasses;
- (BOOL)deviceSupportTransitReminderSetting;
- (BOOL)felicaSecureElementIsAvailable;
- (BOOL)isGymKitEnabled;
- (BOOL)paymentWebService:(id)service canProvisionPaymentPassWithPrimaryAccountIdentifier:(id)identifier;
- (BOOL)paymentWebService:(id)service hasPassWithUniqueID:(id)d;
- (BOOL)paymentWebService:(id)service hasPassesOfType:(unint64_t)type;
- (BOOL)paymentWebServiceSupportsAccounts:(id)accounts;
- (BOOL)paymentWebServiceSupportsPeerPaymentRegistration:(id)registration;
- (BOOL)willPassWithUniqueIdentifierAutomaticallyBecomeDefault:(id)default;
- (NPKCompanionAgentConnection)companionAgentConnection;
- (NPKCompanionPasscodeChangeCoordinatorProtocol)passcodeChangeCoordinator;
- (NPKPaymentWebServiceCompanionTargetDevice)initWithContext:(unint64_t)context responseQueue:(id)queue;
- (NPKPaymentWebServiceCompanionTargetDeviceDelegate)delegate;
- (NPKSubcredentialInvitationCoordinator)subcredentialInvitationCoordinator;
- (NPKTapToRadarManager)manager;
- (PUConnection)passcodeConnection;
- (id)_deviceSupportedFeatureIdentifiers;
- (id)_dummyExpressPassInformationForPass:(id)pass fromUpgradeRequest:(id)request;
- (id)_eligibleExpressUpgradeRequestsForPass:(id)pass;
- (id)_expressModesFromExpressPassConfigurations:(id)configurations;
- (id)_expressPassConfigurationForPaymentPass:(id)pass;
- (id)_expressPassesConfigurationFromDataArray:(id)array;
- (id)_expressPassesInformationFromDataArray:(id)array;
- (id)_idsShortSendTimeoutProvisioningOptions;
- (id)_secureArchiveSubcredential:(id)subcredential;
- (id)_secureUnarchiveSubcredential:(id)subcredential;
- (id)_sendProtobuf:(id)protobuf responseIdentifier:(id)identifier;
- (id)_serialNumbersOfAllPairedDevices;
- (id)_supportedRegionsForWebService:(id)service;
- (id)_synthesizedExpressPassStateForExpressPassConfiguration:(id)configuration otherPaymentPasses:(id)passes;
- (id)appleAccountInformation;
- (id)bridgedClientInfo;
- (id)deviceClass;
- (id)deviceDescriptionForPaymentWebService:(id)service;
- (id)deviceIDSIdentifier;
- (id)deviceName;
- (id)deviceSerialNumber;
- (id)deviceVersion;
- (id)identityPassesOfTypes:(id)types;
- (id)osVersion;
- (id)passcodeUpgradeFlowController;
- (id)passesOfCardType:(int64_t)type;
- (id)passesWithReaderIdentifier:(id)identifier;
- (id)paymentWebService:(id)service passWithUniqueID:(id)d;
- (id)paymentWebService:(id)service passesOfType:(unint64_t)type;
- (id)paymentWebService:(id)service supportedRegionFeatureOfType:(int64_t)type;
- (id)supportedFeatureIdentifiersForAccountProvisioningWithPaymentWebService:(id)service;
- (id)supportedFeatureIdentifiersWithPaymentWebService:(id)service;
- (id)trustedDeviceEnrollmentInfoForWebService:(id)service;
- (id)upgradeRequestForPass:(id)pass;
- (unint64_t)currentPassbookState;
- (unint64_t)paymentSupportedInCurrentRegionForWebService:(id)service;
- (unint64_t)registrationSupportedInCurrentRegionForWebService:(id)service;
- (void)_acquireAssertionOfType:(unint64_t)type;
- (void)_addCompanionDevicePhoneNumberDataIfNeededWithFields:(unint64_t)fields toDeviceMetadata:(id)metadata;
- (void)_canAddSecureElementPassWithConfiguration:(id)configuration completion:(id)completion;
- (void)_checkConflictsForPass:(id)pass withConfiguration:(id)configuration webService:(id)service hasDisqualifyingConflicts:(id)conflicts;
- (void)_checkUpgradedPasscodePolicyByApplyingRestrictions:(BOOL)restrictions applyBackgroundEnforcementIfNecessary:(BOOL)necessary completion:(id)completion;
- (void)_displayableEntitlementsForPassIdentifier:(id)identifier completion:(id)completion;
- (void)_displayableSharesForPassIdentifier:(id)identifier completion:(id)completion;
- (void)_getPairingInfoAndSetAuthRandomIfNotPaired:(BOOL)paired completion:(id)completion;
- (void)_handleOpenLoopPassUpgradeWithPass:(id)pass webService:(id)service completion:(id)completion;
- (void)_invalidateAssertionOfType:(unint64_t)type;
- (void)_multipleExpressTransitPassPaymentWebService:(id)service handlePotentialExpressPassConfiguration:(id)configuration pass:(id)pass withCompletionHandler:(id)handler;
- (void)_paymentWebService:(id)service presentStandaloneTransaction:(int64_t)transaction forPassUniqueIdentifier:(id)identifier terminalReaderIdentifier:(id)readerIdentifier validUntilDate:(id)date completion:(id)completion;
- (void)_paymentWebService:(id)service registrationDataWithAuthToken:(id)token completionHandler:(id)handler;
- (void)_setNewAuthRandomReturningPairingState:(id)state;
- (void)_singleExpressTransitPassPaymentWebService:(id)service handlePotentialExpressPassConfiguration:(id)configuration withCompletionHandler:(id)handler;
- (void)_trackOutstandingRequestWithMessageIdentifier:(id)identifier completionHandler:(id)handler errorHandler:(id)errorHandler;
- (void)_updateDataAccessorForPass:(id)pass;
- (void)acceptCarKeyShareForMessage:(id)message activationCode:(id)code completion:(id)completion;
- (void)acceptCarKeyShareForMessageResponse:(id)response;
- (void)acceptSubcredentialInvitationResponse:(id)response;
- (void)accountAttestationAnonymizationSaltResponse:(id)response;
- (void)accountWithIdentifier:(id)identifier completion:(id)completion;
- (void)accountWithIdentifierResponse:(id)response;
- (void)addISO18013Blobs:(id)blobs cardType:(int64_t)type completion:(id)completion;
- (void)addISO18013BlobsResponse:(id)response;
- (void)addPendingProvisionings:(id)provisionings completion:(id)completion;
- (void)addPendingProvisioningsRequest:(id)request;
- (void)addPendingProvisioningsResponse:(id)response;
- (void)addSecureElementPassWithPropertiesResponse:(id)response;
- (void)allPaymentApplicationUsageSummariesWithCompletion:(id)completion;
- (void)archiveBackgroundContext:(id)context;
- (void)archiveContext:(id)context;
- (void)availableHomeKeyPassesResponse:(id)response;
- (void)availableHomeKeyPassesWithCompletionHandler:(id)handler;
- (void)availableProductsResponse:(id)response;
- (void)balanceReminderForBalance:(id)balance pass:(id)pass completion:(id)completion;
- (void)balanceReminderWithBalanceAndPassResponse:(id)response;
- (void)cacheSharingMessageFromMailboxAddress:(id)address message:(id)message;
- (void)canAcceptInvitationRequest:(id)request;
- (void)canAcceptInvitationResponse:(id)response;
- (void)canAddSecureElementPassWithConfigurationResponse:(id)response;
- (void)cancelAutoTopUpForPassWithUniqueIdentifier:(id)identifier balanceIdentifiers:(id)identifiers completion:(id)completion;
- (void)cancelAutoTopUpResponse:(id)response;
- (void)cancelOutstandingEnableServiceModeRequests;
- (void)cancelOutstandingRemotePassUpdateRequest:(id)request pass:(id)pass;
- (void)cancelOutstandingSetDefaultExpressPassRequestsWithExpressMode:(id)mode;
- (void)carKeyAcceptInvitationResponse:(id)response;
- (void)carKeyAcceptInvitationWithInvitationIdentifier:(id)identifier activationCode:(id)code analyticsUpdateConfig:(id)config completion:(id)completion;
- (void)carKeyAccountAttestationRequestForCredential:(id)credential completion:(id)completion;
- (void)carKeyAccountAttestationResponse:(id)response;
- (void)carKeyDecryptData:(id)data credential:(id)credential ephemeralPublicKey:(id)key completion:(id)completion;
- (void)carKeyDecryptDataResponse:(id)response;
- (void)carKeyGetPretrackRequestForKeyWithInvitationIdentifier:(id)identifier completion:(id)completion;
- (void)carKeyGetPretrackResponse:(id)response;
- (void)carKeyGetProductPlanIdentifierRequestForInvitationWithIdentifier:(id)identifier transportIdentifier:(id)transportIdentifier completion:(id)completion;
- (void)carKeyGetProductPlanIdentifierResponse:(id)response;
- (void)carKeyHandleRecipientMessage:(id)message forInvitationIdentifier:(id)identifier completion:(id)completion;
- (void)carKeyHandleRecipientMessageResponse:(id)response;
- (void)carKeyRejectInvitation:(id)invitation completion:(id)completion;
- (void)carKeyRejectInvitationResponse:(id)response;
- (void)carKeyRetryActivationCodeResponse:(id)response;
- (void)carKeyRetryActivationCodeWithInvitationIdentifier:(id)identifier activationCode:(id)code completion:(id)completion;
- (void)carKeyRoutingInformationForInvitationWithIdentifier:(id)identifier transportIdentifier:(id)transportIdentifier completion:(id)completion;
- (void)carKeyRoutingInformationResponse:(id)response;
- (void)carKeySetAccountAttestation:(id)attestation forCredential:(id)credential completion:(id)completion;
- (void)carKeySetAccountAttestationResponse:(id)response;
- (void)carKeySetEncryptedProductPlanIdentifierContainer:(id)container invitationIdentifier:(id)identifier completion:(id)completion;
- (void)carKeySetEncryptedProductPlanIdentifierContainerResponse:(id)response;
- (void)carKeyStartShareAcceptanceFlow:(id)flow transportIdentifier:(id)identifier completion:(id)completion;
- (void)carKeyStartShareAcceptanceFlowResponse:(id)response;
- (void)carKeyUpdateTrackingAttestation:(id)attestation forCredential:(id)credential encryptedContainer:(id)container completion:(id)completion;
- (void)carKeyUpdateTrackingAttestationResponse:(id)response;
- (void)checkCompanionPeerPaymentRegistrationState:(id)state;
- (void)checkFidoKeyPresenceForRelyingParty:(id)party relyingPartyAccountHash:(id)hash fidoKeyHash:(id)keyHash completion:(id)completion;
- (void)checkFidoKeyResponse:(id)response;
- (void)checkInvitationStatusForMailboxAddress:(id)address completion:(id)completion;
- (void)checkInvitationStatusForMailboxAddressResponse:(id)response;
- (void)checkTLKsMissingResponse:(id)response;
- (void)checkTLKsMissingWithCompletion:(id)completion;
- (void)claimSecureElementForCurrentUserWithCompletion:(id)completion;
- (void)cloudStoreStatusResponse:(id)response;
- (void)cloudStoreStatusWithCompletion:(id)completion;
- (void)commutePlanReminderForCommutePlan:(id)plan pass:(id)pass withCompletion:(id)completion;
- (void)commutePlanReminderWithCommutePlanAndPassResponse:(id)response;
- (void)configurationDataResponse:(id)response;
- (void)conflictingExpressPassIdentifiersForPassConfiguration:(id)configuration completion:(id)completion;
- (void)conflictingExpressPassIdentifiersForPassConfiguration:(id)configuration withReferenceExpressState:(id)state completion:(id)completion;
- (void)conflictingExpressPassIdentifiersForPassInformationResponse:(id)response;
- (void)consistencyCheck;
- (void)createFidoKeyForRelyingParty:(id)party relyingPartyAccountHash:(id)hash challenge:(id)challenge externalizedAuth:(id)auth completion:(id)completion;
- (void)createFidoKeyResponse:(id)response;
- (void)createShareForPartialShareInvitation:(id)invitation authorization:(id)authorization completion:(id)completion;
- (void)createShareForPartialShareInvitationResponse:(id)response;
- (void)currentPasscodeMeetsUpgradedPasscodePolicy:(id)policy;
- (void)currentSecureElementSnapshot:(id)snapshot;
- (void)currentSecureElementSnapshotResponse:(id)response;
- (void)declineRelatedSharingInvitationsIfNecessaryRequest:(id)request;
- (void)declineRelatedSharingInvitationsIfNecessaryResponse:(id)response;
- (void)deleteKeyMaterialForSubCredentialId:(id)id;
- (void)deleteReservation:(id)reservation completion:(id)completion;
- (void)deleteReservationResponse:(id)response;
- (void)deviceMetadataResponse:(id)response;
- (void)deviceSupportedRadioTechnologiesWithCompletion:(id)completion;
- (void)didRegisterResponse:(id)response;
- (void)dismissRemoteDevicePasscodeUpgradePromptWithCompletion:(id)completion;
- (void)displayableEntitlementsForPassIdentifier:(id)identifier completion:(id)completion;
- (void)displayableEntitlementsForPassIdentifierResponse:(id)response;
- (void)displayableSharesForPassIdentifier:(id)identifier completion:(id)completion;
- (void)displayableSharesForPassIdentifierResponse:(id)response;
- (void)downloadAllPaymentPasses:(id)passes;
- (void)downloadAllPaymentPassesForPaymentWebService:(id)service;
- (void)dumpLogsResponse:(id)response;
- (void)dumpLogsWithCompletion:(id)completion;
- (void)enableServiceModeForPassWithUniqueIdentifier:(id)identifier completion:(id)completion;
- (void)enableServiceModeResponse:(id)response;
- (void)endRequiringUpgradedPasscodeIfNecessary;
- (void)enforceUpgradedPasscodePolicyWithCompletion:(id)completion;
- (void)expressModeEnabledForPassIdentifier:(id)identifier completion:(id)completion;
- (void)familyMembersWithCompletion:(id)completion;
- (void)featureApplicationsForAccountIdentifier:(id)identifier completion:(id)completion;
- (void)featureApplicationsForAccountIdentifierResponse:(id)response;
- (void)fetchOrInitializeAccountAttestationAnonymizationSaltRequest:(id)request;
- (void)fetchRemoteDevicePasscodeStateWithCompletion:(id)completion;
- (void)generateAuxiliaryCapabilitiesForRequirements:(id)requirements completion:(id)completion;
- (void)generateAuxiliaryCapabilitiesResponse:(id)response;
- (void)generateISOEncryptionCertificateForSubCredentialId:(id)id completion:(id)completion;
- (void)generateISOEncryptionCertificateForSubCredentialIdResponse:(id)response;
- (void)generateSEEncryptionCertificateForSubCredentialId:(id)id completion:(id)completion;
- (void)generateSEEncryptionCertificateForSubCredentialIdResponse:(id)response;
- (void)generateTransactionKeyWithParametersResponse:(id)response;
- (void)getPairingInfoResponse:(id)response;
- (void)handleAcceptSubcredentialProvisioningForMailboxAddressRequest:(id)request;
- (void)handleAcceptSubcredentialProvisioningRequest:(id)request;
- (void)handleApplyRestrictionsForPasscodeUpgradeFlowControllerResponse:(id)response;
- (void)handleBalanceChange:(id)change;
- (void)handleBalanceReminderWithBalanceAndPassRequest:(id)request;
- (void)handleCheckUpgradedPasscodePolicyResponse:(id)response;
- (void)handleCompanionMigrationResponse:(id)response;
- (void)handleCompanionMigrationWithCompletion:(id)completion;
- (void)handleCompanionPeerPaymentRegistration;
- (void)handleCompanioniCloudSignout;
- (void)handleCredentialsChange:(id)change;
- (void)handleDeletePaymentTransactionWithIdentifier:(id)identifier passUniqueIdentifier:(id)uniqueIdentifier;
- (void)handleDeviceUnlockedForPendingProvisioningRequest:(id)request;
- (void)handlePasscodeUpgradeFlowShouldExitRequest:(id)request;
- (void)handlePaymentTransactions:(id)transactions;
- (void)handlePeerPaymentTermsAndConditionsAcceptanceRequest:(id)request;
- (void)handlePendingRemovalOfPaymentPass:(id)pass uniqueID:(id)d completion:(id)completion;
- (void)handlePreferredAID:(id)d forPassWithUniqueID:(id)iD completion:(id)completion;
- (void)handleRemoteDevicePasscodeStateResponse:(id)response;
- (void)handleRemoteDevicePasscodeUpgradePresentationPromptResponse:(id)response;
- (void)handleRemovedTransaction:(id)transaction;
- (void)handleShowPaymentSetupRequest:(id)request;
- (void)handleTransactionDefaultsNeededRequest:(id)request;
- (void)handleUpdatedAppletState:(id)state;
- (void)handleUpdatedPeerPaymentWebServiceContext:(id)context;
- (void)handleValueAddedServiceTransactions:(id)transactions;
- (void)handleWebServiceContextDidChangeRequest:(id)request;
- (void)handleWebServiceContextNeededRequest:(id)request;
- (void)hasActiveExternallySharedPasses:(id)passes;
- (void)hasActiveExternallySharedPassesResponse:(id)response;
- (void)hasActiveExternallySharedPassesWithCompletion:(id)completion;
- (void)initializeCloudStoreIfNecessaryResponse:(id)response;
- (void)initializeCloudStoreIfNecessaryWithCompletion:(id)completion;
- (void)initializeCloudStoreIfNecessaryWithHandler:(id)handler;
- (void)initializeCloudStoreIfNecessaryWithHandlerResponse:(id)response;
- (void)longTermPrivacyKeyForCredentialGroupIdentifier:(id)identifier reuseExisting:(BOOL)existing completion:(id)completion;
- (void)longTermPrivacyKeyForCredentialGroupIdentifierResponse:(id)response;
- (void)markAllAppletsForDeletionResponse:(id)response;
- (void)markAllAppletsForDeletionWithCompletion:(id)completion;
- (void)matchingCredentialOnDeviceResponse:(id)response;
- (void)noteProvisioningDidBegin;
- (void)noteProvisioningDidEnd;
- (void)noteProvisioningUserInterfaceDidAppear;
- (void)noteProvisioningUserInterfaceDidDisappear;
- (void)openURLWithRequest:(id)request;
- (void)passSharesForCredentialIdentifierResponse:(id)response;
- (void)passcodeChangeCoordinator:(id)coordinator checkRemoteDeviceLockStateWithCompletion:(id)completion;
- (void)passcodeChangeCoordinator:(id)coordinator remoteDeviceShouldCancelPasscodeChangeWithCompletion:(id)completion;
- (void)passcodeChangeCoordinator:(id)coordinator remoteDeviceShouldInitiatePasscodeChangeForType:(unint64_t)type completion:(id)completion;
- (void)paymentApplicationUsageSummariesResponse:(id)response;
- (void)paymentSetupFeaturesForConfiguration:(id)configuration completion:(id)completion;
- (void)paymentSetupFeaturesForConfigurationResponse:(id)response;
- (void)paymentWebService:(id)service acceptSubcredentialInvitation:(id)invitation completion:(id)completion;
- (void)paymentWebService:(id)service acceptSubcredentialInvitationWithIdentifier:(id)identifier metadata:(id)metadata completion:(id)completion;
- (void)paymentWebService:(id)service accountAttestationAnonymizationSaltWithCompletion:(id)completion;
- (void)paymentWebService:(id)service addPaymentPass:(id)pass withCompletionHandler:(id)handler;
- (void)paymentWebService:(id)service addSecureElementPass:(id)pass properties:(id)properties completion:(id)completion;
- (void)paymentWebService:(id)service canAcceptInvitation:(id)invitation withCompletionV2:(id)v2;
- (void)paymentWebService:(id)service canAddSecureElementPassWithConfiguration:(id)configuration completion:(id)completion;
- (void)paymentWebService:(id)service canHandlePotentialExpressPass:(id)pass withCompletionHandler:(id)handler;
- (void)paymentWebService:(id)service configurationDataWithCompletionHandler:(id)handler;
- (void)paymentWebService:(id)service declineRelatedSharingInvitationsIfNecessary:(id)necessary withCompletion:(id)completion;
- (void)paymentWebService:(id)service deleteApplicationWithAID:(id)d;
- (void)paymentWebService:(id)service deviceMetadataWithFields:(unint64_t)fields completion:(id)completion;
- (void)paymentWebService:(id)service didRegisterWithRegionMap:(id)map primaryRegionTopic:(id)topic;
- (void)paymentWebService:(id)service generateTransactionKeyWithParameters:(id)parameters withCompletion:(id)completion;
- (void)paymentWebService:(id)service handlePotentialExpressPass:(id)pass withCompletionHandler:(id)handler;
- (void)paymentWebService:(id)service matchingInvitationOnDevice:(id)device withTimeout:(unint64_t)timeout completion:(id)completion;
- (void)paymentWebService:(id)service passOwnershipTokenWithIdentifier:(id)identifier completion:(id)completion;
- (void)paymentWebService:(id)service passSharesForCredentialIdentifier:(id)identifier completion:(id)completion;
- (void)paymentWebService:(id)service presentStandaloneTransaction:(int64_t)transaction forPassUniqueIdentifier:(id)identifier terminalReaderIdentifier:(id)readerIdentifier completion:(id)completion;
- (void)paymentWebService:(id)service provisioningDataIncludingDeviceMetadata:(BOOL)metadata withCompletionHandler:(id)handler;
- (void)paymentWebService:(id)service queueConnectionToTrustedServiceManagerForPushTopic:(id)topic withCompletion:(id)completion;
- (void)paymentWebService:(id)service registrationDataWithCompletionHandler:(id)handler;
- (void)paymentWebService:(id)service removePass:(id)pass withCompletionHandler:(id)handler;
- (void)paymentWebService:(id)service removeSharingInvitation:(id)invitation withCompletion:(id)completion;
- (void)paymentWebService:(id)service requestPassUpgrade:(id)upgrade pass:(id)pass completion:(id)completion;
- (void)paymentWebService:(id)service requestSubcredentialInvitation:(id)invitation completion:(id)completion;
- (void)paymentWebService:(id)service setAccountAttestationAnonymizationSalt:(id)salt withCompletion:(id)completion;
- (void)paymentWebService:(id)service setDefaultPaymentPassUniqueIdentifier:(id)identifier;
- (void)paymentWebService:(id)service setNewAuthRandom:(id)random;
- (void)paymentWebService:(id)service setNewAuthRandomIfNecessaryReturningPairingState:(id)state;
- (void)paymentWebService:(id)service signData:(id)data signatureEntanglementMode:(unint64_t)mode withCompletionHandler:(id)handler;
- (void)paymentWebService:(id)service signData:(id)data withCompletionHandler:(id)handler;
- (void)paymentWebService:(id)service subcredentialInvitationsWithCompletion:(id)completion;
- (void)paymentWebService:(id)service updateAccountWithIdentifier:(id)identifier completion:(id)completion;
- (void)paymentWebService:(id)service updateMetadataOnPass:(id)pass withCredential:(id)credential completion:(id)completion;
- (void)paymentWebService:(id)service validateAddBiometricPassPreconditionsWithCompletion:(id)completion;
- (void)paymentWebService:(id)service validateAddPreconditionsWithCompletion:(id)completion;
- (void)paymentWebService:(id)service validateTransferPreconditionsWithCompletion:(id)completion;
- (void)paymentWebServiceDidUpdateConfiguration:(id)configuration;
- (void)paymentWebServiceOwnershipTokenResponse:(id)response;
- (void)paymentWebServiceRegisterResponse:(id)response;
- (void)peerPaymentRegisterResponse:(id)response;
- (void)peerPaymentRegisterWithURL:(id)l forceReRegistration:(BOOL)registration completion:(id)completion;
- (void)peerPaymentUnregisterResponse:(id)response;
- (void)peerPaymentUnregisterWithCompletion:(id)completion;
- (void)pendingProvisioningReceiptRequest:(id)request;
- (void)pendingRemovalResponse:(id)response;
- (void)performDeviceCheckInResponse:(id)response;
- (void)performDeviceCheckInWithCompletion:(id)completion;
- (void)performDeviceRegistrationForReason:(id)reason brokerURL:(id)l completion:(id)completion;
- (void)performProductActionRequest:(id)request completion:(id)completion;
- (void)performProductActionResponse:(id)response;
- (void)photosForFamilyMembersWithDSIDs:(id)ds completion:(id)completion;
- (void)photosForFamilyMembersWithDSIDsResponse:(id)response;
- (void)preconditionNotMet:(id)met;
- (void)preferredAIDRequest:(id)request;
- (void)preferredAIDResponse:(id)response;
- (void)prepareProvisioningTarget:(id)target checkFamilyCircle:(BOOL)circle completion:(id)completion;
- (void)prepareProvisioningTargetResponse:(id)response;
- (void)presentRemoteDevicePasscodeUpgradePromptForChangeType:(unint64_t)type completion:(id)completion;
- (void)presentStandaloneTransactionForPassUniqueIdentifierResponse:(id)response;
- (void)prewarmCreateShareForPassIdentifier:(id)identifier completion:(id)completion;
- (void)prewarmCreateShareForPassIdentifierResponse:(id)response;
- (void)productsWithRequest:(id)request completion:(id)completion;
- (void)provisionHomeKeyPassForSerialNumbers:(id)numbers completionHandler:(id)handler;
- (void)provisionHomeKeyPassForSerialNumbersResponse:(id)response;
- (void)provisionPassForRemoteCredentialWithType:(int64_t)type andIdentifier:(id)identifier completion:(id)completion;
- (void)provisionPassForRemoteCredentialWithTypeAndIdentifierResponse:(id)response;
- (void)provisionPeerPaymentPassResponse:(id)response;
- (void)provisionPeerPaymentPassWithCompletion:(id)completion;
- (void)provisioningDataResponse:(id)response;
- (void)queueTSMConnectionResponse:(id)response;
- (void)reclaimUnusedSEMemory:(id)memory;
- (void)reclaimUnusedSEMemoryResponse:(id)response;
- (void)registerCredentialsResponse:(id)response;
- (void)registerCredentialsWithIdentifiers:(id)identifiers completion:(id)completion;
- (void)registrationDataResponse:(id)response;
- (void)remotePassUpgradeResponse:(id)response;
- (void)remotePassUpgradeWithRequest:(id)request pass:(id)pass requireAuthorization:(BOOL)authorization notifyUserOnPairedDevice:(BOOL)device updateBlock:(id)block;
- (void)removeAIDsFromSecureElement:(id)element withCompletion:(id)completion;
- (void)removeExpressPassWithUniqueIdentifier:(id)identifier completion:(id)completion;
- (void)removeExpressPassWithUniqueIdentifierResponse:(id)response;
- (void)removeSharingInvitationResponse:(id)response;
- (void)renewAppleAccountWithCompletionHandler:(id)handler;
- (void)requestAndStoreExternalizedAuthWithCompletion:(id)completion;
- (void)requestAndStoreExternalizedAuthWithCompletionResponse:(id)response;
- (void)requestAutomaticProvisioningForCompanionPaymentPass:(id)pass;
- (void)requestPasscodeUpgradeForPasscodeUpgradeFlowController:(id)controller withVisibleViewController:(id)viewController completion:(id)completion;
- (void)requestSubcredentialInvitationResponse:(id)response;
- (void)reserveStorageForAppletTypes:(id)types metadata:(id)metadata completion:(id)completion;
- (void)reserveStorageForAppletTypesResponse:(id)response;
- (void)resetApplePayManateeViewResponse:(id)response;
- (void)resetApplePayManateeViewWithCompletion:(id)completion;
- (void)retrieveShareInvitationForMailboxAddress:(id)address completion:(id)completion;
- (void)retrieveShareInvitationForMailboxAddressResponse:(id)response;
- (void)retrieveTransactionsForPassWithUniqueID:(id)d;
- (void)revokeCredentialsResponse:(id)response;
- (void)revokeCredentialsWithIdentifiers:(id)identifiers completion:(id)completion;
- (void)revokeCredentialsWithReaderIdentifiers:(id)identifiers completion:(id)completion;
- (void)revokeCredentialsWithReaderIdentifiersResponse:(id)response;
- (void)revokeShareForPassIdentifier:(id)identifier share:(id)share shouldCascade:(BOOL)cascade completion:(id)completion;
- (void)revokeShareForPassIdentifierResponse:(id)response;
- (void)secureElementAppletsWithCompletion:(id)completion;
- (void)secureElementGetAppletsResponse:(id)response;
- (void)secureElementRemoveAppletsResponse:(id)response;
- (void)sendPaymentOptionsDefaultsToWatch;
- (void)sendWebServiceContextToWatch:(id)watch;
- (void)service:(id)service account:(id)account identifier:(id)identifier didSendWithSuccess:(BOOL)success error:(id)error;
- (void)service:(id)service account:(id)account incomingUnhandledProtobuf:(id)protobuf fromID:(id)d context:(id)context;
- (void)service:(id)service activeAccountsChanged:(id)changed;
- (void)service:(id)service devicesChanged:(id)changed;
- (void)serviceProviderDataForPassWithUniqueIdentifier:(id)identifier encrypted:(BOOL)encrypted completion:(id)completion;
- (void)serviceProviderDataForPassWithUniqueIdentifierResponse:(id)response;
- (void)setAccountAttestationAnonymizationSaltResponse:(id)response;
- (void)setBalanceReminder:(id)reminder forBalance:(id)balance pass:(id)pass completion:(id)completion;
- (void)setBalanceReminderWithBalanceAndPassResponse:(id)response;
- (void)setCommutePlanReminder:(id)reminder forCommutePlan:(id)plan pass:(id)pass completion:(id)completion;
- (void)setCommutePlanReminderWithCommutePlanAndPassResponse:(id)response;
- (void)setExpressPassResponse:(id)response;
- (void)setExpressWithPassConfiguration:(id)configuration requestAuthorization:(BOOL)authorization completion:(id)completion;
- (void)setNewAuthRandomIfNecessaryAtBeginningOfProvisioningFlow:(id)flow;
- (void)setNewAuthRandomResponse:(id)response;
- (void)setPasscodeUpgradeFlowController:(id)controller;
- (void)setPeerPaymentPreferences:(id)preferences completion:(id)completion;
- (void)setPeerPaymentPreferencesResponse:(id)response;
- (void)signDataResponse:(id)response;
- (void)signWithFidoKeyForRelyingParty:(id)party relyingPartyAccountHash:(id)hash fidoKeyHash:(id)keyHash challenge:(id)challenge publicKeyIdentifier:(id)identifier externalizedAuth:(id)auth completion:(id)completion;
- (void)signWithFidoKeyResponse:(id)response;
- (void)startBackgroundVerificationObserverForPass:(id)pass verificationMethod:(id)method;
- (void)startRequiringUpgradedPasscodeWithPasscodeMeetsPolicy:(BOOL)policy;
- (void)statusForShareableCredentials:(id)credentials completion:(id)completion;
- (void)statusForShareableCredentialsResponse:(id)response;
- (void)subcredentialInvitationsResponse:(id)response;
- (void)triggerCloudStoreZoneCreationForAccount:(id)account withCompletion:(id)completion;
- (void)triggerCloudStoreZoneCreationForAccountResponse:(id)response;
- (void)updateAccountWithIdentifierResponse:(id)response;
- (void)updatePaymentPass:(id)pass;
- (void)updatePeerPaymentAccountResponse:(id)response;
- (void)updatePeerPaymentAccountWithCompletion:(id)completion;
- (void)updatePushToken:(id)token;
- (void)updateShareForPassIdentifier:(id)identifier share:(id)share authorization:(id)authorization completion:(id)completion;
- (void)updateShareForPassIdentifierResponse:(id)response;
- (void)updateSubcredentialMetadataResponse:(id)response;
- (void)updatedAccountsForProvisioningWithCompletion:(id)completion;
@end

@implementation NPKPaymentWebServiceCompanionTargetDevice

- (BOOL)_isUnifiedAccessProvisioningSupported
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"AD3C8B62-1FB2-4A7A-ABF1-EBD5AF574209"];
  v4 = [v2 supportsCapability:v3];

  return v4;
}

- (BOOL)_isParallelProvisioningSupported
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"94251CFF-6FD3-4126-9C80-71C8FC8F9F6C"];
  v4 = [v2 supportsCapability:v3];

  return v4;
}

- (BOOL)_isAutoTopUpSupported
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"763A8A6B-1D96-4298-878A-A0FF3C627D79"];
  v4 = [v2 supportsCapability:v3];

  return v4;
}

- (BOOL)_isSubcredentialArchivingWithRenamedConfigurationSupported
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"E6F0AB1C-320C-4941-9948-D2EAE7BA9A51"];
  v4 = [v2 supportsCapability:v3];

  return v4;
}

- (BOOL)_isRevokeCredentialsWithReaderIdentifiersSupported
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"E6F0AB1C-320C-4941-9948-D2EAE7BA9A51"];
  v4 = [v2 supportsCapability:v3];

  return v4;
}

- (BOOL)_isDynamicSESupported
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"D5834418-F4A0-4C74-AA38-8ED5F7765BD1"];
  v4 = [v2 supportsCapability:v3];

  return v4;
}

- (BOOL)_isSimultaneousSinglePollingAndGymKitSupported
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"D5834418-F4A0-4C74-AA38-8ED5F7765BD1"];
  v4 = [v2 supportsCapability:v3];

  return v4;
}

+ (id)bridgedClientInfoHTTPHeader
{
  v2 = NPKPairedOrPairingDevice();
  v21 = [v2 valueForProperty:*MEMORY[0x277D2BBC0]];
  v20 = [v2 valueForProperty:*MEMORY[0x277D2BC10]];
  v19 = [v2 valueForProperty:*MEMORY[0x277D2BC20]];
  v18 = [v2 valueForProperty:*MEMORY[0x277D2BC08]];
  v17 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@", v21];
  v3 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@%@;%@", v20, v19, v18];;
  v4 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
  infoDictionary = [v4 infoDictionary];
  v6 = *MEMORY[0x277CBED58];
  v7 = [infoDictionary objectForKey:*MEMORY[0x277CBED58]];

  mainBundle = [MEMORY[0x277CCA8D8] mainBundle];
  infoDictionary2 = [mainBundle infoDictionary];
  v10 = [infoDictionary2 objectForKey:v6];

  v11 = MEMORY[0x277CCACA8];
  bundleIdentifier = [v4 bundleIdentifier];
  bundleIdentifier2 = [mainBundle bundleIdentifier];
  v14 = [v11 stringWithFormat:@"%@/%@ (%@/%@)", bundleIdentifier, v7, bundleIdentifier2, v10];

  v15 = [MEMORY[0x277CCACA8] stringWithFormat:@"<%@> <%@> <%@>", v17, v3, v14];

  return v15;
}

- (NPKPaymentWebServiceCompanionTargetDevice)initWithContext:(unint64_t)context responseQueue:(id)queue
{
  queueCopy = queue;
  v16.receiver = self;
  v16.super_class = NPKPaymentWebServiceCompanionTargetDevice;
  v7 = [(NPKPaymentWebServiceCompanionTargetDevice *)&v16 init];
  v8 = v7;
  if (v7)
  {
    [(NPKPaymentWebServiceCompanionTargetDevice *)v7 setResponseQueue:queueCopy];
    [(NPKPaymentWebServiceCompanionTargetDevice *)v8 setContext:context];
    if (context == 1)
    {
      v9 = @"com.apple.private.alloy.passbook.maintenance";
    }

    else
    {
      v9 = @"com.apple.private.alloy.passbook.provisioning";
    }

    v10 = [objc_alloc(MEMORY[0x277D18778]) initWithService:v9];
    [v10 setProtobufAction:sel_queueTSMConnectionResponse_ forIncomingResponsesOfType:1];
    [v10 setProtobufAction:sel_provisioningDataResponse_ forIncomingResponsesOfType:2];
    [v10 setProtobufAction:sel_registrationDataResponse_ forIncomingResponsesOfType:3];
    [v10 setProtobufAction:sel_configurationDataResponse_ forIncomingResponsesOfType:4];
    [v10 setProtobufAction:sel_signDataResponse_ forIncomingResponsesOfType:14];
    [v10 setProtobufAction:sel_secureElementGetAppletsResponse_ forIncomingResponsesOfType:5];
    [v10 setProtobufAction:sel_secureElementRemoveAppletsResponse_ forIncomingResponsesOfType:6];
    [v10 setProtobufAction:sel_setNewAuthRandomResponse_ forIncomingResponsesOfType:7];
    [v10 setProtobufAction:sel_didRegisterResponse_ forIncomingResponsesOfType:8];
    [v10 setProtobufAction:sel_dumpLogsResponse_ forIncomingResponsesOfType:9];
    [v10 setProtobufAction:sel_pendingRemovalResponse_ forIncomingResponsesOfType:12];
    [v10 setProtobufAction:sel_updatePaymentPass_ forIncomingRequestsOfType:10];
    [v10 setProtobufAction:sel_updatePushToken_ forIncomingRequestsOfType:11];
    [v10 setProtobufAction:sel_preconditionNotMet_ forIncomingRequestsOfType:13];
    [v10 setProtobufAction:sel_handleValueAddedServiceTransactions_ forIncomingRequestsOfType:15];
    [v10 setProtobufAction:sel_preferredAIDRequest_ forIncomingRequestsOfType:16];
    [v10 setProtobufAction:sel_preferredAIDResponse_ forIncomingResponsesOfType:16];
    [v10 setProtobufAction:sel_handleWebServiceContextDidChangeRequest_ forIncomingRequestsOfType:17];
    [v10 setProtobufAction:sel_handleWebServiceContextNeededRequest_ forIncomingRequestsOfType:18];
    [v10 setProtobufAction:sel_handlePaymentTransactions_ forIncomingRequestsOfType:19];
    [v10 setProtobufAction:sel_handlePaymentTransactions_ forIncomingResponsesOfType:20];
    [v10 setProtobufAction:sel_handleRemovedTransaction_ forIncomingRequestsOfType:26];
    [v10 setProtobufAction:sel_setExpressPassResponse_ forIncomingResponsesOfType:22];
    [v10 setProtobufAction:sel_removeExpressPassWithUniqueIdentifierResponse_ forIncomingResponsesOfType:46];
    [v10 setProtobufAction:sel_conflictingExpressPassIdentifiersForPassInformationResponse_ forIncomingResponsesOfType:53];
    [v10 setProtobufAction:sel_handleBalanceReminderWithBalanceAndPassRequest_ forIncomingRequestsOfType:57];
    [v10 setProtobufAction:sel_setBalanceReminderWithBalanceAndPassResponse_ forIncomingResponsesOfType:57];
    [v10 setProtobufAction:sel_setCommutePlanReminderWithCommutePlanAndPassResponse_ forIncomingResponsesOfType:58];
    [v10 setProtobufAction:sel_balanceReminderWithBalanceAndPassResponse_ forIncomingResponsesOfType:65];
    [v10 setProtobufAction:sel_commutePlanReminderWithCommutePlanAndPassResponse_ forIncomingResponsesOfType:66];
    [v10 setProtobufAction:sel_handleUpdatedAppletState_ forIncomingRequestsOfType:25];
    [v10 setProtobufAction:sel_getPairingInfoResponse_ forIncomingResponsesOfType:21];
    [v10 setProtobufAction:sel_handleShowPaymentSetupRequest_ forIncomingRequestsOfType:24];
    [v10 setProtobufAction:sel_enableServiceModeResponse_ forIncomingResponsesOfType:27];
    [v10 setProtobufAction:sel_handleTransactionDefaultsNeededRequest_ forIncomingRequestsOfType:28];
    [v10 setProtobufAction:sel_handleCompanionMigrationResponse_ forIncomingResponsesOfType:30];
    [v10 setProtobufAction:sel_peerPaymentRegisterResponse_ forIncomingResponsesOfType:31];
    [v10 setProtobufAction:sel_peerPaymentUnregisterResponse_ forIncomingResponsesOfType:32];
    [v10 setProtobufAction:sel_handleUpdatedPeerPaymentWebServiceContext_ forIncomingRequestsOfType:33];
    [v10 setProtobufAction:sel_provisionPeerPaymentPassResponse_ forIncomingResponsesOfType:34];
    [v10 setProtobufAction:sel_updatePeerPaymentAccountResponse_ forIncomingResponsesOfType:48];
    [v10 setProtobufAction:sel_setPeerPaymentPreferencesResponse_ forIncomingResponsesOfType:88];
    [v10 setProtobufAction:sel_triggerCloudStoreZoneCreationForAccountResponse_ forIncomingResponsesOfType:130];
    [v10 setProtobufAction:sel_provisionPassForRemoteCredentialWithTypeAndIdentifierResponse_ forIncomingResponsesOfType:131];
    [v10 setProtobufAction:sel_openURLWithRequest_ forIncomingRequestsOfType:60];
    [v10 setProtobufAction:sel_handlePeerPaymentTermsAndConditionsAcceptanceRequest_ forIncomingRequestsOfType:40];
    [v10 setProtobufAction:sel_deviceMetadataResponse_ forIncomingResponsesOfType:54];
    [v10 setProtobufAction:sel_updateAccountWithIdentifierResponse_ forIncomingResponsesOfType:55];
    [v10 setProtobufAction:sel_accountWithIdentifierResponse_ forIncomingResponsesOfType:133];
    [v10 setProtobufAction:sel_handleDeviceUnlockedForPendingProvisioningRequest_ forIncomingRequestsOfType:56];
    [v10 setProtobufAction:sel_performDeviceCheckInResponse_ forIncomingResponsesOfType:62];
    [v10 setProtobufAction:sel_availableProductsResponse_ forIncomingResponsesOfType:63];
    [v10 setProtobufAction:sel_performProductActionResponse_ forIncomingResponsesOfType:64];
    [v10 setProtobufAction:sel_checkTLKsMissingResponse_ forIncomingResponsesOfType:41];
    [v10 setProtobufAction:sel_initializeCloudStoreIfNecessaryWithHandlerResponse_ forIncomingResponsesOfType:42];
    [v10 setProtobufAction:sel_resetApplePayManateeViewResponse_ forIncomingResponsesOfType:43];
    [v10 setProtobufAction:sel_downloadAllPaymentPasses_ forIncomingRequestsOfType:35];
    [v10 setProtobufAction:sel_checkCompanionPeerPaymentRegistrationState_ forIncomingRequestsOfType:37];
    [v10 setProtobufAction:sel_initializeCloudStoreIfNecessaryResponse_ forIncomingResponsesOfType:38];
    [v10 setProtobufAction:sel_cloudStoreStatusResponse_ forIncomingResponsesOfType:39];
    [v10 setProtobufAction:sel_markAllAppletsForDeletionResponse_ forIncomingResponsesOfType:44];
    [v10 setProtobufAction:sel_handleBalanceChange_ forIncomingRequestsOfType:47];
    [v10 setProtobufAction:sel_remotePassUpgradeResponse_ forIncomingResponsesOfType:50];
    [v10 setProtobufAction:sel_handleCheckUpgradedPasscodePolicyResponse_ forIncomingResponsesOfType:61];
    [v10 setProtobufAction:sel_handleRemoteDevicePasscodeUpgradePresentationPromptResponse_ forIncomingResponsesOfType:108];
    [v10 setProtobufAction:sel_handlePasscodeUpgradeFlowShouldExitRequest_ forIncomingRequestsOfType:67];
    [v10 setProtobufAction:sel_handleApplyRestrictionsForPasscodeUpgradeFlowControllerResponse_ forIncomingResponsesOfType:68];
    [v10 setProtobufAction:sel_handleRemoteDevicePasscodeStateResponse_ forIncomingResponsesOfType:109];
    [v10 setProtobufAction:sel_subcredentialInvitationsResponse_ forIncomingResponsesOfType:70];
    [v10 setProtobufAction:sel_acceptSubcredentialInvitationResponse_ forIncomingResponsesOfType:71];
    [v10 setProtobufAction:sel_acceptSubcredentialInvitationResponse_ forIncomingResponsesOfType:122];
    [v10 setProtobufAction:sel_matchingCredentialOnDeviceResponse_ forIncomingResponsesOfType:72];
    [v10 setProtobufAction:sel_canAddSecureElementPassWithConfigurationResponse_ forIncomingResponsesOfType:90];
    [v10 setProtobufAction:sel_canAcceptInvitationRequest_ forIncomingRequestsOfType:73];
    [v10 setProtobufAction:sel_canAcceptInvitationResponse_ forIncomingResponsesOfType:73];
    [v10 setProtobufAction:sel_handleAcceptSubcredentialProvisioningRequest_ forIncomingRequestsOfType:122];
    [v10 setProtobufAction:sel_handleAcceptSubcredentialProvisioningRequest_ forIncomingRequestsOfType:71];
    [v10 setProtobufAction:sel_fetchOrInitializeAccountAttestationAnonymizationSaltRequest_ forIncomingRequestsOfType:74];
    [v10 setProtobufAction:sel_accountAttestationAnonymizationSaltResponse_ forIncomingResponsesOfType:74];
    [v10 setProtobufAction:sel_setAccountAttestationAnonymizationSaltResponse_ forIncomingResponsesOfType:75];
    [v10 setProtobufAction:sel_requestSubcredentialInvitationResponse_ forIncomingResponsesOfType:76];
    [v10 setProtobufAction:sel_updateSubcredentialMetadataResponse_ forIncomingResponsesOfType:77];
    [v10 setProtobufAction:sel_registerCredentialsResponse_ forIncomingResponsesOfType:78];
    [v10 setProtobufAction:sel_revokeCredentialsResponse_ forIncomingResponsesOfType:79];
    [v10 setProtobufAction:sel_removeSharingInvitationResponse_ forIncomingResponsesOfType:80];
    [v10 setProtobufAction:sel_handleCredentialsChange_ forIncomingRequestsOfType:81];
    [v10 setProtobufAction:sel_declineRelatedSharingInvitationsIfNecessaryRequest_ forIncomingRequestsOfType:82];
    [v10 setProtobufAction:sel_declineRelatedSharingInvitationsIfNecessaryResponse_ forIncomingResponsesOfType:82];
    [v10 setProtobufAction:sel_photosForFamilyMembersWithDSIDsResponse_ forIncomingResponsesOfType:87];
    [v10 setProtobufAction:sel_featureApplicationsForAccountIdentifierResponse_ forIncomingResponsesOfType:89];
    [v10 setProtobufAction:sel_provisionHomeKeyPassForSerialNumbersResponse_ forIncomingResponsesOfType:92];
    [v10 setProtobufAction:sel_availableHomeKeyPassesResponse_ forIncomingResponsesOfType:93];
    [v10 setProtobufAction:sel_paymentWebServiceRegisterResponse_ forIncomingResponsesOfType:94];
    [v10 setProtobufAction:sel_createFidoKeyResponse_ forIncomingResponsesOfType:95];
    [v10 setProtobufAction:sel_checkFidoKeyResponse_ forIncomingResponsesOfType:96];
    [v10 setProtobufAction:sel_signWithFidoKeyResponse_ forIncomingResponsesOfType:97];
    [v10 setProtobufAction:sel_generateISOEncryptionCertificateForSubCredentialIdResponse_ forIncomingResponsesOfType:98];
    [v10 setProtobufAction:sel_requestAndStoreExternalizedAuthWithCompletionResponse_ forIncomingResponsesOfType:99];
    [v10 setProtobufAction:sel_generateTransactionKeyWithParametersResponse_ forIncomingResponsesOfType:100];
    [v10 setProtobufAction:sel_generateSEEncryptionCertificateForSubCredentialIdResponse_ forIncomingResponsesOfType:101];
    [v10 setProtobufAction:sel_addISO18013BlobsResponse_ forIncomingResponsesOfType:107];
    [v10 setProtobufAction:sel_presentStandaloneTransactionForPassUniqueIdentifierResponse_ forIncomingResponsesOfType:103];
    [v10 setProtobufAction:sel_serviceProviderDataForPassWithUniqueIdentifierResponse_ forIncomingResponsesOfType:104];
    [v10 setProtobufAction:sel_generateAuxiliaryCapabilitiesResponse_ forIncomingResponsesOfType:152];
    [v10 setProtobufAction:sel_longTermPrivacyKeyForCredentialGroupIdentifierResponse_ forIncomingResponsesOfType:110];
    [v10 setProtobufAction:sel_retrieveShareInvitationForMailboxAddressResponse_ forIncomingResponsesOfType:111];
    [v10 setProtobufAction:sel_revokeShareForPassIdentifierResponse_ forIncomingResponsesOfType:112];
    [v10 setProtobufAction:sel_passSharesForCredentialIdentifierResponse_ forIncomingResponsesOfType:113];
    [v10 setProtobufAction:sel_displayableSharesForPassIdentifierResponse_ forIncomingResponsesOfType:114];
    [v10 setProtobufAction:sel_displayableEntitlementsForPassIdentifierResponse_ forIncomingResponsesOfType:115];
    [v10 setProtobufAction:sel_createShareForPartialShareInvitationResponse_ forIncomingResponsesOfType:116];
    [v10 setProtobufAction:sel_prewarmCreateShareForPassIdentifierResponse_ forIncomingResponsesOfType:127];
    [v10 setProtobufAction:sel_statusForShareableCredentialsResponse_ forIncomingResponsesOfType:117];
    [v10 setProtobufAction:sel_prepareProvisioningTargetResponse_ forIncomingResponsesOfType:118];
    [v10 setProtobufAction:sel_acceptCarKeyShareForMessageResponse_ forIncomingResponsesOfType:121];
    [v10 setProtobufAction:sel_checkInvitationStatusForMailboxAddress_completion_ forIncomingResponsesOfType:123];
    [v10 setProtobufAction:sel_updateShareForPassIdentifier_share_authorization_completion_ forIncomingResponsesOfType:124];
    [v10 setProtobufAction:sel_handleAcceptSubcredentialProvisioningForMailboxAddressRequest_ forIncomingRequestsOfType:126];
    [v10 setProtobufAction:sel_carKeyStartShareAcceptanceFlowResponse_ forIncomingResponsesOfType:140];
    [v10 setProtobufAction:sel_carKeyRoutingInformationResponse_ forIncomingResponsesOfType:141];
    [v10 setProtobufAction:sel_carKeyGetProductPlanIdentifierResponse_ forIncomingResponsesOfType:142];
    [v10 setProtobufAction:sel_carKeySetEncryptedProductPlanIdentifierContainerResponse_ forIncomingResponsesOfType:143];
    [v10 setProtobufAction:sel_carKeyAccountAttestationResponse_ forIncomingResponsesOfType:144];
    [v10 setProtobufAction:sel_carKeyGetPretrackResponse_ forIncomingResponsesOfType:145];
    [v10 setProtobufAction:sel_carKeySetAccountAttestationResponse_ forIncomingResponsesOfType:146];
    [v10 setProtobufAction:sel_carKeyUpdateTrackingAttestationResponse_ forIncomingResponsesOfType:147];
    [v10 setProtobufAction:sel_carKeyAcceptInvitationResponse_ forIncomingResponsesOfType:148];
    [v10 setProtobufAction:sel_carKeyHandleRecipientMessageResponse_ forIncomingResponsesOfType:149];
    [v10 setProtobufAction:sel_carKeyRetryActivationCodeResponse_ forIncomingResponsesOfType:150];
    [v10 setProtobufAction:sel_carKeyDecryptDataResponse_ forIncomingResponsesOfType:151];
    [v10 setProtobufAction:sel_carKeyRejectInvitationResponse_ forIncomingResponsesOfType:153];
    [v10 setProtobufAction:sel_addSecureElementPassWithPropertiesResponse_ forIncomingResponsesOfType:154];
    [v10 setProtobufAction:sel_revokeCredentialsWithReaderIdentifiersResponse_ forIncomingResponsesOfType:155];
    [v10 setProtobufAction:sel_paymentWebServiceOwnershipTokenResponse_ forIncomingResponsesOfType:119];
    [v10 setProtobufAction:sel_paymentSetupFeaturesForConfigurationResponse_ forIncomingResponsesOfType:120];
    [v10 setProtobufAction:sel_hasActiveExternallySharedPassesResponse_ forIncomingResponsesOfType:132];
    [v10 setProtobufAction:sel_currentSecureElementSnapshotResponse_ forIncomingResponsesOfType:134];
    [v10 setProtobufAction:sel_reserveStorageForAppletTypesResponse_ forIncomingResponsesOfType:135];
    [v10 setProtobufAction:sel_deleteReservationResponse_ forIncomingResponsesOfType:136];
    [v10 setProtobufAction:sel_addPendingProvisioningsRequest_ forIncomingRequestsOfType:137];
    [v10 setProtobufAction:sel_addPendingProvisioningsResponse_ forIncomingResponsesOfType:137];
    [v10 setProtobufAction:sel_cancelAutoTopUpResponse_ forIncomingResponsesOfType:138];
    [v10 setProtobufAction:sel_pendingProvisioningReceiptRequest_ forIncomingRequestsOfType:156];
    [v10 setProtobufAction:sel_paymentApplicationUsageSummariesResponse_ forIncomingResponsesOfType:157];
    [v10 setProtobufAction:sel_reclaimUnusedSEMemoryResponse_ forIncomingResponsesOfType:158];
    [v10 addDelegate:v8 queue:queueCopy];
    [(NPKPaymentWebServiceCompanionTargetDevice *)v8 setProvisioningService:v10];
    v11 = [[NPKTargetDeviceAssertionManager alloc] initWithTransportationService:v10];
    remoteDeviceAssertionManager = v8->_remoteDeviceAssertionManager;
    v8->_remoteDeviceAssertionManager = v11;

    dictionary = [MEMORY[0x277CBEB38] dictionary];
    [(NPKPaymentWebServiceCompanionTargetDevice *)v8 setOutstandingRequests:dictionary];

    v14 = dispatch_queue_create("com.apple.NPKPaymentWebServiceCompanionTargetDevice", 0);
    [(NPKPaymentWebServiceCompanionTargetDevice *)v8 setInternalQueue:v14];
  }

  return v8;
}

- (void)service:(id)service activeAccountsChanged:(id)changed
{
  v11 = *MEMORY[0x277D85DE8];
  changedCopy = changed;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v9 = 138412290;
      v10 = changedCopy;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Active accounts changed: %@", &v9, 0xCu);
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)service:(id)service devicesChanged:(id)changed
{
  v11 = *MEMORY[0x277D85DE8];
  changedCopy = changed;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v9 = 138412290;
      v10 = changedCopy;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Devices changed: %@", &v9, 0xCu);
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)service:(id)service account:(id)account incomingUnhandledProtobuf:(id)protobuf fromID:(id)d context:(id)context
{
  v30 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  accountCopy = account;
  protobufCopy = protobuf;
  dCopy = d;
  contextCopy = context;
  v16 = pk_Payment_log();
  v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);

  if (v17)
  {
    v18 = pk_Payment_log();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v20 = 138413314;
      v21 = serviceCopy;
      v22 = 2112;
      v23 = accountCopy;
      v24 = 2112;
      v25 = protobufCopy;
      v26 = 2112;
      v27 = dCopy;
      v28 = 2112;
      v29 = contextCopy;
      _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_ERROR, "Error: Incoming unhandled protobuf: %@ %@ %@ %@ %@", &v20, 0x34u);
    }
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)service:(id)service account:(id)account identifier:(id)identifier didSendWithSuccess:(BOOL)success error:(id)error
{
  successCopy = success;
  v37 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  accountCopy = account;
  identifierCopy = identifier;
  errorCopy = error;
  v16 = pk_Payment_log();
  v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

  if (v17)
  {
    v18 = pk_Payment_log();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138413314;
      v28 = serviceCopy;
      v29 = 2112;
      v30 = accountCopy;
      v31 = 2112;
      v32 = identifierCopy;
      v33 = 1024;
      v34 = successCopy;
      v35 = 2112;
      v36 = errorCopy;
      _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Notice: Service sent with success: %@ %@ %@ %d %@", buf, 0x30u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v23[0] = MEMORY[0x277D85DD0];
  v23[1] = 3221225472;
  v23[2] = __97__NPKPaymentWebServiceCompanionTargetDevice_service_account_identifier_didSendWithSuccess_error___block_invoke;
  v23[3] = &unk_279949A68;
  v23[4] = self;
  v24 = identifierCopy;
  v26 = successCopy;
  v25 = errorCopy;
  v20 = errorCopy;
  v21 = identifierCopy;
  dispatch_async(internalQueue, v23);

  v22 = *MEMORY[0x277D85DE8];
}

void __97__NPKPaymentWebServiceCompanionTargetDevice_service_account_identifier_didSendWithSuccess_error___block_invoke(uint64_t a1)
{
  v36 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v7 = *(a1 + 40);
      v8 = [v3 errorHandler];
      v9 = _Block_copy(v8);
      *buf = 138412802;
      v31 = v7;
      v32 = 2112;
      v33 = v3;
      v34 = 2112;
      v35 = v9;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: identifier %@ request %@ error handler %@", buf, 0x20u);
    }
  }

  if (v3 && (*(a1 + 56) & 1) == 0)
  {
    v10 = NPKGetIDSCommunicationError();
    v11 = *MEMORY[0x277CCA7E8];
    v29[0] = *(a1 + 48);
    v12 = *MEMORY[0x277CCA450];
    v28[0] = v11;
    v28[1] = v12;
    v13 = [v10 localizedDescription];
    v29[1] = v13;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:2];

    v15 = MEMORY[0x277CCA9B8];
    v16 = [v10 domain];
    v17 = [v15 errorWithDomain:v16 code:objc_msgSend(v10 userInfo:{"code"), v14}];

    v18 = [v3 errorHandler];
    if (v18)
    {
      v19 = dispatch_get_global_queue(0, 0);
      v22 = MEMORY[0x277D85DD0];
      v23 = 3221225472;
      v24 = __97__NPKPaymentWebServiceCompanionTargetDevice_service_account_identifier_didSendWithSuccess_error___block_invoke_364;
      v25 = &unk_279946670;
      v27 = v18;
      v26 = v17;
      dispatch_async(v19, &v22);
    }

    v20 = [*(a1 + 32) outstandingRequests];
    [v20 removeObjectForKey:*(a1 + 40)];
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (id)bridgedClientInfo
{
  v2 = objc_opt_class();

  return [v2 bridgedClientInfoHTTPHeader];
}

- (unint64_t)currentPassbookState
{
  if (!PKPassbookIsSupported())
  {
    return 0;
  }

  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"A3D877D2-408A-43F1-9CA4-39C9F3609A93"];
  v4 = [v2 supportsCapability:v3];

  if (!v4)
  {
    return 1;
  }

  if (NPKPairedWatchHasWalletInstalled())
  {
    return 1;
  }

  return 3;
}

- (void)noteProvisioningDidBegin
{
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      *v6 = 0;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Noting that provisioning began", v6, 2u);
    }
  }

  [(NPKPaymentWebServiceCompanionTargetDevice *)self _acquireAssertionOfType:1];
}

- (void)noteProvisioningDidEnd
{
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      *v6 = 0;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Noting that provisioning ended", v6, 2u);
    }
  }

  [(NPKPaymentWebServiceCompanionTargetDevice *)self _invalidateAssertionOfType:1];
}

- (void)startBackgroundVerificationObserverForPass:(id)pass verificationMethod:(id)method
{
  v19 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  methodCopy = method;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      uniqueID = [passCopy uniqueID];
      identifier = [methodCopy identifier];
      v15 = 138412546;
      v16 = uniqueID;
      v17 = 2112;
      v18 = identifier;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Starting background verification observer for %@ with verification method %@", &v15, 0x16u);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate startBackgroundVerificationObserverForPass:passCopy verificationMethod:methodCopy];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)noteProvisioningUserInterfaceDidAppear
{
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Noting that the provisioning UI appeared", buf, 2u);
    }
  }

  v6 = NPKPairedOrPairingDevice();
  if (v6)
  {
    mEMORY[0x277D2BCF8] = [MEMORY[0x277D2BCF8] sharedInstance];
    v8[0] = MEMORY[0x277D85DD0];
    v8[1] = 3221225472;
    v8[2] = __83__NPKPaymentWebServiceCompanionTargetDevice_noteProvisioningUserInterfaceDidAppear__block_invoke;
    v8[3] = &unk_279949A90;
    v8[4] = self;
    [mEMORY[0x277D2BCF8] setActivePairedDevice:v6 withActiveDeviceAssertionHandler:v8];
  }
}

void __83__NPKPaymentWebServiceCompanionTargetDevice_noteProvisioningUserInterfaceDidAppear__block_invoke(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = pk_Payment_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v12 = 138412546;
      v13 = v5;
      v14 = 2112;
      v15 = v6;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: error %@ assertion %@", &v12, 0x16u);
    }
  }

  if (v6)
  {
    v10 = [*(a1 + 32) provisioningActiveDeviceAssertion];
    [v10 invalidate];

    [*(a1 + 32) setProvisioningActiveDeviceAssertion:v6];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)noteProvisioningUserInterfaceDidDisappear
{
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      *v7 = 0;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Noting that the provisioning UI disappeared", v7, 2u);
    }
  }

  provisioningActiveDeviceAssertion = [(NPKPaymentWebServiceCompanionTargetDevice *)self provisioningActiveDeviceAssertion];
  [provisioningActiveDeviceAssertion invalidate];

  [(NPKPaymentWebServiceCompanionTargetDevice *)self setProvisioningActiveDeviceAssertion:0];
}

- (void)archiveContext:(id)context
{
  v13 = *MEMORY[0x277D85DE8];
  contextCopy = context;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v11 = 138412290;
      v12 = contextCopy;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Archiving web service context: %@", &v11, 0xCu);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate archiveWebServiceContext:contextCopy];

  delegate2 = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate2 sendWebServiceContextToWatch];

  v10 = *MEMORY[0x277D85DE8];
}

- (void)archiveBackgroundContext:(id)context
{
  v12 = *MEMORY[0x277D85DE8];
  contextCopy = context;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v10 = 138412290;
      v11 = contextCopy;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Archiving web service background context: %@", &v10, 0xCu);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate archiveWebServiceBackgroundContext:contextCopy];

  v9 = *MEMORY[0x277D85DE8];
}

- (BOOL)paymentWebService:(id)service hasPassesOfType:(unint64_t)type
{
  v24 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  v16 = 0;
  v17 = &v16;
  v18 = 0x2020000000;
  v19 = 0;
  if (type == 1)
  {
    companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
    v15[0] = MEMORY[0x277D85DD0];
    v15[1] = 3221225472;
    v15[2] = __79__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_hasPassesOfType___block_invoke;
    v15[3] = &unk_279949AB8;
    v15[4] = &v16;
    [companionAgentConnection paymentPassUniqueIDsSynchronous:1 reply:v15];
  }

  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v11 = *(v17 + 24);
      *buf = 134218240;
      typeCopy = type;
      v22 = 1024;
      v23 = v11;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Payment web service has passes of type %lu? %d", buf, 0x12u);
    }
  }

  v12 = *(v17 + 24);
  _Block_object_dispose(&v16, 8);

  v13 = *MEMORY[0x277D85DE8];
  return v12 & 1;
}

uint64_t __79__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_hasPassesOfType___block_invoke(uint64_t a1, void *a2)
{
  result = [a2 count];
  *(*(*(a1 + 32) + 8) + 24) = result != 0;
  return result;
}

- (id)paymentWebService:(id)service passesOfType:(unint64_t)type
{
  array = [MEMORY[0x277CBEB18] array];
  if (type == 1)
  {
    companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passesOfType___block_invoke;
    v9[3] = &unk_279947BD8;
    v9[4] = self;
    v10 = array;
    [companionAgentConnection paymentPassUniqueIDsSynchronous:1 reply:v9];
  }

  return array;
}

void __76__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passesOfType___block_invoke(uint64_t a1, void *a2)
{
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passesOfType___block_invoke_2;
  v4[3] = &unk_2799492C0;
  v3 = *(a1 + 40);
  v4[4] = *(a1 + 32);
  v5 = v3;
  [a2 enumerateObjectsUsingBlock:v4];
}

void __76__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passesOfType___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = *(a1 + 32);
  v4 = a2;
  v5 = [v3 companionAgentConnection];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passesOfType___block_invoke_3;
  v6[3] = &unk_279949AE0;
  v7 = *(a1 + 40);
  [v5 paymentPassWithUniqueID:v4 synchronous:1 reply:v6];
}

uint64_t __76__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passesOfType___block_invoke_3(uint64_t result, uint64_t a2)
{
  if (a2)
  {
    return [*(result + 32) addObject:a2];
  }

  return result;
}

- (id)passesOfCardType:(int64_t)type
{
  v9 = 0;
  v10 = &v9;
  v11 = 0x3032000000;
  v12 = __Block_byref_object_copy__22;
  v13 = __Block_byref_object_dispose__22;
  v14 = 0;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __62__NPKPaymentWebServiceCompanionTargetDevice_passesOfCardType___block_invoke;
  block[3] = &unk_279947890;
  block[5] = &v9;
  block[6] = type;
  block[4] = self;
  dispatch_sync(internalQueue, block);

  v6 = v10[5];
  _Block_object_dispose(&v9, 8);

  return v6;
}

void __62__NPKPaymentWebServiceCompanionTargetDevice_passesOfCardType___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) companionAgentConnection];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __62__NPKPaymentWebServiceCompanionTargetDevice_passesOfCardType___block_invoke_2;
  v4[3] = &unk_279949B08;
  v3 = *(a1 + 48);
  v4[4] = *(a1 + 40);
  [v2 passesOfCardType:v3 completion:v4];
}

- (id)identityPassesOfTypes:(id)types
{
  typesCopy = types;
  v12 = 0;
  v13 = &v12;
  v14 = 0x3032000000;
  v15 = __Block_byref_object_copy__22;
  v16 = __Block_byref_object_dispose__22;
  v17 = 0;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __67__NPKPaymentWebServiceCompanionTargetDevice_identityPassesOfTypes___block_invoke;
  block[3] = &unk_279948090;
  block[4] = self;
  v10 = typesCopy;
  v11 = &v12;
  v6 = typesCopy;
  dispatch_sync(internalQueue, block);

  v7 = v13[5];
  _Block_object_dispose(&v12, 8);

  return v7;
}

void __67__NPKPaymentWebServiceCompanionTargetDevice_identityPassesOfTypes___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) companionAgentConnection];
  v3 = [MEMORY[0x277CBEB98] setWithArray:*(a1 + 40)];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __67__NPKPaymentWebServiceCompanionTargetDevice_identityPassesOfTypes___block_invoke_2;
  v4[3] = &unk_279949B08;
  v4[4] = *(a1 + 48);
  [v2 identityPassesOfTypes:v3 completion:v4];
}

- (BOOL)paymentWebService:(id)service hasPassWithUniqueID:(id)d
{
  serviceCopy = service;
  dCopy = d;
  v11 = 0;
  v12 = &v11;
  v13 = 0x2020000000;
  v14 = 0;
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __83__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_hasPassWithUniqueID___block_invoke;
  v10[3] = &unk_279949B30;
  v10[4] = &v11;
  [companionAgentConnection hasPaymentPassWithUniqueID:dCopy synchronous:1 reply:v10];

  LOBYTE(companionAgentConnection) = *(v12 + 24);
  _Block_object_dispose(&v11, 8);

  return companionAgentConnection;
}

- (id)paymentWebService:(id)service passWithUniqueID:(id)d
{
  serviceCopy = service;
  dCopy = d;
  v12 = 0;
  v13 = &v12;
  v14 = 0x3032000000;
  v15 = __Block_byref_object_copy__22;
  v16 = __Block_byref_object_dispose__22;
  v17 = 0;
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __80__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passWithUniqueID___block_invoke;
  v11[3] = &unk_279949B58;
  v11[4] = &v12;
  [companionAgentConnection paymentPassWithUniqueID:dCopy synchronous:1 reply:v11];

  v9 = v13[5];
  _Block_object_dispose(&v12, 8);

  return v9;
}

- (BOOL)paymentWebService:(id)service canProvisionPaymentPassWithPrimaryAccountIdentifier:(id)identifier
{
  v34 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  identifierCopy = identifier;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      LODWORD(buf) = 138412290;
      *(&buf + 4) = identifierCopy;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Can provision payment pass with primary account identifier %@", &buf, 0xCu);
    }
  }

  if (identifierCopy)
  {
    companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
    v12 = dispatch_semaphore_create(0);
    *&buf = 0;
    *(&buf + 1) = &buf;
    v30 = 0x3032000000;
    v31 = __Block_byref_object_copy__22;
    v32 = __Block_byref_object_dispose__22;
    v33 = 0;
    v25[0] = MEMORY[0x277D85DD0];
    v25[1] = 3221225472;
    v25[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canProvisionPaymentPassWithPrimaryAccountIdentifier___block_invoke;
    v25[3] = &unk_279949B80;
    p_buf = &buf;
    v13 = v12;
    v26 = v13;
    [companionAgentConnection paymentPassesWithPrimaryAccountIdentifier:identifierCopy completion:v25];
    dispatch_semaphore_wait(v13, 0xFFFFFFFFFFFFFFFFLL);
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v14 = *(*(&buf + 1) + 40);
    v15 = [v14 countByEnumeratingWithState:&v21 objects:v28 count:16];
    if (v15)
    {
      v16 = *v22;
      while (2)
      {
        for (i = 0; i != v15; ++i)
        {
          if (*v22 != v16)
          {
            objc_enumerationMutation(v14);
          }

          if ([*(*(&v21 + 1) + 8 * i) activationState] < 4)
          {
            v18 = 0;
            goto LABEL_16;
          }
        }

        v15 = [v14 countByEnumeratingWithState:&v21 objects:v28 count:16];
        if (v15)
        {
          continue;
        }

        break;
      }
    }

    v18 = 1;
LABEL_16:

    _Block_object_dispose(&buf, 8);
  }

  else
  {
    v18 = 1;
  }

  v19 = *MEMORY[0x277D85DE8];
  return v18;
}

void __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canProvisionPaymentPassWithPrimaryAccountIdentifier___block_invoke(uint64_t a1, void *a2)
{
  objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
  v4 = a2;
  dispatch_semaphore_signal(*(a1 + 32));
}

- (void)paymentWebService:(id)service validateAddPreconditionsWithCompletion:(id)completion
{
  serviceCopy = service;
  completionCopy = completion;
  v8 = MEMORY[0x277D38098];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_validateAddPreconditionsWithCompletion___block_invoke;
  v11[3] = &unk_2799451C8;
  v12 = serviceCopy;
  selfCopy = self;
  v14 = completionCopy;
  v9 = completionCopy;
  v10 = serviceCopy;
  [v8 configureWebServiceIfNecessary:v10 completion:v11];
}

void __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_validateAddPreconditionsWithCompletion___block_invoke(void *a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = pk_Payment_log();
    v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

    if (v5)
    {
      v6 = pk_Payment_log();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
      {
        v13 = 138412290;
        v14 = v3;
        _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: Web service configuration failed (%@). Continuing preflight anyway.", &v13, 0xCu);
      }
    }
  }

  v7 = [NPKPaymentPreflighter alloc];
  v8 = a1[4];
  v9 = a1[5];
  v10 = [v9 companionAgentConnection];
  v11 = [(NPKPaymentPreflighter *)v7 initWithWebService:v8 targetDevice:v9 companionAgentConnection:v10];

  [(NPKPaymentPreflighter *)v11 addCardPreflightWithCompletion:a1[6]];
  v12 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebService:(id)service validateTransferPreconditionsWithCompletion:(id)completion
{
  completionCopy = completion;
  serviceCopy = service;
  v8 = [NPKPaymentPreflighter alloc];
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  v10 = [(NPKPaymentPreflighter *)v8 initWithWebService:serviceCopy targetDevice:self companionAgentConnection:companionAgentConnection];

  [(NPKPaymentPreflighter *)v10 transferToCompanionPreflightWithCompletion:completionCopy];
}

- (void)paymentWebService:(id)service validateAddBiometricPassPreconditionsWithCompletion:(id)completion
{
  serviceCopy = service;
  completionCopy = completion;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Requested BiometricPassPreconditions", buf, 2u);
    }
  }

  v11 = MEMORY[0x277D38098];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_validateAddBiometricPassPreconditionsWithCompletion___block_invoke;
  v14[3] = &unk_2799451C8;
  v15 = serviceCopy;
  selfCopy = self;
  v17 = completionCopy;
  v12 = completionCopy;
  v13 = serviceCopy;
  [v11 configureWebServiceIfNecessary:v13 completion:v14];
}

void __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_validateAddBiometricPassPreconditionsWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = pk_Payment_log();
    v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

    if (v5)
    {
      v6 = pk_Payment_log();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v16 = v3;
        _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: Web service configuration for Biometric Pass Precondition failed (%@). Continue preflight anyway", buf, 0xCu);
      }
    }
  }

  v7 = [NPKPaymentPreflighter alloc];
  v8 = *(a1 + 32);
  v9 = *(a1 + 40);
  v10 = [v9 companionAgentConnection];
  v11 = [(NPKPaymentPreflighter *)v7 initWithWebService:v8 targetDevice:v9 companionAgentConnection:v10];

  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_validateAddBiometricPassPreconditionsWithCompletion___block_invoke_382;
  v13[3] = &unk_279944F48;
  v14 = *(a1 + 48);
  [(NPKPaymentPreflighter *)v11 addBiometricPassPreflightWithCompletion:v13];

  v12 = *MEMORY[0x277D85DE8];
}

void __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_validateAddBiometricPassPreconditionsWithCompletion___block_invoke_382(uint64_t a1, int a2, void *a3)
{
  v13 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v10[0] = 67109378;
      v10[1] = a2;
      v11 = 2112;
      v12 = v5;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Finish BiometricPassPreconditions successful:%d error:%@", v10, 0x12u);
    }
  }

  (*(*(a1 + 32) + 16))();

  v9 = *MEMORY[0x277D85DE8];
}

- (void)setNewAuthRandomResponse:(id)response
{
  v46 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v42 = 0x3032000000;
  v43 = __Block_byref_object_copy__384;
  v44 = __Block_byref_object_dispose__385;
  v45 = 0;
  v37 = 0;
  v38 = &v37;
  v39 = 0x2020000000;
  v40 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x3032000000;
  v34 = __Block_byref_object_copy__22;
  v35 = __Block_byref_object_dispose__22;
  v36 = 0;
  v25 = 0;
  v26 = &v25;
  v27 = 0x3032000000;
  v28 = __Block_byref_object_copy__22;
  v29 = __Block_byref_object_dispose__22;
  v30 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__NPKPaymentWebServiceCompanionTargetDevice_setNewAuthRandomResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v37;
    v22 = &v31;
    v23 = &v25;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v38 + 24), v32[5], v26[5], 0);
  }

  _Block_object_dispose(&v25, 8);

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v37, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __70__NPKPaymentWebServiceCompanionTargetDevice_setNewAuthRandomResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoSecureElementSetNewAuthRandomResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoSecureElementSetNewAuthRandomResponse *)v4 initWithData:v5];

    if ([(NPKProtoSecureElementSetNewAuthRandomResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      *(*(*(a1 + 56) + 8) + 24) = [(NPKProtoSecureElementSetNewAuthRandomResponse *)v6 success];
      v10 = [(NPKProtoSecureElementSetNewAuthRandomResponse *)v6 cryptogram];
      v11 = *(*(a1 + 64) + 8);
      v12 = *(v11 + 40);
      *(v11 + 40) = v10;

      v13 = [(NPKProtoSecureElementSetNewAuthRandomResponse *)v6 challengeResponse];
      v14 = *(*(a1 + 72) + 8);
      v15 = *(v14 + 40);
      *(v14 + 40) = v13;

      v16 = [*(a1 + 32) outstandingRequests];
      [v16 removeObjectForKey:*(a1 + 40)];

      v17 = [v3 completionHandler];
      v18 = *(*(a1 + 80) + 8);
      v19 = *(v18 + 40);
      *(v18 + 40) = v17;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v20 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v20, 2u);
      }
    }
  }
}

- (void)_setNewAuthRandomReturningPairingState:(id)state
{
  stateCopy = state;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __84__NPKPaymentWebServiceCompanionTargetDevice__setNewAuthRandomReturningPairingState___block_invoke;
  v7[3] = &unk_279945530;
  v7[4] = self;
  v8 = stateCopy;
  v6 = stateCopy;
  dispatch_sync(internalQueue, v7);
}

void __84__NPKPaymentWebServiceCompanionTargetDevice__setNewAuthRandomReturningPairingState___block_invoke(uint64_t a1)
{
  v29 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSecureElementSetNewAuthRandomRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoSecureElementSetNewAuthRandomRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:7 isResponse:0];

  v6 = [*(a1 + 32) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    v7 = *(a1 + 40);
    if (v7)
    {
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __84__NPKPaymentWebServiceCompanionTargetDevice__setNewAuthRandomReturningPairingState___block_invoke_2;
      aBlock[3] = &unk_279949BD0;
      v26 = v7;
      v8 = _Block_copy(aBlock);
      v20 = MEMORY[0x277D85DD0];
      v21 = 3221225472;
      v22 = __84__NPKPaymentWebServiceCompanionTargetDevice__setNewAuthRandomReturningPairingState___block_invoke_3;
      v23 = &unk_279945218;
      v24 = *(a1 + 40);
      v9 = _Block_copy(&v20);
      v10 = *(a1 + 32);
      v11 = _Block_copy(v8);
      [v10 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v11 errorHandler:{v9, v20, v21, v22, v23}];
    }

    else
    {
      v16 = pk_Payment_log();
      v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

      if (v17)
      {
        v18 = pk_Payment_log();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v28 = v6;
          _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
        }
      }
    }
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v28 = v5;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
      }
    }

    v15 = *(a1 + 40);
    if (v15)
    {
      (*(v15 + 16))(v15, 0, 0, 0);
    }
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)getPairingInfoResponse:(id)response
{
  v46 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v42 = 0x3032000000;
  v43 = __Block_byref_object_copy__384;
  v44 = __Block_byref_object_dispose__385;
  v45 = 0;
  v37 = 0;
  v38 = &v37;
  v39 = 0x2020000000;
  v40 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x3032000000;
  v34 = __Block_byref_object_copy__22;
  v35 = __Block_byref_object_dispose__22;
  v36 = 0;
  v25 = 0;
  v26 = &v25;
  v27 = 0x3032000000;
  v28 = __Block_byref_object_copy__22;
  v29 = __Block_byref_object_dispose__22;
  v30 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __68__NPKPaymentWebServiceCompanionTargetDevice_getPairingInfoResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v37;
    v22 = &v31;
    v23 = &v25;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v38 + 24), v32[5], v26[5], 0);
  }

  _Block_object_dispose(&v25, 8);

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v37, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __68__NPKPaymentWebServiceCompanionTargetDevice_getPairingInfoResponse___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoSecureElementGetPairingInfoResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoSecureElementGetPairingInfoResponse *)v4 initWithData:v5];

    if ([v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      *(*(*(a1 + 56) + 8) + 24) = [v6 success];
      v9 = [v6 cryptogram];
      v10 = *(*(a1 + 64) + 8);
      v11 = *(v10 + 40);
      *(v10 + 40) = v9;

      v12 = [v6 challengeResponse];
      v13 = *(*(a1 + 72) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      v15 = pk_Payment_log();
      v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

      if (v16)
      {
        v17 = pk_Payment_log();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          v23[0] = 67109120;
          v23[1] = [v6 authRandomSet];
          _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Pairing info response: set auth random %d", v23, 8u);
        }
      }

      v18 = [*(a1 + 32) outstandingRequests];
      [v18 removeObjectForKey:*(a1 + 40)];

      v19 = [v3 completionHandler];
      v20 = *(*(a1 + 80) + 8);
      v21 = *(v20 + 40);
      *(v20 + 40) = v19;
    }

LABEL_12:

    goto LABEL_13;
  }

  v7 = pk_Payment_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      LOWORD(v23[0]) = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v23, 2u);
    }

    goto LABEL_12;
  }

LABEL_13:

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_getPairingInfoAndSetAuthRandomIfNotPaired:(BOOL)paired completion:(id)completion
{
  completionCopy = completion;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __99__NPKPaymentWebServiceCompanionTargetDevice__getPairingInfoAndSetAuthRandomIfNotPaired_completion___block_invoke;
  block[3] = &unk_279945CF0;
  pairedCopy = paired;
  block[4] = self;
  v10 = completionCopy;
  v8 = completionCopy;
  dispatch_sync(internalQueue, block);
}

void __99__NPKPaymentWebServiceCompanionTargetDevice__getPairingInfoAndSetAuthRandomIfNotPaired_completion___block_invoke(uint64_t a1)
{
  v29 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSecureElementGetPairingInfoRequest);
  [(NPKProtoSecureElementGetPairingInfoRequest *)v2 setSetAuthRandomIfNotPaired:*(a1 + 48)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoSecureElementGetPairingInfoRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:21 isResponse:0];

  v6 = [*(a1 + 32) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    v7 = *(a1 + 40);
    if (v7)
    {
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __99__NPKPaymentWebServiceCompanionTargetDevice__getPairingInfoAndSetAuthRandomIfNotPaired_completion___block_invoke_2;
      aBlock[3] = &unk_279949BD0;
      v26 = v7;
      v8 = _Block_copy(aBlock);
      v20 = MEMORY[0x277D85DD0];
      v21 = 3221225472;
      v22 = __99__NPKPaymentWebServiceCompanionTargetDevice__getPairingInfoAndSetAuthRandomIfNotPaired_completion___block_invoke_3;
      v23 = &unk_279945218;
      v24 = *(a1 + 40);
      v9 = _Block_copy(&v20);
      v10 = *(a1 + 32);
      v11 = _Block_copy(v8);
      [v10 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v11 errorHandler:{v9, v20, v21, v22, v23}];
    }

    else
    {
      v16 = pk_Payment_log();
      v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

      if (v17)
      {
        v18 = pk_Payment_log();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v28 = v6;
          _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
        }
      }
    }
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v28 = v5;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
      }
    }

    v15 = *(a1 + 40);
    if (v15)
    {
      (*(v15 + 16))(v15, 0, 0, 0);
    }
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)setNewAuthRandomIfNecessaryAtBeginningOfProvisioningFlow:(id)flow
{
  flowCopy = flow;
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_setNewAuthRandomIfNecessaryAtBeginningOfProvisioningFlow___block_invoke;
  v6[3] = &unk_279949BF8;
  v7 = flowCopy;
  v5 = flowCopy;
  [(NPKPaymentWebServiceCompanionTargetDevice *)self _setNewAuthRandomIfNecessaryReturningPairingState:v6];
}

uint64_t __102__NPKPaymentWebServiceCompanionTargetDevice_setNewAuthRandomIfNecessaryAtBeginningOfProvisioningFlow___block_invoke(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

- (void)paymentWebService:(id)service setNewAuthRandomIfNecessaryReturningPairingState:(id)state
{
  v15 = *MEMORY[0x277D85DE8];
  stateCopy = state;
  v6 = NPKIsCurrentlyPairing();
  v7 = pk_Payment_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v14[0] = 67109120;
      v14[1] = v6;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: currentlyPairing %d", v14, 8u);
    }
  }

  if (v6)
  {
    [(NPKPaymentWebServiceCompanionTargetDevice *)self _setNewAuthRandomIfNecessaryReturningPairingState:stateCopy];
  }

  else
  {
    v10 = pk_Payment_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

    if (v11)
    {
      v12 = pk_Payment_log();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        LOWORD(v14[0]) = 0;
        _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Do not need to set auth random from PassKit request; returning pairing info", v14, 2u);
      }
    }

    [(NPKPaymentWebServiceCompanionTargetDevice *)self _getPairingInfoAndSetAuthRandomIfNotPaired:0 completion:stateCopy];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebService:(id)service setNewAuthRandom:(id)random
{
  randomCopy = random;
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __80__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_setNewAuthRandom___block_invoke;
  v7[3] = &unk_279949BF8;
  v8 = randomCopy;
  v6 = randomCopy;
  [(NPKPaymentWebServiceCompanionTargetDevice *)self _setNewAuthRandomReturningPairingState:v7];
}

uint64_t __80__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_setNewAuthRandom___block_invoke(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

- (void)queueTSMConnectionResponse:(id)response
{
  v27 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v23 = 0x3032000000;
  v24 = __Block_byref_object_copy__384;
  v25 = __Block_byref_object_dispose__385;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __72__NPKPaymentWebServiceCompanionTargetDevice_queueTSMConnectionResponse___block_invoke;
    block[3] = &unk_279949C20;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, 1, 0);
  }

  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __72__NPKPaymentWebServiceCompanionTargetDevice_queueTSMConnectionResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoQueueTSMConnectionResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoQueueTSMConnectionResponse *)v4 initWithData:v5];

    if ([(NPKProtoQueueTSMConnectionResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service queueConnectionToTrustedServiceManagerForPushTopic:(id)topic withCompletion:(id)completion
{
  topicCopy = topic;
  completionCopy = completion;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __129__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_queueConnectionToTrustedServiceManagerForPushTopic_withCompletion___block_invoke;
  block[3] = &unk_279945A48;
  v13 = topicCopy;
  selfCopy = self;
  v15 = completionCopy;
  v10 = completionCopy;
  v11 = topicCopy;
  dispatch_sync(internalQueue, block);
}

void __129__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_queueConnectionToTrustedServiceManagerForPushTopic_withCompletion___block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoQueueTSMConnectionRequest);
  [(NPKProtoQueueTSMConnectionRequest *)v2 setPushTopic:*(a1 + 32)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoQueueTSMConnectionRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:1 isResponse:0];

  v6 = [*(a1 + 40) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    v7 = *(a1 + 48);
    if (v7)
    {
      v8 = _Block_copy(v7);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __129__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_queueConnectionToTrustedServiceManagerForPushTopic_withCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v20 = *(a1 + 48);
      v9 = _Block_copy(aBlock);
      v10 = *(a1 + 40);
      v11 = _Block_copy(v8);
      [v10 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v11 errorHandler:v9];
    }

    else
    {
      v17 = pk_Payment_log();
      v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

      if (!v18)
      {
        goto LABEL_11;
      }

      v8 = pk_Payment_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v22 = v6;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
      }
    }

    goto LABEL_10;
  }

  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v22 = v5;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
    }
  }

  v15 = *(a1 + 48);
  if (v15)
  {
    v8 = NPKGetIDSCommunicationError();
    (*(v15 + 16))(v15, 0, v8);
LABEL_10:
  }

LABEL_11:

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __129__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_queueConnectionToTrustedServiceManagerForPushTopic_withCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)markAllAppletsForDeletionResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x2020000000;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __79__NPKPaymentWebServiceCompanionTargetDevice_markAllAppletsForDeletionResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v31 + 24), v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __79__NPKPaymentWebServiceCompanionTargetDevice_markAllAppletsForDeletionResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoMarkAllAppletsForDeletionResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoMarkAllAppletsForDeletionResponse *)v5 initWithData:v6];

    if ([(NPKProtoMarkAllAppletsForDeletionResponse *)v7 pending])
    {
      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v11 = [*(a1 + 32) outstandingRequests];
      [v11 removeObjectForKey:*(a1 + 40)];

      v12 = [v4 completionHandler];
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoMarkAllAppletsForDeletionResponse *)v7 success];
      v15 = [(NPKProtoMarkAllAppletsForDeletionResponse *)v7 hasErrorData];
      if (v15)
      {
        v1 = [(NPKProtoMarkAllAppletsForDeletionResponse *)v7 errorData];
        v16 = objc_opt_class();
        v17 = NPKSecureUnarchiveObject(v1, v16);
      }

      else
      {
        v17 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
      if (v15)
      {
      }
    }
  }

  else
  {
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)markAllAppletsForDeletionWithCompletion:(id)completion
{
  completionCopy = completion;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __85__NPKPaymentWebServiceCompanionTargetDevice_markAllAppletsForDeletionWithCompletion___block_invoke;
  v7[3] = &unk_279945530;
  v7[4] = self;
  v8 = completionCopy;
  v6 = completionCopy;
  dispatch_sync(internalQueue, v7);
}

void __85__NPKPaymentWebServiceCompanionTargetDevice_markAllAppletsForDeletionWithCompletion___block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoMarkAllAppletsForDeletionRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoMarkAllAppletsForDeletionRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:44 isResponse:0];

  v6 = [*(a1 + 32) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    v7 = *(a1 + 40);
    if (v7)
    {
      v8 = _Block_copy(v7);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __85__NPKPaymentWebServiceCompanionTargetDevice_markAllAppletsForDeletionWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v20 = *(a1 + 40);
      v9 = _Block_copy(aBlock);
      v10 = *(a1 + 32);
      v11 = _Block_copy(v8);
      [v10 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v11 errorHandler:v9];
    }

    else
    {
      v17 = pk_Payment_log();
      v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

      if (!v18)
      {
        goto LABEL_11;
      }

      v8 = pk_Payment_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v22 = v6;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
      }
    }

    goto LABEL_10;
  }

  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v22 = v5;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
    }
  }

  v15 = *(a1 + 40);
  if (v15)
  {
    v8 = NPKGetIDSCommunicationError();
    (*(v15 + 16))(v15, 0, v8);
LABEL_10:
  }

LABEL_11:

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __85__NPKPaymentWebServiceCompanionTargetDevice_markAllAppletsForDeletionWithCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)handleBalanceChange:(id)change
{
  v26 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  v5 = [NPKProtoHandleBalanceChangeRequest alloc];
  data = [changeCopy data];

  v7 = [(NPKProtoHandleBalanceChangeRequest *)v5 initWithData:data];
  passID = [(NPKProtoHandleBalanceChangeRequest *)v7 passID];
  v9 = [MEMORY[0x277CBEB58] set];
  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412546;
      v23 = passID;
      v24 = 1024;
      LODWORD(v25) = [(NPKProtoHandleBalanceChangeRequest *)v7 balanceBytesCount];
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Got balance update for unique ID %@ with %u balances", buf, 0x12u);
    }
  }

  balanceBytes = [(NPKProtoHandleBalanceChangeRequest *)v7 balanceBytes];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __65__NPKPaymentWebServiceCompanionTargetDevice_handleBalanceChange___block_invoke;
  v20[3] = &unk_279949C70;
  v14 = v9;
  v21 = v14;
  [balanceBytes enumerateObjectsUsingBlock:v20];

  v15 = pk_General_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_General_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412546;
      v23 = v14;
      v24 = 2112;
      v25 = passID;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Handling balance update %@ for unique ID %@", buf, 0x16u);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate handleBalanceUpdate:v14 forUniqueID:passID];

  v19 = *MEMORY[0x277D85DE8];
}

void __65__NPKPaymentWebServiceCompanionTargetDevice_handleBalanceChange___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = objc_opt_class();
  v6 = NPKSecureUnarchiveObject(v3, v4);

  v5 = v6;
  if (v6)
  {
    [*(a1 + 32) addObject:v6];
    v5 = v6;
  }
}

- (void)registrationDataResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__NPKPaymentWebServiceCompanionTargetDevice_registrationDataResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v24;
    v22 = &v30;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5], 0);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __70__NPKPaymentWebServiceCompanionTargetDevice_registrationDataResponse___block_invoke(uint64_t a1)
{
  v36 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoRegistrationDataResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoRegistrationDataResponse *)v4 initWithData:v5];

    if ([v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v9 = pk_Payment_log();
      v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

      if (v10)
      {
        v11 = pk_Payment_log();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
        {
          v12 = [v6 pushToken];
          v34 = 138412290;
          v35 = v12;
          _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Push token from gizmo is %@", &v34, 0xCu);
        }
      }

      v13 = [v6 pushToken];
      v14 = *(*(a1 + 56) + 8);
      v15 = *(v14 + 40);
      *(v14 + 40) = v13;

      v16 = [v6 registrationDataBytes];
      v17 = objc_opt_class();
      v18 = NPKSecureUnarchiveObject(v16, v17);
      v19 = *(*(a1 + 64) + 8);
      v20 = *(v19 + 40);
      *(v19 + 40) = v18;

      if (!*(*(*(a1 + 64) + 8) + 40))
      {
        v21 = pk_Payment_log();
        v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

        if (v22)
        {
          v23 = pk_Payment_log();
          if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
          {
            LOWORD(v34) = 0;
            _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_ERROR, "Error: Received nil SE registration data!", &v34, 2u);
          }
        }
      }

      v24 = MGCopyAnswer();
      [*(*(*(a1 + 64) + 8) + 40) setCompanionSerialNumber:v24];

      v25 = [*(a1 + 32) _serialNumbersOfAllPairedDevices];
      v26 = [*(*(*(a1 + 64) + 8) + 40) deviceSerialNumber];

      if (v26)
      {
        v27 = [*(*(*(a1 + 64) + 8) + 40) deviceSerialNumber];
        v28 = [v25 pk_arrayByRemovingObject:v27];

        v25 = v28;
      }

      [*(*(*(a1 + 64) + 8) + 40) setAdditionalDeviceSerialNumbers:v25];
      v29 = [*(a1 + 32) outstandingRequests];
      [v29 removeObjectForKey:*(a1 + 40)];

      v30 = [v3 completionHandler];
      v31 = *(*(a1 + 72) + 8);
      v32 = *(v31 + 40);
      *(v31 + 40) = v30;
    }

LABEL_19:

    goto LABEL_20;
  }

  v7 = pk_Payment_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      LOWORD(v34) = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", &v34, 2u);
    }

    goto LABEL_19;
  }

LABEL_20:

  v33 = *MEMORY[0x277D85DE8];
}

- (id)appleAccountInformation
{
  mEMORY[0x277D37D38] = [MEMORY[0x277D37D38] sharedInstance];
  appleAccountInformation = [mEMORY[0x277D37D38] appleAccountInformation];

  return appleAccountInformation;
}

- (void)renewAppleAccountWithCompletionHandler:(id)handler
{
  v3 = MEMORY[0x277D37D38];
  handlerCopy = handler;
  sharedInstance = [v3 sharedInstance];
  [sharedInstance renewAppleAccountWithCompletionHandler:handlerCopy];
}

- (void)paymentWebService:(id)service registrationDataWithCompletionHandler:(id)handler
{
  handlerCopy = handler;
  serviceCopy = service;
  appleAccountInformation = [(NPKPaymentWebServiceCompanionTargetDevice *)self appleAccountInformation];
  authorizationHeader = [appleAccountInformation authorizationHeader];

  [(NPKPaymentWebServiceCompanionTargetDevice *)self _paymentWebService:serviceCopy registrationDataWithAuthToken:authorizationHeader completionHandler:handlerCopy];
}

- (void)_paymentWebService:(id)service registrationDataWithAuthToken:(id)token completionHandler:(id)handler
{
  tokenCopy = token;
  handlerCopy = handler;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __112__NPKPaymentWebServiceCompanionTargetDevice__paymentWebService_registrationDataWithAuthToken_completionHandler___block_invoke;
  block[3] = &unk_279945A48;
  v13 = tokenCopy;
  selfCopy = self;
  v15 = handlerCopy;
  v10 = handlerCopy;
  v11 = tokenCopy;
  dispatch_sync(internalQueue, block);
}

void __112__NPKPaymentWebServiceCompanionTargetDevice__paymentWebService_registrationDataWithAuthToken_completionHandler___block_invoke(uint64_t a1)
{
  location[3] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoRegistrationDataRequest);
  [(NPKProtoRegistrationDataRequest *)v2 setAuthToken:*(a1 + 32)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoRegistrationDataRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:3 isResponse:0];

  v6 = [*(a1 + 40) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    if (*(a1 + 48))
    {
      v7 = (a1 + 40);
      objc_initWeak(location, *(a1 + 40));
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __112__NPKPaymentWebServiceCompanionTargetDevice__paymentWebService_registrationDataWithAuthToken_completionHandler___block_invoke_2;
      aBlock[3] = &unk_279949C98;
      objc_copyWeak(&v25, location);
      v24 = *(a1 + 48);
      v8 = _Block_copy(aBlock);
      v21[0] = MEMORY[0x277D85DD0];
      v21[1] = 3221225472;
      v21[2] = __112__NPKPaymentWebServiceCompanionTargetDevice__paymentWebService_registrationDataWithAuthToken_completionHandler___block_invoke_3;
      v21[3] = &unk_279945218;
      v22 = *(a1 + 48);
      v9 = _Block_copy(v21);
      v10 = *v7;
      v11 = _Block_copy(v8);
      [v10 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v11 errorHandler:v9];

      objc_destroyWeak(&v25);
      objc_destroyWeak(location);
    }

    else
    {
      v17 = pk_Payment_log();
      v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

      if (v18)
      {
        v19 = pk_Payment_log();
        if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
        {
          LODWORD(location[0]) = 138412290;
          *(location + 4) = v6;
          _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", location, 0xCu);
        }
      }
    }
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        LODWORD(location[0]) = 138412290;
        *(location + 4) = v5;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", location, 0xCu);
      }
    }

    v15 = *(a1 + 48);
    if (v15)
    {
      v16 = NPKGetIDSCommunicationError();
      (*(v15 + 16))(v15, 0, v16);
    }
  }

  v20 = *MEMORY[0x277D85DE8];
}

void __112__NPKPaymentWebServiceCompanionTargetDevice__paymentWebService_registrationDataWithAuthToken_completionHandler___block_invoke_2(uint64_t a1, void *a2, void *a3, void *a4)
{
  v12 = a2;
  v7 = a3;
  v8 = a4;
  if (v7)
  {
    WeakRetained = objc_loadWeakRetained((a1 + 40));
    v10 = [WeakRetained delegate];
    [v10 handlePushToken:v7];
  }

  v11 = *(a1 + 32);
  if (v11)
  {
    (*(v11 + 16))(v11, v12, v8);
  }
}

uint64_t __112__NPKPaymentWebServiceCompanionTargetDevice__paymentWebService_registrationDataWithAuthToken_completionHandler___block_invoke_3(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)provisioningDataResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__NPKPaymentWebServiceCompanionTargetDevice_provisioningDataResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v23;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5], 0);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __70__NPKPaymentWebServiceCompanionTargetDevice_provisioningDataResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoProvisioningDataResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoProvisioningDataResponse *)v4 initWithData:v5];

    if ([(NPKProtoProvisioningDataResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [(NPKProtoProvisioningDataResponse *)v6 provisioningDataBytes];
      v11 = objc_opt_class();
      v12 = NPKSecureUnarchiveObject(v10, v11);
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      v15 = [*(a1 + 32) outstandingRequests];
      [v15 removeObjectForKey:*(a1 + 40)];

      v16 = [v3 completionHandler];
      v17 = *(*(a1 + 64) + 8);
      v18 = *(v17 + 40);
      *(v17 + 40) = v16;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v19 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service provisioningDataIncludingDeviceMetadata:(BOOL)metadata withCompletionHandler:(id)handler
{
  handlerCopy = handler;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __125__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_provisioningDataIncludingDeviceMetadata_withCompletionHandler___block_invoke;
  block[3] = &unk_279945CF0;
  metadataCopy = metadata;
  block[4] = self;
  v11 = handlerCopy;
  v9 = handlerCopy;
  dispatch_sync(internalQueue, block);
}

void __125__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_provisioningDataIncludingDeviceMetadata_withCompletionHandler___block_invoke(uint64_t a1)
{
  v54 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoProvisioningDataRequest);
  [(NPKProtoProvisioningDataRequest *)v2 setIncludeDeviceMetadata:*(a1 + 48)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoProvisioningDataRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:2 isResponse:0];

  v6 = [*(a1 + 32) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    if (*(a1 + 40))
    {
      *&buf = 0;
      *(&buf + 1) = &buf;
      v50 = 0x3032000000;
      v51 = __Block_byref_object_copy__22;
      v52 = __Block_byref_object_dispose__22;
      v53 = 0;
      v47[0] = 0;
      v47[1] = v47;
      v47[2] = 0x3032000000;
      v47[3] = __Block_byref_object_copy__22;
      v47[4] = __Block_byref_object_dispose__22;
      v48 = 0;
      v45[0] = 0;
      v45[1] = v45;
      v45[2] = 0x3032000000;
      v45[3] = __Block_byref_object_copy__22;
      v45[4] = __Block_byref_object_dispose__22;
      v46 = 0;
      v7 = dispatch_group_create();
      if (*(a1 + 48) == 1)
      {
        v8 = objc_alloc_init(NPKOneShotLocationFetcher);
        dispatch_group_enter(v7);
        v41[0] = MEMORY[0x277D85DD0];
        v41[1] = 3221225472;
        v41[2] = __125__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_provisioningDataIncludingDeviceMetadata_withCompletionHandler___block_invoke_2;
        v41[3] = &unk_279949CE8;
        p_buf = &buf;
        v9 = v8;
        v42 = v9;
        v43 = v7;
        [(NPKOneShotLocationFetcher *)v9 fetchLocationWithCompletion:v41];
      }

      dispatch_group_enter(v7);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __125__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_provisioningDataIncludingDeviceMetadata_withCompletionHandler___block_invoke_414;
      aBlock[3] = &unk_279949D10;
      v40 = v47;
      v10 = v7;
      v39 = v10;
      v11 = _Block_copy(aBlock);
      v35[0] = MEMORY[0x277D85DD0];
      v35[1] = 3221225472;
      v35[2] = __125__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_provisioningDataIncludingDeviceMetadata_withCompletionHandler___block_invoke_416;
      v35[3] = &unk_279949D38;
      v37 = v45;
      v12 = v10;
      v36 = v12;
      v13 = _Block_copy(v35);
      v14 = [*(a1 + 32) responseQueue];
      v26 = MEMORY[0x277D85DD0];
      v27 = 3221225472;
      v28 = __125__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_provisioningDataIncludingDeviceMetadata_withCompletionHandler___block_invoke_417;
      v29 = &unk_279949D70;
      v34 = *(a1 + 48);
      v31 = v47;
      v32 = &buf;
      v30 = *(a1 + 40);
      v33 = v45;
      dispatch_group_notify(v12, v14, &v26);

      v15 = *(a1 + 32);
      v16 = _Block_copy(v11);
      [v15 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v16 errorHandler:{v13, v26, v27, v28, v29}];

      _Block_object_dispose(v45, 8);
      _Block_object_dispose(v47, 8);

      _Block_object_dispose(&buf, 8);
    }

    else
    {
      v22 = pk_Payment_log();
      v23 = os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT);

      if (v23)
      {
        v24 = pk_Payment_log();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
        {
          LODWORD(buf) = 138412290;
          *(&buf + 4) = v6;
          _os_log_impl(&dword_25B300000, v24, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", &buf, 0xCu);
        }
      }
    }
  }

  else
  {
    v17 = pk_Payment_log();
    v18 = os_log_type_enabled(v17, OS_LOG_TYPE_ERROR);

    if (v18)
    {
      v19 = pk_Payment_log();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        LODWORD(buf) = 138412290;
        *(&buf + 4) = v5;
        _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", &buf, 0xCu);
      }
    }

    v20 = *(a1 + 40);
    if (v20)
    {
      v21 = NPKGetIDSCommunicationError();
      (*(v20 + 16))(v20, 0, v21);
    }
  }

  v25 = *MEMORY[0x277D85DE8];
}

void __125__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_provisioningDataIncludingDeviceMetadata_withCompletionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = a2;
  objc_storeStrong((*(*(a1 + 48) + 8) + 40), a2);
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = *(a1 + 32);
      v9 = *(*(*(a1 + 48) + 8) + 40);
      v11 = 138412546;
      v12 = v8;
      v13 = 2112;
      v14 = v9;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Fetcher %@ fetched location %@", &v11, 0x16u);
    }
  }

  dispatch_group_leave(*(a1 + 40));

  v10 = *MEMORY[0x277D85DE8];
}

void __125__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_provisioningDataIncludingDeviceMetadata_withCompletionHandler___block_invoke_414(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v4 = a2;
  objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v9 = 138412290;
      v10 = v4;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Fetched provisioning data %@", &v9, 0xCu);
    }
  }

  dispatch_group_leave(*(a1 + 32));

  v8 = *MEMORY[0x277D85DE8];
}

void __125__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_provisioningDataIncludingDeviceMetadata_withCompletionHandler___block_invoke_416(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v4 = a2;
  objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v9 = 138412290;
      v10 = v4;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Got provisioning error %@", &v9, 0xCu);
    }
  }

  dispatch_group_leave(*(a1 + 32));

  v8 = *MEMORY[0x277D85DE8];
}

uint64_t __125__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_provisioningDataIncludingDeviceMetadata_withCompletionHandler___block_invoke_417(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = *(*(*(a1 + 40) + 8) + 40);
  if (v2 && *(a1 + 64) == 1)
  {
    if (*(*(*(a1 + 48) + 8) + 40))
    {
      [v2 setLocation:?];
      v2 = *(*(*(a1 + 40) + 8) + 40);
    }

    v3 = PKDevicePhoneNumber();
    [v2 setPhoneNumber:v3];

    v2 = *(*(*(a1 + 40) + 8) + 40);
  }

  v4 = [v2 deviceName];

  v5 = [*(*(*(a1 + 40) + 8) + 40) phoneNumber];

  v6 = [*(*(*(a1 + 40) + 8) + 40) location];

  v7 = pk_Payment_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = off_279949D58[v4 != 0];
      v11 = off_279949D58[v5 != 0];
      v12 = off_279949D58[v6 != 0];
      v15 = 136315650;
      v16 = v10;
      v17 = 2080;
      v18 = v11;
      v19 = 2080;
      v20 = v12;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Device provisioning data:\n\tdevice name is %s\n\tphone number is %s\n\tlocation is %s", &v15, 0x20u);
    }
  }

  result = *(a1 + 32);
  if (result)
  {
    result = (*(result + 16))(result, *(*(*(a1 + 40) + 8) + 40), *(*(*(a1 + 56) + 8) + 40));
  }

  v14 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)configurationDataResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__NPKPaymentWebServiceCompanionTargetDevice_configurationDataResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v23;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5], 0);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __71__NPKPaymentWebServiceCompanionTargetDevice_configurationDataResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoConfigurationDataResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoConfigurationDataResponse *)v4 initWithData:v5];

    if ([(NPKProtoConfigurationDataResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [(NPKProtoConfigurationDataResponse *)v6 configurationDataBytes];
      v11 = objc_opt_class();
      v12 = NPKSecureUnarchiveObject(v10, v11);
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      v15 = [*(a1 + 32) outstandingRequests];
      [v15 removeObjectForKey:*(a1 + 40)];

      v16 = [v3 completionHandler];
      v17 = *(*(a1 + 64) + 8);
      v18 = *(v17 + 40);
      *(v17 + 40) = v16;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v19 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service configurationDataWithCompletionHandler:(id)handler
{
  handlerCopy = handler;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_configurationDataWithCompletionHandler___block_invoke;
  v8[3] = &unk_279945530;
  v8[4] = self;
  v9 = handlerCopy;
  v7 = handlerCopy;
  dispatch_sync(internalQueue, v8);
}

void __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_configurationDataWithCompletionHandler___block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoConfigurationDataRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoConfigurationDataRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:4 isResponse:0];

  v6 = [*(a1 + 32) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    v7 = *(a1 + 40);
    if (v7)
    {
      v8 = _Block_copy(v7);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_configurationDataWithCompletionHandler___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v20 = *(a1 + 40);
      v9 = _Block_copy(aBlock);
      v10 = *(a1 + 32);
      v11 = _Block_copy(v8);
      [v10 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v11 errorHandler:v9];
    }

    else
    {
      v17 = pk_Payment_log();
      v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

      if (!v18)
      {
        goto LABEL_11;
      }

      v8 = pk_Payment_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v22 = v6;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
      }
    }

    goto LABEL_10;
  }

  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v22 = v5;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
    }
  }

  v15 = *(a1 + 40);
  if (v15)
  {
    v8 = NPKGetIDSCommunicationError();
    (*(v15 + 16))(v15, 0, v8);
LABEL_10:
  }

LABEL_11:

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_configurationDataWithCompletionHandler___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (id)trustedDeviceEnrollmentInfoForWebService:(id)service
{
  v20 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v18 = 138412290;
      v19 = serviceCopy;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Requested Trusted Device Enrollment Info for WebService: %@", &v18, 0xCu);
    }
  }

  mEMORY[0x277D2BCF8] = [MEMORY[0x277D2BCF8] sharedInstance];
  getActivePairedDevice = [mEMORY[0x277D2BCF8] getActivePairedDevice];

  if (getActivePairedDevice)
  {
    v9 = objc_alloc_init(MEMORY[0x277D38318]);
    v10 = [getActivePairedDevice valueForProperty:*MEMORY[0x277D2BBA8]];
    [v9 setDeviceName:v10];

    v11 = [getActivePairedDevice valueForProperty:*MEMORY[0x277D2BBF8]];
    [v9 setDeviceSerialNumber:v11];

    v12 = [getActivePairedDevice valueForProperty:*MEMORY[0x277D2BC30]];
    [v9 setDeviceUDID:v12];

    v13 = [getActivePairedDevice valueForProperty:*MEMORY[0x277D2BBC0]];
    [v9 setProductType:v13];

    v14 = [getActivePairedDevice valueForProperty:*MEMORY[0x277D2BBE0]];
    [v9 setSecureElementIdentifier:v14];

    v15 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"6BD289D4-EFF7-4E48-A3AD-776E924C8723"];
    [v9 setSupportsAccessExpressMode:{objc_msgSend(getActivePairedDevice, "supportsCapability:", v15)}];
  }

  else
  {
    v9 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)signDataResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __62__NPKPaymentWebServiceCompanionTargetDevice_signDataResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v30;
    v22 = &v24;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5], 0);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __62__NPKPaymentWebServiceCompanionTargetDevice_signDataResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoSignDataResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoSignDataResponse *)v4 initWithData:v5];

    if ([(NPKProtoSignDataResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [(NPKProtoSignDataResponse *)v6 signedData];
      v11 = *(*(a1 + 56) + 8);
      v12 = *(v11 + 40);
      *(v11 + 40) = v10;

      if ([(NPKProtoSignDataResponse *)v6 hasSignatureInfoBytes])
      {
        v13 = [(NPKProtoSignDataResponse *)v6 signatureInfoBytes];
        v14 = objc_opt_class();
        v15 = NPKSecureUnarchiveObject(v13, v14);
        v16 = *(*(a1 + 64) + 8);
        v17 = *(v16 + 40);
        *(v16 + 40) = v15;
      }

      v18 = [*(a1 + 32) outstandingRequests];
      [v18 removeObjectForKey:*(a1 + 40)];

      v19 = [v3 completionHandler];
      v20 = *(*(a1 + 72) + 8);
      v21 = *(v20 + 40);
      *(v20 + 40) = v19;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v22 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v22, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service signData:(id)data signatureEntanglementMode:(unint64_t)mode withCompletionHandler:(id)handler
{
  v27 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  handlerCopy = handler;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 134218240;
      v24 = [dataCopy length];
      v25 = 1024;
      modeCopy = mode;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Request to sign data of length %lu with signature entanglement mode %d", buf, 0x12u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __120__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_signData_signatureEntanglementMode_withCompletionHandler___block_invoke;
  v18[3] = &unk_279949D98;
  v19 = dataCopy;
  selfCopy = self;
  v21 = handlerCopy;
  modeCopy2 = mode;
  v15 = handlerCopy;
  v16 = dataCopy;
  dispatch_sync(internalQueue, v18);

  v17 = *MEMORY[0x277D85DE8];
}

void __120__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_signData_signatureEntanglementMode_withCompletionHandler___block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSignDataRequest);
  [(NPKProtoSignDataRequest *)v2 setDataToSign:*(a1 + 32)];
  [(NPKProtoSignDataRequest *)v2 setEntanglementMode:*(a1 + 56) == 1];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoSignDataRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:14 isResponse:0];

  v6 = [*(a1 + 40) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    v7 = *(a1 + 48);
    if (v7)
    {
      v8 = _Block_copy(v7);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __120__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_signData_signatureEntanglementMode_withCompletionHandler___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v20 = *(a1 + 48);
      v9 = _Block_copy(aBlock);
      v10 = *(a1 + 40);
      v11 = _Block_copy(v8);
      [v10 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v11 errorHandler:v9];
    }

    else
    {
      v17 = pk_Payment_log();
      v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

      if (!v18)
      {
        goto LABEL_11;
      }

      v8 = pk_Payment_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v22 = v6;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
      }
    }

    goto LABEL_10;
  }

  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v22 = v5;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
    }
  }

  v15 = *(a1 + 48);
  if (v15)
  {
    v8 = NPKGetIDSCommunicationError();
    (*(v15 + 16))(v15, 0, 0, v8);
LABEL_10:
  }

LABEL_11:

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __120__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_signData_signatureEntanglementMode_withCompletionHandler___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0, a2);
  }

  return result;
}

- (void)paymentWebService:(id)service signData:(id)data withCompletionHandler:(id)handler
{
  v22 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  handlerCopy = handler;
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 134217984;
      v21 = [dataCopy length];
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Request to sign data of length %lu", buf, 0xCu);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __94__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_signData_withCompletionHandler___block_invoke;
  block[3] = &unk_279945A48;
  v17 = dataCopy;
  selfCopy = self;
  v19 = handlerCopy;
  v13 = handlerCopy;
  v14 = dataCopy;
  dispatch_sync(internalQueue, block);

  v15 = *MEMORY[0x277D85DE8];
}

void __94__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_signData_withCompletionHandler___block_invoke(id *a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSignDataRequest);
  v3 = [a1[4] SHA256Hash];
  [(NPKProtoSignDataRequest *)v2 setDigestToSign:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoSignDataRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:14 isResponse:0];

  v7 = [a1[5] _sendProtobuf:v6 responseExpected:1];
  if (v7)
  {
    v8 = a1[6];
    if (v8)
    {
      v9 = _Block_copy(v8);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __94__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_signData_withCompletionHandler___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v21 = a1[6];
      v10 = _Block_copy(aBlock);
      v11 = a1[5];
      v12 = _Block_copy(v9);
      [v11 _trackOutstandingRequestWithMessageIdentifier:v7 completionHandler:v12 errorHandler:v10];
    }

    else
    {
      v18 = pk_Payment_log();
      v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

      if (!v19)
      {
        goto LABEL_11;
      }

      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v23 = v7;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
      }
    }

    goto LABEL_10;
  }

  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_ERROR);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v23 = v6;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
    }
  }

  v16 = a1[6];
  if (v16)
  {
    v9 = NPKGetIDSCommunicationError();
    (*(v16 + 2))(v16, 0, 0, v9);
LABEL_10:
  }

LABEL_11:

  v17 = *MEMORY[0x277D85DE8];
}

uint64_t __94__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_signData_withCompletionHandler___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0, a2);
  }

  return result;
}

- (void)didRegisterResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __65__NPKPaymentWebServiceCompanionTargetDevice_didRegisterResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v23;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24), 0);
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __65__NPKPaymentWebServiceCompanionTargetDevice_didRegisterResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoDeviceDidRegisterResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoDeviceDidRegisterResponse *)v4 initWithData:v5];

    if ([(NPKProtoDeviceDidRegisterResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      *(*(*(a1 + 56) + 8) + 24) = [(NPKProtoDeviceDidRegisterResponse *)v6 success];
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 64) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service didRegisterWithRegionMap:(id)map primaryRegionTopic:(id)topic
{
  serviceCopy = service;
  mapCopy = map;
  topicCopy = topic;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_didRegisterWithRegionMap_primaryRegionTopic___block_invoke;
  v15[3] = &unk_279946260;
  v16 = mapCopy;
  v17 = topicCopy;
  v18 = serviceCopy;
  selfCopy = self;
  v12 = serviceCopy;
  v13 = topicCopy;
  v14 = mapCopy;
  dispatch_sync(internalQueue, v15);
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_didRegisterWithRegionMap_primaryRegionTopic___block_invoke(uint64_t a1)
{
  v28 = *MEMORY[0x277D85DE8];
  v2 = pk_Payment_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_Payment_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      *buf = 138412546;
      v25 = v5;
      v26 = 2112;
      v27 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: did register with region map %@ (primary topic %@)", buf, 0x16u);
    }
  }

  v7 = objc_alloc_init(NPKProtoDeviceDidRegisterRequest);
  v8 = *(a1 + 32);
  v22[0] = MEMORY[0x277D85DD0];
  v22[1] = 3221225472;
  v22[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_didRegisterWithRegionMap_primaryRegionTopic___block_invoke_432;
  v22[3] = &unk_279949020;
  v9 = v7;
  v23 = v9;
  [v8 enumerateKeysAndObjectsUsingBlock:v22];
  [(NPKProtoDeviceDidRegisterRequest *)v9 setPrimaryRegionTopic:*(a1 + 40)];
  v10 = [*(a1 + 48) context];
  v11 = [v10 regions];
  v12 = [v11 allKeys];
  v13 = [v12 mutableCopy];
  [(NPKProtoDeviceDidRegisterRequest *)v9 setBrokerRegionPushTopics:v13];

  v14 = objc_alloc(MEMORY[0x277D189F0]);
  v15 = [(NPKProtoDeviceDidRegisterRequest *)v9 data];
  v16 = [v14 initWithProtobufData:v15 type:8 isResponse:0];

  v17 = [*(a1 + 56) _sendProtobuf:v16 responseExpected:1];
  if (v17)
  {
    [*(a1 + 56) _trackOutstandingRequestWithMessageIdentifier:v17 completionHandler:&__block_literal_global_28 errorHandler:&__block_literal_global_436];
  }

  else
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_ERROR);

    if (v19)
    {
      v20 = pk_Payment_log();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v25 = v16;
        _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
      }
    }
  }

  v21 = *MEMORY[0x277D85DE8];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_didRegisterWithRegionMap_primaryRegionTopic___block_invoke_432(uint64_t a1, uint64_t a2, void *a3)
{
  v5 = *(a1 + 32);
  v6 = a3;
  [v5 addTsmRegionPushTopics:a2];
  [*(a1 + 32) addTsmRegionURLs:v6];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_didRegisterWithRegionMap_primaryRegionTopic___block_invoke_2(uint64_t a1, int a2, void *a3)
{
  v12 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v9[0] = 67109378;
      v9[1] = a2;
      v10 = 2112;
      v11 = v4;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: completed %d %@", v9, 0x12u);
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_didRegisterWithRegionMap_primaryRegionTopic___block_invoke_434(uint64_t a1, void *a2)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = a2;
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      v7 = 138412290;
      v8 = v2;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: error %@", &v7, 0xCu);
    }
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (id)_supportedRegionsForWebService:(id)service
{
  context = [service context];
  configuration = [context configuration];
  v5 = NPKSupportedRegionsForWebServiceConfiguration(configuration);

  return v5;
}

- (BOOL)_supportsFeaturesForWebService:(id)service
{
  context = [service context];
  configuration = [context configuration];
  v5 = NPKSupportsFeaturesForWebServiceConfiguration(configuration);

  return v5;
}

- (void)paymentWebServiceDidUpdateConfiguration:(id)configuration
{
  v23 = *MEMORY[0x277D85DE8];
  configurationCopy = configuration;
  v5 = [(NPKPaymentWebServiceCompanionTargetDevice *)self _supportedRegionsForWebService:configurationCopy];
  context = [configurationCopy context];

  configuration = [context configuration];
  v7Configuration = [configuration configuration];

  v9 = pk_Payment_log();
  LODWORD(configuration) = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (configuration)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v22 = v7Configuration;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Payment web service updated configuration: %@", buf, 0xCu);
    }
  }

  v11 = NPKDomainAccessorForDomain(@"com.apple.nanopassbook");
  v12 = v11;
  if (v5)
  {
    [v11 setObject:v7Configuration forKey:@"Configuration"];
    v13 = *MEMORY[0x277D389D8];
    [v12 setObject:v5 forKey:*MEMORY[0x277D389D8]];
  }

  else
  {
    [v11 removeObjectForKey:@"Configuration"];
    v13 = *MEMORY[0x277D389D8];
    [v12 removeObjectForKey:*MEMORY[0x277D389D8]];
  }

  synchronize = [v12 synchronize];
  v15 = objc_alloc_init(MEMORY[0x277D2BA60]);
  v16 = MEMORY[0x277CBEB98];
  v20[0] = @"Configuration";
  v20[1] = v13;
  v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v20 count:2];
  v18 = [v16 setWithArray:v17];
  [v15 synchronizeNanoDomain:@"com.apple.nanopassbook" keys:v18];

  v19 = *MEMORY[0x277D85DE8];
}

- (unint64_t)paymentSupportedInCurrentRegionForWebService:(id)service
{
  v18 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  deviceRegion = [(NPKPaymentWebServiceCompanionTargetDevice *)self deviceRegion];
  if (deviceRegion)
  {
    v6 = [(NPKPaymentWebServiceCompanionTargetDevice *)self _supportedRegionsForWebService:serviceCopy];
    if (v6)
    {
      v7 = PKStockholmSetupSupportedInRegion();
    }

    else
    {
      v7 = 0;
    }
  }

  else
  {
    v7 = 0;
  }

  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      if (v7 > 2)
      {
        v11 = @"unknown";
      }

      else
      {
        v11 = off_27994A918[v7];
      }

      v14 = 138412546;
      v15 = deviceRegion;
      v16 = 2112;
      v17 = v11;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: region %@ support %@", &v14, 0x16u);
    }
  }

  v12 = *MEMORY[0x277D85DE8];
  return v7;
}

- (unint64_t)registrationSupportedInCurrentRegionForWebService:(id)service
{
  serviceCopy = service;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self paymentSupportedInCurrentRegionForWebService:serviceCopy]== 1)
  {
    v5 = 1;
  }

  else if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _supportsFeaturesForWebService:serviceCopy])
  {
    v5 = 1;
  }

  else
  {
    v5 = 2;
  }

  return v5;
}

- (id)paymentWebService:(id)service supportedRegionFeatureOfType:(int64_t)type
{
  v26 = *MEMORY[0x277D85DE8];
  context = [service context];
  configuration = [context configuration];

  if (configuration)
  {
    deviceRegion = [(NPKPaymentWebServiceCompanionTargetDevice *)self deviceRegion];
    deviceClass = [(NPKPaymentWebServiceCompanionTargetDevice *)self deviceClass];
    v10 = [configuration featureWithType:type inRegion:deviceRegion];
    if (v10)
    {
      deviceVersion = [(NPKPaymentWebServiceCompanionTargetDevice *)self deviceVersion];
      versionRange = [v10 versionRange];
      v13 = [versionRange versionMeetsRequirements:deviceVersion deviceClass:deviceClass];

      if (v13)
      {
        v14 = v10;
LABEL_17:

LABEL_18:
LABEL_19:

        goto LABEL_20;
      }

      v19 = pk_Payment_log();
      v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

      if (v20)
      {
        v21 = pk_Payment_log();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
        {
          v24 = 134217984;
          typeCopy3 = type;
          _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_DEFAULT, "Notice: Unsupported OS version for feature with type %ld", &v24, 0xCu);
        }
      }
    }

    else
    {
      v17 = pk_Payment_log();
      v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

      if (!v18)
      {
        v14 = 0;
        goto LABEL_18;
      }

      deviceVersion = pk_Payment_log();
      if (os_log_type_enabled(deviceVersion, OS_LOG_TYPE_DEFAULT))
      {
        v24 = 134217984;
        typeCopy3 = type;
        _os_log_impl(&dword_25B300000, deviceVersion, OS_LOG_TYPE_DEFAULT, "Notice: No feature of type %ld found", &v24, 0xCu);
      }
    }

    v14 = 0;
    goto LABEL_17;
  }

  v15 = pk_Payment_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    deviceRegion = pk_Payment_log();
    if (os_log_type_enabled(deviceRegion, OS_LOG_TYPE_DEFAULT))
    {
      v24 = 134217984;
      typeCopy3 = type;
      _os_log_impl(&dword_25B300000, deviceRegion, OS_LOG_TYPE_DEFAULT, "Notice: No feature of type %ld found - device not registered", &v24, 0xCu);
    }

    v14 = 0;
    goto LABEL_19;
  }

  v14 = 0;
LABEL_20:

  v22 = *MEMORY[0x277D85DE8];

  return v14;
}

- (id)deviceDescriptionForPaymentWebService:(id)service
{
  v3 = NPKPairedOrPairingDevice();
  v4 = [v3 valueForProperty:*MEMORY[0x277D2BBA8]];

  return v4;
}

- (id)deviceName
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [v2 valueForProperty:*MEMORY[0x277D2BB70]];

  return v3;
}

- (id)deviceSerialNumber
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [v2 valueForProperty:*MEMORY[0x277D2BBF8]];

  return v3;
}

- (id)deviceClass
{
  v2 = NPKPairedOrPairingDevice();
  v3 = NPKDeviceClassFromDevice(v2);

  return v3;
}

- (id)osVersion
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [v2 valueForProperty:*MEMORY[0x277D2BC20]];

  return v3;
}

- (id)deviceVersion
{
  v2 = NPKPairedOrPairingDevice();
  v3 = NPKDeviceOSVersionRequirementFromDevice(v2);

  return v3;
}

- (void)paymentWebService:(id)service deleteApplicationWithAID:(id)d
{
  v16 = *MEMORY[0x277D85DE8];
  dCopy = d;
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v15 = dCopy;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Delete application with AID %@", buf, 0xCu);
    }
  }

  if (dCopy)
  {
    v13 = dCopy;
    v9 = [MEMORY[0x277CBEA60] arrayWithObjects:&v13 count:1];
    v11[0] = MEMORY[0x277D85DD0];
    v11[1] = 3221225472;
    v11[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_deleteApplicationWithAID___block_invoke;
    v11[3] = &unk_279949DE0;
    v12 = dCopy;
    [(NPKPaymentWebServiceCompanionTargetDevice *)self removeAIDsFromSecureElement:v9 withCompletion:v11];
  }

  v10 = *MEMORY[0x277D85DE8];
}

void __88__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_deleteApplicationWithAID___block_invoke(uint64_t a1, int a2, void *a3)
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = *(a1 + 32);
      v11 = 138412802;
      v12 = v9;
      v13 = 1024;
      v14 = a2;
      v15 = 2112;
      v16 = v5;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Delete AID %@ completed %d %@", &v11, 0x1Cu);
    }
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebService:(id)service addPaymentPass:(id)pass withCompletionHandler:(id)handler
{
  v30 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  passCopy = pass;
  handlerCopy = handler;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      uniqueID = [passCopy uniqueID];
      *buf = 138412290;
      v29 = uniqueID;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Add payment pass: %@", buf, 0xCu);
    }
  }

  context = [serviceCopy context];
  [(NPKPaymentWebServiceCompanionTargetDevice *)self archiveContext:context];

  v16 = NPKGizmoScreenScale();
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  [companionAgentConnection setQueueAppropriateFailedActions:1];
  mEMORY[0x277D37E18] = [MEMORY[0x277D37E18] sharedInstance];
  dataAccessor = [passCopy dataAccessor];
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addPaymentPass_withCompletionHandler___block_invoke;
  v24[3] = &unk_279946698;
  v25 = companionAgentConnection;
  v26 = passCopy;
  v27 = handlerCopy;
  v20 = handlerCopy;
  v21 = passCopy;
  v22 = companionAgentConnection;
  [dataAccessor downloadRemoteAssetsWithScreenScale:@"~watch" suffix:mEMORY[0x277D37E18] cloudStoreCoordinatorDelegate:v24 completion:v16];

  v23 = *MEMORY[0x277D85DE8];
}

void __100__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addPaymentPass_withCompletionHandler___block_invoke(uint64_t a1, int a2, void *a3, float a4)
{
  v23 = *MEMORY[0x277D85DE8];
  v7 = a3;
  v8 = pk_General_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_General_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 67109634;
      v18 = a2;
      v19 = 2048;
      v20 = a4;
      v21 = 2112;
      v22 = v7;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: finished %d progress %f error %@", buf, 0x1Cu);
    }
  }

  if (a2)
  {
    v11 = *(a1 + 32);
    v12 = *(a1 + 40);
    v13 = NPKPairedOrPairingDevice();
    v15[0] = MEMORY[0x277D85DD0];
    v15[1] = 3221225472;
    v15[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addPaymentPass_withCompletionHandler___block_invoke_443;
    v15[3] = &unk_2799467D0;
    v16 = *(a1 + 48);
    [v11 savePaymentPass:v12 forDevice:v13 completion:v15];
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __100__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addPaymentPass_withCompletionHandler___block_invoke_443(uint64_t a1)
{
  v2 = dispatch_get_global_queue(0, 0);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addPaymentPass_withCompletionHandler___block_invoke_2;
  block[3] = &unk_279945198;
  v4 = *(a1 + 32);
  dispatch_async(v2, block);
}

uint64_t __100__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addPaymentPass_withCompletionHandler___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

- (void)paymentWebService:(id)service addSecureElementPass:(id)pass properties:(id)properties completion:(id)completion
{
  v63 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  passCopy = pass;
  propertiesCopy = properties;
  completionCopy = completion;
  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      uniqueID = [passCopy uniqueID];
      *buf = 138412546;
      *&buf[4] = uniqueID;
      *&buf[12] = 2112;
      *&buf[14] = propertiesCopy;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Add secure element pass pass: %@, with properties: %@", buf, 0x16u);
    }
  }

  if (passCopy)
  {
    if ([(NPKPaymentWebServiceCompanionTargetDevice *)self supportsSharingInAChain])
    {
      isCarKeyPass = [passCopy isCarKeyPass];
    }

    else
    {
      isCarKeyPass = 0;
    }

    paymentPass = [passCopy paymentPass];
    objc_initWeak(&location, self);
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke;
    aBlock[3] = &unk_279949E30;
    objc_copyWeak(&v57, &location);
    v22 = paymentPass;
    v55 = v22;
    v23 = completionCopy;
    v56 = v23;
    v24 = _Block_copy(aBlock);
    v25 = v24;
    if (isCarKeyPass)
    {
      v26 = dispatch_group_create();
      dispatch_group_enter(v26);
      v52[0] = MEMORY[0x277D85DD0];
      v52[1] = 3221225472;
      v52[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_446;
      v52[3] = &unk_279944F98;
      v27 = v26;
      v53 = v27;
      v31 = serviceCopy;
      [(NPKPaymentWebServiceCompanionTargetDevice *)self paymentWebService:serviceCopy addPaymentPass:v22 withCompletionHandler:v52];
      *buf = 0;
      *&buf[8] = buf;
      *&buf[16] = 0x3032000000;
      v60 = __Block_byref_object_copy__22;
      v61 = __Block_byref_object_dispose__22;
      v62 = 0;
      v50[0] = 0;
      v50[1] = v50;
      v50[2] = 0x3032000000;
      v50[3] = __Block_byref_object_copy__22;
      v50[4] = __Block_byref_object_dispose__22;
      v51 = 0;
      dispatch_group_enter(v27);
      internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_2;
      block[3] = &unk_279949EA0;
      v43 = passCopy;
      v44 = propertiesCopy;
      v45 = v27;
      selfCopy = self;
      v47 = v23;
      v48 = buf;
      v49 = v50;
      v29 = v27;
      dispatch_sync(internalQueue, block);

      serviceCopy = v31;
      v36[0] = MEMORY[0x277D85DD0];
      v36[1] = 3221225472;
      v36[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_457;
      v36[3] = &unk_279949EF0;
      v40 = buf;
      v41 = v50;
      v37 = v22;
      selfCopy2 = self;
      v39 = v25;
      dispatch_group_notify(v29, MEMORY[0x277D85CD0], v36);

      _Block_object_dispose(v50, 8);
      _Block_object_dispose(buf, 8);
    }

    else
    {
      v33[0] = MEMORY[0x277D85DD0];
      v33[1] = 3221225472;
      v33[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_459;
      v33[3] = &unk_279946670;
      v35 = v24;
      v34 = v22;
      [(NPKPaymentWebServiceCompanionTargetDevice *)self paymentWebService:serviceCopy addPaymentPass:v34 withCompletionHandler:v33];

      v29 = v35;
    }

    objc_destroyWeak(&v57);
    objc_destroyWeak(&location);
  }

  else
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

    if (v19)
    {
      v20 = pk_Payment_log();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Notice: Unable to find pass to add!", buf, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }

  v30 = *MEMORY[0x277D85DE8];
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke(id *a1)
{
  v14 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v3 = [a1[4] uniqueID];
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v13 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Target Device - Add secure element pass: %@ did finish.", buf, 0xCu);
    }
  }

  v7 = [WeakRetained companionAgentConnection];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_445;
  v9[3] = &unk_279949E08;
  v11 = a1[5];
  v10 = a1[4];
  [v7 paymentPassWithUniqueID:v3 synchronous:0 reply:v9];

  v8 = *MEMORY[0x277D85DE8];
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_445(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    if (v5)
    {
      v6 = pk_Payment_log();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
      {
        v14 = 138412290;
        v15 = v3;
        _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Target Device - Replying with updated payment pass: %@", &v14, 0xCu);
      }
    }

    v7 = *(a1 + 40);
    if (v7)
    {
      v8 = *(v7 + 16);
LABEL_14:
      v8();
    }
  }

  else
  {
    if (v5)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        v10 = *(a1 + 32);
        v14 = 138412290;
        v15 = v10;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Target Device - Unable to fetch updated payment pass; Replying with original payment pass: %@", &v14, 0xCu);
      }
    }

    v11 = *(a1 + 40);
    if (v11)
    {
      v12 = *(a1 + 32);
      v8 = *(v11 + 16);
      goto LABEL_14;
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_2(uint64_t a1)
{
  v58 = *MEMORY[0x277D85DE8];
  v2 = pk_Payment_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_Payment_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = [*(a1 + 32) uniqueID];
      v6 = *(a1 + 40);
      *buf = 138412546;
      v55 = v5;
      v56 = 2112;
      v57 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to add secure element pass: %@, with properties: %@", buf, 0x16u);
    }
  }

  v7 = objc_alloc_init(NPKProtoAddSecureElementPassWithPropertiesRequest);
  v8 = [*(a1 + 32) uniqueID];
  [(NPKProtoAddSecureElementPassWithPropertiesRequest *)v7 setPassUniqueID:v8];

  [*(a1 + 32) flushLoadedImageSets];
  v9 = [objc_alloc(MEMORY[0x277D37FB8]) initWithPass:*(a1 + 32)];
  v10 = v9;
  if (v9)
  {
    [v9 setProperties:*(a1 + 40)];
    v53 = v10;
    v11 = [MEMORY[0x277CBEA60] arrayWithObjects:&v53 count:1];
    v12 = [v11 pk_arrayBySafelyApplyingBlock:&__block_literal_global_452];
    v13 = [v12 mutableCopy];
    [(NPKProtoAddSecureElementPassWithPropertiesRequest *)v7 setPayloadDatas:v13];

    v14 = objc_alloc(MEMORY[0x277D189F0]);
    v15 = [(NPKProtoAddSecureElementPassWithPropertiesRequest *)v7 data];
    v16 = [v14 initWithProtobufData:v15 type:154 isResponse:0];

    v17 = *(a1 + 56);
    v51 = *MEMORY[0x277D18650];
    v52 = &unk_286CE7808;
    v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v52 forKeys:&v51 count:1];
    v19 = [v17 _sendProtobuf:v16 responseExpected:1 extraOptions:v18 priority:200];

    if (v19)
    {
      if (*(a1 + 64))
      {
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_453;
        aBlock[3] = &unk_2799464B8;
        v49 = *(a1 + 32);
        v50 = *(a1 + 48);
        v20 = _Block_copy(aBlock);
        v45[0] = MEMORY[0x277D85DD0];
        v45[1] = 3221225472;
        v45[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_454;
        v45[3] = &unk_279949E78;
        v47 = *(a1 + 72);
        v21 = v20;
        v46 = v21;
        v22 = _Block_copy(v45);
        v43[0] = MEMORY[0x277D85DD0];
        v43[1] = 3221225472;
        v43[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_2_456;
        v43[3] = &unk_279945218;
        v44 = v21;
        v42 = v21;
        v23 = v16;
        v24 = v12;
        v25 = v11;
        v26 = _Block_copy(v43);
        v27 = *(a1 + 56);
        v28 = _Block_copy(v22);
        [v27 _trackOutstandingRequestWithMessageIdentifier:v19 completionHandler:v28 errorHandler:v26];

        v11 = v25;
        v12 = v24;
        v16 = v23;

        v29 = v49;
LABEL_23:

        goto LABEL_24;
      }

      v39 = pk_Payment_log();
      v40 = os_log_type_enabled(v39, OS_LOG_TYPE_DEFAULT);

      if (v40)
      {
        v29 = pk_Payment_log();
        if (!os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_23;
        }

        *buf = 138412290;
        v55 = v19;
        v36 = "Warning: No response expected for message with identifier %@";
        v37 = v29;
        v38 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_22;
      }
    }

    else
    {
      v34 = pk_Payment_log();
      v35 = os_log_type_enabled(v34, OS_LOG_TYPE_ERROR);

      if (v35)
      {
        v29 = pk_Payment_log();
        if (!os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_23;
        }

        *buf = 138412290;
        v55 = v16;
        v36 = "Error: No message identifier for protobuf %@";
        v37 = v29;
        v38 = OS_LOG_TYPE_ERROR;
LABEL_22:
        _os_log_impl(&dword_25B300000, v37, v38, v36, buf, 0xCu);
        goto LABEL_23;
      }
    }

LABEL_24:

    goto LABEL_25;
  }

  v30 = pk_General_log();
  v31 = os_log_type_enabled(v30, OS_LOG_TYPE_ERROR);

  if (v31)
  {
    v32 = pk_General_log();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v32, OS_LOG_TYPE_ERROR, "Error: Target device - unable to add secure element pass - no payload found", buf, 2u);
    }
  }

  v33 = *(a1 + 64);
  if (v33)
  {
    (*(v33 + 16))(v33, 0);
  }

  dispatch_group_leave(*(a1 + 48));
LABEL_25:

  v41 = *MEMORY[0x277D85DE8];
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_453(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = pk_Payment_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_Payment_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = NSStringFromBOOL();
      v8 = 138412546;
      v9 = v5;
      v10 = 2112;
      v11 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target Device - Finished handling request to add secure element pass: %@ with success: %@", &v8, 0x16u);
    }
  }

  dispatch_group_leave(*(a1 + 40));
  v7 = *MEMORY[0x277D85DE8];
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_454(void *a1, uint64_t a2, void *a3, void *a4)
{
  v6 = a3;
  v7 = a4;
  v8 = *(a1[5] + 8);
  v9 = *(v8 + 40);
  *(v8 + 40) = v6;
  v13 = v6;

  v10 = *(a1[6] + 8);
  v11 = *(v10 + 40);
  *(v10 + 40) = v7;
  v12 = v7;

  (*(a1[4] + 16))();
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_2_456(uint64_t a1, void *a2)
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = 138412290;
      v9 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v8, 0xCu);
    }
  }

  (*(*(a1 + 32) + 16))();

  v7 = *MEMORY[0x277D85DE8];
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_457(uint64_t a1)
{
  v28 = *MEMORY[0x277D85DE8];
  if ([*(*(*(a1 + 56) + 8) + 40) count])
  {
    v2 = [*(a1 + 32) uniqueID];
    v3 = pk_General_log();
    v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

    if (v4)
    {
      v5 = pk_General_log();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
      {
        v6 = *(*(*(a1 + 56) + 8) + 40);
        v7 = *(*(*(a1 + 64) + 8) + 40);
        *buf = 138412802;
        v23 = v6;
        v24 = 2112;
        v25 = v2;
        v26 = 2112;
        v27 = v7;
        _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Handling credentials update %@ for unique ID %@ paymentApplicationIdentifier %@", buf, 0x20u);
      }
    }

    v8 = [*(a1 + 40) delegate];
    v9 = *(*(*(a1 + 64) + 8) + 40);
    v17[0] = MEMORY[0x277D85DD0];
    v10 = *(a1 + 56);
    v11 = *(*(*(a1 + 56) + 8) + 40);
    v17[1] = 3221225472;
    v17[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_458;
    v17[3] = &unk_279949EC8;
    v18 = v2;
    v21 = v10;
    v20 = *(a1 + 48);
    v19 = *(a1 + 32);
    v12 = v2;
    [v8 handleCredentialsUpdate:v11 forUniqueID:v12 paymentApplicationIdentifier:v9 completion:v17];

    v13 = *MEMORY[0x277D85DE8];
  }

  else
  {
    v14 = *(a1 + 32) != 0;
    v15 = *(*(a1 + 48) + 16);
    v16 = *MEMORY[0x277D85DE8];

    v15();
  }
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_addSecureElementPass_properties_completion___block_invoke_458(void *a1, void *a2)
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_General_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v7 = *(*(a1[7] + 8) + 40);
      v8 = a1[4];
      v9 = *(*(a1[8] + 8) + 40);
      v11 = 138413058;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      v15 = 2112;
      v16 = v9;
      v17 = 2112;
      v18 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Did complete credentials update %@ for unique ID %@ paymentApplicationIdentifier %@. Error: %@", &v11, 0x2Au);
    }
  }

  (*(a1[6] + 16))(a1[6], a1[5] != 0);

  v10 = *MEMORY[0x277D85DE8];
}

- (void)addSecureElementPassWithPropertiesResponse:(id)response
{
  v46 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target addSecureElementPassWithPropertiesResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v42 = 0x3032000000;
  v43 = __Block_byref_object_copy__384;
  v44 = __Block_byref_object_dispose__385;
  v45 = 0;
  v37 = 0;
  v38 = &v37;
  v39 = 0x2020000000;
  v40 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x3032000000;
  v34 = __Block_byref_object_copy__22;
  v35 = __Block_byref_object_dispose__22;
  v36 = 0;
  v25 = 0;
  v26 = &v25;
  v27 = 0x3032000000;
  v28 = __Block_byref_object_copy__22;
  v29 = __Block_byref_object_dispose__22;
  v30 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_addSecureElementPassWithPropertiesResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v37;
    v23 = &v25;
    v24 = &v31;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v38 + 24), v32[5], v26[5]);
  }

  _Block_object_dispose(&v25, 8);

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v37, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __88__NPKPaymentWebServiceCompanionTargetDevice_addSecureElementPassWithPropertiesResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoAddSecureElementPassWithPropertiesResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoAddSecureElementPassWithPropertiesResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    *(*(*(a1 + 64) + 8) + 24) = [v6 success];
    v11 = [v6 paymentApplicationID];
    v12 = *(*(a1 + 72) + 8);
    v13 = *(v12 + 40);
    *(v12 + 40) = v11;

    v14 = [MEMORY[0x277CBEB58] set];
    v15 = [v6 credentialsBytes];
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_addSecureElementPassWithPropertiesResponse___block_invoke_2;
    v23[3] = &unk_279949F18;
    v23[4] = *(a1 + 32);
    v16 = v14;
    v24 = v16;
    [v15 enumerateObjectsUsingBlock:v23];

    v17 = *(*(a1 + 80) + 8);
    v18 = *(v17 + 40);
    *(v17 + 40) = v16;
    v19 = v16;
  }

  else
  {
    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (!v21)
    {
      goto LABEL_4;
    }

    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v22 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v22, 2u);
    }
  }

LABEL_4:
}

void __88__NPKPaymentWebServiceCompanionTargetDevice_addSecureElementPassWithPropertiesResponse___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v3 = [*(a1 + 32) _secureUnarchiveSubcredential:a2];
  if (v3)
  {
    v4 = v3;
    [*(a1 + 40) addObject:v3];
    v3 = v4;
  }
}

- (void)paymentWebService:(id)service removePass:(id)pass withCompletionHandler:(id)handler
{
  handlerCopy = handler;
  passCopy = pass;
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  [companionAgentConnection setQueueAppropriateFailedActions:1];
  uniqueID = [passCopy uniqueID];

  v10 = NPKPairedOrPairingDevice();
  [companionAgentConnection removePaymentPassWithUniqueID:uniqueID forDevice:v10 waitForConfirmation:0 completion:handlerCopy];
}

- (void)downloadAllPaymentPassesForPaymentWebService:(id)service
{
  v15 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v14 = serviceCopy;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Redownloading all payment passes as requested by web service %@", buf, 0xCu);
    }
  }

  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_downloadAllPaymentPassesForPaymentWebService___block_invoke;
  v11[3] = &unk_279944F98;
  v12 = serviceCopy;
  v9 = serviceCopy;
  [companionAgentConnection redownloadAllPaymentPassesWithCompletion:v11];

  v10 = *MEMORY[0x277D85DE8];
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_downloadAllPaymentPassesForPaymentWebService___block_invoke(uint64_t a1)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = pk_Payment_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_Payment_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v7 = 138412290;
      v8 = v5;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Redownload of all payment passes complete as requested by web service %@", &v7, 0xCu);
    }
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (void)secureElementGetAppletsResponse:(id)response
{
  v29 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__384;
  v27 = __Block_byref_object_dispose__385;
  v28 = 0;
  array = [MEMORY[0x277CBEB18] array];
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __77__NPKPaymentWebServiceCompanionTargetDevice_secureElementGetAppletsResponse___block_invoke;
    block[3] = &unk_279949F40;
    block[4] = self;
    v20 = incomingResponseIdentifier;
    v21 = responseCopy;
    v22 = array;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_ERROR);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *v18 = 0;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v18, 2u);
      }
    }
  }

  v16 = *(*(&buf + 1) + 40);
  if (v16)
  {
    (*(v16 + 16))(v16, array, 0);
  }

  _Block_object_dispose(&buf, 8);
  v17 = *MEMORY[0x277D85DE8];
}

void __77__NPKPaymentWebServiceCompanionTargetDevice_secureElementGetAppletsResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoSecureElementGetAppletsResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoSecureElementGetAppletsResponse *)v4 initWithData:v5];

    if ([(NPKProtoSecureElementGetAppletsResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      if ([(NPKProtoSecureElementGetAppletsResponse *)v6 appletsBytesCount])
      {
        v10 = 0;
        do
        {
          v11 = [(NPKProtoSecureElementGetAppletsResponse *)v6 appletsBytes];
          v12 = [v11 objectAtIndexedSubscript:v10];
          v13 = objc_opt_class();
          v14 = NPKSecureUnarchiveObject(v12, v13);

          if (v14)
          {
            [*(a1 + 56) addObject:v14];
          }

          ++v10;
        }

        while (v10 < [(NPKProtoSecureElementGetAppletsResponse *)v6 appletsBytesCount]);
      }

      v15 = [*(a1 + 32) outstandingRequests];
      [v15 removeObjectForKey:*(a1 + 40)];

      v16 = [v3 completionHandler];
      v17 = *(*(a1 + 64) + 8);
      v18 = *(v17 + 40);
      *(v17 + 40) = v16;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v19 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
      }
    }
  }
}

- (void)secureElementAppletsWithCompletion:(id)completion
{
  completionCopy = completion;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __80__NPKPaymentWebServiceCompanionTargetDevice_secureElementAppletsWithCompletion___block_invoke;
  v7[3] = &unk_279945530;
  v7[4] = self;
  v8 = completionCopy;
  v6 = completionCopy;
  dispatch_sync(internalQueue, v7);
}

void __80__NPKPaymentWebServiceCompanionTargetDevice_secureElementAppletsWithCompletion___block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSecureElementGetAppletsRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoSecureElementGetAppletsRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:5 isResponse:0];

  v6 = [*(a1 + 32) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    v7 = *(a1 + 40);
    if (v7)
    {
      v8 = _Block_copy(v7);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __80__NPKPaymentWebServiceCompanionTargetDevice_secureElementAppletsWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v20 = *(a1 + 40);
      v9 = _Block_copy(aBlock);
      v10 = *(a1 + 32);
      v11 = _Block_copy(v8);
      [v10 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v11 errorHandler:v9];
    }

    else
    {
      v17 = pk_Payment_log();
      v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

      if (!v18)
      {
        goto LABEL_11;
      }

      v8 = pk_Payment_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v22 = v6;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
      }
    }

    goto LABEL_10;
  }

  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v22 = v5;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
    }
  }

  v15 = *(a1 + 40);
  if (v15)
  {
    v8 = NPKGetIDSCommunicationError();
    (*(v15 + 16))(v15, 0, v8);
LABEL_10:
  }

LABEL_11:

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __80__NPKPaymentWebServiceCompanionTargetDevice_secureElementAppletsWithCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)secureElementRemoveAppletsResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __80__NPKPaymentWebServiceCompanionTargetDevice_secureElementRemoveAppletsResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v23;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24), 0);
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __80__NPKPaymentWebServiceCompanionTargetDevice_secureElementRemoveAppletsResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoSecureElementRemoveAppletsResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoSecureElementRemoveAppletsResponse *)v4 initWithData:v5];

    if ([(NPKProtoSecureElementRemoveAppletsResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      *(*(*(a1 + 56) + 8) + 24) = [(NPKProtoSecureElementRemoveAppletsResponse *)v6 success];
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 64) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)removeAIDsFromSecureElement:(id)element withCompletion:(id)completion
{
  elementCopy = element;
  completionCopy = completion;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_removeAIDsFromSecureElement_withCompletion___block_invoke;
  block[3] = &unk_279945A48;
  v12 = elementCopy;
  selfCopy = self;
  v14 = completionCopy;
  v9 = completionCopy;
  v10 = elementCopy;
  dispatch_sync(internalQueue, block);
}

void __88__NPKPaymentWebServiceCompanionTargetDevice_removeAIDsFromSecureElement_withCompletion___block_invoke(id *a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSecureElementRemoveAppletsRequest);
  v3 = [a1[4] mutableCopy];
  [(NPKProtoSecureElementRemoveAppletsRequest *)v2 setCardAIDs:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoSecureElementRemoveAppletsRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:6 isResponse:0];

  v7 = [a1[5] _sendProtobuf:v6 responseExpected:1];
  if (v7)
  {
    v8 = a1[6];
    if (v8)
    {
      v9 = _Block_copy(v8);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_removeAIDsFromSecureElement_withCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v21 = a1[6];
      v10 = _Block_copy(aBlock);
      v11 = a1[5];
      v12 = _Block_copy(v9);
      [v11 _trackOutstandingRequestWithMessageIdentifier:v7 completionHandler:v12 errorHandler:v10];
    }

    else
    {
      v18 = pk_Payment_log();
      v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

      if (!v19)
      {
        goto LABEL_11;
      }

      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v23 = v7;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
      }
    }

    goto LABEL_10;
  }

  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_ERROR);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v23 = v6;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
    }
  }

  v16 = a1[6];
  if (v16)
  {
    v9 = NPKGetIDSCommunicationError();
    v16[2](v16, 0, v9);
LABEL_10:
  }

LABEL_11:

  v17 = *MEMORY[0x277D85DE8];
}

uint64_t __88__NPKPaymentWebServiceCompanionTargetDevice_removeAIDsFromSecureElement_withCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)dumpLogsResponse:(id)response
{
  v26 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v22 = 0x3032000000;
  v23 = __Block_byref_object_copy__384;
  v24 = __Block_byref_object_dispose__385;
  v25 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __62__NPKPaymentWebServiceCompanionTargetDevice_dumpLogsResponse___block_invoke;
    block[3] = &unk_279948090;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, 1, 0);
  }

  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __62__NPKPaymentWebServiceCompanionTargetDevice_dumpLogsResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [*(a1 + 32) outstandingRequests];
    [v4 removeObjectForKey:*(a1 + 40)];

    v5 = [v3 completionHandler];
    v6 = *(*(a1 + 48) + 8);
    v7 = *(v6 + 40);
    *(v6 + 40) = v5;
  }

  else
  {
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        *v11 = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v11, 2u);
      }
    }
  }
}

- (void)dumpLogsWithCompletion:(id)completion
{
  completionCopy = completion;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __68__NPKPaymentWebServiceCompanionTargetDevice_dumpLogsWithCompletion___block_invoke;
  v7[3] = &unk_279945530;
  v7[4] = self;
  v8 = completionCopy;
  v6 = completionCopy;
  dispatch_sync(internalQueue, v7);
}

void __68__NPKPaymentWebServiceCompanionTargetDevice_dumpLogsWithCompletion___block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoDumpLogsRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoDumpLogsRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:9 isResponse:0];

  v6 = [*(a1 + 32) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    v7 = *(a1 + 40);
    if (v7)
    {
      v8 = _Block_copy(v7);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __68__NPKPaymentWebServiceCompanionTargetDevice_dumpLogsWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v20 = *(a1 + 40);
      v9 = _Block_copy(aBlock);
      v10 = *(a1 + 32);
      v11 = _Block_copy(v8);
      [v10 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v11 errorHandler:v9];
    }

    else
    {
      v17 = pk_Payment_log();
      v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

      if (!v18)
      {
        goto LABEL_11;
      }

      v8 = pk_Payment_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v22 = v6;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
      }
    }

    goto LABEL_10;
  }

  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v22 = v5;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
    }
  }

  v15 = *(a1 + 40);
  if (v15)
  {
    v8 = NPKGetIDSCommunicationError();
    (*(v15 + 16))(v15, 0, v8);
LABEL_10:
  }

LABEL_11:

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __68__NPKPaymentWebServiceCompanionTargetDevice_dumpLogsWithCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)pendingRemovalResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __68__NPKPaymentWebServiceCompanionTargetDevice_pendingRemovalResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24), 0);
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __68__NPKPaymentWebServiceCompanionTargetDevice_pendingRemovalResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoMarkPaymentPassForDeleteResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoMarkPaymentPassForDeleteResponse *)v4 initWithData:v5];

    if ([(NPKProtoMarkPaymentPassForDeleteResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;

      *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoMarkPaymentPassForDeleteResponse *)v6 success];
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)handlePendingRemovalOfPaymentPass:(id)pass uniqueID:(id)d completion:(id)completion
{
  v28 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  dCopy = d;
  completionCopy = completion;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412546;
      v25 = passCopy;
      v26 = 2112;
      v27 = dCopy;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Handle pending removal of pass %@ with unique ID %@", buf, 0x16u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_handlePendingRemovalOfPaymentPass_uniqueID_completion___block_invoke;
  v19[3] = &unk_279945BB0;
  v20 = dCopy;
  v21 = passCopy;
  selfCopy = self;
  v23 = completionCopy;
  v15 = completionCopy;
  v16 = passCopy;
  v17 = dCopy;
  dispatch_sync(internalQueue, v19);

  v18 = *MEMORY[0x277D85DE8];
}

void __99__NPKPaymentWebServiceCompanionTargetDevice_handlePendingRemovalOfPaymentPass_uniqueID_completion___block_invoke(uint64_t a1)
{
  v43 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoMarkPaymentPassForDeleteRequest);
  [(NPKProtoMarkPaymentPassForDeleteRequest *)v2 setPassID:*(a1 + 32)];
  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  v31 = a1;
  v3 = [*(a1 + 40) devicePaymentApplications];
  v4 = [v3 countByEnumeratingWithState:&v34 objects:v42 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v35;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v35 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v8 = [*(*(&v34 + 1) + 8 * i) applicationIdentifier];
        if (v8)
        {
          [(NPKProtoMarkPaymentPassForDeleteRequest *)v2 addPaymentApplicationAIDs:v8];
          v9 = pk_Payment_log();
          v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

          if (v10)
          {
            v11 = pk_Payment_log();
            if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
            {
              *buf = 138412290;
              v41 = v8;
              _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Requesting deletion of AID %@", buf, 0xCu);
            }
          }
        }
      }

      v5 = [v3 countByEnumeratingWithState:&v34 objects:v42 count:16];
    }

    while (v5);
  }

  v12 = objc_alloc(MEMORY[0x277D189F0]);
  v13 = [(NPKProtoMarkPaymentPassForDeleteRequest *)v2 data];
  v14 = [v12 initWithProtobufData:v13 type:12 isResponse:0];

  v15 = *(v31 + 48);
  v38 = *MEMORY[0x277D185A0];
  v39 = MEMORY[0x277CBEC38];
  v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v39 forKeys:&v38 count:1];
  v17 = [v15 _sendProtobuf:v14 responseExpected:1 extraOptions:v16];

  if (v17)
  {
    v18 = *(v31 + 56);
    if (v18)
    {
      v19 = _Block_copy(v18);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_handlePendingRemovalOfPaymentPass_uniqueID_completion___block_invoke_469;
      aBlock[3] = &unk_279945218;
      v33 = *(v31 + 56);
      v20 = _Block_copy(aBlock);
      v21 = *(v31 + 48);
      v22 = _Block_copy(v19);
      [v21 _trackOutstandingRequestWithMessageIdentifier:v17 completionHandler:v22 errorHandler:v20];

LABEL_23:
      goto LABEL_24;
    }

    v28 = pk_Payment_log();
    v29 = os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT);

    if (v29)
    {
      v19 = pk_Payment_log();
      if (!os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_23;
      }

      *buf = 138412290;
      v41 = v17;
      v25 = "Warning: No response expected for message with identifier %@";
      v26 = v19;
      v27 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_22;
    }
  }

  else
  {
    v23 = pk_Payment_log();
    v24 = os_log_type_enabled(v23, OS_LOG_TYPE_ERROR);

    if (v24)
    {
      v19 = pk_Payment_log();
      if (!os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_23;
      }

      *buf = 138412290;
      v41 = v14;
      v25 = "Error: No message identifier for protobuf %@";
      v26 = v19;
      v27 = OS_LOG_TYPE_ERROR;
LABEL_22:
      _os_log_impl(&dword_25B300000, v26, v27, v25, buf, 0xCu);
      goto LABEL_23;
    }
  }

LABEL_24:

  v30 = *MEMORY[0x277D85DE8];
}

uint64_t __99__NPKPaymentWebServiceCompanionTargetDevice_handlePendingRemovalOfPaymentPass_uniqueID_completion___block_invoke_469(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)preferredAIDRequest:(id)request
{
  v23 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [requestCopy npkDescription];
      v19 = 138412290;
      v20 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &v19, 0xCu);
    }
  }

  v9 = [NPKProtoSetPreferredPaymentApplicationRequest alloc];
  data = [requestCopy data];
  v11 = [(NPKProtoSetPreferredPaymentApplicationRequest *)v9 initWithData:data];

  passID = [(NPKProtoSetPreferredPaymentApplicationRequest *)v11 passID];
  preferredApplicationAID = [(NPKProtoSetPreferredPaymentApplicationRequest *)v11 preferredApplicationAID];
  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v16 = pk_Payment_log();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
      v19 = 138412546;
      v20 = passID;
      v21 = 2112;
      v22 = preferredApplicationAID;
      _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: unique ID %@ AID %@", &v19, 0x16u);
    }
  }

  if (passID)
  {
    delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
    [delegate handlePreferredAID:preferredApplicationAID forPassWithUniqueID:passID];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)preferredAIDResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __66__NPKPaymentWebServiceCompanionTargetDevice_preferredAIDResponse___block_invoke;
    block[3] = &unk_279949F68;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    p_buf = &buf;
    v20 = responseCopy;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, 1, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __66__NPKPaymentWebServiceCompanionTargetDevice_preferredAIDResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [*(a1 + 32) outstandingRequests];
    [v4 removeObjectForKey:*(a1 + 40)];

    v5 = [v3 completionHandler];
    v6 = *(*(a1 + 56) + 8);
    v7 = *(v6 + 40);
    *(v6 + 40) = v5;

    v8 = [NPKProtoSetPreferredPaymentApplicationResponse alloc];
    v9 = [*(a1 + 48) data];
    v10 = [(NPKProtoSetPreferredPaymentApplicationResponse *)v8 initWithData:v9];

    v11 = [(NPKProtoSetPreferredPaymentApplicationResponse *)v10 preferredApplicationAID];
    v12 = *(*(a1 + 64) + 8);
    v13 = *(v12 + 40);
    *(v12 + 40) = v11;
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

    if (v15)
    {
      v16 = pk_Payment_log();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v17, 2u);
      }
    }
  }
}

- (void)handlePreferredAID:(id)d forPassWithUniqueID:(id)iD completion:(id)completion
{
  v28 = *MEMORY[0x277D85DE8];
  dCopy = d;
  iDCopy = iD;
  completionCopy = completion;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412546;
      v25 = dCopy;
      v26 = 2112;
      v27 = iDCopy;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Handle preferred AID %@ for unique ID %@", buf, 0x16u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __95__NPKPaymentWebServiceCompanionTargetDevice_handlePreferredAID_forPassWithUniqueID_completion___block_invoke;
  v19[3] = &unk_279945BB0;
  v20 = iDCopy;
  v21 = dCopy;
  selfCopy = self;
  v23 = completionCopy;
  v15 = completionCopy;
  v16 = dCopy;
  v17 = iDCopy;
  dispatch_sync(internalQueue, v19);

  v18 = *MEMORY[0x277D85DE8];
}

void __95__NPKPaymentWebServiceCompanionTargetDevice_handlePreferredAID_forPassWithUniqueID_completion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSetPreferredPaymentApplicationRequest);
  [(NPKProtoSetPreferredPaymentApplicationRequest *)v2 setPassID:*(a1 + 32)];
  [(NPKProtoSetPreferredPaymentApplicationRequest *)v2 setPreferredApplicationAID:*(a1 + 40)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoSetPreferredPaymentApplicationRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:16 isResponse:0];

  v6 = *(a1 + 48);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 56);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __95__NPKPaymentWebServiceCompanionTargetDevice_handlePreferredAID_forPassWithUniqueID_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 56);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 48);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __95__NPKPaymentWebServiceCompanionTargetDevice_handlePreferredAID_forPassWithUniqueID_completion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0);
  }

  return result;
}

- (void)updatePaymentPass:(id)pass
{
  v17 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  v5 = [NPKProtoUpdatePaymentPassRequest alloc];
  data = [passCopy data];

  v7 = [(NPKProtoUpdatePaymentPassRequest *)v5 initWithData:data];
  passTypeIdentifier = [(NPKProtoUpdatePaymentPassRequest *)v7 passTypeIdentifier];
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v15 = 138412290;
      v16 = passTypeIdentifier;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Incoming update payment pass protobuf: %@", &v15, 0xCu);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  passTypeIdentifier2 = [(NPKProtoUpdatePaymentPassRequest *)v7 passTypeIdentifier];
  [delegate handleUpdatePaymentPassWithTypeIdentifier:passTypeIdentifier2];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)updatePushToken:(id)token
{
  v16 = *MEMORY[0x277D85DE8];
  tokenCopy = token;
  v5 = [NPKProtoUpdatePushTokenRequest alloc];
  data = [tokenCopy data];

  v7 = [(NPKProtoUpdatePushTokenRequest *)v5 initWithData:data];
  pushToken = [(NPKProtoUpdatePushTokenRequest *)v7 pushToken];
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v14 = 138412290;
      v15 = pushToken;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Incoming update push token protobuf: %@", &v14, 0xCu);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate handlePushToken:pushToken];

  v13 = *MEMORY[0x277D85DE8];
}

- (void)preconditionNotMet:(id)met
{
  v22 = *MEMORY[0x277D85DE8];
  metCopy = met;
  v5 = [NPKProtoPaymentPreconditionsNotMetRequest alloc];
  data = [metCopy data];

  v7 = [(NPKProtoPaymentPreconditionsNotMetRequest *)v5 initWithData:data];
  failedPrecondition = [(NPKProtoPaymentPreconditionsNotMetRequest *)v7 failedPrecondition];
  passIDs = [(NPKProtoPaymentPreconditionsNotMetRequest *)v7 passIDs];
  v10 = [passIDs copy];

  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v17[0] = 67109634;
      v17[1] = failedPrecondition;
      v18 = 2112;
      v19 = v10;
      v20 = 1024;
      v21 = failedPrecondition != 2;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Precondition not met: %d unique IDs %@ should unregister %d", v17, 0x18u);
    }
  }

  if (failedPrecondition > 2)
  {
    v14 = 0;
  }

  else
  {
    v14 = off_27994A930[failedPrecondition];
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate handlePreconditionNotMetWithUniqueIDs:v10 preconditionDescription:v14 shouldUnregister:failedPrecondition != 2];

  v16 = *MEMORY[0x277D85DE8];
}

- (void)handleValueAddedServiceTransactions:(id)transactions
{
  v34 = *MEMORY[0x277D85DE8];
  transactionsCopy = transactions;
  v4 = [NPKProtoHandleValueAddedServiceTransactionsRequest alloc];
  data = [transactionsCopy data];
  v6 = [(NPKProtoHandleValueAddedServiceTransactionsRequest *)v4 initWithData:data];

  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 67109120;
      transactionsBytesCount = [(NPKProtoHandleValueAddedServiceTransactionsRequest *)v6 transactionsBytesCount];
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: %u transactions", buf, 8u);
    }
  }

  if ([(NPKProtoHandleValueAddedServiceTransactionsRequest *)v6 transactionsBytesCount])
  {
    v12 = 0;
    while (v12 < [(NPKProtoHandleValueAddedServiceTransactionsRequest *)v6 transactionPassIDsCount])
    {
      transactionsBytes = [(NPKProtoHandleValueAddedServiceTransactionsRequest *)v6 transactionsBytes];
      v14 = [transactionsBytes objectAtIndexedSubscript:v12];
      v15 = objc_opt_class();
      v16 = NPKSecureUnarchiveObject(v14, v15);

      if (v16)
      {
        [array addObject:v16];
        transactionPassIDs = [(NPKProtoHandleValueAddedServiceTransactionsRequest *)v6 transactionPassIDs];
        v18 = [transactionPassIDs objectAtIndexedSubscript:v12];
        [array2 addObject:v18];
      }

      if (++v12 >= [(NPKProtoHandleValueAddedServiceTransactionsRequest *)v6 transactionsBytesCount])
      {
        goto LABEL_16;
      }
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

    if (v20)
    {
      v21 = pk_Payment_log();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        transactionsBytesCount2 = [(NPKProtoHandleValueAddedServiceTransactionsRequest *)v6 transactionsBytesCount];
        transactionPassIDsCount = [(NPKProtoHandleValueAddedServiceTransactionsRequest *)v6 transactionPassIDsCount];
        *buf = 67109376;
        transactionsBytesCount = transactionsBytesCount2;
        v32 = 1024;
        v33 = transactionPassIDsCount;
        _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_ERROR, "Error: VAS transaction protobuf does not have matching array lengths (%u %u)!", buf, 0xEu);
      }
    }
  }

LABEL_16:
  if ([array count])
  {
    v24 = objc_alloc_init(MEMORY[0x277D380F0]);
    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __81__NPKPaymentWebServiceCompanionTargetDevice_handleValueAddedServiceTransactions___block_invoke;
    v27[3] = &unk_279946EA0;
    v28 = array2;
    v29 = v24;
    v25 = v24;
    [array enumerateObjectsUsingBlock:v27];
  }

  v26 = *MEMORY[0x277D85DE8];
}

void __81__NPKPaymentWebServiceCompanionTargetDevice_handleValueAddedServiceTransactions___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v6 = a2;
  v5 = [*(a1 + 32) objectAtIndexedSubscript:a3];
  if (![v5 length])
  {

    v5 = 0;
  }

  [*(a1 + 40) insertOrUpdateValueAddedServiceTransaction:v6 forPassUniqueIdentifier:v5 paymentTransaction:0 completion:0];
}

- (void)handlePaymentTransactions:(id)transactions
{
  v54 = *MEMORY[0x277D85DE8];
  transactionsCopy = transactions;
  v4 = [NPKProtoHandlePaymentTransactionsRequest alloc];
  v48 = transactionsCopy;
  data = [transactionsCopy data];
  v6 = [(NPKProtoHandlePaymentTransactionsRequest *)v4 initWithData:data];

  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v10 = pk_Payment_log();
  LODWORD(data) = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (data)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 67109120;
      *v50 = [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionsBytesCount];
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: %u transactions", buf, 8u);
    }
  }

  if ([(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionsBytesCount])
  {
    v12 = 0;
    while (v12 < [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionPassIDsCount])
    {
      transactionsBytes = [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionsBytes];
      v14 = [transactionsBytes objectAtIndexedSubscript:v12];
      v15 = objc_opt_class();
      v16 = NPKSecureUnarchiveObject(v14, v15);

      if (v16)
      {
        transactionPassIDs = [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionPassIDs];
        v18 = [transactionPassIDs objectAtIndexedSubscript:v12];

        [array addObject:v16];
        [array2 addObject:v18];
        v19 = pk_Payment_log();
        v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

        if (v20)
        {
          v21 = pk_Payment_log();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
          {
            *buf = 138412546;
            *v50 = v16;
            *&v50[8] = 2112;
            v51 = v18;
            _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_DEFAULT, "Notice: Transaction: %@ for unique ID %@", buf, 0x16u);
          }
        }
      }

      if (++v12 >= [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionsBytesCount])
      {
        goto LABEL_20;
      }
    }

    v22 = pk_Payment_log();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

    if (v23)
    {
      v24 = pk_Payment_log();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        transactionsBytesCount = [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionsBytesCount];
        transactionPassIDsCount = [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionPassIDsCount];
        *buf = 67109376;
        *v50 = transactionsBytesCount;
        *&v50[4] = 1024;
        *&v50[6] = transactionPassIDsCount;
        _os_log_impl(&dword_25B300000, v24, OS_LOG_TYPE_ERROR, "Error: Payment transaction protobuf does not have matching array lengths (%u %u)!", buf, 0xEu);
      }
    }
  }

LABEL_20:
  if ([(NPKProtoHandlePaymentTransactionsRequest *)v6 passAppletStatesCount])
  {
    v27 = 0;
    while (v27 < [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionPassIDsCount])
    {
      passAppletStates = [(NPKProtoHandlePaymentTransactionsRequest *)v6 passAppletStates];
      v29 = [passAppletStates objectAtIndexedSubscript:v27];

      if ([v29 length])
      {
        passAppletStates2 = [(NPKProtoHandlePaymentTransactionsRequest *)v6 passAppletStates];
        v31 = [passAppletStates2 objectAtIndexedSubscript:v27];
        v32 = objc_opt_class();
        v33 = NPKSecureUnarchiveObject(v31, v32);

        if (v33)
        {
          transactionPassIDs2 = [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionPassIDs];
          v35 = [transactionPassIDs2 objectAtIndexedSubscript:v27];

          [dictionary setObject:v33 forKey:v35];
        }
      }

      if (++v27 >= [(NPKProtoHandlePaymentTransactionsRequest *)v6 passAppletStatesCount])
      {
        goto LABEL_32;
      }
    }

    v36 = pk_Payment_log();
    v37 = os_log_type_enabled(v36, OS_LOG_TYPE_ERROR);

    if (v37)
    {
      v38 = pk_Payment_log();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        transactionsBytesCount2 = [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionsBytesCount];
        transactionPassIDsCount2 = [(NPKProtoHandlePaymentTransactionsRequest *)v6 transactionPassIDsCount];
        *buf = 67109376;
        *v50 = transactionsBytesCount2;
        *&v50[4] = 1024;
        *&v50[6] = transactionPassIDsCount2;
        _os_log_impl(&dword_25B300000, v38, OS_LOG_TYPE_ERROR, "Error: Applet state protobuf does not have matching array lengths (%u %u)!", buf, 0xEu);
      }
    }
  }

LABEL_32:
  if ([array count] || objc_msgSend(dictionary, "count"))
  {
    v41 = pk_General_log();
    v42 = os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT);

    if (v42)
    {
      v43 = pk_General_log();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412802;
        *v50 = array;
        *&v50[8] = 2112;
        v51 = dictionary;
        v52 = 2112;
        v53 = array2;
        _os_log_impl(&dword_25B300000, v43, OS_LOG_TYPE_DEFAULT, "Notice: Will handle Transactions: %@ appletStates: %@ for uniqueIDs:%@", buf, 0x20u);
      }
    }

    delegate = [v47 delegate];
    [delegate handlePaymentTransactions:array appletStates:dictionary forUniqueIDs:array2];
  }

  v45 = *MEMORY[0x277D85DE8];
}

- (void)handleRemovedTransaction:(id)transaction
{
  v16 = *MEMORY[0x277D85DE8];
  transactionCopy = transaction;
  v5 = [NPKProtoHandleRemoveTransactionsRequest alloc];
  data = [transactionCopy data];

  v7 = [(NPKProtoHandleRemoveTransactionsRequest *)v5 initWithData:data];
  identifiers = [(NPKProtoHandleRemoveTransactionsRequest *)v7 identifiers];
  v9 = pk_General_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_General_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v14 = 138412290;
      v15 = identifiers;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Request to remove transactions with identfiers: %@", &v14, 0xCu);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate handleRemoveTransactionsWithIdentifiers:identifiers];

  v13 = *MEMORY[0x277D85DE8];
}

- (void)retrieveTransactionsForPassWithUniqueID:(id)d
{
  v25 = *MEMORY[0x277D85DE8];
  dCopy = d;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v24 = dCopy;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Retrieving transactions for unique ID %@", buf, 0xCu);
    }
  }

  v8 = objc_alloc_init(NPKProtoRetrievePaymentTransactionsRequest);
  [(NPKProtoRetrievePaymentTransactionsRequest *)v8 setPassID:dCopy];
  v9 = objc_alloc(MEMORY[0x277D189F0]);
  data = [(NPKProtoRetrievePaymentTransactionsRequest *)v8 data];
  v11 = [v9 initWithProtobufData:data type:20 isResponse:0];

  v21[0] = *MEMORY[0x277D18650];
  v12 = [MEMORY[0x277CCABB0] numberWithDouble:*MEMORY[0x277D18828]];
  v22[0] = v12;
  v21[1] = *MEMORY[0x277D18630];
  dCopy = [MEMORY[0x277CCACA8] stringWithFormat:@"retrieveTransactions-%@", dCopy];
  v22[1] = dCopy;
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v22 forKeys:v21 count:2];

  provisioningService = [(NPKPaymentWebServiceCompanionTargetDevice *)self provisioningService];
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __85__NPKPaymentWebServiceCompanionTargetDevice_retrieveTransactionsForPassWithUniqueID___block_invoke;
  v19[3] = &unk_279945058;
  v20 = v11;
  v16 = v11;
  v17 = NPKProtoSendWithOptions(provisioningService, v16, 200, 0, 0, v19, v14);

  v18 = *MEMORY[0x277D85DE8];
}

void __85__NPKPaymentWebServiceCompanionTargetDevice_retrieveTransactionsForPassWithUniqueID___block_invoke(uint64_t a1)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_ERROR);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_ERROR))
    {
      v5 = *(a1 + 32);
      v7 = 138412290;
      v8 = v5;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_ERROR, "Error: IDS failed to send protobuf %@", &v7, 0xCu);
    }
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (void)handleDeletePaymentTransactionWithIdentifier:(id)identifier passUniqueIdentifier:(id)uniqueIdentifier
{
  identifierCopy = identifier;
  uniqueIdentifierCopy = uniqueIdentifier;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __111__NPKPaymentWebServiceCompanionTargetDevice_handleDeletePaymentTransactionWithIdentifier_passUniqueIdentifier___block_invoke;
  block[3] = &unk_279945880;
  v12 = identifierCopy;
  v13 = uniqueIdentifierCopy;
  selfCopy = self;
  v9 = uniqueIdentifierCopy;
  v10 = identifierCopy;
  dispatch_async(internalQueue, block);
}

void __111__NPKPaymentWebServiceCompanionTargetDevice_handleDeletePaymentTransactionWithIdentifier_passUniqueIdentifier___block_invoke(void *a1)
{
  v18[1] = *MEMORY[0x277D85DE8];
  v2 = objc_opt_new();
  v3 = [MEMORY[0x277CBEB18] arrayWithObjects:{a1[4], 0}];
  [v2 setIdentifiers:v3];

  if (a1[5])
  {
    v4 = [MEMORY[0x277CBEB18] arrayWithObjects:0];
    [v2 setPassIDs:v4];
  }

  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [v2 data];
  v7 = [v5 initWithProtobufData:v6 type:26 isResponse:0];

  v8 = a1[6];
  v17 = *MEMORY[0x277D18650];
  v18[0] = &unk_286CE7768;
  v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v18 forKeys:&v17 count:1];
  v10 = [v8 _sendProtobuf:v7 responseExpected:0 extraOptions:v9];

  if (!v10)
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_ERROR);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v16 = v7;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
      }
    }
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)handleUpdatedAppletState:(id)state
{
  v22 = *MEMORY[0x277D85DE8];
  stateCopy = state;
  v5 = [NPKProtoHandleAppletStateChangeRequest alloc];
  data = [stateCopy data];

  v7 = [(NPKProtoHandleAppletStateChangeRequest *)v5 initWithData:data];
  passID = [(NPKProtoHandleAppletStateChangeRequest *)v7 passID];
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v20 = 138412290;
      v21 = passID;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Received updated applet state for pass with unique ID %@", &v20, 0xCu);
    }
  }

  passAppletState = [(NPKProtoHandleAppletStateChangeRequest *)v7 passAppletState];
  if ([passAppletState length])
  {
    v13 = objc_opt_class();
    v14 = NPKSecureUnarchiveObject(passAppletState, v13);
  }

  else
  {
    v14 = 0;
  }

  v15 = pk_Payment_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      v20 = 138412290;
      v21 = v14;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Decoded applet state: %@", &v20, 0xCu);
    }
  }

  if (passID)
  {
    delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
    [delegate handleAppletState:v14 forUniqueID:passID];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)setExpressPassResponse:(id)response
{
  v46 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v42 = 0x3032000000;
  v43 = __Block_byref_object_copy__22;
  v44 = __Block_byref_object_dispose__22;
  v45 = 0;
  v35 = 0;
  v36 = &v35;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v29 = 0;
  v30 = &v29;
  v31 = 0x3032000000;
  v32 = __Block_byref_object_copy__22;
  v33 = __Block_byref_object_dispose__22;
  v34 = 0;
  v25 = 0;
  v26 = &v25;
  v27 = 0x2020000000;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __68__NPKPaymentWebServiceCompanionTargetDevice_setExpressPassResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v35;
    v22 = &v29;
    p_buf = &buf;
    v24 = &v25;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = v36[5];
  if (v15)
  {
    (*(v15 + 16))(v15, v26[3], v30[5], *(*(&buf + 1) + 40));
  }

  _Block_object_dispose(&v25, 8);
  _Block_object_dispose(&v29, 8);

  _Block_object_dispose(&v35, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __68__NPKPaymentWebServiceCompanionTargetDevice_setExpressPassResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoSetExpressPassResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoSetExpressPassResponse *)v4 initWithData:v5];

    if ([(NPKProtoSetExpressPassResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;
    }

    v14 = [(NPKProtoSetExpressPassResponse *)v6 actualUniqueID];
    v15 = *(*(a1 + 64) + 8);
    v16 = *(v15 + 40);
    *(v15 + 40) = v14;

    v17 = [(NPKProtoSetExpressPassResponse *)v6 actualExpressPassInformation];
    v18 = objc_opt_class();
    v19 = NPKSecureUnarchiveObject(v17, v18);

    if (v19)
    {
      v20 = [MEMORY[0x277CBEB98] setWithObject:v19];
      v22 = NPKExpressConfigurationFromInformation(v20, v21);
    }

    else
    {
      v25 = [(NPKProtoSetExpressPassResponse *)v6 currentExpressPassesInformationsCount];
      v26 = *(a1 + 32);
      if (v25)
      {
        v20 = [(NPKProtoSetExpressPassResponse *)v6 currentExpressPassesInformations];
        v24 = [v26 _expressPassesInformationFromDataArray:v20];
        v28 = NPKExpressConfigurationFromInformation(v24, v27);
        v29 = *(*(a1 + 72) + 8);
        v30 = *(v29 + 40);
        *(v29 + 40) = v28;

LABEL_14:
        if ([(NPKProtoSetExpressPassResponse *)v6 success])
        {
          v31 = *(*(a1 + 80) + 8);
          v32 = 1;
        }

        else if ([(NPKProtoSetExpressPassResponse *)v6 cancelled])
        {
          v31 = *(*(a1 + 80) + 8);
          v32 = 2;
        }

        else
        {
          v33 = [(NPKProtoSetExpressPassResponse *)v6 needsUnlock];
          v31 = *(*(a1 + 80) + 8);
          if (!v33)
          {
            *(v31 + 24) = 0;
            goto LABEL_21;
          }

          v32 = 3;
        }

        *(v31 + 24) = v32;
LABEL_21:

        goto LABEL_22;
      }

      v20 = [(NPKProtoSetExpressPassResponse *)v6 expressPassConfigurations];
      v22 = [v26 _expressPassesConfigurationFromDataArray:v20];
    }

    v23 = *(*(a1 + 72) + 8);
    v24 = *(v23 + 40);
    *(v23 + 40) = v22;
    goto LABEL_14;
  }

  v7 = pk_Payment_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v34[0] = 0;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v34, 2u);
    }
  }

LABEL_22:
}

- (void)setExpressWithPassConfiguration:(id)configuration requestAuthorization:(BOOL)authorization completion:(id)completion
{
  authorizationCopy = authorization;
  v38 = *MEMORY[0x277D85DE8];
  configurationCopy = configuration;
  completionCopy = completion;
  passInformation = [configurationCopy passInformation];
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      expressMode = [passInformation expressMode];
      passUniqueIdentifier = [passInformation passUniqueIdentifier];
      paymentApplicationIdentifier = [passInformation paymentApplicationIdentifier];
      *buf = 138413314;
      v29 = configurationCopy;
      v30 = 2112;
      v31 = expressMode;
      v32 = 2112;
      v33 = passUniqueIdentifier;
      v34 = 2112;
      v35 = paymentApplicationIdentifier;
      v36 = 1024;
      v37 = authorizationCopy;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device: set express with configuration %@\n mode: %@\n unique ID %@\n, AID %@\n, request authorization %d", buf, 0x30u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __109__NPKPaymentWebServiceCompanionTargetDevice_setExpressWithPassConfiguration_requestAuthorization_completion___block_invoke;
  block[3] = &unk_279949FB8;
  v27 = authorizationCopy;
  v23 = passInformation;
  v24 = configurationCopy;
  selfCopy = self;
  v26 = completionCopy;
  v18 = completionCopy;
  v19 = configurationCopy;
  v20 = passInformation;
  dispatch_sync(internalQueue, block);

  v21 = *MEMORY[0x277D85DE8];
}

void __109__NPKPaymentWebServiceCompanionTargetDevice_setExpressWithPassConfiguration_requestAuthorization_completion___block_invoke(uint64_t a1)
{
  v38[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSetExpressPassRequest);
  v3 = [*(a1 + 32) passUniqueIdentifier];
  [(NPKProtoSetExpressPassRequest *)v2 setUniqueID:v3];

  v4 = [*(a1 + 32) paymentApplicationIdentifier];
  [(NPKProtoSetExpressPassRequest *)v2 setApplicationIdentifier:v4];

  [(NPKProtoSetExpressPassRequest *)v2 setRequestAuthorization:*(a1 + 64)];
  v5 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoSetExpressPassRequest *)v2 setExpressPassInformation:v5];

  v6 = NPKSecureArchiveObject(*(a1 + 40));
  [(NPKProtoSetExpressPassRequest *)v2 setExpressPassConfiguration:v6];

  v7 = MEMORY[0x277CCACA8];
  v8 = [*(a1 + 32) expressMode];
  v9 = [v7 stringWithFormat:@"SetExpressPassIdentifier-%@", v8];

  v10 = objc_alloc(MEMORY[0x277D189F0]);
  v11 = [(NPKProtoSetExpressPassRequest *)v2 data];
  v12 = [v10 initWithProtobufData:v11 type:22 isResponse:0];

  v13 = *(a1 + 48);
  v14 = *MEMORY[0x277D18630];
  v37[0] = *MEMORY[0x277D185A0];
  v37[1] = v14;
  v38[0] = MEMORY[0x277CBEC38];
  v38[1] = v9;
  v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:v37 count:2];
  v16 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v15];

  if (v16)
  {
    if (*(a1 + 56))
    {
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __109__NPKPaymentWebServiceCompanionTargetDevice_setExpressWithPassConfiguration_requestAuthorization_completion___block_invoke_2;
      aBlock[3] = &unk_279949F90;
      v33 = *(a1 + 32);
      v34 = *(a1 + 56);
      v17 = _Block_copy(aBlock);
      v30[0] = MEMORY[0x277D85DD0];
      v30[1] = 3221225472;
      v30[2] = __109__NPKPaymentWebServiceCompanionTargetDevice_setExpressWithPassConfiguration_requestAuthorization_completion___block_invoke_3;
      v30[3] = &unk_279945218;
      v31 = *(a1 + 56);
      v18 = _Block_copy(v30);
      v19 = *(a1 + 48);
      v20 = _Block_copy(v17);
      [v19 _trackOutstandingRequestWithMessageIdentifier:v16 completionHandler:v20 errorHandler:v18];

      v21 = v33;
LABEL_11:

      goto LABEL_12;
    }

    v27 = pk_Payment_log();
    v28 = os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT);

    if (v28)
    {
      v21 = pk_Payment_log();
      if (!os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v36 = v16;
      v24 = "Warning: No response expected for message with identifier %@";
      v25 = v21;
      v26 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v22 = pk_Payment_log();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

    if (v23)
    {
      v21 = pk_Payment_log();
      if (!os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v36 = v12;
      v24 = "Error: No message identifier for protobuf %@";
      v25 = v21;
      v26 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v25, v26, v24, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v29 = *MEMORY[0x277D85DE8];
}

void __109__NPKPaymentWebServiceCompanionTargetDevice_setExpressWithPassConfiguration_requestAuthorization_completion___block_invoke_2(uint64_t a1, uint64_t a2, void *a3, void *a4)
{
  v6 = a4;
  if (!v6)
  {
    v7 = MEMORY[0x277D37E90];
    v8 = a3;
    v9 = [v7 alloc];
    v10 = [*(a1 + 32) expressMode];
    v11 = [*(a1 + 32) paymentApplicationIdentifier];
    v12 = [v9 initForExpressMode:v10 withPassUniqueIdentifier:v8 paymentApplicationIdentifier:v11];

    if (v12)
    {
      v13 = [MEMORY[0x277CBEB98] setWithObject:v12];
      v15 = NPKExpressConfigurationFromInformation(v13, v14);
    }

    else
    {
      v15 = 0;
    }

    v6 = v15;
  }

  v16 = v6;
  (*(*(a1 + 40) + 16))();
}

uint64_t __109__NPKPaymentWebServiceCompanionTargetDevice_setExpressWithPassConfiguration_requestAuthorization_completion___block_invoke_3(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0);
  }

  return result;
}

- (void)removeExpressPassWithUniqueIdentifierResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: remove express pass with unique identifier: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v28 = 0;
  v29 = &v28;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__22;
  v32 = __Block_byref_object_dispose__22;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x2020000000;
  v27 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_removeExpressPassWithUniqueIdentifierResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v28;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v25 + 24), v29[5]);
  }

  _Block_object_dispose(&v24, 8);
  _Block_object_dispose(&v28, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_removeExpressPassWithUniqueIdentifierResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoRemoveExpressPassWithUniqueIdentifierResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoRemoveExpressPassWithUniqueIdentifierResponse *)v4 initWithData:v5];

    if ([(NPKProtoRemoveExpressPassWithUniqueIdentifierResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;
    }

    v14 = [(NPKProtoRemoveExpressPassWithUniqueIdentifierResponse *)v6 actualExpressPassInformation];
    v15 = objc_opt_class();
    v16 = NPKSecureUnarchiveObject(v14, v15);

    if (v16)
    {
      v17 = [MEMORY[0x277CBEB98] setWithObject:v16];
      v19 = NPKExpressConfigurationFromInformation(v17, v18);
    }

    else
    {
      v22 = [(NPKProtoRemoveExpressPassWithUniqueIdentifierResponse *)v6 currentExpressPassesInformationsCount];
      v23 = *(a1 + 32);
      if (v22)
      {
        v17 = [(NPKProtoRemoveExpressPassWithUniqueIdentifierResponse *)v6 currentExpressPassesInformations];
        v21 = [v23 _expressPassesInformationFromDataArray:v17];
        v25 = NPKExpressConfigurationFromInformation(v21, v24);
        v26 = *(*(a1 + 64) + 8);
        v27 = *(v26 + 40);
        *(v26 + 40) = v25;

        goto LABEL_14;
      }

      v17 = [(NPKProtoRemoveExpressPassWithUniqueIdentifierResponse *)v6 expressPassConfigurations];
      v19 = [v23 _expressPassesConfigurationFromDataArray:v17];
    }

    v20 = *(*(a1 + 64) + 8);
    v21 = *(v20 + 40);
    *(v20 + 40) = v19;
LABEL_14:

    *(*(*(a1 + 72) + 8) + 24) = [(NPKProtoRemoveExpressPassWithUniqueIdentifierResponse *)v6 success];
    goto LABEL_15;
  }

  v7 = pk_Payment_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      *v28 = 0;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v28, 2u);
    }
  }

LABEL_15:
}

- (void)removeExpressPassWithUniqueIdentifier:(id)identifier completion:(id)completion
{
  v21 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  completionCopy = completion;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v20 = identifierCopy;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Target device: remove express pass with unique ID: %@", buf, 0xCu);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __94__NPKPaymentWebServiceCompanionTargetDevice_removeExpressPassWithUniqueIdentifier_completion___block_invoke;
  block[3] = &unk_279945A48;
  v16 = identifierCopy;
  selfCopy = self;
  v18 = completionCopy;
  v12 = completionCopy;
  v13 = identifierCopy;
  dispatch_sync(internalQueue, block);

  v14 = *MEMORY[0x277D85DE8];
}

void __94__NPKPaymentWebServiceCompanionTargetDevice_removeExpressPassWithUniqueIdentifier_completion___block_invoke(uint64_t a1)
{
  v29[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoRemoveExpressPassWithUniqueIdentifierRequest);
  [(NPKProtoRemoveExpressPassWithUniqueIdentifierRequest *)v2 setUniqueID:*(a1 + 32)];
  v3 = [MEMORY[0x277CCACA8] stringWithFormat:@"RemoveExpressPass-%@", *(a1 + 32)];
  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoRemoveExpressPassWithUniqueIdentifierRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:46 isResponse:0];

  v7 = *(a1 + 40);
  v8 = *MEMORY[0x277D18630];
  v28[0] = *MEMORY[0x277D185A0];
  v28[1] = v8;
  v29[0] = MEMORY[0x277CBEC38];
  v29[1] = v3;
  v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:2];
  v10 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v9];

  if (v10)
  {
    v11 = *(a1 + 48);
    if (v11)
    {
      v12 = _Block_copy(v11);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __94__NPKPaymentWebServiceCompanionTargetDevice_removeExpressPassWithUniqueIdentifier_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v25 = *(a1 + 48);
      v13 = _Block_copy(aBlock);
      v14 = *(a1 + 40);
      v15 = _Block_copy(v12);
      [v14 _trackOutstandingRequestWithMessageIdentifier:v10 completionHandler:v15 errorHandler:v13];

LABEL_11:
      goto LABEL_12;
    }

    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT);

    if (v22)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v27 = v10;
      v18 = "Warning: No response expected for message with identifier %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);

    if (v17)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v27 = v6;
      v18 = "Error: No message identifier for protobuf %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v19, v20, v18, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v23 = *MEMORY[0x277D85DE8];
}

void __94__NPKPaymentWebServiceCompanionTargetDevice_removeExpressPassWithUniqueIdentifier_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  if (*(a1 + 32))
  {
    v5 = v3;
    if (v3)
    {
      v4 = 0;
    }

    else
    {
      v4 = [MEMORY[0x277CBEB98] set];
    }

    (*(*(a1 + 32) + 16))();

    v3 = v5;
  }
}

- (void)conflictingExpressPassIdentifiersForPassConfiguration:(id)configuration completion:(id)completion
{
  completionCopy = completion;
  v7 = completionCopy;
  if (completionCopy)
  {
    v8[0] = MEMORY[0x277D85DD0];
    v8[1] = 3221225472;
    v8[2] = __110__NPKPaymentWebServiceCompanionTargetDevice_conflictingExpressPassIdentifiersForPassConfiguration_completion___block_invoke;
    v8[3] = &unk_279949FE0;
    v9 = completionCopy;
    [(NPKPaymentWebServiceCompanionTargetDevice *)self conflictingExpressPassIdentifiersForPassConfiguration:configuration withReferenceExpressState:0 completion:v8];
  }
}

- (void)conflictingExpressPassIdentifiersForPassConfiguration:(id)configuration withReferenceExpressState:(id)state completion:(id)completion
{
  v28 = *MEMORY[0x277D85DE8];
  configurationCopy = configuration;
  stateCopy = state;
  completionCopy = completion;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412546;
      v25 = configurationCopy;
      v26 = 2112;
      v27 = stateCopy;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device: conflicting express pass identifiers with passConfig %@, referenceExpressPassConfigurations:%@", buf, 0x16u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __136__NPKPaymentWebServiceCompanionTargetDevice_conflictingExpressPassIdentifiersForPassConfiguration_withReferenceExpressState_completion___block_invoke;
  v19[3] = &unk_279945BB0;
  v20 = configurationCopy;
  v21 = stateCopy;
  selfCopy = self;
  v23 = completionCopy;
  v15 = completionCopy;
  v16 = stateCopy;
  v17 = configurationCopy;
  dispatch_sync(internalQueue, v19);

  v18 = *MEMORY[0x277D85DE8];
}

void __136__NPKPaymentWebServiceCompanionTargetDevice_conflictingExpressPassIdentifiersForPassConfiguration_withReferenceExpressState_completion___block_invoke(uint64_t a1)
{
  v38[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoConflictingExpressPassIdentifiersForPassInformationRequest);
  v3 = [*(a1 + 32) passInformation];
  v4 = NPKSecureArchiveObject(v3);
  [(NPKProtoConflictingExpressPassIdentifiersForPassInformationRequest *)v2 setExpressPassInformation:v4];

  v5 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoConflictingExpressPassIdentifiersForPassInformationRequest *)v2 setExpressPassConfiguration:v5];

  v6 = *(a1 + 40);
  v33[0] = MEMORY[0x277D85DD0];
  v33[1] = 3221225472;
  v33[2] = __136__NPKPaymentWebServiceCompanionTargetDevice_conflictingExpressPassIdentifiersForPassConfiguration_withReferenceExpressState_completion___block_invoke_2;
  v33[3] = &unk_27994A008;
  v7 = v2;
  v34 = v7;
  [v6 enumerateObjectsUsingBlock:v33];
  v8 = MEMORY[0x277CCACA8];
  v9 = [*(a1 + 32) passUniqueIdentifier];
  v10 = [v8 stringWithFormat:@"ConflictingPassIdentifiers-%@", v9];

  v11 = objc_alloc(MEMORY[0x277D189F0]);
  v12 = [(NPKProtoConflictingExpressPassIdentifiersForPassInformationRequest *)v7 data];
  v13 = [v11 initWithProtobufData:v12 type:53 isResponse:0];

  v14 = *(a1 + 48);
  v15 = *MEMORY[0x277D18630];
  v37[0] = *MEMORY[0x277D185A0];
  v37[1] = v15;
  v38[0] = MEMORY[0x277CBEC38];
  v38[1] = v10;
  v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:v37 count:2];
  v17 = [v14 _sendProtobuf:v13 responseExpected:1 extraOptions:v16];

  if (v17)
  {
    v18 = *(a1 + 56);
    if (v18)
    {
      v19 = _Block_copy(v18);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __136__NPKPaymentWebServiceCompanionTargetDevice_conflictingExpressPassIdentifiersForPassConfiguration_withReferenceExpressState_completion___block_invoke_3;
      aBlock[3] = &unk_279945218;
      v32 = *(a1 + 56);
      v20 = _Block_copy(aBlock);
      v21 = *(a1 + 48);
      v22 = _Block_copy(v19);
      [v21 _trackOutstandingRequestWithMessageIdentifier:v17 completionHandler:v22 errorHandler:v20];

LABEL_11:
      goto LABEL_12;
    }

    v28 = pk_Payment_log();
    v29 = os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT);

    if (v29)
    {
      v19 = pk_Payment_log();
      if (!os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v36 = v17;
      v25 = "Warning: No response expected for message with identifier %@";
      v26 = v19;
      v27 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v23 = pk_Payment_log();
    v24 = os_log_type_enabled(v23, OS_LOG_TYPE_ERROR);

    if (v24)
    {
      v19 = pk_Payment_log();
      if (!os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v36 = v13;
      v25 = "Error: No message identifier for protobuf %@";
      v26 = v19;
      v27 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v26, v27, v25, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v30 = *MEMORY[0x277D85DE8];
}

void __136__NPKPaymentWebServiceCompanionTargetDevice_conflictingExpressPassIdentifiersForPassConfiguration_withReferenceExpressState_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = *(a1 + 32);
  v4 = a2;
  v5 = NPKSecureArchiveObject(v4);
  [v3 addReferenceExpressPassConfigurations:v5];

  v6 = *(a1 + 32);
  v8 = [v4 passInformation];

  v7 = NPKSecureArchiveObject(v8);
  [v6 addReferenceExpressPassesInformation:v7];
}

uint64_t __136__NPKPaymentWebServiceCompanionTargetDevice_conflictingExpressPassIdentifiersForPassConfiguration_withReferenceExpressState_completion___block_invoke_3(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0);
  }

  return result;
}

- (void)conflictingExpressPassIdentifiersForPassInformationResponse:(id)response
{
  v49 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: conflicting express pass identifiers incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v45 = 0x3032000000;
  v46 = __Block_byref_object_copy__384;
  v47 = __Block_byref_object_dispose__385;
  v48 = 0;
  v34 = 0;
  v35 = &v34;
  v36 = 0x3032000000;
  v37 = __Block_byref_object_copy__22;
  v38 = __Block_byref_object_dispose__22;
  v39 = 0;
  v28 = 0;
  v29 = &v28;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__22;
  v32 = __Block_byref_object_dispose__22;
  v33 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __105__NPKPaymentWebServiceCompanionTargetDevice_conflictingExpressPassIdentifiersForPassInformationResponse___block_invoke;
    v22[3] = &unk_279949C48;
    v22[4] = self;
    v23 = incomingResponseIdentifier;
    v24 = responseCopy;
    p_buf = &buf;
    v26 = &v34;
    v27 = &v28;
    dispatch_sync(internalQueue, v22);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v40 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v40, 2u);
      }
    }
  }

  v15 = pk_General_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_General_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      v18 = v35[5];
      v19 = v29[5];
      *v40 = 138412546;
      v41 = v18;
      v42 = 2112;
      v43 = v19;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device: Received conflictingPassesUniqueIDs:%@ conflictingReferencePassIdentifier:%@", v40, 0x16u);
    }
  }

  v20 = *(*(&buf + 1) + 40);
  if (v20)
  {
    (*(v20 + 16))(v20, v35[5], v29[5]);
  }

  _Block_object_dispose(&v28, 8);

  _Block_object_dispose(&v34, 8);
  _Block_object_dispose(&buf, 8);

  v21 = *MEMORY[0x277D85DE8];
}

void __105__NPKPaymentWebServiceCompanionTargetDevice_conflictingExpressPassIdentifiersForPassInformationResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoConflictingExpressPassIdentifiersForPassInformationResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoConflictingExpressPassIdentifiersForPassInformationResponse *)v4 initWithData:v5];

    if ([(NPKProtoConflictingExpressPassIdentifiersForPassInformationResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;
    }

    v14 = [(NPKProtoConflictingExpressPassIdentifiersForPassInformationResponse *)v6 conflictingExpressPassIdentifiers];

    if (v14)
    {
      v15 = MEMORY[0x277CBEB98];
      v16 = [(NPKProtoConflictingExpressPassIdentifiersForPassInformationResponse *)v6 conflictingExpressPassIdentifiers];
      v17 = [v15 setWithArray:v16];
      v18 = *(*(a1 + 64) + 8);
      v19 = *(v18 + 40);
      *(v18 + 40) = v17;
    }

    v20 = [(NPKProtoConflictingExpressPassIdentifiersForPassInformationResponse *)v6 conflictingReferenceExpressPassIdentifiers];

    if (v20)
    {
      v21 = MEMORY[0x277CBEB98];
      v22 = [(NPKProtoConflictingExpressPassIdentifiersForPassInformationResponse *)v6 conflictingReferenceExpressPassIdentifiers];
      v23 = [v21 setWithArray:v22];
      v24 = *(*(a1 + 72) + 8);
      v25 = *(v24 + 40);
      *(v24 + 40) = v23;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v26 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v26, 2u);
      }
    }
  }
}

- (void)handleBalanceReminderWithBalanceAndPassRequest:(id)request
{
  v26 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = [NPKProtoSetBalanceReminderForBalanceAndPassRequest alloc];
  data = [requestCopy data];

  v7 = [(NPKProtoSetBalanceReminderForBalanceAndPassRequest *)v5 initWithData:data];
  uniqueID = [(NPKProtoSetBalanceReminderForBalanceAndPassRequest *)v7 uniqueID];
  balanceBytes = [(NPKProtoSetBalanceReminderForBalanceAndPassRequest *)v7 balanceBytes];
  v10 = objc_opt_class();
  v11 = NPKSecureUnarchiveObject(balanceBytes, v10);

  balanceReminderBytes = [(NPKProtoSetBalanceReminderForBalanceAndPassRequest *)v7 balanceReminderBytes];
  v13 = objc_opt_class();
  v14 = NPKSecureUnarchiveObject(balanceReminderBytes, v13);

  v15 = pk_Payment_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      v20 = 138412802;
      v21 = v14;
      v22 = 2112;
      v23 = v11;
      v24 = 2112;
      v25 = uniqueID;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Handling balance reminder update %@ for balance %@ unique ID %@", &v20, 0x20u);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate handleBalanceReminderUpdate:v14 balance:v11 forUniqueID:uniqueID];

  v19 = *MEMORY[0x277D85DE8];
}

- (void)setBalanceReminderWithBalanceAndPassResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: set balance reminder incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_setBalanceReminderWithBalanceAndPassResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_setBalanceReminderWithBalanceAndPassResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoSetBalanceReminderForBalanceAndPassResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoSetBalanceReminderForBalanceAndPassResponse *)v4 initWithData:v5];

    if ([(NPKProtoSetBalanceReminderForBalanceAndPassResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;
    }

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoSetBalanceReminderForBalanceAndPassResponse *)v6 success];
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)setBalanceReminder:(id)reminder forBalance:(id)balance pass:(id)pass completion:(id)completion
{
  v35 = *MEMORY[0x277D85DE8];
  reminderCopy = reminder;
  balanceCopy = balance;
  passCopy = pass;
  completionCopy = completion;
  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v16 = pk_Payment_log();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412802;
      v30 = reminderCopy;
      v31 = 2112;
      v32 = balanceCopy;
      v33 = 2112;
      v34 = passCopy;
      _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: Target device: setting balance reminder %@ for balance %@ with passInfo %@", buf, 0x20u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_setBalanceReminder_forBalance_pass_completion___block_invoke;
  block[3] = &unk_2799467F8;
  v24 = passCopy;
  v25 = balanceCopy;
  v26 = reminderCopy;
  selfCopy = self;
  v28 = completionCopy;
  v18 = completionCopy;
  v19 = reminderCopy;
  v20 = balanceCopy;
  v21 = passCopy;
  dispatch_sync(internalQueue, block);

  v22 = *MEMORY[0x277D85DE8];
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_setBalanceReminder_forBalance_pass_completion___block_invoke(uint64_t a1)
{
  v35[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSetBalanceReminderForBalanceAndPassRequest);
  v3 = [*(a1 + 32) uniqueID];
  [(NPKProtoSetBalanceReminderForBalanceAndPassRequest *)v2 setUniqueID:v3];

  v4 = NPKSecureArchiveObject(*(a1 + 40));
  [(NPKProtoSetBalanceReminderForBalanceAndPassRequest *)v2 setBalanceBytes:v4];

  v5 = NPKSecureArchiveObject(*(a1 + 48));
  [(NPKProtoSetBalanceReminderForBalanceAndPassRequest *)v2 setBalanceReminderBytes:v5];

  v6 = MEMORY[0x277CCACA8];
  v7 = [*(a1 + 40) identifiers];
  v8 = [v7 anyObject];
  v9 = [v6 stringWithFormat:@"SetBalanceReminder-%@", v8];

  v10 = objc_alloc(MEMORY[0x277D189F0]);
  v11 = [(NPKProtoSetBalanceReminderForBalanceAndPassRequest *)v2 data];
  v12 = [v10 initWithProtobufData:v11 type:57 isResponse:0];

  v13 = *(a1 + 56);
  v14 = *MEMORY[0x277D18630];
  v34[0] = *MEMORY[0x277D18650];
  v34[1] = v14;
  v35[0] = &unk_286CE7768;
  v35[1] = v9;
  v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:2];
  v16 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v15];

  if (v16)
  {
    v17 = *(a1 + 64);
    if (v17)
    {
      v18 = _Block_copy(v17);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_setBalanceReminder_forBalance_pass_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v31 = *(a1 + 64);
      v19 = _Block_copy(aBlock);
      v20 = *(a1 + 56);
      v21 = _Block_copy(v18);
      [v20 _trackOutstandingRequestWithMessageIdentifier:v16 completionHandler:v21 errorHandler:v19];

LABEL_11:
      goto LABEL_12;
    }

    v27 = pk_Payment_log();
    v28 = os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT);

    if (v28)
    {
      v18 = pk_Payment_log();
      if (!os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v33 = v16;
      v24 = "Warning: No response expected for message with identifier %@";
      v25 = v18;
      v26 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v22 = pk_Payment_log();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

    if (v23)
    {
      v18 = pk_Payment_log();
      if (!os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v33 = v12;
      v24 = "Error: No message identifier for protobuf %@";
      v25 = v18;
      v26 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v25, v26, v24, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v29 = *MEMORY[0x277D85DE8];
}

uint64_t __91__NPKPaymentWebServiceCompanionTargetDevice_setBalanceReminder_forBalance_pass_completion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)balanceReminderWithBalanceAndPassResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: balance reminder incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __87__NPKPaymentWebServiceCompanionTargetDevice_balanceReminderWithBalanceAndPassResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __87__NPKPaymentWebServiceCompanionTargetDevice_balanceReminderWithBalanceAndPassResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoBalanceReminderForBalanceAndPassResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoBalanceReminderForBalanceAndPassResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoBalanceReminderForBalanceAndPassResponse *)v7 balanceReminderBytes];
    v13 = objc_opt_class();
    v14 = NPKSecureUnarchiveObject(v12, v13);
    v15 = *(*(a1 + 64) + 8);
    v16 = *(v15 + 40);
    *(v15 + 40) = v14;

    v17 = [(NPKProtoBalanceReminderForBalanceAndPassResponse *)v7 hasErrorData];
    if (v17)
    {
      v1 = [(NPKProtoBalanceReminderForBalanceAndPassResponse *)v7 errorData];
      v18 = objc_opt_class();
      v19 = NPKSecureUnarchiveObject(v1, v18);
    }

    else
    {
      v19 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v19);
    if (v17)
    {
    }
  }

  else
  {
    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v22 = pk_Payment_log();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        v23[0] = 0;
        _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v23, 2u);
      }
    }
  }
}

- (void)balanceReminderForBalance:(id)balance pass:(id)pass completion:(id)completion
{
  v28 = *MEMORY[0x277D85DE8];
  balanceCopy = balance;
  passCopy = pass;
  completionCopy = completion;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412546;
      v25 = balanceCopy;
      v26 = 2112;
      v27 = passCopy;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device: getting balance reminder for balance %@ with passInfo %@", buf, 0x16u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __87__NPKPaymentWebServiceCompanionTargetDevice_balanceReminderForBalance_pass_completion___block_invoke;
  v19[3] = &unk_279945BB0;
  v20 = passCopy;
  v21 = balanceCopy;
  selfCopy = self;
  v23 = completionCopy;
  v15 = completionCopy;
  v16 = balanceCopy;
  v17 = passCopy;
  dispatch_sync(internalQueue, v19);

  v18 = *MEMORY[0x277D85DE8];
}

void __87__NPKPaymentWebServiceCompanionTargetDevice_balanceReminderForBalance_pass_completion___block_invoke(uint64_t a1)
{
  v34[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoBalanceReminderForBalanceAndPassRequest);
  v3 = [*(a1 + 32) uniqueID];
  [(NPKProtoBalanceReminderForBalanceAndPassRequest *)v2 setUniqueID:v3];

  v4 = NPKSecureArchiveObject(*(a1 + 40));
  [(NPKProtoBalanceReminderForBalanceAndPassRequest *)v2 setBalanceBytes:v4];

  v5 = MEMORY[0x277CCACA8];
  v6 = [*(a1 + 40) identifiers];
  v7 = [v6 anyObject];
  v8 = [v5 stringWithFormat:@"BalanceReminder-%@", v7];

  v9 = objc_alloc(MEMORY[0x277D189F0]);
  v10 = [(NPKProtoBalanceReminderForBalanceAndPassRequest *)v2 data];
  v11 = [v9 initWithProtobufData:v10 type:65 isResponse:0];

  v12 = *(a1 + 48);
  v13 = *MEMORY[0x277D18630];
  v33[0] = *MEMORY[0x277D18650];
  v33[1] = v13;
  v34[0] = &unk_286CE7808;
  v34[1] = v8;
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v34 forKeys:v33 count:2];
  v15 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v14];

  if (v15)
  {
    v16 = *(a1 + 56);
    if (v16)
    {
      v17 = _Block_copy(v16);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __87__NPKPaymentWebServiceCompanionTargetDevice_balanceReminderForBalance_pass_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v30 = *(a1 + 56);
      v18 = _Block_copy(aBlock);
      v19 = *(a1 + 48);
      v20 = _Block_copy(v17);
      [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:v18];

LABEL_11:
      goto LABEL_12;
    }

    v26 = pk_Payment_log();
    v27 = os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT);

    if (v27)
    {
      v17 = pk_Payment_log();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v32 = v15;
      v23 = "Warning: No response expected for message with identifier %@";
      v24 = v17;
      v25 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

    if (v22)
    {
      v17 = pk_Payment_log();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v32 = v11;
      v23 = "Error: No message identifier for protobuf %@";
      v24 = v17;
      v25 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v24, v25, v23, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v28 = *MEMORY[0x277D85DE8];
}

uint64_t __87__NPKPaymentWebServiceCompanionTargetDevice_balanceReminderForBalance_pass_completion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)setCommutePlanReminderWithCommutePlanAndPassResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: set commute plan reminder incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __98__NPKPaymentWebServiceCompanionTargetDevice_setCommutePlanReminderWithCommutePlanAndPassResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __98__NPKPaymentWebServiceCompanionTargetDevice_setCommutePlanReminderWithCommutePlanAndPassResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoSetCommutePlanReminderForCommutePlanAndPassResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoSetCommutePlanReminderForCommutePlanAndPassResponse *)v4 initWithData:v5];

    if ([(NPKProtoSetCommutePlanReminderForCommutePlanAndPassResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;
    }

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoSetCommutePlanReminderForCommutePlanAndPassResponse *)v6 success];
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)setCommutePlanReminder:(id)reminder forCommutePlan:(id)plan pass:(id)pass completion:(id)completion
{
  v34 = *MEMORY[0x277D85DE8];
  reminderCopy = reminder;
  planCopy = plan;
  passCopy = pass;
  completionCopy = completion;
  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v16 = pk_Payment_log();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
      uniqueID = [passCopy uniqueID];
      *buf = 138412546;
      v31 = reminderCopy;
      v32 = 2112;
      v33 = uniqueID;
      _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: Target device: setting commute plan reminder %@ for pass %@", buf, 0x16u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_setCommutePlanReminder_forCommutePlan_pass_completion___block_invoke;
  block[3] = &unk_2799467F8;
  v25 = passCopy;
  v26 = reminderCopy;
  v27 = planCopy;
  selfCopy = self;
  v29 = completionCopy;
  v19 = completionCopy;
  v20 = planCopy;
  v21 = reminderCopy;
  v22 = passCopy;
  dispatch_sync(internalQueue, block);

  v23 = *MEMORY[0x277D85DE8];
}

void __99__NPKPaymentWebServiceCompanionTargetDevice_setCommutePlanReminder_forCommutePlan_pass_completion___block_invoke(uint64_t a1)
{
  v33[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSetCommutePlanReminderForCommutePlanAndPassRequest);
  v3 = [*(a1 + 32) uniqueID];
  [(NPKProtoSetCommutePlanReminderForCommutePlanAndPassRequest *)v2 setUniqueID:v3];

  [*(a1 + 40) timeInterval];
  [(NPKProtoSetCommutePlanReminderForCommutePlanAndPassRequest *)v2 setReminderInterval:?];
  v4 = NPKSecureArchiveObject(*(a1 + 48));
  [(NPKProtoSetCommutePlanReminderForCommutePlanAndPassRequest *)v2 setCommutePlanBytes:v4];

  v5 = MEMORY[0x277CCACA8];
  v6 = [*(a1 + 32) uniqueID];
  v7 = [v5 stringWithFormat:@"SetCommutePlanReminder-%@", v6];

  v8 = objc_alloc(MEMORY[0x277D189F0]);
  v9 = [(NPKProtoSetCommutePlanReminderForCommutePlanAndPassRequest *)v2 data];
  v10 = [v8 initWithProtobufData:v9 type:58 isResponse:0];

  v11 = *(a1 + 56);
  v12 = *MEMORY[0x277D18630];
  v32[0] = *MEMORY[0x277D18650];
  v32[1] = v12;
  v33[0] = &unk_286CE7768;
  v33[1] = v7;
  v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v33 forKeys:v32 count:2];
  v14 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v13];

  if (v14)
  {
    v15 = *(a1 + 64);
    if (v15)
    {
      v16 = _Block_copy(v15);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_setCommutePlanReminder_forCommutePlan_pass_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v29 = *(a1 + 64);
      v17 = _Block_copy(aBlock);
      v18 = *(a1 + 56);
      v19 = _Block_copy(v16);
      [v18 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v19 errorHandler:v17];

LABEL_11:
      goto LABEL_12;
    }

    v25 = pk_Payment_log();
    v26 = os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT);

    if (v26)
    {
      v16 = pk_Payment_log();
      if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v31 = v14;
      v22 = "Warning: No response expected for message with identifier %@";
      v23 = v16;
      v24 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

    if (v21)
    {
      v16 = pk_Payment_log();
      if (!os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v31 = v10;
      v22 = "Error: No message identifier for protobuf %@";
      v23 = v16;
      v24 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v23, v24, v22, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v27 = *MEMORY[0x277D85DE8];
}

uint64_t __99__NPKPaymentWebServiceCompanionTargetDevice_setCommutePlanReminder_forCommutePlan_pass_completion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)commutePlanReminderWithCommutePlanAndPassResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: commute plan reminder incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v32 = 0;
  v33 = &v32;
  v34 = 0x2020000000;
  v35 = 0;
  v26 = 0;
  v27 = &v26;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__22;
  v30 = __Block_byref_object_dispose__22;
  v31 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __95__NPKPaymentWebServiceCompanionTargetDevice_commutePlanReminderWithCommutePlanAndPassResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v21 = incomingResponseIdentifier;
    v22 = responseCopy;
    p_buf = &buf;
    v24 = &v32;
    v25 = &v26;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v19 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v19, 2u);
      }
    }
  }

  if (*(*(&buf + 1) + 40))
  {
    v15 = objc_alloc(MEMORY[0x277D38018]);
    v16 = [v15 initWithTimeInterval:v33[3]];
    v17 = v27[5];
    (*(*(*(&buf + 1) + 40) + 16))();
  }

  _Block_object_dispose(&v26, 8);

  _Block_object_dispose(&v32, 8);
  _Block_object_dispose(&buf, 8);

  v18 = *MEMORY[0x277D85DE8];
}

void __95__NPKPaymentWebServiceCompanionTargetDevice_commutePlanReminderWithCommutePlanAndPassResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCommutePlanReminderForCommutePlanAndPassResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCommutePlanReminderForCommutePlanAndPassResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    [(NPKProtoCommutePlanReminderForCommutePlanAndPassResponse *)v7 reminderInterval];
    *(*(*(a1 + 64) + 8) + 24) = v12;
    v13 = [(NPKProtoCommutePlanReminderForCommutePlanAndPassResponse *)v7 hasErrorData];
    if (v13)
    {
      v1 = [(NPKProtoCommutePlanReminderForCommutePlanAndPassResponse *)v7 errorData];
      v14 = objc_opt_class();
      v15 = NPKSecureUnarchiveObject(v1, v14);
    }

    else
    {
      v15 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v15);
    if (v13)
    {
    }
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

    if (v17)
    {
      v18 = pk_Payment_log();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        v19[0] = 0;
        _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
      }
    }
  }
}

- (void)commutePlanReminderForCommutePlan:(id)plan pass:(id)pass withCompletion:(id)completion
{
  v29 = *MEMORY[0x277D85DE8];
  planCopy = plan;
  passCopy = pass;
  completionCopy = completion;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      uniqueID = [passCopy uniqueID];
      *buf = 138412546;
      v26 = planCopy;
      v27 = 2112;
      v28 = uniqueID;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device: getting commute plan reminder for commute plan:%@ pass %@", buf, 0x16u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_commutePlanReminderForCommutePlan_pass_withCompletion___block_invoke;
  v20[3] = &unk_279945BB0;
  v21 = passCopy;
  v22 = planCopy;
  selfCopy = self;
  v24 = completionCopy;
  v16 = completionCopy;
  v17 = planCopy;
  v18 = passCopy;
  dispatch_sync(internalQueue, v20);

  v19 = *MEMORY[0x277D85DE8];
}

void __99__NPKPaymentWebServiceCompanionTargetDevice_commutePlanReminderForCommutePlan_pass_withCompletion___block_invoke(uint64_t a1)
{
  v33[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoCommutePlanReminderForCommutePlanAndPassRequest);
  v3 = [*(a1 + 32) uniqueID];
  [(NPKProtoCommutePlanReminderForCommutePlanAndPassRequest *)v2 setUniqueID:v3];

  v4 = NPKSecureArchiveObject(*(a1 + 40));
  [(NPKProtoCommutePlanReminderForCommutePlanAndPassRequest *)v2 setCommutePlanBytes:v4];

  v5 = MEMORY[0x277CCACA8];
  v6 = [*(a1 + 32) uniqueID];
  v7 = [v5 stringWithFormat:@"CommutePlanReminder-%@", v6];

  v8 = objc_alloc(MEMORY[0x277D189F0]);
  v9 = [(NPKProtoCommutePlanReminderForCommutePlanAndPassRequest *)v2 data];
  v10 = [v8 initWithProtobufData:v9 type:66 isResponse:0];

  v11 = *(a1 + 48);
  v12 = *MEMORY[0x277D18630];
  v32[0] = *MEMORY[0x277D18650];
  v32[1] = v12;
  v33[0] = &unk_286CE7808;
  v33[1] = v7;
  v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v33 forKeys:v32 count:2];
  v14 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v13];

  if (v14)
  {
    v15 = *(a1 + 56);
    if (v15)
    {
      v16 = _Block_copy(v15);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_commutePlanReminderForCommutePlan_pass_withCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v29 = *(a1 + 56);
      v17 = _Block_copy(aBlock);
      v18 = *(a1 + 48);
      v19 = _Block_copy(v16);
      [v18 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v19 errorHandler:v17];

LABEL_11:
      goto LABEL_12;
    }

    v25 = pk_Payment_log();
    v26 = os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT);

    if (v26)
    {
      v16 = pk_Payment_log();
      if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v31 = v14;
      v22 = "Warning: No response expected for message with identifier %@";
      v23 = v16;
      v24 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

    if (v21)
    {
      v16 = pk_Payment_log();
      if (!os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v31 = v10;
      v22 = "Error: No message identifier for protobuf %@";
      v23 = v16;
      v24 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v23, v24, v22, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v27 = *MEMORY[0x277D85DE8];
}

uint64_t __99__NPKPaymentWebServiceCompanionTargetDevice_commutePlanReminderForCommutePlan_pass_withCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)enableServiceModeResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__NPKPaymentWebServiceCompanionTargetDevice_enableServiceModeResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v23;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __71__NPKPaymentWebServiceCompanionTargetDevice_enableServiceModeResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoEnableServiceModeResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoEnableServiceModeResponse *)v4 initWithData:v5];

    *(*(*(a1 + 56) + 8) + 24) = [(NPKProtoEnableServiceModeResponse *)v6 unlockRequired];
    if ([(NPKProtoEnableServiceModeResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 64) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)cancelOutstandingSetDefaultExpressPassRequestsWithExpressMode:(id)mode
{
  v16 = *MEMORY[0x277D85DE8];
  modeCopy = mode;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v15 = modeCopy;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Sending message to cancel outstanding set default express pass requests with mode: %@", buf, 0xCu);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_cancelOutstandingSetDefaultExpressPassRequestsWithExpressMode___block_invoke;
  v11[3] = &unk_2799454E0;
  v12 = modeCopy;
  selfCopy = self;
  v9 = modeCopy;
  dispatch_sync(internalQueue, v11);

  v10 = *MEMORY[0x277D85DE8];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_cancelOutstandingSetDefaultExpressPassRequestsWithExpressMode___block_invoke(uint64_t a1)
{
  v20[2] = *MEMORY[0x277D85DE8];
  v2 = [objc_alloc(MEMORY[0x277D37E90]) initForExpressMode:*(a1 + 32) withPassUniqueIdentifier:0 paymentApplicationIdentifier:0];
  v3 = objc_alloc_init(NPKProtoSetExpressPassRequest);
  [(NPKProtoSetExpressPassRequest *)v3 setCancelOutstandingRequests:1];
  v4 = NPKSecureArchiveObject(v2);
  [(NPKProtoSetExpressPassRequest *)v3 setExpressPassInformation:v4];

  v5 = [MEMORY[0x277CCACA8] stringWithFormat:@"SetExpressPassIdentifier-%@", *(a1 + 32)];
  v6 = objc_alloc(MEMORY[0x277D189F0]);
  v7 = [(NPKProtoSetExpressPassRequest *)v3 data];
  v8 = [v6 initWithProtobufData:v7 type:22 isResponse:0];

  v9 = *(a1 + 40);
  v10 = *MEMORY[0x277D18630];
  v19[0] = *MEMORY[0x277D185A0];
  v19[1] = v10;
  v20[0] = MEMORY[0x277CBEC38];
  v20[1] = v5;
  v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v20 forKeys:v19 count:2];
  v12 = [v9 _sendProtobuf:v8 responseExpected:0 extraOptions:v11];

  if (!v12)
  {
    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_ERROR);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v18 = v8;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
      }
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)enableServiceModeForPassWithUniqueIdentifier:(id)identifier completion:(id)completion
{
  v21 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  completionCopy = completion;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v20 = identifierCopy;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Target device: enable service mode for unique ID %@", buf, 0xCu);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_enableServiceModeForPassWithUniqueIdentifier_completion___block_invoke;
  block[3] = &unk_279945A48;
  v16 = identifierCopy;
  selfCopy = self;
  v18 = completionCopy;
  v12 = completionCopy;
  v13 = identifierCopy;
  dispatch_sync(internalQueue, block);

  v14 = *MEMORY[0x277D85DE8];
}

void __101__NPKPaymentWebServiceCompanionTargetDevice_enableServiceModeForPassWithUniqueIdentifier_completion___block_invoke(uint64_t a1)
{
  v28[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoEnableServiceModeRequest);
  [(NPKProtoEnableServiceModeRequest *)v2 setUniqueID:*(a1 + 32)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoEnableServiceModeRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:27 isResponse:0];

  v6 = *(a1 + 40);
  v7 = *MEMORY[0x277D18630];
  v27[0] = *MEMORY[0x277D185A0];
  v27[1] = v7;
  v28[0] = MEMORY[0x277CBEC38];
  v28[1] = @"EnableServiceModeIdentifier";
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];
  v9 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_enableServiceModeForPassWithUniqueIdentifier_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v9;
      v17 = "Warning: No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v5;
      v17 = "Error: No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __101__NPKPaymentWebServiceCompanionTargetDevice_enableServiceModeForPassWithUniqueIdentifier_completion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)cancelOutstandingEnableServiceModeRequests
{
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Sending message to cancel outstanding service mode requests", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __87__NPKPaymentWebServiceCompanionTargetDevice_cancelOutstandingEnableServiceModeRequests__block_invoke;
  block[3] = &unk_279944F98;
  block[4] = self;
  dispatch_sync(internalQueue, block);
}

void __87__NPKPaymentWebServiceCompanionTargetDevice_cancelOutstandingEnableServiceModeRequests__block_invoke(uint64_t a1)
{
  v17[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoEnableServiceModeRequest);
  [(NPKProtoEnableServiceModeRequest *)v2 setCancelOutstandingRequests:1];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoEnableServiceModeRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:27 isResponse:0];

  v6 = *(a1 + 32);
  v7 = *MEMORY[0x277D18630];
  v16[0] = *MEMORY[0x277D185A0];
  v16[1] = v7;
  v17[0] = MEMORY[0x277CBEC38];
  v17[1] = @"EnableServiceModeIdentifier";
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:v16 count:2];
  v9 = [v6 _sendProtobuf:v5 responseExpected:0 extraOptions:v8];

  if (!v9)
  {
    v10 = pk_Payment_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_ERROR);

    if (v11)
    {
      v12 = pk_Payment_log();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v14 = 138412290;
        v15 = v5;
        _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", &v14, 0xCu);
      }
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)remotePassUpgradeResponse:(id)response
{
  v80 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_General_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Remote update pass. Received response:%@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  if (incomingResponseIdentifier)
  {
    *&buf = 0;
    *(&buf + 1) = &buf;
    v76 = 0x3032000000;
    v77 = __Block_byref_object_copy__384;
    v78 = __Block_byref_object_dispose__385;
    v79 = 0;
    v68 = 0;
    v69 = &v68;
    v70 = 0x3032000000;
    v71 = __Block_byref_object_copy__22;
    v72 = __Block_byref_object_dispose__22;
    v73 = 0;
    v62 = 0;
    v63 = &v62;
    v64 = 0x3032000000;
    v65 = __Block_byref_object_copy__22;
    v66 = __Block_byref_object_dispose__22;
    v67 = 0;
    v58 = 0;
    v59 = &v58;
    v60 = 0x2020000000;
    v61 = 0;
    v52 = 0;
    v53 = &v52;
    v54 = 0x3032000000;
    v55 = __Block_byref_object_copy__22;
    v56 = __Block_byref_object_dispose__22;
    v57 = 0;
    v46 = 0;
    v47 = &v46;
    v48 = 0x3032000000;
    v49 = __Block_byref_object_copy__22;
    v50 = __Block_byref_object_dispose__22;
    v51 = 0;
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__NPKPaymentWebServiceCompanionTargetDevice_remotePassUpgradeResponse___block_invoke;
    block[3] = &unk_27994A030;
    block[4] = self;
    v38 = incomingResponseIdentifier;
    v39 = responseCopy;
    p_buf = &buf;
    v41 = &v58;
    v42 = &v62;
    v43 = &v68;
    v44 = &v46;
    v45 = &v52;
    dispatch_sync(internalQueue, block);

    if (*(*(&buf + 1) + 40))
    {
      if ([v53[5] count])
      {
        v10 = *(*(&buf + 1) + 40);
        v11 = v63[5];
        paymentPass = [v69[5] paymentPass];
        (*(v10 + 16))(v10, v11, paymentPass, v53[5], v59[3]);
      }

      else
      {
        paymentPass = objc_alloc_init(MEMORY[0x277CBEB58]);
        v35 = 0u;
        v36 = 0u;
        v33 = 0u;
        v34 = 0u;
        v16 = v47[5];
        v17 = [v16 countByEnumeratingWithState:&v33 objects:v74 count:16];
        if (v17)
        {
          v18 = *v34;
          do
          {
            for (i = 0; i != v17; ++i)
            {
              if (*v34 != v18)
              {
                objc_enumerationMutation(v16);
              }

              v20 = *(*(&v33 + 1) + 8 * i);
              passUniqueIdentifier = [v20 passUniqueIdentifier];
              uniqueID = [v69[5] uniqueID];
              v23 = [passUniqueIdentifier isEqualToString:uniqueID];

              if (v23)
              {
                v24 = objc_alloc(MEMORY[0x277D37E88]);
                secureElementPass = [v69[5] secureElementPass];
                v26 = [v24 initWithPassInformation:v20 forSecureElementPass:secureElementPass];
              }

              else
              {
                v26 = [objc_alloc(MEMORY[0x277D37E88]) initWithPassInformation:v20 isNFCExpressEnabled:1 isUWBExpressEnabled:0];
              }

              [paymentPass pk_safelyAddObject:v26];
            }

            v17 = [v16 countByEnumeratingWithState:&v33 objects:v74 count:16];
          }

          while (v17);
        }

        v27 = *(*(&buf + 1) + 40);
        v28 = v63[5];
        paymentPass2 = [v69[5] paymentPass];
        (*(v27 + 16))(v27, v28, paymentPass2, paymentPass, v59[3]);
      }
    }

    _Block_object_dispose(&v46, 8);
    _Block_object_dispose(&v52, 8);

    _Block_object_dispose(&v58, 8);
    _Block_object_dispose(&v62, 8);

    _Block_object_dispose(&v68, 8);
    _Block_object_dispose(&buf, 8);
  }

  else
  {
    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_ERROR);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        LOWORD(buf) = 0;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_ERROR, "Error: Remote update pass. No associated message ID in response", &buf, 2u);
      }
    }
  }

  v30 = *MEMORY[0x277D85DE8];
}

void __71__NPKPaymentWebServiceCompanionTargetDevice_remotePassUpgradeResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoRemotePassUpdateResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoRemotePassUpdateResponse *)v5 initWithData:v6];

    if ([(NPKProtoRemotePassUpdateResponse *)v7 pending])
    {
      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v11 = [*(a1 + 32) outstandingRequests];
      [v11 removeObjectForKey:*(a1 + 40)];
    }

    v12 = [v4 completionHandler];
    v13 = *(*(a1 + 56) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    v15 = [(NPKProtoRemotePassUpdateResponse *)v7 upgradeStatus];
    if (v15 <= 1)
    {
      if (v15)
      {
        if (v15 == 1)
        {
          *(*(*(a1 + 64) + 8) + 24) = 0;
        }
      }

      else
      {
        v18 = *(*(a1 + 56) + 8);
        v19 = *(v18 + 40);
        *(v18 + 40) = 0;
      }

      goto LABEL_19;
    }

    if (v15 == 2)
    {
      v16 = *(*(a1 + 64) + 8);
      v17 = 1;
    }

    else
    {
      if (v15 != 3)
      {
LABEL_19:
        v20 = [(NPKProtoRemotePassUpdateResponse *)v7 hasErrorData];
        if (v20)
        {
          v1 = [(NPKProtoRemotePassUpdateResponse *)v7 errorData];
          v21 = objc_opt_class();
          v22 = NPKSecureUnarchiveObject(v1, v21);
        }

        else
        {
          v22 = 0;
        }

        objc_storeStrong((*(*(a1 + 72) + 8) + 40), v22);
        if (v20)
        {
        }

        v23 = [(NPKProtoRemotePassUpdateResponse *)v7 pass];
        v24 = [v23 passData];
        v25 = objc_opt_class();
        v26 = NPKSecureUnarchiveObject(v24, v25);
        v27 = *(*(a1 + 80) + 8);
        v28 = *(v27 + 40);
        *(v27 + 40) = v26;

        v29 = *(a1 + 32);
        v30 = [(NPKProtoRemotePassUpdateResponse *)v7 expressPassInformations];
        v31 = [v29 _expressPassesInformationFromDataArray:v30];
        v32 = *(*(a1 + 88) + 8);
        v33 = *(v32 + 40);
        *(v32 + 40) = v31;

        v34 = *(a1 + 32);
        v35 = [(NPKProtoRemotePassUpdateResponse *)v7 expressPassConfigurations];
        v36 = [v34 _expressPassesConfigurationFromDataArray:v35];
        v37 = *(*(a1 + 96) + 8);
        v38 = *(v37 + 40);
        *(v37 + 40) = v36;

        goto LABEL_25;
      }

      v16 = *(*(a1 + 64) + 8);
      v17 = 2;
    }

    *(v16 + 24) = v17;
    goto LABEL_19;
  }

  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v39[0] = 0;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: Remote update pass. Got response with no associated message handler", v39, 2u);
    }
  }

LABEL_25:
}

- (void)remotePassUpgradeWithRequest:(id)request pass:(id)pass requireAuthorization:(BOOL)authorization notifyUserOnPairedDevice:(BOOL)device updateBlock:(id)block
{
  requestCopy = request;
  passCopy = pass;
  blockCopy = block;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __137__NPKPaymentWebServiceCompanionTargetDevice_remotePassUpgradeWithRequest_pass_requireAuthorization_notifyUserOnPairedDevice_updateBlock___block_invoke;
  block[3] = &unk_27994A058;
  v20 = passCopy;
  v21 = requestCopy;
  authorizationCopy = authorization;
  deviceCopy = device;
  selfCopy = self;
  v23 = blockCopy;
  v16 = blockCopy;
  v17 = requestCopy;
  v18 = passCopy;
  dispatch_sync(internalQueue, block);
}

void __137__NPKPaymentWebServiceCompanionTargetDevice_remotePassUpgradeWithRequest_pass_requireAuthorization_notifyUserOnPairedDevice_updateBlock___block_invoke(uint64_t a1)
{
  v34[2] = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = [*(a1 + 32) uniqueID];
      *buf = 138412290;
      v30 = v5;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Remote update pass with uniqueID:%@. Sending message", buf, 0xCu);
    }
  }

  v6 = objc_alloc_init(NPKProtoPass);
  [*(a1 + 32) flushLoadedImageSets];
  v7 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoPass *)v6 setPassData:v7];

  v8 = objc_alloc_init(NPKProtoRemotePassUpdateRequest);
  v9 = [*(a1 + 32) uniqueID];
  [(NPKProtoRemotePassUpdateRequest *)v8 setPassID:v9];

  [(NPKProtoRemotePassUpdateRequest *)v8 setPass:v6];
  v10 = NPKSecureArchiveObject(*(a1 + 40));
  [(NPKProtoRemotePassUpdateRequest *)v8 setUpdateRequestData:v10];

  [(NPKProtoRemotePassUpdateRequest *)v8 setRequestAuthorization:*(a1 + 64)];
  [(NPKProtoRemotePassUpdateRequest *)v8 setShouldNotifyUser:*(a1 + 65)];
  v11 = objc_alloc(MEMORY[0x277D189F0]);
  v12 = [(NPKProtoRemotePassUpdateRequest *)v8 data];
  v13 = [v11 initWithProtobufData:v12 type:50 isResponse:0];

  v14 = *(a1 + 48);
  v15 = *MEMORY[0x277D185D0];
  v33[0] = *MEMORY[0x277D18630];
  v33[1] = v15;
  v34[0] = @"remotePassUpdate";
  v34[1] = MEMORY[0x277CBEC38];
  v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v34 forKeys:v33 count:2];
  v17 = [v14 _sendProtobuf:v13 responseExpected:1 extraOptions:v16];

  if (!v17)
  {
    v22 = pk_Payment_log();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

    if (!v23)
    {
      goto LABEL_12;
    }

    v21 = pk_Payment_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v24 = [*(a1 + 32) uniqueID];
      *buf = 138412546;
      v30 = v24;
      v31 = 2112;
      v32 = v13;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_ERROR, "Error: Remote update pass with uniqueID:%@. No message identifier for protobuf %@", buf, 0x16u);
    }

    goto LABEL_8;
  }

  v18 = *(a1 + 56);
  if (v18)
  {
    v19 = *(a1 + 48);
    v20 = _Block_copy(v18);
    v26[0] = MEMORY[0x277D85DD0];
    v26[1] = 3221225472;
    v26[2] = __137__NPKPaymentWebServiceCompanionTargetDevice_remotePassUpgradeWithRequest_pass_requireAuthorization_notifyUserOnPairedDevice_updateBlock___block_invoke_553;
    v26[3] = &unk_279947DC0;
    v28 = *(a1 + 56);
    v27 = *(a1 + 32);
    [v19 _trackOutstandingRequestWithMessageIdentifier:v17 completionHandler:v20 errorHandler:v26];

    v21 = v28;
LABEL_8:
  }

LABEL_12:

  v25 = *MEMORY[0x277D85DE8];
}

- (void)cancelOutstandingRemotePassUpdateRequest:(id)request pass:(id)pass
{
  v22 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  passCopy = pass;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      uniqueID = [passCopy uniqueID];
      *buf = 138412290;
      v21 = uniqueID;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Sending message to cancel outstanding remote pass Update Reques for pass UniqueID:%@", buf, 0xCu);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_cancelOutstandingRemotePassUpdateRequest_pass___block_invoke;
  block[3] = &unk_279945880;
  v17 = passCopy;
  v18 = requestCopy;
  selfCopy = self;
  v13 = requestCopy;
  v14 = passCopy;
  dispatch_sync(internalQueue, block);

  v15 = *MEMORY[0x277D85DE8];
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_cancelOutstandingRemotePassUpdateRequest_pass___block_invoke(uint64_t a1)
{
  v19[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoRemotePassUpdateRequest);
  v3 = [*(a1 + 32) uniqueID];
  [(NPKProtoRemotePassUpdateRequest *)v2 setPassID:v3];

  v4 = NPKSecureArchiveObject(*(a1 + 40));
  [(NPKProtoRemotePassUpdateRequest *)v2 setUpdateRequestData:v4];

  [(NPKProtoRemotePassUpdateRequest *)v2 setCancelUpdate:1];
  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [(NPKProtoRemotePassUpdateRequest *)v2 data];
  v7 = [v5 initWithProtobufData:v6 type:50 isResponse:0];

  v8 = *(a1 + 48);
  v9 = *MEMORY[0x277D18630];
  v18[0] = *MEMORY[0x277D185A0];
  v18[1] = v9;
  v19[0] = MEMORY[0x277CBEC38];
  v19[1] = @"remotePassUpdate";
  v10 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v19 forKeys:v18 count:2];
  v11 = [v8 _sendProtobuf:v7 responseExpected:0 extraOptions:v10];

  if (!v11)
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        v16 = 138412290;
        v17 = v7;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", &v16, 0xCu);
      }
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)peerPaymentRegisterResponse:(id)response
{
  v53 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Peer payment register: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v49 = 0x3032000000;
  v50 = __Block_byref_object_copy__384;
  v51 = __Block_byref_object_dispose__385;
  v52 = 0;
  v44 = 0;
  v45 = &v44;
  v46 = 0x2020000000;
  v47 = 0;
  v38 = 0;
  v39 = &v38;
  v40 = 0x3032000000;
  v41 = __Block_byref_object_copy__22;
  v42 = __Block_byref_object_dispose__22;
  v43 = 0;
  v32 = 0;
  v33 = &v32;
  v34 = 0x3032000000;
  v35 = __Block_byref_object_copy__22;
  v36 = __Block_byref_object_dispose__22;
  v37 = 0;
  v26 = 0;
  v27 = &v26;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__22;
  v30 = __Block_byref_object_dispose__22;
  v31 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __73__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentRegisterResponse___block_invoke;
    block[3] = &unk_27994A080;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v44;
    v23 = &v38;
    v24 = &v32;
    v25 = &v26;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v45 + 24), v39[5], v33[5], v27[5]);
  }

  _Block_object_dispose(&v26, 8);

  _Block_object_dispose(&v32, 8);
  _Block_object_dispose(&v38, 8);

  _Block_object_dispose(&v44, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __73__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentRegisterResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoPeerPaymentRegistrationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoPeerPaymentRegistrationResponse *)v5 initWithData:v6];

    if ([(NPKProtoPeerPaymentRegistrationResponse *)v7 pending])
    {
      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v11 = [*(a1 + 32) outstandingRequests];
      [v11 removeObjectForKey:*(a1 + 40)];

      v12 = [v4 completionHandler];
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoPeerPaymentRegistrationResponse *)v7 success];
      v15 = [(NPKProtoPeerPaymentRegistrationResponse *)v7 hasErrorData];
      if (v15)
      {
        v1 = [(NPKProtoPeerPaymentRegistrationResponse *)v7 errorData];
        v16 = objc_opt_class();
        v17 = NPKSecureUnarchiveObject(v1, v16);
      }

      else
      {
        v17 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
      if (v15)
      {
      }

      v18 = [(NPKProtoPeerPaymentRegistrationResponse *)v7 peerPaymentWebServiceContextData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v18, v19);
      v21 = *(*(a1 + 80) + 8);
      v22 = *(v21 + 40);
      *(v21 + 40) = v20;

      v23 = [(NPKProtoPeerPaymentRegistrationResponse *)v7 peerPaymentAccountData];
      v24 = objc_opt_class();
      v25 = NPKSecureUnarchiveObject(v23, v24);
      v26 = *(*(a1 + 88) + 8);
      v27 = *(v26 + 40);
      *(v26 + 40) = v25;
    }
  }

  else
  {
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v28[0] = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v28, 2u);
      }
    }
  }
}

- (void)peerPaymentRegisterWithURL:(id)l forceReRegistration:(BOOL)registration completion:(id)completion
{
  registrationCopy = registration;
  v26 = *MEMORY[0x277D85DE8];
  lCopy = l;
  completionCopy = completion;
  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412546;
      v23 = lCopy;
      v24 = 1024;
      v25 = registrationCopy;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Peer payment register with URL %@ forceReRegistration %i", buf, 0x12u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __103__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentRegisterWithURL_forceReRegistration_completion___block_invoke;
  v17[3] = &unk_27994A0A8;
  v21 = registrationCopy;
  v18 = lCopy;
  selfCopy = self;
  v20 = completionCopy;
  v14 = completionCopy;
  v15 = lCopy;
  dispatch_sync(internalQueue, v17);

  v16 = *MEMORY[0x277D85DE8];
}

void __103__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentRegisterWithURL_forceReRegistration_completion___block_invoke(uint64_t a1)
{
  v28[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoPeerPaymentRegistrationRequest);
  v3 = [*(a1 + 32) absoluteString];
  [(NPKProtoPeerPaymentRegistrationRequest *)v2 setServiceURL:v3];

  [(NPKProtoPeerPaymentRegistrationRequest *)v2 setForceReRegistration:*(a1 + 56)];
  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoPeerPaymentRegistrationRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:31 isResponse:0];

  v7 = *(a1 + 40);
  v27 = *MEMORY[0x277D185A0];
  v28[0] = MEMORY[0x277CBEC38];
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __103__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentRegisterWithURL_forceReRegistration_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v9;
      v17 = "Warning: No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v6;
      v17 = "Error: No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __103__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentRegisterWithURL_forceReRegistration_completion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2, 0, 0);
  }

  return result;
}

- (void)peerPaymentUnregisterResponse:(id)response
{
  v46 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device peer payment unregister: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v42 = 0x3032000000;
  v43 = __Block_byref_object_copy__384;
  v44 = __Block_byref_object_dispose__385;
  v45 = 0;
  v37 = 0;
  v38 = &v37;
  v39 = 0x2020000000;
  v40 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x3032000000;
  v34 = __Block_byref_object_copy__22;
  v35 = __Block_byref_object_dispose__22;
  v36 = 0;
  v25 = 0;
  v26 = &v25;
  v27 = 0x3032000000;
  v28 = __Block_byref_object_copy__22;
  v29 = __Block_byref_object_dispose__22;
  v30 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __75__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentUnregisterResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v37;
    v23 = &v31;
    v24 = &v25;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v38 + 24), v32[5], v26[5], 0);
  }

  _Block_object_dispose(&v25, 8);

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v37, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __75__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentUnregisterResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoPeerPaymentUnregistrationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoPeerPaymentUnregistrationResponse *)v5 initWithData:v6];

    if ([(NPKProtoPeerPaymentUnregistrationResponse *)v7 pending])
    {
      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v11 = [*(a1 + 32) outstandingRequests];
      [v11 removeObjectForKey:*(a1 + 40)];

      v12 = [v4 completionHandler];
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoPeerPaymentUnregistrationResponse *)v7 success];
      v15 = [(NPKProtoPeerPaymentUnregistrationResponse *)v7 hasErrorData];
      if (v15)
      {
        v1 = [(NPKProtoPeerPaymentUnregistrationResponse *)v7 errorData];
        v16 = objc_opt_class();
        v17 = NPKSecureUnarchiveObject(v1, v16);
      }

      else
      {
        v17 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
      if (v15)
      {
      }

      v18 = [(NPKProtoPeerPaymentUnregistrationResponse *)v7 peerPaymentWebServiceContextData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v18, v19);
      v21 = *(*(a1 + 80) + 8);
      v22 = *(v21 + 40);
      *(v21 + 40) = v20;
    }
  }

  else
  {
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v23[0] = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v23, 2u);
      }
    }
  }
}

- (void)peerPaymentUnregisterWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device peer payment unregister", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __81__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentUnregisterWithCompletion___block_invoke;
  v10[3] = &unk_279945530;
  v10[4] = self;
  v11 = completionCopy;
  v9 = completionCopy;
  dispatch_sync(internalQueue, v10);
}

void __81__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentUnregisterWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoPeerPaymentUnregistrationRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoPeerPaymentUnregistrationRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:32 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __81__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentUnregisterWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __81__NPKPaymentWebServiceCompanionTargetDevice_peerPaymentUnregisterWithCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2, 0, 0);
  }

  return result;
}

- (void)provisionPeerPaymentPassResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device provision peer payment pass: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x2020000000;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__NPKPaymentWebServiceCompanionTargetDevice_provisionPeerPaymentPassResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v31 + 24), v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __78__NPKPaymentWebServiceCompanionTargetDevice_provisionPeerPaymentPassResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoProvisionPeerPaymentPassResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoProvisionPeerPaymentPassResponse *)v4 initWithData:v5];

    if ([(NPKProtoProvisionPeerPaymentPassResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;

      *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoProvisionPeerPaymentPassResponse *)v6 success];
      v14 = [(NPKProtoProvisionPeerPaymentPassResponse *)v6 errorData];
      v15 = MEMORY[0x277CBEB98];
      v16 = objc_opt_class();
      v17 = [v15 setWithObjects:{v16, objc_opt_class(), 0}];
      v18 = NPKSecureUnarchiveObjectOfClasses(v14, v17);
      v19 = *(*(a1 + 72) + 8);
      v20 = *(v19 + 40);
      *(v19 + 40) = v18;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", buf, 2u);
      }
    }
  }
}

- (void)provisionPeerPaymentPassWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device provision peer payment pass", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_provisionPeerPaymentPassWithCompletion___block_invoke;
  v10[3] = &unk_279945530;
  v10[4] = self;
  v11 = completionCopy;
  v9 = completionCopy;
  dispatch_sync(internalQueue, v10);
}

void __84__NPKPaymentWebServiceCompanionTargetDevice_provisionPeerPaymentPassWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoProvisionPeerPaymentPassRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoProvisionPeerPaymentPassRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:34 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_provisionPeerPaymentPassWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __84__NPKPaymentWebServiceCompanionTargetDevice_provisionPeerPaymentPassWithCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)updatePeerPaymentAccountResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device update peer payment account: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__NPKPaymentWebServiceCompanionTargetDevice_updatePeerPaymentAccountResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __78__NPKPaymentWebServiceCompanionTargetDevice_updatePeerPaymentAccountResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoUpdatePeerPaymentAccountResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoUpdatePeerPaymentAccountResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = [(NPKProtoUpdatePeerPaymentAccountResponse *)v6 peerPaymentAccountData];
    v12 = objc_opt_class();
    v13 = NPKSecureUnarchiveObject(v11, v12);
    v14 = *(*(a1 + 64) + 8);
    v15 = *(v14 + 40);
    *(v14 + 40) = v13;
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

    if (v17)
    {
      v18 = pk_Payment_log();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        *v19 = 0;
        _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
      }
    }
  }
}

- (void)updatePeerPaymentAccountWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device update peer payment account with completion", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_updatePeerPaymentAccountWithCompletion___block_invoke;
  v10[3] = &unk_279945530;
  v10[4] = self;
  v11 = completionCopy;
  v9 = completionCopy;
  dispatch_sync(internalQueue, v10);
}

void __84__NPKPaymentWebServiceCompanionTargetDevice_updatePeerPaymentAccountWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoUpdatePeerPaymentAccountRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoUpdatePeerPaymentAccountRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:48 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_updatePeerPaymentAccountWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __84__NPKPaymentWebServiceCompanionTargetDevice_updatePeerPaymentAccountWithCompletion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)setPeerPaymentPreferencesResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device update peer payment preferences: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __79__NPKPaymentWebServiceCompanionTargetDevice_setPeerPaymentPreferencesResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __79__NPKPaymentWebServiceCompanionTargetDevice_setPeerPaymentPreferencesResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoSetPeerPaymentPreferencesResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoSetPeerPaymentPreferencesResponse *)v5 initWithData:v6];

    if ([v7 pending])
    {
      v8 = pk_Payment_log();
      v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

      if (v9)
      {
        v10 = pk_Payment_log();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: got pending response for update peer payment preferences.", buf, 2u);
        }
      }

      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v13 = [*(a1 + 32) outstandingRequests];
      [v13 removeObjectForKey:*(a1 + 40)];

      v14 = [v4 completionHandler];
      v15 = *(*(a1 + 56) + 8);
      v16 = *(v15 + 40);
      *(v15 + 40) = v14;

      v17 = [v7 peerPaymentPreferencesData];
      v18 = objc_opt_class();
      v19 = NPKSecureUnarchiveObject(v17, v18);
      v20 = *(*(a1 + 64) + 8);
      v21 = *(v20 + 40);
      *(v20 + 40) = v19;

      v22 = [v7 hasErrorData];
      if (v22)
      {
        v1 = [v7 errorData];
        v23 = objc_opt_class();
        v24 = NPKSecureUnarchiveObject(v1, v23);
      }

      else
      {
        v24 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v24);
      if (v22)
      {
      }
    }

LABEL_16:

    goto LABEL_17;
  }

  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *v25 = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v25, 2u);
    }

    goto LABEL_16;
  }

LABEL_17:
}

- (void)setPeerPaymentPreferences:(id)preferences completion:(id)completion
{
  preferencesCopy = preferences;
  completionCopy = completion;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Target device set peer payment preferences with completion", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __82__NPKPaymentWebServiceCompanionTargetDevice_setPeerPaymentPreferences_completion___block_invoke;
  block[3] = &unk_279945A48;
  v15 = preferencesCopy;
  selfCopy = self;
  v17 = completionCopy;
  v12 = completionCopy;
  v13 = preferencesCopy;
  dispatch_sync(internalQueue, block);
}

void __82__NPKPaymentWebServiceCompanionTargetDevice_setPeerPaymentPreferences_completion___block_invoke(uint64_t a1)
{
  v32[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSetPeerPaymentPreferencesRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoSetPeerPaymentPreferencesRequest *)v2 setPeerPaymentPreferencesData:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoSetPeerPaymentPreferencesRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:88 isResponse:0];

  v7 = *(a1 + 40);
  v31 = *MEMORY[0x277D185A0];
  v32[0] = MEMORY[0x277CBEC38];
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v32 forKeys:&v31 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      v23 = MEMORY[0x277D85DD0];
      v24 = 3221225472;
      v25 = __82__NPKPaymentWebServiceCompanionTargetDevice_setPeerPaymentPreferences_completion___block_invoke_2;
      v26 = &unk_279947DC0;
      v28 = *(a1 + 48);
      v27 = *(a1 + 32);
      v12 = _Block_copy(&v23);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:{v12, v23, v24, v25, v26}];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v30 = v9;
      v17 = "Warning: No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v30 = v6;
      v17 = "Error: No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __82__NPKPaymentWebServiceCompanionTargetDevice_setPeerPaymentPreferences_completion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 40);
  if (result)
  {
    return (*(result + 16))(result, *(a1 + 32), a2);
  }

  return result;
}

- (void)openURLWithRequest:(id)request
{
  v27 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Requested to Open URL", buf, 2u);
    }
  }

  v8 = [NPKProtoOpenURLRequest alloc];
  data = [requestCopy data];

  v10 = [(NPKProtoOpenURLRequest *)v8 initWithData:data];
  v11 = MEMORY[0x277CBEBC0];
  urlString = [(NPKProtoOpenURLRequest *)v10 urlString];
  v13 = [v11 URLWithString:urlString];

  v14 = [MEMORY[0x277CCACE0] componentsWithURL:v13 resolvingAgainstBaseURL:0];
  scheme = [v14 scheme];
  v16 = [scheme isEqualToString:@"tap-to-radar"];

  if (v16)
  {
    v17 = [[NPKTapToRadarRequest alloc] initWithURL:v13];
    manager = [(NPKPaymentWebServiceCompanionTargetDevice *)self manager];
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __64__NPKPaymentWebServiceCompanionTargetDevice_openURLWithRequest___block_invoke;
    v23[3] = &unk_279945058;
    v24 = v17;
    v19 = v17;
    [manager fileRadarWithRequest:v19 requestUserPermission:0 completion:v23];
  }

  else
  {
    v20 = pk_General_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (!v21)
    {
      goto LABEL_11;
    }

    v19 = pk_General_log();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v26 = v13;
      _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Warning: Failed to open URL:%@", buf, 0xCu);
    }
  }

LABEL_11:
  v22 = *MEMORY[0x277D85DE8];
}

void __64__NPKPaymentWebServiceCompanionTargetDevice_openURLWithRequest___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v7 = *(a1 + 32);
      v9 = 138412546;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Filed radar with request:%@  error:%@", &v9, 0x16u);
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (NPKTapToRadarManager)manager
{
  manager = self->_manager;
  if (!manager)
  {
    v4 = objc_alloc_init(NPKTapToRadarManager);
    v5 = self->_manager;
    self->_manager = v4;

    manager = self->_manager;
  }

  return manager;
}

- (void)handlePeerPaymentTermsAndConditionsAcceptanceRequest:(id)request
{
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v8 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Companion received handlePeerPaymentTermsAndConditionsAcceptanceRequest: message", v8, 2u);
    }
  }

  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  [companionAgentConnection handlePeerPaymentTermsAndConditionsRequestFromGizmo];
}

- (void)handleDeviceUnlockedForPendingProvisioningRequest:(id)request
{
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v8 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Companion received handleDeviceUnlockedForPendingProvisioningRequest: message", v8, 2u);
    }
  }

  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  [companionAgentConnection handleDeviceUnlockedForPendingProvisioningRequestFromGizmo];
}

- (BOOL)paymentWebServiceSupportsAccounts:(id)accounts
{
  v30 = *MEMORY[0x277D85DE8];
  accountsCopy = accounts;
  if ([accountsCopy needsRegistration])
  {
    v5 = pk_Payment_log();
    v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

    v7 = 0;
    if (v6)
    {
      v8 = pk_Payment_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        v22 = 67109120;
        v23 = 0;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Payment web service supports accounts = %d, webService needs registration", &v22, 8u);
      }

      v7 = 0;
LABEL_9:
    }
  }

  else
  {
    context = [accountsCopy context];
    primaryRegion = [context primaryRegion];
    accountServiceURL = [primaryRegion accountServiceURL];

    context2 = [accountsCopy context];
    primaryRegion2 = [context2 primaryRegion];
    hasAccounts = [primaryRegion2 hasAccounts];

    context3 = [accountsCopy context];
    configuration = [context3 configuration];
    deviceRegion = [(NPKPaymentWebServiceCompanionTargetDevice *)self deviceRegion];
    v18 = [configuration accountServiceEnabledForRegion:deviceRegion];

    v7 = (hasAccounts | v18) & (accountServiceURL != 0);
    v19 = pk_Payment_log();
    LODWORD(configuration) = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (configuration)
    {
      v8 = pk_Payment_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        v22 = 67109888;
        v23 = (hasAccounts | v18) & (accountServiceURL != 0);
        v24 = 1024;
        v25 = hasAccounts;
        v26 = 1024;
        v27 = v18 & 1;
        v28 = 1024;
        v29 = accountServiceURL != 0;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Payment web service supports accounts = %d, hasAccount: %d, regionEnabled: %d, hasURL: %d", &v22, 0x1Au);
      }

      goto LABEL_9;
    }
  }

  v20 = *MEMORY[0x277D85DE8];
  return v7;
}

- (void)updatedAccountsForProvisioningWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target device updatedAccountsForProvisioningWithCompletion", buf, 2u);
    }
  }

  if (completionCopy)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke;
    v9[3] = &unk_279945530;
    v9[4] = self;
    v10 = completionCopy;
    dispatch_async(internalQueue, v9);
  }
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke(uint64_t a1)
{
  v46 = *MEMORY[0x277D85DE8];
  v1 = pk_Payment_log();
  v2 = os_log_type_enabled(v1, OS_LOG_TYPE_DEFAULT);

  if (v2)
  {
    v3 = pk_Payment_log();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v3, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) performing accountsWithRequest", buf, 2u);
    }
  }

  *buf = 0;
  v40 = buf;
  v41 = 0x3032000000;
  v42 = __Block_byref_object_copy__22;
  v43 = __Block_byref_object_dispose__22;
  v44 = 0;
  v4 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v24 = objc_alloc_init(MEMORY[0x277D37DB0]);
  v5 = [*(a1 + 32) companionAgentConnection];
  v6 = [v5 watchPaymentWebService];
  v7 = [v6 context];
  v8 = [v7 regions];

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v9 = v8;
  v10 = [v9 countByEnumeratingWithState:&v35 objects:v45 count:16];
  if (v10)
  {
    v11 = *v36;
    do
    {
      v12 = 0;
      do
      {
        if (*v36 != v11)
        {
          objc_enumerationMutation(v9);
        }

        v13 = [v9 objectForKey:*(*(&v35 + 1) + 8 * v12)];
        v14 = [v13 accountServiceURL];
        v15 = v14 == 0;

        if (!v15)
        {
          v30[0] = MEMORY[0x277D85DD0];
          v30[1] = 3221225472;
          v30[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke_574;
          v30[3] = &unk_27994A0F8;
          v16 = v13;
          v17 = *(a1 + 32);
          v31 = v16;
          v32 = v17;
          v34 = buf;
          v33 = v4;
          [v24 addOperation:v30];
        }

        ++v12;
      }

      while (v10 != v12);
      v10 = [v9 countByEnumeratingWithState:&v35 objects:v45 count:16];
    }

    while (v10);
  }

  v18 = [MEMORY[0x277CBEB68] null];
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke_3;
  v26[3] = &unk_27994A120;
  v19 = *(a1 + 32);
  v20 = *(a1 + 40);
  v29 = buf;
  v26[4] = v19;
  v28 = v20;
  v21 = v4;
  v27 = v21;
  v22 = [v24 evaluateWithInput:v18 completion:v26];

  _Block_object_dispose(buf, 8);
  v23 = *MEMORY[0x277D85DE8];
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke_574(uint64_t a1, uint64_t a2, void *a3, void *a4)
{
  v6 = a3;
  v7 = a4;
  v8 = objc_alloc_init(MEMORY[0x277D37CE0]);
  v9 = [*(a1 + 32) accountServiceURL];
  [v8 setAccountServicesURL:v9];

  v10 = [*(a1 + 40) companionAgentConnection];
  v11 = [v10 watchPaymentWebService];
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke_2;
  v16[3] = &unk_27994A0D0;
  v13 = *(a1 + 48);
  v12 = *(a1 + 56);
  v19 = v7;
  v20 = v12;
  v17 = v6;
  v18 = v13;
  v14 = v6;
  v15 = v7;
  [v11 accountsWithRequest:v8 completion:v16];
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke_2(void *a1, void *a2, void *a3)
{
  v5 = a3;
  v11 = v5;
  if (v5)
  {
    v6 = *(a1[7] + 8);
    v7 = v5;
    v8 = *(v6 + 40);
    *(v6 + 40) = v7;
  }

  else
  {
    v9 = a1[5];
    v8 = [a2 accounts];
    [v9 addObjectsFromArray:v8];
  }

  v10 = a1[4];
  (*(a1[6] + 16))();
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke_3(uint64_t a1, uint64_t a2, void *a3, void *a4)
{
  v73 = *MEMORY[0x277D85DE8];
  v49 = a3;
  v50 = a4;
  if (*(*(*(a1 + 56) + 8) + 40))
  {
    v6 = a1;
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        v10 = *(*(*(v6 + 56) + 8) + 40);
        *buf = 138412290;
        *&buf[4] = v10;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) error executing accountsWithRequest %@", buf, 0xCu);
      }
    }

    v11 = [*(v6 + 32) companionAgentConnection];
    v12 = [v11 watchPaymentWebService];
    v13 = [v12 context];

    v14 = [v13 primaryRegion];
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18 = [v14 accountServiceURL];
        *buf = 138412802;
        *&buf[4] = v13;
        *&buf[12] = 2112;
        *&buf[14] = v14;
        *&buf[22] = 2112;
        v70 = v18;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) context %@ primaryRegion %@ accountServiceURL %@", buf, 0x20u);
      }
    }

    v19 = dispatch_get_global_queue(0, 0);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke_579;
    block[3] = &unk_279945198;
    v63 = *(v6 + 48);
    dispatch_async(v19, block);

    goto LABEL_42;
  }

  v52 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v51 = objc_alloc_init(MEMORY[0x277CBEB18]);
  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v70 = __Block_byref_object_copy__22;
  v71 = __Block_byref_object_dispose__22;
  v72 = 0;
  v48 = [*(a1 + 32) companionAgentConnection];
  v61[0] = MEMORY[0x277D85DD0];
  v61[1] = 3221225472;
  v61[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke_2_580;
  v61[3] = &unk_279949AB8;
  v61[4] = buf;
  [v48 paymentPassUniqueIDsSynchronous:1 reply:v61];
  v59 = 0u;
  v60 = 0u;
  v57 = 0u;
  v58 = 0u;
  v20 = *(a1 + 40);
  v21 = [v20 countByEnumeratingWithState:&v57 objects:v68 count:16];
  v47 = a1;
  if (!v21)
  {
    goto LABEL_37;
  }

  v22 = *v58;
  do
  {
    for (i = 0; i != v21; ++i)
    {
      if (*v58 != v22)
      {
        objc_enumerationMutation(v20);
      }

      v24 = *(*(&v57 + 1) + 8 * i);
      v25 = [v24 state];
      [v24 state];
      v26 = PKAccountStateToString();
      if (([v24 provisioningAllowed] & 1) == 0)
      {
        v32 = PKLogFacilityTypeGetObject();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
        {
          v33 = [v24 accountIdentifier];
          *v64 = 138412546;
          v65 = v33;
          v66 = 2112;
          v67 = v26;
          _os_log_impl(&dword_25B300000, v32, OS_LOG_TYPE_DEFAULT, "(account-pass-provisioning) Account: %@ with state: %@ does not allow provisioning and will not be offered", v64, 0x16u);
        }

        goto LABEL_34;
      }

      if ((v25 - 1) < 4)
      {
        v27 = *(*&buf[8] + 40);
        v28 = [v24 associatedPassUniqueID];
        LODWORD(v27) = [v27 containsObject:v28];

        v29 = PKLogFacilityTypeGetObject();
        v30 = os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT);
        if (v27)
        {
          if (v30)
          {
            v31 = [v24 accountIdentifier];
            *v64 = 138412546;
            v65 = v31;
            v66 = 2112;
            v67 = v26;
            _os_log_impl(&dword_25B300000, v29, OS_LOG_TYPE_DEFAULT, "(account-pass-provisioning) Account: %@ with state: %@ is on device", v64, 0x16u);
          }

          v32 = [v24 copy];
          [v51 addObject:v32];
        }

        else
        {
          if (v30)
          {
            v36 = [v24 accountIdentifier];
            *v64 = 138412546;
            v65 = v36;
            v66 = 2112;
            v67 = v26;
            _os_log_impl(&dword_25B300000, v29, OS_LOG_TYPE_DEFAULT, "(account-pass-provisioning) Account: %@ with state: %@ is valid for provisioning", v64, 0x16u);
          }

          v32 = [v24 copy];
          [v52 addObject:v32];
        }

LABEL_34:

        goto LABEL_35;
      }

      if (v25)
      {
        v34 = v25 == 5;
      }

      else
      {
        v34 = 1;
      }

      if (v34)
      {
        v32 = PKLogFacilityTypeGetObject();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
        {
          v35 = [v24 accountIdentifier];
          *v64 = 138412546;
          v65 = v35;
          v66 = 2112;
          v67 = v26;
          _os_log_impl(&dword_25B300000, v32, OS_LOG_TYPE_DEFAULT, "(account-pass-provisioning) Account: %@ with state: %@ is not valid for provisioning", v64, 0x16u);
        }

        goto LABEL_34;
      }

LABEL_35:
    }

    v21 = [v20 countByEnumeratingWithState:&v57 objects:v68 count:16];
  }

  while (v21);
LABEL_37:

  v37 = pk_General_log();
  v38 = os_log_type_enabled(v37, OS_LOG_TYPE_DEFAULT);

  if (v38)
  {
    v39 = pk_General_log();
    if (os_log_type_enabled(v39, OS_LOG_TYPE_DEFAULT))
    {
      v40 = [v52 count];
      v41 = [v51 count];
      *v64 = 134218240;
      v65 = v40;
      v66 = 2048;
      v67 = v41;
      _os_log_impl(&dword_25B300000, v39, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning)updatedAccountsForProvisioningWithCompletion found %lu accounts requiring provision and %lu on device ", v64, 0x16u);
    }
  }

  v42 = dispatch_get_global_queue(0, 0);
  v53[0] = MEMORY[0x277D85DD0];
  v53[1] = 3221225472;
  v53[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_updatedAccountsForProvisioningWithCompletion___block_invoke_581;
  v53[3] = &unk_279946780;
  v43 = *(v47 + 48);
  v54 = v52;
  v55 = v51;
  v56 = v43;
  v44 = v51;
  v45 = v52;
  dispatch_async(v42, v53);

  _Block_object_dispose(buf, 8);
LABEL_42:

  v46 = *MEMORY[0x277D85DE8];
}

- (void)triggerCloudStoreZoneCreationForAccountResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: (apple-balance-pass-provisioning) Target device triggerCloudStoreZoneCreationForAccount: incoming protobuf: %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __93__NPKPaymentWebServiceCompanionTargetDevice_triggerCloudStoreZoneCreationForAccountResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: (apple-balance-pass-provisioning) No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __93__NPKPaymentWebServiceCompanionTargetDevice_triggerCloudStoreZoneCreationForAccountResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoTriggerCloudStoreZoneCreationForAccountResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoTriggerCloudStoreZoneCreationForAccountResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoTriggerCloudStoreZoneCreationForAccountResponse *)v6 success];
  }

  else
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: (apple-balance-pass-provisioning) got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)triggerCloudStoreZoneCreationForAccount:(id)account withCompletion:(id)completion
{
  v27 = *MEMORY[0x277D85DE8];
  accountCopy = account;
  completionCopy = completion;
  v8 = NPKPairedOrPairingDeviceSupportsAppleBalance();
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = @"NO";
      if (v8)
      {
        v12 = @"YES";
      }

      *buf = 138412290;
      v26 = v12;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: (apple-balance-pass-provisioning) Target device triggerCloudStoreZoneCreationForAccount. Apple Balance card supported by device: %@", buf, 0xCu);
    }
  }

  if ((v8 & 1) == 0)
  {
    v14 = pk_General_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

    if (!v15)
    {
      goto LABEL_18;
    }

    v16 = pk_General_log();
    if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
      goto LABEL_17;
    }

    *buf = 0;
    v17 = "Notice: (apple-balance-pass-provisioning) triggerCloudStoreZoneCreationForAccount: Called on device with no support for Apple Balance card.";
    goto LABEL_16;
  }

  if (accountCopy)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_triggerCloudStoreZoneCreationForAccount_withCompletion___block_invoke;
    block[3] = &unk_279945A48;
    v22 = accountCopy;
    selfCopy = self;
    v24 = completionCopy;
    dispatch_sync(internalQueue, block);

    goto LABEL_20;
  }

  v18 = pk_General_log();
  v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

  if (v19)
  {
    v16 = pk_General_log();
    if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
LABEL_17:

      goto LABEL_18;
    }

    *buf = 0;
    v17 = "Notice: (apple-balance-pass-provisioning) triggerCloudStoreZoneCreationForAccount: Called with no account";
LABEL_16:
    _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, v17, buf, 2u);
    goto LABEL_17;
  }

LABEL_18:
  if (completionCopy)
  {
    (*(completionCopy + 2))(completionCopy, 0);
  }

LABEL_20:

  v20 = *MEMORY[0x277D85DE8];
}

void __100__NPKPaymentWebServiceCompanionTargetDevice_triggerCloudStoreZoneCreationForAccount_withCompletion___block_invoke(uint64_t a1)
{
  v28[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoTriggerCloudStoreZoneCreationForAccountRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoTriggerCloudStoreZoneCreationForAccountRequest *)v2 setAccountData:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoTriggerCloudStoreZoneCreationForAccountRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:130 isResponse:0];

  v7 = *(a1 + 40);
  v27 = *MEMORY[0x277D185A0];
  v28[0] = MEMORY[0x277CBEC38];
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_triggerCloudStoreZoneCreationForAccount_withCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v9;
      v17 = "Warning: (apple-balance-pass-provisioning) No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v6;
      v17 = "Error: (apple-balance-pass-provisioning) No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __100__NPKPaymentWebServiceCompanionTargetDevice_triggerCloudStoreZoneCreationForAccount_withCompletion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)provisionPassForRemoteCredentialWithTypeAndIdentifierResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: (apple-balance-pass-provisioning) Target device provisionPassForRemoteCredentialWithTypeAndIdentifierResponse: incoming protobuf: %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x2020000000;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_provisionPassForRemoteCredentialWithTypeAndIdentifierResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: (apple-balance-pass-provisioning) No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v31 + 24), v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_provisionPassForRemoteCredentialWithTypeAndIdentifierResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoProvisionPassForRemoteCredentialWithTypeAndIdentifierResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoProvisionPassForRemoteCredentialWithTypeAndIdentifierResponse *)v5 initWithData:v6];

    if ([v7 hasPending]&& [v7 pending])
    {
      v8 = pk_Payment_log();
      v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

      if (v9)
      {
        v10 = pk_Payment_log();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: (apple-balance-pass-provisioning) Got pending response for provisionPassForRemoteCredentialWithTypeAndIdentifierResponse.", buf, 2u);
        }
      }

      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v11 = [*(a1 + 32) outstandingRequests];
      [v11 removeObjectForKey:*(a1 + 40)];

      v12 = [v4 completionHandler];
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      *(*(*(a1 + 64) + 8) + 24) = [v7 success];
      v15 = [v7 hasErrorData];
      if (v15)
      {
        v1 = [v7 errorData];
        v16 = objc_opt_class();
        v17 = NPKSecureUnarchiveObject(v1, v16);
      }

      else
      {
        v17 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
      if (v15)
      {
      }
    }

LABEL_17:

    goto LABEL_18;
  }

  v18 = pk_Payment_log();
  v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

  if (v19)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *v20 = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Warning: (apple-balance-pass-provisioning) got response with no associated message handler", v20, 2u);
    }

    goto LABEL_17;
  }

LABEL_18:
}

- (void)provisionPassForRemoteCredentialWithType:(int64_t)type andIdentifier:(id)identifier completion:(id)completion
{
  v28 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  completionCopy = completion;
  if (type != 135)
  {
    goto LABEL_9;
  }

  v10 = NPKPairedOrPairingDeviceSupportsAppleBalance();
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v14 = @"NO";
      if (v10)
      {
        v14 = @"YES";
      }

      *buf = 138412290;
      v27 = v14;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: (apple-balance-pass-provisioning) Target device provisionPassForRemoteCredentialWithType. Apple Balance card supported by device: %@", buf, 0xCu);
    }
  }

  if (v10)
  {
LABEL_9:
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __111__NPKPaymentWebServiceCompanionTargetDevice_provisionPassForRemoteCredentialWithType_andIdentifier_completion___block_invoke;
    v21[3] = &unk_279949D98;
    typeCopy = type;
    v22 = identifierCopy;
    selfCopy = self;
    v24 = completionCopy;
    dispatch_sync(internalQueue, v21);

    v16 = v22;
LABEL_10:

    goto LABEL_11;
  }

  v18 = pk_General_log();
  v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

  if (v19)
  {
    v20 = pk_General_log();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Warning: (apple-balance-pass-provisioning) provisionPassForRemoteCredentialWithType: Called on device with no support for Apple Balance card.", buf, 2u);
    }
  }

  if (completionCopy)
  {
    v16 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v16);
    goto LABEL_10;
  }

LABEL_11:

  v17 = *MEMORY[0x277D85DE8];
}

void __111__NPKPaymentWebServiceCompanionTargetDevice_provisionPassForRemoteCredentialWithType_andIdentifier_completion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoProvisionPassForRemoteCredentialWithTypeAndIdentifierRequest);
  [(NPKProtoProvisionPassForRemoteCredentialWithTypeAndIdentifierRequest *)v2 setCredentialType:*(a1 + 56)];
  [(NPKProtoProvisionPassForRemoteCredentialWithTypeAndIdentifierRequest *)v2 setCredentialIdentifier:*(a1 + 32)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoProvisionPassForRemoteCredentialWithTypeAndIdentifierRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:131 isResponse:0];

  v6 = *(a1 + 40);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 48);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __111__NPKPaymentWebServiceCompanionTargetDevice_provisionPassForRemoteCredentialWithType_andIdentifier_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 48);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 40);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: (apple-balance-pass-provisioning) No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: (apple-balance-pass-provisioning) No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __111__NPKPaymentWebServiceCompanionTargetDevice_provisionPassForRemoteCredentialWithType_andIdentifier_completion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)deviceMetadataResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target deviceMetadataWithFields (account-pass-protobuf): incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __68__NPKPaymentWebServiceCompanionTargetDevice_deviceMetadataResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __68__NPKPaymentWebServiceCompanionTargetDevice_deviceMetadataResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoDeviceMetadataWithFieldsReponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoDeviceMetadataWithFieldsReponse *)v4 initWithData:v5];

    if ([v6 pending])
    {
      v7 = pk_Payment_log();
      v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

      if (v8)
      {
        v9 = pk_Payment_log();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: got pending response for account-pass-protobuf: deviceMetadataWithFields", buf, 2u);
        }
      }

      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v12 = [*(a1 + 32) outstandingRequests];
      [v12 removeObjectForKey:*(a1 + 40)];

      v13 = [v3 completionHandler];
      v14 = *(*(a1 + 56) + 8);
      v15 = *(v14 + 40);
      *(v14 + 40) = v13;

      v16 = [v6 deviceMetadata];
      v17 = objc_opt_class();
      v18 = NPKSecureUnarchiveObject(v16, v17);
      v19 = *(*(a1 + 64) + 8);
      v20 = *(v19 + 40);
      *(v19 + 40) = v18;
    }

LABEL_12:

    goto LABEL_13;
  }

  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v21 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
    }

    goto LABEL_12;
  }

LABEL_13:
}

- (void)paymentWebService:(id)service deviceMetadataWithFields:(unint64_t)fields completion:(id)completion
{
  v33 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  completionCopy = completion;
  v10 = NPKPairedOrPairingDevice();
  v11 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"DC264F98-B0E2-4D96-9248-663A801E4FB1"];
  v12 = [v10 supportsCapability:v11];

  v13 = pk_Payment_log();
  LODWORD(v11) = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      v15 = @"NO";
      if (v12)
      {
        v15 = @"YES";
      }

      *buf = 134218242;
      fieldsCopy = fields;
      v31 = 2112;
      v32 = v15;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device deviceMetadataWithFields: %lu. AppleCard support %@", buf, 0x16u);
    }
  }

  if (v12)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_deviceMetadataWithFields_completion___block_invoke_598;
    v24[3] = &unk_27994A198;
    v25 = completionCopy;
    fieldsCopy2 = fields;
    v24[4] = self;
    v17 = completionCopy;
    dispatch_sync(internalQueue, v24);

    v18 = v25;
  }

  else
  {
    v19 = PKLogFacilityTypeGetObject();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
    {
      v20 = NPKPairedOrPairingDevice();
      v21 = [v20 valueForProperty:*MEMORY[0x277D2BC20]];
      *buf = 138412290;
      fieldsCopy = v21;
      _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "(account-pass-feature-check) watchOSVersion %@ does not support AppleCard capability. We will invoke the older counterpart to this call.", buf, 0xCu);
    }

    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_deviceMetadataWithFields_completion___block_invoke;
    v27[3] = &unk_27994A148;
    v28 = completionCopy;
    v22 = completionCopy;
    [(NPKPaymentWebServiceCompanionTargetDevice *)self paymentWebService:serviceCopy provisioningDataIncludingDeviceMetadata:1 withCompletionHandler:v27];
    v18 = v28;
  }

  v23 = *MEMORY[0x277D85DE8];
}

void __99__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_deviceMetadataWithFields_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v14 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_ERROR);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v12 = 138412290;
        v13 = v6;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_ERROR, "Error: provisioningDataIncludingDeviceMetadata: call encountered error: %@", &v12, 0xCu);
      }
    }
  }

  v10 = *(a1 + 32);
  if (v10)
  {
    (*(v10 + 16))(v10, v5);
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __99__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_deviceMetadataWithFields_completion___block_invoke_598(uint64_t a1)
{
  v31[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoDeviceMetadataWithFieldsRequest);
  [(NPKProtoDeviceMetadataWithFieldsRequest *)v2 setMetadataFields:*(a1 + 48)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoDeviceMetadataWithFieldsRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:54 isResponse:0];

  v6 = *(a1 + 32);
  v30 = *MEMORY[0x277D185A0];
  v31[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v31 forKeys:&v30 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (!v8)
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (!v16)
    {
      goto LABEL_12;
    }

    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      LODWORD(location[0]) = 138412290;
      *(location + 4) = v5;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", location, 0xCu);
    }

LABEL_11:

    goto LABEL_12;
  }

  if (!*(a1 + 40))
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

    if (!v19)
    {
      goto LABEL_12;
    }

    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      LODWORD(location[0]) = 138412290;
      *(location + 4) = v8;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: No response expected for message with identifier %@", location, 0xCu);
    }

    goto LABEL_11;
  }

  v9 = (a1 + 32);
  objc_initWeak(location, *(a1 + 32));
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_deviceMetadataWithFields_completion___block_invoke_2;
  aBlock[3] = &unk_27994A170;
  objc_copyWeak(v28, location);
  v10 = *(a1 + 40);
  v28[1] = *(a1 + 48);
  v27 = v10;
  v11 = _Block_copy(aBlock);
  v21 = MEMORY[0x277D85DD0];
  v22 = 3221225472;
  v23 = __99__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_deviceMetadataWithFields_completion___block_invoke_3;
  v24 = &unk_279945218;
  v25 = *(a1 + 40);
  v12 = _Block_copy(&v21);
  v13 = *v9;
  v14 = _Block_copy(v11);
  [v13 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v14 errorHandler:{v12, v21, v22, v23, v24}];

  objc_destroyWeak(v28);
  objc_destroyWeak(location);
LABEL_12:

  v20 = *MEMORY[0x277D85DE8];
}

void __99__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_deviceMetadataWithFields_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v5 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained _addCompanionDevicePhoneNumberDataIfNeededWithFields:*(a1 + 48) toDeviceMetadata:v5];

  v4 = *(a1 + 32);
  if (v4)
  {
    (*(v4 + 16))(v4, v5);
  }
}

uint64_t __99__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_deviceMetadataWithFields_completion___block_invoke_3(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (id)supportedFeatureIdentifiersWithPaymentWebService:(id)service
{
  v60 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Target device supportedFeatureIdentifiersWithPaymentWebService", buf, 2u);
    }
  }

  context = [serviceCopy context];
  primaryRegion = [context primaryRegion];
  configuration = [context configuration];
  targetDevice = [serviceCopy targetDevice];

  v11 = configuration;
  deviceRegion = [targetDevice deviceRegion];

  applyServiceURL = [primaryRegion applyServiceURL];

  hasApplications = [primaryRegion hasApplications];
  hasAccounts = [primaryRegion hasAccounts];
  v49 = v11;
  v16 = v11;
  v17 = deviceRegion;
  v18 = [v16 applyServiceEnabledForRegion:deviceRegion];
  v19 = hasApplications | hasAccounts | v18;
  v20 = pk_Payment_log();
  v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

  if (v21)
  {
    v22 = pk_Payment_log();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      v23 = applyServiceURL != 0;
      v24 = hasAccounts & 1;
      v25 = v18 & 1;
      if (applyServiceURL)
      {
        v26 = &stru_286C934F8;
      }

      else
      {
        v26 = [MEMORY[0x277CCACA8] stringWithFormat:@"primary region: %@", primaryRegion];
        v23 = 0;
      }

      *buf = 67110402;
      *v51 = v19 & 1;
      *&v51[4] = 1024;
      *&v51[6] = hasApplications;
      v52 = 1024;
      v53 = v24;
      v54 = 1024;
      v55 = v25;
      v56 = 1024;
      v57 = v23;
      v58 = 2112;
      v27 = v26;
      v59 = v26;
      _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_DEFAULT, "Notice: Payment web service supports apply service: %d, hasApplications: %d, hasAccounts: %d, regionEnabled: %d, hasURL: %d %@", buf, 0x2Au);
      if (!applyServiceURL)
      {
      }
    }
  }

  if (v19)
  {
    v28 = [context applyServiceFeaturesForRegionMeetingEnablementThreshold:v17];
    _deviceSupportedFeatureIdentifiers = [(NPKPaymentWebServiceCompanionTargetDevice *)self _deviceSupportedFeatureIdentifiers];
    v30 = pk_Payment_log();
    v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

    if (v31)
    {
      v32 = pk_Payment_log();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        *v51 = _deviceSupportedFeatureIdentifiers;
        _os_log_impl(&dword_25B300000, v32, OS_LOG_TYPE_DEFAULT, "Notice: Device supported feature identifiers: %@", buf, 0xCu);
      }
    }

    if (![_deviceSupportedFeatureIdentifiers count])
    {
      v33 = pk_Payment_log();
      v34 = os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT);

      if (v34)
      {
        v35 = pk_Payment_log();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v35, OS_LOG_TYPE_DEFAULT, "Notice: NRDevicePropertySupportedFeatureIdentifiers returned a nil set", buf, 2u);
        }
      }
    }

    v36 = MEMORY[0x277CBEB58];
    allKeys = [v28 allKeys];
    v38 = [v36 setWithArray:allKeys];

    v39 = pk_Payment_log();
    v40 = os_log_type_enabled(v39, OS_LOG_TYPE_DEFAULT);

    if (v40)
    {
      v41 = pk_Payment_log();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        *v51 = v38;
        _os_log_impl(&dword_25B300000, v41, OS_LOG_TYPE_DEFAULT, "Notice: Config supported feature identifiers: %@", buf, 0xCu);
      }
    }

    [v38 intersectSet:_deviceSupportedFeatureIdentifiers];
    v42 = pk_Payment_log();
    v43 = os_log_type_enabled(v42, OS_LOG_TYPE_DEFAULT);

    if (v43)
    {
      v44 = pk_Payment_log();
      if (os_log_type_enabled(v44, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        *v51 = v38;
        _os_log_impl(&dword_25B300000, v44, OS_LOG_TYPE_DEFAULT, "Notice: Final supported feature identifiers: %@", buf, 0xCu);
      }
    }

    v45 = [v38 copy];
  }

  else
  {
    v45 = 0;
  }

  v46 = *MEMORY[0x277D85DE8];

  return v45;
}

- (id)supportedFeatureIdentifiersForAccountProvisioningWithPaymentWebService:(id)service
{
  v32 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      LOWORD(v28) = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target device supportedFeatureIdentifiersForAccountProvisioningWithPaymentWebService", &v28, 2u);
    }
  }

  context = [serviceCopy context];
  primaryRegion = [context primaryRegion];
  accountServiceURL = [primaryRegion accountServiceURL];

  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      if (accountServiceURL)
      {
        v14 = @"YES";
      }

      else
      {
        v14 = @"NO";
      }

      accountServiceURL2 = [primaryRegion accountServiceURL];
      v28 = 138412546;
      v29 = v14;
      v30 = 2112;
      v31 = accountServiceURL2;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Payment web service supports account service: %@ accountServiceURL %@", &v28, 0x16u);
    }
  }

  if (accountServiceURL)
  {
    _deviceSupportedFeatureIdentifiers = [(NPKPaymentWebServiceCompanionTargetDevice *)self _deviceSupportedFeatureIdentifiers];
    v17 = pk_Payment_log();
    v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

    if (v18)
    {
      v19 = pk_Payment_log();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        v28 = 138412290;
        v29 = _deviceSupportedFeatureIdentifiers;
        _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Device supported feature identifiers: %@", &v28, 0xCu);
      }
    }

    if (![_deviceSupportedFeatureIdentifiers count])
    {
      v20 = pk_Payment_log();
      v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

      if (v21)
      {
        v22 = pk_Payment_log();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
        {
          LOWORD(v28) = 0;
          _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) NRDevicePropertySupportedFeatureIdentifiers returned a nil set", &v28, 2u);
        }
      }
    }

    v23 = [_deviceSupportedFeatureIdentifiers copy];
LABEL_27:

    goto LABEL_28;
  }

  v24 = pk_Payment_log();
  v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

  if (v25)
  {
    _deviceSupportedFeatureIdentifiers = pk_Payment_log();
    if (os_log_type_enabled(_deviceSupportedFeatureIdentifiers, OS_LOG_TYPE_DEFAULT))
    {
      v28 = 138412290;
      v29 = primaryRegion;
      _os_log_impl(&dword_25B300000, _deviceSupportedFeatureIdentifiers, OS_LOG_TYPE_DEFAULT, "Notice: primary region: %@", &v28, 0xCu);
    }

    v23 = 0;
    goto LABEL_27;
  }

  v23 = 0;
LABEL_28:

  v26 = *MEMORY[0x277D85DE8];

  return v23;
}

- (void)updateAccountWithIdentifierResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target updateAccountWithIdentifier (account-pass-protobuf): incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __81__NPKPaymentWebServiceCompanionTargetDevice_updateAccountWithIdentifierResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __81__NPKPaymentWebServiceCompanionTargetDevice_updateAccountWithIdentifierResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoUpdateAccountWithIdentifierResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoUpdateAccountWithIdentifierResponse *)v5 initWithData:v6];

    if ([v7 pending])
    {
      v8 = pk_Payment_log();
      v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

      if (v9)
      {
        v10 = pk_Payment_log();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: got pending response for account-pass-protobuf: updateAccountWithIdentifier", buf, 2u);
        }
      }

      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v13 = [*(a1 + 32) outstandingRequests];
      [v13 removeObjectForKey:*(a1 + 40)];

      v14 = [v4 completionHandler];
      v15 = *(*(a1 + 56) + 8);
      v16 = *(v15 + 40);
      *(v15 + 40) = v14;

      v17 = [v7 accountData];
      v18 = objc_opt_class();
      v19 = NPKSecureUnarchiveObject(v17, v18);
      v20 = *(*(a1 + 64) + 8);
      v21 = *(v20 + 40);
      *(v20 + 40) = v19;

      v22 = [v7 hasErrorData];
      if (v22)
      {
        v1 = [v7 errorData];
        v23 = objc_opt_class();
        v24 = NPKSecureUnarchiveObject(v1, v23);
      }

      else
      {
        v24 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v24);
      if (v22)
      {
      }
    }

LABEL_16:

    goto LABEL_17;
  }

  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *v25 = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v25, 2u);
    }

    goto LABEL_16;
  }

LABEL_17:
}

- (void)paymentWebService:(id)service updateAccountWithIdentifier:(id)identifier completion:(id)completion
{
  v22 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  completionCopy = completion;
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v21 = identifierCopy;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target device updateAccountWithIdentifier: %@", buf, 0xCu);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_updateAccountWithIdentifier_completion___block_invoke;
  block[3] = &unk_279945A48;
  v17 = identifierCopy;
  selfCopy = self;
  v19 = completionCopy;
  v13 = completionCopy;
  v14 = identifierCopy;
  dispatch_sync(internalQueue, block);

  v15 = *MEMORY[0x277D85DE8];
}

void __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_updateAccountWithIdentifier_completion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoUpdateAccountWithIdentifierRequest);
  [(NPKProtoUpdateAccountWithIdentifierRequest *)v2 setAccountIdentifier:*(a1 + 32)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoUpdateAccountWithIdentifierRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:55 isResponse:0];

  v6 = *(a1 + 40);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 48);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_updateAccountWithIdentifier_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 48);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 40);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_updateAccountWithIdentifier_completion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)accountWithIdentifierResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: (apple-balance-pass-provisioning) Target accountWithIdentifier: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __75__NPKPaymentWebServiceCompanionTargetDevice_accountWithIdentifierResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __75__NPKPaymentWebServiceCompanionTargetDevice_accountWithIdentifierResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoAccountWithIdentifierResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoAccountWithIdentifierResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoAccountWithIdentifierResponse *)v7 hasAccountData];
    if (v12)
    {
      v1 = [(NPKProtoAccountWithIdentifierResponse *)v7 accountData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }

    v18 = [(NPKProtoAccountWithIdentifierResponse *)v7 hasErrorData];
    if (v18)
    {
      v1 = [(NPKProtoAccountWithIdentifierResponse *)v7 errorData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v1, v19);
    }

    else
    {
      v20 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v20);
    if (v18)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)accountWithIdentifier:(id)identifier completion:(id)completion
{
  v21 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  completionCopy = completion;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v20 = identifierCopy;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: (apple-balance-pass-provisioning) Target device accountWithIdentifier: %@", buf, 0xCu);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __78__NPKPaymentWebServiceCompanionTargetDevice_accountWithIdentifier_completion___block_invoke;
  block[3] = &unk_27994A1C0;
  selfCopy = self;
  v18 = completionCopy;
  v16 = identifierCopy;
  v12 = completionCopy;
  v13 = identifierCopy;
  dispatch_sync(internalQueue, block);

  v14 = *MEMORY[0x277D85DE8];
}

void __78__NPKPaymentWebServiceCompanionTargetDevice_accountWithIdentifier_completion___block_invoke(uint64_t a1)
{
  v35[1] = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) length])
  {
    v2 = objc_alloc_init(NPKProtoAccountWithIdentifierRequest);
    [(NPKProtoAccountWithIdentifierRequest *)v2 setAccountIdentifier:*(a1 + 32)];
    v3 = objc_alloc(MEMORY[0x277D189F0]);
    v4 = [(NPKProtoAccountWithIdentifierRequest *)v2 data];
    v5 = [v3 initWithProtobufData:v4 type:133 isResponse:0];

    v6 = *(a1 + 40);
    v30 = *MEMORY[0x277D185A0];
    v31 = MEMORY[0x277CBEC38];
    v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v31 forKeys:&v30 count:1];
    v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

    if (v8)
    {
      v9 = *(a1 + 48);
      if (v9)
      {
        v10 = _Block_copy(v9);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __78__NPKPaymentWebServiceCompanionTargetDevice_accountWithIdentifier_completion___block_invoke_615;
        aBlock[3] = &unk_279945218;
        v29 = *(a1 + 48);
        v11 = _Block_copy(aBlock);
        v12 = *(a1 + 40);
        v13 = _Block_copy(v10);
        [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_17:
        goto LABEL_18;
      }

      v25 = pk_Payment_log();
      v26 = os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT);

      if (v26)
      {
        v10 = pk_Payment_log();
        if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_17;
        }

        *buf = 138412290;
        v33 = v8;
        v22 = "Warning: No response expected for message with identifier %@";
        v23 = v10;
        v24 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_16;
      }
    }

    else
    {
      v20 = pk_Payment_log();
      v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

      if (v21)
      {
        v10 = pk_Payment_log();
        if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_17;
        }

        *buf = 138412290;
        v33 = v5;
        v22 = "Error: No message identifier for protobuf %@";
        v23 = v10;
        v24 = OS_LOG_TYPE_ERROR;
LABEL_16:
        _os_log_impl(&dword_25B300000, v23, v24, v22, buf, 0xCu);
        goto LABEL_17;
      }
    }

LABEL_18:

LABEL_19:
    goto LABEL_20;
  }

  if (*(a1 + 48))
  {
    v14 = MEMORY[0x277CCA9B8];
    v34 = *MEMORY[0x277CCA470];
    v35[0] = @"Invalid account identifier";
    v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:&v34 count:1];
    v16 = [v14 errorWithDomain:@"com.apple.NPKErrorDomain" code:0 userInfo:v15];

    (*(*(a1 + 48) + 16))();
  }

  v17 = pk_Payment_log();
  v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

  if (v18)
  {
    v2 = pk_Payment_log();
    if (os_log_type_enabled(&v2->super.super.super, OS_LOG_TYPE_DEFAULT))
    {
      v19 = *(a1 + 32);
      *buf = 138412290;
      v33 = v19;
      _os_log_impl(&dword_25B300000, &v2->super.super.super, OS_LOG_TYPE_DEFAULT, "Notice: (apple-balance-pass-provisioning) Invalid account identifier: %@", buf, 0xCu);
    }

    goto LABEL_19;
  }

LABEL_20:
  v27 = *MEMORY[0x277D85DE8];
}

uint64_t __78__NPKPaymentWebServiceCompanionTargetDevice_accountWithIdentifier_completion___block_invoke_615(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (id)_deviceSupportedFeatureIdentifiers
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = NPKPairedOrPairingDevice();
  v3 = [v2 valueForProperty:*MEMORY[0x277D2BC00]];
  v4 = PKFeatureIdentifierToString();
  if ([v3 containsObject:v4])
  {
    v5 = [v2 valueForProperty:*MEMORY[0x277D2BC20]];
    v6 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"DC264F98-B0E2-4D96-9248-663A801E4FB1"];
    v7 = [v2 supportsCapability:v6];

    v8 = PKLogFacilityTypeGetObject();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);
    if (v7)
    {
      if (v9)
      {
        v12 = 138412290;
        v13 = v5;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "(account-pass-feature-check) watchOSVersion %@ does support AppleCard capability.", &v12, 0xCu);
      }
    }

    else
    {
      if (v9)
      {
        v12 = 138412546;
        v13 = v5;
        v14 = 2112;
        v15 = v3;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "(account-pass-feature-check) watchOSVersion %@ does not support AppleCard capability. Removing from features %@", &v12, 0x16u);
      }

      [v3 pk_setByRemovingObject:v4];
      v3 = v8 = v3;
    }
  }

  v10 = *MEMORY[0x277D85DE8];

  return v3;
}

- (void)performDeviceCheckInResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target performDeviceCheckInResponse (account-pass-protobuf): incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v28 = 0;
  v29 = &v28;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__22;
  v32 = __Block_byref_object_dispose__22;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x2020000000;
  v27 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __74__NPKPaymentWebServiceCompanionTargetDevice_performDeviceCheckInResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v28;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v25 + 24), v29[5]);
  }

  _Block_object_dispose(&v24, 8);
  _Block_object_dispose(&v28, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __74__NPKPaymentWebServiceCompanionTargetDevice_performDeviceCheckInResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoPerformDeviceCheckInResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoPerformDeviceCheckInResponse *)v5 initWithData:v6];

    if ([v7 pending])
    {
      v8 = pk_Payment_log();
      v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

      if (v9)
      {
        v10 = pk_Payment_log();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: got pending response for account-pass-protobuf: performDeviceCheckInResponse", buf, 2u);
        }
      }

      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v13 = [*(a1 + 32) outstandingRequests];
      [v13 removeObjectForKey:*(a1 + 40)];

      v14 = [v4 completionHandler];
      v15 = *(*(a1 + 56) + 8);
      v16 = *(v15 + 40);
      *(v15 + 40) = v14;

      v17 = [v7 hasErrorData];
      if (v17)
      {
        v1 = [v7 errorData];
        v18 = objc_opt_class();
        v19 = NPKSecureUnarchiveObject(v1, v18);
      }

      else
      {
        v19 = 0;
      }

      objc_storeStrong((*(*(a1 + 64) + 8) + 40), v19);
      if (v17)
      {
      }

      *(*(*(a1 + 72) + 8) + 24) = [v7 success];
    }

LABEL_17:

    goto LABEL_18;
  }

  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *v20 = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v20, 2u);
    }

    goto LABEL_17;
  }

LABEL_18:
}

- (void)performDeviceCheckInWithCompletion:(id)completion
{
  v20 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v5 = NPKPairedOrPairingDevice();
  v6 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"DC264F98-B0E2-4D96-9248-663A801E4FB1"];
  v7 = [v5 supportsCapability:v6];

  v8 = pk_Payment_log();
  LODWORD(v6) = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = @"NO";
      if (v7)
      {
        v10 = @"YES";
      }

      *buf = 138412290;
      v19 = v10;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target device performDeviceCheckInWithCompletion, AppleCard support %@", buf, 0xCu);
    }
  }

  if (v7)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __80__NPKPaymentWebServiceCompanionTargetDevice_performDeviceCheckInWithCompletion___block_invoke;
    v16[3] = &unk_279945530;
    v16[4] = self;
    v17 = completionCopy;
    dispatch_sync(internalQueue, v16);
  }

  else
  {
    v12 = PKLogFacilityTypeGetObject();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = NPKPairedOrPairingDevice();
      v14 = [v13 valueForProperty:*MEMORY[0x277D2BC20]];
      *buf = 138412290;
      v19 = v14;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "(account-pass-feature-check) watchOSVersion %@ does not support AppleCard capability.", buf, 0xCu);
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0, 0);
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

void __80__NPKPaymentWebServiceCompanionTargetDevice_performDeviceCheckInWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoPerformDeviceCheckInRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoPerformDeviceCheckInRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:62 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __80__NPKPaymentWebServiceCompanionTargetDevice_performDeviceCheckInWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __80__NPKPaymentWebServiceCompanionTargetDevice_performDeviceCheckInWithCompletion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0);
  }

  return result;
}

- (void)availableProductsResponse:(id)response
{
  v53 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target availableProductsResponse (account-pass-protobuf): incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v49 = 0x3032000000;
  v50 = __Block_byref_object_copy__384;
  v51 = __Block_byref_object_dispose__385;
  v52 = 0;
  v36 = 0;
  v37 = &v36;
  v38 = 0x3032000000;
  v39 = __Block_byref_object_copy__22;
  v40 = __Block_byref_object_dispose__22;
  v41 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __71__NPKPaymentWebServiceCompanionTargetDevice_availableProductsResponse___block_invoke;
    v24[3] = &unk_279949C48;
    v24[4] = self;
    v25 = incomingResponseIdentifier;
    v26 = responseCopy;
    p_buf = &buf;
    v28 = &v36;
    v29 = &v30;
    dispatch_sync(internalQueue, v24);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v42 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v42, 2u);
      }
    }
  }

  if (*(*(&buf + 1) + 40))
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v19 = pk_Payment_log();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        v20 = v37[5];
        availableProducts = [v20 availableProducts];
        v22 = v31[5];
        *v42 = 138412802;
        v43 = v20;
        v44 = 2112;
        v45 = availableProducts;
        v46 = 2112;
        v47 = v22;
        _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) calling completion for availableProductsWithCompletion %@ (%@) %@", v42, 0x20u);
      }
    }

    (*(*(*(&buf + 1) + 40) + 16))(*(*(&buf + 1) + 40), v37[5], v31[5], v17, v18);
  }

  _Block_object_dispose(&v30, 8);

  _Block_object_dispose(&v36, 8);
  _Block_object_dispose(&buf, 8);

  v23 = *MEMORY[0x277D85DE8];
}

void __71__NPKPaymentWebServiceCompanionTargetDevice_availableProductsResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoAvailableProductsResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoAvailableProductsResponse *)v5 initWithData:v6];

    if ([v7 pending])
    {
      v8 = pk_Payment_log();
      v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

      if (v9)
      {
        v10 = pk_Payment_log();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: got pending response for account-pass-protobuf: availableProductsResponse", buf, 2u);
        }
      }

      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v13 = [*(a1 + 32) outstandingRequests];
      [v13 removeObjectForKey:*(a1 + 40)];

      v14 = [v4 completionHandler];
      v15 = *(*(a1 + 56) + 8);
      v16 = *(v15 + 40);
      *(v15 + 40) = v14;

      v17 = [v7 availableProductsData];
      v18 = objc_opt_class();
      v19 = NPKSecureUnarchiveObject(v17, v18);
      v20 = *(*(a1 + 64) + 8);
      v21 = *(v20 + 40);
      *(v20 + 40) = v19;

      v22 = [v7 hasErrorData];
      if (v22)
      {
        v1 = [v7 errorData];
        v23 = objc_opt_class();
        v24 = NPKSecureUnarchiveObject(v1, v23);
      }

      else
      {
        v24 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v24);
      if (v22)
      {
      }
    }

LABEL_16:

    goto LABEL_17;
  }

  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *v25 = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v25, 2u);
    }

    goto LABEL_16;
  }

LABEL_17:
}

- (void)productsWithRequest:(id)request completion:(id)completion
{
  v34 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  completionCopy = completion;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v33 = requestCopy;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: TargetDevice: products with request:%@", buf, 0xCu);
    }
  }

  v11 = NPKPairedOrPairingDevice();
  v12 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"DC264F98-B0E2-4D96-9248-663A801E4FB1"];
  v13 = [v11 supportsCapability:v12];

  v14 = pk_Payment_log();
  LODWORD(v12) = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = @"NO";
      if (v13)
      {
        v16 = @"YES";
      }

      *buf = 138412290;
      v33 = v16;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target device availableProductsWithCompletion, AppleCard support %@", buf, 0xCu);
    }
  }

  if (v13)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_productsWithRequest_completion___block_invoke_622;
    v27[3] = &unk_279945A48;
    v18 = v28;
    requestCopy = requestCopy;
    v28[0] = requestCopy;
    v28[1] = self;
    v29 = completionCopy;
    v19 = completionCopy;
    dispatch_sync(internalQueue, v27);
  }

  else
  {
    v20 = PKLogFacilityTypeGetObject();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
    {
      v21 = NPKPairedOrPairingDevice();
      v22 = [v21 valueForProperty:*MEMORY[0x277D2BC20]];
      *buf = 138412290;
      v33 = v22;
      _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "(account-pass-feature-check) watchOSVersion %@ does not implement availableProductsWithCompletion, getting products from web service", buf, 0xCu);
    }

    if (!requestCopy)
    {
      requestCopy = objc_alloc_init(MEMORY[0x277D37FF8]);
    }

    companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
    watchPaymentWebService = [companionAgentConnection watchPaymentWebService];
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_productsWithRequest_completion___block_invoke;
    v30[3] = &unk_27994A1E8;
    v18 = &v31;
    v31 = completionCopy;
    v25 = completionCopy;
    [watchPaymentWebService availableProductsWithRequest:requestCopy completion:v30];
  }

  v26 = *MEMORY[0x277D85DE8];
}

void __76__NPKPaymentWebServiceCompanionTargetDevice_productsWithRequest_completion___block_invoke(uint64_t a1, uint64_t a2, void *a3, void *a4)
{
  v17 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v13 = 138412546;
      v14 = v6;
      v15 = 2112;
      v16 = v7;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) availableProductsWithRequest returned %@ %@", &v13, 0x16u);
    }
  }

  v11 = *(a1 + 32);
  if (v11)
  {
    (*(v11 + 16))(v11, v6, v7);
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __76__NPKPaymentWebServiceCompanionTargetDevice_productsWithRequest_completion___block_invoke_622(uint64_t a1)
{
  v29[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoAvailableProductsRequest);
  v3 = *(a1 + 32);
  if (v3)
  {
    v4 = NPKSecureArchiveObject(v3);
    [(NPKProtoAvailableProductsRequest *)v2 setProductsRequestData:v4];
  }

  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [(NPKProtoAvailableProductsRequest *)v2 data];
  v7 = [v5 initWithProtobufData:v6 type:63 isResponse:0];

  v8 = *(a1 + 40);
  v28 = *MEMORY[0x277D185A0];
  v29[0] = MEMORY[0x277CBEC38];
  v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:&v28 count:1];
  v10 = [v8 _sendProtobuf:v7 responseExpected:1 extraOptions:v9];

  if (v10)
  {
    v11 = *(a1 + 48);
    if (v11)
    {
      v12 = _Block_copy(v11);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_productsWithRequest_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v25 = *(a1 + 48);
      v13 = _Block_copy(aBlock);
      v14 = *(a1 + 40);
      v15 = _Block_copy(v12);
      [v14 _trackOutstandingRequestWithMessageIdentifier:v10 completionHandler:v15 errorHandler:v13];

LABEL_13:
      goto LABEL_14;
    }

    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT);

    if (v22)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_13;
      }

      *buf = 138412290;
      v27 = v10;
      v18 = "Warning: No response expected for message with identifier %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_12;
    }
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);

    if (v17)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_13;
      }

      *buf = 138412290;
      v27 = v7;
      v18 = "Error: No message identifier for protobuf %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_ERROR;
LABEL_12:
      _os_log_impl(&dword_25B300000, v19, v20, v18, buf, 0xCu);
      goto LABEL_13;
    }
  }

LABEL_14:

  v23 = *MEMORY[0x277D85DE8];
}

uint64_t __76__NPKPaymentWebServiceCompanionTargetDevice_productsWithRequest_completion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0);
  }

  return result;
}

- (void)performProductActionResponse:(id)response
{
  v53 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target performProductActionResponse (account-pass-protobuf): incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v49 = 0x3032000000;
  v50 = __Block_byref_object_copy__384;
  v51 = __Block_byref_object_dispose__385;
  v52 = 0;
  v36 = 0;
  v37 = &v36;
  v38 = 0x3032000000;
  v39 = __Block_byref_object_copy__22;
  v40 = __Block_byref_object_dispose__22;
  v41 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __74__NPKPaymentWebServiceCompanionTargetDevice_performProductActionResponse___block_invoke;
    v24[3] = &unk_279949C48;
    v24[4] = self;
    v25 = incomingResponseIdentifier;
    v26 = responseCopy;
    p_buf = &buf;
    v28 = &v36;
    v29 = &v30;
    dispatch_sync(internalQueue, v24);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v42 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v42, 2u);
      }
    }
  }

  if (*(*(&buf + 1) + 40))
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v19 = pk_Payment_log();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        v20 = v37[5];
        availableProducts = [v20 availableProducts];
        v22 = v31[5];
        *v42 = 138412802;
        v43 = v20;
        v44 = 2112;
        v45 = availableProducts;
        v46 = 2112;
        v47 = v22;
        _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) calling completion for performProductActionRequest %@ (%@) %@", v42, 0x20u);
      }
    }

    (*(*(*(&buf + 1) + 40) + 16))(*(*(&buf + 1) + 40), v37[5], v31[5], v17, v18);
  }

  _Block_object_dispose(&v30, 8);

  _Block_object_dispose(&v36, 8);
  _Block_object_dispose(&buf, 8);

  v23 = *MEMORY[0x277D85DE8];
}

void __74__NPKPaymentWebServiceCompanionTargetDevice_performProductActionResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoPerformProductActionResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoPerformProductActionResponse *)v5 initWithData:v6];

    if ([v7 pending])
    {
      v8 = pk_Payment_log();
      v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

      if (v9)
      {
        v10 = pk_Payment_log();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: got pending response for account-pass-protobuf: performProductActionResponse", buf, 2u);
        }
      }

      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v13 = [*(a1 + 32) outstandingRequests];
      [v13 removeObjectForKey:*(a1 + 40)];

      v14 = [v4 completionHandler];
      v15 = *(*(a1 + 56) + 8);
      v16 = *(v15 + 40);
      *(v15 + 40) = v14;

      v17 = [v7 availableProductsData];
      v18 = objc_opt_class();
      v19 = NPKSecureUnarchiveObject(v17, v18);
      v20 = *(*(a1 + 64) + 8);
      v21 = *(v20 + 40);
      *(v20 + 40) = v19;

      v22 = [v7 hasErrorData];
      if (v22)
      {
        v1 = [v7 errorData];
        v23 = objc_opt_class();
        v24 = NPKSecureUnarchiveObject(v1, v23);
      }

      else
      {
        v24 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v24);
      if (v22)
      {
      }
    }

LABEL_16:

    goto LABEL_17;
  }

  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *v25 = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v25, 2u);
    }

    goto LABEL_16;
  }

LABEL_17:
}

- (void)performProductActionRequest:(id)request completion:(id)completion
{
  v21 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  completionCopy = completion;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v20 = requestCopy;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target device performProductActionRequest %@", buf, 0xCu);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_performProductActionRequest_completion___block_invoke;
  block[3] = &unk_279945A48;
  v16 = requestCopy;
  selfCopy = self;
  v18 = completionCopy;
  v12 = completionCopy;
  v13 = requestCopy;
  dispatch_sync(internalQueue, block);

  v14 = *MEMORY[0x277D85DE8];
}

void __84__NPKPaymentWebServiceCompanionTargetDevice_performProductActionRequest_completion___block_invoke(uint64_t a1)
{
  v28[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoPerformProductActionRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoPerformProductActionRequest *)v2 setProductsActionData:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoPerformProductActionRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:64 isResponse:0];

  v7 = *(a1 + 40);
  v27 = *MEMORY[0x277D185A0];
  v28[0] = MEMORY[0x277CBEC38];
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_performProductActionRequest_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v9;
      v17 = "Warning: No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v6;
      v17 = "Error: No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __84__NPKPaymentWebServiceCompanionTargetDevice_performProductActionRequest_completion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0);
  }

  return result;
}

- (void)paymentWebService:(id)service setDefaultPaymentPassUniqueIdentifier:(id)identifier
{
  v16 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v15 = identifierCopy;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) Target device setDefaultPaymentPassUniqueIdentifier: %@", buf, 0xCu);
    }
  }

  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_setDefaultPaymentPassUniqueIdentifier___block_invoke;
  v12[3] = &unk_279946BF8;
  v13 = identifierCopy;
  v10 = identifierCopy;
  [companionAgentConnection setDefaultCardUniqueID:v10 completion:v12];

  v11 = *MEMORY[0x277D85DE8];
}

void __101__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_setDefaultPaymentPassUniqueIdentifier___block_invoke(uint64_t a1, int a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v7 = @"NO";
      v8 = *(a1 + 32);
      if (a2)
      {
        v7 = @"YES";
      }

      v10 = 138412546;
      v11 = v8;
      v12 = 2112;
      v13 = v7;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-provisioning) completion of setDefaultCardUniqueID %@ resulted in success = %@", &v10, 0x16u);
    }
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)initializeCloudStoreIfNecessaryResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device initialize cloud store if necessary: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __85__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __85__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoInitializeCloudStoreIfNecessaryResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoInitializeCloudStoreIfNecessaryResponse *)v4 initWithData:v5];

    if ([(NPKProtoInitializeCloudStoreIfNecessaryResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;

      *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoInitializeCloudStoreIfNecessaryResponse *)v6 success];
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)initializeCloudStoreIfNecessaryWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device initialize cloud store if necessary", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryWithCompletion___block_invoke;
  v10[3] = &unk_279945530;
  v10[4] = self;
  v11 = completionCopy;
  v9 = completionCopy;
  dispatch_sync(internalQueue, v10);
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoInitializeCloudStoreIfNecessaryRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoInitializeCloudStoreIfNecessaryRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:38 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __91__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryWithCompletion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)initializeCloudStoreIfNecessaryWithHandlerResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device initialize cloud store if necessary with handler: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x2020000000;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __96__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryWithHandlerResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v31 + 24), v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __96__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryWithHandlerResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoInitializeCloudStoreIfNecessaryWithHandlerResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoInitializeCloudStoreIfNecessaryWithHandlerResponse *)v5 initWithData:v6];

    if ([(NPKProtoInitializeCloudStoreIfNecessaryWithHandlerResponse *)v7 pending])
    {
      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v11 = [*(a1 + 32) outstandingRequests];
      [v11 removeObjectForKey:*(a1 + 40)];

      v12 = [v4 completionHandler];
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoInitializeCloudStoreIfNecessaryWithHandlerResponse *)v7 success];
      v15 = [(NPKProtoInitializeCloudStoreIfNecessaryWithHandlerResponse *)v7 hasErrorData];
      if (v15)
      {
        v1 = [(NPKProtoInitializeCloudStoreIfNecessaryWithHandlerResponse *)v7 errorData];
        v16 = objc_opt_class();
        v17 = NPKSecureUnarchiveObject(v1, v16);
      }

      else
      {
        v17 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
      if (v15)
      {
      }
    }
  }

  else
  {
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)initializeCloudStoreIfNecessaryWithHandler:(id)handler
{
  handlerCopy = handler;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device initialize cloud store if necessary with handler", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryWithHandler___block_invoke;
  v10[3] = &unk_279945530;
  v10[4] = self;
  v11 = handlerCopy;
  v9 = handlerCopy;
  dispatch_sync(internalQueue, v10);
}

void __88__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryWithHandler___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoInitializeCloudStoreIfNecessaryWithHandlerRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoInitializeCloudStoreIfNecessaryWithHandlerRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:42 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryWithHandler___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __88__NPKPaymentWebServiceCompanionTargetDevice_initializeCloudStoreIfNecessaryWithHandler___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)checkTLKsMissingResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device check TLKs missing: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x2020000000;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__NPKPaymentWebServiceCompanionTargetDevice_checkTLKsMissingResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v31 + 24), v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __70__NPKPaymentWebServiceCompanionTargetDevice_checkTLKsMissingResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCheckTLKsMissingResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCheckTLKsMissingResponse *)v5 initWithData:v6];

    if ([(NPKProtoCheckTLKsMissingResponse *)v7 pending])
    {
      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v11 = [*(a1 + 32) outstandingRequests];
      [v11 removeObjectForKey:*(a1 + 40)];

      v12 = [v4 completionHandler];
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoCheckTLKsMissingResponse *)v7 missing];
      v15 = [(NPKProtoCheckTLKsMissingResponse *)v7 hasErrorData];
      if (v15)
      {
        v1 = [(NPKProtoCheckTLKsMissingResponse *)v7 errorData];
        v16 = objc_opt_class();
        v17 = NPKSecureUnarchiveObject(v1, v16);
      }

      else
      {
        v17 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
      if (v15)
      {
      }
    }
  }

  else
  {
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)checkTLKsMissingWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device check TLK missing", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_checkTLKsMissingWithCompletion___block_invoke;
  v10[3] = &unk_279945530;
  v10[4] = self;
  v11 = completionCopy;
  v9 = completionCopy;
  dispatch_sync(internalQueue, v10);
}

void __76__NPKPaymentWebServiceCompanionTargetDevice_checkTLKsMissingWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoCheckTLKsMissingRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoCheckTLKsMissingRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:41 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_checkTLKsMissingWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __76__NPKPaymentWebServiceCompanionTargetDevice_checkTLKsMissingWithCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)resetApplePayManateeViewResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device reset ApplePay manatee view: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v28 = 0;
  v29 = &v28;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__22;
  v32 = __Block_byref_object_dispose__22;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x2020000000;
  v27 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__NPKPaymentWebServiceCompanionTargetDevice_resetApplePayManateeViewResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v24;
    v23 = &v28;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v25 + 24), v29[5]);
  }

  _Block_object_dispose(&v24, 8);
  _Block_object_dispose(&v28, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __78__NPKPaymentWebServiceCompanionTargetDevice_resetApplePayManateeViewResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoResetApplePayManateeViewResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoResetApplePayManateeViewResponse *)v5 initWithData:v6];

    if ([(NPKProtoResetApplePayManateeViewResponse *)v7 pending])
    {
      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v11 = [*(a1 + 32) outstandingRequests];
      [v11 removeObjectForKey:*(a1 + 40)];

      v12 = [v4 completionHandler];
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoResetApplePayManateeViewResponse *)v7 success];
      v15 = [(NPKProtoResetApplePayManateeViewResponse *)v7 hasErrorData];
      if (v15)
      {
        v1 = [(NPKProtoResetApplePayManateeViewResponse *)v7 errorData];
        v16 = objc_opt_class();
        v17 = NPKSecureUnarchiveObject(v1, v16);
      }

      else
      {
        v17 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
      if (v15)
      {
      }
    }
  }

  else
  {
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)resetApplePayManateeViewWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device reset ApplePay manatee view", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_resetApplePayManateeViewWithCompletion___block_invoke;
  v10[3] = &unk_279945530;
  v10[4] = self;
  v11 = completionCopy;
  v9 = completionCopy;
  dispatch_sync(internalQueue, v10);
}

void __84__NPKPaymentWebServiceCompanionTargetDevice_resetApplePayManateeViewWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoResetApplePayManateeViewRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoResetApplePayManateeViewRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:43 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_resetApplePayManateeViewWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __84__NPKPaymentWebServiceCompanionTargetDevice_resetApplePayManateeViewWithCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)cloudStoreStatusResponse:(id)response
{
  v46 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device cloud store status: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v42 = 0x3032000000;
  v43 = __Block_byref_object_copy__384;
  v44 = __Block_byref_object_dispose__385;
  v45 = 0;
  v35 = 0;
  v36 = &v35;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__22;
  v39 = __Block_byref_object_dispose__22;
  v40 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x2020000000;
  v34 = 0;
  v25 = 0;
  v26 = &v25;
  v27 = 0x3032000000;
  v28 = __Block_byref_object_copy__22;
  v29 = __Block_byref_object_dispose__22;
  v30 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__NPKPaymentWebServiceCompanionTargetDevice_cloudStoreStatusResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v35;
    v23 = &v31;
    v24 = &v25;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v36[5], *(v32 + 24), v26[5]);
  }

  _Block_object_dispose(&v25, 8);

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v35, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __70__NPKPaymentWebServiceCompanionTargetDevice_cloudStoreStatusResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoCloudStoreStatusResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoCloudStoreStatusResponse *)v4 initWithData:v5];

    if ([(NPKProtoCloudStoreStatusResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;

      v14 = [(NPKProtoCloudStoreStatusResponse *)v6 accountInfoData];
      v15 = objc_opt_class();
      v16 = NPKSecureUnarchiveObject(v14, v15);
      v17 = *(*(a1 + 64) + 8);
      v18 = *(v17 + 40);
      *(v17 + 40) = v16;

      *(*(*(a1 + 72) + 8) + 24) = [(NPKProtoCloudStoreStatusResponse *)v6 cloudStoreIsSetup];
      v19 = [(NPKProtoCloudStoreStatusResponse *)v6 errorData];
      v20 = MEMORY[0x277CBEB98];
      v21 = objc_opt_class();
      v22 = [v20 setWithObjects:{v21, objc_opt_class(), 0}];
      v23 = NPKSecureUnarchiveObjectOfClasses(v19, v22);
      v24 = *(*(a1 + 80) + 8);
      v25 = *(v24 + 40);
      *(v24 + 40) = v23;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", buf, 2u);
      }
    }
  }
}

- (void)cloudStoreStatusWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device cloud store status", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_cloudStoreStatusWithCompletion___block_invoke;
  v10[3] = &unk_279945530;
  v10[4] = self;
  v11 = completionCopy;
  v9 = completionCopy;
  dispatch_sync(internalQueue, v10);
}

void __76__NPKPaymentWebServiceCompanionTargetDevice_cloudStoreStatusWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoCloudStoreStatusRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoCloudStoreStatusRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:39 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D185A0];
  v27[0] = MEMORY[0x277CBEC38];
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_cloudStoreStatusWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __76__NPKPaymentWebServiceCompanionTargetDevice_cloudStoreStatusWithCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0, a2);
  }

  return result;
}

- (void)downloadAllPaymentPasses:(id)passes
{
  v13 = *MEMORY[0x277D85DE8];
  passesCopy = passes;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [passesCopy npkDescription];
      v11 = 138412290;
      v12 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device download all payment passes: incoming protobuf %@", &v11, 0xCu);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate handleDownloadAllPaymentPasses];

  v10 = *MEMORY[0x277D85DE8];
}

- (void)checkCompanionPeerPaymentRegistrationState:(id)state
{
  v13 = *MEMORY[0x277D85DE8];
  stateCopy = state;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [stateCopy npkDescription];
      v11 = 138412290;
      v12 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device check companion peer payment registration state: incoming protobuf %@", &v11, 0xCu);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate checkCompanionPeerPaymentRegistrationState];

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)felicaSecureElementIsAvailable
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"6C4614A2-1ECC-4405-9FEE-B5F0A5666961"];
  v4 = [v2 supportsCapability:v3];

  return v4;
}

- (BOOL)isGymKitEnabled
{
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSimultaneousSinglePollingAndGymKitSupported])
  {
    return 0;
  }

  return NPKIsGymKitEnabled();
}

- (id)upgradeRequestForPass:(id)pass
{
  v24 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      uniqueID = [passCopy uniqueID];
      v20 = 138412290;
      v21 = uniqueID;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device: handling upgrade request for pass %@", &v20, 0xCu);
    }
  }

  v9 = [(NPKPaymentWebServiceCompanionTargetDevice *)self _eligibleExpressUpgradeRequestsForPass:passCopy];
  v10 = [v9 count];
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        uniqueID2 = [passCopy uniqueID];
        v20 = 138412546;
        v21 = v9;
        v22 = 2112;
        v23 = uniqueID2;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device: found eligible requests (%@) for pass %@. Returning first object.", &v20, 0x16u);
      }
    }

    firstObject = [v9 firstObject];
  }

  else
  {
    if (v12)
    {
      v16 = pk_Payment_log();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        uniqueID3 = [passCopy uniqueID];
        v20 = 138412290;
        v21 = uniqueID3;
        _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: Target device: no eligible upgrade requests found for pass %@", &v20, 0xCu);
      }
    }

    firstObject = 0;
  }

  v18 = *MEMORY[0x277D85DE8];

  return firstObject;
}

- (void)paymentWebService:(id)service handlePotentialExpressPass:(id)pass withCompletionHandler:(id)handler
{
  v20 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  passCopy = pass;
  handlerCopy = handler;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (handlerCopy)
  {
    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        uniqueID = [passCopy uniqueID];
        v18 = 138412290;
        v19 = uniqueID;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device: handling potential express pass %@", &v18, 0xCu);
      }
    }

    v15 = [(NPKPaymentWebServiceCompanionTargetDevice *)self _expressPassConfigurationForPaymentPass:passCopy];
    if ([(NPKPaymentWebServiceCompanionTargetDevice *)self deviceSupportMultipleExpressPasses])
    {
      [(NPKPaymentWebServiceCompanionTargetDevice *)self _multipleExpressTransitPassPaymentWebService:serviceCopy handlePotentialExpressPassConfiguration:v15 pass:passCopy withCompletionHandler:handlerCopy];
    }

    else
    {
      [(NPKPaymentWebServiceCompanionTargetDevice *)self _singleExpressTransitPassPaymentWebService:serviceCopy handlePotentialExpressPassConfiguration:v15 withCompletionHandler:handlerCopy];
    }

LABEL_12:

    goto LABEL_13;
  }

  if (v12)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      uniqueID2 = [passCopy uniqueID];
      v18 = 138412290;
      v19 = uniqueID2;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device: missing complition block will not handling potential express pass %@", &v18, 0xCu);
    }

    goto LABEL_12;
  }

LABEL_13:

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_multipleExpressTransitPassPaymentWebService:(id)service handlePotentialExpressPassConfiguration:(id)configuration pass:(id)pass withCompletionHandler:(id)handler
{
  serviceCopy = service;
  configurationCopy = configuration;
  passCopy = pass;
  handlerCopy = handler;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __157__NPKPaymentWebServiceCompanionTargetDevice__multipleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_pass_withCompletionHandler___block_invoke;
  aBlock[3] = &unk_279945A98;
  objc_copyWeak(&v27, &location);
  v14 = configurationCopy;
  v25 = v14;
  v15 = handlerCopy;
  v26 = v15;
  v16 = _Block_copy(aBlock);
  v17 = v16;
  if (v14)
  {
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __157__NPKPaymentWebServiceCompanionTargetDevice__multipleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_pass_withCompletionHandler___block_invoke_641;
    v20[3] = &unk_27994A238;
    v22 = v16;
    v21 = passCopy;
    v23 = v15;
    [(NPKPaymentWebServiceCompanionTargetDevice *)self _checkConflictsForPass:v21 withConfiguration:v14 webService:serviceCopy hasDisqualifyingConflicts:v20];
  }

  else
  {
    devicePrimaryContactlessPaymentApplication = [passCopy devicePrimaryContactlessPaymentApplication];
    [devicePrimaryContactlessPaymentApplication paymentNetworkIdentifier];
    v19 = PKIsOpenLoopCredentialType();

    if (v19)
    {
      [(NPKPaymentWebServiceCompanionTargetDevice *)self _handleOpenLoopPassUpgradeWithPass:passCopy webService:serviceCopy completion:v15];
    }
  }

  objc_destroyWeak(&v27);
  objc_destroyWeak(&location);
}

void __157__NPKPaymentWebServiceCompanionTargetDevice__multipleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_pass_withCompletionHandler___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v3 = *(a1 + 32);
    v4[0] = MEMORY[0x277D85DD0];
    v4[1] = 3221225472;
    v4[2] = __157__NPKPaymentWebServiceCompanionTargetDevice__multipleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_pass_withCompletionHandler___block_invoke_2;
    v4[3] = &unk_27994A210;
    objc_copyWeak(&v6, (a1 + 48));
    v5 = *(a1 + 40);
    [WeakRetained setExpressWithPassConfiguration:v3 requestAuthorization:0 completion:v4];

    objc_destroyWeak(&v6);
  }
}

void __157__NPKPaymentWebServiceCompanionTargetDevice__multipleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_pass_withCompletionHandler___block_invoke_2(uint64_t a1, uint64_t a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v7 = pk_General_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_General_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v12 = 134218242;
      v13 = a2;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: did finish handle potential express pass with result %lu, current express passes information: %@", &v12, 0x16u);
    }
  }

  if (a2 == 1)
  {
    v10 = [WeakRetained _expressModesFromExpressPassConfigurations:v5];
  }

  else
  {
    v10 = 0;
  }

  (*(*(a1 + 32) + 16))();

  v11 = *MEMORY[0x277D85DE8];
}

uint64_t __157__NPKPaymentWebServiceCompanionTargetDevice__multipleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_pass_withCompletionHandler___block_invoke_641(uint64_t a1, char a2)
{
  v14 = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = pk_General_log();
    v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

    if (v4)
    {
      v5 = pk_General_log();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
      {
        v6 = [*(a1 + 32) uniqueID];
        v12 = 138412290;
        v13 = v6;
        _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Found conflicts for pass %@", &v12, 0xCu);
      }
    }

    result = (*(*(a1 + 48) + 16))();
    v8 = *MEMORY[0x277D85DE8];
  }

  else
  {
    v9 = *(a1 + 40);
    v10 = *(*(a1 + 40) + 16);
    v11 = *MEMORY[0x277D85DE8];

    return v10();
  }

  return result;
}

- (void)_singleExpressTransitPassPaymentWebService:(id)service handlePotentialExpressPassConfiguration:(id)configuration withCompletionHandler:(id)handler
{
  v71 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  configurationCopy = configuration;
  handlerCopy = handler;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      passUniqueIdentifier = [configurationCopy passUniqueIdentifier];
      *buf = 138412290;
      v70 = passUniqueIdentifier;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device: legacy handling potential express pass %@", buf, 0xCu);
    }
  }

  if (!configurationCopy)
  {
    v49 = pk_Payment_log();
    v50 = os_log_type_enabled(v49, OS_LOG_TYPE_DEFAULT);

    if (!v50)
    {
LABEL_36:
      handlerCopy[2](handlerCopy, 0);
      goto LABEL_43;
    }

    v47 = pk_Payment_log();
    if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v47, OS_LOG_TYPE_DEFAULT, "Notice: _singleExpressTransitPassPaymentWebService called with nil configuration", buf, 2u);
    }

LABEL_35:

    goto LABEL_36;
  }

  passInformation = [configurationCopy passInformation];
  cardType = [passInformation cardType];

  if (cardType == 2)
  {
    v58 = handlerCopy;
    v17 = NPKPairedDeviceExpressPassConfigurationWithCardType(2);
    if ([v17 count])
    {
      v18 = pk_General_log();
      v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

      if (v19)
      {
        v20 = pk_General_log();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
        {
          v21 = [v17 count];
          *buf = 134217984;
          v70 = v21;
          _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Notice: Current existing express pass configuration count:%lu", buf, 0xCu);
        }
      }

      passUniqueIdentifier2 = [configurationCopy passUniqueIdentifier];
      v23 = [(NPKPaymentWebServiceCompanionTargetDevice *)self paymentWebService:serviceCopy passesOfType:1];
      v24 = MEMORY[0x277CCAC30];
      v65[0] = MEMORY[0x277D85DD0];
      v65[1] = 3221225472;
      v65[2] = __150__NPKPaymentWebServiceCompanionTargetDevice__singleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_withCompletionHandler___block_invoke;
      v65[3] = &unk_27994A260;
      v66 = passUniqueIdentifier2;
      v67 = v23;
      v25 = configurationCopy;
      v26 = serviceCopy;
      v27 = v23;
      v28 = passUniqueIdentifier2;
      v29 = [v24 predicateWithBlock:v65];
      v30 = [v17 filteredSetUsingPredicate:v29];

      serviceCopy = v26;
      configurationCopy = v25;

      v17 = v30;
    }

    v31 = pk_General_log();
    v32 = os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT);

    if (v32)
    {
      v33 = pk_General_log();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
      {
        v34 = [v17 count];
        *buf = 134217984;
        v70 = v34;
        _os_log_impl(&dword_25B300000, v33, OS_LOG_TYPE_DEFAULT, "Notice: filtered existing express pass information count:%lu", buf, 0xCu);
      }
    }

    if ([v17 count])
    {
      v56 = configurationCopy;
      v57 = serviceCopy;
      v63 = 0u;
      v64 = 0u;
      v61 = 0u;
      v62 = 0u;
      v35 = v17;
      v36 = [v35 countByEnumeratingWithState:&v61 objects:v68 count:16];
      if (v36)
      {
        v37 = v36;
        v38 = *v62;
        do
        {
          for (i = 0; i != v37; ++i)
          {
            if (*v62 != v38)
            {
              objc_enumerationMutation(v35);
            }

            v40 = *(*(&v61 + 1) + 8 * i);
            v41 = pk_Payment_log();
            v42 = os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT);

            if (v42)
            {
              v43 = pk_Payment_log();
              if (os_log_type_enabled(v43, OS_LOG_TYPE_DEFAULT))
              {
                passUniqueIdentifier3 = [v40 passUniqueIdentifier];
                *buf = 138412290;
                v70 = passUniqueIdentifier3;
                _os_log_impl(&dword_25B300000, v43, OS_LOG_TYPE_DEFAULT, "Notice: Not setting pass as express due to existing express pass with unique ID %@", buf, 0xCu);
              }
            }
          }

          v37 = [v35 countByEnumeratingWithState:&v61 objects:v68 count:16];
        }

        while (v37);
      }

      v45 = pk_Payment_log();
      v46 = os_log_type_enabled(v45, OS_LOG_TYPE_DEFAULT);

      configurationCopy = v56;
      serviceCopy = v57;
      handlerCopy = v58;
      if (!v46)
      {
        goto LABEL_36;
      }

      v47 = pk_Payment_log();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
      {
        passUniqueIdentifier4 = [v56 passUniqueIdentifier];
        *buf = 138412290;
        v70 = passUniqueIdentifier4;
        _os_log_impl(&dword_25B300000, v47, OS_LOG_TYPE_DEFAULT, "Notice: Could not handle protential express pass with unique ID %@.", buf, 0xCu);
      }

      goto LABEL_35;
    }

    handlerCopy = v58;
  }

  v51 = pk_General_log();
  v52 = os_log_type_enabled(v51, OS_LOG_TYPE_DEFAULT);

  if (v52)
  {
    v53 = pk_General_log();
    if (os_log_type_enabled(v53, OS_LOG_TYPE_DEFAULT))
    {
      passUniqueIdentifier5 = [configurationCopy passUniqueIdentifier];
      *buf = 138412290;
      v70 = passUniqueIdentifier5;
      _os_log_impl(&dword_25B300000, v53, OS_LOG_TYPE_DEFAULT, "Notice: Will handle potential express pass with unique ID %@", buf, 0xCu);
    }
  }

  v59[0] = MEMORY[0x277D85DD0];
  v59[1] = 3221225472;
  v59[2] = __150__NPKPaymentWebServiceCompanionTargetDevice__singleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_withCompletionHandler___block_invoke_646;
  v59[3] = &unk_27994A288;
  v59[4] = self;
  v60 = handlerCopy;
  [(NPKPaymentWebServiceCompanionTargetDevice *)self setExpressWithPassConfiguration:configurationCopy requestAuthorization:0 completion:v59];

LABEL_43:
  v55 = *MEMORY[0x277D85DE8];
}

uint64_t __150__NPKPaymentWebServiceCompanionTargetDevice__singleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_withCompletionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = [v5 passUniqueIdentifier];
  v26 = 0;
  v27 = &v26;
  v28 = 0x2020000000;
  v29 = 0;
  if (![*(a1 + 32) isEqualToString:v7])
  {
    v11 = *(a1 + 40);
    v20 = MEMORY[0x277D85DD0];
    v21 = 3221225472;
    v22 = __150__NPKPaymentWebServiceCompanionTargetDevice__singleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_withCompletionHandler___block_invoke_643;
    v23 = &unk_279945330;
    v12 = v5;
    v24 = v12;
    v25 = &v26;
    [v11 enumerateObjectsUsingBlock:&v20];
    if ((v27[3] & 1) == 0)
    {
      v13 = pk_Payment_log();
      v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

      if (v14)
      {
        v15 = pk_Payment_log();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          v16 = [v12 passUniqueIdentifier:v20];
          *buf = 138412290;
          v31 = v16;
          _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Inconsistency found. Pass with uniqueID: %@ not found in the DB, we will ignore it from the current express pass configuration", buf, 0xCu);
        }
      }
    }

    v10 = v24;
    goto LABEL_11;
  }

  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v31 = v7;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Inconsistency found. express pass information with Pass uniqueID: %@ match potential express pass uniqueID, we will ignore it from the current express pass information", buf, 0xCu);
    }

LABEL_11:
  }

  v17 = *(v27 + 24);
  _Block_object_dispose(&v26, 8);

  v18 = *MEMORY[0x277D85DE8];
  return v17 & 1;
}

void __150__NPKPaymentWebServiceCompanionTargetDevice__singleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_withCompletionHandler___block_invoke_643(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v6 = [a2 uniqueID];
  v7 = [*(a1 + 32) passUniqueIdentifier];
  v8 = [v6 isEqualToString:v7];

  if (v8)
  {
    *(*(*(a1 + 40) + 8) + 24) = 1;
    *a4 = 1;
  }
}

void __150__NPKPaymentWebServiceCompanionTargetDevice__singleExpressTransitPassPaymentWebService_handlePotentialExpressPassConfiguration_withCompletionHandler___block_invoke_646(uint64_t a1, uint64_t a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = pk_General_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_General_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v12 = 134218242;
      v13 = a2;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: did finish handle potential express pass with result %lu, current express passes configuration: %@", &v12, 0x16u);
    }
  }

  v9 = *(a1 + 40);
  if (v9)
  {
    if (a2 == 1)
    {
      v10 = [*(a1 + 32) _expressModesFromExpressPassConfigurations:v5];
      v9 = *(a1 + 40);
    }

    else
    {
      v10 = 0;
    }

    (*(v9 + 16))(v9, v10);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebService:(id)service canHandlePotentialExpressPass:(id)pass withCompletionHandler:(id)handler
{
  v31 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  passCopy = pass;
  handlerCopy = handler;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      uniqueID = [passCopy uniqueID];
      *buf = 138412290;
      v30 = uniqueID;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device: can handle potential express pass %@", buf, 0xCu);
    }
  }

  if (handlerCopy)
  {
    if (![(NPKPaymentWebServiceCompanionTargetDevice *)self deviceSupportMultipleExpressPasses])
    {
      v15 = pk_Payment_log();
      v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

      if (v16)
      {
        v17 = pk_Payment_log();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device doesn't support Multiple express passes, we will not handle this call.", buf, 2u);
        }
      }

      handlerCopy[2](handlerCopy, 0);
    }

    v18 = [(NPKPaymentWebServiceCompanionTargetDevice *)self _expressPassConfigurationForPaymentPass:passCopy];
    if (v18)
    {
      v26[0] = MEMORY[0x277D85DD0];
      v26[1] = 3221225472;
      v26[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canHandlePotentialExpressPass_withCompletionHandler___block_invoke;
      v26[3] = &unk_2799451F0;
      v28 = handlerCopy;
      v18 = v18;
      v27 = v18;
      [(NPKPaymentWebServiceCompanionTargetDevice *)self _checkConflictsForPass:passCopy withConfiguration:v18 webService:serviceCopy hasDisqualifyingConflicts:v26];
    }

    else
    {
      v22 = pk_Payment_log();
      v23 = os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT);

      if (v23)
      {
        v24 = pk_Payment_log();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v30 = passCopy;
          _os_log_impl(&dword_25B300000, v24, OS_LOG_TYPE_DEFAULT, "Notice: Could not create configuration for pass %@", buf, 0xCu);
        }
      }

      handlerCopy[2](handlerCopy, 0);
    }

LABEL_22:

    goto LABEL_23;
  }

  v19 = pk_Payment_log();
  v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

  if (v20)
  {
    v18 = pk_Payment_log();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      uniqueID2 = [passCopy uniqueID];
      *buf = 138412290;
      v30 = uniqueID2;
      _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Notice: Target device: missing completion block will not check if can handle potential express pass %@", buf, 0xCu);
    }

    goto LABEL_22;
  }

LABEL_23:

  v25 = *MEMORY[0x277D85DE8];
}

void __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canHandlePotentialExpressPass_withCompletionHandler___block_invoke(uint64_t a1, int a2)
{
  v2 = *(a1 + 40);
  if (a2)
  {
    v3 = *(v2 + 16);
    v4 = *(a1 + 40);

    v3(v4, 0);
  }

  else
  {
    v5 = [*(a1 + 32) passInformation];
    (*(v2 + 16))(v2, v5);
  }
}

- (id)_dummyExpressPassInformationForPass:(id)pass fromUpgradeRequest:(id)request
{
  v19 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  requestCopy = request;
  if (requestCopy)
  {
    if ([MEMORY[0x277D37E90] instancesRespondToSelector:sel_initDummyExpressInfoForAutomaticSelectionCriteriaUpgradeRequest_paymentPass_withTechologyTest_])
    {
      v8 = objc_alloc(MEMORY[0x277D37E90]);
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __100__NPKPaymentWebServiceCompanionTargetDevice__dummyExpressPassInformationForPass_fromUpgradeRequest___block_invoke;
      v16[3] = &unk_27994A2B0;
      v16[4] = self;
      v9 = [v8 initDummyExpressInfoForAutomaticSelectionCriteriaUpgradeRequest:requestCopy paymentPass:passCopy withTechologyTest:v16];
      goto LABEL_9;
    }

    v10 = pk_General_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

    if (v11)
    {
      v12 = pk_General_log();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        uniqueID = [passCopy uniqueID];
        *buf = 138412290;
        v18 = uniqueID;
        _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: SPI not available. Can't create dummy express pass information for pass with uniqueID:%@", buf, 0xCu);
      }
    }
  }

  v9 = 0;
LABEL_9:

  v14 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)_synthesizedExpressPassStateForExpressPassConfiguration:(id)configuration otherPaymentPasses:(id)passes
{
  v31 = *MEMORY[0x277D85DE8];
  configurationCopy = configuration;
  passesCopy = passes;
  v23 = objc_alloc_init(MEMORY[0x277CBEB58]);
  passUniqueIdentifier = [configurationCopy passUniqueIdentifier];
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v8 = passesCopy;
  v9 = [v8 countByEnumeratingWithState:&v24 objects:v30 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v25;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v25 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v24 + 1) + 8 * i);
        v14 = [objc_alloc(MEMORY[0x277D37E90]) initForPaymentPass:v13 withTechologyTest:0];
        uniqueID = [v13 uniqueID];
        v16 = [uniqueID isEqualToString:passUniqueIdentifier];

        if ((v16 & 1) == 0 && v14)
        {
          v17 = [objc_alloc(MEMORY[0x277D37E88]) initWithPassInformation:v14 forSecureElementPass:v13];
          if (v17)
          {
            [v23 addObject:v17];
          }
        }
      }

      v10 = [v8 countByEnumeratingWithState:&v24 objects:v30 count:16];
    }

    while (v10);
  }

  v18 = pk_General_log();
  v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

  if (v19)
  {
    v20 = pk_General_log();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v29 = v23;
      _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Notice: Express passes information to use as reference:%@ from local DB", buf, 0xCu);
    }
  }

  v21 = *MEMORY[0x277D85DE8];

  return v23;
}

- (id)_expressPassConfigurationForPaymentPass:(id)pass
{
  v30 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  v5 = objc_alloc(MEMORY[0x277D37E90]);
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __85__NPKPaymentWebServiceCompanionTargetDevice__expressPassConfigurationForPaymentPass___block_invoke;
  v25[3] = &unk_27994A2B0;
  v25[4] = self;
  v6 = [v5 initForPaymentPass:passCopy withTechologyTest:v25];
  if (v6)
  {
    v7 = v6;
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        devicePrimaryPaymentApplication = [passCopy devicePrimaryPaymentApplication];
        *buf = 138412546;
        v27 = devicePrimaryPaymentApplication;
        v28 = 2112;
        v29 = v7;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Target device: found at given pass with primary payment application:%@ express pass information:%@", buf, 0x16u);
      }
    }
  }

  else
  {
    v12 = NPKPairedDeviceSecureElementIdentifiers();
    NPKIdentifyDevicePaymentApplicationsForPass(passCopy, v12);

    v13 = objc_alloc(MEMORY[0x277D37E90]);
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __85__NPKPaymentWebServiceCompanionTargetDevice__expressPassConfigurationForPaymentPass___block_invoke_2;
    v24[3] = &unk_27994A2B0;
    v24[4] = self;
    v7 = [v13 initForPaymentPass:passCopy withTechologyTest:v24];
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

    if (v15)
    {
      v16 = pk_Payment_log();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        devicePrimaryPaymentApplication2 = [passCopy devicePrimaryPaymentApplication];
        *buf = 138412546;
        v27 = devicePrimaryPaymentApplication2;
        v28 = 2112;
        v29 = v7;
        _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: Target device: found at updated pass with primary payment application:%@ express pass information:%@", buf, 0x16u);
      }
    }

    if (!v7)
    {
      v18 = 0;
      goto LABEL_16;
    }
  }

  v18 = [objc_alloc(MEMORY[0x277D37E88]) initWithPassInformation:v7 forSecureElementPass:passCopy];
  v19 = pk_General_log();
  v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

  if (v20)
  {
    v21 = pk_General_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v27 = v18;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_DEFAULT, "Notice: _expressPassConfigurationForPaymentPass created config %@", buf, 0xCu);
    }
  }

LABEL_16:
  v22 = *MEMORY[0x277D85DE8];

  return v18;
}

- (id)_eligibleExpressUpgradeRequestsForPass:(id)pass
{
  v17 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  deviceClass = [(NPKPaymentWebServiceCompanionTargetDevice *)self deviceClass];
  deviceVersion = [(NPKPaymentWebServiceCompanionTargetDevice *)self deviceVersion];
  secureElementIdentifiers = [(NPKPaymentWebServiceCompanionTargetDevice *)self secureElementIdentifiers];
  if ([secureElementIdentifiers count])
  {
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __84__NPKPaymentWebServiceCompanionTargetDevice__eligibleExpressUpgradeRequestsForPass___block_invoke;
    v14[3] = &unk_27994A2B0;
    v14[4] = self;
    v8 = [passCopy eligibleExpressUpgradeRequestsForDeviceClass:deviceClass deviceSEIDs:secureElementIdentifiers deviceVersion:deviceVersion technologyTest:v14];
  }

  else
  {
    v9 = pk_General_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

    if (v10)
    {
      v11 = pk_General_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 136315138;
        v16 = "[NPKPaymentWebServiceCompanionTargetDevice _eligibleExpressUpgradeRequestsForPass:]";
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Warning: Unable to get device SEID in %s", buf, 0xCu);
      }
    }

    v8 = 0;
  }

  v12 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)_checkConflictsForPass:(id)pass withConfiguration:(id)configuration webService:(id)service hasDisqualifyingConflicts:(id)conflicts
{
  v28 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  configurationCopy = configuration;
  conflictsCopy = conflicts;
  if (conflictsCopy)
  {
    v13 = [(NPKPaymentWebServiceCompanionTargetDevice *)self paymentWebService:service passesOfType:1];
    if ([v13 count])
    {
      v14 = [(NPKPaymentWebServiceCompanionTargetDevice *)self _synthesizedExpressPassStateForExpressPassConfiguration:configurationCopy otherPaymentPasses:v13];
      v21[0] = MEMORY[0x277D85DD0];
      v21[1] = 3221225472;
      v21[2] = __123__NPKPaymentWebServiceCompanionTargetDevice__checkConflictsForPass_withConfiguration_webService_hasDisqualifyingConflicts___block_invoke;
      v21[3] = &unk_27994A2D8;
      v21[4] = self;
      v22 = passCopy;
      v13 = v13;
      v23 = v13;
      v24 = configurationCopy;
      v25 = conflictsCopy;
      [(NPKPaymentWebServiceCompanionTargetDevice *)self conflictingExpressPassIdentifiersForPassConfiguration:v24 withReferenceExpressState:v14 completion:v21];
    }

    else
    {
      v17 = pk_General_log();
      v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

      if (v18)
      {
        v19 = pk_General_log();
        if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: No payment passes found, should be no conflicts.", buf, 2u);
        }
      }

      (*(conflictsCopy + 2))(conflictsCopy, 0);
    }

LABEL_12:

    goto LABEL_13;
  }

  v15 = pk_General_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v13 = pk_General_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 136315138;
      v27 = "[NPKPaymentWebServiceCompanionTargetDevice _checkConflictsForPass:withConfiguration:webService:hasDisqualifyingConflicts:]";
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: %s will not proceed with nil completion.", buf, 0xCu);
    }

    goto LABEL_12;
  }

LABEL_13:

  v20 = *MEMORY[0x277D85DE8];
}

void __123__NPKPaymentWebServiceCompanionTargetDevice__checkConflictsForPass_withConfiguration_webService_hasDisqualifyingConflicts___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v50 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if ([v5 count])
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (!v8)
    {
      goto LABEL_39;
    }

    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = [*(a1 + 56) passUniqueIdentifier];
      *buf = 138412546;
      v46 = v5;
      v47 = 2112;
      v48 = v10;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: express passes setup in express mode:%@ conflict with given pass. Will not set in express mode pass with uniqueID:%@", buf, 0x16u);
    }
  }

  else
  {
    if (![v6 count])
    {
      goto LABEL_39;
    }

    v11 = pk_General_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_General_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Checking Conflicting reference passes", buf, 2u);
      }
    }

    v38 = v5;
    v14 = [*(a1 + 32) _categoryIdentifierForPass:*(a1 + 40)];
    v41 = 0u;
    v42 = 0u;
    v43 = 0u;
    v44 = 0u;
    v15 = *(a1 + 48);
    v16 = [v15 countByEnumeratingWithState:&v41 objects:v49 count:16];
    v39 = v14;
    if (v16)
    {
      v17 = v16;
      v18 = *v42;
      v40 = v6;
      while (2)
      {
        for (i = 0; i != v17; ++i)
        {
          if (*v42 != v18)
          {
            objc_enumerationMutation(v15);
          }

          v20 = *(*(&v41 + 1) + 8 * i);
          v21 = [v20 uniqueID];
          v22 = [v6 containsObject:v21];

          if (v22)
          {
            v23 = [*(a1 + 32) _categoryIdentifierForPass:v20];
            if (PKEqualObjects())
            {
              v24 = v15;
              v25 = [v20 isPeerPaymentPass];
              v26 = pk_General_log();
              v27 = os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT);

              if (!v25)
              {
                v5 = v38;
                v9 = v39;
                v32 = v24;
                if (v27)
                {
                  v35 = pk_General_log();
                  if (os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT))
                  {
                    v36 = [v20 uniqueID];
                    *buf = 138412546;
                    v46 = v23;
                    v47 = 2112;
                    v48 = v36;
                    _os_log_impl(&dword_25B300000, v35, OS_LOG_TYPE_DEFAULT, "Notice: Found conflicting category:%@ for pass with unique ID:%@", buf, 0x16u);

                    v32 = v24;
                  }
                }

                v6 = v40;
                goto LABEL_36;
              }

              v15 = v24;
              if (v27)
              {
                v28 = pk_General_log();
                if (os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT))
                {
                  v29 = [v20 uniqueID];
                  *buf = 138412290;
                  v46 = v29;
                  _os_log_impl(&dword_25B300000, v28, OS_LOG_TYPE_DEFAULT, "Notice: Found peer payment pass with uniqueID:%@ conflicting with new pass. Will ignore it", buf, 0xCu);

                  v15 = v24;
                }
              }
            }

            v6 = v40;
          }
        }

        v17 = [v15 countByEnumeratingWithState:&v41 objects:v49 count:16];
        if (v17)
        {
          continue;
        }

        break;
      }
    }

    v30 = pk_General_log();
    v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

    if (v31)
    {
      v32 = pk_General_log();
      v5 = v38;
      if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
      {
        [*(a1 + 56) passUniqueIdentifier];
        v34 = v33 = v32;
        *buf = 138412546;
        v9 = v39;
        v46 = v39;
        v47 = 2112;
        v48 = v34;
        _os_log_impl(&dword_25B300000, v33, OS_LOG_TYPE_DEFAULT, "Notice: Conflicting reference passes doesn't belong to the same express category:%@. Will handle potential express pass with unique ID %@", buf, 0x16u);

        v32 = v33;
      }

      else
      {
        v9 = v39;
      }

LABEL_36:
    }

    else
    {
      v5 = v38;
      v9 = v39;
    }
  }

LABEL_39:
  (*(*(a1 + 64) + 16))();

  v37 = *MEMORY[0x277D85DE8];
}

- (void)_handleOpenLoopPassUpgradeWithPass:(id)pass webService:(id)service completion:(id)completion
{
  v36 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  serviceCopy = service;
  completionCopy = completion;
  if (completionCopy)
  {
    v11 = [(NPKPaymentWebServiceCompanionTargetDevice *)self upgradeRequestForPass:passCopy];
    if (v11)
    {
      v12 = [(NPKPaymentWebServiceCompanionTargetDevice *)self _dummyExpressPassInformationForPass:passCopy fromUpgradeRequest:v11];
      if (v12)
      {
        v13 = objc_alloc(MEMORY[0x277D37E88]);
        devicePaymentApplications = [passCopy devicePaymentApplications];
        v15 = [v13 initWithPassInformation:v12 forPaymentApplications:devicePaymentApplications];

        v28[0] = MEMORY[0x277D85DD0];
        v28[1] = 3221225472;
        v28[2] = __102__NPKPaymentWebServiceCompanionTargetDevice__handleOpenLoopPassUpgradeWithPass_webService_completion___block_invoke;
        v28[3] = &unk_27994A328;
        v29 = passCopy;
        selfCopy = self;
        v31 = v11;
        v32 = v15;
        v33 = completionCopy;
        v16 = v15;
        [(NPKPaymentWebServiceCompanionTargetDevice *)self _checkConflictsForPass:v29 withConfiguration:v16 webService:serviceCopy hasDisqualifyingConflicts:v28];
      }

      else
      {
        v23 = pk_General_log();
        v24 = os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT);

        if (v24)
        {
          v25 = pk_General_log();
          if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
          {
            uniqueID = [passCopy uniqueID];
            *buf = 138412290;
            v35 = uniqueID;
            _os_log_impl(&dword_25B300000, v25, OS_LOG_TYPE_DEFAULT, "Notice: Invalid upgrade request on pass %@, could not create test express info", buf, 0xCu);
          }
        }

        (*(completionCopy + 2))(completionCopy, 0);
      }
    }

    else
    {
      v19 = pk_General_log();
      v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

      if (v20)
      {
        v21 = pk_General_log();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
        {
          uniqueID2 = [passCopy uniqueID];
          *buf = 138412290;
          v35 = uniqueID2;
          _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_DEFAULT, "Notice: No upgrade request for pass %@", buf, 0xCu);
        }
      }

      (*(completionCopy + 2))(completionCopy, 0);
    }

LABEL_19:

    goto LABEL_20;
  }

  v17 = pk_General_log();
  v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

  if (v18)
  {
    v11 = pk_General_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 136315138;
      v35 = "[NPKPaymentWebServiceCompanionTargetDevice _handleOpenLoopPassUpgradeWithPass:webService:completion:]";
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Warning: %s will not continue with nil completion.", buf, 0xCu);
    }

    goto LABEL_19;
  }

LABEL_20:

  v27 = *MEMORY[0x277D85DE8];
}

void __102__NPKPaymentWebServiceCompanionTargetDevice__handleOpenLoopPassUpgradeWithPass_webService_completion___block_invoke(uint64_t a1, char a2)
{
  v21 = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = pk_General_log();
    v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

    if (v4)
    {
      v5 = pk_General_log();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
      {
        v6 = [*(a1 + 32) uniqueID];
        LODWORD(buf) = 138412290;
        *(&buf + 4) = v6;
        _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Pass %@ upgrade request has potential conflicts, not upgrading for express", &buf, 0xCu);
      }
    }

    (*(*(a1 + 64) + 16))();
  }

  else
  {
    if (NPKIsRunningInNPKCompanionAgent())
    {
      v7 = [*(a1 + 32) isAppleCardPass];
    }

    else
    {
      v7 = 0;
    }

    *&buf = 0;
    *(&buf + 1) = &buf;
    v19 = 0x2020000000;
    v20 = 0;
    v9 = *(a1 + 40);
    v8 = *(a1 + 48);
    v10 = *(a1 + 32);
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __102__NPKPaymentWebServiceCompanionTargetDevice__handleOpenLoopPassUpgradeWithPass_webService_completion___block_invoke_2;
    v14[3] = &unk_27994A300;
    p_buf = &buf;
    v11 = *(a1 + 64);
    v12 = *(a1 + 40);
    v16 = v11;
    v14[4] = v12;
    v15 = *(a1 + 56);
    [v9 remotePassUpgradeWithRequest:v8 pass:v10 requireAuthorization:0 notifyUserOnPairedDevice:v7 updateBlock:v14];

    _Block_object_dispose(&buf, 8);
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __102__NPKPaymentWebServiceCompanionTargetDevice__handleOpenLoopPassUpgradeWithPass_webService_completion___block_invoke_2(void *a1, void *a2, void *a3, uint64_t a4, unint64_t a5)
{
  v28 = *MEMORY[0x277D85DE8];
  v8 = a2;
  v9 = a3;
  v10 = pk_General_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_General_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = [v9 uniqueID];
      v14 = NSStringFromNPKRemotePassUpgradeStatus(a5);
      v20 = 138413058;
      v21 = v13;
      v22 = 2112;
      v23 = v14;
      v24 = 2112;
      v25 = v9;
      v26 = 2112;
      v27 = v8;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target Device: handle potential express pass received Remote pass upgrade updated for pass with uniqueID:%@ received, Status:%@ updatedPass:%@ error:%@", &v20, 0x2Au);
    }
  }

  v15 = *(a1[7] + 8);
  if ((*(v15 + 24) & 1) == 0 && a1[6])
  {
    *(v15 + 24) = 1;
    if (v8)
    {
      v16 = 0;
    }

    else
    {
      v17 = a1[4];
      v18 = [MEMORY[0x277CBEB98] setWithObject:a1[5]];
      v16 = [v17 _expressModesFromExpressPassConfigurations:v18];
    }

    (*(a1[6] + 16))();
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)sendPaymentOptionsDefaultsToWatch
{
  v21[2] = *MEMORY[0x277D85DE8];
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      LOWORD(v18) = 0;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Sending updated payment options defaults to watch", &v18, 2u);
    }
  }

  v6 = +[NPKPaymentOptionsSerialization setTransactionDefaultsRequest];
  v7 = objc_alloc(MEMORY[0x277D189F0]);
  data = [v6 data];
  v9 = [v7 initWithProtobufData:data type:23 isResponse:0];

  v20[0] = *MEMORY[0x277D18650];
  v10 = [MEMORY[0x277CCABB0] numberWithDouble:*MEMORY[0x277D18828]];
  v20[1] = *MEMORY[0x277D18630];
  v21[0] = v10;
  v21[1] = @"NPKTransactionDefaultsQueueOne";
  v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v21 forKeys:v20 count:2];

  provisioningService = [(NPKPaymentWebServiceCompanionTargetDevice *)self provisioningService];
  v13 = NPKProtoSendWithOptions(provisioningService, v9, 200, 0, 0, &__block_literal_global_656, v11);

  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v16 = pk_Payment_log();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
      v18 = 138412290;
      v19 = v13;
      _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: Sent updated payment options defaults to watch with message ID %@", &v18, 0xCu);
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __78__NPKPaymentWebServiceCompanionTargetDevice_sendPaymentOptionsDefaultsToWatch__block_invoke(uint64_t a1, void *a2)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = a2;
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_ERROR);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
    {
      v7 = 138412290;
      v8 = v2;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_ERROR, "Error: Failed to send updated payment options defaults to watch %@!", &v7, 0xCu);
    }
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (void)sendWebServiceContextToWatch:(id)watch
{
  v39 = *MEMORY[0x277D85DE8];
  watchCopy = watch;
  if (NPKIsCompanionMigrationNeeded() && ([watchCopy registrationDate], v5 = objc_claimAutoreleasedReturnValue(), v5, !v5))
  {
    v28 = pk_Payment_log();
    v29 = os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT);

    if (v29)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(&v15->super.super.super, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v34 = watchCopy;
        v27 = "Warning: Not sending unregistered web service context to watch (%@) while companion migration is needed";
        goto LABEL_23;
      }

LABEL_24:
    }
  }

  else
  {
    v6 = NPKPairedDeviceSecureElementIdentifiers();
    v7 = NPKValidatePaymentWebServiceContextAgainstWatchSEIDs(watchCopy, v6);

    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v7)
    {
      if (v9)
      {
        v10 = pk_Payment_log();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          primaryRegion = [watchCopy primaryRegion];
          applyServiceURL = [primaryRegion applyServiceURL];
          primaryRegion2 = [watchCopy primaryRegion];
          v14 = @"YES";
          *buf = 138412802;
          v34 = watchCopy;
          v35 = 2112;
          if (!primaryRegion2)
          {
            v14 = @"NO";
          }

          v36 = applyServiceURL;
          v37 = 2112;
          v38 = v14;
          _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-context) Sending web service context to watch: %@ applyServiceURL %@ primaryRegion %@", buf, 0x20u);
        }
      }

      v15 = objc_alloc_init(NPKProtoWebServiceContextDidChangeRequest);
      v16 = NPKSecureArchiveObject(watchCopy);
      if (v16)
      {
        [(NPKProtoWebServiceContextDidChangeRequest *)v15 setWebServiceContextBytes:v16];
      }

      v17 = objc_alloc(MEMORY[0x277D189F0]);
      data = [(NPKProtoWebServiceContextDidChangeRequest *)v15 data];
      v19 = [v17 initWithProtobufData:data type:17 isResponse:0];

      v20 = [MEMORY[0x277CCABB0] numberWithDouble:{*MEMORY[0x277D18828], *MEMORY[0x277D18650]}];
      v31[1] = *MEMORY[0x277D18630];
      v32[0] = v20;
      v32[1] = @"NPKWebServiceContextQueueOne";
      v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v32 forKeys:v31 count:2];

      provisioningService = [(NPKPaymentWebServiceCompanionTargetDevice *)self provisioningService];
      v23 = NPKProtoSendWithOptions(provisioningService, v19, 200, 0, 0, &__block_literal_global_662, v21);

      v24 = pk_Payment_log();
      v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

      if (v25)
      {
        v26 = pk_Payment_log();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v34 = v23;
          _os_log_impl(&dword_25B300000, v26, OS_LOG_TYPE_DEFAULT, "Notice: Sent web service context to watch with message ID %@", buf, 0xCu);
        }
      }

      goto LABEL_24;
    }

    if (v9)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(&v15->super.super.super, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v34 = watchCopy;
        v27 = "Warning: Not sending invalid web service context to watch (%@)";
LABEL_23:
        _os_log_impl(&dword_25B300000, &v15->super.super.super, OS_LOG_TYPE_DEFAULT, v27, buf, 0xCu);
        goto LABEL_24;
      }

      goto LABEL_24;
    }
  }

  v30 = *MEMORY[0x277D85DE8];
}

void __74__NPKPaymentWebServiceCompanionTargetDevice_sendWebServiceContextToWatch___block_invoke(uint64_t a1, void *a2)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = a2;
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_ERROR);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
    {
      v7 = 138412290;
      v8 = v2;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_ERROR, "Error: Failed to send web service context to watch %@!", &v7, 0xCu);
    }
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (void)handleCompanionMigrationResponse:(id)response
{
  v60 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v56 = 0x3032000000;
  v57 = __Block_byref_object_copy__384;
  v58 = __Block_byref_object_dispose__385;
  v59 = 0;
  v51 = 0;
  v52 = &v51;
  v53 = 0x2020000000;
  v54 = 0;
  v45 = 0;
  v46 = &v45;
  v47 = 0x3032000000;
  v48 = __Block_byref_object_copy__22;
  v49 = __Block_byref_object_dispose__22;
  v50 = 0;
  v39 = 0;
  v40 = &v39;
  v41 = 0x3032000000;
  v42 = __Block_byref_object_copy__22;
  v43 = __Block_byref_object_dispose__22;
  v44 = 0;
  v33 = 0;
  v34 = &v33;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__22;
  v37 = __Block_byref_object_dispose__22;
  v38 = 0;
  v27 = 0;
  v28 = &v27;
  v29 = 0x3032000000;
  v30 = __Block_byref_object_copy__22;
  v31 = __Block_byref_object_dispose__22;
  v32 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__NPKPaymentWebServiceCompanionTargetDevice_handleCompanionMigrationResponse___block_invoke;
    block[3] = &unk_27994A030;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v51;
    v23 = &v45;
    v24 = &v39;
    v25 = &v33;
    v26 = &v27;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v52 + 24), v46[5], v40[5], v34[5], v28[5]);
  }

  _Block_object_dispose(&v27, 8);

  _Block_object_dispose(&v33, 8);
  _Block_object_dispose(&v39, 8);

  _Block_object_dispose(&v45, 8);
  _Block_object_dispose(&v51, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __78__NPKPaymentWebServiceCompanionTargetDevice_handleCompanionMigrationResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCompanionMigratedResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCompanionMigratedResponse *)v5 initWithData:v6];

    if ([(NPKProtoCompanionMigratedResponse *)v7 pending])
    {
      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v11 = [*(a1 + 32) outstandingRequests];
      [v11 removeObjectForKey:*(a1 + 40)];

      v12 = [v4 completionHandler];
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoCompanionMigratedResponse *)v7 success];
      v15 = [(NPKProtoCompanionMigratedResponse *)v7 hasErrorData];
      if (v15)
      {
        v1 = [(NPKProtoCompanionMigratedResponse *)v7 errorData];
        v16 = objc_opt_class();
        v17 = NPKSecureUnarchiveObject(v1, v16);
      }

      else
      {
        v17 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
      if (v15)
      {
      }

      v18 = [(NPKProtoCompanionMigratedResponse *)v7 paymentWebServiceContextData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v18, v19);
      v21 = *(*(a1 + 80) + 8);
      v22 = *(v21 + 40);
      *(v21 + 40) = v20;

      v23 = [(NPKProtoCompanionMigratedResponse *)v7 peerPaymentWebServiceContextData];
      v24 = objc_opt_class();
      v25 = NPKSecureUnarchiveObject(v23, v24);
      v26 = *(*(a1 + 88) + 8);
      v27 = *(v26 + 40);
      *(v26 + 40) = v25;

      v28 = [(NPKProtoCompanionMigratedResponse *)v7 peerPaymentAccountData];
      v29 = objc_opt_class();
      v30 = NPKSecureUnarchiveObject(v28, v29);
      v31 = *(*(a1 + 96) + 8);
      v32 = *(v31 + 40);
      *(v31 + 40) = v30;
    }
  }

  else
  {
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v33[0] = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v33, 2u);
      }
    }
  }
}

- (void)handleCompanionMigrationWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Telling watch to handle companion migration", buf, 2u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_handleCompanionMigrationWithCompletion___block_invoke;
  v10[3] = &unk_279945530;
  v10[4] = self;
  v11 = completionCopy;
  v9 = completionCopy;
  dispatch_sync(internalQueue, v10);
}

void __84__NPKPaymentWebServiceCompanionTargetDevice_handleCompanionMigrationWithCompletion___block_invoke(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoCompanionMigratedRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoCompanionMigratedRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:30 isResponse:0];

  v6 = [*(a1 + 32) _sendProtobuf:v5 responseExpected:1];
  if (v6)
  {
    v7 = *(a1 + 40);
    if (v7)
    {
      v8 = _Block_copy(v7);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_handleCompanionMigrationWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v22 = *(a1 + 40);
      v9 = _Block_copy(aBlock);
      v10 = *(a1 + 32);
      v11 = _Block_copy(v8);
      [v10 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v11 errorHandler:v9];

      v12 = pk_Payment_log();
      LODWORD(v11) = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

      if (v11)
      {
        v13 = pk_Payment_log();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v24 = v6;
          _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Sent companion migration event to watch with message ID %@", buf, 0xCu);
        }
      }
    }

    else
    {
      v19 = pk_Payment_log();
      v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

      if (!v20)
      {
        goto LABEL_15;
      }

      v8 = pk_Payment_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v24 = v6;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Warning: No response identifier for message with identifier %@", buf, 0xCu);
      }
    }

    goto LABEL_14;
  }

  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

  if (v15)
  {
    v16 = pk_Payment_log();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v24 = v5;
      _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
    }
  }

  v17 = *(a1 + 40);
  if (v17)
  {
    v8 = NPKGetIDSCommunicationError();
    (*(v17 + 16))(v17, 0, v8, 0, 0, 0);
LABEL_14:
  }

LABEL_15:

  v18 = *MEMORY[0x277D85DE8];
}

uint64_t __84__NPKPaymentWebServiceCompanionTargetDevice_handleCompanionMigrationWithCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2, 0, 0, 0);
  }

  return result;
}

- (void)handleCompanionPeerPaymentRegistration
{
  v21[2] = *MEMORY[0x277D85DE8];
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      LOWORD(v18) = 0;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Sending companion peer payment registration event to watch", &v18, 2u);
    }
  }

  v6 = objc_alloc_init(NPKProtoHandleCompanionPeerPaymentRegistrationRequest);
  v7 = objc_alloc(MEMORY[0x277D189F0]);
  data = [(NPKProtoHandleCompanionPeerPaymentRegistrationRequest *)v6 data];
  v9 = [v7 initWithProtobufData:data type:36 isResponse:0];

  v20[0] = *MEMORY[0x277D18650];
  v10 = [MEMORY[0x277CCABB0] numberWithDouble:*MEMORY[0x277D18828]];
  v20[1] = *MEMORY[0x277D18630];
  v21[0] = v10;
  v21[1] = @"NPKCompanionPeerPaymentRegistrationQueueOne";
  v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v21 forKeys:v20 count:2];

  provisioningService = [(NPKPaymentWebServiceCompanionTargetDevice *)self provisioningService];
  v13 = NPKProtoSendWithOptions(provisioningService, v9, 200, 0, 0, &__block_literal_global_671, v11);

  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v16 = pk_Payment_log();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
      v18 = 138412290;
      v19 = v13;
      _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: Sent companion peer payment registration event to watch with message ID %@", &v18, 0xCu);
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __83__NPKPaymentWebServiceCompanionTargetDevice_handleCompanionPeerPaymentRegistration__block_invoke(uint64_t a1, void *a2)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = a2;
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_ERROR);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
    {
      v7 = 138412290;
      v8 = v2;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_ERROR, "Error: Failed to send companion peer payment registration event to watch %@!", &v7, 0xCu);
    }
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (void)handleCompanioniCloudSignout
{
  v21[2] = *MEMORY[0x277D85DE8];
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      LOWORD(v18) = 0;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Sending companion iCloud signout event to watch", &v18, 2u);
    }
  }

  v6 = objc_alloc_init(NPKProtoHandleCompanioniCloudSignoutRequest);
  v7 = objc_alloc(MEMORY[0x277D189F0]);
  data = [(NPKProtoHandleCompanioniCloudSignoutRequest *)v6 data];
  v9 = [v7 initWithProtobufData:data type:49 isResponse:0];

  v10 = *MEMORY[0x277D18630];
  v20[0] = *MEMORY[0x277D18650];
  v20[1] = v10;
  v21[0] = &unk_286CE7780;
  v21[1] = @"NPKCompanioniCloudSignoutQueueOne";
  v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v21 forKeys:v20 count:2];
  provisioningService = [(NPKPaymentWebServiceCompanionTargetDevice *)self provisioningService];
  v13 = NPKProtoSendWithOptions(provisioningService, v9, 200, 0, 0, &__block_literal_global_679, v11);

  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v16 = pk_Payment_log();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
      v18 = 138412290;
      v19 = v13;
      _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: Sent companion iCloud signout event to watch with message ID %@", &v18, 0xCu);
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __73__NPKPaymentWebServiceCompanionTargetDevice_handleCompanioniCloudSignout__block_invoke(uint64_t a1, void *a2)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = a2;
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_ERROR);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
    {
      v7 = 138412290;
      v8 = v2;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_ERROR, "Error: Failed to send iCloud signout event to watch %@!", &v7, 0xCu);
    }
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (void)handleWebServiceContextDidChangeRequest:(id)request
{
  v27 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = [NPKProtoWebServiceContextDidChangeRequest alloc];
  data = [requestCopy data];

  v7 = [(NPKProtoWebServiceContextDidChangeRequest *)v5 initWithData:data];
  webServiceContextBytes = [(NPKProtoWebServiceContextDidChangeRequest *)v7 webServiceContextBytes];
  v9 = objc_opt_class();
  v10 = NPKSecureUnarchiveObject(webServiceContextBytes, v9);
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v23 = 138412290;
      v24 = v10;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Got updated web service context from watch: %@", &v23, 0xCu);
    }
  }

  if (v10)
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

    if (v15)
    {
      v16 = pk_Payment_log();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        primaryRegion = [v10 primaryRegion];
        applyServiceURL = [primaryRegion applyServiceURL];
        primaryRegion2 = [v10 primaryRegion];
        v20 = @"YES";
        if (!primaryRegion2)
        {
          v20 = @"NO";
        }

        v23 = 138412546;
        v24 = applyServiceURL;
        v25 = 2112;
        v26 = v20;
        _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-context) received updated web service context applyServiceURL %@ primaryRegion %@", &v23, 0x16u);
      }
    }

    delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
    [delegate handlePaymentWebServiceContextFromWatch:v10];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (void)handleWebServiceContextNeededRequest:(id)request
{
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v8 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Watch requested web service context", v8, 2u);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate sendWebServiceContextToWatch];
}

- (void)handleShowPaymentSetupRequest:(id)request
{
  v16 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = [NPKProtoShowPaymentSetupRequest alloc];
  data = [requestCopy data];

  v7 = [(NPKProtoShowPaymentSetupRequest *)v5 initWithData:data];
  appDisplayName = [(NPKProtoShowPaymentSetupRequest *)v7 appDisplayName];
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v14 = 138412290;
      v15 = appDisplayName;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Watch requested that we show payment setup for app %@", &v14, 0xCu);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate showPaymentSetupForAppDisplayName:appDisplayName];

  v13 = *MEMORY[0x277D85DE8];
}

- (void)handleTransactionDefaultsNeededRequest:(id)request
{
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v8 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Watch requested transaction defaults", v8, 2u);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  [delegate sendPaymentOptionsDefaultsToWatch];
}

- (void)handleUpdatedPeerPaymentWebServiceContext:(id)context
{
  contextCopy = context;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Watch provided updated peer payment context and account", buf, 2u);
    }
  }

  v8 = [NPKProtoPeerPaymentWebServiceContextDidChangeRequest alloc];
  data = [contextCopy data];

  v10 = [(NPKProtoPeerPaymentWebServiceContextDidChangeRequest *)v8 initWithData:data];
  peerPaymentWebServiceContextData = [(NPKProtoPeerPaymentWebServiceContextDidChangeRequest *)v10 peerPaymentWebServiceContextData];
  v12 = objc_opt_class();
  v13 = NPKSecureUnarchiveObject(peerPaymentWebServiceContextData, v12);

  peerPaymentAccountData = [(NPKProtoPeerPaymentWebServiceContextDidChangeRequest *)v10 peerPaymentAccountData];
  v15 = objc_opt_class();
  v16 = NPKSecureUnarchiveObject(peerPaymentAccountData, v15);

  if (v13)
  {
    delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
    [delegate handleUpdatedPeerPaymentWebServiceContext:v13 account:v16];
  }

  else
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

    if (!v19)
    {
      goto LABEL_8;
    }

    delegate = pk_Payment_log();
    if (os_log_type_enabled(delegate, OS_LOG_TYPE_DEFAULT))
    {
      *v20 = 0;
      _os_log_impl(&dword_25B300000, delegate, OS_LOG_TYPE_DEFAULT, "Warning: Got updated peer payment web service message, but could not decode context", v20, 2u);
    }
  }

LABEL_8:
}

- (BOOL)paymentWebServiceSupportsPeerPaymentRegistration:(id)registration
{
  registrationCopy = registration;
  deviceRegion = [(NPKPaymentWebServiceCompanionTargetDevice *)self deviceRegion];
  v6 = NPKShouldAllowPeerPaymentRegistrationForWebService(registrationCopy, deviceRegion);

  return v6;
}

- (void)claimSecureElementForCurrentUserWithCompletion:(id)completion
{
  if (completion)
  {
    (*(completion + 2))(completion, 1);
  }
}

- (void)paymentWebService:(id)service requestPassUpgrade:(id)upgrade pass:(id)pass completion:(id)completion
{
  passCopy = pass;
  completionCopy = completion;
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __98__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_requestPassUpgrade_pass_completion___block_invoke;
  v13[3] = &unk_27994A350;
  v14 = passCopy;
  v15 = completionCopy;
  v11 = completionCopy;
  v12 = passCopy;
  [(NPKPaymentWebServiceCompanionTargetDevice *)self remotePassUpgradeWithRequest:upgrade pass:v12 requireAuthorization:1 notifyUserOnPairedDevice:0 updateBlock:v13];
}

void __98__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_requestPassUpgrade_pass_completion___block_invoke(uint64_t a1, void *a2, void *a3, uint64_t a4, unint64_t a5)
{
  v25 = *MEMORY[0x277D85DE8];
  v8 = a2;
  v9 = a3;
  v10 = pk_General_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_General_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = [*(a1 + 32) uniqueID];
      v14 = NSStringFromNPKRemotePassUpgradeStatus(a5);
      v17 = 138413058;
      v18 = v13;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = v9;
      v23 = 2112;
      v24 = v8;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target Device: Received Remote pass upgrade updated for  pass with uniqueID:%@ received, Status:%@ updatedPass:%@ error:%@", &v17, 0x2Au);
    }
  }

  v15 = *(a1 + 40);
  if (v15 && (v8 || a5 == 2))
  {
    (*(v15 + 16))(v15, v8, v9);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)willPassWithUniqueIdentifierAutomaticallyBecomeDefault:(id)default
{
  v22 = *MEMORY[0x277D85DE8];
  defaultCopy = default;
  v14 = 0;
  v15 = &v14;
  v16 = 0x2020000000;
  v17 = 0;
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_willPassWithUniqueIdentifierAutomaticallyBecomeDefault___block_invoke;
  v13[3] = &unk_279949B30;
  v13[4] = &v14;
  [companionAgentConnection willPassWithUniqueIdentifierAutomaticallyBecomeDefault:defaultCopy completion:v13];
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      if (*(v15 + 24))
      {
        v9 = @"YES";
      }

      else
      {
        v9 = @"NO";
      }

      *buf = 138412546;
      v19 = defaultCopy;
      v20 = 2112;
      v21 = v9;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Target Device willPassWithUniqueIdentifierAutomaticallyBecomeDefault for %@ returns %@", buf, 0x16u);
    }
  }

  v10 = *(v15 + 24);

  _Block_object_dispose(&v14, 8);
  v11 = *MEMORY[0x277D85DE8];
  return v10 & 1;
}

- (void)consistencyCheck
{
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  [companionAgentConnection consistencyCheckWithCompletion:0];
}

- (void)currentPasscodeMeetsUpgradedPasscodePolicy:(id)policy
{
  policyCopy = policy;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device currentPasscodeMeetsUpgradedPasscodePolicy:", buf, 2u);
    }
  }

  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_currentPasscodeMeetsUpgradedPasscodePolicy___block_invoke;
  v9[3] = &unk_279944F48;
  v10 = policyCopy;
  v8 = policyCopy;
  [(NPKPaymentWebServiceCompanionTargetDevice *)self _checkUpgradedPasscodePolicyByApplyingRestrictions:0 applyBackgroundEnforcementIfNecessary:0 completion:v9];
}

uint64_t __88__NPKPaymentWebServiceCompanionTargetDevice_currentPasscodeMeetsUpgradedPasscodePolicy___block_invoke(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

- (void)enforceUpgradedPasscodePolicyWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *v8 = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device enforceUpgradedPasscodePolicyWithCompletion", v8, 2u);
    }
  }

  [(NPKPaymentWebServiceCompanionTargetDevice *)self _checkUpgradedPasscodePolicyByApplyingRestrictions:NPKIsCurrentlyPairing() applyBackgroundEnforcementIfNecessary:1 completion:completionCopy];
}

- (void)_checkUpgradedPasscodePolicyByApplyingRestrictions:(BOOL)restrictions applyBackgroundEnforcementIfNecessary:(BOOL)necessary completion:(id)completion
{
  v26 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v9 = NPKPairedOrPairingDevice();
  v10 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"B68E1DBD-8CE4-4684-8F65-FF0AF2040D4E"];
  v11 = [v9 supportsCapability:v10];

  v12 = pk_Payment_log();
  LODWORD(v10) = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v14 = NSStringFromBOOL();
      *buf = 138412290;
      v25 = v14;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Supports inline passcode policy enforcement: %@", buf, 0xCu);
    }
  }

  if (v11)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __145__NPKPaymentWebServiceCompanionTargetDevice__checkUpgradedPasscodePolicyByApplyingRestrictions_applyBackgroundEnforcementIfNecessary_completion___block_invoke;
    block[3] = &unk_27994A378;
    restrictionsCopy = restrictions;
    necessaryCopy = necessary;
    block[4] = self;
    v21 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

    if (v17)
    {
      v18 = pk_Payment_log();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Notice: Cannot enforce passcode policy on an unsupported OS. Advancing the flow by indicating that the device meets the policy.", buf, 2u);
      }
    }

    (*(completionCopy + 2))(completionCopy, 1, 0);
  }

  v19 = *MEMORY[0x277D85DE8];
}

void __145__NPKPaymentWebServiceCompanionTargetDevice__checkUpgradedPasscodePolicyByApplyingRestrictions_applyBackgroundEnforcementIfNecessary_completion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoCheckPasscodePolicyComplianceRequest);
  [(NPKProtoCheckPasscodePolicyComplianceRequest *)v2 setEnforcedPolicy:0];
  [(NPKProtoCheckPasscodePolicyComplianceRequest *)v2 setApplyRestrictions:*(a1 + 48)];
  [(NPKProtoCheckPasscodePolicyComplianceRequest *)v2 setApplyBackgroundEnforcementIfNecessary:*(a1 + 49)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoCheckPasscodePolicyComplianceRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:61 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D18650];
  v27[0] = &unk_286CE7808;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __145__NPKPaymentWebServiceCompanionTargetDevice__checkUpgradedPasscodePolicyByApplyingRestrictions_applyBackgroundEnforcementIfNecessary_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __145__NPKPaymentWebServiceCompanionTargetDevice__checkUpgradedPasscodePolicyByApplyingRestrictions_applyBackgroundEnforcementIfNecessary_completion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)handleCheckUpgradedPasscodePolicyResponse:(id)response
{
  v48 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: handleCheckUpgradedPasscodePolicyResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v44 = 0x3032000000;
  v45 = __Block_byref_object_copy__384;
  v46 = __Block_byref_object_dispose__385;
  v47 = 0;
  v35 = 0;
  v36 = &v35;
  v37 = 0x2020000000;
  v38 = 0;
  v29 = 0;
  v30 = &v29;
  v31 = 0x3032000000;
  v32 = __Block_byref_object_copy__22;
  v33 = __Block_byref_object_dispose__22;
  v34 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __87__NPKPaymentWebServiceCompanionTargetDevice_handleCheckUpgradedPasscodePolicyResponse___block_invoke;
    v23[3] = &unk_279949C48;
    v23[4] = self;
    v24 = incomingResponseIdentifier;
    v25 = responseCopy;
    p_buf = &buf;
    v27 = &v35;
    v28 = &v29;
    dispatch_sync(internalQueue, v23);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v39 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v39, 2u);
      }
    }
  }

  if (*(*(&buf + 1) + 40))
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v19 = pk_Payment_log();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        if (*(v36 + 24))
        {
          v20 = @"YES";
        }

        else
        {
          v20 = @"NO";
        }

        v21 = v30[5];
        *v39 = 138412546;
        v40 = v20;
        v41 = 2112;
        v42 = v21;
        _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: handleCheckUpgradedPasscodePolicyResponse: invoking completion with passcodeMeetsPolicy: %@, error: %@", v39, 0x16u);
      }
    }

    (*(*(*(&buf + 1) + 40) + 16))(*(*(&buf + 1) + 40), *(v36 + 24), v30[5], v17, v18);
  }

  _Block_object_dispose(&v29, 8);

  _Block_object_dispose(&v35, 8);
  _Block_object_dispose(&buf, 8);

  v22 = *MEMORY[0x277D85DE8];
}

void __87__NPKPaymentWebServiceCompanionTargetDevice_handleCheckUpgradedPasscodePolicyResponse___block_invoke(uint64_t a1)
{
  v33[2] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoCheckPasscodePolicyComplianceResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoCheckPasscodePolicyComplianceResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    *(*(*(a1 + 64) + 8) + 24) = [v6 passcodeMeetsPolicy];
    if ([v6 hasErrorData])
    {
      v11 = [v6 errorData];
      v12 = objc_opt_class();
      v13 = NPKSecureUnarchiveObject(v11, v12);
    }

    else
    {
      v13 = 0;
    }

    v16 = [v13 domain];
    if ([v16 isEqualToString:@"com.apple.NPKErrorDomain"])
    {
      v17 = [v13 code];

      if (v17 == -1004)
      {
        v30 = MEMORY[0x277CCA9B8];
        v18 = *MEMORY[0x277D385D8];
        v32[0] = *MEMORY[0x277CCA470];
        v19 = *(a1 + 32);
        v20 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
        v21 = [v20 localizedStringForKey:@"UNLOCK_REQUIRED_ALERT_TITLE" value:&stru_286C934F8 table:@"NanoPassKit"];
        v33[0] = v21;
        v32[1] = *MEMORY[0x277CCA498];
        v22 = *(a1 + 32);
        v23 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
        v24 = [v23 localizedStringForKey:@"UNLOCK_REQUIRED_ALERT_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKit"];
        v33[1] = v24;
        v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v33 forKeys:v32 count:2];
        v26 = [v30 errorWithDomain:v18 code:0 userInfo:v25];

        v13 = v26;
      }
    }

    else
    {
    }

    v27 = *(*(a1 + 72) + 8);
    v28 = *(v27 + 40);
    *(v27 + 40) = v13;

LABEL_13:
    goto LABEL_14;
  }

  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", buf, 2u);
    }

    goto LABEL_13;
  }

LABEL_14:

  v29 = *MEMORY[0x277D85DE8];
}

- (void)requestPasscodeUpgradeForPasscodeUpgradeFlowController:(id)controller withVisibleViewController:(id)viewController completion:(id)completion
{
  v37 = *MEMORY[0x277D85DE8];
  controllerCopy = controller;
  viewControllerCopy = viewController;
  completionCopy = completion;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device requestPasscodeUpgradeForPasscodeUpgradeFlowController:withVisibleViewController:completion:", buf, 2u);
    }
  }

  [(NPKPaymentWebServiceCompanionTargetDevice *)self setPasscodeUpgradeFlowController:controllerCopy];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __137__NPKPaymentWebServiceCompanionTargetDevice_requestPasscodeUpgradeForPasscodeUpgradeFlowController_withVisibleViewController_completion___block_invoke;
  aBlock[3] = &unk_27994A3A0;
  objc_copyWeak(&v33, &location);
  v14 = viewControllerCopy;
  v31 = v14;
  v15 = completionCopy;
  v32 = v15;
  v16 = _Block_copy(aBlock);
  v17 = NPKPairedOrPairingDevice();
  v18 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"B68E1DBD-8CE4-4684-8F65-FF0AF2040D4E"];
  v19 = [v17 supportsCapability:v18];

  v20 = pk_Payment_log();
  LODWORD(v18) = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

  if (v18)
  {
    v21 = pk_Payment_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
    {
      v22 = @"NO";
      if (v19)
      {
        v22 = @"YES";
      }

      *buf = 138412290;
      v36 = v22;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_DEFAULT, "Notice: Supports inline passcode policy enforcement: %@", buf, 0xCu);
    }
  }

  if (v19)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v28[0] = MEMORY[0x277D85DD0];
    v28[1] = 3221225472;
    v28[2] = __137__NPKPaymentWebServiceCompanionTargetDevice_requestPasscodeUpgradeForPasscodeUpgradeFlowController_withVisibleViewController_completion___block_invoke_696;
    v28[3] = &unk_279945530;
    v28[4] = self;
    v29 = v16;
    dispatch_sync(internalQueue, v28);
  }

  else
  {
    v24 = pk_Payment_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

    if (v25)
    {
      v26 = pk_Payment_log();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v26, OS_LOG_TYPE_DEFAULT, "Notice: Cannot apply passcode restrictions on an unsupported OS. Advancing the flow by indicating that all is well.", buf, 2u);
      }
    }

    (*(v16 + 2))(v16, 1, 0);
  }

  objc_destroyWeak(&v33);
  objc_destroyWeak(&location);

  v27 = *MEMORY[0x277D85DE8];
}

void __137__NPKPaymentWebServiceCompanionTargetDevice_requestPasscodeUpgradeForPasscodeUpgradeFlowController_withVisibleViewController_completion___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v7 = WeakRetained;
  if (WeakRetained)
  {
    if (v5 || !a2)
    {
      v11 = pk_Payment_log();
      v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

      if (v12)
      {
        v13 = pk_Payment_log();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
        {
          *v15 = 0;
          _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: Failed to apply passcode restrictions.", v15, 2u);
        }
      }

      v14 = *(a1 + 40);
      if (v14)
      {
        (*(v14 + 16))(v14, a2, v5);
      }

      [v7 setPasscodeUpgradeFlowController:0];
    }

    else
    {
      v8 = [WeakRetained passcodeChangeCoordinator];
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __137__NPKPaymentWebServiceCompanionTargetDevice_requestPasscodeUpgradeForPasscodeUpgradeFlowController_withVisibleViewController_completion___block_invoke_2;
      v16[3] = &unk_2799467A8;
      v9 = *(a1 + 32);
      v10 = *(a1 + 40);
      v16[4] = v7;
      v17 = v10;
      [v8 handleGizmoPasscodeChangeWithVisibleViewController:v9 completion:v16];
    }
  }
}

uint64_t __137__NPKPaymentWebServiceCompanionTargetDevice_requestPasscodeUpgradeForPasscodeUpgradeFlowController_withVisibleViewController_completion___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 40);
  if (v2)
  {
    (*(v2 + 16))();
  }

  [*(a1 + 32) setPasscodeUpgradeFlowController:0];
  v3 = *(a1 + 32);

  return [v3 setPasscodeChangeCoordinator:0];
}

void __137__NPKPaymentWebServiceCompanionTargetDevice_requestPasscodeUpgradeForPasscodeUpgradeFlowController_withVisibleViewController_completion___block_invoke_696(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoPasscodeUpgradeFlowApplyPasscodeRestrictionsRequest);
  [(NPKProtoPasscodeUpgradeFlowApplyPasscodeRestrictionsRequest *)v2 setEnforcedPolicy:0];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoPasscodeUpgradeFlowApplyPasscodeRestrictionsRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:68 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D18650];
  v27[0] = &unk_286CE7808;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __137__NPKPaymentWebServiceCompanionTargetDevice_requestPasscodeUpgradeForPasscodeUpgradeFlowController_withVisibleViewController_completion___block_invoke_2_698;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __137__NPKPaymentWebServiceCompanionTargetDevice_requestPasscodeUpgradeForPasscodeUpgradeFlowController_withVisibleViewController_completion___block_invoke_2_698(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)handleApplyRestrictionsForPasscodeUpgradeFlowControllerResponse:(id)response
{
  v48 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target handleApplyRestrictionsForPasscodeUpgradeFlowControllerResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v44 = 0x3032000000;
  v45 = __Block_byref_object_copy__384;
  v46 = __Block_byref_object_dispose__385;
  v47 = 0;
  v35 = 0;
  v36 = &v35;
  v37 = 0x2020000000;
  v38 = 0;
  v29 = 0;
  v30 = &v29;
  v31 = 0x3032000000;
  v32 = __Block_byref_object_copy__22;
  v33 = __Block_byref_object_dispose__22;
  v34 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __109__NPKPaymentWebServiceCompanionTargetDevice_handleApplyRestrictionsForPasscodeUpgradeFlowControllerResponse___block_invoke;
    v23[3] = &unk_279949C48;
    v23[4] = self;
    v24 = incomingResponseIdentifier;
    v25 = responseCopy;
    p_buf = &buf;
    v27 = &v35;
    v28 = &v29;
    dispatch_sync(internalQueue, v23);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v39 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v39, 2u);
      }
    }
  }

  if (*(*(&buf + 1) + 40))
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v19 = pk_Payment_log();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        if (*(v36 + 24))
        {
          v20 = @"YES";
        }

        else
        {
          v20 = @"NO";
        }

        v21 = v30[5];
        *v39 = 138412546;
        v40 = v20;
        v41 = 2112;
        v42 = v21;
        _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: Calling completion with success: %@ error: %@", v39, 0x16u);
      }
    }

    (*(*(*(&buf + 1) + 40) + 16))(*(*(&buf + 1) + 40), *(v36 + 24), v30[5], v17, v18);
  }

  _Block_object_dispose(&v29, 8);

  _Block_object_dispose(&v35, 8);
  _Block_object_dispose(&buf, 8);

  v22 = *MEMORY[0x277D85DE8];
}

void __109__NPKPaymentWebServiceCompanionTargetDevice_handleApplyRestrictionsForPasscodeUpgradeFlowControllerResponse___block_invoke(uint64_t a1)
{
  v33[2] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoPasscodeUpgradeFlowApplyPasscodeRestrictionsResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoPasscodeUpgradeFlowApplyPasscodeRestrictionsResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    *(*(*(a1 + 64) + 8) + 24) = [v6 success];
    if ([v6 hasErrorData])
    {
      v11 = [v6 errorData];
      v12 = objc_opt_class();
      v13 = NPKSecureUnarchiveObject(v11, v12);
    }

    else
    {
      v13 = 0;
    }

    v16 = [v13 domain];
    if ([v16 isEqualToString:@"com.apple.NPKErrorDomain"])
    {
      v17 = [v13 code];

      if (v17 == -1004)
      {
        v30 = MEMORY[0x277CCA9B8];
        v18 = *MEMORY[0x277D385D8];
        v32[0] = *MEMORY[0x277CCA470];
        v19 = *(a1 + 32);
        v20 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
        v21 = [v20 localizedStringForKey:@"UNLOCK_REQUIRED_ALERT_TITLE" value:&stru_286C934F8 table:@"NanoPassKit"];
        v33[0] = v21;
        v32[1] = *MEMORY[0x277CCA498];
        v22 = *(a1 + 32);
        v23 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
        v24 = [v23 localizedStringForKey:@"UNLOCK_REQUIRED_ALERT_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKit"];
        v33[1] = v24;
        v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v33 forKeys:v32 count:2];
        v26 = [v30 errorWithDomain:v18 code:0 userInfo:v25];

        v13 = v26;
      }
    }

    else
    {
    }

    v27 = *(*(a1 + 72) + 8);
    v28 = *(v27 + 40);
    *(v27 + 40) = v13;

LABEL_13:
    goto LABEL_14;
  }

  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", buf, 2u);
    }

    goto LABEL_13;
  }

LABEL_14:

  v29 = *MEMORY[0x277D85DE8];
}

- (void)presentRemoteDevicePasscodeUpgradePromptForChangeType:(unint64_t)type completion:(id)completion
{
  v27 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v7 = pk_Payment_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Target device presentRemoteDevicePasscodeUpgradePromptForChangeType:completion:", buf, 2u);
    }
  }

  v10 = NPKPairedOrPairingDevice();
  v11 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"C3FD35B9-C30A-4893-B94B-56080B5FD9B7"];
  v12 = [v10 supportsCapability:v11];

  v13 = pk_Payment_log();
  LODWORD(v11) = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      v15 = @"NO";
      if (v12)
      {
        v15 = @"YES";
      }

      *buf = 138412290;
      v26 = v15;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Supports remote device passcode upgrade prompt: %@", buf, 0xCu);
    }
  }

  if (v12)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __110__NPKPaymentWebServiceCompanionTargetDevice_presentRemoteDevicePasscodeUpgradePromptForChangeType_completion___block_invoke;
    block[3] = &unk_27994A198;
    typeCopy = type;
    block[4] = self;
    v23 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v17 = pk_Payment_log();
    v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

    if (v18)
    {
      v19 = pk_Payment_log();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: Cannot present passcode upgrade prompt on an unsupported OS.", buf, 2u);
      }
    }

    v20 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v20);
  }

  v21 = *MEMORY[0x277D85DE8];
}

void __110__NPKPaymentWebServiceCompanionTargetDevice_presentRemoteDevicePasscodeUpgradePromptForChangeType_completion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoPasscodeUpgradeFlowPresentationRequest);
  [(NPKProtoPasscodeUpgradeFlowPresentationRequest *)v2 setChangeType:NPKPasscodeUpgradeChangeTypeProtoFromPasscodeUpgradeChangeType(*(a1 + 48))];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoPasscodeUpgradeFlowPresentationRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:108 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D18650];
  v27[0] = &unk_286CE7808;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7 priority:300];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __110__NPKPaymentWebServiceCompanionTargetDevice_presentRemoteDevicePasscodeUpgradePromptForChangeType_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __110__NPKPaymentWebServiceCompanionTargetDevice_presentRemoteDevicePasscodeUpgradePromptForChangeType_completion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)handleRemoteDevicePasscodeUpgradePresentationPromptResponse:(id)response
{
  v53 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target handleRemoteDevicePasscodeUpgradePresentationPromptResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v49 = 0x3032000000;
  v50 = __Block_byref_object_copy__384;
  v51 = __Block_byref_object_dispose__385;
  v52 = 0;
  v40 = 0;
  v41 = &v40;
  v42 = 0x2020000000;
  v43 = 0;
  v34 = 0;
  v35 = &v34;
  v36 = 0x3032000000;
  v37 = __Block_byref_object_copy__22;
  v38 = __Block_byref_object_dispose__22;
  v39 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v24 = MEMORY[0x277D85DD0];
    v25 = 3221225472;
    v26 = __105__NPKPaymentWebServiceCompanionTargetDevice_handleRemoteDevicePasscodeUpgradePresentationPromptResponse___block_invoke;
    v27 = &unk_279949C48;
    selfCopy = self;
    v29 = incomingResponseIdentifier;
    v30 = responseCopy;
    p_buf = &buf;
    v32 = &v40;
    v33 = &v34;
    dispatch_sync(internalQueue, &v24);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v44 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v44, 2u);
      }
    }
  }

  if (*(*(&buf + 1) + 40))
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18 = *(v41 + 24);
        v19 = v35[5];
        *v44 = 134218242;
        v45 = v18;
        v46 = 2112;
        v47 = v19;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Request to exit passcode change flow with passcode changed: %ld error: %@", v44, 0x16u);
      }
    }

    v20 = [(NPKPaymentWebServiceCompanionTargetDevice *)self passcodeChangeCoordinator:v24];
    [v20 exitPasscodeChangeFlowWithPasscodeChanged:*(v41 + 24) error:v35[5]];

    v21 = *(v41 + 24);
    v22 = v35[5];
    (*(*(*(&buf + 1) + 40) + 16))();
  }

  _Block_object_dispose(&v34, 8);

  _Block_object_dispose(&v40, 8);
  _Block_object_dispose(&buf, 8);

  v23 = *MEMORY[0x277D85DE8];
}

void __105__NPKPaymentWebServiceCompanionTargetDevice_handleRemoteDevicePasscodeUpgradePresentationPromptResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoPasscodeUpgradeFlowShouldExitRequest alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoPasscodeUpgradeFlowShouldExitRequest *)v5 initWithData:v6];

    if ([v7 pending])
    {
      v8 = pk_Payment_log();
      v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

      if (v9)
      {
        v10 = pk_Payment_log();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Passcode upgrade request still pending", buf, 2u);
        }
      }

      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v13 = [v4 completionHandler];
      v14 = *(*(a1 + 56) + 8);
      v15 = *(v14 + 40);
      *(v14 + 40) = v13;

      *(*(*(a1 + 64) + 8) + 24) = [v7 passcodeChanged];
      v16 = [v7 hasErrorData];
      if (v16)
      {
        v1 = [v7 errorData];
        v17 = objc_opt_class();
        v18 = NPKSecureUnarchiveObject(v1, v17);
      }

      else
      {
        v18 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v18);
      if (v16)
      {
      }
    }

LABEL_16:

    goto LABEL_17;
  }

  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *v19 = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
    }

    goto LABEL_16;
  }

LABEL_17:
}

- (void)dismissRemoteDevicePasscodeUpgradePromptWithCompletion:(id)completion
{
  v21 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v5 = NPKPairedOrPairingDevice();
  v6 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"C3FD35B9-C30A-4893-B94B-56080B5FD9B7"];
  v7 = [v5 supportsCapability:v6];

  v8 = pk_Payment_log();
  LODWORD(v6) = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = @"NO";
      if (v7)
      {
        v10 = @"YES";
      }

      *buf = 138412290;
      v20 = v10;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Supports remote device passcode upgrade prompt: %@", buf, 0xCu);
    }
  }

  if (v7)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_dismissRemoteDevicePasscodeUpgradePromptWithCompletion___block_invoke;
    v17[3] = &unk_279945530;
    v17[4] = self;
    v18 = completionCopy;
    dispatch_sync(internalQueue, v17);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Cannot present passcode upgrade prompt on an unsupported OS.", buf, 2u);
      }
    }

    v15 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v15);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __100__NPKPaymentWebServiceCompanionTargetDevice_dismissRemoteDevicePasscodeUpgradePromptWithCompletion___block_invoke(uint64_t a1)
{
  v22[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoPasscodeUpgradeFlowShouldExitRequest);
  [(NPKProtoPasscodeUpgradeFlowShouldExitRequest *)v2 setPasscodeChanged:0];
  [(NPKProtoPasscodeUpgradeFlowShouldExitRequest *)v2 setErrorData:0];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoPasscodeUpgradeFlowShouldExitRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:67 isResponse:0];

  v6 = *(a1 + 32);
  v21 = *MEMORY[0x277D18650];
  v22[0] = &unk_286CE7808;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v22 forKeys:&v21 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:0 extraOptions:v7 priority:300];

  if (!v8)
  {
    v10 = pk_Payment_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_ERROR);

    if (!v11)
    {
      goto LABEL_12;
    }

    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v19 = 138412290;
      v20 = v5;
      v13 = "Error: No message identifier for protobuf %@";
      v14 = v12;
      v15 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v14, v15, v13, &v19, 0xCu);
    }

LABEL_11:

    goto LABEL_12;
  }

  v9 = *(a1 + 40);
  if (!v9)
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

    if (!v17)
    {
      goto LABEL_12;
    }

    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v19 = 138412290;
      v20 = v8;
      v13 = "Warning: No response expected for message with identifier %@";
      v14 = v12;
      v15 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }

    goto LABEL_11;
  }

  (*(v9 + 16))(v9, [(NPKProtoPasscodeUpgradeFlowShouldExitRequest *)v2 passcodeChanged], 0);
LABEL_12:

  v18 = *MEMORY[0x277D85DE8];
}

- (void)handlePasscodeUpgradeFlowShouldExitRequest:(id)request
{
  v25 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [requestCopy npkDescription];
      v21 = 138412290;
      v22 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target handlePasscodeUpgradeFlowShouldExitRequest: incoming protobuf %@", &v21, 0xCu);
    }
  }

  v9 = [NPKProtoPasscodeUpgradeFlowShouldExitRequest alloc];
  data = [requestCopy data];
  v11 = [(NPKProtoPasscodeUpgradeFlowShouldExitRequest *)v9 initWithData:data];

  passcodeChanged = [(NPKProtoPasscodeUpgradeFlowShouldExitRequest *)v11 passcodeChanged];
  if ([(NPKProtoPasscodeUpgradeFlowShouldExitRequest *)v11 hasErrorData])
  {
    errorData = [(NPKProtoPasscodeUpgradeFlowShouldExitRequest *)v11 errorData];
    v14 = objc_opt_class();
    v15 = NPKSecureUnarchiveObject(errorData, v14);
  }

  else
  {
    v15 = 0;
  }

  v16 = pk_Payment_log();
  v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

  if (v17)
  {
    v18 = pk_Payment_log();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      v21 = 134218242;
      v22 = passcodeChanged;
      v23 = 2112;
      v24 = v15;
      _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Notice: Request to exit passcode change flow with passcode changed: %ld error: %@", &v21, 0x16u);
    }
  }

  passcodeChangeCoordinator = [(NPKPaymentWebServiceCompanionTargetDevice *)self passcodeChangeCoordinator];
  [passcodeChangeCoordinator exitPasscodeChangeFlowWithPasscodeChanged:passcodeChanged error:v15];

  v20 = *MEMORY[0x277D85DE8];
}

- (void)startRequiringUpgradedPasscodeWithPasscodeMeetsPolicy:(BOOL)policy
{
  v4 = NPKPairedOrPairingDevice();
  v5 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"B68E1DBD-8CE4-4684-8F65-FF0AF2040D4E"];
  v6 = [v4 supportsCapability:v5];

  if (v6)
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v10 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Noting that provisioning did start requiring upgraded passcode", v10, 2u);
      }
    }

    [(NPKPaymentWebServiceCompanionTargetDevice *)self _acquireAssertionOfType:6];
  }
}

- (void)endRequiringUpgradedPasscodeIfNecessary
{
  v3 = NPKPairedOrPairingDevice();
  v4 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"B68E1DBD-8CE4-4684-8F65-FF0AF2040D4E"];
  v5 = [v3 supportsCapability:v4];

  if (v5)
  {
    v6 = pk_Payment_log();
    v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

    if (v7)
    {
      v8 = pk_Payment_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        *v9 = 0;
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Noting that provisioning did end requiring upgraded passcode", v9, 2u);
      }
    }

    [(NPKPaymentWebServiceCompanionTargetDevice *)self _invalidateAssertionOfType:6];
  }
}

- (void)fetchRemoteDevicePasscodeStateWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device fetchRemoteDevicePasscodeStateWithCompletion:", buf, 2u);
    }
  }

  v8 = NPKPairedOrPairingDevice();
  v9 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"C3FD35B9-C30A-4893-B94B-56080B5FD9B7"];
  v10 = [v8 supportsCapability:v9];

  if (v10)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v15[0] = MEMORY[0x277D85DD0];
    v15[1] = 3221225472;
    v15[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_fetchRemoteDevicePasscodeStateWithCompletion___block_invoke;
    v15[3] = &unk_279945530;
    v15[4] = self;
    v16 = completionCopy;
    dispatch_sync(internalQueue, v15);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: The remote device's OS does not support this call. Pretend all is well so we don't fail here.", buf, 2u);
      }
    }

    (*(completionCopy + 2))(completionCopy, 1, 0, 0);
  }
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_fetchRemoteDevicePasscodeStateWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoRemoteDevicePasscodeStateRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoRemoteDevicePasscodeStateRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:109 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D18650];
  v27[0] = &unk_286CE7808;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_fetchRemoteDevicePasscodeStateWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __90__NPKPaymentWebServiceCompanionTargetDevice_fetchRemoteDevicePasscodeStateWithCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0, a2);
  }

  return result;
}

- (void)handleRemoteDevicePasscodeStateResponse:(id)response
{
  v44 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target handleRemoteDevicePasscodeStateResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v40 = 0x3032000000;
  v41 = __Block_byref_object_copy__384;
  v42 = __Block_byref_object_dispose__385;
  v43 = 0;
  v35 = 0;
  v36 = &v35;
  v37 = 0x2020000000;
  v38 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x2020000000;
  v34 = 0;
  v25 = 0;
  v26 = &v25;
  v27 = 0x3032000000;
  v28 = __Block_byref_object_copy__22;
  v29 = __Block_byref_object_dispose__22;
  v30 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __85__NPKPaymentWebServiceCompanionTargetDevice_handleRemoteDevicePasscodeStateResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v35;
    v23 = &v31;
    v24 = &v25;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v36 + 24), *(v32 + 24), v26[5]);
  }

  _Block_object_dispose(&v25, 8);

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v35, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __85__NPKPaymentWebServiceCompanionTargetDevice_handleRemoteDevicePasscodeStateResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoRemoteDevicePasscodeStateResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoRemoteDevicePasscodeStateResponse *)v5 initWithData:v6];

    v8 = [v4 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoRemoteDevicePasscodeStateResponse *)v7 hasPasscodeSet];
    *(*(*(a1 + 72) + 8) + 24) = [(NPKProtoRemoteDevicePasscodeStateResponse *)v7 isPasscodeLocked];
    v11 = [(NPKProtoRemoteDevicePasscodeStateResponse *)v7 hasErrorData];
    if (v11)
    {
      v1 = [(NPKProtoRemoteDevicePasscodeStateResponse *)v7 errorData];
      v12 = objc_opt_class();
      v13 = NPKSecureUnarchiveObject(v1, v12);
    }

    else
    {
      v13 = 0;
    }

    objc_storeStrong((*(*(a1 + 80) + 8) + 40), v13);
    if (v11)
    {
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

    if (v15)
    {
      v16 = pk_Payment_log();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        v17[0] = 0;
        _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v17, 2u);
      }
    }
  }
}

- (id)deviceIDSIdentifier
{
  mEMORY[0x277D2BCF8] = [MEMORY[0x277D2BCF8] sharedInstance];
  v4 = NPKPairedOrPairingDevice();
  provisioningService = [(NPKPaymentWebServiceCompanionTargetDevice *)self provisioningService];
  devices = [provisioningService devices];

  v7 = [mEMORY[0x277D2BCF8] deviceForNRDevice:v4 fromIDSDevices:devices];
  uniqueIDOverride = [v7 uniqueIDOverride];

  return uniqueIDOverride;
}

- (void)paymentWebService:(id)service canAddSecureElementPassWithConfiguration:(id)configuration completion:(id)completion
{
  v57 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  configurationCopy = configuration;
  completionCopy = completion;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v14 = _Block_copy(completionCopy);
      *buf = 138412546;
      *&buf[4] = configurationCopy;
      *&buf[12] = 2112;
      *&buf[14] = v14;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device - can add secure element pass with configuration %@ completion: %@", buf, 0x16u);
    }
  }

  v15 = dispatch_queue_create("com.apple.NPKCanAddSecureElementPass", 0);
  v51[0] = 0;
  v51[1] = v51;
  v51[2] = 0x2020000000;
  v52 = 0;
  v49[0] = 0;
  v49[1] = v49;
  v49[2] = 0x2020000000;
  v50 = 0;
  v47[0] = 0;
  v47[1] = v47;
  v47[2] = 0x2020000000;
  v48 = 0;
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAddSecureElementPassWithConfiguration_completion___block_invoke;
  aBlock[3] = &unk_27994A3C8;
  v44 = v49;
  v45 = v47;
  v16 = v15;
  v42 = v16;
  v17 = completionCopy;
  v43 = v17;
  v46 = v51;
  v18 = _Block_copy(aBlock);
  v39[0] = 0;
  v39[1] = v39;
  v39[2] = 0x2020000000;
  v40 = 1;
  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v54 = __Block_byref_object_copy__22;
  v55 = __Block_byref_object_dispose__22;
  v56 = 0;
  v19 = [NPKPaymentPreflighter alloc];
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  v21 = [(NPKPaymentPreflighter *)v19 initWithWebService:serviceCopy targetDevice:self companionAgentConnection:companionAgentConnection];

  v33[0] = MEMORY[0x277D85DD0];
  v33[1] = 3221225472;
  v33[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAddSecureElementPassWithConfiguration_completion___block_invoke_708;
  v33[3] = &unk_27994A418;
  v22 = v16;
  v34 = v22;
  v36 = v39;
  v37 = buf;
  v38 = v49;
  v23 = v18;
  v35 = v23;
  [(NPKPaymentPreflighter *)v21 addSecureElementPassPreflightWithCompletion:v33];
  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAddSecureElementPassWithConfiguration_completion___block_invoke_3;
  v27[3] = &unk_27994A418;
  v24 = v22;
  v28 = v24;
  v30 = v39;
  v31 = buf;
  v32 = v47;
  v25 = v23;
  v29 = v25;
  [(NPKPaymentWebServiceCompanionTargetDevice *)self _canAddSecureElementPassWithConfiguration:configurationCopy completion:v27];

  _Block_object_dispose(buf, 8);
  _Block_object_dispose(v39, 8);

  _Block_object_dispose(v47, 8);
  _Block_object_dispose(v49, 8);
  _Block_object_dispose(v51, 8);

  v26 = *MEMORY[0x277D85DE8];
}

void __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAddSecureElementPassWithConfiguration_completion___block_invoke(uint64_t a1, int a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = @"NO";
      if (*(*(*(a1 + 48) + 8) + 24))
      {
        v10 = @"YES";
      }

      else
      {
        v10 = @"NO";
      }

      if (*(*(*(a1 + 56) + 8) + 24))
      {
        v11 = @"YES";
      }

      else
      {
        v11 = @"NO";
      }

      if (a2)
      {
        v9 = @"YES";
      }

      v27 = 138413058;
      v28 = v10;
      v29 = 2112;
      v30 = v11;
      v31 = 2112;
      v32 = v9;
      v33 = 2112;
      v34 = v5;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Target device - can add secure element pass called common completion with checkedPreflight: %@ checkedWatch: %@ for canAddPass: %@ error: %@", &v27, 0x2Au);
    }
  }

  dispatch_assert_queue_V2(*(a1 + 32));
  if (*(a1 + 40))
  {
    v12 = *(*(a1 + 64) + 8);
    if ((*(v12 + 24) & 1) == 0)
    {
      v17 = *(*(*(a1 + 56) + 8) + 24);
      if (*(*(*(a1 + 48) + 8) + 24) == 1)
      {
        if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0)
        {
          goto LABEL_38;
        }

        *(v12 + 24) = 1;
        v18 = pk_Payment_log();
        v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

        if (v19)
        {
          v20 = pk_Payment_log();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
          {
            v21 = @"NO";
            if (a2)
            {
              v21 = @"YES";
            }

            v27 = 138412546;
            v28 = v21;
            v29 = 2112;
            v30 = v5;
            _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Notice: Target device - can add secure element pass finished with canAddPass: %@ error: %@", &v27, 0x16u);
          }
        }

        v22 = *(*(a1 + 40) + 16);
      }

      else
      {
        if (*(*(*(a1 + 56) + 8) + 24) & 1) == 0 || (a2)
        {
          goto LABEL_38;
        }

        *(v12 + 24) = 1;
        v23 = pk_Payment_log();
        v24 = os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT);

        if (v24)
        {
          v25 = pk_Payment_log();
          if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
          {
            v27 = 138412546;
            v28 = @"NO";
            v29 = 2112;
            v30 = v5;
            _os_log_impl(&dword_25B300000, v25, OS_LOG_TYPE_DEFAULT, "Notice: Target device - can add secure element pass finished early with canAddPass: %@ error: %@", &v27, 0x16u);
          }
        }

        v22 = *(*(a1 + 40) + 16);
      }

      v22();
      goto LABEL_38;
    }

    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        v16 = @"NO";
        if (a2)
        {
          v16 = @"YES";
        }

        v27 = 138412546;
        v28 = v16;
        v29 = 2112;
        v30 = v5;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device - can add secure element pass already completed with canAddPass: %@ error: %@", &v27, 0x16u);
      }
    }
  }

LABEL_38:

  v26 = *MEMORY[0x277D85DE8];
}

void __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAddSecureElementPassWithConfiguration_completion___block_invoke_708(uint64_t a1, char a2, void *a3)
{
  v5 = a3;
  v6 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAddSecureElementPassWithConfiguration_completion___block_invoke_2;
  block[3] = &unk_27994A3F0;
  v14 = a2;
  v11 = v5;
  v13 = *(a1 + 56);
  v9 = *(a1 + 40);
  v7 = v9;
  v12 = v9;
  v8 = v5;
  dispatch_async(v6, block);
}

uint64_t __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAddSecureElementPassWithConfiguration_completion___block_invoke_2(uint64_t a1)
{
  v2 = *(*(a1 + 48) + 8);
  if (*(v2 + 24) == 1)
  {
    v3 = *(a1 + 72);
  }

  else
  {
    v3 = 0;
  }

  *(v2 + 24) = v3 & 1;
  v4 = *(*(a1 + 56) + 8);
  v7 = *(v4 + 40);
  v5 = (v4 + 40);
  v6 = v7;
  if (!v7)
  {
    v6 = *(a1 + 32);
  }

  objc_storeStrong(v5, v6);
  *(*(*(a1 + 64) + 8) + 24) = 1;
  v8 = *(*(*(a1 + 48) + 8) + 24);
  v9 = *(*(*(a1 + 56) + 8) + 40);
  v10 = *(*(a1 + 40) + 16);

  return v10();
}

void __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAddSecureElementPassWithConfiguration_completion___block_invoke_3(uint64_t a1, char a2, void *a3)
{
  v5 = a3;
  v6 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAddSecureElementPassWithConfiguration_completion___block_invoke_4;
  block[3] = &unk_27994A3F0;
  v14 = a2;
  v11 = v5;
  v13 = *(a1 + 56);
  v9 = *(a1 + 40);
  v7 = v9;
  v12 = v9;
  v8 = v5;
  dispatch_async(v6, block);
}

uint64_t __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAddSecureElementPassWithConfiguration_completion___block_invoke_4(uint64_t a1)
{
  v2 = *(*(a1 + 48) + 8);
  if (*(v2 + 24) == 1)
  {
    v3 = *(a1 + 72);
  }

  else
  {
    v3 = 0;
  }

  *(v2 + 24) = v3 & 1;
  v4 = *(a1 + 32);
  v5 = *(*(a1 + 56) + 8);
  if (!v4)
  {
    v4 = *(v5 + 40);
  }

  objc_storeStrong((v5 + 40), v4);
  *(*(*(a1 + 64) + 8) + 24) = 1;
  v6 = *(*(*(a1 + 48) + 8) + 24);
  v7 = *(*(*(a1 + 56) + 8) + 40);
  v8 = *(*(a1 + 40) + 16);

  return v8();
}

- (void)_canAddSecureElementPassWithConfiguration:(id)configuration completion:(id)completion
{
  v41 = *MEMORY[0x277D85DE8];
  configurationCopy = configuration;
  completionCopy = completion;
  mEMORY[0x277D37FC0] = [MEMORY[0x277D37FC0] sharedInstanceWithRemoteLibrary];
  _remoteLibrary = [mEMORY[0x277D37FC0] _remoteLibrary];

  v10 = [_remoteLibrary canAddSecureElementPassWithConfiguration:configurationCopy];
  if (!v10)
  {
    if (!completionCopy)
    {
      goto LABEL_16;
    }

    v17 = MEMORY[0x277CCA9B8];
    v18 = *MEMORY[0x277D385D8];
    v33 = *MEMORY[0x277CCA470];
    v34 = @"Target device does not support secure element configuration.";
    v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v34 forKeys:&v33 count:1];
    v20 = [v17 errorWithDomain:v18 code:4 userInfo:v19];

    goto LABEL_14;
  }

  if ([configurationCopy configurationType] != 1)
  {
    if (!completionCopy)
    {
      goto LABEL_16;
    }

    v20 = 0;
LABEL_14:
    completionCopy[2](completionCopy, v10, v20);
LABEL_15:

    goto LABEL_16;
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isUWBSubcredentialProvisioningSupported])
  {
    _deviceIsConnected = [(NPKPaymentWebServiceCompanionTargetDevice *)self _deviceIsConnected];
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (_deviceIsConnected)
    {
      if (v13)
      {
        v14 = pk_Payment_log();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
        {
          v15 = _Block_copy(completionCopy);
          *buf = 138412546;
          v38 = configurationCopy;
          v39 = 2112;
          v40 = v15;
          _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device - sending canAddSecureElementPassWithConfiguration request for configuration: %@ completion: %@", buf, 0x16u);
        }
      }

      internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __98__NPKPaymentWebServiceCompanionTargetDevice__canAddSecureElementPassWithConfiguration_completion___block_invoke;
      block[3] = &unk_279945A48;
      v30 = configurationCopy;
      selfCopy = self;
      v32 = completionCopy;
      dispatch_sync(internalQueue, block);

      goto LABEL_16;
    }

    if (v13)
    {
      v25 = pk_Payment_log();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v25, OS_LOG_TYPE_DEFAULT, "Notice: Target device - not sending canAddSecureElementPassWithConfiguration request; watch not immediately reachable.", buf, 2u);
      }
    }

    if (completionCopy)
    {
      v26 = MEMORY[0x277CCA9B8];
      v27 = *MEMORY[0x277D389E0];
      v35 = *MEMORY[0x277CCA470];
      v36 = @"Target device is not reachable.";
      v28 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
      v20 = [v26 errorWithDomain:v27 code:19 userInfo:v28];

      completionCopy[2](completionCopy, 0, v20);
      goto LABEL_15;
    }
  }

  else
  {
    v22 = pk_Payment_log();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT);

    if (v23)
    {
      v24 = pk_Payment_log();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v24, OS_LOG_TYPE_DEFAULT, "Warning: The expected capability was not found; continuing immediately.", buf, 2u);
      }
    }

    if (completionCopy)
    {
      completionCopy[2](completionCopy, 1, 0);
    }
  }

LABEL_16:

  v21 = *MEMORY[0x277D85DE8];
}

void __98__NPKPaymentWebServiceCompanionTargetDevice__canAddSecureElementPassWithConfiguration_completion___block_invoke(uint64_t a1)
{
  v30[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoCanAddSecureElementPassWithConfigurationRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoCanAddSecureElementPassWithConfigurationRequest *)v2 setConfigurationData:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoCanAddSecureElementPassWithConfigurationRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:90 isResponse:0];

  v7 = *(a1 + 40);
  v29 = *MEMORY[0x277D18650];
  v30[0] = &unk_286CE7818;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:&v29 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __98__NPKPaymentWebServiceCompanionTargetDevice__canAddSecureElementPassWithConfiguration_completion___block_invoke_713;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412546;
      v26 = v9;
      v27 = 1024;
      v28 = [v6 type];
      v17 = "Warning: No response expected for message with identifier %@ of type %hu";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412546;
      v26 = v6;
      v27 = 1024;
      v28 = [v6 type];
      v17 = "Error: No message identifier for protobuf %@ with type %hu";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0x12u);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __98__NPKPaymentWebServiceCompanionTargetDevice__canAddSecureElementPassWithConfiguration_completion___block_invoke_713(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)canAddSecureElementPassWithConfigurationResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target canAddSecureElementPassWithConfigurationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x2020000000;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __94__NPKPaymentWebServiceCompanionTargetDevice_canAddSecureElementPassWithConfigurationResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v31 + 24), v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __94__NPKPaymentWebServiceCompanionTargetDevice_canAddSecureElementPassWithConfigurationResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCanAddSecureElementPassWithConfigurationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCanAddSecureElementPassWithConfigurationResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoCanAddSecureElementPassWithConfigurationResponse *)v7 canAddPass];
    v12 = [(NPKProtoCanAddSecureElementPassWithConfigurationResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoCanAddSecureElementPassWithConfigurationResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service canAcceptInvitation:(id)invitation withCompletionV2:(id)v2
{
  v32 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  v2Copy = v2;
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = _Block_copy(v2Copy);
      *buf = 138412546;
      v29 = invitationCopy;
      v30 = 2112;
      v31 = v12;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device - can accept invitation request with invitation: %@ completion: %@", buf, 0x16u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAcceptInvitation_withCompletionV2___block_invoke;
    block[3] = &unk_279945A48;
    v23 = invitationCopy;
    selfCopy = self;
    v25 = v2Copy;
    dispatch_sync(internalQueue, block);

    v14 = v23;
LABEL_13:

    goto LABEL_14;
  }

  v15 = pk_Payment_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
    }
  }

  if (v2Copy)
  {
    v18 = MEMORY[0x277CCA9B8];
    v19 = *MEMORY[0x277D389E0];
    v26 = *MEMORY[0x277CCA470];
    v27 = @"Target device does not support subcredential provisioning.";
    v20 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
    v14 = [v18 errorWithDomain:v19 code:21 userInfo:v20];

    (*(v2Copy + 2))(v2Copy, v14);
    goto LABEL_13;
  }

LABEL_14:

  v21 = *MEMORY[0x277D85DE8];
}

void __100__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAcceptInvitation_withCompletionV2___block_invoke(uint64_t a1)
{
  v30[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoCanAcceptInvitationRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoCanAcceptInvitationRequest *)v2 setInvitationData:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoCanAcceptInvitationRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:73 isResponse:0];

  v7 = *(a1 + 40);
  v29 = *MEMORY[0x277D18650];
  v30[0] = &unk_286CE7808;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:&v29 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAcceptInvitation_withCompletionV2___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412546;
      v26 = v9;
      v27 = 1024;
      v28 = [v6 type];
      v17 = "Warning: No response expected for message with identifier %@ of type %hu";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412546;
      v26 = v6;
      v27 = 1024;
      v28 = [v6 type];
      v17 = "Error: No message identifier for protobuf %@ with type %hu";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0x12u);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __100__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_canAcceptInvitation_withCompletionV2___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

- (void)canAcceptInvitationResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target canAcceptInvitationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __73__NPKPaymentWebServiceCompanionTargetDevice_canAcceptInvitationResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __73__NPKPaymentWebServiceCompanionTargetDevice_canAcceptInvitationResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCanAcceptInvitationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCanAcceptInvitationResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCanAcceptInvitationResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoCanAcceptInvitationResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)canAcceptInvitationRequest:(id)request
{
  v25 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [requestCopy npkDescription];
      *buf = 138412290;
      v24 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device - received can accept invitation request: %@", buf, 0xCu);
    }
  }

  context = [requestCopy context];
  outgoingResponseIdentifier = [context outgoingResponseIdentifier];

  v11 = [NPKProtoCanAcceptInvitationRequest alloc];
  data = [requestCopy data];
  v13 = [(NPKProtoCanAcceptInvitationRequest *)v11 initWithData:data];

  invitationData = [(NPKProtoCanAcceptInvitationRequest *)v13 invitationData];
  v15 = objc_opt_class();
  v16 = NPKSecureUnarchiveObject(invitationData, v15);
  objc_initWeak(buf, self);
  subcredentialInvitationCoordinator = [(NPKPaymentWebServiceCompanionTargetDevice *)self subcredentialInvitationCoordinator];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __72__NPKPaymentWebServiceCompanionTargetDevice_canAcceptInvitationRequest___block_invoke;
  v20[3] = &unk_27994A440;
  objc_copyWeak(&v22, buf);
  v18 = outgoingResponseIdentifier;
  v21 = v18;
  [subcredentialInvitationCoordinator canAcceptInvitation:v16 completion:v20];

  objc_destroyWeak(&v22);
  objc_destroyWeak(buf);

  v19 = *MEMORY[0x277D85DE8];
}

void __72__NPKPaymentWebServiceCompanionTargetDevice_canAcceptInvitationRequest___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = [WeakRetained internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __72__NPKPaymentWebServiceCompanionTargetDevice_canAcceptInvitationRequest___block_invoke_2;
  block[3] = &unk_279945290;
  objc_copyWeak(&v10, (a1 + 40));
  v8 = v3;
  v9 = *(a1 + 32);
  v6 = v3;
  dispatch_sync(v5, block);

  objc_destroyWeak(&v10);
}

void __72__NPKPaymentWebServiceCompanionTargetDevice_canAcceptInvitationRequest___block_invoke_2(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = objc_alloc_init(NPKProtoCanAcceptInvitationResponse);
  v4 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoCanAcceptInvitationResponse *)v3 setErrorData:v4];

  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [(NPKProtoCanAcceptInvitationResponse *)v3 data];
  v7 = [v5 initWithProtobufData:v6 type:73 isResponse:1];

  v8 = [WeakRetained _sendProtobuf:v7 responseIdentifier:*(a1 + 40)];
  if (!v8)
  {
    v9 = pk_Payment_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);

    if (v10)
    {
      v11 = pk_Payment_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v13 = 138412290;
        v14 = v7;
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", &v13, 0xCu);
      }
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebService:(id)service subcredentialInvitationsWithCompletion:(id)completion
{
  completionCopy = completion;
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Target device - subcredential invitations request", buf, 2u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_subcredentialInvitationsWithCompletion___block_invoke;
    v13[3] = &unk_279945530;
    v13[4] = self;
    v14 = completionCopy;
    dispatch_sync(internalQueue, v13);
  }

  else
  {
    v10 = pk_Payment_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

    if (v11)
    {
      v12 = pk_Payment_log();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_subcredentialInvitationsWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoListSubcredentialInvitationsRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoListSubcredentialInvitationsRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:70 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D18650];
  v27[0] = &unk_286CE7808;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_subcredentialInvitationsWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_subcredentialInvitationsWithCompletion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)subcredentialInvitationsResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target subcredentialInvitationsResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__NPKPaymentWebServiceCompanionTargetDevice_subcredentialInvitationsResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __78__NPKPaymentWebServiceCompanionTargetDevice_subcredentialInvitationsResponse___block_invoke(uint64_t a1)
{
  v32 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoListSubcredentialInvitationsResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoListSubcredentialInvitationsResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = [MEMORY[0x277CBEB58] setWithCapacity:{-[NSObject subcredentialInvitationsDatasCount](v6, "subcredentialInvitationsDatasCount")}];
    v27 = 0u;
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v12 = [v6 subcredentialInvitationsDatas];
    v13 = [v12 countByEnumeratingWithState:&v27 objects:v31 count:16];
    if (v13)
    {
      v14 = v13;
      v15 = *v28;
      do
      {
        v16 = 0;
        do
        {
          if (*v28 != v15)
          {
            objc_enumerationMutation(v12);
          }

          v17 = *(*(&v27 + 1) + 8 * v16);
          v18 = objc_opt_class();
          v19 = NPKSecureUnarchiveObject(v17, v18);
          if (v19)
          {
            [v11 addObject:v19];
          }

          ++v16;
        }

        while (v14 != v16);
        v14 = [v12 countByEnumeratingWithState:&v27 objects:v31 count:16];
      }

      while (v14);
    }

    v20 = [v11 copy];
    v21 = *(*(a1 + 64) + 8);
    v22 = *(v21 + 40);
    *(v21 + 40) = v20;
  }

  else
  {
    v24 = pk_Payment_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

    if (!v25)
    {
      goto LABEL_13;
    }

    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v26 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v26, 2u);
    }
  }

LABEL_13:
  v23 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebService:(id)service acceptSubcredentialInvitationWithIdentifier:(id)identifier metadata:(id)metadata completion:(id)completion
{
  v35 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  metadataCopy = metadata;
  completionCopy = completion;
  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412546;
      v32 = identifierCopy;
      v33 = 2112;
      v34 = metadataCopy;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device - accept subcredential invitation request with identifier: %@ metadata: %@", buf, 0x16u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __127__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_acceptSubcredentialInvitationWithIdentifier_metadata_completion___block_invoke;
    v24[3] = &unk_279945BB0;
    v25 = identifierCopy;
    v26 = metadataCopy;
    selfCopy = self;
    v28 = completionCopy;
    dispatch_sync(internalQueue, v24);

    v16 = v25;
LABEL_13:

    goto LABEL_14;
  }

  v17 = pk_Payment_log();
  v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

  if (v18)
  {
    v19 = pk_Payment_log();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
    }
  }

  if (completionCopy)
  {
    v20 = MEMORY[0x277CCA9B8];
    v21 = *MEMORY[0x277D389E0];
    v29 = *MEMORY[0x277CCA470];
    v30 = @"Target device does not support subcredential provisioning.";
    v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v30 forKeys:&v29 count:1];
    v16 = [v20 errorWithDomain:v21 code:21 userInfo:v22];

    (*(completionCopy + 2))(completionCopy, 0, v16);
    goto LABEL_13;
  }

LABEL_14:

  v23 = *MEMORY[0x277D85DE8];
}

void __127__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_acceptSubcredentialInvitationWithIdentifier_metadata_completion___block_invoke(uint64_t a1)
{
  v28[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoAcceptSubcredentialInvitationWithIdentifierRequest);
  [(NPKProtoAcceptSubcredentialInvitationWithIdentifierRequest *)v2 setInvitationIdentifier:*(a1 + 32)];
  v3 = NPKSecureArchiveObject(*(a1 + 40));
  [(NPKProtoAcceptSubcredentialInvitationWithIdentifierRequest *)v2 setMetadataData:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoAcceptSubcredentialInvitationWithIdentifierRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:71 isResponse:0];

  v7 = *(a1 + 48);
  v27 = *MEMORY[0x277D18650];
  v28[0] = &unk_286CE7808;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 56);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __127__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_acceptSubcredentialInvitationWithIdentifier_metadata_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 56);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 48);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v9;
      v17 = "Warning: No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v6;
      v17 = "Error: No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __127__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_acceptSubcredentialInvitationWithIdentifier_metadata_completion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)paymentWebService:(id)service acceptSubcredentialInvitation:(id)invitation completion:(id)completion
{
  v24 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  completionCopy = completion;
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v23 = invitationCopy;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device - accept subcredential invitation request with invitation: %@", buf, 0xCu);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __104__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_acceptSubcredentialInvitation_completion___block_invoke;
    block[3] = &unk_279945A48;
    v19 = invitationCopy;
    selfCopy = self;
    v21 = completionCopy;
    dispatch_sync(internalQueue, block);

    v13 = v19;
LABEL_13:

    goto LABEL_14;
  }

  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v16 = pk_Payment_log();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", buf, 2u);
    }
  }

  if (completionCopy)
  {
    v13 = PKDisplayableErrorForCommonType();
    (*(completionCopy + 2))(completionCopy, 0, v13);
    goto LABEL_13;
  }

LABEL_14:

  v17 = *MEMORY[0x277D85DE8];
}

void __104__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_acceptSubcredentialInvitation_completion___block_invoke(uint64_t a1)
{
  v28[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoAcceptSubcredentialInvitationRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoAcceptSubcredentialInvitationRequest *)v2 setInvitationData:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoAcceptSubcredentialInvitationRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:122 isResponse:0];

  v7 = *(a1 + 40);
  v27 = *MEMORY[0x277D18650];
  v28[0] = &unk_286CE7808;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __104__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_acceptSubcredentialInvitation_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v9;
      v17 = "Warning: No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v6;
      v17 = "Error: No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __104__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_acceptSubcredentialInvitation_completion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)acceptSubcredentialInvitationResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target acceptSubcredentialInvitationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __83__NPKPaymentWebServiceCompanionTargetDevice_acceptSubcredentialInvitationResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __83__NPKPaymentWebServiceCompanionTargetDevice_acceptSubcredentialInvitationResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoAcceptSubcredentialInvitationResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoAcceptSubcredentialInvitationResponse *)v4 initWithData:v5];

    if ([(NPKProtoAcceptSubcredentialInvitationResponse *)v6 pending])
    {
      [v3 setOrResetCleanupTimer];
    }

    else
    {
      v10 = [*(a1 + 32) outstandingRequests];
      [v10 removeObjectForKey:*(a1 + 40)];

      v11 = [v3 completionHandler];
      v12 = *(*(a1 + 56) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;

      v14 = [(NPKProtoAcceptSubcredentialInvitationResponse *)v6 passForInvitation];
      v15 = [v14 passData];
      v16 = objc_opt_class();
      v17 = NPKSecureUnarchiveObject(v15, v16);
      v18 = *(*(a1 + 64) + 8);
      v19 = *(v18 + 40);
      *(v18 + 40) = v17;

      if ([(NPKProtoAcceptSubcredentialInvitationResponse *)v6 hasErrorData])
      {
        v20 = [(NPKProtoAcceptSubcredentialInvitationResponse *)v6 errorData];
        v21 = objc_opt_class();
        v22 = NPKSecureUnarchiveObject(v20, v21);
      }

      else
      {
        v22 = 0;
      }

      v23 = *(*(a1 + 72) + 8);
      v24 = *(v23 + 40);
      *(v23 + 40) = v22;
    }
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        *v25 = 0;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v25, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service matchingInvitationOnDevice:(id)device withTimeout:(unint64_t)timeout completion:(id)completion
{
  v30[1] = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  completionCopy = completion;
  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device - matching invitation on device request", buf, 2u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __113__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_matchingInvitationOnDevice_withTimeout_completion___block_invoke;
    v23[3] = &unk_279949D98;
    timeoutCopy = timeout;
    v24 = deviceCopy;
    selfCopy = self;
    v26 = completionCopy;
    dispatch_sync(internalQueue, v23);

    v15 = v24;
LABEL_13:

    goto LABEL_14;
  }

  v16 = pk_Payment_log();
  v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

  if (v17)
  {
    v18 = pk_Payment_log();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
    }
  }

  if (completionCopy)
  {
    v19 = MEMORY[0x277CCA9B8];
    v20 = *MEMORY[0x277D389E0];
    v29 = *MEMORY[0x277CCA470];
    v30[0] = @"Target device does not support subcredential provisioning.";
    v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:&v29 count:1];
    v15 = [v19 errorWithDomain:v20 code:21 userInfo:v21];

    (*(completionCopy + 2))(completionCopy, 0, v15);
    goto LABEL_13;
  }

LABEL_14:

  v22 = *MEMORY[0x277D85DE8];
}

void __113__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_matchingInvitationOnDevice_withTimeout_completion___block_invoke(uint64_t a1)
{
  v28[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoMatchingInvitationOnDeviceRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoMatchingInvitationOnDeviceRequest *)v2 setInvitationData:v3];

  [(NPKProtoMatchingInvitationOnDeviceRequest *)v2 setTimeoutInSeconds:*(a1 + 56)];
  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoMatchingInvitationOnDeviceRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:72 isResponse:0];

  v7 = *(a1 + 40);
  v27 = *MEMORY[0x277D18650];
  v28[0] = &unk_286CE7808;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __113__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_matchingInvitationOnDevice_withTimeout_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v9;
      v17 = "Warning: No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v6;
      v17 = "Error: No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __113__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_matchingInvitationOnDevice_withTimeout_completion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)matchingCredentialOnDeviceResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target matchingCredentialOnDeviceResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __80__NPKPaymentWebServiceCompanionTargetDevice_matchingCredentialOnDeviceResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __80__NPKPaymentWebServiceCompanionTargetDevice_matchingCredentialOnDeviceResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoMatchingInvitationOnDeviceResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoMatchingInvitationOnDeviceResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = [(NPKProtoMatchingInvitationOnDeviceResponse *)v6 invitationData];
    v12 = objc_opt_class();
    v13 = NPKSecureUnarchiveObject(v11, v12);
    v14 = *(*(a1 + 64) + 8);
    v15 = *(v14 + 40);
    *(v14 + 40) = v13;

    if ([(NPKProtoMatchingInvitationOnDeviceResponse *)v6 hasErrorData])
    {
      v16 = [(NPKProtoMatchingInvitationOnDeviceResponse *)v6 errorData];
      v17 = objc_opt_class();
      v18 = NPKSecureUnarchiveObject(v16, v17);
    }

    else
    {
      v18 = 0;
    }

    v22 = *(*(a1 + 72) + 8);
    v23 = *(v22 + 40);
    *(v22 + 40) = v18;
  }

  else
  {
    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v21 = pk_Payment_log();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
      {
        *v24 = 0;
        _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v24, 2u);
      }
    }
  }
}

- (void)handleAcceptSubcredentialProvisioningRequest:(id)request
{
  v34 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [requestCopy npkDescription];
      *buf = 138412290;
      v29 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target handleSubcredentialProvisioningRequest: incoming protobuf %@", buf, 0xCu);
    }
  }

  v9 = [NPKProtoAcceptSubcredentialInvitationRequest alloc];
  data = [requestCopy data];
  v11 = [(NPKProtoAcceptSubcredentialInvitationRequest *)v9 initWithData:data];

  invitationData = [(NPKProtoAcceptSubcredentialInvitationRequest *)v11 invitationData];
  v13 = objc_opt_class();
  v14 = NPKSecureUnarchiveObject(invitationData, v13);

  if ([(NPKProtoAcceptSubcredentialInvitationRequest *)v11 hasMetadataData])
  {
    metadataData = [(NPKProtoAcceptSubcredentialInvitationRequest *)v11 metadataData];
    v16 = objc_opt_class();
    v17 = NPKSecureUnarchiveObject(metadataData, v16);
  }

  else
  {
    v17 = 0;
  }

  v18 = pk_General_log();
  v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

  if (v19)
  {
    v20 = pk_General_log();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
    {
      v21 = objc_opt_class();
      v22 = NSStringFromClass(v21);
      *buf = 138543874;
      v29 = v22;
      v30 = 2112;
      v31 = v14;
      v32 = 2112;
      v33 = v17;
      _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Notice: %{public}@: Received handle provisioning request with invitation: %@ metadata: %@", buf, 0x20u);
    }
  }

  subcredentialInvitationCoordinator = [(NPKPaymentWebServiceCompanionTargetDevice *)self subcredentialInvitationCoordinator];
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_handleAcceptSubcredentialProvisioningRequest___block_invoke;
  v26[3] = &unk_27994A468;
  v26[4] = self;
  v27 = v14;
  v24 = v14;
  [subcredentialInvitationCoordinator startProvisioningWithInvitation:v24 metadata:v17 completion:v26];

  v25 = *MEMORY[0x277D85DE8];
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_handleAcceptSubcredentialProvisioningRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v25 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = pk_General_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_General_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = *(a1 + 32);
      v11 = objc_opt_class();
      v12 = NSStringFromClass(v11);
      v13 = [*(a1 + 40) description];
      v14 = [v5 description];
      v15 = [v6 description];
      v17 = 138544130;
      v18 = v12;
      v19 = 2112;
      v20 = v13;
      v21 = 2112;
      v22 = v14;
      v23 = 2112;
      v24 = v15;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: %{public}@: Subcredential provisioning for invitation: %@ completed with pass: %@ error %@", &v17, 0x2Au);
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)handleAcceptSubcredentialProvisioningForMailboxAddressRequest:(id)request
{
  v30 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [requestCopy npkDescription];
      *buf = 138412290;
      v25 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target handleAcceptSubcredentialProvisioningForMailboxAddressRequest: incoming protobuf %@", buf, 0xCu);
    }
  }

  v9 = [NPKProtoAcceptSubcredentialInvitationWithMailboxAddressRequest alloc];
  data = [requestCopy data];
  v11 = [(NPKProtoAcceptSubcredentialInvitationWithMailboxAddressRequest *)v9 initWithData:data];

  mailboxAddress = [(NPKProtoAcceptSubcredentialInvitationWithMailboxAddressRequest *)v11 mailboxAddress];
  activationCode = [(NPKProtoAcceptSubcredentialInvitationWithMailboxAddressRequest *)v11 activationCode];
  v14 = pk_General_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v16 = pk_General_log();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
      v17 = objc_opt_class();
      v18 = NSStringFromClass(v17);
      *buf = 138543875;
      v25 = v18;
      v26 = 2113;
      v27 = mailboxAddress;
      v28 = 2113;
      v29 = activationCode;
      _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: %{public}@: Received handle provisioning request with mailboxAddress: %{private}@, activationCode: %{private}@", buf, 0x20u);
    }
  }

  subcredentialInvitationCoordinator = [(NPKPaymentWebServiceCompanionTargetDevice *)self subcredentialInvitationCoordinator];
  v22[0] = MEMORY[0x277D85DD0];
  v22[1] = 3221225472;
  v22[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_handleAcceptSubcredentialProvisioningForMailboxAddressRequest___block_invoke;
  v22[3] = &unk_27994A468;
  v22[4] = self;
  v23 = mailboxAddress;
  v20 = mailboxAddress;
  [subcredentialInvitationCoordinator startProvisioningWithMailboxAddress:v20 activationCode:activationCode completion:v22];

  v21 = *MEMORY[0x277D85DE8];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_handleAcceptSubcredentialProvisioningForMailboxAddressRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v25 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = pk_General_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_General_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = *(a1 + 32);
      v11 = objc_opt_class();
      v12 = NSStringFromClass(v11);
      v13 = *(a1 + 40);
      v14 = [v5 description];
      v15 = [v6 description];
      v17 = 138544131;
      v18 = v12;
      v19 = 2113;
      v20 = v13;
      v21 = 2112;
      v22 = v14;
      v23 = 2112;
      v24 = v15;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: %{public}@: Subcredential provisioning for mailbox address: %{private}@ completed with pass: %@ error %@", &v17, 0x2Au);
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebService:(id)service accountAttestationAnonymizationSaltWithCompletion:(id)completion
{
  v25 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = _Block_copy(completionCopy);
      *buf = 138412290;
      v24 = v9;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Target device - account attestation anonymization salt request with completion: %@", buf, 0xCu);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __113__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_accountAttestationAnonymizationSaltWithCompletion___block_invoke;
    v19[3] = &unk_279945530;
    v19[4] = self;
    v20 = completionCopy;
    dispatch_sync(internalQueue, v19);
  }

  else
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
      }
    }

    if (completionCopy)
    {
      v14 = MEMORY[0x277CCA9B8];
      v15 = *MEMORY[0x277D389E0];
      v21 = *MEMORY[0x277CCA470];
      v22 = @"Target device does not support subcredential provisioning.";
      v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v22 forKeys:&v21 count:1];
      v17 = [v14 errorWithDomain:v15 code:21 userInfo:v16];

      (*(completionCopy + 2))(completionCopy, 0, v17);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __113__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_accountAttestationAnonymizationSaltWithCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoAccountAttestationAnonymizationSaltRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoAccountAttestationAnonymizationSaltRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:74 isResponse:0];

  v6 = *(a1 + 32);
  v26 = *MEMORY[0x277D18650];
  v27[0] = &unk_286CE7808;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __113__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_accountAttestationAnonymizationSaltWithCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

void __113__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_accountAttestationAnonymizationSaltWithCompletion___block_invoke_2(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (*(a1 + 32))
  {
    v4 = pk_Payment_log();
    v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

    if (v5)
    {
      v6 = pk_Payment_log();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
      {
        v7 = [v3 description];
        v9 = 138412290;
        v10 = v7;
        _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: %@", &v9, 0xCu);
      }
    }

    (*(*(a1 + 32) + 16))();
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)accountAttestationAnonymizationSaltResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target accountAttestationAnonymizationSaltResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __89__NPKPaymentWebServiceCompanionTargetDevice_accountAttestationAnonymizationSaltResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __89__NPKPaymentWebServiceCompanionTargetDevice_accountAttestationAnonymizationSaltResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoAccountAttestationAnonymizationSaltResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoAccountAttestationAnonymizationSaltResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoAccountAttestationAnonymizationSaltResponse *)v7 anonymizationSalt];
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    v15 = [(NPKProtoAccountAttestationAnonymizationSaltResponse *)v7 hasErrorData];
    if (v15)
    {
      v1 = [(NPKProtoAccountAttestationAnonymizationSaltResponse *)v7 errorData];
      v16 = objc_opt_class();
      v17 = NPKSecureUnarchiveObject(v1, v16);
    }

    else
    {
      v17 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
    if (v15)
    {
    }
  }

  else
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

    if (v19)
    {
      v20 = pk_Payment_log();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)fetchOrInitializeAccountAttestationAnonymizationSaltRequest:(id)request
{
  v19 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [requestCopy npkDescription];
      *buf = 138412290;
      v18 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device - received account attestation anonymization salt request: %@", buf, 0xCu);
    }
  }

  context = [requestCopy context];
  outgoingResponseIdentifier = [context outgoingResponseIdentifier];

  objc_initWeak(buf, self);
  subcredentialInvitationCoordinator = [(NPKPaymentWebServiceCompanionTargetDevice *)self subcredentialInvitationCoordinator];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __105__NPKPaymentWebServiceCompanionTargetDevice_fetchOrInitializeAccountAttestationAnonymizationSaltRequest___block_invoke;
  v14[3] = &unk_279945D40;
  objc_copyWeak(&v16, buf);
  v12 = outgoingResponseIdentifier;
  v15 = v12;
  [subcredentialInvitationCoordinator fetchOrInitializeAccountAttestationAnonymizationSaltIfNecessaryWithCompletion:v14];

  objc_destroyWeak(&v16);
  objc_destroyWeak(buf);

  v13 = *MEMORY[0x277D85DE8];
}

void __105__NPKPaymentWebServiceCompanionTargetDevice_fetchOrInitializeAccountAttestationAnonymizationSaltRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = [WeakRetained internalQueue];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __105__NPKPaymentWebServiceCompanionTargetDevice_fetchOrInitializeAccountAttestationAnonymizationSaltRequest___block_invoke_2;
  v11[3] = &unk_279945308;
  objc_copyWeak(&v15, (a1 + 40));
  v12 = v5;
  v13 = v6;
  v14 = *(a1 + 32);
  v9 = v6;
  v10 = v5;
  dispatch_sync(v8, v11);

  objc_destroyWeak(&v15);
}

void __105__NPKPaymentWebServiceCompanionTargetDevice_fetchOrInitializeAccountAttestationAnonymizationSaltRequest___block_invoke_2(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v3 = objc_alloc_init(NPKProtoAccountAttestationAnonymizationSaltResponse);
  [(NPKProtoAccountAttestationAnonymizationSaltResponse *)v3 setAnonymizationSalt:*(a1 + 32)];
  v4 = NPKSecureArchiveObject(*(a1 + 40));
  [(NPKProtoAccountAttestationAnonymizationSaltResponse *)v3 setErrorData:v4];

  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [(NPKProtoAccountAttestationAnonymizationSaltResponse *)v3 data];
  v7 = [v5 initWithProtobufData:v6 type:74 isResponse:1];

  v8 = [WeakRetained _sendProtobuf:v7 responseIdentifier:*(a1 + 48)];
  if (!v8)
  {
    v9 = pk_Payment_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);

    if (v10)
    {
      v11 = pk_Payment_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v13 = 138412290;
        v14 = v7;
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", &v13, 0xCu);
      }
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebService:(id)service setAccountAttestationAnonymizationSalt:(id)salt withCompletion:(id)completion
{
  v30 = *MEMORY[0x277D85DE8];
  saltCopy = salt;
  completionCopy = completion;
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = _Block_copy(completionCopy);
      *buf = 138412290;
      v29 = v12;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device - set account attestation anonymization salt request with completion: %@", buf, 0xCu);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __117__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_setAccountAttestationAnonymizationSalt_withCompletion___block_invoke;
    block[3] = &unk_279945A48;
    v23 = saltCopy;
    selfCopy = self;
    v25 = completionCopy;
    dispatch_sync(internalQueue, block);

    v14 = v23;
LABEL_13:

    goto LABEL_14;
  }

  v15 = pk_Payment_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
    }
  }

  if (completionCopy)
  {
    v18 = MEMORY[0x277CCA9B8];
    v19 = *MEMORY[0x277D389E0];
    v26 = *MEMORY[0x277CCA470];
    v27 = @"Target device does not support subcredential provisioning.";
    v20 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
    v14 = [v18 errorWithDomain:v19 code:21 userInfo:v20];

    (*(completionCopy + 2))(completionCopy, v14);
    goto LABEL_13;
  }

LABEL_14:

  v21 = *MEMORY[0x277D85DE8];
}

void __117__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_setAccountAttestationAnonymizationSalt_withCompletion___block_invoke(uint64_t a1)
{
  v27[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoSetAccountAttestationAnonymizationSaltRequest);
  [(NPKProtoSetAccountAttestationAnonymizationSaltRequest *)v2 setAnonymizationSalt:*(a1 + 32)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoSetAccountAttestationAnonymizationSaltRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:75 isResponse:0];

  v6 = *(a1 + 40);
  v26 = *MEMORY[0x277D18650];
  v27[0] = &unk_286CE7808;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 48);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __117__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_setAccountAttestationAnonymizationSalt_withCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 48);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 40);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v25 = v5;
      v16 = "Error: No message identifier for protobuf %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __117__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_setAccountAttestationAnonymizationSalt_withCompletion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

- (void)setAccountAttestationAnonymizationSaltResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target setAccountAttestationAnonymizationSaltResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __92__NPKPaymentWebServiceCompanionTargetDevice_setAccountAttestationAnonymizationSaltResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __92__NPKPaymentWebServiceCompanionTargetDevice_setAccountAttestationAnonymizationSaltResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoSetAccountAttestationAnonymizationSaltResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoSetAccountAttestationAnonymizationSaltResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    if ([(NPKProtoSetAccountAttestationAnonymizationSaltResponse *)v6 hasErrorData])
    {
      v11 = [(NPKProtoSetAccountAttestationAnonymizationSaltResponse *)v6 errorData];
      v12 = objc_opt_class();
      v13 = NPKSecureUnarchiveObject(v11, v12);
    }

    else
    {
      v13 = 0;
    }

    v17 = *(*(a1 + 64) + 8);
    v18 = *(v17 + 40);
    *(v17 + 40) = v13;
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

    if (v15)
    {
      v16 = pk_Payment_log();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        *v19 = 0;
        _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service requestSubcredentialInvitation:(id)invitation completion:(id)completion
{
  v32 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  completionCopy = completion;
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = _Block_copy(completionCopy);
      *buf = 138412546;
      v29 = invitationCopy;
      v30 = 2112;
      v31 = v12;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device - request subcredential invitation %@ with completion %@", buf, 0x16u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __105__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_requestSubcredentialInvitation_completion___block_invoke;
    block[3] = &unk_279945A48;
    v23 = invitationCopy;
    selfCopy = self;
    v25 = completionCopy;
    dispatch_sync(internalQueue, block);

    v14 = v23;
LABEL_13:

    goto LABEL_14;
  }

  v15 = pk_Payment_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
    }
  }

  if (completionCopy)
  {
    v18 = MEMORY[0x277CCA9B8];
    v19 = *MEMORY[0x277D389E0];
    v26 = *MEMORY[0x277CCA470];
    v27 = @"Target device does not support subcredential provisioning.";
    v20 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
    v14 = [v18 errorWithDomain:v19 code:21 userInfo:v20];

    (*(completionCopy + 2))(completionCopy, v14);
    goto LABEL_13;
  }

LABEL_14:

  v21 = *MEMORY[0x277D85DE8];
}

void __105__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_requestSubcredentialInvitation_completion___block_invoke(uint64_t a1)
{
  v28[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoRequestSubcredentialInvitationRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoRequestSubcredentialInvitationRequest *)v2 setInvitationData:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoRequestSubcredentialInvitationRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:76 isResponse:0];

  v7 = *(a1 + 40);
  v27 = *MEMORY[0x277D18650];
  v28[0] = &unk_286CE7808;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __105__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_requestSubcredentialInvitation_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v9;
      v17 = "Warning: No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v6;
      v17 = "Error: No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __105__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_requestSubcredentialInvitation_completion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

- (void)requestSubcredentialInvitationResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target requestSubcredentialInvitationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_requestSubcredentialInvitationResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __84__NPKPaymentWebServiceCompanionTargetDevice_requestSubcredentialInvitationResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoRequestSubcredentialInvitationResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoRequestSubcredentialInvitationResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    if ([(NPKProtoRequestSubcredentialInvitationResponse *)v6 hasErrorData])
    {
      v11 = [(NPKProtoRequestSubcredentialInvitationResponse *)v6 errorData];
      v12 = objc_opt_class();
      v13 = NPKSecureUnarchiveObject(v11, v12);
    }

    else
    {
      v13 = 0;
    }

    v17 = *(*(a1 + 64) + 8);
    v18 = *(v17 + 40);
    *(v17 + 40) = v13;
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

    if (v15)
    {
      v16 = pk_Payment_log();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        *v19 = 0;
        _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service updateMetadataOnPass:(id)pass withCredential:(id)credential completion:(id)completion
{
  v32 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  credentialCopy = credential;
  completionCopy = completion;
  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      v15 = _Block_copy(completionCopy);
      *buf = 138412802;
      v27 = passCopy;
      v28 = 2112;
      v29 = credentialCopy;
      v30 = 2112;
      v31 = v15;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device - update metadata on pass %@ with credential %@ completion %@", buf, 0x20u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __110__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_updateMetadataOnPass_withCredential_completion___block_invoke;
    v21[3] = &unk_279945BB0;
    v22 = passCopy;
    selfCopy = self;
    v24 = credentialCopy;
    v25 = completionCopy;
    dispatch_sync(internalQueue, v21);
  }

  else
  {
    v17 = pk_Payment_log();
    v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

    if (v18)
    {
      v19 = pk_Payment_log();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }

  v20 = *MEMORY[0x277D85DE8];
}

void __110__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_updateMetadataOnPass_withCredential_completion___block_invoke(uint64_t a1)
{
  v29[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoUpdateSubcredentialMetadataRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoUpdateSubcredentialMetadataRequest *)v2 setPassData:v3];

  v4 = [*(a1 + 40) _secureArchiveSubcredential:*(a1 + 48)];
  [(NPKProtoUpdateSubcredentialMetadataRequest *)v2 setCredentialData:v4];

  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [(NPKProtoUpdateSubcredentialMetadataRequest *)v2 data];
  v7 = [v5 initWithProtobufData:v6 type:77 isResponse:0];

  v8 = *(a1 + 40);
  v28 = *MEMORY[0x277D18650];
  v29[0] = &unk_286CE7808;
  v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:&v28 count:1];
  v10 = [v8 _sendProtobuf:v7 responseExpected:1 extraOptions:v9];

  if (v10)
  {
    v11 = *(a1 + 56);
    if (v11)
    {
      v12 = _Block_copy(v11);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __110__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_updateMetadataOnPass_withCredential_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v25 = *(a1 + 56);
      v13 = _Block_copy(aBlock);
      v14 = *(a1 + 40);
      v15 = _Block_copy(v12);
      [v14 _trackOutstandingRequestWithMessageIdentifier:v10 completionHandler:v15 errorHandler:v13];

LABEL_11:
      goto LABEL_12;
    }

    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT);

    if (v22)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v27 = v10;
      v18 = "Warning: No response expected for message with identifier %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);

    if (v17)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v27 = v7;
      v18 = "Error: No message identifier for protobuf %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v19, v20, v18, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v23 = *MEMORY[0x277D85DE8];
}

uint64_t __110__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_updateMetadataOnPass_withCredential_completion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)updateSubcredentialMetadataResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target updateSubcredentialMetadataResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __81__NPKPaymentWebServiceCompanionTargetDevice_updateSubcredentialMetadataResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __81__NPKPaymentWebServiceCompanionTargetDevice_updateSubcredentialMetadataResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoUpdateSubcredentialMetadataResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoUpdateSubcredentialMetadataResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = [(NPKProtoUpdateSubcredentialMetadataResponse *)v6 passData];
    v12 = objc_opt_class();
    v13 = NPKSecureUnarchiveObject(v11, v12);

    [*(a1 + 32) _updateDataAccessorForPass:v13];
    v14 = *(*(a1 + 64) + 8);
    v15 = *(v14 + 40);
    *(v14 + 40) = v13;
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

    if (v17)
    {
      v18 = pk_Payment_log();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        *v19 = 0;
        _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
      }
    }
  }
}

- (void)registerCredentialsWithIdentifiers:(id)identifiers completion:(id)completion
{
  v29 = *MEMORY[0x277D85DE8];
  identifiersCopy = identifiers;
  completionCopy = completion;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v28 = identifiersCopy;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Target device - register credentials with identifiers %@", buf, 0xCu);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_registerCredentialsWithIdentifiers_completion___block_invoke;
    block[3] = &unk_279945A48;
    v22 = identifiersCopy;
    selfCopy = self;
    v24 = completionCopy;
    dispatch_sync(internalQueue, block);

    v12 = v22;
LABEL_13:

    goto LABEL_14;
  }

  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
    }
  }

  if (completionCopy)
  {
    v16 = MEMORY[0x277CCA9B8];
    v17 = *MEMORY[0x277D389E0];
    v25 = *MEMORY[0x277CCA470];
    v26 = @"Target device does not support subcredential provisioning.";
    v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v26 forKeys:&v25 count:1];
    v12 = [v16 errorWithDomain:v17 code:21 userInfo:v18];

    v19 = [MEMORY[0x277CBEB98] setWithObject:v12];
    (*(completionCopy + 2))(completionCopy, 0, v19);

    goto LABEL_13;
  }

LABEL_14:

  v20 = *MEMORY[0x277D85DE8];
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_registerCredentialsWithIdentifiers_completion___block_invoke(uint64_t a1)
{
  v34[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoRegisterSubcredentialsRequest);
  v3 = *(a1 + 32);
  v29[0] = MEMORY[0x277D85DD0];
  v29[1] = 3221225472;
  v29[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_registerCredentialsWithIdentifiers_completion___block_invoke_2;
  v29[3] = &unk_279948BC0;
  v4 = v2;
  v30 = v4;
  [v3 enumerateObjectsUsingBlock:v29];
  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [(NPKProtoRegisterSubcredentialsRequest *)v4 data];
  v7 = [v5 initWithProtobufData:v6 type:78 isResponse:0];

  v8 = *(a1 + 40);
  v33 = *MEMORY[0x277D18650];
  v34[0] = &unk_286CE7808;
  v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v34 forKeys:&v33 count:1];
  v10 = [v8 _sendProtobuf:v7 responseExpected:1 extraOptions:v9];

  if (v10)
  {
    v11 = *(a1 + 48);
    if (v11)
    {
      v12 = _Block_copy(v11);
      v24 = MEMORY[0x277D85DD0];
      v25 = 3221225472;
      v26 = __91__NPKPaymentWebServiceCompanionTargetDevice_registerCredentialsWithIdentifiers_completion___block_invoke_3;
      v27 = &unk_279945218;
      v28 = *(a1 + 48);
      v13 = _Block_copy(&v24);
      v14 = *(a1 + 40);
      v15 = _Block_copy(v12);
      [v14 _trackOutstandingRequestWithMessageIdentifier:v10 completionHandler:v15 errorHandler:{v13, v24, v25, v26, v27}];

LABEL_11:
      goto LABEL_12;
    }

    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT);

    if (v22)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v32 = v10;
      v18 = "Warning: No response expected for message with identifier %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);

    if (v17)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v32 = v7;
      v18 = "Error: No message identifier for protobuf %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v19, v20, v18, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v23 = *MEMORY[0x277D85DE8];
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_registerCredentialsWithIdentifiers_completion___block_invoke_3(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (v2)
  {
    v3 = [MEMORY[0x277CBEB98] setWithObject:a2];
    (*(v2 + 16))(v2, 0, v3);
  }
}

- (void)registerCredentialsResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target registerCredentialsResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __73__NPKPaymentWebServiceCompanionTargetDevice_registerCredentialsResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v30;
    v22 = &v24;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __73__NPKPaymentWebServiceCompanionTargetDevice_registerCredentialsResponse___block_invoke(uint64_t a1)
{
  v51 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v39 = v3;
    v4 = [NPKProtoRegisterSubcredentialsResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoRegisterSubcredentialsResponse *)v4 initWithData:v5];

    v7 = [MEMORY[0x277CBEB58] setWithCapacity:{-[NSObject passesDatasCount](v6, "passesDatasCount")}];
    v45 = 0u;
    v46 = 0u;
    v47 = 0u;
    v48 = 0u;
    v8 = [v6 passesDatas];
    v9 = [v8 countByEnumeratingWithState:&v45 objects:v50 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v46;
      do
      {
        v12 = 0;
        do
        {
          if (*v46 != v11)
          {
            objc_enumerationMutation(v8);
          }

          v13 = *(*(&v45 + 1) + 8 * v12);
          v14 = objc_opt_class();
          v15 = NPKSecureUnarchiveObject(v13, v14);
          if (v15)
          {
            [*(a1 + 32) _updateDataAccessorForPass:v15];
            [v7 addObject:v15];
          }

          ++v12;
        }

        while (v10 != v12);
        v10 = [v8 countByEnumeratingWithState:&v45 objects:v50 count:16];
      }

      while (v10);
    }

    v16 = [v7 copy];
    v17 = *(*(a1 + 56) + 8);
    v18 = *(v17 + 40);
    *(v17 + 40) = v16;

    v19 = [MEMORY[0x277CBEB58] setWithCapacity:{-[NSObject errorsDatasCount](v6, "errorsDatasCount")}];
    v41 = 0u;
    v42 = 0u;
    v43 = 0u;
    v44 = 0u;
    v20 = [v6 errorsDatas];
    v21 = [v20 countByEnumeratingWithState:&v41 objects:v49 count:16];
    if (v21)
    {
      v22 = v21;
      v23 = *v42;
      do
      {
        v24 = 0;
        do
        {
          if (*v42 != v23)
          {
            objc_enumerationMutation(v20);
          }

          v25 = *(*(&v41 + 1) + 8 * v24);
          if (v25)
          {
            v26 = objc_opt_class();
            v27 = NPKSecureUnarchiveObject(v25, v26);
            if (v27)
            {
              v28 = v27;
              [v19 addObject:v27];
            }
          }

          ++v24;
        }

        while (v22 != v24);
        v22 = [v20 countByEnumeratingWithState:&v41 objects:v49 count:16];
      }

      while (v22);
    }

    v29 = [v19 copy];
    v30 = *(*(a1 + 64) + 8);
    v31 = *(v30 + 40);
    *(v30 + 40) = v29;

    v32 = [*(a1 + 32) outstandingRequests];
    [v32 removeObjectForKey:*(a1 + 40)];

    v3 = v39;
    v33 = [v39 completionHandler];
    v34 = *(*(a1 + 72) + 8);
    v35 = *(v34 + 40);
    *(v34 + 40) = v33;
  }

  else
  {
    v37 = pk_Payment_log();
    v38 = os_log_type_enabled(v37, OS_LOG_TYPE_DEFAULT);

    if (!v38)
    {
      goto LABEL_23;
    }

    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", buf, 2u);
    }
  }

LABEL_23:
  v36 = *MEMORY[0x277D85DE8];
}

- (void)revokeCredentialsWithIdentifiers:(id)identifiers completion:(id)completion
{
  v25 = *MEMORY[0x277D85DE8];
  identifiersCopy = identifiers;
  completionCopy = completion;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v11 = _Block_copy(completionCopy);
      *buf = 138412546;
      v22 = identifiersCopy;
      v23 = 2112;
      v24 = v11;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Target device - revoke credentials with identifiers %@ completion %@", buf, 0x16u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __89__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithIdentifiers_completion___block_invoke;
    block[3] = &unk_279945A48;
    v18 = identifiersCopy;
    selfCopy = self;
    v20 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __89__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithIdentifiers_completion___block_invoke(uint64_t a1)
{
  v34[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoRevokeSubcredentialsRequest);
  v3 = *(a1 + 32);
  v29[0] = MEMORY[0x277D85DD0];
  v29[1] = 3221225472;
  v29[2] = __89__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithIdentifiers_completion___block_invoke_2;
  v29[3] = &unk_279948BC0;
  v4 = v2;
  v30 = v4;
  [v3 enumerateObjectsUsingBlock:v29];
  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [(NPKProtoRevokeSubcredentialsRequest *)v4 data];
  v7 = [v5 initWithProtobufData:v6 type:79 isResponse:0];

  v8 = *(a1 + 40);
  v33 = *MEMORY[0x277D18650];
  v34[0] = &unk_286CE7808;
  v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v34 forKeys:&v33 count:1];
  v10 = [v8 _sendProtobuf:v7 responseExpected:1 extraOptions:v9];

  if (v10)
  {
    v11 = *(a1 + 48);
    if (v11)
    {
      v12 = _Block_copy(v11);
      v24 = MEMORY[0x277D85DD0];
      v25 = 3221225472;
      v26 = __89__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithIdentifiers_completion___block_invoke_3;
      v27 = &unk_279945218;
      v28 = *(a1 + 48);
      v13 = _Block_copy(&v24);
      v14 = *(a1 + 40);
      v15 = _Block_copy(v12);
      [v14 _trackOutstandingRequestWithMessageIdentifier:v10 completionHandler:v15 errorHandler:{v13, v24, v25, v26, v27}];

LABEL_11:
      goto LABEL_12;
    }

    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT);

    if (v22)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v32 = v10;
      v18 = "Warning: No response expected for message with identifier %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);

    if (v17)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v32 = v7;
      v18 = "Error: No message identifier for protobuf %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v19, v20, v18, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v23 = *MEMORY[0x277D85DE8];
}

uint64_t __89__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithIdentifiers_completion___block_invoke_3(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)revokeCredentialsResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target revokeCredentialsResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v23;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __71__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoRevokeSubcredentialsResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoRevokeSubcredentialsResponse *)v4 initWithData:v5];

    *(*(*(a1 + 56) + 8) + 24) = [(NPKProtoRevokeSubcredentialsResponse *)v6 success];
    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 64) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;
  }

  else
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service removeSharingInvitation:(id)invitation withCompletion:(id)completion
{
  v32 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  completionCopy = completion;
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = _Block_copy(completionCopy);
      *buf = 138412546;
      v29 = invitationCopy;
      v30 = 2112;
      v31 = v12;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device - remove sharing invitation %@ with completion %@", buf, 0x16u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_removeSharingInvitation_withCompletion___block_invoke;
    block[3] = &unk_279945A48;
    v23 = invitationCopy;
    selfCopy = self;
    v25 = completionCopy;
    dispatch_sync(internalQueue, block);

    v14 = v23;
LABEL_13:

    goto LABEL_14;
  }

  v15 = pk_Payment_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
    }
  }

  if (completionCopy)
  {
    v18 = MEMORY[0x277CCA9B8];
    v19 = *MEMORY[0x277D389E0];
    v26 = *MEMORY[0x277CCA470];
    v27 = @"Target device does not support subcredential provisioning.";
    v20 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
    v14 = [v18 errorWithDomain:v19 code:21 userInfo:v20];

    (*(completionCopy + 2))(completionCopy, v14 != 0);
    goto LABEL_13;
  }

LABEL_14:

  v21 = *MEMORY[0x277D85DE8];
}

void __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_removeSharingInvitation_withCompletion___block_invoke(uint64_t a1)
{
  v28[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoRemoveSharingInvitationRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoRemoveSharingInvitationRequest *)v2 setInvitationData:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoRemoveSharingInvitationRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:80 isResponse:0];

  v7 = *(a1 + 40);
  v27 = *MEMORY[0x277D18650];
  v28[0] = &unk_286CE7808;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_removeSharingInvitation_withCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v9;
      v17 = "Warning: No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v6;
      v17 = "Error: No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __102__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_removeSharingInvitation_withCompletion___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, a2 != 0);
  }

  return result;
}

- (void)removeSharingInvitationResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target removeSharingInvitationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __77__NPKPaymentWebServiceCompanionTargetDevice_removeSharingInvitationResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __77__NPKPaymentWebServiceCompanionTargetDevice_removeSharingInvitationResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoRemoveSharingInvitationResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoRemoveSharingInvitationResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoRemoveSharingInvitationResponse *)v6 success];
  }

  else
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)handleCredentialsChange:(id)change
{
  v39 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [changeCopy npkDescription];
      *buf = 138412290;
      v36 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target handleCredentialsChange: incoming protobuf %@", buf, 0xCu);
    }
  }

  v9 = [NPKProtoHandleCredentialsChangeRequest alloc];
  data = [changeCopy data];
  v11 = [(NPKProtoHandleCredentialsChangeRequest *)v9 initWithData:data];

  passID = [(NPKProtoHandleCredentialsChangeRequest *)v11 passID];
  paymentApplicationID = [(NPKProtoHandleCredentialsChangeRequest *)v11 paymentApplicationID];
  v14 = [MEMORY[0x277CBEB58] set];
  v15 = pk_Payment_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      credentialsBytesCount = [(NPKProtoHandleCredentialsChangeRequest *)v11 credentialsBytesCount];
      *buf = 138412802;
      v36 = passID;
      v37 = 1024;
      *v38 = credentialsBytesCount;
      *&v38[4] = 2112;
      *&v38[6] = paymentApplicationID;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Got credentials update for unique ID %@ with %u credentials for paymentApplicationIdentifier %@", buf, 0x1Cu);
    }
  }

  credentialsBytes = [(NPKProtoHandleCredentialsChangeRequest *)v11 credentialsBytes];
  v33[0] = MEMORY[0x277D85DD0];
  v33[1] = 3221225472;
  v33[2] = __69__NPKPaymentWebServiceCompanionTargetDevice_handleCredentialsChange___block_invoke;
  v33[3] = &unk_279949F18;
  v33[4] = self;
  v20 = v14;
  v34 = v20;
  [credentialsBytes enumerateObjectsUsingBlock:v33];

  v21 = pk_General_log();
  v22 = os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT);

  if (v22)
  {
    v23 = pk_General_log();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412802;
      v36 = v20;
      v37 = 2112;
      *v38 = passID;
      *&v38[8] = 2112;
      *&v38[10] = paymentApplicationID;
      _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_DEFAULT, "Notice: Handling credentials update %@ for unique ID: %@, paymentApplicationIdentifier: %@", buf, 0x20u);
    }
  }

  delegate = [(NPKPaymentWebServiceCompanionTargetDevice *)self delegate];
  v29[0] = MEMORY[0x277D85DD0];
  v29[1] = 3221225472;
  v29[2] = __69__NPKPaymentWebServiceCompanionTargetDevice_handleCredentialsChange___block_invoke_754;
  v29[3] = &unk_2799463A0;
  v30 = v20;
  v31 = passID;
  v32 = paymentApplicationID;
  v25 = paymentApplicationID;
  v26 = passID;
  v27 = v20;
  [delegate handleCredentialsUpdate:v27 forUniqueID:v26 paymentApplicationIdentifier:v25 completion:v29];

  v28 = *MEMORY[0x277D85DE8];
}

void __69__NPKPaymentWebServiceCompanionTargetDevice_handleCredentialsChange___block_invoke(uint64_t a1, uint64_t a2)
{
  v3 = [*(a1 + 32) _secureUnarchiveSubcredential:a2];
  if (v3)
  {
    v4 = v3;
    [*(a1 + 40) addObject:v3];
    v3 = v4;
  }
}

void __69__NPKPaymentWebServiceCompanionTargetDevice_handleCredentialsChange___block_invoke_754(void *a1, void *a2)
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_General_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v7 = a1[4];
      v8 = a1[5];
      v9 = a1[6];
      v11 = 138413058;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      v15 = 2112;
      v16 = v9;
      v17 = 2112;
      v18 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Handled credentials update %@ for unique ID %@ paymentApplicationIdentifier %@ with error: %@", &v11, 0x2Au);
    }
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebService:(id)service declineRelatedSharingInvitationsIfNecessary:(id)necessary withCompletion:(id)completion
{
  v32 = *MEMORY[0x277D85DE8];
  necessaryCopy = necessary;
  completionCopy = completion;
  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = _Block_copy(completionCopy);
      *buf = 138412546;
      v29 = necessaryCopy;
      v30 = 2112;
      v31 = v12;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device - decline related invitations if necessary for invitation %@ with completion %@", buf, 0x16u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __122__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_declineRelatedSharingInvitationsIfNecessary_withCompletion___block_invoke;
    block[3] = &unk_279945A48;
    v23 = necessaryCopy;
    selfCopy = self;
    v25 = completionCopy;
    dispatch_sync(internalQueue, block);

    v14 = v23;
LABEL_13:

    goto LABEL_14;
  }

  v15 = pk_Payment_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support subcredential provisioning.", buf, 2u);
    }
  }

  if (completionCopy)
  {
    v18 = MEMORY[0x277CCA9B8];
    v19 = *MEMORY[0x277D389E0];
    v26 = *MEMORY[0x277CCA470];
    v27 = @"Target device does not support subcredential provisioning.";
    v20 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
    v14 = [v18 errorWithDomain:v19 code:21 userInfo:v20];

    (*(completionCopy + 2))(completionCopy, v14 != 0);
    goto LABEL_13;
  }

LABEL_14:

  v21 = *MEMORY[0x277D85DE8];
}

void __122__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_declineRelatedSharingInvitationsIfNecessary_withCompletion___block_invoke(uint64_t a1)
{
  v28[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoDeclineRelatedInvitationsIfNecessaryRequest);
  v3 = NPKSecureArchiveObject(*(a1 + 32));
  [(NPKProtoDeclineRelatedInvitationsIfNecessaryRequest *)v2 setInvitationData:v3];

  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoDeclineRelatedInvitationsIfNecessaryRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:82 isResponse:0];

  v7 = *(a1 + 40);
  v27 = *MEMORY[0x277D18650];
  v28[0] = &unk_286CE7808;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  v9 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v8];

  if (v9)
  {
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = _Block_copy(v10);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __122__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_declineRelatedSharingInvitationsIfNecessary_withCompletion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 48);
      v12 = _Block_copy(aBlock);
      v13 = *(a1 + 40);
      v14 = _Block_copy(v11);
      [v13 _trackOutstandingRequestWithMessageIdentifier:v9 completionHandler:v14 errorHandler:v12];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v9;
      v17 = "Warning: No response expected for message with identifier %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

    if (v16)
    {
      v11 = pk_Payment_log();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v6;
      v17 = "Error: No message identifier for protobuf %@";
      v18 = v11;
      v19 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v18, v19, v17, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __122__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_declineRelatedSharingInvitationsIfNecessary_withCompletion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)declineRelatedSharingInvitationsIfNecessaryRequest:(id)request
{
  v25 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [requestCopy npkDescription];
      *buf = 138412290;
      v24 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device - received decline related sharing invitations if necessary request: %@", buf, 0xCu);
    }
  }

  v9 = [NPKProtoDeclineRelatedInvitationsIfNecessaryRequest alloc];
  data = [requestCopy data];
  v11 = [(NPKProtoDeclineRelatedInvitationsIfNecessaryRequest *)v9 initWithData:data];

  invitationData = [(NPKProtoDeclineRelatedInvitationsIfNecessaryRequest *)v11 invitationData];
  v13 = objc_opt_class();
  v14 = NPKSecureUnarchiveObject(invitationData, v13);

  context = [requestCopy context];
  outgoingResponseIdentifier = [context outgoingResponseIdentifier];

  objc_initWeak(buf, self);
  subcredentialInvitationCoordinator = [(NPKPaymentWebServiceCompanionTargetDevice *)self subcredentialInvitationCoordinator];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __96__NPKPaymentWebServiceCompanionTargetDevice_declineRelatedSharingInvitationsIfNecessaryRequest___block_invoke;
  v20[3] = &unk_27994A4B8;
  objc_copyWeak(&v22, buf);
  v18 = outgoingResponseIdentifier;
  v21 = v18;
  [subcredentialInvitationCoordinator declineRelatedInvitationsIfNecessaryForInvitation:v14 completion:v20];

  objc_destroyWeak(&v22);
  objc_destroyWeak(buf);

  v19 = *MEMORY[0x277D85DE8];
}

void __96__NPKPaymentWebServiceCompanionTargetDevice_declineRelatedSharingInvitationsIfNecessaryRequest___block_invoke(uint64_t a1, char a2)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = [WeakRetained internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __96__NPKPaymentWebServiceCompanionTargetDevice_declineRelatedSharingInvitationsIfNecessaryRequest___block_invoke_2;
  block[3] = &unk_27994A490;
  objc_copyWeak(&v8, (a1 + 40));
  v9 = a2;
  v7 = *(a1 + 32);
  dispatch_sync(v5, block);

  objc_destroyWeak(&v8);
}

void __96__NPKPaymentWebServiceCompanionTargetDevice_declineRelatedSharingInvitationsIfNecessaryRequest___block_invoke_2(uint64_t a1)
{
  v14 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = objc_alloc_init(NPKProtoDeclineRelatedInvitationsIfNecessaryResponse);
  [(NPKProtoDeclineRelatedInvitationsIfNecessaryResponse *)v3 setDidDeclineInvitations:*(a1 + 48)];
  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoDeclineRelatedInvitationsIfNecessaryResponse *)v3 data];
  v6 = [v4 initWithProtobufData:v5 type:82 isResponse:1];

  v7 = [WeakRetained _sendProtobuf:v6 responseIdentifier:*(a1 + 32)];
  if (!v7)
  {
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_ERROR);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v12 = 138412290;
        v13 = v6;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", &v12, 0xCu);
      }
    }
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)declineRelatedSharingInvitationsIfNecessaryResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target declineRelatedSharingInvitationsIfNecessaryResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __97__NPKPaymentWebServiceCompanionTargetDevice_declineRelatedSharingInvitationsIfNecessaryResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __97__NPKPaymentWebServiceCompanionTargetDevice_declineRelatedSharingInvitationsIfNecessaryResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoDeclineRelatedInvitationsIfNecessaryResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoDeclineRelatedInvitationsIfNecessaryResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoDeclineRelatedInvitationsIfNecessaryResponse *)v6 didDeclineInvitations];
  }

  else
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service presentStandaloneTransaction:(int64_t)transaction forPassUniqueIdentifier:(id)identifier terminalReaderIdentifier:(id)readerIdentifier completion:(id)completion
{
  v111 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  identifierCopy = identifier;
  readerIdentifierCopy = readerIdentifier;
  completionCopy = completion;
  date = [MEMORY[0x277CBEAA8] date];
  v16 = pk_Payment_log();
  v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

  if (v17)
  {
    v18 = pk_Payment_log();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      v19 = _Block_copy(completionCopy);
      *buf = 138413314;
      *&buf[4] = date;
      *&buf[12] = 2048;
      *&buf[14] = transaction;
      *&buf[22] = 2112;
      v109 = identifierCopy;
      *v110 = 2112;
      *&v110[2] = readerIdentifierCopy;
      *&v110[10] = 2112;
      *&v110[12] = v19;
      _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Notice: Target device (%@) - present standalone transaction %lu for pass unique ID %@ reader ID %@ with completion %@", buf, 0x34u);
    }
  }

  if ((NPKPairedOrPairingDeviceSupportsUWB() & 1) == 0)
  {
    v23 = pk_Payment_log();
    v24 = os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT);

    if (v24)
    {
      v25 = pk_Payment_log();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v25, OS_LOG_TYPE_DEFAULT, "Notice: Paired device doesn't support UWB; we won't forward standalone transaction events.", buf, 2u);
      }
    }

    if (completionCopy)
    {
      goto LABEL_18;
    }

    goto LABEL_19;
  }

  if (!NPKPairedOrPairingDeviceIsTinker())
  {
    if (![(NPKPaymentWebServiceCompanionTargetDevice *)self _isUWBSubcredentialProvisioningSupported])
    {
      v46 = pk_Payment_log();
      v47 = os_log_type_enabled(v46, OS_LOG_TYPE_DEFAULT);

      if (v47)
      {
        v48 = pk_Payment_log();
        if (os_log_type_enabled(v48, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412546;
          *&buf[4] = date;
          *&buf[12] = 2112;
          *&buf[14] = identifierCopy;
          _os_log_impl(&dword_25B300000, v48, OS_LOG_TYPE_DEFAULT, "Notice: Target device (%@) - will not present standalone transaction for pass %@; watch is not on supported software.", buf, 0x16u);
        }
      }

      if (completionCopy)
      {
        goto LABEL_18;
      }

      goto LABEL_19;
    }

    if (![(NPKPaymentWebServiceCompanionTargetDevice *)self _deviceIsConnected])
    {
      v49 = pk_Payment_log();
      v50 = os_log_type_enabled(v49, OS_LOG_TYPE_DEFAULT);

      if (v50)
      {
        v51 = pk_Payment_log();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412546;
          *&buf[4] = date;
          *&buf[12] = 2112;
          *&buf[14] = identifierCopy;
          _os_log_impl(&dword_25B300000, v51, OS_LOG_TYPE_DEFAULT, "Notice: Target device (%@) - will not present standalone transaction for pass %@; watch is not immediately reachable.", buf, 0x16u);
        }
      }

      if (completionCopy)
      {
        goto LABEL_18;
      }

      goto LABEL_19;
    }

    v102[0] = 0;
    v102[1] = v102;
    v102[2] = 0x2020000000;
    v103 = 0;
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke;
    aBlock[3] = &unk_27994A4E0;
    v99 = v102;
    v27 = date;
    v100 = 0x3FF0000000000000;
    v94 = v27;
    selfCopy = self;
    v96 = serviceCopy;
    transactionCopy = transaction;
    v97 = readerIdentifierCopy;
    v98 = completionCopy;
    v28 = _Block_copy(aBlock);
    v29 = dispatch_time(0, 1000000000);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_3;
    block[3] = &unk_27994A508;
    v30 = v27;
    v89 = v30;
    groupa = identifierCopy;
    v90 = groupa;
    v92 = v102;
    v31 = v28;
    v91 = v31;
    dispatch_after(v29, MEMORY[0x277D85CD0], block);
    v32 = dispatch_group_create();
    v86[0] = 0;
    v86[1] = v86;
    v86[2] = 0x2020000000;
    v87 = 0;
    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v109 = __Block_byref_object_copy__22;
    *v110 = __Block_byref_object_dispose__22;
    *&v110[8] = 0;
    dispatch_group_enter(v32);
    passcodeConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self passcodeConnection];
    v80[0] = MEMORY[0x277D85DD0];
    v80[1] = 3221225472;
    v80[2] = __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_759;
    v80[3] = &unk_27994A530;
    v34 = v30;
    v81 = v34;
    v84 = v86;
    v35 = v31;
    v83 = v35;
    v85 = buf;
    v36 = v32;
    v82 = v36;
    [passcodeConnection getRemoteDeviceState:v80];

    dispatch_group_enter(v36);
    companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
    v73[0] = MEMORY[0x277D85DD0];
    v73[1] = 3221225472;
    v73[2] = __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_761;
    v73[3] = &unk_27994A558;
    v56 = v34;
    v74 = v56;
    v38 = groupa;
    v75 = v38;
    v78 = buf;
    v79 = v86;
    v39 = v35;
    v77 = v39;
    group = v36;
    v76 = group;
    [companionAgentConnection paymentPassWithUniqueID:v38 synchronous:0 reply:v73];

    v55 = objc_alloc_init(MEMORY[0x277D37FC0]);
    v54 = [v55 passWithUniqueID:v38];
    secureElementPass = [v54 secureElementPass];
    pairedTerminalIdentifier = [secureElementPass pairedTerminalIdentifier];

    if (pairedTerminalIdentifier)
    {
      dispatch_group_enter(group);
      companionAgentConnection2 = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
      v66[0] = MEMORY[0x277D85DD0];
      v66[1] = 3221225472;
      v66[2] = __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_762;
      v66[3] = &unk_27994A5A0;
      v67 = v56;
      v68 = pairedTerminalIdentifier;
      v71 = buf;
      v72 = v86;
      v70 = v39;
      v69 = group;
      [companionAgentConnection2 passesWithReaderIdentifier:v68 completion:v66];

      v43 = v67;
    }

    else
    {
      v52 = pk_Payment_log();
      v53 = os_log_type_enabled(v52, OS_LOG_TYPE_DEFAULT);

      if (!v53)
      {
        goto LABEL_25;
      }

      v43 = pk_Payment_log();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_DEFAULT))
      {
        *v104 = 138412546;
        v105 = v56;
        v106 = 2112;
        v107 = 0;
        _os_log_impl(&dword_25B300000, v43, OS_LOG_TYPE_DEFAULT, "Notice: Target device (%@) - present standalone transaction not considering reader identifier matches as no readerID was found on companion pass. %@", v104, 0x16u);
      }
    }

LABEL_25:
    responseQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self responseQueue];
    v60[0] = MEMORY[0x277D85DD0];
    v60[1] = 3221225472;
    v60[2] = __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_767;
    v60[3] = &unk_27994A5C8;
    v64 = buf;
    v65 = v86;
    v61 = v56;
    v62 = v38;
    v63 = v39;
    v45 = v39;
    dispatch_group_notify(group, responseQueue, v60);

    _Block_object_dispose(buf, 8);
    _Block_object_dispose(v86, 8);

    _Block_object_dispose(v102, 8);
    goto LABEL_19;
  }

  v20 = pk_Payment_log();
  v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

  if (v21)
  {
    v22 = pk_Payment_log();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_DEFAULT, "Notice: Paired device is tinker; we won't forward to tinker devices.", buf, 2u);
    }
  }

  if (completionCopy)
  {
LABEL_18:
    (*(completionCopy + 2))(completionCopy, 0);
  }

LABEL_19:

  v26 = *MEMORY[0x277D85DE8];
}

void __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke(uint64_t a1, int a2, void *a3)
{
  v5 = a3;
  v6 = *(*(a1 + 72) + 8);
  if ((*(v6 + 24) & 1) == 0)
  {
    *(v6 + 24) = 1;
    if (a2)
    {
      v7 = [*(a1 + 32) dateByAddingTimeInterval:*(a1 + 80)];
      v8 = *(a1 + 40);
      v9 = *(a1 + 48);
      v10 = *(a1 + 88);
      v13[0] = MEMORY[0x277D85DD0];
      v13[1] = 3221225472;
      v13[2] = __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_2;
      v13[3] = &unk_2799467D0;
      v11 = *(a1 + 56);
      v14 = *(a1 + 64);
      [v8 _paymentWebService:v9 presentStandaloneTransaction:v10 forPassUniqueIdentifier:v5 terminalReaderIdentifier:v11 validUntilDate:v7 completion:v13];
    }

    else
    {
      v12 = *(a1 + 64);
      if (v12)
      {
        (*(v12 + 16))(v12, 0);
      }
    }
  }
}

uint64_t __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

uint64_t __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_3(void *a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = pk_Payment_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_Payment_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = a1[4];
      v6 = a1[5];
      if (*(*(a1[7] + 8) + 24))
      {
        v7 = @"NO";
      }

      else
      {
        v7 = @"YES";
      }

      v10 = 138412802;
      v11 = v5;
      v12 = 2112;
      v13 = v6;
      v14 = 2112;
      v15 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device (%@) - firing standalone transaction timer for pass unique id: %@. Is result pending? %@", &v10, 0x20u);
    }
  }

  result = (*(a1[6] + 16))();
  v9 = *MEMORY[0x277D85DE8];
  return result;
}

void __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_759(uint64_t a1, int a2, int a3, int a4, void *a5)
{
  v26 = *MEMORY[0x277D85DE8];
  v9 = a5;
  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = *(a1 + 32);
      v16 = 138413314;
      v17 = v13;
      v18 = 1024;
      v19 = a2;
      v20 = 1024;
      v21 = a3;
      v22 = 1024;
      v23 = a4;
      v24 = 2112;
      v25 = v9;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device (%@) - present standalone transaction got remote device state hasPasscodeSet:%d\nisPasscodeLocked:%d\nisUnlockOnly:%d\nerror:%@", &v16, 0x28u);
    }
  }

  *(*(*(a1 + 56) + 8) + 24) = a2 & ~a3;
  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0)
  {
    v14 = *(*(a1 + 48) + 16);
    goto LABEL_9;
  }

  if (*(*(*(a1 + 64) + 8) + 40))
  {
    v14 = *(*(a1 + 48) + 16);
LABEL_9:
    v14();
  }

  dispatch_group_leave(*(a1 + 40));

  v15 = *MEMORY[0x277D85DE8];
}

void __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_761(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (v3)
  {
    v5 = [v3 devicePrimaryPaymentApplication];
    [v5 state];
    IsPersonalized = PKPaymentApplicationStateIsPersonalized();

    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (v8)
    {
      v9 = pk_Payment_log();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        v10 = *(a1 + 32);
        v11 = *(a1 + 40);
        v12 = @"YES";
        if (!IsPersonalized)
        {
          v12 = @"NO";
        }

        v18 = 138412802;
        v19 = v10;
        v20 = 2112;
        v21 = v11;
        v22 = 2112;
        v23 = v12;
        _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Target device (%@) - present standalone transaction got pass unique ID matching %@. Is personalized? %@", &v18, 0x20u);
      }
    }

    if (IsPersonalized)
    {
      v13 = [v4 uniqueID];
      v14 = *(*(a1 + 64) + 8);
      v15 = *(v14 + 40);
      *(v14 + 40) = v13;

      if (*(*(*(a1 + 72) + 8) + 24) == 1)
      {
        v16 = *(*(*(a1 + 64) + 8) + 40);
        (*(*(a1 + 56) + 16))();
      }
    }
  }

  dispatch_group_leave(*(a1 + 48));

  v17 = *MEMORY[0x277D85DE8];
}

void __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_762(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = [a2 pk_anyObjectPassingTest:&__block_literal_global_766];
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v7 = *(a1 + 32);
      v8 = *(a1 + 40);
      v9 = @"YES";
      if (!v3)
      {
        v9 = @"NO";
      }

      v15 = 138412802;
      v16 = v7;
      v17 = 2112;
      v18 = v8;
      v19 = 2112;
      v20 = v9;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Target device (%@) - present standalone transaction found personalized pass matching reader ID matching %@? %@", &v15, 0x20u);
    }
  }

  if (v3)
  {
    v10 = [v3 uniqueID];
    v11 = *(*(a1 + 64) + 8);
    v12 = *(v11 + 40);
    *(v11 + 40) = v10;

    if (*(*(*(a1 + 72) + 8) + 24) == 1)
    {
      v13 = *(*(*(a1 + 64) + 8) + 40);
      (*(*(a1 + 56) + 16))();
    }
  }

  dispatch_group_leave(*(a1 + 48));

  v14 = *MEMORY[0x277D85DE8];
}

BOOL __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_2_763(uint64_t a1, void *a2)
{
  v2 = [a2 devicePrimaryPaymentApplication];
  [v2 state];
  v3 = PKPaymentApplicationStateIsPersonalized() != 0;

  return v3;
}

uint64_t __152__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_completion___block_invoke_767(void *a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = *(*(a1[7] + 8) + 40);
  if (v2)
  {
    v3 = *(*(a1[8] + 8) + 24);
  }

  else
  {
    v3 = 0;
  }

  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v7 = a1[4];
      v8 = a1[5];
      v9 = @"NO";
      if (v3)
      {
        v10 = @"YES";
      }

      else
      {
        v10 = @"NO";
      }

      if (*(*(a1[8] + 8) + 24))
      {
        v11 = @"YES";
      }

      else
      {
        v11 = @"NO";
      }

      if (v2)
      {
        v9 = @"YES";
      }

      v15 = 138413314;
      v16 = v7;
      v17 = 2112;
      v18 = v8;
      v19 = 2112;
      v20 = v10;
      v21 = 2112;
      v22 = v11;
      v23 = 2112;
      v24 = v9;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Target device (%@) - present standalone transaction request for pass %@ yielded result: %@. isRemoteDeviceUnlocked: %@; watchHasMatchingPass: %@", &v15, 0x34u);
    }
  }

  v12 = *(*(a1[7] + 8) + 40);
  result = (*(a1[6] + 16))();
  v14 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_paymentWebService:(id)service presentStandaloneTransaction:(int64_t)transaction forPassUniqueIdentifier:(id)identifier terminalReaderIdentifier:(id)readerIdentifier validUntilDate:(id)date completion:(id)completion
{
  v42 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  readerIdentifierCopy = readerIdentifier;
  dateCopy = date;
  completionCopy = completion;
  if (![(NPKPaymentWebServiceCompanionTargetDevice *)self _isUWBSubcredentialProvisioningSupported])
  {
    v17 = pk_General_log();
    v18 = os_log_type_enabled(v17, OS_LOG_TYPE_ERROR);

    if (v18)
    {
      v19 = pk_General_log();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        *buf = 136446722;
        transactionCopy = "[NPKPaymentWebServiceCompanionTargetDevice _paymentWebService:presentStandaloneTransaction:forPassUniqueIdentifier:terminalReaderIdentifier:validUntilDate:completion:]";
        v38 = 2082;
        v39 = "/Library/Caches/com.apple.xbs/Sources/NanoPassbook_Frameworks/NanoPassKit/NPKPaymentWebServiceCompanionTargetDevice.m";
        v40 = 2048;
        v41 = 7115;
        _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_ERROR, "Error: *** NPKAssertion failure in %{public}s, %{public}s:%ld (reason: We should only invoke this method after verifying the watch is on supported software.)", buf, 0x20u);
      }
    }

    _NPKAssertAbort();
  }

  v20 = pk_Payment_log();
  v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

  if (v21)
  {
    v22 = pk_Payment_log();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 134218242;
      transactionCopy = transaction;
      v38 = 2112;
      v39 = identifierCopy;
      _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_DEFAULT, "Notice: Target device - sending presentStandaloneTransaction request for transactionType: %ld passUniqueIdentifier: %@", buf, 0x16u);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v29[0] = MEMORY[0x277D85DD0];
  v29[1] = 3221225472;
  v29[2] = __168__NPKPaymentWebServiceCompanionTargetDevice__paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_validUntilDate_completion___block_invoke;
  v29[3] = &unk_27994A5F0;
  v30 = identifierCopy;
  v31 = dateCopy;
  v32 = readerIdentifierCopy;
  selfCopy = self;
  v34 = completionCopy;
  transactionCopy2 = transaction;
  v24 = completionCopy;
  v25 = readerIdentifierCopy;
  v26 = dateCopy;
  v27 = identifierCopy;
  dispatch_sync(internalQueue, v29);

  v28 = *MEMORY[0x277D85DE8];
}

void __168__NPKPaymentWebServiceCompanionTargetDevice__paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_validUntilDate_completion___block_invoke(uint64_t a1)
{
  v30[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoPresentStandaloneTransactionRequest);
  [(NPKProtoPresentStandaloneTransactionRequest *)v2 setTransactionType:*(a1 + 72)];
  [(NPKProtoPresentStandaloneTransactionRequest *)v2 setWatchPassUniqueID:*(a1 + 32)];
  [*(a1 + 40) timeIntervalSince1970];
  [(NPKProtoPresentStandaloneTransactionRequest *)v2 setValidUntilEpochTimeInterval:?];
  [(NPKProtoPresentStandaloneTransactionRequest *)v2 setTerminalReaderIdentifier:*(a1 + 48)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoPresentStandaloneTransactionRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:103 isResponse:0];

  v6 = *(a1 + 56);
  v29 = *MEMORY[0x277D18650];
  v30[0] = &unk_286CE7818;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:&v29 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7 priority:300];

  if (v8)
  {
    v9 = *(a1 + 64);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __168__NPKPaymentWebServiceCompanionTargetDevice__paymentWebService_presentStandaloneTransaction_forPassUniqueIdentifier_terminalReaderIdentifier_validUntilDate_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v24 = *(a1 + 64);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 56);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v26 = v8;
      v16 = "Warning: No response expected for message with identifier %@";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      v19 = 12;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412546;
      v26 = v5;
      v27 = 1024;
      v28 = [v5 type];
      v16 = "Error: No message identifier for protobuf %@ with type %hu";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
      v19 = 18;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, v19);
      goto LABEL_11;
    }
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

- (void)presentStandaloneTransactionForPassUniqueIdentifierResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target presentStandaloneTransactionForPassUniqueIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __105__NPKPaymentWebServiceCompanionTargetDevice_presentStandaloneTransactionForPassUniqueIdentifierResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __105__NPKPaymentWebServiceCompanionTargetDevice_presentStandaloneTransactionForPassUniqueIdentifierResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoPresentStandaloneTransactionResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoPresentStandaloneTransactionResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoPresentStandaloneTransactionResponse *)v6 success];
  }

  else
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)paymentWebServiceOwnershipTokenResponse:(id)response
{
  v38 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Payment web service OwnershipToken token request: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v34 = 0x3032000000;
  v35 = __Block_byref_object_copy__384;
  v36 = __Block_byref_object_dispose__385;
  v37 = 0;
  v29[0] = 0;
  v29[1] = v29;
  v29[2] = 0x3032000000;
  v29[3] = __Block_byref_object_copy__22;
  v29[4] = __Block_byref_object_dispose__22;
  v30 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __85__NPKPaymentWebServiceCompanionTargetDevice_paymentWebServiceOwnershipTokenResponse___block_invoke;
    v17[3] = &unk_27994A618;
    v17[4] = self;
    v18 = incomingResponseIdentifier;
    p_buf = &buf;
    v19 = responseCopy;
    v21 = v29;
    v22 = &v23;
    dispatch_sync(internalQueue, v17);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v31 = 136315138;
        v32 = "[NPKPaymentWebServiceCompanionTargetDevice paymentWebServiceOwnershipTokenResponse:]";
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response, %s", v31, 0xCu);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(v29, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __85__NPKPaymentWebServiceCompanionTargetDevice_paymentWebServiceOwnershipTokenResponse___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  v4 = [v3 completionHandler];
  v5 = *(*(a1 + 56) + 8);
  v6 = *(v5 + 40);
  *(v5 + 40) = v4;

  if (v3)
  {
    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [NPKProtoOwnershipTokenResponse alloc];
    v9 = [*(a1 + 48) data];
    v10 = [(NPKProtoOwnershipTokenResponse *)v8 initWithData:v9];

    v11 = [v10 identifier];
    v12 = *(*(a1 + 64) + 8);
    v13 = *(v12 + 40);
    *(v12 + 40) = v11;

    v14 = [v10 token];
    v15 = *(*(a1 + 72) + 8);
    v16 = *(v15 + 40);
    *(v15 + 40) = v14;

    v17 = pk_Payment_log();
    v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

    if (v18)
    {
      v19 = pk_Payment_log();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        v20 = *(a1 + 72);
        v21 = *(*(*(a1 + 64) + 8) + 40);
        v22 = [*(*(v20 + 8) + 40) length];
        v26 = 138412546;
        v27 = v21;
        v28 = 1024;
        v29 = v22 != 0;
        _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: Finish Payment web service OwnershipToken token request with identifier:%@ hasToken:%d", &v26, 0x12u);
      }
    }

LABEL_9:

    goto LABEL_10;
  }

  v23 = pk_Payment_log();
  v24 = os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT);

  if (v24)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v26 = 136315138;
      v27 = "[NPKPaymentWebServiceCompanionTargetDevice paymentWebServiceOwnershipTokenResponse:]_block_invoke";
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler, %s", &v26, 0xCu);
    }

    goto LABEL_9;
  }

LABEL_10:

  v25 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebService:(id)service passOwnershipTokenWithIdentifier:(id)identifier completion:(id)completion
{
  identifierCopy = identifier;
  completionCopy = completion;
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passOwnershipTokenWithIdentifier_completion___block_invoke;
  aBlock[3] = &unk_27994A640;
  v9 = completionCopy;
  v25 = v9;
  v10 = _Block_copy(aBlock);
  v11 = NPKPairedOrPairingDevice();
  v12 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"45D167B6-F5A6-469D-A81B-3146DE124929"];
  v13 = [v11 supportsCapability:v12];

  if (v13)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passOwnershipTokenWithIdentifier_completion___block_invoke_776;
    block[3] = &unk_27994A668;
    v20 = identifierCopy;
    selfCopy = self;
    v22 = v9;
    v23 = v10;
    dispatch_async(internalQueue, block);
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        *v18 = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Paired device doesn't support Super easy provisioning", v18, 2u);
      }
    }

    (*(v10 + 2))(v10, 0);
  }
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passOwnershipTokenWithIdentifier_completion___block_invoke(uint64_t a1, void *a2)
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v9[0] = 67109120;
      v9[1] = v3 != 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Found ownership token:%d", v9, 8u);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passOwnershipTokenWithIdentifier_completion___block_invoke_776(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoOwnershipTokenRequest);
  [(NPKProtoOwnershipTokenRequest *)v2 setIdentifier:*(a1 + 32)];
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoOwnershipTokenRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:119 isResponse:0];

  v6 = [*(a1 + 40) _sendProtobuf:v5 responseExpected:1 extraOptions:0];
  if (v6)
  {
    if (*(a1 + 48))
    {
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passOwnershipTokenWithIdentifier_completion___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v20 = *(a1 + 56);
      v7 = _Block_copy(aBlock);
      v8 = *(a1 + 40);
      v9 = _Block_copy(*(a1 + 56));
      [v8 _trackOutstandingRequestWithMessageIdentifier:v6 completionHandler:v9 errorHandler:v7];

      v10 = v20;
LABEL_11:

      goto LABEL_12;
    }

    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

    if (v17)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 136315394;
      v22 = "[NPKPaymentWebServiceCompanionTargetDevice paymentWebService:passOwnershipTokenWithIdentifier:completion:]_block_invoke";
      v23 = 2112;
      v24 = v6;
      v13 = "Warning: %s No response expected for message with identifier %@";
      v14 = v10;
      v15 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_ERROR);

    if (v12)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 136315394;
      v22 = "[NPKPaymentWebServiceCompanionTargetDevice paymentWebService:passOwnershipTokenWithIdentifier:completion:]_block_invoke";
      v23 = 2112;
      v24 = v5;
      v13 = "Error: %s No message identifier for protobuf %@";
      v14 = v10;
      v15 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v14, v15, v13, buf, 0x16u);
      goto LABEL_11;
    }
  }

LABEL_12:

  v18 = *MEMORY[0x277D85DE8];
}

- (void)requestAutomaticProvisioningForCompanionPaymentPass:(id)pass
{
  v16 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v15 = passCopy;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Requesting automatic provisioning for companion payment pass with unique ID: %@", buf, 0xCu);
    }
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __97__NPKPaymentWebServiceCompanionTargetDevice_requestAutomaticProvisioningForCompanionPaymentPass___block_invoke;
  v11[3] = &unk_2799454E0;
  v12 = passCopy;
  selfCopy = self;
  v9 = passCopy;
  dispatch_sync(internalQueue, v11);

  v10 = *MEMORY[0x277D85DE8];
}

void __97__NPKPaymentWebServiceCompanionTargetDevice_requestAutomaticProvisioningForCompanionPaymentPass___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoAutomaticProvisioningRequest);
  v3 = [*(a1 + 32) passTypeIdentifier];
  [(NPKProtoAutomaticProvisioningRequest *)v2 setPassTypeIdentifier:v3];

  v4 = [*(a1 + 32) serialNumber];
  [(NPKProtoAutomaticProvisioningRequest *)v2 setSerialNumber:v4];

  v5 = [*(a1 + 32) devicePrimaryPaymentApplication];
  -[NPKProtoAutomaticProvisioningRequest setCredentialType:](v2, "setCredentialType:", [v5 paymentNetworkIdentifier]);

  v6 = [*(a1 + 32) primaryAccountNumberSuffix];
  [(NPKProtoAutomaticProvisioningRequest *)v2 setPrimaryAccountNumberSuffix:v6];

  v7 = [*(a1 + 32) localizedName];
  [(NPKProtoAutomaticProvisioningRequest *)v2 setLocalizedName:v7];

  v8 = [*(a1 + 32) cardType] - 1;
  if (v8 < 3)
  {
    v9 = (v8 + 1);
  }

  else
  {
    v9 = 0;
  }

  [(NPKProtoAutomaticProvisioningRequest *)v2 setCardType:v9];
  v10 = objc_alloc(MEMORY[0x277D189F0]);
  v11 = [(NPKProtoAutomaticProvisioningRequest *)v2 data];
  v12 = [v10 initWithProtobufData:v11 type:83 isResponse:0];

  v13 = [*(a1 + 40) _sendProtobuf:v12 responseExpected:0];
  if (!v13)
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v16 = pk_Payment_log();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v18 = 138412290;
        v19 = v12;
        _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", &v18, 0xCu);
      }
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)familyMembersWithCompletion:(id)completion
{
  v22 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  IsTinker = NPKPairedOrPairingDeviceIsTinker();
  v5 = IsTinker;
  if (IsTinker)
  {
    v6 = NPKPairedOrPairingDevice();
    v8 = NPKPairingDeviceAccountAltDSID(v6, v7);

    v9 = pk_Payment_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

    if (v10)
    {
      v11 = pk_Payment_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v21 = v8;
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target familyMembersResponse: child altDSID:%@", buf, 0xCu);
      }
    }
  }

  else
  {
    v8 = 0;
  }

  v12 = objc_alloc_init(MEMORY[0x277D380F0]);
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __73__NPKPaymentWebServiceCompanionTargetDevice_familyMembersWithCompletion___block_invoke;
  v16[3] = &unk_27994A690;
  v19 = v5;
  v17 = v8;
  v18 = completionCopy;
  v13 = completionCopy;
  v14 = v8;
  [v12 familyMembersWithCompletion:v16];

  v15 = *MEMORY[0x277D85DE8];
}

void __73__NPKPaymentWebServiceCompanionTargetDevice_familyMembersWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (*(a1 + 48) == 1)
  {
    v17 = 0u;
    v18 = 0u;
    v15 = 0u;
    v16 = 0u;
    v5 = [v3 countByEnumeratingWithState:&v15 objects:v21 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v16;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v16 != v7)
          {
            objc_enumerationMutation(v4);
          }

          v9 = *(*(&v15 + 1) + 8 * i);
          v10 = [v9 altDSID];
          [v9 setMe:{objc_msgSend(v10, "isEqualToString:", *(a1 + 32))}];
        }

        v6 = [v4 countByEnumeratingWithState:&v15 objects:v21 count:16];
      }

      while (v6);
    }

    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v20 = v4;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target familyMembersResponse: family members after:%@", buf, 0xCu);
      }
    }
  }

  (*(*(a1 + 40) + 16))();

  v14 = *MEMORY[0x277D85DE8];
}

- (void)paymentWebServiceRegisterResponse:(id)response
{
  v40 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Payment web service registration request: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v36 = 0x3032000000;
  v37 = __Block_byref_object_copy__384;
  v38 = __Block_byref_object_dispose__385;
  v39 = 0;
  v29 = 0;
  v30 = &v29;
  v31 = 0x2020000000;
  v32 = 1;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __79__NPKPaymentWebServiceCompanionTargetDevice_paymentWebServiceRegisterResponse___block_invoke;
    v17[3] = &unk_279949C48;
    v17[4] = self;
    v18 = incomingResponseIdentifier;
    v19 = responseCopy;
    p_buf = &buf;
    v21 = &v29;
    v22 = &v23;
    dispatch_sync(internalQueue, v17);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v33 = 136315138;
        v34 = "[NPKPaymentWebServiceCompanionTargetDevice paymentWebServiceRegisterResponse:]";
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response, %s", v33, 0xCu);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v30[3], v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&v29, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __79__NPKPaymentWebServiceCompanionTargetDevice_paymentWebServiceRegisterResponse___block_invoke(uint64_t a1)
{
  v44 = *MEMORY[0x277D85DE8];
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoPaymentWebServiceRegistrationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoPaymentWebServiceRegistrationResponse *)v5 initWithData:v6];

    if ([v7 pending])
    {
      v8 = pk_Payment_log();
      v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

      if (v9)
      {
        v10 = pk_Payment_log();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          LOWORD(v40) = 0;
          _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Payment web service registration request still pending", &v40, 2u);
        }
      }

      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v13 = [*(a1 + 32) outstandingRequests];
      [v13 removeObjectForKey:*(a1 + 40)];

      v14 = [v4 completionHandler];
      v15 = *(*(a1 + 56) + 8);
      v16 = *(v15 + 40);
      *(v15 + 40) = v14;

      *(*(*(a1 + 64) + 8) + 24) = [v7 registrationResult];
      v17 = [v7 hasErrorData];
      if (v17)
      {
        v1 = [v7 errorData];
        v18 = objc_opt_class();
        v19 = NPKSecureUnarchiveObject(v1, v18);
      }

      else
      {
        v19 = 0;
      }

      objc_storeStrong((*(*(a1 + 72) + 8) + 40), v19);
      if (v17)
      {
      }

      v20 = pk_Payment_log();
      v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

      if (v21)
      {
        v22 = pk_Payment_log();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
        {
          v23 = *(*(*(a1 + 64) + 8) + 24);
          v24 = *(*(*(a1 + 72) + 8) + 40);
          v40 = 134218242;
          v41 = v23;
          v42 = 2112;
          v43 = v24;
          _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_DEFAULT, "Notice: Finish Payment web service registration request result:%lu error:%@", &v40, 0x16u);
        }
      }

      v25 = [v7 webServiceContextData];
      v26 = objc_opt_class();
      v27 = NPKSecureUnarchiveObject(v25, v26);

      v28 = pk_Payment_log();
      v29 = os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT);

      if (v29)
      {
        v30 = pk_Payment_log();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
        {
          v40 = 138412290;
          v41 = v27;
          _os_log_impl(&dword_25B300000, v30, OS_LOG_TYPE_DEFAULT, "Notice: Got updated web service context from watch: %@", &v40, 0xCu);
        }
      }

      if (v27)
      {
        v31 = pk_Payment_log();
        v32 = os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT);

        if (v32)
        {
          v33 = pk_Payment_log();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            v34 = [v27 primaryRegion];
            v35 = [v34 applyServiceURL];
            v36 = [v27 primaryRegion];
            v37 = @"YES";
            if (!v36)
            {
              v37 = @"NO";
            }

            v40 = 138412546;
            v41 = v35;
            v42 = 2112;
            v43 = v37;
            _os_log_impl(&dword_25B300000, v33, OS_LOG_TYPE_DEFAULT, "Notice: (account-pass-context) received updated web service context applyServiceURL %@ primaryRegion %@", &v40, 0x16u);
          }
        }

        v38 = [*(a1 + 32) delegate];
        [v38 handlePaymentWebServiceContextFromWatch:v27];
      }
    }

LABEL_33:

    goto LABEL_34;
  }

  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v40 = 136315138;
      v41 = "[NPKPaymentWebServiceCompanionTargetDevice paymentWebServiceRegisterResponse:]_block_invoke";
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler, %s", &v40, 0xCu);
    }

    goto LABEL_33;
  }

LABEL_34:

  v39 = *MEMORY[0x277D85DE8];
}

- (void)performDeviceRegistrationForReason:(id)reason brokerURL:(id)l completion:(id)completion
{
  v52 = *MEMORY[0x277D85DE8];
  reasonCopy = reason;
  lCopy = l;
  completionCopy = completion;
  uUID = [MEMORY[0x277CCAD78] UUID];
  v12 = pk_General_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

  if (v13)
  {
    v14 = pk_General_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412802;
      v47 = reasonCopy;
      v48 = 2112;
      v49 = lCopy;
      v50 = 2112;
      v51 = uUID;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: target Device: requested register device with reason:%@ brokerURL:%@ UUID:%@", buf, 0x20u);
    }
  }

  v15 = NPKPairedOrPairingDevice();
  v16 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"79770938-0C49-40BD-B593-4E04E7557E01"];
  v17 = [v15 supportsCapability:v16];

  if (v17)
  {
    v18 = pk_General_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

    if (v19)
    {
      v20 = pk_General_log();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Notice: target Device: Will forward registration request to gizmo", buf, 2u);
      }
    }

    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v34[0] = MEMORY[0x277D85DD0];
    v34[1] = 3221225472;
    v34[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_performDeviceRegistrationForReason_brokerURL_completion___block_invoke_786;
    v34[3] = &unk_2799467F8;
    v35 = lCopy;
    v36 = reasonCopy;
    selfCopy = self;
    v38 = uUID;
    v39 = completionCopy;
    dispatch_sync(internalQueue, v34);

    webService = v35;
  }

  else
  {
    v23 = +[NPKSharedWebServiceProvider sharedWebServiceProvider];
    webService = [v23 webService];

    v24 = pk_General_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

    if (v25)
    {
      v26 = pk_General_log();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v47 = webService;
        _os_log_impl(&dword_25B300000, v26, OS_LOG_TYPE_DEFAULT, "Notice: target Device: Active device can't forward registration we will do it locally with webService:%@", buf, 0xCu);
      }
    }

    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_performDeviceRegistrationForReason_brokerURL_completion___block_invoke;
    aBlock[3] = &unk_27994A6B8;
    v45 = completionCopy;
    v27 = _Block_copy(aBlock);
    v28 = v27;
    if (webService)
    {
      if (lCopy)
      {
        v40[0] = MEMORY[0x277D85DD0];
        v40[1] = 3221225472;
        v40[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_performDeviceRegistrationForReason_brokerURL_completion___block_invoke_2;
        v40[3] = &unk_27994A6B8;
        v41 = v27;
        [webService registerDeviceAtBrokerURL:lCopy consistencyCheckResults:0 completion:v40];
        v29 = v41;
      }

      else
      {
        v42[0] = MEMORY[0x277D85DD0];
        v42[1] = 3221225472;
        v42[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_performDeviceRegistrationForReason_brokerURL_completion___block_invoke_785;
        v42[3] = &unk_27994A6B8;
        v43 = v27;
        [webService registerDeviceWithCompletion:v42];
        v29 = v43;
      }
    }

    else
    {
      v30 = pk_General_log();
      v31 = os_log_type_enabled(v30, OS_LOG_TYPE_ERROR);

      if (v31)
      {
        v32 = pk_General_log();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412290;
          v47 = 0;
          _os_log_impl(&dword_25B300000, v32, OS_LOG_TYPE_ERROR, "Error: target Device: Unexpected. No deviceWebService (%@) found with which to register the device", buf, 0xCu);
        }
      }

      v29 = PKDisplayableErrorForCommonType();
      (v28)[2](v28, 0, 0x7FFFFFFFFFFFFFFFLL, v29);
    }
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __101__NPKPaymentWebServiceCompanionTargetDevice_performDeviceRegistrationForReason_brokerURL_completion___block_invoke(uint64_t a1, unint64_t a2, void *a3, void *a4)
{
  v25 = *MEMORY[0x277D85DE8];
  v7 = a4;
  v8 = pk_General_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG);

  if (v9)
  {
    v10 = pk_General_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v19 = 134218498;
      v20 = a2;
      v21 = 2048;
      v22 = a3;
      v23 = 2112;
      v24 = v7;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEBUG, "Debug: target Device: register device completion. Result: %lu, cardsOnFile: %lu, error: %@", &v19, 0x20u);
    }
  }

  if (*(a1 + 32))
  {
    if (a2 > 3)
    {
      v11 = 0;
    }

    else
    {
      v11 = qword_25B59AB10[a2];
    }

    v15 = pk_General_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG);

    if (v16)
    {
      v17 = pk_General_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
      {
        v19 = 134218242;
        v20 = v11;
        v21 = 2112;
        v22 = v7;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEBUG, "Debug: target Device: Calling completion with registration result: %lu, error: %@", &v19, 0x16u);
      }
    }

    (*(*(a1 + 32) + 16))();
  }

  else
  {
    v12 = pk_General_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_General_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        LOWORD(v19) = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Warning: target Device: Unexpected. No completion block", &v19, 2u);
      }
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __101__NPKPaymentWebServiceCompanionTargetDevice_performDeviceRegistrationForReason_brokerURL_completion___block_invoke_786(uint64_t a1)
{
  v32[2] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoPaymentWebServiceRegistrationRequest);
  v3 = [*(a1 + 32) absoluteString];
  [(NPKProtoPaymentWebServiceRegistrationRequest *)v2 setBrokerURLString:v3];

  [(NPKProtoPaymentWebServiceRegistrationRequest *)v2 setReason:*(a1 + 40)];
  v4 = objc_alloc(MEMORY[0x277D189F0]);
  v5 = [(NPKProtoPaymentWebServiceRegistrationRequest *)v2 data];
  v6 = [v4 initWithProtobufData:v5 type:94 isResponse:0];

  v31[0] = *MEMORY[0x277D18630];
  v7 = *(a1 + 48);
  v8 = [MEMORY[0x277CCACA8] stringWithFormat:@"PaymentWebServiceRegisterRequest-%@", *(a1 + 56)];
  v31[1] = *MEMORY[0x277D185D0];
  v32[0] = v8;
  v32[1] = MEMORY[0x277CBEC38];
  v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v32 forKeys:v31 count:2];
  v10 = [v7 _sendProtobuf:v6 responseExpected:1 extraOptions:v9];

  if (v10)
  {
    v11 = *(a1 + 64);
    if (v11)
    {
      v12 = _Block_copy(v11);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_performDeviceRegistrationForReason_brokerURL_completion___block_invoke_2_791;
      aBlock[3] = &unk_279945218;
      v26 = *(a1 + 64);
      v13 = _Block_copy(aBlock);
      v14 = *(a1 + 48);
      v15 = _Block_copy(v12);
      [v14 _trackOutstandingRequestWithMessageIdentifier:v10 completionHandler:v15 errorHandler:v13];

LABEL_11:
      goto LABEL_12;
    }

    v22 = pk_Payment_log();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT);

    if (v23)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v28 = v10;
      v18 = "Warning: No response expected for message with identifier %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_DEFAULT;
      v21 = 12;
      goto LABEL_10;
    }
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);

    if (v17)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 136315394;
      v28 = "[NPKPaymentWebServiceCompanionTargetDevice performDeviceRegistrationForReason:brokerURL:completion:]_block_invoke";
      v29 = 2112;
      v30 = v6;
      v18 = "Error: %s No message identifier for protobuf %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_ERROR;
      v21 = 22;
LABEL_10:
      _os_log_impl(&dword_25B300000, v19, v20, v18, buf, v21);
      goto LABEL_11;
    }
  }

LABEL_12:

  v24 = *MEMORY[0x277D85DE8];
}

uint64_t __101__NPKPaymentWebServiceCompanionTargetDevice_performDeviceRegistrationForReason_brokerURL_completion___block_invoke_2_791(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 1, a2);
  }

  return result;
}

- (void)photosForFamilyMembersWithDSIDsResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target photosForFamilyMembersWithDSIDsResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __85__NPKPaymentWebServiceCompanionTargetDevice_photosForFamilyMembersWithDSIDsResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __85__NPKPaymentWebServiceCompanionTargetDevice_photosForFamilyMembersWithDSIDsResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoPhotosForFamilyMembersWithDSIDsResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoPhotosForFamilyMembersWithDSIDsResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = objc_alloc_init(MEMORY[0x277CBEB38]);
    v12 = *(*(a1 + 64) + 8);
    v13 = *(v12 + 40);
    *(v12 + 40) = v11;

    if ([(NPKProtoPhotosForFamilyMembersWithDSIDsResponse *)v6 familyPhotosIDsCount])
    {
      v14 = 0;
      do
      {
        v15 = [(NPKProtoPhotosForFamilyMembersWithDSIDsResponse *)v6 familyPhotosIDs];
        v16 = [v15 objectAtIndexedSubscript:v14];
        v17 = objc_opt_class();
        v18 = NPKSecureUnarchiveObject(v16, v17);

        v19 = [(NPKProtoPhotosForFamilyMembersWithDSIDsResponse *)v6 familyPhotos];
        v20 = [v19 objectAtIndexedSubscript:v14];
        v21 = objc_opt_class();
        v22 = NPKSecureUnarchiveObject(v20, v21);

        if (v18 && v22)
        {
          [*(*(*(a1 + 64) + 8) + 40) setObject:v22 forKey:v18];
        }

        ++v14;
      }

      while (v14 < [(NPKProtoPhotosForFamilyMembersWithDSIDsResponse *)v6 familyPhotosIDsCount]);
    }
  }

  else
  {
    v23 = pk_Payment_log();
    v24 = os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT);

    if (v24)
    {
      v25 = pk_Payment_log();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
      {
        *v26 = 0;
        _os_log_impl(&dword_25B300000, v25, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v26, 2u);
      }
    }
  }
}

- (void)photosForFamilyMembersWithDSIDs:(id)ds completion:(id)completion
{
  dsCopy = ds;
  completionCopy = completion;
  if (NPKPairedOrPairingDeviceIsTinker())
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_photosForFamilyMembersWithDSIDs_completion___block_invoke;
    block[3] = &unk_279945A48;
    v11 = dsCopy;
    selfCopy = self;
    v13 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v9 = objc_alloc_init(MEMORY[0x277D380F0]);
    [v9 photosForFamilyMembersWithDSIDs:dsCopy completion:completionCopy];
  }
}

void __88__NPKPaymentWebServiceCompanionTargetDevice_photosForFamilyMembersWithDSIDs_completion___block_invoke(uint64_t a1)
{
  v40 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      *buf = 138412290;
      v39 = v5;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Photos for family members with IDs %@. Sending message", buf, 0xCu);
    }
  }

  v6 = objc_alloc_init(NPKProtoPhotosForFamilyMembersWithDSIDsRequest);
  v7 = *(a1 + 32);
  v34[0] = MEMORY[0x277D85DD0];
  v34[1] = 3221225472;
  v34[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_photosForFamilyMembersWithDSIDs_completion___block_invoke_795;
  v34[3] = &unk_27994A6E0;
  v8 = v6;
  v35 = v8;
  [v7 enumerateObjectsUsingBlock:v34];
  v9 = objc_alloc(MEMORY[0x277D189F0]);
  v10 = [(NPKProtoPhotosForFamilyMembersWithDSIDsRequest *)v8 data];
  v11 = [v9 initWithProtobufData:v10 type:87 isResponse:0];

  v12 = *(a1 + 40);
  v13 = *MEMORY[0x277D185D0];
  v36[0] = *MEMORY[0x277D18630];
  v36[1] = v13;
  v37[0] = @"familyMembersPhotos";
  v37[1] = MEMORY[0x277CBEC38];
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v37 forKeys:v36 count:2];
  v15 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v14];

  if (v15)
  {
    v16 = *(a1 + 48);
    if (v16)
    {
      v17 = _Block_copy(v16);
      v29 = MEMORY[0x277D85DD0];
      v30 = 3221225472;
      v31 = __88__NPKPaymentWebServiceCompanionTargetDevice_photosForFamilyMembersWithDSIDs_completion___block_invoke_2;
      v32 = &unk_279945218;
      v33 = *(a1 + 48);
      v18 = _Block_copy(&v29);
      v19 = *(a1 + 40);
      v20 = _Block_copy(v17);
      [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:{v18, v29, v30, v31, v32}];

LABEL_15:
      goto LABEL_16;
    }

    v26 = pk_Payment_log();
    v27 = os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT);

    if (v27)
    {
      v17 = pk_Payment_log();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v39 = v15;
      v23 = "Warning: No response expected for message with identifier %@";
      v24 = v17;
      v25 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_14;
    }
  }

  else
  {
    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

    if (v22)
    {
      v17 = pk_Payment_log();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v39 = v11;
      v23 = "Error: No message identifier for protobuf %@";
      v24 = v17;
      v25 = OS_LOG_TYPE_ERROR;
LABEL_14:
      _os_log_impl(&dword_25B300000, v24, v25, v23, buf, 0xCu);
      goto LABEL_15;
    }
  }

LABEL_16:

  v28 = *MEMORY[0x277D85DE8];
}

void __88__NPKPaymentWebServiceCompanionTargetDevice_photosForFamilyMembersWithDSIDs_completion___block_invoke_795(uint64_t a1, void *a2)
{
  v3 = NPKSecureArchiveObject(a2);
  if (v3)
  {
    v4 = v3;
    [*(a1 + 32) addRequestDSIDs:v3];
    v3 = v4;
  }
}

uint64_t __88__NPKPaymentWebServiceCompanionTargetDevice_photosForFamilyMembersWithDSIDs_completion___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)featureApplicationsForAccountIdentifierResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target featureApplicationsForAccountIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __93__NPKPaymentWebServiceCompanionTargetDevice_featureApplicationsForAccountIdentifierResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __93__NPKPaymentWebServiceCompanionTargetDevice_featureApplicationsForAccountIdentifierResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoFeatureApplicationsForAccountIdentifierResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoFeatureApplicationsForAccountIdentifierResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = objc_alloc_init(MEMORY[0x277CBEB18]);
    v12 = *(*(a1 + 64) + 8);
    v13 = *(v12 + 40);
    *(v12 + 40) = v11;

    if ([(NPKProtoFeatureApplicationsForAccountIdentifierResponse *)v6 deprecatedFeatureApplicationsCount])
    {
      v14 = 0;
      do
      {
        v15 = [(NPKProtoFeatureApplicationsForAccountIdentifierResponse *)v6 deprecatedFeatureApplications];
        v16 = [v15 objectAtIndexedSubscript:v14];
        v17 = [MEMORY[0x277CBEB98] setWithObject:objc_opt_class()];
        v18 = NPKSecureUnarchiveArrayOfObjectsOfClasses(v16, v17);

        if (v18)
        {
          [*(*(*(a1 + 64) + 8) + 40) addObjectsFromArray:v18];
        }

        ++v14;
      }

      while (v14 < [(NPKProtoFeatureApplicationsForAccountIdentifierResponse *)v6 deprecatedFeatureApplicationsCount]);
    }

    if ([(NPKProtoFeatureApplicationsForAccountIdentifierResponse *)v6 featureApplicationsCount])
    {
      v19 = 0;
      do
      {
        v20 = [(NPKProtoFeatureApplicationsForAccountIdentifierResponse *)v6 featureApplications];
        v21 = [v20 objectAtIndexedSubscript:v19];
        v22 = objc_opt_class();
        v23 = NPKSecureUnarchiveObject(v21, v22);

        if (v23)
        {
          [*(*(*(a1 + 64) + 8) + 40) addObject:v23];
        }

        ++v19;
      }

      while (v19 < [(NPKProtoFeatureApplicationsForAccountIdentifierResponse *)v6 featureApplicationsCount]);
    }
  }

  else
  {
    v24 = pk_Payment_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

    if (v25)
    {
      v26 = pk_Payment_log();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
      {
        *v27 = 0;
        _os_log_impl(&dword_25B300000, v26, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v27, 2u);
      }
    }
  }
}

- (void)featureApplicationsForAccountIdentifier:(id)identifier completion:(id)completion
{
  identifierCopy = identifier;
  completionCopy = completion;
  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __96__NPKPaymentWebServiceCompanionTargetDevice_featureApplicationsForAccountIdentifier_completion___block_invoke;
  block[3] = &unk_279945A48;
  v12 = identifierCopy;
  selfCopy = self;
  v14 = completionCopy;
  v9 = completionCopy;
  v10 = identifierCopy;
  dispatch_sync(internalQueue, block);
}

void __96__NPKPaymentWebServiceCompanionTargetDevice_featureApplicationsForAccountIdentifier_completion___block_invoke(uint64_t a1)
{
  v33 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      *buf = 138412290;
      v32 = v5;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Feature applications for account with identifier %@. Sending message", buf, 0xCu);
    }
  }

  v6 = objc_alloc_init(NPKProtoFeatureApplicationsForAccountIdentifierRequest);
  [(NPKProtoFeatureApplicationsForAccountIdentifierRequest *)v6 setAccountIdentifier:*(a1 + 32)];
  v7 = objc_alloc(MEMORY[0x277D189F0]);
  v8 = [(NPKProtoFeatureApplicationsForAccountIdentifierRequest *)v6 data];
  v9 = [v7 initWithProtobufData:v8 type:89 isResponse:0];

  v10 = *(a1 + 40);
  v11 = *MEMORY[0x277D185D0];
  v29[0] = *MEMORY[0x277D18630];
  v29[1] = v11;
  v30[0] = @"featureApplications";
  v30[1] = MEMORY[0x277CBEC38];
  v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:v29 count:2];
  v13 = [v10 _sendProtobuf:v9 responseExpected:1 extraOptions:v12];

  if (v13)
  {
    v14 = *(a1 + 48);
    if (v14)
    {
      v15 = _Block_copy(v14);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __96__NPKPaymentWebServiceCompanionTargetDevice_featureApplicationsForAccountIdentifier_completion___block_invoke_806;
      aBlock[3] = &unk_279945218;
      v28 = *(a1 + 48);
      v16 = _Block_copy(aBlock);
      v17 = *(a1 + 40);
      v18 = _Block_copy(v15);
      [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_15:
      goto LABEL_16;
    }

    v24 = pk_Payment_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

    if (v25)
    {
      v15 = pk_Payment_log();
      if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v32 = v13;
      v21 = "Warning: No response expected for message with identifier %@";
      v22 = v15;
      v23 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_14;
    }
  }

  else
  {
    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

    if (v20)
    {
      v15 = pk_Payment_log();
      if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v32 = v9;
      v21 = "Error: No message identifier for protobuf %@";
      v22 = v15;
      v23 = OS_LOG_TYPE_ERROR;
LABEL_14:
      _os_log_impl(&dword_25B300000, v22, v23, v21, buf, 0xCu);
      goto LABEL_15;
    }
  }

LABEL_16:

  v26 = *MEMORY[0x277D85DE8];
}

void __96__NPKPaymentWebServiceCompanionTargetDevice_featureApplicationsForAccountIdentifier_completion___block_invoke_806(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)provisionHomeKeyPassForSerialNumbers:(id)numbers completionHandler:(id)handler
{
  v35 = *MEMORY[0x277D85DE8];
  numbersCopy = numbers;
  handlerCopy = handler;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v11 = _Block_copy(handlerCopy);
      *buf = 138412546;
      v32 = numbersCopy;
      v33 = 2112;
      v34 = v11;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Target device - provision home key pass for serial numbers: %@ completion: %@", buf, 0x16u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isHomeKeyProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_provisionHomeKeyPassForSerialNumbers_completionHandler___block_invoke;
    block[3] = &unk_279945A48;
    v26 = numbersCopy;
    selfCopy = self;
    v28 = handlerCopy;
    dispatch_sync(internalQueue, block);

    v13 = v26;
LABEL_13:

    goto LABEL_14;
  }

  v14 = pk_Payment_log();
  v15 = os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT);

  if (v15)
  {
    v16 = pk_Payment_log();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v16, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support home key provisioning.", buf, 2u);
    }
  }

  if (handlerCopy)
  {
    v17 = MEMORY[0x277CCA9B8];
    v18 = *MEMORY[0x277D385D8];
    v29[0] = *MEMORY[0x277CCA470];
    v19 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v20 = [v19 localizedStringForKey:@"HOMEKEY_ERROR_ALERT_CANNOT_ADD_KEY_UNSUPPORTED_ERROR_TITLE" value:&stru_286C934F8 table:@"NanoPassKit-HomeKey"];
    v30[0] = v20;
    v29[1] = *MEMORY[0x277CCA498];
    v21 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v22 = [v21 localizedStringForKey:@"HOMEKEY_ERROR_ALERT_CANNOT_ADD_KEY_UNSUPPORTED_ERROR_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKit-HomeKey"];
    v30[1] = v22;
    v23 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:v29 count:2];
    v13 = [v17 errorWithDomain:v18 code:0 userInfo:v23];

    (*(handlerCopy + 2))(handlerCopy, 0, v13);
    goto LABEL_13;
  }

LABEL_14:

  v24 = *MEMORY[0x277D85DE8];
}

void __100__NPKPaymentWebServiceCompanionTargetDevice_provisionHomeKeyPassForSerialNumbers_completionHandler___block_invoke(uint64_t a1)
{
  v38[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoProvisionHomeKeyPassForSerialNumbersRequest);
  v3 = *(a1 + 32);
  v31[0] = MEMORY[0x277D85DD0];
  v31[1] = 3221225472;
  v31[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_provisionHomeKeyPassForSerialNumbers_completionHandler___block_invoke_2;
  v31[3] = &unk_279945858;
  v4 = v2;
  v32 = v4;
  [v3 enumerateObjectsUsingBlock:v31];
  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [(NPKProtoProvisionHomeKeyPassForSerialNumbersRequest *)v4 data];
  v7 = [v5 initWithProtobufData:v6 type:92 isResponse:0];

  v8 = *(a1 + 40);
  v37 = *MEMORY[0x277D18650];
  v38[0] = &unk_286CE7808;
  v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:&v37 count:1];
  v10 = [v8 _sendProtobuf:v7 responseExpected:1 extraOptions:v9];

  if (v10)
  {
    v11 = *(a1 + 48);
    if (v11)
    {
      v12 = _Block_copy(v11);
      v26 = MEMORY[0x277D85DD0];
      v27 = 3221225472;
      v28 = __100__NPKPaymentWebServiceCompanionTargetDevice_provisionHomeKeyPassForSerialNumbers_completionHandler___block_invoke_3;
      v29 = &unk_279945218;
      v30 = *(a1 + 48);
      v13 = _Block_copy(&v26);
      v14 = *(a1 + 40);
      v15 = _Block_copy(v12);
      [v14 _trackOutstandingRequestWithMessageIdentifier:v10 completionHandler:v15 errorHandler:{v13, v26, v27, v28, v29}];

LABEL_11:
      goto LABEL_12;
    }

    v22 = pk_Payment_log();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT);

    if (v23)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      v24 = [v7 type];
      *buf = 138412546;
      v34 = v10;
      v35 = 1024;
      v36 = v24;
      v19 = "Warning: No response expected for message with identifier %@ of type %hu";
      v20 = v12;
      v21 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);

    if (v17)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      v18 = [v7 type];
      *buf = 138412546;
      v34 = v7;
      v35 = 1024;
      v36 = v18;
      v19 = "Error: No message identifier for protobuf %@ with type %hu";
      v20 = v12;
      v21 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v20, v21, v19, buf, 0x12u);
      goto LABEL_11;
    }
  }

LABEL_12:

  v25 = *MEMORY[0x277D85DE8];
}

uint64_t __100__NPKPaymentWebServiceCompanionTargetDevice_provisionHomeKeyPassForSerialNumbers_completionHandler___block_invoke_3(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)provisionHomeKeyPassForSerialNumbersResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target provisionHomeKeyPassForSerialNumbersResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_provisionHomeKeyPassForSerialNumbersResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_provisionHomeKeyPassForSerialNumbersResponse___block_invoke(uint64_t a1)
{
  v56 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoProvisionHomeKeyPassForSerialNumbersResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoProvisionHomeKeyPassForSerialNumbersResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v40 = v3;
    v8 = [v3 completionHandler];
    v38 = a1;
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v41 = [MEMORY[0x277CBEB18] arrayWithCapacity:{-[NPKProtoProvisionHomeKeyPassForSerialNumbersResponse provisionedPassesDatasCount](v6, "provisionedPassesDatasCount")}];
    v45 = 0u;
    v46 = 0u;
    v47 = 0u;
    v48 = 0u;
    p_super = &v6->super.super;
    obj = [(NPKProtoProvisionHomeKeyPassForSerialNumbersResponse *)v6 provisionedPassesDatas];
    v11 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
    if (!v11)
    {
      goto LABEL_25;
    }

    v12 = v11;
    v13 = *v46;
    v14 = 0x277D38000uLL;
    while (1)
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v46 != v13)
        {
          objc_enumerationMutation(obj);
        }

        v16 = *(*(&v45 + 1) + 8 * i);
        v17 = objc_alloc(*(v14 + 624));
        v44 = 0;
        v18 = [v17 initWithData:v16 error:&v44];
        v19 = v44;
        if (v18)
        {
          v20 = v19 == 0;
        }

        else
        {
          v20 = 0;
        }

        if (v20)
        {
          v43 = 0;
          v5 = [MEMORY[0x277D37F98] createWithFileDataAccessor:v18 validationOptions:2 warnings:0 error:&v43];
          v21 = v43;
          v23 = [v5 paymentPass];
          if (v23)
          {
            [v41 addObject:v23];
          }

          else
          {
            pk_Payment_log();
            v25 = v24 = v14;
            v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

            v14 = v24;
            if (v26)
            {
              v27 = pk_Payment_log();
              if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
              {
                *buf = 136315394;
                v50 = "[NPKPaymentWebServiceCompanionTargetDevice provisionHomeKeyPassForSerialNumbersResponse:]_block_invoke";
                v51 = 2112;
                v52 = v21;
                _os_log_impl(&dword_25B300000, v27, OS_LOG_TYPE_ERROR, "Error: %s Problem recreating pass from received pass data. Error: %@", buf, 0x16u);
              }

              v14 = v24;
            }
          }

          goto LABEL_22;
        }

        v21 = v19;
        if (v19)
        {
          v5 = pk_Payment_log();
          v22 = os_log_type_enabled(v5, OS_LOG_TYPE_ERROR);

          if (v22)
          {
            v5 = pk_Payment_log();
            if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
            {
              *buf = 136315650;
              v50 = "[NPKPaymentWebServiceCompanionTargetDevice provisionHomeKeyPassForSerialNumbersResponse:]_block_invoke";
              v51 = 2112;
              v52 = v18;
              v53 = 2112;
              v54 = v21;
              _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_ERROR, "Error: %s Error creating data accessor (%@). Error: %@", buf, 0x20u);
            }

LABEL_22:
          }
        }
      }

      v12 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
      if (!v12)
      {
LABEL_25:

        v28 = [v41 copy];
        v29 = *(*(v38 + 64) + 8);
        v30 = *(v29 + 40);
        *(v29 + 40) = v28;

        v31 = p_super;
        v32 = [p_super hasErrorData];
        if (v32)
        {
          v5 = [p_super errorData];
          v33 = objc_opt_class();
          v34 = NPKSecureUnarchiveObject(v5, v33);
        }

        else
        {
          v34 = 0;
        }

        v3 = v40;
        objc_storeStrong((*(*(v38 + 72) + 8) + 40), v34);
        if (v32)
        {
        }

        goto LABEL_34;
      }
    }
  }

  v35 = pk_Payment_log();
  v36 = os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT);

  if (v36)
  {
    v31 = pk_Payment_log();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v31, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", buf, 2u);
    }

LABEL_34:
  }

  v37 = *MEMORY[0x277D85DE8];
}

- (void)availableHomeKeyPassesWithCompletionHandler:(id)handler
{
  v28 = *MEMORY[0x277D85DE8];
  handlerCopy = handler;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = _Block_copy(handlerCopy);
      *buf = 138412290;
      v27 = v8;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device - available home key passes with completion: %@", buf, 0xCu);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isHomeKeyProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __89__NPKPaymentWebServiceCompanionTargetDevice_availableHomeKeyPassesWithCompletionHandler___block_invoke;
    v22[3] = &unk_279945530;
    v22[4] = self;
    v23 = handlerCopy;
    dispatch_sync(internalQueue, v22);
  }

  else
  {
    v10 = pk_Payment_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

    if (v11)
    {
      v12 = pk_Payment_log();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support home key provisioning.", buf, 2u);
      }
    }

    if (handlerCopy)
    {
      v13 = MEMORY[0x277CCA9B8];
      v14 = *MEMORY[0x277D385D8];
      v24[0] = *MEMORY[0x277CCA470];
      v15 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
      v16 = [v15 localizedStringForKey:@"HOMEKEY_ERROR_ALERT_CANNOT_ADD_KEY_UNSUPPORTED_ERROR_TITLE" value:&stru_286C934F8 table:@"NanoPassKit-HomeKey"];
      v25[0] = v16;
      v24[1] = *MEMORY[0x277CCA498];
      v17 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
      v18 = [v17 localizedStringForKey:@"HOMEKEY_ERROR_ALERT_CANNOT_ADD_KEY_UNSUPPORTED_ERROR_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKit-HomeKey"];
      v25[1] = v18;
      v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v25 forKeys:v24 count:2];
      v20 = [v13 errorWithDomain:v14 code:0 userInfo:v19];

      (*(handlerCopy + 2))(handlerCopy, 0, v20);
    }
  }

  v21 = *MEMORY[0x277D85DE8];
}

void __89__NPKPaymentWebServiceCompanionTargetDevice_availableHomeKeyPassesWithCompletionHandler___block_invoke(uint64_t a1)
{
  v29[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoAvailableHomeKeyPassesRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoAvailableHomeKeyPassesRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:93 isResponse:0];

  v6 = *(a1 + 32);
  v28 = *MEMORY[0x277D18650];
  v29[0] = &unk_286CE7808;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:&v28 count:1];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7];

  if (v8)
  {
    v9 = *(a1 + 40);
    if (v9)
    {
      v10 = _Block_copy(v9);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __89__NPKPaymentWebServiceCompanionTargetDevice_availableHomeKeyPassesWithCompletionHandler___block_invoke_2;
      aBlock[3] = &unk_279945218;
      v23 = *(a1 + 40);
      v11 = _Block_copy(aBlock);
      v12 = *(a1 + 32);
      v13 = _Block_copy(v10);
      [v12 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v13 errorHandler:v11];

LABEL_11:
      goto LABEL_12;
    }

    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412546;
      v25 = v8;
      v26 = 1024;
      v27 = [v5 type];
      v16 = "Warning: No response expected for message with identifier %@ of type %hu";
      v17 = v10;
      v18 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v14 = pk_Payment_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (v15)
    {
      v10 = pk_Payment_log();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412546;
      v25 = v5;
      v26 = 1024;
      v27 = [v5 type];
      v16 = "Error: No message identifier for protobuf %@ with type %hu";
      v17 = v10;
      v18 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v17, v18, v16, buf, 0x12u);
      goto LABEL_11;
    }
  }

LABEL_12:

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __89__NPKPaymentWebServiceCompanionTargetDevice_availableHomeKeyPassesWithCompletionHandler___block_invoke_2(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, a2);
  }

  return result;
}

- (void)availableHomeKeyPassesResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target availableHomeKeyPassesResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_availableHomeKeyPassesResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __76__NPKPaymentWebServiceCompanionTargetDevice_availableHomeKeyPassesResponse___block_invoke(uint64_t a1)
{
  v56 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoAvailableHomeKeyPassesResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoAvailableHomeKeyPassesResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v40 = v3;
    v8 = [v3 completionHandler];
    v38 = a1;
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v41 = [MEMORY[0x277CBEB18] arrayWithCapacity:{-[NPKProtoAvailableHomeKeyPassesResponse passesDatasCount](v6, "passesDatasCount")}];
    v45 = 0u;
    v46 = 0u;
    v47 = 0u;
    v48 = 0u;
    p_super = &v6->super.super;
    obj = [(NPKProtoAvailableHomeKeyPassesResponse *)v6 passesDatas];
    v11 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
    if (!v11)
    {
      goto LABEL_25;
    }

    v12 = v11;
    v13 = *v46;
    v14 = 0x277D38000uLL;
    while (1)
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v46 != v13)
        {
          objc_enumerationMutation(obj);
        }

        v16 = *(*(&v45 + 1) + 8 * i);
        v17 = objc_alloc(*(v14 + 624));
        v44 = 0;
        v18 = [v17 initWithData:v16 error:&v44];
        v19 = v44;
        if (v18)
        {
          v20 = v19 == 0;
        }

        else
        {
          v20 = 0;
        }

        if (v20)
        {
          v43 = 0;
          v5 = [MEMORY[0x277D37F98] createWithFileDataAccessor:v18 validationOptions:2 warnings:0 error:&v43];
          v21 = v43;
          v23 = [v5 paymentPass];
          if (v23)
          {
            [v41 addObject:v23];
          }

          else
          {
            pk_Payment_log();
            v25 = v24 = v14;
            v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

            v14 = v24;
            if (v26)
            {
              v27 = pk_Payment_log();
              if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
              {
                *buf = 136315394;
                v50 = "[NPKPaymentWebServiceCompanionTargetDevice availableHomeKeyPassesResponse:]_block_invoke";
                v51 = 2112;
                v52 = v21;
                _os_log_impl(&dword_25B300000, v27, OS_LOG_TYPE_ERROR, "Error: %s Problem recreating pass from received pass data. Error: %@", buf, 0x16u);
              }

              v14 = v24;
            }
          }

          goto LABEL_22;
        }

        v21 = v19;
        if (v19)
        {
          v5 = pk_Payment_log();
          v22 = os_log_type_enabled(v5, OS_LOG_TYPE_ERROR);

          if (v22)
          {
            v5 = pk_Payment_log();
            if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
            {
              *buf = 136315650;
              v50 = "[NPKPaymentWebServiceCompanionTargetDevice availableHomeKeyPassesResponse:]_block_invoke";
              v51 = 2112;
              v52 = v18;
              v53 = 2112;
              v54 = v21;
              _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_ERROR, "Error: %s Error creating data accessor (%@). Error: %@", buf, 0x20u);
            }

LABEL_22:
          }
        }
      }

      v12 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
      if (!v12)
      {
LABEL_25:

        v28 = [v41 copy];
        v29 = *(*(v38 + 64) + 8);
        v30 = *(v29 + 40);
        *(v29 + 40) = v28;

        v31 = p_super;
        v32 = [p_super hasErrorData];
        if (v32)
        {
          v5 = [p_super errorData];
          v33 = objc_opt_class();
          v34 = NPKSecureUnarchiveObject(v5, v33);
        }

        else
        {
          v34 = 0;
        }

        v3 = v40;
        objc_storeStrong((*(*(v38 + 72) + 8) + 40), v34);
        if (v32)
        {
        }

        goto LABEL_34;
      }
    }
  }

  v35 = pk_Payment_log();
  v36 = os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT);

  if (v36)
  {
    v31 = pk_Payment_log();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v31, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", buf, 2u);
    }

LABEL_34:
  }

  v37 = *MEMORY[0x277D85DE8];
}

- (void)generateAuxiliaryCapabilitiesForRequirements:(id)requirements completion:(id)completion
{
  requirementsCopy = requirements;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isAuxiliaryRegistrationSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_generateAuxiliaryCapabilitiesForRequirements_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v15 = requirementsCopy;
    selfCopy = self;
    v17 = completionCopy;
    dispatch_sync(internalQueue, block);

    v9 = v15;
LABEL_9:

    goto LABEL_10;
  }

  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *v13 = 0;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support generateAuxiliaryCapabilitiesForRequirements:completion: message.", v13, 2u);
    }
  }

  if (completionCopy)
  {
    v9 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v9);
    goto LABEL_9;
  }

LABEL_10:
}

void __101__NPKPaymentWebServiceCompanionTargetDevice_generateAuxiliaryCapabilitiesForRequirements_completion___block_invoke(uint64_t a1)
{
  v47 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138478083;
      v44 = v5;
      v45 = 2112;
      v46 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to generate auxiliary capabilities for requirements: %{private}@, completion: %@", buf, 0x16u);
    }
  }

  v7 = objc_alloc_init(NPKProtoGenerateAuxiliaryCapabilitiesRequest);
  v8 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v9 = *(a1 + 32);
  v10 = [v9 countByEnumeratingWithState:&v36 objects:v42 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v37;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v37 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = NPKSecureArchiveObject(*(*(&v36 + 1) + 8 * i));
        [v8 addObject:v14];
      }

      v11 = [v9 countByEnumeratingWithState:&v36 objects:v42 count:16];
    }

    while (v11);
  }

  [(NPKProtoGenerateAuxiliaryCapabilitiesRequest *)v7 setRegistrationRequirements:v8];
  v15 = objc_alloc(MEMORY[0x277D189F0]);
  v16 = [(NPKProtoGenerateAuxiliaryCapabilitiesRequest *)v7 data];
  v17 = [v15 initWithProtobufData:v16 type:152 isResponse:0];

  v18 = *(a1 + 40);
  v40 = *MEMORY[0x277D18650];
  v41 = &unk_286CE7808;
  v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v41 forKeys:&v40 count:1];
  v20 = [v18 _sendProtobuf:v17 responseExpected:1 extraOptions:v19];

  if (v20)
  {
    v21 = *(a1 + 48);
    if (v21)
    {
      v22 = _Block_copy(v21);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_generateAuxiliaryCapabilitiesForRequirements_completion___block_invoke_823;
      aBlock[3] = &unk_279945218;
      v35 = *(a1 + 48);
      v23 = _Block_copy(aBlock);
      v24 = *(a1 + 40);
      v25 = _Block_copy(v22);
      [v24 _trackOutstandingRequestWithMessageIdentifier:v20 completionHandler:v25 errorHandler:v23];

LABEL_22:
      goto LABEL_23;
    }

    v31 = pk_Payment_log();
    v32 = os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT);

    if (v32)
    {
      v22 = pk_Payment_log();
      if (!os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_22;
      }

      *buf = 138412290;
      v44 = v20;
      v28 = "Warning: No response expected for message with identifier %@";
      v29 = v22;
      v30 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_21;
    }
  }

  else
  {
    v26 = pk_Payment_log();
    v27 = os_log_type_enabled(v26, OS_LOG_TYPE_ERROR);

    if (v27)
    {
      v22 = pk_Payment_log();
      if (!os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_22;
      }

      *buf = 138412290;
      v44 = v17;
      v28 = "Error: No message identifier for protobuf %@";
      v29 = v22;
      v30 = OS_LOG_TYPE_ERROR;
LABEL_21:
      _os_log_impl(&dword_25B300000, v29, v30, v28, buf, 0xCu);
      goto LABEL_22;
    }
  }

LABEL_23:

  v33 = *MEMORY[0x277D85DE8];
}

void __101__NPKPaymentWebServiceCompanionTargetDevice_generateAuxiliaryCapabilitiesForRequirements_completion___block_invoke_823(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)generateAuxiliaryCapabilitiesResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target generateAuxiliaryCapabilitiesResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __83__NPKPaymentWebServiceCompanionTargetDevice_generateAuxiliaryCapabilitiesResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __83__NPKPaymentWebServiceCompanionTargetDevice_generateAuxiliaryCapabilitiesResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoGenerateAuxiliaryCapabilitiesResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoGenerateAuxiliaryCapabilitiesResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = objc_alloc_init(MEMORY[0x277CCAB00]);
    v12 = *(*(a1 + 64) + 8);
    v13 = *(v12 + 40);
    *(v12 + 40) = v11;

    v14 = [(NPKProtoGenerateAuxiliaryCapabilitiesResponse *)v6 keyMaterialValues];
    v15 = [v14 count];

    i = [(NPKProtoGenerateAuxiliaryCapabilitiesResponse *)v6 requirementKeys];
    v17 = [i count];

    if (v17 == v15 && v15)
    {
      for (i = 0; i != v15; ++i)
      {
        v18 = [(NPKProtoGenerateAuxiliaryCapabilitiesResponse *)v6 requirementKeys];
        v19 = [v18 objectAtIndexedSubscript:i];

        if (v19)
        {
          v20 = objc_opt_class();
          v21 = NPKSecureUnarchiveObject(v19, v20);
          v22 = [(NPKProtoGenerateAuxiliaryCapabilitiesResponse *)v6 keyMaterialValues];
          v23 = [v22 objectAtIndexedSubscript:i];

          if (v23)
          {
            v24 = objc_opt_class();
            v25 = NPKSecureUnarchiveObject(v23, v24);
            if (v25)
            {
              v26 = v25;
              [*(*(*(a1 + 64) + 8) + 40) setObject:v25 forKey:v21];
            }
          }
        }
      }
    }

    v27 = [(NPKProtoGenerateAuxiliaryCapabilitiesResponse *)v6 hasErrorData];
    if (v27)
    {
      i = [(NPKProtoGenerateAuxiliaryCapabilitiesResponse *)v6 errorData];
      v28 = objc_opt_class();
      v29 = NPKSecureUnarchiveObject(i, v28);
    }

    else
    {
      v29 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v29);
    if (v27)
    {
    }
  }

  else
  {
    v30 = pk_Payment_log();
    v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

    if (v31)
    {
      v32 = pk_Payment_log();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v32, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", buf, 2u);
      }
    }
  }
}

- (void)createFidoKeyForRelyingParty:(id)party relyingPartyAccountHash:(id)hash challenge:(id)challenge externalizedAuth:(id)auth completion:(id)completion
{
  v40[2] = *MEMORY[0x277D85DE8];
  partyCopy = party;
  hashCopy = hash;
  challengeCopy = challenge;
  authCopy = auth;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isUnifiedAccessProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __136__NPKPaymentWebServiceCompanionTargetDevice_createFidoKeyForRelyingParty_relyingPartyAccountHash_challenge_externalizedAuth_completion___block_invoke;
    block[3] = &unk_27994A708;
    v33 = partyCopy;
    v34 = hashCopy;
    v35 = challengeCopy;
    v36 = authCopy;
    selfCopy = self;
    v38 = completionCopy;
    dispatch_sync(internalQueue, block);

    v18 = v33;
LABEL_9:

    goto LABEL_10;
  }

  v19 = pk_Payment_log();
  v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

  if (v20)
  {
    v21 = pk_Payment_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support unified access provisioning.", buf, 2u);
    }
  }

  if (completionCopy)
  {
    v29 = MEMORY[0x277CCA9B8];
    v28 = *MEMORY[0x277D385D8];
    v39[0] = *MEMORY[0x277CCA470];
    v30 = partyCopy;
    v22 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v23 = [v22 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_TITLE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v40[0] = v23;
    v39[1] = *MEMORY[0x277CCA498];
    v24 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v25 = [v24 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v40[1] = v25;
    v26 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v40 forKeys:v39 count:2];
    v18 = [v29 errorWithDomain:v28 code:4 userInfo:v26];

    partyCopy = v30;
    (*(completionCopy + 2))(completionCopy, 0, 0, 0, v18);
    goto LABEL_9;
  }

LABEL_10:

  v27 = *MEMORY[0x277D85DE8];
}

void __136__NPKPaymentWebServiceCompanionTargetDevice_createFidoKeyForRelyingParty_relyingPartyAccountHash_challenge_externalizedAuth_completion___block_invoke(uint64_t a1)
{
  v44 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = *(a1 + 48);
      v8 = *(a1 + 56);
      v9 = _Block_copy(*(a1 + 72));
      *buf = 138413314;
      v35 = v5;
      v36 = 2112;
      v37 = v6;
      v38 = 2112;
      v39 = v7;
      v40 = 2112;
      v41 = v8;
      v42 = 2112;
      v43 = v9;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target create fido key for relying party %@ accountHash %@ challenge %@ externalizedauth %@ with completion %@", buf, 0x34u);
    }
  }

  v10 = objc_alloc_init(NPKProtoCreateFidoKeyRequest);
  [(NPKProtoCreateFidoKeyRequest *)v10 setRelyingParty:*(a1 + 32)];
  [(NPKProtoCreateFidoKeyRequest *)v10 setRelyingPartyAccountHash:*(a1 + 40)];
  [(NPKProtoCreateFidoKeyRequest *)v10 setChallenge:*(a1 + 48)];
  [(NPKProtoCreateFidoKeyRequest *)v10 setExternalizedAuth:*(a1 + 56)];
  v11 = objc_alloc(MEMORY[0x277D189F0]);
  v12 = [(NPKProtoCreateFidoKeyRequest *)v10 data];
  v13 = [v11 initWithProtobufData:v12 type:95 isResponse:0];

  v14 = *(a1 + 64);
  v32 = *MEMORY[0x277D185D0];
  v33 = MEMORY[0x277CBEC38];
  v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v33 forKeys:&v32 count:1];
  v16 = [v14 _sendProtobuf:v13 responseExpected:1 extraOptions:v15];

  if (v16)
  {
    v17 = *(a1 + 72);
    if (v17)
    {
      v18 = _Block_copy(v17);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __136__NPKPaymentWebServiceCompanionTargetDevice_createFidoKeyForRelyingParty_relyingPartyAccountHash_challenge_externalizedAuth_completion___block_invoke_829;
      aBlock[3] = &unk_279945218;
      v31 = *(a1 + 72);
      v19 = _Block_copy(aBlock);
      v20 = *(a1 + 64);
      v21 = _Block_copy(v18);
      [v20 _trackOutstandingRequestWithMessageIdentifier:v16 completionHandler:v21 errorHandler:v19];

LABEL_15:
      goto LABEL_16;
    }

    v27 = pk_Payment_log();
    v28 = os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT);

    if (v28)
    {
      v18 = pk_Payment_log();
      if (!os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v35 = v16;
      v24 = "Warning: No response expected for message with identifier %@";
      v25 = v18;
      v26 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_14;
    }
  }

  else
  {
    v22 = pk_Payment_log();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

    if (v23)
    {
      v18 = pk_Payment_log();
      if (!os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v35 = v13;
      v24 = "Error: No message identifier for protobuf %@";
      v25 = v18;
      v26 = OS_LOG_TYPE_ERROR;
LABEL_14:
      _os_log_impl(&dword_25B300000, v25, v26, v24, buf, 0xCu);
      goto LABEL_15;
    }
  }

LABEL_16:

  v29 = *MEMORY[0x277D85DE8];
}

void __136__NPKPaymentWebServiceCompanionTargetDevice_createFidoKeyForRelyingParty_relyingPartyAccountHash_challenge_externalizedAuth_completion___block_invoke_829(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, 0, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)createFidoKeyResponse:(id)response
{
  v55 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target createFidoKeyResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v51 = 0x3032000000;
  v52 = __Block_byref_object_copy__384;
  v53 = __Block_byref_object_dispose__385;
  v54 = 0;
  v44 = 0;
  v45 = &v44;
  v46 = 0x3032000000;
  v47 = __Block_byref_object_copy__22;
  v48 = __Block_byref_object_dispose__22;
  v49 = 0;
  v38 = 0;
  v39 = &v38;
  v40 = 0x3032000000;
  v41 = __Block_byref_object_copy__22;
  v42 = __Block_byref_object_dispose__22;
  v43 = 0;
  v32 = 0;
  v33 = &v32;
  v34 = 0x3032000000;
  v35 = __Block_byref_object_copy__22;
  v36 = __Block_byref_object_dispose__22;
  v37 = 0;
  v26 = 0;
  v27 = &v26;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__22;
  v30 = __Block_byref_object_dispose__22;
  v31 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __67__NPKPaymentWebServiceCompanionTargetDevice_createFidoKeyResponse___block_invoke;
    block[3] = &unk_27994A080;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v44;
    v23 = &v38;
    v24 = &v32;
    v25 = &v26;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v45[5], v39[5], v33[5], v27[5]);
  }

  _Block_object_dispose(&v26, 8);

  _Block_object_dispose(&v32, 8);
  _Block_object_dispose(&v38, 8);

  _Block_object_dispose(&v44, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __67__NPKPaymentWebServiceCompanionTargetDevice_createFidoKeyResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCreateFidoKeyResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCreateFidoKeyResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCreateFidoKeyResponse *)v7 fidoKey];
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    v15 = [(NPKProtoCreateFidoKeyResponse *)v7 fidoAttestation];
    v16 = *(*(a1 + 72) + 8);
    v17 = *(v16 + 40);
    *(v16 + 40) = v15;

    v18 = [(NPKProtoCreateFidoKeyResponse *)v7 keyHash];
    v19 = *(*(a1 + 80) + 8);
    v20 = *(v19 + 40);
    *(v19 + 40) = v18;

    v21 = [(NPKProtoCreateFidoKeyResponse *)v7 hasErrorData];
    if (v21)
    {
      v1 = [(NPKProtoCreateFidoKeyResponse *)v7 errorData];
      v22 = objc_opt_class();
      v23 = NPKSecureUnarchiveObject(v1, v22);
    }

    else
    {
      v23 = 0;
    }

    objc_storeStrong((*(*(a1 + 88) + 8) + 40), v23);
    if (v21)
    {
    }
  }

  else
  {
    v24 = pk_Payment_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

    if (v25)
    {
      v26 = pk_Payment_log();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
      {
        v27[0] = 0;
        _os_log_impl(&dword_25B300000, v26, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v27, 2u);
      }
    }
  }
}

- (void)checkFidoKeyPresenceForRelyingParty:(id)party relyingPartyAccountHash:(id)hash fidoKeyHash:(id)keyHash completion:(id)completion
{
  partyCopy = party;
  hashCopy = hash;
  keyHashCopy = keyHash;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isUnifiedAccessProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __128__NPKPaymentWebServiceCompanionTargetDevice_checkFidoKeyPresenceForRelyingParty_relyingPartyAccountHash_fidoKeyHash_completion___block_invoke;
    block[3] = &unk_27994A730;
    v20 = partyCopy;
    v21 = hashCopy;
    v22 = keyHashCopy;
    selfCopy = self;
    v24 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        *v18 = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support unified access provisioning.", v18, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __128__NPKPaymentWebServiceCompanionTargetDevice_checkFidoKeyPresenceForRelyingParty_relyingPartyAccountHash_fidoKeyHash_completion___block_invoke(uint64_t a1)
{
  v41 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = *(a1 + 48);
      v8 = _Block_copy(*(a1 + 64));
      *buf = 138413058;
      v34 = v5;
      v35 = 2112;
      v36 = v6;
      v37 = 2112;
      v38 = v7;
      v39 = 2112;
      v40 = v8;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target check fido key presence for relayingParty %@ accountHash %@ fidoKeyHash %@ completion %@", buf, 0x2Au);
    }
  }

  v9 = objc_alloc_init(NPKProtoCheckFidoKeyPresenceRequest);
  [(NPKProtoCheckFidoKeyPresenceRequest *)v9 setRelyingParty:*(a1 + 32)];
  [(NPKProtoCheckFidoKeyPresenceRequest *)v9 setRelyingPartyAccountHash:*(a1 + 40)];
  [(NPKProtoCheckFidoKeyPresenceRequest *)v9 setFidoKeyHash:*(a1 + 48)];
  v10 = objc_alloc(MEMORY[0x277D189F0]);
  v11 = [(NPKProtoCheckFidoKeyPresenceRequest *)v9 data];
  v12 = [v10 initWithProtobufData:v11 type:96 isResponse:0];

  v13 = *(a1 + 56);
  v31 = *MEMORY[0x277D185D0];
  v32 = MEMORY[0x277CBEC38];
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v32 forKeys:&v31 count:1];
  v15 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v14];

  if (v15)
  {
    v16 = *(a1 + 64);
    if (v16)
    {
      v17 = _Block_copy(v16);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __128__NPKPaymentWebServiceCompanionTargetDevice_checkFidoKeyPresenceForRelyingParty_relyingPartyAccountHash_fidoKeyHash_completion___block_invoke_841;
      aBlock[3] = &unk_279945218;
      v30 = *(a1 + 64);
      v18 = _Block_copy(aBlock);
      v19 = *(a1 + 56);
      v20 = _Block_copy(v17);
      [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:v18];

LABEL_15:
      goto LABEL_16;
    }

    v26 = pk_Payment_log();
    v27 = os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT);

    if (v27)
    {
      v17 = pk_Payment_log();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v34 = v15;
      v23 = "Warning: No response expected for message with identifier %@";
      v24 = v17;
      v25 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_14;
    }
  }

  else
  {
    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

    if (v22)
    {
      v17 = pk_Payment_log();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v34 = v12;
      v23 = "Error: No message identifier for protobuf %@";
      v24 = v17;
      v25 = OS_LOG_TYPE_ERROR;
LABEL_14:
      _os_log_impl(&dword_25B300000, v24, v25, v23, buf, 0xCu);
      goto LABEL_15;
    }
  }

LABEL_16:

  v28 = *MEMORY[0x277D85DE8];
}

void __128__NPKPaymentWebServiceCompanionTargetDevice_checkFidoKeyPresenceForRelyingParty_relyingPartyAccountHash_fidoKeyHash_completion___block_invoke_841(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)checkFidoKeyResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target checkFidoKeyResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __66__NPKPaymentWebServiceCompanionTargetDevice_checkFidoKeyResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __66__NPKPaymentWebServiceCompanionTargetDevice_checkFidoKeyResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoCheckFidoKeyPresenceResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoCheckFidoKeyPresenceResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoCheckFidoKeyPresenceResponse *)v6 keyExists];
  }

  else
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)signWithFidoKeyForRelyingParty:(id)party relyingPartyAccountHash:(id)hash fidoKeyHash:(id)keyHash challenge:(id)challenge publicKeyIdentifier:(id)identifier externalizedAuth:(id)auth completion:(id)completion
{
  v50[2] = *MEMORY[0x277D85DE8];
  partyCopy = party;
  hashCopy = hash;
  keyHashCopy = keyHash;
  challengeCopy = challenge;
  identifierCopy = identifier;
  authCopy = auth;
  completionCopy = completion;
  v38 = challengeCopy;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isUnifiedAccessProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __170__NPKPaymentWebServiceCompanionTargetDevice_signWithFidoKeyForRelyingParty_relyingPartyAccountHash_fidoKeyHash_challenge_publicKeyIdentifier_externalizedAuth_completion___block_invoke;
    block[3] = &unk_27994A758;
    v41 = partyCopy;
    v42 = hashCopy;
    v43 = keyHashCopy;
    v44 = challengeCopy;
    v45 = identifierCopy;
    v46 = authCopy;
    selfCopy = self;
    v48 = completionCopy;
    dispatch_sync(internalQueue, block);

    v23 = v41;
LABEL_9:

    goto LABEL_10;
  }

  v24 = partyCopy;
  v25 = pk_Payment_log();
  v26 = os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT);

  if (v26)
  {
    v27 = pk_Payment_log();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v27, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support unified access provisioning.", buf, 2u);
    }
  }

  partyCopy = v24;
  if (completionCopy)
  {
    v35 = MEMORY[0x277CCA9B8];
    v34 = *MEMORY[0x277D385D8];
    v49[0] = *MEMORY[0x277CCA470];
    v36 = keyHashCopy;
    v28 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v37 = hashCopy;
    v29 = [v28 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_TITLE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v50[0] = v29;
    v49[1] = *MEMORY[0x277CCA498];
    v30 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v31 = [v30 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v50[1] = v31;
    v32 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v50 forKeys:v49 count:2];
    v23 = [v35 errorWithDomain:v34 code:4 userInfo:v32];

    hashCopy = v37;
    keyHashCopy = v36;

    partyCopy = v24;
    (*(completionCopy + 2))(completionCopy, 0, v23);
    goto LABEL_9;
  }

LABEL_10:

  v33 = *MEMORY[0x277D85DE8];
}

void __170__NPKPaymentWebServiceCompanionTargetDevice_signWithFidoKeyForRelyingParty_relyingPartyAccountHash_fidoKeyHash_challenge_publicKeyIdentifier_externalizedAuth_completion___block_invoke(uint64_t a1)
{
  v50 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = *(a1 + 48);
      v8 = *(a1 + 56);
      v9 = *(a1 + 64);
      v10 = *(a1 + 72);
      v11 = _Block_copy(*(a1 + 88));
      *buf = 138413826;
      v37 = v5;
      v38 = 2112;
      v39 = v6;
      v40 = 2112;
      v41 = v7;
      v42 = 2112;
      v43 = v8;
      v44 = 2112;
      v45 = v9;
      v46 = 2112;
      v47 = v10;
      v48 = 2112;
      v49 = v11;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target sign with fido key for relaying party %@ accountHash %@ fidoKeyHash %@ challenge %@ publicKeyIdentifier %@ externalizedAuth %@ completion %@", buf, 0x48u);
    }
  }

  v12 = objc_alloc_init(NPKProtoSignWithFidoKeyRequest);
  [(NPKProtoSignWithFidoKeyRequest *)v12 setRelyingParty:*(a1 + 32)];
  [(NPKProtoSignWithFidoKeyRequest *)v12 setRelyingPartyAccountHash:*(a1 + 40)];
  [(NPKProtoSignWithFidoKeyRequest *)v12 setFidoKeyHash:*(a1 + 48)];
  [(NPKProtoSignWithFidoKeyRequest *)v12 setChallenge:*(a1 + 56)];
  [(NPKProtoSignWithFidoKeyRequest *)v12 setPublicKeyIdentifier:*(a1 + 64)];
  [(NPKProtoSignWithFidoKeyRequest *)v12 setExternalizedAuth:*(a1 + 72)];
  v13 = objc_alloc(MEMORY[0x277D189F0]);
  v14 = [(NPKProtoSignWithFidoKeyRequest *)v12 data];
  v15 = [v13 initWithProtobufData:v14 type:97 isResponse:0];

  v16 = *(a1 + 80);
  v34 = *MEMORY[0x277D18650];
  v35 = &unk_286CE7808;
  v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v35 forKeys:&v34 count:1];
  v18 = [v16 _sendProtobuf:v15 responseExpected:1 extraOptions:v17];

  if (v18)
  {
    v19 = *(a1 + 88);
    if (v19)
    {
      v20 = _Block_copy(v19);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __170__NPKPaymentWebServiceCompanionTargetDevice_signWithFidoKeyForRelyingParty_relyingPartyAccountHash_fidoKeyHash_challenge_publicKeyIdentifier_externalizedAuth_completion___block_invoke_844;
      aBlock[3] = &unk_279945218;
      v33 = *(a1 + 88);
      v21 = _Block_copy(aBlock);
      v22 = *(a1 + 80);
      v23 = _Block_copy(v20);
      [v22 _trackOutstandingRequestWithMessageIdentifier:v18 completionHandler:v23 errorHandler:v21];

LABEL_15:
      goto LABEL_16;
    }

    v29 = pk_Payment_log();
    v30 = os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT);

    if (v30)
    {
      v20 = pk_Payment_log();
      if (!os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v37 = v18;
      v26 = "Warning: No response expected for message with identifier %@";
      v27 = v20;
      v28 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_14;
    }
  }

  else
  {
    v24 = pk_Payment_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_ERROR);

    if (v25)
    {
      v20 = pk_Payment_log();
      if (!os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v37 = v15;
      v26 = "Error: No message identifier for protobuf %@";
      v27 = v20;
      v28 = OS_LOG_TYPE_ERROR;
LABEL_14:
      _os_log_impl(&dword_25B300000, v27, v28, v26, buf, 0xCu);
      goto LABEL_15;
    }
  }

LABEL_16:

  v31 = *MEMORY[0x277D85DE8];
}

void __170__NPKPaymentWebServiceCompanionTargetDevice_signWithFidoKeyForRelyingParty_relyingPartyAccountHash_fidoKeyHash_challenge_publicKeyIdentifier_externalizedAuth_completion___block_invoke_844(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)signWithFidoKeyResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target signWithFidoKeyResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __69__NPKPaymentWebServiceCompanionTargetDevice_signWithFidoKeyResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __69__NPKPaymentWebServiceCompanionTargetDevice_signWithFidoKeyResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoSignWithFidoKeyResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoSignWithFidoKeyResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoSignWithFidoKeyResponse *)v7 fidoAttestation];
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    v15 = [(NPKProtoSignWithFidoKeyResponse *)v7 hasErrorData];
    if (v15)
    {
      v1 = [(NPKProtoSignWithFidoKeyResponse *)v7 errorData];
      v16 = objc_opt_class();
      v17 = NPKSecureUnarchiveObject(v1, v16);
    }

    else
    {
      v17 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
    if (v15)
    {
    }
  }

  else
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

    if (v19)
    {
      v20 = pk_Payment_log();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)generateISOEncryptionCertificateForSubCredentialId:(id)id completion:(id)completion
{
  v27[2] = *MEMORY[0x277D85DE8];
  idCopy = id;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isUnifiedAccessProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_generateISOEncryptionCertificateForSubCredentialId_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v23 = idCopy;
    selfCopy = self;
    v25 = completionCopy;
    dispatch_sync(internalQueue, block);

    v9 = v23;
LABEL_9:

    goto LABEL_10;
  }

  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *v21 = 0;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support unified access provisioning.", v21, 2u);
    }
  }

  if (completionCopy)
  {
    v13 = MEMORY[0x277CCA9B8];
    v14 = *MEMORY[0x277D385D8];
    v26[0] = *MEMORY[0x277CCA470];
    v15 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v16 = [v15 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_TITLE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v27[0] = v16;
    v26[1] = *MEMORY[0x277CCA498];
    v17 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v18 = [v17 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v27[1] = v18;
    v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:v26 count:2];
    v9 = [v13 errorWithDomain:v14 code:4 userInfo:v19];

    (*(completionCopy + 2))(completionCopy, 0, 0, v9);
    goto LABEL_9;
  }

LABEL_10:

  v20 = *MEMORY[0x277D85DE8];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_generateISOEncryptionCertificateForSubCredentialId_completion___block_invoke(uint64_t a1)
{
  v35 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138412546;
      v32 = v5;
      v33 = 2112;
      v34 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target generate ISO encryption certificate for subcredential ID %@ completion %@", buf, 0x16u);
    }
  }

  v7 = objc_alloc_init(NPKProtoGenerateISOEncryptionCertificateForSubCredentialIdRequest);
  [(NPKProtoGenerateISOEncryptionCertificateForSubCredentialIdRequest *)v7 setSubCredentialId:*(a1 + 32)];
  v8 = objc_alloc(MEMORY[0x277D189F0]);
  v9 = [(NPKProtoGenerateISOEncryptionCertificateForSubCredentialIdRequest *)v7 data];
  v10 = [v8 initWithProtobufData:v9 type:98 isResponse:0];

  v11 = *(a1 + 40);
  v29 = *MEMORY[0x277D185D0];
  v30 = MEMORY[0x277CBEC38];
  v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v30 forKeys:&v29 count:1];
  v13 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v12];

  if (v13)
  {
    v14 = *(a1 + 48);
    if (v14)
    {
      v15 = _Block_copy(v14);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_generateISOEncryptionCertificateForSubCredentialId_completion___block_invoke_847;
      aBlock[3] = &unk_279945218;
      v28 = *(a1 + 48);
      v16 = _Block_copy(aBlock);
      v17 = *(a1 + 40);
      v18 = _Block_copy(v15);
      [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_15:
      goto LABEL_16;
    }

    v24 = pk_Payment_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

    if (v25)
    {
      v15 = pk_Payment_log();
      if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v32 = v13;
      v21 = "Warning: No response expected for message with identifier %@";
      v22 = v15;
      v23 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_14;
    }
  }

  else
  {
    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

    if (v20)
    {
      v15 = pk_Payment_log();
      if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v32 = v10;
      v21 = "Error: No message identifier for protobuf %@";
      v22 = v15;
      v23 = OS_LOG_TYPE_ERROR;
LABEL_14:
      _os_log_impl(&dword_25B300000, v22, v23, v21, buf, 0xCu);
      goto LABEL_15;
    }
  }

LABEL_16:

  v26 = *MEMORY[0x277D85DE8];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_generateISOEncryptionCertificateForSubCredentialId_completion___block_invoke_847(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)generateISOEncryptionCertificateForSubCredentialIdResponse:(id)response
{
  v48 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target generateISOEncryptionCertificateForSubCredentialIdResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v44 = 0x3032000000;
  v45 = __Block_byref_object_copy__384;
  v46 = __Block_byref_object_dispose__385;
  v47 = 0;
  v37 = 0;
  v38 = &v37;
  v39 = 0x3032000000;
  v40 = __Block_byref_object_copy__22;
  v41 = __Block_byref_object_dispose__22;
  v42 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x3032000000;
  v34 = __Block_byref_object_copy__22;
  v35 = __Block_byref_object_dispose__22;
  v36 = 0;
  v25 = 0;
  v26 = &v25;
  v27 = 0x3032000000;
  v28 = __Block_byref_object_copy__22;
  v29 = __Block_byref_object_dispose__22;
  v30 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __104__NPKPaymentWebServiceCompanionTargetDevice_generateISOEncryptionCertificateForSubCredentialIdResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v37;
    v23 = &v31;
    v24 = &v25;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v38[5], v32[5], v26[5]);
  }

  _Block_object_dispose(&v25, 8);

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v37, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __104__NPKPaymentWebServiceCompanionTargetDevice_generateISOEncryptionCertificateForSubCredentialIdResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoGenerateISOEncryptionCertificateForSubCredentialIdResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoGenerateISOEncryptionCertificateForSubCredentialIdResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoGenerateISOEncryptionCertificateForSubCredentialIdResponse *)v7 attestations];
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    v15 = [(NPKProtoGenerateISOEncryptionCertificateForSubCredentialIdResponse *)v7 authorization];
    v16 = *(*(a1 + 72) + 8);
    v17 = *(v16 + 40);
    *(v16 + 40) = v15;

    v18 = [(NPKProtoGenerateISOEncryptionCertificateForSubCredentialIdResponse *)v7 hasErrorData];
    if (v18)
    {
      v1 = [(NPKProtoGenerateISOEncryptionCertificateForSubCredentialIdResponse *)v7 errorData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v1, v19);
    }

    else
    {
      v20 = 0;
    }

    objc_storeStrong((*(*(a1 + 80) + 8) + 40), v20);
    if (v18)
    {
    }
  }

  else
  {
    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT);

    if (v22)
    {
      v23 = pk_Payment_log();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT))
      {
        v24[0] = 0;
        _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v24, 2u);
      }
    }
  }
}

- (void)requestAndStoreExternalizedAuthWithCompletion:(id)completion
{
  v22[2] = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isUnifiedAccessProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_requestAndStoreExternalizedAuthWithCompletion___block_invoke;
    block[3] = &unk_279946670;
    block[4] = self;
    v20 = completionCopy;
    dispatch_sync(internalQueue, block);

    v6 = v20;
LABEL_9:

    goto LABEL_10;
  }

  v7 = pk_Payment_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      *v18 = 0;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support unified access provisioning.", v18, 2u);
    }
  }

  if (completionCopy)
  {
    v10 = MEMORY[0x277CCA9B8];
    v11 = *MEMORY[0x277D385D8];
    v21[0] = *MEMORY[0x277CCA470];
    v12 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v13 = [v12 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_TITLE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v22[0] = v13;
    v21[1] = *MEMORY[0x277CCA498];
    v14 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v15 = [v14 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v22[1] = v15;
    v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v22 forKeys:v21 count:2];
    v6 = [v10 errorWithDomain:v11 code:4 userInfo:v16];

    (*(completionCopy + 2))(completionCopy, v6);
    goto LABEL_9;
  }

LABEL_10:

  v17 = *MEMORY[0x277D85DE8];
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_requestAndStoreExternalizedAuthWithCompletion___block_invoke(uint64_t a1)
{
  v32 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = _Block_copy(*(a1 + 40));
      *buf = 138412290;
      v31 = v5;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target request and store externalized auth with completion %@", buf, 0xCu);
    }
  }

  v6 = objc_alloc_init(NPKProtoFidoExternalizedAuthRequest);
  v7 = objc_alloc(MEMORY[0x277D189F0]);
  v8 = [(NPKProtoFidoExternalizedAuthRequest *)v6 data];
  v9 = [v7 initWithProtobufData:v8 type:99 isResponse:0];

  v10 = *(a1 + 32);
  v28 = *MEMORY[0x277D185D0];
  v29 = MEMORY[0x277CBEC38];
  v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v29 forKeys:&v28 count:1];
  v12 = [v10 _sendProtobuf:v9 responseExpected:1 extraOptions:v11];

  if (v12)
  {
    v13 = *(a1 + 40);
    if (v13)
    {
      v14 = _Block_copy(v13);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_requestAndStoreExternalizedAuthWithCompletion___block_invoke_850;
      aBlock[3] = &unk_279945218;
      v27 = *(a1 + 40);
      v15 = _Block_copy(aBlock);
      v16 = *(a1 + 32);
      v17 = _Block_copy(v14);
      [v16 _trackOutstandingRequestWithMessageIdentifier:v12 completionHandler:v17 errorHandler:v15];

LABEL_15:
      goto LABEL_16;
    }

    v23 = pk_Payment_log();
    v24 = os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT);

    if (v24)
    {
      v14 = pk_Payment_log();
      if (!os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v31 = v12;
      v20 = "Warning: No response expected for message with identifier %@";
      v21 = v14;
      v22 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_14;
    }
  }

  else
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_ERROR);

    if (v19)
    {
      v14 = pk_Payment_log();
      if (!os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v31 = v9;
      v20 = "Error: No message identifier for protobuf %@";
      v21 = v14;
      v22 = OS_LOG_TYPE_ERROR;
LABEL_14:
      _os_log_impl(&dword_25B300000, v21, v22, v20, buf, 0xCu);
      goto LABEL_15;
    }
  }

LABEL_16:

  v25 = *MEMORY[0x277D85DE8];
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_requestAndStoreExternalizedAuthWithCompletion___block_invoke_850(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)requestAndStoreExternalizedAuthWithCompletionResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target requestAndStoreExternalizedAuthWithCompletionResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_requestAndStoreExternalizedAuthWithCompletionResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __99__NPKPaymentWebServiceCompanionTargetDevice_requestAndStoreExternalizedAuthWithCompletionResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoFidoExternalizedAuthResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoFidoExternalizedAuthResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoFidoExternalizedAuthResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoFidoExternalizedAuthResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service generateTransactionKeyWithParameters:(id)parameters withCompletion:(id)completion
{
  v28[2] = *MEMORY[0x277D85DE8];
  parametersCopy = parameters;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isUnifiedAccessProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_generateTransactionKeyWithParameters_withCompletion___block_invoke;
    block[3] = &unk_27994A1C0;
    v24 = parametersCopy;
    selfCopy = self;
    v26 = completionCopy;
    dispatch_sync(internalQueue, block);

    v10 = v24;
LABEL_9:

    goto LABEL_10;
  }

  v11 = pk_Payment_log();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

  if (v12)
  {
    v13 = pk_Payment_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *v22 = 0;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support unified access provisioning.", v22, 2u);
    }
  }

  if (completionCopy)
  {
    v14 = MEMORY[0x277CCA9B8];
    v15 = *MEMORY[0x277D385D8];
    v27[0] = *MEMORY[0x277CCA470];
    v16 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v17 = [v16 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_TITLE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v28[0] = v17;
    v27[1] = *MEMORY[0x277CCA498];
    v18 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v19 = [v18 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v28[1] = v19;
    v20 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];
    v10 = [v14 errorWithDomain:v15 code:4 userInfo:v20];

    (*(completionCopy + 2))(completionCopy, 0, 0, 0, v10);
    goto LABEL_9;
  }

LABEL_10:

  v21 = *MEMORY[0x277D85DE8];
}

void __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_generateTransactionKeyWithParameters_withCompletion___block_invoke(uint64_t a1)
{
  v36 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138412546;
      v33 = v5;
      v34 = 2112;
      v35 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target generate transaction key with parameters %@ completion %@", buf, 0x16u);
    }
  }

  v7 = objc_alloc_init(NPKProtoGenerateTransactionKeyWithParametersRequest);
  v8 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:*(a1 + 32) requiringSecureCoding:1 error:0];
  [(NPKProtoGenerateTransactionKeyWithParametersRequest *)v7 setParameters:v8];
  v9 = objc_alloc(MEMORY[0x277D189F0]);
  v10 = [(NPKProtoGenerateTransactionKeyWithParametersRequest *)v7 data];
  v11 = [v9 initWithProtobufData:v10 type:100 isResponse:0];

  v12 = *(a1 + 40);
  v30 = *MEMORY[0x277D18650];
  v31 = &unk_286CE7808;
  v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v31 forKeys:&v30 count:1];
  v14 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v13];

  if (v14)
  {
    v15 = *(a1 + 48);
    if (v15)
    {
      v16 = _Block_copy(v15);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_generateTransactionKeyWithParameters_withCompletion___block_invoke_854;
      aBlock[3] = &unk_279945218;
      v29 = *(a1 + 48);
      v17 = _Block_copy(aBlock);
      v18 = *(a1 + 40);
      v19 = _Block_copy(v16);
      [v18 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v19 errorHandler:v17];

LABEL_15:
      goto LABEL_16;
    }

    v25 = pk_Payment_log();
    v26 = os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT);

    if (v26)
    {
      v16 = pk_Payment_log();
      if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v33 = v14;
      v22 = "Warning: No response expected for message with identifier %@";
      v23 = v16;
      v24 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_14;
    }
  }

  else
  {
    v20 = pk_Payment_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

    if (v21)
    {
      v16 = pk_Payment_log();
      if (!os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v33 = v11;
      v22 = "Error: No message identifier for protobuf %@";
      v23 = v16;
      v24 = OS_LOG_TYPE_ERROR;
LABEL_14:
      _os_log_impl(&dword_25B300000, v23, v24, v22, buf, 0xCu);
      goto LABEL_15;
    }
  }

LABEL_16:

  v27 = *MEMORY[0x277D85DE8];
}

void __115__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_generateTransactionKeyWithParameters_withCompletion___block_invoke_854(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, 0, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)generateTransactionKeyWithParametersResponse:(id)response
{
  v55 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target generateTransactionKeyWithParametersResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v51 = 0x3032000000;
  v52 = __Block_byref_object_copy__384;
  v53 = __Block_byref_object_dispose__385;
  v54 = 0;
  v44 = 0;
  v45 = &v44;
  v46 = 0x3032000000;
  v47 = __Block_byref_object_copy__22;
  v48 = __Block_byref_object_dispose__22;
  v49 = 0;
  v38 = 0;
  v39 = &v38;
  v40 = 0x3032000000;
  v41 = __Block_byref_object_copy__22;
  v42 = __Block_byref_object_dispose__22;
  v43 = 0;
  v32 = 0;
  v33 = &v32;
  v34 = 0x3032000000;
  v35 = __Block_byref_object_copy__22;
  v36 = __Block_byref_object_dispose__22;
  v37 = 0;
  v26 = 0;
  v27 = &v26;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__22;
  v30 = __Block_byref_object_dispose__22;
  v31 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_generateTransactionKeyWithParametersResponse___block_invoke;
    block[3] = &unk_27994A080;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v44;
    v23 = &v38;
    v24 = &v32;
    v25 = &v26;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v45[5], v39[5], v33[5], v27[5]);
  }

  _Block_object_dispose(&v26, 8);

  _Block_object_dispose(&v32, 8);
  _Block_object_dispose(&v38, 8);

  _Block_object_dispose(&v44, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_generateTransactionKeyWithParametersResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoGenerateTransactionKeyWithParametersResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoGenerateTransactionKeyWithParametersResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoGenerateTransactionKeyWithParametersResponse *)v7 transactionKeyIdentifier];
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    v15 = [(NPKProtoGenerateTransactionKeyWithParametersResponse *)v7 transactionKeyCertChains];
    v16 = *(*(a1 + 72) + 8);
    v17 = *(v16 + 40);
    *(v16 + 40) = v15;

    v18 = [(NPKProtoGenerateTransactionKeyWithParametersResponse *)v7 appletIdentifier];
    v19 = *(*(a1 + 80) + 8);
    v20 = *(v19 + 40);
    *(v19 + 40) = v18;

    v21 = [(NPKProtoGenerateTransactionKeyWithParametersResponse *)v7 hasErrorData];
    if (v21)
    {
      v1 = [(NPKProtoGenerateTransactionKeyWithParametersResponse *)v7 errorData];
      v22 = objc_opt_class();
      v23 = NPKSecureUnarchiveObject(v1, v22);
    }

    else
    {
      v23 = 0;
    }

    objc_storeStrong((*(*(a1 + 88) + 8) + 40), v23);
    if (v21)
    {
    }
  }

  else
  {
    v24 = pk_Payment_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

    if (v25)
    {
      v26 = pk_Payment_log();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
      {
        v27[0] = 0;
        _os_log_impl(&dword_25B300000, v26, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v27, 2u);
      }
    }
  }
}

- (void)generateSEEncryptionCertificateForSubCredentialId:(id)id completion:(id)completion
{
  v27[2] = *MEMORY[0x277D85DE8];
  idCopy = id;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isUnifiedAccessProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_generateSEEncryptionCertificateForSubCredentialId_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v23 = idCopy;
    selfCopy = self;
    v25 = completionCopy;
    dispatch_sync(internalQueue, block);

    v9 = v23;
LABEL_9:

    goto LABEL_10;
  }

  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *v21 = 0;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support unified access provisioning.", v21, 2u);
    }
  }

  if (completionCopy)
  {
    v13 = MEMORY[0x277CCA9B8];
    v14 = *MEMORY[0x277D385D8];
    v26[0] = *MEMORY[0x277CCA470];
    v15 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v16 = [v15 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_TITLE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v27[0] = v16;
    v26[1] = *MEMORY[0x277CCA498];
    v17 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v18 = [v17 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v27[1] = v18;
    v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:v26 count:2];
    v9 = [v13 errorWithDomain:v14 code:4 userInfo:v19];

    (*(completionCopy + 2))(completionCopy, 0, v9);
    goto LABEL_9;
  }

LABEL_10:

  v20 = *MEMORY[0x277D85DE8];
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_generateSEEncryptionCertificateForSubCredentialId_completion___block_invoke(uint64_t a1)
{
  v35 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138412546;
      v32 = v5;
      v33 = 2112;
      v34 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target generate SE encryption certificate for subcredential ID %@ completion %@", buf, 0x16u);
    }
  }

  v7 = objc_alloc_init(NPKProtoGenerateSEEncryptionCertificateForSubCredentialIdRequest);
  [(NPKProtoGenerateSEEncryptionCertificateForSubCredentialIdRequest *)v7 setSubCredentialId:*(a1 + 32)];
  v8 = objc_alloc(MEMORY[0x277D189F0]);
  v9 = [(NPKProtoGenerateSEEncryptionCertificateForSubCredentialIdRequest *)v7 data];
  v10 = [v8 initWithProtobufData:v9 type:101 isResponse:0];

  v11 = *(a1 + 40);
  v29 = *MEMORY[0x277D185D0];
  v30 = MEMORY[0x277CBEC38];
  v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v30 forKeys:&v29 count:1];
  v13 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v12];

  if (v13)
  {
    v14 = *(a1 + 48);
    if (v14)
    {
      v15 = _Block_copy(v14);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __106__NPKPaymentWebServiceCompanionTargetDevice_generateSEEncryptionCertificateForSubCredentialId_completion___block_invoke_857;
      aBlock[3] = &unk_279945218;
      v28 = *(a1 + 48);
      v16 = _Block_copy(aBlock);
      v17 = *(a1 + 40);
      v18 = _Block_copy(v15);
      [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_15:
      goto LABEL_16;
    }

    v24 = pk_Payment_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

    if (v25)
    {
      v15 = pk_Payment_log();
      if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v32 = v13;
      v21 = "Warning: No response expected for message with identifier %@";
      v22 = v15;
      v23 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_14;
    }
  }

  else
  {
    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

    if (v20)
    {
      v15 = pk_Payment_log();
      if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v32 = v10;
      v21 = "Error: No message identifier for protobuf %@";
      v22 = v15;
      v23 = OS_LOG_TYPE_ERROR;
LABEL_14:
      _os_log_impl(&dword_25B300000, v22, v23, v21, buf, 0xCu);
      goto LABEL_15;
    }
  }

LABEL_16:

  v26 = *MEMORY[0x277D85DE8];
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_generateSEEncryptionCertificateForSubCredentialId_completion___block_invoke_857(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)generateSEEncryptionCertificateForSubCredentialIdResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target generateSEEncryptionCertificateForSubCredentialIdResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __103__NPKPaymentWebServiceCompanionTargetDevice_generateSEEncryptionCertificateForSubCredentialIdResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __103__NPKPaymentWebServiceCompanionTargetDevice_generateSEEncryptionCertificateForSubCredentialIdResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoGenerateSEEncryptionCertificateForSubCredentialIdResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoGenerateSEEncryptionCertificateForSubCredentialIdResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoGenerateSEEncryptionCertificateForSubCredentialIdResponse *)v7 certificate];
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    v15 = [(NPKProtoGenerateSEEncryptionCertificateForSubCredentialIdResponse *)v7 hasErrorData];
    if (v15)
    {
      v1 = [(NPKProtoGenerateSEEncryptionCertificateForSubCredentialIdResponse *)v7 errorData];
      v16 = objc_opt_class();
      v17 = NPKSecureUnarchiveObject(v1, v16);
    }

    else
    {
      v17 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
    if (v15)
    {
    }
  }

  else
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

    if (v19)
    {
      v20 = pk_Payment_log();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)deleteKeyMaterialForSubCredentialId:(id)id
{
  idCopy = id;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isUnifiedAccessProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __81__NPKPaymentWebServiceCompanionTargetDevice_deleteKeyMaterialForSubCredentialId___block_invoke;
    block[3] = &unk_2799454E0;
    v11 = idCopy;
    selfCopy = self;
    dispatch_sync(internalQueue, block);

    v6 = v11;
  }

  else
  {
    v7 = pk_Payment_log();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

    if (!v8)
    {
      goto LABEL_7;
    }

    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v9 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support unified access provisioning.", v9, 2u);
    }
  }

LABEL_7:
}

void __81__NPKPaymentWebServiceCompanionTargetDevice_deleteKeyMaterialForSubCredentialId___block_invoke(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      *buf = 138412290;
      v20 = v5;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target delete key material for subcredential ID %@", buf, 0xCu);
    }
  }

  v6 = objc_alloc_init(NPKProtoDeleteKeyMaterialForSubCredentialIdRequest);
  [(NPKProtoDeleteKeyMaterialForSubCredentialIdRequest *)v6 setCredentialIdentifier:*(a1 + 32)];
  v7 = objc_alloc(MEMORY[0x277D189F0]);
  v8 = [(NPKProtoDeleteKeyMaterialForSubCredentialIdRequest *)v6 data];
  v9 = [v7 initWithProtobufData:v8 type:102 isResponse:0];

  v10 = *(a1 + 40);
  v17 = *MEMORY[0x277D185D0];
  v18 = MEMORY[0x277CBEC38];
  v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v18 forKeys:&v17 count:1];
  v12 = [v10 _sendProtobuf:v9 responseExpected:0 extraOptions:v11];

  if (!v12)
  {
    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_ERROR);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v20 = v9;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_ERROR, "Error: No message identifier for protobuf %@", buf, 0xCu);
      }
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)addISO18013Blobs:(id)blobs cardType:(int64_t)type completion:(id)completion
{
  v30[2] = *MEMORY[0x277D85DE8];
  blobsCopy = blobs;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isUnifiedAccessProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __82__NPKPaymentWebServiceCompanionTargetDevice_addISO18013Blobs_cardType_completion___block_invoke;
    block[3] = &unk_27994A780;
    v25 = blobsCopy;
    typeCopy = type;
    selfCopy = self;
    v27 = completionCopy;
    dispatch_sync(internalQueue, block);

    v11 = v25;
LABEL_9:

    goto LABEL_10;
  }

  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      *v23 = 0;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support unified access provisioning.", v23, 2u);
    }
  }

  if (completionCopy)
  {
    v15 = MEMORY[0x277CCA9B8];
    v16 = *MEMORY[0x277D385D8];
    v29[0] = *MEMORY[0x277CCA470];
    v17 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v18 = [v17 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_TITLE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v30[0] = v18;
    v29[1] = *MEMORY[0x277CCA498];
    v19 = [MEMORY[0x277CCA8D8] bundleForClass:objc_opt_class()];
    v20 = [v19 localizedStringForKey:@"UNIFIED_ACCESS_ERROR_ALERT_CANNOT_ADD_KEY_MESSAGE" value:&stru_286C934F8 table:@"NanoPassKitUI-Hydra"];
    v30[1] = v20;
    v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:v29 count:2];
    v11 = [v15 errorWithDomain:v16 code:4 userInfo:v21];

    (*(completionCopy + 2))(completionCopy, v11);
    goto LABEL_9;
  }

LABEL_10:

  v22 = *MEMORY[0x277D85DE8];
}

void __82__NPKPaymentWebServiceCompanionTargetDevice_addISO18013Blobs_cardType_completion___block_invoke(uint64_t a1)
{
  v54 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 56);
      v7 = _Block_copy(*(a1 + 48));
      *buf = 138412802;
      v49 = v5;
      v50 = 2048;
      v51 = v6;
      v52 = 2112;
      v53 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target add ISO18013 blobs %@ with card type %ld, completion %@", buf, 0x20u);
    }
  }

  v8 = objc_alloc_init(NPKProtoAddISO18013BlobsRequest);
  v9 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v10 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v41 = 0u;
  v42 = 0u;
  v43 = 0u;
  v44 = 0u;
  v11 = *(a1 + 32);
  v12 = [v11 countByEnumeratingWithState:&v41 objects:v47 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v42;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v42 != v14)
        {
          objc_enumerationMutation(v11);
        }

        v16 = *(*(&v41 + 1) + 8 * i);
        v17 = [*(a1 + 40) _secureArchiveSubcredential:v16];
        [v9 addObject:v17];

        v18 = [*(a1 + 32) objectForKey:v16];
        [v10 addObject:v18];
      }

      v13 = [v11 countByEnumeratingWithState:&v41 objects:v47 count:16];
    }

    while (v13);
  }

  [(NPKProtoAddISO18013BlobsRequest *)v8 setSubcredentialDatas:v9];
  [(NPKProtoAddISO18013BlobsRequest *)v8 setIsoblobs:v10];
  if ((*(a1 + 56) - 1) < 4)
  {
    v19 = *(a1 + 56);
  }

  else
  {
    v19 = 0;
  }

  [(NPKProtoAddISO18013BlobsRequest *)v8 setCardType:v19];
  v20 = objc_alloc(MEMORY[0x277D189F0]);
  v21 = [(NPKProtoAddISO18013BlobsRequest *)v8 data];
  v22 = [v20 initWithProtobufData:v21 type:107 isResponse:0];

  v23 = *(a1 + 40);
  v45 = *MEMORY[0x277D185D0];
  v46 = MEMORY[0x277CBEC38];
  v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v46 forKeys:&v45 count:1];
  v25 = [v23 _sendProtobuf:v22 responseExpected:1 extraOptions:v24];

  if (v25)
  {
    v26 = *(a1 + 48);
    if (v26)
    {
      v27 = _Block_copy(v26);
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __82__NPKPaymentWebServiceCompanionTargetDevice_addISO18013Blobs_cardType_completion___block_invoke_861;
      aBlock[3] = &unk_279945218;
      v40 = *(a1 + 48);
      v28 = _Block_copy(aBlock);
      v29 = *(a1 + 40);
      v30 = _Block_copy(v27);
      [v29 _trackOutstandingRequestWithMessageIdentifier:v25 completionHandler:v30 errorHandler:v28];

LABEL_25:
      goto LABEL_26;
    }

    v36 = pk_Payment_log();
    v37 = os_log_type_enabled(v36, OS_LOG_TYPE_DEFAULT);

    if (v37)
    {
      v27 = pk_Payment_log();
      if (!os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_25;
      }

      *buf = 138412290;
      v49 = v25;
      v33 = "Warning: No response expected for message with identifier %@";
      v34 = v27;
      v35 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_24;
    }
  }

  else
  {
    v31 = pk_Payment_log();
    v32 = os_log_type_enabled(v31, OS_LOG_TYPE_ERROR);

    if (v32)
    {
      v27 = pk_Payment_log();
      if (!os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_25;
      }

      *buf = 138412290;
      v49 = v22;
      v33 = "Error: No message identifier for protobuf %@";
      v34 = v27;
      v35 = OS_LOG_TYPE_ERROR;
LABEL_24:
      _os_log_impl(&dword_25B300000, v34, v35, v33, buf, 0xCu);
      goto LABEL_25;
    }
  }

LABEL_26:

  v38 = *MEMORY[0x277D85DE8];
}

void __82__NPKPaymentWebServiceCompanionTargetDevice_addISO18013Blobs_cardType_completion___block_invoke_861(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)addISO18013BlobsResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target addISO18013BlobsResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__NPKPaymentWebServiceCompanionTargetDevice_addISO18013BlobsResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __70__NPKPaymentWebServiceCompanionTargetDevice_addISO18013BlobsResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoAddISO18013BlobsResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoAddISO18013BlobsResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoAddISO18013BlobsResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoAddISO18013BlobsResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (BOOL)areUnifiedAccessPassesSupported
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"BA0452A1-075E-4E13-B48F-E36DF2F88980"];
  v4 = [v2 supportsCapability:v3];

  return v4;
}

- (void)longTermPrivacyKeyForCredentialGroupIdentifier:(id)identifier reuseExisting:(BOOL)existing completion:(id)completion
{
  identifierCopy = identifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __117__NPKPaymentWebServiceCompanionTargetDevice_longTermPrivacyKeyForCredentialGroupIdentifier_reuseExisting_completion___block_invoke;
    block[3] = &unk_27994A7A8;
    v17 = identifierCopy;
    existingCopy = existing;
    selfCopy = self;
    v19 = completionCopy;
    dispatch_sync(internalQueue, block);

    v11 = v17;
LABEL_9:

    goto LABEL_10;
  }

  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      *v15 = 0;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v15, 2u);
    }
  }

  if (completionCopy)
  {
    v11 = PKDisplayableErrorForCommonType();
    (*(completionCopy + 2))(completionCopy, 0, v11);
    goto LABEL_9;
  }

LABEL_10:
}

void __117__NPKPaymentWebServiceCompanionTargetDevice_longTermPrivacyKeyForCredentialGroupIdentifier_reuseExisting_completion___block_invoke(uint64_t a1)
{
  v41 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      if (*(a1 + 56))
      {
        v6 = @"YES";
      }

      else
      {
        v6 = @"NO";
      }

      v7 = _Block_copy(*(a1 + 48));
      *buf = 138412802;
      v36 = v5;
      v37 = 2112;
      v38 = v6;
      v39 = 2112;
      v40 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request for long term privacy key for credential with group identifier: %@, reuseExisting: %@, completion: %@", buf, 0x20u);
    }
  }

  if (*(a1 + 32))
  {
    v8 = objc_alloc_init(NPKProtoLongTermPrivacyKeyRequest);
    [(NPKProtoLongTermPrivacyKeyRequest *)v8 setCredentialGroupIdentifier:*(a1 + 32)];
    [(NPKProtoLongTermPrivacyKeyRequest *)v8 setReuseExisting:*(a1 + 56)];
    v9 = objc_alloc(MEMORY[0x277D189F0]);
    v10 = [(NPKProtoLongTermPrivacyKeyRequest *)v8 data];
    v11 = [v9 initWithProtobufData:v10 type:110 isResponse:0];

    v12 = *(a1 + 40);
    v33 = *MEMORY[0x277D18650];
    v34 = &unk_286CE7808;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v34 forKeys:&v33 count:1];
    v14 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v13];

    if (v14)
    {
      v15 = *(a1 + 48);
      if (v15)
      {
        v16 = _Block_copy(v15);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __117__NPKPaymentWebServiceCompanionTargetDevice_longTermPrivacyKeyForCredentialGroupIdentifier_reuseExisting_completion___block_invoke_867;
        aBlock[3] = &unk_279945218;
        v32 = *(a1 + 48);
        v17 = _Block_copy(aBlock);
        v18 = *(a1 + 40);
        v19 = _Block_copy(v16);
        [v18 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v19 errorHandler:v17];

LABEL_25:
        goto LABEL_26;
      }

      v28 = pk_Payment_log();
      v29 = os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT);

      if (v29)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_25;
        }

        *buf = 138412290;
        v36 = v14;
        v25 = "Warning: No response expected for message with identifier %@";
        v26 = v16;
        v27 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_24;
      }
    }

    else
    {
      v23 = pk_Payment_log();
      v24 = os_log_type_enabled(v23, OS_LOG_TYPE_ERROR);

      if (v24)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_25;
        }

        *buf = 138412290;
        v36 = v11;
        v25 = "Error: No message identifier for protobuf %@";
        v26 = v16;
        v27 = OS_LOG_TYPE_ERROR;
LABEL_24:
        _os_log_impl(&dword_25B300000, v26, v27, v25, buf, 0xCu);
        goto LABEL_25;
      }
    }

LABEL_26:

    goto LABEL_27;
  }

  v20 = pk_General_log();
  v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

  if (v21)
  {
    v22 = pk_General_log();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_ERROR, "Error: Unable to access long term privacy key without specified group identifier", buf, 2u);
    }
  }

  if (*(a1 + 48))
  {
    v8 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 48) + 16))();
LABEL_27:
  }

  v30 = *MEMORY[0x277D85DE8];
}

void __117__NPKPaymentWebServiceCompanionTargetDevice_longTermPrivacyKeyForCredentialGroupIdentifier_reuseExisting_completion___block_invoke_867(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)longTermPrivacyKeyForCredentialGroupIdentifierResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target longTermPrivacyKeyForCredentialGroupIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_longTermPrivacyKeyForCredentialGroupIdentifierResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __100__NPKPaymentWebServiceCompanionTargetDevice_longTermPrivacyKeyForCredentialGroupIdentifierResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoLongTermPrivacyKeyResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoLongTermPrivacyKeyResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoLongTermPrivacyKeyResponse *)v7 keyData];
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    v15 = [(NPKProtoLongTermPrivacyKeyResponse *)v7 hasErrorData];
    if (v15)
    {
      v1 = [(NPKProtoLongTermPrivacyKeyResponse *)v7 errorData];
      v16 = objc_opt_class();
      v17 = NPKSecureUnarchiveObject(v1, v16);
    }

    else
    {
      v17 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
    if (v15)
    {
    }
  }

  else
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

    if (v19)
    {
      v20 = pk_Payment_log();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)retrieveShareInvitationForMailboxAddress:(id)address completion:(id)completion
{
  addressCopy = address;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __97__NPKPaymentWebServiceCompanionTargetDevice_retrieveShareInvitationForMailboxAddress_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v15 = addressCopy;
    selfCopy = self;
    v17 = completionCopy;
    dispatch_sync(internalQueue, block);

    v9 = v15;
LABEL_9:

    goto LABEL_10;
  }

  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *v13 = 0;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v13, 2u);
    }
  }

  if (completionCopy)
  {
    v9 = PKDisplayableErrorForCommonType();
    (*(completionCopy + 2))(completionCopy, 0, v9);
    goto LABEL_9;
  }

LABEL_10:
}

void __97__NPKPaymentWebServiceCompanionTargetDevice_retrieveShareInvitationForMailboxAddress_completion___block_invoke(uint64_t a1)
{
  v38 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138478083;
      v35 = v5;
      v36 = 2112;
      v37 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to retrieve share invitation for mailbox address: %{private}@, completion: %@", buf, 0x16u);
    }
  }

  if (*(a1 + 32))
  {
    v7 = objc_alloc_init(NPKProtoRetrieveShareInvitationForMailboxAddressRequest);
    [(NPKProtoRetrieveShareInvitationForMailboxAddressRequest *)v7 setMailboxAddress:*(a1 + 32)];
    v8 = objc_alloc(MEMORY[0x277D189F0]);
    v9 = [(NPKProtoRetrieveShareInvitationForMailboxAddressRequest *)v7 data];
    v10 = [v8 initWithProtobufData:v9 type:111 isResponse:0];

    v11 = *(a1 + 40);
    v32 = *MEMORY[0x277D18650];
    v33 = &unk_286CE7818;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v33 forKeys:&v32 count:1];
    v13 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v12 priority:300];

    if (v13)
    {
      v14 = *(a1 + 48);
      if (v14)
      {
        v15 = _Block_copy(v14);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __97__NPKPaymentWebServiceCompanionTargetDevice_retrieveShareInvitationForMailboxAddress_completion___block_invoke_870;
        aBlock[3] = &unk_279945218;
        v31 = *(a1 + 48);
        v16 = _Block_copy(aBlock);
        v17 = *(a1 + 40);
        v18 = _Block_copy(v15);
        [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_22:
        goto LABEL_23;
      }

      v27 = pk_Payment_log();
      v28 = os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT);

      if (v28)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v35 = v13;
        v24 = "Warning: No response expected for message with identifier %@";
        v25 = v15;
        v26 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v22 = pk_Payment_log();
      v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

      if (v23)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v35 = v10;
        v24 = "Error: No message identifier for protobuf %@";
        v25 = v15;
        v26 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v25, v26, v24, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v19 = pk_General_log();
  v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

  if (v20)
  {
    v21 = pk_General_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_ERROR, "Error: Unable to retrieve share invitation without specified mailbox address", buf, 2u);
    }
  }

  if (*(a1 + 48))
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 48) + 16))();
LABEL_24:
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __97__NPKPaymentWebServiceCompanionTargetDevice_retrieveShareInvitationForMailboxAddress_completion___block_invoke_870(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)retrieveShareInvitationForMailboxAddressResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target retrieveShareInvitationForMailboxAddressResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __94__NPKPaymentWebServiceCompanionTargetDevice_retrieveShareInvitationForMailboxAddressResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __94__NPKPaymentWebServiceCompanionTargetDevice_retrieveShareInvitationForMailboxAddressResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoRetrieveShareInvitationForMailboxAddressResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoRetrieveShareInvitationForMailboxAddressResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoRetrieveShareInvitationForMailboxAddressResponse *)v7 hasInvitationData];
    if (v12)
    {
      v1 = [(NPKProtoRetrieveShareInvitationForMailboxAddressResponse *)v7 invitationData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }

    v18 = [(NPKProtoRetrieveShareInvitationForMailboxAddressResponse *)v7 hasErrorData];
    if (v18)
    {
      v1 = [(NPKProtoRetrieveShareInvitationForMailboxAddressResponse *)v7 errorData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v1, v19);
    }

    else
    {
      v20 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v20);
    if (v18)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)revokeShareForPassIdentifier:(id)identifier share:(id)share shouldCascade:(BOOL)cascade completion:(id)completion
{
  identifierCopy = identifier;
  shareCopy = share;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __105__NPKPaymentWebServiceCompanionTargetDevice_revokeShareForPassIdentifier_share_shouldCascade_completion___block_invoke;
    block[3] = &unk_27994A7D0;
    v20 = shareCopy;
    v21 = identifierCopy;
    cascadeCopy = cascade;
    selfCopy = self;
    v23 = completionCopy;
    dispatch_sync(internalQueue, block);

    v14 = v20;
LABEL_9:

    goto LABEL_10;
  }

  v15 = pk_Payment_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_Payment_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *v18 = 0;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v18, 2u);
    }
  }

  if (completionCopy)
  {
    v14 = PKDisplayableErrorForCommonType();
    (*(completionCopy + 2))(completionCopy, 0, v14);
    goto LABEL_9;
  }

LABEL_10:
}

void __105__NPKPaymentWebServiceCompanionTargetDevice_revokeShareForPassIdentifier_share_shouldCascade_completion___block_invoke(uint64_t a1)
{
  v47 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      if (*(a1 + 64))
      {
        v7 = @"YES";
      }

      else
      {
        v7 = @"NO";
      }

      v8 = _Block_copy(*(a1 + 56));
      *buf = 138413058;
      v40 = v5;
      v41 = 2112;
      v42 = v6;
      v43 = 2112;
      v44 = v7;
      v45 = 2112;
      v46 = v8;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to revoke share %@ for pass identifier: %@ cascading: %@, completion: %@", buf, 0x2Au);
    }
  }

  if (*(a1 + 40) && *(a1 + 32))
  {
    v9 = objc_alloc_init(NPKProtoRevokeShareForPassIdentifierRequest);
    [(NPKProtoRevokeShareForPassIdentifierRequest *)v9 setPassIdentifier:*(a1 + 40)];
    v10 = NPKSecureArchiveObject(*(a1 + 32));
    [(NPKProtoRevokeShareForPassIdentifierRequest *)v9 setShareData:v10];

    [(NPKProtoRevokeShareForPassIdentifierRequest *)v9 setShouldCascade:*(a1 + 64)];
    v11 = objc_alloc(MEMORY[0x277D189F0]);
    v12 = [(NPKProtoRevokeShareForPassIdentifierRequest *)v9 data];
    v13 = [v11 initWithProtobufData:v12 type:112 isResponse:0];

    v14 = *(a1 + 48);
    v37 = *MEMORY[0x277D18650];
    v38 = &unk_286CE7808;
    v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v38 forKeys:&v37 count:1];
    v16 = [v14 _sendProtobuf:v13 responseExpected:1 extraOptions:v15];

    if (v16)
    {
      v17 = *(a1 + 56);
      if (v17)
      {
        v18 = _Block_copy(v17);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __105__NPKPaymentWebServiceCompanionTargetDevice_revokeShareForPassIdentifier_share_shouldCascade_completion___block_invoke_874;
        aBlock[3] = &unk_279945218;
        v36 = *(a1 + 56);
        v19 = _Block_copy(aBlock);
        v20 = *(a1 + 48);
        v21 = _Block_copy(v18);
        [v20 _trackOutstandingRequestWithMessageIdentifier:v16 completionHandler:v21 errorHandler:v19];

LABEL_26:
        goto LABEL_27;
      }

      v32 = pk_Payment_log();
      v33 = os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT);

      if (v33)
      {
        v18 = pk_Payment_log();
        if (!os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_26;
        }

        *buf = 138412290;
        v40 = v16;
        v29 = "Warning: No response expected for message with identifier %@";
        v30 = v18;
        v31 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_25;
      }
    }

    else
    {
      v27 = pk_Payment_log();
      v28 = os_log_type_enabled(v27, OS_LOG_TYPE_ERROR);

      if (v28)
      {
        v18 = pk_Payment_log();
        if (!os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_26;
        }

        *buf = 138412290;
        v40 = v13;
        v29 = "Error: No message identifier for protobuf %@";
        v30 = v18;
        v31 = OS_LOG_TYPE_ERROR;
LABEL_25:
        _os_log_impl(&dword_25B300000, v30, v31, v29, buf, 0xCu);
        goto LABEL_26;
      }
    }

LABEL_27:

    goto LABEL_28;
  }

  v22 = pk_General_log();
  v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

  if (v23)
  {
    v24 = pk_General_log();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = *(a1 + 32);
      v26 = *(a1 + 40);
      *buf = 138412546;
      v40 = v25;
      v41 = 2112;
      v42 = v26;
      _os_log_impl(&dword_25B300000, v24, OS_LOG_TYPE_ERROR, "Error: Unable to revoke share without specified share (%@) or pass identifier (%@)", buf, 0x16u);
    }
  }

  if (*(a1 + 56))
  {
    v9 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 56) + 16))();
LABEL_28:
  }

  v34 = *MEMORY[0x277D85DE8];
}

void __105__NPKPaymentWebServiceCompanionTargetDevice_revokeShareForPassIdentifier_share_shouldCascade_completion___block_invoke_874(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)revokeShareForPassIdentifierResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target revokeShareForPassIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x2020000000;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __82__NPKPaymentWebServiceCompanionTargetDevice_revokeShareForPassIdentifierResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v31 + 24), v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __82__NPKPaymentWebServiceCompanionTargetDevice_revokeShareForPassIdentifierResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoRevokeShareForPassIdentifierResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoRevokeShareForPassIdentifierResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoRevokeShareForPassIdentifierResponse *)v7 success];
    v12 = [(NPKProtoRevokeShareForPassIdentifierResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoRevokeShareForPassIdentifierResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)paymentWebService:(id)service passSharesForCredentialIdentifier:(id)identifier completion:(id)completion
{
  identifierCopy = identifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __108__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passSharesForCredentialIdentifier_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v15 = identifierCopy;
    selfCopy = self;
    v17 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v10 = pk_Payment_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

    if (v11)
    {
      v12 = pk_Payment_log();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        *v13 = 0;
        _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v13, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __108__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passSharesForCredentialIdentifier_completion___block_invoke(uint64_t a1)
{
  v40 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138412546;
      v37 = v5;
      v38 = 2112;
      v39 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request for pass shares for credential identifier: %@, completion: %@", buf, 0x16u);
    }
  }

  if (*(a1 + 32))
  {
    v7 = objc_alloc_init(NPKProtoPassSharesForCredentialIdentifierRequest);
    [(NPKProtoPassSharesForCredentialIdentifierRequest *)v7 setCredentialIdentifier:*(a1 + 32)];
    v8 = objc_alloc(MEMORY[0x277D189F0]);
    v9 = [(NPKProtoPassSharesForCredentialIdentifierRequest *)v7 data];
    v10 = [v8 initWithProtobufData:v9 type:113 isResponse:0];

    v11 = *(a1 + 40);
    v34 = *MEMORY[0x277D18650];
    v35 = &unk_286CE7808;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v35 forKeys:&v34 count:1];
    v13 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v12];

    if (v13)
    {
      v14 = *(a1 + 48);
      if (v14)
      {
        v15 = _Block_copy(v14);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __108__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passSharesForCredentialIdentifier_completion___block_invoke_877;
        aBlock[3] = &unk_279945218;
        v33 = *(a1 + 48);
        v16 = _Block_copy(aBlock);
        v17 = *(a1 + 40);
        v18 = _Block_copy(v15);
        [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_22:
        goto LABEL_23;
      }

      v29 = pk_Payment_log();
      v30 = os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT);

      if (v30)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v13;
        v26 = "Warning: No response expected for message with identifier %@";
        v27 = v15;
        v28 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v24 = pk_Payment_log();
      v25 = os_log_type_enabled(v24, OS_LOG_TYPE_ERROR);

      if (v25)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v10;
        v26 = "Error: No message identifier for protobuf %@";
        v27 = v15;
        v28 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v27, v28, v26, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v19 = pk_General_log();
  v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

  if (v20)
  {
    v21 = pk_General_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = *(a1 + 32);
      *buf = 138412290;
      v37 = v22;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_ERROR, "Error: Unable to fetch pass shares without credential identifier (%@)", buf, 0xCu);
    }
  }

  v23 = *(a1 + 48);
  if (v23)
  {
    (*(v23 + 16))(v23, 0);
  }

LABEL_24:
  v31 = *MEMORY[0x277D85DE8];
}

void __108__NPKPaymentWebServiceCompanionTargetDevice_paymentWebService_passSharesForCredentialIdentifier_completion___block_invoke_877(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)passSharesForCredentialIdentifierResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target passSharesForCredentialIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __87__NPKPaymentWebServiceCompanionTargetDevice_passSharesForCredentialIdentifierResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __87__NPKPaymentWebServiceCompanionTargetDevice_passSharesForCredentialIdentifierResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoPassSharesForCredentialIdentifierResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoPassSharesForCredentialIdentifierResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{-[NSObject sharesDatasCount](v6, "sharesDatasCount")}];
    v12 = [v6 sharesDatas];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __87__NPKPaymentWebServiceCompanionTargetDevice_passSharesForCredentialIdentifierResponse___block_invoke_2;
    v20[3] = &unk_279949C70;
    v21 = v11;
    v13 = v11;
    [v12 enumerateObjectsUsingBlock:v20];

    v14 = [v13 copy];
    v15 = *(*(a1 + 64) + 8);
    v16 = *(v15 + 40);
    *(v15 + 40) = v14;
  }

  else
  {
    v17 = pk_Payment_log();
    v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

    if (!v18)
    {
      goto LABEL_4;
    }

    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v19 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
    }
  }

LABEL_4:
}

void __87__NPKPaymentWebServiceCompanionTargetDevice_passSharesForCredentialIdentifierResponse___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = objc_opt_class();
  v6 = NPKSecureUnarchiveObject(v3, v4);

  v5 = v6;
  if (v6)
  {
    [*(a1 + 32) addObject:v6];
    v5 = v6;
  }
}

- (void)displayableSharesForPassIdentifier:(id)identifier completion:(id)completion
{
  v23 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  completionCopy = completion;
  v8 = pk_General_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_General_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v11 = _Block_copy(completionCopy);
      *buf = 138412546;
      v20 = identifierCopy;
      v21 = 2112;
      v22 = v11;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request for displayable shares for pass identifier: %@, completion: %@\nChecking for displayable shares from the corresponding companion pass first...", buf, 0x16u);
    }
  }

  v12 = objc_alloc_init(MEMORY[0x277D380F0]);
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_displayableSharesForPassIdentifier_completion___block_invoke;
  v16[3] = &unk_27994A7F8;
  v17 = identifierCopy;
  v18 = completionCopy;
  v16[4] = self;
  v13 = identifierCopy;
  v14 = completionCopy;
  [v12 displayableSharesForPassIdentifier:v13 completion:v16];

  v15 = *MEMORY[0x277D85DE8];
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_displayableSharesForPassIdentifier_completion___block_invoke(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = pk_General_log();
    v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

    if (v5)
    {
      v6 = pk_General_log();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
      {
        v9 = 138412290;
        v10 = v3;
        _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Returning displayable shares (%@) for companion pass", &v9, 0xCu);
      }
    }

    v7 = *(a1 + 48);
    if (v7)
    {
      (*(v7 + 16))(v7, v3);
    }
  }

  else
  {
    [*(a1 + 32) _displayableSharesForPassIdentifier:*(a1 + 40) completion:*(a1 + 48)];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_displayableSharesForPassIdentifier:(id)identifier completion:(id)completion
{
  identifierCopy = identifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __92__NPKPaymentWebServiceCompanionTargetDevice__displayableSharesForPassIdentifier_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v14 = identifierCopy;
    selfCopy = self;
    v16 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v9 = pk_Payment_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

    if (v10)
    {
      v11 = pk_Payment_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        *v12 = 0;
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v12, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __92__NPKPaymentWebServiceCompanionTargetDevice__displayableSharesForPassIdentifier_completion___block_invoke(uint64_t a1)
{
  v40 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138412546;
      v37 = v5;
      v38 = 2112;
      v39 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request for displayable shares from watch for pass identifier: %@, completion: %@", buf, 0x16u);
    }
  }

  if (*(a1 + 32))
  {
    v7 = objc_alloc_init(NPKProtoDisplayableSharesForPassIdentifierRequest);
    [(NPKProtoDisplayableSharesForPassIdentifierRequest *)v7 setPassIdentifier:*(a1 + 32)];
    v8 = objc_alloc(MEMORY[0x277D189F0]);
    v9 = [(NPKProtoDisplayableSharesForPassIdentifierRequest *)v7 data];
    v10 = [v8 initWithProtobufData:v9 type:114 isResponse:0];

    v11 = *(a1 + 40);
    v34 = *MEMORY[0x277D18650];
    v35 = &unk_286CE7808;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v35 forKeys:&v34 count:1];
    v13 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v12];

    if (v13)
    {
      v14 = *(a1 + 48);
      if (v14)
      {
        v15 = _Block_copy(v14);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __92__NPKPaymentWebServiceCompanionTargetDevice__displayableSharesForPassIdentifier_completion___block_invoke_881;
        aBlock[3] = &unk_279945218;
        v33 = *(a1 + 48);
        v16 = _Block_copy(aBlock);
        v17 = *(a1 + 40);
        v18 = _Block_copy(v15);
        [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_22:
        goto LABEL_23;
      }

      v29 = pk_Payment_log();
      v30 = os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT);

      if (v30)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v13;
        v26 = "Warning: No response expected for message with identifier %@";
        v27 = v15;
        v28 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v24 = pk_Payment_log();
      v25 = os_log_type_enabled(v24, OS_LOG_TYPE_ERROR);

      if (v25)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v10;
        v26 = "Error: No message identifier for protobuf %@";
        v27 = v15;
        v28 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v27, v28, v26, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v19 = pk_General_log();
  v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

  if (v20)
  {
    v21 = pk_General_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = *(a1 + 32);
      *buf = 138412290;
      v37 = v22;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_ERROR, "Error: Unable to fetch displayable shares without pass identifier (%@)", buf, 0xCu);
    }
  }

  v23 = *(a1 + 48);
  if (v23)
  {
    (*(v23 + 16))(v23, 0);
  }

LABEL_24:
  v31 = *MEMORY[0x277D85DE8];
}

void __92__NPKPaymentWebServiceCompanionTargetDevice__displayableSharesForPassIdentifier_completion___block_invoke_881(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)displayableSharesForPassIdentifierResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target displayableSharesForPassIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_displayableSharesForPassIdentifierResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __88__NPKPaymentWebServiceCompanionTargetDevice_displayableSharesForPassIdentifierResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoDisplayableSharesForPassIdentifierResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoDisplayableSharesForPassIdentifierResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{-[NSObject sharesDatasCount](v6, "sharesDatasCount")}];
    v12 = [v6 sharesDatas];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __88__NPKPaymentWebServiceCompanionTargetDevice_displayableSharesForPassIdentifierResponse___block_invoke_2;
    v20[3] = &unk_279949C70;
    v21 = v11;
    v13 = v11;
    [v12 enumerateObjectsUsingBlock:v20];

    v14 = [v13 copy];
    v15 = *(*(a1 + 64) + 8);
    v16 = *(v15 + 40);
    *(v15 + 40) = v14;
  }

  else
  {
    v17 = pk_Payment_log();
    v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

    if (!v18)
    {
      goto LABEL_4;
    }

    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v19 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
    }
  }

LABEL_4:
}

void __88__NPKPaymentWebServiceCompanionTargetDevice_displayableSharesForPassIdentifierResponse___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = objc_opt_class();
  v6 = NPKSecureUnarchiveObject(v3, v4);

  v5 = v6;
  if (v6)
  {
    [*(a1 + 32) addObject:v6];
    v5 = v6;
  }
}

- (void)displayableEntitlementsForPassIdentifier:(id)identifier completion:(id)completion
{
  v23 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  completionCopy = completion;
  v8 = pk_General_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_General_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v11 = _Block_copy(completionCopy);
      *buf = 138412546;
      v20 = identifierCopy;
      v21 = 2112;
      v22 = v11;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request for displayable entitlements for pass identifier: %@, completion: %@\nChecking for displayable entitlements from the corresponding companion pass first...", buf, 0x16u);
    }
  }

  v12 = objc_alloc_init(MEMORY[0x277D380F0]);
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __97__NPKPaymentWebServiceCompanionTargetDevice_displayableEntitlementsForPassIdentifier_completion___block_invoke;
  v16[3] = &unk_27994A7F8;
  v17 = identifierCopy;
  v18 = completionCopy;
  v16[4] = self;
  v13 = identifierCopy;
  v14 = completionCopy;
  [v12 displayableEntitlementsForPassIdentifier:v13 completion:v16];

  v15 = *MEMORY[0x277D85DE8];
}

void __97__NPKPaymentWebServiceCompanionTargetDevice_displayableEntitlementsForPassIdentifier_completion___block_invoke(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = pk_General_log();
    v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

    if (v5)
    {
      v6 = pk_General_log();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
      {
        v9 = 138412290;
        v10 = v3;
        _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Returning displayable entitlements (%@) for companion pass", &v9, 0xCu);
      }
    }

    v7 = *(a1 + 48);
    if (v7)
    {
      (*(v7 + 16))(v7, v3);
    }
  }

  else
  {
    [*(a1 + 32) _displayableEntitlementsForPassIdentifier:*(a1 + 40) completion:*(a1 + 48)];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_displayableEntitlementsForPassIdentifier:(id)identifier completion:(id)completion
{
  identifierCopy = identifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __98__NPKPaymentWebServiceCompanionTargetDevice__displayableEntitlementsForPassIdentifier_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v14 = identifierCopy;
    selfCopy = self;
    v16 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v9 = pk_Payment_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

    if (v10)
    {
      v11 = pk_Payment_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        *v12 = 0;
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v12, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __98__NPKPaymentWebServiceCompanionTargetDevice__displayableEntitlementsForPassIdentifier_completion___block_invoke(uint64_t a1)
{
  v40 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138412546;
      v37 = v5;
      v38 = 2112;
      v39 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request for displayable entitlements from watch for pass identifier: %@, completion: %@", buf, 0x16u);
    }
  }

  if (*(a1 + 32))
  {
    v7 = objc_alloc_init(NPKProtoDisplayableEntitlementsForPassIdentifierRequest);
    [(NPKProtoDisplayableEntitlementsForPassIdentifierRequest *)v7 setPassIdentifier:*(a1 + 32)];
    v8 = objc_alloc(MEMORY[0x277D189F0]);
    v9 = [(NPKProtoDisplayableEntitlementsForPassIdentifierRequest *)v7 data];
    v10 = [v8 initWithProtobufData:v9 type:115 isResponse:0];

    v11 = *(a1 + 40);
    v34 = *MEMORY[0x277D18650];
    v35 = &unk_286CE7808;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v35 forKeys:&v34 count:1];
    v13 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v12];

    if (v13)
    {
      v14 = *(a1 + 48);
      if (v14)
      {
        v15 = _Block_copy(v14);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __98__NPKPaymentWebServiceCompanionTargetDevice__displayableEntitlementsForPassIdentifier_completion___block_invoke_884;
        aBlock[3] = &unk_279945218;
        v33 = *(a1 + 48);
        v16 = _Block_copy(aBlock);
        v17 = *(a1 + 40);
        v18 = _Block_copy(v15);
        [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_22:
        goto LABEL_23;
      }

      v29 = pk_Payment_log();
      v30 = os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT);

      if (v30)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v13;
        v26 = "Warning: No response expected for message with identifier %@";
        v27 = v15;
        v28 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v24 = pk_Payment_log();
      v25 = os_log_type_enabled(v24, OS_LOG_TYPE_ERROR);

      if (v25)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v10;
        v26 = "Error: No message identifier for protobuf %@";
        v27 = v15;
        v28 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v27, v28, v26, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v19 = pk_General_log();
  v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

  if (v20)
  {
    v21 = pk_General_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = *(a1 + 32);
      *buf = 138412290;
      v37 = v22;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_ERROR, "Error: Unable to fetch displayable entitlements without pass identifier (%@)", buf, 0xCu);
    }
  }

  v23 = *(a1 + 48);
  if (v23)
  {
    (*(v23 + 16))(v23, 0);
  }

LABEL_24:
  v31 = *MEMORY[0x277D85DE8];
}

void __98__NPKPaymentWebServiceCompanionTargetDevice__displayableEntitlementsForPassIdentifier_completion___block_invoke_884(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)displayableEntitlementsForPassIdentifierResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target displayableEntitlementsForPassIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __94__NPKPaymentWebServiceCompanionTargetDevice_displayableEntitlementsForPassIdentifierResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __94__NPKPaymentWebServiceCompanionTargetDevice_displayableEntitlementsForPassIdentifierResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoDisplayableEntitlementsForPassIdentifierResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoDisplayableEntitlementsForPassIdentifierResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{-[NSObject entitlementsDatasCount](v6, "entitlementsDatasCount")}];
    v12 = [v6 entitlementsDatas];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __94__NPKPaymentWebServiceCompanionTargetDevice_displayableEntitlementsForPassIdentifierResponse___block_invoke_2;
    v20[3] = &unk_279949C70;
    v21 = v11;
    v13 = v11;
    [v12 enumerateObjectsUsingBlock:v20];

    v14 = [v13 copy];
    v15 = *(*(a1 + 64) + 8);
    v16 = *(v15 + 40);
    *(v15 + 40) = v14;
  }

  else
  {
    v17 = pk_Payment_log();
    v18 = os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT);

    if (!v18)
    {
      goto LABEL_4;
    }

    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *v19 = 0;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
    }
  }

LABEL_4:
}

void __94__NPKPaymentWebServiceCompanionTargetDevice_displayableEntitlementsForPassIdentifierResponse___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = objc_opt_class();
  v6 = NPKSecureUnarchiveObject(v3, v4);

  v5 = v6;
  if (v6)
  {
    [*(a1 + 32) addObject:v6];
    v5 = v6;
  }
}

- (void)prewarmCreateShareForPassIdentifier:(id)identifier completion:(id)completion
{
  identifierCopy = identifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __92__NPKPaymentWebServiceCompanionTargetDevice_prewarmCreateShareForPassIdentifier_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v14 = identifierCopy;
    selfCopy = self;
    v16 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v9 = pk_Payment_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

    if (v10)
    {
      v11 = pk_Payment_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        *v12 = 0;
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v12, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __92__NPKPaymentWebServiceCompanionTargetDevice_prewarmCreateShareForPassIdentifier_completion___block_invoke(uint64_t a1)
{
  v40 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138412546;
      v37 = v5;
      v38 = 2112;
      v39 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to prewarm share creation for pass identifier: %@, completion: %@", buf, 0x16u);
    }
  }

  if (*(a1 + 32))
  {
    v7 = objc_alloc_init(NPKProtoPrewarmCreateShareForPassIdentifierRequest);
    [(NPKProtoPrewarmCreateShareForPassIdentifierRequest *)v7 setPassIdentifier:*(a1 + 32)];
    v8 = objc_alloc(MEMORY[0x277D189F0]);
    v9 = [(NPKProtoPrewarmCreateShareForPassIdentifierRequest *)v7 data];
    v10 = [v8 initWithProtobufData:v9 type:127 isResponse:0];

    v11 = *(a1 + 40);
    v34 = *MEMORY[0x277D18650];
    v35 = &unk_286CE7808;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v35 forKeys:&v34 count:1];
    v13 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v12];

    if (v13)
    {
      v14 = *(a1 + 48);
      if (v14)
      {
        v15 = _Block_copy(v14);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __92__NPKPaymentWebServiceCompanionTargetDevice_prewarmCreateShareForPassIdentifier_completion___block_invoke_888;
        aBlock[3] = &unk_279945218;
        v33 = *(a1 + 48);
        v16 = _Block_copy(aBlock);
        v17 = *(a1 + 40);
        v18 = _Block_copy(v15);
        [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_22:
        goto LABEL_23;
      }

      v29 = pk_Payment_log();
      v30 = os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT);

      if (v30)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v13;
        v26 = "Warning: No response expected for message with identifier %@";
        v27 = v15;
        v28 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v24 = pk_Payment_log();
      v25 = os_log_type_enabled(v24, OS_LOG_TYPE_ERROR);

      if (v25)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v10;
        v26 = "Error: No message identifier for protobuf %@";
        v27 = v15;
        v28 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v27, v28, v26, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v19 = pk_General_log();
  v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

  if (v20)
  {
    v21 = pk_General_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = *(a1 + 32);
      *buf = 138412290;
      v37 = v22;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_ERROR, "Error: Unable to prewarm share without a pass identifier (%@)", buf, 0xCu);
    }
  }

  v23 = *(a1 + 48);
  if (v23)
  {
    (*(v23 + 16))(v23, 0);
  }

LABEL_24:
  v31 = *MEMORY[0x277D85DE8];
}

void __92__NPKPaymentWebServiceCompanionTargetDevice_prewarmCreateShareForPassIdentifier_completion___block_invoke_888(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)prewarmCreateShareForPassIdentifierResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target prewarmCreateShareForPassIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __89__NPKPaymentWebServiceCompanionTargetDevice_prewarmCreateShareForPassIdentifierResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __89__NPKPaymentWebServiceCompanionTargetDevice_prewarmCreateShareForPassIdentifierResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoPrewarmCreateShareForPassIdentifierResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoPrewarmCreateShareForPassIdentifierResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoPrewarmCreateShareForPassIdentifierResponse *)v6 success];
  }

  else
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (void)createShareForPartialShareInvitation:(id)invitation authorization:(id)authorization completion:(id)completion
{
  invitationCopy = invitation;
  authorizationCopy = authorization;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_createShareForPartialShareInvitation_authorization_completion___block_invoke;
    block[3] = &unk_279945C50;
    v18 = invitationCopy;
    v19 = authorizationCopy;
    selfCopy = self;
    v21 = completionCopy;
    dispatch_sync(internalQueue, block);

    v12 = v18;
LABEL_9:

    goto LABEL_10;
  }

  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      *v16 = 0;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v16, 2u);
    }
  }

  if (completionCopy)
  {
    v12 = PKDisplayableErrorForCommonType();
    (*(completionCopy + 2))(completionCopy, 0, v12);
    goto LABEL_9;
  }

LABEL_10:
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_createShareForPartialShareInvitation_authorization_completion___block_invoke(uint64_t a1)
{
  v43 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = _Block_copy(*(a1 + 56));
      *buf = 138412802;
      v38 = v5;
      v39 = 2112;
      v40 = v6;
      v41 = 2112;
      v42 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to create share for partial share invitation: %@, authorization: %@, completion: %@", buf, 0x20u);
    }
  }

  if (*(a1 + 32))
  {
    v8 = objc_alloc_init(NPKProtoCreateShareForPartialShareInvitationRequest);
    v9 = NPKSecureArchiveObject(*(a1 + 32));
    [(NPKProtoCreateShareForPartialShareInvitationRequest *)v8 setInviteData:v9];

    [(NPKProtoCreateShareForPartialShareInvitationRequest *)v8 setAuthorizationData:*(a1 + 40)];
    v10 = objc_alloc(MEMORY[0x277D189F0]);
    v11 = [(NPKProtoCreateShareForPartialShareInvitationRequest *)v8 data];
    v12 = [v10 initWithProtobufData:v11 type:116 isResponse:0];

    v13 = *(a1 + 48);
    v35 = *MEMORY[0x277D18650];
    v36 = &unk_286CE7808;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    v15 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v14];

    if (v15)
    {
      v16 = *(a1 + 56);
      if (v16)
      {
        v17 = _Block_copy(v16);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_createShareForPartialShareInvitation_authorization_completion___block_invoke_891;
        aBlock[3] = &unk_279945218;
        v34 = *(a1 + 56);
        v18 = _Block_copy(aBlock);
        v19 = *(a1 + 48);
        v20 = _Block_copy(v17);
        [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:v18];

LABEL_22:
        goto LABEL_23;
      }

      v30 = pk_Payment_log();
      v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

      if (v31)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v15;
        v27 = "Warning: No response expected for message with identifier %@";
        v28 = v17;
        v29 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v25 = pk_Payment_log();
      v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

      if (v26)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v12;
        v27 = "Error: No message identifier for protobuf %@";
        v28 = v17;
        v29 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v28, v29, v27, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v21 = pk_General_log();
  v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

  if (v22)
  {
    v23 = pk_General_log();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = *(a1 + 32);
      *buf = 138412290;
      v38 = v24;
      _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_ERROR, "Error: Unable to create share without a partial share invitation (%@)", buf, 0xCu);
    }
  }

  if (*(a1 + 56))
  {
    v8 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 56) + 16))();
LABEL_24:
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_createShareForPartialShareInvitation_authorization_completion___block_invoke_891(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  if (*(a1 + 32))
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 32) + 16))();
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)createShareForPartialShareInvitationResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target createShareForPartialShareInvitationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_createShareForPartialShareInvitationResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_createShareForPartialShareInvitationResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCreateShareForPartialShareInvitationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCreateShareForPartialShareInvitationResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCreateShareForPartialShareInvitationResponse *)v7 hasShareURLData];
    if (v12)
    {
      v1 = [(NPKProtoCreateShareForPartialShareInvitationResponse *)v7 shareURLData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }

    v18 = [(NPKProtoCreateShareForPartialShareInvitationResponse *)v7 hasErrorData];
    if (v18)
    {
      v1 = [(NPKProtoCreateShareForPartialShareInvitationResponse *)v7 errorData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v1, v19);
    }

    else
    {
      v20 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v20);
    if (v18)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)checkInvitationStatusForMailboxAddress:(id)address completion:(id)completion
{
  addressCopy = address;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __95__NPKPaymentWebServiceCompanionTargetDevice_checkInvitationStatusForMailboxAddress_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v15 = addressCopy;
    selfCopy = self;
    v17 = completionCopy;
    dispatch_sync(internalQueue, block);

    v9 = v15;
LABEL_9:

    goto LABEL_10;
  }

  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *v13 = 0;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v13, 2u);
    }
  }

  if (completionCopy)
  {
    v9 = PKDisplayableErrorForCommonType();
    (*(completionCopy + 2))(completionCopy, 0, v9);
    goto LABEL_9;
  }

LABEL_10:
}

void __95__NPKPaymentWebServiceCompanionTargetDevice_checkInvitationStatusForMailboxAddress_completion___block_invoke(uint64_t a1)
{
  v38 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138478083;
      v35 = v5;
      v36 = 2112;
      v37 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to check invitation status for mailbox address: %{private}@, completion: %@", buf, 0x16u);
    }
  }

  if ([*(a1 + 32) length])
  {
    v7 = objc_alloc_init(NPKProtoCheckInvitationStatusForMailboxAddressRequest);
    [(NPKProtoCheckInvitationStatusForMailboxAddressRequest *)v7 setMailboxAddress:*(a1 + 32)];
    v8 = objc_alloc(MEMORY[0x277D189F0]);
    v9 = [(NPKProtoCheckInvitationStatusForMailboxAddressRequest *)v7 data];
    v10 = [v8 initWithProtobufData:v9 type:123 isResponse:0];

    v11 = *(a1 + 40);
    v32 = *MEMORY[0x277D18650];
    v33 = &unk_286CE7808;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v33 forKeys:&v32 count:1];
    v13 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v12];

    if (v13)
    {
      v14 = *(a1 + 48);
      if (v14)
      {
        v15 = _Block_copy(v14);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __95__NPKPaymentWebServiceCompanionTargetDevice_checkInvitationStatusForMailboxAddress_completion___block_invoke_895;
        aBlock[3] = &unk_279945218;
        v31 = *(a1 + 48);
        v16 = _Block_copy(aBlock);
        v17 = *(a1 + 40);
        v18 = _Block_copy(v15);
        [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_22:
        goto LABEL_23;
      }

      v27 = pk_Payment_log();
      v28 = os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT);

      if (v28)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v35 = v13;
        v24 = "Warning: No response expected for message with identifier %@";
        v25 = v15;
        v26 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v22 = pk_Payment_log();
      v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

      if (v23)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v35 = v10;
        v24 = "Error: No message identifier for protobuf %@";
        v25 = v15;
        v26 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v25, v26, v24, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v19 = pk_General_log();
  v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

  if (v20)
  {
    v21 = pk_General_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_ERROR, "Error: Unable to fetch invitation status without mailbox address", buf, 2u);
    }
  }

  if (*(a1 + 48))
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 48) + 16))();
LABEL_24:
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __95__NPKPaymentWebServiceCompanionTargetDevice_checkInvitationStatusForMailboxAddress_completion___block_invoke_895(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  if (*(a1 + 32))
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 32) + 16))();
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)checkInvitationStatusForMailboxAddressResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target checkInvitationStatusForMailboxAddressResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x2020000000;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __92__NPKPaymentWebServiceCompanionTargetDevice_checkInvitationStatusForMailboxAddressResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v31 + 24), v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __92__NPKPaymentWebServiceCompanionTargetDevice_checkInvitationStatusForMailboxAddressResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCheckInvitationStatusForMailboxAddressResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCheckInvitationStatusForMailboxAddressResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoCheckInvitationStatusForMailboxAddressResponse *)v7 valid];
    v12 = [(NPKProtoCheckInvitationStatusForMailboxAddressResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoCheckInvitationStatusForMailboxAddressResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)statusForShareableCredentials:(id)credentials completion:(id)completion
{
  credentialsCopy = credentials;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __86__NPKPaymentWebServiceCompanionTargetDevice_statusForShareableCredentials_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v15 = credentialsCopy;
    selfCopy = self;
    v17 = completionCopy;
    dispatch_sync(internalQueue, block);

    v9 = v15;
LABEL_9:

    goto LABEL_10;
  }

  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *v13 = 0;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v13, 2u);
    }
  }

  if (completionCopy)
  {
    v9 = PKDisplayableErrorForCommonType();
    (*(completionCopy + 2))(completionCopy, 0, 0, v9);
    goto LABEL_9;
  }

LABEL_10:
}

void __86__NPKPaymentWebServiceCompanionTargetDevice_statusForShareableCredentials_completion___block_invoke(uint64_t a1)
{
  v46 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138412546;
      v43 = v5;
      v44 = 2112;
      v45 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request for status for shareable credentials: %@, completion: %@", buf, 0x16u);
    }
  }

  if ([*(a1 + 32) count])
  {
    v7 = objc_alloc_init(NPKProtoStatusForShareableCredentialsRequest);
    v8 = *(a1 + 32);
    v38[0] = MEMORY[0x277D85DD0];
    v38[1] = 3221225472;
    v38[2] = __86__NPKPaymentWebServiceCompanionTargetDevice_statusForShareableCredentials_completion___block_invoke_898;
    v38[3] = &unk_27994A820;
    v9 = v7;
    v39 = v9;
    [v8 enumerateObjectsUsingBlock:v38];
    v10 = objc_alloc(MEMORY[0x277D189F0]);
    v11 = [(NPKProtoStatusForShareableCredentialsRequest *)v9 data];
    v12 = [v10 initWithProtobufData:v11 type:117 isResponse:0];

    v13 = *(a1 + 40);
    v40 = *MEMORY[0x277D18650];
    v41 = &unk_286CE7808;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v41 forKeys:&v40 count:1];
    v15 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v14];

    if (v15)
    {
      v16 = *(a1 + 48);
      if (v16)
      {
        v17 = _Block_copy(v16);
        v33 = MEMORY[0x277D85DD0];
        v34 = 3221225472;
        v35 = __86__NPKPaymentWebServiceCompanionTargetDevice_statusForShareableCredentials_completion___block_invoke_2;
        v36 = &unk_279945218;
        v37 = *(a1 + 48);
        v18 = _Block_copy(&v33);
        v19 = *(a1 + 40);
        v20 = _Block_copy(v17);
        [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:{v18, v33, v34, v35, v36}];

LABEL_22:
        goto LABEL_23;
      }

      v30 = pk_Payment_log();
      v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

      if (v31)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v43 = v15;
        v27 = "Warning: No response expected for message with identifier %@";
        v28 = v17;
        v29 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v25 = pk_Payment_log();
      v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

      if (v26)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v43 = v12;
        v27 = "Error: No message identifier for protobuf %@";
        v28 = v17;
        v29 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v28, v29, v27, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v21 = pk_General_log();
  v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

  if (v22)
  {
    v23 = pk_General_log();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = *(a1 + 32);
      *buf = 138412290;
      v43 = v24;
      _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_ERROR, "Error: Unable to fetch credential status without credentials (%@)", buf, 0xCu);
    }
  }

  if (*(a1 + 48))
  {
    v9 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 48) + 16))();
LABEL_24:
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __86__NPKPaymentWebServiceCompanionTargetDevice_statusForShareableCredentials_completion___block_invoke_898(uint64_t a1, void *a2)
{
  v3 = NPKSecureArchiveObject(a2);
  if (v3)
  {
    v4 = v3;
    [*(a1 + 32) addShareableCredentialsData:v3];
    v3 = v4;
  }
}

void __86__NPKPaymentWebServiceCompanionTargetDevice_statusForShareableCredentials_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  if (*(a1 + 32))
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 32) + 16))();
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)statusForShareableCredentialsResponse:(id)response
{
  v46 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target statusForShareableCredentialsResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v42 = 0x3032000000;
  v43 = __Block_byref_object_copy__384;
  v44 = __Block_byref_object_dispose__385;
  v45 = 0;
  v37 = 0;
  v38 = &v37;
  v39 = 0x2020000000;
  v40 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x3032000000;
  v34 = __Block_byref_object_copy__22;
  v35 = __Block_byref_object_dispose__22;
  v36 = 0;
  v25 = 0;
  v26 = &v25;
  v27 = 0x3032000000;
  v28 = __Block_byref_object_copy__22;
  v29 = __Block_byref_object_dispose__22;
  v30 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __83__NPKPaymentWebServiceCompanionTargetDevice_statusForShareableCredentialsResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v37;
    v23 = &v31;
    v24 = &v25;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v38[3], v32[5], v26[5]);
  }

  _Block_object_dispose(&v25, 8);

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v37, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __83__NPKPaymentWebServiceCompanionTargetDevice_statusForShareableCredentialsResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoStatusForShareableCredentialsResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoStatusForShareableCredentialsResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [v7 aggregateStatus];
    if (v12 <= 4)
    {
      *(*(*(a1 + 64) + 8) + 24) = v12;
    }

    v13 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{-[NSObject updatedCredentialsDatasCount](v7, "updatedCredentialsDatasCount")}];
    v14 = [v7 updatedCredentialsDatas];
    v25[0] = MEMORY[0x277D85DD0];
    v25[1] = 3221225472;
    v25[2] = __83__NPKPaymentWebServiceCompanionTargetDevice_statusForShareableCredentialsResponse___block_invoke_2;
    v25[3] = &unk_279949C70;
    v15 = v13;
    v26 = v15;
    [v14 enumerateObjectsUsingBlock:v25];

    v16 = [v15 copy];
    v17 = *(*(a1 + 72) + 8);
    v18 = *(v17 + 40);
    *(v17 + 40) = v16;

    v19 = [v7 hasErrorData];
    if (v19)
    {
      v1 = [v7 errorData];
      v20 = objc_opt_class();
      v21 = NPKSecureUnarchiveObject(v1, v20);
    }

    else
    {
      v21 = 0;
    }

    objc_storeStrong((*(*(a1 + 80) + 8) + 40), v21);
    if (v19)
    {
    }

LABEL_13:
    goto LABEL_14;
  }

  v22 = pk_Payment_log();
  v23 = os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT);

  if (v23)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *v24 = 0;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v24, 2u);
    }

    goto LABEL_13;
  }

LABEL_14:
}

void __83__NPKPaymentWebServiceCompanionTargetDevice_statusForShareableCredentialsResponse___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = objc_opt_class();
  v6 = NPKSecureUnarchiveObject(v3, v4);

  v5 = v6;
  if (v6)
  {
    [*(a1 + 32) addObject:v6];
    v5 = v6;
  }
}

- (void)prepareProvisioningTarget:(id)target checkFamilyCircle:(BOOL)circle completion:(id)completion
{
  targetCopy = target;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_prepareProvisioningTarget_checkFamilyCircle_completion___block_invoke;
    block[3] = &unk_27994A7A8;
    v17 = targetCopy;
    circleCopy = circle;
    selfCopy = self;
    v19 = completionCopy;
    dispatch_sync(internalQueue, block);

    v11 = v17;
LABEL_9:

    goto LABEL_10;
  }

  v12 = pk_Payment_log();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

  if (v13)
  {
    v14 = pk_Payment_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      *v15 = 0;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v15, 2u);
    }
  }

  if (completionCopy)
  {
    v11 = PKDisplayableErrorForCommonType();
    (*(completionCopy + 2))(completionCopy, 0, 0, v11);
    goto LABEL_9;
  }

LABEL_10:
}

void __100__NPKPaymentWebServiceCompanionTargetDevice_prepareProvisioningTarget_checkFamilyCircle_completion___block_invoke(uint64_t a1)
{
  v43 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      if (*(a1 + 56))
      {
        v6 = @"YES";
      }

      else
      {
        v6 = @"NO";
      }

      v7 = _Block_copy(*(a1 + 48));
      *buf = 138412802;
      v38 = v5;
      v39 = 2112;
      v40 = v6;
      v41 = 2112;
      v42 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to prepare provisioning target: %@, checkingFamilyCircle: %@, completion: %@", buf, 0x20u);
    }
  }

  if (*(a1 + 32))
  {
    v8 = objc_alloc_init(NPKProtoPrepareProvisioningTargetRequest);
    v9 = NPKSecureArchiveObject(*(a1 + 32));
    [(NPKProtoPrepareProvisioningTargetRequest *)v8 setTargetData:v9];

    [(NPKProtoPrepareProvisioningTargetRequest *)v8 setCheckFamilyCircle:*(a1 + 56)];
    v10 = objc_alloc(MEMORY[0x277D189F0]);
    v11 = [(NPKProtoPrepareProvisioningTargetRequest *)v8 data];
    v12 = [v10 initWithProtobufData:v11 type:118 isResponse:0];

    v13 = *(a1 + 40);
    v35 = *MEMORY[0x277D18650];
    v36 = &unk_286CE7808;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    v15 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v14];

    if (v15)
    {
      v16 = *(a1 + 48);
      if (v16)
      {
        v17 = _Block_copy(v16);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_prepareProvisioningTarget_checkFamilyCircle_completion___block_invoke_903;
        aBlock[3] = &unk_279945218;
        v34 = *(a1 + 48);
        v18 = _Block_copy(aBlock);
        v19 = *(a1 + 40);
        v20 = _Block_copy(v17);
        [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:v18];

LABEL_25:
        goto LABEL_26;
      }

      v30 = pk_Payment_log();
      v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

      if (v31)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_25;
        }

        *buf = 138412290;
        v38 = v15;
        v27 = "Warning: No response expected for message with identifier %@";
        v28 = v17;
        v29 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_24;
      }
    }

    else
    {
      v25 = pk_Payment_log();
      v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

      if (v26)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_25;
        }

        *buf = 138412290;
        v38 = v12;
        v27 = "Error: No message identifier for protobuf %@";
        v28 = v17;
        v29 = OS_LOG_TYPE_ERROR;
LABEL_24:
        _os_log_impl(&dword_25B300000, v28, v29, v27, buf, 0xCu);
        goto LABEL_25;
      }
    }

LABEL_26:

    goto LABEL_27;
  }

  v21 = pk_General_log();
  v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

  if (v22)
  {
    v23 = pk_General_log();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = *(a1 + 32);
      *buf = 138412290;
      v38 = v24;
      _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_ERROR, "Error: Unable to prepare provisioning target without a provisioning target (%@)", buf, 0xCu);
    }
  }

  if (*(a1 + 48))
  {
    v8 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 48) + 16))();
LABEL_27:
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __100__NPKPaymentWebServiceCompanionTargetDevice_prepareProvisioningTarget_checkFamilyCircle_completion___block_invoke_903(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  if (*(a1 + 32))
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 32) + 16))();
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)prepareProvisioningTargetResponse:(id)response
{
  v46 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target prepareProvisioningTargetResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v42 = 0x3032000000;
  v43 = __Block_byref_object_copy__384;
  v44 = __Block_byref_object_dispose__385;
  v45 = 0;
  v35 = 0;
  v36 = &v35;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__22;
  v39 = __Block_byref_object_dispose__22;
  v40 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x2020000000;
  v34 = 0;
  v25 = 0;
  v26 = &v25;
  v27 = 0x3032000000;
  v28 = __Block_byref_object_copy__22;
  v29 = __Block_byref_object_dispose__22;
  v30 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __79__NPKPaymentWebServiceCompanionTargetDevice_prepareProvisioningTargetResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v35;
    v23 = &v31;
    v24 = &v25;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v36[5], *(v32 + 24), v26[5]);
  }

  _Block_object_dispose(&v25, 8);

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v35, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __79__NPKPaymentWebServiceCompanionTargetDevice_prepareProvisioningTargetResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoPrepareProvisioningTargetResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoPrepareProvisioningTargetResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoPrepareProvisioningTargetResponse *)v7 hasEncryptedTargetData];
    if (v12)
    {
      v1 = [(NPKProtoPrepareProvisioningTargetResponse *)v7 encryptedTargetData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }

    *(*(*(a1 + 72) + 8) + 24) = [(NPKProtoPrepareProvisioningTargetResponse *)v7 wasFamilyCircle];
    v18 = [(NPKProtoPrepareProvisioningTargetResponse *)v7 hasErrorData];
    if (v18)
    {
      v1 = [(NPKProtoPrepareProvisioningTargetResponse *)v7 errorData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v1, v19);
    }

    else
    {
      v20 = 0;
    }

    objc_storeStrong((*(*(a1 + 80) + 8) + 40), v20);
    if (v18)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)cacheSharingMessageFromMailboxAddress:(id)address message:(id)message
{
  addressCopy = address;
  messageCopy = message;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_cacheSharingMessageFromMailboxAddress_message___block_invoke;
    block[3] = &unk_279945880;
    v14 = addressCopy;
    v15 = messageCopy;
    selfCopy = self;
    dispatch_sync(internalQueue, block);

    v9 = v14;
  }

  else
  {
    v10 = pk_Payment_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

    if (!v11)
    {
      goto LABEL_7;
    }

    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      *v12 = 0;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v12, 2u);
    }
  }

LABEL_7:
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_cacheSharingMessageFromMailboxAddress_message___block_invoke(uint64_t a1)
{
  v34 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      *buf = 138478083;
      v31 = v5;
      v32 = 2113;
      v33 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to cache sharing message from mailbox address: %{private}@, message: %{private}@", buf, 0x16u);
    }
  }

  if (*(a1 + 32) && *(a1 + 40))
  {
    v7 = objc_alloc_init(NPKProtoCacheSharingMessageFromMailboxAddressRequest);
    [(NPKProtoCacheSharingMessageFromMailboxAddressRequest *)v7 setMailboxAddress:*(a1 + 32)];
    v8 = NPKSecureArchiveObject(*(a1 + 40));
    [(NPKProtoCacheSharingMessageFromMailboxAddressRequest *)v7 setSharingMessageData:v8];

    v9 = objc_alloc(MEMORY[0x277D189F0]);
    v10 = [(NPKProtoCacheSharingMessageFromMailboxAddressRequest *)v7 data];
    v11 = [v9 initWithProtobufData:v10 type:125 isResponse:0];

    v12 = *(a1 + 48);
    v28 = *MEMORY[0x277D18650];
    v29 = &unk_286CE7808;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v29 forKeys:&v28 count:1];
    v14 = [v12 _sendProtobuf:v11 responseExpected:0 extraOptions:v13];

    v15 = pk_Payment_log();
    v16 = v15;
    if (v14)
    {
      v17 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

      if (v17)
      {
        v18 = pk_Payment_log();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v31 = v14;
          v19 = "Warning: No response expected for message with identifier %@";
          v20 = v18;
          v21 = OS_LOG_TYPE_DEFAULT;
LABEL_17:
          _os_log_impl(&dword_25B300000, v20, v21, v19, buf, 0xCu);
          goto LABEL_18;
        }

        goto LABEL_18;
      }
    }

    else
    {
      v26 = os_log_type_enabled(v15, OS_LOG_TYPE_ERROR);

      if (v26)
      {
        v18 = pk_Payment_log();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412290;
          v31 = v11;
          v19 = "Error: No message identifier for protobuf %@";
          v20 = v18;
          v21 = OS_LOG_TYPE_ERROR;
          goto LABEL_17;
        }

LABEL_18:
      }
    }

LABEL_20:
    goto LABEL_21;
  }

  v22 = pk_General_log();
  v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

  if (v23)
  {
    v7 = pk_General_log();
    if (os_log_type_enabled(&v7->super.super.super, OS_LOG_TYPE_ERROR))
    {
      v25 = *(a1 + 32);
      v24 = *(a1 + 40);
      *buf = 138478083;
      v31 = v24;
      v32 = 2113;
      v33 = v25;
      _os_log_impl(&dword_25B300000, &v7->super.super.super, OS_LOG_TYPE_ERROR, "Error: Unable to cache sharing message (%{private}@) for mailbox address (%{private}@)", buf, 0x16u);
    }

    goto LABEL_20;
  }

LABEL_21:
  v27 = *MEMORY[0x277D85DE8];
}

- (void)updateShareForPassIdentifier:(id)identifier share:(id)share authorization:(id)authorization completion:(id)completion
{
  identifierCopy = identifier;
  shareCopy = share;
  authorizationCopy = authorization;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __105__NPKPaymentWebServiceCompanionTargetDevice_updateShareForPassIdentifier_share_authorization_completion___block_invoke;
    block[3] = &unk_27994A730;
    v21 = identifierCopy;
    v22 = shareCopy;
    v23 = authorizationCopy;
    selfCopy = self;
    v25 = completionCopy;
    dispatch_sync(internalQueue, block);

    v15 = v21;
LABEL_9:

    goto LABEL_10;
  }

  v16 = pk_Payment_log();
  v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

  if (v17)
  {
    v18 = pk_Payment_log();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      *v19 = 0;
      _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v19, 2u);
    }
  }

  if (completionCopy)
  {
    v15 = PKDisplayableErrorForCommonType();
    (*(completionCopy + 2))(completionCopy, 0, v15);
    goto LABEL_9;
  }

LABEL_10:
}

void __105__NPKPaymentWebServiceCompanionTargetDevice_updateShareForPassIdentifier_share_authorization_completion___block_invoke(uint64_t a1)
{
  v47 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = *(a1 + 48);
      v8 = _Block_copy(*(a1 + 64));
      *buf = 138413058;
      v40 = v5;
      v41 = 2112;
      v42 = v6;
      v43 = 2112;
      v44 = v7;
      v45 = 2112;
      v46 = v8;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to update share for pass identifier: %@, share: %@, authorization: %@, completion: %@", buf, 0x2Au);
    }
  }

  if (*(a1 + 32) && *(a1 + 40))
  {
    v9 = objc_alloc_init(NPKProtoUpdateShareForPassIdentifierRequest);
    [(NPKProtoUpdateShareForPassIdentifierRequest *)v9 setPassIdentifier:*(a1 + 32)];
    v10 = NPKSecureArchiveObject(*(a1 + 40));
    [(NPKProtoUpdateShareForPassIdentifierRequest *)v9 setShareData:v10];

    [(NPKProtoUpdateShareForPassIdentifierRequest *)v9 setAuthorization:*(a1 + 48)];
    v11 = objc_alloc(MEMORY[0x277D189F0]);
    v12 = [(NPKProtoUpdateShareForPassIdentifierRequest *)v9 data];
    v13 = [v11 initWithProtobufData:v12 type:124 isResponse:0];

    v14 = *(a1 + 56);
    v37 = *MEMORY[0x277D18650];
    v38 = &unk_286CE7808;
    v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v38 forKeys:&v37 count:1];
    v16 = [v14 _sendProtobuf:v13 responseExpected:1 extraOptions:v15];

    if (v16)
    {
      v17 = *(a1 + 64);
      if (v17)
      {
        v18 = _Block_copy(v17);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __105__NPKPaymentWebServiceCompanionTargetDevice_updateShareForPassIdentifier_share_authorization_completion___block_invoke_908;
        aBlock[3] = &unk_279945218;
        v36 = *(a1 + 64);
        v19 = _Block_copy(aBlock);
        v20 = *(a1 + 56);
        v21 = _Block_copy(v18);
        [v20 _trackOutstandingRequestWithMessageIdentifier:v16 completionHandler:v21 errorHandler:v19];

LABEL_23:
        goto LABEL_24;
      }

      v32 = pk_Payment_log();
      v33 = os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT);

      if (v33)
      {
        v18 = pk_Payment_log();
        if (!os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_23;
        }

        *buf = 138412290;
        v40 = v16;
        v29 = "Warning: No response expected for message with identifier %@";
        v30 = v18;
        v31 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_22;
      }
    }

    else
    {
      v27 = pk_Payment_log();
      v28 = os_log_type_enabled(v27, OS_LOG_TYPE_ERROR);

      if (v28)
      {
        v18 = pk_Payment_log();
        if (!os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_23;
        }

        *buf = 138412290;
        v40 = v13;
        v29 = "Error: No message identifier for protobuf %@";
        v30 = v18;
        v31 = OS_LOG_TYPE_ERROR;
LABEL_22:
        _os_log_impl(&dword_25B300000, v30, v31, v29, buf, 0xCu);
        goto LABEL_23;
      }
    }

LABEL_24:

    goto LABEL_25;
  }

  v22 = pk_General_log();
  v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

  if (v23)
  {
    v24 = pk_General_log();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v26 = *(a1 + 32);
      v25 = *(a1 + 40);
      *buf = 138412546;
      v40 = v25;
      v41 = 2112;
      v42 = v26;
      _os_log_impl(&dword_25B300000, v24, OS_LOG_TYPE_ERROR, "Error: Unable to update share (%@) for pass identifier %@", buf, 0x16u);
    }
  }

  if (*(a1 + 64))
  {
    v9 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 64) + 16))();
LABEL_25:
  }

  v34 = *MEMORY[0x277D85DE8];
}

void __105__NPKPaymentWebServiceCompanionTargetDevice_updateShareForPassIdentifier_share_authorization_completion___block_invoke_908(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  if (*(a1 + 32))
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 32) + 16))();
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)updateShareForPassIdentifierResponse:(id)response
{
  v39 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target updateShareForPassIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__384;
  v37 = __Block_byref_object_dispose__385;
  v38 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x2020000000;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __82__NPKPaymentWebServiceCompanionTargetDevice_updateShareForPassIdentifierResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v31 + 24), v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __82__NPKPaymentWebServiceCompanionTargetDevice_updateShareForPassIdentifierResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoUpdateShareForPassIdentifierResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoUpdateShareForPassIdentifierResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoUpdateShareForPassIdentifierResponse *)v7 success];
    v12 = [(NPKProtoUpdateShareForPassIdentifierResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoUpdateShareForPassIdentifierResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)acceptCarKeyShareForMessage:(id)message activationCode:(id)code completion:(id)completion
{
  messageCopy = message;
  codeCopy = code;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharedInvitationProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_acceptCarKeyShareForMessage_activationCode_completion___block_invoke;
    block[3] = &unk_279945C50;
    v18 = messageCopy;
    v19 = codeCopy;
    selfCopy = self;
    v21 = completionCopy;
    dispatch_sync(internalQueue, block);

    v12 = v18;
LABEL_9:

    goto LABEL_10;
  }

  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      *v16 = 0;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support share invitation provisioning.", v16, 2u);
    }
  }

  if (completionCopy)
  {
    v12 = PKDisplayableErrorForCommonType();
    (*(completionCopy + 2))(completionCopy, 0, v12);
    goto LABEL_9;
  }

LABEL_10:
}

void __99__NPKPaymentWebServiceCompanionTargetDevice_acceptCarKeyShareForMessage_activationCode_completion___block_invoke(uint64_t a1)
{
  v43 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = _Block_copy(*(a1 + 56));
      *buf = 138478339;
      v38 = v5;
      v39 = 2113;
      v40 = v6;
      v41 = 2112;
      v42 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to accept car key share for message: %{private}@, activation code: %{private}@, completion: %@", buf, 0x20u);
    }
  }

  if (*(a1 + 32))
  {
    v8 = objc_alloc_init(NPKProtoAcceptCarKeyShareForMessageWithActivationCodeRequest);
    v9 = NPKSecureArchiveObject(*(a1 + 32));
    [(NPKProtoAcceptCarKeyShareForMessageWithActivationCodeRequest *)v8 setSharingMessageData:v9];

    [(NPKProtoAcceptCarKeyShareForMessageWithActivationCodeRequest *)v8 setActivationCode:*(a1 + 40)];
    v10 = objc_alloc(MEMORY[0x277D189F0]);
    v11 = [(NPKProtoAcceptCarKeyShareForMessageWithActivationCodeRequest *)v8 data];
    v12 = [v10 initWithProtobufData:v11 type:121 isResponse:0];

    v13 = *(a1 + 48);
    v35 = *MEMORY[0x277D18650];
    v36 = &unk_286CE7808;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    v15 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v14];

    if (v15)
    {
      v16 = *(a1 + 56);
      if (v16)
      {
        v17 = _Block_copy(v16);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __99__NPKPaymentWebServiceCompanionTargetDevice_acceptCarKeyShareForMessage_activationCode_completion___block_invoke_911;
        aBlock[3] = &unk_279945218;
        v34 = *(a1 + 56);
        v18 = _Block_copy(aBlock);
        v19 = *(a1 + 48);
        v20 = _Block_copy(v17);
        [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:v18];

LABEL_22:
        goto LABEL_23;
      }

      v30 = pk_Payment_log();
      v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

      if (v31)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v15;
        v27 = "Warning: No response expected for message with identifier %@";
        v28 = v17;
        v29 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v25 = pk_Payment_log();
      v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

      if (v26)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v12;
        v27 = "Error: No message identifier for protobuf %@";
        v28 = v17;
        v29 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v28, v29, v27, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v21 = pk_General_log();
  v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

  if (v22)
  {
    v23 = pk_General_log();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = *(a1 + 32);
      *buf = 138412290;
      v38 = v24;
      _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_ERROR, "Error: Unable to accept car key share with nil message (%@)", buf, 0xCu);
    }
  }

  if (*(a1 + 56))
  {
    v8 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 56) + 16))();
LABEL_24:
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __99__NPKPaymentWebServiceCompanionTargetDevice_acceptCarKeyShareForMessage_activationCode_completion___block_invoke_911(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  if (*(a1 + 32))
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(*(a1 + 32) + 16))();
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)acceptCarKeyShareForMessageResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target acceptCarKeyShareForMessageResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __81__NPKPaymentWebServiceCompanionTargetDevice_acceptCarKeyShareForMessageResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __81__NPKPaymentWebServiceCompanionTargetDevice_acceptCarKeyShareForMessageResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoAcceptCarKeyShareForMessageWithActivationCodeResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoAcceptCarKeyShareForMessageWithActivationCodeResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoAcceptCarKeyShareForMessageWithActivationCodeResponse *)v7 hasCarShareAcceptanceResponseData];
    if (v12)
    {
      v1 = [(NPKProtoAcceptCarKeyShareForMessageWithActivationCodeResponse *)v7 carShareAcceptanceResponseData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }

    v18 = [(NPKProtoAcceptCarKeyShareForMessageWithActivationCodeResponse *)v7 hasErrorData];
    if (v18)
    {
      v1 = [(NPKProtoAcceptCarKeyShareForMessageWithActivationCodeResponse *)v7 errorData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v1, v19);
    }

    else
    {
      v20 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v20);
    if (v18)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)carKeyStartShareAcceptanceFlow:(id)flow transportIdentifier:(id)identifier completion:(id)completion
{
  flowCopy = flow;
  identifierCopy = identifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_carKeyStartShareAcceptanceFlow_transportIdentifier_completion___block_invoke;
    block[3] = &unk_279945C50;
    v18 = flowCopy;
    v19 = identifierCopy;
    selfCopy = self;
    v21 = completionCopy;
    dispatch_sync(internalQueue, block);

    v12 = v18;
LABEL_9:

    goto LABEL_10;
  }

  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      *v16 = 0;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeyStartShareAcceptanceFlow:transportIdentifier:completion: message.", v16, 2u);
    }
  }

  if (completionCopy)
  {
    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, v12);
    goto LABEL_9;
  }

LABEL_10:
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_carKeyStartShareAcceptanceFlow_transportIdentifier_completion___block_invoke(uint64_t a1)
{
  v44 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = _Block_copy(*(a1 + 56));
      *buf = 138478339;
      v39 = v5;
      v40 = 2113;
      v41 = v6;
      v42 = 2112;
      v43 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to start car key share acceptance for invitation: %{private}@, transportIdentifier: %{private}@, completion: %@", buf, 0x20u);
    }
  }

  if (*(a1 + 32))
  {
    v8 = objc_alloc_init(NPKProtoCarKeyStartShareAcceptanceFlowRequest);
    v9 = NPKSecureArchiveObject(*(a1 + 32));
    [(NPKProtoCarKeyStartShareAcceptanceFlowRequest *)v8 setInvitationData:v9];

    [(NPKProtoCarKeyStartShareAcceptanceFlowRequest *)v8 setTransportationIdentifier:*(a1 + 40)];
    v10 = objc_alloc(MEMORY[0x277D189F0]);
    v11 = [(NPKProtoCarKeyStartShareAcceptanceFlowRequest *)v8 data];
    v12 = [v10 initWithProtobufData:v11 type:140 isResponse:0];

    v13 = *(a1 + 48);
    v36 = *MEMORY[0x277D18650];
    v37 = &unk_286CE7808;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v37 forKeys:&v36 count:1];
    v15 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v14];

    if (v15)
    {
      v16 = *(a1 + 56);
      if (v16)
      {
        v17 = _Block_copy(v16);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __107__NPKPaymentWebServiceCompanionTargetDevice_carKeyStartShareAcceptanceFlow_transportIdentifier_completion___block_invoke_915;
        aBlock[3] = &unk_279945218;
        v35 = *(a1 + 56);
        v18 = _Block_copy(aBlock);
        v19 = *(a1 + 48);
        v20 = _Block_copy(v17);
        [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:v18];

LABEL_22:
        goto LABEL_23;
      }

      v31 = pk_Payment_log();
      v32 = os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT);

      if (v32)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v39 = v15;
        v28 = "Warning: No response expected for message with identifier %@";
        v29 = v17;
        v30 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v26 = pk_Payment_log();
      v27 = os_log_type_enabled(v26, OS_LOG_TYPE_ERROR);

      if (v27)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v39 = v12;
        v28 = "Error: No message identifier for protobuf %@";
        v29 = v17;
        v30 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v29, v30, v28, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v21 = pk_General_log();
  v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

  if (v22)
  {
    v23 = pk_General_log();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = *(a1 + 32);
      *buf = 138477827;
      v39 = v24;
      _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_ERROR, "Error: Unable to start car key acceptance flow with nil invitation (%{private}@)", buf, 0xCu);
    }
  }

  v25 = *(a1 + 56);
  if (v25)
  {
    (*(v25 + 16))(v25, 0);
  }

LABEL_24:
  v33 = *MEMORY[0x277D85DE8];
}

void __107__NPKPaymentWebServiceCompanionTargetDevice_carKeyStartShareAcceptanceFlow_transportIdentifier_completion___block_invoke_915(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyStartShareAcceptanceFlowResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyStartShareAcceptanceFlowResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_carKeyStartShareAcceptanceFlowResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __84__NPKPaymentWebServiceCompanionTargetDevice_carKeyStartShareAcceptanceFlowResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCarKeyStartShareAcceptanceFlowResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCarKeyStartShareAcceptanceFlowResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCarKeyStartShareAcceptanceFlowResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoCarKeyStartShareAcceptanceFlowResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)carKeyRoutingInformationForInvitationWithIdentifier:(id)identifier transportIdentifier:(id)transportIdentifier completion:(id)completion
{
  identifierCopy = identifier;
  transportIdentifierCopy = transportIdentifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __128__NPKPaymentWebServiceCompanionTargetDevice_carKeyRoutingInformationForInvitationWithIdentifier_transportIdentifier_completion___block_invoke;
    block[3] = &unk_279945C50;
    v18 = identifierCopy;
    v19 = transportIdentifierCopy;
    selfCopy = self;
    v21 = completionCopy;
    dispatch_sync(internalQueue, block);

    v12 = v18;
LABEL_9:

    goto LABEL_10;
  }

  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      *v16 = 0;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeyRoutingInformationForInvitationWithIdentifier:transportIdentifier:completion: message.", v16, 2u);
    }
  }

  if (completionCopy)
  {
    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v12);
    goto LABEL_9;
  }

LABEL_10:
}

void __128__NPKPaymentWebServiceCompanionTargetDevice_carKeyRoutingInformationForInvitationWithIdentifier_transportIdentifier_completion___block_invoke(uint64_t a1)
{
  v43 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = _Block_copy(*(a1 + 56));
      *buf = 138478339;
      v38 = v5;
      v39 = 2113;
      v40 = v6;
      v41 = 2112;
      v42 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to fetch car key routing information for invitationIdentifier: (%{private}@), transportIdentifier: (%{private}@), completion: %@", buf, 0x20u);
    }
  }

  if ([*(a1 + 32) length])
  {
    goto LABEL_6;
  }

  v20 = pk_General_log();
  v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

  if (v21)
  {
    v22 = pk_General_log();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = *(a1 + 32);
      *buf = 138477827;
      v38 = v23;
      _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_ERROR, "Error: Unable to fetch car key routing information with nil empty invitationIdentifier (%{private}@)", buf, 0xCu);
    }
  }

  v24 = *(a1 + 56);
  if (!v24)
  {
LABEL_6:
    v8 = objc_alloc_init(NPKProtoCarKeyRoutingInformationRequest);
    [(NPKProtoCarKeyRoutingInformationRequest *)v8 setInvitationIdentifier:*(a1 + 32)];
    [(NPKProtoCarKeyRoutingInformationRequest *)v8 setTransportIdentifier:*(a1 + 40)];
    v9 = objc_alloc(MEMORY[0x277D189F0]);
    v10 = [(NPKProtoCarKeyRoutingInformationRequest *)v8 data];
    v11 = [v9 initWithProtobufData:v10 type:141 isResponse:0];

    v12 = *(a1 + 48);
    v35 = *MEMORY[0x277D18650];
    v36 = &unk_286CE7808;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    v14 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v13];

    if (v14)
    {
      v15 = *(a1 + 56);
      if (v15)
      {
        v16 = _Block_copy(v15);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __128__NPKPaymentWebServiceCompanionTargetDevice_carKeyRoutingInformationForInvitationWithIdentifier_transportIdentifier_completion___block_invoke_918;
        aBlock[3] = &unk_279945218;
        v34 = *(a1 + 56);
        v17 = _Block_copy(aBlock);
        v18 = *(a1 + 48);
        v19 = _Block_copy(v16);
        [v18 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v19 errorHandler:v17];

LABEL_22:
        goto LABEL_23;
      }

      v30 = pk_Payment_log();
      v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

      if (v31)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v14;
        v27 = "Warning: No response expected for message with identifier %@";
        v28 = v16;
        v29 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v25 = pk_Payment_log();
      v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

      if (v26)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v11;
        v27 = "Error: No message identifier for protobuf %@";
        v28 = v16;
        v29 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v28, v29, v27, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v8 = PKDisplayableErrorForCommonType();
  (*(v24 + 16))(v24, 0, v8);
LABEL_24:

  v32 = *MEMORY[0x277D85DE8];
}

void __128__NPKPaymentWebServiceCompanionTargetDevice_carKeyRoutingInformationForInvitationWithIdentifier_transportIdentifier_completion___block_invoke_918(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyRoutingInformationResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyRoutingInformationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__NPKPaymentWebServiceCompanionTargetDevice_carKeyRoutingInformationResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __78__NPKPaymentWebServiceCompanionTargetDevice_carKeyRoutingInformationResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCarKeyRoutingInformationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCarKeyRoutingInformationResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCarKeyRoutingInformationResponse *)v7 routingInformation];
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    v15 = [(NPKProtoCarKeyRoutingInformationResponse *)v7 hasErrorData];
    if (v15)
    {
      v1 = [(NPKProtoCarKeyRoutingInformationResponse *)v7 errorData];
      v16 = objc_opt_class();
      v17 = NPKSecureUnarchiveObject(v1, v16);
    }

    else
    {
      v17 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v17);
    if (v15)
    {
    }
  }

  else
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

    if (v19)
    {
      v20 = pk_Payment_log();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)carKeyGetProductPlanIdentifierRequestForInvitationWithIdentifier:(id)identifier transportIdentifier:(id)transportIdentifier completion:(id)completion
{
  identifierCopy = identifier;
  transportIdentifierCopy = transportIdentifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __141__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetProductPlanIdentifierRequestForInvitationWithIdentifier_transportIdentifier_completion___block_invoke;
    block[3] = &unk_279945C50;
    v18 = identifierCopy;
    v19 = transportIdentifierCopy;
    selfCopy = self;
    v21 = completionCopy;
    dispatch_sync(internalQueue, block);

    v12 = v18;
LABEL_9:

    goto LABEL_10;
  }

  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      *v16 = 0;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeyGetProductPlanIdentifierRequestForInvitationWithIdentifier:transportIdentifier:completion: message.", v16, 2u);
    }
  }

  if (completionCopy)
  {
    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v12);
    goto LABEL_9;
  }

LABEL_10:
}

void __141__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetProductPlanIdentifierRequestForInvitationWithIdentifier_transportIdentifier_completion___block_invoke(uint64_t a1)
{
  v43 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = _Block_copy(*(a1 + 56));
      *buf = 138478339;
      v38 = v5;
      v39 = 2113;
      v40 = v6;
      v41 = 2112;
      v42 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to get car key product plan identifier for invitationIdentifier: (%{private}@), transportIdentifier: (%{private}@), completion: %@", buf, 0x20u);
    }
  }

  if ([*(a1 + 32) length])
  {
    v8 = objc_alloc_init(NPKProtoCarKeyGetProductPlanIdentifierRequest);
    [(NPKProtoCarKeyGetProductPlanIdentifierRequest *)v8 setInvitationIdentifier:*(a1 + 32)];
    [(NPKProtoCarKeyGetProductPlanIdentifierRequest *)v8 setTransportIdentifier:*(a1 + 40)];
    v9 = objc_alloc(MEMORY[0x277D189F0]);
    v10 = [(NPKProtoCarKeyGetProductPlanIdentifierRequest *)v8 data];
    v11 = [v9 initWithProtobufData:v10 type:142 isResponse:0];

    v12 = *(a1 + 48);
    v35 = *MEMORY[0x277D18650];
    v36 = &unk_286CE7808;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    v14 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v13];

    if (v14)
    {
      v15 = *(a1 + 56);
      if (v15)
      {
        v16 = _Block_copy(v15);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __141__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetProductPlanIdentifierRequestForInvitationWithIdentifier_transportIdentifier_completion___block_invoke_921;
        aBlock[3] = &unk_279945218;
        v34 = *(a1 + 56);
        v17 = _Block_copy(aBlock);
        v18 = *(a1 + 48);
        v19 = _Block_copy(v16);
        [v18 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v19 errorHandler:v17];

LABEL_22:
        goto LABEL_23;
      }

      v30 = pk_Payment_log();
      v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

      if (v31)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v14;
        v27 = "Warning: No response expected for message with identifier %@";
        v28 = v16;
        v29 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v25 = pk_Payment_log();
      v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

      if (v26)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v11;
        v27 = "Error: No message identifier for protobuf %@";
        v28 = v16;
        v29 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v28, v29, v27, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v20 = pk_General_log();
  v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

  if (v21)
  {
    v22 = pk_General_log();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = *(a1 + 32);
      *buf = 138477827;
      v38 = v23;
      _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_ERROR, "Error: Unable to get car key product plan identifier with nil invitationIdentifier (%{private}@)", buf, 0xCu);
    }
  }

  v24 = *(a1 + 56);
  if (v24)
  {
    v8 = PKDisplayableErrorForCommonType();
    (*(v24 + 16))(v24, 0, v8);
LABEL_24:
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __141__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetProductPlanIdentifierRequestForInvitationWithIdentifier_transportIdentifier_completion___block_invoke_921(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyGetProductPlanIdentifierResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyGetProductPlanIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __84__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetProductPlanIdentifierResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __84__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetProductPlanIdentifierResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCarKeyGetProductPlanIdentifierResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCarKeyGetProductPlanIdentifierResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCarKeyGetProductPlanIdentifierResponse *)v7 hasContainerData];
    if (v12)
    {
      v1 = [(NPKProtoCarKeyGetProductPlanIdentifierResponse *)v7 containerData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }

    v18 = [(NPKProtoCarKeyGetProductPlanIdentifierResponse *)v7 hasErrorData];
    if (v18)
    {
      v1 = [(NPKProtoCarKeyGetProductPlanIdentifierResponse *)v7 errorData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v1, v19);
    }

    else
    {
      v20 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v20);
    if (v18)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)carKeySetEncryptedProductPlanIdentifierContainer:(id)container invitationIdentifier:(id)identifier completion:(id)completion
{
  containerCopy = container;
  identifierCopy = identifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __126__NPKPaymentWebServiceCompanionTargetDevice_carKeySetEncryptedProductPlanIdentifierContainer_invitationIdentifier_completion___block_invoke;
    block[3] = &unk_279945C50;
    v18 = containerCopy;
    v19 = identifierCopy;
    selfCopy = self;
    v21 = completionCopy;
    dispatch_sync(internalQueue, block);

    v12 = v18;
LABEL_9:

    goto LABEL_10;
  }

  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      *v16 = 0;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeySetEncryptedProductPlanIdentifierContainer:invitationIdentifier:completion: message.", v16, 2u);
    }
  }

  if (completionCopy)
  {
    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, v12);
    goto LABEL_9;
  }

LABEL_10:
}

void __126__NPKPaymentWebServiceCompanionTargetDevice_carKeySetEncryptedProductPlanIdentifierContainer_invitationIdentifier_completion___block_invoke(uint64_t a1)
{
  v44 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = _Block_copy(*(a1 + 56));
      *buf = 138478339;
      v39 = v5;
      v40 = 2113;
      v41 = v6;
      v42 = 2112;
      v43 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to set car key encrypted product plan container: (%{private}@), invitationIdentifier: (%{private}@), completion: %@", buf, 0x20u);
    }
  }

  if ([*(a1 + 40) length])
  {
    v8 = objc_alloc_init(NPKProtoCarKeySetEncryptedProductPlanIdentifierContainerRequest);
    v9 = NPKSecureArchiveObject(*(a1 + 32));
    [(NPKProtoCarKeySetEncryptedProductPlanIdentifierContainerRequest *)v8 setContainerData:v9];

    [(NPKProtoCarKeySetEncryptedProductPlanIdentifierContainerRequest *)v8 setInvitationIdentifier:*(a1 + 40)];
    v10 = objc_alloc(MEMORY[0x277D189F0]);
    v11 = [(NPKProtoCarKeySetEncryptedProductPlanIdentifierContainerRequest *)v8 data];
    v12 = [v10 initWithProtobufData:v11 type:143 isResponse:0];

    v13 = *(a1 + 48);
    v36 = *MEMORY[0x277D18650];
    v37 = &unk_286CE7808;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v37 forKeys:&v36 count:1];
    v15 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v14];

    if (v15)
    {
      v16 = *(a1 + 56);
      if (v16)
      {
        v17 = _Block_copy(v16);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __126__NPKPaymentWebServiceCompanionTargetDevice_carKeySetEncryptedProductPlanIdentifierContainer_invitationIdentifier_completion___block_invoke_925;
        aBlock[3] = &unk_279945218;
        v35 = *(a1 + 56);
        v18 = _Block_copy(aBlock);
        v19 = *(a1 + 48);
        v20 = _Block_copy(v17);
        [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:v18];

LABEL_22:
        goto LABEL_23;
      }

      v31 = pk_Payment_log();
      v32 = os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT);

      if (v32)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v39 = v15;
        v28 = "Warning: No response expected for message with identifier %@";
        v29 = v17;
        v30 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v26 = pk_Payment_log();
      v27 = os_log_type_enabled(v26, OS_LOG_TYPE_ERROR);

      if (v27)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v39 = v12;
        v28 = "Error: No message identifier for protobuf %@";
        v29 = v17;
        v30 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v29, v30, v28, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v21 = pk_General_log();
  v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

  if (v22)
  {
    v23 = pk_General_log();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = *(a1 + 40);
      *buf = 138477827;
      v39 = v24;
      _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_ERROR, "Error: Unable to set car key encrypted product plan container with empty invitationIdentifier (%{private}@)", buf, 0xCu);
    }
  }

  v25 = *(a1 + 56);
  if (v25)
  {
    v8 = PKDisplayableErrorForCommonType();
    (*(v25 + 16))(v25, v8);
LABEL_24:
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __126__NPKPaymentWebServiceCompanionTargetDevice_carKeySetEncryptedProductPlanIdentifierContainer_invitationIdentifier_completion___block_invoke_925(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeySetEncryptedProductPlanIdentifierContainerResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeySetEncryptedProductPlanIdentifierContainerResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __102__NPKPaymentWebServiceCompanionTargetDevice_carKeySetEncryptedProductPlanIdentifierContainerResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __102__NPKPaymentWebServiceCompanionTargetDevice_carKeySetEncryptedProductPlanIdentifierContainerResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCarKeySetEncryptedProductPlanIdentifierContainerResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCarKeySetEncryptedProductPlanIdentifierContainerResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCarKeySetEncryptedProductPlanIdentifierContainerResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoCarKeySetEncryptedProductPlanIdentifierContainerResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)carKeyAccountAttestationRequestForCredential:(id)credential completion:(id)completion
{
  credentialCopy = credential;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_carKeyAccountAttestationRequestForCredential_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v15 = credentialCopy;
    selfCopy = self;
    v17 = completionCopy;
    dispatch_sync(internalQueue, block);

    v9 = v15;
LABEL_9:

    goto LABEL_10;
  }

  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *v13 = 0;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeyAccountAttestationRequestForCredential:completion: message.", v13, 2u);
    }
  }

  if (completionCopy)
  {
    v9 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v9);
    goto LABEL_9;
  }

LABEL_10:
}

void __101__NPKPaymentWebServiceCompanionTargetDevice_carKeyAccountAttestationRequestForCredential_completion___block_invoke(uint64_t a1)
{
  v41 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138478083;
      v38 = v5;
      v39 = 2112;
      v40 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to fetch car key account attestation for credential: (%{private}@), completion: %@", buf, 0x16u);
    }
  }

  if (*(a1 + 32))
  {
    v7 = objc_alloc_init(NPKProtoCarKeyAccountAttestationRequest);
    v8 = [*(a1 + 40) _secureArchiveSubcredential:*(a1 + 32)];
    [(NPKProtoCarKeyAccountAttestationRequest *)v7 setCredentialData:v8];

    v9 = objc_alloc(MEMORY[0x277D189F0]);
    v10 = [(NPKProtoCarKeyAccountAttestationRequest *)v7 data];
    v11 = [v9 initWithProtobufData:v10 type:144 isResponse:0];

    v12 = *(a1 + 40);
    v35 = *MEMORY[0x277D18650];
    v36 = &unk_286CE7808;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    v14 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v13];

    if (v14)
    {
      v15 = *(a1 + 48);
      if (v15)
      {
        v16 = _Block_copy(v15);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __101__NPKPaymentWebServiceCompanionTargetDevice_carKeyAccountAttestationRequestForCredential_completion___block_invoke_928;
        aBlock[3] = &unk_279945218;
        v34 = *(a1 + 48);
        v17 = _Block_copy(aBlock);
        v18 = *(a1 + 40);
        v19 = _Block_copy(v16);
        [v18 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v19 errorHandler:v17];

LABEL_22:
        goto LABEL_23;
      }

      v30 = pk_Payment_log();
      v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

      if (v31)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v14;
        v27 = "Warning: No response expected for message with identifier %@";
        v28 = v16;
        v29 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v25 = pk_Payment_log();
      v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

      if (v26)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v11;
        v27 = "Error: No message identifier for protobuf %@";
        v28 = v16;
        v29 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v28, v29, v27, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v20 = pk_General_log();
  v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

  if (v21)
  {
    v22 = pk_General_log();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = *(a1 + 32);
      *buf = 138477827;
      v38 = v23;
      _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_ERROR, "Error: Unable to fetch car key account attestation with nil credential (%{private}@)", buf, 0xCu);
    }
  }

  v24 = *(a1 + 48);
  if (v24)
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(v24 + 16))(v24, 0, v7);
LABEL_24:
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __101__NPKPaymentWebServiceCompanionTargetDevice_carKeyAccountAttestationRequestForCredential_completion___block_invoke_928(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyAccountAttestationResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyAccountAttestationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__NPKPaymentWebServiceCompanionTargetDevice_carKeyAccountAttestationResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __78__NPKPaymentWebServiceCompanionTargetDevice_carKeyAccountAttestationResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCarKeyAccountAttestationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCarKeyAccountAttestationResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCarKeyAccountAttestationResponse *)v7 hasAttestationRequestData];
    if (v12)
    {
      v1 = [(NPKProtoCarKeyAccountAttestationResponse *)v7 attestationRequestData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }

    v18 = [(NPKProtoCarKeyAccountAttestationResponse *)v7 hasErrorData];
    if (v18)
    {
      v1 = [(NPKProtoCarKeyAccountAttestationResponse *)v7 errorData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v1, v19);
    }

    else
    {
      v20 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v20);
    if (v18)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)carKeyGetPretrackRequestForKeyWithInvitationIdentifier:(id)identifier completion:(id)completion
{
  identifierCopy = identifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __111__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetPretrackRequestForKeyWithInvitationIdentifier_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v15 = identifierCopy;
    selfCopy = self;
    v17 = completionCopy;
    dispatch_sync(internalQueue, block);

    v9 = v15;
LABEL_9:

    goto LABEL_10;
  }

  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *v13 = 0;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeyGetPretrackRequestForKeyWithInvitationIdentifier:completion: message.", v13, 2u);
    }
  }

  if (completionCopy)
  {
    v9 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v9);
    goto LABEL_9;
  }

LABEL_10:
}

void __111__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetPretrackRequestForKeyWithInvitationIdentifier_completion___block_invoke(uint64_t a1)
{
  v40 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138478083;
      v37 = v5;
      v38 = 2112;
      v39 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to get pretrack request for car key with invitationIdentifier: (%{private}@), completion: %@", buf, 0x16u);
    }
  }

  if ([*(a1 + 32) length])
  {
    v7 = objc_alloc_init(NPKProtoCarKeyGetPretrackRequest);
    [(NPKProtoCarKeyGetPretrackRequest *)v7 setInvitationIdentifier:*(a1 + 32)];
    v8 = objc_alloc(MEMORY[0x277D189F0]);
    v9 = [(NPKProtoCarKeyGetPretrackRequest *)v7 data];
    v10 = [v8 initWithProtobufData:v9 type:145 isResponse:0];

    v11 = *(a1 + 40);
    v34 = *MEMORY[0x277D18650];
    v35 = &unk_286CE7808;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v35 forKeys:&v34 count:1];
    v13 = [v11 _sendProtobuf:v10 responseExpected:1 extraOptions:v12];

    if (v13)
    {
      v14 = *(a1 + 48);
      if (v14)
      {
        v15 = _Block_copy(v14);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __111__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetPretrackRequestForKeyWithInvitationIdentifier_completion___block_invoke_932;
        aBlock[3] = &unk_279945218;
        v33 = *(a1 + 48);
        v16 = _Block_copy(aBlock);
        v17 = *(a1 + 40);
        v18 = _Block_copy(v15);
        [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_22:
        goto LABEL_23;
      }

      v29 = pk_Payment_log();
      v30 = os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT);

      if (v30)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v13;
        v26 = "Warning: No response expected for message with identifier %@";
        v27 = v15;
        v28 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v24 = pk_Payment_log();
      v25 = os_log_type_enabled(v24, OS_LOG_TYPE_ERROR);

      if (v25)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v10;
        v26 = "Error: No message identifier for protobuf %@";
        v27 = v15;
        v28 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v27, v28, v26, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v19 = pk_General_log();
  v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

  if (v20)
  {
    v21 = pk_General_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = *(a1 + 32);
      *buf = 138477827;
      v37 = v22;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_ERROR, "Error: Unable to get pretrack request for car key with nil invitationIdentifier (%{private}@)", buf, 0xCu);
    }
  }

  v23 = *(a1 + 48);
  if (v23)
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(v23 + 16))(v23, 0, v7);
LABEL_24:
  }

  v31 = *MEMORY[0x277D85DE8];
}

void __111__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetPretrackRequestForKeyWithInvitationIdentifier_completion___block_invoke_932(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyGetPretrackResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyGetPretrackResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetPretrackResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __71__NPKPaymentWebServiceCompanionTargetDevice_carKeyGetPretrackResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCarKeyGetPretrackResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCarKeyGetPretrackResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCarKeyGetPretrackResponse *)v7 hasPreTrackRequestData];
    if (v12)
    {
      v1 = [(NPKProtoCarKeyGetPretrackResponse *)v7 preTrackRequestData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }

    v18 = [(NPKProtoCarKeyGetPretrackResponse *)v7 hasErrorData];
    if (v18)
    {
      v1 = [(NPKProtoCarKeyGetPretrackResponse *)v7 errorData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v1, v19);
    }

    else
    {
      v20 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v20);
    if (v18)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)carKeySetAccountAttestation:(id)attestation forCredential:(id)credential completion:(id)completion
{
  attestationCopy = attestation;
  credentialCopy = credential;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __98__NPKPaymentWebServiceCompanionTargetDevice_carKeySetAccountAttestation_forCredential_completion___block_invoke;
    block[3] = &unk_279945C50;
    v18 = attestationCopy;
    v19 = credentialCopy;
    selfCopy = self;
    v21 = completionCopy;
    dispatch_sync(internalQueue, block);

    v12 = v18;
LABEL_9:

    goto LABEL_10;
  }

  v13 = pk_Payment_log();
  v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

  if (v14)
  {
    v15 = pk_Payment_log();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      *v16 = 0;
      _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeySetAccountAttestation:forCredential:completion: message.", v16, 2u);
    }
  }

  if (completionCopy)
  {
    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, v12);
    goto LABEL_9;
  }

LABEL_10:
}

void __98__NPKPaymentWebServiceCompanionTargetDevice_carKeySetAccountAttestation_forCredential_completion___block_invoke(uint64_t a1)
{
  v44 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = _Block_copy(*(a1 + 56));
      *buf = 138478339;
      v39 = v5;
      v40 = 2113;
      v41 = v6;
      v42 = 2112;
      v43 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to set car key account attestation: (%{private}@), credential: (%{private}@), completion: %@", buf, 0x20u);
    }
  }

  if (*(a1 + 40))
  {
    v8 = objc_alloc_init(NPKProtoCarKeySetAccountAttestationRequest);
    [(NPKProtoCarKeySetAccountAttestationRequest *)v8 setAttestation:*(a1 + 32)];
    v9 = [*(a1 + 48) _secureArchiveSubcredential:*(a1 + 40)];
    [(NPKProtoCarKeySetAccountAttestationRequest *)v8 setCredentialData:v9];

    v10 = objc_alloc(MEMORY[0x277D189F0]);
    v11 = [(NPKProtoCarKeySetAccountAttestationRequest *)v8 data];
    v12 = [v10 initWithProtobufData:v11 type:146 isResponse:0];

    v13 = *(a1 + 48);
    v36 = *MEMORY[0x277D18650];
    v37 = &unk_286CE7808;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v37 forKeys:&v36 count:1];
    v15 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v14];

    if (v15)
    {
      v16 = *(a1 + 56);
      if (v16)
      {
        v17 = _Block_copy(v16);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __98__NPKPaymentWebServiceCompanionTargetDevice_carKeySetAccountAttestation_forCredential_completion___block_invoke_935;
        aBlock[3] = &unk_279945218;
        v35 = *(a1 + 56);
        v18 = _Block_copy(aBlock);
        v19 = *(a1 + 48);
        v20 = _Block_copy(v17);
        [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:v18];

LABEL_22:
        goto LABEL_23;
      }

      v31 = pk_Payment_log();
      v32 = os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT);

      if (v32)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v39 = v15;
        v28 = "Warning: No response expected for message with identifier %@";
        v29 = v17;
        v30 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v26 = pk_Payment_log();
      v27 = os_log_type_enabled(v26, OS_LOG_TYPE_ERROR);

      if (v27)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v39 = v12;
        v28 = "Error: No message identifier for protobuf %@";
        v29 = v17;
        v30 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v29, v30, v28, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v21 = pk_General_log();
  v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

  if (v22)
  {
    v23 = pk_General_log();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = *(a1 + 40);
      *buf = 138477827;
      v39 = v24;
      _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_ERROR, "Error: Unable to  set car key account attestation with nil credential (%{private}@)", buf, 0xCu);
    }
  }

  v25 = *(a1 + 56);
  if (v25)
  {
    v8 = PKDisplayableErrorForCommonType();
    (*(v25 + 16))(v25, v8);
LABEL_24:
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __98__NPKPaymentWebServiceCompanionTargetDevice_carKeySetAccountAttestation_forCredential_completion___block_invoke_935(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeySetAccountAttestationResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeySetAccountAttestationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __81__NPKPaymentWebServiceCompanionTargetDevice_carKeySetAccountAttestationResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __81__NPKPaymentWebServiceCompanionTargetDevice_carKeySetAccountAttestationResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCarKeySetAccountAttestationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCarKeySetAccountAttestationResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCarKeySetAccountAttestationResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoCarKeySetAccountAttestationResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)carKeyUpdateTrackingAttestation:(id)attestation forCredential:(id)credential encryptedContainer:(id)container completion:(id)completion
{
  attestationCopy = attestation;
  credentialCopy = credential;
  containerCopy = container;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __121__NPKPaymentWebServiceCompanionTargetDevice_carKeyUpdateTrackingAttestation_forCredential_encryptedContainer_completion___block_invoke;
    block[3] = &unk_27994A730;
    v20 = attestationCopy;
    v21 = credentialCopy;
    v22 = containerCopy;
    selfCopy = self;
    v24 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        *v18 = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeyUpdateTrackingAttestation:forCredential:encryptedContainer:completion: message.", v18, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __121__NPKPaymentWebServiceCompanionTargetDevice_carKeyUpdateTrackingAttestation_forCredential_encryptedContainer_completion___block_invoke(uint64_t a1)
{
  v48 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = *(a1 + 48);
      v8 = _Block_copy(*(a1 + 64));
      *buf = 138478595;
      v41 = v5;
      v42 = 2113;
      v43 = v6;
      v44 = 2113;
      v45 = v7;
      v46 = 2112;
      v47 = v8;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to update car key tracking attestation: (%{private}@), credential: (%{private}@), container: (%{private}@), completion: %@", buf, 0x2Au);
    }
  }

  if (*(a1 + 40))
  {
    v9 = objc_alloc_init(NPKProtoCarKeyUpdateTrackingAttestationRequest);
    [(NPKProtoCarKeyUpdateTrackingAttestationRequest *)v9 setAttestation:*(a1 + 32)];
    v10 = [*(a1 + 56) _secureArchiveSubcredential:*(a1 + 40)];
    [(NPKProtoCarKeyUpdateTrackingAttestationRequest *)v9 setCredentialData:v10];

    v11 = NPKSecureArchiveObject(*(a1 + 48));
    [(NPKProtoCarKeyUpdateTrackingAttestationRequest *)v9 setContainerData:v11];

    v12 = objc_alloc(MEMORY[0x277D189F0]);
    v13 = [(NPKProtoCarKeyUpdateTrackingAttestationRequest *)v9 data];
    v14 = [v12 initWithProtobufData:v13 type:147 isResponse:0];

    v15 = *(a1 + 56);
    v38 = *MEMORY[0x277D18650];
    v39 = &unk_286CE7808;
    v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v39 forKeys:&v38 count:1];
    v17 = [v15 _sendProtobuf:v14 responseExpected:1 extraOptions:v16];

    if (v17)
    {
      v18 = *(a1 + 64);
      if (v18)
      {
        v19 = _Block_copy(v18);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __121__NPKPaymentWebServiceCompanionTargetDevice_carKeyUpdateTrackingAttestation_forCredential_encryptedContainer_completion___block_invoke_938;
        aBlock[3] = &unk_279945218;
        v37 = *(a1 + 64);
        v20 = _Block_copy(aBlock);
        v21 = *(a1 + 56);
        v22 = _Block_copy(v19);
        [v21 _trackOutstandingRequestWithMessageIdentifier:v17 completionHandler:v22 errorHandler:v20];

LABEL_22:
        goto LABEL_23;
      }

      v33 = pk_Payment_log();
      v34 = os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT);

      if (v34)
      {
        v19 = pk_Payment_log();
        if (!os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v41 = v17;
        v30 = "Warning: No response expected for message with identifier %@";
        v31 = v19;
        v32 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v28 = pk_Payment_log();
      v29 = os_log_type_enabled(v28, OS_LOG_TYPE_ERROR);

      if (v29)
      {
        v19 = pk_Payment_log();
        if (!os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v41 = v14;
        v30 = "Error: No message identifier for protobuf %@";
        v31 = v19;
        v32 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v31, v32, v30, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v23 = pk_General_log();
  v24 = os_log_type_enabled(v23, OS_LOG_TYPE_ERROR);

  if (v24)
  {
    v25 = pk_General_log();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = *(a1 + 40);
      *buf = 138477827;
      v41 = v26;
      _os_log_impl(&dword_25B300000, v25, OS_LOG_TYPE_ERROR, "Error: Unable to update car key tracking attestation with nil credential (%{private}@)", buf, 0xCu);
    }
  }

  v27 = *(a1 + 64);
  if (v27)
  {
    (*(v27 + 16))(v27, 0);
  }

LABEL_24:
  v35 = *MEMORY[0x277D85DE8];
}

void __121__NPKPaymentWebServiceCompanionTargetDevice_carKeyUpdateTrackingAttestation_forCredential_encryptedContainer_completion___block_invoke_938(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, v3 == 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyUpdateTrackingAttestationResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyUpdateTrackingAttestationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __85__NPKPaymentWebServiceCompanionTargetDevice_carKeyUpdateTrackingAttestationResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __85__NPKPaymentWebServiceCompanionTargetDevice_carKeyUpdateTrackingAttestationResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoCarKeyUpdateTrackingAttestationResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoCarKeyUpdateTrackingAttestationResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = [(NPKProtoCarKeyUpdateTrackingAttestationResponse *)v6 hasSuccess];
    if (v11)
    {
      LOBYTE(v11) = [(NPKProtoCarKeyUpdateTrackingAttestationResponse *)v6 success];
    }

    *(*(*(a1 + 64) + 8) + 24) = v11;
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        v15[0] = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v15, 2u);
      }
    }
  }
}

- (void)carKeyAcceptInvitationWithInvitationIdentifier:(id)identifier activationCode:(id)code analyticsUpdateConfig:(id)config completion:(id)completion
{
  identifierCopy = identifier;
  codeCopy = code;
  configCopy = config;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __140__NPKPaymentWebServiceCompanionTargetDevice_carKeyAcceptInvitationWithInvitationIdentifier_activationCode_analyticsUpdateConfig_completion___block_invoke;
    block[3] = &unk_27994A730;
    v20 = identifierCopy;
    v21 = codeCopy;
    v22 = configCopy;
    selfCopy = self;
    v24 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        *v18 = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support acceptSharingMessage:activationCode:completion: message.", v18, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __140__NPKPaymentWebServiceCompanionTargetDevice_carKeyAcceptInvitationWithInvitationIdentifier_activationCode_analyticsUpdateConfig_completion___block_invoke(uint64_t a1)
{
  v48 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = *(a1 + 48);
      v8 = _Block_copy(*(a1 + 64));
      *buf = 138478595;
      v41 = v5;
      v42 = 2113;
      v43 = v6;
      v44 = 2113;
      v45 = v7;
      v46 = 2112;
      v47 = v8;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to accept car key invitation with identifier: %{private}@, activation code: %{private}@, analytics update config: %{private}@, completion: %@", buf, 0x2Au);
    }
  }

  if (*(a1 + 32))
  {
    v9 = objc_alloc_init(NPKProtoCarKeyAcceptInvitationRequest);
    [(NPKProtoCarKeyAcceptInvitationRequest *)v9 setInvitationIdentifier:*(a1 + 32)];
    [(NPKProtoCarKeyAcceptInvitationRequest *)v9 setActivationCode:*(a1 + 40)];
    v10 = *(a1 + 48);
    if (v10 && [v10 conformsToProtocol:&unk_286CE8820])
    {
      v11 = NPKSecureArchiveObject(*(a1 + 48));
      [(NPKProtoCarKeyAcceptInvitationRequest *)v9 setAnalyticsUpdateConfigData:v11];
    }

    v12 = objc_alloc(MEMORY[0x277D189F0]);
    v13 = [(NPKProtoCarKeyAcceptInvitationRequest *)v9 data];
    v14 = [v12 initWithProtobufData:v13 type:148 isResponse:0];

    v15 = *(a1 + 56);
    v38 = *MEMORY[0x277D18650];
    v39 = &unk_286CE7808;
    v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v39 forKeys:&v38 count:1];
    v17 = [v15 _sendProtobuf:v14 responseExpected:1 extraOptions:v16];

    if (v17)
    {
      v18 = *(a1 + 64);
      if (v18)
      {
        v19 = _Block_copy(v18);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __140__NPKPaymentWebServiceCompanionTargetDevice_carKeyAcceptInvitationWithInvitationIdentifier_activationCode_analyticsUpdateConfig_completion___block_invoke_950;
        aBlock[3] = &unk_279945218;
        v37 = *(a1 + 64);
        v20 = _Block_copy(aBlock);
        v21 = *(a1 + 56);
        v22 = _Block_copy(v19);
        [v21 _trackOutstandingRequestWithMessageIdentifier:v17 completionHandler:v22 errorHandler:v20];

LABEL_25:
        goto LABEL_26;
      }

      v33 = pk_Payment_log();
      v34 = os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT);

      if (v34)
      {
        v19 = pk_Payment_log();
        if (!os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_25;
        }

        *buf = 138412290;
        v41 = v17;
        v30 = "Warning: No response expected for message with identifier %@";
        v31 = v19;
        v32 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_24;
      }
    }

    else
    {
      v28 = pk_Payment_log();
      v29 = os_log_type_enabled(v28, OS_LOG_TYPE_ERROR);

      if (v29)
      {
        v19 = pk_Payment_log();
        if (!os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_25;
        }

        *buf = 138412290;
        v41 = v14;
        v30 = "Error: No message identifier for protobuf %@";
        v31 = v19;
        v32 = OS_LOG_TYPE_ERROR;
LABEL_24:
        _os_log_impl(&dword_25B300000, v31, v32, v30, buf, 0xCu);
        goto LABEL_25;
      }
    }

LABEL_26:

    goto LABEL_27;
  }

  v23 = pk_General_log();
  v24 = os_log_type_enabled(v23, OS_LOG_TYPE_ERROR);

  if (v24)
  {
    v25 = pk_General_log();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = *(a1 + 32);
      *buf = 138477827;
      v41 = v26;
      _os_log_impl(&dword_25B300000, v25, OS_LOG_TYPE_ERROR, "Error: Unable to accept car key invitation with nil invitationIdentifier (%{private}@)", buf, 0xCu);
    }
  }

  v27 = *(a1 + 64);
  if (v27)
  {
    (*(v27 + 16))(v27, 0);
  }

LABEL_27:
  v35 = *MEMORY[0x277D85DE8];
}

void __140__NPKPaymentWebServiceCompanionTargetDevice_carKeyAcceptInvitationWithInvitationIdentifier_activationCode_analyticsUpdateConfig_completion___block_invoke_950(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyAcceptInvitationResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyAcceptInvitationWithInvitationIdentifierResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_carKeyAcceptInvitationResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __76__NPKPaymentWebServiceCompanionTargetDevice_carKeyAcceptInvitationResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCarKeyAcceptInvitationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCarKeyAcceptInvitationResponse *)v5 initWithData:v6];

    if ([(NPKProtoCarKeyAcceptInvitationResponse *)v7 pending])
    {
      [v4 setOrResetCleanupTimer];
    }

    else
    {
      v11 = [*(a1 + 32) outstandingRequests];
      [v11 removeObjectForKey:*(a1 + 40)];

      v12 = [v4 completionHandler];
      v13 = *(*(a1 + 56) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      v15 = [(NPKProtoCarKeyAcceptInvitationResponse *)v7 hasResultData];
      if (v15)
      {
        v1 = [(NPKProtoCarKeyAcceptInvitationResponse *)v7 resultData];
        v16 = objc_opt_class();
        v17 = NPKSecureUnarchiveObject(v1, v16);
      }

      else
      {
        v17 = 0;
      }

      objc_storeStrong((*(*(a1 + 64) + 8) + 40), v17);
      if (v15)
      {
      }
    }
  }

  else
  {
    v8 = pk_Payment_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_Payment_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)carKeyHandleRecipientMessage:(id)message forInvitationIdentifier:(id)identifier completion:(id)completion
{
  messageCopy = message;
  identifierCopy = identifier;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __109__NPKPaymentWebServiceCompanionTargetDevice_carKeyHandleRecipientMessage_forInvitationIdentifier_completion___block_invoke;
    block[3] = &unk_279945C50;
    v17 = messageCopy;
    v18 = identifierCopy;
    selfCopy = self;
    v20 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        *v15 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeyHandleRecipientMessage:forInvitationIdentifier:completion: message.", v15, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __109__NPKPaymentWebServiceCompanionTargetDevice_carKeyHandleRecipientMessage_forInvitationIdentifier_completion___block_invoke(uint64_t a1)
{
  v45 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = _Block_copy(*(a1 + 56));
      *buf = 138478339;
      v40 = v5;
      v41 = 2113;
      v42 = v6;
      v43 = 2112;
      v44 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Handle car key recipient message: %{private}@, for invitationIdentifier: %{private}@, completion: %@", buf, 0x20u);
    }
  }

  if (*(a1 + 32) && [*(a1 + 40) length])
  {
    v8 = objc_alloc_init(NPKProtoCarKeyHandleRecipientMessageRequest);
    v9 = NPKSecureArchiveObject(*(a1 + 32));
    [(NPKProtoCarKeyHandleRecipientMessageRequest *)v8 setMessageData:v9];

    [(NPKProtoCarKeyHandleRecipientMessageRequest *)v8 setInvitationIdentifier:*(a1 + 40)];
    v10 = objc_alloc(MEMORY[0x277D189F0]);
    v11 = [(NPKProtoCarKeyHandleRecipientMessageRequest *)v8 data];
    v12 = [v10 initWithProtobufData:v11 type:149 isResponse:0];

    v13 = *(a1 + 48);
    v37 = *MEMORY[0x277D18650];
    v38 = &unk_286CE7808;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v38 forKeys:&v37 count:1];
    v15 = [v13 _sendProtobuf:v12 responseExpected:1 extraOptions:v14];

    if (v15)
    {
      v16 = *(a1 + 56);
      if (v16)
      {
        v17 = _Block_copy(v16);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __109__NPKPaymentWebServiceCompanionTargetDevice_carKeyHandleRecipientMessage_forInvitationIdentifier_completion___block_invoke_954;
        aBlock[3] = &unk_279945218;
        v36 = *(a1 + 56);
        v18 = _Block_copy(aBlock);
        v19 = *(a1 + 48);
        v20 = _Block_copy(v17);
        [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:v18];

LABEL_23:
        goto LABEL_24;
      }

      v32 = pk_Payment_log();
      v33 = os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT);

      if (v33)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_23;
        }

        *buf = 138412290;
        v40 = v15;
        v29 = "Warning: No response expected for message with identifier %@";
        v30 = v17;
        v31 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_22;
      }
    }

    else
    {
      v27 = pk_Payment_log();
      v28 = os_log_type_enabled(v27, OS_LOG_TYPE_ERROR);

      if (v28)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_23;
        }

        *buf = 138412290;
        v40 = v12;
        v29 = "Error: No message identifier for protobuf %@";
        v30 = v17;
        v31 = OS_LOG_TYPE_ERROR;
LABEL_22:
        _os_log_impl(&dword_25B300000, v30, v31, v29, buf, 0xCu);
        goto LABEL_23;
      }
    }

LABEL_24:

    goto LABEL_25;
  }

  v21 = pk_General_log();
  v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

  if (v22)
  {
    v23 = pk_General_log();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = *(a1 + 32);
      v25 = *(a1 + 40);
      *buf = 138478083;
      v40 = v24;
      v41 = 2113;
      v42 = v25;
      _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_ERROR, "Error: Unable to handle nil message (%{private}@) or empty invitation identifier (%{private}@)", buf, 0x16u);
    }
  }

  v26 = *(a1 + 56);
  if (v26)
  {
    (*(v26 + 16))(v26, 0);
  }

LABEL_25:
  v34 = *MEMORY[0x277D85DE8];
}

void __109__NPKPaymentWebServiceCompanionTargetDevice_carKeyHandleRecipientMessage_forInvitationIdentifier_completion___block_invoke_954(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyHandleRecipientMessageResponse:(id)response
{
  v34 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyHandleRecipientMessageResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__384;
  v32 = __Block_byref_object_dispose__385;
  v33 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x3032000000;
  v26 = __Block_byref_object_copy__22;
  v27 = __Block_byref_object_dispose__22;
  v28 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __82__NPKPaymentWebServiceCompanionTargetDevice_carKeyHandleRecipientMessageResponse___block_invoke;
    block[3] = &unk_279949F68;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    p_buf = &buf;
    v20 = responseCopy;
    v22 = &v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v24[5]);
  }

  _Block_object_dispose(&v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __82__NPKPaymentWebServiceCompanionTargetDevice_carKeyHandleRecipientMessageResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [*(a1 + 32) outstandingRequests];
    [v5 removeObjectForKey:*(a1 + 40)];

    v6 = [v4 completionHandler];
    v7 = *(*(a1 + 56) + 8);
    v8 = *(v7 + 40);
    *(v7 + 40) = v6;

    v9 = [NPKProtoCarKeyHandleRecipientMessageResponse alloc];
    v10 = [*(a1 + 48) data];
    v11 = [(NPKProtoCarKeyHandleRecipientMessageResponse *)v9 initWithData:v10];

    v12 = [(NPKProtoCarKeyHandleRecipientMessageResponse *)v11 hasResultData];
    if (v12)
    {
      v1 = [(NPKProtoCarKeyHandleRecipientMessageResponse *)v11 resultData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)carKeyRetryActivationCodeWithInvitationIdentifier:(id)identifier activationCode:(id)code completion:(id)completion
{
  identifierCopy = identifier;
  codeCopy = code;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __121__NPKPaymentWebServiceCompanionTargetDevice_carKeyRetryActivationCodeWithInvitationIdentifier_activationCode_completion___block_invoke;
    block[3] = &unk_279945C50;
    v17 = codeCopy;
    v18 = identifierCopy;
    selfCopy = self;
    v20 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        *v15 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeyRetryActivationCodeWithInvitationIdentifier:activationCode:completion: message.", v15, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __121__NPKPaymentWebServiceCompanionTargetDevice_carKeyRetryActivationCodeWithInvitationIdentifier_activationCode_completion___block_invoke(uint64_t a1)
{
  v44 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = _Block_copy(*(a1 + 56));
      *buf = 138478339;
      v39 = v5;
      v40 = 2113;
      v41 = v6;
      v42 = 2112;
      v43 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to retry activation code: %{private}@, for invitation identifier: %{private}@, completion: %@", buf, 0x20u);
    }
  }

  if ([*(a1 + 32) length] && objc_msgSend(*(a1 + 40), "length"))
  {
    v8 = objc_alloc_init(NPKProtoCarKeyRetryActivationCodeRequest);
    [(NPKProtoCarKeyRetryActivationCodeRequest *)v8 setInvitationIdentifier:*(a1 + 40)];
    [(NPKProtoCarKeyRetryActivationCodeRequest *)v8 setActivationCode:*(a1 + 32)];
    v9 = objc_alloc(MEMORY[0x277D189F0]);
    v10 = [(NPKProtoCarKeyRetryActivationCodeRequest *)v8 data];
    v11 = [v9 initWithProtobufData:v10 type:150 isResponse:0];

    v12 = *(a1 + 48);
    v36 = *MEMORY[0x277D18650];
    v37 = &unk_286CE7808;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v37 forKeys:&v36 count:1];
    v14 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v13];

    if (v14)
    {
      v15 = *(a1 + 56);
      if (v15)
      {
        v16 = _Block_copy(v15);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __121__NPKPaymentWebServiceCompanionTargetDevice_carKeyRetryActivationCodeWithInvitationIdentifier_activationCode_completion___block_invoke_957;
        aBlock[3] = &unk_279945218;
        v35 = *(a1 + 56);
        v17 = _Block_copy(aBlock);
        v18 = *(a1 + 48);
        v19 = _Block_copy(v16);
        [v18 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v19 errorHandler:v17];

LABEL_23:
        goto LABEL_24;
      }

      v31 = pk_Payment_log();
      v32 = os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT);

      if (v32)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_23;
        }

        *buf = 138412290;
        v39 = v14;
        v28 = "Warning: No response expected for message with identifier %@";
        v29 = v16;
        v30 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_22;
      }
    }

    else
    {
      v26 = pk_Payment_log();
      v27 = os_log_type_enabled(v26, OS_LOG_TYPE_ERROR);

      if (v27)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_23;
        }

        *buf = 138412290;
        v39 = v11;
        v28 = "Error: No message identifier for protobuf %@";
        v29 = v16;
        v30 = OS_LOG_TYPE_ERROR;
LABEL_22:
        _os_log_impl(&dword_25B300000, v29, v30, v28, buf, 0xCu);
        goto LABEL_23;
      }
    }

LABEL_24:

    goto LABEL_25;
  }

  v20 = pk_General_log();
  v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

  if (v21)
  {
    v22 = pk_General_log();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = *(a1 + 32);
      v24 = *(a1 + 40);
      *buf = 138478083;
      v39 = v23;
      v40 = 2113;
      v41 = v24;
      _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_ERROR, "Error: Unable to retry activation code with nil code (%{private}@) or invitation identifier (%{private}@)", buf, 0x16u);
    }
  }

  v25 = *(a1 + 56);
  if (v25)
  {
    (*(v25 + 16))(v25, 0);
  }

LABEL_25:
  v33 = *MEMORY[0x277D85DE8];
}

void __121__NPKPaymentWebServiceCompanionTargetDevice_carKeyRetryActivationCodeWithInvitationIdentifier_activationCode_completion___block_invoke_957(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyRetryActivationCodeResponse:(id)response
{
  v30 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyRetryActivationCodeResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__384;
  v28 = __Block_byref_object_dispose__385;
  v29 = 0;
  v23[0] = 0;
  v23[1] = v23;
  v23[2] = 0x3032000000;
  v23[3] = __Block_byref_object_copy__22;
  v23[4] = __Block_byref_object_dispose__22;
  v24 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __79__NPKPaymentWebServiceCompanionTargetDevice_carKeyRetryActivationCodeResponse___block_invoke;
    block[3] = &unk_279949F68;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    p_buf = &buf;
    v20 = responseCopy;
    v22 = v23;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, 0);
  }

  _Block_object_dispose(v23, 8);

  _Block_object_dispose(&buf, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __79__NPKPaymentWebServiceCompanionTargetDevice_carKeyRetryActivationCodeResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [*(a1 + 32) outstandingRequests];
    [v5 removeObjectForKey:*(a1 + 40)];

    v6 = [v4 completionHandler];
    v7 = *(*(a1 + 56) + 8);
    v8 = *(v7 + 40);
    *(v7 + 40) = v6;

    v9 = [NPKProtoCarKeyRetryActivationCodeResponse alloc];
    v10 = [*(a1 + 48) data];
    v11 = [(NPKProtoCarKeyRetryActivationCodeResponse *)v9 initWithData:v10];

    v12 = [(NPKProtoCarKeyRetryActivationCodeResponse *)v11 hasResultData];
    if (v12)
    {
      v1 = [(NPKProtoCarKeyRetryActivationCodeResponse *)v11 resultData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)carKeyDecryptData:(id)data credential:(id)credential ephemeralPublicKey:(id)key completion:(id)completion
{
  dataCopy = data;
  credentialCopy = credential;
  keyCopy = key;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __104__NPKPaymentWebServiceCompanionTargetDevice_carKeyDecryptData_credential_ephemeralPublicKey_completion___block_invoke;
    block[3] = &unk_27994A730;
    v21 = dataCopy;
    v22 = credentialCopy;
    v23 = keyCopy;
    selfCopy = self;
    v25 = completionCopy;
    dispatch_sync(internalQueue, block);

    v15 = v21;
LABEL_9:

    goto LABEL_10;
  }

  v16 = pk_Payment_log();
  v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

  if (v17)
  {
    v18 = pk_Payment_log();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      *v19 = 0;
      _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeyDecryptData:credential:ephemeralPublicKey:completion: message.", v19, 2u);
    }
  }

  if (completionCopy)
  {
    v15 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v15);
    goto LABEL_9;
  }

LABEL_10:
}

void __104__NPKPaymentWebServiceCompanionTargetDevice_carKeyDecryptData_credential_ephemeralPublicKey_completion___block_invoke(uint64_t a1)
{
  v48 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = *(a1 + 48);
      v8 = _Block_copy(*(a1 + 64));
      *buf = 138478595;
      v41 = v5;
      v42 = 2113;
      v43 = v6;
      v44 = 2113;
      v45 = v7;
      v46 = 2112;
      v47 = v8;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to decrypt car key data: (%{private}@), credential: (%{private}@), ephemeralPublicKey: (%{private}@), completion: %@", buf, 0x2Au);
    }
  }

  if (*(a1 + 40))
  {
    v9 = objc_alloc_init(NPKProtoCarKeyDecryptDataRequest);
    [(NPKProtoCarKeyDecryptDataRequest *)v9 setEncryptedData:*(a1 + 32)];
    v10 = [*(a1 + 56) _secureArchiveSubcredential:*(a1 + 40)];
    [(NPKProtoCarKeyDecryptDataRequest *)v9 setCredentialData:v10];

    v11 = NPKSecureArchiveObject(*(a1 + 48));
    [(NPKProtoCarKeyDecryptDataRequest *)v9 setEphemeralPublicKeyData:v11];

    v12 = objc_alloc(MEMORY[0x277D189F0]);
    v13 = [(NPKProtoCarKeyDecryptDataRequest *)v9 data];
    v14 = [v12 initWithProtobufData:v13 type:151 isResponse:0];

    v15 = *(a1 + 56);
    v38 = *MEMORY[0x277D18650];
    v39 = &unk_286CE7808;
    v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v39 forKeys:&v38 count:1];
    v17 = [v15 _sendProtobuf:v14 responseExpected:1 extraOptions:v16];

    if (v17)
    {
      v18 = *(a1 + 64);
      if (v18)
      {
        v19 = _Block_copy(v18);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __104__NPKPaymentWebServiceCompanionTargetDevice_carKeyDecryptData_credential_ephemeralPublicKey_completion___block_invoke_960;
        aBlock[3] = &unk_279945218;
        v37 = *(a1 + 64);
        v20 = _Block_copy(aBlock);
        v21 = *(a1 + 56);
        v22 = _Block_copy(v19);
        [v21 _trackOutstandingRequestWithMessageIdentifier:v17 completionHandler:v22 errorHandler:v20];

LABEL_22:
        goto LABEL_23;
      }

      v33 = pk_Payment_log();
      v34 = os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT);

      if (v34)
      {
        v19 = pk_Payment_log();
        if (!os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v41 = v17;
        v30 = "Warning: No response expected for message with identifier %@";
        v31 = v19;
        v32 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v28 = pk_Payment_log();
      v29 = os_log_type_enabled(v28, OS_LOG_TYPE_ERROR);

      if (v29)
      {
        v19 = pk_Payment_log();
        if (!os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v41 = v14;
        v30 = "Error: No message identifier for protobuf %@";
        v31 = v19;
        v32 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v31, v32, v30, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v23 = pk_General_log();
  v24 = os_log_type_enabled(v23, OS_LOG_TYPE_ERROR);

  if (v24)
  {
    v25 = pk_General_log();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = *(a1 + 40);
      *buf = 138477827;
      v41 = v26;
      _os_log_impl(&dword_25B300000, v25, OS_LOG_TYPE_ERROR, "Error: Unable to decrypt car key data with nil credential (%{private}@)", buf, 0xCu);
    }
  }

  v27 = *(a1 + 64);
  if (v27)
  {
    v9 = PKDisplayableErrorForCommonType();
    (*(v27 + 16))(v27, 0, v9);
LABEL_24:
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __104__NPKPaymentWebServiceCompanionTargetDevice_carKeyDecryptData_credential_ephemeralPublicKey_completion___block_invoke_960(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyDecryptDataResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyDecryptDataResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__NPKPaymentWebServiceCompanionTargetDevice_carKeyDecryptDataResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __71__NPKPaymentWebServiceCompanionTargetDevice_carKeyDecryptDataResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoCarKeyDecryptDataResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoCarKeyDecryptDataResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = [(NPKProtoCarKeyDecryptDataResponse *)v6 hasEncryptedData];
    if (v11)
    {
      v12 = [(NPKProtoCarKeyDecryptDataResponse *)v6 encryptedData];
    }

    else
    {
      v12 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v12);
    if (v11)
    {
    }

    v16 = [(NPKProtoCarKeyDecryptDataResponse *)v6 hasErrorData];
    if (v16)
    {
      v12 = [(NPKProtoCarKeyDecryptDataResponse *)v6 errorData];
      v17 = objc_opt_class();
      v18 = NPKSecureUnarchiveObject(v12, v17);
    }

    else
    {
      v18 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v18);
    if (v16)
    {
    }
  }

  else
  {
    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        v19[0] = 0;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v19, 2u);
      }
    }
  }
}

- (void)carKeyRejectInvitation:(id)invitation completion:(id)completion
{
  invitationCopy = invitation;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSharingInAChainSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __79__NPKPaymentWebServiceCompanionTargetDevice_carKeyRejectInvitation_completion___block_invoke;
    block[3] = &unk_27994A1C0;
    v15 = invitationCopy;
    selfCopy = self;
    v17 = completionCopy;
    dispatch_sync(internalQueue, block);

    v9 = v15;
LABEL_9:

    goto LABEL_10;
  }

  v10 = pk_Payment_log();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v12 = pk_Payment_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      *v13 = 0;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support carKeyRejectInvitation:completion: message.", v13, 2u);
    }
  }

  if (completionCopy)
  {
    v9 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v9);
    goto LABEL_9;
  }

LABEL_10:
}

void __79__NPKPaymentWebServiceCompanionTargetDevice_carKeyRejectInvitation_completion___block_invoke(uint64_t a1)
{
  v41 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = _Block_copy(*(a1 + 48));
      *buf = 138478083;
      v38 = v5;
      v39 = 2112;
      v40 = v6;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to reject car key invitation: (%{private}@), completion: %@", buf, 0x16u);
    }
  }

  if (*(a1 + 32))
  {
    v7 = objc_alloc_init(NPKProtoCarKeyRejectInvitationRequest);
    v8 = NPKSecureArchiveObject(*(a1 + 32));
    [(NPKProtoCarKeyRejectInvitationRequest *)v7 setMessageData:v8];

    v9 = objc_alloc(MEMORY[0x277D189F0]);
    v10 = [(NPKProtoCarKeyRejectInvitationRequest *)v7 data];
    v11 = [v9 initWithProtobufData:v10 type:153 isResponse:0];

    v12 = *(a1 + 40);
    v35 = *MEMORY[0x277D18650];
    v36 = &unk_286CE7808;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    v14 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v13];

    if (v14)
    {
      v15 = *(a1 + 48);
      if (v15)
      {
        v16 = _Block_copy(v15);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __79__NPKPaymentWebServiceCompanionTargetDevice_carKeyRejectInvitation_completion___block_invoke_963;
        aBlock[3] = &unk_279945218;
        v34 = *(a1 + 48);
        v17 = _Block_copy(aBlock);
        v18 = *(a1 + 40);
        v19 = _Block_copy(v16);
        [v18 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v19 errorHandler:v17];

LABEL_22:
        goto LABEL_23;
      }

      v30 = pk_Payment_log();
      v31 = os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT);

      if (v31)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v14;
        v27 = "Warning: No response expected for message with identifier %@";
        v28 = v16;
        v29 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v25 = pk_Payment_log();
      v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

      if (v26)
      {
        v16 = pk_Payment_log();
        if (!os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v38 = v11;
        v27 = "Error: No message identifier for protobuf %@";
        v28 = v16;
        v29 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v28, v29, v27, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v20 = pk_General_log();
  v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

  if (v21)
  {
    v22 = pk_General_log();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = *(a1 + 32);
      *buf = 138477827;
      v38 = v23;
      _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_ERROR, "Error: Unable to reject car key invitation with nil message (%{private}@)", buf, 0xCu);
    }
  }

  v24 = *(a1 + 48);
  if (v24)
  {
    v7 = PKDisplayableErrorForCommonType();
    (*(v24 + 16))(v24, 0, v7);
LABEL_24:
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __79__NPKPaymentWebServiceCompanionTargetDevice_carKeyRejectInvitation_completion___block_invoke_963(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)carKeyRejectInvitationResponse:(id)response
{
  v41 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target carKeyRejectInvitationResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v37 = 0x3032000000;
  v38 = __Block_byref_object_copy__384;
  v39 = __Block_byref_object_dispose__385;
  v40 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __76__NPKPaymentWebServiceCompanionTargetDevice_carKeyRejectInvitationResponse___block_invoke;
    block[3] = &unk_279949C48;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    p_buf = &buf;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, v31[5], v25[5]);
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __76__NPKPaymentWebServiceCompanionTargetDevice_carKeyRejectInvitationResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCarKeyRejectInvitationResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCarKeyRejectInvitationResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCarKeyRejectInvitationResponse *)v7 hasCancelationMessageData];
    if (v12)
    {
      v1 = [(NPKProtoCarKeyRejectInvitationResponse *)v7 cancelationMessageData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 64) + 8) + 40), v14);
    if (v12)
    {
    }

    v18 = [(NPKProtoCarKeyRejectInvitationResponse *)v7 hasErrorData];
    if (v18)
    {
      v1 = [(NPKProtoCarKeyRejectInvitationResponse *)v7 errorData];
      v19 = objc_opt_class();
      v20 = NPKSecureUnarchiveObject(v1, v19);
    }

    else
    {
      v20 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v20);
    if (v18)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)revokeCredentialsWithReaderIdentifiers:(id)identifiers completion:(id)completion
{
  v25 = *MEMORY[0x277D85DE8];
  identifiersCopy = identifiers;
  completionCopy = completion;
  v8 = pk_Payment_log();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v9)
  {
    v10 = pk_Payment_log();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v11 = _Block_copy(completionCopy);
      *buf = 138412546;
      v22 = identifiersCopy;
      v23 = 2112;
      v24 = v11;
      _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Target device - revoke credentials with reader identifiers %@ completion %@", buf, 0x16u);
    }
  }

  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isRevokeCredentialsWithReaderIdentifiersSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __95__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithReaderIdentifiers_completion___block_invoke;
    block[3] = &unk_279945A48;
    v18 = identifiersCopy;
    selfCopy = self;
    v20 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support revoking credentials by reader identifier.", buf, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __95__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithReaderIdentifiers_completion___block_invoke(uint64_t a1)
{
  v34[1] = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoRevokeSubcredentialsRequest);
  v3 = *(a1 + 32);
  v29[0] = MEMORY[0x277D85DD0];
  v29[1] = 3221225472;
  v29[2] = __95__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithReaderIdentifiers_completion___block_invoke_2;
  v29[3] = &unk_279948BC0;
  v4 = v2;
  v30 = v4;
  [v3 enumerateObjectsUsingBlock:v29];
  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [(NPKProtoRevokeSubcredentialsRequest *)v4 data];
  v7 = [v5 initWithProtobufData:v6 type:155 isResponse:0];

  v8 = *(a1 + 40);
  v33 = *MEMORY[0x277D18650];
  v34[0] = &unk_286CE7808;
  v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v34 forKeys:&v33 count:1];
  v10 = [v8 _sendProtobuf:v7 responseExpected:1 extraOptions:v9];

  if (v10)
  {
    v11 = *(a1 + 48);
    if (v11)
    {
      v12 = _Block_copy(v11);
      v24 = MEMORY[0x277D85DD0];
      v25 = 3221225472;
      v26 = __95__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithReaderIdentifiers_completion___block_invoke_3;
      v27 = &unk_279945218;
      v28 = *(a1 + 48);
      v13 = _Block_copy(&v24);
      v14 = *(a1 + 40);
      v15 = _Block_copy(v12);
      [v14 _trackOutstandingRequestWithMessageIdentifier:v10 completionHandler:v15 errorHandler:{v13, v24, v25, v26, v27}];

LABEL_11:
      goto LABEL_12;
    }

    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT);

    if (v22)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v32 = v10;
      v18 = "Warning: No response expected for message with identifier %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_10;
    }
  }

  else
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);

    if (v17)
    {
      v12 = pk_Payment_log();
      if (!os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_11;
      }

      *buf = 138412290;
      v32 = v7;
      v18 = "Error: No message identifier for protobuf %@";
      v19 = v12;
      v20 = OS_LOG_TYPE_ERROR;
LABEL_10:
      _os_log_impl(&dword_25B300000, v19, v20, v18, buf, 0xCu);
      goto LABEL_11;
    }
  }

LABEL_12:

  v23 = *MEMORY[0x277D85DE8];
}

void __95__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithReaderIdentifiers_completion___block_invoke_3(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked for revoke credentials with reader identifiers! Error: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)revokeCredentialsWithReaderIdentifiersResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target revokeCredentialsWithReaderIdentifiersResponse: incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __92__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithReaderIdentifiersResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v23;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __92__NPKPaymentWebServiceCompanionTargetDevice_revokeCredentialsWithReaderIdentifiersResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoRevokeSubcredentialsResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoRevokeSubcredentialsResponse *)v4 initWithData:v5];

    *(*(*(a1 + 56) + 8) + 24) = [(NPKProtoRevokeSubcredentialsResponse *)v6 success];
    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 64) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;
  }

  else
  {
    v11 = pk_Payment_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_Payment_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v14, 2u);
      }
    }
  }
}

- (id)passesWithReaderIdentifier:(id)identifier
{
  v24 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      LODWORD(buf) = 138412290;
      *(&buf + 4) = identifierCopy;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device - passes with reader identifier: %@", &buf, 0xCu);
    }
  }

  *&buf = 0;
  *(&buf + 1) = &buf;
  v20 = 0x3032000000;
  v21 = __Block_byref_object_copy__22;
  v22 = __Block_byref_object_dispose__22;
  v23 = 0;
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __72__NPKPaymentWebServiceCompanionTargetDevice_passesWithReaderIdentifier___block_invoke;
  v16[3] = &unk_279949AB8;
  v16[4] = &buf;
  [companionAgentConnection passesWithReaderIdentifier:identifierCopy synchronous:1 reply:v16];

  v9 = pk_Payment_log();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

  if (v10)
  {
    v11 = pk_Payment_log();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = *(*(&buf + 1) + 40);
      *v17 = 138412290;
      v18 = v12;
      _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device - found passes with reader identifier? %@", v17, 0xCu);
    }
  }

  v13 = *(*(&buf + 1) + 40);
  _Block_object_dispose(&buf, 8);

  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (void)deviceSupportedRadioTechnologiesWithCompletion:(id)completion
{
  v16 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v7 = _Block_copy(completionCopy);
      v14 = 138412290;
      v15 = v7;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Target device - device supported radio technologies with completion: %@", &v14, 0xCu);
    }
  }

  if (completionCopy)
  {
    v8 = NPKPairedOrPairingDevice();
    v9 = NPKRadioTechnologySupportedByPairedDevice(3, v8);
    v10 = pk_Payment_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

    if (v11)
    {
      v12 = pk_Payment_log();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        v14 = 134217984;
        v15 = v9;
        _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Notice: Target device - returning device supported radio technologies: %lu", &v14, 0xCu);
      }
    }

    (*(completionCopy + 2))(completionCopy, v9);
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (BOOL)canAddToCompanionPrecheckForegroundConnectivity
{
  v3 = pk_Payment_log();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

  if (v4)
  {
    v5 = pk_Payment_log();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v5, OS_LOG_TYPE_DEFAULT, "Notice: Target device - checking can add to companion precheck connectivity", buf, 2u);
    }
  }

  *buf = 0;
  v10 = buf;
  v11 = 0x2020000000;
  v12 = 0;
  companionAgentConnection = [(NPKPaymentWebServiceCompanionTargetDevice *)self companionAgentConnection];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __92__NPKPaymentWebServiceCompanionTargetDevice_canAddToCompanionPrecheckForegroundConnectivity__block_invoke;
  v8[3] = &unk_279949B30;
  v8[4] = buf;
  [companionAgentConnection canAddToCompanionPrecheckForegroundConnectivitySynchronous:1 reply:v8];

  LOBYTE(companionAgentConnection) = v10[24];
  _Block_object_dispose(buf, 8);
  return companionAgentConnection;
}

- (void)cancelAutoTopUpForPassWithUniqueIdentifier:(id)identifier balanceIdentifiers:(id)identifiers completion:(id)completion
{
  identifierCopy = identifier;
  identifiersCopy = identifiers;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isAutoTopUpSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __118__NPKPaymentWebServiceCompanionTargetDevice_cancelAutoTopUpForPassWithUniqueIdentifier_balanceIdentifiers_completion___block_invoke;
    block[3] = &unk_279945C50;
    v17 = identifierCopy;
    v18 = identifiersCopy;
    selfCopy = self;
    v20 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        *v15 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support auto top up.", v15, 2u);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }
}

void __118__NPKPaymentWebServiceCompanionTargetDevice_cancelAutoTopUpForPassWithUniqueIdentifier_balanceIdentifiers_completion___block_invoke(uint64_t a1)
{
  v50 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = _Block_copy(*(a1 + 56));
      *buf = 138412802;
      v45 = v5;
      v46 = 2112;
      v47 = v6;
      v48 = 2112;
      v49 = v7;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Target device - Request to cancel auto top up for pass with id: %@, balanceIdentifiers : %@, completion: %@", buf, 0x20u);
    }
  }

  if (*(a1 + 32))
  {
    v8 = objc_alloc_init(NPKProtoCancelAutoTopUpRequest);
    [(NPKProtoCancelAutoTopUpRequest *)v8 setUniqueID:*(a1 + 32)];
    v9 = *(a1 + 40);
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __118__NPKPaymentWebServiceCompanionTargetDevice_cancelAutoTopUpForPassWithUniqueIdentifier_balanceIdentifiers_completion___block_invoke_967;
    v40[3] = &unk_279948BC0;
    v10 = v8;
    v41 = v10;
    [v9 enumerateObjectsUsingBlock:v40];
    v11 = objc_alloc(MEMORY[0x277D189F0]);
    v12 = [(NPKProtoCancelAutoTopUpRequest *)v10 data];
    v13 = [v11 initWithProtobufData:v12 type:138 isResponse:0];

    v14 = *(a1 + 48);
    v42 = *MEMORY[0x277D18650];
    v43 = &unk_286CE7808;
    v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v43 forKeys:&v42 count:1];
    v16 = [v14 _sendProtobuf:v13 responseExpected:1 extraOptions:v15];

    if (v16)
    {
      v17 = *(a1 + 56);
      if (v17)
      {
        v18 = _Block_copy(v17);
        v35 = MEMORY[0x277D85DD0];
        v36 = 3221225472;
        v37 = __118__NPKPaymentWebServiceCompanionTargetDevice_cancelAutoTopUpForPassWithUniqueIdentifier_balanceIdentifiers_completion___block_invoke_2;
        v38 = &unk_279945218;
        v39 = *(a1 + 56);
        v19 = _Block_copy(&v35);
        v20 = *(a1 + 48);
        v21 = _Block_copy(v18);
        [v20 _trackOutstandingRequestWithMessageIdentifier:v16 completionHandler:v21 errorHandler:{v19, v35, v36, v37, v38}];

LABEL_22:
        goto LABEL_23;
      }

      v32 = pk_Payment_log();
      v33 = os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT);

      if (v33)
      {
        v18 = pk_Payment_log();
        if (!os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v45 = v16;
        v29 = "Warning: No response expected for message with identifier %@";
        v30 = v18;
        v31 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v27 = pk_Payment_log();
      v28 = os_log_type_enabled(v27, OS_LOG_TYPE_ERROR);

      if (v28)
      {
        v18 = pk_Payment_log();
        if (!os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v45 = v13;
        v29 = "Error: No message identifier for protobuf %@";
        v30 = v18;
        v31 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v30, v31, v29, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  v22 = pk_General_log();
  v23 = os_log_type_enabled(v22, OS_LOG_TYPE_ERROR);

  if (v23)
  {
    v24 = pk_General_log();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = *(a1 + 32);
      *buf = 138412290;
      v45 = v25;
      _os_log_impl(&dword_25B300000, v24, OS_LOG_TYPE_ERROR, "Error: Unable to fetch pass with unique identifier (%@)", buf, 0xCu);
    }
  }

  v26 = *(a1 + 56);
  if (v26)
  {
    (*(v26 + 16))(v26, 0);
  }

LABEL_24:
  v34 = *MEMORY[0x277D85DE8];
}

void __118__NPKPaymentWebServiceCompanionTargetDevice_cancelAutoTopUpForPassWithUniqueIdentifier_balanceIdentifiers_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)cancelAutoTopUpResponse:(id)response
{
  v32 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      LODWORD(buf) = 138412290;
      *(&buf + 4) = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Cancel auto top up incoming protobuf %@", &buf, 0xCu);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *&buf = 0;
  *(&buf + 1) = &buf;
  v28 = 0x3032000000;
  v29 = __Block_byref_object_copy__384;
  v30 = __Block_byref_object_dispose__385;
  v31 = 0;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __69__NPKPaymentWebServiceCompanionTargetDevice_cancelAutoTopUpResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v19 = incomingResponseIdentifier;
    v20 = responseCopy;
    v21 = &v23;
    p_buf = &buf;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_ERROR);

    if (v13)
    {
      v14 = pk_Payment_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        *v17 = 0;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v17, 2u);
      }
    }
  }

  v15 = *(*(&buf + 1) + 40);
  if (v15)
  {
    (*(v15 + 16))(v15, *(v24 + 24));
  }

  _Block_object_dispose(&v23, 8);
  _Block_object_dispose(&buf, 8);

  v16 = *MEMORY[0x277D85DE8];
}

void __69__NPKPaymentWebServiceCompanionTargetDevice_cancelAutoTopUpResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoCancelAutoTopUpResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoCancelAutoTopUpResponse *)v4 initWithData:v5];

    *(*(*(a1 + 56) + 8) + 24) = [(NPKProtoCancelAutoTopUpResponse *)v6 success];
    v7 = [v3 completionHandler];
    v8 = *(*(a1 + 64) + 8);
    v9 = *(v8 + 40);
    *(v8 + 40) = v7;
  }

  else
  {
    v10 = pk_Payment_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

    if (v11)
    {
      v12 = pk_Payment_log();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        *v13 = 0;
        _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v13, 2u);
      }
    }
  }
}

- (void)serviceProviderDataForPassWithUniqueIdentifierResponse:(id)response
{
  v54 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      data = [responseCopy data];
      *buf = 138412546;
      *&buf[4] = npkDescription;
      *&buf[12] = 2048;
      *&buf[14] = [data length];
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target serviceProviderDataForPassWithUniqueIdentifierResponse: incoming protobuf %@. Data size: %lu", buf, 0x16u);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v51 = __Block_byref_object_copy__384;
  v52 = __Block_byref_object_dispose__385;
  v53 = 0;
  v44 = 0;
  v45 = &v44;
  v46 = 0x3032000000;
  v47 = __Block_byref_object_copy__22;
  v48 = __Block_byref_object_dispose__22;
  v49 = 0;
  v40 = 0;
  v41 = &v40;
  v42 = 0x2020000000;
  v43 = 0;
  v34 = 0;
  v35 = &v34;
  v36 = 0x3032000000;
  v37 = __Block_byref_object_copy__22;
  v38 = __Block_byref_object_dispose__22;
  v39 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __100__NPKPaymentWebServiceCompanionTargetDevice_serviceProviderDataForPassWithUniqueIdentifierResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v28 = incomingResponseIdentifier;
    v29 = responseCopy;
    v30 = buf;
    v31 = &v44;
    v32 = &v40;
    v33 = &v34;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_ERROR);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *v26 = 0;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v26, 2u);
      }
    }
  }

  if (*(*&buf[8] + 40))
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

    if (v17)
    {
      v18 = pk_Payment_log();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        *v26 = 0;
        _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Notice: Target serviceProviderDataForPassWithUniqueIdentifierResponse. Calling completion block", v26, 2u);
      }
    }

    v19 = v45[5];
    v20 = *(v41 + 24);
    v21 = v35[5];
    (*(*(*&buf[8] + 40) + 16))();
  }

  else
  {
    v22 = pk_Payment_log();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT);

    if (v23)
    {
      v24 = pk_Payment_log();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
      {
        *v26 = 0;
        _os_log_impl(&dword_25B300000, v24, OS_LOG_TYPE_DEFAULT, "Warning: Target serviceProviderDataForPassWithUniqueIdentifierResponse. No completion block to call, unexpected.", v26, 2u);
      }
    }
  }

  _Block_object_dispose(&v34, 8);

  _Block_object_dispose(&v40, 8);
  _Block_object_dispose(&v44, 8);

  _Block_object_dispose(buf, 8);
  v25 = *MEMORY[0x277D85DE8];
}

void __100__NPKPaymentWebServiceCompanionTargetDevice_serviceProviderDataForPassWithUniqueIdentifierResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoServiceProviderDataForPassWithUniqueIdentifierResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoServiceProviderDataForPassWithUniqueIdentifierResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoServiceProviderDataForPassWithUniqueIdentifierResponse *)v7 serviceProviderData];
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    *(*(*(a1 + 72) + 8) + 24) = [(NPKProtoServiceProviderDataForPassWithUniqueIdentifierResponse *)v7 encrypted];
    v15 = [(NPKProtoServiceProviderDataForPassWithUniqueIdentifierResponse *)v7 hasErrorData];
    if (v15)
    {
      v1 = [(NPKProtoServiceProviderDataForPassWithUniqueIdentifierResponse *)v7 errorData];
      v16 = objc_opt_class();
      v17 = NPKSecureUnarchiveObject(v1, v16);
    }

    else
    {
      v17 = 0;
    }

    objc_storeStrong((*(*(a1 + 80) + 8) + 40), v17);
    if (v15)
    {
    }
  }

  else
  {
    v18 = pk_Payment_log();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

    if (v19)
    {
      v20 = pk_Payment_log();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
      {
        v21[0] = 0;
        _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v21, 2u);
      }
    }
  }
}

- (void)serviceProviderDataForPassWithUniqueIdentifier:(id)identifier encrypted:(BOOL)encrypted completion:(id)completion
{
  v32 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  completionCopy = completion;
  v10 = NPKPairedOrPairingDevice();
  v11 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"674FD660-822D-4A0A-8A10-7ED7299FB8F7"];
  if ([v10 supportsCapability:v11])
  {
    v12 = 1;
  }

  else
  {
    v13 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"FA784EAB-0396-4E07-B68A-66815BB84E3E"];
    if ([v10 supportsCapability:v13])
    {
      v12 = 1;
    }

    else
    {
      v14 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"D3581A95-1F64-4EBD-8F71-0CD6B696D766"];
      v12 = [v10 supportsCapability:v14];
    }
  }

  v15 = pk_General_log();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

  if (v16)
  {
    v17 = pk_General_log();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      v18 = @"NO";
      if (v12)
      {
        v18 = @"YES";
      }

      *buf = 138412290;
      v31 = v18;
      _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Notice: Target device serviceProviderDataForPassWithUniqueIdentifier, Service Provider Data support %@", buf, 0xCu);
    }
  }

  if (v12)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v25[0] = MEMORY[0x277D85DD0];
    v25[1] = 3221225472;
    v25[2] = __113__NPKPaymentWebServiceCompanionTargetDevice_serviceProviderDataForPassWithUniqueIdentifier_encrypted_completion___block_invoke;
    v25[3] = &unk_27994A0A8;
    encryptedCopy = encrypted;
    v26 = identifierCopy;
    selfCopy = self;
    v28 = completionCopy;
    dispatch_sync(internalQueue, v25);

    v20 = v26;
LABEL_21:

    goto LABEL_22;
  }

  v21 = pk_General_log();
  v22 = os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT);

  if (v22)
  {
    v23 = pk_General_log();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v31 = identifierCopy;
      _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support the message. Not sending message to get Service Provider data for pass with unique ID %@.", buf, 0xCu);
    }
  }

  if (completionCopy)
  {
    v20 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(completionCopy + 2))(completionCopy, 0, v20);
    goto LABEL_21;
  }

LABEL_22:

  v24 = *MEMORY[0x277D85DE8];
}

void __113__NPKPaymentWebServiceCompanionTargetDevice_serviceProviderDataForPassWithUniqueIdentifier_encrypted_completion___block_invoke(uint64_t a1)
{
  v36 = *MEMORY[0x277D85DE8];
  v2 = pk_General_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT);

  if (v3)
  {
    v4 = pk_General_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = *(a1 + 32);
      *buf = 138412290;
      v35 = v5;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_DEFAULT, "Notice: Service Provider data for pass with unique ID %@. Sending message", buf, 0xCu);
    }
  }

  v6 = objc_alloc_init(NPKProtoServiceProviderDataForPassWithUniqueIdentifierRequest);
  [(NPKProtoServiceProviderDataForPassWithUniqueIdentifierRequest *)v6 setPassUniqueID:*(a1 + 32)];
  [(NPKProtoServiceProviderDataForPassWithUniqueIdentifierRequest *)v6 setEncrypted:*(a1 + 56)];
  v7 = objc_alloc(MEMORY[0x277D189F0]);
  v8 = [(NPKProtoServiceProviderDataForPassWithUniqueIdentifierRequest *)v6 data];
  v9 = [v7 initWithProtobufData:v8 type:104 isResponse:0];

  v10 = *MEMORY[0x277D18580];
  v32[0] = *MEMORY[0x277D185D0];
  v32[1] = v10;
  v33[0] = MEMORY[0x277CBEC38];
  v33[1] = MEMORY[0x277CBEC38];
  v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v33 forKeys:v32 count:2];
  v12 = [*(a1 + 40) _sendProtobuf:v9 responseExpected:1 extraOptions:v11 priority:300];
  if (v12)
  {
    v13 = *(a1 + 48);
    if (v13)
    {
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __113__NPKPaymentWebServiceCompanionTargetDevice_serviceProviderDataForPassWithUniqueIdentifier_encrypted_completion___block_invoke_980;
      aBlock[3] = &unk_27994A848;
      v31 = *(a1 + 56);
      v30 = v13;
      v14 = _Block_copy(aBlock);
      v27[0] = MEMORY[0x277D85DD0];
      v27[1] = 3221225472;
      v27[2] = __113__NPKPaymentWebServiceCompanionTargetDevice_serviceProviderDataForPassWithUniqueIdentifier_encrypted_completion___block_invoke_982;
      v27[3] = &unk_279945218;
      v28 = *(a1 + 48);
      v15 = _Block_copy(v27);
      v16 = *(a1 + 40);
      v17 = _Block_copy(v14);
      [v16 _trackOutstandingRequestWithMessageIdentifier:v12 completionHandler:v17 errorHandler:v15];

      v18 = v30;
LABEL_15:

      goto LABEL_16;
    }

    v24 = pk_Payment_log();
    v25 = os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT);

    if (v25)
    {
      v18 = pk_Payment_log();
      if (!os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v35 = v12;
      v21 = "Warning: No response expected for message with identifier %@";
      v22 = v18;
      v23 = OS_LOG_TYPE_DEFAULT;
      goto LABEL_14;
    }
  }

  else
  {
    v19 = pk_Payment_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_ERROR);

    if (v20)
    {
      v18 = pk_Payment_log();
      if (!os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_15;
      }

      *buf = 138412290;
      v35 = v9;
      v21 = "Error: No message identifier for protobuf %@";
      v22 = v18;
      v23 = OS_LOG_TYPE_ERROR;
LABEL_14:
      _os_log_impl(&dword_25B300000, v22, v23, v21, buf, 0xCu);
      goto LABEL_15;
    }
  }

LABEL_16:

  v26 = *MEMORY[0x277D85DE8];
}

void __113__NPKPaymentWebServiceCompanionTargetDevice_serviceProviderDataForPassWithUniqueIdentifier_encrypted_completion___block_invoke_980(uint64_t a1, void *a2, int a3, void *a4)
{
  v7 = a2;
  v8 = a4;
  if (*(a1 + 40) != a3)
  {
    v9 = pk_Payment_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);

    if (v10)
    {
      v11 = pk_Payment_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        *v14 = 0;
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_ERROR, "Error: Got result back that didn't match requested encryption status", v14, 2u);
      }
    }

    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];

    v7 = 0;
    v8 = v12;
  }

  v13 = *(a1 + 32);
  if (v13)
  {
    (*(v13 + 16))(v13, v7, v8);
  }
}

void __113__NPKPaymentWebServiceCompanionTargetDevice_serviceProviderDataForPassWithUniqueIdentifier_encrypted_completion___block_invoke_982(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0, v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

void __106__NPKPaymentWebServiceCompanionTargetDevice_serviceProviderDataForSecureElementPass_encrypted_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = *(a1 + 32);
  if (v7)
  {
    if (!v5 || v6)
    {
      (*(v7 + 16))(v7, 0, v6);
    }

    else
    {
      v17 = 0;
      v8 = [MEMORY[0x277CCAAA0] JSONObjectWithData:v5 options:0 error:&v17];
      v6 = v17;
      v9 = pk_General_log();
      v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

      if (v10)
      {
        v11 = pk_General_log();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v19 = v8;
          _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Received encrypted payload %@", buf, 0xCu);
        }
      }

      if (v6)
      {
        v12 = pk_General_log();
        v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

        if (v13)
        {
          v14 = pk_General_log();
          if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
          {
            *buf = 138412290;
            v19 = v6;
            _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Error converting encrypted payload to JSON string: %@", buf, 0xCu);
          }
        }

        v15 = v6;
      }

      (*(*(a1 + 32) + 16))();
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)paymentSetupFeaturesForConfigurationResponse:(id)response
{
  v42 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      data = [responseCopy data];
      *buf = 138412546;
      *&buf[4] = npkDescription;
      *&buf[12] = 2048;
      *&buf[14] = [data length];
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target paymentSetupFeaturesForConfigurationResponse: incoming protobuf %@. Data size: %lu", buf, 0x16u);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v39 = __Block_byref_object_copy__384;
  v40 = __Block_byref_object_dispose__385;
  v41 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy__22;
  v34 = __Block_byref_object_dispose__22;
  v35 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __90__NPKPaymentWebServiceCompanionTargetDevice_paymentSetupFeaturesForConfigurationResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v26 = incomingResponseIdentifier;
    v27 = responseCopy;
    v28 = buf;
    v29 = &v30;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_ERROR);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *v36 = 0;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v36, 2u);
      }
    }
  }

  if (*(*&buf[8] + 40))
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

    if (v17)
    {
      v18 = pk_Payment_log();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        v19 = v31[5];
        *v36 = 138412290;
        v37 = v19;
        _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_DEFAULT, "Notice: Target paymentSetupFeaturesForConfigurationResponse. Calling completion block with response %@", v36, 0xCu);
      }
    }

    v20 = v31[5];
    (*(*(*&buf[8] + 40) + 16))();
  }

  else
  {
    v21 = pk_Payment_log();
    v22 = os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT);

    if (v22)
    {
      v23 = pk_Payment_log();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT))
      {
        *v36 = 0;
        _os_log_impl(&dword_25B300000, v23, OS_LOG_TYPE_DEFAULT, "Warning: Target paymentSetupFeaturesForConfigurationResponse. No completion block to call, unexpected.", v36, 2u);
      }
    }
  }

  _Block_object_dispose(&v30, 8);

  _Block_object_dispose(buf, 8);
  v24 = *MEMORY[0x277D85DE8];
}

void __90__NPKPaymentWebServiceCompanionTargetDevice_paymentSetupFeaturesForConfigurationResponse___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [NPKProtoPaymentSetupFeaturesForConfigurationResponse alloc];
    v5 = [*(a1 + 48) data];
    v6 = [(NPKProtoPaymentSetupFeaturesForConfigurationResponse *)v4 initWithData:v5];

    v7 = [*(a1 + 32) outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 40)];

    v8 = [v3 completionHandler];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = [(NPKProtoPaymentSetupFeaturesForConfigurationResponse *)v6 paymentSetupFeatureDatas];
    v12 = [v11 pk_arrayBySafelyApplyingBlock:&__block_literal_global_988];
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        *v18 = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

id __90__NPKPaymentWebServiceCompanionTargetDevice_paymentSetupFeaturesForConfigurationResponse___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = objc_opt_class();
  v4 = NPKSecureUnarchiveObject(v2, v3);

  return v4;
}

- (void)paymentSetupFeaturesForConfiguration:(id)configuration completion:(id)completion
{
  v21 = *MEMORY[0x277D85DE8];
  configurationCopy = configuration;
  completionCopy = completion;
  v8 = NPKPairedOrPairingDevice();
  v9 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"C990FB84-055B-467E-B7AD-EB88FCE19825"];
  v10 = [v8 supportsCapability:v9];

  if (v10)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __93__NPKPaymentWebServiceCompanionTargetDevice_paymentSetupFeaturesForConfiguration_completion___block_invoke;
    block[3] = &unk_279945A48;
    block[4] = self;
    v17 = configurationCopy;
    v18 = completionCopy;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v12 = pk_General_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_General_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v20 = configurationCopy;
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support the message. Not sending message to get payment setup features for configuration %@.", buf, 0xCu);
      }
    }

    if (completionCopy)
    {
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

void __93__NPKPaymentWebServiceCompanionTargetDevice_paymentSetupFeaturesForConfiguration_completion___block_invoke(id *a1)
{
  v38 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] provisioningService];
  CanSendMessage = NPKProtoCanSendMessage(v2);

  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (CanSendMessage)
  {
    if (v5)
    {
      v6 = pk_General_log();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
      {
        v7 = a1[5];
        *buf = 138412290;
        v37 = v7;
        _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Payment setup features for configuration %@. Sending message", buf, 0xCu);
      }
    }

    v8 = objc_alloc_init(NPKProtoPaymentSetupFeaturesForConfigurationRequest);
    v9 = NPKSecureArchiveObject(a1[5]);
    [(NPKProtoPaymentSetupFeaturesForConfigurationRequest *)v8 setConfigurationData:v9];

    v10 = objc_alloc(MEMORY[0x277D189F0]);
    v11 = [(NPKProtoPaymentSetupFeaturesForConfigurationRequest *)v8 data];
    v12 = [v10 initWithProtobufData:v11 type:120 isResponse:0];

    v13 = *MEMORY[0x277D18580];
    v34[0] = *MEMORY[0x277D185D0];
    v34[1] = v13;
    v35[0] = MEMORY[0x277CBEC38];
    v35[1] = MEMORY[0x277CBEC38];
    v34[2] = *MEMORY[0x277D18650];
    v35[2] = &unk_286CE7818;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:3];
    v15 = [a1[4] _sendProtobuf:v12 responseExpected:1 extraOptions:v14 priority:300];
    if (v15)
    {
      v16 = a1[6];
      if (v16)
      {
        v17 = _Block_copy(v16);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __93__NPKPaymentWebServiceCompanionTargetDevice_paymentSetupFeaturesForConfiguration_completion___block_invoke_994;
        aBlock[3] = &unk_279945218;
        v33 = a1[6];
        v18 = _Block_copy(aBlock);
        v19 = a1[4];
        v20 = _Block_copy(v17);
        [v19 _trackOutstandingRequestWithMessageIdentifier:v15 completionHandler:v20 errorHandler:v18];

LABEL_22:
        goto LABEL_23;
      }

      v29 = pk_Payment_log();
      v30 = os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT);

      if (v30)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v15;
        v26 = "Warning: No response expected for message with identifier %@";
        v27 = v17;
        v28 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v24 = pk_Payment_log();
      v25 = os_log_type_enabled(v24, OS_LOG_TYPE_ERROR);

      if (v25)
      {
        v17 = pk_Payment_log();
        if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v37 = v12;
        v26 = "Error: No message identifier for protobuf %@";
        v27 = v17;
        v28 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v27, v28, v26, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  if (v5)
  {
    v21 = pk_General_log();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
    {
      v22 = a1[5];
      *buf = 138412290;
      v37 = v22;
      _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_DEFAULT, "Notice: Payment setup features for configuration %@, device is not connected, will not send message", buf, 0xCu);
    }
  }

  v23 = a1[6];
  if (v23)
  {
    v23[2](v23, 0);
  }

LABEL_24:
  v31 = *MEMORY[0x277D85DE8];
}

void __93__NPKPaymentWebServiceCompanionTargetDevice_paymentSetupFeaturesForConfiguration_completion___block_invoke_994(uint64_t a1, void *a2)
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v9 = 138412290;
      v10 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v9, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    (*(v7 + 16))(v7, 0);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)hasActiveExternallySharedPassesResponse:(id)response
{
  v48 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [responseCopy npkDescription];
      data = [responseCopy data];
      *buf = 138412546;
      *&buf[4] = npkDescription;
      *&buf[12] = 2048;
      *&buf[14] = [data length];
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target hasActiveExternallySharedPassesResponse: incoming protobuf %@. Data size: %lu", buf, 0x16u);
    }
  }

  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v45 = __Block_byref_object_copy__384;
  v46 = __Block_byref_object_dispose__385;
  v47 = 0;
  v38 = 0;
  v39 = &v38;
  v40 = 0x2020000000;
  v41 = 0;
  v32 = 0;
  v33 = &v32;
  v34 = 0x3032000000;
  v35 = __Block_byref_object_copy__22;
  v36 = __Block_byref_object_dispose__22;
  v37 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v26[0] = MEMORY[0x277D85DD0];
    v26[1] = 3221225472;
    v26[2] = __85__NPKPaymentWebServiceCompanionTargetDevice_hasActiveExternallySharedPassesResponse___block_invoke;
    v26[3] = &unk_279949C48;
    v26[4] = self;
    v27 = incomingResponseIdentifier;
    v28 = responseCopy;
    v29 = buf;
    v30 = &v38;
    v31 = &v32;
    dispatch_sync(internalQueue, v26);
  }

  else
  {
    v13 = pk_Payment_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_ERROR);

    if (v14)
    {
      v15 = pk_Payment_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *v42 = 0;
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", v42, 2u);
      }
    }
  }

  if (*(*&buf[8] + 40))
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

    if (v17)
    {
      v20 = pk_Payment_log();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
      {
        v21 = *(v39 + 24);
        *v42 = 67109120;
        v43 = v21;
        _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Notice: Target hasActiveExternallySharedPassesResponse. Calling completion block with response %d", v42, 8u);
      }
    }

    (*(*(*&buf[8] + 40) + 16))(*(*&buf[8] + 40), *(v39 + 24), v33[5], v18, v19);
  }

  else
  {
    v22 = pk_Payment_log();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT);

    if (v23)
    {
      v24 = pk_Payment_log();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
      {
        *v42 = 0;
        _os_log_impl(&dword_25B300000, v24, OS_LOG_TYPE_DEFAULT, "Warning: Target hasActiveExternallySharedPassesResponse. No completion block to call, unexpected.", v42, 2u);
      }
    }
  }

  _Block_object_dispose(&v32, 8);

  _Block_object_dispose(&v38, 8);
  _Block_object_dispose(buf, 8);

  v25 = *MEMORY[0x277D85DE8];
}

void __85__NPKPaymentWebServiceCompanionTargetDevice_hasActiveExternallySharedPassesResponse___block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoHasActiveExternallySharedPassesResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoHasActiveExternallySharedPassesResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    *(*(*(a1 + 64) + 8) + 24) = [(NPKProtoHasActiveExternallySharedPassesResponse *)v7 hasActiveExternallySharedPasses];
    v12 = [(NPKProtoHasActiveExternallySharedPassesResponse *)v7 hasErrorData];
    if (v12)
    {
      v1 = [(NPKProtoHasActiveExternallySharedPassesResponse *)v7 errorData];
      v13 = objc_opt_class();
      v14 = NPKSecureUnarchiveObject(v1, v13);
    }

    else
    {
      v14 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v14);
    if (v12)
    {
    }
  }

  else
  {
    v15 = pk_Payment_log();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);

    if (v16)
    {
      v17 = pk_Payment_log();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18[0] = 0;
        _os_log_impl(&dword_25B300000, v17, OS_LOG_TYPE_DEFAULT, "Warning: got response with no associated message handler", v18, 2u);
      }
    }
  }
}

- (void)hasActiveExternallySharedPasses:(id)passes
{
  passesCopy = passes;
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __77__NPKPaymentWebServiceCompanionTargetDevice_hasActiveExternallySharedPasses___block_invoke;
  v6[3] = &unk_279944F48;
  v7 = passesCopy;
  v5 = passesCopy;
  [(NPKPaymentWebServiceCompanionTargetDevice *)self hasActiveExternallySharedPassesWithCompletion:v6];
}

uint64_t __77__NPKPaymentWebServiceCompanionTargetDevice_hasActiveExternallySharedPasses___block_invoke(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

- (void)currentSecureElementSnapshot:(id)snapshot
{
  v17 = *MEMORY[0x277D85DE8];
  snapshotCopy = snapshot;
  if (snapshotCopy)
  {
    if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isParallelProvisioningSupported])
    {
      internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
      v13[0] = MEMORY[0x277D85DD0];
      v13[1] = 3221225472;
      v13[2] = __74__NPKPaymentWebServiceCompanionTargetDevice_currentSecureElementSnapshot___block_invoke;
      v13[3] = &unk_279945530;
      v13[4] = self;
      v14 = snapshotCopy;
      dispatch_sync(internalQueue, v13);
    }

    else
    {
      v9 = pk_General_log();
      v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

      if (v10)
      {
        v11 = pk_General_log();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 136315138;
          v16 = "[NPKPaymentWebServiceCompanionTargetDevice currentSecureElementSnapshot:]";
          _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: %s, not supported, will not send message", buf, 0xCu);
        }
      }

      (*(snapshotCopy + 2))(snapshotCopy, 0, 0);
    }
  }

  else
  {
    v6 = pk_General_log();
    v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

    if (v7)
    {
      v8 = pk_General_log();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 136315138;
        v16 = "[NPKPaymentWebServiceCompanionTargetDevice currentSecureElementSnapshot:]";
        _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: %s, nil completion, will not send message", buf, 0xCu);
      }
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __74__NPKPaymentWebServiceCompanionTargetDevice_currentSecureElementSnapshot___block_invoke(uint64_t a1)
{
  v22 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoCurrentSecureElementSnapshotRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoCurrentSecureElementSnapshotRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:134 isResponse:0];

  v6 = *(a1 + 32);
  v7 = [v6 _idsShortSendTimeoutProvisioningOptions];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7 priority:300];

  if (v8)
  {
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __74__NPKPaymentWebServiceCompanionTargetDevice_currentSecureElementSnapshot___block_invoke_2;
    aBlock[3] = &unk_279945218;
    v17 = *(a1 + 40);
    v9 = _Block_copy(aBlock);
    v10 = *(a1 + 32);
    v11 = _Block_copy(*(a1 + 40));
    [v10 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v11 errorHandler:v9];

    v12 = v17;
  }

  else
  {
    v14 = pk_General_log();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_ERROR);

    if (!v15)
    {
      goto LABEL_4;
    }

    v12 = pk_General_log();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      *buf = 136315394;
      v19 = "[NPKPaymentWebServiceCompanionTargetDevice currentSecureElementSnapshot:]_block_invoke";
      v20 = 2112;
      v21 = v5;
      _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_ERROR, "Error: %s, No message identifier for protobuf %@", buf, 0x16u);
    }
  }

LABEL_4:
  v13 = *MEMORY[0x277D85DE8];
}

void __74__NPKPaymentWebServiceCompanionTargetDevice_currentSecureElementSnapshot___block_invoke_2(uint64_t a1, void *a2)
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_General_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = 138412290;
      v9 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@ for currentSecureElementSnapshot", &v8, 0xCu);
    }
  }

  (*(*(a1 + 32) + 16))();

  v7 = *MEMORY[0x277D85DE8];
}

- (void)currentSecureElementSnapshotResponse:(id)response
{
  v42 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  v34 = 0;
  v35 = &v34;
  v36 = 0x3032000000;
  v37 = __Block_byref_object_copy__384;
  v38 = __Block_byref_object_dispose__385;
  v39 = 0;
  v28 = 0;
  v29 = &v28;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy__22;
  v32 = __Block_byref_object_dispose__22;
  v33 = 0;
  v22 = 0;
  v23 = &v22;
  v24 = 0x3032000000;
  v25 = __Block_byref_object_copy__22;
  v26 = __Block_byref_object_dispose__22;
  v27 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __82__NPKPaymentWebServiceCompanionTargetDevice_currentSecureElementSnapshotResponse___block_invoke;
    v16[3] = &unk_279949C48;
    v16[4] = self;
    v17 = incomingResponseIdentifier;
    v18 = responseCopy;
    v19 = &v34;
    v20 = &v28;
    v21 = &v22;
    dispatch_sync(internalQueue, v16);
  }

  else
  {
    v8 = pk_General_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_ERROR);

    if (v9)
    {
      v10 = pk_General_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", buf, 2u);
      }
    }
  }

  v11 = v35[5];
  if (v11)
  {
    (*(v11 + 16))(v11, v29[5], v23[5]);
  }

  else
  {
    v12 = pk_General_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_General_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 136315138;
        v41 = "[NPKPaymentWebServiceCompanionTargetDevice currentSecureElementSnapshotResponse:]";
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Warning: %s No completion block to call, unexpected.", buf, 0xCu);
      }
    }
  }

  _Block_object_dispose(&v22, 8);

  _Block_object_dispose(&v28, 8);
  _Block_object_dispose(&v34, 8);

  v15 = *MEMORY[0x277D85DE8];
}

void __82__NPKPaymentWebServiceCompanionTargetDevice_currentSecureElementSnapshotResponse___block_invoke(uint64_t a1)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoCurrentSecureElementSnapshotResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoCurrentSecureElementSnapshotResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = [(NPKProtoCurrentSecureElementSnapshotResponse *)v7 snapshot];
    v13 = objc_opt_class();
    v14 = NPKSecureUnarchiveObject(v12, v13);
    v15 = *(*(a1 + 64) + 8);
    v16 = *(v15 + 40);
    *(v15 + 40) = v14;

    v17 = [(NPKProtoCurrentSecureElementSnapshotResponse *)v7 hasErrorData];
    if (v17)
    {
      v1 = [(NPKProtoCurrentSecureElementSnapshotResponse *)v7 errorData];
      v18 = objc_opt_class();
      v19 = NPKSecureUnarchiveObject(v1, v18);
    }

    else
    {
      v19 = 0;
    }

    objc_storeStrong((*(*(a1 + 72) + 8) + 40), v19);
    if (v17)
    {
    }
  }

  else
  {
    v20 = pk_General_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT);

    if (v21)
    {
      v22 = pk_General_log();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        v24 = 136315138;
        v25 = "[NPKPaymentWebServiceCompanionTargetDevice currentSecureElementSnapshotResponse:]_block_invoke";
        _os_log_impl(&dword_25B300000, v22, OS_LOG_TYPE_DEFAULT, "Warning: %s got response with no associated message handler", &v24, 0xCu);
      }
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)reserveStorageForAppletTypes:(id)types metadata:(id)metadata completion:(id)completion
{
  v23 = *MEMORY[0x277D85DE8];
  typesCopy = types;
  metadataCopy = metadata;
  completionCopy = completion;
  if (completionCopy)
  {
    if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isParallelProvisioningSupported])
    {
      internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __94__NPKPaymentWebServiceCompanionTargetDevice_reserveStorageForAppletTypes_metadata_completion___block_invoke;
      v16[3] = &unk_279945BB0;
      v17 = typesCopy;
      v18 = metadataCopy;
      selfCopy = self;
      v20 = completionCopy;
      dispatch_sync(internalQueue, v16);
    }

    else
    {
      (*(completionCopy + 2))(completionCopy, 0, 0, 0);
    }
  }

  else
  {
    v12 = pk_General_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_General_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 136315138;
        v22 = "[NPKPaymentWebServiceCompanionTargetDevice reserveStorageForAppletTypes:metadata:completion:]";
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: %s, nil completion, will not send message", buf, 0xCu);
      }
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

void __94__NPKPaymentWebServiceCompanionTargetDevice_reserveStorageForAppletTypes_metadata_completion___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoReserveStorageForAppletTypesRequest);
  v3 = [*(a1 + 32) mutableCopy];
  [(NPKProtoReserveStorageForAppletTypesRequest *)v2 setAppletTypes:v3];

  v4 = NPKSecureArchiveObject(*(a1 + 40));
  [(NPKProtoReserveStorageForAppletTypesRequest *)v2 setMetadata:v4];

  v5 = objc_alloc(MEMORY[0x277D189F0]);
  v6 = [(NPKProtoReserveStorageForAppletTypesRequest *)v2 data];
  v7 = [v5 initWithProtobufData:v6 type:135 isResponse:0];

  v8 = *(a1 + 48);
  v9 = [v8 _idsShortSendTimeoutProvisioningOptions];
  v10 = [v8 _sendProtobuf:v7 responseExpected:1 extraOptions:v9 priority:300];

  if (v10)
  {
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __94__NPKPaymentWebServiceCompanionTargetDevice_reserveStorageForAppletTypes_metadata_completion___block_invoke_2;
    aBlock[3] = &unk_279945218;
    v19 = *(a1 + 56);
    v11 = _Block_copy(aBlock);
    v12 = *(a1 + 48);
    v13 = _Block_copy(*(a1 + 56));
    [v12 _trackOutstandingRequestWithMessageIdentifier:v10 completionHandler:v13 errorHandler:v11];

    v14 = v19;
  }

  else
  {
    v16 = pk_General_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);

    if (!v17)
    {
      goto LABEL_4;
    }

    v14 = pk_General_log();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 136315394;
      v21 = "[NPKPaymentWebServiceCompanionTargetDevice reserveStorageForAppletTypes:metadata:completion:]_block_invoke";
      v22 = 2112;
      v23 = v7;
      _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_ERROR, "Error: %s, No message identifier for protobuf %@", buf, 0x16u);
    }
  }

LABEL_4:
  v15 = *MEMORY[0x277D85DE8];
}

void __94__NPKPaymentWebServiceCompanionTargetDevice_reserveStorageForAppletTypes_metadata_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_General_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = 138412290;
      v9 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@ for reserveStorageForAppletTypes", &v8, 0xCu);
    }
  }

  (*(*(a1 + 32) + 16))();

  v7 = *MEMORY[0x277D85DE8];
}

- (void)reserveStorageForAppletTypesResponse:(id)response
{
  v48 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  v40 = 0;
  v41 = &v40;
  v42 = 0x3032000000;
  v43 = __Block_byref_object_copy__384;
  v44 = __Block_byref_object_dispose__385;
  v45 = 0;
  v34 = 0;
  v35 = &v34;
  v36 = 0x3032000000;
  v37 = __Block_byref_object_copy__22;
  v38 = __Block_byref_object_dispose__22;
  v39 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x2020000000;
  v33 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy__22;
  v28 = __Block_byref_object_dispose__22;
  v29 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __82__NPKPaymentWebServiceCompanionTargetDevice_reserveStorageForAppletTypesResponse___block_invoke;
    block[3] = &unk_279949BA8;
    block[4] = self;
    v18 = incomingResponseIdentifier;
    v19 = responseCopy;
    v20 = &v40;
    v21 = &v34;
    v22 = &v30;
    v23 = &v24;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v8 = pk_General_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_ERROR);

    if (v9)
    {
      v10 = pk_General_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", buf, 2u);
      }
    }
  }

  v11 = v41[5];
  if (v11)
  {
    if ([v35[5] count])
    {
      v12 = v35[5];
    }

    else
    {
      v12 = 0;
    }

    (*(v11 + 16))(v11, v12, *(v31 + 24), v25[5]);
  }

  else
  {
    v13 = pk_General_log();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

    if (v14)
    {
      v15 = pk_General_log();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 136315138;
        v47 = "[NPKPaymentWebServiceCompanionTargetDevice reserveStorageForAppletTypesResponse:]";
        _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Warning: %s No completion block to call, unexpected.", buf, 0xCu);
      }
    }
  }

  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&v34, 8);

  _Block_object_dispose(&v40, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __82__NPKPaymentWebServiceCompanionTargetDevice_reserveStorageForAppletTypesResponse___block_invoke(uint64_t a1)
{
  v35 = *MEMORY[0x277D85DE8];
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoReserveStorageForAppletTypesResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoReserveStorageForAppletTypesResponse *)v5 initWithData:v6];

    v8 = [*(a1 + 32) outstandingRequests];
    [v8 removeObjectForKey:*(a1 + 40)];

    v9 = [v4 completionHandler];
    v10 = *(*(a1 + 56) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;

    v12 = objc_alloc_init(MEMORY[0x277CBEB18]);
    v13 = *(*(a1 + 64) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    v15 = [v7 reservationIDs];
    v16 = [v15 countByEnumeratingWithState:&v28 objects:v34 count:16];
    if (v16)
    {
      v1 = v16;
      v17 = *v29;
      do
      {
        for (i = 0; i != v1; i = i + 1)
        {
          if (*v29 != v17)
          {
            objc_enumerationMutation(v15);
          }

          v19 = *(*(&v28 + 1) + 8 * i);
          v20 = objc_opt_class();
          v21 = NPKSecureUnarchiveObject(v19, v20);
          [*(*(*(a1 + 64) + 8) + 40) npkSafelyAddObject:v21];
        }

        v1 = [v15 countByEnumeratingWithState:&v28 objects:v34 count:16];
      }

      while (v1);
    }

    *(*(*(a1 + 72) + 8) + 24) = [v7 isFull];
    v22 = [v7 hasErrorData];
    if (v22)
    {
      v1 = [v7 errorData];
      v23 = objc_opt_class();
      v24 = NPKSecureUnarchiveObject(v1, v23);
    }

    else
    {
      v24 = 0;
    }

    objc_storeStrong((*(*(a1 + 80) + 8) + 40), v24);
    if (v22)
    {
    }

LABEL_17:

    goto LABEL_18;
  }

  v25 = pk_General_log();
  v26 = os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT);

  if (v26)
  {
    v7 = pk_General_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 136315138;
      v33 = "[NPKPaymentWebServiceCompanionTargetDevice reserveStorageForAppletTypesResponse:]_block_invoke";
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Warning: %s got response with no associated message handler", buf, 0xCu);
    }

    goto LABEL_17;
  }

LABEL_18:

  v27 = *MEMORY[0x277D85DE8];
}

- (void)deleteReservation:(id)reservation completion:(id)completion
{
  v22 = *MEMORY[0x277D85DE8];
  reservationCopy = reservation;
  completionCopy = completion;
  if (completionCopy)
  {
    if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isParallelProvisioningSupported])
    {
      internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __74__NPKPaymentWebServiceCompanionTargetDevice_deleteReservation_completion___block_invoke;
      block[3] = &unk_279945A48;
      v17 = reservationCopy;
      selfCopy = self;
      v19 = completionCopy;
      dispatch_sync(internalQueue, block);
    }

    else
    {
      v12 = pk_General_log();
      v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

      if (v13)
      {
        v14 = pk_General_log();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 136315138;
          v21 = "[NPKPaymentWebServiceCompanionTargetDevice deleteReservation:completion:]";
          _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Notice: %s, not supported, will not send message", buf, 0xCu);
        }
      }

      completionCopy[2](completionCopy);
    }
  }

  else
  {
    v9 = pk_General_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

    if (v10)
    {
      v11 = pk_General_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 136315138;
        v21 = "[NPKPaymentWebServiceCompanionTargetDevice deleteReservation:completion:]";
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: %s, nil completion, will not send message", buf, 0xCu);
      }
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

void __74__NPKPaymentWebServiceCompanionTargetDevice_deleteReservation_completion___block_invoke(uint64_t a1)
{
  v33 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoDeleteReservationRequest);
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v3 = *(a1 + 32);
  v4 = [v3 countByEnumeratingWithState:&v24 objects:v32 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v25;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v25 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v8 = NPKSecureArchiveObject(*(*(&v24 + 1) + 8 * i));
        [(NPKProtoDeleteReservationRequest *)v2 addReservationID:v8];
      }

      v5 = [v3 countByEnumeratingWithState:&v24 objects:v32 count:16];
    }

    while (v5);
  }

  v9 = objc_alloc(MEMORY[0x277D189F0]);
  v10 = [(NPKProtoDeleteReservationRequest *)v2 data];
  v11 = [v9 initWithProtobufData:v10 type:136 isResponse:0];

  v12 = *(a1 + 40);
  v13 = [v12 _idsShortSendTimeoutProvisioningOptions];
  v14 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v13 priority:300];

  if (v14)
  {
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __74__NPKPaymentWebServiceCompanionTargetDevice_deleteReservation_completion___block_invoke_2;
    aBlock[3] = &unk_279945218;
    v23 = *(a1 + 48);
    v15 = _Block_copy(aBlock);
    v16 = *(a1 + 40);
    v17 = _Block_copy(*(a1 + 48));
    [v16 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v17 errorHandler:v15];

    v18 = v23;
  }

  else
  {
    v20 = pk_General_log();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_ERROR);

    if (!v21)
    {
      goto LABEL_11;
    }

    v18 = pk_General_log();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      *buf = 136315394;
      v29 = "[NPKPaymentWebServiceCompanionTargetDevice deleteReservation:completion:]_block_invoke";
      v30 = 2112;
      v31 = v11;
      _os_log_impl(&dword_25B300000, v18, OS_LOG_TYPE_ERROR, "Error: %s, No message identifier for protobuf %@", buf, 0x16u);
    }
  }

LABEL_11:
  v19 = *MEMORY[0x277D85DE8];
}

void __74__NPKPaymentWebServiceCompanionTargetDevice_deleteReservation_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_General_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = 138412290;
      v9 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@ for deleteReservation", &v8, 0xCu);
    }
  }

  (*(*(a1 + 32) + 16))();

  v7 = *MEMORY[0x277D85DE8];
}

- (void)deleteReservationResponse:(id)response
{
  v27 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  v19 = 0;
  v20 = &v19;
  v21 = 0x3032000000;
  v22 = __Block_byref_object_copy__384;
  v23 = __Block_byref_object_dispose__385;
  v24 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__NPKPaymentWebServiceCompanionTargetDevice_deleteReservationResponse___block_invoke;
    block[3] = &unk_279948090;
    block[4] = self;
    v17 = incomingResponseIdentifier;
    v18 = &v19;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v8 = pk_General_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_ERROR);

    if (v9)
    {
      v10 = pk_General_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", buf, 2u);
      }
    }
  }

  v11 = v20[5];
  if (v11)
  {
    (*(v11 + 16))();
  }

  else
  {
    v12 = pk_General_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_General_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 136315138;
        v26 = "[NPKPaymentWebServiceCompanionTargetDevice deleteReservationResponse:]";
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Warning: %s No completion block to call, unexpected.", buf, 0xCu);
      }
    }
  }

  _Block_object_dispose(&v19, 8);

  v15 = *MEMORY[0x277D85DE8];
}

void __71__NPKPaymentWebServiceCompanionTargetDevice_deleteReservationResponse___block_invoke(uint64_t a1)
{
  v14 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [*(a1 + 32) outstandingRequests];
    [v4 removeObjectForKey:*(a1 + 40)];

    v5 = [v3 completionHandler];
    v6 = *(*(a1 + 48) + 8);
    v7 = *(v6 + 40);
    *(v6 + 40) = v5;
  }

  else
  {
    v8 = pk_General_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

    if (v9)
    {
      v10 = pk_General_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v12 = 136315138;
        v13 = "[NPKPaymentWebServiceCompanionTargetDevice deleteReservationResponse:]_block_invoke";
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Warning: %s got response with no associated message handler", &v12, 0xCu);
      }
    }
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)allPaymentApplicationUsageSummariesWithCompletion:(id)completion
{
  v21 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v5 = pk_General_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_General_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = _Block_copy(completionCopy);
      *buf = 136315394;
      v18 = "[NPKPaymentWebServiceCompanionTargetDevice allPaymentApplicationUsageSummariesWithCompletion:]";
      v19 = 2112;
      v20 = v8;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: %s called with completion %@", buf, 0x16u);
    }
  }

  if (![(NPKPaymentWebServiceCompanionTargetDevice *)self _isDynamicSESupported])
  {
    v9 = pk_General_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

    if (v10)
    {
      v11 = pk_General_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 136315138;
        v18 = "[NPKPaymentWebServiceCompanionTargetDevice allPaymentApplicationUsageSummariesWithCompletion:]";
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Warning: Paired watch does not support %s", buf, 0xCu);
      }
    }

    (*(completionCopy + 2))(completionCopy, 0);
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __95__NPKPaymentWebServiceCompanionTargetDevice_allPaymentApplicationUsageSummariesWithCompletion___block_invoke;
  v15[3] = &unk_279945530;
  v15[4] = self;
  v16 = completionCopy;
  v13 = completionCopy;
  dispatch_sync(internalQueue, v15);

  v14 = *MEMORY[0x277D85DE8];
}

void __95__NPKPaymentWebServiceCompanionTargetDevice_allPaymentApplicationUsageSummariesWithCompletion___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoAllPaymentApplicationUsageSummariesRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoAllPaymentApplicationUsageSummariesRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:157 isResponse:0];

  v6 = *(a1 + 32);
  v7 = [v6 _idsShortSendTimeoutProvisioningOptions];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7 priority:300];

  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __95__NPKPaymentWebServiceCompanionTargetDevice_allPaymentApplicationUsageSummariesWithCompletion___block_invoke_2;
  aBlock[3] = &unk_279945218;
  v17 = *(a1 + 40);
  v9 = _Block_copy(aBlock);
  v10 = *(a1 + 32);
  v11 = _Block_copy(*(a1 + 40));
  [v10 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v11 errorHandler:v9];

  v12 = pk_General_log();
  LODWORD(v11) = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

  if (v11)
  {
    v13 = pk_General_log();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v14 = _Block_copy(*(a1 + 40));
      *buf = 136315650;
      v19 = "[NPKPaymentWebServiceCompanionTargetDevice allPaymentApplicationUsageSummariesWithCompletion:]_block_invoke";
      v20 = 2112;
      v21 = v8;
      v22 = 2112;
      v23 = v14;
      _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Notice: Tracking outstanding request for %s with identifier %@ and completion %@", buf, 0x20u);
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

void __95__NPKPaymentWebServiceCompanionTargetDevice_allPaymentApplicationUsageSummariesWithCompletion___block_invoke_2(uint64_t a1, void *a2)
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_General_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = 138412290;
      v9 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@ for allPaymentApplicationUsageSummariesWithCompletion", &v8, 0xCu);
    }
  }

  (*(*(a1 + 32) + 16))();

  v7 = *MEMORY[0x277D85DE8];
}

- (void)paymentApplicationUsageSummariesResponse:(id)response
{
  v35 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  if (incomingResponseIdentifier)
  {
    *buf = 0;
    v28 = buf;
    v29 = 0x3032000000;
    v30 = __Block_byref_object_copy__384;
    v31 = __Block_byref_object_dispose__385;
    v32 = 0;
    v21 = 0;
    v22 = &v21;
    v23 = 0x3032000000;
    v24 = __Block_byref_object_copy__22;
    v25 = __Block_byref_object_dispose__22;
    v26 = objc_alloc_init(MEMORY[0x277CBEB18]);
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __86__NPKPaymentWebServiceCompanionTargetDevice_paymentApplicationUsageSummariesResponse___block_invoke;
    block[3] = &unk_279949F68;
    block[4] = self;
    v17 = incomingResponseIdentifier;
    v19 = buf;
    v18 = responseCopy;
    v20 = &v21;
    dispatch_sync(internalQueue, block);

    v8 = *(v28 + 5);
    if (v8)
    {
      (*(v8 + 16))(v8, v22[5]);
    }

    else
    {
      v12 = pk_General_log();
      v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

      if (v13)
      {
        v14 = pk_General_log();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
        {
          *v33 = 136315138;
          v34 = "[NPKPaymentWebServiceCompanionTargetDevice paymentApplicationUsageSummariesResponse:]";
          _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Warning: %s No completion block to call, unexpected.", v33, 0xCu);
        }
      }
    }

    _Block_object_dispose(&v21, 8);
    _Block_object_dispose(buf, 8);
  }

  else
  {
    v9 = pk_General_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);

    if (v10)
    {
      v11 = pk_General_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_ERROR, "Error: paymentApplicationUsageSummariesResponse called with no associated message ID", buf, 2u);
      }
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

void __86__NPKPaymentWebServiceCompanionTargetDevice_paymentApplicationUsageSummariesResponse___block_invoke(uint64_t a1)
{
  v34 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outstandingRequests];
  v3 = [v2 objectForKey:*(a1 + 40)];

  if (v3)
  {
    v4 = [v3 completionHandler];
    v5 = *(*(a1 + 56) + 8);
    v6 = *(v5 + 40);
    *(v5 + 40) = v4;

    v7 = [NPKProtoAllPaymentApplicationUsageSummariesResponse alloc];
    v8 = [*(a1 + 48) data];
    v9 = [(NPKProtoAllPaymentApplicationUsageSummariesResponse *)v7 initWithData:v8];

    v29 = 0u;
    v30 = 0u;
    v27 = 0u;
    v28 = 0u;
    v10 = [v9 paymentApplicationUsageSummaries];
    v11 = [v10 countByEnumeratingWithState:&v27 objects:v33 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v28;
      do
      {
        v14 = 0;
        do
        {
          if (*v28 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v27 + 1) + 8 * v14);
          v16 = *(*(*(a1 + 64) + 8) + 40);
          v17 = objc_opt_class();
          v18 = NPKSecureUnarchiveObject(v15, v17);
          [v16 npkSafelyAddObject:v18];

          ++v14;
        }

        while (v12 != v14);
        v12 = [v10 countByEnumeratingWithState:&v27 objects:v33 count:16];
      }

      while (v12);
    }

    v19 = pk_General_log();
    v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

    if (v20)
    {
      v21 = pk_General_log();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
      {
        v22 = *(*(*(a1 + 64) + 8) + 40);
        *buf = 138412290;
        v32 = v22;
        _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_DEFAULT, "Notice: Received NPKProtoAllPaymentApplicationUsageSummariesResponse with summaries %@", buf, 0xCu);
      }
    }

LABEL_16:

    goto LABEL_17;
  }

  v23 = pk_General_log();
  v24 = os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT);

  if (v24)
  {
    v9 = pk_General_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v25 = *(a1 + 40);
      *buf = 138412290;
      v32 = v25;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Couldn't find outstanding request for message with ID %@", buf, 0xCu);
    }

    goto LABEL_16;
  }

LABEL_17:

  v26 = *MEMORY[0x277D85DE8];
}

- (void)reclaimUnusedSEMemory:(id)memory
{
  v22 = *MEMORY[0x277D85DE8];
  memoryCopy = memory;
  v5 = pk_General_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_General_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = _Block_copy(memoryCopy);
      *buf = 136315394;
      v19 = "[NPKPaymentWebServiceCompanionTargetDevice reclaimUnusedSEMemory:]";
      v20 = 2112;
      v21 = v8;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: %s called with completion %@", buf, 0x16u);
    }
  }

  if (![(NPKPaymentWebServiceCompanionTargetDevice *)self _isDynamicSESupported])
  {
    v9 = pk_General_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

    if (v10)
    {
      v11 = pk_General_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 136315138;
        v19 = "[NPKPaymentWebServiceCompanionTargetDevice reclaimUnusedSEMemory:]";
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Warning: Paired watch does not support %s", buf, 0xCu);
      }
    }

    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
    (*(memoryCopy + 2))(memoryCopy, 0, v12);
  }

  internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __67__NPKPaymentWebServiceCompanionTargetDevice_reclaimUnusedSEMemory___block_invoke;
  v16[3] = &unk_279945530;
  v16[4] = self;
  v17 = memoryCopy;
  v14 = memoryCopy;
  dispatch_sync(internalQueue, v16);

  v15 = *MEMORY[0x277D85DE8];
}

void __67__NPKPaymentWebServiceCompanionTargetDevice_reclaimUnusedSEMemory___block_invoke(uint64_t a1)
{
  v2 = objc_alloc_init(NPKProtoReclaimUnusedSEMemoryRequest);
  v3 = objc_alloc(MEMORY[0x277D189F0]);
  v4 = [(NPKProtoReclaimUnusedSEMemoryRequest *)v2 data];
  v5 = [v3 initWithProtobufData:v4 type:158 isResponse:0];

  v6 = *(a1 + 32);
  v7 = [v6 _idsShortSendTimeoutProvisioningOptions];
  v8 = [v6 _sendProtobuf:v5 responseExpected:1 extraOptions:v7 priority:300];

  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __67__NPKPaymentWebServiceCompanionTargetDevice_reclaimUnusedSEMemory___block_invoke_2;
  aBlock[3] = &unk_279945218;
  v13 = *(a1 + 40);
  v9 = _Block_copy(aBlock);
  v10 = *(a1 + 32);
  v11 = _Block_copy(*(a1 + 40));
  [v10 _trackOutstandingRequestWithMessageIdentifier:v8 completionHandler:v11 errorHandler:v9];
}

void __67__NPKPaymentWebServiceCompanionTargetDevice_reclaimUnusedSEMemory___block_invoke_2(uint64_t a1, void *a2)
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_General_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = 138412290;
      v9 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@ for reclaimUnusedSEMemory", &v8, 0xCu);
    }
  }

  (*(*(a1 + 32) + 16))();

  v7 = *MEMORY[0x277D85DE8];
}

- (void)reclaimUnusedSEMemoryResponse:(id)response
{
  v43 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  if (incomingResponseIdentifier)
  {
    *buf = 0;
    v36 = buf;
    v37 = 0x3032000000;
    v38 = __Block_byref_object_copy__384;
    v39 = __Block_byref_object_dispose__385;
    v40 = 0;
    v29 = 0;
    v30 = &v29;
    v31 = 0x3032000000;
    v32 = __Block_byref_object_copy__22;
    v33 = __Block_byref_object_dispose__22;
    v34 = 0;
    v23 = 0;
    v24 = &v23;
    v25 = 0x3032000000;
    v26 = __Block_byref_object_copy__22;
    v27 = __Block_byref_object_dispose__22;
    v28 = 0;
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __75__NPKPaymentWebServiceCompanionTargetDevice_reclaimUnusedSEMemoryResponse___block_invoke;
    v16[3] = &unk_279949C48;
    v17 = responseCopy;
    selfCopy = self;
    v19 = incomingResponseIdentifier;
    v20 = buf;
    v21 = &v29;
    v22 = &v23;
    dispatch_sync(internalQueue, v16);

    v8 = *(v36 + 5);
    if (v8)
    {
      (*(v8 + 16))(v8, v30[5], v24[5]);
    }

    else
    {
      v12 = pk_General_log();
      v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

      if (v13)
      {
        v14 = pk_General_log();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
        {
          *v41 = 136315138;
          v42 = "[NPKPaymentWebServiceCompanionTargetDevice reclaimUnusedSEMemoryResponse:]";
          _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Warning: Unexpected missing completion on outstanding request for %s", v41, 0xCu);
        }
      }
    }

    _Block_object_dispose(&v23, 8);
    _Block_object_dispose(&v29, 8);

    _Block_object_dispose(buf, 8);
  }

  else
  {
    v9 = pk_General_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);

    if (v10)
    {
      v11 = pk_General_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_ERROR, "Error: reclaimUnusedSEMemoryResponse called with no associated message ID", buf, 2u);
      }
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

void __75__NPKPaymentWebServiceCompanionTargetDevice_reclaimUnusedSEMemoryResponse___block_invoke(uint64_t a1)
{
  v28 = *MEMORY[0x277D85DE8];
  v2 = [NPKProtoReclaimUnusedSEMemoryResponse alloc];
  v3 = [*(a1 + 32) data];
  v4 = [(NPKProtoReclaimUnusedSEMemoryResponse *)v2 initWithData:v3];

  v5 = [*(a1 + 40) outstandingRequests];
  v6 = [v5 objectForKeyedSubscript:*(a1 + 48)];

  if (v6)
  {
    v7 = [v6 completionHandler];
    v8 = *(*(a1 + 56) + 8);
    v9 = *(v8 + 40);
    *(v8 + 40) = v7;
  }

  else
  {
    v10 = pk_General_log();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

    if (v11)
    {
      v12 = pk_General_log();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        v26 = 136315138;
        v27 = "[NPKPaymentWebServiceCompanionTargetDevice reclaimUnusedSEMemoryResponse:]_block_invoke";
        _os_log_impl(&dword_25B300000, v12, OS_LOG_TYPE_DEFAULT, "Warning: Could not find outstanding request for %s", &v26, 0xCu);
      }
    }
  }

  v13 = [(NPKProtoReclaimUnusedSEMemoryResponse *)v4 snapshotData];
  v14 = objc_opt_class();
  v15 = NPKSecureUnarchiveObject(v13, v14);
  v16 = *(*(a1 + 64) + 8);
  v17 = *(v16 + 40);
  *(v16 + 40) = v15;

  v18 = pk_General_log();
  v19 = os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT);

  if (v19)
  {
    v20 = pk_General_log();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
    {
      v21 = *(*(*(a1 + 64) + 8) + 40);
      v26 = 138412290;
      v27 = v21;
      _os_log_impl(&dword_25B300000, v20, OS_LOG_TYPE_DEFAULT, "Notice: Unarchived snapshot as %@", &v26, 0xCu);
    }
  }

  v22 = [(NPKProtoReclaimUnusedSEMemoryResponse *)v4 hasErrorData];
  if (v22)
  {
    v19 = [(NPKProtoReclaimUnusedSEMemoryResponse *)v4 errorData];
    v23 = objc_opt_class();
    v24 = NPKSecureUnarchiveObject(v19, v23);
  }

  else
  {
    v24 = 0;
  }

  objc_storeStrong((*(*(a1 + 72) + 8) + 40), v24);
  if (v22)
  {
  }

  v25 = *MEMORY[0x277D85DE8];
}

- (id)_idsShortSendTimeoutProvisioningOptions
{
  v7[3] = *MEMORY[0x277D85DE8];
  v2 = *MEMORY[0x277D18580];
  v6[0] = *MEMORY[0x277D185D0];
  v6[1] = v2;
  v7[0] = MEMORY[0x277CBEC38];
  v7[1] = MEMORY[0x277CBEC38];
  v6[2] = *MEMORY[0x277D18650];
  v7[2] = &unk_286CE7818;
  v3 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v7 forKeys:v6 count:3];
  v4 = *MEMORY[0x277D85DE8];

  return v3;
}

- (void)addPendingProvisionings:(id)provisionings completion:(id)completion
{
  v18[1] = *MEMORY[0x277D85DE8];
  provisioningsCopy = provisionings;
  completionCopy = completion;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isParallelProvisioningSupported])
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __80__NPKPaymentWebServiceCompanionTargetDevice_addPendingProvisionings_completion___block_invoke;
    v13[3] = &unk_279945A48;
    v14 = provisioningsCopy;
    selfCopy = self;
    v16 = completionCopy;
    dispatch_sync(internalQueue, v13);

    v9 = v14;
  }

  else
  {
    v10 = MEMORY[0x277CCA9B8];
    v17 = *MEMORY[0x277CCA068];
    v18[0] = @"Parallel provisioning not supported on this device.";
    v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v18 forKeys:&v17 count:1];
    v9 = [v10 errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:v11];

    (*(completionCopy + 2))(completionCopy, v9);
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __80__NPKPaymentWebServiceCompanionTargetDevice_addPendingProvisionings_completion___block_invoke(uint64_t a1)
{
  v26 = *MEMORY[0x277D85DE8];
  v2 = objc_alloc_init(NPKProtoAddPendingProvisioningRequest);
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v3 = *(a1 + 32);
  v4 = [v3 countByEnumeratingWithState:&v21 objects:v25 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v22;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v22 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v8 = NPKSecureArchiveObject(*(*(&v21 + 1) + 8 * i));
        [(NPKProtoAddPendingProvisioningRequest *)v2 addPendingProvisioning:v8];
      }

      v5 = [v3 countByEnumeratingWithState:&v21 objects:v25 count:16];
    }

    while (v5);
  }

  v9 = objc_alloc(MEMORY[0x277D189F0]);
  v10 = [(NPKProtoAddPendingProvisioningRequest *)v2 data];
  v11 = [v9 initWithProtobufData:v10 type:137 isResponse:0];

  v12 = *(a1 + 40);
  v13 = [v12 _idsShortSendTimeoutProvisioningOptions];
  v14 = [v12 _sendProtobuf:v11 responseExpected:1 extraOptions:v13 priority:300];

  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __80__NPKPaymentWebServiceCompanionTargetDevice_addPendingProvisionings_completion___block_invoke_2;
  aBlock[3] = &unk_279945218;
  v20 = *(a1 + 48);
  v15 = _Block_copy(aBlock);
  v16 = *(a1 + 40);
  v17 = _Block_copy(*(a1 + 48));
  [v16 _trackOutstandingRequestWithMessageIdentifier:v14 completionHandler:v17 errorHandler:v15];

  v18 = *MEMORY[0x277D85DE8];
}

void __80__NPKPaymentWebServiceCompanionTargetDevice_addPendingProvisionings_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_General_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = 138412290;
      v9 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@ for addPendingProvisionings", &v8, 0xCu);
    }
  }

  (*(*(a1 + 32) + 16))();

  v7 = *MEMORY[0x277D85DE8];
}

- (void)addPendingProvisioningsResponse:(id)response
{
  v35 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  context = [responseCopy context];
  incomingResponseIdentifier = [context incomingResponseIdentifier];

  v27 = 0;
  v28 = &v27;
  v29 = 0x3032000000;
  v30 = __Block_byref_object_copy__384;
  v31 = __Block_byref_object_dispose__385;
  v32 = 0;
  v21 = 0;
  v22 = &v21;
  v23 = 0x3032000000;
  v24 = __Block_byref_object_copy__22;
  v25 = __Block_byref_object_dispose__22;
  v26 = 0;
  if (incomingResponseIdentifier)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __77__NPKPaymentWebServiceCompanionTargetDevice_addPendingProvisioningsResponse___block_invoke;
    block[3] = &unk_279949CC0;
    block[4] = self;
    v17 = incomingResponseIdentifier;
    v18 = responseCopy;
    v19 = &v21;
    v20 = &v27;
    dispatch_sync(internalQueue, block);
  }

  else
  {
    v8 = pk_General_log();
    v9 = os_log_type_enabled(v8, OS_LOG_TYPE_ERROR);

    if (v9)
    {
      v10 = pk_General_log();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_ERROR, "Error: No associated message ID in response", buf, 2u);
      }
    }
  }

  v11 = v28[5];
  if (v11)
  {
    (*(v11 + 16))(v11, v22[5]);
  }

  else
  {
    v12 = pk_General_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (v13)
    {
      v14 = pk_General_log();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 136315138;
        v34 = "[NPKPaymentWebServiceCompanionTargetDevice addPendingProvisioningsResponse:]";
        _os_log_impl(&dword_25B300000, v14, OS_LOG_TYPE_DEFAULT, "Warning: %s No completion block to call, unexpected.", buf, 0xCu);
      }
    }
  }

  _Block_object_dispose(&v21, 8);

  _Block_object_dispose(&v27, 8);
  v15 = *MEMORY[0x277D85DE8];
}

void __77__NPKPaymentWebServiceCompanionTargetDevice_addPendingProvisioningsResponse___block_invoke(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = [*(a1 + 32) outstandingRequests];
  v4 = [v3 objectForKey:*(a1 + 40)];

  if (v4)
  {
    v5 = [NPKProtoAddPendingProvisioningResponse alloc];
    v6 = [*(a1 + 48) data];
    v7 = [(NPKProtoAddPendingProvisioningResponse *)v5 initWithData:v6];

    v8 = [(NPKProtoAddPendingProvisioningResponse *)v7 hasErrorData];
    if (v8)
    {
      v1 = [(NPKProtoAddPendingProvisioningResponse *)v7 errorData];
      v9 = objc_opt_class();
      v10 = NPKSecureUnarchiveObject(v1, v9);
    }

    else
    {
      v10 = 0;
    }

    objc_storeStrong((*(*(a1 + 56) + 8) + 40), v10);
    if (v8)
    {
    }

    v14 = [*(a1 + 32) outstandingRequests];
    [v14 removeObjectForKey:*(a1 + 40)];

    v15 = [v4 completionHandler];
    v16 = *(*(a1 + 64) + 8);
    v17 = *(v16 + 40);
    *(v16 + 40) = v15;
  }

  else
  {
    v11 = pk_General_log();
    v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);

    if (v12)
    {
      v13 = pk_General_log();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        v19 = 136315138;
        v20 = "[NPKPaymentWebServiceCompanionTargetDevice addPendingProvisioningsResponse:]_block_invoke";
        _os_log_impl(&dword_25B300000, v13, OS_LOG_TYPE_DEFAULT, "Warning: %s got response with no associated message handler", &v19, 0xCu);
      }
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)addPendingProvisioningsRequest:(id)request
{
  v43 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [requestCopy npkDescription];
      *buf = 138412290;
      v42 = npkDescription;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Target device - received add pending provisionings request: %@", buf, 0xCu);
    }
  }

  v8 = [NPKProtoAddPendingProvisioningRequest alloc];
  v29 = requestCopy;
  data = [requestCopy data];
  v10 = [(NPKProtoAddPendingProvisioningRequest *)v8 initWithData:data];

  v32 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{-[NPKProtoAddPendingProvisioningRequest pendingProvisioningsCount](v10, "pendingProvisioningsCount")}];
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v28 = v10;
  obj = [(NPKProtoAddPendingProvisioningRequest *)v10 pendingProvisionings];
  v33 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
  if (v33)
  {
    v31 = *v37;
    do
    {
      v11 = 0;
      do
      {
        if (*v37 != v31)
        {
          objc_enumerationMutation(obj);
        }

        v34 = MEMORY[0x277CBEB98];
        v35 = *(*(&v36 + 1) + 8 * v11);
        v12 = objc_opt_class();
        v13 = objc_opt_class();
        v14 = objc_opt_class();
        v15 = objc_opt_class();
        v16 = objc_opt_class();
        v17 = objc_opt_class();
        v18 = objc_opt_class();
        v19 = objc_opt_class();
        v20 = objc_opt_class();
        v21 = [v34 setWithObjects:{v12, v13, v14, v15, v16, v17, v18, v19, v20, objc_opt_class(), 0}];
        v22 = NPKSecureUnarchiveObjectOfClasses(v35, v21);
        [v32 npkSafelyAddObject:v22];

        ++v11;
      }

      while (v33 != v11);
      v33 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
    }

    while (v33);
  }

  v23 = pk_General_log();
  v24 = os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT);

  if (v24)
  {
    v25 = pk_General_log();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v42 = v32;
      _os_log_impl(&dword_25B300000, v25, OS_LOG_TYPE_DEFAULT, "Notice: Will add pending provisionings: %@", buf, 0xCu);
    }
  }

  v26 = objc_alloc_init(MEMORY[0x277D380F0]);
  [v26 addPendingProvisionings:v32 completion:&__block_literal_global_1022];

  v27 = *MEMORY[0x277D85DE8];
}

void __76__NPKPaymentWebServiceCompanionTargetDevice_addPendingProvisioningsRequest___block_invoke(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = a2;
  v3 = pk_General_log();
  v4 = v3;
  if (v2)
  {
    v5 = os_log_type_enabled(v3, OS_LOG_TYPE_ERROR);

    if (v5)
    {
      v6 = pk_General_log();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
      {
        v13 = 138412290;
        v14 = v2;
        v7 = "Error: addPendingProvisionings: failed with error: %@";
        v8 = v6;
        v9 = OS_LOG_TYPE_ERROR;
        v10 = 12;
LABEL_8:
        _os_log_impl(&dword_25B300000, v8, v9, v7, &v13, v10);
        goto LABEL_9;
      }

      goto LABEL_9;
    }
  }

  else
  {
    v11 = os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT);

    if (v11)
    {
      v6 = pk_General_log();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
      {
        LOWORD(v13) = 0;
        v7 = "Notice: addPendingProvisionings: completed with success!";
        v8 = v6;
        v9 = OS_LOG_TYPE_DEFAULT;
        v10 = 2;
        goto LABEL_8;
      }

LABEL_9:
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)pendingProvisioningReceiptRequest:(id)request
{
  v30 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      npkDescription = [requestCopy npkDescription];
      v28 = 138412290;
      v29 = npkDescription;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Target device - received  pending provisionings receipt request: %@", &v28, 0xCu);
    }
  }

  v9 = [NPKProtoPendingProvisioningReceiptRequest alloc];
  data = [requestCopy data];
  v11 = [(NPKProtoPendingProvisioningReceiptRequest *)v9 initWithData:data];

  identifier = [(NPKProtoPendingProvisioningReceiptRequest *)v11 identifier];
  receiptData = [(NPKProtoPendingProvisioningReceiptRequest *)v11 receiptData];
  v14 = objc_opt_class();
  v15 = NPKSecureUnarchiveObject(receiptData, v14);

  if (identifier && v15)
  {
    v16 = pk_Payment_log();
    v17 = os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT);

    if (v17)
    {
      v18 = pk_Payment_log();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        v28 = 138412290;
        v29 = v15;
      }
    }

    v19 = objc_alloc_init(MEMORY[0x277D380F0]);
    if (objc_opt_respondsToSelector())
    {
      [v19 addRemoteDevicePendingProvisioningReceipt:v15];
    }

    v20 = objc_alloc_init(NPKProtoPendingProvisioningReceiptResponse);
    [(NPKProtoPendingProvisioningReceiptResponse *)v20 setIdentifier:identifier];
    v21 = objc_alloc(MEMORY[0x277D189F0]);
    data2 = [(NPKProtoPendingProvisioningReceiptResponse *)v20 data];
    v23 = [v21 initWithProtobufData:data2 type:156 isResponse:1];

    v24 = [(NPKPaymentWebServiceCompanionTargetDevice *)self _sendProtobuf:v23 responseExpected:0];
  }

  else
  {
    v25 = pk_General_log();
    v26 = os_log_type_enabled(v25, OS_LOG_TYPE_ERROR);

    if (!v26)
    {
      goto LABEL_18;
    }

    v19 = pk_General_log();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v28 = 136315138;
      v29 = "[NPKPaymentWebServiceCompanionTargetDevice pendingProvisioningReceiptRequest:]";
      _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_ERROR, "Error: Target device - unexpected data at %s", &v28, 0xCu);
    }
  }

LABEL_18:
  v27 = *MEMORY[0x277D85DE8];
}

- (void)hasActiveExternallySharedPassesWithCompletion:(id)completion
{
  completionCopy = completion;
  v5 = NPKPairedOrPairingDevice();
  v6 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"FD975695-3B94-465A-86E1-26276C5835A8"];
  v7 = [v5 supportsCapability:v6];

  if (v7)
  {
    internalQueue = [(NPKPaymentWebServiceCompanionTargetDevice *)self internalQueue];
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_hasActiveExternallySharedPassesWithCompletion___block_invoke;
    v13[3] = &unk_279945530;
    v13[4] = self;
    v14 = completionCopy;
    dispatch_sync(internalQueue, v13);
  }

  else
  {
    v9 = pk_General_log();
    v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

    if (v10)
    {
      v11 = pk_General_log();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Target device does not support the message. Not sending message to get has active externally shared passes.", buf, 2u);
      }
    }

    if (completionCopy)
    {
      v12 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1006 userInfo:0];
      (*(completionCopy + 2))(completionCopy, 0, v12);
    }
  }
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_hasActiveExternallySharedPassesWithCompletion___block_invoke(uint64_t a1)
{
  v34[3] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) provisioningService];
  CanSendMessage = NPKProtoCanSendMessage(v2);

  v4 = pk_General_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);

  if (CanSendMessage)
  {
    if (v5)
    {
      v6 = pk_General_log();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 0;
        _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_DEFAULT, "Notice: Has active externally shared passes: sending message", buf, 2u);
      }
    }

    v7 = objc_alloc_init(NPKProtoHasActiveExternallySharedPassesRequest);
    v8 = objc_alloc(MEMORY[0x277D189F0]);
    v9 = [(NPKProtoHasActiveExternallySharedPassesRequest *)v7 data];
    v10 = [v8 initWithProtobufData:v9 type:132 isResponse:0];

    v11 = *MEMORY[0x277D18580];
    v33[0] = *MEMORY[0x277D185D0];
    v33[1] = v11;
    v34[0] = MEMORY[0x277CBEC38];
    v34[1] = MEMORY[0x277CBEC38];
    v33[2] = *MEMORY[0x277D18650];
    v34[2] = &unk_286CE7818;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v34 forKeys:v33 count:3];
    v13 = [*(a1 + 32) _sendProtobuf:v10 responseExpected:1 extraOptions:v12 priority:300];
    if (v13)
    {
      v14 = *(a1 + 40);
      if (v14)
      {
        v15 = _Block_copy(v14);
        aBlock[0] = MEMORY[0x277D85DD0];
        aBlock[1] = 3221225472;
        aBlock[2] = __91__NPKPaymentWebServiceCompanionTargetDevice_hasActiveExternallySharedPassesWithCompletion___block_invoke_1032;
        aBlock[3] = &unk_279945218;
        v30 = *(a1 + 40);
        v16 = _Block_copy(aBlock);
        v17 = *(a1 + 32);
        v18 = _Block_copy(v15);
        [v17 _trackOutstandingRequestWithMessageIdentifier:v13 completionHandler:v18 errorHandler:v16];

LABEL_22:
        goto LABEL_23;
      }

      v26 = pk_Payment_log();
      v27 = os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT);

      if (v27)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v32 = v13;
        v23 = "Warning: No response expected for message with identifier %@";
        v24 = v15;
        v25 = OS_LOG_TYPE_DEFAULT;
        goto LABEL_21;
      }
    }

    else
    {
      v21 = pk_Payment_log();
      v22 = os_log_type_enabled(v21, OS_LOG_TYPE_ERROR);

      if (v22)
      {
        v15 = pk_Payment_log();
        if (!os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_22;
        }

        *buf = 138412290;
        v32 = v10;
        v23 = "Error: No message identifier for protobuf %@";
        v24 = v15;
        v25 = OS_LOG_TYPE_ERROR;
LABEL_21:
        _os_log_impl(&dword_25B300000, v24, v25, v23, buf, 0xCu);
        goto LABEL_22;
      }
    }

LABEL_23:

    goto LABEL_24;
  }

  if (v5)
  {
    v19 = pk_General_log();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_25B300000, v19, OS_LOG_TYPE_DEFAULT, "Notice: Has active externally shared passes, device is not connected, will not send message", buf, 2u);
    }
  }

  v7 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1001 userInfo:0];
  v20 = *(a1 + 40);
  if (v20)
  {
    (*(v20 + 16))(v20, 0, v7);
  }

LABEL_24:

  v28 = *MEMORY[0x277D85DE8];
}

void __91__NPKPaymentWebServiceCompanionTargetDevice_hasActiveExternallySharedPassesWithCompletion___block_invoke_1032(uint64_t a1, void *a2)
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = pk_Payment_log();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_ERROR);

  if (v5)
  {
    v6 = pk_Payment_log();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v10 = 138412290;
      v11 = v3;
      _os_log_impl(&dword_25B300000, v6, OS_LOG_TYPE_ERROR, "Error: Provisioning service outstanding request error handler invoked: %@", &v10, 0xCu);
    }
  }

  v7 = *(a1 + 32);
  if (v7)
  {
    v8 = [MEMORY[0x277CCA9B8] errorWithDomain:@"com.apple.NPKErrorDomain" code:-1001 userInfo:0];
    (*(v7 + 16))(v7, 0, v8);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)expressModeEnabledForPassIdentifier:(id)identifier completion:(id)completion
{
  identifierCopy = identifier;
  completionCopy = completion;
  v12 = 0;
  v13 = &v12;
  v14 = 0x2020000000;
  v15 = 0;
  v7 = NPKPairedDeviceCurrentExpressPassConfiguration();
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __92__NPKPaymentWebServiceCompanionTargetDevice_expressModeEnabledForPassIdentifier_completion___block_invoke;
  v9[3] = &unk_279948878;
  v8 = identifierCopy;
  v10 = v8;
  v11 = &v12;
  [v7 enumerateObjectsUsingBlock:v9];
  if (completionCopy)
  {
    completionCopy[2](completionCopy, *(v13 + 24));
  }

  _Block_object_dispose(&v12, 8);
}

void __92__NPKPaymentWebServiceCompanionTargetDevice_expressModeEnabledForPassIdentifier_completion___block_invoke(uint64_t a1, void *a2, _BYTE *a3)
{
  v5 = [a2 passUniqueIdentifier];
  v6 = [v5 isEqualToString:*(a1 + 32)];

  if (v6)
  {
    *(*(*(a1 + 40) + 8) + 24) = 1;
    *a3 = 1;
  }
}

- (void)passcodeChangeCoordinator:(id)coordinator remoteDeviceShouldInitiatePasscodeChangeForType:(unint64_t)type completion:(id)completion
{
  completionCopy = completion;
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __130__NPKPaymentWebServiceCompanionTargetDevice_passcodeChangeCoordinator_remoteDeviceShouldInitiatePasscodeChangeForType_completion___block_invoke;
  v9[3] = &unk_27994A8B8;
  v10 = completionCopy;
  typeCopy = type;
  v8 = completionCopy;
  [(NPKPaymentWebServiceCompanionTargetDevice *)self presentRemoteDevicePasscodeUpgradePromptForChangeType:type completion:v9];
}

void __130__NPKPaymentWebServiceCompanionTargetDevice_passcodeChangeCoordinator_remoteDeviceShouldInitiatePasscodeChangeForType_completion___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = NSStringFromNPKPasscodeUpgradeChangeType(*(a1 + 40));
      v10 = @"NO";
      v13 = 138412802;
      v14 = v9;
      v15 = 2112;
      if (a2)
      {
        v10 = @"YES";
      }

      v16 = v10;
      v17 = 2112;
      v18 = v5;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Remote device prompted for passcode change (%@) with success: %@, error: %@", &v13, 0x20u);
    }
  }

  v11 = *(a1 + 32);
  if (v11)
  {
    (*(v11 + 16))(v11, a2, v5);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)passcodeChangeCoordinator:(id)coordinator remoteDeviceShouldCancelPasscodeChangeWithCompletion:(id)completion
{
  completionCopy = completion;
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __124__NPKPaymentWebServiceCompanionTargetDevice_passcodeChangeCoordinator_remoteDeviceShouldCancelPasscodeChangeWithCompletion___block_invoke;
  v7[3] = &unk_279944F48;
  v8 = completionCopy;
  v6 = completionCopy;
  [(NPKPaymentWebServiceCompanionTargetDevice *)self dismissRemoteDevicePasscodeUpgradePromptWithCompletion:v7];
}

void __124__NPKPaymentWebServiceCompanionTargetDevice_passcodeChangeCoordinator_remoteDeviceShouldCancelPasscodeChangeWithCompletion___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = @"NO";
      if (a2)
      {
        v9 = @"YES";
      }

      v12 = 138412546;
      v13 = v9;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Remote device dismissed passcode upgrade prompt with success: %@, error: %@", &v12, 0x16u);
    }
  }

  v10 = *(a1 + 32);
  if (v10)
  {
    (*(v10 + 16))(v10, a2, v5);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)passcodeChangeCoordinator:(id)coordinator checkRemoteDeviceLockStateWithCompletion:(id)completion
{
  completionCopy = completion;
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __112__NPKPaymentWebServiceCompanionTargetDevice_passcodeChangeCoordinator_checkRemoteDeviceLockStateWithCompletion___block_invoke;
  v7[3] = &unk_279946BA8;
  v8 = completionCopy;
  v6 = completionCopy;
  [(NPKPaymentWebServiceCompanionTargetDevice *)self fetchRemoteDevicePasscodeStateWithCompletion:v7];
}

void __112__NPKPaymentWebServiceCompanionTargetDevice_passcodeChangeCoordinator_checkRemoteDeviceLockStateWithCompletion___block_invoke(uint64_t a1, uint64_t a2, uint64_t a3, void *a4)
{
  v17 = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = pk_Payment_log();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT);

  if (v8)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = @"NO";
      if (a3)
      {
        v10 = @"YES";
      }

      v13 = 138412546;
      v14 = v10;
      v15 = 2112;
      v16 = v6;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Remote device is passcode locked: %@, error: %@", &v13, 0x16u);
    }
  }

  v11 = *(a1 + 32);
  if (v11)
  {
    (*(v11 + 16))(v11, a3, v6);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_addCompanionDevicePhoneNumberDataIfNeededWithFields:(unint64_t)fields toDeviceMetadata:(id)metadata
{
  v28 = *MEMORY[0x277D85DE8];
  metadataCopy = metadata;
  v6 = pk_Payment_log();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT);

  if (v7)
  {
    v8 = pk_Payment_log();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v24 = 134217984;
      fieldsCopy = fields;
      _os_log_impl(&dword_25B300000, v8, OS_LOG_TYPE_DEFAULT, "Notice: Device Metadata: Verifying whether phone number data needs to be added for fields: %lu", &v24, 0xCu);
    }
  }

  if (metadataCopy)
  {
    if (NPKPairedOrPairingDeviceIsTinker())
    {
      v9 = pk_Payment_log();
      v10 = os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT);

      if (v10)
      {
        v11 = pk_Payment_log();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
        {
          LOWORD(v24) = 0;
          _os_log_impl(&dword_25B300000, v11, OS_LOG_TYPE_DEFAULT, "Notice: Device Metadata: Phone number data not applicable for family device", &v24, 2u);
        }

LABEL_27:
      }
    }

    else
    {
      if ((fields & 0x20) != 0)
      {
        v12 = PKDevicePhoneNumber();
        if ([v12 length])
        {
          [metadataCopy setPhoneNumber:v12];
        }

        v13 = pk_Payment_log();
        v14 = os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT);

        if (v14)
        {
          v15 = pk_Payment_log();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
          {
            v24 = 138412290;
            fieldsCopy = v12;
            _os_log_impl(&dword_25B300000, v15, OS_LOG_TYPE_DEFAULT, "Notice: Device Metadata: Phone number %@ to be added", &v24, 0xCu);
          }
        }
      }

      if ((fields & 0x40) != 0)
      {
        v16 = PKDevicePhoneNumberSignature();
        v11 = v16;
        if (v16)
        {
          v17 = [v16 objectForKeyedSubscript:*MEMORY[0x277CC4398]];
          v18 = [v11 objectForKeyedSubscript:*MEMORY[0x277CC43A0]];
          [metadataCopy setSignedPhoneNumber:v17];
          [metadataCopy setSignedPhoneNumberVersion:v18];
        }

        else
        {
          v18 = 0;
          v17 = 0;
        }

        v19 = pk_Payment_log();
        v20 = os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT);

        if (v20)
        {
          v21 = pk_Payment_log();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
          {
            v22 = [v17 length];
            v24 = 134218242;
            fieldsCopy = v22;
            v26 = 2112;
            v27 = v18;
            _os_log_impl(&dword_25B300000, v21, OS_LOG_TYPE_DEFAULT, "Notice: Device Metadata: Phone number signature (%lu characters long) and version %@ to be added", &v24, 0x16u);
          }
        }

        goto LABEL_27;
      }
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_acquireAssertionOfType:(unint64_t)type
{
  v13 = *MEMORY[0x277D85DE8];
  v5 = pk_Payment_log();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v7 = pk_Payment_log();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v11 = 134217984;
      typeCopy = type;
      _os_log_impl(&dword_25B300000, v7, OS_LOG_TYPE_DEFAULT, "Notice: Acquiring assertion of type:%lu", &v11, 0xCu);
    }
  }

  remoteDeviceAssertionManager = [(NPKPaymentWebServiceCompanionTargetDevice *)self remoteDeviceAssertionManager];
  v9 = [remoteDeviceAssertionManager acquireAssertionOfType:type];

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_invalidateAssertionOfType:(unint64_t)type
{
  v18 = *MEMORY[0x277D85DE8];
  remoteDeviceAssertionManager = [(NPKPaymentWebServiceCompanionTargetDevice *)self remoteDeviceAssertionManager];
  v6 = [remoteDeviceAssertionManager assertionsUUIDsOfType:type];
  lastObject = [v6 lastObject];

  v8 = pk_Payment_log();
  LODWORD(v6) = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

  if (v6)
  {
    v9 = pk_Payment_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v14 = 134218242;
      typeCopy = type;
      v16 = 2112;
      v17 = lastObject;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_DEFAULT, "Notice: Invalidating assertion of type:%lu UUID:%@", &v14, 0x16u);
    }
  }

  if (lastObject)
  {
    remoteDeviceAssertionManager2 = [(NPKPaymentWebServiceCompanionTargetDevice *)self remoteDeviceAssertionManager];
    [remoteDeviceAssertionManager2 invalidateAssertionWithUUID:lastObject];
  }

  else
  {
    v12 = pk_Payment_log();
    v13 = os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT);

    if (!v13)
    {
      goto LABEL_8;
    }

    remoteDeviceAssertionManager2 = pk_Payment_log();
    if (os_log_type_enabled(remoteDeviceAssertionManager2, OS_LOG_TYPE_DEFAULT))
    {
      LOWORD(v14) = 0;
      _os_log_impl(&dword_25B300000, remoteDeviceAssertionManager2, OS_LOG_TYPE_DEFAULT, "Warning: We don't have any assertion to invalidate", &v14, 2u);
    }
  }

LABEL_8:
  v11 = *MEMORY[0x277D85DE8];
}

- (void)_trackOutstandingRequestWithMessageIdentifier:(id)identifier completionHandler:(id)handler errorHandler:(id)errorHandler
{
  identifierCopy = identifier;
  handlerCopy = handler;
  errorHandlerCopy = errorHandler;
  v11 = objc_alloc_init(NPKProvisioningServiceOutstandingRequest);
  [(NPKProvisioningServiceOutstandingRequest *)v11 setCompletionHandler:handlerCopy];
  [(NPKProvisioningServiceOutstandingRequest *)v11 setErrorHandler:errorHandlerCopy];
  [(NPKProvisioningServiceOutstandingRequest *)v11 setMessageIdentifier:identifierCopy];
  objc_initWeak(&location, self);
  v15 = MEMORY[0x277D85DD0];
  v16 = 3221225472;
  v17 = __122__NPKPaymentWebServiceCompanionTargetDevice__trackOutstandingRequestWithMessageIdentifier_completionHandler_errorHandler___block_invoke;
  v18 = &unk_279945A98;
  objc_copyWeak(&v21, &location);
  v12 = identifierCopy;
  v19 = v12;
  v13 = errorHandlerCopy;
  v20 = v13;
  [(NPKProvisioningServiceOutstandingRequest *)v11 setTimeoutHandler:&v15];
  [(NPKProvisioningServiceOutstandingRequest *)v11 setTimeoutQueue:self->_internalQueue, v15, v16, v17, v18];
  outstandingRequests = [(NPKPaymentWebServiceCompanionTargetDevice *)self outstandingRequests];
  [outstandingRequests setObject:v11 forKey:v12];

  [(NPKProvisioningServiceOutstandingRequest *)v11 setOrResetCleanupTimer];
  objc_destroyWeak(&v21);
  objc_destroyWeak(&location);
}

void __122__NPKPaymentWebServiceCompanionTargetDevice__trackOutstandingRequestWithMessageIdentifier_completionHandler_errorHandler___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = WeakRetained;
  if (WeakRetained)
  {
    dispatch_assert_queue_V2(WeakRetained[6]);
    v4 = [(dispatch_queue_t *)v3 outstandingRequests];
    v5 = [v4 objectForKeyedSubscript:*(a1 + 32)];

    v6 = [v5 errorHandler];
    v7 = [(dispatch_queue_t *)v3 outstandingRequests];
    [v7 removeObjectForKey:*(a1 + 32)];

    if (*(a1 + 40))
    {
      v8 = pk_Payment_log();
      v9 = os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT);

      if (v9)
      {
        v10 = pk_Payment_log();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
        {
          v11 = *(a1 + 32);
          *buf = 138412290;
          v19 = v11;
          _os_log_impl(&dword_25B300000, v10, OS_LOG_TYPE_DEFAULT, "Notice: Timed out waiting for response; invoking error handler for message %@", buf, 0xCu);
        }
      }

      v12 = NPKGetIDSCommunicationError();
      v15[0] = MEMORY[0x277D85DD0];
      v15[1] = 3221225472;
      v15[2] = __122__NPKPaymentWebServiceCompanionTargetDevice__trackOutstandingRequestWithMessageIdentifier_completionHandler_errorHandler___block_invoke_1035;
      v15[3] = &unk_279946670;
      v16 = v12;
      v17 = v6;
      v13 = v12;
      dispatch_async(MEMORY[0x277D85CD0], v15);
    }
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)_sendProtobuf:(id)protobuf responseIdentifier:(id)identifier
{
  v13[1] = *MEMORY[0x277D85DE8];
  protobufCopy = protobuf;
  if (identifier)
  {
    v12 = *MEMORY[0x277D18610];
    v13[0] = identifier;
    v7 = MEMORY[0x277CBEAC0];
    identifierCopy = identifier;
    identifier = [v7 dictionaryWithObjects:v13 forKeys:&v12 count:1];
  }

  v9 = [(NPKPaymentWebServiceCompanionTargetDevice *)self _sendProtobuf:protobufCopy responseExpected:0 extraOptions:identifier];

  v10 = *MEMORY[0x277D85DE8];

  return v9;
}

void __98__NPKPaymentWebServiceCompanionTargetDevice__sendProtobuf_responseExpected_extraOptions_priority___block_invoke(uint64_t a1)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = pk_Payment_log();
  v3 = os_log_type_enabled(v2, OS_LOG_TYPE_ERROR);

  if (v3)
  {
    v4 = pk_Payment_log();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_ERROR))
    {
      v5 = *(a1 + 32);
      v7 = 138412290;
      v8 = v5;
      _os_log_impl(&dword_25B300000, v4, OS_LOG_TYPE_ERROR, "Error: IDS failed to send protobuf %@", &v7, 0xCu);
    }
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (id)_serialNumbersOfAllPairedDevices
{
  mEMORY[0x277D2BCF8] = [MEMORY[0x277D2BCF8] sharedInstance];
  array = [MEMORY[0x277CBEB18] array];
  getAllDevices = [mEMORY[0x277D2BCF8] getAllDevices];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __77__NPKPaymentWebServiceCompanionTargetDevice__serialNumbersOfAllPairedDevices__block_invoke;
  v7[3] = &unk_279946A48;
  v5 = array;
  v8 = v5;
  [getAllDevices enumerateObjectsUsingBlock:v7];

  return v5;
}

void __77__NPKPaymentWebServiceCompanionTargetDevice__serialNumbersOfAllPairedDevices__block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 valueForProperty:*MEMORY[0x277D2BBF8]];
  if (v3)
  {
    v4 = v3;
    [*(a1 + 32) addObject:v3];
    v3 = v4;
  }
}

- (BOOL)deviceSupportMultipleExpressPasses
{
  v2 = NPKPairedOrPairingDevice();
  if (v2)
  {
    v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"AB2653AC-2D55-4D7D-9BFB-7D99AA89708B"];
    v4 = [v2 supportsCapability:v3];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (BOOL)deviceSupportTransitReminderSetting
{
  v2 = NPKPairedOrPairingDevice();
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"66A5B423-7CBE-423C-A13B-6389E27D63B9"];
  v4 = [v2 supportsCapability:v3];

  return v4;
}

- (BOOL)_deviceIsConnected
{
  provisioningService = [(NPKPaymentWebServiceCompanionTargetDevice *)self provisioningService];
  v3 = NPKIsConnectedToPairedOrPairingDeviceFromService(provisioningService);

  return v3;
}

- (NPKCompanionAgentConnection)companionAgentConnection
{
  companionAgentConnection = self->_companionAgentConnection;
  if (!companionAgentConnection)
  {
    v4 = objc_alloc_init(NPKCompanionAgentConnection);
    v5 = self->_companionAgentConnection;
    self->_companionAgentConnection = v4;

    companionAgentConnection = self->_companionAgentConnection;
  }

  return companionAgentConnection;
}

- (id)_expressPassesInformationFromDataArray:(id)array
{
  if (array)
  {
    v3 = MEMORY[0x277CBEB58];
    arrayCopy = array;
    v5 = [v3 set];
    v8[0] = MEMORY[0x277D85DD0];
    v8[1] = 3221225472;
    v8[2] = __84__NPKPaymentWebServiceCompanionTargetDevice__expressPassesInformationFromDataArray___block_invoke;
    v8[3] = &unk_279949C70;
    v6 = v5;
    v9 = v6;
    [arrayCopy enumerateObjectsUsingBlock:v8];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

void __84__NPKPaymentWebServiceCompanionTargetDevice__expressPassesInformationFromDataArray___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = objc_opt_class();
  v6 = NPKSecureUnarchiveObject(v3, v4);

  v5 = v6;
  if (v6)
  {
    [*(a1 + 32) addObject:v6];
    v5 = v6;
  }
}

- (id)_expressPassesConfigurationFromDataArray:(id)array
{
  if (array)
  {
    v3 = MEMORY[0x277CBEB58];
    arrayCopy = array;
    v5 = [v3 set];
    v8[0] = MEMORY[0x277D85DD0];
    v8[1] = 3221225472;
    v8[2] = __86__NPKPaymentWebServiceCompanionTargetDevice__expressPassesConfigurationFromDataArray___block_invoke;
    v8[3] = &unk_279949C70;
    v6 = v5;
    v9 = v6;
    [arrayCopy enumerateObjectsUsingBlock:v8];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

void __86__NPKPaymentWebServiceCompanionTargetDevice__expressPassesConfigurationFromDataArray___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = objc_opt_class();
  v5 = NPKSecureUnarchiveObject(v3, v4);

  if (v3)
  {
    [*(a1 + 32) addObject:v5];
  }
}

- (id)_expressModesFromExpressPassConfigurations:(id)configurations
{
  v3 = MEMORY[0x277CBEB58];
  configurationsCopy = configurations;
  v5 = [v3 set];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __88__NPKPaymentWebServiceCompanionTargetDevice__expressModesFromExpressPassConfigurations___block_invoke;
  v8[3] = &unk_27994A008;
  v6 = v5;
  v9 = v6;
  [configurationsCopy enumerateObjectsUsingBlock:v8];

  return v6;
}

void __88__NPKPaymentWebServiceCompanionTargetDevice__expressModesFromExpressPassConfigurations___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 passInformation];
  v5 = [v4 expressMode];

  if (v5)
  {
    [*(a1 + 32) addObject:v5];
  }

  else
  {
    v6 = [v3 passInformation];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __88__NPKPaymentWebServiceCompanionTargetDevice__expressModesFromExpressPassConfigurations___block_invoke_2;
    v7[3] = &unk_27994A8E0;
    v8 = *(a1 + 32);
    [v6 enumerateCriteriaWithHandler:v7];
  }
}

void __88__NPKPaymentWebServiceCompanionTargetDevice__expressModesFromExpressPassConfigurations___block_invoke_2(uint64_t a1, uint64_t a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v12;
    do
    {
      v8 = 0;
      do
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = [*(*(&v11 + 1) + 8 * v8) type];
        if (v9)
        {
          [*(a1 + 32) addObject:v9];
        }

        ++v8;
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v6);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (NPKCompanionPasscodeChangeCoordinatorProtocol)passcodeChangeCoordinator
{
  passcodeChangeCoordinator = self->_passcodeChangeCoordinator;
  if (!passcodeChangeCoordinator)
  {
    v4 = [MEMORY[0x277CCA8D8] bundleWithPath:@"/System/Library/NanoPreferenceBundles/Applications/NanoPassbookBridgeSettings.bundle"];
    v5 = objc_alloc_init([v4 classNamed:@"NPKCompanionPasscodeChangeCoordinator"]);
    v6 = self->_passcodeChangeCoordinator;
    self->_passcodeChangeCoordinator = v5;

    passcodeUpgradeFlowController = [(NPKPaymentWebServiceCompanionTargetDevice *)self passcodeUpgradeFlowController];
    [(NPKCompanionPasscodeChangeCoordinatorProtocol *)self->_passcodeChangeCoordinator setFlowController:passcodeUpgradeFlowController];

    [(NPKCompanionPasscodeChangeCoordinatorProtocol *)self->_passcodeChangeCoordinator setDelegate:self];
    passcodeChangeCoordinator = self->_passcodeChangeCoordinator;
  }

  return passcodeChangeCoordinator;
}

- (void)setPasscodeUpgradeFlowController:(id)controller
{
  controllerCopy = controller;
  objc_storeWeak(&self->_passcodeUpgradeFlowController, controllerCopy);
  passcodeChangeCoordinator = [(NPKPaymentWebServiceCompanionTargetDevice *)self passcodeChangeCoordinator];
  [passcodeChangeCoordinator setFlowController:controllerCopy];
}

- (NPKSubcredentialInvitationCoordinator)subcredentialInvitationCoordinator
{
  subcredentialInvitationCoordinator = self->_subcredentialInvitationCoordinator;
  if (!subcredentialInvitationCoordinator)
  {
    v4 = objc_alloc_init(NPKSubcredentialInvitationCoordinator);
    v5 = self->_subcredentialInvitationCoordinator;
    self->_subcredentialInvitationCoordinator = v4;

    subcredentialInvitationCoordinator = self->_subcredentialInvitationCoordinator;
  }

  return subcredentialInvitationCoordinator;
}

- (PUConnection)passcodeConnection
{
  passcodeConnection = self->_passcodeConnection;
  if (!passcodeConnection)
  {
    v10 = 0;
    v11 = &v10;
    v12 = 0x2050000000;
    v4 = getPUConnectionClass_softClass_0;
    v13 = getPUConnectionClass_softClass_0;
    if (!getPUConnectionClass_softClass_0)
    {
      v9[0] = MEMORY[0x277D85DD0];
      v9[1] = 3221225472;
      v9[2] = __getPUConnectionClass_block_invoke_0;
      v9[3] = &unk_2799457C8;
      v9[4] = &v10;
      __getPUConnectionClass_block_invoke_0(v9);
      v4 = v11[3];
    }

    v5 = v4;
    _Block_object_dispose(&v10, 8);
    v6 = objc_alloc_init(v4);
    v7 = self->_passcodeConnection;
    self->_passcodeConnection = v6;

    passcodeConnection = self->_passcodeConnection;
  }

  return passcodeConnection;
}

- (void)_updateDataAccessorForPass:(id)pass
{
  v27 = *MEMORY[0x277D85DE8];
  passCopy = pass;
  uniqueID = [passCopy uniqueID];
  if ([uniqueID length])
  {
    v5 = MEMORY[0x277CBEBC0];
    v6 = NPKStorePathForPaymentPassWithUniqueID(uniqueID);
    v7 = [v5 fileURLWithPath:v6];

    v22 = 0;
    v8 = [objc_alloc(MEMORY[0x277D37EE8]) initWithFileURL:v7 error:&v22];
    v9 = v22;
    [passCopy setDataAccessor:v8];

    v10 = pk_General_log();
    v11 = v10;
    if (v9)
    {
      v12 = os_log_type_enabled(v10, OS_LOG_TYPE_ERROR);

      if (v12)
      {
        v13 = pk_General_log();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412546;
          v24 = uniqueID;
          v25 = 2112;
          v26 = v9;
          v14 = "Error: Error updating data accessor for pass: %@. Error: %@";
          v15 = v13;
          v16 = OS_LOG_TYPE_ERROR;
          v17 = 22;
LABEL_12:
          _os_log_impl(&dword_25B300000, v15, v16, v14, buf, v17);
          goto LABEL_13;
        }

        goto LABEL_13;
      }
    }

    else
    {
      v20 = os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT);

      if (v20)
      {
        v13 = pk_General_log();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v24 = uniqueID;
          v14 = "Notice: Successfully updated data accessor for pass: %@";
          v15 = v13;
          v16 = OS_LOG_TYPE_DEFAULT;
          v17 = 12;
          goto LABEL_12;
        }

LABEL_13:
      }
    }

LABEL_15:
    goto LABEL_16;
  }

  v18 = pk_General_log();
  v19 = os_log_type_enabled(v18, OS_LOG_TYPE_ERROR);

  if (v19)
  {
    v9 = pk_General_log();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v24 = uniqueID;
      v25 = 2112;
      v26 = passCopy;
      _os_log_impl(&dword_25B300000, v9, OS_LOG_TYPE_ERROR, "Error: Unable to update data accessor; no pass unique ID found: %@ for pass: %@", buf, 0x16u);
    }

    goto LABEL_15;
  }

LABEL_16:

  v21 = *MEMORY[0x277D85DE8];
}

- (id)_secureArchiveSubcredential:(id)subcredential
{
  v11[1] = *MEMORY[0x277D85DE8];
  subcredentialCopy = subcredential;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialArchivingWithRenamedConfigurationSupported])
  {
    v5 = NPKSecureArchiveObject(subcredentialCopy);
  }

  else
  {
    v6 = objc_alloc(MEMORY[0x277CBEAC0]);
    v11[0] = objc_opt_class();
    v7 = [MEMORY[0x277CBEA60] arrayWithObjects:v11 count:1];
    v8 = [v6 initWithObjects:v7 forKeys:&unk_286CE7570];

    v5 = NPKSecureArchiveObjectWithClassNameForClass(subcredentialCopy, v8);
  }

  v9 = *MEMORY[0x277D85DE8];

  return v5;
}

- (id)_secureUnarchiveSubcredential:(id)subcredential
{
  v13[1] = *MEMORY[0x277D85DE8];
  subcredentialCopy = subcredential;
  if ([(NPKPaymentWebServiceCompanionTargetDevice *)self _isSubcredentialArchivingWithRenamedConfigurationSupported])
  {
    v5 = objc_opt_class();
    v6 = NPKSecureUnarchiveObject(subcredentialCopy, v5);
  }

  else
  {
    v7 = objc_alloc(MEMORY[0x277CBEAC0]);
    v13[0] = objc_opt_class();
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
    v9 = [v7 initWithObjects:v8 forKeys:&unk_286CE7588];

    v10 = objc_opt_class();
    v6 = NPKSecureUnarchiveObjectWithClassNameForClass(subcredentialCopy, v10, v9);
  }

  v11 = *MEMORY[0x277D85DE8];

  return v6;
}

- (NPKPaymentWebServiceCompanionTargetDeviceDelegate)delegate
{
  WeakRetained = objc_loadWeakRetained(&self->_delegate);

  return WeakRetained;
}

- (id)passcodeUpgradeFlowController
{
  WeakRetained = objc_loadWeakRetained(&self->_passcodeUpgradeFlowController);

  return WeakRetained;
}

@end