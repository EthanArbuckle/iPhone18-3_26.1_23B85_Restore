@interface HMDHome
+ (BOOL)didHomeAppOnboardHindsightWithAppData:(id)data;
+ (BOOL)isObjectContainedInHome:(id)home;
+ (BOOL)updateCHIPPropertiesOnHomeModel:(id)model forAddedHAPAccessoryServer:(id)server;
+ (HMDHome)homeWithHomeManager:(id)manager backingStore:(id)store model:(id)model error:(id *)error;
+ (id)createNewHomeModelsWithModelID:(id)d parentModelID:(id)iD name:(id)name acwgGroupResolvingKey:(id)key acwgIssuerPublicKeyExternalRepresentation:(id)representation userUniqueIDForAccessories:(id)accessories hasOnboardedActivityHistory:(BOOL)history ownedBy:(id)self0;
+ (id)createUserUniqueIDForAccessoriesWithoutDuplicatingExistingIDs:(id)ds;
+ (id)decodedMigrationBulletinBoardNotifications:(id)notifications;
+ (id)decodedMigrationCameraNotificationSettings:(id)settings;
+ (id)encodedMigrationBulletinBoardNotifications:(id)notifications;
+ (id)encodedMigrationCameraNotificationSettings:(id)settings;
+ (id)filterUsersSupportingPresence:(id)presence;
+ (id)getBuiltinActionSets;
+ (id)loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID:(id)d;
+ (id)logCategory;
+ (id)matterDeviceControllerWithUUID:(id)d;
+ (id)migrationBulletinBoardNotificationsForHome:(id)home;
+ (id)migrationCameraNotificationSettingsForHome:(id)home;
+ (id)nfcIssuerKeyIdentifierWithPairingIdentity:(id)identity;
+ (id)notificationPayloadForChangedCharacteristics:(id)characteristics destination:(id)destination destinationIsXPCTransport:(BOOL)transport;
+ (id)shortDescription;
+ (id)supportedAccessoryClasses;
+ (id)updatedHomeModelCHIPPropertiesForAddedHAPAccessoryServer:(id)server;
+ (id)zoneIDFromHomeUUID:(id)d;
+ (uint64_t)sanitizedOriginalSourceForMessage:(uint64_t)message;
+ (unint64_t)privilegeFromUserInviteInformation:(id)information;
+ (void)_initialize;
+ (void)appendCharacteristicsToAccessoryList:(id)list responseTuples:(id)tuples forMultipleCharacteristicsRemoteRead:(id)read;
+ (void)appendCharacteristicsToAccessoryList:(id)list responseTuples:(id)tuples forMultipleCharacteristicsRemoteWrite:(id)write message:(id)message;
+ (void)dumpAccessories:(id)accessories usingTag:(id)tag flow:(id)flow;
+ (void)removeCharacteristicAuthorizationDataMigrationFileFromDiskWithhHomeUUID:(id)d;
+ (void)updateCHIPPropertiesOnAccessoryModel:(id)model forAddedHAPAccessoryServer:(id)server;
+ (void)updateCHIPPropertiesOnMKFAccessoryModel:(id)model forAddedHAPAccessoryServer:(id)server;
- (BOOL)__shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:(id)message error:(id *)error;
- (BOOL)_accessoryRequiresNativeMatter:(id)matter;
- (BOOL)_addAccessory:(id)accessory;
- (BOOL)_deviceEligibleForDarkPoll;
- (BOOL)_doesInvitedUserHasTheSamePairingIdentityAsOwner:(id)owner;
- (BOOL)_doesUsersHaveCATID;
- (BOOL)_ensureDevicesSymptomDiscoveryMessageCanBeHandled:(id)handled;
- (BOOL)_hasPairedReachableBTLEAccessories;
- (BOOL)_homeHasMatterThreadAccessories;
- (BOOL)_homeHasNativeMatterAccessories;
- (BOOL)_isAccessToHomeAllowed;
- (BOOL)_isEventTriggerOnLocalDeviceForAccessory:(id)accessory;
- (BOOL)_isEventTriggerOnRemoteGatewayForAccessory:(id)accessory;
- (BOOL)_isNetworkRouterSupportEnabledForCurrentDevice;
- (BOOL)_isReadRequestAllowForCharacteristics:(id)characteristics message:(id)message error:(id *)error;
- (BOOL)_isRegisteredForNotificationsForClients:(id)clients;
- (BOOL)_isRegisteredForNotificationsWithRemoteGateway:(id)gateway;
- (BOOL)_isResidentNativeMatterCapable:(id)capable;
- (BOOL)_isResidentThreadCapable:(id)capable;
- (BOOL)_isRetrievalInProgressForPrimaryAccessory:(id)accessory linkType:(int64_t)type;
- (BOOL)_isSecureClassTriggeredByCharacteristics:(id)characteristics;
- (BOOL)_isSharedHomeVersionTrustZoneCapable;
- (BOOL)_isUserValid:(id)valid error:(id *)error;
- (BOOL)_justSentInvitation:(id)invitation;
- (BOOL)_matterAccessoryRequiresThread:(id)thread;
- (BOOL)_populateTriggerModel:(id)model fromBuilderMessage:(id)message transaction:(id)transaction responsePayload:(id)payload;
- (BOOL)_processTestModeHomeAccessControlOverride:(id)override error:(id *)error;
- (BOOL)_processTestModeHomeLocationStatusOverride:(id)override error:(id *)error;
- (BOOL)_processTestModeSkipHH2MigrationOverride:(id)override error:(id *)error;
- (BOOL)_processTestModeUpdateHomeLocation:(id)location error:(id *)error;
- (BOOL)_removeAccessory:(id)accessory;
- (BOOL)_residentDeviceAvailable;
- (BOOL)_shouldAllowAddingAccessoryOfCategory:(id)category requestMessage:(id)message error:(id *)error;
- (BOOL)_shouldAllowAddingAccessoryWithDescription:(id)description requestMessage:(id)message error:(id *)error;
- (BOOL)_shouldAvoidTombstoningAccessoryServer:(id)server accessory:(id)accessory;
- (BOOL)_shouldFallbackLocallyForRemoteMatterRequest:(id)request;
- (BOOL)_shouldRateLimitChangeNotificationsForCharacteristic:(id)characteristic;
- (BOOL)_shouldRegisterForNotificationsWithDevice:(id)device;
- (BOOL)_shouldResendOutgoingInvitation:(id)invitation;
- (BOOL)_shouldSendToDestination:(id)destination device:(id)device remoteSourceDevice:(id)sourceDevice;
- (BOOL)_shouldUseAttributeReportForBulletin:(id)bulletin;
- (BOOL)_shouldUseDeprecatedAddAccessoryMessage:(id)message minimumVersion:(id)version primaryResident:(id)resident shouldRelayMessages:(BOOL)messages;
- (BOOL)_shouldWaitForAccessoriesToBeReachable;
- (BOOL)_validateAddingNewTriggerWithName:(id)name message:(id)message;
- (BOOL)_validateSettingsUpdate:(id)update type:(int64_t *)type keyPath:(id *)path value:(id *)value error:(id *)error;
- (BOOL)_verifyUserManagementPermissionForAccessory:(id)accessory error:(id *)error;
- (BOOL)addBulletinConditions:(id)conditions on:(id)on context:(id)context;
- (BOOL)addPresenceBulletinCondition:(id)condition on:(id)on context:(id)context;
- (BOOL)addSunriseSunSetTimePeriodElement:(id)element toCondition:(id)condition isStartElement:(BOOL)startElement;
- (BOOL)addTimeOfDayTimePeriodElement:(id)element toCondition:(id)condition isStartElement:(BOOL)startElement;
- (BOOL)addTimePeriodBulletinCondition:(id)condition on:(id)on;
- (BOOL)applyDeviceLockStatus:(id)status;
- (BOOL)areAllThreadResidentNodesUnreachable;
- (BOOL)areCharacteristicRequests:(id)requests allowedForUser:(id)user;
- (BOOL)attemptToUpdateThreadNetworkID:(id)d;
- (BOOL)auditStorageWithFabricData:(id)data;
- (BOOL)bulletinBoardNotificationsMigrationFileExistsOnDisk;
- (BOOL)cameraNotificationSettingsMigrationFileExistsOnDisk;
- (BOOL)canTopicBeForwardedToPrimaryFromResident:(id)resident;
- (BOOL)checkForNetworkRouterSupport:(unint64_t)support error:(id *)error;
- (BOOL)configureWithHomeManager:(id)manager accessoriesPresent:(id)present uncommittedTransactions:(id)transactions source:(unint64_t)source;
- (BOOL)containsRemovedUser:(id)user;
- (BOOL)currentDeviceSupportsSidekickSettings;
- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithNoPasscodeForSiriSecureAccessoryAccessController:(id)controller;
- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithWatchAuthForSiriSecureAccessoryAccessController:(id)controller;
- (BOOL)currentRemoteReachabilityRegistration;
- (BOOL)defaultRoomContainsAccessoryWithUUID:(id)d;
- (BOOL)doesHomeContainResident;
- (BOOL)doesThisHomeHaveCameras;
- (BOOL)enableBulletinRegistrations:(id)registrations source:(id)source homeMember:(id)member context:(id)context;
- (BOOL)enabledResidentsSupportsHomeHub;
- (BOOL)evaluatePredicate:(id)predicate;
- (BOOL)getUpdateTransactionForAccessory:(id)accessory hapAccessory:(id)hapAccessory accessoryTransaction:(id)transaction addSvcTransactions:(id *)transactions updateSvcTransactions:(id *)svcTransactions removeSvcTransactions:(id *)removeSvcTransactions;
- (BOOL)hasActiveWACPairing;
- (BOOL)hasAnyAccessoryWithAliroNFCSupport;
- (BOOL)hasAnyAccessoryWithAliroUWBSupport;
- (BOOL)hasAnyAccessoryWithUnifiedAccessWalletKeySupport;
- (BOOL)hasAnyAccessoryWithWalletKeyAndAccessCodeSupport;
- (BOOL)hasAnyAccessoryWithWalletKeySupport;
- (BOOL)hasAnyReachableAccessories;
- (BOOL)hasAnyResident;
- (BOOL)hasCharacteristicNotificationRegistrations;
- (BOOL)hasDemoAccessories;
- (BOOL)hasDemoPrimaryResident;
- (BOOL)hasNeverAddedAnyHAPAccessory;
- (BOOL)hasPostedWalletKeyOnboardingBulletinForAnyAccessory;
- (BOOL)hasResidentDevicesForPrimaryResidentChangeMonitor:(id)monitor;
- (BOOL)hasSharedUser;
- (BOOL)hasSiriEndpointAccessory;
- (BOOL)hasThreadCapableResident;
- (BOOL)insertOrUpdateAudioAnalysisEventBulletinRegistrations:(id)registrations source:(id)source managedBulletinRegistration:(id)registration accessory:(id)accessory user:(id)user context:(id)context;
- (BOOL)insertOrUpdateCameraAccessModeBulletinRegistration:(id)registration source:(id)source managedBulletinRegistration:(id)bulletinRegistration accessory:(id)accessory user:(id)user context:(id)context;
- (BOOL)insertOrUpdateCameraReachabilityBulletinRegistration:(id)registration source:(id)source managedBulletinRegistration:(id)bulletinRegistration accessory:(id)accessory user:(id)user context:(id)context;
- (BOOL)insertOrUpdateCameraSignificantEventBulletinRegistration:(id)registration source:(id)source managedBulletinRegistration:(id)bulletinRegistration accessory:(id)accessory user:(id)user context:(id)context;
- (BOOL)insertOrUpdateCharacteristicBulletinRegistration:(id)registration source:(id)source managedBulletinRegistration:(id)bulletinRegistration accessory:(id)accessory homeMember:(id)member context:(id)context;
- (BOOL)insertOrUpdateMatterBulletinRegistration:(id)registration source:(id)source managedBulletinRegistration:(id)bulletinRegistration accessory:(id)accessory homeMember:(id)member context:(id)context;
- (BOOL)isAccessAllowedForCharacteristicsWithMessage:(id)message;
- (BOOL)isActiveNetworkRouterInitialSetupNeeded;
- (BOOL)isAdminUser;
- (BOOL)isAllowedToEnableAdaptiveTemperatureAutomations;
- (BOOL)isAnyBTLEAccessoryReachable;
- (BOOL)isAppleMediaAccessory:(id)accessory;
- (BOOL)isAutomaticSoftwareUpdateEnabled;
- (BOOL)isAutomaticThirdPartyAccessorySoftwareUpdateEnabled;
- (BOOL)isCarPlayAccessAllowedForActionSet:(id)set withMessage:(id)message fromSource:(unint64_t)source;
- (BOOL)isCarPlayAccessAllowedForCharacteristic:(id)characteristic withMessage:(id)message fromSource:(unint64_t)source;
- (BOOL)isClientIdentifierSubscribedToAppleMediaAccessoryState:(id)state;
- (BOOL)isCompanionReachable;
- (BOOL)isCurrentDeviceAvailableResident;
- (BOOL)isCurrentDeviceConfirmedPrimaryResident;
- (BOOL)isCurrentDevicePairedWithWatchForSiriSecureAccessoryAccessController:(id)controller;
- (BOOL)isCurrentDevicePrimaryResident;
- (BOOL)isCurrentDevicePrimaryResidentForRemoteEventRouterClientController:(id)controller;
- (BOOL)isCurrentDeviceResidentCapableForRemoteEventRouterClientController:(id)controller;
- (BOOL)isCurrentDeviceThreadBorderRouterCapable;
- (BOOL)isCurrentDeviceThreadPreferredPrimaryResident;
- (BOOL)isCurrentUserRestrictedForRemoteEventRouterClientController:(id)controller;
- (BOOL)isDeviceIdentifierPrimaryResident:(id)resident;
- (BOOL)isDevicePrimaryResident:(id)resident;
- (BOOL)isEventLogEnabled;
- (BOOL)isLocalPresenceSupported;
- (BOOL)isMediaPeerToPeerEnabled;
- (BOOL)isMediaSystem:(id)system;
- (BOOL)isOwnerUser;
- (BOOL)isPrimaryResidentNodeReachable;
- (BOOL)isRemoteAccessDeviceReachable;
- (BOOL)isResidentReachable:(id)reachable;
- (BOOL)isResidentSupported;
- (BOOL)isSharedAdmin;
- (BOOL)isSidekickAccessory:(id)accessory;
- (BOOL)isSiriPhraseOptionsHeySiriEnabled;
- (BOOL)isSiriPhraseOptionsJustSiriEnabled;
- (BOOL)isSmokeAlarmEnabled;
- (BOOL)isThisHomeMigratedToHH2;
- (BOOL)isThreadCapable;
- (BOOL)isThreadNetworkUp;
- (BOOL)ownerTrustZoneCapable;
- (BOOL)receivedRemoteMessageOverTransportType:(int)type remoteMessageSenderContext:(id)context;
- (BOOL)remoteAccessIsEnabled;
- (BOOL)remoteEventAllowedForTopic:(id)topic deviceType:(unint64_t)type userType:(unint64_t)userType;
- (BOOL)requiresRemoteFabricDataUpdateThroughPairingCompletionMessage;
- (BOOL)requiresUnlockToAccessCharacteristics:(id)characteristics withMessage:(id)message;
- (BOOL)residentSyncDidSync;
- (BOOL)router:(id)router shouldHandleMessage:(id)message usingRouter:(id)usingRouter;
- (BOOL)sendMatterHMFMessageRequest:(id)request;
- (BOOL)sendMatterMessagePayloadToPrimaryResident:(id)resident timeout:(double)timeout responseHandler:(id)handler;
- (BOOL)setUpAccessoryServerBrowserWithOperationalFabricData:(id)data ownerDataSnapshot:(id)snapshot error:(id *)error;
- (BOOL)setUpOperationalFabricDataWithError:(id *)error;
- (BOOL)shouldAccessoryRemovalFallbackToLocalRemovalOnError:(id)error accessory:(id)accessory;
- (BOOL)shouldAllowTopic:(id)topic forDeviceWithMessageIdentifier:(id)identifier;
- (BOOL)shouldEncodeLegacyLocationServiceSettingForSettingsParentUUID:(id)d;
- (BOOL)shouldPostBulletin;
- (BOOL)shouldRelayNotificationToRegisteredDevicesForSource:(id)source;
- (BOOL)shouldRestrictAllMessagingToLocalTransportsForUser:(id)user;
- (BOOL)shouldSendMatterCommandsToResident;
- (BOOL)shouldWeSendAutomationsToClients;
- (BOOL)storeIntoLegacyStorageWithFabricData:(id)data;
- (BOOL)storeNewFabricData:(id)data;
- (BOOL)storeSharedHomeFabricData:(id)data;
- (BOOL)supportsDeviceWithCapabilities:(id)capabilities;
- (BOOL)supportsResidentSelection;
- (BOOL)supportsRouterManagement;
- (BOOL)supportsSiriEndpointOnBoarding;
- (BOOL)synchronouslyFetchIsCarPlayConnectedStatus;
- (BOOL)synchronouslyFetchIsConnectedToCarPlayNetwork;
- (BOOL)updateCHIPPropertiesOnHomeModel:(id)model usingUpdatedHomeInfo:(id)info;
- (BOOL)updateFabricUsingHomeModel:(id)model;
- (BOOL)updateMatterFabricIDIfNeeded;
- (BOOL)validateActionsDoNotConflict:(id)conflict;
- (BOOL)watchSkipVersionCheck;
- (HMDAccessory)currentAccessory;
- (HMDAccessoryCount)accessoryCount;
- (HMDActionSet)_createActionSetWithUUID:(void *)d name:(void *)name type:(void *)type fromDictionary:(void *)dictionary transaction:(void *)transaction response:(void *)response error:;
- (HMDActionSetStateObserver)actionSetStateObserver;
- (HMDActionSetStateSubscriptionManager)actionSetStateSubscriptionManager;
- (HMDBackingStore)backingStore;
- (HMDDevice)companionDevice;
- (HMDDevice)currentDevice;
- (HMDFeaturesDataSource)featuresDataSource;
- (HMDHAPAccessory)activeNetworkRouterAccessory;
- (HMDHome)initWithCoder:(id)coder;
- (HMDHome)initWithName:(id)name uuid:(id)uuid defaultRoomUUID:(id)d owner:(id)owner homeManager:(id)manager presenceAuth:(id)auth dataSource:(id)source;
- (HMDHome)initWithName:(id)name uuid:(id)uuid defaultRoomUUID:(id)d owner:(id)owner homeManager:(id)manager presenceAuth:(id)auth dataSource:(id)source logEventSubmitter:(id)self0 carPlayDataSource:(id)self1 administratorHandlerFactory:(id)self2 localCapabilitiesDataSource:(id)self3 notificationCenter:(id)self4 keychainStore:(id)self5;
- (HMDHomeKitVersion)minHomeKitVersionForAccessoryNetworkProtectionChange;
- (HMDHomeKitVersion)minimumNetworkRouterSupportHomeKitVersion;
- (HMDHomeManager)homeManager;
- (HMDHomeNFCReaderKey)nfcReaderKey;
- (HMDHomePersonManager)personManager;
- (HMDHomePresenceCheck)homePresence;
- (HMDNaturalLightingContext)naturalLightingContext;
- (HMDNetworkRouterClientManager)routerClientManager;
- (HMDResidentDevice)userSelectedPreferredResident;
- (HMDSiriSecureAccessoryAccessController)siriSecureAccessoryAccessController;
- (HMDUser)currentUser;
- (HMDUserActivityStateDetectorManager)userActivityStateDetectorManager;
- (HMDUserPresenceFeeder)presenceFeeder;
- (HMEEventForwarder)eventForwarder;
- (HMFMessageDestination)messageDestination;
- (HMFWiFiManager)wifiManager;
- (HMHomeNetworkInfo)primaryResidentNetworkInfo;
- (HMHomePersonManagerSettings)personManagerSettings;
- (HMMDailyScheduler)dailyScheduler;
- (MTRDeviceController)matterDeviceController;
- (NSArray)accessories;
- (NSArray)accessoriesRequiringManualReconfigurationOnRouterRemoval;
- (NSArray)accessoriesWithAliroProvisioning;
- (NSArray)accessoriesWithWalletKeySupport;
- (NSArray)actionSets;
- (NSArray)appleMediaAccessories;
- (NSArray)autoSelectedPreferredResidents;
- (NSArray)cameraAccessories;
- (NSArray)enabledResidents;
- (NSArray)hapAccessories;
- (NSArray)hapAccessoriesForLegacyDataBlobEncoding;
- (NSArray)lpRooms;
- (NSArray)matterAccessories;
- (NSArray)mediaSessionStates;
- (NSArray)mediaSessions;
- (NSArray)mediaSystems;
- (NSArray)nativeMatterAccessories;
- (NSArray)outgoingInvitations;
- (NSArray)removedUsers;
- (NSArray)residentCapableDevices;
- (NSArray)residentEnabledDevices;
- (NSArray)rooms;
- (NSArray)serviceGroups;
- (NSArray)triggerOwnedActionSets;
- (NSArray)triggers;
- (NSArray)usersPendingUserManagementOperations;
- (NSArray)usersSupportingPresence;
- (NSArray)wiFiRouterAccessories;
- (NSArray)zones;
- (NSData)threadOperationalDataset;
- (NSDictionary)assistantObject;
- (NSHashTable)removeAccessoryInProgressForHMDAccessories;
- (NSMapTable)addPendingAccessories;
- (NSMutableDictionary)addPendingAccessorySetupCodeHandlers;
- (NSNumber)availableBSPsCount;
- (NSNumber)availableBorderRouters;
- (NSNumber)matterFabricID;
- (NSNumber)overriddenHomeAccessControl;
- (NSNumber)residentSelectionVersion;
- (NSSet)notificationDeregistrations;
- (NSSet)notificationRegistrations;
- (NSString)contextID;
- (NSString)name;
- (NSString)threadNetworkID;
- (NSString)unfilteredThreadNetworkID;
- (NSString)urlString;
- (NSUUID)activeNetworkRouterUUID;
- (NSUUID)contextSPIUniqueIdentifier;
- (NSUUID)primaryNetworkRouterManagingDeviceUUID;
- (id)__modelObjectsForRemovingOutgoingInvitationForUser:(id)user;
- (id)__readWriteResponseHandler:(id)handler unhandledRequests:(id)requests;
- (id)_addAccessoriesUsingPrimaryAccessoryModel:(void *)model updatedHomeInfo:(void *)info message:;
- (id)_addMediaSessionForCurrentAccessory:(id)accessory;
- (id)_addOwnerToNewlyPairedAccessoryServer:(id)server;
- (id)_appDataContainerForMessage:(id)message;
- (id)_changedHMDCharacteristicsForHAPCharacteristics:(id)characteristics stateNumber:(id)number broadcast:(BOOL)broadcast accessoryServer:(id)server;
- (id)_characteristicNotificationPayloadsOnDirectTransports:(BOOL)transports;
- (id)_characteristicUpdatesByDestinationForNotificationRegistryDestinations:(id)destinations bulletinDestinations:(id)bulletinDestinations broadcast:(BOOL)broadcast;
- (id)_characteristicUpdatesForChangedCharacteristics:(id)characteristics bulletinCharacteristics:(id)bulletinCharacteristics broadcast:(BOOL)broadcast;
- (id)_checkResidentCapabilitiesForCredentialSharing:(id)sharing;
- (id)_configureMatterV1Accessory:(id)accessory accessoryModel:(id)model;
- (id)_configureTTUAndUWBOnAccessory:(id)accessory accessoryModel:(id)model;
- (id)_configureWithFeatureSpecificDataAccessory:(id)accessory accessoryModel:(id)model;
- (id)_createBuiltinActionSets;
- (id)_createEventsPayload:(uint64_t)payload;
- (id)_createMediaSessionWithEndpoint:(id)endpoint;
- (id)_createMessageForReadWriteRequest:(id)request source:(unint64_t)source withCompletionHandler:(id)handler;
- (id)_disablePayloadFromRemotelyUpdatedCharacteristicNotifications:(id)notifications;
- (id)_enqueueRetrievalTupleForAccessory:(id)accessory linkType:(int64_t)type inProgress:(BOOL *)progress completion:(id)completion;
- (id)_getReachabilityTupleForAccessoryUUID:(id)d;
- (id)_handleRenameHomeModel:(id)model message:(id)message;
- (id)_hasConfirmedPrimaryResidentDevice;
- (id)_hmdCharacteristicsForUpdatedHAPCharacteristics:(id)characteristics accessoryServer:(id)server;
- (id)_initWithCoder:(id)coder;
- (id)_outgoingInvitationForUserWithHandle:(id)handle;
- (id)_primaryAccessoryForServer:(id)server;
- (id)_productDataFromHAPAccessory:(id)accessory;
- (id)_pushTokenToDestinationMappingForDestinations:(id)destinations;
- (id)_readDataNeededImmediatelyAfterPairing:(id)pairing intoModel:(id)model;
- (id)_readRequestTuplesFromMessage:(id)message outUnhandledRequests:(id *)requests;
- (id)_removeAccessoriesCommon:(id)common;
- (id)_removeUserFromNewlyPairedAccessoryServer:(id)server user:(id)user;
- (id)_residentDeviceForResidentUser:(id)user;
- (id)_residentUserForResidentDevice:(id)device;
- (id)_residentUsers;
- (id)_retrieveTupleForPrimaryAccessory:(id)accessory linkType:(int64_t)type;
- (id)_setupCodeProviderForMessage:(id)message;
- (id)_setupDescriptionFromData:(id)data error:(id *)error;
- (id)_splitCharacteristicChanges:(id)changes changedAccessories:(id)accessories;
- (id)_unexpectedCharacteristicsFromCharacteristicNotifications:(id)notifications;
- (id)_updateAndGetOwnedTriggers;
- (id)_userForDevice:(id)device;
- (id)accessCodeForMatterUserWithUserUniqueID:(id)d;
- (id)accessoriesWithUUIDs:(id)ds;
- (id)accessoryAdministerPrivilegeCATID:(BOOL)d;
- (id)accessoryOperatePrivilegeCATID:(BOOL)d;
- (id)accessorySettingsMessengerMessageTargetUUID;
- (id)accessoryWithDeviceIdentifier:(id)identifier;
- (id)accessoryWithEndpointIdentifier:(id)identifier;
- (id)accessoryWithIdentifier:(id)identifier;
- (id)accessoryWithSPIClientIdentifier:(id)identifier;
- (id)accessoryWithUUID:(id)d;
- (id)actionSetWithName:(id)name;
- (id)actionSetWithUUID:(id)d;
- (id)actionWithDictionaryRepresentation:(id)representation;
- (id)addActionSetName:(id)name;
- (id)addName:(id)name;
- (id)addUserAccessCodeForUser:(id)user fromOutgoingInvitation:(id)invitation;
- (id)allNewlyConfiguredAccessories;
- (id)appleMediaAccessoryUUIDsForMediaStateSubscriber:(id)subscriber;
- (id)audioDestinationControllerDataForDestination:(id)destination;
- (id)auditOrAddRestrictedGuest:(id)guest onAccessory:(id)accessory flow:(id)flow;
- (id)auditOrAddRestrictedGuestUserUniqueIdentifier:(id)identifier onAccessory:(id)accessory user:(id)user requireFullScheduleAudit:(BOOL)audit flow:(id)flow;
- (id)backingStoreObjects:(int64_t)objects hh2Migration:(BOOL)migration;
- (id)builtInActionSetInfo;
- (id)createAccessorySettingsLocalMessageHandlerWithHomeUUID:(id)d languageValuesDataProvider:(id)provider;
- (id)createAccessorySettingsMessengerWithMessageTargetUUID:(id)d messageDispatcher:(id)dispatcher messageRouter:(id)router messageHandler:(id)handler logEventSubmitter:(id)submitter;
- (id)createActionSetWithName:(id)name uuid:(id)uuid type:(id)type;
- (id)createAppleMediaAccessoriesStateMessengerWithIdentifier:(id)identifier messageDispatcher:(id)dispatcher;
- (id)createMultiuserSettingsMessenger:(id)messenger messageDispatcher:(id)dispatcher;
- (id)createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:(id)snapshot operationalKeyPair:(id)pair error:(id *)error;
- (id)createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:(id)submitter;
- (id)createPrimaryResidentMessageRouterWithHomeUUID:(id)d messageDispatcher:(id)dispatcher metricsDispatcher:(id)metricsDispatcher;
- (id)createSiriEndpointProfileMessageHandlerWithHomeUUID:(id)d;
- (id)createSiriEndpointProfilesMessengerWithMessageTargetUUID:(id)d messageDispatcher:(id)dispatcher messageRouter:(id)router messageHandler:(id)handler;
- (id)createUnifiedLanguageValueListSettingDataProvider;
- (id)createUserUniqueIDForAccessories;
- (id)currentAccessoryHomeUUID;
- (id)currentAccessorySetupMetricDispatcher;
- (id)currentAccessoryUUIDsForMediaStateSubscriber:(id)subscriber;
- (id)currentDeviceControllerNodeID;
- (id)dataProvidersForUnifiedLanguageValueListSettingDataProvider:(id)provider;
- (id)deletedBackingStoreObject;
- (id)descriptionWithPointer:(BOOL)pointer;
- (id)destinationControllerDataForAppleMediaAccessory:(id)accessory;
- (id)destinationControllerWithCommittedDestinationIdentifier:(id)identifier;
- (id)destinationControllerWithDestinationIdentifier:(id)identifier;
- (id)destinationControllerWithIdentifier:(id)identifier;
- (id)destinationControllers;
- (id)destinationForAppleMediaAccessory:(id)accessory;
- (id)destinationForEnabledResidents;
- (id)destinationForMediaSystem:(id)system;
- (id)destinationManagerPassingTest:(id)test;
- (id)destinationManagerWithDestinationIdentifier:(id)identifier;
- (id)destinationManagerWithParentIdentifier:(id)identifier;
- (id)destinationManagersWithDestinationIdentifiers:(id)identifiers supportedOptions:(unint64_t)options;
- (id)deviceForAccessoryUUID:(id)d forRemoteEventRouterClientController:(id)controller;
- (id)deviceForAppleMediaAccessoryMessageRouter:(id)router message:(id)message;
- (id)deviceForPrimaryResidentForRemoteEventRouterClientController:(id)controller;
- (id)dumpActionSetDescriptionWithPrivacyLevel:(unint64_t)level;
- (id)dumpBulletinNotificationRegistrationsState;
- (id)dumpCharacteristicNotificationRegistry;
- (id)dumpMediaSessionDescriptionWithPrivacyLevel:(unint64_t)level;
- (id)dumpStateWithPrivacyLevel:(unint64_t)level;
- (id)emptyModelObjectWithChangeType:(unint64_t)type;
- (id)eventRouterDumpStateInfo;
- (id)eventRouterServerDiagnosticInfo;
- (id)eventSourceForMediaGroupsAggregator:(id)aggregator;
- (id)eventStoreReadHandle;
- (id)eventStoreReadHandleForRemoteEventRouterClientController:(id)controller;
- (id)eventStoreWriteHandleForRemoteEventRouterClientController:(id)controller;
- (id)executeMatterNaturalLightingActions:(id)actions;
- (id)expandedTopicsWithTopics:(id)topics;
- (id)fabricDataInLegacyStorage;
- (id)fetchOperationalFabricDataWithError:(id *)error;
- (id)filterBuiltinActionSets:(id)sets;
- (id)findAdditionalUUIDsForUser:(id)user;
- (id)findBulletinRegistration:(id)registration source:(id)source homeMember:(id)member context:(id)context;
- (id)findOrAddUser:(id)user onAccessory:(id)accessory didRedispatch:(BOOL)redispatch flow:(id)flow;
- (id)findOrAddUserIndexForUserUUID:(id)d guestName:(id)name accessory:(id)accessory flow:(id)flow;
- (id)findOrAddUserUniqueIDForGuestAccessCode:(id)code onAccessory:(id)accessory;
- (id)findUserIndexForUserUUID:(id)d guestName:(id)name accessory:(id)accessory;
- (id)findUserSlotForUserUniqueIdentifier:(id)identifier onAccessory:(id)accessory;
- (id)getBulletinBoardNotificationSerializedFileName;
- (id)getCameraNotificationSettingsSerializedFileName;
- (id)getOrCreateUniqueIDForAccessoriesForUser:(id)user flow:(id)flow;
- (id)getServiceTransaction:(id)transaction parentUUID:(id)d changeType:(unint64_t)type;
- (id)getTransactionFromHAPAccessory:(id)accessory hmdAccessory:(id)hmdAccessory uuid:(id)uuid hostAccessoryUUID:(id)d objectChangeType:(unint64_t)type;
- (id)handleFindOrAddUserUniqueIdentifier:(id)identifier onAccessory:(id)accessory flow:(id)flow;
- (id)handleRemoveUserUniqueIdentifier:(id)identifier fromAccessory:(id)accessory;
- (id)hapAccessoriesForServer:(id)server;
- (id)hapAccessoriesForServer:(id)server linkType:(int64_t)type;
- (id)hapAccessoryServerIdentifiers;
- (id)hapAccessoryUniqueIdentifiers;
- (id)hapAccessoryWithIdentifier:(id)identifier;
- (id)hapAccessoryWithIdentifier:(id)identifier instanceID:(id)d;
- (id)hmdHAPAccessoryWithHAPAccessory:(id)accessory;
- (id)homeBulletinContext;
- (id)homeConfigurationModelObjectWithChangeType:(unint64_t)type;
- (id)homeConfigurationUUID;
- (id)homeLocationWithPrivacyLevel:(unint64_t)level;
- (id)hubAccessories;
- (id)iCloudIdentifier;
- (id)invitationWithIDSInvitationIdentifier:(id)identifier;
- (id)invitationWithInvitationIdentifier:(id)identifier;
- (id)isAccessoryCertifiedForNaturalLighting:(id)lighting;
- (id)languageValueList;
- (id)lightProfileWithUUID:(id)d;
- (id)loadMigrationBulletinBoardNotificationsFromDisk;
- (id)loadMigrationCameraNotificationSettingsFromDisk;
- (id)localAndRemoteSubscriptionProvider;
- (id)matterAccessoriesWithNewFirmwareInstalledInHome;
- (id)matterAccessoryWithIdentifier:(id)identifier;
- (id)matterAccessoryWithNodeID:(id)d;
- (id)matterPathWithUUID:(id)d;
- (id)mediaDestinationManagersWithHomeTheaterSupportedOptions;
- (id)mediaDestinationManagersWithSupportedOptions:(unint64_t)options;
- (id)mediaDestinationsInRoom:(id)room;
- (id)mediaGroupsAggregateDataTopicName;
- (id)mediaPassword;
- (id)mediaProfileForAppleMediaAccessoryUUID:(id)d mediaStateSubscriber:(id)subscriber;
- (id)mediaProfileWithUUID:(id)d;
- (id)mediaSessionStateWithIdentifier:(id)identifier;
- (id)mediaSessionWithIdentifier:(id)identifier;
- (id)mediaSessionWithUUID:(id)d;
- (id)mediaSystemController:(id)controller accessoryForUUID:(id)d;
- (id)mediaSystemForAppleMediaAccessory:(id)accessory;
- (id)mediaSystemWithUUID:(id)d;
- (id)mediaSystemsWithUUIDs:(id)ds;
- (id)messageTargetForDeviceIdentifier:(id)identifier;
- (id)modelObjectWithChangeType:(unint64_t)type version:(int64_t)version;
- (id)multiUserSettings;
- (id)namesOfServicesWithNewFirmwareAvailableInHome;
- (id)newFabricData;
- (id)notificationRegistrationsForAppleMediaAccessories;
- (id)operationalKeyPairForPairing;
- (id)outgoingInvitationToResendForUser:(id)user;
- (id)outgoingInvitationWithUUID:(id)d;
- (id)owner;
- (id)participantDataTopicForAccessory:(id)accessory mediaGroupsAggregator:(id)aggregator;
- (id)payloadFromEnableRegistrations:(id)registrations disableRegistration:(id)registration source:(id)source;
- (id)payloadFromRegistrations:(id)registrations;
- (id)pendingUsers;
- (id)performReadRequests:(id)requests loggingObject:(id)object flow:(id)flow;
- (id)performReadRequests:(id)requests withRetries:(int64_t)retries timeInterval:(double)interval loggingObject:(id)object flow:(id)flow;
- (id)performWriteRequests:(id)requests loggingObject:(id)object flow:(id)flow;
- (id)performWriteRequests:(id)requests withRetries:(int64_t)retries timeInterval:(double)interval loggingObject:(id)object flow:(id)flow;
- (id)playbackArchiveWithSessionIdentifier:(id)identifier;
- (id)preflightCheckLogEventWithSessionIdentifier:(id)identifier accessoryCategory:(id)category fetchDuration:(double)duration firstImportCompleted:(BOOL)completed hasMediaRouteIdentifier:(BOOL)routeIdentifier hasPairingIdentity:(BOOL)identity hasConnectedEventRouterClient:(BOOL)client isCloudSignedIn:(BOOL)self0 hasManatee:(BOOL)self1 isIdsReady:(BOOL)self2 isOwnerUser:(BOOL)self3 homeUUID:(id)self4;
- (id)primaryResident;
- (id)primaryResidentDeviceIdentifierForRemoteEventRouterClientController:(id)controller;
- (id)privateDataSourceForNode:(id)node;
- (id)receiverForParticipantAccessoryUUID:(id)d mediaGroupsLocalDataStorage:(id)storage;
- (id)registrationSourceFromPayload:(id)payload;
- (id)registrationsFromPayload:(id)payload enabled:(BOOL)enabled;
- (id)removeGuestAccessCode:(id)code fromAccessory:(id)accessory;
- (id)removeName:(id)name;
- (id)removeUser:(id)user fromAccessory:(id)accessory;
- (id)removeUserFromMatterAccessories:(id)accessories;
- (id)removeUsersFromAccessory:(id)accessory;
- (id)replaceActionSetName:(id)name withNewName:(id)newName;
- (id)replaceName:(id)name withNewName:(id)newName;
- (id)resolveReceiverForMessageTargetUUID:(id)d;
- (id)restrictedGuests;
- (id)retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:(id)identifier;
- (id)retrieveNewlyAddedAccessoriesForPairedAccessoryServerInfo:(id)info;
- (id)roomForAccessoryUUID:(id)d;
- (id)roomForAllDestinationParentIdentifiers:(id)identifiers;
- (id)roomUUIDsSupportingLocalPresence;
- (id)roomWithName:(id)name;
- (id)roomWithUUID:(id)d;
- (id)roomWithUniqueIdentifier:(id)identifier forClientIdentifierSalt:(id)salt;
- (id)rootDestinationManagerWithDescendantDestinationIdentifier:(id)identifier;
- (id)routerForParticipantAccessoryUUID:(id)d mediaGroupsLocalDataStorage:(id)storage;
- (id)routerServerUserAccessControlProviderForIdentifier:(id)identifier;
- (id)routerServerUserAccessControlProviderIdentifierForMessage:(id)message;
- (id)sameRoomAccessoryUUIDsForDestinationControllerData:(id)data mediaGroupsAggregator:(id)aggregator;
- (id)saveUserUniqueID:(id)d ForGuestAccessCode:(id)code;
- (id)serviceGroupWithName:(id)name;
- (id)serviceGroupWithUUID:(id)d;
- (id)sharedHomeModel;
- (id)sharedUsers;
- (id)shortDescription;
- (id)storedFabricDataWithDataPresentInV2FabricDataStore:(BOOL *)store error:(id *)error;
- (id)storedOperationalKeyPair;
- (id)storedSharedHomeFabricData;
- (id)targetAccessoriesWithDestinationIdentifiers:(id)identifiers;
- (id)triggerOwnedActionSetWithUUID:(id)d;
- (id)triggerWithName:(id)name;
- (id)triggerWithUUID:(id)d;
- (id)uniqueIDsOfAllUsers;
- (id)updateHomeWithModel:(id)model message:(id)message;
- (id)updatePersonManagerSettings:(id)settings;
- (id)userForActivityStatus:(id)status;
- (id)userFromOutgoingInvitationModel:(id)model;
- (id)userIncludingPendingUserWithUUID:(id)d;
- (id)userUniqueIDForGuestAccessCode:(id)code;
- (id)userWithMergeID:(id)d;
- (id)userWithPairingIdentity:(id)identity;
- (id)userWithPairingIdentityIdentifier:(id)identifier;
- (id)userWithUUID:(id)d;
- (id)usersIncludingPendingUsers:(BOOL)users;
- (id)validateName:(id)name;
- (id)writeRequestTuplesFromMessage:(id)message outUnhandledRequests:(id *)requests;
- (id)zoneWithName:(id)name;
- (id)zoneWithUUID:(id)d;
- (int64_t)atHomeLevel;
- (int64_t)destinationTypeForDestinationWithIdentifier:(id)identifier;
- (int64_t)homeLocation;
- (int64_t)minimumMediaUserPrivilege;
- (int64_t)protectionMode;
- (int64_t)reachableAccessoriesCount;
- (int64_t)reachableAccessoriesCountExcludingMatter;
- (int64_t)reachableAppleMediaAccessoriesCount;
- (uint64_t)isCharacteristicAllowedForCarPlayAccess:(void *)access;
- (uint64_t)isMessageEntitledForCarPlayAccess:(uint64_t)access source:;
- (unint64_t)accessNotAllowedReasonCode;
- (unint64_t)accessoryCountForRoom:(id)room;
- (unint64_t)accessorySettingsLocalMessageHandler:(id)handler callerPrivilegeWithMessage:(id)message;
- (unint64_t)assistantAccessCapableAccessoryCount;
- (unint64_t)deriveNetworkRouterSupport:(unint64_t)support;
- (unint64_t)networkRouterSupport;
- (unint64_t)networkRouterSupportDisableReason;
- (unint64_t)numMatterV2Keys;
- (unint64_t)pendingUserPrivilegeFromOutgoingInvitationUUID:(id)d;
- (unint64_t)threadNetworkSequenceNumber;
- (void)__addMediaSession:(id)session;
- (void)__encodeAccessoriesWithCoder:(id)coder options:(unint64_t)options;
- (void)__handleAcceptedOutgoingInvitationResponse:(id)response destinationAddress:(id)address publicKey:(id)key username:(id)username reverseShare:(id)share reverseShareToken:(id)token issuerPublicKeyER:(id)r presenceAuthStatus:(id)self0 completionHandler:(id)self1;
- (void)__handleAddHAPAccessoryModel:(id)model message:(id)message;
- (void)__handleAddMediaAccessoryModel:(id)model message:(id)message;
- (void)__handleCompletedOutgoingInvitation:(id)invitation;
- (void)__handleProcessStateChange:(id)change;
- (void)__handleUpdateRestrictedGuestSettings:(id)settings;
- (void)__removeAccessory:(char)accessory isBeingReplaced:(int)replaced isForceUpdate:(void *)update message:;
- (void)__requestAccessoryBrowsing;
- (void)__sendOutgoingInvitation:(void *)invitation shareURL:(void *)l shareToken:(uint64_t)token suppressHomeInviteNotification:(void *)notification logEventBuilder:;
- (void)__updateServiceTransaction:(id)transaction accessoryTransaction:(id)accessoryTransaction service:(id)service accessory:(id)accessory hapService:(id)hapService;
- (void)_accessoryPairingDidComplete:(id)complete configuration:(id)configuration pairingEvent:(id)event accessoryServer:(id)server certificationStatus:(int64_t)status requestMessage:(id)message;
- (void)_addAccessories:(id)accessories;
- (void)_addAllUsersToAccessory:(id)accessory;
- (void)_addAndMaybeAssociateMediaAccessory:(void *)accessory message:;
- (void)_addMediaAccessory:(id)accessory message:(id)message;
- (void)_addNewTrigger:(id)trigger message:(id)message payloadAnnex:(id)annex triggerModel:(id)model;
- (void)_addOutgoingInvitations:(id)invitations message:(id)message transactionCompleted:(id)completed;
- (void)_addResidentWithUsername:(id)username publicKey:(id)key destination:(id)destination;
- (void)_addResponseTuplesFromDictionary:(id)dictionary accessoryRequestMapTable:(id)table responseTuples:(id)tuples completedGroup:(id)group logEvents:(id)events;
- (void)_addRetrievalCompletionTuple:(id)tuple;
- (void)_addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:(id)change message:(id)message;
- (void)_addTransactionForMinimumNetworkRouterHomeKitVersion:(id)version message:(id)message;
- (void)_addTransactionWithProtectionMode:(id)mode message:(id)message;
- (void)_addUserToContainer:(id)container;
- (void)_addUserToIdentityRegistry:(id)registry;
- (void)_addUsersWithInviteInformations:(id)informations message:(id)message;
- (void)_applyDeviceLockCheck:(uint64_t)check forSource:(void *)source message:(void *)message completion:;
- (void)_applyNotificationDeregistrations;
- (void)_areWriteRequestsAllowed:(id)allowed message:(id)message completion:(id)completion;
- (void)_auditAccessForUsers;
- (void)_auditActionSetsAndTriggersForAccessory:(id)accessory;
- (void)_auditAndDeregisterCharacteristicsForHAPAccessory:(id)accessory;
- (void)_auditChangedCharacteristics:(id)characteristics;
- (void)_broadcastClearActivityHistoryToOwnerDevices;
- (void)_cancelPairingWithAccessoryDescription:(id)description context:(id)context;
- (void)_cancelPairingWithAccessoryUUID:(id)d context:(id)context completionHandler:(id)handler;
- (void)_checkHomeManagerAppData:(void *)data;
- (void)_cleanAddAccessoryOperations;
- (void)_cleanRemovedUsers:(id)users;
- (void)_clearAccessoryNetworkProtectionStateWithTransaction:(id)transaction;
- (void)_clearCHIPStorageWithCompletion:(id)completion;
- (void)_clearEventsWithCompletion:(id)completion;
- (void)_configureBulletinNotification;
- (void)_configureConfiguredResident:(id)resident desiredConfigState:(unint64_t)state message:(id)message;
- (void)_configureNetworkRouterClientManager:(id)manager;
- (void)_configureUnconfiguredResident:(id)resident desiredConfigState:(unint64_t)state;
- (void)_configureUserActivityStateDetectorManager;
- (void)_continueLegacyAddAccessoryWithUUID:(id)d unassociatedAccessory:(id)accessory setupCode:(id)code appID:(id)iD message:(id)message;
- (void)_continuePairingAfterUserConsentWithAccessoryDescription:(id)description progressHandlerDelegate:(id)delegate message:(id)message;
- (void)_continuePairingAfterUserConsentWithAccessoryUUID:(id)d orUnassociatedAccessory:(id)accessory message:(id)message;
- (void)_createModifyNotificationsCoalesceTimerIfNeeded;
- (void)_createUniquePSKClientConfigurationWithRequestMessage:(id)message pairingEvent:(id)event completion:(id)completion;
- (void)_dequeueRetrievalForAccessory:(id)accessory linkType:(int64_t)type error:(id)error;
- (void)_deregisterDeviceForReachabilityNotification:(id)notification;
- (void)_deregisterPairedAccessory:(id)accessory;
- (void)_didOnboardHindsightChanged;
- (void)_disableDirectCharacteristicNotificationsForClient:(id)client;
- (void)_disableNotificationsForClient:(id)client;
- (void)_disableNotificationsForDevices:(id)devices;
- (void)_dispatchCHIPReport:(id)report destination:(id)destination;
- (void)_enableMultiUserWithMessage:(void *)message;
- (void)_enableNotificationsForDevices:(id)devices;
- (void)_encodeActionSets:(id)sets coder:(id)coder;
- (void)_encodeObjectsWithAccessoriesWithCoder:(id)coder;
- (void)_encodeWithCoder:(id)coder;
- (void)_evaluateNetworkProtectionAndRouterManagement;
- (void)_evaluateNetworkProtectionSupport;
- (void)_evaluateNetworkRouterManagementForTransaction:(id)transaction;
- (void)_evaluateOwnerTrustZoneCapabilityAndNotify;
- (void)_evaluateShouldRelaunchAndSetRelaunch;
- (void)_fetchMetadataFromPrimaryResidentWithCompletion:(id)completion;
- (void)_fetchMetadataOnCurrentDeviceWithCompletion:(id)completion;
- (void)_fetchThreadCredentialsAndStartThreadNetworkWithCompletion:(id)completion;
- (void)_fixupHindsightOnboarding;
- (void)_fixupUsersWithoutMergeID;
- (void)_getRunTimeStateUpdateWithOptions:(unint64_t)options includeMediaAccessorySessionState:(BOOL)state includeResidentDeviceState:(BOOL)deviceState completion:(id)completion;
- (void)_grantAccessAndSendOutgoingInvitation:(id)invitation suppressHomeInviteNotification:(BOOL)notification;
- (void)_handleAccessoryReachabilityChange:(id)change;
- (void)_handleAccessoryReachabilityUpdatesTimerFired;
- (void)_handleAddAccessory:(id)accessory;
- (void)_handleAddAccessoryModel:(id)model message:(id)message;
- (void)_handleAddAccessoryWithDescription:(id)description;
- (void)_handleAddAccessoryWithDescription:(void *)description progressHandlerDelegate:(void *)delegate message:;
- (void)_handleAddActionSet:(id)set;
- (void)_handleAddActionSetFromBuilder:(id)builder;
- (void)_handleAddActionSetModel:(id)model message:(id)message;
- (void)_handleAddEventTrigger:(id)trigger;
- (void)_handleAddEventTriggerModel:(id)model message:(id)message;
- (void)_handleAddHomeOwnedActionSet:(id)set;
- (void)_handleAddOutgoingHomeInvitationModel:(id)model message:(id)message;
- (void)_handleAddRoom:(id)room;
- (void)_handleAddRoomModel:(id)model message:(id)message;
- (void)_handleAddServiceGroup:(id)group;
- (void)_handleAddServiceGroupModel:(id)model message:(id)message;
- (void)_handleAddTimerTrigger:(id)trigger;
- (void)_handleAddTimerTriggerModel:(id)model message:(id)message;
- (void)_handleAddTriggerOwnedActionSet:(id)set;
- (void)_handleAddUserModel:(id)model message:(id)message;
- (void)_handleAddZone:(id)zone;
- (void)_handleAddZoneModel:(id)model message:(id)message;
- (void)_handleAllowUserManagementMessage:(id)message;
- (void)_handleAssistantAccessControlUpdate:(id)update;
- (void)_handleAudioAnalysisClassifierOptionsChange:(id)change message:(id)message;
- (void)_handleAudioAnalysisClassifierOptionsUpdateRequest:(id)request;
- (void)_handleAudioAnalysisOnboardingStatusChange:(id)change message:(id)message;
- (void)_handleAudioAnalysisOnboardingUpdateRequest:(id)request;
- (void)_handleCHIPSendRemoteRequestMessage:(id)message;
- (void)_handleCancelPairingAccessory:(id)accessory;
- (void)_handleCharacteristicEnableNotification:(id)notification;
- (void)_handleCharacteristicRead:(id)read;
- (void)_handleCharacteristicWrite:(id)write;
- (void)_handleCharacteristicsChangedNotification:(id)notification;
- (void)_handleClearActivityHistoryBroadcastMessage:(id)message;
- (void)_handleCoalescedModifyNotifications;
- (void)_handleConfirmResidentRequest:(id)request;
- (void)_handleCreateUniquePSKClientConfiguration:(id)configuration;
- (void)_handleDidOnboardLocationServicesChange:(id)change message:(id)message;
- (void)_handleDidReceiveIDSMessageWithNoListenerFromAddress:(id)address;
- (void)_handleDisableNotificationsTimerFired;
- (void)_handleEnableMultiUserRequest:(id)request;
- (void)_handleEnableNotifications:(id)notifications;
- (void)_handleEventLogClearMessage:(id)message;
- (void)_handleEventLogSetDidOnboard:(id)onboard;
- (void)_handleEventLogSetDurationMessage:(id)message;
- (void)_handleEventLogSetEnabledMessage:(id)message;
- (void)_handleExecuteActionSet:(id)set;
- (void)_handleExecuteConfirmationOfTrigger:(id)trigger;
- (void)_handleFetchOrCreateReaderKey:(id)key;
- (void)_handleFetchTriggerNameRequest:(id)request;
- (void)_handleFetchUniqueIdentifierForBundleIdentifier:(id)identifier;
- (void)_handleHAPAccessoryCharacteristicsUpdatedForAccessory:(id)accessory;
- (void)_handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:(id)change message:(id)message;
- (void)_handleHomeDataRequest:(id)request;
- (void)_handleHomeLocationChange:(int64_t)change previousLocation:(int64_t)location;
- (void)_handleHomeLocationUpdateFromSharedAdmin:(id)admin;
- (void)_handleHomeUpdateDidOnboardLocationServicesRequest:(id)request;
- (void)_handleHomeUpdateLocationServicesEnabledRequest:(id)request;
- (void)_handleIncomingMTRPluginMatterRequest:(id)request;
- (void)_handleJoinOrFormThreadNetworkMessage:(id)message;
- (void)_handleLegacyAddAccessory:(id)accessory;
- (void)_handleLocationServicesEnabledChange:(id)change message:(id)message;
- (void)_handleMatterLockChangedCharacteristics:(id)characteristics message:(id)message remoteRequest:(BOOL)request;
- (void)_handleMediaContentProfileAccessControlUpdate:(id)update;
- (void)_handleMediaPropertiesRead:(id)read;
- (void)_handleMediaPropertiesWrite:(id)write;
- (void)_handleModifyCharacteristicNotifications:(id)notifications;
- (void)_handleMultiUserEnabledChange:(id)change message:(id)message;
- (void)_handleMultipleCharacteristicRead:(id)read;
- (void)_handleMultipleCharacteristicWrite:(id)write;
- (void)_handleNetworkProtectionModeChangeForTransaction:(id)transaction;
- (void)_handleOutgoingInvitations:(id)invitations;
- (void)_handleOwnerSettingsUpdate:(id)update;
- (void)_handlePrimaryResidentDidBecomeCurrentDevice;
- (void)_handlePrimaryResidentDidBecomeOtherDevice;
- (void)_handleQueryResidentReachabilityForAccessories:(id)accessories;
- (void)_handleReadMediaProperties:(id)properties source:(unint64_t)source message:(id)message completionHandler:(id)handler;
- (void)_handleReceivedNonCloudSourcedSharedHomeModel;
- (void)_handleRemoteAddHAPAccessories:(id)accessories;
- (void)_handleRemoteAddMediaAccessory:(id)accessory;
- (void)_handleRemoteAddMediaAccessoryRequest:(id)request;
- (void)_handleRemoteGatewayNotificationRegistration:(id)registration enable:(BOOL)enable;
- (void)_handleRemoteReachabilityNotificationTimerFired;
- (void)_handleRemoteUserClientCloudShareRepairRequest:(id)request;
- (void)_handleRemoteUserClientCloudShareRequest:(id)request;
- (void)_handleRemoveAccessoryAfterUserConsent:(id)consent message:(id)message;
- (void)_handleRemoveAccessoryMessage:(id)message;
- (void)_handleRemoveAccessoryModel:(id)model message:(id)message;
- (void)_handleRemoveActionSet:(id)set;
- (void)_handleRemoveActionSetModel:(id)model message:(id)message;
- (void)_handleRemoveAppDataModel:(id)model message:(id)message;
- (void)_handleRemoveClientConfiguration:(id)configuration;
- (void)_handleRemoveOutgoingHomeInvitationModel:(id)model message:(id)message;
- (void)_handleRemoveRoom:(id)room;
- (void)_handleRemoveRoomModel:(id)model message:(id)message;
- (void)_handleRemoveServiceGroup:(id)group;
- (void)_handleRemoveServiceGroupModel:(id)model message:(id)message;
- (void)_handleRemoveTrigger:(id)trigger;
- (void)_handleRemoveTriggerModel:(id)model message:(id)message;
- (void)_handleRemoveUser:(id)user;
- (void)_handleRemoveUserModel:(id)model message:(id)message;
- (void)_handleRemoveZone:(id)zone;
- (void)_handleRemoveZoneModel:(id)model message:(id)message;
- (void)_handleRename:(id)rename;
- (void)_handleRequestHomeDataSync:(id)sync;
- (void)_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)message;
- (void)_handleResetMatterStorageRequest:(id)request;
- (void)_handleResidentChange;
- (void)_handleResolveThreadNetworkRequest:(id)request;
- (void)_handleResponseForElectMessageToResident:(id)resident error:(id)error;
- (void)_handleRetrieveAsyncResults:(id)results;
- (void)_handleRetrieveHomeLocationForFeedback:(id)feedback;
- (void)_handleRollACWGIssuerKey:(id)key;
- (void)_handleRollReaderKey:(id)key;
- (void)_handleSendingNotificationsForRequest:(id)request requestIdentifier:(id)identifier supportsMultiPartResponse:(BOOL)response characteristicUpdates:(id)updates completion:(id)completion;
- (void)_handleSetAppData:(id)data;
- (void)_handleSetDismissedUWBOnboarding:(id)onboarding;
- (void)_handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest:(id)request;
- (void)_handleSetHasOnboardedForAccessCodeChange:(id)change message:(id)message;
- (void)_handleSetHasOnboardedForAccessCodeMessage:(id)message;
- (void)_handleSetHasOnboardedForWalletKeyChange:(id)change message:(id)message;
- (void)_handleSetHomeManagerAppData:(id)data;
- (void)_handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)change;
- (void)_handleSetMinimumNetworkRouterHomeKitVersion:(id)version;
- (void)_handleSetResidentElectionVersion:(id)version;
- (void)_handleSharedUserSettingsUpdate:(id)update;
- (void)_handleSiriPhraseOptionsStatusChange:(id)change message:(id)message;
- (void)_handleSiriPhraseOptionsUpdateRequest:(id)request;
- (void)_handleSoundCheckChange:(id)change message:(id)message;
- (void)_handleSoundCheckUpdateRequest:(id)request;
- (void)_handleStartDiscoveringSymptomsForNearbyDevicesMessage:(id)message;
- (void)_handleStopDiscoveringSymptomsForNearbyDevicesMessage:(id)message;
- (void)_handleTestUpgradeToROAR:(id)r;
- (void)_handleThreadNetworkCredentialsRequest:(id)request;
- (void)_handleUnjoinThreadNetworkMessage:(id)message;
- (void)_handleUpdateAppDataModel:(id)model message:(id)message;
- (void)_handleUpdateAudioAnalysisAccess:(id)access;
- (void)_handleUpdateAutomaticSoftwareUpdate:(id)update;
- (void)_handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate:(id)update;
- (void)_handleUpdateMediaPassword:(id)password;
- (void)_handleUpdateMediaPeerToPeerEnabled:(id)enabled;
- (void)_handleUpdateMinimumMediaUserPrivilege:(id)privilege;
- (void)_handleUpdateNetworkProtection:(id)protection;
- (void)_handleUpdateNetworkProtectionWithHomeModel:(id)model message:(id)message;
- (void)_handleUpdateOutgoingInvitationState:(id)state;
- (void)_handleUpdatePresenceConsent:(id)consent;
- (void)_handleUpdateRequestForHomeInvitation:(id)invitation controllerPublicKey:(id)key controllerUsername:(id)username invitationState:(int64_t)state presenceAuthStatus:(id)status preferredUserID:(id)d fromHandle:(id)handle fromAddress:(id)self0 fromMergeID:(id)self1 reverseShareURL:(id)self2 reverseShareToken:(id)self3 issuerPublicKeyER:(id)self4 message:(id)self5 messageResponseHandler:(id)self6;
- (void)_handleUpdateRestrictedGuestSettings:(id)settings;
- (void)_handleUpdateUserAccess:(id)access;
- (void)_handleUpdateUserAnnounceAccess:(id)access;
- (void)_handleUpdateUserCamerasAccessLevel:(id)level;
- (void)_handleUserConsentForAccessoryReplacement:(id)replacement consent:(BOOL)consent message:(id)message;
- (void)_handleUserConsentResponseForAccessory:(id)accessory;
- (void)_handleUserInvitations:(id)invitations;
- (void)_handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:(id)ds;
- (void)_handleWriteMediaProperties:(id)properties source:(unint64_t)source requestMessage:(id)message completionHandler:(id)handler;
- (void)_homeManagerAppDataChanged:(id)changed;
- (void)_incrementCurrentSequenceNumber;
- (void)_loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance:(id)acceptance;
- (void)_locallyAddMediaAccessory:(void *)accessory message:;
- (void)_maybeCheckACWGLocksForMFiCertificationWithContentVersion:(void *)version;
- (void)_maybeFixHindsightOnboardingOnCurrentDevice;
- (void)_notificationPayloadsForRemoteGateway:(void *)gateway accessories:(void *)accessories enableCharacteristicNotificationPayload:(void *)payload characteristicNotificationThresholdsPayload:(void *)thresholdsPayload disableCharacteristicNotificationPayload:(void *)notificationPayload enableMediaNotificationPayload:(void *)mediaNotificationPayload disableMediaNotificationPayload:;
- (void)_notifyChangedActionSetResponses:(id)responses notificationUpdateIdentifier:(id)identifier toUserDeviceAddress:(id)address;
- (void)_notifyChangedProperties:(id)properties withRequestIdentifier:(id)identifier notificationUpdateIdentifier:(id)updateIdentifier toUserDeviceAddress:(id)address;
- (void)_notifyClientOfNewlyAddedAccessories:(id)accessories requestMessage:(id)message;
- (void)_notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)accessories shouldRefreshBadge:(BOOL)badge withCompletion:(id)completion;
- (void)_notifyClientsOfUpdatedResidentUser:(id)user;
- (void)_notifyRemoteUsersOfChangedActionSetResponses:(id)responses;
- (void)_notifyRemoteUsersOfChangedCharacteristics:(id)characteristics message:(id)message broadcast:(BOOL)broadcast;
- (void)_notifyRemoteUsersOfChangedProperties:(id)properties requestMessageInformation:(id)information;
- (void)_notifyRetrievalError:(id)error accessoryServer:(id)server linkType:(int64_t)type accessoryOperationBlock:(id)block;
- (void)_notifyThreadLayerOfResidentChange;
- (void)_notifyUpdatedCharacteristic:(id)characteristic withRequestIdentifier:(id)identifier notificationUpdateIdentifier:(id)updateIdentifier toUserDeviceAddress:(id)address completion:(id)completion;
- (void)_pairAccessoryWithAccessoryDescription:(id)description configuration:(id)configuration pairingEvent:(id)event progressHandler:(id)handler requestMessage:(id)message;
- (void)_pairAccessoryWithAccessoryDescription:(id)description unpairedAccessory:(id)accessory configuration:(id)configuration pairingEvent:(id)event requestMessage:(id)message;
- (void)_performAllowedWriteCharacteristicValues:(uint64_t)values source:(void *)source identifier:(uint64_t)identifier qualityOfService:(void *)service withCompletionHandler:(void *)handler activity:;
- (void)_performMediaGroupReadinessCheckAndSubmitMetricEventWithMessage:(id)message;
- (void)_performOperation:(id)operation completion:(id)completion;
- (void)_performRemoteAddHAPAccessories:(id)accessories;
- (void)_performUpdateBulletinRegistrations:(id)registrations;
- (void)_postInternalNotificationForChangedCharacteristics:(id)characteristics previouslyNilChangedCharacteristics:(id)changedCharacteristics modifiedCharacteristics:(id)modifiedCharacteristics changedByThisDevice:(BOOL)device residentShouldNotifyPeers:(BOOL)peers message:(id)message broadcast:(BOOL)broadcast;
- (void)_processAccessoriesToAddForUnpairedAccessory:(id)accessory certificationStatus:(int64_t)status accessoryServer:(id)server networkCredential:(id)credential pairingEvent:(id)event message:(id)message completionHandler:(id)handler;
- (void)_processLegacyPairingRequestForMessage:(id)message cancelPairing:(BOOL)pairing context:(id)context;
- (void)_processNewlyPairedAccessoryServerInfo:(id)info message:(id)message completionHandler:(id)handler;
- (void)_processOutgoingInvitationsRequest:(id)request;
- (void)_processPairingRequestForMessage:(id)message cancelPairing:(BOOL)pairing context:(id)context;
- (void)_processProductDataForNewlyAddedAccessory:(id)accessory transaction:(id)transaction;
- (void)_processUnacceptReverseShareAccessForUsers;
- (void)_processUnsentOutgoingInvitations;
- (void)_processUpdatedAccessoryServer:(id)server reAddServices:(BOOL)services;
- (void)_processUpdatedProductDataForAccessory:(id)accessory hapAccessory:(id)hapAccessory transaction:(id)transaction;
- (void)_purgeResidentUsers;
- (void)_reachabilityChangedForAccessory:(id)accessory reachable:(BOOL)reachable;
- (void)_readCharacteristicValues:(id)values requestMessage:(id)message source:(unint64_t)source withCompletionHandler:(id)handler;
- (void)_readLocalHomeKeyMiscInfo;
- (void)_readProfileState:(void *)state viaDevice:;
- (void)_reconfigureAccessoriesOnRouterRemovalWithCompletion:(id)completion;
- (void)_reevaluateAccessoryInfoWithBadgeRefresh:(BOOL)refresh;
- (void)_refreshCharacteristicValuesOnHomeNotificationEnable;
- (void)_refreshUserDisplayNames;
- (void)_registerDeviceForReachabilityNotification:(id)notification accessoryList:(id)list;
- (void)_registerForAccessoryReachabilityNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier;
- (void)_registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier;
- (void)_registerForMatterRequests;
- (void)_registerForMessages;
- (void)_registerForNotifications;
- (void)_registerForReachabilityChangeNotificationsEnabled:(BOOL)enabled completionHandler:(id)handler;
- (void)_registerForThreadNetworkEvents;
- (void)_registerPairedAccessory:(id)accessory transports:(unint64_t)transports setupHash:(id)hash;
- (void)_registerPerformMediaGroupReadinessCheckMessage;
- (void)_registerThreadResidentCommissioningMessageHandlers;
- (void)_relayAddTriggerToResident:(id)resident;
- (void)_remoteAccessEnabled:(BOOL)enabled;
- (void)_remoteAccessHealthMonitorTimerDidFire;
- (void)_remotelyAddMediaAccessory:(void *)accessory usingRemoteMessageName:(void *)name message:(void *)message fallbackBlock:;
- (void)_remotelySetNotificationsEnabled:(BOOL)enabled forActionSetUUIDs:(id)ds;
- (void)_remotelySetNotificationsEnabled:(BOOL)enabled forCharacteristics:(id)characteristics characteristicChangeThresholds:(id)thresholds;
- (void)_remotelySetNotificationsEnabled:(BOOL)enabled forMatterAttributes:(id)attributes;
- (void)_removeAccessories:(id)accessories message:(id)message;
- (void)_removeAccessoriesForPrimaryAccessory:(id)accessory error:(id)error completionHandler:(id)handler;
- (void)_removeAccessoriesFromContainers:(id)containers;
- (void)_removeAccessory:(id)accessory completionHandler:(id)handler;
- (void)_removeAccessoryWithUUID:(id)d message:(id)message;
- (void)_removeAllHomeContentsAndAccessoryPairings:(BOOL)pairings queue:(id)queue completionHandler:(id)handler;
- (void)_removeClientConfigurationWithIdentifier:(id)identifier;
- (void)_removeClientConfigurationWithIdentifier:(id)identifier completion:(id)completion;
- (void)_removeCloudData;
- (void)_removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:(id)devices;
- (void)_removeCorruptAccessories;
- (void)_removeFailedAddWithAccessoryServerInfo:(id)info;
- (void)_removeMediaSessionWithIdentifier:(id)identifier;
- (void)_removeOutgoingInvitationForUser:(id)user;
- (void)_removePendingAccessoryAdd:(id)add;
- (void)_removeRetrievalCompletionTuple:(id)tuple;
- (void)_removeService:(id)service;
- (void)_removeTrigger:(id)trigger message:(id)message;
- (void)_removeUser:(id)user;
- (void)_removeUser:(id)user message:(id)message;
- (void)_removeUserFromContainer:(id)container;
- (void)_removeWithMergeSecondaryAccessory:(id)accessory removedFromBridgeAccessory:(id)bridgeAccessory completionHandler:(id)handler;
- (void)_requestRemoveClientConfigurationWithIdentifier:(id)identifier;
- (void)_requestUniquePSKClientConfigurationWithCompletion:(id)completion;
- (void)_resubscribeForNotificationsOnResident:(id)resident;
- (void)_retrieveHAPAccessoryForHMDHAPAccessory:(id)accessory linkType:(int64_t)type forceRetrieve:(BOOL)retrieve completion:(id)completion;
- (void)_retrievePreferredNetworkOnControllerWithCompletion:(id)completion;
- (void)_retryStartThreadNetwork:(double)network;
- (void)_saveAndSyncMatterFabricIDWithCompletion:(id)completion;
- (void)_saveOutgoingInvitationsWithRestrictedGuestSettings:(id)settings inTransaction:(id)transaction message:(id)message transactionCompleted:(id)completed;
- (void)_saveRestrictedGuestSettingsFromOutgoingInvitation:(id)invitation managedObjectContext:(id)context error:(id *)error;
- (void)_scheduleApplyNetworkRouterSettingsAction:(id)action;
- (void)_sendClientCharacteristicsChangedNotificationWithIdentifier:(id)identifier requestMessage:(id)message multiPartResponse:(BOOL)response moreInMultiPartResponse:(BOOL)partResponse characteristicChanges:(id)changes completionHandler:(id)handler;
- (void)_sendCoalescedRemoteNotificationsForRequestMessage:(id)message accessories:(id)accessories;
- (void)_sendInvitation:(id)invitation message:(id)message shareURL:(id)l shareToken:(id)token suppressHomeInviteNotification:(BOOL)notification logEventBuilder:(id)builder;
- (void)_sendInvitationCancelationRequestToInvitee:(id)invitee;
- (void)_sendRemoteMessageUsingNodeId:(unint64_t)id payload:(id)payload completion:(id)completion;
- (void)_sendRemoveCompletionStatusForHMDAccessories:(id)accessories withCompletion:(id)completion error:(id)error;
- (void)_sendResidentInviteWithDestination:(id)destination;
- (void)_setAccessories:(id)accessories;
- (void)_setupActiveNetworkRouterAccessory:(id)accessory existingRouterAccessories:(id)accessories;
- (void)_startHomeNotificationDeregistrationTimer;
- (void)_startThreadNetworkOnCommissionerWithCompletion:(id)completion;
- (void)_startThreadNetworkOnCommissionerWithOperationalDataset:(id)dataset completion:(id)completion;
- (void)_startThreadNetworkOnControllerWithCompletion:(id)completion;
- (void)_startThreadNetworkOnResidentWithCompletion:(id)completion;
- (void)_startThreadNetworkWithCompletion:(id)completion;
- (void)_stopThreadNetworkWithCompletion:(id)completion;
- (void)_subscribeForHomeNotificationsFromRemoteGateway:(BOOL)gateway accessories:(id)accessories;
- (void)_subscribeForHomeNotificationsOnDirectTransports:(void *)transports;
- (void)_subscribeForNotificationFromRemoteGateway:(void *)gateway;
- (void)_synchronizeHindsightCloudShareManager;
- (void)_unconfigureNetworkRouterClientManager;
- (void)_unconfigurePairedAccessoriesForServer:(id)server updateReachability:(BOOL)reachability;
- (void)_unitTest_setRetrievalCompletionsTimeout:(double)timeout;
- (void)_unjoinThreadNetworkWithCompletion:(id)completion;
- (void)_unregisterForThreadNetworkEvents;
- (void)_updateActiveNetworkRouterAccessory:(id)accessory isReplacement:(BOOL)replacement withTransaction:(id)transaction;
- (void)_updateConfigurationStateForResidentDevice:(id)device desiredConfigState:(unint64_t)state message:(id)message;
- (void)_updateConfigurationVersion;
- (void)_updateExpectConfigurationVersion;
- (void)_updateHomeLocation;
- (void)_updateOwnerSettingDependents:(id)dependents keyPath:(id)path value:(id)value;
- (void)_updateReachabilityChangeToRegisteredDevices:(id)devices;
- (void)_updateRestrictedGuestHomeAccessSettingsFromOutgoingInvitation:(id)invitation forUserModel:(id)model;
- (void)_updateThreadNetworkWithModel:(id)model message:(id)message;
- (void)_updateWoWState:(id)state;
- (void)_wol_processChangedCharacteristicResponses:(id)responses;
- (void)_writeAccessoryCapabilities:(id)capabilities accessoryUUID:(id)d homeUUID:(id)iD;
- (void)_writeCharacteristicValues:(id)values requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource withCompletionHandler:(id)handler;
- (void)_writeCharacteristicValues:(void *)values source:(void *)source message:(void *)message identifier:(void *)identifier qualityOfService:(void *)service withCompletionHandler:(void *)handler activity:;
- (void)_writeLogData:(id)data logName:(id)name completion:(id)completion;
- (void)_writeResidentCapabilities:(id)capabilities accessoryUUID:(id)d homeUUID:(id)iD;
- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didDiscoverAccessories:(id)accessories transaction:(id)transaction error:(id)error;
- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didStopPairingWithError:(id)error;
- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateCategory:(id)category;
- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateHasPairings:(BOOL)pairings;
- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateValuesForCharacteristics:(id)characteristics stateNumber:(id)number broadcast:(BOOL)broadcast;
- (void)accessoryBrowser:(id)browser didAddAccessoryAdvertisement:(id)advertisement;
- (void)accessoryBrowser:(id)browser didFindAccessoryServer:(id)server stateChanged:(BOOL)changed stateNumber:(id)number completion:(id)completion;
- (void)accessoryBrowser:(id)browser didFindAccessoryServerNeedingReprovisioning:(id)reprovisioning error:(id)error;
- (void)accessoryBrowser:(id)browser didFinishPairingForAccessoryServer:(id)server;
- (void)accessoryBrowser:(id)browser didFinishWACForAccessoryWithIdentifier:(id)identifier error:(id)error;
- (void)accessoryBrowser:(id)browser didRemoveAccessoryAdvertisement:(id)advertisement;
- (void)accessoryBrowser:(id)browser didRemoveAccessoryServer:(id)server error:(id)error;
- (void)accessoryBrowser:(id)browser didTombstoneAccessoryServer:(id)server;
- (void)accessoryBrowser:(id)browser didUpdateEndpoint:(id)endpoint;
- (void)accessoryBrowser:(id)browser discoveryFailedWithError:(id)error accessoryServer:(id)server linkType:(int64_t)type;
- (void)actionSetResponsePayloadForActionSetsPayload:(id)payload completion:(id)completion;
- (void)addAccessory:(id)accessory;
- (void)addCompanionAsResidentUser:(id)user;
- (void)addMediaSession:(id)session;
- (void)addMediaSessionState:(id)state;
- (void)addNewlyConfiguredAccessories:(id)accessories addSessionIdentifier:(id)identifier;
- (void)addNotificationDeregistrationForClientIdentifier:(id)identifier;
- (void)addNotificationRegistrationForClientIdentifier:(id)identifier includesAppleMediaAccessories:(BOOL)accessories;
- (void)addOutgoingInvitation:(id)invitation;
- (void)addResidentCapableDevice:(id)device;
- (void)addSharedUserEventBuilder:(id)builder;
- (void)addSharedUserResponseEventBuilder:(id)builder;
- (void)addToCurrentTriggers:(id)triggers;
- (void)addUnconfiguredResidentDevice:(id)device;
- (void)addUser:(id)user;
- (void)aggregator:(id)aggregator accessoryCapabilitiesWithUUID:(id)d completion:(id)completion;
- (void)aggregator:(id)aggregator changedAccessoryCapabilities:(id)capabilities rawCapabilities:(id)rawCapabilities accessoryUUID:(id)d homeUUID:(id)iD;
- (void)aggregator:(id)aggregator changedResidentCapabilities:(id)capabilities rawCapabilities:(id)rawCapabilities accessoryUUID:(id)d homeUUID:(id)iD;
- (void)aggregator:(id)aggregator didReceiveDeviceIRKWithUUID:(id)d deviceIRK:(id)k;
- (void)aggregator:(id)aggregator didReceivePublicPairingKeyWithUUID:(id)d pairingIdentity:(id)identity;
- (void)aggregator:(id)aggregator didReceiveSoftwareVersionWithUUID:(id)d softwareVersion:(id)version;
- (void)aggregator:(id)aggregator residentCapabilitiesWithUUID:(id)d completion:(id)completion;
- (void)aggregatorDidBecomePrimary:(id)primary;
- (void)auditAccessForUsers;
- (void)auditDestinationsForNotifications:(id)notifications;
- (void)btleAccessoryReachabilityProbeTimer:(BOOL)timer;
- (void)canReachPrimaryResidentChanged;
- (void)checkForCATIDUpdate:(id)update;
- (void)clearAccessoryServerBrowserOperationalFabricData;
- (void)clientController:(id)controller didReceiveFetchedCachedEvents:(id)events source:(id)source;
- (void)clientController:(id)controller primaryClientConnectMessageFailWithError:(id)error;
- (void)completePotentialFabricDataCreation;
- (void)computeBridgedAccessoriesForAllBridges;
- (void)configureAccessorySettingsMessengerWithMessengerFactory:(id)factory messageHandlerFactory:(id)handlerFactory;
- (void)configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:(id)accessory accessories:(id)accessories uncommittedTransactions:(id)transactions;
- (void)configureBulletinNotification;
- (void)configureMediaDestinationControllersForAccessories:(id)accessories;
- (void)configureMediaGroupObjects;
- (void)configureMediaGroupsAggregateConsumer;
- (void)configureMediaGroupsAggregator;
- (void)configureMediaGroupsUnconfiguredParticipantOnboardingManager;
- (void)configureMediaSystems;
- (void)configureMultiuserSettingsMessengerWithMessengerFactory:(id)factory;
- (void)configureNaturalLightingForDemoMode;
- (void)configureNaturalLightingWithDemoModeEnabled:(BOOL)enabled;
- (void)configurePrimaryResidentMessageRouterWithFactory:(id)factory metricsDispatcherFactory:(id)dispatcherFactory;
- (void)configureRemoteEventRouterClientControllerForAccessories:(id)accessories;
- (void)configureSiriEndpointProfilesMessengerWithMessengerFactory:(id)factory messageHandlerFactory:(id)handlerFactory;
- (void)configureUnifiedLanguageValueListSettingDataProviderWithFactory:(id)factory;
- (void)configureUserActivityStateDetectorManager;
- (void)connectToThreadAccessoryWithExtendedMACAddress:(id)address completion:(id)completion;
- (void)createAndConfigureBulletinManagers;
- (void)createRemoteEventRouterServerIfNeeded;
- (void)dealloc;
- (void)deregisterForMessagesInDemoModeV2;
- (void)didReceiveAccessorySetting:(id)setting accessoryUUID:(id)d;
- (void)didUpdateAggregateDataForMediaGroupsAggregateConsumer:(id)consumer;
- (void)disableBulletinRegistrations:(id)registrations source:(id)source homeMember:(id)member context:(id)context;
- (void)disableNotificationsForDevices:(id)devices;
- (void)discoverPrimaryResidentForEventRouterClientController:(id)controller;
- (void)dispatchRequestToEvaluateCondition:(id)condition forCharacteristics:(id)characteristics completion:(id)completion;
- (void)doFullImportWithCompletion:(id)completion;
- (void)downloadLogWithController:(id)controller nodeId:(id)id type:(int64_t)type timeout:(double)timeout completion:(id)completion;
- (void)enableMultiUser;
- (void)enableNotificationsForDevices:(id)devices;
- (void)enableUserListeningHistoryForAccessoryUUID:(id)d userUUID:(id)iD;
- (void)encodeMediaSystemsWithCoder:(id)coder modifiedOptions:(unint64_t)options;
- (void)encodeWithCoder:(id)coder;
- (void)endReportingSessionForMessage:(id)message;
- (void)evaluateBulletinNotificationsSupported;
- (void)evaluateNotificationConditionForCharacteristics:(id)characteristics homePresence:(id)presence completion:(id)completion;
- (void)evaluateResidentUpdate;
- (void)evaluateShouldRelaunchAndSetRelaunch;
- (void)exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:(id)d commissioneeNodeID:(id)iD fabricID:(id)fabricID publicKey:(id)key sender:(id)sender completion:(id)completion;
- (void)executeActionSet:(id)set;
- (void)executeActionsFromMessage:(id)message;
- (void)fetchFabricDataForPairingWithCompletion:(id)completion;
- (void)fetchOperationalCertificatesForNewFabricWithFabricID:(id)d publicKey:(id)key fetchFromResident:(BOOL)resident completion:(id)completion;
- (void)filterServiceTransactions:(id)transactions removedServiceUUIDs:(id)ds;
- (void)finishPairingForServer:(id)server;
- (void)fixupHomeAfterDecoding;
- (void)getOrCreateUniqueIDForAccessoriesForUser:(id)user flow:(id)flow completionHandler:(id)handler;
- (void)getReachableIPAccessories:(unint64_t *)accessories btleAccessories:(unint64_t *)btleAccessories mediaAccessories:(unint64_t *)mediaAccessories;
- (void)getRunTimeStateUpdateWithOptions:(unint64_t)options includeMediaAccessorySessionState:(BOOL)state includeResidentDeviceState:(BOOL)deviceState completion:(id)completion;
- (void)handleAcceptRequestForIDSInvitationWithIdentifier:(id)identifier payload:(id)payload fromAddress:(id)address fromMergeID:(id)d;
- (void)handleAccessoryDidAddNetworkRouterControllerNotification:(id)notification;
- (void)handleAccessoryDidRemoveNetworkRouterControllerNotification:(id)notification;
- (void)handleAccessoryReachabilityChangeNotification:(id)notification;
- (void)handleAccountHandlesUpdated:(id)updated;
- (void)handleActiveAccountChanged:(id)changed;
- (void)handleCATUpdate;
- (void)handleCHIPSendRemoteRequestMessage:(id)message;
- (void)handleCHIPSendReportMessage:(id)message;
- (void)handleClearMatterControllerPrivateStorageRequest:(id)request;
- (void)handleClientProcessDisconnectedNotification:(id)notification;
- (void)handleCommissioningCertificateRequest:(id)request;
- (void)handleCommissioningCertificateRequestWithCommissionerNodeID:(id)d commissioneeNodeID:(id)iD fabricID:(id)fabricID publicKey:(id)key sender:(id)sender completion:(id)completion;
- (void)handleCurrentAccountMergeIdentifierUpdated:(id)updated;
- (void)handleCurrentUserPrivilegeChanged:(id)changed;
- (void)handleCurrentWiFiNetworkChangedNotification:(id)notification;
- (void)handleDeclineRequestForIDSInvitationWithIdentifier:(id)identifier fromAddress:(id)address;
- (void)handleDidReceiveIDSMessageWithNoListener:(id)listener;
- (void)handleEvaluatePredicateMessage:(id)message;
- (void)handleFetchLightProfileSettingsMessage:(id)message;
- (void)handleFetchLightProfileSettingsMessage:(id)message withLightProfileUUIDs:(id)ds;
- (void)handleFetchPresenceMapMessage:(id)message;
- (void)handleFindResidentsNotification:(id)notification;
- (void)handleFirstProcessDidBecomeActiveNotification:(id)notification;
- (void)handleGetPowerAssertionsWithMessage:(id)message;
- (void)handleGetPrimaryResidentNetworkInfoWithMessage:(id)message;
- (void)handleHAPAccessoryCharacteristicsAddedNotification:(id)notification;
- (void)handleHAPAccessoryServicesAddedNotification:(id)notification;
- (void)handleHomeBecameQualifiedForAdaptiveTemperatureAutomations;
- (void)handleHomeDataLoaded:(id)loaded;
- (void)handleHomePresenceUpdate:(id)update;
- (void)handleHomeWasRemoved;
- (void)handleLastProcessDidBecomeInactiveNotification:(id)notification;
- (void)handleMatterPairingCompletionNotification:(id)notification;
- (void)handleMobileAssetsUpdatedNotification:(id)notification;
- (void)handleNetworkInfoFetchWithMessage:(id)message;
- (void)handlePrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification:(id)notification;
- (void)handlePrimaryResidentChangeNotification:(id)notification;
- (void)handlePrimaryResidentDidBecomeCurrentDeviceSwiftExtensions;
- (void)handlePrimaryResidentDidBecomeOtherDeviceSwiftExtensions;
- (void)handlePrimaryResidentIsCurrentDeviceChangeNotification:(id)notification;
- (void)handleRemoteUpdateCHIPKeyValueStoreMessage:(id)message;
- (void)handleRemoveAccessory:(id)accessory completion:(id)completion;
- (void)handleRemoveAccessoryMessage:(id)message;
- (void)handleRemovedMediaSessions:(id)sessions;
- (void)handleReportingSessionResponseMessage:(id)message;
- (void)handleResetMatterStorageRequest:(id)request;
- (void)handleRoomsSupportingLocalPresenceMessage:(id)message;
- (void)handleSetNaturalLightingEnabledForLightProfilesMessage:(id)message;
- (void)handleSetPreferredPrimaryMessage:(id)message;
- (void)handleSignificantTimeChange;
- (void)handleSiriEndPointAddedNotification:(id)notification;
- (void)handleSwitchFromResidentSelectionToREV2:(id)v2;
- (void)handleUpdateBulletinRegistrations:(id)registrations;
- (void)handleUpdatedCHIPPropertiesOnHomeModel:(id)model actions:(id)actions;
- (void)handleUpdatedCharacteristics:(id)characteristics accessoryServer:(id)server;
- (void)handleUserActivityStateDetectorManagerChangeNotification:(id)notification;
- (void)handleUserFabricKeyUpdate:(id)update;
- (void)handleWiFiInfoFetchWithMessage:(id)message;
- (void)handleXPCConnectionInvalidated:(id)invalidated;
- (void)incrementOperatePrivilegeCATVersion:(id)version;
- (void)invokeCommandWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId commandId:(id)commandId fields:(id)fields timedInvokeTimeout:(id)timeout source:(unint64_t)source completion:(id)self0;
- (void)isEnergyCurrentlyExpensiveWithCompletion:(id)completion;
- (void)matterAccessoryBecameReachable;
- (void)maybeRemoveStaleRegistrationsFromPreviousUserForSource:(id)source homeMember:(id)member context:(id)context;
- (void)mediaSystemController:(id)controller didRemoveMediaSystem:(id)system;
- (void)mediaSystemController:(id)controller removeAccessories:(id)accessories fromAssistantAccessControl:(id)control;
- (void)mergeMediaDestinationControllerDataWithConsumer:(id)consumer;
- (void)mergeMediaDestinationsWithConsumer:(id)consumer;
- (void)mergeMediaGroupsAggregateDataWithConsumer:(id)consumer;
- (void)migrateAfterResidentChange;
- (void)modifyCharacteristicNotifications:(id)notifications characteristicChangeThresholds:(id)thresholds mediaNotifications:(id)mediaNotifications actionSetNotificationPayload:(id)payload enableNotification:(BOOL)notification withDevice:(id)device;
- (void)newMatterAccessoryFrom:(id)from message:(id)message;
- (void)notifyClientOfVendorInfoUpdatedForManufacturers:(id)manufacturers withCompletion:(id)completion;
- (void)notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)accessories;
- (void)notifyClientsOfReachabilityUpdateForAccessory:(id)accessory;
- (void)notifyNewRemotePeersFound:(BOOL)found remoteUsersRemoved:(id)removed forceRemoteNotificationRegistration:(BOOL)registration;
- (void)notifyOfAddedAccessory:(id)accessory;
- (void)notifyOfChangedCharacteristic:(id)characteristic changedByThisDevice:(BOOL)device residentShouldNotifyPeers:(BOOL)peers message:(id)message;
- (void)notifyOfNewlyAddedAccessoryByThisOwnerDevice:(id)device;
- (void)notifyOfRemovedAccessory:(id)accessory source:(unint64_t)source;
- (void)notifyRemoteUsersOfChangedActionSetResponses:(id)responses;
- (void)notifyRemoteUsersOfChangedCharacteristics:(id)characteristics message:(id)message broadcast:(BOOL)broadcast;
- (void)notifyRemoteUsersOfChangedProperties:(id)properties requestMessageInformation:(id)information;
- (void)onThreadNetworkCallStateChange:(BOOL)change;
- (void)onThreadNetworkConnectionStateChange:(int64_t)change;
- (void)onThreadNetworkNodeTypeStateChange:(int64_t)change;
- (void)onThreadNetworkPeripheralDeviceNodeTypeChange:(id)change;
- (void)onThreadNetworkWakeOnDeviceConnectionStateChange:(id)change;
- (void)performLocalAddAccessoryWithDescription:(id)description progressHandlerDelegate:(id)delegate completion:(id)completion;
- (void)prepareNewCloudKitZone;
- (void)prepareOperationalFabricData;
- (void)primaryResidentClientHasConnectivityDidChangeForRemoteEventRouterClientController:(id)controller;
- (void)queryPrimaryResidentReachabilityForAccessories:(id)accessories completion:(id)completion;
- (void)reEvaluateHomeHubState;
- (void)reEvaluateTriggers;
- (void)reachabilityChangedForAccessory:(id)accessory reachable:(BOOL)reachable;
- (void)readAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId params:(id)params completion:(id)completion;
- (void)readCharacteristicValues:(id)values identifier:(id)identifier source:(unint64_t)source qualityOfService:(int64_t)service withCompletionHandler:(id)handler;
- (void)readCharacteristicValues:(id)values source:(unint64_t)source sourceForLogging:(id)logging qualityOfService:(int64_t)service withCompletionHandler:(id)handler;
- (void)readProfileState:(id)state viaDevice:(id)device;
- (void)redispatchMediaReadRequests:(id)requests viaDevice:(id)device completion:(id)completion;
- (void)redispatchMediaWriteRequests:(id)requests viaDevice:(id)device completion:(id)completion;
- (void)redispatchToResidentMessage:(id)message target:(id)target responseQueue:(id)queue viaDevice:(id)device;
- (void)reevaluateAccessoryInfo;
- (void)refreshUserDisplayNames;
- (void)regionStateUpdated;
- (void)registerForAccessoryReachabilityNotifications:(BOOL)notifications registrationIdentifier:(id)identifier;
- (void)registerForBulletinNotificationRegistrationHandlersUsingPolicies:(id)policies;
- (void)registerForDeviceWithCapabilities;
- (void)registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier;
- (void)registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier;
- (void)registerForNetworkInfoMessages;
- (void)registerForPowerAssertionMessages;
- (void)remoteAccessEnabled:(BOOL)enabled;
- (void)remoteAccessHealthMonitorTimerDidFire;
- (void)remotelySetNotificationsEnabled:(BOOL)enabled forActionSetUUIDs:(id)ds;
- (void)remotelySetNotificationsEnabled:(BOOL)enabled forCharacteristics:(id)characteristics characteristicChangeThresholds:(id)thresholds;
- (void)remotelySetNotificationsEnabled:(BOOL)enabled forMatterAttributes:(id)attributes;
- (void)remotelyUpdateHomeModelWithCHIPKeyValueStore:(id)store removedKeys:(id)keys completion:(id)completion;
- (void)removeAccessory:(id)accessory;
- (void)removeAccessory:(id)accessory completionHandler:(id)handler;
- (void)removeAllHomeContentsAndAccessoryPairings:(BOOL)pairings queue:(id)queue completionHandler:(id)handler;
- (void)removeAllUsersAndCloudDataFromAccessory:(id)accessory completionHandler:(id)handler;
- (void)removeBulletinBoardNotificationsMigrationFileFromDisk;
- (void)removeCameraNotificationSettingsMigrationFileFromDisk;
- (void)removeFromCurrentTriggers:(id)triggers;
- (void)removeMediaSession:(id)session;
- (void)removeMediaSessionState:(id)state;
- (void)removeNotificationDeregistrationForClientIdentifier:(id)identifier;
- (void)removeOutgoingInvitation:(id)invitation;
- (void)removeRemovedUser:(id)user;
- (void)removeResidentCapableDevice:(id)device;
- (void)removeService:(id)service;
- (void)removeSharedHomeFabricData;
- (void)removeSharedUserEventBuilder:(id)builder;
- (void)removeSharedUserResponseEventBuilder:(id)builder;
- (void)removeThreadNetworkPreferredNetworkWithCompletion:(id)completion;
- (void)removeTrigger:(id)trigger;
- (void)removeTriggerNoNotification:(id)notification;
- (void)removeUnconfiguredResidentDeviceWithUserID:(id)d;
- (void)removeUser:(id)user;
- (void)removeUserWithUserID:(id)d;
- (void)removeWithMergeSecondaryAccessory:(id)accessory removedFromBridgeAccessory:(id)bridgeAccessory completionHandler:(id)handler;
- (void)resendOutgoingInvitationToUser:(id)user;
- (void)resetAccessoryHashedRouteIdentifiers;
- (void)resetConfiguration;
- (void)resetHomeKeyMiscInfo;
- (void)residentDeviceManager:(id)manager didUpdatePrimaryResident:(id)resident previousPrimaryResident:(id)primaryResident;
- (void)residentDeviceManager:(id)manager didUpdateResidentAvailable:(BOOL)available;
- (void)residentDeviceManagerDidUpdateResidents:(id)residents;
- (void)respondMessage:(id)message withSettingResults:(id)results;
- (void)resubscribeForNotificationsOnResident:(id)resident;
- (void)retrieveHAPAccessoryForHMDAccessory:(id)accessory linkType:(int64_t)type forceRetrieve:(BOOL)retrieve queue:(id)queue completion:(id)completion;
- (void)retrieveOperationalCertificatesForFabricID:(id)d commissioneeNodeID:(id)iD publicKey:(id)key completion:(id)completion;
- (void)retrieveOperationalCertificatesForFabricID:(id)d commissionerNodeID:(id)iD commissioneeNodeID:(id)nodeID publicKey:(id)key completion:(id)completion;
- (void)retrieveStateForTrackedAccessory:(id)accessory stateNumber:(id *)number isReachable:(BOOL *)reachable linkQuality:(unint64_t *)quality lastSeen:(id *)seen;
- (void)retrieveThreadNetworkMetadataWithCompletion:(id)completion;
- (void)retrieveThreadNetworkMetadataWithNoFallbackWithCompletion:(id)completion;
- (void)runPotentialFabricDataCreationBlock:(id)block;
- (void)saveAndSyncWithThreadOperationalDataset:(id)dataset forceUpdate:(BOOL)update;
- (void)saveAttributedUserUUID:(id)d forTargetStateCharacteristic:(id)characteristic;
- (void)saveClientWalletKeyUUIDToLocalStore:(id)store;
- (void)saveToCurrentAccountWithReason:(id)reason;
- (void)scheduleRemoval;
- (void)sendFirmwareUpdateUINotification:(id)notification;
- (void)setAccessories:(id)accessories;
- (void)setActiveNetworkRouterInitialSetupNeeded:(BOOL)needed;
- (void)setActiveNetworkRouterUUID:(id)d;
- (void)setAllowedToEnableAdaptiveTemperatureAutomations:(BOOL)automations;
- (void)setAnyBTLEAccessoryReachable:(BOOL)reachable;
- (void)setAtHomeLevel:(int64_t)level;
- (void)setAutomaticSoftwareUpdateEnabled:(BOOL)enabled;
- (void)setAvailableBSPsCount:(id)count;
- (void)setAvailableBorderRouters:(id)routers;
- (void)setBackingStore:(id)store;
- (void)setCHIPReportHandlerWithSubscriber:(id)subscriber handler:(id)handler;
- (void)setCurrentUser:(id)user;
- (void)setHomeLocation:(int64_t)location;
- (void)setHomeUpdatedToROARAndInformClients;
- (void)setMediaPassword:(id)password;
- (void)setMediaPeerToPeerEnabled:(BOOL)enabled;
- (void)setMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)change;
- (void)setMinimumMediaUserPrivilege:(int64_t)privilege;
- (void)setMinimumNetworkRouterSupportHomeKitVersion:(id)version;
- (void)setName:(id)name;
- (void)setNaturalLightingContext:(id)context;
- (void)setNetworkRouterSupport:(unint64_t)support;
- (void)setNetworkRouterSupportDisableReason:(unint64_t)reason;
- (void)setNfcReaderKey:(id)key;
- (void)setOutgoingInvitations:(id)invitations;
- (void)setOverriddenHomeAccessControl:(id)control;
- (void)setOwner:(id)owner;
- (void)setOwnerTrustZoneCapable:(BOOL)capable;
- (void)setOwnerUser:(BOOL)user;
- (void)setPersonManagerSettings:(id)settings;
- (void)setPrimaryNetworkRouterManagingDeviceUUID:(id)d;
- (void)setPrimaryResidentNetworkInfo:(id)info;
- (void)setProtectionMode:(int64_t)mode;
- (void)setRemoteAccessEnabled:(BOOL)enabled;
- (void)setResidentSelectionVersion:(id)version;
- (void)setRouterClientManager:(id)manager;
- (void)setThreadNetworkID:(id)d;
- (void)setThreadNetworkSequenceNumber:(unint64_t)number;
- (void)setThreadOperationalDataset:(id)dataset;
- (void)setUpFabricForPairingWithCompletion:(id)completion;
- (void)setUpSharedUserFabricDataWithForceFetch:(BOOL)fetch completion:(id)completion;
- (void)setUserActivityStateDetectorManager:(id)manager;
- (void)setWatchSkipVersionCheck:(BOOL)check;
- (void)startReportingSessionForMessage:(id)message;
- (void)startThreadNetwork:(BOOL)network;
- (void)stateObserverStartedMonitoringCharacteristics:(id)characteristics completionHandler:(id)handler;
- (void)stateObserverStoppedMonitoringCharacteristics:(id)characteristics;
- (void)stopThreadAccessoryFirmwareUpdateWithCompletion:(id)completion;
- (void)stopThreadAccessoryPairingWithCompletion:(id)completion;
- (void)stopThreadNetworkWithCompletion:(BOOL)completion completion:(id)a4;
- (void)storeMigrationBulletinBoardNotificationsToDisk;
- (void)storeMigrationCameraNotificationSettingsToDisk;
- (void)storeMigrationCharacteristicsAuthorizationData;
- (void)submitLogEventForCommandResponse:(id)response nodeID:(unint64_t)d endpointID:(id)iD clusterID:(id)clusterID commandID:(id)commandID source:(unint64_t)source error:(id)error;
- (void)submitLogEventForWriteAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId value:(id)value timedWriteTimeout:(id)timeout error:(id)error;
- (void)submitRvcUsageLogEventForNodeID:(unint64_t)d endpointID:(id)iD source:(unint64_t)source error:(id)error;
- (void)subscribeForNotificationsFromRemoteGateway;
- (void)subscribeToAccessoryLanguageSettingsIfNeeded;
- (void)suspendedStateChangedForAccessory:(id)accessory suspendedState:(unint64_t)state;
- (void)test_addActionSets:(id)sets;
- (void)test_addRooms:(id)rooms;
- (void)test_addServiceGroups:(id)groups;
- (void)test_addTriggerOwnedActionSets:(id)sets;
- (void)test_addZones:(id)zones;
- (void)timerDidFire:(id)fire;
- (void)transactionObjectRemoved:(id)removed message:(id)message;
- (void)transactionObjectUpdated:(id)updated newValues:(id)values message:(id)message;
- (void)unconfigure;
- (void)unsetFabricForPairing;
- (void)updateAccessoryBrowsing;
- (void)updateAppData:(id)data identifierKey:(id)key lookup:(id)lookup;
- (void)updateBulletinRegistrationOnPrimaryResidentWithSource:(id)source enableRegistrations:(id)registrations disableRegistration:(id)registration completionHandler:(id)handler;
- (void)updateCATIDsForUsersIfNeeded:(BOOL)needed completion:(id)completion;
- (void)updateEnabledBulletinRegistrations:(id)registrations disabledBulletinRegistrations:(id)bulletinRegistrations source:(id)source context:(id)context completionHandler:(id)handler;
- (void)updateHasOnboardedForWalletKey:(BOOL)key message:(id)message;
- (void)updateHomeConfigurationWithModel:(id)model message:(id)message;
- (void)updateHomeFirstHAPAccessoryAddedDateToNow;
- (void)updateHomeLocation;
- (void)updateHomeLocationForPairing;
- (void)updateLightProfilesSettings:(id)settings;
- (void)updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled:(BOOL)enabled;
- (void)updateLocalUWBOnboardingDismissed:(BOOL)dismissed;
- (void)updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange;
- (void)updateMediaStateWithResponses:(void *)responses requestMessageInformation:;
- (void)updateNetworkConnectivity:(BOOL)connectivity companionReachable:(BOOL)reachable;
- (void)updateNetworkRouterManagingDeviceSettingsWithModel:(id)model message:(id)message;
- (void)updateNetworkRouterSettingsWithModel:(id)model message:(id)message;
- (void)updateROARStatus:(id)status message:(id)message;
- (void)updateThreadOperationalDatasetWithHomeModel:(id)model message:(id)message;
- (void)updateUserCATWithOperatePrivilege:(id)privilege administerPrivilege:(id)administerPrivilege completion:(id)completion;
- (void)userAssistantAccessControlDidUpdate:(id)update accessories:(id)accessories;
- (void)verifyAdaptiveTemperatureAutomationsEnabledHomeShouldSendInvitations:(NSArray *)invitations withQueryController:(HMDIDSIDQueryController *)controller completion:(id)completion;
- (void)writeAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId value:(id)value timedWriteTimeout:(id)timeout completion:(id)completion;
- (void)writeCharacteristicValues:(id)values message:(id)message withCompletionHandler:(id)handler;
- (void)writeCharacteristicValues:(id)values source:(unint64_t)source biomeSource:(unint64_t)biomeSource identifier:(id)identifier transport:(id)transport qualityOfService:(int64_t)service withCompletionHandler:(id)handler;
- (void)writeCharacteristicValues:(id)values source:(unint64_t)source message:(id)message identifier:(id)identifier qualityOfService:(int64_t)service withCompletionHandler:(id)handler;
@end

@implementation HMDHome

- (HMDHomeManager)homeManager
{
  WeakRetained = objc_loadWeakRetained(&self->_homeManager);

  return WeakRetained;
}

- (id)primaryResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];

  return primaryResidentDevice;
}

- (void)canReachPrimaryResidentChanged
{
  selfCopy = self;
  sub_2297A6684();
}

- (void)_clearEventsWithCompletion:(id)completion
{
  v5 = sub_22A4DB7DC();
  v6 = *(v5 - 8);
  v7 = *(v6 + 64);
  v8 = MEMORY[0x28223BE20](v5);
  v9 = &v27 - ((v7 + 15) & 0xFFFFFFFFFFFFFFF0);
  MEMORY[0x28223BE20](v8);
  v11 = &v27 - v10;
  v12 = __swift_instantiateConcreteTypeFromMangledNameV2(&unk_27D87D8F0, &qword_22A578D70);
  v13 = *(*(v12 - 8) + 64);
  MEMORY[0x28223BE20](v12 - 8);
  v15 = &v27 - v14;
  v16 = _Block_copy(completion);
  v17 = swift_allocObject();
  *(v17 + 16) = v16;
  v18 = sub_22A4DD9DC();
  (*(*(v18 - 8) + 56))(v15, 1, 1, v18);
  selfCopy = self;
  spiClientIdentifier = [(HMDHome *)selfCopy spiClientIdentifier];
  sub_22A4DB79C();

  v20 = *(v6 + 32);
  v21 = v5;
  v20(v9, v11, v5);
  v22 = (*(v6 + 80) + 32) & ~*(v6 + 80);
  v23 = v22 + v7;
  v24 = (v22 + v7) & 0xFFFFFFFFFFFFFFF8;
  v25 = swift_allocObject();
  *(v25 + 16) = 0;
  *(v25 + 24) = 0;
  v20((v25 + v22), v9, v21);
  *(v25 + v23) = 1;
  v26 = v25 + v24;
  *(v26 + 8) = sub_2295B994C;
  *(v26 + 16) = v17;

  sub_22957F3C0(0, 0, v15, &unk_22A578F40, v25);
}

- (void)_handleClearActivityHistoryBroadcastMessage:(id)message
{
  messageCopy = message;
  selfCopy = self;
  sub_2295B3164(messageCopy);
}

- (void)_synchronizeHindsightCloudShareManager
{
  selfCopy = self;
  sub_2295B3974();
}

- (void)_broadcastClearActivityHistoryToOwnerDevices
{
  selfCopy = self;
  sub_2295B3A98();
}

- (void)_maybeFixHindsightOnboardingOnCurrentDevice
{
  selfCopy = self;
  sub_2295B44E4();
}

- (void)prepareNewCloudKitZone
{
  ObjectType = swift_getObjectType();
  v4 = sub_22A4DB7DC();
  v5 = *(v4 - 8);
  v6 = *(v5 + 64);
  v7 = MEMORY[0x28223BE20](v4);
  v8 = &v22 - ((v6 + 15) & 0xFFFFFFFFFFFFFFF0);
  MEMORY[0x28223BE20](v7);
  v10 = &v22 - v9;
  v11 = __swift_instantiateConcreteTypeFromMangledNameV2(&unk_27D87D8F0, &qword_22A578D70);
  v12 = *(*(v11 - 8) + 64);
  MEMORY[0x28223BE20](v11 - 8);
  v14 = &v22 - v13;
  v15 = sub_22A4DD9DC();
  (*(*(v15 - 8) + 56))(v14, 1, 1, v15);
  selfCopy = self;
  spiClientIdentifier = [(HMDHome *)selfCopy spiClientIdentifier];
  sub_22A4DB79C();

  v18 = *(v5 + 32);
  v18(v8, v10, v4);
  v19 = (*(v5 + 80) + 32) & ~*(v5 + 80);
  v20 = (v6 + v19 + 7) & 0xFFFFFFFFFFFFFFF8;
  v21 = swift_allocObject();
  *(v21 + 16) = 0;
  *(v21 + 24) = 0;
  v18((v21 + v19), v8, v4);
  *(v21 + v20) = ObjectType;
  sub_22957F3C0(0, 0, v14, &unk_22A578ED8, v21);
}

- (void)registerForPowerAssertionMessages
{
  selfCopy = self;
  sub_22960A164();
}

- (void)handleGetPowerAssertionsWithMessage:(id)message
{
  messageCopy = message;
  selfCopy = self;
  sub_22960A4AC(messageCopy);
}

- (NSArray)lpRooms
{
  selfCopy = self;
  rooms = [(HMDHome *)selfCopy rooms];
  sub_229562F68(0, &unk_2814017A0, off_278666308);
  v4 = sub_22A4DD83C();

  sub_229869E18(v4);

  __swift_instantiateConcreteTypeFromMangledNameV2(&unk_27D881F00, &unk_22A57CB50);
  v5 = sub_22A4DD81C();

  return v5;
}

- (void)isEnergyCurrentlyExpensiveWithCompletion:(id)completion
{
  v5 = __swift_instantiateConcreteTypeFromMangledNameV2(&unk_27D87D8F0, &qword_22A578D70);
  v6 = *(*(v5 - 8) + 64);
  MEMORY[0x28223BE20](v5 - 8);
  v8 = &v15 - v7;
  v9 = _Block_copy(completion);
  v10 = swift_allocObject();
  *(v10 + 16) = v9;
  *(v10 + 24) = self;
  v11 = sub_22A4DD9DC();
  (*(*(v11 - 8) + 56))(v8, 1, 1, v11);
  v12 = swift_allocObject();
  v12[2] = 0;
  v12[3] = 0;
  v12[4] = &unk_22A57DE20;
  v12[5] = v10;
  v13 = swift_allocObject();
  v13[2] = 0;
  v13[3] = 0;
  v13[4] = &unk_22A57B590;
  v13[5] = v12;
  selfCopy = self;
  sub_229859F70(0, 0, v8, &unk_22A581CC0, v13);
}

- (void)handleRoomsSupportingLocalPresenceMessage:(id)message
{
  messageCopy = message;
  selfCopy = self;
  sub_2296F4FE4(messageCopy);
}

- (id)roomUUIDsSupportingLocalPresence
{
  selfCopy = self;
  sub_2296F5280();

  sub_22A4DB7DC();
  sub_2295E9190(&qword_281403880, MEMORY[0x277CC95F0]);
  v3 = sub_22A4DDB5C();

  return v3;
}

- (void)registerForNetworkInfoMessages
{
  selfCopy = self;
  sub_2297271A4();
}

- (void)handleGetPrimaryResidentNetworkInfoWithMessage:(id)message
{
  messageCopy = message;
  selfCopy = self;
  sub_2297275D8(messageCopy);
}

- (void)handleWiFiInfoFetchWithMessage:(id)message
{
  messageCopy = message;
  selfCopy = self;
  sub_229727DF0(messageCopy);
}

- (void)handleNetworkInfoFetchWithMessage:(id)message
{
  messageCopy = message;
  selfCopy = self;
  sub_22972B618(messageCopy);
}

- (void)handleHomeBecameQualifiedForAdaptiveTemperatureAutomations
{
  selfCopy = self;
  sub_229738B40();
}

- (void)verifyAdaptiveTemperatureAutomationsEnabledHomeShouldSendInvitations:(NSArray *)invitations withQueryController:(HMDIDSIDQueryController *)controller completion:(id)completion
{
  v9 = __swift_instantiateConcreteTypeFromMangledNameV2(&unk_27D87D8F0, &qword_22A578D70);
  v10 = *(*(v9 - 8) + 64);
  MEMORY[0x28223BE20](v9 - 8);
  v12 = &v20 - v11;
  v13 = _Block_copy(completion);
  v14 = swift_allocObject();
  v14[2] = invitations;
  v14[3] = controller;
  v14[4] = v13;
  v14[5] = self;
  v15 = sub_22A4DD9DC();
  (*(*(v15 - 8) + 56))(v12, 1, 1, v15);
  v16 = swift_allocObject();
  v16[2] = 0;
  v16[3] = 0;
  v16[4] = &unk_22A581988;
  v16[5] = v14;
  v17 = swift_allocObject();
  v17[2] = 0;
  v17[3] = 0;
  v17[4] = &unk_22A57B590;
  v17[5] = v16;
  invitationsCopy = invitations;
  swift_unknownObjectRetain();
  selfCopy = self;
  sub_229859F70(0, 0, v12, &unk_22A581CC0, v17);
}

- (void)handleHomePresenceUpdate:(id)update
{
  v4 = sub_22A4DB21C();
  v5 = *(v4 - 8);
  v6 = *(v5 + 64);
  MEMORY[0x28223BE20](v4);
  v8 = &v11 - ((v7 + 15) & 0xFFFFFFFFFFFFFFF0);
  sub_22A4DB1DC();
  selfCopy = self;
  v10 = sub_22A4DB1CC();
  [(HMDHome *)selfCopy handleNotificationsForIsAllowedToEnableAdaptiveTemperatureAutomations:v10];

  sub_2297424C4(v8);
  (*(v5 + 8))(v8, v4);
}

- (void)handlePrimaryResidentDidBecomeCurrentDeviceSwiftExtensions
{
  selfCopy = self;
  sub_2297A588C();
}

- (void)handlePrimaryResidentDidBecomeOtherDeviceSwiftExtensions
{
  selfCopy = self;
  sub_2297A63FC();
}

- (HMDActionSetStateSubscriptionManager)actionSetStateSubscriptionManager
{
  selfCopy = self;
  result = [(HMDHome *)selfCopy swiftExtensions];
  if (!result)
  {
    __break(1u);
    goto LABEL_7;
  }

  v4 = result;

  swift_getObjectType();
  result = swift_conformsToProtocol2();
  if (!result)
  {
LABEL_7:
    __break(1u);
    return result;
  }

  v5 = *(v4 + OBJC_IVAR____TtCE13HomeKitDaemonCSo7HMDHomeP33_0B6F54D380C02F3DBB7BB084234D6AED22DefaultSwiftExtensions_actionSetStateSubscriptionManager);
  swift_unknownObjectRelease();

  return v5;
}

- (HMDActionSetStateObserver)actionSetStateObserver
{
  selfCopy = self;
  result = [(HMDHome *)selfCopy swiftExtensions];
  if (!result)
  {
    __break(1u);
    goto LABEL_7;
  }

  v4 = result;

  swift_getObjectType();
  result = swift_conformsToProtocol2();
  if (!result)
  {
LABEL_7:
    __break(1u);
    return result;
  }

  v5 = *(v4 + OBJC_IVAR____TtCE13HomeKitDaemonCSo7HMDHomeP33_0B6F54D380C02F3DBB7BB084234D6AED22DefaultSwiftExtensions_actionSetStateObserver);

  swift_unknownObjectRelease();

  return v5;
}

- (void)newMatterAccessoryFrom:(id)from message:(id)message
{
  fromCopy = from;
  messageCopy = message;
  selfCopy = self;
  sub_2297A7548(fromCopy, message);
}

- (void)handleFetchPresenceMapMessage:(id)message
{
  messageCopy = message;
  selfCopy = self;
  sub_2297A8AF4(messageCopy);
}

- (HMDHomePresenceCheck)homePresence
{
  selfCopy = self;
  v3 = sub_2297A9A28();

  return v3;
}

- (void)submitLogEventForWriteAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId value:(id)value timedWriteTimeout:(id)timeout error:(id)error
{
  endpointIdCopy = endpointId;
  clusterIdCopy = clusterId;
  attributeIdCopy = attributeId;
  swift_unknownObjectRetain();
  selfCopy = self;
  timeoutCopy = timeout;
  errorCopy = error;
  sub_22A4DE01C();
  swift_unknownObjectRelease();
  sub_2297A9CF8(id, endpointIdCopy, clusterIdCopy, attributeIdCopy, v20, timeout, error);

  __swift_destroy_boxed_opaque_existential_0(v20);
}

- (void)submitLogEventForCommandResponse:(id)response nodeID:(unint64_t)d endpointID:(id)iD clusterID:(id)clusterID commandID:(id)commandID source:(unint64_t)source error:(id)error
{
  if (response)
  {
    sub_22A4DD49C();
  }

  iDCopy = iD;
  clusterIDCopy = clusterID;
  commandIDCopy = commandID;
  errorCopy = error;
  selfCopy = self;
  sub_2297AD3C4(d, iDCopy, clusterIDCopy, commandIDCopy, source, error);
}

- (id)resolveReceiverForMessageTargetUUID:(id)d
{
  v4 = sub_22A4DB7DC();
  v5 = *(v4 - 8);
  v6 = *(v5 + 64);
  MEMORY[0x28223BE20](v4);
  v8 = (&v12 - ((v7 + 15) & 0xFFFFFFFFFFFFFFF0));
  sub_22A4DB79C();
  selfCopy = self;
  v10 = sub_2297B0F74(v8);

  (*(v5 + 8))(v8, v4);

  return v10;
}

- (id)preflightCheckLogEventWithSessionIdentifier:(id)identifier accessoryCategory:(id)category fetchDuration:(double)duration firstImportCompleted:(BOOL)completed hasMediaRouteIdentifier:(BOOL)routeIdentifier hasPairingIdentity:(BOOL)identity hasConnectedEventRouterClient:(BOOL)client isCloudSignedIn:(BOOL)self0 hasManatee:(BOOL)self1 isIdsReady:(BOOL)self2 isOwnerUser:(BOOL)self3 homeUUID:(id)self4
{
  identityCopy = identity;
  clientCopy = client;
  completedCopy = completed;
  routeIdentifierCopy = routeIdentifier;
  manateeCopy = manatee;
  readyCopy = ready;
  HIDWORD(v30) = in;
  v18 = sub_22A4DB7DC();
  v19 = *(v18 - 8);
  v20 = *(v19 + 64);
  MEMORY[0x28223BE20](v18);
  v22 = &v30 - ((v21 + 15) & 0xFFFFFFFFFFFFFFF0);
  if (identifier)
  {
    identifier = sub_22A4DD5EC();
    v24 = v23;
    if (category)
    {
LABEL_3:
      v25 = sub_22A4DD5EC();
      category = v26;
      goto LABEL_6;
    }
  }

  else
  {
    v24 = 0;
    if (category)
    {
      goto LABEL_3;
    }
  }

  v25 = 0;
LABEL_6:
  sub_22A4DB79C();
  selfCopy = self;
  v28 = sub_2297ED524(identifier, v24, v25, category, completedCopy, routeIdentifierCopy, identityCopy, clientCopy, duration, BYTE4(v30), manateeCopy, readyCopy, user, v22);

  (*(v19 + 8))(v22, v18);

  return v28;
}

- (BOOL)hasDemoAccessories
{
  selfCopy = self;
  v3 = sub_229814508();

  return v3;
}

- (BOOL)hasDemoPrimaryResident
{
  selfCopy = self;
  primaryResidentDevice = [(HMDResidentDeviceManager *)[(HMDHome *)selfCopy residentDeviceManager] primaryResidentDevice];
  swift_unknownObjectRelease();
  if (primaryResidentDevice)
  {
    isDemoDevice = [primaryResidentDevice isDemoDevice];
  }

  else
  {
    isDemoDevice = 0;
  }

  return isDemoDevice;
}

- (void)deregisterForMessagesInDemoModeV2
{
  selfCopy = self;
  sub_2298146C4();
}

- (id)homeBulletinContext
{
  v10[2] = *MEMORY[0x277D85DE8];
  v9[0] = @"home";
  contextID = [(HMDHome *)self contextID];
  v10[0] = contextID;
  v9[1] = *MEMORY[0x277CCF328];
  contextSPIUniqueIdentifier = [(HMDHome *)self contextSPIUniqueIdentifier];
  uUIDString = [contextSPIUniqueIdentifier UUIDString];
  v10[1] = uUIDString;
  v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v10 forKeys:v9 count:2];

  v7 = *MEMORY[0x277D85DE8];

  return v6;
}

- (NSUUID)contextSPIUniqueIdentifier
{
  v3 = +[HMDProcessInfo privateClientIdentifierSalt];
  v4 = MEMORY[0x277CCAD78];
  uuid = [(HMDHome *)self uuid];
  v6 = [v4 hm_deriveUUIDFromBaseUUID:uuid identifierSalt:v3];

  return v6;
}

- (NSString)contextID
{
  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];

  return uUIDString;
}

- (void)updateHasOnboardedForWalletKey:(BOOL)key message:(id)message
{
  keyCopy = key;
  v32 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if ([(HMDHome *)self hasOnboardedForWalletKey]!= keyCopy)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      [(HMDHome *)selfCopy hasOnboardedForWalletKey];
      v11 = HMFBooleanToString();
      v12 = HMFBooleanToString();
      v24 = 138544130;
      v25 = v10;
      v26 = 2112;
      v27 = v11;
      v28 = 2112;
      v29 = v12;
      v30 = 2112;
      v31 = messageCopy;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Updating has onboarded for wallet key from %@ to %@ with message: %@", &v24, 0x2Au);
    }

    objc_autoreleasePoolPop(v7);
    v13 = [HMDHomeModel alloc];
    uuid = [(HMDHome *)selfCopy uuid];
    homeManager = [(HMDHome *)selfCopy homeManager];
    uuid2 = [homeManager uuid];
    v17 = [(HMDBackingStoreModelObject *)v13 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

    if (keyCopy)
    {
      v18 = MEMORY[0x277CBEC38];
    }

    else
    {
      v18 = MEMORY[0x277CBEC28];
    }

    [(HMDHomeModel *)v17 setHasOnboardedForWalletKey:v18];
    backingStore = [(HMDHome *)selfCopy backingStore];
    name = [messageCopy name];
    v21 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v22 = [backingStore transaction:name options:v21];

    [v22 add:v17 withMessage:messageCopy];
    [v22 run];
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (BOOL)hasPostedWalletKeyOnboardingBulletinForAnyAccessory
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_any:&__block_literal_global_986];

  return v3;
}

uint64_t __70__HMDHome_Wallet__hasPostedWalletKeyOnboardingBulletinForAnyAccessory__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 hasPostedBulletinForWalletKeyOnboarding];

  return v5;
}

- (NSArray)accessoriesWithAliroProvisioning
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_984];

  return v3;
}

id __51__HMDHome_Wallet__accessoriesWithAliroProvisioning__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = 0;
  if ([v4 supportsACWGProvisioning])
  {
    v5 = v4;
  }

  return v5;
}

- (NSArray)accessoriesWithWalletKeySupport
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_982];

  return v3;
}

id __50__HMDHome_Wallet__accessoriesWithWalletKeySupport__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = 0;
  if ([v4 supportsWalletKey])
  {
    v5 = v4;
  }

  return v5;
}

- (BOOL)hasAnyAccessoryWithWalletKeyAndAccessCodeSupport
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_any:&__block_literal_global_978];

  return v3;
}

uint64_t __67__HMDHome_Wallet__hasAnyAccessoryWithWalletKeyAndAccessCodeSupport__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 supportsAccessCode];
  v6 = [v4 supportsWalletKey];

  return v6 & v5;
}

- (BOOL)hasAnyAccessoryWithAliroUWBSupport
{
  v7 = 0;
  v8 = &v7;
  v9 = 0x2020000000;
  v10 = 0;
  backingStore = [(HMDHome *)self backingStore];
  context = [backingStore context];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_Wallet__hasAnyAccessoryWithAliroUWBSupport__block_invoke;
  v6[3] = &unk_27868A688;
  v6[4] = self;
  v6[5] = &v7;
  [context unsafeSynchronousBlock:v6];

  LOBYTE(backingStore) = *(v8 + 24);
  _Block_object_dispose(&v7, 8);
  return backingStore;
}

void __53__HMDHome_Wallet__hasAnyAccessoryWithAliroUWBSupport__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  v4 = [v3 accessories];
  v5 = [v4 na_map:&__block_literal_global_975];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_Wallet__hasAnyAccessoryWithAliroUWBSupport__block_invoke_3;
  v6[3] = &unk_27866DFA0;
  v6[4] = *(a1 + 32);
  *(*(*(a1 + 40) + 8) + 24) = [v5 na_any:v6];
}

uint64_t __53__HMDHome_Wallet__hasAnyAccessoryWithAliroUWBSupport__block_invoke_3(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) currentUser];
  v5 = [v4 restrictedGuestAccessSettings];
  v6 = [v5 schedule];

  v7 = [*(a1 + 32) currentUser];
  if ([(HMDAliroVersion *)v7 isRestrictedGuest])
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (v8)
  {

    goto LABEL_7;
  }

  v14 = [v6 weekDayRules];
  v15 = [v14 count];
  v16 = [v3 weekDayScheduleCapacity];
  if (v15 > [v16 integerValue])
  {

    v17 = 0;
LABEL_15:

    goto LABEL_16;
  }

  v18 = [v6 yearDayRules];
  v19 = [v18 count];
  v20 = [v3 yearDayScheduleCapacity];
  v21 = [v20 integerValue];

  if (v19 <= v21)
  {
LABEL_7:
    v9 = [HMDAliroVersion alloc];
    v10 = [v3 expeditedTransactionSupportedVersions];
    v11 = [v3 bleUWBSupportedVersions];
    v12 = [v3 bleAdvertisingVersion];
    v13 = [HMDAliroVersionUtilities dataFromNumber:v12 error:0];
    if (v13)
    {
      v7 = [(HMDAliroVersion *)v9 initWithExpeditedTransactionSupportedVersions:v10 bleUWBSupportedVersions:v11 bleAdvertisingVersions:v13];
    }

    else
    {
      v22 = [MEMORY[0x277CBEA90] data];
      v7 = [(HMDAliroVersion *)v9 initWithExpeditedTransactionSupportedVersions:v10 bleUWBSupportedVersions:v11 bleAdvertisingVersions:v22];
    }

    v23 = [HMDAliroVersionUtilities isCurrentDeviceCompatibleWithAliroVersion:v7 includeUWBCompatibility:1];
    v14 = [v3 supportsMatCredACB];
    v17 = [v14 BOOLValue] & v23;
    goto LABEL_15;
  }

  v17 = 0;
LABEL_16:

  return v17;
}

void *__53__HMDHome_Wallet__hasAnyAccessoryWithAliroUWBSupport__block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 conformsToProtocol:&unk_283F59838])
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (BOOL)hasAnyAccessoryWithAliroNFCSupport
{
  v7 = 0;
  v8 = &v7;
  v9 = 0x2020000000;
  v10 = 0;
  backingStore = [(HMDHome *)self backingStore];
  context = [backingStore context];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_Wallet__hasAnyAccessoryWithAliroNFCSupport__block_invoke;
  v6[3] = &unk_27868A688;
  v6[4] = self;
  v6[5] = &v7;
  [context unsafeSynchronousBlock:v6];

  LOBYTE(backingStore) = *(v8 + 24);
  _Block_object_dispose(&v7, 8);
  return backingStore;
}

void __53__HMDHome_Wallet__hasAnyAccessoryWithAliroNFCSupport__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  v4 = [v3 accessories];
  v5 = [v4 na_map:&__block_literal_global_970];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_Wallet__hasAnyAccessoryWithAliroNFCSupport__block_invoke_3;
  v6[3] = &unk_27866DFA0;
  v6[4] = *(a1 + 32);
  *(*(*(a1 + 40) + 8) + 24) = [v5 na_any:v6];
}

uint64_t __53__HMDHome_Wallet__hasAnyAccessoryWithAliroNFCSupport__block_invoke_3(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) currentUser];
  v5 = [v4 restrictedGuestAccessSettings];
  v6 = [v5 schedule];

  v7 = [*(a1 + 32) currentUser];
  if ([(HMDAliroVersion *)v7 isRestrictedGuest])
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (v8)
  {

    goto LABEL_7;
  }

  v14 = [v6 weekDayRules];
  v15 = [v14 count];
  v16 = [v3 weekDayScheduleCapacity];
  if (v15 > [v16 integerValue])
  {

    v17 = 0;
LABEL_15:

    goto LABEL_16;
  }

  v18 = [v6 yearDayRules];
  v19 = [v18 count];
  v20 = [v3 yearDayScheduleCapacity];
  v21 = [v20 integerValue];

  if (v19 <= v21)
  {
LABEL_7:
    v9 = [HMDAliroVersion alloc];
    v10 = [v3 expeditedTransactionSupportedVersions];
    v11 = [v3 bleUWBSupportedVersions];
    v12 = [v3 bleAdvertisingVersion];
    v13 = [HMDAliroVersionUtilities dataFromNumber:v12 error:0];
    if (v13)
    {
      v7 = [(HMDAliroVersion *)v9 initWithExpeditedTransactionSupportedVersions:v10 bleUWBSupportedVersions:v11 bleAdvertisingVersions:v13];
    }

    else
    {
      v22 = [MEMORY[0x277CBEA90] data];
      v7 = [(HMDAliroVersion *)v9 initWithExpeditedTransactionSupportedVersions:v10 bleUWBSupportedVersions:v11 bleAdvertisingVersions:v22];
    }

    v23 = [v3 supportsMatCredACB];
    v24 = +[HMDAliroVersionUtilities isCurrentDeviceCompatibleWithAliroVersion:includeUWBCompatibility:](HMDAliroVersionUtilities, "isCurrentDeviceCompatibleWithAliroVersion:includeUWBCompatibility:", v7, [v23 BOOLValue]);

    v14 = [v3 supportsMatCredACP];
    v17 = [v14 BOOLValue] & v24;
    goto LABEL_15;
  }

  v17 = 0;
LABEL_16:

  return v17;
}

void *__53__HMDHome_Wallet__hasAnyAccessoryWithAliroNFCSupport__block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 conformsToProtocol:&unk_283F59838])
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (BOOL)hasAnyAccessoryWithUnifiedAccessWalletKeySupport
{
  v7 = 0;
  v8 = &v7;
  v9 = 0x2020000000;
  v10 = 0;
  backingStore = [(HMDHome *)self backingStore];
  context = [backingStore context];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke;
  v6[3] = &unk_27868A688;
  v6[4] = self;
  v6[5] = &v7;
  [context unsafeSynchronousBlock:v6];

  LOBYTE(backingStore) = *(v8 + 24);
  _Block_object_dispose(&v7, 8);
  return backingStore;
}

void __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  v4 = [v3 accessories];
  v5 = [v4 na_map:&__block_literal_global_2090];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke_3;
  v6[3] = &unk_27866DFA0;
  v6[4] = *(a1 + 32);
  *(*(*(a1 + 40) + 8) + 24) = [v5 na_any:v6];
}

uint64_t __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke_3(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) currentUser];
  v5 = [v4 restrictedGuestAccessSettings];
  v6 = [v5 schedule];

  v7 = [*(a1 + 32) currentUser];
  if ([v7 isRestrictedGuest])
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (v8)
  {
  }

  else
  {
    v13 = [v6 weekDayRules];
    v14 = [v13 count];
    v15 = [v3 weekDayScheduleCapacity];
    if (v14 > [v15 integerValue])
    {

      v12 = 0;
LABEL_14:

      goto LABEL_15;
    }

    v17 = [v6 yearDayRules];
    v18 = [v17 count];
    v19 = [v3 yearDayScheduleCapacity];
    v20 = [v19 integerValue];

    if (v18 > v20)
    {
      v12 = 0;
      goto LABEL_15;
    }
  }

  v9 = [v3 services];
  if (([v9 na_any:&__block_literal_global_963] & 1) == 0)
  {

    goto LABEL_13;
  }

  v10 = [v3 services];
  v11 = [v10 na_any:&__block_literal_global_966];

  if ((v11 & 1) == 0)
  {
LABEL_13:
    v7 = [v3 supportsMatterWalletKey];
    v12 = [v7 BOOLValue];
    goto LABEL_14;
  }

  v12 = 1;
LABEL_15:

  return v12;
}

uint64_t __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke_5(uint64_t a1, void *a2)
{
  v2 = [a2 serviceType];
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"00000266-0000-1000-8000-0026BB765291"];
  v4 = [v2 hmf_isEqualToUUID:v3];

  return v4;
}

uint64_t __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke_4(uint64_t a1, void *a2)
{
  v2 = [a2 serviceType];
  v3 = objc_alloc(MEMORY[0x277CCAD78]);
  v4 = [v3 initWithUUIDString:*MEMORY[0x277CD0EB0]];
  v5 = [v2 hmf_isEqualToUUID:v4];

  return v5;
}

void *__67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 conformsToProtocol:&unk_283F59838])
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (BOOL)hasAnyAccessoryWithWalletKeySupport
{
  if ([(HMDHome *)self hasAnyAccessoryWithUnifiedAccessWalletKeySupport])
  {
    return 1;
  }

  return [(HMDHome *)self hasAnyAccessoryWithAliroNFCSupport];
}

+ (id)nfcIssuerKeyIdentifierWithPairingIdentity:(id)identity
{
  publicKey = [identity publicKey];
  data = [publicKey data];
  v5 = [HMDHomeNFCReaderKey identifierForKey:data];

  return v5;
}

- (id)createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:(id)snapshot operationalKeyPair:(id)pair error:(id *)error
{
  v40 = *MEMORY[0x277D85DE8];
  snapshotCopy = snapshot;
  pairCopy = pair;
  currentDeviceControllerNodeID = [(HMDHome *)self currentDeviceControllerNodeID];
  v10 = [(HMDHome *)self accessoryAdministerPrivilegeCATID:0];
  if (v10)
  {
    v11 = [MEMORY[0x277CBEB98] setWithObject:v10];
    if (!currentDeviceControllerNodeID)
    {
      goto LABEL_6;
    }

LABEL_5:
    if (![currentDeviceControllerNodeID isEqual:&unk_283E71918])
    {
      goto LABEL_7;
    }

    goto LABEL_6;
  }

  v11 = 0;
  if (currentDeviceControllerNodeID)
  {
    goto LABEL_5;
  }

LABEL_6:
  v12 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:{objc_msgSend(MEMORY[0x277D17B90], "randomNodeID")}];

  v13 = [(HMDHome *)self privateDataSourceForNode:v12];
  currentDeviceControllerNodeID = v12;
LABEL_7:
  v14 = objc_autoreleasePoolPush();
  selfCopy = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    HMFGetLogIdentifier();
    v17 = v28 = pairCopy;
    rootCert = [snapshotCopy rootCert];
    fabricID = [snapshotCopy fabricID];
    *buf = 138544386;
    v31 = v17;
    v32 = 2112;
    v33 = currentDeviceControllerNodeID;
    v34 = 2112;
    v35 = v11;
    v36 = 2112;
    v37 = rootCert;
    v38 = 2112;
    v39 = fabricID;
    _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Creating operational certificate for controller node ID %@ CAT %@ root cert %@, fabric ID %@", buf, 0x34u);

    pairCopy = v28;
  }

  objc_autoreleasePoolPop(v14);
  v20 = MEMORY[0x277CD5230];
  rootKeyPair = [snapshotCopy rootKeyPair];
  rootCert2 = [snapshotCopy rootCert];
  publicKey = [pairCopy publicKey];
  fabricID2 = [snapshotCopy fabricID];
  v25 = [v20 createOperationalCertificate:rootKeyPair signingCertificate:rootCert2 operationalPublicKey:publicKey fabricID:fabricID2 nodeID:currentDeviceControllerNodeID caseAuthenticatedTags:v11 error:error];

  v26 = *MEMORY[0x277D85DE8];

  return v25;
}

- (id)fetchOperationalFabricDataWithError:(id *)error
{
  v47 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [(HMDHome *)self storedFabricDataWithError:error];
    if (*error)
    {
      v6 = objc_autoreleasePoolPush();
      selfCopy = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = HMFGetLogIdentifier();
        v10 = *error;
        v43 = 138543618;
        v44 = v9;
        v45 = 2112;
        v46 = v10;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data from local storage: %@", &v43, 0x16u);
      }

      objc_autoreleasePoolPop(v6);
      storedSharedHomeFabricData = 0;
      goto LABEL_39;
    }

    if ([(HMDHome *)self isCurrentDevicePrimaryResident])
    {
      residentOperationalCert = [v5 residentOperationalCert];
      residentOperationalKeyPair = [v5 residentOperationalKeyPair];
      goto LABEL_20;
    }

    if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
    {
      residentOperationalKeyPair = [(HMDHome *)self storedOperationalKeyPair];
      if (residentOperationalKeyPair)
      {
        residentOperationalCert = [(HMDHome *)self createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:v5 operationalKeyPair:residentOperationalKeyPair error:error];
        if (*error)
        {
          v18 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v20 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
          {
            v21 = HMFGetLogIdentifier();
            v22 = *error;
            v43 = 138543618;
            v44 = v21;
            v45 = 2112;
            v46 = v22;
            _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data due to cert generation failure: %@", &v43, 0x16u);
          }

          objc_autoreleasePoolPop(v18);
          storedSharedHomeFabricData = 0;
          goto LABEL_38;
        }

LABEL_20:
        rootCert = [v5 rootCert];

        if (rootCert)
        {
          if (residentOperationalCert)
          {
            goto LABEL_22;
          }
        }

        else
        {
          v24 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v26 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
          {
            v27 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v27;
            _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while root cert is missing from storage", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          if (residentOperationalCert)
          {
LABEL_22:
            if (residentOperationalKeyPair)
            {
LABEL_33:
              rootCert2 = [v5 rootCert];

              if (residentOperationalKeyPair && residentOperationalCert && rootCert2)
              {
                v37 = objc_alloc(MEMORY[0x277D17B58]);
                rootCert3 = [v5 rootCert];
                v39 = [v5 ipk];
                residentNodeID = [v5 residentNodeID];
                storedSharedHomeFabricData = [v37 initWithRootCert:rootCert3 ipk:v39 residentNodeID:residentNodeID operationalCert:residentOperationalCert operationalKeyPair:residentOperationalKeyPair];
              }

              else
              {
                [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
                *error = storedSharedHomeFabricData = 0;
              }

LABEL_38:

LABEL_39:
              goto LABEL_40;
            }

LABEL_30:
            v32 = objc_autoreleasePoolPush();
            selfCopy4 = self;
            v34 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
            {
              v35 = HMFGetLogIdentifier();
              v43 = 138543362;
              v44 = v35;
              _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while operational key pair is missing", &v43, 0xCu);
            }

            objc_autoreleasePoolPop(v32);
            goto LABEL_33;
          }
        }

        v28 = objc_autoreleasePoolPush();
        selfCopy5 = self;
        v30 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
        {
          v31 = HMFGetLogIdentifier();
          v43 = 138543362;
          v44 = v31;
          _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while operational cert is missing from storage", &v43, 0xCu);
        }

        objc_autoreleasePoolPop(v28);
        if (residentOperationalKeyPair)
        {
          goto LABEL_33;
        }

        goto LABEL_30;
      }
    }

    else
    {
      residentOperationalKeyPair = 0;
    }

    residentOperationalCert = 0;
    goto LABEL_20;
  }

  storedSharedHomeFabricData = [(HMDHome *)self storedSharedHomeFabricData];
  if (!storedSharedHomeFabricData)
  {
    *error = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
    v12 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v43 = 138543362;
      v44 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@No stored operational fabric data", &v43, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    storedSharedHomeFabricData = 0;
  }

LABEL_40:
  v41 = *MEMORY[0x277D85DE8];

  return storedSharedHomeFabricData;
}

void __102__HMDHome_CHIP__fetchOrCreateFabricDataForPairingWithOperationalKeyPair_fetchFromResident_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, void *a6)
{
  v65 = *MEMORY[0x277D85DE8];
  v11 = a2;
  v55 = a3;
  v12 = a4;
  v13 = a5;
  v14 = a6;
  if (!v14)
  {
    v19 = *(a1 + 32);
    v56 = 0;
    v20 = [v19 storedFabricDataWithError:&v56];
    v54 = v56;
    if (v54)
    {
      v21 = objc_autoreleasePoolPush();
      v22 = *(a1 + 32);
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v25 = v24 = v11;
        *buf = 138543618;
        v58 = v25;
        v59 = 2112;
        v60 = v54;
        _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@No stored fabric data for pairing: %@", buf, 0x16u);

        v11 = v24;
      }

      objc_autoreleasePoolPop(v21);
    }

    v53 = v11;
    v26 = [objc_alloc(MEMORY[0x277D17B58]) initWithRootCert:v11 ipk:v13 residentNodeID:v12 operationalCert:v55 operationalKeyPair:*(a1 + 40)];
    v27 = [v26 fabricID];

    if (!v27)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = *(a1 + 32);
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v36 = v51 = v33;
        *buf = 138543362;
        v58 = v36;
        _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Fabric data for pairing fetched from a resident is corrupt", buf, 0xCu);

        v33 = v51;
      }

      objc_autoreleasePoolPop(v33);
      v37 = *(a1 + 48);
      v38 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
      (*(v37 + 16))(v37, 0, 0, v38);

      goto LABEL_22;
    }

    v28 = [v20 rootKeyPair];
    if (v28)
    {
      v29 = v28;
      v30 = [v20 rootCert];
      if (v30)
      {
        v31 = v30;
        v32 = [v20 fabricID];

        if (v32)
        {
LABEL_21:
          (*(*(a1 + 48) + 16))();
LABEL_22:
          v11 = v53;

          goto LABEL_23;
        }
      }

      else
      {
      }
    }

    v39 = objc_autoreleasePoolPush();
    v40 = *(a1 + 32);
    v41 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v42 = v50 = v26;
      v48 = [v20 rootKeyPair];
      HMFBooleanToString();
      v43 = v49 = v40;
      v47 = [v20 rootCert];
      v44 = HMFBooleanToString();
      [v20 fabricID];
      v45 = v52 = v39;
      *buf = 138544130;
      v58 = v42;
      v59 = 2112;
      v60 = v43;
      v61 = 2112;
      v62 = v44;
      v63 = 2112;
      v64 = v45;
      _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Stored fabric data insufficient for pairing: rootKeyPair %@, rootCert %@, fabricID %@", buf, 0x2Au);

      v39 = v52;
      v40 = v49;

      v26 = v50;
    }

    objc_autoreleasePoolPop(v39);
    v20 = 0;
    goto LABEL_21;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = *(a1 + 32);
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
  {
    v18 = HMFGetLogIdentifier();
    *buf = 138543618;
    v58 = v18;
    v59 = 2112;
    v60 = v14;
    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch fabric data for pairing from resident: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v15);
  (*(*(a1 + 48) + 16))();
LABEL_23:

  v46 = *MEMORY[0x277D85DE8];
}

- (void)fetchFabricDataForPairingWithCompletion:(id)completion
{
  v81 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if (![(HMDHome *)self hasAnyResident])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      fabric = [(HMDHome *)self fabric];

      if (fabric)
      {
        operationalKeyPairForPairing = [(HMDHome *)self operationalKeyPairForPairing];
        v65[0] = MEMORY[0x277D85DD0];
        v65[1] = 3221225472;
        v65[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_413;
        v65[3] = &unk_27866EF88;
        v65[4] = self;
        v66 = completionCopy;
        [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:operationalKeyPairForPairing fetchFromResident:0 completion:v65];

        v13 = v66;
        goto LABEL_10;
      }
    }

    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v74 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot fetch fabric data for pairing without a resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    initUnassociated = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    (*(completionCopy + 2))(completionCopy, 0, 0, initUnassociated);
    goto LABEL_18;
  }

  primaryResident = [(HMDHome *)self primaryResident];
  if (primaryResident)
  {
    v6 = primaryResident;
    primaryResident2 = [(HMDHome *)self primaryResident];
    capabilities = [primaryResident2 capabilities];

    if (capabilities)
    {
      if ([(HMDHome *)self isOwnerUser])
      {
        primaryResident3 = [(HMDHome *)self primaryResident];
        capabilities2 = [primaryResident3 capabilities];
        supportsMatterOwnerCertFetch = [capabilities2 supportsMatterOwnerCertFetch];

        if (supportsMatterOwnerCertFetch)
        {
          operationalKeyPairForPairing2 = [(HMDHome *)self operationalKeyPairForPairing];
          v69[0] = MEMORY[0x277D85DD0];
          v69[1] = 3221225472;
          v69[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_2;
          v69[3] = &unk_27866F1A0;
          v70 = completionCopy;
          [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:operationalKeyPairForPairing2 fetchFromResident:1 completion:v69];

          v13 = v70;
LABEL_10:

          goto LABEL_19;
        }

        v68 = 0;
        v29 = [(HMDHome *)self storedFabricDataWithError:&v68];
        v30 = v68;
        if (v30)
        {
          v31 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v74 = v34;
            v75 = 2112;
            v76 = v30;
            _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Could to retrieve stored fabric data for pairing: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          (*(completionCopy + 2))(completionCopy, 0, 0, v30);
LABEL_35:

          goto LABEL_19;
        }

        residentOperationalKeyPair = [v29 residentOperationalKeyPair];
        if (!residentOperationalKeyPair)
        {
          goto LABEL_32;
        }

        v36 = residentOperationalKeyPair;
        rootKeyPair = [v29 rootKeyPair];
        if (rootKeyPair)
        {
          v38 = rootKeyPair;
          rootCert = [v29 rootCert];
          if (rootCert)
          {
            v40 = rootCert;
            fabricID = [v29 fabricID];

            if (fabricID)
            {
              residentOperationalKeyPair2 = [v29 residentOperationalKeyPair];
              v67 = 0;
              v43 = [(HMDHome *)self createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:v29 operationalKeyPair:residentOperationalKeyPair2 error:&v67];
              v44 = v67;
              if (v43)
              {
                v45 = objc_alloc(MEMORY[0x277D17B58]);
                rootCert2 = [v29 rootCert];
                v47 = [v29 ipk];
                residentNodeID = [v29 residentNodeID];
                v49 = [v45 initWithRootCert:rootCert2 ipk:v47 residentNodeID:residentNodeID operationalCert:v43 operationalKeyPair:residentOperationalKeyPair2];

                (*(completionCopy + 2))(completionCopy, v49, 0, 0);
              }

              else
              {
                v58 = objc_autoreleasePoolPush();
                selfCopy3 = self;
                v60 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v60, OS_LOG_TYPE_ERROR))
                {
                  v61 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v74 = v61;
                  v75 = 2112;
                  v76 = v44;
                  _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_ERROR, "%{public}@Could not generate operational certificate for pairing: %@", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v58);
                (*(completionCopy + 2))(completionCopy, 0, 0, v44);
              }

              goto LABEL_19;
            }

LABEL_32:
            v50 = objc_autoreleasePoolPush();
            selfCopy4 = self;
            v52 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
            {
              v53 = HMFGetLogIdentifier();
              rootKeyPair2 = [v29 rootKeyPair];
              v54 = HMFBooleanToString();
              rootCert3 = [v29 rootCert];
              HMFBooleanToString();
              v55 = v64 = v50;
              fabricID2 = [v29 fabricID];
              *buf = 138544130;
              v74 = v53;
              v75 = 2112;
              v76 = v54;
              v77 = 2112;
              v78 = v55;
              v79 = 2112;
              v80 = fabricID2;
              _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@Stored fabric data insufficient for pairing: rootKeyPair %@, rootCert %@, fabricID %@", buf, 0x2Au);

              v50 = v64;
            }

            objc_autoreleasePoolPop(v50);
            v57 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
            (*(completionCopy + 2))(completionCopy, 0, 0, v57);

            goto LABEL_35;
          }
        }

        goto LABEL_32;
      }

      initUnassociated = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
      v71[0] = MEMORY[0x277D85DD0];
      v71[1] = 3221225472;
      v71[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke;
      v71[3] = &unk_27866EF88;
      v71[4] = self;
      v72 = completionCopy;
      [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:initUnassociated fetchFromResident:1 completion:v71];

LABEL_18:
      goto LABEL_19;
    }
  }

  v21 = objc_autoreleasePoolPush();
  selfCopy5 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    *buf = 138543362;
    v74 = v24;
    _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Cannot fetch fabric data for pairing when a primary resident is unreachable", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  v25 = MEMORY[0x277CCA9B8];
  v26 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
  v27 = [v25 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v26];
  (*(completionCopy + 2))(completionCopy, 0, 0, v27);

LABEL_19:
  v28 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke(uint64_t a1, void *a2, uint64_t a3, void *a4)
{
  v7 = a2;
  v6 = a4;
  if (v7)
  {
    [*(a1 + 32) storeSharedHomeFabricData:v7];
  }

  (*(*(a1 + 40) + 16))();
}

void __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_413(uint64_t a1, void *a2, void *a3, void *a4)
{
  v24 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  if (v8 | v9)
  {
    v10 = v9;
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Cannot use fetched operational fabric data without stored fabric data for owner local pairing", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];

    v7 = 0;
  }

  v15 = MEMORY[0x277CD5230];
  v16 = [v8 residentOperationalKeyPair];
  v17 = [v7 operationalCert];
  LODWORD(v15) = [v15 keypair:v16 matchesCertificate:v17];

  if (v15)
  {
    v18 = *(a1 + 32);
    v19 = [v7 operationalNodeID];
    v20 = [v18 privateDataSourceForNode:v19];
  }

  (*(*(a1 + 40) + 16))();

  v21 = *MEMORY[0x277D85DE8];
}

- (void)clearAccessoryServerBrowserOperationalFabricData
{
  homeManager = [(HMDHome *)self homeManager];
  accessoryBrowser = [homeManager accessoryBrowser];
  chipAccessoryServerBrowser = [accessoryBrowser chipAccessoryServerBrowser];
  targetFabricUUID = [(HMDHome *)self targetFabricUUID];
  [chipAccessoryServerBrowser clearOperationalFabricDataForTargetFabricUUID:targetFabricUUID];
}

- (BOOL)setUpAccessoryServerBrowserWithOperationalFabricData:(id)data ownerDataSnapshot:(id)snapshot error:(id *)error
{
  v54 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  snapshotCopy = snapshot;
  v9 = objc_alloc(MEMORY[0x277D17B50]);
  if (snapshotCopy)
  {
    rootKeyPair = [snapshotCopy rootKeyPair];
    rootCert = [dataCopy rootCert];
    fabricID = [dataCopy fabricID];
    v13 = [v9 initWithRootKeyPair:rootKeyPair rootCertificate:rootCert fabricID:fabricID];
  }

  else
  {
    rootKeyPair = [dataCopy fabricID];
    v13 = [v9 initWithRemoteDelegate:self fabricID:rootKeyPair];
  }

  targetFabricUUID = [(HMDHome *)self targetFabricUUID];
  homeManager = [(HMDHome *)self homeManager];
  chipDataSource = [homeManager chipDataSource];
  allTargetFabricUUIDs = [chipDataSource allTargetFabricUUIDs];

  operationalNodeID = [dataCopy operationalNodeID];
  v19 = [(HMDHome *)self privateDataSourceForNode:operationalNodeID];

  isFeatureMatterLocalFabricConfigEnabled = [(HMDHome *)self isFeatureMatterLocalFabricConfigEnabled];
  if (v19)
  {
    LODWORD(chipAccessoryServerBrowser) = 0;
  }

  else
  {
    LODWORD(chipAccessoryServerBrowser) = isFeatureMatterLocalFabricConfigEnabled;
  }

  if (chipAccessoryServerBrowser == 1)
  {
    v40 = allTargetFabricUUIDs;
    v22 = objc_autoreleasePoolPush();
    selfCopy = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v25 = chipAccessoryServerBrowser = v13;
      *buf = 138543362;
      v47 = v25;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Cannot set up operational fabric data without private data source", buf, 0xCu);

      v13 = chipAccessoryServerBrowser;
      LOBYTE(chipAccessoryServerBrowser) = 1;
    }

    objc_autoreleasePoolPop(v22);
    *error = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
    allTargetFabricUUIDs = v40;
  }

  else
  {
    rootKeyPair2 = [snapshotCopy rootKeyPair];

    if (rootKeyPair2)
    {
      rootKeyPair3 = [snapshotCopy rootKeyPair];
      v45 = SecKeyCopyExternalRepresentation([rootKeyPair3 publicKey], 0);
    }

    else
    {
      v45 = 0;
    }

    v42 = v13;
    v43 = targetFabricUUID;
    if ([(HMDHome *)self isCurrentDevicePrimaryResident])
    {
      matterAccessories = [(HMDHome *)self matterAccessories];
      v29 = [matterAccessories na_map:&__block_literal_global_410];
      v39 = [v29 na_filter:&__block_literal_global_412];
    }

    else
    {
      v39 = 0;
    }

    v41 = chipAccessoryServerBrowser;
    v30 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      v33 = HMFGetLogIdentifier();
      v34 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[__CFData hash](v45, "hash")}];
      *buf = 138544130;
      v47 = v33;
      v48 = 2112;
      v49 = dataCopy;
      v50 = 2112;
      v51 = v43;
      v52 = 2112;
      v53 = v34;
      _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Setting operational fabric data %@ for target fabric UUID %@, signing key: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v30);
    accessoryBrowser = [homeManager accessoryBrowser];
    chipAccessoryServerBrowser = [accessoryBrowser chipAccessoryServerBrowser];
    uuid = [(HMDHome *)selfCopy2 uuid];
    v13 = v42;
    [chipAccessoryServerBrowser setOperationalFabricData:dataCopy operationalCertIssuer:v42 storageDataSource:v19 allTargetFabricUUIDs:allTargetFabricUUIDs entityIdentifier:uuid accessoryServerNodeIDs:v39 forTargetFabricUUID:v43];

    targetFabricUUID = v43;
    LOBYTE(chipAccessoryServerBrowser) = v41;
  }

  v37 = *MEMORY[0x277D85DE8];
  return chipAccessoryServerBrowser ^ 1;
}

- (id)storedSharedHomeFabricData
{
  v3 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  uuid = [(HMDHome *)self uuid];
  iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v3 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

  fabricData = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v6 fabricData];

  return fabricData;
}

- (void)removeSharedHomeFabricData
{
  v3 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  uuid = [(HMDHome *)self uuid];
  iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v3 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

  [(HMDCHIPSharedHomeKeychainFabricDataStore *)v6 removeFabricData];
}

- (BOOL)storeSharedHomeFabricData:(id)data
{
  dataCopy = data;
  v5 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  uuid = [(HMDHome *)self uuid];
  iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
  v8 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v5 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

  LOBYTE(iCloudIdentifier) = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v8 storeFabricData:dataCopy];
  return iCloudIdentifier;
}

- (BOOL)auditStorageWithFabricData:(id)data
{
  v40 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  fabricID = [dataCopy fabricID];
  if (fabricID)
  {
    v6 = fabricID;
    fabricID2 = [dataCopy fabricID];
    v8 = [fabricID2 isEqual:&unk_283E71918];

    if (!v8)
    {
      fabricDataInLegacyStorage = [(HMDHome *)self fabricDataInLegacyStorage];
      rootCert = [fabricDataInLegacyStorage rootCert];
      if (!rootCert)
      {
        goto LABEL_15;
      }

      v17 = rootCert;
      residentOperationalCert = [fabricDataInLegacyStorage residentOperationalCert];
      if (residentOperationalCert)
      {
        v19 = residentOperationalCert;
        v20 = MEMORY[0x277CD5230];
        rootCert2 = [fabricDataInLegacyStorage rootCert];
        rootCert3 = [dataCopy rootCert];
        if ([v20 isCertificate:rootCert2 equalTo:rootCert3])
        {
          v23 = MEMORY[0x277CD5230];
          residentOperationalCert2 = [fabricDataInLegacyStorage residentOperationalCert];
          residentOperationalCert3 = [dataCopy residentOperationalCert];
          if ([v23 isCertificate:residentOperationalCert2 equalTo:residentOperationalCert3])
          {
            [fabricDataInLegacyStorage ipk];
            v26 = v34 = residentOperationalCert2;
            v27 = [dataCopy ipk];
            v35 = [v26 isEqual:v27];

            if (v35)
            {
              v14 = 1;
LABEL_18:

              goto LABEL_19;
            }

LABEL_15:
            v28 = objc_autoreleasePoolPush();
            selfCopy = self;
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
            {
              v31 = HMFGetLogIdentifier();
              *buf = 138543362;
              v37 = v31;
              _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Updating fabric data in legacy storage", buf, 0xCu);
            }

            objc_autoreleasePoolPop(v28);
            v14 = [(HMDHome *)selfCopy storeIntoLegacyStorageWithFabricData:dataCopy];
            goto LABEL_18;
          }
        }
      }

      goto LABEL_15;
    }
  }

  v9 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
  {
    v12 = HMFGetLogIdentifier();
    fabricID3 = [dataCopy fabricID];
    *buf = 138543618;
    v37 = v12;
    v38 = 2112;
    v39 = fabricID3;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot audit storage with invalid fabricID: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = 0;
LABEL_19:

  v32 = *MEMORY[0x277D85DE8];
  return v14;
}

- (BOOL)storeIntoLegacyStorageWithFabricData:(id)data
{
  dataCopy = data;
  v5 = [HMDCHIPHomeDataSource alloc];
  fabricID = [dataCopy fabricID];
  v7 = [(HMDCHIPHomeDataSource *)v5 initWithFabricID:fabricID home:self];

  v8 = objc_alloc_init(MEMORY[0x277D17B00]);
  v9 = objc_alloc_init(MEMORY[0x277D17B40]);
  v10 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:dataCopy chipStorageDelegate:v7 keychainDelegate:v8 v2FabricDataStoreDelegate:v9];

  LOBYTE(dataCopy) = [v10 commit];
  return dataCopy;
}

- (id)fabricDataInLegacyStorage
{
  v3 = [HMDCHIPHomeDataSource alloc];
  matterFabricID = [(HMDHome *)self matterFabricID];
  v5 = [(HMDCHIPHomeDataSource *)v3 initWithFabricID:matterFabricID home:self];

  v6 = objc_alloc_init(MEMORY[0x277D17B00]);
  v7 = objc_alloc_init(MEMORY[0x277D17B30]);
  v8 = [objc_alloc(MEMORY[0x277D17B28]) initWithCHIPStorageDelegate:v5 keychainDelegate:v6 v2FabricDataStoreDelegate:v7];
  v11 = 0;
  v9 = [v8 locallyStoredFabricDataWithDataPresentInV2FabricDataStore:0 error:&v11];

  return v9;
}

- (BOOL)storeNewFabricData:(id)data
{
  v30 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  fabricID = [dataCopy fabricID];
  if (fabricID && (v6 = fabricID, [dataCopy fabricID], v7 = objc_claimAutoreleasedReturnValue(), v8 = objc_msgSend(v7, "isEqual:", &unk_283E71918), v7, v6, !v8))
  {
    v15 = [HMDCHIPHomeDataSource alloc];
    fabricID2 = [dataCopy fabricID];
    v17 = [(HMDCHIPHomeDataSource *)v15 initWithFabricID:fabricID2 home:self];

    v18 = objc_alloc_init(MEMORY[0x277D17B00]);
    v19 = [HMDCHIPHomeKeychainFabricData alloc];
    uuid = [(HMDHome *)self uuid];
    iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
    v22 = [(HMDCHIPHomeKeychainFabricData *)v19 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

    v23 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:dataCopy chipStorageDelegate:v17 keychainDelegate:v18 v2FabricDataStoreDelegate:v22];
    commit = [v23 commit];
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      fabricID3 = [dataCopy fabricID];
      v26 = 138543618;
      v27 = v12;
      v28 = 2112;
      v29 = fabricID3;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot store new fabric data with invalid fabricID: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    commit = 0;
  }

  v24 = *MEMORY[0x277D85DE8];
  return commit;
}

- (id)newFabricData
{
  v19 = *MEMORY[0x277D85DE8];
  matterFabricID = [(HMDHome *)self matterFabricID];
  if (matterFabricID)
  {
    v4 = matterFabricID;
  }

  else
  {
    v4 = &unk_283E71918;
  }

  v5 = [[HMDCHIPHomeDataSource alloc] initWithFabricID:v4 home:self];
  v6 = objc_alloc_init(MEMORY[0x277D17B00]);
  v7 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:v5 keychainDelegate:v6];
  newFabricData = [v7 newFabricData];
  if (!newFabricData)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v13;
      v14 = "%{public}@Failed to create new fabric data";
LABEL_11:
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, v14, &v17, 0xCu);
    }

LABEL_12:

    objc_autoreleasePoolPop(v10);
    v9 = 0;
    goto LABEL_13;
  }

  if (![(HMDHome *)self storeNewFabricData:newFabricData])
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v13;
      v14 = "%{public}@Failed to store newly created fabric data";
      goto LABEL_11;
    }

    goto LABEL_12;
  }

  v9 = newFabricData;
LABEL_13:

  v15 = *MEMORY[0x277D85DE8];
  return v9;
}

- (id)storedFabricDataWithDataPresentInV2FabricDataStore:(BOOL *)store error:(id *)error
{
  matterFabricID = [(HMDHome *)self matterFabricID];
  if (matterFabricID)
  {
    v8 = matterFabricID;
  }

  else
  {
    v8 = &unk_283E71918;
  }

  v9 = [[HMDCHIPHomeDataSource alloc] initWithFabricID:v8 home:self];
  v10 = objc_alloc_init(MEMORY[0x277D17B00]);
  v11 = [HMDCHIPHomeKeychainFabricData alloc];
  uuid = [(HMDHome *)self uuid];
  iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
  v14 = [(HMDCHIPHomeKeychainFabricData *)v11 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

  v15 = [objc_alloc(MEMORY[0x277D17B28]) initWithCHIPStorageDelegate:v9 keychainDelegate:v10 v2FabricDataStoreDelegate:v14];
  v16 = [v15 locallyStoredFabricDataWithDataPresentInV2FabricDataStore:store error:error];

  return v16;
}

- (id)iCloudIdentifier
{
  homeManager = [(HMDHome *)self homeManager];
  appleAccountManager = [homeManager appleAccountManager];

  if (![appleAccountManager isLoggedInToPrimaryAccount] || (objc_msgSend(appleAccountManager, "accountContext"), v4 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v4, "identifier"), v5 = objc_claimAutoreleasedReturnValue(), v4, !v5))
  {
    v5 = @"NOT-LOGGED-IN";
    v6 = @"NOT-LOGGED-IN";
  }

  return v5;
}

- (id)storedOperationalKeyPair
{
  v21 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isOwnerUser])
  {
    v16 = 0;
    v3 = [(HMDHome *)self storedFabricDataWithError:&v16];
    v4 = v16;
    if (!v3)
    {
      v5 = objc_autoreleasePoolPush();
      selfCopy = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v8;
        v19 = 2112;
        v20 = v4;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Failed to fetch sstored operational key pair, which may happen when owner never created the key: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v5);
    }

    residentOperationalKeyPair = [v3 residentOperationalKeyPair];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Unexpected call to storedOperationalKeyPair for shared user", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    residentOperationalKeyPair = 0;
  }

  v14 = *MEMORY[0x277D85DE8];

  return residentOperationalKeyPair;
}

- (id)operationalKeyPairForPairing
{
  storedOperationalKeyPair = [(HMDHome *)self storedOperationalKeyPair];
  if (!storedOperationalKeyPair)
  {
    storedOperationalKeyPair = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
  }

  return storedOperationalKeyPair;
}

- (id)matterPathWithUUID:(id)d
{
  dCopy = d;
  matterAccessories = [(HMDHome *)self matterAccessories];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __36__HMDHome_CHIP__matterPathWithUUID___block_invoke;
  v10[3] = &unk_27866F158;
  v11 = dCopy;
  v6 = dCopy;
  v7 = [matterAccessories na_map:v10];
  firstObject = [v7 firstObject];

  return firstObject;
}

id __36__HMDHome_CHIP__matterPathWithUUID___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 matterAdapter];
  v4 = [v3 matterPathWithUUID:*(a1 + 32)];

  return v4;
}

- (BOOL)isPrimaryResidentNodeReachable
{
  primaryResident = [(HMDHome *)self primaryResident];
  isReachable = [primaryResident isReachable];

  return isReachable;
}

- (id)currentDeviceControllerNodeID
{
  controllerPrivateStorage = [(HMDHome *)self controllerPrivateStorage];
  cachedLocalControllerNodeID = [controllerPrivateStorage cachedLocalControllerNodeID];

  return cachedLocalControllerNodeID;
}

- (id)privateDataSourceForNode:(id)node
{
  nodeCopy = node;
  controllerPrivateStorage = [(HMDHome *)self controllerPrivateStorage];
  v6 = [controllerPrivateStorage privateDataSourceForControllerNodeID:nodeCopy];

  return v6;
}

- (BOOL)areAllThreadResidentNodesUnreachable
{
  enabledResidents = [(HMDHome *)self enabledResidents];
  v3 = [enabledResidents na_allObjectsPassTest:&__block_literal_global_402_8947];

  return v3;
}

uint64_t __53__HMDHome_CHIP__areAllThreadResidentNodesUnreachable__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 capabilities];
  if ([v3 supportsThreadBorderRouter])
  {
    v4 = [v2 isReachable] ^ 1;
  }

  else
  {
    v4 = 1;
  }

  return v4;
}

- (void)updateUserCATWithOperatePrivilege:(id)privilege administerPrivilege:(id)administerPrivilege completion:(id)completion
{
  privilegeCopy = privilege;
  administerPrivilegeCopy = administerPrivilege;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __82__HMDHome_CHIP__updateUserCATWithOperatePrivilege_administerPrivilege_completion___block_invoke;
  v15[3] = &unk_278689AB8;
  v15[4] = self;
  v16 = privilegeCopy;
  v17 = administerPrivilegeCopy;
  v18 = completionCopy;
  v12 = completionCopy;
  v13 = administerPrivilegeCopy;
  v14 = privilegeCopy;
  dispatch_async(workQueue, v15);
}

void __82__HMDHome_CHIP__updateUserCATWithOperatePrivilege_administerPrivilege_completion___block_invoke(uint64_t a1)
{
  v1 = a1;
  v48 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) backingStore];
  v3 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v33 = [v2 transaction:@"UpdatingUserCATIDs" options:v3];

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v4 = [*(v1 + 32) users];
  v5 = [v4 countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v5)
  {

    goto LABEL_23;
  }

  v7 = v5;
  v8 = 0;
  v9 = *v36;
  v34 = (v1 + 48);
  v32 = v1;
  v10 = (v1 + 40);
  *&v6 = 138544130;
  v29 = v6;
  v31 = v4;
  do
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(v4);
      }

      v12 = *(*(&v35 + 1) + 8 * i);
      v13 = [v12 privilege];
      if (v13 != 4)
      {
        if (v13 == 3)
        {
          if (!*v34)
          {
            continue;
          }

          v17 = [v12 matterCASEAuthenticatedTagID];
          v18 = [v17 isEqual:*v34];

          v16 = v34;
          if (v18)
          {
            continue;
          }

          goto LABEL_14;
        }

        if (v13)
        {
          continue;
        }
      }

      if (!*v10)
      {
        continue;
      }

      v14 = [v12 matterCASEAuthenticatedTagID];
      v15 = [v14 isEqual:*v10];

      v16 = v10;
      if (v15)
      {
        continue;
      }

LABEL_14:
      v19 = *v16;
      if (v19)
      {
        v20 = v19;
        v21 = [v12 newModelWithChangeType:2];
        [v21 setMatterCASEAuthenticatedTagID:v20];
        [v33 add:v21];
        v22 = objc_autoreleasePoolPush();
        v23 = *(v32 + 32);
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v25 = v30 = v22;
          v26 = [v20 integerValue];
          *buf = v29;
          v40 = v25;
          v41 = 2112;
          v42 = v12;
          v43 = 2048;
          v44 = v26;
          v45 = 2112;
          v46 = v20;
          _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Updated CATID transaction for user %@ to 0x%lX (%@)", buf, 0x2Au);

          v22 = v30;
        }

        objc_autoreleasePoolPop(v22);
        v8 = 1;
        v4 = v31;
      }
    }

    v7 = [v4 countByEnumeratingWithState:&v35 objects:v47 count:16];
  }

  while (v7);

  v1 = v32;
  if (v8)
  {
    [v33 run:*(v32 + 56)];
    goto LABEL_25;
  }

LABEL_23:
  v27 = *(v1 + 56);
  if (v27)
  {
    (*(v27 + 16))(v27, 0);
  }

LABEL_25:

  v28 = *MEMORY[0x277D85DE8];
}

- (void)incrementOperatePrivilegeCATVersion:(id)version
{
  v20 = *MEMORY[0x277D85DE8];
  versionCopy = version;
  v5 = [(HMDHome *)self accessoryOperatePrivilegeCATID:1];
  v13 = 0;
  [MEMORY[0x277D17B90] parseCaseAuthenticatedTag:v5 identifier:&v13 + 2 version:&v13];
  v6 = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:HIWORD(v13) version:(v13 + 1)];
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    integerValue = [v6 integerValue];
    *buf = 138543874;
    v15 = v10;
    v16 = 2048;
    v17 = integerValue;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Bumping tag version for operate as 0x%lX (%@)", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  versionCopy[2](versionCopy, v6);

  v12 = *MEMORY[0x277D85DE8];
}

- (id)accessoryAdministerPrivilegeCATID:(BOOL)d
{
  dCopy = d;
  v48 = *MEMORY[0x277D85DE8];
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  users = [(HMDHome *)self users];
  v6 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v6)
  {
LABEL_21:

LABEL_22:
    currentAdministerCATID = [(HMDHome *)self currentAdministerCATID];

    if (currentAdministerCATID)
    {
      currentAdministerCATID = [(HMDHome *)self currentAdministerCATID];
    }

    if (!currentAdministerCATID && dCopy)
    {
      currentAdministerCATID = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:objc_msgSend(MEMORY[0x277D17B90] version:{"randomCASEAuthenticatedTagIdentifier"), 1}];
      v27 = objc_autoreleasePoolPush();
      selfCopy = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        integerValue = [currentAdministerCATID integerValue];
        *buf = 138543874;
        v40 = v30;
        v41 = 2048;
        v42 = integerValue;
        v43 = 2112;
        v44 = currentAdministerCATID;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Generated new CAT for accessory administer 0x%lX (%@)", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v27);
    }

    goto LABEL_29;
  }

  v7 = v6;
  v34 = dCopy;
  currentAdministerCATID = 0;
  v9 = *v36;
  while (2)
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(users);
      }

      v11 = *(*(&v35 + 1) + 8 * i);
      if ([v11 privilege] == 3)
      {
        if (currentAdministerCATID || ([v11 matterCASEAuthenticatedTagID], v18 = objc_claimAutoreleasedReturnValue(), v18, !v18))
        {
          matterCASEAuthenticatedTagID = [v11 matterCASEAuthenticatedTagID];
          v13 = [matterCASEAuthenticatedTagID isEqual:currentAdministerCATID];

          if ((v13 & 1) == 0)
          {
            matterCASEAuthenticatedTagID2 = [v11 matterCASEAuthenticatedTagID];
            if (matterCASEAuthenticatedTagID2)
            {
              v15 = matterCASEAuthenticatedTagID2;
              matterCASEAuthenticatedTagID3 = [v11 matterCASEAuthenticatedTagID];
              v17 = [matterCASEAuthenticatedTagID3 isEqual:currentAdministerCATID];

              if ((v17 & 1) == 0)
              {
                v19 = objc_autoreleasePoolPush();
                selfCopy2 = self;
                v21 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
                {
                  v23 = HMFGetLogIdentifier();
                  integerValue2 = [currentAdministerCATID integerValue];
                  matterCASEAuthenticatedTagID4 = [v11 matterCASEAuthenticatedTagID];
                  integerValue3 = [matterCASEAuthenticatedTagID4 integerValue];
                  *buf = 138544130;
                  v40 = v23;
                  v41 = 2048;
                  v42 = integerValue2;
                  v43 = 2048;
                  v44 = integerValue3;
                  v45 = 2112;
                  v46 = v11;
                  _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@CATID mismatch between users - current 0x%lX userCAT 0x%lX user %@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v19);
                dCopy = v34;
                goto LABEL_21;
              }
            }
          }
        }

        else
        {
          currentAdministerCATID = [v11 matterCASEAuthenticatedTagID];
        }
      }
    }

    v7 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
    if (v7)
    {
      continue;
    }

    break;
  }

  dCopy = v34;
  if (!currentAdministerCATID)
  {
    goto LABEL_22;
  }

LABEL_29:
  [(HMDHome *)self setCurrentAdministerCATID:currentAdministerCATID];
  v32 = *MEMORY[0x277D85DE8];

  return currentAdministerCATID;
}

- (id)accessoryOperatePrivilegeCATID:(BOOL)d
{
  dCopy = d;
  v48 = *MEMORY[0x277D85DE8];
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  users = [(HMDHome *)self users];
  v6 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v6)
  {
LABEL_21:

LABEL_22:
    currentOperateCATID = [(HMDHome *)self currentOperateCATID];

    if (currentOperateCATID)
    {
      currentOperateCATID = [(HMDHome *)self currentOperateCATID];
    }

    if (!currentOperateCATID && dCopy)
    {
      currentOperateCATID = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:objc_msgSend(MEMORY[0x277D17B90] version:{"randomCASEAuthenticatedTagIdentifier"), 1}];
      v27 = objc_autoreleasePoolPush();
      selfCopy = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        integerValue = [currentOperateCATID integerValue];
        *buf = 138543874;
        v40 = v30;
        v41 = 2048;
        v42 = integerValue;
        v43 = 2112;
        v44 = currentOperateCATID;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Generated new CAT for accessory operate 0x%lX (%@)", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v27);
    }

    goto LABEL_29;
  }

  v7 = v6;
  v34 = dCopy;
  currentOperateCATID = 0;
  v9 = *v36;
  while (2)
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(users);
      }

      v11 = *(*(&v35 + 1) + 8 * i);
      if (([v11 privilege] | 4) == 4)
      {
        if (currentOperateCATID || ([v11 matterCASEAuthenticatedTagID], v18 = objc_claimAutoreleasedReturnValue(), v18, !v18))
        {
          matterCASEAuthenticatedTagID = [v11 matterCASEAuthenticatedTagID];
          v13 = [matterCASEAuthenticatedTagID isEqual:currentOperateCATID];

          if ((v13 & 1) == 0)
          {
            matterCASEAuthenticatedTagID2 = [v11 matterCASEAuthenticatedTagID];
            if (matterCASEAuthenticatedTagID2)
            {
              v15 = matterCASEAuthenticatedTagID2;
              matterCASEAuthenticatedTagID3 = [v11 matterCASEAuthenticatedTagID];
              v17 = [matterCASEAuthenticatedTagID3 isEqual:currentOperateCATID];

              if ((v17 & 1) == 0)
              {
                v19 = objc_autoreleasePoolPush();
                selfCopy2 = self;
                v21 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
                {
                  v23 = HMFGetLogIdentifier();
                  integerValue2 = [currentOperateCATID integerValue];
                  matterCASEAuthenticatedTagID4 = [v11 matterCASEAuthenticatedTagID];
                  integerValue3 = [matterCASEAuthenticatedTagID4 integerValue];
                  *buf = 138544130;
                  v40 = v23;
                  v41 = 2048;
                  v42 = integerValue2;
                  v43 = 2048;
                  v44 = integerValue3;
                  v45 = 2112;
                  v46 = v11;
                  _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@CATID mismatch between users - current 0x%lX userCAT 0x%lX user %@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v19);
                dCopy = v34;
                goto LABEL_21;
              }
            }
          }
        }

        else
        {
          currentOperateCATID = [v11 matterCASEAuthenticatedTagID];
        }
      }
    }

    v7 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
    if (v7)
    {
      continue;
    }

    break;
  }

  dCopy = v34;
  if (!currentOperateCATID)
  {
    goto LABEL_22;
  }

LABEL_29:
  [(HMDHome *)self setCurrentOperateCATID:currentOperateCATID];
  v32 = *MEMORY[0x277D85DE8];

  return currentOperateCATID;
}

- (BOOL)hasSharedUser
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  users = [(HMDHome *)self users];
  v3 = [users countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(users);
        }

        v7 = *(*(&v11 + 1) + 8 * i);
        if ([v7 privilege] == 4 || !objc_msgSend(v7, "privilege"))
        {
          v8 = 1;
          goto LABEL_13;
        }
      }

      v4 = [users countByEnumeratingWithState:&v11 objects:v15 count:16];
      v8 = 0;
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  else
  {
    v8 = 0;
  }

LABEL_13:

  v9 = *MEMORY[0x277D85DE8];
  return v8;
}

- (void)updateCATIDsForUsersIfNeeded:(BOOL)needed completion:(id)completion
{
  neededCopy = needed;
  v37 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if ([(HMDHome *)self _doesUsersHaveCATID]|| ![(HMDHome *)self isOwnerUser])
  {
    goto LABEL_16;
  }

  matterAccessories = [(HMDHome *)self matterAccessories];
  v8 = [matterAccessories count];

  if (!v8 && !neededCopy)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v28 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEBUG, "%{public}@Not Updating CAT as its not pairing and there are no matter accessories yet", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    goto LABEL_16;
  }

  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  if ([residentDeviceManager hasAnyResident])
  {
    residentDeviceManager2 = [(HMDHome *)self residentDeviceManager];
    isCurrentDeviceConfirmedPrimaryResident = [residentDeviceManager2 isCurrentDeviceConfirmedPrimaryResident];

    if (isCurrentDeviceConfirmedPrimaryResident)
    {
      goto LABEL_19;
    }
  }

  else
  {
  }

  residentDeviceManager3 = [(HMDHome *)self residentDeviceManager];
  if ([residentDeviceManager3 hasAnyResident])
  {

    goto LABEL_16;
  }

  v17 = isThisDeviceDesignatedFMFDevice();

  if ((v17 & 1) == 0 && !neededCopy)
  {
LABEL_16:
    if (completionCopy)
    {
      completionCopy[2](completionCopy, 0);
    }

    goto LABEL_18;
  }

LABEL_19:
  v19 = [(HMDHome *)self accessoryAdministerPrivilegeCATID:1];
  if ([(HMDHome *)self hasSharedUser])
  {
    v20 = [(HMDHome *)self accessoryOperatePrivilegeCATID:1];
  }

  else
  {
    v20 = 0;
  }

  v21 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
  {
    v24 = HMFGetLogIdentifier();
    *buf = 138544386;
    v28 = v24;
    v29 = 2048;
    integerValue = [v20 integerValue];
    v31 = 2112;
    v32 = v20;
    v33 = 2048;
    integerValue2 = [v19 integerValue];
    v35 = 2112;
    v36 = v19;
    _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_DEBUG, "%{public}@Updating CAT for new user Operate 0x%lX %@, Administer 0x%lX (%@)", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v21);
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __57__HMDHome_CHIP__updateCATIDsForUsersIfNeeded_completion___block_invoke;
  v25[3] = &unk_278689A68;
  v25[4] = selfCopy2;
  v26 = completionCopy;
  [(HMDHome *)selfCopy2 updateUserCATWithOperatePrivilege:v20 administerPrivilege:v19 completion:v25];

LABEL_18:
  v18 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome_CHIP__updateCATIDsForUsersIfNeeded_completion___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v7;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed transaction to update user CAT: %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v8 = *(a1 + 40);
    if (v8)
    {
      v9 = *(v8 + 16);
LABEL_8:
      v9();
    }
  }

  else
  {
    v10 = *(a1 + 40);
    if (v10)
    {
      v9 = *(v10 + 16);
      goto LABEL_8;
    }
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)_doesUsersHaveCATID
{
  v20 = *MEMORY[0x277D85DE8];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  users = [(HMDHome *)self users];
  v3 = [users countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v16;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v16 != v5)
        {
          objc_enumerationMutation(users);
        }

        v7 = *(*(&v15 + 1) + 8 * i);
        if ([v7 isAllowedToHaveCATId])
        {
          matterCASEAuthenticatedTagID = [v7 matterCASEAuthenticatedTagID];
          if (!matterCASEAuthenticatedTagID || (v9 = matterCASEAuthenticatedTagID, [v7 matterCASEAuthenticatedTagID], v10 = objc_claimAutoreleasedReturnValue(), v11 = objc_msgSend(v10, "intValue"), v10, v9, !v11))
          {
            v12 = 0;
            goto LABEL_13;
          }
        }
      }

      v4 = [users countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  v12 = 1;
LABEL_13:

  v13 = *MEMORY[0x277D85DE8];
  return v12;
}

- (void)_clearCHIPStorageWithCompletion:(id)completion
{
  completionCopy = completion;
  chipStorage = [(HMDHome *)self chipStorage];
  keyValueStore = [chipStorage keyValueStore];
  v7 = [keyValueStore count];

  if (v7)
  {
    v8 = [HMDCHIPHomeDataSource alloc];
    matterFabricID = [(HMDHome *)self matterFabricID];
    v10 = [(HMDCHIPHomeDataSource *)v8 initWithFabricID:matterFabricID home:self];

    v11[0] = MEMORY[0x277D85DD0];
    v11[1] = 3221225472;
    v11[2] = __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke;
    v11[3] = &unk_278689A68;
    v11[4] = self;
    v12 = completionCopy;
    [(HMDCHIPHomeDataSource *)v10 updateKeyValueStore:MEMORY[0x277CBEC10] completion:v11];
  }

  else
  {
    (*(completionCopy + 2))(completionCopy, 0);
  }
}

void __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke_2;
  v7[3] = &unk_27868A7A0;
  v5 = *(a1 + 40);
  v8 = v3;
  v9 = v5;
  v6 = v3;
  dispatch_async(v4, v7);
}

- (void)_handleResetMatterStorageRequest:(id)request
{
  v81 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = [requestCopy stringForKey:*MEMORY[0x277CD0538]];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v78 = v9;
    v79 = 2112;
    v80 = v5;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Handling request to reset Matter storage with corruption option: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  if ([(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0530]])
  {
    v10 = [HMDCHIPHomeDataSource alloc];
    matterFabricID = [(HMDHome *)selfCopy matterFabricID];
    initUnassociated = [(HMDCHIPHomeDataSource *)v10 initWithFabricID:matterFabricID home:selfCopy];

    v13 = objc_alloc_init(MEMORY[0x277D17AF8]);
    v14 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:initUnassociated keychainDelegate:v13];
    newFabricData = [v14 newFabricData];
    if (newFabricData)
    {
      v16 = objc_alloc_init(MEMORY[0x277D17B40]);
      v17 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:newFabricData chipStorageDelegate:initUnassociated keychainDelegate:v13 v2FabricDataStoreDelegate:v16];
      v72 = v5;
      if ([v17 commit])
      {
        if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
        {
          fabric = [(HMDHome *)selfCopy fabric];
          [fabric invalidateCachedData];
        }

        v19 = objc_autoreleasePoolPush();
        v20 = selfCopy;
        v21 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v22 = v69 = requestCopy;
          *buf = 138543362;
          v78 = v22;
          _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Stored bad fabric data into CHIP storage", buf, 0xCu);

          requestCopy = v69;
        }

        objc_autoreleasePoolPop(v19);
        v76 = 0;
        [(HMDHome *)v20 setUpOperationalFabricDataWithError:&v76];
        v23 = v76;
        [requestCopy respondWithSuccess];
      }

      else
      {
        v47 = objc_autoreleasePoolPush();
        v48 = selfCopy;
        v49 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v49, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v50 = v71 = requestCopy;
          *buf = 138543362;
          v78 = v50;
          _os_log_impl(&dword_229538000, v49, OS_LOG_TYPE_ERROR, "%{public}@Failed to store bad fabric data", buf, 0xCu);

          requestCopy = v71;
        }

        objc_autoreleasePoolPop(v47);
        v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [requestCopy respondWithError:v23];
      }

      v5 = v72;
    }

    else
    {
      v43 = objc_autoreleasePoolPush();
      v44 = selfCopy;
      v45 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
      {
        v46 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v46;
        _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate bad fabric data", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v43);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [requestCopy respondWithError:v16];
    }
  }

  else
  {
    if ([(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0528]])
    {
      initUnassociated = [requestCopy numberForKey:*MEMORY[0x277CD0540]];
      if (initUnassociated)
      {
        v73 = v5;
        v13 = objc_alloc_init(MEMORY[0x277D17B08]);
        v24 = objc_alloc_init(MEMORY[0x277D17AF8]);
        v25 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:v13 keychainDelegate:v24];
        newFabricData2 = [v25 newFabricData];
        if (newFabricData2)
        {
          v70 = v24;
          v27 = requestCopy;
          v28 = [HMDCHIPHomeKeychainFabricData alloc];
          uuid = [(HMDHome *)selfCopy uuid];
          iCloudIdentifier = [(HMDHome *)selfCopy iCloudIdentifier];
          v31 = [(HMDCHIPHomeKeychainFabricData *)v28 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

          LOBYTE(v28) = [(HMDCHIPHomeKeychainFabricData *)v31 storeFabricData:newFabricData2 dataVersion:initUnassociated];
          context = objc_autoreleasePoolPush();
          v32 = selfCopy;
          v33 = HMFGetOSLogHandle();
          v34 = v33;
          if (v28)
          {
            requestCopy = v27;
            if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
            {
              v35 = HMFGetLogIdentifier();
              *buf = 138543618;
              v78 = v35;
              v79 = 2112;
              v80 = initUnassociated;
              _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Stored additional V2 fabric data item to keychain with data version: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(context);
            [v27 respondWithSuccess];
          }

          else
          {
            requestCopy = v27;
            if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
            {
              v64 = HMFGetLogIdentifier();
              *buf = 138543362;
              v78 = v64;
              _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Failed to store additional fabric data", buf, 0xCu);
            }

            objc_autoreleasePoolPop(context);
            v65 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
            [v27 respondWithError:v65];
          }

          v24 = v70;
        }

        else
        {
          v60 = objc_autoreleasePoolPush();
          v61 = selfCopy;
          v62 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v62, OS_LOG_TYPE_ERROR))
          {
            v63 = HMFGetLogIdentifier();
            *buf = 138543362;
            v78 = v63;
            _os_log_impl(&dword_229538000, v62, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate additional fabric data", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v60);
          v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          [requestCopy respondWithError:v31];
        }

        v5 = v73;
      }

      else
      {
        v52 = objc_autoreleasePoolPush();
        v53 = selfCopy;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_ERROR))
        {
          v55 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v55;
          _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_ERROR, "%{public}@Data version is missing for additional V2 key request", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v52);
        v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        [requestCopy respondWithError:v13];
      }

      goto LABEL_34;
    }

    if (![(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0520]])
    {
      v74[0] = MEMORY[0x277D85DD0];
      v74[1] = 3221225472;
      v74[2] = __50__HMDHome_CHIP___handleResetMatterStorageRequest___block_invoke;
      v74[3] = &unk_27868A1D8;
      v74[4] = selfCopy;
      v75 = requestCopy;
      [(HMDHome *)selfCopy _clearCHIPStorageWithCompletion:v74];

      goto LABEL_35;
    }

    initUnassociated = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
    initUnassociated2 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
    v13 = initUnassociated2;
    if (initUnassociated && initUnassociated2)
    {
      v14 = objc_alloc_init(MEMORY[0x277D17B00]);
      v37 = [v14 forceUpdateNocSigner:initUnassociated ownerSharedOperationalKeyPair:v13];
      v38 = objc_autoreleasePoolPush();
      v39 = selfCopy;
      v40 = HMFGetOSLogHandle();
      v41 = v40;
      if (v37)
      {
        if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v42;
          _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Stored new V0 keys to keychain", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v38);
        [requestCopy respondWithSuccess];
      }

      else
      {
        if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
        {
          v66 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v66;
          _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_ERROR, "%{public}@Failed to write new V0 keys", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v38);
        v67 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [requestCopy respondWithError:v67];
      }
    }

    else
    {
      v56 = objc_autoreleasePoolPush();
      v57 = selfCopy;
      v58 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v59 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v59;
        _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_ERROR, "%{public}@Failed to create new V0 keys", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v56);
      v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [requestCopy respondWithError:v14];
    }
  }

LABEL_34:
LABEL_35:

  v51 = *MEMORY[0x277D85DE8];
}

void __50__HMDHome_CHIP___handleResetMatterStorageRequest___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543618;
      v18 = v7;
      v19 = 2112;
      v20 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to clear CHIP storage: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 40) respondWithError:v3];
  }

  else
  {
    if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
    {
      v8 = [*(a1 + 32) fabric];
      [v8 invalidateCachedData];
    }

    v9 = *(a1 + 32);
    v16 = 0;
    [v9 setUpOperationalFabricDataWithError:&v16];
    v10 = v16;
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Cleared and left CHIP storage as empty", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    [*(a1 + 40) respondWithSuccess];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)handleMatterPairingCompletionNotification:(id)notification
{
  v37 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  v5 = [notificationCopy numberForKey:@"HMDHomePairingCompletionNodeIDMessageKey"];
  v6 = [notificationCopy numberForKey:@"HMDHomePairingCompletionFabricIDMessageKey"];
  v7 = [notificationCopy numberForKey:@"HMDHomePairingCompletionVendorIDMessageKey"];
  v8 = [notificationCopy numberForKey:@"HMDHomePairingCompletionProductIDMessageKey"];
  v9 = [notificationCopy numberForKey:@"HMDHomePairingCompletionConfigNumberMessageKey"];
  v10 = [notificationCopy numberForKey:@"HMDHomePairingCompletionCategoryMessageKey"];
  v11 = [notificationCopy dataForKey:@"HMDHomePairingCompletionTopologyMessageKey"];
  v12 = v11;
  if (v5 && v6)
  {
    homeManager = [(HMDHome *)self homeManager];
    accessoryBrowserInternal = [homeManager accessoryBrowserInternal];
    [accessoryBrowserInternal chipAccessoryServerBrowser];
    v13 = v5;
    v14 = v6;
    v15 = v10;
    v16 = v9;
    v17 = v8;
    v19 = v18 = v7;
    targetFabricUUID = [(HMDHome *)self targetFabricUUID];
    [v19 handlePairingCompletionForAccessoryWithNodeID:v13 targetFabricUUID:targetFabricUUID fabricID:v14 vendorID:v18 productID:v17 configNumber:v16 category:v15 topology:v12];

    v7 = v18;
    v8 = v17;
    v9 = v16;
    v10 = v15;
    v6 = v14;
    v5 = v13;

    [notificationCopy respondWithSuccess];
  }

  else
  {
    v30 = v11;
    v21 = objc_autoreleasePoolPush();
    selfCopy = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v24 = v28 = v21;
      *buf = 138543874;
      v32 = v24;
      v33 = 2112;
      v34 = v5;
      v35 = 2112;
      v36 = v6;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Resident cannot establish connection with accessory with accessory node ID = %@, fabric ID = %@", buf, 0x20u);

      v21 = v28;
    }

    objc_autoreleasePoolPop(v21);
    v25 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
    [notificationCopy respondWithError:v25];

    v12 = v30;
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)completePotentialFabricDataCreation
{
  os_unfair_recursive_lock_lock_with_options();
  potentialFabricDataCreationBlocks = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v4 = [potentialFabricDataCreationBlocks count];

  if (v4)
  {
    potentialFabricDataCreationBlocks2 = [(HMDHome *)self potentialFabricDataCreationBlocks];
    [potentialFabricDataCreationBlocks2 removeObjectAtIndex:0];
  }

  potentialFabricDataCreationBlocks3 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v7 = [potentialFabricDataCreationBlocks3 count];

  if (v7)
  {
    potentialFabricDataCreationBlocks4 = [(HMDHome *)self potentialFabricDataCreationBlocks];
    v9 = [potentialFabricDataCreationBlocks4 objectAtIndexedSubscript:0];

    os_unfair_recursive_lock_unlock();
    if (v9)
    {
      v9[2]();
    }
  }

  else
  {

    os_unfair_recursive_lock_unlock();
  }
}

- (void)runPotentialFabricDataCreationBlock:(id)block
{
  aBlock = block;
  os_unfair_recursive_lock_lock_with_options();
  potentialFabricDataCreationBlocks = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v5 = [potentialFabricDataCreationBlocks count];

  potentialFabricDataCreationBlocks2 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v7 = _Block_copy(aBlock);
  [potentialFabricDataCreationBlocks2 addObject:v7];

  os_unfair_recursive_lock_unlock();
  if (!v5)
  {
    aBlock[2]();
  }
}

- (void)exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:(id)d commissioneeNodeID:(id)iD fabricID:(id)fabricID publicKey:(id)key sender:(id)sender completion:(id)completion
{
  v71 = *MEMORY[0x277D85DE8];
  dCopy = d;
  iDCopy = iD;
  fabricIDCopy = fabricID;
  keyCopy = key;
  senderCopy = sender;
  completionCopy = completion;
  if (![(HMDHome *)self isOwnerUser])
  {
    v24 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v26 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_17;
    }

    v27 = HMFGetLogIdentifier();
    *buf = 138543362;
    v66 = v27;
    v29 = "%{public}@Non-owner user cannot handle request to generate certificates";
    v30 = v26;
    v31 = 12;
LABEL_15:
    _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, v29, buf, v31);
LABEL_16:

    goto LABEL_17;
  }

  if (!keyCopy)
  {
    v24 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v26 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_17;
    }

    v27 = HMFGetLogIdentifier();
    *buf = 138543618;
    v66 = v27;
    v67 = 2112;
    v68 = 0;
    v29 = "%{public}@Cannot handle remote request to retrieve certificates with public Key: %@";
    v30 = v26;
    v31 = 22;
    goto LABEL_15;
  }

  if (!isFeatureMatterLocalFabricConfigEnabled())
  {
    if (([fabricIDCopy isEqual:&unk_283E71918] & 1) == 0)
    {
      if (fabricIDCopy)
      {
        chipStorage = [(HMDHome *)self chipStorage];
        fabricID = [chipStorage fabricID];
        if (!fabricID)
        {
          goto LABEL_21;
        }

        v22 = fabricID;
        chipStorage2 = [(HMDHome *)self chipStorage];
        fabricID2 = [chipStorage2 fabricID];
        if ([fabricID2 isEqual:&unk_283E71918])
        {
LABEL_36:

          goto LABEL_21;
        }

        chipStorage3 = [(HMDHome *)self chipStorage];
        fabricID3 = [chipStorage3 fabricID];
        v54 = [fabricIDCopy isEqual:fabricID3];

        if ((v54 & 1) == 0)
        {
          v24 = objc_autoreleasePoolPush();
          selfCopy6 = self;
          v26 = HMFGetOSLogHandle();
          if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_17;
          }

          v27 = HMFGetLogIdentifier();
          chipStorage4 = [(HMDHome *)selfCopy6 chipStorage];
          v56 = v24;
          fabricID4 = [chipStorage4 fabricID];
          *buf = 138543874;
          v66 = v27;
          v67 = 2112;
          v68 = fabricIDCopy;
          v69 = 2112;
          v70 = fabricID4;
          goto LABEL_46;
        }
      }

LABEL_22:
      if ([dCopy isEqualToNumber:&unk_283E71918])
      {

        dCopy = 0;
      }

      if (iDCopy && !fabricIDCopy)
      {
        v34 = objc_autoreleasePoolPush();
        selfCopy5 = self;
        v36 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
LABEL_29:

          objc_autoreleasePoolPop(v34);
          fabricIDCopy = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          (*(completionCopy + 2))(completionCopy, 0, 0, 0, 0, fabricIDCopy);
          goto LABEL_18;
        }

        v37 = HMFGetLogIdentifier();
        *buf = 138543874;
        v66 = v37;
        v67 = 2112;
        v68 = iDCopy;
        v69 = 2112;
        v70 = 0;
        v38 = "%{public}@Cannot handle remote request to retrieve certificates with device Node ID %@ and fabricID %@";
        v39 = v36;
        v40 = 32;
LABEL_28:
        _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_ERROR, v38, buf, v40);

        goto LABEL_29;
      }

      if (isFeatureMatterLocalFabricConfigEnabled())
      {
        fabric = [(HMDHome *)self fabric];
        fabricID5 = [fabric fabricID];

        isOwner = [senderCopy isOwner];
        if (fabricID5)
        {
          goto LABEL_42;
        }
      }

      else
      {
        chipStorage5 = [(HMDHome *)self chipStorage];
        fabricID5 = [chipStorage5 fabricID];

        isOwner = 0;
        if (fabricID5)
        {
          goto LABEL_42;
        }
      }

      if (![(HMDHome *)self isCurrentDevicePrimaryResident]&& [(HMDHome *)self doesHomeContainResident])
      {
        v34 = objc_autoreleasePoolPush();
        selfCopy5 = self;
        v36 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_29;
        }

        v37 = HMFGetLogIdentifier();
        *buf = 138543362;
        v66 = v37;
        v38 = "%{public}@Failing commissioning cert because operational cert creation is not allowed in this device while there is a resident in Home";
        v39 = v36;
        v40 = 12;
        goto LABEL_28;
      }

LABEL_42:
      homeManager = [(HMDHome *)self homeManager];
      v57[0] = MEMORY[0x277D85DD0];
      v57[1] = 3221225472;
      v57[2] = __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke;
      v57[3] = &unk_27866F130;
      v57[4] = self;
      v58 = fabricID5;
      v63 = completionCopy;
      v59 = homeManager;
      dCopy = dCopy;
      v60 = dCopy;
      v61 = iDCopy;
      v64 = isOwner;
      v62 = keyCopy;
      v47 = homeManager;
      fabricIDCopy = fabricID5;
      [(HMDHome *)self updateCATIDsForUsersIfNeeded:1 completion:v57];

      goto LABEL_18;
    }

LABEL_20:
    chipStorage = fabricIDCopy;
    fabricIDCopy = 0;
LABEL_21:

    goto LABEL_22;
  }

  if ([fabricIDCopy isEqualToNumber:&unk_283E71918])
  {
    goto LABEL_20;
  }

  if (!fabricIDCopy)
  {
    goto LABEL_22;
  }

  chipStorage = [(HMDHome *)self fabric];
  fabricID6 = [chipStorage fabricID];
  if (!fabricID6)
  {
    goto LABEL_21;
  }

  v22 = fabricID6;
  chipStorage2 = [(HMDHome *)self fabric];
  fabricID2 = [chipStorage2 fabricID];
  if ([fabricID2 isEqual:&unk_283E71918])
  {
    goto LABEL_36;
  }

  fabric2 = [(HMDHome *)self fabric];
  fabricID7 = [fabric2 fabricID];
  v52 = [fabricIDCopy isEqual:fabricID7];

  if (v52)
  {
    goto LABEL_22;
  }

  v24 = objc_autoreleasePoolPush();
  selfCopy6 = self;
  v26 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
  {
    v27 = HMFGetLogIdentifier();
    chipStorage4 = [(HMDHome *)selfCopy6 fabric];
    v56 = v24;
    fabricID4 = [chipStorage4 fabricID];
    *buf = 138543874;
    v66 = v27;
    v67 = 2112;
    v68 = fabricIDCopy;
    v69 = 2112;
    v70 = fabricID4;
LABEL_46:
    _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle remote request to retrieve certificates for unknown fabricID %@. Current home fabric ID %@", buf, 0x20u);

    v24 = v56;
    goto LABEL_16;
  }

LABEL_17:

  objc_autoreleasePoolPop(v24);
  v32 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
  (*(completionCopy + 2))(completionCopy, 0, 0, 0, 0, v32);

LABEL_18:
  v33 = *MEMORY[0x277D85DE8];
}

void __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke(uint64_t a1, void *a2)
{
  v48 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v43 = 0;
  v4 = *(a1 + 32);
  v42 = 0;
  v5 = [v4 storedFabricDataWithDataPresentInV2FabricDataStore:&v43 error:&v42];
  v6 = v42;
  v7 = v6;
  if (!v5)
  {
    v8 = [v6 underlyingErrors];
    if ([v8 na_any:&__block_literal_global_388_8951])
    {
    }

    else
    {
      v30 = [v7 domain];
      if ([v30 isEqual:*MEMORY[0x277D0F1A0]])
      {
        v31 = [v7 code];

        if (v31 == 2)
        {
          goto LABEL_4;
        }
      }

      else
      {
      }

      v34 = *(a1 + 40);
      if (!v34 || ([v34 isEqual:&unk_283E71918] & 1) != 0 || (objc_msgSend(v7, "underlyingErrors"), v35 = objc_claimAutoreleasedReturnValue(), v36 = objc_msgSend(v35, "na_any:", &__block_literal_global_390), v35, (v36 & 1) == 0))
      {
        v37 = objc_autoreleasePoolPush();
        v38 = *(a1 + 32);
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_DEFAULT))
        {
          v40 = HMFGetLogIdentifier();
          *buf = 138543618;
          v45 = v40;
          v46 = 2112;
          v47 = v7;
          _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot handle commissioning cert request due to fabric data fetch error: %@", buf, 0x16u);
        }

        v33 = v37;
        goto LABEL_28;
      }
    }

LABEL_4:
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Creating new fabric data", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v5 = [*(a1 + 32) newFabricData];
    v13 = objc_autoreleasePoolPush();
    v14 = *(a1 + 32);
    v15 = HMFGetOSLogHandle();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);
    if (v5)
    {
      if (v16)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v17;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@New fabric data created and stored", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
      v43 = 1;
      v18 = [v5 fabricID];
      v19 = [*(a1 + 32) fabric];
      [v19 setFabricID:v18];

      v20 = [v5 fabricID];
      v21 = [*(a1 + 32) chipStorage];
      [v21 setFabricID:v20];

      goto LABEL_10;
    }

    if (v16)
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v32;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to create new fabric data when handling commissioning cert request", buf, 0xCu);
    }

    v33 = v13;
LABEL_28:
    objc_autoreleasePoolPop(v33);
    (*(*(a1 + 80) + 16))();
    goto LABEL_29;
  }

LABEL_10:
  if ((v43 & 1) == 0)
  {
    v22 = objc_autoreleasePoolPush();
    v23 = *(a1 + 32);
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v25;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Migrating fabric data to V2 fabric data store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v22);
    [*(a1 + 32) storeNewFabricData:v5];
  }

  v26 = [*(a1 + 32) accessoryAdministerPrivilegeCATID:0];
  v27 = [*(a1 + 32) accessoryOperatePrivilegeCATID:0];
  v28 = [*(a1 + 48) accessoryBrowser];
  v29 = [v28 chipAccessoryServerBrowser];
  [v29 fetchCertificatesForMatterNodeWithCommissionerNodeID:*(a1 + 56) commissioneeNodeID:*(a1 + 64) forOwner:*(a1 + 88) publicKey:*(a1 + 72) fabricData:v5 adminCAT:v26 opCAT:v27 completionHandler:*(a1 + 80)];

LABEL_29:
  v41 = *MEMORY[0x277D85DE8];
}

BOOL __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_3(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 domain];
  if ([v3 isEqual:*MEMORY[0x277D17A00]])
  {
    v4 = [v2 code] == 1;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

BOOL __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 domain];
  if ([v3 isEqual:*MEMORY[0x277D17A00]])
  {
    v4 = [v2 code] == 2;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)handleCommissioningCertificateRequestWithCommissionerNodeID:(id)d commissioneeNodeID:(id)iD fabricID:(id)fabricID publicKey:(id)key sender:(id)sender completion:(id)completion
{
  dCopy = d;
  iDCopy = iD;
  fabricIDCopy = fabricID;
  keyCopy = key;
  senderCopy = sender;
  completionCopy = completion;
  objc_initWeak(&location, self);
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke;
  v26[3] = &unk_27866F0E8;
  objc_copyWeak(&v33, &location);
  v20 = dCopy;
  v27 = v20;
  v21 = iDCopy;
  v28 = v21;
  v22 = fabricIDCopy;
  v29 = v22;
  v23 = keyCopy;
  v30 = v23;
  v24 = senderCopy;
  v31 = v24;
  v25 = completionCopy;
  v32 = v25;
  [(HMDHome *)self runPotentialFabricDataCreationBlock:v26];

  objc_destroyWeak(&v33);
  objc_destroyWeak(&location);
}

void __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v3 = *(a1 + 32);
  v4 = *(a1 + 40);
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v7 = *(a1 + 64);
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2;
  v8[3] = &unk_27866F0C0;
  objc_copyWeak(&v10, (a1 + 80));
  v9 = *(a1 + 72);
  [WeakRetained exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:v3 commissioneeNodeID:v4 fabricID:v5 publicKey:v6 sender:v7 completion:v8];

  objc_destroyWeak(&v10);
}

void __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2(uint64_t a1, void *a2, void *a3, void *a4, void *a5, void *a6)
{
  v11 = a6;
  v12 = a5;
  v13 = a4;
  v14 = a3;
  v15 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  (*(*(a1 + 32) + 16))();

  [WeakRetained completePotentialFabricDataCreation];
}

- (void)handleCommissioningCertificateRequest:(id)request
{
  requestCopy = request;
  v5 = [requestCopy numberForKey:@"HMDHomeCommissioningDeviceNodeIDMessageKey"];
  v6 = [requestCopy numberForKey:@"HMDHomeCommissioningFabricIDMessageKey"];
  v7 = [requestCopy dataForKey:@"HMDHomeCommissioningPublicKeyMessageKey"];
  v8 = [requestCopy userForHome:self];
  if (!isFeatureMatterLocalFabricConfigEnabled())
  {
    goto LABEL_4;
  }

  v9 = [requestCopy numberForKey:@"HMDHomeCommissioningCommissionerNodeIDMessageKey"];
  if ([v9 isEqualToNumber:&unk_283E71918])
  {

LABEL_4:
    v9 = 0;
  }

  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __55__HMDHome_CHIP__handleCommissioningCertificateRequest___block_invoke;
  v11[3] = &unk_27866F098;
  v12 = requestCopy;
  v10 = requestCopy;
  [(HMDHome *)self handleCommissioningCertificateRequestWithCommissionerNodeID:v9 commissioneeNodeID:v5 fabricID:v6 publicKey:v7 sender:v8 completion:v11];
}

void __55__HMDHome_CHIP__handleCommissioningCertificateRequest___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, uint64_t a6)
{
  v15 = a2;
  v11 = a3;
  v12 = a4;
  v13 = a5;
  if (a6)
  {
    [*(a1 + 32) respondWithError:a6];
  }

  else
  {
    v14 = [MEMORY[0x277CBEB38] dictionary];
    [v14 setObject:v15 forKeyedSubscript:@"HMDHomeCommissioningRootCertMessageKey"];
    [v14 setObject:v11 forKeyedSubscript:@"HMDHomeCommissioningOperationalCertMessageKey"];
    [v14 setObject:v12 forKeyedSubscript:@"HMDHomeCommissioningOwnerNodeIDMessageKey"];
    [v14 setObject:v13 forKeyedSubscript:@"HMDHomeCommissioningIPKMessageKey"];
    [*(a1 + 32) respondWithPayload:v14];
  }
}

- (void)_dispatchCHIPReport:(id)report destination:(id)destination
{
  v35 = *MEMORY[0x277D85DE8];
  reportCopy = report;
  destinationCopy = destination;
  v8 = [HMDDeviceHandle deviceHandleForDestination:destinationCopy];
  v9 = +[HMDAccountRegistry sharedRegistry];
  v10 = [v9 deviceForHandle:v8];

  account = [v10 account];

  if (account)
  {
    if (![v10 isCurrentDevice])
    {
      objc_initWeak(buf, self);
      homeManager = [(HMDHome *)self homeManager];
      v21 = [reportCopy copy];
      uuid = [(HMDHome *)self uuid];
      workQueue = [(HMDHome *)self workQueue];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __49__HMDHome_CHIP___dispatchCHIPReport_destination___block_invoke;
      v25[3] = &unk_278689460;
      objc_copyWeak(&v28, buf);
      v26 = reportCopy;
      v27 = destinationCopy;
      [homeManager sendSecureMessage:v21 target:uuid userID:v27 destination:v27 responseQueue:workQueue responseHandler:v25];

      objc_destroyWeak(&v28);
      objc_destroyWeak(buf);
      goto LABEL_10;
    }

    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v30 = v15;
      v31 = 2112;
      v32 = destinationCopy;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Skipping device %@ - ourselves", buf, 0x16u);
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      shortDescription = [v10 shortDescription];
      *buf = 138543874;
      v30 = v18;
      v31 = 2112;
      v32 = shortDescription;
      v33 = 2112;
      v34 = destinationCopy;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Device %@ for CHIP report destination %@ has no user attached to it. Destination removed.", buf, 0x20u);
    }
  }

  objc_autoreleasePoolPop(v12);
  notificationRegistry = [(HMDHome *)selfCopy2 notificationRegistry];
  chipRemoteSubscribers = [notificationRegistry chipRemoteSubscribers];
  [chipRemoteSubscribers removeObject:destinationCopy];

LABEL_10:
  v24 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome_CHIP___dispatchCHIPReport_destination___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v23 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
    if (v5)
    {
      if (v11)
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 40);
        v17 = 138543874;
        v18 = v12;
        v19 = 2112;
        v20 = v13;
        v21 = 2112;
        v22 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Failed to send CHIP report to user %@ due to error %@", &v17, 0x20u);
LABEL_7:
      }
    }

    else if (v11)
    {
      v12 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) messagePayload];
      v15 = *(a1 + 40);
      v17 = 138543874;
      v18 = v12;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = v15;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Sent CHIP report: %@ to user %@", &v17, 0x20u);

      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleCHIPSendRemoteRequestMessage:(id)message
{
  v52 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v40 = [messageCopy numberForKey:@"HMDHomeCHIPNodeIDMessageKey"];
  if (v40)
  {
    v38 = messageCopy;
    v43 = 0u;
    v44 = 0u;
    v41 = 0u;
    v42 = 0u;
    matterAccessories = [(HMDHome *)self matterAccessories];
    v6 = [matterAccessories countByEnumeratingWithState:&v41 objects:v51 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v42;
      while (2)
      {
        v9 = 0;
        v39 = v7;
        do
        {
          if (*v42 != v8)
          {
            objc_enumerationMutation(matterAccessories);
          }

          v10 = *(*(&v41 + 1) + 8 * v9);
          v11 = objc_autoreleasePoolPush();
          selfCopy = self;
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
          {
            HMFGetLogIdentifier();
            v14 = v8;
            selfCopy2 = self;
            v17 = v16 = matterAccessories;
            matterNodeID = [v10 matterNodeID];
            *buf = 138543874;
            v46 = v17;
            v47 = 2112;
            v48 = matterNodeID;
            v49 = 2112;
            v50 = v40;
            _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Remote request dispatch compares %@ with %@", buf, 0x20u);

            matterAccessories = v16;
            self = selfCopy2;
            v8 = v14;
            v7 = v39;
          }

          objc_autoreleasePoolPop(v11);
          matterNodeID2 = [v10 matterNodeID];
          if ([matterNodeID2 isEqual:&unk_283E71918])
          {
          }

          else
          {
            matterNodeID3 = [v10 matterNodeID];
            v21 = [matterNodeID3 isEqualToNumber:v40];

            if (v21)
            {
              v32 = objc_autoreleasePoolPush();
              v33 = selfCopy;
              v34 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v34, OS_LOG_TYPE_DEBUG))
              {
                v35 = HMFGetLogIdentifier();
                identifier = [v10 identifier];
                *buf = 138543618;
                v46 = v35;
                v47 = 2112;
                v48 = identifier;
                _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_DEBUG, "%{public}@Dispatching remote request to accessory %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v32);
              messageCopy = v38;
              [v10 handleCHIPSendRemoteRequestMessage:v38];
              goto LABEL_24;
            }
          }

          ++v9;
        }

        while (v7 != v9);
        v7 = [matterAccessories countByEnumeratingWithState:&v41 objects:v51 count:16];
        if (v7)
        {
          continue;
        }

        break;
      }
    }

    v22 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v24 = HMFGetOSLogHandle();
    messageCopy = v38;
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543618;
      v46 = v25;
      v47 = 2112;
      v48 = v38;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory for CHIP remote request: %@", buf, 0x16u);
    }

    v26 = v22;
  }

  else
  {
    v27 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      v30 = HMFGetLogIdentifier();
      messagePayload = [messageCopy messagePayload];
      *buf = 138543618;
      v46 = v30;
      v47 = 2112;
      v48 = messagePayload;
      _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Cannot find node ID in CHIP remote request message payload: %@", buf, 0x16u);
    }

    v26 = v27;
  }

  objc_autoreleasePoolPop(v26);
  matterAccessories = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
  [messageCopy respondWithError:matterAccessories];
LABEL_24:

  v37 = *MEMORY[0x277D85DE8];
}

- (void)_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)message
{
  v31 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = [messageCopy uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v5)
  {
    matterAccessories = [(HMDHome *)self matterAccessories];
    v25[0] = MEMORY[0x277D85DD0];
    v25[1] = 3221225472;
    v25[2] = __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke;
    v25[3] = &unk_278681CA8;
    v7 = v5;
    v26 = v7;
    v8 = [matterAccessories na_firstObjectPassingTest:v25];

    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    v12 = v11;
    if (v8)
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v13;
        v29 = 2112;
        v30 = v8;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Resetting and removing all CHIP pairings from accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke_383;
      v23[3] = &unk_27868A1D8;
      v23[4] = selfCopy;
      v24 = messageCopy;
      [v8 removeAllCHIPPairingsWithCompletion:v23];
    }

    else
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v20;
        v29 = 2112;
        v30 = v7;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory with UUID %@ for reset and remove all CHIP pairings message", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [messageCopy respondWithError:v21];
    }

    v19 = v26;
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      messagePayload = [messageCopy messagePayload];
      *buf = 138543618;
      v28 = v17;
      v29 = 2112;
      v30 = messagePayload;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory UUID in reset and remove all CHIP pairings message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [messageCopy respondWithError:v19];
  }

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

void __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke_383(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Ignoring remove all CHIP pairings error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  [*(a1 + 32) handleRemoveAccessoryMessage:*(a1 + 40)];

  v8 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldFallbackLocallyForRemoteMatterRequest:(id)request
{
  requestCopy = request;
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    code = [requestCopy code];
    v5 = 1;
    if (code > 8 || ((1 << code) & 0x11C) == 0)
    {
      v5 = code == 3201;
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (void)_sendRemoteMessageUsingNodeId:(unint64_t)id payload:(id)payload completion:(id)completion
{
  v32[2] = *MEMORY[0x277D85DE8];
  payloadCopy = payload;
  completionCopy = completion;
  v10 = objc_alloc(MEMORY[0x277D0F820]);
  uuid = [(HMDHome *)self uuid];
  v12 = [v10 initWithTarget:uuid];

  v31[0] = @"HMDHomeCHIPNodeIDMessageKey";
  v13 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:id];
  v31[1] = @"HMDHomeCHIPRequestMessageKey";
  v32[0] = v13;
  v32[1] = payloadCopy;
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v32 forKeys:v31 count:2];

  v15 = [MEMORY[0x277D0F848] messageWithName:@"HMDHomeCHIPSendRemoteRequestMessage" destination:v12 payload:v14];
  cHIPRemoteMessageTimeout = [payloadCopy CHIPRemoteMessageTimeout];

  if (cHIPRemoteMessageTimeout)
  {
    cHIPRemoteMessageTimeout2 = [payloadCopy CHIPRemoteMessageTimeout];
    [cHIPRemoteMessageTimeout2 doubleValue];
    [v15 setTimeout:?];
  }

  v22 = MEMORY[0x277D85DD0];
  v23 = 3221225472;
  v24 = __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke;
  v25 = &unk_27866F070;
  v29 = completionCopy;
  idCopy = id;
  selfCopy = self;
  v27 = v12;
  v28 = v14;
  v18 = v14;
  v19 = v12;
  v20 = completionCopy;
  [v15 setResponseHandler:&v22];
  [(HMDHome *)self handleCHIPSendRemoteRequestMessage:v15, v22, v23, v24, v25, selfCopy];

  v21 = *MEMORY[0x277D85DE8];
}

void __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    if ([*(a1 + 32) _shouldFallbackLocallyForRemoteMatterRequest:v5])
    {
      v7 = [MEMORY[0x277D0F848] messageWithName:@"HMDHomeCHIPSendRemoteRequestMessage" destination:*(a1 + 40) payload:*(a1 + 48)];
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke_382;
      v23[3] = &unk_27866F048;
      v9 = *(a1 + 56);
      v8 = *(a1 + 64);
      v23[4] = *(a1 + 32);
      v25 = v8;
      v24 = v9;
      [v7 setResponseHandler:v23];
      [*(a1 + 32) _handleCHIPSendRemoteRequestMessage:v7];
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = *(a1 + 32);
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v19 = HMFGetLogIdentifier();
        v20 = *(a1 + 64);
        *buf = 138543874;
        v27 = v19;
        v28 = 2048;
        v29 = v20;
        v30 = 2112;
        v31 = v5;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute CHIP remote operation for nodeID=%llu: error=%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v16);
      v21 = *(a1 + 56);
      v7 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
      (*(v21 + 16))(v21, v7, v5);
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 32);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 64);
      *buf = 138543618;
      v27 = v13;
      v28 = 2048;
      v29 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Successfully executed CHIP remote operation for nodeID=%llu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v15 = *(a1 + 56);
    v7 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
    (*(v15 + 16))(v15, v7, 0);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke_382(uint64_t a1, void *a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v5)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = *(a1 + 48);
      v21 = 138543874;
      v22 = v11;
      v23 = 2048;
      v24 = v12;
      v25 = 2112;
      v26 = v5;
      v13 = "%{public}@Failed to execute CHIP local fallback operation for nodeID=%llu: error=%@";
      v14 = v10;
      v15 = OS_LOG_TYPE_ERROR;
      v16 = 32;
LABEL_6:
      _os_log_impl(&dword_229538000, v14, v15, v13, &v21, v16);
    }
  }

  else if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v17 = *(a1 + 48);
    v21 = 138543618;
    v22 = v11;
    v23 = 2048;
    v24 = v17;
    v13 = "%{public}@Successfully executed CHIP local fallback operation for nodeID=%llu";
    v14 = v10;
    v15 = OS_LOG_TYPE_INFO;
    v16 = 22;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v7);
  v18 = *(a1 + 40);
  v19 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
  (*(v18 + 16))(v18, v19, v5);

  v20 = *MEMORY[0x277D85DE8];
}

- (unint64_t)numMatterV2Keys
{
  v3 = [HMDCHIPHomeKeychainFabricData alloc];
  uuid = [(HMDHome *)self uuid];
  iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPHomeKeychainFabricData *)v3 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

  fabricDataItems = [(HMDCHIPHomeKeychainFabricData *)v6 fabricDataItems];
  v8 = [fabricDataItems count];

  return v8;
}

- (void)retrieveOperationalCertificatesForFabricID:(id)d commissioneeNodeID:(id)iD publicKey:(id)key completion:(id)completion
{
  completionCopy = completion;
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __100__HMDHome_CHIP__retrieveOperationalCertificatesForFabricID_commissioneeNodeID_publicKey_completion___block_invoke;
  v12[3] = &unk_27866F020;
  v13 = completionCopy;
  v11 = completionCopy;
  [(HMDHome *)self retrieveOperationalCertificatesForFabricID:d commissionerNodeID:0 commissioneeNodeID:iD publicKey:key completion:v12];
}

- (BOOL)requiresRemoteFabricDataUpdateThroughPairingCompletionMessage
{
  primaryResident = [(HMDHome *)self primaryResident];
  capabilities = [primaryResident capabilities];
  supportsMatterSharedAdminPairing = [capabilities supportsMatterSharedAdminPairing];

  return supportsMatterSharedAdminPairing;
}

- (void)fetchOperationalCertificatesForNewFabricWithFabricID:(id)d publicKey:(id)key fetchFromResident:(BOOL)resident completion:(id)completion
{
  residentCopy = resident;
  v27 = *MEMORY[0x277D85DE8];
  dCopy = d;
  keyCopy = key;
  completionCopy = completion;
  if (residentCopy || [(HMDHome *)self isOwnerUser])
  {
    if (isFeatureMatterLocalFabricConfigEnabled())
    {
      controllerPrivateStorage = [(HMDHome *)self controllerPrivateStorage];
      cachedLocalControllerNodeID = [controllerPrivateStorage cachedLocalControllerNodeID];

      if (!residentCopy)
      {
LABEL_5:
        currentUser = [(HMDHome *)self currentUser];
        [(HMDHome *)self handleCommissioningCertificateRequestWithCommissionerNodeID:cachedLocalControllerNodeID commissioneeNodeID:0 fabricID:dCopy publicKey:keyCopy sender:currentUser completion:completionCopy];

LABEL_8:
        goto LABEL_12;
      }
    }

    else
    {
      cachedLocalControllerNodeID = 0;
      if (!residentCopy)
      {
        goto LABEL_5;
      }
    }

    [(HMDHome *)self retrieveOperationalCertificatesForFabricID:dCopy commissionerNodeID:cachedLocalControllerNodeID commissioneeNodeID:0 publicKey:keyCopy completion:completionCopy];
    goto LABEL_8;
  }

  v16 = objc_autoreleasePoolPush();
  selfCopy = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
  {
    v19 = HMFGetLogIdentifier();
    currentUser2 = [(HMDHome *)selfCopy currentUser];
    v23 = 138543618;
    v24 = v19;
    v25 = 2112;
    v26 = currentUser2;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Current user %@ is not the owner. Therefore it must request NOC from the primary resident", &v23, 0x16u);
  }

  objc_autoreleasePoolPop(v16);
  v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:10];
  (*(completionCopy + 2))(completionCopy, 0, 0, 0, 0, v21);

LABEL_12:
  v22 = *MEMORY[0x277D85DE8];
}

- (void)handleClearMatterControllerPrivateStorageRequest:(id)request
{
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __66__HMDHome_CHIP__handleClearMatterControllerPrivateStorageRequest___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = requestCopy;
  v6 = requestCopy;
  dispatch_async(workQueue, v7);
}

void __66__HMDHome_CHIP__handleClearMatterControllerPrivateStorageRequest___block_invoke(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  if (![*(a1 + 32) isFeatureMatterLocalFabricConfigEnabled])
  {
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Matter controller private storage is not available to clear", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v13 = *(a1 + 40);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 48;
    goto LABEL_12;
  }

  v2 = [*(a1 + 32) controllerPrivateStorage];
  v3 = [v2 removeAllSDKKeyValuePairs];

  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (!v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v16;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to clear Matter controller private storage", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v13 = *(a1 + 40);
    v14 = MEMORY[0x277CCA9B8];
    v15 = -1;
LABEL_12:
    v17 = [v14 hmErrorWithCode:v15];
    [v13 respondWithError:v17];

    goto LABEL_13;
  }

  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Cleared Matter controller private storage", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 40) respondWithSuccess];
LABEL_13:
  v18 = *MEMORY[0x277D85DE8];
}

- (void)handleResetMatterStorageRequest:(id)request
{
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = requestCopy;
  v6 = requestCopy;
  dispatch_async(workQueue, v7);
}

void __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) primaryResidentMessageRouter];
  v3 = v2;
  if (v2)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke_380;
    v12[3] = &unk_27868A398;
    v4 = *(a1 + 40);
    v12[4] = *(a1 + 32);
    [v2 routeMessage:v4 localHandler:v12];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to handle request to reset Matter storage", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v9 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleCHIPSendReportMessage:(id)message
{
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = messageCopy;
  v6 = messageCopy;
  dispatch_async(workQueue, v7);
}

void __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke(uint64_t a1)
{
  v57 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) isCurrentDevicePrimaryResident])
  {
    v2 = [*(a1 + 32) notificationRegistry];
    v3 = [v2 chipRemoteSubscribers];
    v4 = [v3 copy];

    v47 = 0u;
    v48 = 0u;
    v45 = 0u;
    v46 = 0u;
    v5 = v4;
    v6 = [v5 countByEnumeratingWithState:&v45 objects:v56 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v46;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v46 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = *(*(&v45 + 1) + 8 * i);
          v11 = objc_autoreleasePoolPush();
          v12 = *(a1 + 32);
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
          {
            v14 = HMFGetLogIdentifier();
            *buf = 138543618;
            v51 = v14;
            v52 = 2112;
            v53 = v10;
            _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Dispatch CHIP report to %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v11);
          [*(a1 + 32) _dispatchCHIPReport:*(a1 + 40) destination:v10];
        }

        v7 = [v5 countByEnumeratingWithState:&v45 objects:v56 count:16];
      }

      while (v7);
    }
  }

  v15 = [*(a1 + 40) numberForKey:@"HMDHomeCHIPNodeIDMessageKey"];
  v36 = [v15 unsignedIntegerValue];

  v16 = [*(a1 + 40) arrayForKey:@"HMDHomeCHIPReportMessageKey"];
  v37 = [v16 na_filter:&__block_literal_global_378];

  if (([*(a1 + 32) isCurrentDevicePrimaryResident] & 1) == 0)
  {
    v17 = [*(a1 + 32) matterAccessories];
    v44[0] = MEMORY[0x277D85DD0];
    v44[1] = 3221225472;
    v44[2] = __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_2;
    v44[3] = &__block_descriptor_40_e50_B16__0__HMDAccessory_HMDMatterAccessoryProtocol__8l;
    v44[4] = v36;
    v18 = [v17 na_firstObjectPassingTest:v44];

    if (v18)
    {
      v42[0] = MEMORY[0x277D85DD0];
      v42[1] = 3221225472;
      v42[2] = __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_3;
      v42[3] = &unk_278682C28;
      v42[4] = *(a1 + 32);
      v43 = v18;
      [v37 na_each:v42];
    }

    else
    {
      v19 = objc_autoreleasePoolPush();
      v20 = *(a1 + 32);
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138543874;
        v51 = v22;
        v52 = 2048;
        v53 = v36;
        v54 = 2112;
        v55 = v37;
        _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@Failed to find matching accessory for attribute update notification. nodeID=%lu report=%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v19);
    }
  }

  v40 = 0u;
  v41 = 0u;
  v38 = 0u;
  v39 = 0u;
  v23 = [*(a1 + 32) chipLocalSubscribers];
  v24 = [v23 countByEnumeratingWithState:&v38 objects:v49 count:16];
  if (v24)
  {
    v25 = v24;
    v26 = *v39;
    do
    {
      for (j = 0; j != v25; ++j)
      {
        if (*v39 != v26)
        {
          objc_enumerationMutation(v23);
        }

        v28 = *(*(&v38 + 1) + 8 * j);
        v29 = objc_autoreleasePoolPush();
        v30 = *(a1 + 32);
        v31 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_DEBUG))
        {
          v32 = HMFGetLogIdentifier();
          *buf = 138543618;
          v51 = v32;
          v52 = 2112;
          v53 = v28;
          _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_DEBUG, "%{public}@Calling CHIP report handler for subscriber %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v29);
        v33 = [*(a1 + 32) chipLocalSubscribers];
        v34 = [v33 objectForKeyedSubscript:v28];
        (v34)[2](v34, v36, v37);
      }

      v25 = [v23 countByEnumeratingWithState:&v38 objects:v49 count:16];
    }

    while (v25);
  }

  [*(a1 + 40) respondWithSuccess];
  v35 = *MEMORY[0x277D85DE8];
}

uint64_t __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 matterNodeID];
  v4 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 32)];
  v5 = [v3 isEqualToNumber:v4];

  return v5;
}

void __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_3(uint64_t a1, void *a2)
{
  v38 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [MEMORY[0x277CBEB38] dictionary];
  v5 = [v3 hmf_arrayForKey:*MEMORY[0x277CD50B8]];
  v6 = v5;
  if (v5 && [v5 count] == 3)
  {
    v7 = [v6 objectAtIndexedSubscript:0];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = v7;
    }

    else
    {
      v8 = 0;
    }

    v9 = v8;

    v10 = [v6 objectAtIndexedSubscript:1];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v11 = v10;
    }

    else
    {
      v11 = 0;
    }

    v12 = v11;

    v13 = [v6 objectAtIndexedSubscript:2];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v9)
    {
      v16 = v12 == 0;
    }

    else
    {
      v16 = 1;
    }

    if (v16 || v15 == 0)
    {
      v18 = objc_autoreleasePoolPush();
      v19 = *(a1 + 32);
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        v34 = 138543618;
        v35 = v21;
        v36 = 2112;
        v37 = v3;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to process attribute update: missing endpointID, clusterID, or attributeID. report=%@", &v34, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
    }

    else
    {
      [v4 setObject:v9 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationEndpointIDKey"];
      [v4 setObject:v12 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationClusterIDKey"];
      [v4 setObject:v15 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationAttributeIDKey"];
      v26 = *MEMORY[0x277CD50D8];
      v27 = [v3 hmf_dictionaryForKey:*MEMORY[0x277CD50D8]];
      v28 = [v27 valueForKey:*MEMORY[0x277CD51A0]];
      [v4 setObject:v28 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationDecodedValueKey"];

      v29 = [v3 hmf_dictionaryForKey:v26];
      [v4 setObject:v29 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationDataKey"];

      v30 = [v3 hmf_dictionaryForKey:*MEMORY[0x277CD5170]];
      [v4 setObject:v30 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationPreviousDataKey"];

      v31 = *(a1 + 40);
      v32 = [v4 copy];
      logAndPostNotification(@"HMDMatterAttributeChangedNotification", v31, v32);
    }
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = *(a1 + 32);
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      v34 = 138543618;
      v35 = v25;
      v36 = 2112;
      v37 = v3;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Failed to process attribute update: AttributePath array is invalid. report=%@", &v34, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v33 = *MEMORY[0x277D85DE8];
}

uint64_t __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_375(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & (v2 != 0);
}

- (void)handleCHIPSendRemoteRequestMessage:(id)message
{
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = messageCopy;
  v6 = messageCopy;
  dispatch_async(workQueue, v7);
}

void __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled() && ([*(a1 + 32) isPrimaryResidentNodeReachable] & 1) == 0)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Primary resident unreachable, handling CHIP remote request locally", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    [*(a1 + 32) _handleCHIPSendRemoteRequestMessage:*(a1 + 40)];
  }

  else
  {
    v2 = [*(a1 + 32) primaryResidentMessageRouter];
    v3 = v2;
    if (v2)
    {
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke_373;
      v16[3] = &unk_27868A398;
      v4 = *(a1 + 40);
      v16[4] = *(a1 + 32);
      [v2 routeMessage:v4 localHandler:v16];
    }

    else
    {
      v5 = objc_autoreleasePoolPush();
      v6 = *(a1 + 32);
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543362;
        v18 = v8;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to handle CHIP remote request", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
      v9 = *(a1 + 40);
      v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v9 respondWithError:v10];
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)handleRemoteUpdateCHIPKeyValueStoreMessage:(id)message
{
  v32 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  matterFabricID = [(HMDHome *)self matterFabricID];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (matterFabricID)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      shortDescription = [messageCopy shortDescription];
      *buf = 138543618;
      v29 = v10;
      v30 = 2112;
      v31 = shortDescription;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Handling remote update CHIP key-value store message: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [[HMDCHIPHomeDataSource alloc] initWithFabricID:matterFabricID home:selfCopy];
    v13 = [messageCopy dictionaryForKey:@"HMDHomeRemoteUpdateCHIPKeyValueStoreMessageKey"];
    if (v13)
    {
      v14 = [messageCopy arrayForKey:@"HMDHomeRemoteUpdateCHIPRemovedKeysMessageKey"];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __60__HMDHome_CHIP__handleRemoteUpdateCHIPKeyValueStoreMessage___block_invoke;
      v25[3] = &unk_27866EFD8;
      v26 = v13;
      v27 = v14;
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __60__HMDHome_CHIP__handleRemoteUpdateCHIPKeyValueStoreMessage___block_invoke_2;
      v23[3] = &unk_27868A250;
      v24 = messageCopy;
      v15 = v14;
      [(HMDCHIPHomeDataSource *)v12 updateKeyValueStoreWithBlock:v25 completion:v23];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = selfCopy;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        messagePayload = [messageCopy messagePayload];
        *buf = 138543618;
        v29 = v20;
        v30 = 2112;
        v31 = messagePayload;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Did not find key-value store in message payload: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v17);
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      [messageCopy respondWithError:v15];
    }
  }

  else
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v16;
      v30 = 2112;
      v31 = 0;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle remote update CHIP key-value store message with fabricID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
    [messageCopy respondWithError:v12];
  }

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __60__HMDHome_CHIP__handleRemoteUpdateCHIPKeyValueStoreMessage___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v7 = *(a1 + 32);
  v8 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v18;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v18 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v17 + 1) + 8 * i);
        if (([v12 isEqual:{@"HMD.MTRPlugin.PairedNodeIDs", v17}] & 1) == 0)
        {
          v13 = [v5 objectForKeyedSubscript:v12];

          if (v13)
          {
            continue;
          }
        }

        v14 = [*(a1 + 32) objectForKeyedSubscript:v12];
        [v5 setObject:v14 forKeyedSubscript:v12];
      }

      v9 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
    }

    while (v9);
  }

  if (*(a1 + 40))
  {
    [v5 removeObjectsForKeys:?];
    [v6 addObjectsFromArray:*(a1 + 40)];
  }

  v15 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)hasThreadCapableResident
{
  enabledResidents = [(HMDHome *)self enabledResidents];
  v3 = [enabledResidents na_any:&__block_literal_global_367];

  return v3;
}

uint64_t __41__HMDHome_CHIP__hasThreadCapableResident__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 capabilities];
  v3 = [v2 supportsThreadBorderRouter];

  return v3;
}

- (void)setUpSharedUserFabricDataWithForceFetch:(BOOL)fetch completion:(id)completion
{
  v44 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if ([(HMDHome *)self isOwnerUser])
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Owner doesn't set up shared user fabric data", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    if (completionCopy)
    {
      completionCopy[2](completionCopy, 0);
    }

    goto LABEL_31;
  }

  currentUser = [(HMDHome *)self currentUser];

  if (currentUser)
  {
    initUnassociated = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
    fabric = [(HMDHome *)self fabric];
    fabricID = [fabric fabricID];

    if (initUnassociated)
    {
      error = 0;
      v15 = SecKeyCopyExternalRepresentation([initUnassociated publicKey], &error);
      if (!v15)
      {
        v17 = error;
        v18 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
        {
          v21 = HMFGetLogIdentifier();
          *buf = 138543618;
          v41 = v21;
          v42 = 2112;
          v43 = v17;
          v22 = "%{public}@Cannot fetch shared user NOC while failing to convert operational public key with error: %@";
          v23 = v20;
          v24 = OS_LOG_TYPE_ERROR;
          goto LABEL_24;
        }

LABEL_25:

        objc_autoreleasePoolPop(v18);
        if (completionCopy)
        {
          (completionCopy)[2](completionCopy, v17);
        }

        goto LABEL_28;
      }

      if (!fetch)
      {
        storedSharedHomeFabricData = [(HMDHome *)self storedSharedHomeFabricData];

        if (storedSharedHomeFabricData)
        {
          v34 = 0;
          [(HMDHome *)self setUpOperationalFabricDataWithError:&v34];
          v17 = v34;
          v18 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v20 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
          {
            v21 = HMFGetLogIdentifier();
            *buf = 138543618;
            v41 = v21;
            v42 = 2112;
            v43 = v17;
            v22 = "%{public}@Set up shared user fabric data using stored data with error: %@";
            v23 = v20;
            v24 = OS_LOG_TYPE_INFO;
LABEL_24:
            _os_log_impl(&dword_229538000, v23, v24, v22, buf, 0x16u);

            goto LABEL_25;
          }

          goto LABEL_25;
        }
      }

      v35[0] = MEMORY[0x277D85DD0];
      v35[1] = 3221225472;
      v35[2] = __68__HMDHome_CHIP__setUpSharedUserFabricDataWithForceFetch_completion___block_invoke;
      v35[3] = &unk_27866EFB0;
      v35[4] = self;
      v38 = completionCopy;
      v36 = fabricID;
      v37 = initUnassociated;
      [(HMDHome *)self fetchOperationalCertificatesForNewFabricWithFabricID:v36 publicKey:v15 fetchFromResident:1 completion:v35];
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543362;
        v41 = v32;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Cannot fetch shared user NOC without operational keypair", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v29);
      if (!completionCopy)
      {
        goto LABEL_29;
      }

      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
      (completionCopy)[2](completionCopy, v15);
    }

LABEL_28:

LABEL_29:
    goto LABEL_30;
  }

  v25 = objc_autoreleasePoolPush();
  selfCopy5 = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
  {
    v28 = HMFGetLogIdentifier();
    *buf = 138543362;
    v41 = v28;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Shared user is not yet user of the home. Will wait for user addition before setting up fabric data", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v25);
  if (completionCopy)
  {
    initUnassociated = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
    (completionCopy)[2](completionCopy, initUnassociated);
LABEL_30:
  }

LABEL_31:

  v33 = *MEMORY[0x277D85DE8];
}

void __68__HMDHome_CHIP__setUpSharedUserFabricDataWithForceFetch_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, void *a6)
{
  v76 = *MEMORY[0x277D85DE8];
  v11 = a2;
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  if (v15)
  {
    v16 = v15;
    v17 = objc_autoreleasePoolPush();
    v18 = *(a1 + 32);
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543618;
      v67 = v20;
      v68 = 2112;
      v69 = v16;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Failed to fetch shared user NOC from resident with error %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
    v21 = *(a1 + 56);
    if (v21)
    {
      (*(v21 + 16))(v21, v16);
    }
  }

  else if (v11 && v12 && v13 && v14)
  {
    v64 = *(a1 + 40);
    v22 = *(a1 + 40);
    if (!v22 || [v22 isEqualToNumber:&unk_283E71918])
    {
      v62 = [MEMORY[0x277CD5230] convertX509Certificate:v11];
      v23 = [objc_alloc(MEMORY[0x277CD5228]) initWithTLVBytes:v62];
      v24 = objc_autoreleasePoolPush();
      v25 = *(a1 + 32);
      v26 = HMFGetOSLogHandle();
      v27 = v26;
      if (v23)
      {
        if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          v60 = [v23 subject];
          v61 = v24;
          v29 = [v60 fabricID];
          *buf = 138543618;
          v67 = v28;
          v68 = 2112;
          v69 = v29;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Updating fabric ID to %@ for Shared Home", buf, 0x16u);

          v24 = v61;
        }

        objc_autoreleasePoolPop(v24);
        v30 = [v23 subject];
        v31 = [v30 fabricID];

        v32 = [*(a1 + 32) fabric];
        [v32 setFabricID:v31];

        v64 = v31;
      }

      else
      {
        if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
        {
          v39 = HMFGetLogIdentifier();
          *buf = 138543362;
          v67 = v39;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Couldn't extract certificate info", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v24);
      }
    }

    v40 = objc_autoreleasePoolPush();
    v41 = *(a1 + 32);
    v42 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v42, OS_LOG_TYPE_INFO))
    {
      v43 = HMFGetLogIdentifier();
      *buf = 138544386;
      v67 = v43;
      v68 = 2112;
      v69 = v64;
      v70 = 2112;
      v71 = v11;
      v72 = 2112;
      v73 = v12;
      v74 = 2112;
      v75 = v13;
      _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_INFO, "%{public}@Successfully created operational certificates from resident for fabric ID %@. Root Certificate %@, Operational certificate %@, Owner NodeID %@", buf, 0x34u);
    }

    objc_autoreleasePoolPop(v40);
    v44 = [objc_alloc(MEMORY[0x277D17B58]) initWithRootCert:v11 ipk:v14 residentNodeID:v13 operationalCert:v12 operationalKeyPair:*(a1 + 48)];
    v45 = objc_autoreleasePoolPush();
    v46 = *(a1 + 32);
    v47 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
    {
      v48 = HMFGetLogIdentifier();
      *buf = 138543618;
      v67 = v48;
      v68 = 2112;
      v69 = v44;
      _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Caching operational fabric data %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v45);
    [*(a1 + 32) storeSharedHomeFabricData:v44];
    v49 = *(a1 + 32);
    v65 = 0;
    [v49 setUpOperationalFabricDataWithError:&v65];
    v16 = v65;
    v50 = objc_autoreleasePoolPush();
    v51 = *(a1 + 32);
    v52 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v63 = v11;
      v53 = v13;
      v54 = v12;
      v55 = v14;
      v57 = v56 = v44;
      *buf = 138543618;
      v67 = v57;
      v68 = 2112;
      v69 = v16;
      _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_INFO, "%{public}@Set up new shared user fabric data with error: %@", buf, 0x16u);

      v44 = v56;
      v14 = v55;
      v12 = v54;
      v13 = v53;
      v11 = v63;
    }

    objc_autoreleasePoolPop(v50);
    v58 = *(a1 + 56);
    if (v58)
    {
      (*(v58 + 16))(v58, v16);
    }
  }

  else
  {
    v33 = objc_autoreleasePoolPush();
    v34 = *(a1 + 32);
    v35 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
    {
      v36 = HMFGetLogIdentifier();
      *buf = 138543362;
      v67 = v36;
      _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Shared user NOC info missing from resident response", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v33);
    v37 = *(a1 + 56);
    if (v37)
    {
      v38 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
      (*(v37 + 16))(v37, v38);
    }

    v16 = 0;
  }

  v59 = *MEMORY[0x277D85DE8];
}

- (void)prepareOperationalFabricData
{
  v17 = *MEMORY[0x277D85DE8];
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    v12 = 0;
    v3 = [(HMDHome *)self setUpOperationalFabricDataWithError:&v12];
    v4 = v12;
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
    if (v3)
    {
      if (v8)
      {
        v9 = HMFGetLogIdentifier();
        fabric = [(HMDHome *)selfCopy fabric];
        *buf = 138543618;
        v14 = v9;
        v15 = 2112;
        v16 = fabric;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Successfully set up operational fabric data for fabric %@", buf, 0x16u);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Delay setting up operational fabric data, matter data source not yet configured", buf, 0xCu);
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v5);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)setUpOperationalFabricDataWithError:(id *)error
{
  v44 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self fabricSetUpForPairing])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Operational fabric data set up is deferred till pairing is complete", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [MEMORY[0x277CCA9B8] hmfErrorWithCode:9];
    *error = v9 = 0;
  }

  else
  {
    v10 = [(HMDHome *)self fetchOperationalFabricDataWithError:error];
    if (*error)
    {
      v11 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v15 = *error;
        *buf = 138543618;
        v41 = v14;
        v42 = 2112;
        v43 = v15;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to set up operational fabric data due to failure to fetch data with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
      if ([(HMDHome *)selfCopy2 retainFabricDataWhenLocallyUnavailable])
      {
        v16 = objc_autoreleasePoolPush();
        v17 = selfCopy2;
        v18 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
        {
          v19 = HMFGetLogIdentifier();
          *buf = 138543362;
          v41 = v19;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Will keep using fabric data set up by pairing while fabric data isn't locally available", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v16);
      }

      else
      {
        [(HMDHome *)selfCopy2 clearAccessoryServerBrowserOperationalFabricData];
      }

      v20 = [*error copy];
      [(HMDHome *)selfCopy2 setOperationalFabricError:v20];
      v9 = 0;
    }

    else
    {
      [(HMDHome *)self setRetainFabricDataWhenLocallyUnavailable:0];
      if ([(HMDHome *)self isOwnerUser]&& ![(HMDHome *)self hasAnyResident])
      {
        v39 = 0;
        v20 = [(HMDHome *)self storedFabricDataWithError:&v39];
        v33 = v39;
        if (v33)
        {
          v34 = v33;
          v35 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v37 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
          {
            v38 = HMFGetLogIdentifier();
            *buf = 138543618;
            v41 = v38;
            v42 = 2112;
            v43 = v20;
            _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_INFO, "%{public}@Ignoring error %@ while fetching owner stored fabric data to set up operational fabric data", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v35);
        }
      }

      else
      {
        v20 = 0;
      }

      matterFabricID = [(HMDHome *)self matterFabricID];
      if (!matterFabricID)
      {
        goto LABEL_17;
      }

      v22 = matterFabricID;
      matterFabricID2 = [(HMDHome *)self matterFabricID];
      fabricID = [v10 fabricID];
      v25 = [matterFabricID2 isEqual:fabricID];

      if ((v25 & 1) == 0)
      {
LABEL_17:
        fabricID2 = [v10 fabricID];
        fabric = [(HMDHome *)self fabric];
        [fabric setFabricID:fabricID2];

        fabricID3 = [v10 fabricID];
        chipStorage = [(HMDHome *)self chipStorage];
        [chipStorage setFabricID:fabricID3];
      }

      v9 = [(HMDHome *)self setUpAccessoryServerBrowserWithOperationalFabricData:v10 ownerDataSnapshot:v20 error:error];
      if (*error)
      {
        v30 = [*error copy];
        [(HMDHome *)self setOperationalFabricError:v30];
      }

      else
      {
        [(HMDHome *)self setOperationalFabricError:0];
      }
    }
  }

  v31 = *MEMORY[0x277D85DE8];
  return v9;
}

- (void)unsetFabricForPairing
{
  v11 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setRetainFabricDataWhenLocallyUnavailable:[(HMDHome *)self fabricSetUpForPairing]];
  [(HMDHome *)self setFabricSetUpForPairing:0];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v10 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Attempting to set operational fabric data after pairing completion", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v8 = 0;
  [(HMDHome *)selfCopy setUpOperationalFabricDataWithError:&v8];
  v7 = *MEMORY[0x277D85DE8];
}

- (void)setUpFabricForPairingWithCompletion:(id)completion
{
  completionCopy = completion;
  [(HMDHome *)self setFabricSetUpForPairing:1];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_CHIP__setUpFabricForPairingWithCompletion___block_invoke;
  v6[3] = &unk_27866EF88;
  v6[4] = self;
  v7 = completionCopy;
  v5 = completionCopy;
  [(HMDHome *)self fetchFabricDataForPairingWithCompletion:v6];
}

void __53__HMDHome_CHIP__setUpFabricForPairingWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v31 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = *(a1 + 32);
  if (v9)
  {
    [v10 setFabricSetUpForPairing:0];
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v14;
      v29 = 2112;
      v30 = v9;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch fabric data to set up fabric for pairing: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
  }

  else
  {
    v15 = [v10 matterFabricID];
    if (!v15)
    {
      goto LABEL_7;
    }

    v16 = v15;
    v17 = [*(a1 + 32) matterFabricID];
    v18 = [v7 fabricID];
    v19 = [v17 isEqual:v18];

    if ((v19 & 1) == 0)
    {
LABEL_7:
      v20 = [v7 fabricID];
      v21 = [*(a1 + 32) fabric];
      [v21 setFabricID:v20];

      v22 = [v7 fabricID];
      v23 = [*(a1 + 32) chipStorage];
      [v23 setFabricID:v22];
    }

    v24 = *(a1 + 32);
    v26 = 0;
    [v24 setUpAccessoryServerBrowserWithOperationalFabricData:v7 ownerDataSnapshot:v8 error:&v26];
    v9 = v26;
    if (v9)
    {
      [*(a1 + 32) setFabricSetUpForPairing:0];
    }
  }

  (*(*(a1 + 40) + 16))();

  v25 = *MEMORY[0x277D85DE8];
}

- (void)handleUserFabricKeyUpdate:(id)update
{
  v17 = *MEMORY[0x277D85DE8];
  updateCopy = update;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v16 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling user fabric key update", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  homeManager = [(HMDHome *)selfCopy homeManager];
  hasLoadedData = [homeManager hasLoadedData];

  if ([(HMDHome *)selfCopy isCurrentDevicePrimaryResident])
  {
    goto LABEL_7;
  }

  featuresDataSource = [(HMDHome *)selfCopy featuresDataSource];
  if (([featuresDataSource isRVCEnabled] & hasLoadedData) == 1)
  {

LABEL_7:
    v14 = 0;
    [(HMDHome *)selfCopy setUpOperationalFabricDataWithError:&v14];

    goto LABEL_8;
  }

  v12 = isFeatureMatteriPhoneOnlyPairingControlEnabled() & hasLoadedData;

  if (v12 == 1)
  {
    goto LABEL_7;
  }

LABEL_8:

  v13 = *MEMORY[0x277D85DE8];
}

- (void)handleCATUpdate
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v16 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Handling CAT update", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  homeManager = [(HMDHome *)selfCopy homeManager];
  if ([(HMDHome *)selfCopy isOwnerUser])
  {
    if ([(HMDHome *)selfCopy isCurrentDevicePrimaryResident])
    {
      accessoryBrowser = [homeManager accessoryBrowser];
      chipAccessoryServerBrowser = [accessoryBrowser chipAccessoryServerBrowser];
      fabric = [(HMDHome *)selfCopy fabric];
      [chipAccessoryServerBrowser updateAccessoryACLForFabric:fabric];
    }

    else
    {
      v14 = 0;
      [(HMDHome *)selfCopy setUpOperationalFabricDataWithError:&v14];
    }
  }

  else
  {
    objc_initWeak(buf, selfCopy);
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __32__HMDHome_CHIP__handleCATUpdate__block_invoke;
    v12[3] = &unk_278688A18;
    objc_copyWeak(&v13, buf);
    [(HMDHome *)selfCopy setUpSharedUserFabricDataWithForceFetch:1 completion:v12];
    objc_destroyWeak(&v13);
    objc_destroyWeak(buf);
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __32__HMDHome_CHIP__handleCATUpdate__block_invoke(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v8;
    v12 = 2112;
    v13 = v3;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Completed CAT update handling with error: %@", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = *MEMORY[0x277D85DE8];
}

- (void)setCHIPReportHandlerWithSubscriber:(id)subscriber handler:(id)handler
{
  subscriberCopy = subscriber;
  handlerCopy = handler;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __60__HMDHome_CHIP__setCHIPReportHandlerWithSubscriber_handler___block_invoke;
  block[3] = &unk_278689F98;
  v12 = subscriberCopy;
  v13 = handlerCopy;
  block[4] = self;
  v9 = subscriberCopy;
  v10 = handlerCopy;
  dispatch_async(workQueue, block);
}

void __60__HMDHome_CHIP__setCHIPReportHandlerWithSubscriber_handler___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 48);
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 40);
      v16 = 138543618;
      v17 = v7;
      v18 = 2112;
      v19 = v8;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEBUG, "%{public}@Register CHIP report handler for subscriber %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v9 = [*(a1 + 32) chipLocalSubscribers];

    if (!v9)
    {
      v10 = objc_alloc_init(MEMORY[0x277CBEB38]);
      [*(a1 + 32) setChipLocalSubscribers:v10];
    }

    v11 = _Block_copy(*(a1 + 48));
    v12 = [*(a1 + 32) chipLocalSubscribers];
    [v12 setObject:v11 forKeyedSubscript:*(a1 + 40)];
  }

  else
  {
    if (v6)
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 40);
      v16 = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = v14;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEBUG, "%{public}@Deregister CHIP report handler for subscriber %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v11 = [*(a1 + 32) chipLocalSubscribers];
    [v11 setObject:0 forKeyedSubscript:*(a1 + 40)];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)finishPairingForServer:(id)server
{
  serverCopy = server;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = serverCopy;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  [v5 finishPairing];

  if (![(HMDHome *)self hasAnyResident])
  {
    [(HMDHome *)self updateHomeLocationForPairing];
  }
}

- (void)_saveAndSyncMatterFabricIDWithCompletion:(id)completion
{
  completionCopy = completion;
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [(HMDHome *)self emptyModelObjectWithChangeType:2];
    fabric = [(HMDHome *)self fabric];
    fabricID = [fabric fabricID];
    [v5 setMatterFabricID:fabricID];

    backingStore = [(HMDHome *)self backingStore];
    v9 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v10 = [backingStore transaction:@"Update Matter Fabric ID" options:v9];

    [v10 add:v5];
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __58__HMDHome_CHIP___saveAndSyncMatterFabricIDWithCompletion___block_invoke;
    v12[3] = &unk_278689A68;
    v12[4] = self;
    v13 = completionCopy;
    [v10 run:v12];
  }

  else
  {
    v11 = _Block_copy(completionCopy);
    v5 = v11;
    if (v11)
    {
      (*(v11 + 2))(v11, 0);
    }
  }
}

void __58__HMDHome_CHIP___saveAndSyncMatterFabricIDWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v9 = [*(a1 + 32) fabric];
    v10 = [v9 fabricID];
    v17 = 138543618;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v11 = "%{public}@Failed to sync Matter Fabric ID to %@";
    v12 = v7;
    v13 = OS_LOG_TYPE_ERROR;
  }

  else
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v9 = [*(a1 + 32) fabric];
    v10 = [v9 fabricID];
    v17 = 138543618;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v11 = "%{public}@Successfully sync'ed Matter Fabric ID to %@";
    v12 = v7;
    v13 = OS_LOG_TYPE_INFO;
  }

  _os_log_impl(&dword_229538000, v12, v13, v11, &v17, 0x16u);

LABEL_7:
  objc_autoreleasePoolPop(v4);
  v14 = _Block_copy(*(a1 + 40));
  v15 = v14;
  if (v14)
  {
    (*(v14 + 2))(v14, v3);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)updateFabricUsingHomeModel:(id)model
{
  v54 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  setProperties = [modelCopy setProperties];
  if (![setProperties containsObject:@"matterFabricID"])
  {
    goto LABEL_11;
  }

  fabric = [(HMDHome *)self fabric];
  fabricID = [fabric fabricID];
  matterFabricID = [modelCopy matterFabricID];
  v9 = HMFEqualObjects();

  if (v9 || ([modelCopy matterFabricID], (v10 = objc_claimAutoreleasedReturnValue()) == 0))
  {
LABEL_11:

    goto LABEL_12;
  }

  v11 = v10;
  v12 = [v10 isEqualToNumber:&unk_283E71918];

  if (v12)
  {
LABEL_12:
    v25 = 0;
    goto LABEL_13;
  }

  fabric2 = [(HMDHome *)self fabric];
  fabricID2 = [fabric2 fabricID];

  v15 = objc_autoreleasePoolPush();
  selfCopy = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    fabric3 = [(HMDHome *)selfCopy fabric];
    fabricID3 = [fabric3 fabricID];
    matterFabricID2 = [modelCopy matterFabricID];
    v48 = 138543874;
    v49 = v18;
    v50 = 2112;
    v51 = fabricID3;
    v52 = 2112;
    v53 = matterFabricID2;
    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Updating fabric ID from %@ to %@", &v48, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  matterFabricID3 = [modelCopy matterFabricID];
  fabric4 = [(HMDHome *)selfCopy fabric];
  [fabric4 setFabricID:matterFabricID3];

  if (fabricID2 && ([fabricID2 isEqualToNumber:&unk_283E71918] & 1) == 0)
  {
    fabric5 = [(HMDHome *)selfCopy fabric];
    [fabric5 invalidateCachedData];
  }

  v25 = 1;
LABEL_13:
  chipStorage = [(HMDHome *)self chipStorage];
  fabricID4 = [chipStorage fabricID];
  v28 = fabricID4;
  if (fabricID4 && ([fabricID4 isEqualToNumber:&unk_283E71918] & 1) == 0)
  {
    fabric6 = [(HMDHome *)self fabric];
    fabricID5 = [fabric6 fabricID];
    chipStorage2 = [(HMDHome *)self chipStorage];
    fabricID6 = [chipStorage2 fabricID];
    v34 = HMFEqualObjects();

    if (v34)
    {
      if (!v25)
      {
        goto LABEL_16;
      }
    }

    else
    {
      v35 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
      {
        v38 = HMFGetLogIdentifier();
        fabric7 = [(HMDHome *)selfCopy2 fabric];
        fabricID7 = [fabric7 fabricID];
        chipStorage3 = [(HMDHome *)selfCopy2 chipStorage];
        fabricID8 = [chipStorage3 fabricID];
        v48 = 138543874;
        v49 = v38;
        v50 = 2112;
        v51 = fabricID7;
        v52 = 2112;
        v53 = fabricID8;
        _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_INFO, "%{public}@Updating fabric ID from CHIPStorage from %@ to %@", &v48, 0x20u);
      }

      objc_autoreleasePoolPop(v35);
      chipStorage4 = [(HMDHome *)selfCopy2 chipStorage];
      fabricID9 = [chipStorage4 fabricID];
      fabric8 = [(HMDHome *)selfCopy2 fabric];
      [fabric8 setFabricID:fabricID9];
    }

LABEL_23:
    [(HMDHome *)self _saveAndSyncMatterFabricIDWithCompletion:0];
    v29 = 1;
    goto LABEL_24;
  }

  if (v25)
  {
    goto LABEL_23;
  }

LABEL_16:
  v29 = 0;
LABEL_24:

  v46 = *MEMORY[0x277D85DE8];
  return v29;
}

- (BOOL)updateMatterFabricIDIfNeeded
{
  chipStorage = [(HMDHome *)self chipStorage];
  fabricID = [chipStorage fabricID];
  if (fabricID)
  {
    v5 = fabricID;
    v6 = [fabricID isEqualToNumber:&unk_283E71918];

    if ((v6 & 1) == 0)
    {
      chipStorage2 = [(HMDHome *)self chipStorage];
      fabricID2 = [chipStorage2 fabricID];
      fabric = [(HMDHome *)self fabric];
      [fabric setFabricID:fabricID2];

      [(HMDHome *)self _saveAndSyncMatterFabricIDWithCompletion:0];
      return 1;
    }
  }

  else
  {
  }

  return 0;
}

- (void)handleUpdatedCHIPPropertiesOnHomeModel:(id)model actions:(id)actions
{
  modelCopy = model;
  actionsCopy = actions;
  chipStorage = [(HMDHome *)self chipStorage];
  v9 = [chipStorage updateUsingHomeModel:modelCopy];

  if (isFeatureMatterLocalFabricConfigEnabled() && [(HMDHome *)self updateFabricUsingHomeModel:modelCopy])
  {
    [actionsCopy markChanged];
  }

  if (v9)
  {
    workQueue = [(HMDHome *)self workQueue];
    v12 = MEMORY[0x277D85DD0];
    v13 = 3221225472;
    v14 = __64__HMDHome_CHIP__handleUpdatedCHIPPropertiesOnHomeModel_actions___block_invoke;
    v15 = &unk_27868A750;
    selfCopy = self;
    v11 = actionsCopy;
    v17 = v11;
    dispatch_async(workQueue, &v12);

    [v11 markChanged];
  }
}

void __64__HMDHome_CHIP__handleUpdatedCHIPPropertiesOnHomeModel_actions___block_invoke(uint64_t a1)
{
  v22 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) homeManager];
  if (([v2 hasLoadedData] & 1) == 0)
  {

    goto LABEL_10;
  }

  if (([*(a1 + 32) isCurrentDevicePrimaryResident] & 1) == 0)
  {
    v3 = [*(a1 + 32) featuresDataSource];
    if ([v3 isRVCEnabled])
    {

      goto LABEL_5;
    }

    v14 = isFeatureMatteriPhoneOnlyPairingControlEnabled();

    if (v14)
    {
      goto LABEL_6;
    }

LABEL_10:
    v5 = 0;
    goto LABEL_11;
  }

LABEL_5:

LABEL_6:
  v4 = *(a1 + 32);
  v15 = 0;
  [v4 setUpOperationalFabricDataWithError:&v15];
  v5 = v15;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v19 = v9;
    v20 = 2112;
    v21 = v5;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Set up operational fabric data per CHIP properties change on home model with error: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
LABEL_11:
  v10 = [*(a1 + 40) source] < 2;
  v16 = @"HMDHomeCHIPStorageIsLocalChangeNotificationKey";
  v11 = [MEMORY[0x277CCABB0] numberWithBool:v10];
  v17 = v11;
  v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v17 forKeys:&v16 count:1];

  logAndPostNotification(@"HMDHomeCHIPStorageUpdatedNotification", *(a1 + 32), v12);
  v13 = *MEMORY[0x277D85DE8];
}

- (void)_writeLogData:(id)data logName:(id)name completion:(id)completion
{
  v44 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  nameCopy = name;
  completionCopy = completion;
  v11 = completionCopy;
  if (dataCopy && nameCopy)
  {
    homeManager = [(HMDHome *)self homeManager];
    chipDataSource = [homeManager chipDataSource];
    fileManager = [chipDataSource fileManager];

    v15 = MEMORY[0x277CBEBC0];
    v16 = HMDCreateHomeKitDaemonCacheDirectory();
    v17 = [v15 fileURLWithPath:v16];

    v18 = [v17 URLByAppendingPathComponent:@"MatterDiagnostics"];

    v37 = 0;
    LOBYTE(v16) = [fileManager createDirectoryAtURL:v18 withIntermediateDirectories:1 attributes:0 error:&v37];
    v19 = v37;
    if (v16)
    {
      v20 = [v18 URLByAppendingPathComponent:nameCopy];
      v36 = v19;
      v21 = [fileManager writeData:dataCopy toURL:v20 options:0 error:&v36];
      v22 = v36;

      if ((v21 & 1) == 0)
      {
        v23 = objc_autoreleasePoolPush();
        selfCopy = self;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v26 = v35 = v23;
          *buf = 138543874;
          v39 = v26;
          v40 = 2112;
          v41 = v20;
          v42 = 2112;
          v43 = v22;
          _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Failed to write log file to path: %@ error: %@", buf, 0x20u);

          v23 = v35;
        }

        objc_autoreleasePoolPop(v23);
        v20 = 0;
      }

      v27 = _Block_copy(v11);
      if (v27)
      {
        path = [v20 path];
        v27[2](v27, path, v22);
      }
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543874;
        v39 = v32;
        v40 = 2112;
        v41 = v18;
        v42 = 2112;
        v43 = v19;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Failed to create directory at path: %@ error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
      v33 = _Block_copy(v11);
      v20 = v33;
      if (v33)
      {
        (*(v33 + 2))(v33, 0, v19);
      }

      v22 = v19;
    }

    goto LABEL_19;
  }

  fileManager = _Block_copy(completionCopy);
  if (fileManager)
  {
    v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (fileManager)[2](fileManager, 0, v18);
LABEL_19:
  }

  v34 = *MEMORY[0x277D85DE8];
}

- (void)downloadLogWithController:(id)controller nodeId:(id)id type:(int64_t)type timeout:(double)timeout completion:(id)completion
{
  idCopy = id;
  completionCopy = completion;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  [dictionary setCHIPRemoteCommand:*MEMORY[0x277D17C70]];
  v14 = [MEMORY[0x277CCABB0] numberWithInteger:type];
  [dictionary setCHIPDownloadLogType:v14];

  v15 = [MEMORY[0x277CCABB0] numberWithDouble:timeout];
  [dictionary setCHIPDownloadTimeout:v15];

  if (timeout)
  {
    v16 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:(timeout + 10.0)];
    [dictionary setCHIPRemoteMessageTimeout:v16];
  }

  unsignedLongValue = [idCopy unsignedLongValue];
  v18 = [dictionary copy];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __74__HMDHome_CHIP__downloadLogWithController_nodeId_type_timeout_completion___block_invoke;
  v20[3] = &unk_27867D090;
  v20[4] = self;
  v21 = completionCopy;
  v19 = completionCopy;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:unsignedLongValue payload:v18 completion:v20];
}

void __74__HMDHome_CHIP__downloadLogWithController_nodeId_type_timeout_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v16 = 138543874;
    v17 = v10;
    v18 = 2112;
    v19 = v5;
    v20 = 2112;
    v21 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Download log response: %@, error: %@", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = [v5 hmf_dataForKey:*MEMORY[0x277D17C98]];
  v12 = [v5 hmf_stringForKey:*MEMORY[0x277D17CA0]];
  if (v6)
  {
    v13 = _Block_copy(*(a1 + 40));
    v14 = v13;
    if (v13)
    {
      (*(v13 + 2))(v13, 0, v6);
    }
  }

  else
  {
    [*(a1 + 32) _writeLogData:v11 logName:v12 completion:*(a1 + 40)];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)submitRvcUsageLogEventForNodeID:(unint64_t)d endpointID:(id)iD source:(unint64_t)source error:(id)error
{
  iDCopy = iD;
  errorCopy = error;
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke;
  v14[3] = &unk_27866EF60;
  v14[4] = self;
  v15 = iDCopy;
  dCopy = d;
  sourceCopy = source;
  v16 = errorCopy;
  v12 = errorCopy;
  v13 = iDCopy;
  [(HMDHome *)self readAttributeWithNodeId:d endpointId:v13 clusterId:&unk_283E718A0 attributeId:&unk_283E718B8 params:0 completion:v14];
}

void __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v42 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543618;
      v39 = v10;
      v40 = 2112;
      v41 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned error for current clean mode read, cannot submit clean modes in RVCUsageLogEvent. readCurrentCleanModeError=%@", buf, 0x16u);
    }

    v11 = v7;
LABEL_12:
    objc_autoreleasePoolPop(v11);
    v20 = 0;
    goto LABEL_13;
  }

  v12 = v5;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v13 = v12;
  }

  else
  {
    v13 = 0;
  }

  v14 = v13;

  v15 = [v14 hmf_isEmpty];
  if (v15)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = *(a1 + 32);
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v39 = v19;
      v40 = 2112;
      v41 = v12;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned incorrect data for readCurrentCleanModeValues, cannot submit clean modes in RVCUsageLogEvent. readCurrentCleanModeValues=%@", buf, 0x16u);
    }

    v11 = v16;
    goto LABEL_12;
  }

  v28 = [v12 objectAtIndexedSubscript:0];
  v29 = [v28 objectForKeyedSubscript:*MEMORY[0x277CD50D8]];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v30 = v29;
  }

  else
  {
    v30 = 0;
  }

  v31 = v30;

  v20 = [v31 hmf_numberForKey:*MEMORY[0x277CD51A0]];

LABEL_13:
  v21 = *(a1 + 56);
  v23 = *(a1 + 32);
  v22 = *(a1 + 40);
  v32[0] = MEMORY[0x277D85DD0];
  v32[1] = 3221225472;
  v32[2] = __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_331;
  v32[3] = &unk_27866EF38;
  v32[4] = v23;
  v33 = v20;
  v36 = v21;
  v24 = v22;
  v25 = *(a1 + 64);
  v34 = v24;
  v37 = v25;
  v35 = *(a1 + 48);
  v26 = v20;
  [v23 readAttributeWithNodeId:v21 endpointId:v24 clusterId:&unk_283E718A0 attributeId:&unk_283E718D0 params:0 completion:v32];

  v27 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_331(uint64_t a1, void *a2, void *a3)
{
  v61 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = &unk_22A586000;
  if (v6)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v11;
      v59 = 2112;
      v60 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned error for supported clean modes, cannot submit clean modes in RVCUsageLogEvent. readSupportedCleanModesError=%@", buf, 0x16u);
    }

LABEL_12:
    objc_autoreleasePoolPop(v8);
    v18 = 0;
    goto LABEL_13;
  }

  v12 = v5;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v13 = v12;
  }

  else
  {
    v13 = 0;
  }

  v14 = v13;

  v15 = [v14 hmf_isEmpty];
  if (v15)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v17;
      v59 = 2112;
      v60 = v12;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned incorrect data for readSupportedCleanModesValues, cannot submit clean modes in RVCUsageLogEvent. readSupportedCleanModesValues=%@", buf, 0x16u);
    }

    goto LABEL_12;
  }

  v24 = [v12 objectAtIndexedSubscript:0];
  v25 = *MEMORY[0x277CD50D8];
  v26 = [v24 objectForKeyedSubscript:*MEMORY[0x277CD50D8]];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v27 = v26;
  }

  else
  {
    v27 = 0;
  }

  v28 = v27;

  v29 = *MEMORY[0x277CD51A0];
  v50 = v28;
  v30 = [v28 hmf_arrayForKey:*MEMORY[0x277CD51A0]];
  v55[0] = MEMORY[0x277D85DD0];
  v55[1] = 3221225472;
  v55[2] = __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_332;
  v55[3] = &unk_278686BA8;
  v56 = *(a1 + 40);
  v31 = [v30 na_firstObjectPassingTest:v55];
  v32 = [v31 objectForKeyedSubscript:v25];
  v33 = [v32 objectForKeyedSubscript:v29];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v34 = v33;
  }

  else
  {
    v34 = 0;
  }

  v35 = v34;

  v36 = [v35 count];
  if (v36 < 3)
  {
    v46 = objc_autoreleasePoolPush();
    v47 = *(a1 + 32);
    v48 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
    {
      v49 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v49;
      v59 = 2112;
      v60 = v12;
      _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned incorrect data for readSupportedCleanModesValues, cannot submit clean modes in RVCUsageLogEvent. readSupportedCleanModesValues=%@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v46);
    v18 = 0;
  }

  else
  {
    v37 = [v31 objectForKeyedSubscript:v25];
    v38 = [v37 objectForKeyedSubscript:v29];
    v39 = [v38 objectAtIndexedSubscript:2];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v40 = v39;
    }

    else
    {
      v40 = 0;
    }

    v41 = v40;

    v42 = [v41 objectForKeyedSubscript:v25];

    v43 = [v42 objectForKeyedSubscript:v29];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v44 = v43;
    }

    else
    {
      v44 = 0;
    }

    v45 = v44;

    v18 = [v45 na_map:&__block_literal_global_9038];
  }

  v7 = &unk_22A586000;
LABEL_13:
  v19 = *(a1 + 32);
  v51[0] = MEMORY[0x277D85DD0];
  v51[1] = v7[441];
  v51[2] = __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_339;
  v51[3] = &unk_27866EF10;
  v20 = *(a1 + 64);
  v54 = *(a1 + 72);
  v51[4] = v19;
  v52 = v18;
  v21 = *(a1 + 48);
  v53 = *(a1 + 56);
  v22 = v18;
  [v19 readAttributeWithNodeId:v20 endpointId:v21 clusterId:&unk_283E718E8 attributeId:&unk_283E71900 params:0 completion:v51];

  v23 = *MEMORY[0x277D85DE8];
}

uint64_t __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_332(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *MEMORY[0x277CD50D8];
  v5 = [v3 objectForKeyedSubscript:*MEMORY[0x277CD50D8]];
  v6 = *MEMORY[0x277CD51A0];
  v7 = [v5 objectForKeyedSubscript:*MEMORY[0x277CD51A0]];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  v10 = [v9 count];
  if (v10 >= 2)
  {
    v12 = [v3 objectForKeyedSubscript:v4];
    v13 = [v12 objectForKeyedSubscript:v6];
    v14 = [v13 objectAtIndexedSubscript:1];
    v15 = [v14 objectForKeyedSubscript:v4];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v16 = v15;
    }

    else
    {
      v16 = 0;
    }

    v17 = v16;

    v18 = [v17 hmf_numberForKey:v6];

    v11 = [v18 isEqual:*(a1 + 32)];
  }

  else
  {
    v11 = 0;
  }

  return v11;
}

void __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_339(uint64_t a1, void *a2, void *a3)
{
  v39 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      v35 = 138543618;
      v36 = v10;
      v37 = 2112;
      v38 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned error for selected areas, cannot submit roomCount in RVCUsageLogEvent. readSelectedAreasError=%@", &v35, 0x16u);
    }

    v11 = v7;
LABEL_12:
    objc_autoreleasePoolPop(v11);
    v20 = 0;
    goto LABEL_13;
  }

  v12 = v5;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v13 = v12;
  }

  else
  {
    v13 = 0;
  }

  v14 = v13;

  v15 = [v14 hmf_isEmpty];
  if (v15)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = *(a1 + 32);
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v35 = 138543618;
      v36 = v19;
      v37 = 2112;
      v38 = v12;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned incorrect data for readSelectedAreasValues, cannot submit roomCount in RVCUsageLogEvent. readSelectedAreasValues=%@", &v35, 0x16u);
    }

    v11 = v16;
    goto LABEL_12;
  }

  v30 = [v12 objectAtIndexedSubscript:0];
  v31 = [v30 objectForKeyedSubscript:*MEMORY[0x277CD50D8]];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v32 = v31;
  }

  else
  {
    v32 = 0;
  }

  v33 = v32;

  v34 = [v33 hmf_arrayForKey:*MEMORY[0x277CD51A0]];

  v20 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v34, "count")}];

LABEL_13:
  v21 = *(a1 + 56);
  v22 = [v20 isEqual:&unk_283E71918];
  if ([v20 isEqual:&unk_283E71918])
  {
    v23 = 0;
  }

  else
  {
    v23 = v20;
  }

  v24 = MEMORY[0x277CCABB0];
  v25 = [*(a1 + 32) rooms];
  v26 = [v24 numberWithUnsignedInteger:{objc_msgSend(v25, "count")}];
  v27 = [HMDRVCUsageLogEvent eventWithSource:v21 wholeHouse:v22 roomCount:v23 roomsInHome:v26 cleanModes:*(a1 + 40)];

  v28 = [*(a1 + 32) logEventSubmitter];
  [v28 submitLogEvent:v27 error:*(a1 + 48)];

  v29 = *MEMORY[0x277D85DE8];
}

id __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = *MEMORY[0x277CD50D8];
  v4 = [v2 objectForKeyedSubscript:*MEMORY[0x277CD50D8]];
  v5 = *MEMORY[0x277CD51A0];
  v6 = [v4 objectForKeyedSubscript:*MEMORY[0x277CD51A0]];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  v9 = [v8 count];
  v10 = 0;
  if (v9 >= 2)
  {
    v11 = [v2 objectForKeyedSubscript:v3];
    v12 = [v11 objectForKeyedSubscript:v5];
    v13 = [v12 objectAtIndexedSubscript:1];
    v14 = [v13 objectForKeyedSubscript:v3];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;

    v10 = [v16 hmf_numberForKey:v5];
  }

  return v10;
}

- (void)invokeCommandWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId commandId:(id)commandId fields:(id)fields timedInvokeTimeout:(id)timeout source:(unint64_t)source completion:(id)self0
{
  v44 = *MEMORY[0x277D85DE8];
  endpointIdCopy = endpointId;
  clusterIdCopy = clusterId;
  commandIdCopy = commandId;
  fieldsCopy = fields;
  timeoutCopy = timeout;
  completionCopy = completion;
  featuresDataSource = [(HMDHome *)self featuresDataSource];
  isRVCEnabled = [featuresDataSource isRVCEnabled];

  if (isRVCEnabled)
  {
    v22 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:id];
    v23 = [(HMDHome *)self matterAccessoryWithNodeID:v22];
    matterAdapter = [v23 matterAdapter];

    if ([matterAdapter useMatterPlugin])
    {
      v25 = objc_autoreleasePoolPush();
      selfCopy = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_DEBUG))
      {
        v28 = HMFGetLogIdentifier();
        *buf = 138543362;
        v43 = v28;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEBUG, "%{public}@HMDHome+CHIP Matter API is not supported for accessories that use MatterPlugin", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
      v29 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      completionCopy[2](completionCopy, 0, v29);

      v30 = fieldsCopy;
      v31 = timeoutCopy;
      goto LABEL_12;
    }
  }

  matterAdapter = objc_alloc_init(MEMORY[0x277CBEB38]);
  [matterAdapter setCHIPRemoteCommand:*MEMORY[0x277D17C68]];
  [matterAdapter setCHIPEndpointId:endpointIdCopy clusterId:clusterIdCopy commandId:commandIdCopy];
  v30 = fieldsCopy;
  if (fieldsCopy)
  {
    [matterAdapter setCHIPCommandFields:fieldsCopy];
  }

  v31 = timeoutCopy;
  if (timeoutCopy)
  {
    [matterAdapter setCHIPTimedInvokeTimeout:timeoutCopy];
  }

  v35[0] = MEMORY[0x277D85DD0];
  v35[1] = 3221225472;
  v35[2] = __116__HMDHome_CHIP__invokeCommandWithNodeId_endpointId_clusterId_commandId_fields_timedInvokeTimeout_source_completion___block_invoke;
  v35[3] = &unk_27866EEC8;
  v35[4] = self;
  v39 = completionCopy;
  idCopy = id;
  v36 = endpointIdCopy;
  v37 = clusterIdCopy;
  v38 = commandIdCopy;
  sourceCopy = source;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:id payload:matterAdapter completion:v35];

LABEL_12:
  v32 = *MEMORY[0x277D85DE8];
}

void __116__HMDHome_CHIP__invokeCommandWithNodeId_endpointId_clusterId_commandId_fields_timedInvokeTimeout_source_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Invoke command response: %@, error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 64);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  [*(a1 + 32) submitLogEventForCommandResponse:v5 nodeID:*(a1 + 72) endpointID:*(a1 + 40) clusterID:*(a1 + 48) commandID:*(a1 + 56) source:*(a1 + 80) error:v6];
  v13 = *MEMORY[0x277D85DE8];
}

- (void)writeAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId value:(id)value timedWriteTimeout:(id)timeout completion:(id)completion
{
  v43 = *MEMORY[0x277D85DE8];
  endpointIdCopy = endpointId;
  clusterIdCopy = clusterId;
  attributeIdCopy = attributeId;
  valueCopy = value;
  timeoutCopy = timeout;
  completionCopy = completion;
  featuresDataSource = [(HMDHome *)self featuresDataSource];
  isRVCEnabled = [featuresDataSource isRVCEnabled];

  if (isRVCEnabled)
  {
    v32 = completionCopy;
    v23 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:id];
    v24 = [(HMDHome *)self matterAccessoryWithNodeID:v23];
    matterAdapter = [v24 matterAdapter];

    if ([matterAdapter useMatterPlugin])
    {
      v26 = objc_autoreleasePoolPush();
      selfCopy = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_DEBUG))
      {
        v29 = HMFGetLogIdentifier();
        *buf = 138543362;
        v42 = v29;
        _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_DEBUG, "%{public}@HMDHome+CHIP Matter API is not supported for accessories that use MatterPlugin", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v26);
      v30 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      v32[2](v32, 0, v30);

      completionCopy = v32;
      goto LABEL_10;
    }

    completionCopy = v32;
  }

  matterAdapter = objc_alloc_init(MEMORY[0x277CBEB38]);
  [matterAdapter setCHIPRemoteCommand:*MEMORY[0x277D17C90]];
  [matterAdapter setCHIPEndpointId:endpointIdCopy clusterId:clusterIdCopy attributeId:attributeIdCopy];
  [matterAdapter setCHIPData:valueCopy];
  if (timeoutCopy)
  {
    [matterAdapter setCHIPTimedWriteTimeout:timeoutCopy];
  }

  v33[0] = MEMORY[0x277D85DD0];
  v33[1] = 3221225472;
  v33[2] = __110__HMDHome_CHIP__writeAttributeWithNodeId_endpointId_clusterId_attributeId_value_timedWriteTimeout_completion___block_invoke;
  v33[3] = &unk_27866EEA0;
  v33[4] = self;
  v39 = completionCopy;
  idCopy = id;
  v34 = endpointIdCopy;
  v35 = clusterIdCopy;
  v36 = attributeIdCopy;
  v37 = valueCopy;
  v38 = timeoutCopy;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:id payload:matterAdapter completion:v33];

LABEL_10:
  v31 = *MEMORY[0x277D85DE8];
}

void __110__HMDHome_CHIP__writeAttributeWithNodeId_endpointId_clusterId_attributeId_value_timedWriteTimeout_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Write attribute response: %@, error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 80);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  [*(a1 + 32) submitLogEventForWriteAttributeWithNodeId:*(a1 + 88) endpointId:*(a1 + 40) clusterId:*(a1 + 48) attributeId:*(a1 + 56) value:*(a1 + 64) timedWriteTimeout:*(a1 + 72) error:v6];
  v13 = *MEMORY[0x277D85DE8];
}

- (void)readAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId params:(id)params completion:(id)completion
{
  v34 = *MEMORY[0x277D85DE8];
  endpointIdCopy = endpointId;
  clusterIdCopy = clusterId;
  attributeIdCopy = attributeId;
  paramsCopy = params;
  completionCopy = completion;
  featuresDataSource = [(HMDHome *)self featuresDataSource];
  isRVCEnabled = [featuresDataSource isRVCEnabled];

  if (!isRVCEnabled)
  {
    goto LABEL_7;
  }

  v21 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:id];
  v22 = [(HMDHome *)self matterAccessoryWithNodeID:v21];
  matterAdapter = [v22 matterAdapter];

  if (![matterAdapter useMatterPlugin])
  {

LABEL_7:
    matterAdapter = objc_alloc_init(MEMORY[0x277CBEB38]);
    [matterAdapter setCHIPRemoteCommand:*MEMORY[0x277D17C80]];
    [matterAdapter setCHIPEndpointId:endpointIdCopy clusterId:clusterIdCopy attributeId:attributeIdCopy];
    [matterAdapter setCHIPEncodedParams:paramsCopy];
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __92__HMDHome_CHIP__readAttributeWithNodeId_endpointId_clusterId_attributeId_params_completion___block_invoke;
    v30[3] = &unk_27867D090;
    v30[4] = self;
    v31 = completionCopy;
    [(HMDHome *)self _sendRemoteMessageUsingNodeId:id payload:matterAdapter completion:v30];

    goto LABEL_8;
  }

  v24 = objc_autoreleasePoolPush();
  selfCopy = self;
  v26 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
  {
    v27 = HMFGetLogIdentifier();
    *buf = 138543362;
    v33 = v27;
    _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_DEBUG, "%{public}@HMDHome+CHIP Matter API is not supported for accessories that use MatterPlugin", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v24);
  v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
  (*(completionCopy + 2))(completionCopy, 0, v28);

LABEL_8:
  v29 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome_CHIP__readAttributeWithNodeId_endpointId_clusterId_attributeId_params_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    v14 = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Read attribute response: %@, error: %@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 40);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  v13 = *MEMORY[0x277D85DE8];
}

- (id)matterAccessoryWithNodeID:(id)d
{
  dCopy = d;
  matterAccessories = [(HMDHome *)self matterAccessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __43__HMDHome_CHIP__matterAccessoryWithNodeID___block_invoke;
  v9[3] = &unk_278681CA8;
  v10 = dCopy;
  v6 = dCopy;
  v7 = [matterAccessories na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __43__HMDHome_CHIP__matterAccessoryWithNodeID___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 matterNodeID];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (void)remotelyUpdateHomeModelWithCHIPKeyValueStore:(id)store removedKeys:(id)keys completion:(id)completion
{
  v56[1] = *MEMORY[0x277D85DE8];
  storeCopy = store;
  keysCopy = keys;
  completionCopy = completion;
  home = [(HMDHome *)self home];
  if (home)
  {
    v12 = MEMORY[0x277CBEB38];
    v55 = @"HMDHomeRemoteUpdateCHIPKeyValueStoreMessageKey";
    v56[0] = storeCopy;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v56 forKeys:&v55 count:1];
    v14 = [v12 dictionaryWithDictionary:v13];

    v46 = keysCopy;
    [v14 setObject:keysCopy forKeyedSubscript:@"HMDHomeRemoteUpdateCHIPRemovedKeysMessageKey"];
    v15 = objc_alloc(MEMORY[0x277D0F848]);
    v16 = objc_alloc(MEMORY[0x277D0F820]);
    messageTargetUUID = [home messageTargetUUID];
    v18 = [v16 initWithTarget:messageTargetUUID];
    v19 = [v15 initWithName:@"HMDHomeRemoteUpdateCHIPKeyValueStoreMessage" destination:v18 payload:v14];

    identifier = [v19 identifier];
    v48[0] = MEMORY[0x277D85DD0];
    v48[1] = 3221225472;
    v48[2] = __85__HMDHome_CHIP__remotelyUpdateHomeModelWithCHIPKeyValueStore_removedKeys_completion___block_invoke;
    v48[3] = &unk_2786862C0;
    v48[4] = self;
    v44 = identifier;
    v45 = completionCopy;
    v49 = v44;
    v21 = completionCopy;
    v50 = v21;
    [v19 setResponseHandler:v48];
    v22 = objc_autoreleasePoolPush();
    selfCopy = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      [v19 shortDescription];
      v27 = v26 = storeCopy;
      *buf = 138543618;
      v52 = v25;
      v53 = 2112;
      v54 = v27;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Remotely updating home model with CHIP key value store using message: %@", buf, 0x16u);

      storeCopy = v26;
    }

    objc_autoreleasePoolPop(v22);
    administratorHandler = [(HMDHome *)selfCopy administratorHandler];
    v47 = 0;
    v29 = [administratorHandler operationForMessage:v19 error:&v47];
    v30 = v47;

    if (v29)
    {
      administratorHandler2 = [(HMDHome *)selfCopy administratorHandler];
      [administratorHandler2 addOperation:v29];
      keysCopy = v46;
    }

    else
    {
      v36 = objc_autoreleasePoolPush();
      v37 = selfCopy;
      v38 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v43 = v36;
        v40 = v39 = storeCopy;
        *buf = 138543618;
        v52 = v40;
        v53 = 2112;
        v54 = v30;
        _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_ERROR, "%{public}@Failed to create home administration configuration operation for remotely updating home model with key value store: %@", buf, 0x16u);

        storeCopy = v39;
        v36 = v43;
      }

      objc_autoreleasePoolPop(v36);
      v41 = _Block_copy(v21);
      administratorHandler2 = v41;
      keysCopy = v46;
      if (v41)
      {
        (*(v41 + 2))(v41, v30);
      }
    }

    completionCopy = v45;

    goto LABEL_15;
  }

  v32 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v34 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
  {
    v35 = HMFGetLogIdentifier();
    *buf = 138543362;
    v52 = v35;
    _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Home reference is nil", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v32);
  v14 = _Block_copy(completionCopy);
  if (v14)
  {
    v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (v14)[2](v14, v19);
LABEL_15:
  }

  v42 = *MEMORY[0x277D85DE8];
}

void __85__HMDHome_CHIP__remotelyUpdateHomeModelWithCHIPKeyValueStore_removedKeys_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v5)
  {
    if (!os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 40);
    v21 = 138543874;
    v22 = v11;
    v23 = 2112;
    v24 = v12;
    v25 = 2112;
    v26 = v5;
    v13 = "%{public}@Failed to remotely update CHIP key value store for message %@: %@";
    v14 = v10;
    v15 = OS_LOG_TYPE_ERROR;
    v16 = 32;
  }

  else
  {
    if (!os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      goto LABEL_7;
    }

    v11 = HMFGetLogIdentifier();
    v17 = *(a1 + 40);
    v21 = 138543618;
    v22 = v11;
    v23 = 2112;
    v24 = v17;
    v13 = "%{public}@Successfully remotely updated CHIP key value store for message %@";
    v14 = v10;
    v15 = OS_LOG_TYPE_INFO;
    v16 = 22;
  }

  _os_log_impl(&dword_229538000, v14, v15, v13, &v21, v16);

LABEL_7:
  objc_autoreleasePoolPop(v7);
  v18 = _Block_copy(*(a1 + 48));
  v19 = v18;
  if (v18)
  {
    (*(v18 + 2))(v18, v5);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (BOOL)updateCHIPPropertiesOnHomeModel:(id)model usingUpdatedHomeInfo:(id)info
{
  modelCopy = model;
  v7 = [info objectForKeyedSubscript:@"HMDHomeModelUpdatedCHIPPropertiesMessageKeyFabricID"];
  if (v7 && (-[HMDHome chipStorage](self, "chipStorage"), v8 = objc_claimAutoreleasedReturnValue(), [v8 fabricID], v9 = objc_claimAutoreleasedReturnValue(), v10 = HMFEqualObjects(), v9, v8, (v10 & 1) == 0))
  {
    [modelCopy setChipFabricID:v7];
    [modelCopy setChipFabricIndex:v7];
    v11 = 1;
  }

  else
  {
    v11 = 0;
  }

  return v11;
}

+ (void)updateCHIPPropertiesOnAccessoryModel:(id)model forAddedHAPAccessoryServer:(id)server
{
  modelCopy = model;
  serverCopy = server;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = serverCopy;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;
  v8 = v7;
  if (v7)
  {
    nodeID = [v7 nodeID];
    [modelCopy setChipNodeID:nodeID];
  }
}

+ (BOOL)updateCHIPPropertiesOnHomeModel:(id)model forAddedHAPAccessoryServer:(id)server
{
  modelCopy = model;
  serverCopy = server;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = serverCopy;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;
  fabricID = [v8 fabricID];

  if (fabricID)
  {
    fabricID2 = [v8 fabricID];
    [modelCopy setChipFabricID:fabricID2];

    fabricID3 = [v8 fabricID];
    [modelCopy setChipFabricIndex:fabricID3];
  }

  return fabricID != 0;
}

+ (void)updateCHIPPropertiesOnMKFAccessoryModel:(id)model forAddedHAPAccessoryServer:(id)server
{
  modelCopy = model;
  serverCopy = server;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = serverCopy;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;
  v8 = v7;
  if (v7)
  {
    nodeID = [v7 nodeID];
    [modelCopy setMatterNodeID:nodeID];

    vendorID = [v8 vendorID];

    if (vendorID)
    {
      vendorID2 = [v8 vendorID];
      [modelCopy setMatterVendorID:vendorID2];
    }

    productID = [v8 productID];

    if (productID)
    {
      productID2 = [v8 productID];
      [modelCopy setMatterProductID:productID2];
    }

    v14 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v8, "isWEDDevice")}];
    [modelCopy setMatterWEDSupport:v14];

    eMACAddress = [v8 eMACAddress];
    [modelCopy setMatterExtendedMACAddress:eMACAddress];

    softwareVersionNumber = [v8 softwareVersionNumber];
    [modelCopy setMatterSoftwareVersionNumber:softwareVersionNumber];

    supportedLinkLayerTypes = [v8 supportedLinkLayerTypes];
    [modelCopy setSupportedLinkLayerTypes:supportedLinkLayerTypes];
  }
}

+ (id)updatedHomeModelCHIPPropertiesForAddedHAPAccessoryServer:(id)server
{
  v12[2] = *MEMORY[0x277D85DE8];
  serverCopy = server;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = serverCopy;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  fabricID = [v5 fabricID];

  if (fabricID)
  {
    v11[0] = @"HMDHomeModelUpdatedCHIPPropertiesMessageKeyFabricID";
    fabricID2 = [v5 fabricID];
    v11[1] = @"HMDHomeModelUpdatedCHIPPropertiesMessageKeyFabricIndex";
    v12[0] = fabricID2;
    fabricID3 = [v5 fabricID];
    v12[1] = fabricID3;
    fabricID = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:v11 count:2];
  }

  v9 = *MEMORY[0x277D85DE8];

  return fabricID;
}

- (void)setAllowedToEnableAdaptiveTemperatureAutomations:(BOOL)automations
{
  os_unfair_recursive_lock_lock_with_options();
  self->_allowedToEnableAdaptiveTemperatureAutomations = automations;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isAllowedToEnableAdaptiveTemperatureAutomations
{
  os_unfair_recursive_lock_lock_with_options();
  allowedToEnableAdaptiveTemperatureAutomations = self->_allowedToEnableAdaptiveTemperatureAutomations;
  os_unfair_recursive_lock_unlock();
  return allowedToEnableAdaptiveTemperatureAutomations;
}

- (void)setUserActivityStateDetectorManager:(id)manager
{
  managerCopy = manager;
  os_unfair_recursive_lock_lock_with_options();
  userActivityStateDetectorManager = self->_userActivityStateDetectorManager;
  self->_userActivityStateDetectorManager = managerCopy;

  os_unfair_recursive_lock_unlock();
}

- (HMDUserActivityStateDetectorManager)userActivityStateDetectorManager
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_userActivityStateDetectorManager;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (MTRDeviceController)matterDeviceController
{
  os_unfair_recursive_lock_lock_with_options();
  if (!self->_matterDeviceController)
  {
    featuresDataSource = [(HMDHome *)self featuresDataSource];
    isRVCEnabled = [featuresDataSource isRVCEnabled];

    if (isRVCEnabled)
    {
      v5 = objc_opt_class();
      uuid = [(HMDHome *)self uuid];
      v7 = [v5 matterDeviceControllerWithUUID:uuid];
      matterDeviceController = self->_matterDeviceController;
      self->_matterDeviceController = v7;
    }
  }

  v9 = self->_matterDeviceController;
  os_unfair_recursive_lock_unlock();

  return v9;
}

- (void)removeSharedUserResponseEventBuilder:(id)builder
{
  builderCopy = builder;
  if (builderCopy)
  {
    v5 = builderCopy;
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableSet *)self->_sharedUserResponseEventBuilders removeObject:v5];
    os_unfair_recursive_lock_unlock();
    builderCopy = v5;
  }
}

- (void)addSharedUserResponseEventBuilder:(id)builder
{
  builderCopy = builder;
  if (builderCopy)
  {
    v8 = builderCopy;
    os_unfair_recursive_lock_lock_with_options();
    sharedUserResponseEventBuilders = self->_sharedUserResponseEventBuilders;
    if (!sharedUserResponseEventBuilders)
    {
      v6 = [MEMORY[0x277CBEB58] set];
      v7 = self->_sharedUserResponseEventBuilders;
      self->_sharedUserResponseEventBuilders = v6;

      sharedUserResponseEventBuilders = self->_sharedUserResponseEventBuilders;
    }

    [(NSMutableSet *)sharedUserResponseEventBuilders addObject:v8];
    os_unfair_recursive_lock_unlock();
    builderCopy = v8;
  }
}

- (void)removeSharedUserEventBuilder:(id)builder
{
  builderCopy = builder;
  if (builderCopy)
  {
    v5 = builderCopy;
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableSet *)self->_sharedUserInviteEventBuilders removeObject:v5];
    os_unfair_recursive_lock_unlock();
    builderCopy = v5;
  }
}

- (void)addSharedUserEventBuilder:(id)builder
{
  builderCopy = builder;
  if (builderCopy)
  {
    v8 = builderCopy;
    os_unfair_recursive_lock_lock_with_options();
    sharedUserInviteEventBuilders = self->_sharedUserInviteEventBuilders;
    if (!sharedUserInviteEventBuilders)
    {
      v6 = [MEMORY[0x277CBEB58] set];
      v7 = self->_sharedUserInviteEventBuilders;
      self->_sharedUserInviteEventBuilders = v6;

      sharedUserInviteEventBuilders = self->_sharedUserInviteEventBuilders;
    }

    [(NSMutableSet *)sharedUserInviteEventBuilders addObject:v8];
    os_unfair_recursive_lock_unlock();
    builderCopy = v8;
  }
}

- (BOOL)shouldPostBulletin
{
  v20 = *MEMORY[0x277D85DE8];
  currentUser = [(HMDHome *)self currentUser];
  isAccessCurrentlyAllowedBySchedule = [currentUser isAccessCurrentlyAllowedBySchedule];
  if ([currentUser isRestrictedGuest] && ((-[HMDHome homeLocation](self, "homeLocation") == 1) & isAccessCurrentlyAllowedBySchedule) == 0)
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      [(HMDHome *)selfCopy homeLocation];
      v10 = HMStringFromHomeLocation();
      v11 = HMFBooleanToString();
      v14 = 138543874;
      v15 = v9;
      v16 = 2112;
      v17 = v10;
      v18 = 2112;
      v19 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Will not post the bulletin as RG is either away from the home or not within schedule. HomeLocation: %@, allowedBySchedule: %@", &v14, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    v5 = 0;
  }

  else
  {
    v5 = 1;
  }

  v12 = *MEMORY[0x277D85DE8];
  return v5;
}

- (void)_handleFetchTriggerNameRequest:(id)request
{
  v27 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = [requestCopy uuidForKey:@"triggerUUID"];
  if (v5)
  {
    triggers = [(HMDHome *)self triggers];
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __42__HMDHome__handleFetchTriggerNameRequest___block_invoke;
    v21[3] = &unk_27867AED8;
    v22 = v5;
    v7 = [triggers na_firstObjectPassingTest:v21];

    configuredName = [v7 configuredName];
    if (configuredName || ([v7 name], (configuredName = objc_claimAutoreleasedReturnValue()) != 0))
    {
      v9 = configuredName;
      v23 = *MEMORY[0x277CD2758];
      v24 = configuredName;
      v10 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v24 forKeys:&v23 count:1];
      [requestCopy respondWithPayload:v10];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      selfCopy = self;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        *buf = 138543362;
        v26 = v20;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@trigger name is nil.", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [requestCopy respondWithError:v9];
    }

    v11 = v22;
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@message does not contain the trigger SPI identifier", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [requestCopy respondWithError:v11];
  }

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __42__HMDHome__handleFetchTriggerNameRequest___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 spiClientIdentifier];
  v4 = *(a1 + 32);
  v5 = HMFEqualObjects();

  return v5;
}

- (NSArray)autoSelectedPreferredResidents
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  autoSelectedPreferredResidents = [residentDeviceManager autoSelectedPreferredResidents];

  return autoSelectedPreferredResidents;
}

- (HMDResidentDevice)userSelectedPreferredResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  userSelectedPreferredResident = [residentDeviceManager userSelectedPreferredResident];

  return userSelectedPreferredResident;
}

- (BOOL)supportsResidentSelection
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  homeSupportsResidentSelection = [residentDeviceManager homeSupportsResidentSelection];

  return homeSupportsResidentSelection;
}

- (BOOL)receivedRemoteMessageOverTransportType:(int)type remoteMessageSenderContext:(id)context
{
  contextCopy = context;
  isCurrentDeviceConfirmedPrimaryResident = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident];
  if (isCurrentDeviceConfirmedPrimaryResident)
  {
    pairingIdentityIdentifier = [contextCopy pairingIdentityIdentifier];
    v8 = [(HMDHome *)self userWithPairingIdentityIdentifier:pairingIdentityIdentifier];

    if (v8 && ([v8 isRemoteAccessAllowed] & 1) == 0)
    {
      presenceMonitor = [(HMDHome *)self presenceMonitor];
      v10 = [MEMORY[0x277CBEAA8] now];
      uuid = [v8 uuid];
      [presenceMonitor updateLastLocalActivityTimestamp:v10 forUserUUID:uuid];
    }
  }

  return isCurrentDeviceConfirmedPrimaryResident;
}

- (BOOL)areCharacteristicRequests:(id)requests allowedForUser:(id)user
{
  requestsCopy = requests;
  userCopy = user;
  if ([userCopy isRestrictedGuest])
  {
    restrictedGuestAccessSettings = [userCopy restrictedGuestAccessSettings];
    uuidsOfAllowedAccessories = [restrictedGuestAccessSettings uuidsOfAllowedAccessories];

    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __52__HMDHome_areCharacteristicRequests_allowedForUser___block_invoke;
    v12[3] = &unk_278689280;
    v9 = uuidsOfAllowedAccessories;
    v13 = v9;
    if ([requestsCopy na_all:v12])
    {
      isAccessCurrentlyAllowedBySchedule = [userCopy isAccessCurrentlyAllowedBySchedule];
    }

    else
    {
      isAccessCurrentlyAllowedBySchedule = 0;
    }
  }

  else
  {
    isAccessCurrentlyAllowedBySchedule = 1;
  }

  return isAccessCurrentlyAllowedBySchedule;
}

uint64_t __52__HMDHome_areCharacteristicRequests_allowedForUser___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 accessory];
  v4 = [v3 uuid];
  v5 = [v2 containsObject:v4];

  return v5;
}

- (void)_loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance:(id)acceptance
{
  v48 = *MEMORY[0x277D85DE8];
  acceptanceCopy = acceptance;
  v5 = [(HMDHome *)self userWithUUID:acceptanceCopy];
  if ([v5 isRestrictedGuest])
  {
    restrictedGuestAccessSettings = [v5 restrictedGuestAccessSettings];
    uuidsOfAllowedAccessories = [restrictedGuestAccessSettings uuidsOfAllowedAccessories];

    if (uuidsOfAllowedAccessories)
    {
      if (([uuidsOfAllowedAccessories hmf_isEmpty] & 1) == 0)
      {
        internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
        v9 = objc_autoreleasePoolPush();
        selfCopy = self;
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          v12 = HMFGetLogIdentifier();
          uUID = [internalOnlyInitializer UUID];
          uuid = [v5 uuid];
          *buf = 138544130;
          v41 = v12;
          v42 = 2112;
          v43 = uUID;
          v44 = 2112;
          v45 = uuid;
          v46 = 2112;
          v47 = uuidsOfAllowedAccessories;
          _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Restricted Guest}] Kicking off operations for restricted guest: %@ on invitation acceptance with allowed accessories: %@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v9);
        v15 = objc_alloc(MEMORY[0x277D0F7A8]);
        workQueue = [(HMDHome *)selfCopy workQueue];
        v17 = [v15 initWithQueue:workQueue];

        v18 = MEMORY[0x277D0F7C0];
        v36[0] = MEMORY[0x277D85DD0];
        v36[1] = 3221225472;
        v36[2] = __73__HMDHome__loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance___block_invoke;
        v36[3] = &unk_278686828;
        v19 = v5;
        v37 = v19;
        v38 = uuidsOfAllowedAccessories;
        v20 = internalOnlyInitializer;
        v39 = v20;
        v21 = [v18 inContext:v17 perform:v36];
        v33[0] = MEMORY[0x277D85DD0];
        v33[1] = 3221225472;
        v33[2] = __73__HMDHome__loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance___block_invoke_2;
        v33[3] = &unk_27867CF60;
        v33[4] = selfCopy;
        v34 = v20;
        v35 = v19;
        v22 = v20;
        v23 = [v21 then:v33];
      }
    }

    else
    {
      v28 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
      {
        v31 = HMFGetLogIdentifier();
        *buf = 138543618;
        v41 = v31;
        v42 = 2112;
        v43 = acceptanceCopy;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, "%{public}@Allowed Accessories not set for guest: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v28);
    }
  }

  else
  {
    v24 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      *buf = 138543618;
      v41 = v27;
      v42 = 2112;
      v43 = acceptanceCopy;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@User %@ is not a restricted guest, not configuring credentials on locks here", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
  }

  v32 = *MEMORY[0x277D85DE8];
}

uint64_t __73__HMDHome__loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance___block_invoke(void *a1)
{
  v1 = [HMDBackgroundOperationManagerHelper auditAllowedAccessToRestrictedGuest:a1[4] forAccessories:a1[5] shouldRemoveScheduledOperations:0 parentFlow:a1[6]];
  if (v1)
  {
    v2 = v1;

    return 3;
  }

  else
  {
    v4 = _HMFPreconditionFailure();
    return __73__HMDHome__loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance___block_invoke_2(v4);
  }
}

uint64_t __73__HMDHome__loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance___block_invoke_2(id *a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 count];
  v5 = objc_autoreleasePoolPush();
  v6 = a1[4];
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [a1[5] UUID];
      v11 = [a1[6] uuid];
      v18 = 138544130;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v11;
      v24 = 2112;
      v25 = v3;
      v12 = "%{public}@[Flow: %@] Some error occurred when adding pairings, pin codes & Home keys for the restricted guest %@ with error dictionary: %@";
      v13 = v8;
      v14 = OS_LOG_TYPE_ERROR;
      v15 = 42;
LABEL_6:
      _os_log_impl(&dword_229538000, v13, v14, v12, &v18, v15);
    }
  }

  else if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [a1[5] UUID];
    v11 = [a1[6] uuid];
    v18 = 138543874;
    v19 = v9;
    v20 = 2112;
    v21 = v10;
    v22 = 2112;
    v23 = v11;
    v12 = "%{public}@[Flow: %@] Successfully added pairings, pin codes & Home keys for the restricted guest %@";
    v13 = v8;
    v14 = OS_LOG_TYPE_INFO;
    v15 = 32;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v5);
  v16 = *MEMORY[0x277D85DE8];
  return 1;
}

- (void)_saveRestrictedGuestSettingsFromOutgoingInvitation:(id)invitation managedObjectContext:(id)context error:(id *)error
{
  v45 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  contextCopy = context;
  user = [invitationCopy user];
  isRestrictedGuest = [user isRestrictedGuest];

  if (isRestrictedGuest)
  {
    deletedObjects = [contextCopy deletedObjects];
    v13 = [deletedObjects na_firstObjectPassingTest:&__block_literal_global_2635];

    if (v13)
    {
      user2 = [invitationCopy user];
      uuid = [user2 uuid];
      v16 = [HMCContext findGuestWithModelID:uuid];

      if (v16)
      {
        *v43 = 0;
        *&v43[8] = v43;
        *&v43[16] = 0x2020000000;
        v44 = 1;
        deletedObjects2 = [contextCopy deletedObjects];
        v35[0] = MEMORY[0x277D85DD0];
        v35[1] = 3221225472;
        v35[2] = __89__HMDHome__saveRestrictedGuestSettingsFromOutgoingInvitation_managedObjectContext_error___block_invoke_2741;
        v35[3] = &unk_278678F88;
        v36 = v16;
        selfCopy = self;
        v38 = v43;
        [deletedObjects2 hmf_enumerateWithAutoreleasePoolUsingBlock:v35];

        if (error)
        {
          *error = 0;
          if ((*(*&v43[8] + 24) & 1) == 0)
          {
            *error = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2905];
          }
        }

        v18 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
        {
          v21 = HMFGetLogIdentifier();
          v22 = *error;
          *buf = 138543618;
          v40 = v21;
          v41 = 2112;
          v42 = v22;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Finishing outgoing invitation acceptance with error: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
        _Block_object_dispose(v43, 8);
      }

      else
      {
        context = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v29 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
        {
          v30 = HMFGetLogIdentifier();
          user3 = [invitationCopy user];
          uuid2 = [user3 uuid];
          *v43 = 138543618;
          *&v43[4] = v30;
          *&v43[12] = 2112;
          *&v43[14] = uuid2;
          _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the newly created guest model after accepting the invitation in database: %@", v43, 0x16u);
        }

        objc_autoreleasePoolPop(context);
        if (error)
        {
          *error = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        }
      }
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        v26 = HMFGetLogIdentifier();
        uuid3 = [invitationCopy uuid];
        *v43 = 138543618;
        *&v43[4] = v26;
        *&v43[12] = 2112;
        *&v43[14] = uuid3;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the outgoing invitation with UUID in database: %@", v43, 0x16u);
      }

      objc_autoreleasePoolPop(v23);
      if (error)
      {
        *error = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      }
    }
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __89__HMDHome__saveRestrictedGuestSettingsFromOutgoingInvitation_managedObjectContext_error___block_invoke_2741(uint64_t a1, void *a2, _BYTE *a3)
{
  v45 = *MEMORY[0x277D85DE8];
  v5 = a2;
  if ([v5 conformsToProtocol:&unk_283FBE1E0])
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v40 = 0;
    v8 = *(a1 + 32);
    v9 = [MEMORY[0x277CCAD78] UUID];
    v10 = [v8 materializeOrCreateWeekDayScheduleRulesRelationWithModelID:v9 createdNew:&v40];

    if (v40)
    {
      v11 = [v7 startTime];
      [v10 setStartTime:v11];

      v12 = [v7 endTime];
      [v10 setEndTime:v12];

      v13 = [v7 daysOfTheWeek];
      [v10 setDaysOfTheWeek:v13];

      v14 = objc_autoreleasePoolPush();
      v15 = *(a1 + 40);
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        v17 = HMFGetLogIdentifier();
        v18 = [v10 debugDescription];
        *buf = 138543618;
        v42 = v17;
        v43 = 2112;
        v44 = v18;
        _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Created new week day rule: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      v32 = *(a1 + 40);
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
      {
        v34 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v34;
        v43 = 2112;
        v44 = v7;
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Unable to create week day schedule from : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v31);
      *a3 = 1;
      *(*(*(a1 + 48) + 8) + 24) = 0;
    }
  }

  else
  {
    v19 = v5;
    if ([v19 conformsToProtocol:&unk_283F73708])
    {
      v20 = v19;
    }

    else
    {
      v20 = 0;
    }

    v10 = v20;

    if (v10)
    {
      v40 = 0;
      v21 = *(a1 + 32);
      v22 = [MEMORY[0x277CCAD78] UUID];
      v23 = [v21 materializeOrCreateYearDayScheduleRulesRelationWithModelID:v22 createdNew:&v40];

      if (v40)
      {
        v24 = [v10 startDate];
        [v23 setStartDate:v24];

        v25 = [v10 endDate];
        [v23 setEndDate:v25];

        v26 = objc_autoreleasePoolPush();
        v27 = *(a1 + 40);
        v28 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
        {
          v29 = HMFGetLogIdentifier();
          v30 = [v23 debugDescription];
          *buf = 138543618;
          v42 = v29;
          v43 = 2112;
          v44 = v30;
          _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@Created new year day rule: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v26);
      }

      else
      {
        v35 = objc_autoreleasePoolPush();
        v36 = *(a1 + 40);
        v37 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
        {
          v38 = HMFGetLogIdentifier();
          *buf = 138543618;
          v42 = v38;
          v43 = 2112;
          v44 = v10;
          _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@Unable to create year day schedule from : %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v35);
        *a3 = 1;
        *(*(*(a1 + 48) + 8) + 24) = 0;
      }
    }
  }

  v39 = *MEMORY[0x277D85DE8];
}

uint64_t __89__HMDHome__saveRestrictedGuestSettingsFromOutgoingInvitation_managedObjectContext_error___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 conformsToProtocol:&unk_283F5D530];
  if (v2)
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)_saveOutgoingInvitationsWithRestrictedGuestSettings:(id)settings inTransaction:(id)transaction message:(id)message transactionCompleted:(id)completed
{
  settingsCopy = settings;
  messageCopy = message;
  completedCopy = completed;
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __106__HMDHome__saveOutgoingInvitationsWithRestrictedGuestSettings_inTransaction_message_transactionCompleted___block_invoke;
  v19[3] = &unk_278670420;
  v19[4] = self;
  v20 = settingsCopy;
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __106__HMDHome__saveOutgoingInvitationsWithRestrictedGuestSettings_inTransaction_message_transactionCompleted___block_invoke_2632;
  v16[3] = &unk_278689358;
  v17 = messageCopy;
  v18 = completedCopy;
  v16[4] = self;
  v13 = messageCopy;
  v14 = completedCopy;
  v15 = settingsCopy;
  [transaction runWithCoreDataBlock:v19 withCompletionBlock:v16];
}

void __106__HMDHome__saveOutgoingInvitationsWithRestrictedGuestSettings_inTransaction_message_transactionCompleted___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v48 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = objc_autoreleasePoolPush();
  v37 = a1;
  v10 = *(a1 + 32);
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    *buf = 138543618;
    v45 = v12;
    v46 = 2112;
    v47 = v8;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Going to save RG settings with previous error: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  if (!v8)
  {
    v34 = 0;
    v35 = v7;
    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    obj = *(a1 + 40);
    v13 = [obj countByEnumeratingWithState:&v39 objects:v43 count:16];
    if (v13)
    {
      v14 = v13;
      v15 = *v40;
      p_info = HMDAggregationAnalysisLogEvent.info;
      while (2)
      {
        v17 = 0;
        v36 = v14;
        do
        {
          if (*v40 != v15)
          {
            objc_enumerationMutation(obj);
          }

          v18 = *(*(&v39 + 1) + 8 * v17);
          v19 = [v18 identifier];
          v20 = [p_info + 101 findOutgoingInvitationWithModelID:v19];

          if (v20)
          {
            v21 = [v18 user];
            v22 = [v21 restrictedGuestAccessSettings];
            v23 = [v22 schedule];
            v24 = [v20 populateWorkingStoreFromRestrictedGuestSchedule:v23];

            if ((v24 & 1) == 0)
            {
              if (a4)
              {
                *a4 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2905];
              }

              goto LABEL_22;
            }
          }

          else
          {
            v25 = v15;
            v26 = p_info;
            v27 = a4;
            v28 = objc_autoreleasePoolPush();
            v29 = *(v37 + 32);
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
            {
              v31 = HMFGetLogIdentifier();
              v32 = [v18 uuid];
              *buf = 138543618;
              v45 = v31;
              v46 = 2112;
              v47 = v32;
              _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the outgoing invitation with UUID in database: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v28);
            a4 = v27;
            p_info = v26;
            v15 = v25;
            v14 = v36;
            if (a4)
            {
              *a4 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
            }
          }

          ++v17;
        }

        while (v14 != v17);
        v14 = [obj countByEnumeratingWithState:&v39 objects:v43 count:16];
        if (v14)
        {
          continue;
        }

        break;
      }
    }

LABEL_22:

    v8 = v34;
    v7 = v35;
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __106__HMDHome__saveOutgoingInvitationsWithRestrictedGuestSettings_inTransaction_message_transactionCompleted___block_invoke_2632(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v11 = 138543618;
    v12 = v7;
    v13 = 2112;
    v14 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@RG settings transaction finished with error: %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = _Block_copy(*(a1 + 48));
  v9 = v8;
  if (v8)
  {
    (*(v8 + 2))(v8);
  }

  [*(a1 + 40) respondWithPayload:0 error:v3];
  v10 = *MEMORY[0x277D85DE8];
}

- (void)__handleUpdateRestrictedGuestSettings:(id)settings
{
  v66 = *MEMORY[0x277D85DE8];
  settingsCopy = settings;
  flow = [settingsCopy flow];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    uUID = [flow UUID];
    *buf = 138543874;
    v61 = v9;
    v62 = 2112;
    v63 = uUID;
    v64 = 2112;
    v65 = settingsCopy;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Handling update restricted guest settings message: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = [settingsCopy stringForKey:@"kUserIDKey"];
  users = [(HMDHome *)selfCopy users];
  v13 = [users hmf_firstObjectWithValue:v11 forKeyPath:@"userID"];

  if (v13)
  {
    if ([v13 isRestrictedGuest])
    {
      v14 = *MEMORY[0x277CD0D10];
      v59 = objc_opt_class();
      v15 = [MEMORY[0x277CBEA60] arrayWithObjects:&v59 count:1];
      v16 = [settingsCopy unarchivedObjectForKey:v14 ofClasses:v15];

      if (!v16)
      {
        v37 = objc_autoreleasePoolPush();
        v38 = selfCopy;
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_ERROR))
        {
          v40 = HMFGetLogIdentifier();
          uUID2 = [flow UUID];
          *buf = 138543618;
          v61 = v40;
          v62 = 2112;
          v63 = uUID2;
          _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to decode restricted guest settings", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v37);
        v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        [settingsCopy respondWithError:v17];
        goto LABEL_27;
      }

      v17 = [[HMDRestrictedGuestHomeAccessSettings alloc] initWithRestrictedGuestHomeAccessSettings:v16];
      if (v17)
      {
        restrictedGuestAccessSettings = [v13 restrictedGuestAccessSettings];
        v19 = HMFEqualObjects();

        if (!v19)
        {
          backingStore = [(HMDHome *)selfCopy backingStore];
          context = [backingStore context];
          v53[0] = MEMORY[0x277D85DD0];
          v53[1] = 3221225472;
          v53[2] = __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke;
          v53[3] = &unk_278689550;
          v54 = v13;
          v55 = selfCopy;
          v56 = flow;
          v57 = settingsCopy;
          v58 = v17;
          [context performBlock:v53];

          v47 = v54;
          goto LABEL_26;
        }

        v20 = objc_autoreleasePoolPush();
        v21 = selfCopy;
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
        {
          v23 = HMFGetLogIdentifier();
          [flow UUID];
          v24 = v51 = v20;
          *buf = 138543618;
          v61 = v23;
          v62 = 2112;
          v63 = v24;
          _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Current restricted guest settings are the same as the new settings. Nothing to done here", buf, 0x16u);

          v20 = v51;
        }

        objc_autoreleasePoolPop(v20);
        v25 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2904];
      }

      else
      {
        v42 = objc_autoreleasePoolPush();
        v43 = selfCopy;
        v44 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
        {
          v45 = HMFGetLogIdentifier();
          [flow UUID];
          v46 = v52 = v42;
          *buf = 138543618;
          v61 = v45;
          v62 = 2112;
          v63 = v46;
          _os_log_impl(&dword_229538000, v44, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to initialize restricted guest settings", buf, 0x16u);

          v42 = v52;
        }

        objc_autoreleasePoolPop(v42);
        v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      }

      v47 = v25;
      [settingsCopy respondWithError:v25];
LABEL_26:

LABEL_27:
      goto LABEL_28;
    }

    v32 = objc_autoreleasePoolPush();
    v33 = selfCopy;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      uUID3 = [flow UUID];
      *buf = 138543874;
      v61 = v35;
      v62 = 2112;
      v63 = uUID3;
      v64 = 2112;
      v65 = v13;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Cannot update restricted guest settings for user with UUID %@ as the user is not RG", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v32);
    v31 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2901];
  }

  else
  {
    v26 = objc_autoreleasePoolPush();
    v27 = selfCopy;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      v29 = HMFGetLogIdentifier();
      uUID4 = [flow UUID];
      *buf = 138543874;
      v61 = v29;
      v62 = 2112;
      v63 = uUID4;
      v64 = 2112;
      v65 = v11;
      _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find user with userID %@ in the home", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v26);
    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
  }

  v16 = v31;
  [settingsCopy respondWithError:v31];
LABEL_28:

  v50 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke(id *a1)
{
  v109 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] uuid];
  v3 = [HMCContext findGuestWithModelID:v2];

  if (v3)
  {
    v4 = MEMORY[0x277CBEB98];
    v5 = [v3 allowedAccessories];
    v6 = [v4 setWithArray:v5];

    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v106 = __Block_byref_object_copy__14759;
    v107 = __Block_byref_object_dispose__14760;
    v7 = MEMORY[0x277CBEB58];
    v8 = [a1[8] uuidsOfAllowedAccessories];
    v108 = [v7 setWithCapacity:{objc_msgSend(v8, "count")}];

    v90 = 0;
    v91 = &v90;
    v92 = 0x3032000000;
    v93 = __Block_byref_object_copy__14759;
    v94 = __Block_byref_object_dispose__14760;
    v95 = 0;
    v9 = [a1[8] uuidsOfAllowedAccessories];
    v85[0] = MEMORY[0x277D85DD0];
    v85[1] = 3221225472;
    v85[2] = __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke_2617;
    v85[3] = &unk_2786709C0;
    v10 = a1[6];
    v85[4] = a1[5];
    v86 = v10;
    v88 = &v90;
    v89 = buf;
    v11 = v3;
    v87 = v11;
    [v9 hmf_enumerateWithAutoreleasePoolUsingBlock:v85];

    if (v91[5])
    {
      [a1[7] respondWithError:?];
    }

    else
    {
      v19 = [a1[8] uuidsOfAllowedAccessories];
      v20 = [v19 count] == 0;

      if (v20)
      {
        [v11 dematerializeAllowedAccessoriesRelationship];
      }

      v21 = [a1[8] schedule];
      v22 = [v11 populateWorkingStoreFromRestrictedGuestSchedule:v21];

      if (v22)
      {
        v23 = [v6 mutableCopy];
        [v23 minusSet:*(*&buf[8] + 40)];
        v78 = [*(*&buf[8] + 40) mutableCopy];
        [v78 minusSet:v6];
        v24 = a1[5];
        [objc_opt_class() dumpAccessories:v23 usingTag:@"removed from allowed accessories" flow:a1[6]];
        v25 = a1[5];
        [objc_opt_class() dumpAccessories:v78 usingTag:@"newly added to allowed accessories" flow:a1[6]];
        v83[0] = MEMORY[0x277D85DD0];
        v83[1] = 3221225472;
        v83[2] = __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke_2625;
        v83[3] = &unk_2786709E8;
        v84 = v11;
        [v23 na_each:v83];
        v75 = listOfUUIDsFromManagedObjectSet(v23);
        v74 = listOfUUIDsFromManagedObjectSet(v78);
        v26 = [a1[4] restrictedGuestAccessSettings];
        v27 = [v26 schedule];
        v28 = [a1[8] schedule];
        v76 = HMFEqualObjects();

        if ((v76 & 1) == 0)
        {
          v29 = objc_autoreleasePoolPush();
          v30 = a1[5];
          v31 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
          {
            v69 = v29;
            v72 = HMFGetLogIdentifier();
            v70 = [a1[6] UUID];
            v32 = [a1[4] restrictedGuestAccessSettings];
            v33 = [v32 schedule];
            v34 = [a1[8] schedule];
            *v97 = 138544130;
            v98 = v72;
            v99 = 2112;
            v100 = v70;
            v101 = 2112;
            v102 = v33;
            v103 = 2112;
            v104 = v34;
            _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Changing schedule from: %@, to: %@", v97, 0x2Au);

            v29 = v69;
          }

          objc_autoreleasePoolPop(v29);
        }

        v35 = +[HMCContext currentContext];
        v82 = 0;
        v36 = [v35 save:&v82];
        v73 = v82;

        v37 = objc_autoreleasePoolPush();
        v38 = a1[5];
        if (v36)
        {
          v39 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
          {
            v40 = HMFGetLogIdentifier();
            v41 = [a1[6] UUID];
            v42 = a1[8];
            *v97 = 138543874;
            v98 = v40;
            v99 = 2112;
            v100 = v41;
            v101 = 2112;
            v102 = v42;
            _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Successfully saved the restricted guest settings to working store : %@", v97, 0x20u);
          }

          objc_autoreleasePoolPop(v37);
          [a1[4] setRestrictedGuestAccessSettings:a1[8]];
          [a1[4] scheduleRestrictedGuestAccessTimersWithReason:@"Admin updated RG Settings"];
          v43 = [HMDBackgroundOperationManagerHelper auditProhibitedAccessToRestrictedGuest:a1[4] forAccessories:v75 shouldRemoveScheduledOperations:1 parentFlow:a1[6]];
          if (v76)
          {
            v44 = v74;
          }

          else
          {
            v44 = [a1[8] uuidsOfAllowedAccessories];
          }

          v77 = v44;
          v56 = [HMDBackgroundOperationManagerHelper auditAllowedAccessToRestrictedGuest:a1[4] forAccessories:v44 shouldRemoveScheduledOperations:1 parentFlow:a1[6]];
          v57 = objc_alloc(MEMORY[0x277D0F7A8]);
          v58 = [a1[5] workQueue];
          v59 = [v57 initWithQueue:v58];

          v60 = MEMORY[0x277D0F7C0];
          v96[0] = v43;
          v96[1] = v56;
          v61 = [MEMORY[0x277CBEA60] arrayWithObjects:v96 count:2];
          v62 = [v60 allSettled:v61];

          v79[0] = MEMORY[0x277D85DD0];
          v79[1] = 3221225472;
          v79[2] = __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke_2630;
          v79[3] = &unk_278679B58;
          v71 = *(a1 + 5);
          v63 = *(&v71 + 1);
          v64 = a1[4];
          v65 = a1[7];
          *&v66 = v64;
          *(&v66 + 1) = v65;
          v80 = v71;
          v81 = v66;
          v67 = [v62 inContext:v59 then:v79];
        }

        else
        {
          v52 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
          {
            v53 = HMFGetLogIdentifier();
            v54 = [a1[6] UUID];
            *v97 = 138543874;
            v98 = v53;
            v99 = 2112;
            v100 = v54;
            v101 = 2112;
            v102 = v73;
            _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Unable to save the restricted guest settings to working store : %@", v97, 0x20u);
          }

          objc_autoreleasePoolPop(v37);
          v55 = a1[7];
          v43 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2711];
          [v55 respondWithError:v43];
        }
      }

      else
      {
        v45 = objc_autoreleasePoolPush();
        v46 = a1[5];
        v47 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
        {
          v48 = HMFGetLogIdentifier();
          v49 = [a1[6] UUID];
          v50 = [a1[8] schedule];
          *v97 = 138543874;
          v98 = v48;
          v99 = 2112;
          v100 = v49;
          v101 = 2112;
          v102 = v50;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Unable to save the restricted guest schedule to working store : %@", v97, 0x20u);
        }

        objc_autoreleasePoolPop(v45);
        v51 = a1[7];
        v23 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2711];
        [v51 respondWithError:v23];
      }
    }

    _Block_object_dispose(&v90, 8);
    _Block_object_dispose(buf, 8);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = a1[5];
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [a1[6] UUID];
      v17 = [a1[4] uuid];
      *buf = 138543874;
      *&buf[4] = v15;
      *&buf[12] = 2112;
      *&buf[14] = v16;
      *&buf[22] = 2112;
      v106 = v17;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Unable to fetch the guest with id [%@] from working store", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
    v18 = a1[7];
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v18 respondWithError:v6];
  }

  v68 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke_2617(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v23 = *MEMORY[0x277D85DE8];
  v6 = a2;
  v7 = [HMCContext findAccessoryWithModelID:v6];
  if (v7)
  {
    [*(*(*(a1 + 64) + 8) + 40) addObject:v7];
    [*(a1 + 48) addAllowedAccessoriesObject:v7];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [*(a1 + 40) UUID];
      v17 = 138543874;
      v18 = v11;
      v19 = 2112;
      v20 = v12;
      v21 = 2112;
      v22 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Unable to fetch the accessory with id [%@] from working store", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v14 = *(*(a1 + 56) + 8);
    v15 = *(v14 + 40);
    *(v14 + 40) = v13;

    *a4 = 1;
  }

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke_2630(id *a1, void *a2)
{
  v34 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 objectAtIndexedSubscript:0];
  v5 = [v4 count];

  v6 = objc_autoreleasePoolPush();
  v7 = a1[4];
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (!os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v10 = HMFGetLogIdentifier();
    v11 = [a1[5] UUID];
    v12 = [a1[6] uuid];
    v13 = [v3 objectAtIndexedSubscript:0];
    v26 = 138544130;
    v27 = v10;
    v28 = 2112;
    v29 = v11;
    v30 = 2112;
    v31 = v12;
    v32 = 2112;
    v33 = v13;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Some error occurred when removing pairings, pin codes & Home keys for the restricted guest %@ with error dictionary: %@", &v26, 0x2Au);
  }

  else
  {
    if (!os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      goto LABEL_7;
    }

    v10 = HMFGetLogIdentifier();
    v11 = [a1[5] UUID];
    v26 = 138543618;
    v27 = v10;
    v28 = 2112;
    v29 = v11;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Successfully finished removing pairings, pin codes & Home keys for the restricted guest", &v26, 0x16u);
  }

LABEL_7:
  objc_autoreleasePoolPop(v6);
  v14 = [v3 objectAtIndexedSubscript:1];
  v15 = [v14 count];

  v16 = objc_autoreleasePoolPush();
  v17 = a1[4];
  v18 = HMFGetOSLogHandle();
  v19 = v18;
  if (v15)
  {
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      v21 = [a1[5] UUID];
      v22 = [a1[6] uuid];
      v23 = [v3 objectAtIndexedSubscript:1];
      v26 = 138544130;
      v27 = v20;
      v28 = 2112;
      v29 = v21;
      v30 = 2112;
      v31 = v22;
      v32 = 2112;
      v33 = v23;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Some error occurred when adding pairings, pin codes & Home keys for the restricted guest %@ with error dictionary: %@", &v26, 0x2Au);

LABEL_12:
    }
  }

  else if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v21 = [a1[5] UUID];
    v26 = 138543618;
    v27 = v20;
    v28 = 2112;
    v29 = v21;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Successfully finished adding pairings, pin codes & Home keys for the restricted guest", &v26, 0x16u);
    goto LABEL_12;
  }

  objc_autoreleasePoolPop(v16);
  [a1[7] respondWithSuccess];

  v24 = *MEMORY[0x277D85DE8];
  return 1;
}

- (void)_handleUpdateRestrictedGuestSettings:(id)settings
{
  v13 = *MEMORY[0x277D85DE8];
  settingsCopy = settings;
  if ([(HMDHome *)self hasAnyResident]&& isTVOSDevice())
  {
    [(HMDHome *)self __handleUpdateRestrictedGuestSettings:settingsCopy];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Not handling this message as this home does not have any resident and this is controller.", &v11, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    [settingsCopy respondWithError:v9];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_updateRestrictedGuestHomeAccessSettingsFromOutgoingInvitation:(id)invitation forUserModel:(id)model
{
  v19 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  modelCopy = model;
  uuidsOfAllowedAccessories = [invitationCopy uuidsOfAllowedAccessories];
  [modelCopy setAllowedAccessoryUUIDs:uuidsOfAllowedAccessories];

  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    allowedAccessoryUUIDs = [modelCopy allowedAccessoryUUIDs];
    v15 = 138543618;
    v16 = v12;
    v17 = 2112;
    v18 = allowedAccessoryUUIDs;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Allowed accessories for RG users: %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)shouldWeSendAutomationsToClients
{
  currentUser = [(HMDHome *)self currentUser];
  isRestrictedGuest = [currentUser isRestrictedGuest];

  return isRestrictedGuest ^ 1;
}

- (BOOL)defaultRoomContainsAccessoryWithUUID:(id)d
{
  v4 = [(HMDHome *)self accessoryWithUUID:d];
  roomForEntireHome = [(HMDHome *)self roomForEntireHome];
  room = [v4 room];
  v7 = [roomForEntireHome isEqual:room];

  return v7;
}

- (BOOL)hasActiveWACPairing
{
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  hasActiveWACPairing = [accessoryBrowser hasActiveWACPairing];

  return hasActiveWACPairing;
}

- (id)destinationForAppleMediaAccessory:(id)accessory
{
  accessoryCopy = accessory;
  mediaGroupsAggregateConsumer = [(HMDHome *)self mediaGroupsAggregateConsumer];
  uuid = [accessoryCopy uuid];

  v7 = [mediaGroupsAggregateConsumer destinationWithParentIdentifier:uuid];

  return v7;
}

- (id)destinationControllerDataForAppleMediaAccessory:(id)accessory
{
  accessoryCopy = accessory;
  mediaGroupsAggregateConsumer = [(HMDHome *)self mediaGroupsAggregateConsumer];
  uuid = [accessoryCopy uuid];

  v7 = [mediaGroupsAggregateConsumer destinationControllerDataWithParentIdentifier:uuid];

  return v7;
}

- (id)mediaGroupsAggregateDataTopicName
{
  v2 = MEMORY[0x277CD1A78];
  v3 = *MEMORY[0x277CCFF30];
  uuid = [(HMDHome *)self uuid];
  v5 = [v2 topicFromSuffixID:v3 homeUUID:uuid];

  return v5;
}

- (void)_handleRetrieveHomeLocationForFeedback:(id)feedback
{
  v24 = *MEMORY[0x277D85DE8];
  feedbackCopy = feedback;
  homeLocationHandler = [(HMDHome *)self homeLocationHandler];

  if (homeLocationHandler)
  {
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    homeLocationHandler2 = [(HMDHome *)self homeLocationHandler];
    locationUpdateTimestamp = [homeLocationHandler2 locationUpdateTimestamp];

    if (locationUpdateTimestamp)
    {
      homeLocationHandler3 = [(HMDHome *)self homeLocationHandler];
      locationUpdateTimestamp2 = [homeLocationHandler3 locationUpdateTimestamp];
      [dictionary setObject:locationUpdateTimestamp2 forKeyedSubscript:*MEMORY[0x277CD0048]];
    }

    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v20 = 138543618;
      v21 = v14;
      v22 = 2112;
      v23 = dictionary;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Retrieve home location for feedback : %@", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    [feedbackCopy respondWithPayload:dictionary];
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v20 = 138543362;
      v21 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Home Location Handler does not exist.", &v20, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
    dictionary = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [feedbackCopy respondWithError:dictionary];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (BOOL)_processTestModeHomeAccessControlOverride:(id)override error:(id *)error
{
  v26 = *MEMORY[0x277D85DE8];
  overrideCopy = override;
  v7 = [overrideCopy hmf_BOOLForKey:@"kConfigTestingResetOverrideKey"];
  v8 = [overrideCopy hmf_numberForKey:@"kConfigTestingHomeAccessControlKey"];
  if (v8)
  {
    v9 = 1;
  }

  else
  {
    v9 = v7;
  }

  if (v9)
  {
    os_unfair_recursive_lock_lock_with_options();
    if (v7)
    {

      v8 = 0;
    }

    overriddenHomeAccessControl = self->_overriddenHomeAccessControl;
    v11 = HMFEqualObjects();
    objc_storeStrong(&self->_overriddenHomeAccessControl, v8);
    os_unfair_recursive_lock_unlock();
    if (v11)
    {
      v12 = objc_autoreleasePoolPush();
      selfCopy = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v22 = 138543618;
        v23 = v15;
        v24 = 2112;
        v25 = overrideCopy;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Home Access Control overridden to %@", &v22, 0x16u);
      }

      objc_autoreleasePoolPop(v12);
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home access control override: missing data in payload", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    if (error)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      *error = v8 = 0;
    }

    else
    {
      v8 = 0;
    }
  }

  v20 = *MEMORY[0x277D85DE8];
  return v9;
}

- (BOOL)_processTestModeUpdateHomeLocation:(id)location error:(id *)error
{
  v44 = *MEMORY[0x277D85DE8];
  locationCopy = location;
  if (isInternalBuild())
  {
    v7 = [locationCopy dataForKey:@"kHomeLocationDataKey"];
    if (v7)
    {
      v37 = 0;
      v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v7 error:&v37];
      v9 = v37;
      v10 = v9;
      v11 = v8 != 0;
      if (v8)
      {
        v36 = v9;
        v12 = [locationCopy hmf_numberForKey:@"homeLocationSource"];
        intValue = [v12 intValue];

        v14 = objc_autoreleasePoolPush();
        selfCopy = self;
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
        {
          v17 = HMFGetLogIdentifier();
          v18 = HMDHomeLocationSourceToString(intValue);
          *buf = 138543874;
          v39 = v17;
          v40 = 2112;
          v41 = v8;
          v42 = 2112;
          v43 = v18;
          _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Received new home location override from shared admin: %@, source : %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v14);
        homeLocationHandler = [(HMDHome *)selfCopy homeLocationHandler];
        date = [MEMORY[0x277CBEAA8] date];
        [homeLocationHandler runTransactionWithLocation:v8 updatedTime:date source:intValue];

        v10 = v36;
      }

      else
      {
        v29 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v31 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
        {
          v32 = HMFGetLogIdentifier();
          *buf = 138543874;
          v39 = v32;
          v40 = 2112;
          v41 = v7;
          v42 = 2112;
          v43 = v10;
          _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: failed to unarchive location from data %@: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v29);
        if (error)
        {
          v33 = v10;
          *error = v10;
        }
      }
    }

    else
    {
      v25 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        *buf = 138543362;
        v39 = v28;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: no home location data found in payload", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
      if (error)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        *error = v11 = 0;
      }

      else
      {
        v11 = 0;
      }
    }
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v39 = v24;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: not running on an internal build", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
    if (error)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      *error = v11 = 0;
    }

    else
    {
      v11 = 0;
    }
  }

  v34 = *MEMORY[0x277D85DE8];
  return v11;
}

- (BOOL)_processTestModeHomeLocationStatusOverride:(id)override error:(id *)error
{
  v23 = *MEMORY[0x277D85DE8];
  overrideCopy = override;
  v7 = [overrideCopy hmf_BOOLForKey:@"kConfigTestingResetOverrideKey"];
  v8 = [overrideCopy hmf_numberForKey:@"kConfigTestingHomeLocationStatusKey"];
  v9 = v8;
  if (v8)
  {
    v10 = 1;
  }

  else
  {
    v10 = v7;
  }

  if (v10)
  {
    unsignedIntegerValue = [v8 unsignedIntegerValue];
    homeLocation = [(HMDHome *)self homeLocation];
    os_unfair_recursive_lock_lock_with_options();
    if (v7)
    {
      if (!self->_overrideHomeLocation)
      {
        self->_overriddenHomeLocation = unsignedIntegerValue;
        os_unfair_recursive_lock_unlock();
        goto LABEL_16;
      }

      v13 = 0;
    }

    else
    {
      v13 = 1;
    }

    self->_overrideHomeLocation = v13;
    self->_overriddenHomeLocation = unsignedIntegerValue;
    os_unfair_recursive_lock_unlock();
    homeLocation2 = [(HMDHome *)self homeLocation];
    if (homeLocation2 != homeLocation)
    {
      [(HMDHome *)self _handleHomeLocationChange:homeLocation2 previousLocation:homeLocation];
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v17;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location status override: missing data in payload", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
    if (error)
    {
      *error = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    }
  }

LABEL_16:

  v19 = *MEMORY[0x277D85DE8];
  return v10;
}

- (void)aggregator:(id)aggregator didReceiveSoftwareVersionWithUUID:(id)d softwareVersion:(id)version
{
  v35 = *MEMORY[0x277D85DE8];
  aggregatorCopy = aggregator;
  dCopy = d;
  versionCopy = version;
  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    buildVersion = [versionCopy buildVersion];
    *buf = 138544130;
    v28 = v14;
    v29 = 2112;
    v30 = versionCopy;
    v31 = 2112;
    v32 = buildVersion;
    v33 = 2112;
    v34 = dCopy;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received accessory software version: %@ (%@) accessory: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v11);
  backingStore = [(HMDHome *)selfCopy backingStore];
  context = [backingStore context];

  if (context)
  {
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __72__HMDHome_aggregator_didReceiveSoftwareVersionWithUUID_softwareVersion___block_invoke;
    v23[3] = &unk_2786891E0;
    v23[4] = selfCopy;
    v24 = versionCopy;
    v25 = dCopy;
    v26 = context;
    [v26 performBlock:v23];
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    v19 = selfCopy;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v21;
      v29 = 2112;
      v30 = 0;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to handle received software version due to missing backing store context: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __72__HMDHome_aggregator_didReceiveSoftwareVersionWithUUID_softwareVersion___block_invoke(uint64_t a1)
{
  v35 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v7 = *(a1 + 48);
    *buf = 138543874;
    v30 = v5;
    v31 = 2112;
    v32 = v6;
    v33 = 2112;
    v34 = v7;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saving accessory software version: %@ accessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v2);
  v8 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 48)];
  v9 = v8;
  if (!v8)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = *(a1 + 32);
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v20 = *(a1 + 48);
      *buf = 138543618;
      v30 = v15;
      v31 = 2112;
      v32 = v20;
      v17 = "%{public}@Aggregator: Failed to save accessory software version due to missing mkfAppleMediaAccessory with uuid: %@";
      v18 = v14;
      v19 = OS_LOG_TYPE_ERROR;
      goto LABEL_9;
    }

LABEL_10:

    objc_autoreleasePoolPop(v12);
    goto LABEL_16;
  }

  v10 = *(a1 + 40);
  v11 = [v8 softwareVersion];
  LODWORD(v10) = [v10 isEqual:v11];

  if (v10)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = *(a1 + 32);
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v16 = *(a1 + 48);
      *buf = 138543618;
      v30 = v15;
      v31 = 2112;
      v32 = v16;
      v17 = "%{public}@Aggregator: Skipping already saved accessory software version for accessory: %@";
      v18 = v14;
      v19 = OS_LOG_TYPE_INFO;
LABEL_9:
      _os_log_impl(&dword_229538000, v18, v19, v17, buf, 0x16u);

      goto LABEL_10;
    }

    goto LABEL_10;
  }

  [v9 setSoftwareVersion:*(a1 + 40)];
  v21 = *(a1 + 56);
  v28 = 0;
  [v21 save:&v28];
  v22 = v28;
  if (v22)
  {
    v23 = objc_autoreleasePoolPush();
    v24 = *(a1 + 32);
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v30 = v26;
      v31 = 2112;
      v32 = v22;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save accessory software version with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
  }

LABEL_16:
  v27 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)aggregator didReceiveDeviceIRKWithUUID:(id)d deviceIRK:(id)k
{
  v32 = *MEMORY[0x277D85DE8];
  aggregatorCopy = aggregator;
  dCopy = d;
  kCopy = k;
  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    *buf = 138543874;
    v27 = v14;
    v28 = 2112;
    v29 = kCopy;
    v30 = 2112;
    v31 = dCopy;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received accessory deviceIRK: %@ accessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v11);
  backingStore = [(HMDHome *)selfCopy backingStore];
  context = [backingStore context];

  if (context)
  {
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __60__HMDHome_aggregator_didReceiveDeviceIRKWithUUID_deviceIRK___block_invoke;
    v22[3] = &unk_2786891E0;
    v22[4] = selfCopy;
    v23 = kCopy;
    v24 = dCopy;
    v25 = context;
    [v25 performBlock:v22];
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = selfCopy;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v20;
      v28 = 2112;
      v29 = 0;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Missing backing store context: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
  }

  v21 = *MEMORY[0x277D85DE8];
}

void __60__HMDHome_aggregator_didReceiveDeviceIRKWithUUID_deviceIRK___block_invoke(uint64_t a1)
{
  v44 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v7 = *(a1 + 48);
    *buf = 138543874;
    v39 = v5;
    v40 = 2112;
    v41 = v6;
    v42 = 2112;
    v43 = v7;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saving accessory deviceIRK: %@ accessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v2);
  v8 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 48)];
  v9 = v8;
  if (v8)
  {
    v10 = [v8 resident];
    if (!v10)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = *(a1 + 32);
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v15 = *(a1 + 48);
        *buf = 138543618;
        v39 = v14;
        v40 = 2112;
        v41 = v15;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save deviceIRK due to missing mkfResident for accessory with uuid: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
    }

    v16 = *(a1 + 40);
    v17 = [v9 deviceIRKData];
    if ([v16 isEqual:v17])
    {
      v18 = *(a1 + 40);
      v19 = [v10 deviceIRKData];
      LODWORD(v18) = [v18 isEqual:v19];

      if (v18)
      {
        v20 = objc_autoreleasePoolPush();
        v21 = *(a1 + 32);
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          v23 = HMFGetLogIdentifier();
          v24 = *(a1 + 48);
          *buf = 138543618;
          v39 = v23;
          v40 = 2112;
          v41 = v24;
          _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Skipping matching deviceIRK for accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v20);
LABEL_22:

        goto LABEL_23;
      }
    }

    else
    {
    }

    [v9 setDeviceIRKData:*(a1 + 40)];
    [v10 setDeviceIRKData:*(a1 + 40)];
    v30 = *(a1 + 56);
    v37 = 0;
    [v30 save:&v37];
    v31 = v37;
    if (v31)
    {
      v32 = objc_autoreleasePoolPush();
      v33 = *(a1 + 32);
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543618;
        v39 = v35;
        v40 = 2112;
        v41 = v31;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save accessory pairing identity with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v32);
    }

    goto LABEL_22;
  }

  v25 = objc_autoreleasePoolPush();
  v26 = *(a1 + 32);
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
  {
    v28 = HMFGetLogIdentifier();
    v29 = *(a1 + 48);
    *buf = 138543618;
    v39 = v28;
    v40 = 2112;
    v41 = v29;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: did not find mkfAppleMediaAccessory with uuid: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v25);
LABEL_23:

  v36 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)aggregator didReceivePublicPairingKeyWithUUID:(id)d pairingIdentity:(id)identity
{
  v32 = *MEMORY[0x277D85DE8];
  aggregatorCopy = aggregator;
  dCopy = d;
  identityCopy = identity;
  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    *buf = 138543874;
    v27 = v14;
    v28 = 2112;
    v29 = identityCopy;
    v30 = 2112;
    v31 = dCopy;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received accessory public pairing identity: %@ accessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v11);
  backingStore = [(HMDHome *)selfCopy backingStore];
  context = [backingStore context];

  if (context)
  {
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __73__HMDHome_aggregator_didReceivePublicPairingKeyWithUUID_pairingIdentity___block_invoke;
    v22[3] = &unk_2786891E0;
    v22[4] = selfCopy;
    v23 = identityCopy;
    v24 = dCopy;
    v25 = context;
    [v25 performBlock:v22];
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = selfCopy;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v20;
      v28 = 2112;
      v29 = 0;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to handle received accessory public pairing identity due to missing backing store context: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
  }

  v21 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome_aggregator_didReceivePublicPairingKeyWithUUID_pairingIdentity___block_invoke(uint64_t a1)
{
  v48 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v7 = *(a1 + 48);
    *buf = 138543874;
    v43 = v5;
    v44 = 2112;
    v45 = v6;
    v46 = 2112;
    v47 = v7;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saving accessory public pairing identity: %@ accessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v2);
  v8 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 48)];
  v9 = v8;
  if (v8)
  {
    v10 = [v8 resident];
    if (!v10)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = *(a1 + 32);
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v15 = *(a1 + 48);
        *buf = 138543618;
        v43 = v14;
        v44 = 2112;
        v45 = v15;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save accessory public pairing identity due to missing mkfResident for accessory with uuid: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
    }

    v16 = *(a1 + 40);
    v17 = [v9 pairingIdentity];
    if ([v16 isEqual:v17])
    {
      v18 = *(a1 + 40);
      v19 = [v10 pairingIdentity];
      LODWORD(v18) = [v18 isEqual:v19];

      if (v18)
      {
        v20 = objc_autoreleasePoolPush();
        v21 = *(a1 + 32);
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          v23 = HMFGetLogIdentifier();
          v24 = *(a1 + 48);
          *buf = 138543618;
          v43 = v23;
          v44 = 2112;
          v45 = v24;
          _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Skipping already saved accessory public pairing identity for accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v20);
        goto LABEL_25;
      }
    }

    else
    {
    }

    [v9 setPairingIdentity:*(a1 + 40)];
    [v10 setPairingIdentity:*(a1 + 40)];
    v30 = *(a1 + 56);
    v41 = 0;
    v31 = [v30 save:&v41];
    v32 = v41;
    v33 = v32;
    if (v31)
    {
      v34 = objc_autoreleasePoolPush();
      v35 = *(a1 + 32);
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
      {
        v37 = HMFGetLogIdentifier();
        v38 = *(a1 + 48);
        *buf = 138543618;
        v43 = v37;
        v44 = 2112;
        v45 = v38;
        _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Saved pairing identity for accessory: %@", buf, 0x16u);
      }
    }

    else
    {
      if (!v32)
      {
LABEL_24:

LABEL_25:
        goto LABEL_26;
      }

      v34 = objc_autoreleasePoolPush();
      v35 = *(a1 + 32);
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
      {
        v39 = HMFGetLogIdentifier();
        *buf = 138543618;
        v43 = v39;
        v44 = 2112;
        v45 = v33;
        _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save pairing identity error: %@", buf, 0x16u);
      }
    }

    objc_autoreleasePoolPop(v34);
    goto LABEL_24;
  }

  v25 = objc_autoreleasePoolPush();
  v26 = *(a1 + 32);
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
  {
    v28 = HMFGetLogIdentifier();
    v29 = *(a1 + 48);
    *buf = 138543618;
    v43 = v28;
    v44 = 2112;
    v45 = v29;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save accessory public pairing identity due to missing mkfAppleMediaAccessory with uuid: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v25);
LABEL_26:

  v40 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)aggregator residentCapabilitiesWithUUID:(id)d completion:(id)completion
{
  v32 = *MEMORY[0x277D85DE8];
  aggregatorCopy = aggregator;
  dCopy = d;
  completionCopy = completion;
  v11 = [(HMDHome *)self accessoryWithUUID:dCopy];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v12 = v11;
  }

  else
  {
    v12 = 0;
  }

  v13 = v12;

  if (v13)
  {
    backingStore = [(HMDHome *)self backingStore];
    context = [backingStore context];

    if (context)
    {
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __62__HMDHome_aggregator_residentCapabilitiesWithUUID_completion___block_invoke;
      v25[3] = &unk_27868A7A0;
      v26 = dCopy;
      v27 = completionCopy;
      [context performBlock:v25];
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      selfCopy = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543362;
        v29 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Did not find backingstore context", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v19;
      v30 = 2112;
      v31 = dCopy;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Did not find accessory for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    (*(completionCopy + 2))(completionCopy, 0);
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __62__HMDHome_aggregator_residentCapabilitiesWithUUID_completion___block_invoke(uint64_t a1)
{
  v5 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 32)];
  v2 = *(a1 + 40);
  v3 = [v5 resident];
  v4 = [v3 residentCapabilities];
  (*(v2 + 16))(v2, v4);
}

- (void)aggregator:(id)aggregator accessoryCapabilitiesWithUUID:(id)d completion:(id)completion
{
  v32 = *MEMORY[0x277D85DE8];
  aggregatorCopy = aggregator;
  dCopy = d;
  completionCopy = completion;
  v11 = [(HMDHome *)self accessoryWithUUID:dCopy];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v12 = v11;
  }

  else
  {
    v12 = 0;
  }

  v13 = v12;

  if (v13)
  {
    backingStore = [(HMDHome *)self backingStore];
    context = [backingStore context];

    if (context)
    {
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __63__HMDHome_aggregator_accessoryCapabilitiesWithUUID_completion___block_invoke;
      v25[3] = &unk_27868A7A0;
      v26 = dCopy;
      v27 = completionCopy;
      [context performBlock:v25];
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      selfCopy = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543362;
        v29 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Did not find backingstore context", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v19;
      v30 = 2112;
      v31 = dCopy;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Did not find accessory for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    (*(completionCopy + 2))(completionCopy, 0);
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __63__HMDHome_aggregator_accessoryCapabilitiesWithUUID_completion___block_invoke(uint64_t a1)
{
  v4 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 32)];
  v2 = *(a1 + 40);
  v3 = [v4 accessoryCapabilities];
  (*(v2 + 16))(v2, v3);
}

- (void)aggregatorDidBecomePrimary:(id)primary
{
  v26 = *MEMORY[0x277D85DE8];
  primaryCopy = primary;
  homeManager = [(HMDHome *)self homeManager];
  _accessoryOfCurrentDevice = [homeManager _accessoryOfCurrentDevice];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = _accessoryOfCurrentDevice;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  if (v8)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v23 = v13;
      v24 = 2112;
      v25 = v8;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Became primary with current accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    backingStore = [(HMDHome *)selfCopy backingStore];
    context = [backingStore context];

    v18[0] = MEMORY[0x277D85DD0];
    v18[1] = 3221225472;
    v18[2] = __38__HMDHome_aggregatorDidBecomePrimary___block_invoke;
    v18[3] = &unk_27868A010;
    v19 = appleMediaAccessories;
    v20 = selfCopy;
    v21 = context;
    v16 = context;
    [v16 performBlock:v18];
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome_aggregatorDidBecomePrimary___block_invoke(uint64_t a1)
{
  v1 = a1;
  v45 = *MEMORY[0x277D85DE8];
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v2 = *(a1 + 32);
  v34 = [v2 countByEnumeratingWithState:&v36 objects:v44 count:16];
  if (v34)
  {
    v3 = 0;
    v33 = *v37;
    v35 = v1;
    obj = v2;
    do
    {
      for (i = 0; i != v34; ++i)
      {
        if (*v37 != v33)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v36 + 1) + 8 * i);
        v6 = [v5 uuid];
        v7 = [HMCContext findAppleMediaAccessoryWithModelID:v6];

        v8 = [*(v1 + 40) capabilitiesAggregator];
        v9 = [v5 uuid];
        v10 = [v7 accessoryCapabilities];
        v11 = [v8 accessoryCapabilitiesForAccessory:v9 ifDifferentFrom:v10];

        if (v11)
        {
          [v7 setAccessoryCapabilities:v11];
          v12 = objc_autoreleasePoolPush();
          v13 = *(v1 + 40);
          v14 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
          {
            v15 = HMFGetLogIdentifier();
            v16 = [v5 uuid];
            *buf = 138543618;
            v41 = v15;
            v42 = 2112;
            v43 = v16;
            _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Accessory capabilities differ for %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v12);
          v3 = 1;
          v1 = v35;
        }

        v17 = [v7 resident];
        v18 = [*(v1 + 40) capabilitiesAggregator];
        v19 = [v5 uuid];
        v20 = [v17 residentCapabilities];
        v21 = [v18 residentCapabilitiesForAccessory:v19 ifDifferentFrom:v20];

        if (v17 && v21)
        {
          [v17 setResidentCapabilities:v21];
          v22 = objc_autoreleasePoolPush();
          v23 = *(v35 + 40);
          v24 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
          {
            v25 = HMFGetLogIdentifier();
            v26 = [v5 uuid];
            *buf = 138543618;
            v41 = v25;
            v42 = 2112;
            v43 = v26;
            _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Resident capabilities differ for %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v22);
          v3 = 1;
        }

        v1 = v35;
      }

      v34 = [obj countByEnumeratingWithState:&v36 objects:v44 count:16];
    }

    while (v34);

    if ((v3 & 1) != 0 && [*(v35 + 48) save])
    {
      v27 = objc_autoreleasePoolPush();
      v28 = *(v35 + 40);
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543362;
        v41 = v30;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saved capabilities as they are different", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v27);
    }
  }

  else
  {
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)aggregator changedResidentCapabilities:(id)capabilities rawCapabilities:(id)rawCapabilities accessoryUUID:(id)d homeUUID:(id)iD
{
  v26 = *MEMORY[0x277D85DE8];
  aggregatorCopy = aggregator;
  capabilitiesCopy = capabilities;
  rawCapabilitiesCopy = rawCapabilities;
  dCopy = d;
  iDCopy = iD;
  v17 = objc_autoreleasePoolPush();
  selfCopy = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v22 = 138543618;
    v23 = v20;
    v24 = 2112;
    v25 = dCopy;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received resident capabilities for accessory: %@", &v22, 0x16u);
  }

  objc_autoreleasePoolPop(v17);
  [(HMDHome *)selfCopy _writeResidentCapabilities:rawCapabilitiesCopy accessoryUUID:dCopy homeUUID:iDCopy];

  v21 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)aggregator changedAccessoryCapabilities:(id)capabilities rawCapabilities:(id)rawCapabilities accessoryUUID:(id)d homeUUID:(id)iD
{
  v26 = *MEMORY[0x277D85DE8];
  aggregatorCopy = aggregator;
  capabilitiesCopy = capabilities;
  rawCapabilitiesCopy = rawCapabilities;
  dCopy = d;
  iDCopy = iD;
  v17 = objc_autoreleasePoolPush();
  selfCopy = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v22 = 138543618;
    v23 = v20;
    v24 = 2112;
    v25 = dCopy;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received accessory capabilities for accessory: %@", &v22, 0x16u);
  }

  objc_autoreleasePoolPop(v17);
  [(HMDHome *)selfCopy _writeAccessoryCapabilities:rawCapabilitiesCopy accessoryUUID:dCopy homeUUID:iDCopy];

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_writeResidentCapabilities:(id)capabilities accessoryUUID:(id)d homeUUID:(id)iD
{
  capabilitiesCopy = capabilities;
  dCopy = d;
  v9 = [(HMDHome *)self accessoryWithUUID:dCopy];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if ((isKindOfClass & 1) != 0 && v9)
  {
    backingStore = [(HMDHome *)self backingStore];
    context = [backingStore context];

    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __61__HMDHome__writeResidentCapabilities_accessoryUUID_homeUUID___block_invoke;
    v14[3] = &unk_2786891E0;
    v15 = dCopy;
    v16 = capabilitiesCopy;
    v17 = context;
    selfCopy = self;
    v13 = context;
    [v13 performBlock:v14];
  }
}

void __61__HMDHome__writeResidentCapabilities_accessoryUUID_homeUUID___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 32)];
  v3 = *(a1 + 40);
  v4 = [v2 resident];
  [v4 setResidentCapabilities:v3];

  if ([*(a1 + 48) save])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 56);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 32);
      v11 = 138543618;
      v12 = v8;
      v13 = 2112;
      v14 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saved resident capabilities for %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_writeAccessoryCapabilities:(id)capabilities accessoryUUID:(id)d homeUUID:(id)iD
{
  capabilitiesCopy = capabilities;
  dCopy = d;
  v9 = [(HMDHome *)self accessoryWithUUID:dCopy];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if ((isKindOfClass & 1) != 0 && v9)
  {
    backingStore = [(HMDHome *)self backingStore];
    context = [backingStore context];

    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __62__HMDHome__writeAccessoryCapabilities_accessoryUUID_homeUUID___block_invoke;
    v14[3] = &unk_2786891E0;
    v15 = dCopy;
    v16 = capabilitiesCopy;
    v17 = context;
    selfCopy = self;
    v13 = context;
    [v13 performBlock:v14];
  }
}

void __62__HMDHome__writeAccessoryCapabilities_accessoryUUID_homeUUID___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 32)];
  [v2 setAccessoryCapabilities:*(a1 + 40)];
  if ([*(a1 + 48) save])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 56);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 32);
      v9 = 138543618;
      v10 = v6;
      v11 = 2112;
      v12 = v7;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saved accessory capabilities for %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (id)localAndRemoteSubscriptionProvider
{
  homeManager = [(HMDHome *)self homeManager];
  localAndRemoteSubscriptionProvider = [homeManager localAndRemoteSubscriptionProvider];

  return localAndRemoteSubscriptionProvider;
}

- (id)eventStoreReadHandle
{
  homeManager = [(HMDHome *)self homeManager];
  eventStoreReadHandle = [homeManager eventStoreReadHandle];

  return eventStoreReadHandle;
}

- (HMEEventForwarder)eventForwarder
{
  homeManager = [(HMDHome *)self homeManager];
  eventForwarder = [homeManager eventForwarder];

  return eventForwarder;
}

- (void)didReceiveAccessorySetting:(id)setting accessoryUUID:(id)d
{
  v35 = *MEMORY[0x277D85DE8];
  settingCopy = setting;
  dCopy = d;
  v8 = settingCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  if (v10 && ([v10 keyPath], v11 = objc_claimAutoreleasedReturnValue(), v12 = objc_msgSend(v11, "isEqualToString:", @"root.siri.availableLanguages"), v11, (v12 & 1) != 0))
  {
    v13 = [(HMDHome *)self accessoryWithUUID:dCopy];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v15)
    {
      notificationCenter = [(HMDHome *)self notificationCenter];
      v27 = @"HMDHomeNotificationKey";
      selfCopy = self;
      v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&selfCopy forKeys:&v27 count:1];
      [notificationCenter postNotificationName:@"HMDAppleMediaAccessoryLanguagesChangedNotification" object:self userInfo:v17];
    }

    else
    {
      v22 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543874;
        v30 = v25;
        v31 = 2112;
        v32 = v8;
        v33 = 2112;
        v34 = dCopy;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Received accessory setting %@ that is not for an accessory %@ in this home", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v22);
    }
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543618;
      v30 = v21;
      v31 = 2112;
      v32 = v8;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Unexpectedly received accessory setting %@ that is not for available languages", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (id)deviceForAppleMediaAccessoryMessageRouter:(id)router message:(id)message
{
  messagePayload = [message messagePayload];
  v6 = [messagePayload hmf_UUIDForKey:*MEMORY[0x277CCF0B8]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  device = [v9 device];

  return device;
}

- (BOOL)isCurrentDevicePairedWithWatchForSiriSecureAccessoryAccessController:(id)controller
{
  homeManager = [(HMDHome *)self homeManager];
  isPairedWithWatch = [homeManager isPairedWithWatch];

  return isPairedWithWatch;
}

- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithWatchAuthForSiriSecureAccessoryAccessController:(id)controller
{
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsSiriUnsecuringActionsWithWatchAuth = [localCapabilitiesDataSource supportsSiriUnsecuringActionsWithWatchAuth];

  return supportsSiriUnsecuringActionsWithWatchAuth;
}

- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithNoPasscodeForSiriSecureAccessoryAccessController:(id)controller
{
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsSiriUnsecuringActionsWithNoPasscode = [localCapabilitiesDataSource supportsSiriUnsecuringActionsWithNoPasscode];

  return supportsSiriUnsecuringActionsWithNoPasscode;
}

- (HMDSiriSecureAccessoryAccessController)siriSecureAccessoryAccessController
{
  dataSource = [(HMDHome *)self dataSource];
  v4 = [dataSource makeSiriSecureAccessoryAccessControllerWithDataSource:self];

  return v4;
}

- (BOOL)isMediaSystem:(id)system
{
  systemCopy = system;
  mediaSystems = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __25__HMDHome_isMediaSystem___block_invoke;
  v9[3] = &unk_278675410;
  v10 = systemCopy;
  v6 = systemCopy;
  v7 = [mediaSystems na_firstObjectPassingTest:v9];

  return v7 != 0;
}

uint64_t __25__HMDHome_isMediaSystem___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (BOOL)isSidekickAccessory:(id)accessory
{
  v3 = [(HMDHome *)self accessoryWithUUID:accessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = v5;
  if (v5)
  {
    siriEndpointProfile = [v5 siriEndpointProfile];
    v8 = siriEndpointProfile != 0;
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (BOOL)isAppleMediaAccessory:(id)accessory
{
  v3 = [(HMDHome *)self accessoryWithUUID:accessory];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & (v3 != 0);
}

- (BOOL)router:(id)router shouldHandleMessage:(id)message usingRouter:(id)usingRouter
{
  v35 = *MEMORY[0x277D85DE8];
  routerCopy = router;
  messageCopy = message;
  usingRouterCopy = usingRouter;
  accessoryMessageRouterViaPrimary = [(HMDHome *)self accessoryMessageRouterViaPrimary];

  if (accessoryMessageRouterViaPrimary != routerCopy)
  {
    v12 = 0;
    goto LABEL_18;
  }

  messagePayload = [messageCopy messagePayload];
  v14 = [messagePayload hmf_UUIDForKey:*MEMORY[0x277CCF0B8]];

  v15 = [(HMDHome *)self accessoryWithUUID:v14];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v16 = v15;
  }

  else
  {
    v16 = 0;
  }

  v17 = v16;

  currentAccessory = [(HMDHome *)self currentAccessory];
  uuid = [currentAccessory uuid];
  uuid2 = [v17 uuid];
  v21 = [uuid hmf_isEqualToUUID:uuid2];

  if (v17)
  {
    appleDeviceRouter = [(HMDHome *)self appleDeviceRouter];
    v23 = appleDeviceRouter;
    if (appleDeviceRouter == usingRouterCopy)
    {
      v24 = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident]| v21;

      if (v24)
      {
        v25 = objc_autoreleasePoolPush();
        selfCopy = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_DEBUG))
        {
          v28 = HMFGetLogIdentifier();
          v33 = 138543362;
          v34 = v28;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEBUG, "%{public}@accepting accessory router", &v33, 0xCu);
        }

        objc_autoreleasePoolPop(v25);
        v29 = 1;
        goto LABEL_14;
      }
    }

    else
    {
    }
  }

  v29 = 0;
LABEL_14:
  primaryResidentMessageRouter = [(HMDHome *)self primaryResidentMessageRouter];

  if (primaryResidentMessageRouter == usingRouterCopy)
  {
    v12 = 1;
  }

  else
  {
    v12 = v29;
  }

LABEL_18:
  v31 = *MEMORY[0x277D85DE8];
  return v12;
}

- (BOOL)remoteEventAllowedForTopic:(id)topic deviceType:(unint64_t)type userType:(unint64_t)userType
{
  topicCopy = topic;
  homeRemoteEventAccessController = [(HMDHome *)self homeRemoteEventAccessController];
  LOBYTE(userType) = [homeRemoteEventAccessController remoteEventAllowedForTopic:topicCopy deviceType:type userType:userType];

  return userType;
}

- (id)currentAccessoryHomeUUID
{
  currentAccessory = [(HMDHome *)self currentAccessory];

  if (currentAccessory)
  {
    uuid = [(HMDHome *)self uuid];
  }

  else
  {
    uuid = 0;
  }

  return uuid;
}

- (id)currentAccessorySetupMetricDispatcher
{
  homeManager = [(HMDHome *)self homeManager];
  currentAccessorySetupMetricDispatcher = [homeManager currentAccessorySetupMetricDispatcher];

  return currentAccessorySetupMetricDispatcher;
}

- (id)expandedTopicsWithTopics:(id)topics
{
  topicsCopy = topics;
  homeManager = [(HMDHome *)self homeManager];
  v6 = [HMDHomeEventsGenerated expandedTopicsWithTopics:topicsCopy homeManager:homeManager];

  return v6;
}

- (BOOL)canTopicBeForwardedToPrimaryFromResident:(id)resident
{
  residentCopy = resident;
  currentAccessory = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = currentAccessory;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    if (self)
    {
      v8 = MEMORY[0x277CD16F0];
      v9 = v7;
      uuid = [(HMDHome *)self uuid];
      uuid2 = [v9 uuid];

      self = [v8 topicPrefixWithHomeUUID:uuid accessoryUUID:uuid2];
    }

    v12 = [residentCopy hasPrefix:self];
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

- (id)messageTargetForDeviceIdentifier:(id)identifier
{
  identifierCopy = identifier;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __44__HMDHome_messageTargetForDeviceIdentifier___block_invoke;
  v11[3] = &unk_2786850E0;
  v12 = identifierCopy;
  v7 = identifierCopy;
  v8 = [residentDevices na_firstObjectPassingTest:v11];
  device = [v8 device];

  return device;
}

uint64_t __44__HMDHome_messageTargetForDeviceIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 device];
  v4 = [v3 identifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (BOOL)isDeviceIdentifierPrimaryResident:(id)resident
{
  residentCopy = resident;
  primaryResident = [(HMDHome *)self primaryResident];
  device = [primaryResident device];
  identifier = [device identifier];
  v8 = [identifier hmf_isEqualToUUID:residentCopy];

  return v8;
}

- (BOOL)isDevicePrimaryResident:(id)resident
{
  residentCopy = resident;
  primaryResident = [(HMDHome *)self primaryResident];
  device = [primaryResident device];
  v7 = [device isEqual:residentCopy];

  return v7;
}

- (BOOL)shouldAllowTopic:(id)topic forDeviceWithMessageIdentifier:(id)identifier
{
  v14[1] = *MEMORY[0x277D85DE8];
  topicCopy = topic;
  v7 = [(HMDHome *)self accessoryWithDeviceIdentifier:identifier];
  if (v7)
  {
    v14[0] = topicCopy;
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v14 count:1];
    uuid = [v7 uuid];
    v10 = [HMDAccessoryEventsGenerated topicsRemovingAccessoryTopics:v8 accessoryUUID:uuid];
    v11 = [v10 count] != 0;
  }

  else
  {
    v11 = 1;
  }

  v12 = *MEMORY[0x277D85DE8];
  return v11;
}

- (id)routerServerUserAccessControlProviderForIdentifier:(id)identifier
{
  identifierCopy = identifier;
  users = [(HMDHome *)self users];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __62__HMDHome_routerServerUserAccessControlProviderForIdentifier___block_invoke;
  v9[3] = &unk_278688680;
  v10 = identifierCopy;
  v6 = identifierCopy;
  v7 = [users na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __62__HMDHome_routerServerUserAccessControlProviderForIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (id)routerServerUserAccessControlProviderIdentifierForMessage:(id)message
{
  v3 = [message matchingRemoteIdentityUserForHome:self];
  uuid = [v3 uuid];

  return uuid;
}

- (void)primaryResidentClientHasConnectivityDidChangeForRemoteEventRouterClientController:(id)controller
{
  v17 = *MEMORY[0x277D85DE8];
  controllerCopy = controller;
  remoteEventRouterClientController = [(HMDHome *)self remoteEventRouterClientController];

  if (remoteEventRouterClientController == controllerCopy)
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      primaryResidentClientHasConnectivity = [controllerCopy primaryResidentClientHasConnectivity];
      v11 = @"down";
      if (primaryResidentClientHasConnectivity)
      {
        v11 = @"up";
      }

      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Connectivity to primary resident is %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    [(HMDHome *)selfCopy canReachPrimaryResidentChanged];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)clientController:(id)controller primaryClientConnectMessageFailWithError:(id)error
{
  errorCopy = error;
  homeManager = [(HMDHome *)self homeManager];
  v7 = [homeManager accessorySetupMetricDispatchersForHome:self];
  v14 = MEMORY[0x277D85DD0];
  v15 = 3221225472;
  v16 = __69__HMDHome_clientController_primaryClientConnectMessageFailWithError___block_invoke;
  v17 = &unk_278670998;
  selfCopy = self;
  v8 = errorCopy;
  v19 = v8;
  [v7 na_each:&v14];
  v9 = [(HMDHome *)self currentDevice:v14];
  if (v9)
  {
    v10 = v9;
    _hasConfirmedPrimaryResidentDevice = [(HMDHome *)self _hasConfirmedPrimaryResidentDevice];

    if (_hasConfirmedPrimaryResidentDevice)
    {
      currentAccessorySetupMetricDispatcher = [homeManager currentAccessorySetupMetricDispatcher];
      [currentAccessorySetupMetricDispatcher markEventRouterPrimaryClientConnectMessageFailedWithError:v8];

      currentAccessorySetupMetricDispatcher2 = [homeManager currentAccessorySetupMetricDispatcher];
      [currentAccessorySetupMetricDispatcher2 markCurrentDeviceConfirmedPrimaryResidentStatusDidChange:{-[HMDHome isCurrentDeviceConfirmedPrimaryResident](self, "isCurrentDeviceConfirmedPrimaryResident")}];
    }
  }
}

void __69__HMDHome_clientController_primaryClientConnectMessageFailWithError___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [v3 trackingInfo];
    v9 = [v8 accessoryUUID];
    v12 = 138543618;
    v13 = v7;
    v14 = 2112;
    v15 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Marking primary client connect message failed for accessory: %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = [*(a1 + 32) _hasConfirmedPrimaryResidentDevice];

  if (v10)
  {
    [v3 markEventRouterPrimaryClientConnectMessageFailedWithError:*(a1 + 40)];
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome_clientController_connectionStatusDidChange___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [v3 trackingInfo];
    v9 = [v8 accessoryUUID];
    v12 = 138543618;
    v13 = v7;
    v14 = 2112;
    v15 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Marking primary client connection status changed for accessory: %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = [*(a1 + 32) _hasConfirmedPrimaryResidentDevice];

  if (v10)
  {
    [v3 markEventRouterPrimaryClientConnectStatusChanged:*(a1 + 40)];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentUserRestrictedForRemoteEventRouterClientController:(id)controller
{
  currentUser = [(HMDHome *)self currentUser];
  isRestrictedGuest = [currentUser isRestrictedGuest];

  return isRestrictedGuest;
}

- (void)discoverPrimaryResidentForEventRouterClientController:(id)controller
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  [residentDeviceManager discoverPrimaryResidentForRequester:0];
}

- (BOOL)isCurrentDevicePrimaryResidentForRemoteEventRouterClientController:(id)controller
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  isCurrentDevicePrimaryResident = [residentDeviceManager isCurrentDevicePrimaryResident];

  return isCurrentDevicePrimaryResident;
}

- (BOOL)isCurrentDeviceResidentCapableForRemoteEventRouterClientController:(id)controller
{
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  isResidentCapable = [localCapabilitiesDataSource isResidentCapable];

  return isResidentCapable;
}

- (id)deviceForPrimaryResidentForRemoteEventRouterClientController:(id)controller
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];
  device = [primaryResidentDevice device];

  if ([device isCurrentDevice])
  {
    v6 = 0;
  }

  else
  {
    v6 = device;
  }

  return v6;
}

- (id)deviceForAccessoryUUID:(id)d forRemoteEventRouterClientController:(id)controller
{
  controller = [(HMDHome *)self accessoryWithUUID:d, controller];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = controller;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  if (v6)
  {
    deviceForDirectMessaging = [v6 deviceForDirectMessaging];
  }

  else
  {
    deviceForDirectMessaging = 0;
  }

  return deviceForDirectMessaging;
}

- (id)eventStoreWriteHandleForRemoteEventRouterClientController:(id)controller
{
  homeManager = [(HMDHome *)self homeManager];
  eventStoreWriteHandle = [homeManager eventStoreWriteHandle];

  return eventStoreWriteHandle;
}

- (id)eventStoreReadHandleForRemoteEventRouterClientController:(id)controller
{
  homeManager = [(HMDHome *)self homeManager];
  eventStoreReadHandle = [homeManager eventStoreReadHandle];

  return eventStoreReadHandle;
}

- (id)primaryResidentDeviceIdentifierForRemoteEventRouterClientController:(id)controller
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];
  device = [primaryResidentDevice device];
  identifier = [device identifier];

  return identifier;
}

- (void)clientController:(id)controller didReceiveFetchedCachedEvents:(id)events source:(id)source
{
  sourceCopy = source;
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __65__HMDHome_clientController_didReceiveFetchedCachedEvents_source___block_invoke;
  v9[3] = &unk_278670948;
  v9[4] = self;
  v10 = sourceCopy;
  v8 = sourceCopy;
  [events hmf_enumerateKeysAndObjectsWithAutoreleasePoolUsingBlock:v9];
}

void __65__HMDHome_clientController_didReceiveFetchedCachedEvents_source___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = *(a1 + 32);
  v6 = a3;
  v7 = a2;
  v9 = [v5 homeManager];
  v8 = [v9 memoryEventConsumer];
  [v8 didReceiveCachedEvent:v6 topic:v7 source:*(a1 + 40)];
}

- (id)eventRouterDumpStateInfo
{
  v20[1] = *MEMORY[0x277D85DE8];
  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];

  v19 = uUIDString;
  v17[0] = @"RemoteClientController";
  remoteEventRouterClientController = [(HMDHome *)self remoteEventRouterClientController];
  dumpStateDescription = [remoteEventRouterClientController dumpStateDescription];
  v7 = dumpStateDescription;
  if (dumpStateDescription)
  {
    v8 = dumpStateDescription;
  }

  else
  {
    v8 = &stru_283CF9D50;
  }

  v17[1] = @"RemoteServer";
  v18[0] = v8;
  remoteEventRouterServer = [(HMDHome *)self remoteEventRouterServer];
  dumpStateDescription2 = [remoteEventRouterServer dumpStateDescription];
  v11 = dumpStateDescription2;
  if (dumpStateDescription2)
  {
    v12 = dumpStateDescription2;
  }

  else
  {
    v12 = &stru_283CF9D50;
  }

  v18[1] = v12;
  v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v18 forKeys:v17 count:2];
  v20[0] = v13;
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v20 forKeys:&v19 count:1];

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

- (void)_handleRetrieveAsyncResults:(id)results
{
  v60 = *MEMORY[0x277D85DE8];
  resultsCopy = results;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    shortDescription = [resultsCopy shortDescription];
    *buf = 138543618;
    v54 = v8;
    v55 = 2112;
    v56 = shortDescription;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling retrieve async results message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [resultsCopy dataForKey:*MEMORY[0x277CD0510]];
  if (v10)
  {
    reportingSessionManager = [(HMDHome *)selfCopy reportingSessionManager];
    v12 = [reportingSessionManager consumeResponseMessagePayloadsForSessionWithReportContextRequestInfo:v10];

    if ([v12 count])
    {
      v45 = v10;
      v51 = 0u;
      v52 = 0u;
      v49 = 0u;
      v50 = 0u;
      v13 = v12;
      v48 = [v13 countByEnumeratingWithState:&v49 objects:v59 count:16];
      if (v48)
      {
        v47 = *v50;
        obj = v13;
        do
        {
          for (i = 0; i != v48; ++i)
          {
            if (*v50 != v47)
            {
              objc_enumerationMutation(obj);
            }

            v15 = *(*(&v49 + 1) + 8 * i);
            v16 = objc_autoreleasePoolPush();
            v17 = [v15 mutableCopy];
            [v17 setObject:MEMORY[0x277CBEC28] forKeyedSubscript:@"kMultiPartResponseKey"];
            v18 = objc_autoreleasePoolPush();
            v19 = selfCopy;
            v20 = selfCopy;
            v21 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
            {
              v22 = HMFGetLogIdentifier();
              *buf = 138543874;
              v54 = v22;
              v55 = 2112;
              v56 = v15;
              v57 = 2112;
              v58 = v17;
              _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Overriding payload in last cached message from %@ to %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v18);
            if ([resultsCopy qualityOfService] < 17)
            {
              qualityOfService = 17;
            }

            else
            {
              qualityOfService = [resultsCopy qualityOfService];
            }

            v24 = objc_alloc(MEMORY[0x277D0F820]);
            uuid = [(HMDHome *)v20 uuid];
            v26 = [v24 initWithTarget:uuid];

            v27 = objc_alloc(MEMORY[0x277D0F848]);
            v28 = [v17 copy];
            v29 = [v27 initWithName:@"kMultipleCharacteristicValuesUpdatedNotificationKey" qualityOfService:qualityOfService destination:v26 payload:v28];

            transport = [resultsCopy transport];
            [v29 setTransport:transport];
            identifier = [resultsCopy identifier];
            [v29 setIdentifier:identifier];

            msgDispatcher = [(HMDHome *)v20 msgDispatcher];
            [msgDispatcher sendMessage:v29];

            objc_autoreleasePoolPop(v16);
            selfCopy = v19;
          }

          v13 = obj;
          v48 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
        }

        while (v48);
      }

      [resultsCopy respondWithSuccess];
      v10 = v45;
    }

    else
    {
      v38 = v12;
      v39 = objc_autoreleasePoolPush();
      v40 = selfCopy;
      v41 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT))
      {
        v42 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v42;
        _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_DEFAULT, "%{public}@Did not find any response message payloads to retrieve", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v39);
      v43 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [resultsCopy respondWithError:v43];

      v13 = v38;
    }
  }

  else
  {
    v33 = objc_autoreleasePoolPush();
    v34 = selfCopy;
    v35 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
    {
      v36 = HMFGetLogIdentifier();
      messagePayload = [resultsCopy messagePayload];
      *buf = 138543618;
      v54 = v36;
      v55 = 2112;
      v56 = messagePayload;
      _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Could not find request info in message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v33);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [resultsCopy respondWithError:v13];
  }

  v44 = *MEMORY[0x277D85DE8];
}

- (void)endReportingSessionForMessage:(id)message
{
  messageCopy = message;
  v4 = reportContextFromMessage(messageCopy);
  if (v4)
  {
    v5 = messageCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (!v7)
    {
      reportingSessionManager = [(HMDHome *)self reportingSessionManager];
      identifier = [v5 identifier];
      [reportingSessionManager endSessionWithUUID:identifier];
    }
  }
}

- (void)handleReportingSessionResponseMessage:(id)message
{
  messageCopy = message;
  reportingSessionManager = [(HMDHome *)self reportingSessionManager];
  messagePayload = [messageCopy messagePayload];
  identifier = [messageCopy identifier];

  [reportingSessionManager addResponseMessagePayload:messagePayload toSessionWithUUID:identifier];
}

- (void)startReportingSessionForMessage:(id)message
{
  messageCopy = message;
  v4 = reportContextFromMessage(messageCopy);
  if (v4)
  {
    transport = [messageCopy transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = transport;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      reportingSessionManager = [(HMDHome *)self reportingSessionManager];
      identifier = [messageCopy identifier];
      [reportingSessionManager startSessionWithUUID:identifier reportContext:v4 xpcClientConnection:v7];
    }
  }
}

- (BOOL)hasCharacteristicNotificationRegistrations
{
  notificationRegistrations = [(HMDHome *)self notificationRegistrations];
  v3 = [notificationRegistrations count] != 0;

  return v3;
}

- (void)_applyNotificationDeregistrations
{
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationRegistrations minusSet:self->_notificationDeregistrations];
  [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories minusSet:self->_notificationDeregistrations];
  [(NSMutableSet *)self->_notificationDeregistrations removeAllObjects];

  os_unfair_recursive_lock_unlock();
}

- (void)removeNotificationDeregistrationForClientIdentifier:(id)identifier
{
  identifierCopy = identifier;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationDeregistrations removeObject:identifierCopy];
  os_unfair_recursive_lock_unlock();
}

- (void)addNotificationDeregistrationForClientIdentifier:(id)identifier
{
  identifierCopy = identifier;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationDeregistrations addObject:identifierCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSSet)notificationDeregistrations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationDeregistrations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (BOOL)isClientIdentifierSubscribedToAppleMediaAccessoryState:(id)state
{
  stateCopy = state;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories containsObject:stateCopy];
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (void)addNotificationRegistrationForClientIdentifier:(id)identifier includesAppleMediaAccessories:(BOOL)accessories
{
  accessoriesCopy = accessories;
  identifierCopy = identifier;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationRegistrations addObject:identifierCopy];
  if (accessoriesCopy)
  {
    [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories addObject:identifierCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)notificationRegistrationsForAppleMediaAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSSet)notificationRegistrations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationRegistrations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)handleSwitchFromResidentSelectionToREV2:(id)v2
{
  v19 = *MEMORY[0x277D85DE8];
  v2Copy = v2;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v18 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received request to switch from Resident Selection to REV2", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  backingStore = [(HMDHome *)selfCopy backingStore];
  context = [backingStore context];

  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __51__HMDHome_handleSwitchFromResidentSelectionToREV2___block_invoke;
  v14[3] = &unk_27868A010;
  v14[4] = selfCopy;
  v15 = context;
  v16 = v2Copy;
  v11 = v2Copy;
  v12 = context;
  [v12 performBlock:v14];

  v13 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome_handleSwitchFromResidentSelectionToREV2___block_invoke(uint64_t a1)
{
  v27 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  v4 = [MEMORY[0x277CCABB0] numberWithLong:2];
  [v3 setResidentSelectionVersion:v4];

  v5 = [v3 residentSelections];
  v23[0] = MEMORY[0x277D85DD0];
  v23[1] = 3221225472;
  v23[2] = __51__HMDHome_handleSwitchFromResidentSelectionToREV2___block_invoke_2;
  v23[3] = &unk_278670920;
  v6 = *(a1 + 40);
  v23[4] = *(a1 + 32);
  v24 = v6;
  [v5 hmf_enumerateWithAutoreleasePoolUsingBlock:v23];

  v7 = *(a1 + 40);
  v22 = 0;
  v8 = [v7 save:&v22];
  v9 = v22;
  v10 = v9;
  if (v8)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Finished removing Resident Selection models.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    [*(a1 + 48) respondWithSuccess];
  }

  else if (v9)
  {
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 32);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove Resident Selection models.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
    v19 = *(a1 + 48);
    v20 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
    [v19 respondWithError:v20];
  }

  v21 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome_handleSwitchFromResidentSelectionToREV2___block_invoke_2(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v12 = 138543618;
    v13 = v7;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Deleting: %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = v3;
  if ([v8 conformsToProtocol:&unk_283E89AA8])
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  [*(a1 + 40) deleteObject:v10];
  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleSetPreferredPrimaryMessage:(id)message
{
  v34 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    messagePayload = [messageCopy messagePayload];
    *buf = 138543618;
    v31 = v8;
    v32 = 2112;
    v33 = messagePayload;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@SetPreferredPrimary - Received set preferred primary message with payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  messagePayload2 = [messageCopy messagePayload];
  v11 = [messagePayload2 hmf_stringForKey:*MEMORY[0x277CD05B0]];

  messagePayload3 = [messageCopy messagePayload];
  v13 = [messagePayload3 hmf_BOOLForKey:*MEMORY[0x277CD05A8]];

  messagePayload4 = [messageCopy messagePayload];
  v15 = [messagePayload4 hmf_BOOLForKey:*MEMORY[0x277CD05B8]];

  destinationForEnabledResidents = [(HMDHome *)selfCopy destinationForEnabledResidents];
  if (!destinationForEnabledResidents)
  {
    v23 = objc_autoreleasePoolPush();
    v24 = selfCopy;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543362;
      v31 = v26;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_DEFAULT, "%{public}@SetPreferredPrimary - Not propagating message, no known enabled residents in home", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v23);
    if (v11)
    {
      goto LABEL_5;
    }

LABEL_10:
    clearPrimaryPreference(0);
    goto LABEL_11;
  }

  v29[0] = v11;
  v17 = [MEMORY[0x277CCABB0] numberWithBool:{v13, @"preferred.primary.identifier", @"preferred.primary.one.time"}];
  v29[1] = v17;
  v28[2] = @"preferred.primary.trigger.election";
  v18 = [MEMORY[0x277CCABB0] numberWithBool:v15];
  v29[2] = v18;
  v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:3];

  v20 = [[HMDRemoteMessage alloc] initWithName:@"mesh.setPreferredPrimary.debug" qualityOfService:9 destination:destinationForEnabledResidents payload:v19 type:3 timeout:1 secure:0.0];
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  [msgDispatcher sendMessage:v20];

  if (!v11)
  {
    goto LABEL_10;
  }

LABEL_5:
  setPrimaryPreference(v11, v13);
  if (v15)
  {
    residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
    [residentDeviceManager electResidentDevice:7];
  }

LABEL_11:
  [messageCopy respondWithSuccess];

  v27 = *MEMORY[0x277D85DE8];
}

- (id)destinationForEnabledResidents
{
  enabledResidents = [(HMDHome *)self enabledResidents];
  v4 = [enabledResidents na_map:&__block_literal_global_2392];

  if ([v4 count])
  {
    v5 = [HMDMultipleRemoteDeviceDestination alloc];
    uuid = [(HMDHome *)self uuid];
    v7 = [(HMDMultipleRemoteDeviceDestination *)v5 initWithTarget:uuid devices:v4];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

id __41__HMDHome_destinationForEnabledResidents__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 device];
  v4 = [v3 isCurrentDevice];

  if (v4)
  {
    v5 = 0;
  }

  else
  {
    v5 = [v2 device];
  }

  return v5;
}

- (void)_handleRollACWGIssuerKey:(id)key
{
  v27 = *MEMORY[0x277D85DE8];
  keyCopy = key;
  internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    uUID = [internalOnlyInitializer UUID];
    *buf = 138543618;
    v24 = v9;
    v25 = 2112;
    v26 = uUID;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Homeutil command received to ACWG issuer key in this home", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = +[HMDACWGKeyManager shared];
  uuid = [(HMDHome *)selfCopy uuid];
  currentUser = [(HMDHome *)selfCopy currentUser];
  uuid2 = [currentUser uuid];
  backingStore = [(HMDHome *)selfCopy backingStore];
  context = [backingStore context];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __36__HMDHome__handleRollACWGIssuerKey___block_invoke;
  v20[3] = &unk_2786708F8;
  v20[4] = selfCopy;
  v21 = internalOnlyInitializer;
  v22 = keyCopy;
  v17 = keyCopy;
  v18 = internalOnlyInitializer;
  [v11 getOrCreateIssuerKeyAndSaveIfNeededWithHome:uuid user:uuid2 context:context shouldRoll:1 completionHandler:v20];

  v19 = *MEMORY[0x277D85DE8];
}

void __36__HMDHome__handleRollACWGIssuerKey___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [*(a1 + 40) UUID];
    v14 = 138544130;
    v15 = v10;
    v16 = 2112;
    v17 = v11;
    v18 = 2112;
    v19 = v5;
    v20 = 2112;
    v21 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Issuer key %@ created with error %@", &v14, 0x2Au);
  }

  objc_autoreleasePoolPop(v7);
  v12 = *(a1 + 48);
  if (v6)
  {
    [v12 respondWithError:v6];
  }

  else
  {
    [v12 respondWithSuccess];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleRollReaderKey:(id)key
{
  v20 = *MEMORY[0x277D85DE8];
  keyCopy = key;
  internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    uUID = [internalOnlyInitializer UUID];
    *buf = 138543618;
    v17 = v9;
    v18 = 2112;
    v19 = uUID;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Homeutil command received to roll reader key in this home", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  nfcReaderKeyManager = [(HMDHome *)selfCopy nfcReaderKeyManager];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __32__HMDHome__handleRollReaderKey___block_invoke;
  v14[3] = &unk_27868A250;
  v15 = keyCopy;
  v12 = keyCopy;
  [nfcReaderKeyManager rollReaderKeyWithFlow:internalOnlyInitializer withCompletion:v14];

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __32__HMDHome__handleRollReaderKey___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithSuccess];
  }
}

- (void)_handleFetchOrCreateReaderKey:(id)key
{
  v30 = *MEMORY[0x277D85DE8];
  keyCopy = key;
  internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    uUID = [internalOnlyInitializer UUID];
    *buf = 138543618;
    v27 = v9;
    v28 = 2112;
    v29 = uUID;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Homeutil command received to FetchOrCreateReaderKey", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  nfcReaderKeyManager = [(HMDHome *)selfCopy nfcReaderKeyManager];
  v12 = [nfcReaderKeyManager fetchOrCreateReaderKeyForPairingWithFlow:internalOnlyInitializer];
  v23[0] = MEMORY[0x277D85DD0];
  v23[1] = 3221225472;
  v23[2] = __41__HMDHome__handleFetchOrCreateReaderKey___block_invoke;
  v23[3] = &unk_2786708D0;
  v23[4] = selfCopy;
  v13 = internalOnlyInitializer;
  v24 = v13;
  v14 = keyCopy;
  v25 = v14;
  v15 = [v12 addSuccessBlock:v23];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __41__HMDHome__handleFetchOrCreateReaderKey___block_invoke_2389;
  v20[3] = &unk_278688D58;
  v20[4] = selfCopy;
  v21 = v13;
  v22 = v14;
  v16 = v14;
  v17 = v13;
  v18 = [v15 addFailureBlock:v20];

  v19 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleFetchOrCreateReaderKey___block_invoke(id *a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = a1[4];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [a1[5] UUID];
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Fetched reader key: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  [a1[6] respondWithSuccess];

  v9 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleFetchOrCreateReaderKey___block_invoke_2389(id *a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = a1[4];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [a1[5] UUID];
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to fetch reader key with error: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  [a1[6] respondWithError:v3];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_handleTestUpgradeToROAR:(id)r
{
  v23 = *MEMORY[0x277D85DE8];
  rCopy = r;
  v5 = [rCopy numberForKey:*MEMORY[0x277CD0608]];
  v6 = v5;
  if (v5)
  {
    if ([v5 BOOLValue])
    {
      v7 = [HMDHomeUpgradedToROAR defaultModelForHome:self];
    }

    else
    {
      [(HMDHome *)self setIsUpdatedToHH2:0];
      v13 = [HMDHomeUpgradedToROAR alloc];
      v14 = [HMDHomeUpgradedToROAR modelIDForHome:self];
      uuid = [(HMDHome *)self uuid];
      v7 = [(HMDBackingStoreModelObject *)v13 initWithObjectChangeType:3 uuid:v14 parentUUID:uuid];

      [(HMDHome *)self saveWithReason:@"Downgrading To HH1" postSyncNotification:0 objectChange:1];
    }

    backingStore = [(HMDHome *)self backingStore];
    name = [rCopy name];
    v18 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v19 = [backingStore transaction:name options:v18];

    [v19 add:v7 withMessage:rCopy];
    [v19 run];
    [rCopy respondWithSuccess];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v11;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Update flag is needed.", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
    [rCopy respondWithError:v12];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (HMDHomeNFCReaderKey)nfcReaderKey
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_nfcReaderKey;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNfcReaderKey:(id)key
{
  keyCopy = key;
  os_unfair_recursive_lock_lock_with_options();
  nfcReaderKey = self->_nfcReaderKey;
  self->_nfcReaderKey = keyCopy;

  os_unfair_recursive_lock_unlock();
}

- (void)configureNaturalLightingForDemoMode
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Setting up natural lighting for demo mode", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  [(HMDHome *)selfCopy configureNaturalLightingWithDemoModeEnabled:1];
  v7 = *MEMORY[0x277D85DE8];
}

- (HMDNaturalLightingContext)naturalLightingContext
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_naturalLightingContext;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNaturalLightingContext:(id)context
{
  contextCopy = context;
  os_unfair_recursive_lock_lock_with_options();
  if ([(HMDNaturalLightingContext *)self->_naturalLightingContext isEqual:contextCopy])
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    v4 = [contextCopy copy];
    naturalLightingContext = self->_naturalLightingContext;
    self->_naturalLightingContext = v4;

    os_unfair_recursive_lock_unlock();
    logAndPostNotification(@"HMDHomeNaturalLightingContextUpdatedNotification", self, 0);
  }
}

- (NSArray)mediaSystems
{
  mediaSystemController = [(HMDHome *)self mediaSystemController];
  mediaSystems = [mediaSystemController mediaSystems];

  return mediaSystems;
}

- (BOOL)isResidentReachable:(id)reachable
{
  v32 = *MEMORY[0x277D85DE8];
  reachableCopy = reachable;
  if (-[HMDHome isCurrentDevicePrimaryResident](self, "isCurrentDevicePrimaryResident") || (-[HMDHome primaryResident](self, "primaryResident"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 isEqual:reachableCopy], v5, v6))
  {
    isReachable = [reachableCopy isReachable];
  }

  else
  {
    v25 = 0u;
    v26 = 0u;
    v23 = 0u;
    v24 = 0u;
    appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
    v11 = [appleMediaAccessories countByEnumeratingWithState:&v23 objects:v31 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v24;
      while (2)
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v24 != v13)
          {
            objc_enumerationMutation(appleMediaAccessories);
          }

          v15 = *(*(&v23 + 1) + 8 * i);
          device = [v15 device];
          device2 = [reachableCopy device];
          v18 = [device isEqual:device2];

          if (v18)
          {
            if ([v15 isReachable])
            {
              isReachable = 1;
            }

            else
            {
              isReachable = [v15 isDeviceReachable];
            }

            goto LABEL_4;
          }
        }

        v12 = [appleMediaAccessories countByEnumeratingWithState:&v23 objects:v31 count:16];
        if (v12)
        {
          continue;
        }

        break;
      }
    }

    v19 = objc_autoreleasePoolPush();
    selfCopy = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v22;
      v29 = 2112;
      v30 = reachableCopy;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_DEBUG, "%{public}@Could not find matching accessory for resident %@ so assuming unreachable", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    isReachable = 0;
  }

LABEL_4:

  v8 = *MEMORY[0x277D85DE8];
  return isReachable;
}

- (BOOL)isCompanionReachable
{
  homeManager = [(HMDHome *)self homeManager];
  companionReachable = [homeManager companionReachable];

  return companionReachable;
}

- (HMDDevice)companionDevice
{
  homeManager = [(HMDHome *)self homeManager];
  companionDevice = [homeManager companionDevice];

  return companionDevice;
}

- (void)_wol_processChangedCharacteristicResponses:(id)responses
{
  v24 = *MEMORY[0x277D85DE8];
  responsesCopy = responses;
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v4 = [responsesCopy countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v20;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v20 != v6)
        {
          objc_enumerationMutation(responsesCopy);
        }

        v8 = *(*(&v19 + 1) + 8 * i);
        request = [v8 request];
        characteristic = [request characteristic];

        accessory = [characteristic accessory];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = accessory;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if ([v13 canWakeUpViaWoL])
        {
          request2 = [v8 request];
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();

          v16 = (request2 == 0) | ~isKindOfClass;
          error = [v8 error];
          [v13 _wol_processReadWriteResponseForCharacteristic:characteristic isRead:v16 & 1 response:v8 error:error];
        }
      }

      v5 = [responsesCopy countByEnumeratingWithState:&v19 objects:v23 count:16];
    }

    while (v5);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (BOOL)attemptToUpdateThreadNetworkID:(id)d
{
  v23 = *MEMORY[0x277D85DE8];
  dCopy = d;
  os_unfair_recursive_lock_lock_with_options();
  unfilteredThreadNetworkID = self->_unfilteredThreadNetworkID;
  v7 = HMFEqualObjects();
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  if (v7)
  {
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v11 = HMFGetLogIdentifier();
      v17 = 138543618;
      v18 = v11;
      v19 = 2112;
      v20 = dCopy;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_DEBUG, "%{public}@unfilteredThreadNetworkID did not change (%@)", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  else
  {
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = self->_unfilteredThreadNetworkID;
      v17 = 138543874;
      v18 = v13;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = dCopy;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@unfilteredThreadNetworkID changed: %@ -> %@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    objc_storeStrong(&self->_unfilteredThreadNetworkID, d);
  }

  os_unfair_recursive_lock_unlock();

  v15 = *MEMORY[0x277D85DE8];
  return v7 ^ 1;
}

- (NSString)unfilteredThreadNetworkID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_unfilteredThreadNetworkID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setThreadNetworkSequenceNumber:(unint64_t)number
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  self->_threadNetworkSequenceNumber = number;
}

- (unint64_t)threadNetworkSequenceNumber
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  return self->_threadNetworkSequenceNumber;
}

- (void)_handleSetHomeManagerAppData:(id)data
{
  dataCopy = data;
  homeManager = [(HMDHome *)self homeManager];
  [homeManager setAppDataWithMessage:dataCopy];
}

- (void)_handleRemoteUserClientCloudShareRepairRequest:(id)request
{
  requestCopy = request;
  homeManager = [(HMDHome *)self homeManager];
  [homeManager handleRemoteUserClientCloudShareRepairRequest:requestCopy];
}

- (void)_handleRemoteUserClientCloudShareRequest:(id)request
{
  requestCopy = request;
  homeManager = [(HMDHome *)self homeManager];
  [homeManager handleRemoteUserClientCloudShareRequest:requestCopy];
}

- (void)handleXPCConnectionInvalidated:(id)invalidated
{
  invalidatedCopy = invalidated;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_handleXPCConnectionInvalidated___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = invalidatedCopy;
  selfCopy = self;
  v6 = invalidatedCopy;
  dispatch_async(workQueue, v7);
}

void __42__HMDHome_handleXPCConnectionInvalidated___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"connection"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (v5)
  {
    [*(a1 + 40) _removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:v5];
    v6 = [*(a1 + 40) deviceHomeKitSetupSession];
    v7 = [v6 clientConnection];
    v8 = HMFEqualObjects();

    if (v8)
    {
      v9 = objc_autoreleasePoolPush();
      v10 = *(a1 + 40);
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        v13 = [v5 shortDescription];
        v20 = 138543618;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Client connection %@ is invalidated, removing device HomeKit setup session", &v20, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      [*(a1 + 40) setDeviceHomeKitSetupSession:0];
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    v15 = *(a1 + 40);
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = *(a1 + 32);
      v20 = 138543618;
      v21 = v17;
      v22 = 2112;
      v23 = v18;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Received connection invalidated notification, but no connection object was found: %@", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (id)updatePersonManagerSettings:(id)settings
{
  settingsCopy = settings;
  personDataManager = [(HMDHome *)self personDataManager];
  v6 = [personDataManager updateSettingsModelWithSettings:settingsCopy];

  return v6;
}

- (HMDHomePersonManager)personManager
{
  personDataManager = [(HMDHome *)self personDataManager];
  personManager = [personDataManager personManager];

  return personManager;
}

- (void)setPersonManagerSettings:(id)settings
{
  settingsCopy = settings;
  os_unfair_recursive_lock_lock_with_options();
  if (([(HMHomePersonManagerSettings *)self->_personManagerSettings isEqual:settingsCopy]& 1) != 0)
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    v4 = [settingsCopy copy];
    personManagerSettings = self->_personManagerSettings;
    self->_personManagerSettings = v4;

    os_unfair_recursive_lock_unlock();
    logAndPostNotification(@"HMDHomePersonManagerSettingsDidChangeNotification", self, 0);
  }
}

- (HMHomePersonManagerSettings)personManagerSettings
{
  os_unfair_recursive_lock_lock_with_options();
  personManagerSettings = self->_personManagerSettings;
  if (personManagerSettings)
  {
    v4 = personManagerSettings;
  }

  else
  {
    v4 = objc_alloc_init(MEMORY[0x277CD1AB0]);
  }

  v5 = v4;
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (void)_removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:(id)devices
{
  devicesCopy = devices;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices containsObject:devicesCopy])
  {
    [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices removeObject:devicesCopy];
    v4 = [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices count];
    os_unfair_recursive_lock_unlock();
    if (!v4)
    {
      v5 = +[HMDMainDriver driver];
      symptomManager = [v5 symptomManager];
      [symptomManager stopDiscoveringSymptomsRequiringNearbyInfo];
    }
  }

  else
  {
    os_unfair_recursive_lock_unlock();
  }
}

- (void)_handleStopDiscoveringSymptomsForNearbyDevicesMessage:(id)message
{
  v15 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if ([(HMDHome *)self _ensureDevicesSymptomDiscoveryMessageCanBeHandled:messageCopy])
  {
    transport = [messageCopy transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = transport;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      [(HMDHome *)self _removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:v7];
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        v13 = 138543362;
        v14 = v11;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Asked to stop discovering symptoms, but no connection proxy was available", &v13, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
    }

    [messageCopy respondWithPayload:0];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_handleStartDiscoveringSymptomsForNearbyDevicesMessage:(id)message
{
  v18 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if ([(HMDHome *)self _ensureDevicesSymptomDiscoveryMessageCanBeHandled:messageCopy])
  {
    transport = [messageCopy transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = transport;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      os_unfair_recursive_lock_lock_with_options();
      if ([(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices containsObject:v7])
      {
        os_unfair_recursive_lock_unlock();
      }

      else
      {
        [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices addObject:v7];
        v12 = [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices count];
        os_unfair_recursive_lock_unlock();
        if (v12 == 1)
        {
          v13 = +[HMDMainDriver driver];
          symptomManager = [v13 symptomManager];
          [symptomManager startDiscoveringSymptomsRequiringNearbyInfo];
        }
      }
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        v16 = 138543362;
        v17 = v11;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Asked to start discovering symptoms, but no connection proxy was available", &v16, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
    }

    [messageCopy respondWithPayload:0];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (BOOL)_ensureDevicesSymptomDiscoveryMessageCanBeHandled:(id)handled
{
  v20 = *MEMORY[0x277D85DE8];
  handledCopy = handled;
  if ([handledCopy isEntitledForSPIAccess])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      LOBYTE(responseHandler) = 1;
      goto LABEL_13;
    }

    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      v18 = 138543362;
      v19 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Only owners may start discovering symptoms for nearby devices", &v18, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    responseHandler = [handledCopy responseHandler];

    if (responseHandler)
    {
      v10 = 17;
      goto LABEL_12;
    }
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      v18 = 138543362;
      v19 = v9;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Only entitled clients may stop discovering symptoms for nearby devices", &v18, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
    responseHandler = [handledCopy responseHandler];

    if (responseHandler)
    {
      v10 = 10;
LABEL_12:
      responseHandler = [MEMORY[0x277CCA9B8] hmErrorWithCode:v10];
      responseHandler2 = [handledCopy responseHandler];
      (responseHandler2)[2](responseHandler2, responseHandler, 0);

      LOBYTE(responseHandler) = 0;
    }
  }

LABEL_13:

  v16 = *MEMORY[0x277D85DE8];
  return responseHandler;
}

- (void)mediaSystemController:(id)controller didRemoveMediaSystem:(id)system
{
  systemCopy = system;
  homeManager = [(HMDHome *)self homeManager];
  lastEventStoreController = [homeManager lastEventStoreController];
  [lastEventStoreController didRemoveMediaSystem:systemCopy];
}

- (void)mediaSystemController:(id)controller removeAccessories:(id)accessories fromAssistantAccessControl:(id)control
{
  accessoriesCopy = accessories;
  controlCopy = control;
  currentUser = [(HMDHome *)self currentUser];
  v9 = [currentUser isEqual:controlCopy];

  if (v9)
  {
    currentUser2 = [(HMDHome *)self currentUser];
    [currentUser2 removeAccessoriesFromAssistantAccessControlList:accessoriesCopy];
  }
}

- (id)mediaSystemController:(id)controller accessoryForUUID:(id)d
{
  dCopy = d;
  accessories = [(HMDHome *)self accessories];
  v7 = [accessories hmf_firstObjectWithUUID:dCopy];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  return v8;
}

- (id)destinationForMediaSystem:(id)system
{
  systemCopy = system;
  mediaGroupsAggregateConsumer = [(HMDHome *)self mediaGroupsAggregateConsumer];
  uuid = [systemCopy uuid];

  v7 = [mediaGroupsAggregateConsumer destinationWithParentIdentifier:uuid];

  return v7;
}

- (void)userAssistantAccessControlDidUpdate:(id)update accessories:(id)accessories
{
  updateCopy = update;
  accessoriesCopy = accessories;
  currentUser = [(HMDHome *)self currentUser];
  v9 = [currentUser isEqual:updateCopy];

  if (v9)
  {
    workQueue = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __59__HMDHome_userAssistantAccessControlDidUpdate_accessories___block_invoke;
    block[3] = &unk_27868A010;
    block[4] = self;
    v12 = updateCopy;
    v13 = accessoriesCopy;
    dispatch_async(workQueue, block);
  }
}

void __59__HMDHome_userAssistantAccessControlDidUpdate_accessories___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) mediaSystemController];
  [v2 _userAssistantAccessControlDidUpdate:*(a1 + 40) accessories:*(a1 + 48)];
}

- (NSArray)cameraAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_2383];

  return v3;
}

id __28__HMDHome_cameraAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 cameraProfiles];
  v6 = [v5 count];

  if (v6)
  {
    v7 = v4;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (NSArray)hapAccessoriesForLegacyDataBlobEncoding
{
  hapAccessories = [(HMDHome *)self hapAccessories];
  v3 = [hapAccessories na_filter:&__block_literal_global_2381];

  return v3;
}

- (NSArray)nativeMatterAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_2379];

  return v3;
}

id __34__HMDHome_nativeMatterAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 conformsToProtocol:&unk_283F010C8])
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = 0;
  if ([v4 supportsCHIP])
  {
    v6 = v4;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = v6;
    }

    else
    {
      v7 = 0;
    }

    v5 = v7;
  }

  return v5;
}

- (id)matterAccessoryWithIdentifier:(id)identifier
{
  v3 = [(HMDHome *)self accessoryWithIdentifier:identifier];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (NSArray)matterAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_2224];

  return v3;
}

id __28__HMDHome_matterAccessories__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 conformsToProtocol:&unk_283F010C8])
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 supportsCHIP];
  if ((v6 & 1) != 0 || ([v5 matterNodeID], v2 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v2, "unsignedIntValue")))
  {
    v7 = v5;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = v7;
    }

    else
    {
      v8 = 0;
    }

    v9 = v8;

    if (v6)
    {
      goto LABEL_13;
    }
  }

  else
  {
    v9 = 0;
  }

LABEL_13:

  return v9;
}

- (NSArray)hapAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_2221];

  return v3;
}

void *__25__HMDHome_hapAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)_handleMediaPropertiesWrite:(id)write
{
  writeCopy = write;
  source = [writeCopy source];
  v6 = [writeCopy dictionaryForKey:@"kMediaPropertiesListKey"];
  objc_initWeak(&location, self);
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __39__HMDHome__handleMediaPropertiesWrite___block_invoke;
  v8[3] = &unk_27867A4A0;
  objc_copyWeak(&v10, &location);
  v7 = writeCopy;
  v9 = v7;
  [(HMDHome *)self _handleWriteMediaProperties:v6 source:source requestMessage:v7 completionHandler:v8];

  objc_destroyWeak(&v10);
  objc_destroyWeak(&location);
}

void __39__HMDHome__handleMediaPropertiesWrite___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Responding to media write with %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [*(a1 + 32) responseHandler];
    (v9)[2](v9, 0, v3);
  }

  else
  {
    v9 = [*(a1 + 32) responseHandler];
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    (v9)[2](v9, v10, 0);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleWriteMediaProperties:(id)properties source:(unint64_t)source requestMessage:(id)message completionHandler:(id)handler
{
  v63 = *MEMORY[0x277D85DE8];
  propertiesCopy = properties;
  messageCopy = message;
  handlerCopy = handler;
  v41 = propertiesCopy;
  v40 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(propertiesCopy, "count")}];
  group = dispatch_group_create();
  objc_initWeak(&location, self);
  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  allKeys = [propertiesCopy allKeys];
  v10 = [allKeys countByEnumeratingWithState:&v51 objects:v62 count:16];
  if (v10)
  {
    v39 = *v52;
    obj = allKeys;
    do
    {
      v42 = v10;
      for (i = 0; i != v42; ++i)
      {
        if (*v52 != v39)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v51 + 1) + 8 * i);
        v13 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:{v12, messageCopy}];
        v14 = [(HMDHome *)self mediaProfileWithUUID:v13];
        v15 = [v41 hmf_dictionaryForKey:v12];
        v16 = [HMDMediaPropertyWriteRequest deserializeWriteRequests:v15 mediaProfile:v14];
        if ([v16 count])
        {
          mediaSession = [v14 mediaSession];
          if (mediaSession)
          {
            dispatch_group_enter(group);
            v47[0] = MEMORY[0x277D85DD0];
            v47[1] = 3221225472;
            v47[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke;
            v47[3] = &unk_278684610;
            objc_copyWeak(&v50, &location);
            v48 = v40;
            v49 = group;
            [mediaSession writeProperties:v16 completion:v47];

            objc_destroyWeak(&v50);
          }

          else
          {
            v20 = objc_autoreleasePoolPush();
            selfCopy = self;
            v22 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
            {
              log = v22;
              v36 = v20;
              v23 = HMFGetLogIdentifier();
              accessory = [v14 accessory];
              name = [accessory name];
              *buf = 138543874;
              v57 = v23;
              v58 = 2112;
              v59 = name;
              v60 = 2112;
              v61 = v12;
              _os_log_impl(&dword_229538000, log, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ not reachable for writing", buf, 0x20u);

              v20 = v36;
              v22 = log;
            }

            objc_autoreleasePoolPop(v20);
            v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
            v27 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v16 error:v26];
            v28 = [HMDMediaPropertyResponse serializeResponses:v27];
            [v40 addEntriesFromDictionary:v28];

            mediaSession = 0;
          }
        }

        else
        {
          mediaSession = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v18 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v16 error:mediaSession];
          v19 = [HMDMediaPropertyResponse serializeResponses:v18];
          [v40 addEntriesFromDictionary:v19];
        }
      }

      allKeys = obj;
      v10 = [obj countByEnumeratingWithState:&v51 objects:v62 count:16];
    }

    while (v10);
  }

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_3;
  block[3] = &unk_27868A7A0;
  v45 = v40;
  v46 = handlerCopy;
  v30 = v40;
  v31 = handlerCopy;
  dispatch_group_notify(group, workQueue, block);

  objc_destroyWeak(&location);
  v32 = *MEMORY[0x277D85DE8];
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke(id *a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_2;
    block[3] = &unk_27868A010;
    v8 = a1[4];
    v9 = v3;
    v10 = a1[5];
    dispatch_async(v6, block);
  }
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_3(uint64_t a1)
{
  v1 = *(a1 + 40);
  if (v1)
  {
    v2 = [*(a1 + 32) copy];
    (*(v1 + 16))(v1, v2);
  }
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_2(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

- (void)redispatchMediaWriteRequests:(id)requests viaDevice:(id)device completion:(id)completion
{
  v29[1] = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  deviceCopy = device;
  completionCopy = completion;
  v10 = [HMDMediaPropertyWriteRequest serializeWriteRequests:requestsCopy];
  if ([v10 count])
  {
    uuid = [(HMDHome *)self uuid];
    uUIDString = [uuid UUIDString];

    v13 = *MEMORY[0x277CD0640];
    v27[0] = @"kMediaPropertiesListKey";
    v27[1] = v13;
    v28[0] = v10;
    v28[1] = uUIDString;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];
    v15 = MEMORY[0x277D0F848];
    messageDestination = [(HMDHome *)self messageDestination];
    v17 = [v15 messageWithName:@"kMediaPropertiesWriteRequestKey" qualityOfService:25 destination:messageDestination payload:v14];

    objc_initWeak(&location, self);
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __61__HMDHome_redispatchMediaWriteRequests_viaDevice_completion___block_invoke;
    v22[3] = &unk_278685EC0;
    objc_copyWeak(&v25, &location);
    v24 = completionCopy;
    v23 = requestsCopy;
    [v17 setResponseHandler:v22];
    uuid2 = [(HMDHome *)self uuid];
    workQueue = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v17 target:uuid2 responseQueue:workQueue viaDevice:deviceCopy];

    objc_destroyWeak(&v25);
    objc_destroyWeak(&location);
LABEL_5:

    goto LABEL_6;
  }

  if (completionCopy)
  {
    uUIDString = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v14 = [HMDMediaPropertyResponse propertyResponsesFromRequests:requestsCopy error:uUIDString];
    v29[0] = v14;
    v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v29 count:1];
    (*(completionCopy + 2))(completionCopy, v17);
    goto LABEL_5;
  }

LABEL_6:

  v20 = *MEMORY[0x277D85DE8];
}

void __61__HMDHome_redispatchMediaWriteRequests_viaDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v13[1] = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = *(a1 + 40);
    if (v5)
    {
      if (v8)
      {
        v9 = [HMDMediaPropertyResponse propertyResponsesFromRequests:*(a1 + 32) error:v5];
        v10 = *(a1 + 40);
        v13[0] = v9;
        v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
        (*(v10 + 16))(v10, v11);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v6 requests:*(a1 + 32) home:WeakRetained];
      (*(*(a1 + 40) + 16))();
      goto LABEL_7;
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_handleMediaPropertiesRead:(id)read
{
  location[3] = *MEMORY[0x277D85DE8];
  readCopy = read;
  v5 = [readCopy dictionaryForKey:@"kMediaPropertiesListKey"];
  if ([v5 count])
  {
    source = [readCopy source];
    objc_initWeak(location, self);
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __38__HMDHome__handleMediaPropertiesRead___block_invoke;
    v13[3] = &unk_27867A4A0;
    objc_copyWeak(&v15, location);
    v14 = readCopy;
    [(HMDHome *)self _handleReadMediaProperties:v5 source:source message:v14 completionHandler:v13];

    objc_destroyWeak(&v15);
    objc_destroyWeak(location);
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@None of the properties in media properties read are valid", location, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [readCopy respondWithError:v11];
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__handleMediaPropertiesRead___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Responding to media read with %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 32) respondWithPayload:v3];
  }

  else
  {
    v9 = *(a1 + 32);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v9 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleReadMediaProperties:(id)properties source:(unint64_t)source message:(id)message completionHandler:(id)handler
{
  v123 = *MEMORY[0x277D85DE8];
  propertiesCopy = properties;
  messageCopy = message;
  handlerCopy = handler;
  group = dispatch_group_create();
  v76 = propertiesCopy;
  v73 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(propertiesCopy, "count")}];
  objc_initWeak(&location, self);
  v107 = 0u;
  v108 = 0u;
  v105 = 0u;
  v106 = 0u;
  obj = [propertiesCopy allKeys];
  v79 = [obj countByEnumeratingWithState:&v105 objects:v114 count:16];
  if (v79)
  {
    v78 = *v106;
    v93 = *MEMORY[0x277CD0910];
    v92 = *MEMORY[0x277CD0938];
    v91 = *MEMORY[0x277CD0990];
    v90 = *MEMORY[0x277CD0960];
    v87 = *MEMORY[0x277CD09B0];
    v84 = *MEMORY[0x277CD0920];
    v80 = *MEMORY[0x277CD09A0];
    do
    {
      v88 = 0;
      do
      {
        if (*v106 != v78)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v105 + 1) + 8 * v88);
        v86 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v9];
        v89 = [(HMDHome *)self mediaProfileWithUUID:?];
        if (v89)
        {
          v82 = [v76 hmf_arrayForKey:v9];
          v10 = [HMDMediaPropertyRequest deserializeReadRequests:"deserializeReadRequests:mediaProfile:" mediaProfile:?];
          if (![v10 count])
          {
            goto LABEL_53;
          }

          mediaSession = [v89 mediaSession];
          accessory = [v89 accessory];
          v81 = v10;
          v77 = accessory;
          if (accessory)
          {
            identifier = [accessory identifier];
            v13 = [(HMDHome *)self mediaSessionStateWithIdentifier:identifier];

            if (!mediaSession && v13)
            {
              if ([(HMDHome *)self isCurrentDevicePrimaryResident])
              {
                v14 = objc_autoreleasePoolPush();
                selfCopy = self;
                v15 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
                {
                  v16 = HMFGetLogIdentifier();
                  accessory2 = [v89 accessory];
                  name = [accessory2 name];
                  *buf = 138543874;
                  v116 = v16;
                  v117 = 2112;
                  v118 = name;
                  v119 = 2112;
                  v120 = v9;
                  _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ has no session, returning local state", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v14);
                v13 = v13;
                v19 = v81;
                v71 = v19;
                if (self)
                {
                  v20 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v19, "count")}];
                  v21 = [MEMORY[0x277CBEAA8] now];
                  v112 = 0u;
                  v113 = 0u;
                  v110 = 0u;
                  v111 = 0u;
                  v22 = v71;
                  v23 = [v22 countByEnumeratingWithState:&v110 objects:buf count:16];
                  if (!v23)
                  {
                    goto LABEL_42;
                  }

                  v24 = *v111;
                  while (1)
                  {
                    for (i = 0; i != v23; ++i)
                    {
                      if (*v111 != v24)
                      {
                        objc_enumerationMutation(v22);
                      }

                      v26 = *(*(&v110 + 1) + 8 * i);
                      property = [v26 property];
                      v28 = [property isEqualToString:v93];

                      if (v28)
                      {
                        sessionIdentifier = [v13 sessionIdentifier];
                        v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                        goto LABEL_38;
                      }

                      property2 = [v26 property];
                      v32 = [property2 isEqualToString:v92];

                      if (v32)
                      {
                        sessionIdentifier = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "playbackState")}];
                        v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                        goto LABEL_38;
                      }

                      property3 = [v26 property];
                      v34 = [property3 isEqualToString:v91];

                      if (v34)
                      {
                        sessionIdentifier = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "shuffleState")}];
                        v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                        goto LABEL_38;
                      }

                      property4 = [v26 property];
                      v36 = [property4 isEqualToString:v90];

                      if (v36)
                      {
                        sessionIdentifier = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "repeatState")}];
                        v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                        goto LABEL_38;
                      }

                      property5 = [v26 property];
                      if ([property5 isEqualToString:v87])
                      {
                        volume = [v13 volume];
                        v39 = volume == 0;

                        if (!v39)
                        {
                          sessionIdentifier = [v13 volume];
                          v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                          goto LABEL_38;
                        }
                      }

                      else
                      {
                      }

                      property6 = [v26 property];
                      if ([property6 isEqualToString:v84])
                      {
                        mediaUniqueIdentifier = [v13 mediaUniqueIdentifier];
                        v42 = mediaUniqueIdentifier == 0;

                        if (!v42)
                        {
                          sessionIdentifier = [v13 mediaUniqueIdentifier];
                          v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                          goto LABEL_38;
                        }
                      }

                      else
                      {
                      }

                      property7 = [v26 property];
                      v44 = [property7 isEqualToString:v80];

                      if (!v44)
                      {
                        continue;
                      }

                      sessionIdentifier = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v13, "sleepWakeState")}];
                      v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
LABEL_38:
                      v45 = v30;

                      if (v45)
                      {
                        [v20 addObject:v45];
                      }
                    }

                    v23 = [v22 countByEnumeratingWithState:&v110 objects:buf count:16];
                    if (!v23)
                    {
LABEL_42:

                      v46 = [v20 copy];
                      goto LABEL_43;
                    }
                  }
                }

                v46 = 0;
LABEL_43:

                dispatch_group_enter(group);
                workQueue = [(HMDHome *)selfCopy workQueue];
                block[0] = MEMORY[0x277D85DD0];
                block[1] = 3221225472;
                block[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke;
                block[3] = &unk_27868A010;
                v102 = v73;
                v103 = v46;
                v104 = group;
                v48 = v46;
                dispatch_async(workQueue, block);

LABEL_52:
                v10 = v81;
LABEL_53:

                goto LABEL_54;
              }

LABEL_49:
              v55 = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v57 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
              {
                v58 = HMFGetLogIdentifier();
                accessory3 = [v89 accessory];
                name2 = [accessory3 name];
                *buf = 138543874;
                v116 = v58;
                v117 = 2112;
                v118 = name2;
                v119 = 2112;
                v120 = v9;
                _os_log_impl(&dword_229538000, v57, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ not reachable for reading", buf, 0x20u);
              }

              objc_autoreleasePoolPop(v55);
              v61 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
              v62 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v81 error:v61];
              v63 = [HMDMediaPropertyResponse serializeResponses:v62];
              [v73 addEntriesFromDictionary:v63];

              goto LABEL_52;
            }
          }

          else
          {
            v13 = 0;
          }

          if (mediaSession)
          {
            dispatch_group_enter(group);
            v49 = objc_autoreleasePoolPush();
            selfCopy3 = self;
            v51 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
            {
              v52 = HMFGetLogIdentifier();
              accessory4 = [v89 accessory];
              name3 = [accessory4 name];
              *buf = 138544130;
              v116 = v52;
              v117 = 2112;
              v118 = name3;
              v119 = 2112;
              v120 = v9;
              v121 = 2112;
              v122 = mediaSession;
              _os_log_impl(&dword_229538000, v51, OS_LOG_TYPE_INFO, "%{public}@Reading state for accessory with media profile %@/%@ from media session: %@", buf, 0x2Au);
            }

            objc_autoreleasePoolPop(v49);
            v97[0] = MEMORY[0x277D85DD0];
            v97[1] = 3221225472;
            v97[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2218;
            v97[3] = &unk_278684610;
            objc_copyWeak(&v100, &location);
            v98 = group;
            v99 = v73;
            [mediaSession readProperties:v81 completion:v97];

            objc_destroyWeak(&v100);
            goto LABEL_52;
          }

          goto LABEL_49;
        }

LABEL_54:

        ++v88;
      }

      while (v88 != v79);
      v64 = [obj countByEnumeratingWithState:&v105 objects:v114 count:16];
      v79 = v64;
    }

    while (v64);
  }

  workQueue2 = [(HMDHome *)self workQueue];
  v94[0] = MEMORY[0x277D85DD0];
  v94[1] = 3221225472;
  v94[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_3;
  v94[3] = &unk_27868A7A0;
  v95 = v73;
  v96 = handlerCopy;
  v66 = v73;
  v67 = handlerCopy;
  dispatch_group_notify(group, workQueue2, v94);

  objc_destroyWeak(&location);
  v68 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2218(id *a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2;
    block[3] = &unk_27868A010;
    v8 = a1[5];
    v9 = v3;
    v10 = a1[4];
    dispatch_async(v6, block);
  }

  else
  {
    dispatch_group_leave(a1[4]);
  }
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_3(uint64_t a1)
{
  v1 = *(a1 + 40);
  if (v1)
  {
    v2 = [*(a1 + 32) copy];
    (*(v1 + 16))(v1, v2);
  }
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

- (void)redispatchMediaReadRequests:(id)requests viaDevice:(id)device completion:(id)completion
{
  v29[1] = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  deviceCopy = device;
  completionCopy = completion;
  v10 = [HMDMediaPropertyRequest serializeReadRequests:requestsCopy];
  if ([v10 count])
  {
    uuid = [(HMDHome *)self uuid];
    uUIDString = [uuid UUIDString];

    v13 = *MEMORY[0x277CD0640];
    v27[0] = @"kMediaPropertiesListKey";
    v27[1] = v13;
    v28[0] = v10;
    v28[1] = uUIDString;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];
    v15 = MEMORY[0x277D0F848];
    messageDestination = [(HMDHome *)self messageDestination];
    v17 = [v15 messageWithName:@"kMediaPropertiesReadRequestKey" qualityOfService:33 destination:messageDestination payload:v14];

    objc_initWeak(&location, self);
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __60__HMDHome_redispatchMediaReadRequests_viaDevice_completion___block_invoke;
    v22[3] = &unk_278685EC0;
    objc_copyWeak(&v25, &location);
    v24 = completionCopy;
    v23 = requestsCopy;
    [v17 setResponseHandler:v22];
    uuid2 = [(HMDHome *)self uuid];
    workQueue = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v17 target:uuid2 responseQueue:workQueue viaDevice:deviceCopy];

    objc_destroyWeak(&v25);
    objc_destroyWeak(&location);
LABEL_5:

    goto LABEL_6;
  }

  if (completionCopy)
  {
    uUIDString = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v14 = [HMDMediaPropertyResponse propertyResponsesFromRequests:requestsCopy error:uUIDString];
    v29[0] = v14;
    v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v29 count:1];
    (*(completionCopy + 2))(completionCopy, v17);
    goto LABEL_5;
  }

LABEL_6:

  v20 = *MEMORY[0x277D85DE8];
}

void __60__HMDHome_redispatchMediaReadRequests_viaDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v13[1] = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = *(a1 + 40);
    if (v5)
    {
      if (v8)
      {
        v9 = [HMDMediaPropertyResponse propertyResponsesFromRequests:*(a1 + 32) error:v5];
        v10 = *(a1 + 40);
        v13[0] = v9;
        v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
        (*(v10 + 16))(v10, v11);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v6 requests:*(a1 + 32) home:WeakRetained];
      (*(*(a1 + 40) + 16))();
      goto LABEL_7;
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeMediaSessionState:(id)state
{
  stateCopy = state;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_mediaSessionStates containsObject:stateCopy])
  {
    [(NSMutableArray *)self->_mediaSessionStates removeObject:stateCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addMediaSessionState:(id)state
{
  stateCopy = state;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_mediaSessionStates containsObject:stateCopy]& 1) == 0)
  {
    [(NSMutableArray *)self->_mediaSessionStates addObject:stateCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)mediaSessionStateWithIdentifier:(id)identifier
{
  identifierCopy = identifier;
  if ([identifierCopy hasPrefix:@"direct://"])
  {
    identifierCopy = identifierCopy;
    v6 = [identifierCopy substringFromIndex:8];
  }

  else
  {
    identifierCopy = [MEMORY[0x277CCACA8] stringWithFormat:@"direct://%@", identifierCopy];
    v6 = identifierCopy;
  }

  v7 = v6;
  mediaSessionStates = [(HMDHome *)self mediaSessionStates];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __43__HMDHome_mediaSessionStateWithIdentifier___block_invoke;
  v13[3] = &unk_278670868;
  v14 = identifierCopy;
  v15 = v7;
  v9 = v7;
  v10 = identifierCopy;
  v11 = [mediaSessionStates na_firstObjectPassingTest:v13];

  return v11;
}

uint64_t __43__HMDHome_mediaSessionStateWithIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 sessionIdentifier];
  if ([v4 isEqualToString:*(a1 + 32)])
  {
    v5 = 1;
  }

  else
  {
    v6 = [v3 sessionIdentifier];
    v5 = [v6 isEqualToString:*(a1 + 40)];
  }

  return v5;
}

- (NSArray)mediaSessionStates
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_mediaSessionStates copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)removeMediaSession:(id)session
{
  sessionCopy = session;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_mediaSessions containsObject:sessionCopy])
  {
    [(NSMutableArray *)self->_mediaSessions removeObject:sessionCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addMediaSession:(id)session
{
  sessionCopy = session;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_mediaSessions containsObject:sessionCopy]& 1) == 0)
  {
    [(NSMutableArray *)self->_mediaSessions addObject:sessionCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)mediaSessionWithUUID:(id)d
{
  dCopy = d;
  mediaSessions = [(HMDHome *)self mediaSessions];
  v6 = [mediaSessions hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)mediaSessionWithIdentifier:(id)identifier
{
  identifierCopy = identifier;
  mediaSessions = [(HMDHome *)self mediaSessions];
  v6 = [mediaSessions hmf_firstObjectWithValue:identifierCopy forKeyPath:@"sessionIdentifier"];

  return v6;
}

- (NSArray)mediaSessions
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_mediaSessions copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (id)homeConfigurationModelObjectWithChangeType:(unint64_t)type
{
  v5 = [HMDHomeConfigurationModel alloc];
  homeConfigurationUUID = [(HMDHome *)self homeConfigurationUUID];
  uuid = [(HMDHome *)self uuid];
  v8 = [(HMDBackingStoreModelObject *)v5 initWithObjectChangeType:type uuid:homeConfigurationUUID parentUUID:uuid];

  v9 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome configurationVersion](self, "configurationVersion")}];
  [(HMDHomeConfigurationModel *)v8 setConfigurationVersion:v9];

  return v8;
}

- (id)homeConfigurationUUID
{
  v8[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277CCAD78];
  uuid = [(HMDHome *)self uuid];
  v8[0] = @"6741775F-2ED4-4DF8-B582-1F64BB3D1C75";
  v4 = [MEMORY[0x277CBEA60] arrayWithObjects:v8 count:1];
  v5 = [v2 hm_deriveUUIDFromBaseUUID:uuid identifierSalt:0 withSalts:v4];

  v6 = *MEMORY[0x277D85DE8];

  return v5;
}

- (id)emptyModelObjectWithChangeType:(unint64_t)type
{
  v5 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)self uuid];
  v7 = objc_alloc(MEMORY[0x277CCAD78]);
  v8 = [v7 initWithUUIDString:*MEMORY[0x277CD23C8]];
  v9 = [(HMDBackingStoreModelObject *)v5 initWithObjectChangeType:type uuid:uuid parentUUID:v8];

  return v9;
}

- (id)modelObjectWithChangeType:(unint64_t)type version:(int64_t)version
{
  v6 = [(HMDHome *)self emptyModelObjectWithChangeType:type];
  name = [(HMDHome *)self name];
  [v6 setName:name];

  ownerName = [(HMDHome *)self ownerName];
  if (ownerName)
  {
    v9 = ownerName;
    owner = [(HMDHome *)self owner];
    publicKey = [owner publicKey];

    if (publicKey)
    {
      ownerName2 = [(HMDHome *)self ownerName];
      [v6 setOwnerName:ownerName2];

      owner2 = [(HMDHome *)self owner];
      uuid = [owner2 uuid];
      uUIDString = [uuid UUIDString];
      [v6 setOwnerUUID:uUIDString];

      owner3 = [(HMDHome *)self owner];
      userID = [owner3 userID];
      [v6 setOwnerUserID:userID];

      owner4 = [(HMDHome *)self owner];
      publicKey2 = [owner4 publicKey];
      [v6 setOwnerPublicKey:publicKey2];
    }
  }

  v20 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isOwnerUser](self, "isOwnerUser")}];
  [v6 setOwned:v20];

  nfcReaderKey = [(HMDHome *)self nfcReaderKey];
  [v6 setNfcReaderKey:nfcReaderKey];

  creationDate = [(HMDHome *)self creationDate];

  if (creationDate)
  {
    creationDate2 = [(HMDHome *)self creationDate];
    [v6 setCreationDate:creationDate2];
  }

  firstHAPAccessoryAddedDate = [(HMDHome *)self firstHAPAccessoryAddedDate];

  if (firstHAPAccessoryAddedDate)
  {
    firstHAPAccessoryAddedDate2 = [(HMDHome *)self firstHAPAccessoryAddedDate];
    [v6 setFirstHAPAccessoryAddedDate:firstHAPAccessoryAddedDate2];
  }

  roomForEntireHome = [(HMDHome *)self roomForEntireHome];
  uuid2 = [roomForEntireHome uuid];
  uUIDString2 = [uuid2 UUIDString];
  [v6 setDefaultRoomUUID:uUIDString2];

  homeLocationHandler = [(HMDHome *)self homeLocationHandler];
  locationData = [homeLocationHandler locationData];
  v31 = encodeRootObject();
  [v6 setHomeLocationData:v31];

  if (version >= 4)
  {
    presenceAuthStatus = [(HMDHome *)self presenceAuthStatus];

    if (presenceAuthStatus)
    {
      presenceAuthStatus2 = [(HMDHome *)self presenceAuthStatus];
      number = [presenceAuthStatus2 number];
      [v6 setPresenceAuthorizationStatus:number];
    }

    presenceComputeStatus = [(HMDHome *)self presenceComputeStatus];

    if (presenceComputeStatus)
    {
      presenceComputeStatus2 = [(HMDHome *)self presenceComputeStatus];
      number2 = [presenceComputeStatus2 number];
      [v6 setPresenceComputeStatus:number2];
    }

    sharedHomeSourceVersion = [(HMDHome *)self sharedHomeSourceVersion];

    if (sharedHomeSourceVersion)
    {
      sharedHomeSourceVersion2 = [(HMDHome *)self sharedHomeSourceVersion];
      [v6 setSharedHomeSourceVersion:sharedHomeSourceVersion2];
    }

    v40 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome protectionMode](self, "protectionMode")}];
    [v6 setNetworkProtectionMode:v40];
  }

  if ([(HMDHome *)self isMultiUserEnabled])
  {
    v41 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isMultiUserEnabled](self, "isMultiUserEnabled")}];
    [v6 setMultiUserEnabled:v41];
  }

  hasAnyUserAcknowledgedCameraRecordingOnboarding = [v6 hasAnyUserAcknowledgedCameraRecordingOnboarding];

  if (hasAnyUserAcknowledgedCameraRecordingOnboarding)
  {
    v43 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasAnyUserAcknowledgedCameraRecordingOnboarding](self, "hasAnyUserAcknowledgedCameraRecordingOnboarding")}];
    [v6 setHasAnyUserAcknowledgedCameraRecordingOnboarding:v43];
  }

  if ([(HMDHome *)self hasOnboardedForAccessCode])
  {
    v44 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasOnboardedForAccessCode](self, "hasOnboardedForAccessCode")}];
    [v6 setHasOnboardedForAccessCode:v44];
  }

  if ([(HMDHome *)self shouldEncodeHasOnboardedForWalletKey])
  {
    v45 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasOnboardedForWalletKey](self, "hasOnboardedForWalletKey")}];
    [v6 setHasOnboardedForWalletKey:v45];
  }

  naturalLightingContext = [(HMDHome *)self naturalLightingContext];
  if (naturalLightingContext)
  {
    [v6 setNaturalLightingContext:naturalLightingContext];
  }

  chipStorage = [(HMDHome *)self chipStorage];
  [chipStorage updateHomeModel:v6];

  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    fabric = [(HMDHome *)self fabric];
    fabricID = [fabric fabricID];
    [v6 setMatterFabricID:fabricID];
  }

  v50 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome soundCheckEnabled](self, "soundCheckEnabled")}];
  [v6 setSoundCheckEnabled:v50];

  v51 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome audioAnalysisClassifierOptions](self, "audioAnalysisClassifierOptions")}];
  [v6 setAnalysisOptions:v51];

  v52 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome didOnboardAudioAnalysis](self, "didOnboardAudioAnalysis")}];
  [v6 setDidOnboardAnalysis:v52];

  v53 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome siriPhraseOptions](self, "siriPhraseOptions")}];
  [v6 setSiriPhraseOptions:v53];

  v54 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome locationServicesEnabled](self, "locationServicesEnabled")}];
  [v6 setLocationServicesEnabled:v54];

  v55 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome didOnboardLocationServices](self, "didOnboardLocationServices")}];
  [v6 setDidOnboardLocationServices:v55];

  return v6;
}

- (id)backingStoreObjects:(int64_t)objects hh2Migration:(BOOL)migration
{
  migrationCopy = migration;
  v238 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v7 = [(HMDHome *)self modelObjectWithChangeType:1 version:objects];
  [array addObject:v7];

  v220 = 0u;
  v221 = 0u;
  v218 = 0u;
  v219 = 0u;
  selfCopy = self;
  accessories = [(HMDHome *)self accessories];
  v9 = [accessories countByEnumeratingWithState:&v218 objects:v237 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v219;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v219 != v11)
        {
          objc_enumerationMutation(accessories);
        }

        v13 = *(*(&v218 + 1) + 8 * i);
        if (objects <= 3)
        {
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) == 0)
          {
            continue;
          }
        }

        v14 = [v13 backingStoreObjects:objects];
        [array addObjectsFromArray:v14];
      }

      v10 = [accessories countByEnumeratingWithState:&v218 objects:v237 count:16];
    }

    while (v10);
  }

  v216 = 0u;
  v217 = 0u;
  v214 = 0u;
  v215 = 0u;
  actionSets = [(HMDHome *)selfCopy actionSets];
  v16 = [actionSets countByEnumeratingWithState:&v214 objects:v236 count:16];
  if (v16)
  {
    v17 = v16;
    v18 = *v215;
    do
    {
      for (j = 0; j != v17; ++j)
      {
        if (*v215 != v18)
        {
          objc_enumerationMutation(actionSets);
        }

        v20 = *(*(&v214 + 1) + 8 * j);
        if (objects <= 1)
        {
          v21 = MEMORY[0x277CD1800];
          type = [*(*(&v214 + 1) + 8 * j) type];
          LOBYTE(v21) = [v21 isBuiltinActionSetType:type];

          if (v21)
          {
            continue;
          }
        }

        v23 = [v20 backingStoreObjects:objects];
        [array addObjectsFromArray:v23];
      }

      v17 = [actionSets countByEnumeratingWithState:&v214 objects:v236 count:16];
    }

    while (v17);
  }

  if (objects >= 3)
  {
    isWatch();
    v210 = 0u;
    v211 = 0u;
    v212 = 0u;
    v213 = 0u;
    triggerOwnedActionSets = [(HMDHome *)selfCopy triggerOwnedActionSets];
    v25 = [triggerOwnedActionSets countByEnumeratingWithState:&v210 objects:v235 count:16];
    if (v25)
    {
      v26 = v25;
      v27 = *v211;
      do
      {
        for (k = 0; k != v26; ++k)
        {
          if (*v211 != v27)
          {
            objc_enumerationMutation(triggerOwnedActionSets);
          }

          v29 = [*(*(&v210 + 1) + 8 * k) backingStoreObjects:objects];
          [array addObjectsFromArray:v29];
        }

        v26 = [triggerOwnedActionSets countByEnumeratingWithState:&v210 objects:v235 count:16];
      }

      while (v26);
    }

    v208 = 0u;
    v209 = 0u;
    v206 = 0u;
    v207 = 0u;
    triggers = [(HMDHome *)selfCopy triggers];
    v31 = [triggers countByEnumeratingWithState:&v206 objects:v234 count:16];
    if (v31)
    {
      v32 = v31;
      v33 = *v207;
      do
      {
        for (m = 0; m != v32; ++m)
        {
          if (*v207 != v33)
          {
            objc_enumerationMutation(triggers);
          }

          v35 = *(*(&v206 + 1) + 8 * m);
          requiresDataVersion4 = [v35 requiresDataVersion4];
          if (objects > 3 || (requiresDataVersion4 & 1) == 0)
          {
            v37 = [v35 backingStoreObjects:objects];
            [array addObjectsFromArray:v37];
          }
        }

        v32 = [triggers countByEnumeratingWithState:&v206 objects:v234 count:16];
      }

      while (v32);
    }
  }

  v204 = 0u;
  v205 = 0u;
  v202 = 0u;
  v203 = 0u;
  rooms = [(HMDHome *)selfCopy rooms];
  v39 = [rooms countByEnumeratingWithState:&v202 objects:v233 count:16];
  v40 = migrationCopy;
  if (v39)
  {
    v41 = v39;
    v42 = *v203;
    do
    {
      for (n = 0; n != v41; ++n)
      {
        if (*v203 != v42)
        {
          objc_enumerationMutation(rooms);
        }

        v44 = [*(*(&v202 + 1) + 8 * n) backingStoreObjects:objects];
        [array addObjectsFromArray:v44];
      }

      v41 = [rooms countByEnumeratingWithState:&v202 objects:v233 count:16];
    }

    while (v41);
  }

  v200 = 0u;
  v201 = 0u;
  v198 = 0u;
  v199 = 0u;
  zones = [(HMDHome *)selfCopy zones];
  v46 = [zones countByEnumeratingWithState:&v198 objects:v232 count:16];
  if (v46)
  {
    v47 = v46;
    v48 = *v199;
    do
    {
      for (ii = 0; ii != v47; ++ii)
      {
        if (*v199 != v48)
        {
          objc_enumerationMutation(zones);
        }

        v50 = [*(*(&v198 + 1) + 8 * ii) backingStoreObjects:objects];
        [array addObjectsFromArray:v50];
      }

      v47 = [zones countByEnumeratingWithState:&v198 objects:v232 count:16];
    }

    while (v47);
  }

  v196 = 0u;
  v197 = 0u;
  v194 = 0u;
  v195 = 0u;
  serviceGroups = [(HMDHome *)selfCopy serviceGroups];
  v52 = [serviceGroups countByEnumeratingWithState:&v194 objects:v231 count:16];
  if (v52)
  {
    v53 = v52;
    v54 = *v195;
    do
    {
      for (jj = 0; jj != v53; ++jj)
      {
        if (*v195 != v54)
        {
          objc_enumerationMutation(serviceGroups);
        }

        v56 = [*(*(&v194 + 1) + 8 * jj) backingStoreObjects:objects];
        [array addObjectsFromArray:v56];
      }

      v53 = [serviceGroups countByEnumeratingWithState:&v194 objects:v231 count:16];
    }

    while (v53);
  }

  v192 = 0u;
  v193 = 0u;
  v190 = 0u;
  v191 = 0u;
  users = [(HMDHome *)selfCopy users];
  v58 = [users countByEnumeratingWithState:&v190 objects:v230 count:16];
  if (v58)
  {
    v59 = v58;
    v60 = *v191;
    obj = users;
    do
    {
      for (kk = 0; kk != v59; ++kk)
      {
        if (*v191 != v60)
        {
          objc_enumerationMutation(users);
        }

        v62 = *(*(&v190 + 1) + 8 * kk);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();
        v64 = isKindOfClass;
        if (objects > 1 || (isKindOfClass & 1) == 0)
        {
          isWatch();
          if (objects > 3 || ([(HMDOutgoingHomeInvitation *)v62 requiresMakoSupport]& 1) == 0)
          {
            if (!v40 || ([(HMDOutgoingHomeInvitation *)v62 isOwner]& 1) != 0)
            {
              v65 = [(HMDOutgoingHomeInvitation *)v62 backingStoreObjects:objects];
              [array addObjectsFromArray:v65];

              continue;
            }

            if (v64)
            {
              v66 = objc_autoreleasePoolPush();
              v67 = selfCopy;
              v68 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v68, OS_LOG_TYPE_INFO))
              {
                v69 = HMFGetLogIdentifier();
                *buf = 138543618;
                v227 = v69;
                v228 = 2112;
                v229 = v62;
                v70 = v68;
                v71 = "%{public}@Skipping resident user [%@] for HH2 migration as it is deprecated in HH2";
                goto LABEL_83;
              }

              goto LABEL_84;
            }

            userID = [(HMDOutgoingHomeInvitation *)v62 userID];

            if (userID)
            {
              if ([(HMDHome *)selfCopy nonIPadResidentDeviceCountForHH2Migration])
              {
                v169 = [HMDOutgoingHomeInvitation alloc];
                v73 = MEMORY[0x277CCAD78];
                uuid = [(HMDOutgoingHomeInvitation *)v62 uuid];
                v225 = @"50690AC3-FD93-4D1F-A677-9369289BB998";
                v74 = [MEMORY[0x277CBEA60] arrayWithObjects:&v225 count:1];
                v75 = [v73 hm_deriveUUIDFromBaseUUID:uuid withSalts:v74];
                v76 = [(HMDOutgoingHomeInvitation *)v169 initWithUUID:v75 invitee:v62 invitationState:2 forHome:selfCopy expiryDate:0 messageIdentifier:0];

                v77 = v76;
                v78 = [(HMDOutgoingHomeInvitation *)v76 modelObjectWithChangeType:1 version:objects];
                [array addObject:v78];

                v79 = objc_autoreleasePoolPush();
                v80 = v77;
                v81 = selfCopy;
                v82 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
                {
                  HMFGetLogIdentifier();
                  v83 = v171 = v79;
                  *buf = 138543618;
                  v227 = v83;
                  v228 = 2112;
                  v229 = v80;
                  _os_log_impl(&dword_229538000, v82, OS_LOG_TYPE_INFO, "%{public}@Generated re-invite for shared user: %@", buf, 0x16u);

                  v79 = v171;
                }

                objc_autoreleasePoolPop(v79);
                [(HMDOutgoingHomeInvitation *)v62 setPrivilege:2];
                v84 = [(HMDOutgoingHomeInvitation *)v62 backingStoreObjects:objects];
                [array addObjectsFromArray:v84];
              }

              else
              {
                v85 = objc_autoreleasePoolPush();
                v86 = selfCopy;
                v87 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v87, OS_LOG_TYPE_INFO))
                {
                  v88 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v227 = v88;
                  v228 = 2112;
                  v229 = v62;
                  _os_log_impl(&dword_229538000, v87, OS_LOG_TYPE_INFO, "%{public}@Dropping shared user as there will be no valid resident after migration: %@", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v85);
              }

              v40 = migrationCopy;
            }

            else
            {
              v66 = objc_autoreleasePoolPush();
              v67 = selfCopy;
              v68 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v68, OS_LOG_TYPE_INFO))
              {
                v69 = HMFGetLogIdentifier();
                *buf = 138543618;
                v227 = v69;
                v228 = 2112;
                v229 = v62;
                v70 = v68;
                v71 = "%{public}@Skipping bad user [%@] for HH2 migration, no account handle";
LABEL_83:
                _os_log_impl(&dword_229538000, v70, OS_LOG_TYPE_INFO, v71, buf, 0x16u);

                v40 = migrationCopy;
              }

LABEL_84:

              objc_autoreleasePoolPop(v66);
            }

            users = obj;
            continue;
          }
        }
      }

      v59 = [users countByEnumeratingWithState:&v190 objects:v230 count:16];
    }

    while (v59);
  }

  if (objects >= 2)
  {
    v188 = 0u;
    v189 = 0u;
    v186 = 0u;
    v187 = 0u;
    obja = [(HMDHome *)selfCopy outgoingInvitations];
    v89 = [obja countByEnumeratingWithState:&v186 objects:v224 count:16];
    if (v89)
    {
      v90 = v89;
      v91 = *v187;
      do
      {
        for (mm = 0; mm != v90; ++mm)
        {
          if (*v187 != v91)
          {
            objc_enumerationMutation(obja);
          }

          v93 = *(*(&v186 + 1) + 8 * mm);
          if (objects <= 3)
          {
            user = [*(*(&v186 + 1) + 8 * mm) user];
            requiresMakoSupport = [user requiresMakoSupport];

            if (requiresMakoSupport)
            {
              continue;
            }
          }

          if (v40)
          {
            if (![(HMDHome *)selfCopy nonIPadResidentDeviceCountForHH2Migration])
            {
              v98 = objc_autoreleasePoolPush();
              v99 = selfCopy;
              v100 = HMFGetOSLogHandle();
              if (!os_log_type_enabled(v100, OS_LOG_TYPE_INFO))
              {
                goto LABEL_117;
              }

              v101 = HMFGetLogIdentifier();
              *buf = 138543618;
              v227 = v101;
              v228 = 2112;
              v229 = v93;
              v102 = v100;
              v103 = "%{public}@Dropping outgoing invite as there will be no valid resident after migration: %@";
LABEL_116:
              _os_log_impl(&dword_229538000, v102, OS_LOG_TYPE_INFO, v103, buf, 0x16u);

              goto LABEL_117;
            }

            if ([(HMDHomeInvitation *)v93 invitationState]!= 2)
            {
              v98 = objc_autoreleasePoolPush();
              v99 = selfCopy;
              v100 = HMFGetOSLogHandle();
              if (!os_log_type_enabled(v100, OS_LOG_TYPE_INFO))
              {
                goto LABEL_117;
              }

              v101 = HMFGetLogIdentifier();
              *buf = 138543618;
              v227 = v101;
              v228 = 2112;
              v229 = v93;
              v102 = v100;
              v103 = "%{public}@Dropping outgoing invite as it is in a terminal state: %@";
              goto LABEL_116;
            }

            users2 = [(HMDHome *)selfCopy users];
            v185[0] = MEMORY[0x277D85DD0];
            v185[1] = 3221225472;
            v185[2] = __44__HMDHome_backingStoreObjects_hh2Migration___block_invoke;
            v185[3] = &unk_278688680;
            v185[4] = v93;
            v97 = [users2 na_any:v185];

            if (v97)
            {
              v98 = objc_autoreleasePoolPush();
              v99 = selfCopy;
              v100 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v100, OS_LOG_TYPE_INFO))
              {
                v101 = HMFGetLogIdentifier();
                *buf = 138543618;
                v227 = v101;
                v228 = 2112;
                v229 = v93;
                v102 = v100;
                v103 = "%{public}@Dropping outgoing invite as there is already a matching user in the home: %@";
                goto LABEL_116;
              }

LABEL_117:

              objc_autoreleasePoolPop(v98);
              v40 = migrationCopy;
              continue;
            }
          }

          v104 = [(HMDOutgoingHomeInvitation *)v93 modelObjectWithChangeType:1 version:objects];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v105 = v104;
          }

          else
          {
            v105 = 0;
          }

          v106 = v105;

          if (v106)
          {
            [array addObject:v106];
          }
        }

        v90 = [obja countByEnumeratingWithState:&v186 objects:v224 count:16];
      }

      while (v90);
    }

    if (objects >= 3)
    {
      v183 = 0u;
      v184 = 0u;
      v181 = 0u;
      v182 = 0u;
      residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
      residentDevices = [residentDeviceManager residentDevices];

      v109 = [residentDevices countByEnumeratingWithState:&v181 objects:v223 count:16];
      if (v109)
      {
        v110 = v109;
        v111 = *v182;
        do
        {
          for (nn = 0; nn != v110; ++nn)
          {
            if (*v182 != v111)
            {
              objc_enumerationMutation(residentDevices);
            }

            v113 = [*(*(&v181 + 1) + 8 * nn) modelObjectWithChangeType:1 version:objects];
            [array addObject:v113];
          }

          v110 = [residentDevices countByEnumeratingWithState:&v181 objects:v223 count:16];
        }

        while (v110);
      }

      appData = [(HMDHome *)selfCopy appData];

      if (appData)
      {
        appData2 = [(HMDHome *)selfCopy appData];
        v116 = [appData2 modelObjectWithChangeType:1];
        [array addObject:v116];
      }

      if (objects >= 4)
      {
        v117 = [HMDHomeSettingsModel alloc];
        uuid2 = [(HMDHome *)selfCopy uuid];
        v119 = [HMDHomeSettingsModel modelIDForHomeUUID:uuid2];
        uuid3 = [(HMDHome *)selfCopy uuid];
        v121 = [(HMDBackingStoreModelObject *)v117 initWithObjectChangeType:1 uuid:v119 parentUUID:uuid3];

        v122 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isAutomaticSoftwareUpdateEnabled](selfCopy, "isAutomaticSoftwareUpdateEnabled")}];
        [(HMDHomeSettingsModel *)v121 setAutomaticSoftwareUpdateEnabled:v122];

        v123 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isAutomaticThirdPartyAccessorySoftwareUpdateEnabled](selfCopy, "isAutomaticThirdPartyAccessorySoftwareUpdateEnabled")}];
        [(HMDHomeSettingsModel *)v121 setAutomaticThirdPartyAccessorySoftwareUpdateEnabled:v123];

        [array addObject:v121];
        v124 = [HMDHomeMediaSettingsModel alloc];
        uuid4 = [(HMDHome *)selfCopy uuid];
        v126 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:uuid4];
        uuid5 = [(HMDHome *)selfCopy uuid];
        v128 = [(HMDBackingStoreModelObject *)v124 initWithObjectChangeType:1 uuid:v126 parentUUID:uuid5];

        v129 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome minimumMediaUserPrivilege](selfCopy, "minimumMediaUserPrivilege")}];
        [(HMDHomeMediaSettingsModel *)v128 setMinimumMediaUserPrivilege:v129];

        v130 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isMediaPeerToPeerEnabled](selfCopy, "isMediaPeerToPeerEnabled")}];
        [(HMDHomeMediaSettingsModel *)v128 setMediaPeerToPeerEnabled:v130];

        mediaPassword = [(HMDHome *)selfCopy mediaPassword];
        [(HMDHomeMediaSettingsModel *)v128 setMediaPassword:mediaPassword];

        [array addObject:v128];
        mediaSystemController = [(HMDHome *)selfCopy mediaSystemController];
        v133 = [mediaSystemController backingStoreObjectsForVersion:objects];

        if ([v133 count])
        {
          [array addObjectsFromArray:v133];
        }

        objb = v133;
        uuid6 = [(HMDHome *)selfCopy uuid];
        v135 = [HMDHomeNetworkRouterManagingDeviceSettingsModel defaultModelForHomeUUID:uuid6];

        primaryNetworkRouterManagingDeviceUUID = [(HMDHome *)selfCopy primaryNetworkRouterManagingDeviceUUID];
        uUIDString = [primaryNetworkRouterManagingDeviceUUID UUIDString];
        [v135 setPrimaryNetworkRouterManagingDeviceUUID:uUIDString];

        [array addObject:v135];
        uuid7 = [(HMDHome *)selfCopy uuid];
        v139 = [HMDHomeNetworkRouterSettingsModel defaultModelForHomeUUID:uuid7];

        activeNetworkRouterUUID = [(HMDHome *)selfCopy activeNetworkRouterUUID];
        uUIDString2 = [activeNetworkRouterUUID UUIDString];
        [v139 setActiveNetworkRouterAccessoryUUID:uUIDString2];

        v142 = +[HMDHomeKitVersion version6];
        minimumNetworkRouterSupportHomeKitVersion = [(HMDHome *)selfCopy minimumNetworkRouterSupportHomeKitVersion];
        if (!minimumNetworkRouterSupportHomeKitVersion || (v144 = minimumNetworkRouterSupportHomeKitVersion, -[HMDHome minimumNetworkRouterSupportHomeKitVersion](selfCopy, "minimumNetworkRouterSupportHomeKitVersion"), v145 = objc_claimAutoreleasedReturnValue(), v146 = [v145 compare:v142], v145, v144, v146 == -1))
        {
          versionString = [v142 versionString];
          [v139 setMinimumNetworkRouterSupportHomeKitVersion:versionString];
        }

        minHomeKitVersionForAccessoryNetworkProtectionChange = [(HMDHome *)selfCopy minHomeKitVersionForAccessoryNetworkProtectionChange];
        versionString2 = [minHomeKitVersionForAccessoryNetworkProtectionChange versionString];
        [v139 setMinHomeKitVersionForAccessoryNetworkProtectionChange:versionString2];

        [array addObject:v139];
        v179 = 0u;
        v180 = 0u;
        v177 = 0u;
        v178 = 0u;
        networkProtectionGroupRegistry = [(HMDHome *)selfCopy networkProtectionGroupRegistry];
        persistedGroups = [networkProtectionGroupRegistry persistedGroups];

        v152 = [persistedGroups countByEnumeratingWithState:&v177 objects:v222 count:16];
        if (v152)
        {
          v153 = v152;
          v154 = *v178;
          do
          {
            for (i1 = 0; i1 != v153; ++i1)
            {
              if (*v178 != v154)
              {
                objc_enumerationMutation(persistedGroups);
              }

              v156 = [*(*(&v177 + 1) + 8 * i1) modelForVersion:objects];
              [array addObject:v156];
            }

            v153 = [persistedGroups countByEnumeratingWithState:&v177 objects:v222 count:16];
          }

          while (v153);
        }

        v157 = [HMDHomeThreadNetworkModel defaultModelForHome:selfCopy];
        unfilteredThreadNetworkID = [(HMDHome *)selfCopy unfilteredThreadNetworkID];
        [v157 setThreadNetworkID:unfilteredThreadNetworkID];

        [array addObject:v157];
        uuid8 = [(HMDHome *)selfCopy uuid];
        v160 = [HMDHomePersonManagerSettingsModel defaultModelForHomeUUID:uuid8];

        personManagerZoneUUID = [(HMDHome *)selfCopy personManagerZoneUUID];
        [v160 setZoneUUID:personManagerZoneUUID];

        [array addObject:v160];
        labelsByAccessCode = [(HMDHome *)selfCopy labelsByAccessCode];
        v163 = [HMDAccessCodeDataManager createHomeAccessCodeModelsFromLabelsByAccessCode:labelsByAccessCode forHome:selfCopy];

        [array addObjectsFromArray:v163];
        removedUserInfoByAccessCode = [(HMDHome *)selfCopy removedUserInfoByAccessCode];
        v165 = [HMDAccessCodeDataManager createRemovedUserInfoModelsFromRemovedUserInfoByAccessCode:removedUserInfoByAccessCode forHome:selfCopy];

        [array addObjectsFromArray:v165];
      }
    }
  }

  v166 = array;

  v167 = *MEMORY[0x277D85DE8];
  return array;
}

uint64_t __44__HMDHome_backingStoreObjects_hh2Migration___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = [v2 user];
  v5 = [v4 isEqual:v3];

  return v5;
}

- (id)sharedHomeModel
{
  v3 = [HMDSharedHomeModel alloc];
  uuid = [(HMDHome *)self uuid];
  v5 = objc_alloc(MEMORY[0x277CCAD78]);
  v6 = [v5 initWithUUIDString:*MEMORY[0x277CD23C8]];
  v7 = [(HMDBackingStoreModelObject *)v3 initWithObjectChangeType:1 uuid:uuid parentUUID:v6];

  homeManager = [(HMDHome *)self homeManager];
  v9 = [homeManager generateDataForSharedHomeModel:self];
  [(HMDSharedHomeModel *)v7 setHomeData:v9];

  v10 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome configurationVersion](self, "configurationVersion")}];
  [(HMDSharedHomeModel *)v7 setConfigurationVersion:v10];

  return v7;
}

- (id)deletedBackingStoreObject
{
  homeManager = [(HMDHome *)self homeManager];
  isOwnerUser = [(HMDHome *)self isOwnerUser];
  v5 = off_2786661D8;
  if (!isOwnerUser)
  {
    v5 = off_278666320;
  }

  v6 = objc_alloc(*v5);
  uuid = [(HMDHome *)self uuid];
  uuid2 = [homeManager uuid];
  v9 = [v6 initWithObjectChangeType:3 uuid:uuid parentUUID:uuid2];

  return v9;
}

- (void)transactionObjectRemoved:(id)removed message:(id)message
{
  v56 = *MEMORY[0x277D85DE8];
  removedCopy = removed;
  messageCopy = message;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = removedCopy;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;
  if (!v9)
  {
    v11 = removedCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v12 = v11;
    }

    else
    {
      v12 = 0;
    }

    residentDeviceManager = v12;

    if (!residentDeviceManager)
    {
      v21 = v11;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v22 = v21;
      }

      else
      {
        v22 = 0;
      }

      internalOnlyInitializer2 = v22;

      if (!internalOnlyInitializer2)
      {
        homeObjectChangeHandler = [(HMDHome *)self homeObjectChangeHandler];
        [homeObjectChangeHandler handleObjectRemove:v21 message:messageCopy];

        internalOnlyInitializer2 = 0;
LABEL_38:

        goto LABEL_39;
      }

      messagePayload = [messageCopy messagePayload];
      internalOnlyInitializer = [messagePayload hmf_flowForKey:*MEMORY[0x277D0F1C8]];

      if (internalOnlyInitializer)
      {
        v25 = objc_autoreleasePoolPush();
        selfCopy = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          [internalOnlyInitializer UUID];
          v29 = v49 = v25;
          *buf = 138543618;
          v53 = v28;
          v54 = 2112;
          v55 = v29;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Handling removed removed-user access code model", buf, 0x16u);

          v25 = v49;
        }
      }

      else
      {
        internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
        v25 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v39 = v50 = v25;
          uUID = [internalOnlyInitializer UUID];
          *buf = 138543618;
          v53 = v39;
          v54 = 2112;
          v55 = uUID;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling removed removed-user access code model", buf, 0x16u);

          v25 = v50;
        }
      }

      objc_autoreleasePoolPop(v25);
      accessCodeManager = [(HMDHome *)self accessCodeManager];
      dataManager = [accessCodeManager dataManager];

      if (dataManager)
      {
        [dataManager handleRemovedHMDRemovedUserAccessCodeModel:internalOnlyInitializer2 message:messageCopy flow:internalOnlyInitializer];
      }

      else
      {
        v43 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v46 = v51 = v43;
          *buf = 138543362;
          v53 = v46;
          _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDRemovedUserAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);

          v43 = v51;
        }

        objc_autoreleasePoolPop(v43);
        v47 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [messageCopy respondWithError:v47];
      }

LABEL_37:
      goto LABEL_38;
    }

    messagePayload2 = [messageCopy messagePayload];
    internalOnlyInitializer2 = [messagePayload2 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

    if (internalOnlyInitializer2)
    {
      v15 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_23;
      }

      v18 = HMFGetLogIdentifier();
      uUID2 = [internalOnlyInitializer2 UUID];
      *buf = 138543618;
      v53 = v18;
      v54 = 2112;
      v55 = uUID2;
      v20 = "%{public}@[Flow: %@] Handling removed home access code model";
    }

    else
    {
      internalOnlyInitializer2 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
      v15 = objc_autoreleasePoolPush();
      selfCopy5 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_23;
      }

      v18 = HMFGetLogIdentifier();
      uUID2 = [internalOnlyInitializer2 UUID];
      *buf = 138543618;
      v53 = v18;
      v54 = 2112;
      v55 = uUID2;
      v20 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling removed home access code model";
    }

    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, v20, buf, 0x16u);

LABEL_23:
    objc_autoreleasePoolPop(v15);
    accessCodeManager2 = [(HMDHome *)self accessCodeManager];
    internalOnlyInitializer = [accessCodeManager2 dataManager];

    if (internalOnlyInitializer)
    {
      [internalOnlyInitializer handleRemovedHomeAccessCodeModel:residentDeviceManager message:messageCopy flow:internalOnlyInitializer2];
    }

    else
    {
      v32 = objc_autoreleasePoolPush();
      selfCopy6 = self;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543362;
        v53 = v35;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDHomeAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v32);
      v36 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [messageCopy respondWithError:v36];
    }

    goto LABEL_37;
  }

  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  [residentDeviceManager transactionObjectRemoved:removedCopy message:messageCopy];
LABEL_39:

  v48 = *MEMORY[0x277D85DE8];
}

- (void)transactionObjectUpdated:(id)updated newValues:(id)values message:(id)message
{
  v102 = *MEMORY[0x277D85DE8];
  updatedCopy = updated;
  valuesCopy = values;
  messageCopy = message;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = valuesCopy;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;
  if (!v12)
  {
    v14 = valuesCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;

    if (v16)
    {
      [(HMDHome *)self updateHomeConfigurationWithModel:v16 message:messageCopy];
LABEL_102:

      goto LABEL_103;
    }

    v17 = v14;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    if (v19)
    {
      residentDeviceManager = [(HMDHome *)self residentDeviceManager];
      [residentDeviceManager transactionObjectUpdated:updatedCopy newValues:v17 message:messageCopy];

LABEL_101:
      goto LABEL_102;
    }

    v21 = v17;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v22 = v21;
    }

    else
    {
      v22 = 0;
    }

    v23 = v22;

    if (v23)
    {
      homeManager = [(HMDHome *)self homeManager];
      [homeManager transactionObjectUpdated:updatedCopy newValues:v21 message:messageCopy];

LABEL_100:
      goto LABEL_101;
    }

    v25 = v21;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v26 = v25;
    }

    else
    {
      v26 = 0;
    }

    v27 = v26;

    if (v27)
    {
      __transactionHomeSettingsUpdated(self, v27, messageCopy);
      v23 = 0;
LABEL_99:

      goto LABEL_100;
    }

    v28 = v25;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v29 = v28;
    }

    else
    {
      v29 = 0;
    }

    v30 = v29;

    if (v30)
    {
      __transactionHomeMediaSettingsUpdated(self, v30, messageCopy);
      v31 = v30;
      v23 = 0;
LABEL_98:

      goto LABEL_99;
    }

    v32 = v28;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v33 = v32;
    }

    else
    {
      v33 = 0;
    }

    v34 = v33;

    if (v34)
    {
      [(HMDHome *)self updateNetworkRouterSettingsWithModel:v34 message:messageCopy];
      v35 = v34;
      v23 = 0;
LABEL_97:

      v31 = 0;
      goto LABEL_98;
    }

    v36 = v32;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v37 = v36;
    }

    else
    {
      v37 = 0;
    }

    v38 = v37;

    if (v38)
    {
      [(HMDHome *)self updateNetworkRouterManagingDeviceSettingsWithModel:v38 message:messageCopy];
      v39 = v38;
      v23 = 0;
LABEL_96:

      v35 = 0;
      goto LABEL_97;
    }

    v40 = v36;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v41 = v40;
    }

    else
    {
      v41 = 0;
    }

    v42 = v41;

    if (v42)
    {
      [(HMDHome *)self _updateThreadNetworkWithModel:v42 message:messageCopy];
      v43 = v42;
      v23 = 0;
LABEL_95:

      v39 = 0;
      goto LABEL_96;
    }

    v44 = v40;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v45 = v44;
    }

    else
    {
      v45 = 0;
    }

    v46 = v45;

    if (v46)
    {
      v47 = updatedCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v48 = v47;
      }

      else
      {
        v48 = 0;
      }

      v95 = v48;

      personDataManager = [(HMDHome *)self personDataManager];
      [personDataManager handleUpdatedSettingsModel:v46 previousSettingsModel:v95 message:messageCopy];

      goto LABEL_94;
    }

    v50 = v44;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v51 = v50;
    }

    else
    {
      v51 = 0;
    }

    v52 = v51;

    v94 = v52;
    if (v52)
    {
      messagePayload = [messageCopy messagePayload];
      v54 = [messagePayload hmf_flowForKey:*MEMORY[0x277D0F1C8]];

      internalOnlyInitializer = v54;
      if (v54)
      {
        context = objc_autoreleasePoolPush();
        selfCopy = self;
        log = HMFGetOSLogHandle();
        if (os_log_type_enabled(log, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          uUID = [v54 UUID];
          *buf = 138543618;
          v99 = v56;
          v100 = 2112;
          v101 = uUID;
          v58 = "%{public}@[Flow: %@] Handling updated home access code model";
LABEL_70:
          _os_log_impl(&dword_229538000, log, OS_LOG_TYPE_INFO, v58, buf, 0x16u);
        }
      }

      else
      {
        internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
        context = objc_autoreleasePoolPush();
        selfCopy2 = self;
        log = HMFGetOSLogHandle();
        if (os_log_type_enabled(log, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          uUID = [internalOnlyInitializer UUID];
          *buf = 138543618;
          v99 = v56;
          v100 = 2112;
          v101 = uUID;
          v58 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling updated home access code model";
          goto LABEL_70;
        }
      }

      objc_autoreleasePoolPop(context);
      accessCodeManager = [(HMDHome *)self accessCodeManager];
      dataManager = [accessCodeManager dataManager];

      if (dataManager)
      {
        [dataManager handleUpdatedHomeAccessCodeModel:v94 message:messageCopy flow:internalOnlyInitializer];
      }

      else
      {
        logb = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v72 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v72, OS_LOG_TYPE_ERROR))
        {
          contextc = HMFGetLogIdentifier();
          *buf = 138543362;
          v99 = contextc;
          _os_log_impl(&dword_229538000, v72, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDHomeAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
        }

        objc_autoreleasePoolPop(logb);
        v73 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [messageCopy respondWithError:v73];
      }

      goto LABEL_93;
    }

    v59 = v50;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v60 = v59;
    }

    else
    {
      v60 = 0;
    }

    v61 = v60;

    internalOnlyInitializer = v61;
    if (!v61)
    {
      v74 = v59;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v75 = v74;
      }

      else
      {
        v75 = 0;
      }

      v76 = v75;
      v97 = v74;

      if (v76)
      {
        [(HMDHome *)self updateROARStatus:v76 message:messageCopy];
        [messageCopy respondWithSuccess];
      }

      else
      {
        homeObjectChangeHandler = [(HMDHome *)self homeObjectChangeHandler];
        [homeObjectChangeHandler handleObjectUpdate:updatedCopy newValues:v97 message:messageCopy];
      }

      internalOnlyInitializer = 0;
LABEL_93:

      v46 = 0;
LABEL_94:

      v23 = 0;
      v43 = 0;
      goto LABEL_95;
    }

    messagePayload2 = [messageCopy messagePayload];
    v63 = [messagePayload2 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

    loga = v63;
    if (v63)
    {
      v85 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      contexta = HMFGetOSLogHandle();
      if (os_log_type_enabled(contexta, OS_LOG_TYPE_INFO))
      {
        v65 = HMFGetLogIdentifier();
        uUID2 = [v63 UUID];
        *buf = 138543618;
        v99 = v65;
        v100 = 2112;
        v101 = uUID2;
        v67 = "%{public}@[Flow: %@] Handling updated removed-user access code model";
LABEL_84:
        _os_log_impl(&dword_229538000, contexta, OS_LOG_TYPE_INFO, v67, buf, 0x16u);
      }
    }

    else
    {
      loga = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
      v85 = objc_autoreleasePoolPush();
      selfCopy5 = self;
      contexta = HMFGetOSLogHandle();
      if (os_log_type_enabled(contexta, OS_LOG_TYPE_INFO))
      {
        v65 = HMFGetLogIdentifier();
        uUID2 = [loga UUID];
        *buf = 138543618;
        v99 = v65;
        v100 = 2112;
        v101 = uUID2;
        v67 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling updated removed-user access code model";
        goto LABEL_84;
      }
    }

    objc_autoreleasePoolPop(v85);
    accessCodeManager2 = [(HMDHome *)self accessCodeManager];
    dataManager2 = [accessCodeManager2 dataManager];

    if (dataManager2)
    {
      [dataManager2 handleUpdatedHMDRemovedUserAccessCodeModel:internalOnlyInitializer message:messageCopy flow:loga];
    }

    else
    {
      contextb = objc_autoreleasePoolPush();
      selfCopy6 = self;
      v81 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v81, OS_LOG_TYPE_ERROR))
      {
        v86 = HMFGetLogIdentifier();
        *buf = 138543362;
        v99 = v86;
        _os_log_impl(&dword_229538000, v81, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDRemovedUserAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
      }

      objc_autoreleasePoolPop(contextb);
      v82 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [messageCopy respondWithError:v82];
    }

    goto LABEL_93;
  }

  v13 = [(HMDHome *)self updateHomeWithModel:v12 message:messageCopy];
LABEL_103:

  v84 = *MEMORY[0x277D85DE8];
}

- (void)updateNetworkRouterManagingDeviceSettingsWithModel:(id)model message:(id)message
{
  modelCopy = model;
  messageCopy = message;
  setProperties = [modelCopy setProperties];
  if ([setProperties containsObject:@"primaryNetworkRouterManagingDeviceUUID"])
  {
    primaryNetworkRouterManagingDeviceUUID = [(HMDHome *)self primaryNetworkRouterManagingDeviceUUID];
    uUIDString = [primaryNetworkRouterManagingDeviceUUID UUIDString];
    primaryNetworkRouterManagingDeviceUUID2 = [modelCopy primaryNetworkRouterManagingDeviceUUID];
    v11 = HMFEqualObjects();

    if (v11)
    {
      goto LABEL_5;
    }

    v12 = objc_alloc(MEMORY[0x277CCAD78]);
    primaryNetworkRouterManagingDeviceUUID3 = [modelCopy primaryNetworkRouterManagingDeviceUUID];
    setProperties = [v12 initWithUUIDString:primaryNetworkRouterManagingDeviceUUID3];

    [(HMDHome *)self setPrimaryNetworkRouterManagingDeviceUUID:setProperties];
    transactionResult = [messageCopy transactionResult];
    [(HMDHome *)self _evaluateNetworkRouterManagementForTransaction:transactionResult];
    [transactionResult markChanged];
  }

LABEL_5:
  [messageCopy respondWithPayload:0];
}

- (void)setHomeUpdatedToROARAndInformClients
{
  v14 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isUpdatedToHH2])
  {
    v3 = objc_autoreleasePoolPush();
    selfCopy = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v6;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@isUpdatedToHH2 is already set on this home. Not doing anything.", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  else if (![(HMDHome *)self isUpdatedToHH2])
  {
    [(HMDHome *)self setIsUpdatedToHH2:1];
    v7 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Marked home upgraded to HH2 & informing clients about the status", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    [(HMDHome *)selfCopy2 saveWithReason:@"Upgraded To HH2" postSyncNotification:0 objectChange:1];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)updateROARStatus:(id)status message:(id)message
{
  v20 = *MEMORY[0x277D85DE8];
  statusCopy = status;
  messageCopy = message;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543618;
    v17 = v11;
    v18 = 2112;
    v19 = statusCopy;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Found ROAR Model : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  transactionResult = [messageCopy transactionResult];
  workQueue = [(HMDHome *)selfCopy workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __36__HMDHome_updateROARStatus_message___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = selfCopy;
  dispatch_async(workQueue, block);

  [transactionResult markSaveToAssistant];
  [transactionResult markChanged];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)updateNetworkRouterSettingsWithModel:(id)model message:(id)message
{
  v59 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  transactionResult = [messageCopy transactionResult];
  setProperties = [modelCopy setProperties];
  v10 = [setProperties containsObject:@"activeNetworkRouterAccessoryUUID"];

  if (v10)
  {
    v11 = objc_alloc(MEMORY[0x277CCAD78]);
    activeNetworkRouterAccessoryUUID = [modelCopy activeNetworkRouterAccessoryUUID];
    v13 = [v11 initWithUUIDString:activeNetworkRouterAccessoryUUID];

    activeNetworkRouterUUID = [(HMDHome *)self activeNetworkRouterUUID];
    v15 = HMFEqualObjects();

    if ((v15 & 1) == 0)
    {
      [(HMDHome *)self setActiveNetworkRouterUUID:v13];
      if (v13)
      {
        activeNetworkRouterAccessoryUUID2 = [modelCopy activeNetworkRouterAccessoryUUID];
        activeNetworkRouterInitialSetupNeededUUID = [modelCopy activeNetworkRouterInitialSetupNeededUUID];
        -[HMDHome setActiveNetworkRouterInitialSetupNeeded:](self, "setActiveNetworkRouterInitialSetupNeeded:", [activeNetworkRouterAccessoryUUID2 isEqual:activeNetworkRouterInitialSetupNeededUUID]);
      }

      else
      {
        [(HMDHome *)self setActiveNetworkRouterInitialSetupNeeded:0];
      }
    }

    v18 = v15 ^ 1;
  }

  else
  {
    v18 = 0;
  }

  setProperties2 = [modelCopy setProperties];
  v20 = [setProperties2 containsObject:@"minimumNetworkRouterSupportHomeKitVersion"];

  if (v20)
  {
    minimumNetworkRouterSupportHomeKitVersion = [modelCopy minimumNetworkRouterSupportHomeKitVersion];

    if (minimumNetworkRouterSupportHomeKitVersion)
    {
      v22 = [HMDHomeKitVersion alloc];
      minimumNetworkRouterSupportHomeKitVersion2 = [modelCopy minimumNetworkRouterSupportHomeKitVersion];
      minimumNetworkRouterSupportHomeKitVersion = [(HMDHomeKitVersion *)v22 initWithString:minimumNetworkRouterSupportHomeKitVersion2];
    }

    v24 = +[HMDHomeKitVersion version6];
    if (-[HMDHome isOwnerUser](self, "isOwnerUser") && [transactionResult source] != 1 && -[HMDHomeKitVersion isGreaterThanVersion:](minimumNetworkRouterSupportHomeKitVersion, "isGreaterThanVersion:", v24))
    {
      v25 = objc_autoreleasePoolPush();
      selfCopy = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v45 = v25;
        v29 = v28 = v24;
        *buf = 138543874;
        v54 = v29;
        v55 = 2112;
        v56 = minimumNetworkRouterSupportHomeKitVersion;
        v57 = 2112;
        v58 = v28;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Overriding minimum router support HomeKit version to enable network router support from %@ in cloud to our version %@", buf, 0x20u);

        v24 = v28;
        v25 = v45;
      }

      objc_autoreleasePoolPop(v25);
      workQueue = [(HMDHome *)selfCopy workQueue];
      block = MEMORY[0x277D85DD0];
      v47 = 3221225472;
      v48 = __56__HMDHome_updateNetworkRouterSettingsWithModel_message___block_invoke;
      v49 = &unk_27868A010;
      v50 = selfCopy;
      v51 = minimumNetworkRouterSupportHomeKitVersion;
      v52 = messageCopy;
      dispatch_async(workQueue, &block);
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        [(HMDHome *)selfCopy2 minimumNetworkRouterSupportHomeKitVersion];
        v45 = transactionResult;
        v36 = v35 = v24;
        *buf = 138543874;
        v54 = v34;
        v55 = 2112;
        v56 = v36;
        v57 = 2112;
        v58 = minimumNetworkRouterSupportHomeKitVersion;
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Updating minimum router support HomeKit version to enable network router support from %@ to cloud version %@", buf, 0x20u);

        v24 = v35;
        transactionResult = v45;
      }

      objc_autoreleasePoolPop(v31);
      [(HMDHome *)selfCopy2 setMinimumNetworkRouterSupportHomeKitVersion:minimumNetworkRouterSupportHomeKitVersion];
      v18 = 1;
    }
  }

  setProperties3 = [modelCopy setProperties];
  v38 = [setProperties3 containsObject:@"minHomeKitVersionForAccessoryNetworkProtectionChange"];

  if (v38)
  {
    minHomeKitVersionForAccessoryNetworkProtectionChange = [modelCopy minHomeKitVersionForAccessoryNetworkProtectionChange];

    if (minHomeKitVersionForAccessoryNetworkProtectionChange)
    {
      v40 = [HMDHomeKitVersion alloc];
      minHomeKitVersionForAccessoryNetworkProtectionChange2 = [modelCopy minHomeKitVersionForAccessoryNetworkProtectionChange];
      minHomeKitVersionForAccessoryNetworkProtectionChange = [(HMDHomeKitVersion *)v40 initWithString:minHomeKitVersionForAccessoryNetworkProtectionChange2];
    }

    minHomeKitVersionForAccessoryNetworkProtectionChange3 = [(HMDHome *)self minHomeKitVersionForAccessoryNetworkProtectionChange];
    v43 = HMFEqualObjects();

    if (v43)
    {

      if ((v18 & 1) == 0)
      {
        goto LABEL_31;
      }
    }

    else
    {
      [(HMDHome *)self setMinHomeKitVersionForAccessoryNetworkProtectionChange:minHomeKitVersionForAccessoryNetworkProtectionChange];
    }
  }

  else if (!v18)
  {
    goto LABEL_31;
  }

  [(HMDHome *)self _evaluateNetworkRouterManagementForTransaction:transactionResult];
  [transactionResult markChanged];
LABEL_31:
  [messageCopy respondWithPayload:0];

  v44 = *MEMORY[0x277D85DE8];
}

- (void)updateHomeConfigurationWithModel:(id)model message:(id)message
{
  v31 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  transactionResult = [messageCopy transactionResult];
  setProperties = [modelCopy setProperties];
  v10 = [setProperties containsObject:@"configurationVersion"];

  if (v10)
  {
    configurationVersion = [modelCopy configurationVersion];
    integerValue = [configurationVersion integerValue];

    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = HMFGetLogIdentifier();
      v23 = 138544130;
      v24 = v16;
      v25 = 2048;
      v26 = integerValue;
      v27 = 2048;
      lastSyncedConfigurationVersion = [(HMDHome *)selfCopy lastSyncedConfigurationVersion];
      v29 = 2048;
      configurationVersion2 = [(HMDHome *)selfCopy configurationVersion];
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Received incoming configuration version %lu, last synced was %lu, and current is %lu", &v23, 0x2Au);
    }

    objc_autoreleasePoolPop(v13);
    if ([(HMDHome *)selfCopy isOwnerUser])
    {
      if (integerValue >= [(HMDHome *)selfCopy configurationVersion])
      {
        configurationVersion3 = [(HMDHome *)selfCopy configurationVersion];
        if (configurationVersion3 <= [(HMDHome *)selfCopy lastSyncedConfigurationVersion])
        {
          [(HMDHome *)selfCopy setConfigurationVersion:integerValue];
        }

        else
        {
          [(HMDHome *)selfCopy setConfigurationVersion:integerValue + 1];
          [(HMDHome *)selfCopy __saveConfigurationVersionTransaction];
        }

        [(HMDHome *)selfCopy setLastSyncedConfigurationVersion:integerValue];
      }

      else
      {
        [(HMDHome *)selfCopy __saveConfigurationVersionTransaction];
      }
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = selfCopy;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        v20 = HMFGetLogIdentifier();
        v23 = 138543362;
        v24 = v20;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Shared user will use incoming configuration version", &v23, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      [(HMDHome *)v18 setConfigurationVersion:integerValue];
      [(HMDHome *)v18 setLastSyncedConfigurationVersion:integerValue];
      [(HMDHome *)v18 setExpectedConfigurationVersion:0];
    }
  }

  [messageCopy respondWithPayload:0];
  [transactionResult markChanged];

  v22 = *MEMORY[0x277D85DE8];
}

- (id)updateHomeWithModel:(id)model message:(id)message
{
  v319 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  transactionResult = [(HMDHome *)messageCopy transactionResult];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    *buf = 138543874;
    v315 = v12;
    v316 = 2112;
    *v317 = modelCopy;
    *&v317[8] = 2112;
    v318 = messageCopy;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Updating home with model: %@ / %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v9);
  residentSyncClientDidSync = [modelCopy residentSyncClientDidSync];
  -[HMDHome setResidentSyncClientDidSync:](selfCopy, "setResidentSyncClientDidSync:", [residentSyncClientDidSync BOOLValue]);

  if ([(HMDHome *)selfCopy residentSyncDidSync])
  {
    v14 = objc_autoreleasePoolPush();
    v15 = selfCopy;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v315 = v17;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Fulfilling resident sync complete promise", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
    residentSyncClientDidSyncPromise = [(HMDHome *)v15 residentSyncClientDidSyncPromise];
    [residentSyncClientDidSyncPromise fulfillWithNoValue];
  }

  setProperties = [modelCopy setProperties];
  v20 = [setProperties containsObject:@"owned"];

  v302 = transactionResult;
  if (v20)
  {
    owned = [modelCopy owned];
    -[HMDHome setOwnerUser:](selfCopy, "setOwnerUser:", [owned BOOLValue]);

    v22 = objc_autoreleasePoolPush();
    v23 = selfCopy;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      [(HMDHome *)v23 isOwnerUser];
      v26 = HMFBooleanToString();
      *buf = 138543618;
      v315 = v25;
      v316 = 2112;
      *v317 = v26;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Is this device owner of this home : [%@]", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
  }

  nfcReaderKey = [modelCopy nfcReaderKey];
  setProperties2 = [modelCopy setProperties];
  v298 = nfcReaderKey;
  if ([setProperties2 containsObject:@"hh2EncodedNfcReaderKey"])
  {
    nfcReaderKey2 = [(HMDHome *)selfCopy nfcReaderKey];
    v30 = HMFEqualObjects();

    if (v30)
    {
      goto LABEL_17;
    }

    v31 = objc_autoreleasePoolPush();
    v32 = selfCopy;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      nfcReaderKey3 = [(HMDHome *)v32 nfcReaderKey];
      *buf = 138543874;
      v315 = v34;
      v316 = 2112;
      *v317 = nfcReaderKey3;
      *&v317[8] = 2112;
      v318 = v298;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@HH2: Updating nfc reader key from %@ -> %@", buf, 0x20u);

      nfcReaderKey = v298;
    }

    objc_autoreleasePoolPop(v31);
    setProperties2 = [MEMORY[0x277CBEB38] dictionary];
    nfcReaderKey4 = [(HMDHome *)v32 nfcReaderKey];
    [setProperties2 setObject:nfcReaderKey4 forKeyedSubscript:@"HMDHomeDidUpdateNFCReaderKeyNotificationKeyPreviousNFCReaderKey"];

    [(HMDHome *)v32 setNfcReaderKey:nfcReaderKey];
    logAndPostNotification(@"HMDHomeDidUpdateNFCReaderKeyNotification", v32, setProperties2);
    [transactionResult markChanged];
  }

LABEL_17:
  setProperties3 = [modelCopy setProperties];
  if (([setProperties3 containsObject:@"primaryIPv4NetworkSignature"] & 1) == 0)
  {
    setProperties4 = [modelCopy setProperties];
    if (([setProperties4 containsObject:@"primaryIPv6NetworkSignature"] & 1) == 0)
    {
      setProperties5 = [modelCopy setProperties];
      if (([setProperties5 containsObject:@"primaryWiFiSSID"] & 1) == 0)
      {
        setProperties6 = [modelCopy setProperties];
        v81 = [setProperties6 containsObject:@"primaryWiFiRequiresPassword"];

        if ((v81 & 1) == 0)
        {
          goto LABEL_28;
        }

        goto LABEL_23;
      }
    }
  }

LABEL_23:
  v40 = objc_alloc(MEMORY[0x277CD1AC8]);
  primaryWiFiSSID = [modelCopy primaryWiFiSSID];
  primaryWiFiRequiresPassword = [modelCopy primaryWiFiRequiresPassword];
  v43 = [v40 initWithSSID:primaryWiFiSSID requiresPassword:{objc_msgSend(primaryWiFiRequiresPassword, "BOOLValue")}];

  v44 = objc_alloc(MEMORY[0x277CD1AA0]);
  primaryIPv4NetworkSignature = [modelCopy primaryIPv4NetworkSignature];
  primaryIPv6NetworkSignature = [modelCopy primaryIPv6NetworkSignature];
  v47 = [v44 initWithIpv4Addresses:0 ipv6Addresses:0 ipv4NetworkSignature:0 ipv6NetworkSignature:0 binaryIPv4NetworkSignature:primaryIPv4NetworkSignature binaryIPv6NetworkSignature:primaryIPv6NetworkSignature routerIPV4:0 routerIPV6:0 wiFiInfo:v43];

  primaryResidentNetworkInfo = [(HMDHome *)selfCopy primaryResidentNetworkInfo];
  LOBYTE(primaryIPv4NetworkSignature) = [primaryResidentNetworkInfo isEqual:v47];

  if ((primaryIPv4NetworkSignature & 1) == 0)
  {
    v49 = objc_autoreleasePoolPush();
    v50 = selfCopy;
    v51 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
    {
      v52 = HMFGetLogIdentifier();
      *buf = 138543618;
      v315 = v52;
      v316 = 2112;
      *v317 = v47;
      _os_log_impl(&dword_229538000, v51, OS_LOG_TYPE_INFO, "%{public}@Updating primary resident network info %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v49);
    [(HMDHome *)v50 setPrimaryResidentNetworkInfo:v47];
    [transactionResult markChanged];
  }

LABEL_28:
  residentSelectionVersion = [modelCopy residentSelectionVersion];
  setProperties7 = [modelCopy setProperties];
  v55 = [setProperties7 containsObject:@"residentSelectionVersion"];

  v56 = v302;
  if (v55)
  {
    residentSelectionVersion2 = [(HMDHome *)selfCopy residentSelectionVersion];

    if (residentSelectionVersion2 != residentSelectionVersion)
    {
      v58 = objc_autoreleasePoolPush();
      v59 = selfCopy;
      v60 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v60, OS_LOG_TYPE_INFO))
      {
        v61 = HMFGetLogIdentifier();
        residentSelectionVersion3 = [(HMDHome *)v59 residentSelectionVersion];
        *buf = 138543874;
        v315 = v61;
        v316 = 2114;
        *v317 = residentSelectionVersion3;
        *&v317[8] = 2114;
        v318 = residentSelectionVersion;
        _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_INFO, "%{public}@Updating resident selection version from %{public}@ to %{public}@", buf, 0x20u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v58);
      [(HMDHome *)v59 setResidentSelectionVersion:residentSelectionVersion];
      [v56 markChanged];
    }
  }

  currentUser = [(HMDHome *)selfCopy currentUser];
  setProperties8 = [modelCopy setProperties];
  v64 = [setProperties8 containsObject:@"presenceAuthorizationStatus"];

  v296 = residentSelectionVersion;
  if (v64)
  {
    v65 = MEMORY[0x277CD1F00];
    presenceAuthorizationStatus = [modelCopy presenceAuthorizationStatus];
    v67 = [v65 authWithNumber:presenceAuthorizationStatus];

    if (isPresenceAuthorizationValid())
    {
      presenceAuthStatus = [(HMDHome *)selfCopy presenceAuthStatus];
      v69 = HMFEqualObjects();

      if (v69)
      {
        v70 = objc_autoreleasePoolPush();
        v71 = selfCopy;
        v72 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v72, OS_LOG_TYPE_INFO))
        {
          v73 = HMFGetLogIdentifier();
          presenceAuthStatus2 = [(HMDHome *)v71 presenceAuthStatus];
          *buf = 138543618;
          v315 = v73;
          v316 = 2112;
          *v317 = presenceAuthStatus2;
          _os_log_impl(&dword_229538000, v72, OS_LOG_TYPE_INFO, "%{public}@Presence auth is not changing from %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v70);
      }

      else
      {
        [(HMDHome *)selfCopy setPresenceAuthStatus:v67];
        [currentUser setPresenceAuthStatus:v67];
        [v302 markChanged];
      }

      v295 = v69 ^ 1;
      v56 = v302;
      if (![(HMDHome *)selfCopy isOwnerUser])
      {
        [v302 markSaveToSharedUserAccount];
      }
    }

    else
    {
      v75 = objc_autoreleasePoolPush();
      v76 = selfCopy;
      v77 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v77, OS_LOG_TYPE_INFO))
      {
        v78 = HMFGetLogIdentifier();
        presenceAuthorizationStatus2 = [modelCopy presenceAuthorizationStatus];
        *buf = 138543618;
        v315 = v78;
        v316 = 2112;
        *v317 = presenceAuthorizationStatus2;
        _os_log_impl(&dword_229538000, v77, OS_LOG_TYPE_INFO, "%{public}@Ignoring the value for presence auth in home model: %@", buf, 0x16u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v75);
      v295 = 0;
    }
  }

  else
  {
    v295 = 0;
  }

  setProperties9 = [modelCopy setProperties];
  v83 = [setProperties9 containsObject:@"presenceComputeStatus"];

  if (v83)
  {
    v84 = MEMORY[0x277CD1F08];
    presenceComputeStatus = [modelCopy presenceComputeStatus];
    v86 = [v84 computeWithNumber:presenceComputeStatus];

    if (v86)
    {
      presenceComputeStatus2 = [(HMDHome *)selfCopy presenceComputeStatus];
      v88 = HMFEqualObjects();

      if ((v88 & 1) == 0)
      {
        [(HMDHome *)selfCopy setPresenceComputeStatus:v86];
        if (![(HMDHome *)selfCopy isOwnerUser])
        {
          [v56 markSaveToSharedUserAccount];
        }

        [v56 markChanged];
      }
    }
  }

  setProperties10 = [modelCopy setProperties];
  v90 = [setProperties10 containsObject:@"homeLocationData"];

  v300 = messageCopy;
  if (v90)
  {
    homeLocationHandler = [(HMDHome *)selfCopy homeLocationHandler];
    v92 = [homeLocationHandler _handleHomeLocationData:modelCopy message:messageCopy];

    if (v92)
    {
      v93 = v92;
    }

    else
    {
      v94 = [MEMORY[0x277CBEB58] set];
      v308 = 0u;
      v309 = 0u;
      v310 = 0u;
      v311 = 0u;
      dataSource = [(HMDHome *)selfCopy dataSource];
      xpcMessageTransport = [dataSource xpcMessageTransport];
      connections = [xpcMessageTransport connections];

      v98 = [connections countByEnumeratingWithState:&v308 objects:v313 count:16];
      if (v98)
      {
        v99 = v98;
        v100 = *v309;
        do
        {
          for (i = 0; i != v99; ++i)
          {
            if (*v309 != v100)
            {
              objc_enumerationMutation(connections);
            }

            processInfo = [*(*(&v308 + 1) + 8 * i) processInfo];
            locationAuthorization = [processInfo locationAuthorization];

            if (locationAuthorization)
            {
              [v94 addObject:locationAuthorization];
            }
          }

          v99 = [connections countByEnumeratingWithState:&v308 objects:v313 count:16];
        }

        while (v99);
      }

      v306 = 0u;
      v307 = 0u;
      v304 = 0u;
      v305 = 0u;
      v104 = v94;
      v105 = [v104 countByEnumeratingWithState:&v304 objects:v312 count:16];
      if (v105)
      {
        v106 = v105;
        v107 = *v305;
        do
        {
          for (j = 0; j != v106; ++j)
          {
            if (*v305 != v107)
            {
              objc_enumerationMutation(v104);
            }

            v109 = *(*(&v304 + 1) + 8 * j);
            if ([v109 isAuthorized])
            {
              [v109 mark];
            }
          }

          v106 = [v104 countByEnumeratingWithState:&v304 objects:v312 count:16];
        }

        while (v106);
      }

      v93 = 0;
      messageCopy = v300;
    }

    v56 = v302;
  }

  else
  {
    v93 = 0;
  }

  naturalLightingContext = [modelCopy naturalLightingContext];
  setProperties11 = [modelCopy setProperties];
  v301 = naturalLightingContext;
  if ([setProperties11 containsObject:@"encodedNaturalLightingContext"])
  {
    naturalLightingContext2 = [(HMDHome *)selfCopy naturalLightingContext];
    v113 = [naturalLightingContext2 isEqual:naturalLightingContext];

    if ((v113 & 1) == 0)
    {
      v114 = objc_autoreleasePoolPush();
      v115 = selfCopy;
      v116 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v116, OS_LOG_TYPE_INFO))
      {
        v117 = HMFGetLogIdentifier();
        naturalLightingContext3 = [(HMDHome *)v115 naturalLightingContext];
        *buf = 138543874;
        v315 = v117;
        v316 = 2112;
        *v317 = naturalLightingContext3;
        *&v317[8] = 2112;
        v318 = v301;
        _os_log_impl(&dword_229538000, v116, OS_LOG_TYPE_INFO, "%{public}@Updating natural lighting context from %@ -> %@", buf, 0x20u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v114);
      [(HMDHome *)v115 setNaturalLightingContext:v301];
      [v56 markChanged];
    }
  }

  else
  {
  }

  setProperties12 = [modelCopy setProperties];
  if (![setProperties12 containsObject:@"name"])
  {
    goto LABEL_91;
  }

  name = [modelCopy name];
  name2 = [(HMDHome *)selfCopy name];
  v122 = [name isEqualToString:name2];

  if ((v122 & 1) == 0)
  {
    v123 = [(HMDHome *)selfCopy _handleRenameHomeModel:modelCopy message:messageCopy];
    setProperties12 = v123;
    if (v123)
    {
      v124 = v123;

      v93 = v124;
    }

    [v56 markSaveToAssistant];
    [v56 markChanged];
LABEL_91:
  }

  creationDate = [modelCopy creationDate];
  if (creationDate)
  {
    v126 = creationDate;
    creationDate2 = [modelCopy creationDate];
    creationDate3 = [(HMDHome *)selfCopy creationDate];
    v129 = [creationDate2 isEqualToDate:creationDate3];

    if ((v129 & 1) == 0)
    {
      creationDate4 = [modelCopy creationDate];
      [(HMDHome *)selfCopy setCreationDate:creationDate4];

      [v56 markChanged];
    }
  }

  firstHAPAccessoryAddedDate = [modelCopy firstHAPAccessoryAddedDate];
  if (firstHAPAccessoryAddedDate)
  {
    v132 = firstHAPAccessoryAddedDate;
    firstHAPAccessoryAddedDate2 = [modelCopy firstHAPAccessoryAddedDate];
    firstHAPAccessoryAddedDate3 = [(HMDHome *)selfCopy firstHAPAccessoryAddedDate];
    v135 = [firstHAPAccessoryAddedDate2 isEqualToDate:firstHAPAccessoryAddedDate3];

    if ((v135 & 1) == 0)
    {
      firstHAPAccessoryAddedDate4 = [modelCopy firstHAPAccessoryAddedDate];
      [(HMDHome *)selfCopy setFirstHAPAccessoryAddedDate:firstHAPAccessoryAddedDate4];

      [v56 markChanged];
    }
  }

  setProperties13 = [modelCopy setProperties];
  if ([setProperties13 containsObject:@"multiUserEnabled"])
  {
    multiUserEnabled = [modelCopy multiUserEnabled];
    bOOLValue = [multiUserEnabled BOOLValue];
    isMultiUserEnabled = [(HMDHome *)selfCopy isMultiUserEnabled];

    if (bOOLValue != isMultiUserEnabled)
    {
      v141 = objc_autoreleasePoolPush();
      v142 = selfCopy;
      v143 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v143, OS_LOG_TYPE_INFO))
      {
        v144 = HMFGetLogIdentifier();
        multiUserEnabled2 = [modelCopy multiUserEnabled];
        v146 = @"YES";
        *buf = 138543874;
        v315 = v144;
        v316 = 2112;
        if (!multiUserEnabled2)
        {
          v146 = @"NO";
        }

        *v317 = v146;
        *&v317[8] = 2112;
        v318 = v142;
        _os_log_impl(&dword_229538000, v143, OS_LOG_TYPE_INFO, "%{public}@Merging multi-user enabled value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v141);
      [(HMDHome *)v142 _handleMultiUserEnabledChange:modelCopy message:messageCopy];
      [v56 markChanged];
    }
  }

  else
  {
  }

  if ([modelCopy propertyWasSet:@"soundCheckEnabled"])
  {
    soundCheckEnabled = [modelCopy soundCheckEnabled];
    bOOLValue2 = [soundCheckEnabled BOOLValue];
    soundCheckEnabled2 = [(HMDHome *)selfCopy soundCheckEnabled];

    if (bOOLValue2 != soundCheckEnabled2)
    {
      [(HMDHome *)selfCopy _handleSoundCheckChange:modelCopy message:messageCopy];
      [v56 markChanged];
    }
  }

  if ([modelCopy propertyWasSet:@"analysisOptions"])
  {
    analysisOptions = [modelCopy analysisOptions];
    unsignedIntegerValue = [analysisOptions unsignedIntegerValue];
    audioAnalysisClassifierOptions = [(HMDHome *)selfCopy audioAnalysisClassifierOptions];

    if (unsignedIntegerValue != audioAnalysisClassifierOptions)
    {
      [(HMDHome *)selfCopy _handleAudioAnalysisClassifierOptionsChange:modelCopy message:messageCopy];
      [v56 markChanged];
    }
  }

  if ([modelCopy propertyWasSet:@"didOnboardAnalysis"])
  {
    didOnboardAnalysis = [modelCopy didOnboardAnalysis];
    bOOLValue3 = [didOnboardAnalysis BOOLValue];
    didOnboardAudioAnalysis = [(HMDHome *)selfCopy didOnboardAudioAnalysis];

    if (bOOLValue3 != didOnboardAudioAnalysis)
    {
      [(HMDHome *)selfCopy _handleAudioAnalysisOnboardingStatusChange:modelCopy message:messageCopy];
      [v56 markChanged];
    }
  }

  if ([modelCopy propertyWasSet:@"siriPhraseOptions"])
  {
    siriPhraseOptions = [modelCopy siriPhraseOptions];
    unsignedIntegerValue2 = [siriPhraseOptions unsignedIntegerValue];
    siriPhraseOptions2 = [(HMDHome *)selfCopy siriPhraseOptions];

    if (unsignedIntegerValue2 != siriPhraseOptions2)
    {
      [(HMDHome *)selfCopy _handleSiriPhraseOptionsStatusChange:modelCopy message:messageCopy];
      [v56 markChanged];
    }
  }

  if ([modelCopy propertyWasSet:@"locationServicesEnabled"])
  {
    locationServicesEnabled = [modelCopy locationServicesEnabled];
    bOOLValue4 = [locationServicesEnabled BOOLValue];
    locationServicesEnabled2 = [(HMDHome *)selfCopy locationServicesEnabled];

    if (bOOLValue4 != locationServicesEnabled2)
    {
      [(HMDHome *)selfCopy _handleLocationServicesEnabledChange:modelCopy message:messageCopy];
      [v56 markChanged];
    }
  }

  if ([modelCopy propertyWasSet:@"didOnboardLocationServices"])
  {
    didOnboardLocationServices = [modelCopy didOnboardLocationServices];
    bOOLValue5 = [didOnboardLocationServices BOOLValue];
    didOnboardLocationServices2 = [(HMDHome *)selfCopy didOnboardLocationServices];

    if (bOOLValue5 != didOnboardLocationServices2)
    {
      [(HMDHome *)selfCopy _handleDidOnboardLocationServicesChange:modelCopy message:messageCopy];
      [v56 markChanged];
    }
  }

  setProperties14 = [modelCopy setProperties];
  if ([setProperties14 containsObject:@"hasAnyUserAcknowledgedCameraRecordingOnboarding"])
  {
    hasAnyUserAcknowledgedCameraRecordingOnboarding = [modelCopy hasAnyUserAcknowledgedCameraRecordingOnboarding];
    bOOLValue6 = [hasAnyUserAcknowledgedCameraRecordingOnboarding BOOLValue];
    hasAnyUserAcknowledgedCameraRecordingOnboarding2 = [(HMDHome *)selfCopy hasAnyUserAcknowledgedCameraRecordingOnboarding];

    if (bOOLValue6 != hasAnyUserAcknowledgedCameraRecordingOnboarding2)
    {
      v169 = objc_autoreleasePoolPush();
      v170 = selfCopy;
      v171 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v171, OS_LOG_TYPE_INFO))
      {
        v172 = HMFGetLogIdentifier();
        hasAnyUserAcknowledgedCameraRecordingOnboarding3 = [modelCopy hasAnyUserAcknowledgedCameraRecordingOnboarding];
        v174 = @"YES";
        *buf = 138543874;
        v315 = v172;
        v316 = 2112;
        if (!hasAnyUserAcknowledgedCameraRecordingOnboarding3)
        {
          v174 = @"NO";
        }

        *v317 = v174;
        *&v317[8] = 2112;
        v318 = v170;
        _os_log_impl(&dword_229538000, v171, OS_LOG_TYPE_INFO, "%{public}@Merging home's has any user acknowledged camera recording onboarding value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v169);
      [(HMDHome *)v170 _handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:modelCopy message:messageCopy];
      [v56 markChanged];
    }
  }

  else
  {
  }

  setProperties15 = [modelCopy setProperties];
  if ([setProperties15 containsObject:@"hasOnboardedForAccessCode"])
  {
    hasOnboardedForAccessCode = [modelCopy hasOnboardedForAccessCode];
    bOOLValue7 = [hasOnboardedForAccessCode BOOLValue];
    hasOnboardedForAccessCode2 = [(HMDHome *)selfCopy hasOnboardedForAccessCode];

    if (bOOLValue7 != hasOnboardedForAccessCode2)
    {
      v179 = objc_autoreleasePoolPush();
      v180 = selfCopy;
      v181 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v181, OS_LOG_TYPE_INFO))
      {
        v182 = HMFGetLogIdentifier();
        hasOnboardedForAccessCode3 = [modelCopy hasOnboardedForAccessCode];
        [hasOnboardedForAccessCode3 BOOLValue];
        v184 = HMFBooleanToString();
        *buf = 138543874;
        v315 = v182;
        v316 = 2112;
        *v317 = v184;
        *&v317[8] = 2112;
        v318 = v180;
        _os_log_impl(&dword_229538000, v181, OS_LOG_TYPE_INFO, "%{public}@Merging home's has onboarded for access code value %@ into home: %@", buf, 0x20u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v179);
      [(HMDHome *)v180 _handleSetHasOnboardedForAccessCodeChange:modelCopy message:messageCopy];
      [v56 markChanged];
    }
  }

  else
  {
  }

  setProperties16 = [modelCopy setProperties];
  if ([setProperties16 containsObject:@"hasOnboardedForWalletKey"])
  {
    hasOnboardedForWalletKey = [modelCopy hasOnboardedForWalletKey];
    bOOLValue8 = [hasOnboardedForWalletKey BOOLValue];
    hasOnboardedForWalletKey2 = [(HMDHome *)selfCopy hasOnboardedForWalletKey];

    if (bOOLValue8 != hasOnboardedForWalletKey2)
    {
      v189 = objc_autoreleasePoolPush();
      v190 = selfCopy;
      v191 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v191, OS_LOG_TYPE_INFO))
      {
        v192 = HMFGetLogIdentifier();
        hasOnboardedForWalletKey3 = [modelCopy hasOnboardedForWalletKey];
        [hasOnboardedForWalletKey3 BOOLValue];
        v194 = HMFBooleanToString();
        *buf = 138543874;
        v315 = v192;
        v316 = 2112;
        *v317 = v194;
        *&v317[8] = 2112;
        v318 = v190;
        _os_log_impl(&dword_229538000, v191, OS_LOG_TYPE_INFO, "%{public}@Merging home's has onboarded for wallet key value %@ into home: %@", buf, 0x20u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v189);
      [(HMDHome *)v190 _handleSetHasOnboardedForWalletKeyChange:modelCopy message:messageCopy];
      [v56 markChanged];
    }
  }

  else
  {
  }

  setProperties17 = [modelCopy setProperties];
  v196 = [setProperties17 containsObject:@"networkProtectionMode"];

  if (v196)
  {
    [(HMDHome *)selfCopy _handleUpdateNetworkProtectionWithHomeModel:modelCopy message:messageCopy];
  }

  if (![(HMDHome *)selfCopy isOwnerUser])
  {
    v217 = [v56 source] != 2 && objc_msgSend(v56, "source") != 3;
    setProperties18 = [modelCopy setProperties];
    v280 = [setProperties18 containsObject:@"sharedHomeSourceVersion"];

    if (v280)
    {
      if (v217)
      {
        [(HMDHome *)selfCopy _handleReceivedNonCloudSourcedSharedHomeModel];
        v281 = objc_autoreleasePoolPush();
        v282 = selfCopy;
        v283 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v283, OS_LOG_TYPE_INFO))
        {
          v284 = HMFGetLogIdentifier();
          sharedHomeSourceVersion = [(HMDHome *)v282 sharedHomeSourceVersion];
          sharedHomeSourceVersion2 = [modelCopy sharedHomeSourceVersion];
          *buf = 138543874;
          v315 = v284;
          v316 = 2112;
          *v317 = sharedHomeSourceVersion;
          *&v317[8] = 2112;
          v318 = sharedHomeSourceVersion2;
          _os_log_impl(&dword_229538000, v283, OS_LOG_TYPE_INFO, "%{public}@Updating shared home source version from %@ to %@", buf, 0x20u);

          v56 = v302;
        }

        objc_autoreleasePoolPop(v281);
        sharedHomeSourceVersion3 = [(HMDHome *)v282 sharedHomeSourceVersion];
        sharedHomeSourceVersion4 = [modelCopy sharedHomeSourceVersion];
        v289 = HMFEqualObjects();

        if ((v289 & 1) == 0)
        {
          sharedHomeSourceVersion5 = [modelCopy sharedHomeSourceVersion];
          [(HMDHome *)v282 setSharedHomeSourceVersion:sharedHomeSourceVersion5];

          [v56 markChanged];
        }
      }
    }
  }

  v197 = v300;
  if ([modelCopy propertyWasSet:@"threadOperationalDataset"])
  {
    threadOperationalDataset = [modelCopy threadOperationalDataset];

    if (threadOperationalDataset)
    {
      [(HMDHome *)selfCopy updateThreadOperationalDatasetWithHomeModel:modelCopy message:v300];
    }
  }

  if ([modelCopy propertyWasSet:@"matCredGRK"])
  {
    acwgGroupResolvingKey = [(HMDHome *)selfCopy acwgGroupResolvingKey];
    matCredGRK = [modelCopy matCredGRK];
    v201 = HMFEqualObjects();

    if ((v201 & 1) == 0)
    {
      v202 = objc_autoreleasePoolPush();
      v203 = selfCopy;
      v204 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v204, OS_LOG_TYPE_INFO))
      {
        v205 = HMFGetLogIdentifier();
        matCredGRK2 = [modelCopy matCredGRK];
        *buf = 138543618;
        v315 = v205;
        v316 = 2112;
        *v317 = matCredGRK2;
        _os_log_impl(&dword_229538000, v204, OS_LOG_TYPE_INFO, "%{public}@Updating acwgGroupResolvingKey to: %@", buf, 0x16u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v202);
      matCredGRK3 = [modelCopy matCredGRK];
      [(HMDHome *)v203 setAcwgGroupResolvingKey:matCredGRK3];

      [v56 markChanged];
    }
  }

  [(HMDHome *)selfCopy handleUpdatedCHIPPropertiesOnHomeModel:modelCopy actions:v56];
  v297 = v93;
  if (![modelCopy propertyWasSet:@"didOnboardEventLog"])
  {
    goto LABEL_164;
  }

  didOnboardEventLog = [modelCopy didOnboardEventLog];
  bOOLValue9 = [didOnboardEventLog BOOLValue];

  if (bOOLValue9 == [(HMDHome *)selfCopy didOnboardEventLog])
  {
    if ((bOOLValue9 & 1) == 0)
    {
      [(HMDHome *)selfCopy _maybeFixHindsightOnboardingOnCurrentDevice];
    }

LABEL_164:
    v216 = 0;
    goto LABEL_165;
  }

  [(HMDHome *)selfCopy setDidOnboardEventLog:bOOLValue9];
  v210 = objc_autoreleasePoolPush();
  v211 = selfCopy;
  v212 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v212, OS_LOG_TYPE_DEFAULT))
  {
    v213 = HMFGetLogIdentifier();
    objc_opt_class();
    objc_opt_self();
    v214 = @"[Hindsight]";
    v215 = HMFBooleanToString();
    *buf = 138543874;
    v315 = v213;
    v316 = 2114;
    *v317 = @"[Hindsight]";
    *&v317[8] = 2114;
    v318 = v215;
    _os_log_impl(&dword_229538000, v212, OS_LOG_TYPE_DEFAULT, "%{public}@%{public}@ Activity history did onboard is now %{public}@", buf, 0x20u);

    v197 = v300;
    v56 = v302;
  }

  objc_autoreleasePoolPop(v210);
  [v56 markChanged];
  [(HMDHome *)v211 _didOnboardHindsightChanged];
  v216 = 1;
LABEL_165:
  if ([modelCopy propertyWasSet:@"eventLogHomeSettingEnabled"])
  {
    eventLogHomeSettingEnabled = [modelCopy eventLogHomeSettingEnabled];
    bOOLValue10 = [eventLogHomeSettingEnabled BOOLValue];

    if (bOOLValue10 != [(HMDHome *)selfCopy isEventLogHomeSettingEnabled])
    {
      [(HMDHome *)selfCopy setEventLogHomeSettingEnabled:bOOLValue10];
      v220 = objc_autoreleasePoolPush();
      v221 = selfCopy;
      v222 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v222, OS_LOG_TYPE_DEFAULT))
      {
        v223 = HMFGetLogIdentifier();
        objc_opt_class();
        objc_opt_self();
        v224 = @"[Hindsight]";
        v225 = HMFEnabledStatusToString();
        *buf = 138543874;
        v315 = v223;
        v316 = 2114;
        *v317 = @"[Hindsight]";
        *&v317[8] = 2114;
        v318 = v225;
        _os_log_impl(&dword_229538000, v222, OS_LOG_TYPE_DEFAULT, "%{public}@%{public}@ Activity history is now %{public}@", buf, 0x20u);

        v197 = v300;
        v56 = v302;
      }

      objc_autoreleasePoolPop(v220);
      [v56 markChanged];
      v216 = 1;
    }
  }

  if ([modelCopy propertyWasSet:@"eventLogDuration"])
  {
    eventLogDuration = [modelCopy eventLogDuration];
    unsignedIntegerValue3 = [eventLogDuration unsignedIntegerValue];

    if ([(HMDHome *)selfCopy eventLogDuration]!= unsignedIntegerValue3)
    {
      [(HMDHome *)selfCopy setEventLogDuration:unsignedIntegerValue3];
      v228 = objc_autoreleasePoolPush();
      v229 = selfCopy;
      v230 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v230, OS_LOG_TYPE_DEFAULT))
      {
        v231 = HMFGetLogIdentifier();
        objc_opt_class();
        objc_opt_self();
        v232 = @"[Hindsight]";
        *buf = 138543874;
        v315 = v231;
        v316 = 2114;
        *v317 = @"[Hindsight]";
        *&v317[8] = 2048;
        v318 = unsignedIntegerValue3;
        _os_log_impl(&dword_229538000, v230, OS_LOG_TYPE_DEFAULT, "%{public}@%{public}@ Activity history duration is now %lu days", buf, 0x20u);

        v197 = v300;
      }

      objc_autoreleasePoolPop(v228);
      [v56 markChanged];
    }
  }

  if (v216)
  {
    [(HMDHome *)selfCopy _synchronizeHindsightCloudShareManager];
  }

  v233 = v297;
  if ([modelCopy propertyWasSet:@"timeZone"])
  {
    timeZone = [modelCopy timeZone];
    timeZone2 = [(HMDHome *)selfCopy timeZone];
    v236 = HMFEqualObjects();

    if ((v236 & 1) == 0)
    {
      v237 = objc_autoreleasePoolPush();
      v238 = selfCopy;
      v239 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v239, OS_LOG_TYPE_INFO))
      {
        v240 = HMFGetLogIdentifier();
        timeZone3 = [(HMDHome *)v238 timeZone];
        timeZone4 = [modelCopy timeZone];
        *buf = 138543874;
        v315 = v240;
        v316 = 2112;
        *v317 = timeZone3;
        *&v317[8] = 2112;
        v318 = timeZone4;
        _os_log_impl(&dword_229538000, v239, OS_LOG_TYPE_INFO, "%{public}@Home timeZone was updated to: %@ from : %@", buf, 0x20u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v237);
      timeZone5 = [modelCopy timeZone];
      [(HMDHome *)v238 setTimeZone:timeZone5];

      timeZone6 = [(HMDHome *)v238 timeZone];

      if (!timeZone6)
      {
        localTimeZone = [MEMORY[0x277CBEBB0] localTimeZone];
        [(HMDHome *)v238 setTimeZone:localTimeZone];
      }

      [v56 markChanged];
    }
  }

  if ([modelCopy propertyWasSet:@"numberOfCameras"])
  {
    numberOfCameras = [modelCopy numberOfCameras];
    numberOfCameras2 = [(HMDHome *)selfCopy numberOfCameras];
    v248 = HMFEqualObjects();

    if ((v248 & 1) == 0)
    {
      v249 = objc_autoreleasePoolPush();
      v250 = selfCopy;
      v251 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v251, OS_LOG_TYPE_INFO))
      {
        v252 = HMFGetLogIdentifier();
        numberOfCameras3 = [(HMDHome *)v250 numberOfCameras];
        unsignedIntValue = [numberOfCameras3 unsignedIntValue];
        numberOfCameras4 = [modelCopy numberOfCameras];
        unsignedIntValue2 = [numberOfCameras4 unsignedIntValue];
        *buf = 138543874;
        v315 = v252;
        v316 = 1024;
        *v317 = unsignedIntValue;
        v56 = v302;
        *&v317[4] = 1024;
        *&v317[6] = unsignedIntValue2;
        _os_log_impl(&dword_229538000, v251, OS_LOG_TYPE_INFO, "%{public}@Home numberOfCameras changed from %u to %u", buf, 0x18u);

        v233 = v297;
      }

      objc_autoreleasePoolPop(v249);
      numberOfCameras5 = [modelCopy numberOfCameras];
      [(HMDHome *)v250 setNumberOfCameras:numberOfCameras5];

      [v56 markChanged];
    }
  }

  setProperties19 = [modelCopy setProperties];
  v259 = [setProperties19 containsObject:@"isAllowedToEnableAdaptiveTemperatureAutomations"];

  if (v259)
  {
    isAllowedToEnableAdaptiveTemperatureAutomations = [modelCopy isAllowedToEnableAdaptiveTemperatureAutomations];
    bOOLValue11 = [isAllowedToEnableAdaptiveTemperatureAutomations BOOLValue];
    isAllowedToEnableAdaptiveTemperatureAutomations2 = [(HMDHome *)selfCopy isAllowedToEnableAdaptiveTemperatureAutomations];

    if (bOOLValue11 != isAllowedToEnableAdaptiveTemperatureAutomations2)
    {
      v263 = objc_autoreleasePoolPush();
      v264 = selfCopy;
      v265 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v265, OS_LOG_TYPE_INFO))
      {
        v266 = HMFGetLogIdentifier();
        isAllowedToEnableAdaptiveTemperatureAutomations3 = [(HMDHome *)v264 isAllowedToEnableAdaptiveTemperatureAutomations];
        isAllowedToEnableAdaptiveTemperatureAutomations4 = [modelCopy isAllowedToEnableAdaptiveTemperatureAutomations];
        bOOLValue12 = [isAllowedToEnableAdaptiveTemperatureAutomations4 BOOLValue];
        *buf = 138543874;
        v315 = v266;
        v316 = 1024;
        *v317 = isAllowedToEnableAdaptiveTemperatureAutomations3;
        *&v317[4] = 1024;
        *&v317[6] = bOOLValue12;
        _os_log_impl(&dword_229538000, v265, OS_LOG_TYPE_INFO, "%{public}@allowedToEnableAdaptiveTemperatureAutomations changed from %{BOOL}d to %{BOOL}d", buf, 0x18u);

        v233 = v297;
      }

      objc_autoreleasePoolPop(v263);
      isAllowedToEnableAdaptiveTemperatureAutomations5 = [modelCopy isAllowedToEnableAdaptiveTemperatureAutomations];
      -[HMDHome setAllowedToEnableAdaptiveTemperatureAutomations:](v264, "setAllowedToEnableAdaptiveTemperatureAutomations:", [isAllowedToEnableAdaptiveTemperatureAutomations5 BOOLValue]);

      [v56 markChanged];
      if ([(HMDHome *)v264 isAllowedToEnableAdaptiveTemperatureAutomations])
      {
        workQueue = [(HMDHome *)v264 workQueue];
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __39__HMDHome_updateHomeWithModel_message___block_invoke;
        block[3] = &unk_27868A728;
        block[4] = v264;
        dispatch_async(workQueue, block);
      }
    }
  }

  responseHandler = [(HMDHome *)v197 responseHandler];

  if (responseHandler)
  {
    responseHandler2 = [(HMDHome *)v197 responseHandler];
    (responseHandler2)[2](responseHandler2, v233, 0);
  }

  v274 = v301;
  if (v295)
  {
    name3 = [(HMDHome *)v197 name];
    v276 = HMFEqualObjects();

    presenceFeeder = [(HMDHome *)selfCopy presenceFeeder];
    v278 = presenceFeeder;
    if (v276)
    {
      [presenceFeeder presenceAuthChanged];
    }

    else
    {
      presenceAuthStatus3 = [(HMDHome *)selfCopy presenceAuthStatus];
      [v278 presenceAuthStatusChangedForUser:currentUser presenceAuthStatus:presenceAuthStatus3];
    }

    v274 = v301;
  }

  v292 = v233;

  v293 = *MEMORY[0x277D85DE8];
  return v233;
}

- (void)_handleUpdateNetworkProtectionWithHomeModel:(id)model message:(id)message
{
  messageCopy = message;
  networkProtectionMode = [model networkProtectionMode];
  unsignedIntegerValue = [networkProtectionMode unsignedIntegerValue];

  if ([(HMDHome *)self protectionMode]!= unsignedIntegerValue)
  {
    [(HMDHome *)self setProtectionMode:unsignedIntegerValue];
    transactionResult = [messageCopy transactionResult];
    [(HMDHome *)self _handleNetworkProtectionModeChangeForTransaction:transactionResult];
    [transactionResult markChanged];
  }
}

- (NSNumber)availableBorderRouters
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_availableBorderRouters;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setAvailableBorderRouters:(id)routers
{
  routersCopy = routers;
  os_unfair_recursive_lock_lock_with_options();
  availableBorderRouters = self->_availableBorderRouters;
  self->_availableBorderRouters = routersCopy;

  os_unfair_recursive_lock_unlock();
}

- (NSNumber)availableBSPsCount
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_availableBSPsCount;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setAvailableBSPsCount:(id)count
{
  countCopy = count;
  os_unfair_recursive_lock_lock_with_options();
  availableBSPsCount = self->_availableBSPsCount;
  self->_availableBSPsCount = countCopy;

  os_unfair_recursive_lock_unlock();
}

- (id)dumpMediaSessionDescriptionWithPrivacyLevel:(unint64_t)level
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = MEMORY[0x277CBEB18];
  mediaSessionStates = [(HMDHome *)self mediaSessionStates];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(mediaSessionStates, "count")}];

  v18 = 0u;
  v19 = 0u;
  v16 = 0u;
  v17 = 0u;
  mediaSessionStates2 = [(HMDHome *)self mediaSessionStates];
  v9 = [mediaSessionStates2 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v17;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v17 != v11)
        {
          objc_enumerationMutation(mediaSessionStates2);
        }

        v13 = [*(*(&v16 + 1) + 8 * i) dumpStateWithPrivacyLevel:level];
        [v7 addObject:v13];
      }

      v10 = [mediaSessionStates2 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v10);
  }

  v14 = *MEMORY[0x277D85DE8];

  return v7;
}

- (id)dumpCharacteristicNotificationRegistry
{
  v3 = MEMORY[0x277CCAB68];
  name = [(HMDHome *)self name];
  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];
  v7 = [v3 stringWithFormat:@"Home %@/%@:", name, uUIDString];

  notificationRegistry = [(HMDHome *)self notificationRegistry];
  shortDescription = [notificationRegistry shortDescription];
  [v7 appendString:shortDescription];

  return v7;
}

- (id)dumpActionSetDescriptionWithPrivacyLevel:(unint64_t)level
{
  v33 = *MEMORY[0x277D85DE8];
  v5 = MEMORY[0x277CBEB18];
  mediaSessionStates = [(HMDHome *)self mediaSessionStates];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(mediaSessionStates, "count")}];

  actionSets = [(HMDHome *)self actionSets];
  v27 = 0u;
  v28 = 0u;
  v29 = 0u;
  v30 = 0u;
  v9 = [actionSets countByEnumeratingWithState:&v27 objects:v32 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v28;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v28 != v11)
        {
          objc_enumerationMutation(actionSets);
        }

        v13 = [*(*(&v27 + 1) + 8 * i) dumpStateWithPrivacyLevel:level];
        [v7 addObject:v13];
      }

      v10 = [actionSets countByEnumeratingWithState:&v27 objects:v32 count:16];
    }

    while (v10);
  }

  triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v15 = [triggerOwnedActionSets countByEnumeratingWithState:&v23 objects:v31 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v24;
    do
    {
      for (j = 0; j != v16; ++j)
      {
        if (*v24 != v17)
        {
          objc_enumerationMutation(triggerOwnedActionSets);
        }

        v19 = [*(*(&v23 + 1) + 8 * j) dumpStateWithPrivacyLevel:level];
        [v7 addObject:v19];
      }

      v16 = [triggerOwnedActionSets countByEnumeratingWithState:&v23 objects:v31 count:16];
    }

    while (v16);
  }

  v20 = [v7 copy];

  v21 = *MEMORY[0x277D85DE8];

  return v20;
}

- (void)doFullImportWithCompletion:(id)completion
{
  completionCopy = completion;
  v6 = +[HMDCoreDataCloudTransform sharedInstance];
  uuid = [(HMDHome *)self uuid];
  [v6 runCompleteMergeTransformForHomeWithModelID:uuid completion:completionCopy];
}

- (void)_handleResponseForElectMessageToResident:(id)resident error:(id)error
{
  v44 = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  errorCopy = error;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if ([(HMDHome *)self remoteAccessIsEnabled])
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v11 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
LABEL_5:

      objc_autoreleasePoolPop(v9);
      goto LABEL_19;
    }

    v12 = HMFGetLogIdentifier();
    userID = [residentCopy userID];
    v38 = 138543618;
    v39 = v12;
    v40 = 2112;
    v41 = userID;
    v14 = "%{public}@Received response for ping message to resident %@. Remote access is already setup, dropping response";
LABEL_4:
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, v14, &v38, 0x16u);

    goto LABEL_5;
  }

  if (errorCopy)
  {
    domain = [errorCopy domain];
    if ([domain isEqualToString:*MEMORY[0x277D18538]])
    {
      if ([errorCopy code] == 16)
      {

LABEL_21:
        v9 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v11 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          goto LABEL_5;
        }

        v12 = HMFGetLogIdentifier();
        userID = [residentCopy userID];
        v38 = 138543618;
        v39 = v12;
        v40 = 2112;
        v41 = userID;
        v14 = "%{public}@Failed to ping resident %@, will try again at next heartbeat";
        goto LABEL_4;
      }

      code = [errorCopy code];

      if (code == 23)
      {
        goto LABEL_21;
      }
    }

    else
    {
    }

    v29 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
    {
      v32 = HMFGetLogIdentifier();
      userID2 = [residentCopy userID];
      v38 = 138543874;
      v39 = v32;
      v40 = 2112;
      v41 = userID2;
      v42 = 2112;
      v43 = errorCopy;
      _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_INFO, "%{public}@Failed to ping resident %@, but error %@ is not specific IDS error, will not re-try at next heartbeat", &v38, 0x20u);
    }

    objc_autoreleasePoolPop(v29);
    heartbeatPingMessagesQueuedWithServer = [(HMDHome *)selfCopy3 heartbeatPingMessagesQueuedWithServer];
    userID3 = [residentCopy userID];
    [heartbeatPingMessagesQueuedWithServer addObject:userID3];
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      userID4 = [residentCopy userID];
      v38 = 138543618;
      v39 = v19;
      v40 = 2112;
      v41 = userID4;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Successfully sent ping message to resident %@, remembering queued message", &v38, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    heartbeatPingMessagesQueuedWithServer2 = [(HMDHome *)selfCopy4 heartbeatPingMessagesQueuedWithServer];
    userID5 = [residentCopy userID];
    [heartbeatPingMessagesQueuedWithServer2 addObject:userID5];

    v23 = objc_autoreleasePoolPush();
    v24 = selfCopy4;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      v38 = 138543362;
      v39 = v26;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled, requesting electing a remote peer", &v38, 0xCu);
    }

    objc_autoreleasePoolPop(v23);
    homeManager = [(HMDHome *)v24 homeManager];
    uuid = [(HMDHome *)v24 uuid];
    [homeManager electRemoteAccessPeerForHome:uuid];
  }

LABEL_19:

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_remoteAccessHealthMonitorTimerDidFire
{
  v39 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if (![(HMDHome *)self remoteAccessIsEnabled])
  {
    _residentUsers = [(HMDHome *)self _residentUsers];
    objc_initWeak(&location, self);
    v31 = 0u;
    v32 = 0u;
    v29 = 0u;
    v30 = 0u;
    obj = _residentUsers;
    v5 = [obj countByEnumeratingWithState:&v29 objects:v38 count:16];
    if (v5)
    {
      v26 = *v30;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v30 != v26)
          {
            objc_enumerationMutation(obj);
          }

          v7 = *(*(&v29 + 1) + 8 * i);
          heartbeatPingMessagesQueuedWithServer = [(HMDHome *)self heartbeatPingMessagesQueuedWithServer];
          userID = [v7 userID];
          v10 = [heartbeatPingMessagesQueuedWithServer containsObject:userID];

          v11 = objc_autoreleasePoolPush();
          selfCopy = self;
          if (v10)
          {
            v13 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
            {
              v14 = HMFGetLogIdentifier();
              userID2 = [v7 userID];
              *buf = 138543618;
              v35 = v14;
              v36 = 2112;
              v37 = userID2;
              _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Remote access health monitor fired, but we already have a ping queued with server to %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v11);
          }

          else
          {
            v16 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
            {
              v17 = HMFGetLogIdentifier();
              userID3 = [v7 userID];
              *buf = 138543618;
              v35 = v17;
              v36 = 2112;
              v37 = userID3;
              _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Remote access health monitor fired, sending ping elect message to %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v11);
            aBlock[0] = MEMORY[0x277D85DD0];
            aBlock[1] = 3221225472;
            aBlock[2] = __49__HMDHome__remoteAccessHealthMonitorTimerDidFire__block_invoke;
            aBlock[3] = &unk_278670840;
            objc_copyWeak(&v28, &location);
            aBlock[4] = v7;
            v19 = _Block_copy(aBlock);
            homeManager = [(HMDHome *)selfCopy homeManager];
            userID4 = [v7 userID];
            userID5 = [v7 userID];
            workQueue2 = [(HMDHome *)selfCopy workQueue];
            [homeManager electDeviceForUser:userID4 destination:userID5 deviceCapabilities:0 responseTimeout:workQueue2 queue:v19 completionHandler:600.0];

            objc_destroyWeak(&v28);
          }
        }

        v5 = [obj countByEnumeratingWithState:&v29 objects:v38 count:16];
      }

      while (v5);
    }

    objc_destroyWeak(&location);
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome__remoteAccessHealthMonitorTimerDidFire__block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v6)
    {
      v4 = [v6 userInfo];
      v5 = [v4 objectForKeyedSubscript:*MEMORY[0x277CCA7E8]];

      [WeakRetained _handleResponseForElectMessageToResident:*(a1 + 32) error:v5];
    }

    else
    {
      [WeakRetained _handleResponseForElectMessageToResident:*(a1 + 32) error:0];
    }
  }
}

- (void)remoteAccessHealthMonitorTimerDidFire
{
  if (isiOSDevice())
  {
    workQueue = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __48__HMDHome_remoteAccessHealthMonitorTimerDidFire__block_invoke;
    block[3] = &unk_27868A728;
    block[4] = self;
    dispatch_async(workQueue, block);
  }
}

- (void)_handleDidReceiveIDSMessageWithNoListenerFromAddress:(id)address
{
  v36 = *MEMORY[0x277D85DE8];
  addressCopy = address;
  v5 = shouldLogPrivateInformation();
  v6 = @"...";
  if (v5)
  {
    v6 = addressCopy;
  }

  v7 = v6;
  if ([(HMDHome *)self remoteAccessIsEnabled])
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v11;
      v34 = 2112;
      v35 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Received IDS message from %@ but home has remote access enabled, ignoring notification", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  else
  {
    v29 = 0u;
    v30 = 0u;
    v27 = 0u;
    v28 = 0u;
    _residentUsers = [(HMDHome *)self _residentUsers];
    v13 = [_residentUsers countByEnumeratingWithState:&v27 objects:v31 count:16];
    if (v13)
    {
      v14 = v13;
      v15 = *v28;
      while (2)
      {
        for (i = 0; i != v14; ++i)
        {
          if (*v28 != v15)
          {
            objc_enumerationMutation(_residentUsers);
          }

          v17 = *(*(&v27 + 1) + 8 * i);
          if ([v17 configurationState] == 2)
          {
            userID = [v17 userID];
            v19 = [userID isEqualToString:addressCopy];

            if (v19)
            {
              v20 = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v22 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
              {
                v23 = HMFGetLogIdentifier();
                *buf = 138543618;
                v33 = v23;
                v34 = 2112;
                v35 = v7;
                _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled but we received a message from resident at %@, requesting electing a remote peer", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v20);
              homeManager = [(HMDHome *)selfCopy2 homeManager];
              uuid = [(HMDHome *)selfCopy2 uuid];
              [homeManager electRemoteAccessPeerForHome:uuid];

              goto LABEL_20;
            }
          }
        }

        v14 = [_residentUsers countByEnumeratingWithState:&v27 objects:v31 count:16];
        if (v14)
        {
          continue;
        }

        break;
      }
    }

LABEL_20:
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)handleDidReceiveIDSMessageWithNoListener:(id)listener
{
  listenerCopy = listener;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __52__HMDHome_handleDidReceiveIDSMessageWithNoListener___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = listenerCopy;
  selfCopy = self;
  v6 = listenerCopy;
  dispatch_async(workQueue, v7);
}

void __52__HMDHome_handleDidReceiveIDSMessageWithNoListener___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) userInfo];

  if (v2)
  {
    v3 = [*(a1 + 32) userInfo];
    v5 = [v3 hmf_stringForKey:@"kIDSMessageSourceIDKey"];

    v4 = v5;
    if (v5)
    {
      [*(a1 + 40) _handleDidReceiveIDSMessageWithNoListenerFromAddress:v5];
      v4 = v5;
    }
  }
}

- (void)handleActiveAccountChanged:(id)changed
{
  userInfo = [changed userInfo];
  v5 = [userInfo objectForKeyedSubscript:@"HMDAccountNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  workQueue = [(HMDHome *)self workQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __38__HMDHome_handleActiveAccountChanged___block_invoke;
  v10[3] = &unk_27868A750;
  v10[4] = self;
  v11 = v7;
  v9 = v7;
  dispatch_async(workQueue, v10);
}

- (void)handleCurrentAccountMergeIdentifierUpdated:(id)updated
{
  updatedCopy = updated;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __54__HMDHome_handleCurrentAccountMergeIdentifierUpdated___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = updatedCopy;
  selfCopy = self;
  v6 = updatedCopy;
  dispatch_async(workQueue, v7);
}

void __54__HMDHome_handleCurrentAccountMergeIdentifierUpdated___block_invoke(uint64_t a1)
{
  v34 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  if ([*(a1 + 40) isOwnerUser])
  {
    v5 = +[HMDAppleAccountManager sharedManager];
    v6 = [v5 account];
    v7 = [v4 isEqualToAccount:v6];

    if (v7)
    {
      v8 = [*(a1 + 40) currentUser];
      if (v8)
      {
        v9 = [v4 senderCorrelationIdentifier];
        if (!v9)
        {
          goto LABEL_16;
        }

        v10 = v9;
        v11 = [v4 senderCorrelationIdentifier];
        v12 = [v8 mergeIdentifier];
        v13 = HMFEqualObjects();

        if (v13)
        {
          goto LABEL_16;
        }

        if (![*(a1 + 40) hasAnyResident] || (objc_msgSend(*(a1 + 40), "isCurrentDevicePrimaryResident") & 1) != 0)
        {
          v14 = [*(a1 + 40) backingStore];
          v15 = [v14 context];

          v27[0] = MEMORY[0x277D85DD0];
          v27[1] = 3221225472;
          v27[2] = __54__HMDHome_handleCurrentAccountMergeIdentifierUpdated___block_invoke_2067;
          v27[3] = &unk_2786891E0;
          v28 = v8;
          v29 = v15;
          v16 = v4;
          v17 = *(a1 + 40);
          v30 = v16;
          v31 = v17;
          v18 = v15;
          [v18 unsafeSynchronousBlock:v27];

LABEL_16:
          goto LABEL_17;
        }

        v19 = objc_autoreleasePoolPush();
        v20 = *(a1 + 40);
        v21 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          v22 = HMFGetLogIdentifier();
          *buf = 138543362;
          v33 = v22;
          v23 = "%{public}@Skip updating owner user with mergeID since this device is not the primary resident";
          v24 = v21;
          v25 = OS_LOG_TYPE_INFO;
          goto LABEL_14;
        }
      }

      else
      {
        v19 = objc_autoreleasePoolPush();
        v20 = *(a1 + 40);
        v21 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
        {
          v22 = HMFGetLogIdentifier();
          *buf = 138543362;
          v33 = v22;
          v23 = "%{public}@Home does not currently have a user account. Not attempting to update mergeID.";
          v24 = v21;
          v25 = OS_LOG_TYPE_ERROR;
LABEL_14:
          _os_log_impl(&dword_229538000, v24, v25, v23, buf, 0xCu);
        }
      }

      objc_autoreleasePoolPop(v19);
      goto LABEL_16;
    }
  }

LABEL_17:

  v26 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome_handleCurrentAccountMergeIdentifierUpdated___block_invoke_2067(id *a1)
{
  v18 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] uuid];
  v3 = [a1[5] managedObjectContext];
  v4 = [_MKFHome findHomeMemberWithUUID:v2 context:v3];

  v5 = [a1[6] senderCorrelationIdentifier];
  [v4 setIdsMergeIdentifier:v5];

  v6 = a1[5];
  v13 = 0;
  LOBYTE(v3) = [v6 save:&v13];
  v7 = v13;
  if ((v3 & 1) == 0)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = a1[7];
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to update mergeID for owner: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleAccountHandlesUpdated:(id)updated
{
  updatedCopy = updated;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __39__HMDHome_handleAccountHandlesUpdated___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = updatedCopy;
  selfCopy = self;
  v6 = updatedCopy;
  dispatch_async(workQueue, v7);
}

void __39__HMDHome_handleAccountHandlesUpdated___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v7 = v3;

  v4 = +[HMDAppleAccountManager sharedManager];
  v5 = [v4 account];
  v6 = [v7 isEqualToAccount:v5];

  if (v6)
  {
    __updateAccountHandleForCurrentUser(*(a1 + 40), v7);
  }
}

- (void)removeUnconfiguredResidentDeviceWithUserID:(id)d
{
  dCopy = d;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __54__HMDHome_removeUnconfiguredResidentDeviceWithUserID___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = dCopy;
  v6 = dCopy;
  dispatch_async(workQueue, v7);
}

void __54__HMDHome_removeUnconfiguredResidentDeviceWithUserID___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) unconfiguredResidentDevices];
  v4 = [v2 hmf_firstObjectWithValue:*(a1 + 40) forKeyPath:@"userID"];

  if (v4)
  {
    [v4 setConfigurationState:2];
    v3 = [*(a1 + 32) unconfiguredResidentDevices];
    [v3 removeObject:v4];
  }
}

- (void)addUnconfiguredResidentDevice:(id)device
{
  deviceCopy = device;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome_addUnconfiguredResidentDevice___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = deviceCopy;
  v6 = deviceCopy;
  dispatch_async(workQueue, v7);
}

void __41__HMDHome_addUnconfiguredResidentDevice___block_invoke(uint64_t a1)
{
  v42 = *MEMORY[0x277D85DE8];
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v2 = [*(a1 + 32) unconfiguredResidentDevices];
  v3 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v32 objects:v41 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v33;
LABEL_3:
    v6 = 0;
    while (1)
    {
      if (*v33 != v5)
      {
        objc_enumerationMutation(v2);
      }

      v7 = [*(*(&v32 + 1) + 8 * v6) device];
      v8 = [v7 isEqual:*(a1 + 40)];

      if (v8)
      {
        break;
      }

      if (v4 == ++v6)
      {
        v4 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v32 objects:v41 count:16];
        if (v4)
        {
          goto LABEL_3;
        }

        goto LABEL_9;
      }
    }

    v21 = objc_autoreleasePoolPush();
    v22 = *(a1 + 32);
    v23 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      goto LABEL_25;
    }

    v24 = HMFGetLogIdentifier();
    v25 = [*(a1 + 40) shortDescription];
    *buf = 138543618;
    v38 = v24;
    v39 = 2112;
    v40 = v25;
    v26 = "%{public}@Not adding resident device, %@, to unconfigured list since it already exists";
  }

  else
  {
LABEL_9:

    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    v2 = [*(a1 + 32) _residentUsers];
    v9 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v28 objects:v36 count:16];
    if (!v9)
    {
LABEL_17:

      v15 = objc_autoreleasePoolPush();
      v16 = *(a1 + 32);
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v19 = [*(a1 + 40) shortDescription];
        *buf = 138543618;
        v38 = v18;
        v39 = 2112;
        v40 = v19;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Adding resident device, %@, to unconfigured list and posting notification", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
      v2 = [[HMDResidentUser alloc] initWithDevice:*(a1 + 40) home:*(a1 + 32) pairingIdentity:0 configurationState:1];
      v20 = [*(a1 + 32) unconfiguredResidentDevices];
      [v20 addObject:v2];

      [(HMDUser *)v2 setHome:*(a1 + 32)];
      [*(a1 + 32) _configureUnconfiguredResident:v2 desiredConfigState:2];
      goto LABEL_26;
    }

    v10 = v9;
    v11 = *v29;
LABEL_11:
    v12 = 0;
    while (1)
    {
      if (*v29 != v11)
      {
        objc_enumerationMutation(v2);
      }

      v13 = [*(*(&v28 + 1) + 8 * v12) device];
      v14 = [v13 isEqual:*(a1 + 40)];

      if (v14)
      {
        break;
      }

      if (v10 == ++v12)
      {
        v10 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v28 objects:v36 count:16];
        if (v10)
        {
          goto LABEL_11;
        }

        goto LABEL_17;
      }
    }

    v21 = objc_autoreleasePoolPush();
    v22 = *(a1 + 32);
    v23 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      goto LABEL_25;
    }

    v24 = HMFGetLogIdentifier();
    v25 = [*(a1 + 40) shortDescription];
    *buf = 138543618;
    v38 = v24;
    v39 = 2112;
    v40 = v25;
    v26 = "%{public}@Not adding resident device, %@, to unconfigured list since it already exists in users";
  }

  _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, v26, buf, 0x16u);

LABEL_25:
  objc_autoreleasePoolPop(v21);
LABEL_26:

  v27 = *MEMORY[0x277D85DE8];
}

- (void)timerDidFire:(id)fire
{
  v17 = *MEMORY[0x277D85DE8];
  fireCopy = fire;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  modifyNotificationsCoalesceTimer = [(HMDHome *)self modifyNotificationsCoalesceTimer];

  if (modifyNotificationsCoalesceTimer == fireCopy)
  {
    [(HMDHome *)self _handleCoalescedModifyNotifications];
  }

  else
  {
    disableNotificationTimer = [(HMDHome *)self disableNotificationTimer];

    if (disableNotificationTimer == fireCopy)
    {
      [(HMDHome *)self _handleDisableNotificationsTimerFired];
    }

    else
    {
      reachabilityNotificationTimer = [(HMDHome *)self reachabilityNotificationTimer];

      if (reachabilityNotificationTimer == fireCopy)
      {
        [(HMDHome *)self _handleRemoteReachabilityNotificationTimerFired];
      }

      else
      {
        pendingResponsesTimer = [(HMDHome *)self pendingResponsesTimer];

        if (pendingResponsesTimer == fireCopy)
        {
          [(HMDHome *)self _handlePendingResponsesTimerFired:0];
        }

        else if (self->_homeLocationTimer == fireCopy)
        {
          v10 = objc_autoreleasePoolPush();
          selfCopy = self;
          v12 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
          {
            v13 = HMFGetLogIdentifier();
            v15 = 138543362;
            v16 = v13;
            _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Evaluating home location", &v15, 0xCu);
          }

          objc_autoreleasePoolPop(v10);
          [(HMDHome *)selfCopy updateHomeLocation];
        }

        else if (self->_accessoryReachabilityUpdatesTimer == fireCopy)
        {
          [(HMDHome *)self _handleAccessoryReachabilityUpdatesTimerFired];
        }
      }
    }
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleAccessoryReachabilityUpdatesTimerFired
{
  v102 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  allObjects = [(NSMutableSet *)self->_reachabilityUpdatedAccessories allObjects];
  [(NSMutableSet *)self->_reachabilityUpdatedAccessories removeAllObjects];
  os_unfair_recursive_lock_unlock();
  selfCopy = self;
  v69 = allObjects;
  v59 = [v69 count];
  v5 = objc_autoreleasePoolPush();
  v72 = selfCopy;
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (v59)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v99 = v8;
      v100 = 2048;
      v101 = v59;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Sending accessory reachability updates - number of entries %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v71 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
    v61 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
    v70 = [MEMORY[0x277CBEB18] arrayWithCapacity:v59];
    v87 = 0u;
    v88 = 0u;
    v85 = 0u;
    v86 = 0u;
    obj = [(HMDHome *)v72 accessories];
    v9 = [obj countByEnumeratingWithState:&v85 objects:buf count:16];
    if (v9)
    {
      v66 = *v86;
      v62 = *MEMORY[0x277CCEC80];
      v60 = *MEMORY[0x277CCF048];
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v86 != v66)
          {
            objc_enumerationMutation(obj);
          }

          v11 = *(*(&v85 + 1) + 8 * i);
          uuid = [v11 uuid];
          uUIDString = [uuid UUIDString];

          if ([v69 containsObject:uUIDString])
          {
            v14 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v11, "isReachableForXPCClients")}];
            messageSendPolicy = [v11 messageSendPolicy];
            v16 = [v71 hmf_mutableDictionaryForKey:messageSendPolicy];
            if (!v16)
            {
              v16 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
              [v71 setObject:v16 forKey:messageSendPolicy];
            }

            v17 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:3];
            [v17 setObject:v14 forKeyedSubscript:@"kAccessoryIsReachableKey"];
            v18 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v11, "reachableTransports")}];
            [v17 setObject:v18 forKeyedSubscript:v62];

            v19 = v11;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v20 = v19;
            }

            else
            {
              v20 = 0;
            }

            v21 = v20;

            if (v21)
            {
              v22 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v21, "suspendedState")}];
              [v17 setObject:v22 forKeyedSubscript:v60];
            }

            v23 = [v17 copy];
            [v16 setObject:v23 forKeyedSubscript:uUIDString];

            if (([messageSendPolicy entitlements] & 4) == 0)
            {
              v24 = [v61 hmf_mutableDictionaryForKey:messageSendPolicy];
              if (!v24)
              {
                v24 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
                [v61 setObject:v24 forKey:messageSendPolicy];
              }

              v96 = @"kAccessoryIsReachableKey";
              v97 = v14;
              v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v97 forKeys:&v96 count:1];
              [v24 setObject:v25 forKeyedSubscript:uUIDString];
            }
          }
        }

        v9 = [obj countByEnumeratingWithState:&v85 objects:buf count:16];
      }

      while (v9);
    }

    v83 = 0u;
    v84 = 0u;
    v81 = 0u;
    v82 = 0u;
    obja = [v71 allKeys];
    v26 = [obja countByEnumeratingWithState:&v81 objects:v95 count:16];
    if (v26)
    {
      v27 = *v82;
      v28 = *MEMORY[0x277CCE9C0];
      v67 = *MEMORY[0x277CCE7A8];
      do
      {
        for (j = 0; j != v26; ++j)
        {
          if (*v82 != v27)
          {
            objc_enumerationMutation(obja);
          }

          v30 = *(*(&v81 + 1) + 8 * j);
          v31 = [v71 hmf_mutableDictionaryForKey:{v30, v59}];
          if ([v31 count])
          {
            v32 = MEMORY[0x277D0F848];
            messageDestination = [(HMDHome *)v72 messageDestination];
            v93 = v67;
            v34 = [v31 copy];
            v94 = v34;
            v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v94 forKeys:&v93 count:1];
            v36 = [v32 messageWithName:v28 destination:messageDestination payload:v35];

            if (([v30 entitlements] & 4) != 0)
            {
              v37 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v30 entitlements], objc_msgSend(v30, "options"), 1);
            }

            else
            {
              v37 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v30 entitlements] | 4, objc_msgSend(v30, "options"), 1);
            }

            v38 = v37;
            [v36 setSendPolicy:v37];

            [v70 addObject:v36];
          }
        }

        v26 = [obja countByEnumeratingWithState:&v81 objects:v95 count:16];
      }

      while (v26);
    }

    v79 = 0u;
    v80 = 0u;
    v77 = 0u;
    v78 = 0u;
    objb = [v61 allKeys];
    v39 = [objb countByEnumeratingWithState:&v77 objects:v92 count:16];
    if (v39)
    {
      v40 = *v78;
      v41 = *MEMORY[0x277CCE9C0];
      v68 = *MEMORY[0x277CCE7A8];
      do
      {
        for (k = 0; k != v39; ++k)
        {
          if (*v78 != v40)
          {
            objc_enumerationMutation(objb);
          }

          v43 = *(*(&v77 + 1) + 8 * k);
          v44 = [v71 hmf_mutableDictionaryForKey:{v43, v59}];
          if ([v44 count])
          {
            v45 = MEMORY[0x277D0F848];
            messageDestination2 = [(HMDHome *)v72 messageDestination];
            v90 = v68;
            v47 = [v44 copy];
            v91 = v47;
            v48 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v91 forKeys:&v90 count:1];
            v49 = [v45 messageWithName:v41 destination:messageDestination2 payload:v48];

            [v49 setRequiresNoSPIEntitlement:1];
            v50 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v43 entitlements], objc_msgSend(v43, "options"), 1);
            [v49 setSendPolicy:v50];
            [v70 addObject:v49];
          }
        }

        v39 = [objb countByEnumeratingWithState:&v77 objects:v92 count:16];
      }

      while (v39);
    }

    v51 = [v70 copy];
  }

  else
  {
    if (v7)
    {
      v52 = HMFGetLogIdentifier();
      *buf = 138543362;
      v99 = v52;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Reachability update timer fired but no entries", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v51 = MEMORY[0x277CBEBF8];
  }

  v73 = 0u;
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  v53 = [v51 countByEnumeratingWithState:&v73 objects:v89 count:16];
  if (v53)
  {
    v54 = *v74;
    do
    {
      for (m = 0; m != v53; ++m)
      {
        if (*v74 != v54)
        {
          objc_enumerationMutation(v51);
        }

        v56 = *(*(&v73 + 1) + 8 * m);
        msgDispatcher = [(HMDHome *)v72 msgDispatcher];
        [msgDispatcher sendMessage:v56];
      }

      v53 = [v51 countByEnumeratingWithState:&v73 objects:v89 count:16];
    }

    while (v53);
  }

  v58 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientsOfReachabilityUpdateForAccessory:(id)accessory
{
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __57__HMDHome_notifyClientsOfReachabilityUpdateForAccessory___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = accessoryCopy;
  selfCopy = self;
  v6 = accessoryCopy;
  dispatch_async(workQueue, v7);
}

void __57__HMDHome_notifyClientsOfReachabilityUpdateForAccessory___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [v2 UUIDString];

  if (v3)
  {
    v4 = *(a1 + 40);
    os_unfair_recursive_lock_lock_with_options();
    if ([*(*(a1 + 40) + 184) containsObject:v3])
    {
      v5 = 0;
    }

    else
    {
      [*(*(a1 + 40) + 184) addObject:v3];
      v5 = [*(*(a1 + 40) + 184) count] == 1;
    }

    os_unfair_recursive_lock_unlock();
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [*(a1 + 32) shortDescription];
      v16 = HMFBooleanToString();
      v18 = 138543874;
      v19 = v14;
      v20 = 2112;
      v21 = v15;
      v22 = 2112;
      v23 = v16;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Queuing up reachability update for accessory %@. Started timer: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    if (v5)
    {
      [*(*(a1 + 40) + 176) resume];
    }
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 32);
      v18 = 138543618;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Attempt to queue reachability update for accessory with no UUID - %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleDisableNotificationsTimerFired
{
  v39 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  notificationRegistrations = [(HMDHome *)self notificationRegistrations];
  v5 = [notificationRegistrations copy];

  notificationDeregistrations = [(HMDHome *)self notificationDeregistrations];
  v7 = [notificationDeregistrations copy];

  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    shortDescription = [v5 shortDescription];
    shortDescription2 = [v7 shortDescription];
    v33 = 138543874;
    v34 = v11;
    v35 = 2112;
    v36 = shortDescription;
    v37 = 2112;
    v38 = shortDescription2;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Notification disable timer fired - registrations %@  deregistrations %@", &v33, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [(HMDHome *)selfCopy setDisableNotificationTimer:0];
  notificationRegistrationsForAppleMediaAccessories = [(HMDHome *)selfCopy notificationRegistrationsForAppleMediaAccessories];
  v15 = [notificationRegistrationsForAppleMediaAccessories count];

  [(HMDHome *)selfCopy _applyNotificationDeregistrations];
  notificationRegistrations2 = [(HMDHome *)selfCopy notificationRegistrations];
  v17 = [notificationRegistrations2 count];

  notificationRegistrationsForAppleMediaAccessories2 = [(HMDHome *)selfCopy notificationRegistrationsForAppleMediaAccessories];
  v19 = [notificationRegistrationsForAppleMediaAccessories2 count];

  if (!v19 && v15)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = selfCopy;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      v33 = 138543362;
      v34 = v23;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Modifying Apple Media notification registrations with devices due to HomeKit client no longer active", &v33, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    mediaStateSubscriber = [(HMDHome *)v21 mediaStateSubscriber];
    [mediaStateSubscriber unsubscribeForAppleMediaStateWithSubscriptionToken:@"HMDHomeClientMediaStateRegistrationToken"];
  }

  if (!v17)
  {
    v25 = objc_autoreleasePoolPush();
    v26 = selfCopy;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
    {
      v28 = HMFGetLogIdentifier();
      v33 = 138543362;
      v34 = v28;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to HomeKit client no longer active", &v33, 0xCu);
    }

    objc_autoreleasePoolPop(v25);
    [(HMDHome *)v26 _subscribeForHomeNotificationsFromRemoteGateway:0];
    [(HMDHome *)v26 _subscribeForHomeNotificationsOnDirectTransports:?];
    date = [MEMORY[0x277CBEAA8] date];
    [(HMDHome *)v26 setNotificationsUpdatedTime:date];

    homeManager = [(HMDHome *)v26 homeManager];
    chipDataSource = [homeManager chipDataSource];
    [chipDataSource updateNotificationsEnabled:0 forHome:v26 keepAliveOnly:0];

    logAndPostNotification(@"HMDHomeDidDisableCharacteristicNotifyEventNotification", v26, 0);
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)_subscribeForHomeNotificationsOnDirectTransports:(void *)transports
{
  v62 = *MEMORY[0x277D85DE8];
  if (transports)
  {
    v2 = a2;
    v4 = [transports _characteristicNotificationPayloadsOnDirectTransports:a2];
    v5 = [v4 objectAtIndex:0];
    v6 = [v4 objectAtIndex:1];
    if ([v5 count] || objc_msgSend(v6, "count"))
    {
      if ([v5 count])
      {
        v7 = objc_autoreleasePoolPush();
        transportsCopy = transports;
        v9 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
        {
          v10 = HMFGetLogIdentifier();
          shortDescription = [v5 shortDescription];
          *buf = 138543618;
          v59 = v10;
          v60 = 2112;
          v61 = shortDescription;
          _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Deregistering notifications %@ with direct transports", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v7);
      }

      v47 = v2;
      v46 = v6;
      v54 = 0u;
      v55 = 0u;
      v52 = 0u;
      v53 = 0u;
      v45 = v5;
      v12 = v5;
      v13 = [v12 countByEnumeratingWithState:&v52 objects:v57 count:16];
      if (v13)
      {
        v14 = v13;
        v15 = *v53;
        do
        {
          for (i = 0; i != v14; ++i)
          {
            if (*v53 != v15)
            {
              objc_enumerationMutation(v12);
            }

            v17 = *(*(&v52 + 1) + 8 * i);
            v18 = [v12 objectForKey:{v17, v45}];
            v19 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v17];
            v20 = [transports accessoryWithUUID:v19];

            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v21 = v20;
            }

            else
            {
              v21 = 0;
            }

            v22 = v21;

            [v22 enableNotification:0 forCharacteristics:v18 message:0 clientIdentifier:@"com.apple.HomeKitDaemon.homeNotifications"];
          }

          v14 = [v12 countByEnumeratingWithState:&v52 objects:v57 count:16];
        }

        while (v14);
      }

      if ([v46 count])
      {
        v23 = objc_autoreleasePoolPush();
        transportsCopy2 = transports;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
        {
          v26 = HMFGetLogIdentifier();
          shortDescription2 = [v46 shortDescription];
          *buf = 138543618;
          v59 = v26;
          v60 = 2112;
          v61 = shortDescription2;
          _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_DEBUG, "%{public}@Registering notifications %@ with direct transports", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
      }

      v50 = 0u;
      v51 = 0u;
      v48 = 0u;
      v49 = 0u;
      v28 = v46;
      v29 = [v28 countByEnumeratingWithState:&v48 objects:v56 count:16];
      v5 = v45;
      if (v29)
      {
        v30 = v29;
        v31 = *v49;
        do
        {
          for (j = 0; j != v30; ++j)
          {
            if (*v49 != v31)
            {
              objc_enumerationMutation(v28);
            }

            v33 = *(*(&v48 + 1) + 8 * j);
            v34 = [v28 objectForKey:{v33, v45}];
            v35 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v33];
            v36 = [transports accessoryWithUUID:v35];

            v37 = v36;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v38 = v37;
            }

            else
            {
              v38 = 0;
            }

            v39 = v38;

            if (v39)
            {
              if (v47)
              {
                [v39 enableNotification:1 forCharacteristics:v34 message:0 clientIdentifier:@"com.apple.HomeKitDaemon.homeNotifications"];
              }

              else
              {
                [v39 updateNotificationEnabled:0 forCharacteristics:v34 onBehalfOf:@"com.apple.HomeKitDaemon.homeNotifications"];
              }

              [v39 checkHAPSessionRestore];
            }
          }

          v30 = [v28 countByEnumeratingWithState:&v48 objects:v56 count:16];
        }

        while (v30);
      }

      v6 = v46;
    }

    else
    {
      v41 = objc_autoreleasePoolPush();
      transportsCopy3 = transports;
      v43 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
      {
        v44 = HMFGetLogIdentifier();
        *buf = 138543362;
        v59 = v44;
        _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@Not registering notifications on direct transports since we have no modifications", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v41);
    }
  }

  v40 = *MEMORY[0x277D85DE8];
}

- (void)_handleCoalescedModifyNotifications
{
  v20 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)self setModifyNotificationsCoalesceTimer:0];
  v4 = objc_autoreleasePoolPush();
  selfCopy = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    *buf = 138543362;
    v19 = v7;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to notification coalesce timer firing", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __46__HMDHome__handleCoalescedModifyNotifications__block_invoke;
  aBlock[3] = &unk_278670818;
  aBlock[4] = selfCopy;
  v8 = _Block_copy(aBlock);
  enableNotificationPayload = [(HMDHome *)selfCopy enableNotificationPayload];
  pendingCharacteristicThresholdPayload = [(HMDHome *)selfCopy pendingCharacteristicThresholdPayload];
  actionSetsEnableNotificationPayload = [(HMDHome *)selfCopy actionSetsEnableNotificationPayload];
  matterAttributesEnableNotificationPayload = [(HMDHome *)selfCopy matterAttributesEnableNotificationPayload];
  v8[2](v8, enableNotificationPayload, pendingCharacteristicThresholdPayload, actionSetsEnableNotificationPayload, matterAttributesEnableNotificationPayload, 1);

  disableNotificationPayload = [(HMDHome *)selfCopy disableNotificationPayload];
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  actionSetsDisableNotificationPayload = [(HMDHome *)selfCopy actionSetsDisableNotificationPayload];
  v8[2](v8, disableNotificationPayload, dictionary, actionSetsDisableNotificationPayload, 0, 0);

  v16 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleCoalescedModifyNotifications__block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, unsigned int a6)
{
  v11 = a2;
  v12 = a3;
  v13 = a4;
  v14 = a5;
  if ([v11 count] || objc_msgSend(v13, "count") || objc_msgSend(v14, "count"))
  {
    v24 = a6;
    v15 = [v11 na_dictionaryByMappingValues:&__block_literal_global_2063];
    v23 = [v15 copy];

    v16 = [v13 copy];
    v17 = [v14 copy];
    v25 = v12;
    v18 = [v12 copy];
    v19 = objc_autoreleasePoolPush();
    v20 = [*(a1 + 32) notificationRegistrations];
    v21 = [v20 count];

    if (v21)
    {
      v26[0] = MEMORY[0x277D85DD0];
      v26[1] = 3221225472;
      v26[2] = __46__HMDHome__handleCoalescedModifyNotifications__block_invoke_3;
      v26[3] = &unk_2786707F0;
      v26[4] = *(a1 + 32);
      v22 = [v18 na_filter:v26];

      v18 = v22;
    }

    objc_autoreleasePoolPop(v19);
    [*(a1 + 32) _modifyCharacteristicNotificationsOnResident:v23 characteristicChangeThresholds:v18 mediaNotifications:MEMORY[0x277CBEC10] actionSetNotificationPayload:v16 matterAttributeNotifications:v17 enableNotification:v24];
    [v11 removeAllObjects];
    v12 = v25;
    [v25 removeAllObjects];
    [v13 removeAllObjects];
    [v14 removeAllObjects];
  }
}

BOOL __46__HMDHome__handleCoalescedModifyNotifications__block_invoke_3(uint64_t a1, void *a2, void *a3)
{
  v40 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v5];
  if (v7)
  {
    v8 = [*(a1 + 32) accessoryWithUUID:v7];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    if (v10)
    {
      v27 = v7;
      v28 = v5;
      v37 = 0u;
      v38 = 0u;
      v35 = 0u;
      v36 = 0u;
      v11 = [v6 allKeys];
      v34 = [v11 countByEnumeratingWithState:&v35 objects:v39 count:16];
      if (v34)
      {
        v12 = *v36;
        v30 = v10;
        v31 = v6;
        v29 = *v36;
        do
        {
          for (i = 0; i != v34; ++i)
          {
            if (*v36 != v12)
            {
              objc_enumerationMutation(v11);
            }

            v14 = *(*(&v35 + 1) + 8 * i);
            v15 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v14, "integerValue")}];
            if (v15)
            {
              v16 = [v10 hmdCharacteristicForInstanceId:v15];
              v17 = v16;
              if (v16)
              {
                v18 = [v16 service];
                if (!v18)
                {
                  goto LABEL_15;
                }

                v33 = [*(a1 + 32) dataSource];
                v19 = [v33 hapMetadata];
                v20 = [v17 type];
                [v18 type];
                v21 = v11;
                v23 = v22 = a1;
                v32 = [v19 shouldEnableHomeNotificationForCharacteristicType:v20 serviceType:v23];

                a1 = v22;
                v11 = v21;

                v10 = v30;
                v12 = v29;

                v6 = v31;
                if (v32)
                {
LABEL_15:
                  [v6 setObject:0 forKeyedSubscript:v14];
                }
              }

              else
              {
                [v6 setObject:0 forKeyedSubscript:v14];
              }
            }

            else
            {
              [v6 setObject:0 forKeyedSubscript:v14];
            }
          }

          v34 = [v11 countByEnumeratingWithState:&v35 objects:v39 count:16];
        }

        while (v34);
      }

      v24 = [v6 count] != 0;
      v7 = v27;
      v5 = v28;
    }

    else
    {
      v24 = 0;
    }
  }

  else
  {
    v24 = 0;
  }

  v25 = *MEMORY[0x277D85DE8];
  return v24;
}

id __46__HMDHome__handleCoalescedModifyNotifications__block_invoke_2(uint64_t a1, uint64_t a2, void *a3)
{
  v3 = [a3 copy];

  return v3;
}

- (void)residentDeviceManagerDidUpdateResidents:(id)residents
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __51__HMDHome_residentDeviceManagerDidUpdateResidents___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)residentDeviceManager:(id)manager didUpdatePrimaryResident:(id)resident previousPrimaryResident:(id)primaryResident
{
  residentCopy = resident;
  primaryResidentCopy = primaryResident;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __82__HMDHome_residentDeviceManager_didUpdatePrimaryResident_previousPrimaryResident___block_invoke;
  block[3] = &unk_27868A010;
  block[4] = self;
  v13 = residentCopy;
  v14 = primaryResidentCopy;
  v10 = primaryResidentCopy;
  v11 = residentCopy;
  dispatch_async(workQueue, block);
}

void __82__HMDHome_residentDeviceManager_didUpdatePrimaryResident_previousPrimaryResident___block_invoke(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  if (([*(a1 + 32) isOwnerUser] & 1) == 0)
  {
    v2 = [*(a1 + 32) residentSyncManager];
    [v2 performSync];
  }

  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v7 = *(a1 + 40);
    v8 = *(a1 + 48);
    v13 = 138543874;
    v14 = v6;
    v15 = 2112;
    v16 = v7;
    v17 = 2112;
    v18 = v8;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Scheduling re-subscription for new primary resident: %@, old primary: %@", &v13, 0x20u);
  }

  objc_autoreleasePoolPop(v3);
  v9 = *(a1 + 32);
  v10 = [*(a1 + 48) device];
  [v9 resubscribeForNotificationsOnResident:v10];

  [*(a1 + 32) migrateAfterResidentChange];
  [*(a1 + 32) reEvaluateHomeHubState];
  v11 = [*(a1 + 32) stagedRemoteReachabilityRegistration];
  [v11 resetAndStagePriorValue];

  v12 = *MEMORY[0x277D85DE8];
}

- (void)residentDeviceManager:(id)manager didUpdateResidentAvailable:(BOOL)available
{
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __60__HMDHome_residentDeviceManager_didUpdateResidentAvailable___block_invoke;
  v7[3] = &unk_278688650;
  v7[4] = self;
  availableCopy = available;
  dispatch_async(workQueue, v7);
}

uint64_t __60__HMDHome_residentDeviceManager_didUpdateResidentAvailable___block_invoke(uint64_t a1)
{
  v31 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 32) shortDescription];
    v7 = v6;
    v8 = *(a1 + 40);
    *buf = 138543874;
    v26 = v5;
    if (v8)
    {
      v9 = @"available";
    }

    else
    {
      v9 = @"unavailable";
    }

    v27 = 2112;
    v28 = v6;
    v29 = 2112;
    v30 = v9;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@[%@] Resident devices are %@ for this home", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v2);
  if ((*(a1 + 40) & 1) == 0)
  {
    [*(a1 + 32) migrateAfterResidentChange];
    if ((*(a1 + 40) & 1) == 0)
    {
      v22 = 0u;
      v23 = 0u;
      v20 = 0u;
      v21 = 0u;
      v10 = [*(a1 + 32) _residentUsers];
      v11 = [v10 countByEnumeratingWithState:&v20 objects:v24 count:16];
      if (v11)
      {
        v12 = v11;
        v13 = *v21;
        do
        {
          v14 = 0;
          do
          {
            if (*v21 != v13)
            {
              objc_enumerationMutation(v10);
            }

            [*(a1 + 32) _notifyClientsOfUpdatedResidentUser:*(*(&v20 + 1) + 8 * v14++)];
          }

          while (v12 != v14);
          v12 = [v10 countByEnumeratingWithState:&v20 objects:v24 count:16];
        }

        while (v12);
      }

      v15 = [*(a1 + 32) homeManager];
      v16 = [*(a1 + 32) uuid];
      [v15 electRemoteAccessPeerForHome:v16];

      if (([*(a1 + 32) isOwnerUser] & 1) == 0)
      {
        v17 = [*(a1 + 32) residentDeviceManager];
        [v17 discoverPrimaryResidentForRequester:0];
      }
    }
  }

  result = [*(a1 + 32) reEvaluateHomeHubState];
  v19 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)retrieveOperationalCertificatesForFabricID:(id)d commissionerNodeID:(id)iD commissioneeNodeID:(id)nodeID publicKey:(id)key completion:(id)completion
{
  v48 = *MEMORY[0x277D85DE8];
  dCopy = d;
  iDCopy = iD;
  nodeIDCopy = nodeID;
  keyCopy = key;
  completionCopy = completion;
  primaryResident = [(HMDHome *)self primaryResident];
  v15 = primaryResident;
  if (primaryResident && ([primaryResident device], (v16 = objc_claimAutoreleasedReturnValue()) != 0) && (-[HMDHome primaryResident](self, "primaryResident"), v17 = objc_claimAutoreleasedReturnValue(), v18 = objc_msgSend(v17, "isReachable"), v17, v16, (v18 & 1) != 0))
  {
    v19 = [HMDRemoteDeviceMessageDestination alloc];
    uuid = [(HMDHome *)self uuid];
    device = [v15 device];
    v22 = [(HMDRemoteDeviceMessageDestination *)v19 initWithTarget:uuid device:device];

    dictionary = [MEMORY[0x277CBEB38] dictionary];
    [dictionary setObject:nodeIDCopy forKeyedSubscript:@"HMDHomeCommissioningDeviceNodeIDMessageKey"];
    [dictionary setObject:dCopy forKeyedSubscript:@"HMDHomeCommissioningFabricIDMessageKey"];
    [dictionary setObject:dCopy forKeyedSubscript:@"HMDHomeCommissioningFabricIndexMessageKey"];
    [dictionary setObject:keyCopy forKeyedSubscript:@"HMDHomeCommissioningPublicKeyMessageKey"];
    if (isFeatureMatterLocalFabricConfigEnabled())
    {
      [dictionary setObject:iDCopy forKeyedSubscript:@"HMDHomeCommissioningCommissionerNodeIDMessageKey"];
    }

    v24 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeRequestCommissioningCertificatesMessage" destination:v22 payload:dictionary];
    [v24 setRemote:1];
    [v24 setSecureRemote:1];
    objc_initWeak(&location, self);
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __113__HMDHome_retrieveOperationalCertificatesForFabricID_commissionerNodeID_commissioneeNodeID_publicKey_completion___block_invoke;
    v40[3] = &unk_278689728;
    objc_copyWeak(&v42, &location);
    v41 = completionCopy;
    [v24 setResponseHandler:v40];
    context = objc_autoreleasePoolPush();
    selfCopy = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      shortDescription = [v24 shortDescription];
      *buf = 138543618;
      v45 = v27;
      v46 = 2112;
      v47 = shortDescription;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Sending message %@ to fetch Matter operational certificates from the primary resident", buf, 0x16u);
    }

    objc_autoreleasePoolPop(context);
    msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
    [msgDispatcher sendMessage:v24];

    objc_destroyWeak(&v42);
    objc_destroyWeak(&location);
  }

  else
  {
    v30 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
    {
      v33 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v33;
      _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not available or it is unreachable", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v30);
    v34 = MEMORY[0x277CCA9B8];
    v22 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
    dictionary = [v34 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v22];
    (*(completionCopy + 2))(completionCopy, 0, 0, 0, 0, dictionary);
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __113__HMDHome_retrieveOperationalCertificatesForFabricID_commissionerNodeID_commissioneeNodeID_publicKey_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v11;
        v29 = 2112;
        v30 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for operational certificates failed with %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:@"HMDHomeCommissioningRootCertMessageKey"];
      v13 = [v6 hmf_dataForKey:@"HMDHomeCommissioningOperationalCertMessageKey"];
      v14 = [v6 hmf_numberForKey:@"HMDHomeCommissioningOwnerNodeIDMessageKey"];
      v15 = [v6 hmf_dataForKey:@"HMDHomeCommissioningIPKMessageKey"];
      context = objc_autoreleasePoolPush();
      v16 = WeakRetained;
      v17 = HMFGetOSLogHandle();
      v18 = v17;
      if (v12 && v13)
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v19 = v24 = v15;
          *buf = 138544130;
          v28 = v19;
          v29 = 2112;
          v30 = v12;
          v31 = 2112;
          v32 = v13;
          v33 = 2112;
          v34 = v14;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Request for operational certificates successful. rootCertificate %@, operationalCert %@, ownerNodeID %@", buf, 0x2Au);

          v15 = v24;
        }

        objc_autoreleasePoolPop(context);
        (*(*(a1 + 32) + 16))();
      }

      else
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v20 = v25 = v15;
          *buf = 138544130;
          v28 = v20;
          v29 = 2112;
          v30 = v12;
          v31 = 2112;
          v32 = v13;
          v33 = 2112;
          v34 = v14;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Primary resident returned unexpected values for rootCertificate %@, operationalCert %@, ownerNodeID %@", buf, 0x2Au);

          v15 = v25;
        }

        objc_autoreleasePoolPop(context);
        v21 = *(a1 + 32);
        v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        (*(v21 + 16))(v21, 0, 0, 0, 0, v22);
      }
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_fetchMetadataFromPrimaryResidentWithCompletion:(id)completion
{
  v26 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  primaryResident = [(HMDHome *)self primaryResident];
  v6 = [(HMDHome *)self _checkResidentCapabilitiesForCredentialSharing:primaryResident];
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v25 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Couldn't find compatible resident to fetch Thread network credentials", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    completionCopy[2](completionCopy, 0, v6);
  }

  else
  {
    v11 = [HMDRemoteDeviceMessageDestination alloc];
    uuid = [(HMDHome *)self uuid];
    device = [primaryResident device];
    v14 = [(HMDRemoteDeviceMessageDestination *)v11 initWithTarget:uuid device:device];

    v15 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeThreadNetworkCredentialsRequestKey" destination:v14 payload:0];
    [v15 setRemote:1];
    [v15 setSecureRemote:1];
    objc_initWeak(buf, self);
    v18 = MEMORY[0x277D85DD0];
    v19 = 3221225472;
    v20 = __59__HMDHome__fetchMetadataFromPrimaryResidentWithCompletion___block_invoke;
    v21 = &unk_278689728;
    objc_copyWeak(&v23, buf);
    v22 = completionCopy;
    [v15 setResponseHandler:&v18];
    v16 = [(HMDHome *)self msgDispatcher:v18];
    [v16 sendMessage:v15 completionHandler:0];

    objc_destroyWeak(&v23);
    objc_destroyWeak(buf);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __59__HMDHome__fetchMetadataFromPrimaryResidentWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v47 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v11;
        v43 = 2112;
        v44 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for Thread Network credentials failed with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:*MEMORY[0x277CD0620]];
      v40 = 0;
      v13 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v12 error:&v40];
      v38 = v40;
      v14 = [v6 hmf_dataForKey:@"HMHomeThreadNetworkCredentialsMasterKeyMessageKey"];
      v15 = objc_autoreleasePoolPush();
      v16 = WeakRetained;
      v17 = HMFGetOSLogHandle();
      v18 = v17;
      v39 = v14;
      if (v13)
      {
        v19 = v14 == 0;
      }

      else
      {
        v19 = 1;
      }

      if (v19)
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v21 = v20 = v12;
          v22 = [v39 length];
          *buf = 138543874;
          v42 = v21;
          v43 = 2112;
          v44 = v13;
          v45 = 2048;
          v46 = v22;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Missing metadata (%@)/masterKeyData (length %zu) in response", buf, 0x20u);

          v12 = v20;
        }

        objc_autoreleasePoolPop(v15);
        v23 = *(a1 + 32);
        v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        (*(v23 + 16))(v23, 0, v24);
        v14 = v39;
      }

      else
      {
        v36 = v6;
        v37 = v12;
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          v26 = HMFGetLogIdentifier();
          *buf = 138543362;
          v42 = v26;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Request for Thread Network Metadata successful", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v15);
        v35 = objc_alloc(MEMORY[0x277CD1EA8]);
        v33 = [v13 name];
        v34 = [v13 channel];
        v32 = [v13 PANID];
        v27 = [v13 extendedPANID];
        v28 = [v13 passPhrase];
        v29 = [v13 PSKc];
        v30 = [v13 operationalDataset];
        v24 = [v35 initWithName:v33 channel:v34 PANID:v32 extendedPANID:v27 masterKey:v14 passPhrase:v28 PSKc:v29 operationalDataset:v30];

        (*(*(a1 + 32) + 16))();
        v6 = v36;
        v12 = v37;
      }
    }
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (id)_checkResidentCapabilitiesForCredentialSharing:(id)sharing
{
  v21 = *MEMORY[0x277D85DE8];
  sharingCopy = sharing;
  v5 = sharingCopy;
  if (sharingCopy && ([sharingCopy device], v6 = objc_claimAutoreleasedReturnValue(), v6, v6))
  {
    capabilities = [v5 capabilities];
    supportsThreadNetworkCredentialSharing = [capabilities supportsThreadNetworkCredentialSharing];

    if (supportsThreadNetworkCredentialSharing)
    {
      v9 = 0;
      goto LABEL_12;
    }

    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v16;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Primary resident doesn't support Thread Network Credential sharing", &v19, 0xCu);
    }

    v14 = 92;
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request thread credentials from", &v19, 0xCu);
    }

    v14 = 91;
  }

  objc_autoreleasePoolPop(v10);
  v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:v14];
LABEL_12:

  v17 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)removeThreadNetworkPreferredNetworkWithCompletion:(id)completion
{
  completionCopy = completion;
  v4 = +[HMDThreadNetworkMetadataStore defaultStore];
  [v4 removePreferredNetworkWithCompletion:completionCopy];
}

- (void)retrieveThreadNetworkMetadataWithNoFallbackWithCompletion:(id)completion
{
  v31 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if (![(HMDHome *)self isSharedAdmin]&& ![(HMDHome *)self isOwnerUser])
  {
    v17 = objc_autoreleasePoolPush();
    selfCopy = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543362;
      v30 = v20;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Unexpected user. Returning without retrieving thread network credentials", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
    residentDevices = [MEMORY[0x277CCA9B8] hmErrorWithCode:47];
    completionCopy[2](completionCopy, 0, residentDevices);
    goto LABEL_23;
  }

  if (![(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];

    if ([residentDevices count])
    {
      primaryResident = [(HMDHome *)self primaryResident];
      isReachable = [primaryResident isReachable];

      if (isReachable)
      {
        v27[0] = MEMORY[0x277D85DD0];
        v27[1] = 3221225472;
        v27[2] = __69__HMDHome_retrieveThreadNetworkMetadataWithNoFallbackWithCompletion___block_invoke;
        v27[3] = &unk_2786815F0;
        v27[4] = self;
        v28 = completionCopy;
        [(HMDHome *)self _fetchMetadataFromPrimaryResidentWithCompletion:v27];

LABEL_23:
        goto LABEL_24;
      }
    }

    if ([(HMDHome *)self isSharedAdmin])
    {
      v9 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 138543362;
        v30 = v12;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@No resident available. Returning without retrieving thread network credentials", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
      v13 = [residentDevices count];
      v14 = MEMORY[0x277CCA9B8];
      if (!v13)
      {
        v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
        completionCopy[2](completionCopy, 0, v15);
        goto LABEL_22;
      }

      v15 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
      v16 = [v14 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v15];
      completionCopy[2](completionCopy, 0, v16);
    }

    else
    {
      if (![residentDevices count])
      {
        [(HMDHome *)self _fetchMetadataOnCurrentDeviceWithCompletion:completionCopy];
        goto LABEL_23;
      }

      v21 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        *buf = 138543362;
        v30 = v24;
        _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not reachable. Returning without retrieving thread network credentials", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
      v25 = MEMORY[0x277CCA9B8];
      v15 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
      v16 = [v25 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v15];
      completionCopy[2](completionCopy, 0, v16);
    }

LABEL_22:
    goto LABEL_23;
  }

  [(HMDHome *)self _fetchMetadataOnCurrentDeviceWithCompletion:completionCopy];
LABEL_24:

  v26 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome_retrieveThreadNetworkMetadataWithNoFallbackWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (!v5 || v6)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v13 = 138543618;
      v14 = v11;
      v15 = 2112;
      v16 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to get thread network credentials from resident. Not falling back. Error: %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  (*(*(a1 + 40) + 16))();

  v12 = *MEMORY[0x277D85DE8];
}

- (void)retrieveThreadNetworkMetadataWithCompletion:(id)completion
{
  v14 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if (![(HMDHome *)self isSharedAdmin])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      v10 = +[HMDThreadNetworkMetadataStore defaultStore];
      [v10 retrieveMetadataWithCompletion:completionCopy];
LABEL_12:

      goto LABEL_13;
    }

    v5 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v8;
      v9 = "%{public}@Unexpected user. Returning without retrieving thread network credentials";
      goto LABEL_10;
    }

LABEL_11:

    objc_autoreleasePoolPop(v5);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:47];
    completionCopy[2](completionCopy, 0, v10);
    goto LABEL_12;
  }

  if ([(HMDHome *)self isCurrentDevicePrimaryResident])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v8;
      v9 = "%{public}@Running as a shared admin on primary resident; This is unexpected. Returning without retrieving thread network credentials";
LABEL_10:
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, v9, &v12, 0xCu);

      goto LABEL_11;
    }

    goto LABEL_11;
  }

  [(HMDHome *)self _fetchMetadataFromPrimaryResidentWithCompletion:completionCopy];
LABEL_13:

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_fetchMetadataOnCurrentDeviceWithCompletion:(id)completion
{
  completionCopy = completion;
  v6 = +[HMDThreadNetworkMetadataStore defaultStore];
  threadOperationalDataset = [(HMDHome *)self threadOperationalDataset];
  [v6 retrieveMetadata:threadOperationalDataset homeHasResident:-[HMDHome doesHomeContainResident](self completion:{"doesHomeContainResident"), completionCopy}];
}

- (void)_unconfigurePairedAccessoriesForServer:(id)server updateReachability:(BOOL)reachability
{
  reachabilityCopy = reachability;
  v24 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  if ([serverCopy isPaired])
  {
    if (reachabilityCopy)
    {
      v7 = objc_autoreleasePoolPush();
      selfCopy = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543618;
        v21 = v10;
        v22 = 2112;
        v23 = serverCopy;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Setting reachability to false for all paired accessories associated with %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
    }

    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    identifier = [serverCopy identifier];
    linkType = [serverCopy linkType];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __69__HMDHome__unconfigurePairedAccessoriesForServer_updateReachability___block_invoke;
    v16[3] = &unk_2786707A8;
    v17 = identifier;
    v18 = linkType;
    v19 = reachabilityCopy;
    v14 = identifier;
    [(HMDHome *)self _notifyRetrievalError:v11 accessoryServer:v14 linkType:linkType accessoryOperationBlock:v16];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_processUpdatedAccessoryServer:(id)server reAddServices:(BOOL)services
{
  v312 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v301 = v8;
    v302 = 2112;
    v303 = serverCopy;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Updating existing HMDAccessory objects from HAPAccessory objects for server: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v225 = [(HMDHome *)selfCopy _primaryAccessoryForServer:serverCopy];
  identifier = [serverCopy identifier];
  v194 = [(HMDHome *)selfCopy matterAccessoryWithIdentifier:identifier];

  matterAdapter = [v194 matterAdapter];
  v11 = [matterAdapter updateNativeMatterSupportForAccessoryServer:serverCopy];

  if ((v11 & 1) == 0)
  {
    if ([v194 isNativeMatter])
    {
      v12 = v194;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v13 = v12;
      }

      else
      {
        v13 = 0;
      }

      array = v13;

      [array processUpdatedAccessoryServer:serverCopy];
LABEL_147:

      goto LABEL_148;
    }

    array = [MEMORY[0x277CBEB18] array];
    array2 = [MEMORY[0x277CBEB18] array];
    configNumber = [v225 configNumber];
    v14 = MEMORY[0x277CBEB18];
    accessories = [serverCopy accessories];
    v205 = [v14 arrayWithArray:accessories];

    v16 = MEMORY[0x277CBEB18];
    v17 = [(HMDHome *)selfCopy hapAccessoriesForServer:serverCopy];
    v218 = [v16 arrayWithArray:v17];

    v18 = objc_autoreleasePoolPush();
    v235 = selfCopy;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      v21 = [v218 count];
      identifier2 = [serverCopy identifier];
      accessories2 = [serverCopy accessories];
      v24 = [accessories2 count];
      *buf = 138544130;
      v301 = v20;
      v302 = 2050;
      v303 = v21;
      v304 = 2114;
      v305 = identifier2;
      v306 = 2050;
      v307 = v24;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Found %{public}tu existing HMDAccessory objects associated with the server: '%{public}@' and discovered %{public}tu HAPAccessory objects", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v18);
    array3 = [MEMORY[0x277CBEB18] array];
    array4 = [MEMORY[0x277CBEB18] array];
    array5 = [MEMORY[0x277CBEB18] array];
    array6 = [MEMORY[0x277CBEB18] array];
    array7 = [MEMORY[0x277CBEB18] array];
    context = [MEMORY[0x277CBEB18] array];
    v281 = 0u;
    v282 = 0u;
    v279 = 0u;
    v280 = 0u;
    obj = [serverCopy accessories];
    v222 = [obj countByEnumeratingWithState:&v279 objects:v298 count:16];
    if (v222)
    {
      v219 = *v280;
      do
      {
        for (i = 0; i != v222; ++i)
        {
          if (*v280 != v219)
          {
            objc_enumerationMutation(obj);
          }

          v26 = *(*(&v279 + 1) + 8 * i);
          v275 = 0u;
          v276 = 0u;
          v277 = 0u;
          v278 = 0u;
          v27 = v218;
          v28 = [v27 countByEnumeratingWithState:&v275 objects:v297 count:16];
          if (!v28)
          {
            goto LABEL_27;
          }

          v29 = *v276;
          while (2)
          {
            for (j = 0; j != v28; ++j)
            {
              if (*v276 != v29)
              {
                objc_enumerationMutation(v27);
              }

              v31 = *(*(&v275 + 1) + 8 * j);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v32 = v31;
              }

              else
              {
                v32 = 0;
              }

              v33 = v32;

              if ([v33 matchesHAPAccessory:v26])
              {

                if (!v33)
                {
                  goto LABEL_62;
                }

                if (([v33 isPrimary] & 1) == 0 && (objc_msgSend(v33, "isPaired") & 1) == 0)
                {
                  v65 = objc_autoreleasePoolPush();
                  v66 = v235;
                  v67 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v67, OS_LOG_TYPE_INFO))
                  {
                    v68 = HMFGetLogIdentifier();
                    shortDescription = [v33 shortDescription];
                    *buf = 138543618;
                    v301 = v68;
                    v302 = 2114;
                    v303 = shortDescription;
                    _os_log_impl(&dword_229538000, v67, OS_LOG_TYPE_INFO, "%{public}@Skipping configuring unpaired secondary accessory with identifier: %{public}@", buf, 0x16u);
                  }

                  objc_autoreleasePoolPop(v65);
                  goto LABEL_61;
                }

                [array addObject:v26];
                [array2 addObject:v33];
                uuid = [v33 uuid];
                hostAccessory = [v33 hostAccessory];
                uuid2 = [hostAccessory uuid];
                v37 = [(HMDHome *)v235 getTransactionFromHAPAccessory:v26 hmdAccessory:v33 uuid:uuid hostAccessoryUUID:uuid2 objectChangeType:2];

                v38 = v26;
                v39 = v33;
                v40 = v37;
                initialManufacturer = [v39 initialManufacturer];
                if (initialManufacturer)
                {
LABEL_34:
                }

                else
                {
                  manufacturer = [v38 manufacturer];
                  v43 = manufacturer == 0;

                  if (!v43)
                  {
                    initialManufacturer = [v38 manufacturer];
                    [v40 setInitialManufacturer:initialManufacturer];
                    goto LABEL_34;
                  }
                }

                initialModel = [v39 initialModel];
                if (initialModel)
                {
LABEL_38:
                }

                else
                {
                  model = [v38 model];
                  v46 = model == 0;

                  if (!v46)
                  {
                    initialModel = [v38 model];
                    [v40 setInitialModel:initialModel];
                    goto LABEL_38;
                  }
                }

                initialCategoryIdentifier = [v39 initialCategoryIdentifier];
                if (initialCategoryIdentifier)
                {
LABEL_42:
                }

                else
                {
                  category = [v38 category];
                  v49 = category == 0;

                  if (!v49)
                  {
                    initialCategoryIdentifier = [v38 category];
                    [v40 setInitialCategoryIdentifier:initialCategoryIdentifier];
                    goto LABEL_42;
                  }
                }

                initialServiceTypeUUIDs = [v39 initialServiceTypeUUIDs];
                v51 = initialServiceTypeUUIDs == 0;

                if (v51)
                {
                  v52 = serviceTypeUUIDsForAccessory(v38);
                  if (v52)
                  {
                    [v40 setInitialServiceTypeUUIDs:v52];
                  }
                }

                v274 = array6;
                v273 = array7;
                v272 = context;
                [(HMDHome *)v235 getUpdateTransactionForAccessory:v39 hapAccessory:v38 accessoryTransaction:v40 addSvcTransactions:&v274 updateSvcTransactions:&v273 removeSvcTransactions:&v272];
                val = v274;

                v233 = v273;
                v230 = v272;

                if ([v38 isPrimary])
                {
                  setupHash = [serverCopy setupHash];
                  if (setupHash)
                  {
                    contexta = objc_autoreleasePoolPush();
                    v54 = v235;
                    v55 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v55, OS_LOG_TYPE_INFO))
                    {
                      v56 = HMFGetLogIdentifier();
                      shortDescription2 = [v39 shortDescription];
                      *buf = 138543874;
                      v301 = v56;
                      v302 = 2112;
                      v303 = setupHash;
                      v304 = 2112;
                      v305 = shortDescription2;
                      _os_log_impl(&dword_229538000, v55, OS_LOG_TYPE_INFO, "%{public}@Saving setup hash '%@ for accessory %@", buf, 0x20u);
                    }

                    objc_autoreleasePoolPop(contexta);
                    [v40 setAccessorySetupHash:setupHash];
                  }

                  [(HMDHome *)v235 _processUpdatedProductDataForAccessory:v39 hapAccessory:v38 transaction:v40];
                }

                v58 = [v39 modelObjectWithChangeType:1];
                v271 = 0;
                [v58 diff:v40 differingFields:&v271];
                v59 = v271;

                if ([(__CFString *)v59 count])
                {
                  v60 = objc_autoreleasePoolPush();
                  v61 = v235;
                  v62 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
                  {
                    v63 = HMFGetLogIdentifier();
                    shortDescription3 = [v225 shortDescription];
                    *buf = 138544130;
                    v301 = v63;
                    v302 = 2114;
                    v303 = shortDescription3;
                    v304 = 2114;
                    v305 = v40;
                    v306 = 2114;
                    v307 = v59;
                    _os_log_impl(&dword_229538000, v62, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Received accessory update %{public}@ due to diff %{public}@", buf, 0x2Au);
                  }

                  objc_autoreleasePoolPop(v60);
                  [array4 addObject:v40];
                }

                context = v230;
                array7 = v233;
                array6 = val;
                goto LABEL_61;
              }
            }

            v28 = [v27 countByEnumeratingWithState:&v275 objects:v297 count:16];
            if (v28)
            {
              continue;
            }

            break;
          }

LABEL_27:
          v31 = v27;
LABEL_61:

LABEL_62:
          ;
        }

        v222 = [obj countByEnumeratingWithState:&v279 objects:v298 count:16];
      }

      while (v222);
    }

    v70 = objc_autoreleasePoolPush();
    vala = v235;
    v71 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v71, OS_LOG_TYPE_INFO))
    {
      v72 = HMFGetLogIdentifier();
      *buf = 138543618;
      v301 = v72;
      v302 = 2112;
      v303 = serverCopy;
      _os_log_impl(&dword_229538000, v71, OS_LOG_TYPE_INFO, "%{public}@Finished updating paired accessories for server: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v70);
    [v205 removeObjectsInArray:array];
    [v218 removeObjectsInArray:array2];
    accessories3 = [(HMDHome *)vala accessories];
    v269 = 0u;
    v270 = 0u;
    v267 = 0u;
    v268 = 0u;
    v204 = v205;
    obja = [v204 countByEnumeratingWithState:&v267 objects:v296 count:16];
    if (obja)
    {
      v210 = *v268;
      do
      {
        v73 = 0;
        do
        {
          if (*v268 != v210)
          {
            v74 = v73;
            objc_enumerationMutation(v204);
            v73 = v74;
          }

          v220 = v73;
          v75 = *(*(&v267 + 1) + 8 * v73);
          v263 = 0u;
          v264 = 0u;
          v265 = 0u;
          v266 = 0u;
          v76 = accessories3;
          v77 = [v76 countByEnumeratingWithState:&v263 objects:v295 count:16];
          if (v77)
          {
            v78 = *v264;
LABEL_73:
            v79 = 0;
            while (1)
            {
              if (*v264 != v78)
              {
                objc_enumerationMutation(v76);
              }

              v80 = *(*(&v263 + 1) + 8 * v79);
              objc_opt_class();
              v81 = (objc_opt_isKindOfClass() & 1) != 0 ? v80 : 0;
              v82 = v81;

              identifier3 = [v75 identifier];
              instanceID = [v75 instanceID];
              v85 = [v82 matchesHAPAccessoryWithServerIdentifier:identifier3 instanceID:instanceID];

              if (v85)
              {
                break;
              }

              if (v77 == ++v79)
              {
                v77 = [v76 countByEnumeratingWithState:&v263 objects:v295 count:16];
                if (v77)
                {
                  goto LABEL_73;
                }

                goto LABEL_82;
              }
            }

            v236 = objc_autoreleasePoolPush();
            v223 = vala;
            v86 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v86, OS_LOG_TYPE_INFO))
            {
              v206 = HMFGetLogIdentifier();
              server = [v75 server];
              identifier4 = [server identifier];
              instanceID2 = [v75 instanceID];
              linkType = [v75 linkType];
              v90 = @"Undefined";
              if (linkType <= 2)
              {
                v90 = off_2786768F0[linkType];
              }

              v91 = v90;
              name = [v82 name];
              uniqueIdentifier = [v82 uniqueIdentifier];
              *buf = 138544642;
              v301 = v206;
              v302 = 2114;
              v303 = identifier4;
              v304 = 2114;
              v305 = instanceID2;
              v306 = 2112;
              v307 = v91;
              v308 = 2112;
              v309 = name;
              v310 = 2112;
              v311 = uniqueIdentifier;
              _os_log_impl(&dword_229538000, v86, OS_LOG_TYPE_INFO, "%{public}@HAPAccessory %{public}@/%{public}@/%@ matches existing HMDAccessory %@(%@)", buf, 0x3Eu);
            }

            objc_autoreleasePoolPop(v236);
            if (v82)
            {
              [v218 removeObject:v82];
              uuid3 = [v82 uuid];
              hostAccessory2 = [v82 hostAccessory];
              uuid4 = [hostAccessory2 uuid];
              v237 = [(HMDHome *)v223 getTransactionFromHAPAccessory:v75 hmdAccessory:v82 uuid:uuid3 hostAccessoryUUID:uuid4 objectChangeType:2];

              v262 = array6;
              v261 = array7;
              v260 = context;
              [(HMDHome *)v223 getUpdateTransactionForAccessory:v82 hapAccessory:v75 accessoryTransaction:v237 addSvcTransactions:&v262 updateSvcTransactions:&v261 removeSvcTransactions:&v260];
              v97 = v262;

              v98 = v261;
              v99 = v260;

              v100 = [v82 modelObjectWithChangeType:1];
              v259 = 0;
              [v100 diff:v237 differingFields:&v259];
              v101 = v259;

              if ([(__CFString *)v101 count])
              {
                v102 = objc_autoreleasePoolPush();
                v103 = v223;
                v104 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v104, OS_LOG_TYPE_INFO))
                {
                  v105 = HMFGetLogIdentifier();
                  uuid5 = [v225 uuid];
                  *buf = 138544130;
                  v301 = v105;
                  v302 = 2114;
                  v303 = uuid5;
                  v304 = 2114;
                  v305 = v237;
                  v306 = 2114;
                  v307 = v101;
                  _os_log_impl(&dword_229538000, v104, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Received accessory update %{public}@ due to diff %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v102);
                [array4 addObject:v237];
              }

              goto LABEL_102;
            }
          }

          else
          {
LABEL_82:
          }

          if (v225)
          {
            instanceID3 = [v75 instanceID];
            stringValue = [instanceID3 stringValue];
            v294 = stringValue;
            v80 = [MEMORY[0x277CBEA60] arrayWithObjects:&v294 count:1];

            v109 = MEMORY[0x277CCAD78];
            uuid6 = [v225 uuid];
            v237 = [v109 hm_deriveUUIDFromBaseUUID:uuid6 withSalts:v80];

            if (!v237)
            {
              v111 = objc_autoreleasePoolPush();
              v112 = vala;
              v113 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v113, OS_LOG_TYPE_ERROR))
              {
                v114 = HMFGetLogIdentifier();
                shortDescription4 = [v225 shortDescription];
                *buf = 138543618;
                v301 = v114;
                v302 = 2112;
                v303 = shortDescription4;
                _os_log_impl(&dword_229538000, v113, OS_LOG_TYPE_ERROR, "%{public}@Error during _processUpdatedAccessoryServer: Primary Accessory for Server has nil UUID: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v111);
              v116 = +[HMDTTRManager sharedManager];
              [v116 requestRadarWithDisplayReason:@"accessory has null identifier" radarTitle:@"PrimaryAccessoryForServer results in nil uuid during processUpdatedAccessoryServer"];
            }

            v117 = objc_autoreleasePoolPush();
            v118 = vala;
            v119 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v119, OS_LOG_TYPE_INFO))
            {
              v120 = HMFGetLogIdentifier();
              shortDescription5 = [v225 shortDescription];
              instanceID4 = [v75 instanceID];
              uUIDString = [v237 UUIDString];
              *buf = 138544130;
              v301 = v120;
              v302 = 2114;
              v303 = shortDescription5;
              v304 = 2114;
              v305 = instanceID4;
              v306 = 2114;
              v307 = uUIDString;
              _os_log_impl(&dword_229538000, v119, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Adding a new bridged accessory instanceID %{public}@ and uuid %{public}@", buf, 0x2Au);
            }

            objc_autoreleasePoolPop(v117);
            uuid7 = [v225 uuid];
            v101 = [(HMDHome *)v118 getTransactionFromHAPAccessory:v75 hmdAccessory:0 uuid:v237 hostAccessoryUUID:uuid7 objectChangeType:1];

            roomUUID = [(__CFString *)v101 roomUUID];
            LODWORD(uuid7) = roomUUID == 0;

            if (uuid7)
            {
              room = [v225 room];
              uuid8 = [room uuid];
              uUIDString2 = [uuid8 UUIDString];
              [(__CFString *)v101 setRoomUUID:uUIDString2];
            }

            v258 = array6;
            v257 = array7;
            v256 = context;
            [(HMDHome *)v118 getUpdateTransactionForAccessory:0 hapAccessory:v75 accessoryTransaction:v101 addSvcTransactions:&v258 updateSvcTransactions:&v257 removeSvcTransactions:&v256];
            v97 = v258;

            v98 = v257;
            v99 = v256;

            v129 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v225, "certificationStatus")}];
            [(__CFString *)v101 setCertificationStatus:v129];

            uuidToHAPAccessoryConfigTable = [(HMDHome *)v118 uuidToHAPAccessoryConfigTable];
            [uuidToHAPAccessoryConfigTable setObject:v75 forKey:v237];

            [array3 addObject:v101];
LABEL_102:

            context = v99;
            array7 = v98;
            array6 = v97;
          }

          v73 = v220 + 1;
        }

        while ((v220 + 1) != obja);
        obja = [v204 countByEnumeratingWithState:&v267 objects:v296 count:16];
      }

      while (obja);
    }

    if ([v218 count])
    {
      v254 = 0u;
      v255 = 0u;
      v252 = 0u;
      v253 = 0u;
      v131 = v218;
      v132 = [v131 countByEnumeratingWithState:&v252 objects:v293 count:16];
      if (v132)
      {
        v133 = *v253;
        do
        {
          for (k = 0; k != v132; ++k)
          {
            if (*v253 != v133)
            {
              objc_enumerationMutation(v131);
            }

            v135 = *(*(&v252 + 1) + 8 * k);
            if (([v135 isPrimary] & 1) == 0)
            {
              v136 = [v135 transactionWithObjectChangeType:3];
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v137 = v136;
              }

              else
              {
                v137 = 0;
              }

              v138 = v137;

              v139 = objc_autoreleasePoolPush();
              v140 = vala;
              v141 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v141, OS_LOG_TYPE_INFO))
              {
                v142 = HMFGetLogIdentifier();
                shortDescription6 = [v225 shortDescription];
                *buf = 138543874;
                v301 = v142;
                v302 = 2114;
                v303 = shortDescription6;
                v304 = 2114;
                v305 = v138;
                _os_log_impl(&dword_229538000, v141, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Removing a secondary accessory %{public}@", buf, 0x20u);
              }

              objc_autoreleasePoolPop(v139);
              if (v138)
              {
                [array5 addObject:v138];
              }
            }
          }

          v132 = [v131 countByEnumeratingWithState:&v252 objects:v293 count:16];
        }

        while (v132);
      }
    }

    v144 = dispatch_group_create();
    v221 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v224 = serverCopy;
    v145 = v225;
    v234 = array6;
    v231 = array7;
    v238 = context;
    contextb = v145;
    configNumber2 = [v145 configNumber];
    if ([v224 configNumber] == configNumber2)
    {
      if ([v238 count] || objc_msgSend(v234, "count"))
      {

LABEL_127:
        v147 = objc_autoreleasePoolPush();
        v148 = vala;
        v149 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v149, OS_LOG_TYPE_ERROR))
        {
          v150 = HMFGetLogIdentifier();
          shortDescription7 = [contextb shortDescription];
          v152 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:configNumber];
          *buf = 138543874;
          v301 = v150;
          v302 = 2112;
          v303 = shortDescription7;
          v304 = 2112;
          v305 = v152;
          _os_log_impl(&dword_229538000, v149, OS_LOG_TYPE_ERROR, "%{public}@Only storing the update locally since the accessory %@ didn't update its config number: %@ after updating its services/characteristics.", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v147);
        v153 = @"Add Accessory Locally";
        v154 = +[HMDBackingStoreTransactionOptions defaultLocalOptions];

        v155 = @"Add Accessory Locally";
        v221 = v154;
        goto LABEL_132;
      }

      v289 = 0u;
      v290 = 0u;
      v287 = 0u;
      v288 = 0u;
      v207 = v231;
      v199 = [v207 countByEnumeratingWithState:&v287 objects:buf count:16];
      if (v199)
      {
        v175 = *v288;
        objb = *MEMORY[0x277CD2138];
        v211 = *MEMORY[0x277CD21A8];
        v195 = *v288;
        while (2)
        {
          v176 = 0;
          do
          {
            if (*v288 != v175)
            {
              v177 = v176;
              objc_enumerationMutation(v207);
              v176 = v177;
            }

            v198 = v176;
            v178 = *(*(&v287 + 1) + 8 * v176);
            instanceID5 = [v178 instanceID];
            v180 = [contextb findService:instanceID5];

            serviceType = [v180 serviceType];
            serviceType2 = [v178 serviceType];
            v183 = [serviceType isEqualToString:serviceType2];

            if (!v183)
            {
LABEL_167:

              goto LABEL_127;
            }

            v285 = 0u;
            v286 = 0u;
            v283 = 0u;
            v284 = 0u;
            characteristics = [v178 characteristics];
            v184 = [characteristics countByEnumeratingWithState:&v283 objects:v299 count:16];
            if (v184)
            {
              v185 = *v284;
              while (2)
              {
                for (m = 0; m != v184; ++m)
                {
                  if (*v284 != v185)
                  {
                    objc_enumerationMutation(characteristics);
                  }

                  v187 = *(*(&v283 + 1) + 8 * m);
                  v188 = [v187 objectForKeyedSubscript:objb];
                  v189 = [v187 objectForKeyedSubscript:v211];
                  v190 = [v180 findCharacteristic:v188];
                  characteristicType = [v190 characteristicType];
                  v192 = [characteristicType isEqualToString:v189];

                  if (!v192)
                  {

                    goto LABEL_167;
                  }
                }

                v184 = [characteristics countByEnumeratingWithState:&v283 objects:v299 count:16];
                if (v184)
                {
                  continue;
                }

                break;
              }
            }

            v176 = v198 + 1;
            v175 = v195;
          }

          while (v198 + 1 != v199);
          v199 = [v207 countByEnumeratingWithState:&v287 objects:buf count:16];
          v175 = v195;
          if (v199)
          {
            continue;
          }

          break;
        }
      }
    }

    else
    {
    }

    v155 = @"Add Accessory";
LABEL_132:
    backingStore = [(HMDHome *)vala backingStore];
    v157 = [backingStore transaction:v155 options:v221];

    v158 = [array4 arrayByAddingObjectsFromArray:array3];
    v159 = [v158 arrayByAddingObjectsFromArray:array5];

    v250 = 0u;
    v251 = 0u;
    v248 = 0u;
    v249 = 0u;
    v160 = v159;
    v161 = [v160 countByEnumeratingWithState:&v248 objects:v292 count:16];
    if (v161)
    {
      v162 = *v249;
      do
      {
        for (n = 0; n != v161; ++n)
        {
          if (*v249 != v162)
          {
            objc_enumerationMutation(v160);
          }

          v164 = *(*(&v248 + 1) + 8 * n);
          [v164 setConfigurationTracker:v144];
          [v157 add:v164 withMessage:0];
        }

        v161 = [v160 countByEnumeratingWithState:&v248 objects:v292 count:16];
      }

      while (v161);
    }

    v165 = [v231 arrayByAddingObjectsFromArray:v234];
    v166 = [v165 arrayByAddingObjectsFromArray:v238];

    v246 = 0u;
    v247 = 0u;
    v244 = 0u;
    v245 = 0u;
    v167 = v166;
    v168 = [v167 countByEnumeratingWithState:&v244 objects:v291 count:16];
    if (v168)
    {
      v169 = *v245;
      do
      {
        for (ii = 0; ii != v168; ++ii)
        {
          if (*v245 != v169)
          {
            objc_enumerationMutation(v167);
          }

          v171 = *(*(&v244 + 1) + 8 * ii);
          [v171 setConfigurationTracker:v144];
          [v157 add:v171 withMessage:0];
        }

        v168 = [v167 countByEnumeratingWithState:&v244 objects:v291 count:16];
      }

      while (v168);
    }

    objc_initWeak(buf, vala);
    v239[0] = MEMORY[0x277D85DD0];
    v239[1] = 3221225472;
    v239[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke;
    v239[3] = &unk_278681F48;
    objc_copyWeak(&v243, buf);
    v240 = v224;
    v172 = v144;
    v241 = v172;
    v173 = array3;
    v242 = v173;
    [v157 run:v239];

    objc_destroyWeak(&v243);
    objc_destroyWeak(buf);

    goto LABEL_147;
  }

LABEL_148:

  v174 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke(uint64_t a1)
{
  v54 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v29 = a1;
    v3 = [*(a1 + 32) accessories];
    v31 = WeakRetained;
    v30 = [WeakRetained accessories];
    v4 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v47 = 0u;
    v48 = 0u;
    v49 = 0u;
    v50 = 0u;
    obj = v3;
    v32 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
    if (v32)
    {
      v28 = *v48;
      do
      {
        v5 = 0;
        do
        {
          if (*v48 != v28)
          {
            objc_enumerationMutation(obj);
          }

          v6 = *(*(&v47 + 1) + 8 * v5);
          v43 = 0u;
          v44 = 0u;
          v45 = 0u;
          v46 = 0u;
          v7 = v30;
          v8 = [v7 countByEnumeratingWithState:&v43 objects:v52 count:16];
          if (v8)
          {
            v9 = v8;
            v10 = *v44;
            do
            {
              v11 = 0;
              do
              {
                if (*v44 != v10)
                {
                  objc_enumerationMutation(v7);
                }

                v12 = *(*(&v43 + 1) + 8 * v11);
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v13 = v12;
                }

                else
                {
                  v13 = 0;
                }

                v14 = v13;

                if (v14 && [v14 matchesHAPAccessory:v6])
                {
                  [v4 setObject:v6 forKey:v14];
                }

                ++v11;
              }

              while (v9 != v11);
              v9 = [v7 countByEnumeratingWithState:&v43 objects:v52 count:16];
            }

            while (v9);
          }

          ++v5;
        }

        while (v5 != v32);
        v32 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
      }

      while (v32);
    }

    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v15 = v4;
    v16 = [v15 countByEnumeratingWithState:&v39 objects:v51 count:16];
    if (v16)
    {
      v17 = v16;
      v33 = *v40;
      do
      {
        v18 = 0;
        do
        {
          if (*v40 != v33)
          {
            objc_enumerationMutation(v15);
          }

          v19 = *(*(&v39 + 1) + 8 * v18);
          dispatch_group_enter(*(v29 + 40));
          v20 = [v15 objectForKey:v19];
          v21 = [v31 notificationRegistrations];
          v22 = [v21 count] != 0;
          v23 = [v31 workQueue];
          v37[0] = MEMORY[0x277D85DD0];
          v37[1] = 3221225472;
          v37[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_2;
          v37[3] = &unk_27868A010;
          v37[4] = v19;
          v37[5] = v31;
          v38 = *(v29 + 40);
          [v19 configureWithAccessory:v20 homeNotificationsEnabled:v22 queue:v23 completion:v37];

          ++v18;
        }

        while (v17 != v18);
        v17 = [v15 countByEnumeratingWithState:&v39 objects:v51 count:16];
      }

      while (v17);
    }

    v24 = *(v29 + 40);
    WeakRetained = v31;
    v25 = [v31 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_3;
    block[3] = &unk_27868A010;
    block[4] = v31;
    v35 = *(v29 + 32);
    v36 = *(v29 + 48);
    dispatch_group_notify(v24, v25, block);
  }

  v26 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_2(uint64_t a1)
{
  logAndPostNotification(@"HMDAccessoryConnectedNotification", *(a1 + 32), 0);
  [*(a1 + 32) updateLightProfilesSettings];
  v2 = [*(a1 + 40) homeManager];
  v3 = [v2 hasLoadedData];

  if (v3)
  {
    [*(a1 + 40) _auditActionSetsAndTriggersForAccessory:*(a1 + 32)];
  }

  v4 = *(a1 + 48);

  dispatch_group_leave(v4);
}

uint64_t __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_3(uint64_t a1)
{
  v1 = a1;
  v46 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) identifier];
  v4 = [v1[5] linkType];
  v38[0] = MEMORY[0x277D85DD0];
  v38[1] = 3221225472;
  v38[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_4;
  v38[3] = &unk_278682958;
  v38[4] = v1[4];
  [v2 _notifyRetrievalError:0 accessoryServer:v3 linkType:v4 accessoryOperationBlock:v38];

  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = v1[6];
  v5 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
  if (v5)
  {
    v7 = v5;
    v8 = *v35;
    v9 = v32;
    *&v6 = 138543874;
    v27 = v6;
    v28 = *v35;
    do
    {
      v10 = 0;
      do
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v11 = v1[4];
        v12 = [*(*(&v34 + 1) + 8 * v10) uuid];
        v13 = [v11 accessoryWithUUID:v12];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if (v15)
        {
          v16 = objc_autoreleasePoolPush();
          v17 = v1[4];
          v18 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
          {
            v19 = HMFGetLogIdentifier();
            v20 = [v15 shortDescription];
            [v15 supportsTargetController];
            HMFBooleanToString();
            v30 = v16;
            v21 = v7;
            v22 = v1;
            v24 = v23 = v9;
            *buf = v27;
            v40 = v19;
            v41 = 2112;
            v42 = v20;
            v43 = 2112;
            v44 = v24;
            _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Bridged accessory %@ (supportsTargetController %@) being added to home", buf, 0x20u);

            v8 = v28;
            v9 = v23;
            v1 = v22;
            v7 = v21;
            v16 = v30;
          }

          objc_autoreleasePoolPop(v16);
          v31[0] = MEMORY[0x277D85DD0];
          v31[1] = 3221225472;
          v32[0] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_2053;
          v32[1] = &unk_27868A250;
          v33 = v15;
          [v33 readInitialRequiredCharacteristicsForAccessory:v31];
        }

        ++v10;
      }

      while (v7 != v10);
      v7 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
    }

    while (v7);
  }

  result = [v1[4] _evaluateShouldRelaunchAndSetRelaunch];
  v26 = *MEMORY[0x277D85DE8];
  return result;
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_4(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 isPrimary])
  {
    v4 = MEMORY[0x277D85DD0];
    v5 = 3221225472;
    v6 = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_5;
    v7 = &unk_27868A1D8;
    v8 = *(a1 + 32);
    v9 = v3;
    [v9 maybeCommissionToThreadNetworkWithCompletion:&v4];
  }

  [v3 handleUpdatedServicesForThreadManagementWithCompletion:{0, v4, v5, v6, v7, v8}];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_5(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) shortDescription];
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Commissioning finished for %@ with error: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
}

- (void)_processUpdatedProductDataForAccessory:(id)accessory hapAccessory:(id)hapAccessory transaction:(id)transaction
{
  v54 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  hapAccessoryCopy = hapAccessory;
  transactionCopy = transaction;
  productData = [accessoryCopy productData];
  v12 = [(HMDHome *)self _productDataFromHAPAccessory:hapAccessoryCopy];
  v13 = v12;
  if (productData)
  {
    if (v12)
    {
      if (([v12 isEqualToString:productData] & 1) == 0)
      {
        v14 = +[HMDVendorDataManager sharedVendorDataManager];
        v15 = [v14 vendorModelEntryForProductData:productData];

        if (v15)
        {
          productDataAlternates = [v15 productDataAlternates];
          v17 = [productDataAlternates containsObject:v13];

          v18 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v20 = HMFGetOSLogHandle();
          v21 = v20;
          if (v17)
          {
            if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
            {
              HMFGetLogIdentifier();
              v22 = v41 = v18;
              shortDescription = [accessoryCopy shortDescription];
              *buf = 138544130;
              v45 = v22;
              v46 = 2112;
              v47 = shortDescription;
              v48 = 2112;
              v49 = productData;
              v50 = 2112;
              v51 = v13;
              _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ has changed its product data to a value that is allowed, binding: %@ -> %@", buf, 0x2Au);

              v18 = v41;
            }

            objc_autoreleasePoolPop(v18);
            [transactionCopy setProductDataV2:v13];
            goto LABEL_22;
          }

          if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
          {
            v34 = HMFGetLogIdentifier();
            [accessoryCopy shortDescription];
            v38 = v43 = v18;
            *buf = 138544130;
            v45 = v34;
            v46 = 2112;
            v47 = v38;
            v48 = 2112;
            v49 = productData;
            v50 = 2112;
            v51 = v13;
            _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has changed its productData to a value that is not allowed, keeping previous product data: %@ -> %@", buf, 0x2Au);

            v18 = v43;
            goto LABEL_20;
          }
        }

        else
        {
          v18 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v21 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            shortDescription2 = [accessoryCopy shortDescription];
            [accessoryCopy manufacturer];
            v36 = v40 = selfCopy2;
            [accessoryCopy model];
            v37 = v42 = v18;
            *buf = 138544386;
            v45 = v34;
            v46 = 2112;
            v47 = shortDescription2;
            v48 = 2112;
            v49 = v36;
            v50 = 2112;
            v51 = v37;
            v52 = 2112;
            v53 = productData;
            _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ could not be found in the VIDB, keeping previous product data (manufacturer: '%@', model: '%@', productData: '%@')", buf, 0x34u);

            v18 = v42;
            selfCopy2 = v40;

            v15 = 0;
LABEL_20:
          }
        }

        objc_autoreleasePoolPop(v18);
LABEL_22:
      }
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        shortDescription3 = [accessoryCopy shortDescription];
        *buf = 138543874;
        v45 = v32;
        v46 = 2112;
        v47 = shortDescription3;
        v48 = 2112;
        v49 = productData;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ is no longer advertising product data, keeping previous product data %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
    }
  }

  else if (v12)
  {
    v24 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
    {
      v27 = HMFGetLogIdentifier();
      shortDescription4 = [accessoryCopy shortDescription];
      *buf = 138543874;
      v45 = v27;
      v46 = 2112;
      v47 = shortDescription4;
      v48 = 2112;
      v49 = v13;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ is now bound to product data %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v24);
    [transactionCopy setProductDataV2:v13];
    [transactionCopy setProductData:v13];
  }

  v39 = *MEMORY[0x277D85DE8];
}

- (void)_processProductDataForNewlyAddedAccessory:(id)accessory transaction:(id)transaction
{
  v21 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  transactionCopy = transaction;
  v8 = [(HMDHome *)self _productDataFromHAPAccessory:accessoryCopy];
  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      shortDescription = [accessoryCopy shortDescription];
      v15 = 138543874;
      v16 = v12;
      v17 = 2112;
      v18 = shortDescription;
      v19 = 2112;
      v20 = v8;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ is now bound to productData %@", &v15, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [transactionCopy setProductDataV2:v8];
    [transactionCopy setProductData:v8];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)_productDataFromHAPAccessory:(id)accessory
{
  v61 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  server = [accessoryCopy server];
  productData = [server productData];

  if (productData)
  {
    productData2 = [server productData];
    v8 = [HMDAccessory validateProductData:productData2];

    if (v8)
    {
      productData3 = [accessoryCopy productData];
      if (productData3)
      {
        v10 = productData3;
        productData4 = [server productData];
        productData5 = [accessoryCopy productData];
        v13 = [productData4 isEqualToString:productData5];

        if ((v13 & 1) == 0)
        {
          v14 = objc_autoreleasePoolPush();
          selfCopy = self;
          v16 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            v17 = HMFGetLogIdentifier();
            shortDescription = [accessoryCopy shortDescription];
            productData6 = [server productData];
            productData7 = [accessoryCopy productData];
            v53 = 138544130;
            v54 = v17;
            v55 = 2112;
            v56 = shortDescription;
            v57 = 2112;
            v58 = productData6;
            v59 = 2112;
            v60 = productData7;
            _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ is using productData from pair setup that differs from productData published on AIS: %@ != %@", &v53, 0x2Au);
          }

          objc_autoreleasePoolPop(v14);
        }
      }

      v21 = server;
      goto LABEL_15;
    }

    v22 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      shortDescription2 = [accessoryCopy shortDescription];
      productData8 = [server productData];
      v53 = 138543874;
      v54 = v25;
      v55 = 2112;
      v56 = shortDescription2;
      v57 = 2112;
      v58 = productData8;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has invalid productData from pair setup: %@", &v53, 0x20u);
    }

    objc_autoreleasePoolPop(v22);
  }

  productData9 = [accessoryCopy productData];

  if (productData9)
  {
    productData10 = [accessoryCopy productData];
    v30 = [HMDAccessory validateProductData:productData10];

    if (v30)
    {
      v21 = accessoryCopy;
LABEL_15:
      productData11 = [v21 productData];
      goto LABEL_29;
    }

    v32 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      shortDescription3 = [accessoryCopy shortDescription];
      productData12 = [accessoryCopy productData];
      v53 = 138543874;
      v54 = v35;
      v55 = 2112;
      v56 = shortDescription3;
      v57 = 2112;
      v58 = productData12;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has invalid productData published on AIS: %@", &v53, 0x20u);
    }

    objc_autoreleasePoolPop(v32);
  }

  v38 = +[HMDVendorDataManager sharedVendorDataManager];
  manufacturer = [accessoryCopy manufacturer];
  model = [accessoryCopy model];
  v41 = [v38 vendorModelEntryForManufacturer:manufacturer model:model];

  if (!v41)
  {
    v43 = objc_autoreleasePoolPush();
    selfCopy5 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      shortDescription4 = [accessoryCopy shortDescription];
      manufacturer2 = [accessoryCopy manufacturer];
      model2 = [accessoryCopy model];
      v53 = 138544130;
      v54 = v46;
      v55 = 2112;
      v56 = shortDescription4;
      v57 = 2112;
      v58 = manufacturer2;
      v59 = 2112;
      v60 = model2;
      v50 = "%{public}@Accessory %@ could not be found in the VIDB (manufacturer: '%@', model: '%@')";
LABEL_26:
      _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_ERROR, v50, &v53, 0x2Au);
    }

LABEL_27:

    objc_autoreleasePoolPop(v43);
    productData11 = 0;
    goto LABEL_28;
  }

  productData13 = [v41 productData];

  if (!productData13)
  {
    v43 = objc_autoreleasePoolPush();
    selfCopy5 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      shortDescription4 = [accessoryCopy shortDescription];
      manufacturer2 = [accessoryCopy manufacturer];
      model2 = [accessoryCopy model];
      v53 = 138544130;
      v54 = v46;
      v55 = 2112;
      v56 = shortDescription4;
      v57 = 2112;
      v58 = manufacturer2;
      v59 = 2112;
      v60 = model2;
      v50 = "%{public}@Accessory %@ does not have productData in the VIDB (manufacturer: '%@', model: '%@')";
      goto LABEL_26;
    }

    goto LABEL_27;
  }

  productData11 = [v41 productData];
LABEL_28:

LABEL_29:
  v51 = *MEMORY[0x277D85DE8];

  return productData11;
}

- (void)filterServiceTransactions:(id)transactions removedServiceUUIDs:(id)ds
{
  v41 = *MEMORY[0x277D85DE8];
  transactionsCopy = transactions;
  dsCopy = ds;
  if (transactionsCopy && [transactionsCopy count] && objc_msgSend(dsCopy, "count"))
  {
    indexSet = [MEMORY[0x277CCAB58] indexSet];
    v30 = 0u;
    v31 = 0u;
    v32 = 0u;
    v33 = 0u;
    v26 = transactionsCopy;
    v9 = transactionsCopy;
    v10 = [v9 countByEnumeratingWithState:&v30 objects:v40 count:16];
    if (v10)
    {
      v11 = v10;
      v12 = *v31;
      v27 = *v31;
      v28 = v9;
      do
      {
        v13 = 0;
        v29 = v11;
        do
        {
          if (*v31 != v12)
          {
            objc_enumerationMutation(v9);
          }

          v14 = *(*(&v30 + 1) + 8 * v13);
          uuid = [v14 uuid];
          v16 = [dsCopy containsObject:uuid];

          if (v16)
          {
            [indexSet addIndex:{objc_msgSend(v9, "indexOfObject:", v14)}];
            v17 = objc_autoreleasePoolPush();
            selfCopy = self;
            v19 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
            {
              v20 = HMFGetLogIdentifier();
              [v14 uuid];
              v21 = indexSet;
              selfCopy2 = self;
              v24 = v23 = dsCopy;
              *buf = 138543874;
              v35 = v20;
              v36 = 2114;
              v37 = v24;
              v38 = 2114;
              v39 = v14;
              _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@[Pair-Verify %{public}@] Removing duplicate service transaction %{public}@", buf, 0x20u);

              dsCopy = v23;
              self = selfCopy2;
              indexSet = v21;
              v9 = v28;

              v12 = v27;
            }

            objc_autoreleasePoolPop(v17);
            v11 = v29;
          }

          ++v13;
        }

        while (v11 != v13);
        v11 = [v9 countByEnumeratingWithState:&v30 objects:v40 count:16];
      }

      while (v11);
    }

    [v9 removeObjectsAtIndexes:indexSet];
    transactionsCopy = v26;
  }

  v25 = *MEMORY[0x277D85DE8];
}

- (BOOL)getUpdateTransactionForAccessory:(id)accessory hapAccessory:(id)hapAccessory accessoryTransaction:(id)transaction addSvcTransactions:(id *)transactions updateSvcTransactions:(id *)svcTransactions removeSvcTransactions:(id *)removeSvcTransactions
{
  v170 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  hapAccessoryCopy = hapAccessory;
  transactionCopy = transaction;
  services = [accessoryCopy services];
  v14 = [services mutableCopy];

  v155 = 0u;
  v156 = 0u;
  v153 = 0u;
  v154 = 0u;
  v116 = hapAccessoryCopy;
  services2 = [hapAccessoryCopy services];
  v16 = [services2 countByEnumeratingWithState:&v153 objects:v169 count:16];
  v126 = accessoryCopy;
  v122 = transactionCopy;
  if (!v16)
  {
    goto LABEL_65;
  }

  v17 = v16;
  v18 = *v154;
  parentUUID2 = 138544130;
  v121 = services2;
  v123 = *v154;
  while (2)
  {
    v19 = 0;
    v124 = v17;
    do
    {
      v127 = v14;
      if (*v154 != v18)
      {
        objc_enumerationMutation(services2);
      }

      v125 = v19;
      v20 = *(*(&v153 + 1) + 8 * v19);
      dataSource = [(HMDHome *)self dataSource];
      hapMetadata = [dataSource hapMetadata];
      type = [v20 type];
      v24 = [hapMetadata shouldFilterServiceOfType:type];

      if (v24)
      {
        v14 = v127;
        goto LABEL_63;
      }

      v151 = 0u;
      v152 = 0u;
      v149 = 0u;
      v150 = 0u;
      services3 = [accessoryCopy services];
      v26 = [services3 countByEnumeratingWithState:&v149 objects:v168 count:16];
      if (v26)
      {
        v27 = v26;
        v28 = *v150;
        while (2)
        {
          for (i = 0; i != v27; ++i)
          {
            if (*v150 != v28)
            {
              objc_enumerationMutation(services3);
            }

            v30 = *(*(&v149 + 1) + 8 * i);
            instanceID = [v30 instanceID];
            instanceID2 = [v20 instanceID];
            v33 = [instanceID isEqual:instanceID2];

            if (v33)
            {
              v34 = v30;
              goto LABEL_18;
            }
          }

          v27 = [services3 countByEnumeratingWithState:&v149 objects:v168 count:16];
          if (v27)
          {
            continue;
          }

          break;
        }

        v34 = 0;
LABEL_18:
        services2 = v121;
        transactionCopy = v122;
      }

      else
      {
        v34 = 0;
      }

      uuid = [transactionCopy uuid];
      if (v34)
      {
        v36 = 2;
      }

      else
      {
        v36 = 1;
      }

      v37 = [(HMDHome *)self getServiceTransaction:v20 parentUUID:uuid changeType:v36];

      type2 = [(HMDServiceTransaction *)v34 type];
      if (type2)
      {
        v39 = type2;
        type3 = [(HMDServiceTransaction *)v34 type];
        serviceType = [(HMDServiceTransaction *)v37 serviceType];
        v42 = [type3 isEqualToString:serviceType];

        if ((v42 & 1) == 0)
        {

          v111 = 0;
          v94 = v127;
          goto LABEL_82;
        }
      }

      [(HMDHome *)self __updateServiceTransaction:v37 accessoryTransaction:transactionCopy service:v34 accessory:accessoryCopy hapService:v20];
      accessory = [(HMDServiceTransaction *)v34 accessory];
      shortDescription = [accessory shortDescription];
      v45 = shortDescription;
      v46 = v37;
      if (shortDescription)
      {
        uUIDString = shortDescription;
      }

      else
      {
        parentUUID = [(HMDBackingStoreModelObject *)v37 parentUUID];
        uUIDString = [parentUUID UUIDString];
      }

      if (!v34)
      {
        goto LABEL_59;
      }

      uuid2 = [(HMDBackingStoreModelObject *)v34 uuid];
      uuid3 = [(HMDBackingStoreModelObject *)v37 uuid];
      v50 = [uuid2 isEqual:uuid3];

      if ((v50 & 1) == 0)
      {
        v84 = objc_autoreleasePoolPush();
        selfCopy = self;
        v86 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v86, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v88 = v87 = v37;
          uuid4 = [(HMDBackingStoreModelObject *)v37 uuid];
          *buf = 138544130;
          v161 = v88;
          v162 = 2114;
          v163 = uuid4;
          v164 = 2114;
          v165 = v34;
          v166 = 2114;
          v167 = v87;
          _os_log_impl(&dword_229538000, v86, OS_LOG_TYPE_ERROR, "%{public}@[Pair-Verify %{public}@] matched service %{public}@ doesn't match the service transaction: %{public}@. Removing it to re-add.", buf, 0x2Au);

          v46 = v87;
        }

        objc_autoreleasePoolPop(v84);
LABEL_59:
        v90 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v92 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v92, OS_LOG_TYPE_INFO))
        {
          v93 = HMFGetLogIdentifier();
          *buf = 138543874;
          v161 = v93;
          v162 = 2114;
          v163 = uUIDString;
          v164 = 2114;
          v165 = v46;
          _os_log_impl(&dword_229538000, v92, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Adding service %{public}@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v90);
        [*transactions addObject:v46];
        v14 = v127;
        goto LABEL_62;
      }

      v51 = [(HMDServiceTransaction *)v34 modelObjectWithChangeType:1];
      v148 = 0;
      v131 = v51;
      [v51 diff:v37 differingFields:&v148];
      v52 = v148;
      v119 = v52;
      v132 = v37;
      if (svcTransactions)
      {
        v53 = v52;
        if ([(HMDServiceTransaction *)v52 count])
        {
          v117 = v34;
          v54 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v56 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
          {
            v57 = HMFGetLogIdentifier();
            *buf = 138544130;
            v161 = v57;
            v162 = 2112;
            v163 = uUIDString;
            v164 = 2114;
            v165 = v46;
            v166 = 2114;
            v167 = v53;
            _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %@] Received service update %{public}@ due to diff %{public}@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v54);
          v146 = 0u;
          v147 = 0u;
          v144 = 0u;
          v145 = 0u;
          obj = v53;
          v58 = [(HMDServiceTransaction *)obj countByEnumeratingWithState:&v144 objects:v159 count:16];
          if (v58)
          {
            v59 = v58;
            v60 = *v145;
            do
            {
              for (j = 0; j != v59; ++j)
              {
                if (*v145 != v60)
                {
                  objc_enumerationMutation(obj);
                }

                v62 = *(*(&v144 + 1) + 8 * j);
                v63 = objc_autoreleasePoolPush();
                v64 = selfCopy3;
                v65 = selfCopy3;
                v66 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
                {
                  v67 = HMFGetLogIdentifier();
                  v68 = [v131 valueForKeyPath:v62];
                  *buf = 138544130;
                  v161 = v67;
                  v162 = 2114;
                  v163 = uUIDString;
                  v164 = 2114;
                  v165 = v62;
                  v166 = 2114;
                  v167 = v68;
                  _os_log_impl(&dword_229538000, v66, OS_LOG_TYPE_INFO, "%{public}@[%{public}@] LOCAL %{public}@: %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v63);
                v69 = objc_autoreleasePoolPush();
                v70 = v65;
                v71 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v71, OS_LOG_TYPE_INFO))
                {
                  v72 = HMFGetLogIdentifier();
                  v73 = [(HMDServiceTransaction *)v132 valueForKeyPath:v62];
                  *buf = 138544130;
                  v161 = v72;
                  v162 = 2114;
                  v163 = uUIDString;
                  v164 = 2114;
                  v165 = v62;
                  v166 = 2114;
                  v167 = v73;
                  _os_log_impl(&dword_229538000, v71, OS_LOG_TYPE_INFO, "%{public}@[%{public}@] UPDATE %{public}@: %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v69);
                selfCopy3 = v64;
              }

              v59 = [(HMDServiceTransaction *)obj countByEnumeratingWithState:&v144 objects:v159 count:16];
            }

            while (v59);
          }

          [*svcTransactions addObject:v132];
          v34 = v117;
        }
      }

      v74 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v127, "count")}];
      v140 = 0u;
      v141 = 0u;
      v142 = 0u;
      v143 = 0u;
      v75 = v127;
      v76 = [v75 countByEnumeratingWithState:&v140 objects:v158 count:16];
      if (v76)
      {
        v77 = v76;
        v78 = *v141;
        do
        {
          for (k = 0; k != v77; ++k)
          {
            if (*v141 != v78)
            {
              objc_enumerationMutation(v75);
            }

            v80 = *(*(&v140 + 1) + 8 * k);
            uuid5 = [v80 uuid];
            uuid6 = [(HMDBackingStoreModelObject *)v34 uuid];
            v83 = [uuid5 isEqual:uuid6];

            if ((v83 & 1) == 0)
            {
              [v74 addObject:v80];
            }
          }

          v77 = [v75 countByEnumeratingWithState:&v140 objects:v158 count:16];
        }

        while (v77);
      }

      uUIDString = v132;
      v46 = v34;
      v14 = v74;
      accessoryCopy = v126;
      services2 = v121;
      transactionCopy = v122;
LABEL_62:
      v18 = v123;
      v17 = v124;

LABEL_63:
      v19 = v125 + 1;
    }

    while (v125 + 1 != v17);
    v17 = [services2 countByEnumeratingWithState:&v153 objects:v169 count:16];
    if (v17)
    {
      continue;
    }

    break;
  }

LABEL_65:

  v138 = 0u;
  v139 = 0u;
  v136 = 0u;
  v137 = 0u;
  v94 = v14;
  v95 = [v94 countByEnumeratingWithState:&v136 objects:v157 count:16];
  if (v95)
  {
    v96 = v95;
    v128 = v94;
    v97 = *v137;
    do
    {
      for (m = 0; m != v96; ++m)
      {
        if (*v137 != v97)
        {
          objc_enumerationMutation(v128);
        }

        v99 = *(*(&v136 + 1) + 8 * m);
        v100 = [HMDServiceTransaction alloc];
        uuid7 = [v99 uuid];
        uuid8 = [accessoryCopy uuid];
        v103 = [(HMDBackingStoreModelObject *)v100 initWithObjectChangeType:3 uuid:uuid7 parentUUID:uuid8];

        v104 = objc_autoreleasePoolPush();
        selfCopy4 = self;
        v106 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v106, OS_LOG_TYPE_INFO))
        {
          v107 = HMFGetLogIdentifier();
          accessory2 = [v99 accessory];
          shortDescription2 = [accessory2 shortDescription];
          v110 = shortDescription2;
          if (!shortDescription2)
          {
            parentUUID2 = [(HMDBackingStoreModelObject *)v103 parentUUID];
            v110 = parentUUID2;
          }

          *buf = 138543874;
          v161 = v107;
          v162 = 2114;
          v163 = v110;
          v164 = 2114;
          v165 = v103;
          _os_log_impl(&dword_229538000, v106, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Removing service %{public}@", buf, 0x20u);
          if (!shortDescription2)
          {
          }

          accessoryCopy = v126;
        }

        objc_autoreleasePoolPop(v104);
        [*removeSvcTransactions addObject:v103];
      }

      v96 = [v128 countByEnumeratingWithState:&v136 objects:v157 count:16];
    }

    while (v96);
    v94 = v128;

    transactionCopy = v122;
    goto LABEL_81;
  }

  if (removeSvcTransactions)
  {
LABEL_81:
    v112 = MEMORY[0x277CBEB98];
    v113 = [*removeSvcTransactions na_map:&__block_literal_global_2041];
    services2 = [v112 setWithArray:v113];

    [(HMDHome *)self filterServiceTransactions:*transactions removedServiceUUIDs:services2];
    [(HMDHome *)self filterServiceTransactions:*svcTransactions removedServiceUUIDs:services2];
    v111 = 1;
LABEL_82:
  }

  else
  {
    v111 = 1;
  }

  v114 = *MEMORY[0x277D85DE8];
  return v111;
}

- (void)__updateServiceTransaction:(id)transaction accessoryTransaction:(id)accessoryTransaction service:(id)service accessory:(id)accessory hapService:(id)hapService
{
  v99 = *MEMORY[0x277D85DE8];
  transactionCopy = transaction;
  accessoryTransactionCopy = accessoryTransaction;
  serviceCopy = service;
  accessoryCopy = accessory;
  hapServiceCopy = hapService;
  v14 = MEMORY[0x277CBEB18];
  v69 = hapServiceCopy;
  characteristics = [hapServiceCopy characteristics];
  v16 = [v14 arrayWithArray:characteristics];

  if ([v16 count])
  {
    v17 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v16, "count")}];
    v91 = 0u;
    v92 = 0u;
    v93 = 0u;
    v94 = 0u;
    v67 = v16;
    obj = v16;
    v18 = [obj countByEnumeratingWithState:&v91 objects:v98 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = 0x277CBE000uLL;
      v77 = *MEMORY[0x277CD2138];
      v76 = *MEMORY[0x277CD21A8];
      v82 = *MEMORY[0x277CD2190];
      v83 = *v92;
      v75 = *MEMORY[0x277CD2148];
      v68 = serviceCopy;
      v78 = v17;
      selfCopy = self;
      do
      {
        v21 = 0;
        v80 = v19;
        do
        {
          if (*v92 != v83)
          {
            objc_enumerationMutation(obj);
          }

          v84 = v21;
          v22 = *(*(&v91 + 1) + 8 * v21);
          dataSource = [(HMDHome *)self dataSource];
          hapMetadata = [dataSource hapMetadata];
          type = [v22 type];
          v26 = [hapMetadata shouldFilterCharacteristicOfType:type];

          if ((v26 & 1) == 0)
          {
            metadata = [v22 metadata];
            v28 = [*(v20 + 2872) dictionaryWithCapacity:8];
            format = [metadata format];
            [v28 setObject:format forKeyedSubscript:@"metadataFormat"];

            units = [metadata units];
            [v28 setObject:units forKeyedSubscript:@"metadataUnits"];

            manufacturerDescription = [metadata manufacturerDescription];
            [v28 setObject:manufacturerDescription forKeyedSubscript:@"metadataUserDescription"];

            constraints = [metadata constraints];

            if (constraints)
            {
              constraints2 = [metadata constraints];
              minimumValue = [constraints2 minimumValue];
              [v28 setObject:minimumValue forKeyedSubscript:@"metadataMinimumValue"];

              constraints3 = [metadata constraints];
              maximumValue = [constraints3 maximumValue];
              [v28 setObject:maximumValue forKeyedSubscript:@"metadataMaximumValue"];

              constraints4 = [metadata constraints];
              stepValue = [constraints4 stepValue];
              [v28 setObject:stepValue forKeyedSubscript:@"metadataStepValue"];

              constraints5 = [metadata constraints];
              maxLength = [constraints5 maxLength];
              [v28 setObject:maxLength forKeyedSubscript:@"metadataMaxLength"];

              constraints6 = [metadata constraints];
              validValues = [constraints6 validValues];
              [v28 setObject:validValues forKeyedSubscript:@"metadataValidValues"];
            }

            v43 = *(v20 + 2872);
            v96[0] = v77;
            instanceID = [v22 instanceID];
            v97[0] = instanceID;
            v96[1] = v76;
            type2 = [v22 type];
            v97[1] = type2;
            v96[2] = v82;
            v46 = [MEMORY[0x277CCABB0] numberWithUnsignedShort:{objc_msgSend(v22, "properties")}];
            v96[3] = v75;
            v97[2] = v46;
            v97[3] = v28;
            v47 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v97 forKeys:v96 count:4];
            v48 = [v43 dictionaryWithDictionary:v47];

            if (serviceCopy)
            {
              v89 = 0u;
              v90 = 0u;
              v87 = 0u;
              v88 = 0u;
              characteristics2 = [serviceCopy characteristics];
              v50 = [characteristics2 countByEnumeratingWithState:&v87 objects:v95 count:16];
              if (v50)
              {
                v72 = v48;
                v73 = metadata;
                v51 = *v88;
LABEL_13:
                v52 = 0;
                while (1)
                {
                  if (*v88 != v51)
                  {
                    objc_enumerationMutation(characteristics2);
                  }

                  v53 = *(*(&v87 + 1) + 8 * v52);
                  instanceID2 = [v53 instanceID];
                  instanceID3 = [v22 instanceID];
                  v56 = [instanceID2 isEqual:instanceID3];

                  if (v56)
                  {
                    break;
                  }

                  if (v50 == ++v52)
                  {
                    v50 = [characteristics2 countByEnumeratingWithState:&v87 objects:v95 count:16];
                    if (v50)
                    {
                      goto LABEL_13;
                    }

                    serviceCopy = v68;
                    v48 = v72;
                    metadata = v73;
                    goto LABEL_23;
                  }
                }

                v50 = v53;

                if (!v50)
                {
                  serviceCopy = v68;
                  v48 = v72;
                  metadata = v73;
                  goto LABEL_25;
                }

                v57 = [accessoryCopy findServiceWithServiceType:@"00000701-0000-1000-8000-0026BB765291"];

                serviceCopy = v68;
                v48 = v72;
                metadata = v73;
                if (!v57)
                {
                  goto LABEL_25;
                }

                properties = [v22 properties];
                properties2 = [v50 properties];
                characteristics2 = [MEMORY[0x277CCABB0] numberWithUnsignedShort:properties2 & 0x80 | properties];
                [v72 setObject:characteristics2 forKeyedSubscript:v82];
              }

LABEL_23:

LABEL_25:
            }

            v17 = v78;
            [v78 addObject:v48];
            value = [v22 value];

            if (value)
            {
              aBlock[0] = MEMORY[0x277D85DD0];
              aBlock[1] = 3221225472;
              aBlock[2] = __88__HMDHome___updateServiceTransaction_accessoryTransaction_service_accessory_hapService___block_invoke;
              aBlock[3] = &unk_278678710;
              v86 = transactionCopy;
              v61 = _Block_copy(aBlock);
              type3 = [v22 type];
              value2 = [v22 value];
              type4 = [v69 type];
              [HMDService processUpdateForCharacteristicType:type3 value:value2 serviceType:type4 service:serviceCopy serviceTransactionGetter:v61 accessory:accessoryCopy accessoryTransaction:accessoryTransactionCopy accessoryTransactionChanged:0];
            }

            self = selfCopy;
            v19 = v80;
            v20 = 0x277CBE000;
          }

          v21 = v84 + 1;
        }

        while (v84 + 1 != v19);
        v19 = [obj countByEnumeratingWithState:&v91 objects:v98 count:16];
      }

      while (v19);
    }

    v16 = v67;
  }

  else
  {
    v17 = 0;
  }

  v65 = +[HMDCharacteristic sortComparatorForCharacteristicDictionary];
  [v17 sortUsingComparator:v65];

  [transactionCopy setCharacteristics:v17];
  v66 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didFinishPairingForAccessoryServer:(id)server
{
  v53 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  primaryResident = [(HMDHome *)self primaryResident];
  v8 = primaryResident;
  if (primaryResident && ([primaryResident device], v9 = objc_claimAutoreleasedReturnValue(), v9, v9))
  {
    v10 = objc_alloc(MEMORY[0x277D0F820]);
    uuid = [(HMDHome *)self uuid];
    v42 = [v10 initWithTarget:uuid];

    v12 = serverCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v13 = v12;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    dictionary = [MEMORY[0x277CBEB38] dictionary];
    nodeID = [v14 nodeID];
    [dictionary setObject:nodeID forKeyedSubscript:@"HMDHomePairingCompletionNodeIDMessageKey"];

    fabricID = [v14 fabricID];
    [dictionary setObject:fabricID forKeyedSubscript:@"HMDHomePairingCompletionFabricIDMessageKey"];

    fabricID2 = [v14 fabricID];
    [dictionary setObject:fabricID2 forKeyedSubscript:@"HMDHomePairingCompletionFabricIndexMessageKey"];

    vendorID = [v14 vendorID];
    [dictionary setObject:vendorID forKeyedSubscript:@"HMDHomePairingCompletionVendorIDMessageKey"];

    productID = [v14 productID];
    [dictionary setObject:productID forKeyedSubscript:@"HMDHomePairingCompletionProductIDMessageKey"];

    v21 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v14, "configNumber")}];
    [dictionary setObject:v21 forKeyedSubscript:@"HMDHomePairingCompletionConfigNumberMessageKey"];

    category = [v14 category];
    [dictionary setObject:category forKeyedSubscript:@"HMDHomePairingCompletionCategoryMessageKey"];

    topology = [v14 topology];
    [dictionary setObject:topology forKeyedSubscript:@"HMDHomePairingCompletionTopologyMessageKey"];

    v24 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeNotificationPairingCompletionMessage" destination:v42 payload:dictionary];
    objc_initWeak(&location, self);
    v45[0] = MEMORY[0x277D85DD0];
    v45[1] = 3221225472;
    v45[2] = __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke;
    v45[3] = &unk_278687F40;
    objc_copyWeak(&v47, &location);
    v46 = v12;
    [v24 setResponseHandler:v45];
    v25 = objc_autoreleasePoolPush();
    selfCopy = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
    {
      v28 = HMFGetLogIdentifier();
      shortDescription = [v24 shortDescription];
      *buf = 138543618;
      v50 = v28;
      v51 = 2112;
      v52 = shortDescription;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Sending message %@ to notify pairing completion", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v25);
    primaryResidentMessageRouter = [(HMDHome *)selfCopy primaryResidentMessageRouter];
    v31 = primaryResidentMessageRouter;
    if (primaryResidentMessageRouter)
    {
      v44[0] = MEMORY[0x277D85DD0];
      v44[1] = 3221225472;
      v44[2] = __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke_2037;
      v44[3] = &unk_27868A398;
      v44[4] = selfCopy;
      [primaryResidentMessageRouter routeMessage:v24 localHandler:v44];
    }

    else
    {
      v36 = objc_autoreleasePoolPush();
      v37 = selfCopy;
      v38 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        v39 = HMFGetLogIdentifier();
        *buf = 138543362;
        v50 = v39;
        _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to send HMDHomeNotificationPairingCompletionMessage", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v36);
      v40 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v24 respondWithError:v40];
    }

    objc_destroyWeak(&v47);
    objc_destroyWeak(&location);
  }

  else
  {
    v32 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      *buf = 138543362;
      v50 = v35;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not available", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v32);
  }

  v41 = *MEMORY[0x277D85DE8];
}

void __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = v10;
    if (v5)
    {
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        v20 = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = v5;
        v14 = "%{public}@Failed to notify pairing completion for accessory server %@ to the primary resident with error %@";
        v15 = v11;
        v16 = OS_LOG_TYPE_ERROR;
        v17 = 32;
LABEL_7:
        _os_log_impl(&dword_229538000, v15, v16, v14, &v20, v17);
      }
    }

    else if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v18 = *(a1 + 32);
      v20 = 138543618;
      v21 = v12;
      v22 = 2112;
      v23 = v18;
      v14 = "%{public}@Successfully notified the primary resident of pairing completion for accessory server %@";
      v15 = v11;
      v16 = OS_LOG_TYPE_INFO;
      v17 = 22;
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v19 = *MEMORY[0x277D85DE8];
}

uint64_t __89__HMDHome_accessoryBrowser_didUpdateReachability_forBTLEAccessoriesWithServerIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 identifier];
  v4 = [v3 isEqualToString:*(a1 + 32)];

  return v4;
}

id __89__HMDHome_accessoryBrowser_didUpdateReachability_forBTLEAccessoriesWithServerIdentifier___block_invoke_2033(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 hasBTLELink])
  {
    v3 = [v2 identifier];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateCategory:(id)category
{
  v25 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  categoryCopy = category;
  identifier = [serverCopy identifier];
  v12 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  if (v12)
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      shortDescription = [v12 shortDescription];
      v19 = 138543874;
      v20 = v16;
      v21 = 2112;
      v22 = shortDescription;
      v23 = 2112;
      v24 = categoryCopy;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Paired Accessory: %@, Updated Category to %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    [v12 updateCategory:categoryCopy];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateHasPairings:(BOOL)pairings
{
  pairingsCopy = pairings;
  v25 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  identifier = [serverCopy identifier];
  v11 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  if (v11)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      identifier2 = [serverCopy identifier];
      v19 = 138543874;
      v20 = v15;
      v21 = 2112;
      v22 = identifier2;
      v23 = 1024;
      v24 = pairingsCopy;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Updating accessory server %@ with new value of hasPairings: %d", &v19, 0x1Cu);
    }

    objc_autoreleasePoolPop(v12);
    if ([serverCopy isPaired] == pairingsCopy)
    {
      accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
      [accessoryBrowser resurrectAccessoryServer:serverCopy];
    }

    else
    {
      [(HMDHome *)selfCopy _unconfigurePairedAccessoriesForServer:serverCopy updateReachability:1];
      accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
      [accessoryBrowser tombstoneAccessoryServer:serverCopy];
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isSecureClassTriggeredByCharacteristics:(id)characteristics
{
  v70 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  v5 = MEMORY[0x277CBEB18];
  triggers = [(HMDHome *)self triggers];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(triggers, "count")}];

  v58 = 0u;
  v59 = 0u;
  v56 = 0u;
  v57 = 0u;
  selfCopy = self;
  obj = [(HMDHome *)self triggers];
  v41 = [obj countByEnumeratingWithState:&v56 objects:v69 count:16];
  if (v41)
  {
    v40 = *v57;
    do
    {
      for (i = 0; i != v41; ++i)
      {
        if (*v57 != v40)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v56 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v54 = 0u;
        v55 = 0u;
        v52 = 0u;
        v53 = 0u;
        v42 = v11;
        characteristicBaseEvents = [v11 characteristicBaseEvents];
        v13 = [characteristicBaseEvents countByEnumeratingWithState:&v52 objects:v68 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v53;
          do
          {
            for (j = 0; j != v14; ++j)
            {
              if (*v53 != v15)
              {
                objc_enumerationMutation(characteristicBaseEvents);
              }

              characteristic = [*(*(&v52 + 1) + 8 * j) characteristic];
              v18 = [characteristicsCopy containsObject:characteristic];

              if (v18)
              {
                [v7 addObject:v9];
              }
            }

            v14 = [characteristicBaseEvents countByEnumeratingWithState:&v52 objects:v68 count:16];
          }

          while (v14);
        }
      }

      v41 = [obj countByEnumeratingWithState:&v56 objects:v69 count:16];
    }

    while (v41);
  }

  v50 = 0u;
  v51 = 0u;
  v48 = 0u;
  v49 = 0u;
  v19 = v7;
  v20 = [v19 countByEnumeratingWithState:&v48 objects:v67 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v49;
    v43 = *v49;
    do
    {
      for (k = 0; k != v21; ++k)
      {
        if (*v49 != v22)
        {
          objc_enumerationMutation(v19);
        }

        v24 = *(*(&v48 + 1) + 8 * k);
        v44 = 0u;
        v45 = 0u;
        v46 = 0u;
        v47 = 0u;
        actionSets = [v24 actionSets];
        v26 = [actionSets countByEnumeratingWithState:&v44 objects:v66 count:16];
        if (v26)
        {
          v27 = v26;
          v28 = *v45;
          while (2)
          {
            for (m = 0; m != v27; ++m)
            {
              if (*v45 != v28)
              {
                objc_enumerationMutation(actionSets);
              }

              v30 = *(*(&v44 + 1) + 8 * m);
              if ([v30 containsSecureCharacteristic])
              {
                v32 = objc_autoreleasePoolPush();
                v33 = selfCopy;
                v34 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v34, OS_LOG_TYPE_DEBUG))
                {
                  v35 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v61 = v35;
                  v62 = 2112;
                  v63 = v24;
                  v64 = 2112;
                  v65 = v30;
                  _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_DEBUG, "%{public}@Trigger %@ has action set %@ with security class", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v32);
                v31 = 1;
                goto LABEL_40;
              }
            }

            v27 = [actionSets countByEnumeratingWithState:&v44 objects:v66 count:16];
            if (v27)
            {
              continue;
            }

            break;
          }
        }

        v22 = v43;
      }

      v21 = [v19 countByEnumeratingWithState:&v48 objects:v67 count:16];
      v31 = 0;
    }

    while (v21);
  }

  else
  {
    v31 = 0;
  }

LABEL_40:

  v36 = *MEMORY[0x277D85DE8];
  return v31;
}

- (void)handleUpdatedCharacteristics:(id)characteristics accessoryServer:(id)server
{
  characteristicsCopy = characteristics;
  serverCopy = server;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_handleUpdatedCharacteristics_accessoryServer___block_invoke;
  block[3] = &unk_27868A010;
  block[4] = self;
  v12 = characteristicsCopy;
  v13 = serverCopy;
  v9 = serverCopy;
  v10 = characteristicsCopy;
  dispatch_async(workQueue, block);
}

- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateValuesForCharacteristics:(id)characteristics stateNumber:(id)number broadcast:(BOOL)broadcast
{
  serverCopy = server;
  characteristicsCopy = characteristics;
  numberCopy = number;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __100__HMDHome_accessoryBrowser_accessoryServer_didUpdateValuesForCharacteristics_stateNumber_broadcast___block_invoke;
  block[3] = &unk_2786899C8;
  block[4] = self;
  v19 = characteristicsCopy;
  v20 = serverCopy;
  v21 = numberCopy;
  broadcastCopy = broadcast;
  v15 = numberCopy;
  v16 = serverCopy;
  v17 = characteristicsCopy;
  dispatch_async(workQueue, block);
}

- (id)_changedHMDCharacteristicsForHAPCharacteristics:(id)characteristics stateNumber:(id)number broadcast:(BOOL)broadcast accessoryServer:(id)server
{
  broadcastCopy = broadcast;
  v182 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  numberCopy = number;
  serverCopy = server;
  strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v159 = 0u;
  v160 = 0u;
  v161 = 0u;
  v162 = 0u;
  obj = characteristicsCopy;
  selfCopy = self;
  v149 = [obj countByEnumeratingWithState:&v159 objects:v181 count:16];
  if (v149)
  {
    context = *v160;
    v141 = broadcastCopy;
    do
    {
      for (i = 0; i != v149; ++i)
      {
        if (*v160 != context)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v159 + 1) + 8 * i);
        service = [v12 service];
        accessory = [service accessory];
        dataSource = [(HMDHome *)self dataSource];
        hapMetadata = [dataSource hapMetadata];
        if (broadcastCopy)
        {
          type = [v12 type];
          v18 = [hapMetadata shouldFilterCharacteristicOfType:type];

          if (v18)
          {
            goto LABEL_16;
          }

          primaryAccessory = [serverCopy primaryAccessory];

          accessory = primaryAccessory;
        }

        else
        {
          type2 = [service type];
          v21 = [hapMetadata shouldFilterServiceOfType:type2];

          if (v21)
          {
            goto LABEL_16;
          }
        }

        v22 = [(HMDHome *)self hmdHAPAccessoryWithHAPAccessory:accessory];
        instanceID = [v12 instanceID];
        v24 = [v22 hmdCharacteristicForInstanceId:instanceID];

        if (v24)
        {
          [strongToStrongObjectsMapTable setObject:v24 forKey:v12];
        }

        else
        {
          v25 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v27 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
          {
            HMFGetLogIdentifier();
            v28 = v132 = selfCopy2;
            [serverCopy identifier];
            v29 = loga = v27;
            instanceID2 = [service instanceID];
            [v12 instanceID];
            v31 = v135 = v25;
            type3 = [v12 type];
            *buf = 138544386;
            v165 = v28;
            v166 = 2112;
            v167 = v29;
            v168 = 2112;
            v169 = instanceID2;
            v170 = 2112;
            v171 = v31;
            v172 = 2112;
            v173 = type3;
            _os_log_impl(&dword_229538000, loga, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot map HAPCharacteristic %@/%@/%@/%@ to a HMDCharacteristic", buf, 0x34u);

            v25 = v135;
            v27 = loga;

            selfCopy2 = v132;
          }

          objc_autoreleasePoolPop(v25);
          self = selfCopy;
        }

        broadcastCopy = v141;
LABEL_16:
      }

      v149 = [obj countByEnumeratingWithState:&v159 objects:v181 count:16];
    }

    while (v149);
  }

  v136 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(obj, "count")}];
  v127 = [MEMORY[0x277CBEB58] set];
  v155 = 0u;
  v156 = 0u;
  v157 = 0u;
  v158 = 0u;
  keyEnumerator = [strongToStrongObjectsMapTable keyEnumerator];
  allObjects = [keyEnumerator allObjects];

  v133 = allObjects;
  v142 = [allObjects countByEnumeratingWithState:&v155 objects:v180 count:16];
  v36 = 0;
  if (!v142)
  {
    v37 = numberCopy;
    goto LABEL_71;
  }

  log = *v156;
  *&v35 = 138543618;
  v126 = v35;
  v37 = numberCopy;
  do
  {
    v38 = 0;
    do
    {
      if (*v156 != log)
      {
        objc_enumerationMutation(v133);
      }

      v39 = *(*(&v155 + 1) + 8 * v38);
      v40 = [strongToStrongObjectsMapTable objectForKey:{v39, v126}];
      stateNumber = [v40 stateNumber];
      v42 = HMFEqualObjects();

      if (v42)
      {
        v150 = v38;
        value = [v39 value];
        lastKnownValue = [v40 lastKnownValue];
        v45 = [HMDCharacteristic value:value differentThan:lastKnownValue];

        if (v37 && v45)
        {
          contexta = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v47 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
          {
            v129 = HMFGetLogIdentifier();
            type4 = [v40 type];
            instanceID3 = [v40 instanceID];
            lastKnownValue2 = [v40 lastKnownValue];
            stateNumber2 = [v40 stateNumber];
            value2 = [v39 value];
            identifier = [serverCopy identifier];
            *buf = 138545154;
            v165 = v129;
            v166 = 2112;
            v167 = type4;
            v168 = 2112;
            v169 = instanceID3;
            v54 = instanceID3;
            v170 = 2112;
            v171 = lastKnownValue2;
            v172 = 2112;
            v173 = stateNumber2;
            v174 = 2112;
            v175 = value2;
            v176 = 2112;
            v177 = numberCopy;
            v178 = 2112;
            v179 = identifier;
            _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value at same state number from %@/%@ to %@/%@ for accessory: %@", buf, 0x52u);

            self = selfCopy;
          }

          goto LABEL_32;
        }

        if ([v40 shouldUpdateValueFromHAPCharacteristic:v39] && (objc_msgSend(v39, "value"), v76 = objc_claimAutoreleasedReturnValue(), v76, v76))
        {
          v77 = objc_autoreleasePoolPush();
          selfCopy4 = self;
          v79 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v79, OS_LOG_TYPE_DEFAULT))
          {
            v80 = HMFGetLogIdentifier();
            type5 = [v40 type];
            [v40 instanceID];
            v82 = v130 = selfCopy4;
            [v40 lastKnownValue];
            v83 = contextb = v77;
            value3 = [v39 value];
            identifier2 = [serverCopy identifier];
            *buf = 138544898;
            v165 = v80;
            v166 = 2112;
            v167 = type5;
            v168 = 2112;
            v169 = v82;
            v170 = 2112;
            v171 = v83;
            v172 = 2112;
            v173 = value3;
            v174 = 2112;
            v175 = numberCopy;
            v176 = 2112;
            v177 = identifier2;
            _os_log_impl(&dword_229538000, v79, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value from %@ to %@ at same state number %@ for accessory: %@", buf, 0x48u);

            v77 = contextb;
            selfCopy4 = v130;
          }

          objc_autoreleasePoolPop(v77);
          [v136 addObject:v40];
          accessory2 = [v40 accessory];
          if (([accessory2 supportsWoL] & 1) == 0 && !objc_msgSend(accessory2, "custom1WoBLE"))
          {
            goto LABEL_48;
          }

          v87 = objc_autoreleasePoolPush();
          v88 = selfCopy4;
          v89 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v89, OS_LOG_TYPE_INFO))
          {
            v90 = HMFGetLogIdentifier();
            identifier3 = [serverCopy identifier];
            *buf = 138544130;
            v165 = v90;
            v166 = 2112;
            v167 = v39;
            v168 = 2112;
            v169 = v40;
            v170 = 2112;
            v171 = identifier3;
            _os_log_impl(&dword_229538000, v89, OS_LOG_TYPE_INFO, "%{public}@Checking if we should update value hapCharacteristic %@ to hmdCharacteristic %@ for accessory: %@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v87);
          if (v45 || ([v40 lastKnownValueUpdateTime], v92 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v39, "valueUpdatedTime"), v93 = objc_claimAutoreleasedReturnValue(), v94 = objc_msgSend(v92, "compare:", v93), v93, v92, v94))
          {
LABEL_48:

            self = selfCopy;
            goto LABEL_33;
          }

          v113 = objc_autoreleasePoolPush();
          v114 = v88;
          v115 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v115, OS_LOG_TYPE_INFO))
          {
            v116 = HMFGetLogIdentifier();
            identifier4 = [serverCopy identifier];
            *buf = v126;
            v165 = v116;
            v166 = 2112;
            v167 = identifier4;
            _os_log_impl(&dword_229538000, v115, OS_LOG_TYPE_INFO, "%{public}@Not updating value because update times and values are the same for accessory: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v113);
          v37 = numberCopy;
          [v40 setStateNumber:numberCopy];
          v36 = 1;
        }

        else
        {
          v95 = objc_autoreleasePoolPush();
          selfCopy5 = self;
          v97 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v97, OS_LOG_TYPE_DEBUG))
          {
            v128 = HMFGetLogIdentifier();
            type6 = [v40 type];
            instanceID4 = [v40 instanceID];
            [v40 stateNumber];
            v100 = v131 = v36;
            [v40 lastKnownValue];
            v101 = contextc = v95;
            value4 = [v39 value];
            identifier5 = [serverCopy identifier];
            *buf = 138544898;
            v165 = v128;
            v166 = 2112;
            v167 = type6;
            v104 = type6;
            v168 = 2112;
            v169 = instanceID4;
            v170 = 2112;
            v171 = v100;
            v172 = 2112;
            v173 = v101;
            v174 = 2112;
            v175 = value4;
            v176 = 2112;
            v177 = identifier5;
            _os_log_impl(&dword_229538000, v97, OS_LOG_TYPE_DEBUG, "%{public}@Ignoring the update for characteristic: '%@'/%@/%@ from %@ to %@ for accessory: %@", buf, 0x48u);

            v95 = contextc;
            v36 = v131;

            v37 = numberCopy;
          }

          objc_autoreleasePoolPop(v95);
        }

        self = selfCopy;
LABEL_53:
        v38 = v150;
        if (!v37)
        {
          goto LABEL_59;
        }

LABEL_54:
        if ((v36 & 1) != 0 && ([v40 shouldIgnoreCacheValueForRead] & 1) == 0)
        {
          accessory3 = [v40 accessory];
          if (accessory3)
          {
            [v127 addObject:accessory3];
          }
        }

        goto LABEL_59;
      }

      value5 = [v39 value];
      if (!value5 || (v56 = value5, v57 = [v40 shouldUpdateValueFromHAPCharacteristic:v39], v56, (v57 & 1) != 0))
      {
        contexta = objc_autoreleasePoolPush();
        selfCopy6 = self;
        v47 = HMFGetOSLogHandle();
        v150 = v38;
        if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
        {
          v59 = HMFGetLogIdentifier();
          type7 = [v40 type];
          instanceID5 = [v40 instanceID];
          lastKnownValue3 = [v40 lastKnownValue];
          stateNumber3 = [v40 stateNumber];
          value6 = [v39 value];
          identifier6 = [serverCopy identifier];
          *buf = 138545154;
          v165 = v59;
          v166 = 2112;
          v167 = type7;
          v168 = 2112;
          v169 = instanceID5;
          v170 = 2112;
          v171 = lastKnownValue3;
          v172 = 2112;
          v173 = stateNumber3;
          v174 = 2112;
          v175 = value6;
          v176 = 2112;
          v177 = numberCopy;
          v178 = 2112;
          v179 = identifier6;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value / state number from %@/%@ to %@/%@ for accessory: %@", buf, 0x52u);

          self = selfCopy;
        }

LABEL_32:

        objc_autoreleasePoolPop(contexta);
        [v136 addObject:v40];
LABEL_33:
        v37 = numberCopy;
        [v40 setStateNumber:numberCopy];
        notificationContext = [v39 notificationContext];

        if (notificationContext)
        {
          v67 = objc_autoreleasePoolPush();
          selfCopy7 = self;
          v69 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
          {
            v70 = HMFGetLogIdentifier();
            value7 = [v39 value];
            notificationContext2 = [v39 notificationContext];
            *buf = 138543874;
            v165 = v70;
            v166 = 2112;
            v167 = value7;
            v168 = 2112;
            v169 = notificationContext2;
            _os_log_impl(&dword_229538000, v69, OS_LOG_TYPE_INFO, "%{public}@Updating HMD characteristic with value: %@ and notification context: %@", buf, 0x20u);

            self = selfCopy;
          }

          objc_autoreleasePoolPop(v67);
        }

        value8 = [v39 value];
        valueUpdatedTime = [v39 valueUpdatedTime];
        notificationContext3 = [v39 notificationContext];
        [v40 updateValue:value8 updatedTime:valueUpdatedTime stateNumber:numberCopy notificationContext:notificationContext3];

        v36 = 1;
        goto LABEL_53;
      }

      v106 = objc_autoreleasePoolPush();
      selfCopy8 = self;
      v108 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v108, OS_LOG_TYPE_INFO))
      {
        v109 = HMFGetLogIdentifier();
        value9 = [v39 value];
        shortDescription = [v40 shortDescription];
        identifier7 = [serverCopy identifier];
        *buf = 138544130;
        v165 = v109;
        v166 = 2112;
        v167 = value9;
        v168 = 2112;
        v169 = shortDescription;
        v170 = 2112;
        v171 = identifier7;
        _os_log_impl(&dword_229538000, v108, OS_LOG_TYPE_INFO, "%{public}@Ignoring same value %@ updates from local for characteristic: '%@' for accessory: %@", buf, 0x2Au);

        v37 = numberCopy;
        self = selfCopy;
      }

      objc_autoreleasePoolPop(v106);
      [v40 setStateNumber:v37];
      v36 = 1;
      if (v37)
      {
        goto LABEL_54;
      }

LABEL_59:

      ++v38;
    }

    while (v142 != v38);
    v118 = [v133 countByEnumeratingWithState:&v155 objects:v180 count:16];
    v142 = v118;
  }

  while (v118);
LABEL_71:

  v153 = 0u;
  v154 = 0u;
  v151 = 0u;
  v152 = 0u;
  v119 = v127;
  v120 = [v119 countByEnumeratingWithState:&v151 objects:v163 count:16];
  if (v120)
  {
    v121 = v120;
    v122 = *v152;
    do
    {
      for (j = 0; j != v121; ++j)
      {
        if (*v152 != v122)
        {
          objc_enumerationMutation(v119);
        }

        [*(*(&v151 + 1) + 8 * j) notifyingCharacteristicStateNumberUpdated:v37];
      }

      v121 = [v119 countByEnumeratingWithState:&v151 objects:v163 count:16];
    }

    while (v121);
  }

  if (v37 != 0 && (v36 & 1) != 0)
  {
    [(HMDHome *)self saveToCurrentAccountWithReason:*MEMORY[0x277CD21D0]];
  }

  v124 = *MEMORY[0x277D85DE8];

  return v136;
}

- (id)_hmdCharacteristicsForUpdatedHAPCharacteristics:(id)characteristics accessoryServer:(id)server
{
  v39 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  serverCopy = server;
  v28 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(characteristicsCopy, "count")}];
  accessories = [(HMDHome *)self accessories];
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  obj = characteristicsCopy;
  v26 = [obj countByEnumeratingWithState:&v33 objects:v38 count:16];
  if (v26)
  {
    v23 = *v34;
    do
    {
      v7 = 0;
      do
      {
        if (*v34 != v23)
        {
          objc_enumerationMutation(obj);
        }

        v27 = v7;
        v8 = *(*(&v33 + 1) + 8 * v7);
        primaryAccessory = [serverCopy primaryAccessory];
        v29 = 0u;
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v10 = accessories;
        v11 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
        if (v11)
        {
          v12 = v11;
          v13 = *v30;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v30 != v13)
              {
                objc_enumerationMutation(v10);
              }

              v15 = *(*(&v29 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v16 = v15;
              }

              else
              {
                v16 = 0;
              }

              v17 = v16;

              if ([v17 matchesHAPAccessory:primaryAccessory])
              {
                instanceID = [v8 instanceID];
                v19 = [v17 hmdCharacteristicForInstanceId:instanceID];

                if ([v19 shouldUpdateValueFromHAPCharacteristic:v8])
                {
                  [v28 addObject:v19];
                }
              }
            }

            v12 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
          }

          while (v12);
        }

        v7 = v27 + 1;
      }

      while (v27 + 1 != v26);
      v26 = [obj countByEnumeratingWithState:&v33 objects:v38 count:16];
    }

    while (v26);
  }

  v20 = *MEMORY[0x277D85DE8];

  return v28;
}

- (void)accessoryBrowser:(id)browser didUpdateEndpoint:(id)endpoint
{
  v87 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  endpointCopy = endpoint;
  v7 = MEMORY[0x277CBEB18];
  selfCopy = self;
  accessories = [(HMDHome *)self accessories];
  v9 = [v7 arrayWithCapacity:{objc_msgSend(accessories, "count")}];

  v55 = endpointCopy;
  [endpointCopy advertisements];
  v70 = 0u;
  v71 = 0u;
  v72 = 0u;
  obj = v73 = 0u;
  v59 = [obj countByEnumeratingWithState:&v70 objects:v86 count:16];
  if (v59)
  {
    v57 = *v71;
    do
    {
      v10 = 0;
      do
      {
        if (*v71 != v57)
        {
          objc_enumerationMutation(obj);
        }

        v60 = v10;
        identifier = [*(*(&v70 + 1) + 8 * v10) identifier];
        v66 = 0u;
        v67 = 0u;
        v68 = 0u;
        v69 = 0u;
        accessories2 = [(HMDHome *)selfCopy accessories];
        v13 = [accessories2 countByEnumeratingWithState:&v66 objects:v85 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v67;
          do
          {
            for (i = 0; i != v14; ++i)
            {
              if (*v67 != v15)
              {
                objc_enumerationMutation(accessories2);
              }

              v17 = *(*(&v66 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v18 = v17;
              }

              else
              {
                v18 = 0;
              }

              v19 = v18;

              identifier2 = [v19 identifier];
              v21 = [identifier2 isEqual:identifier];

              if (v21)
              {
                [v9 addObject:v19];
              }
            }

            v14 = [accessories2 countByEnumeratingWithState:&v66 objects:v85 count:16];
          }

          while (v14);
        }

        v10 = v60 + 1;
      }

      while (v60 + 1 != v59);
      v59 = [obj countByEnumeratingWithState:&v70 objects:v86 count:16];
    }

    while (v59);
  }

  v22 = objc_autoreleasePoolPush();
  v23 = selfCopy;
  v24 = HMFGetOSLogHandle();
  v25 = v55;
  if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
  {
    v26 = HMFGetLogIdentifier();
    sessionIdentifier = [v55 sessionIdentifier];
    *buf = 138544130;
    v76 = v26;
    v77 = 2112;
    v78 = sessionIdentifier;
    v79 = 2112;
    v80 = obj;
    v81 = 2112;
    v82 = v9;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Endpoint %@ with advertisements %@ matches accessories %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v22);
  if ([v9 count])
  {
    sessionIdentifier2 = [v55 sessionIdentifier];
    if (!sessionIdentifier2)
    {
      v39 = objc_autoreleasePoolPush();
      v40 = v23;
      v41 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
      {
        v42 = HMFGetLogIdentifier();
        *buf = 138543618;
        v76 = v42;
        v77 = 2112;
        v78 = 0;
        _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Nil session identifier - dropping update for endpoint %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v39);
      goto LABEL_46;
    }

    v29 = [(HMDHome *)v23 mediaSessionWithIdentifier:sessionIdentifier2];
    v61 = sessionIdentifier2;
    if (v29)
    {
      v30 = v29;
      v31 = objc_autoreleasePoolPush();
      v32 = v23;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        uuid = [v30 uuid];
        uUIDString = [uuid UUIDString];
        v37 = [v9 count];
        *buf = 138544386;
        v76 = v34;
        v77 = 2112;
        v78 = uUIDString;
        v79 = 2112;
        v80 = sessionIdentifier2;
        v81 = 2112;
        v82 = obj;
        v83 = 2048;
        v84 = v37;
        v38 = "%{public}@Updated the endpoint for mediaSession %@ with sessionIdentifier %@ (%@ advertisements for %tu accessories) ";
LABEL_32:
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, v38, buf, 0x34u);
      }
    }

    else
    {
      v30 = [(HMDHome *)v23 _createMediaSessionWithEndpoint:v55];
      v31 = objc_autoreleasePoolPush();
      v43 = v23;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        uuid = [v30 uuid];
        uUIDString = [uuid UUIDString];
        v44 = [v9 count];
        *buf = 138544386;
        v76 = v34;
        v77 = 2112;
        v78 = uUIDString;
        v79 = 2112;
        v80 = sessionIdentifier2;
        v81 = 2112;
        v82 = obj;
        v83 = 2048;
        v84 = v44;
        v38 = "%{public}@Creating mediaSession %@ for sessionIdentifier %@ (%@ advertisements for %tu accessories) ";
        goto LABEL_32;
      }
    }

    objc_autoreleasePoolPop(v31);
    v64 = 0u;
    v65 = 0u;
    v62 = 0u;
    v63 = 0u;
    v45 = v9;
    v46 = [v45 countByEnumeratingWithState:&v62 objects:v74 count:16];
    if (v46)
    {
      v47 = v46;
      v48 = *v63;
      do
      {
        for (j = 0; j != v47; ++j)
        {
          if (*v63 != v48)
          {
            objc_enumerationMutation(v45);
          }

          v50 = *(*(&v62 + 1) + 8 * j);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v51 = v50;
          }

          else
          {
            v51 = 0;
          }

          v52 = v51;

          if (!v52)
          {
            [v50 setReachable:1];
          }

          [v50 updateMediaSession:v30];
        }

        v47 = [v45 countByEnumeratingWithState:&v62 objects:v74 count:16];
      }

      while (v47);
    }

    v25 = v55;
    sessionIdentifier2 = v61;
LABEL_46:
  }

  v53 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didDiscoverAccessories:(id)accessories transaction:(id)transaction error:(id)error
{
  v59 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  accessoriesCopy = accessories;
  transactionCopy = transaction;
  errorCopy = error;
  identifier = [serverCopy identifier];
  v18 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  identifier2 = [serverCopy identifier];
  v20 = [(HMDHome *)self matterAccessoryWithIdentifier:identifier2];

  featuresDataSource = [(HMDHome *)self featuresDataSource];
  if ([featuresDataSource isRVCEnabled])
  {
    convertingMatterAccessory = [v20 convertingMatterAccessory];

    if (convertingMatterAccessory)
    {
      v23 = objc_autoreleasePoolPush();
      selfCopy = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v46 = accessoriesCopy;
        v26 = transactionCopy;
        v28 = v27 = browserCopy;
        *buf = 138543618;
        v54 = v28;
        v55 = 2112;
        v56 = v18;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Ignoring the Matter accessory while it's being converted to Hybrid/Native matter: %@", buf, 0x16u);

        browserCopy = v27;
        transactionCopy = v26;
        accessoriesCopy = v46;
      }

      objc_autoreleasePoolPop(v23);
      goto LABEL_25;
    }
  }

  else
  {
  }

  isNativeMatter = [v20 isNativeMatter];
  if (!errorCopy && isNativeMatter)
  {
    [(HMDHome *)self _configurePairedAccessoriesForServer:serverCopy reAddServices:0];
  }

  if (v18)
  {
    v30 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v32 = HMFGetOSLogHandle();
    v33 = v32;
    if (errorCopy)
    {
      v47 = browserCopy;
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        v34 = HMFGetLogIdentifier();
        *buf = 138543874;
        v54 = v34;
        v55 = 2112;
        v56 = serverCopy;
        v57 = 2114;
        v58 = errorCopy;
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Failed HAP service discovery on accessory server %@ with error: %{public}@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v30);
      identifier3 = [serverCopy identifier];
      linkType = [serverCopy linkType];
      v49[0] = MEMORY[0x277D85DD0];
      v49[1] = 3221225472;
      v49[2] = __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke;
      v49[3] = &unk_278670760;
      v37 = identifier3;
      v51 = selfCopy2;
      v52 = linkType;
      v50 = v37;
      [(HMDHome *)selfCopy2 _notifyRetrievalError:errorCopy accessoryServer:v37 linkType:linkType accessoryOperationBlock:v49];
      domain = [errorCopy domain];
      if ([domain isEqualToString:*MEMORY[0x277CCFD28]])
      {
        code = [errorCopy code];

        if (code == 66)
        {
          [v18 didEncounterError:errorCopy];
          browserCopy = v47;
LABEL_24:

          goto LABEL_25;
        }
      }

      else
      {
      }

      v43 = serverCopy;
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();

      browserCopy = v47;
      if (v43 && (isKindOfClass & 1) != 0)
      {
        [v18 _forceEnableReachabilityPingForPrimaryResident:v43];
      }

      goto LABEL_24;
    }

    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v48 = accessoriesCopy;
      v40 = transactionCopy;
      v42 = v41 = browserCopy;
      *buf = 138543618;
      v54 = v42;
      v55 = 2112;
      v56 = serverCopy;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Completed HAP service discovery on accessory server %@", buf, 0x16u);

      browserCopy = v41;
      transactionCopy = v40;
      accessoriesCopy = v48;
    }

    objc_autoreleasePoolPop(v30);
    [v18 setLastPairingFailureTime:0.0];
    [v18 setConsecutivePairingFailures:0];
    -[HMDHome _configurePairedAccessoriesForServer:reAddServices:](selfCopy2, "_configurePairedAccessoriesForServer:reAddServices:", serverCopy, [accessoriesCopy count] == 0);
  }

LABEL_25:

  v45 = *MEMORY[0x277D85DE8];
}

void __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke(uint64_t a1, void *a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v3 = a2;
  [v3 setReachability:0 serverIdentifier:*(a1 + 32) linkType:*(a1 + 48)];
  if ([v3 hasBTLELink] && *(a1 + 48) == 2)
  {
    v4 = [*(a1 + 40) accessoryBrowser];
    v9[0] = *(a1 + 32);
    v5 = [MEMORY[0x277CBEA60] arrayWithObjects:v9 count:1];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke_2;
    v7[3] = &unk_278670738;
    v8 = v3;
    [v4 probeReachabilityForBTLEAccessoryServersWithIdentifiers:v5 forceScan:1 withCompletion:v7];
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didStopPairingWithError:(id)error
{
  v44 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  errorCopy = error;
  identifier = [serverCopy identifier];
  v12 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  if (v12)
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      shortDescription = [serverCopy shortDescription];
      *buf = 138543874;
      v39 = v16;
      v40 = 2112;
      v41 = shortDescription;
      v42 = 2112;
      v43 = errorCopy;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ stopped pairing with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v18 = objc_autoreleasePoolPush();
    v19 = selfCopy;
    v20 = HMFGetOSLogHandle();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_INFO);
    if (errorCopy)
    {
      if (v21)
      {
        v22 = HMFGetLogIdentifier();
        shortDescription2 = [serverCopy shortDescription];
        *buf = 138543874;
        v39 = v22;
        v40 = 2112;
        v41 = shortDescription2;
        v42 = 2112;
        v43 = errorCopy;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ failed to pair with error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v18);
      userInfo = [errorCopy userInfo];
      v25 = [userInfo objectForKeyedSubscript:*MEMORY[0x277CCA7E8]];

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v26 = v25;
      }

      else
      {
        v26 = 0;
      }

      accessoryBrowser = v26;

      domain = [accessoryBrowser domain];
      v29 = *MEMORY[0x277CCA590];
      v30 = HMFEqualObjects();

      if (!v30 || [accessoryBrowser code] != -6754)
      {
        [v12 setLastPairingFailureTime:CFAbsoluteTimeGetCurrent()];
        [v12 setConsecutivePairingFailures:{objc_msgSend(v12, "consecutivePairingFailures") + 1}];
      }

      identifier2 = [serverCopy identifier];
      linkType = [serverCopy linkType];
      v36[0] = MEMORY[0x277D85DD0];
      v36[1] = 3221225472;
      v36[2] = __68__HMDHome_accessoryBrowser_accessoryServer_didStopPairingWithError___block_invoke;
      v36[3] = &unk_27866FC38;
      v37 = errorCopy;
      [(HMDHome *)v19 _notifyRetrievalError:v37 accessoryServer:identifier2 linkType:linkType accessoryOperationBlock:v36];
    }

    else
    {
      if (v21)
      {
        v33 = HMFGetLogIdentifier();
        shortDescription3 = [serverCopy shortDescription];
        *buf = 138543618;
        v39 = v33;
        v40 = 2112;
        v41 = shortDescription3;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ pairing completed successfully", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
      accessoryBrowser = [(HMDHome *)v19 accessoryBrowser];
      [accessoryBrowser discoverAccessories:serverCopy];
    }
  }

  v35 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser discoveryFailedWithError:(id)error accessoryServer:(id)server linkType:(int64_t)type
{
  errorCopy = error;
  serverCopy = server;
  v11 = [(HMDHome *)self hapAccessoryWithIdentifier:serverCopy];
  if (v11)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __78__HMDHome_accessoryBrowser_discoveryFailedWithError_accessoryServer_linkType___block_invoke;
    v12[3] = &unk_278670710;
    typeCopy = type;
    v13 = serverCopy;
    [(HMDHome *)self _notifyRetrievalError:errorCopy accessoryServer:v13 linkType:type accessoryOperationBlock:v12];
  }
}

void __78__HMDHome_accessoryBrowser_discoveryFailedWithError_accessoryServer_linkType___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (*(a1 + 40) != 2)
  {
    v6 = v3;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v4 = v6;
    }

    else
    {
      v4 = 0;
    }

    v5 = v4;
    [v5 setReachability:0 serverIdentifier:*(a1 + 32) linkType:*(a1 + 40)];

    v3 = v6;
  }
}

- (void)accessoryBrowser:(id)browser didFinishWACForAccessoryWithIdentifier:(id)identifier error:(id)error
{
  identifierCopy = identifier;
  errorCopy = error;
  v8 = [(HMDHome *)self accessoryWithIdentifier:identifierCopy];
  if (v8)
  {
    homeReprovisionHandler = [(HMDHome *)self homeReprovisionHandler];
    [homeReprovisionHandler handleReprovionedAccessory:v8 identifier:identifierCopy error:errorCopy];
  }
}

- (void)accessoryBrowser:(id)browser didFindAccessoryServerNeedingReprovisioning:(id)reprovisioning error:(id)error
{
  v24 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  reprovisioningCopy = reprovisioning;
  errorCopy = error;
  if ([reprovisioningCopy isPaired])
  {
    identifier = [reprovisioningCopy identifier];
    v12 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

    if (v12)
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        shortDescription = [v12 shortDescription];
        v20 = 138543618;
        v21 = v16;
        v22 = 2112;
        v23 = shortDescription;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ needs reprovisioning is found", &v20, 0x16u);
      }

      objc_autoreleasePoolPop(v13);
      homeReprovisionHandler = [(HMDHome *)selfCopy homeReprovisionHandler];
      [homeReprovisionHandler handleFoundAccessoryNeedingReprovisioning:v12 error:errorCopy];
    }
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didTombstoneAccessoryServer:(id)server
{
  v22 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  identifier = [serverCopy identifier];
  v9 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      shortDescription = [v9 shortDescription];
      v16 = 138543874;
      v17 = v13;
      v18 = 2112;
      v19 = serverCopy;
      v20 = 2112;
      v21 = shortDescription;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@AccessoryServer %@ tombstoned - unconfiguring all paired accessories for %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    [(HMDHome *)selfCopy _unconfigurePairedAccessoriesForServer:serverCopy updateReachability:1];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didRemoveAccessoryServer:(id)server error:(id)error
{
  v35 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  errorCopy = error;
  identifier = [serverCopy identifier];
  v12 = [(HMDHome *)self accessoryWithIdentifier:identifier];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v13 = v12;
  }

  else
  {
    v13 = 0;
  }

  v14 = v13;

  identifier2 = [serverCopy identifier];
  [v14 didRemoveAccessoryServer:identifier2];

  identifier3 = [serverCopy identifier];
  v17 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier3];

  if (v17)
  {
    if ([serverCopy linkType] == 1)
    {
      [v17 _wol_processDidRemoveHPAccessoryServer:serverCopy];
    }

    linkType = [serverCopy linkType];
    if (errorCopy)
    {
      v19 = 0;
    }

    else
    {
      v19 = linkType == 2;
    }

    v20 = !v19;
    v21 = objc_autoreleasePoolPush();
    selfCopy = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      v25 = @"not updating";
      v29 = 138543874;
      v30 = v24;
      v31 = 2112;
      if (v20)
      {
        v25 = @"updating";
      }

      v32 = serverCopy;
      v33 = 2112;
      v34 = v25;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@AccessoryServer %@ removed - %@ reachability", &v29, 0x20u);
    }

    objc_autoreleasePoolPop(v21);
    [(HMDHome *)selfCopy _unconfigurePairedAccessoriesForServer:serverCopy updateReachability:v20];
    v26 = objc_alloc_init(HMDHAPMetricsLogEvent);
    [(HMDHAPMetricsLogEvent *)v26 updateWithHAPAccessoryServer:serverCopy];
    logEventSubmitter = [(HMDHome *)selfCopy logEventSubmitter];
    [logEventSubmitter submitLogEvent:v26];
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didFindAccessoryServer:(id)server stateChanged:(BOOL)changed stateNumber:(id)number completion:(id)completion
{
  changedCopy = changed;
  v148 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  numberCopy = number;
  completionCopy = completion;
  v15 = objc_autoreleasePoolPush();
  selfCopy = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    shortDescription = [serverCopy shortDescription];
    v20 = HMFBooleanToString();
    *buf = 138544130;
    v137 = v18;
    v138 = 2112;
    v139 = shortDescription;
    v140 = 2112;
    v141 = numberCopy;
    v142 = 2112;
    v143 = v20;
    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Found paired accessory server %@. State: %@/%@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v15);
  identifier = [serverCopy identifier];
  v22 = [(HMDHome *)selfCopy hapAccessoryWithIdentifier:identifier];

  v23 = [(HMDHome *)selfCopy _shouldAvoidTombstoningAccessoryServer:serverCopy accessory:v22];
  identifier2 = [serverCopy identifier];
  v25 = [(HMDHome *)selfCopy accessoryWithIdentifier:identifier2];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v26 = v25;
  }

  else
  {
    v26 = 0;
  }

  v27 = v26;

  v28 = v27 != 0;
  if (v27)
  {
    [v27 didFindAccessoryServer:serverCopy];
  }

  if (!v22)
  {
    goto LABEL_61;
  }

  v125 = v27 != 0;
  v129 = v27;
  v130 = completionCopy;
  v131 = numberCopy;
  v128 = browserCopy;
  residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
  isCurrentDeviceAvailableResident = [residentDeviceManager isCurrentDeviceAvailableResident];

  v31 = objc_autoreleasePoolPush();
  v32 = selfCopy;
  v33 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
  {
    v34 = HMFGetLogIdentifier();
    shortDescription2 = [v22 shortDescription];
    v36 = HMFBooleanToString();
    *buf = 138543874;
    v137 = v34;
    v138 = 2112;
    v139 = shortDescription2;
    v140 = 2112;
    v141 = v36;
    _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Performing accessory/service discovery on paired accessory %@. isResidentDevice: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v31);
  if ((![v22 canWakeUpViaWoL] || objc_msgSend(v22, "shouldDiscoverSuspendCapableAccessoryServer:", serverCopy)) && !objc_msgSend(serverCopy, "wakeNumber"))
  {
    context = isCurrentDeviceAvailableResident;
    v50 = serverCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v51 = v50;
    }

    else
    {
      v51 = 0;
    }

    v123 = v51;

    v121 = v50;
    if ([v50 isReachable] && (objc_msgSend(v123, "isCached") & 1) == 0)
    {
      v52 = [MEMORY[0x277CBEB18] arrayWithObject:v22];
      identifiersForBridgedAccessories = [v22 identifiersForBridgedAccessories];
      allObjects = [identifiersForBridgedAccessories allObjects];
      v55 = [(HMDHome *)v32 accessoriesWithUUIDs:allObjects];
      [v52 addObjectsFromArray:v55];

      v50 = v121;
      v134[0] = MEMORY[0x277D85DD0];
      v134[1] = 3221225472;
      v134[2] = __87__HMDHome_accessoryBrowser_didFindAccessoryServer_stateChanged_stateNumber_completion___block_invoke;
      v134[3] = &unk_27866FC38;
      v135 = v121;
      [v52 na_each:v134];
    }

    v56 = objc_autoreleasePoolPush();
    v57 = v32;
    v58 = HMFGetOSLogHandle();
    v124 = v57;
    if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
    {
      v59 = HMFGetLogIdentifier();
      shortDescription3 = [v22 shortDescription];
      [(HMDHome *)v57 isCurrentDevicePrimaryResident];
      v61 = HMFBooleanToString();
      [(HMDHome *)v57 isCurrentDeviceAvailableResident];
      HMFBooleanToString();
      v63 = v62 = v23;
      *buf = 138544130;
      v137 = v59;
      v138 = 2112;
      v139 = shortDescription3;
      v140 = 2114;
      v141 = v61;
      v142 = 2114;
      v143 = v63;
      _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_INFO, "%{public}@Evaluating disconnect on idle status for %@ using - isCurrentDevicePrimaryResident = %{public}@, isCurrentDeviceAvailableResident = %{public}@", buf, 0x2Au);

      v23 = v62;
      v50 = v121;
    }

    objc_autoreleasePoolPop(v56);
    v64 = shouldDisconnectOnIdleForAccessory(v22);
    if (v64 != [v22 shouldDisconnectOnIdle])
    {
      [v22 setShouldDisconnectOnIdle:v64];
    }

    [v50 setShouldDisconnectOnIdle:v64];
    identifier3 = [v50 identifier];
    supportedTransports = [v22 supportedTransports];
    setupHash = [v50 setupHash];
    [(HMDHome *)v57 _registerPairedAccessory:identifier3 transports:supportedTransports setupHash:setupHash];

    DiscoveryBackoffPeriod = 0.0;
    browserCopy = v128;
    v27 = v129;
    if (context)
    {
LABEL_28:
      completionCopy = v130;
      numberCopy = v131;
LABEL_48:
      v28 = v125;
LABEL_49:
      if (!v27 && DiscoveryBackoffPeriod == 0.0)
      {
        shouldAutoDiscoverAccessoryServer = [v22 shouldAutoDiscoverAccessoryServer];
        enhancedAuthMethod = [v22 enhancedAuthMethod];
        v87 = -[HMDHome _isRetrievalInProgressForPrimaryAccessory:linkType:](v124, "_isRetrievalInProgressForPrimaryAccessory:linkType:", v22, [v121 linkType]);
        contexta = objc_autoreleasePoolPush();
        v88 = v124;
        v89 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v89, OS_LOG_TYPE_INFO))
        {
          v117 = HMFGetLogIdentifier();
          identifier4 = [v121 identifier];
          linkType = [v121 linkType];
          v115 = v88;
          if (linkType > 2)
          {
            v91 = @"Undefined";
          }

          else
          {
            v91 = off_2786768F0[linkType];
          }

          v92 = v91;
          v93 = HMFBooleanToString();
          HMFBooleanToString();
          v94 = v122 = shouldAutoDiscoverAccessoryServer;
          v95 = HMFBooleanToString();
          *buf = 138544642;
          v137 = v117;
          v138 = 2112;
          v139 = identifier4;
          v140 = 2112;
          v141 = v92;
          v142 = 2112;
          v143 = v93;
          v144 = 2112;
          v145 = *&v94;
          v146 = 2112;
          v147 = v95;
          _os_log_impl(&dword_229538000, v89, OS_LOG_TYPE_INFO, "%{public}@Evaluating need to discover accessories from found accessory server %@/%@, autoDiscoveryEnabled =  %@, hasExplicitRetrieveRequest = %@ discoverForEAuth = %@", buf, 0x3Eu);

          shouldAutoDiscoverAccessoryServer = v122;
          browserCopy = v128;
          v27 = v129;
          v88 = v115;
        }

        objc_autoreleasePoolPop(contexta);
        v28 = shouldAutoDiscoverAccessoryServer | v87 | (enhancedAuthMethod == 0);
        completionCopy = v130;
        numberCopy = v131;
      }

      if (DiscoveryBackoffPeriod > 0.0)
      {
        v127 = v28;
        v96 = objc_autoreleasePoolPush();
        v97 = v124;
        v98 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v98, OS_LOG_TYPE_INFO))
        {
          v99 = HMFGetLogIdentifier();
          shortDescription4 = [v22 shortDescription];
          HMFBooleanToString();
          v102 = v101 = v23;
          *buf = 138544386;
          v137 = v99;
          v138 = 2112;
          v139 = shortDescription4;
          v140 = 2112;
          v141 = v131;
          v142 = 2112;
          v143 = v102;
          v144 = 2048;
          v145 = DiscoveryBackoffPeriod;
          _os_log_impl(&dword_229538000, v98, OS_LOG_TYPE_INFO, "%{public}@Backing off discovery for accessory %@ with s# %@, state changed: %@ for %.2f sec", buf, 0x34u);

          v23 = v101;
        }

        objc_autoreleasePoolPop(v96);
        numberCopy = v131;
        [v22 backOffAccessoryForStateNumber:v131 backoffPeriod:DiscoveryBackoffPeriod];
        v27 = v129;
        completionCopy = v130;
        v28 = v127;
      }

LABEL_61:
      completionCopy[2](completionCopy, v23, v28 & 1);
      goto LABEL_62;
    }

    Current = CFAbsoluteTimeGetCurrent();
    [v22 lastPairingFailureTime];
    v71 = Current - v70;
    consecutivePairingFailures = [v22 consecutivePairingFailures];
    if (v71 < getDiscoveryBackoffPeriod() || consecutivePairingFailures >= 6)
    {
      if (consecutivePairingFailures <= 5)
      {
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
      }

      else
      {
        DiscoveryBackoffPeriod = 1800.0;
      }

      completionCopy = v130;
      numberCopy = v131;
      [v22 setResetOnBackoffExpiry:consecutivePairingFailures > 5];
      v78 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
      identifier5 = [v121 identifier];
      [(HMDHome *)v124 _notifyRetrievalError:v78 accessoryServer:identifier5 linkType:0 accessoryOperationBlock:0];

      goto LABEL_48;
    }

    v28 = v125;
    if (!v123)
    {
      completionCopy = v130;
      numberCopy = v131;
      goto LABEL_49;
    }

    completionCopy = v130;
    numberCopy = v131;
    if (!changedCopy)
    {
      goto LABEL_49;
    }

    if ([v22 isRemotelyReachable])
    {
      v73 = objc_autoreleasePoolPush();
      v74 = v124;
      v75 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v75, OS_LOG_TYPE_INFO))
      {
        v76 = HMFGetLogIdentifier();
        shortDescription5 = [v22 shortDescription];
        *buf = 138543618;
        v137 = v76;
        v138 = 2112;
        v139 = shortDescription5;
        _os_log_impl(&dword_229538000, v75, OS_LOG_TYPE_INFO, "%{public}@Skipping discovery since accessory: %@ is remotely reachable.", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v73);
      goto LABEL_47;
    }

    if ([(HMDHome *)v124 _isRegisteredForNotificationsWithRemoteGateway:v22])
    {
      v80 = objc_autoreleasePoolPush();
      v81 = v124;
      v82 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
      {
LABEL_46:

        objc_autoreleasePoolPop(v80);
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
LABEL_47:
        completionCopy = v130;
        numberCopy = v131;
        v27 = v129;
        goto LABEL_48;
      }

      v83 = HMFGetLogIdentifier();
      shortDescription6 = [v22 shortDescription];
      *buf = 138543618;
      v137 = v83;
      v138 = 2112;
      v139 = shortDescription6;
      v85 = "%{public}@Backing off since notifications for %@ are registered with remote gateway";
    }

    else
    {
      if (![(HMDHome *)v124 _isEventTriggerOnRemoteGatewayForAccessory:v22]|| [(HMDHome *)v124 _isRegisteredForNotificationsForClients:v22]|| [(HMDHome *)v124 _isEventTriggerOnLocalDeviceForAccessory:v22])
      {
        v104 = [(HMDHome *)v124 _isEventTriggerOnRemoteGatewayForAccessory:v22];
        contextb = objc_autoreleasePoolPush();
        v105 = v124;
        v106 = HMFGetOSLogHandle();
        v107 = os_log_type_enabled(v106, OS_LOG_TYPE_INFO);
        if (!v104)
        {
          if (v107)
          {
            v110 = HMFGetLogIdentifier();
            shortDescription7 = [v22 shortDescription];
            stateNumber = [v123 stateNumber];
            [v123 stateChanged];
            HMFBooleanToString();
            v114 = v113 = v23;
            *buf = 138544130;
            v137 = v110;
            v138 = 2112;
            v139 = shortDescription7;
            v140 = 2112;
            v141 = stateNumber;
            v142 = 2112;
            v143 = v114;
            _os_log_impl(&dword_229538000, v106, OS_LOG_TYPE_INFO, "%{public}@Discovering BLE Accessory: %@, State Number: %@, State Changed: %@", buf, 0x2Au);

            v23 = v113;
            v27 = v129;
          }

          objc_autoreleasePoolPop(contextb);
          v28 = 1;
          completionCopy = v130;
          numberCopy = v131;
          goto LABEL_61;
        }

        if (v107)
        {
          v108 = HMFGetLogIdentifier();
          shortDescription8 = [v22 shortDescription];
          *buf = 138543618;
          v137 = v108;
          v138 = 2112;
          v139 = shortDescription8;
          _os_log_impl(&dword_229538000, v106, OS_LOG_TYPE_INFO, "%{public}@Backing off since triggers are on resident and have clients interested for accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(contextb);
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
        goto LABEL_28;
      }

      v80 = objc_autoreleasePoolPush();
      v81 = v124;
      v82 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
      {
        goto LABEL_46;
      }

      v83 = HMFGetLogIdentifier();
      shortDescription6 = [v22 shortDescription];
      *buf = 138543618;
      v137 = v83;
      v138 = 2112;
      v139 = shortDescription6;
      v85 = "%{public}@Not discovering accessory (%@) as trigger is active on resident and no clients and no local triggers locally";
    }

    _os_log_impl(&dword_229538000, v82, OS_LOG_TYPE_INFO, v85, buf, 0x16u);

    goto LABEL_46;
  }

  v37 = objc_autoreleasePoolPush();
  v38 = v32;
  v39 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
  {
    v40 = HMFGetLogIdentifier();
    shortDescription9 = [serverCopy shortDescription];
    [v22 lpmProfile];
    v42 = v133 = v37;
    connectivityInfo = [v22 connectivityInfo];
    [connectivityInfo woWLANInfo];
    v44 = serverCopy;
    v45 = v22;
    v47 = v46 = v23;
    *buf = 138544130;
    v137 = v40;
    v138 = 2112;
    v139 = shortDescription9;
    v140 = 2112;
    v141 = v42;
    v142 = 2112;
    v143 = v47;
    _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Not discovering the suspended accessory server: %@ with LPM Profile: %@ and WoWInfo: %@.", buf, 0x2Au);

    v23 = v46;
    v22 = v45;
    serverCopy = v44;

    v37 = v133;
  }

  objc_autoreleasePoolPop(v37);
  v48 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
  identifier6 = [serverCopy identifier];
  -[HMDHome _notifyRetrievalError:accessoryServer:linkType:accessoryOperationBlock:](v38, "_notifyRetrievalError:accessoryServer:linkType:accessoryOperationBlock:", v48, identifier6, [serverCopy linkType], 0);

  completionCopy = v130;
  v130[2](v130, v23, 0);

  browserCopy = v128;
  v27 = v129;
  numberCopy = v131;
LABEL_62:

  v103 = *MEMORY[0x277D85DE8];
}

void __87__HMDHome_accessoryBrowser_didFindAccessoryServer_stateChanged_stateNumber_completion___block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v6;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [*(a1 + 32) identifier];
  [v4 setReachability:1 serverIdentifier:v5 linkType:{objc_msgSend(*(a1 + 32), "linkType")}];
}

- (void)handleRemovedMediaSessions:(id)sessions
{
  sessionsCopy = sessions;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __38__HMDHome_handleRemovedMediaSessions___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = sessionsCopy;
  selfCopy = self;
  v6 = sessionsCopy;
  dispatch_async(workQueue, v7);
}

void __38__HMDHome_handleRemovedMediaSessions___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_arrayForKey:@"kRemovedMediaSessionIdentifiersKey"];

  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  v4 = v3;
  v5 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v11;
    do
    {
      v8 = 0;
      do
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(v4);
        }

        [*(a1 + 40) _removeMediaSessionWithIdentifier:{*(*(&v10 + 1) + 8 * v8++), v10}];
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didRemoveAccessoryAdvertisement:(id)advertisement
{
  v19 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  advertisementCopy = advertisement;
  identifier = [advertisementCopy identifier];
  v9 = [(HMDHome *)self accessoryWithIdentifier:identifier];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = advertisementCopy;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Handling removed advertisement: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    [v9 removeAdvertisement:advertisementCopy];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didAddAccessoryAdvertisement:(id)advertisement
{
  v19 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  advertisementCopy = advertisement;
  identifier = [advertisementCopy identifier];
  v9 = [(HMDHome *)self accessoryWithIdentifier:identifier];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = advertisementCopy;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Handling added advertisement: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    [v9 addAdvertisement:advertisementCopy];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceAvailableResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  isCurrentDeviceAvailableResident = [residentDeviceManager isCurrentDeviceAvailableResident];

  return isCurrentDeviceAvailableResident;
}

- (BOOL)_shouldAvoidTombstoningAccessoryServer:(id)server accessory:(id)accessory
{
  v66 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  accessoryCopy = accessory;
  v8 = accessoryCopy;
  v9 = 0;
  if (serverCopy && accessoryCopy)
  {
    removeAccessoryInProgressForHMDAccessories = [(HMDHome *)self removeAccessoryInProgressForHMDAccessories];
    v11 = [removeAccessoryInProgressForHMDAccessories containsObject:v8];

    if (v11)
    {
      v12 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        name = [serverCopy name];
        identifier = [serverCopy identifier];
        *buf = 138543874;
        v57 = v15;
        v58 = 2112;
        v59 = name;
        v60 = 2112;
        v61 = identifier;
        v18 = "%{public}@Accessory %@/%@ being removed from home - not tombstoning";
LABEL_9:
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, v18, buf, 0x20u);

        goto LABEL_10;
      }

      goto LABEL_10;
    }

    addPendingAccessorySetupCodeHandlers = [(HMDHome *)self addPendingAccessorySetupCodeHandlers];
    uuid = [v8 uuid];
    v21 = [addPendingAccessorySetupCodeHandlers objectForKey:uuid];

    if (v21)
    {
      v12 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        name = [serverCopy name];
        identifier = [serverCopy identifier];
        *buf = 138543874;
        v57 = v15;
        v58 = 2112;
        v59 = name;
        v60 = 2112;
        v61 = identifier;
        v18 = "%{public}@Accessory %@/%@ being added to home - not tombstoning";
        goto LABEL_9;
      }

LABEL_10:

      objc_autoreleasePoolPop(v12);
LABEL_11:
      v9 = 1;
      goto LABEL_12;
    }

    addPendingAccessories = [(HMDHome *)self addPendingAccessories];
    hm_allKeys = [addPendingAccessories hm_allKeys];
    v54[0] = MEMORY[0x277D85DD0];
    v54[1] = 3221225472;
    v54[2] = __60__HMDHome__shouldAvoidTombstoningAccessoryServer_accessory___block_invoke;
    v54[3] = &unk_27866FE40;
    v26 = v8;
    v55 = v26;
    v27 = [hm_allKeys na_any:v54];

    if (v27)
    {
      v28 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
      {
        v31 = HMFGetLogIdentifier();
        name2 = [serverCopy name];
        identifier2 = [serverCopy identifier];
        *buf = 138543874;
        v57 = v31;
        v58 = 2112;
        v59 = name2;
        v60 = 2112;
        v61 = identifier2;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ being added to home (via setupDescription) - not tombstoning", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v28);
      goto LABEL_11;
    }

    currentAccessory = [(HMDHome *)self currentAccessory];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v35 = currentAccessory;
    }

    else
    {
      v35 = 0;
    }

    v36 = v35;

    sensorManager = [v36 sensorManager];
    if (sensorManager)
    {
      v38 = sensorManager;
      identifier3 = [v26 identifier];
      sensorManager2 = [v36 sensorManager];
      derivedHAPAccessoryIdentifier = [sensorManager2 derivedHAPAccessoryIdentifier];
      if ([identifier3 isEqualToString:derivedHAPAccessoryIdentifier])
      {

LABEL_24:
        v45 = objc_autoreleasePoolPush();
        selfCopy4 = self;
        v47 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
        {
          v48 = HMFGetLogIdentifier();
          name3 = [serverCopy name];
          identifier4 = [serverCopy identifier];
          *buf = 138544386;
          v57 = v48;
          v58 = 2112;
          v59 = name3;
          v60 = 2112;
          v61 = identifier4;
          v62 = 2112;
          v63 = v26;
          v64 = 2112;
          v65 = v36;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ (%@) is a derived homepod sensor for %@ - not tombstoning", buf, 0x34u);
        }

        objc_autoreleasePoolPop(v45);
        v9 = 1;
        goto LABEL_28;
      }

      uuid2 = [v26 uuid];
      [v36 sensorManager];
      v43 = v51 = identifier3;
      [v43 derivedSensorUUID];
      v44 = v53 = v36;
      v52 = [uuid2 hmf_isEqualToUUID:v44];

      v36 = v53;
      if (v52)
      {
        goto LABEL_24;
      }
    }

    v9 = -[HMDHome _isRetrievalInProgressForPrimaryAccessory:linkType:](self, "_isRetrievalInProgressForPrimaryAccessory:linkType:", v26, [serverCopy linkType]);
LABEL_28:
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
  return v9;
}

uint64_t __60__HMDHome__shouldAvoidTombstoningAccessoryServer_accessory___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 accessoryUUID];
  v4 = [*(a1 + 32) uuid];
  v5 = [v3 isEqual:v4];

  return v5;
}

- (BOOL)_isEventTriggerOnLocalDeviceForAccessory:(id)accessory
{
  v20 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  triggers = [(HMDHome *)self triggers];
  v6 = [triggers countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(triggers);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 isEventTriggerOnLocalDeviceForAccessory:accessoryCopy];
        if (v12)
        {
          LOBYTE(v6) = 1;
          goto LABEL_14;
        }
      }

      v6 = [triggers countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_14:

  v13 = *MEMORY[0x277D85DE8];
  return v6;
}

- (BOOL)_isEventTriggerOnRemoteGatewayForAccessory:(id)accessory
{
  v20 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  triggers = [(HMDHome *)self triggers];
  v6 = [triggers countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(triggers);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 isEventTriggerOnRemoteGatewayForAccessory:accessoryCopy];
        if (v12)
        {
          LOBYTE(v6) = 1;
          goto LABEL_14;
        }
      }

      v6 = [triggers countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_14:

  v13 = *MEMORY[0x277D85DE8];
  return v6;
}

- (BOOL)_isRegisteredForNotificationsForClients:(id)clients
{
  clientsCopy = clients;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = clientsCopy;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  isClientRegisteredForNotifications = [v5 isClientRegisteredForNotifications];

  return isClientRegisteredForNotifications;
}

- (BOOL)_isRegisteredForNotificationsWithRemoteGateway:(id)gateway
{
  v32 = *MEMORY[0x277D85DE8];
  gatewayCopy = gateway;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = gatewayCopy;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  v29 = 0u;
  services = [v5 services];
  v7 = [services copy];

  v8 = [v7 countByEnumeratingWithState:&v26 objects:v31 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v27;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v27 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v26 + 1) + 8 * i);
        v22 = 0u;
        v23 = 0u;
        v24 = 0u;
        v25 = 0u;
        characteristics = [v12 characteristics];
        v14 = [characteristics copy];

        v15 = [v14 countByEnumeratingWithState:&v22 objects:v30 count:16];
        if (v15)
        {
          v16 = v15;
          v17 = *v23;
          while (2)
          {
            for (j = 0; j != v16; ++j)
            {
              if (*v23 != v17)
              {
                objc_enumerationMutation(v14);
              }

              if ([*(*(&v22 + 1) + 8 * j) notificationRegisteredWithRemoteGateway])
              {

                v19 = 1;
                goto LABEL_22;
              }
            }

            v16 = [v14 countByEnumeratingWithState:&v22 objects:v30 count:16];
            if (v16)
            {
              continue;
            }

            break;
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v26 objects:v31 count:16];
      v19 = 0;
    }

    while (v9);
  }

  else
  {
    v19 = 0;
  }

LABEL_22:

  v20 = *MEMORY[0x277D85DE8];
  return v19;
}

- (void)retrieveHAPAccessoryForHMDAccessory:(id)accessory linkType:(int64_t)type forceRetrieve:(BOOL)retrieve queue:(id)queue completion:(id)completion
{
  accessoryCopy = accessory;
  queueCopy = queue;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke;
  v19[3] = &unk_278675DA0;
  v19[4] = self;
  v20 = accessoryCopy;
  v22 = completionCopy;
  typeCopy = type;
  retrieveCopy = retrieve;
  v21 = queueCopy;
  v16 = queueCopy;
  v17 = completionCopy;
  v18 = accessoryCopy;
  dispatch_async(workQueue, v19);
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v3 = *(a1 + 72);
  v4 = *(a1 + 64);
  if (*(a1 + 56))
  {
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_2;
    v7[3] = &unk_278689A68;
    v8 = *(a1 + 48);
    v9 = *(a1 + 56);
    [v1 _retrieveHAPAccessoryForHMDHAPAccessory:v2 linkType:v4 forceRetrieve:v3 completion:v7];
  }

  else
  {
    v6 = *(a1 + 32);

    [v6 _retrieveHAPAccessoryForHMDHAPAccessory:v2 linkType:v4 forceRetrieve:v3 completion:0];
  }
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  if (v4)
  {
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_3;
    v7[3] = &unk_27868A7A0;
    v9 = *(a1 + 40);
    v8 = v3;
    dispatch_async(v4, v7);
  }

  else
  {
    v5 = _Block_copy(*(a1 + 40));
    v6 = v5;
    if (v5)
    {
      (*(v5 + 2))(v5, v3);
    }
  }
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_3(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  if (v2)
  {
    v3 = v2;
    (*(v2 + 2))(v2, *(a1 + 32));
    v2 = v3;
  }
}

- (HMFMessageDestination)messageDestination
{
  v3 = objc_alloc(MEMORY[0x277D0F820]);
  messageTargetUUID = [(HMDHome *)self messageTargetUUID];
  v5 = [v3 initWithTarget:messageTargetUUID];

  return v5;
}

- (void)_removeCorruptAccessories
{
  selfCopy = self;
  v43 = *MEMORY[0x277D85DE8];
  accessories = [(HMDHome *)self accessories];
  v26 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v4 = accessories;
  v29 = [v4 countByEnumeratingWithState:&v30 objects:v42 count:16];
  if (v29)
  {
    v6 = *v31;
    *&v5 = 138544130;
    v23 = v5;
    v24 = v4;
    v25 = selfCopy;
    do
    {
      v7 = 0;
      do
      {
        if (*v31 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v30 + 1) + 8 * v7);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        identifier = [v8 identifier];
        if (identifier)
        {
          v12 = identifier;
          if (!v10)
          {

LABEL_16:
            [v26 addObject:{v8, v23}];
            goto LABEL_17;
          }

          uniqueIdentifier = [v10 uniqueIdentifier];

          if (uniqueIdentifier)
          {
            goto LABEL_16;
          }
        }

        v14 = objc_autoreleasePoolPush();
        v15 = selfCopy;
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
        {
          v27 = HMFGetLogIdentifier();
          uuid = [v8 uuid];
          uUIDString = [uuid UUIDString];
          identifier2 = [v8 identifier];
          [v10 uniqueIdentifier];
          v28 = v14;
          v21 = v20 = v6;
          *buf = v23;
          v35 = v27;
          v36 = 2112;
          v37 = uUIDString;
          v38 = 2112;
          v39 = identifier2;
          v40 = 2112;
          v41 = v21;
          _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_DEBUG, "%{public}@Incomplete accessory: %@ (%@ / %@)", buf, 0x2Au);

          v6 = v20;
          v14 = v28;

          v4 = v24;
          selfCopy = v25;
        }

        objc_autoreleasePoolPop(v14);
LABEL_17:

        ++v7;
      }

      while (v29 != v7);
      v29 = [v4 countByEnumeratingWithState:&v30 objects:v42 count:16];
    }

    while (v29);
  }

  [(HMDHome *)selfCopy setAccessories:v26];
  v22 = *MEMORY[0x277D85DE8];
}

- (void)_encodeActionSets:(id)sets coder:(id)coder
{
  setsCopy = sets;
  coderCopy = coder;
  if ([(HMDHome *)self shouldWeSendAutomationsToClients])
  {
    v7 = [MEMORY[0x277CBEB18] arrayWithArray:setsCopy];
    v8 = [MEMORY[0x277CCAC30] predicateWithFormat:@"type == %@", *MEMORY[0x277CCF1A8]];
    v9 = [v7 filteredArrayUsingPredicate:v8];
    if ([v9 count])
    {
      v10 = [v9 copy];
      [coderCopy encodeObject:v10 forKey:@"actionSets"];
    }

    if (([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
    {
      v11 = [v7 arrayByExcludingObjectsInArray:v9];
      [coderCopy encodeObject:v11 forKey:@"builtinActionSets"];
    }
  }
}

- (void)encodeMediaSystemsWithCoder:(id)coder modifiedOptions:(unint64_t)options
{
  optionsCopy = options;
  coderCopy = coder;
  if ((optionsCopy & 0xC0) != 0)
  {
    v11 = coderCopy;
    hmd_isForXPCTransport = [coderCopy hmd_isForXPCTransport];
    mediaSystemController = [(HMDHome *)self mediaSystemController];
    v9 = mediaSystemController;
    if (hmd_isForXPCTransport)
    {
      filteredMediaSystems = [mediaSystemController filteredMediaSystems];
      [v11 encodeObject:filteredMediaSystems forKey:*MEMORY[0x277CD2480]];
    }

    else
    {
      [v11 encodeObject:mediaSystemController forKey:*MEMORY[0x277CD2448]];
    }

    coderCopy = v11;
  }
}

- (void)_encodeObjectsWithAccessoriesWithCoder:(id)coder
{
  v87 = *MEMORY[0x277D85DE8];
  coderCopy = coder;
  hmd_isForXPCTransport = [coderCopy hmd_isForXPCTransport];
  hmd_isForLocalStore = [coderCopy hmd_isForLocalStore];
  hmd_isForRemoteTransport = [coderCopy hmd_isForRemoteTransport];
  hmd_isForRemoteTransportOnSameAccount = [coderCopy hmd_isForRemoteTransportOnSameAccount];
  hmd_isForRemoteGatewayCoder = [coderCopy hmd_isForRemoteGatewayCoder];
  hmd_isForXPCTransportEntitledForSPIAccess = [coderCopy hmd_isForXPCTransportEntitledForSPIAccess];
  hmd_homeManagerOptions = [coderCopy hmd_homeManagerOptions];
  v12 = hmd_homeManagerOptions;
  if (hmd_homeManagerOptions)
  {
    v13 = hmd_homeManagerOptions | 0x9FD0;
    if (!hmd_isForXPCTransportEntitledForSPIAccess)
    {
      v13 = hmd_homeManagerOptions;
    }

    if (hmd_isForRemoteTransportOnSameAccount)
    {
      v14 = hmd_homeManagerOptions;
    }

    else
    {
      v14 = -1;
    }

    if (!hmd_isForRemoteTransport)
    {
      v14 = hmd_homeManagerOptions;
    }

    if (hmd_isForXPCTransport)
    {
      v15 = v13;
    }

    else
    {
      v15 = v14;
    }

    [(HMDHome *)self __encodeAccessoriesWithCoder:coderCopy options:v15];
    [(HMDHome *)self encodeMediaSystemsWithCoder:coderCopy modifiedOptions:v15];
    if (([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
    {
      serviceGroups = [(HMDHome *)self serviceGroups];
      [coderCopy encodeObject:serviceGroups forKey:*MEMORY[0x277CD25E8]];
    }

    actionSets = [(HMDHome *)self actionSets];
    [(HMDHome *)self _encodeActionSets:actionSets coder:coderCopy];

    if ((((hmd_isForXPCTransport | hmd_isForLocalStore) & 1) != 0 || ((hmd_isForRemoteTransport ^ 1 | hmd_isForRemoteTransportOnSameAccount) & 1) == 0 || ((hmd_isForRemoteTransportOnSameAccount ^ 1 | hmd_isForRemoteGatewayCoder) & 1) == 0) && [(HMDHome *)self shouldWeSendAutomationsToClients])
    {
      triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
      [coderCopy encodeObject:triggerOwnedActionSets forKey:@"HM.triggerOwnedActionSets"];
    }

    isWatch();
    if (hmd_isForXPCTransport && hmd_isForXPCTransportEntitledForSPIAccess & 1 | !isAppleTV())
    {
      v69 = hmd_isForXPCTransportEntitledForSPIAccess;
      v19 = MEMORY[0x277CBEB18];
      triggers = [(HMDHome *)self triggers];
      v21 = [v19 arrayWithCapacity:{objc_msgSend(triggers, "count")}];

      v80 = 0u;
      v81 = 0u;
      v78 = 0u;
      v79 = 0u;
      selfCopy = self;
      triggers2 = [(HMDHome *)self triggers];
      v23 = [triggers2 countByEnumeratingWithState:&v78 objects:v86 count:16];
      if (v23)
      {
        v24 = v23;
        v25 = *v79;
        p_superclass = HMDIDSActivityRegistrationModel.superclass;
        p_cache = &OBJC_METACLASS___HMDAccessoryFirmwareUpdateManagerWingman.cache;
        v68 = *v79;
        do
        {
          for (i = 0; i != v24; ++i)
          {
            if (*v79 != v25)
            {
              objc_enumerationMutation(triggers2);
            }

            v29 = *(*(&v78 + 1) + 8 * i);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v30 = v29;
            }

            else
            {
              v30 = 0;
            }

            v31 = v30;

            if (v31)
            {
              [v21 addObject:v29];
            }

            else
            {
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v32 = p_superclass;
                v33 = triggers2;
                v34 = coderCopy;
                v35 = p_cache;
                v36 = v29;
                significantEvent = [v36 significantEvent];

                if ((significantEvent == 0) | v69 & 1)
                {
                  [v21 addObject:v36];
                }

                p_cache = v35;
                coderCopy = v34;
                triggers2 = v33;
                p_superclass = v32;
                v25 = v68;
              }
            }
          }

          v24 = [triggers2 countByEnumeratingWithState:&v78 objects:v86 count:16];
        }

        while (v24);
      }

      if ([(HMDHome *)selfCopy shouldWeSendAutomationsToClients])
      {
        v38 = [v21 copy];
        [coderCopy encodeObject:v38 forKey:@"triggers"];
      }
    }

    else if (([coderCopy hmd_isForLocalStore] & 1) != 0 || objc_msgSend(coderCopy, "hmd_isForRemoteTransport") && (objc_msgSend(coderCopy, "hmd_isForRemoteTransportOnSameAccount") & 1) == 0 && (objc_msgSend(coderCopy, "hmd_isForRemoteUserAdministrator") & 1) != 0 || objc_msgSend(coderCopy, "hmd_isForRemoteTransportOnSameAccount") && (objc_msgSend(coderCopy, "hmd_isForRemoteGatewayCoder") & 1) == 0)
    {
      array = [MEMORY[0x277CBEB18] array];
      array2 = [MEMORY[0x277CBEB18] array];
      array3 = [MEMORY[0x277CBEB18] array];
      v74 = 0u;
      v75 = 0u;
      v76 = 0u;
      v77 = 0u;
      triggers3 = [(HMDHome *)self triggers];
      v43 = [triggers3 countByEnumeratingWithState:&v74 objects:v85 count:16];
      if (v43)
      {
        v44 = v43;
        v45 = *v75;
        do
        {
          for (j = 0; j != v44; ++j)
          {
            if (*v75 != v45)
            {
              objc_enumerationMutation(triggers3);
            }

            [array addObject:*(*(&v74 + 1) + 8 * j)];
          }

          v44 = [triggers3 countByEnumeratingWithState:&v74 objects:v85 count:16];
        }

        while (v44);
      }

      v47 = [array2 copy];
      [coderCopy encodeObject:v47 forKey:@"HM.triggers"];

      v48 = [array3 copy];
      [coderCopy encodeObject:v48 forKey:@"HM.sharedActivationTriggers"];

      if ([coderCopy hmd_isForLocalStore])
      {
        v49 = [array copy];
        [coderCopy encodeObject:v49 forKey:@"triggers"];

        _updateAndGetOwnedTriggers = [(HMDHome *)self _updateAndGetOwnedTriggers];
        [coderCopy encodeObject:_updateAndGetOwnedTriggers forKey:@"HM.deviceOwnedTriggers"];
      }
    }

    else if ([coderCopy hmd_isForNonAdminSharedUser])
    {
      v52 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v54 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v54, OS_LOG_TYPE_INFO))
      {
        v55 = HMFGetLogIdentifier();
        *buf = 138543362;
        v84 = v55;
        _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_INFO, "%{public}@Syncing triggers to remote transport", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v52);
      array4 = [MEMORY[0x277CBEB18] array];
      v70 = 0u;
      v71 = 0u;
      v72 = 0u;
      v73 = 0u;
      triggers4 = [(HMDHome *)selfCopy2 triggers];
      v58 = [triggers4 countByEnumeratingWithState:&v70 objects:v82 count:16];
      if (v58)
      {
        v59 = v58;
        v60 = *v71;
        do
        {
          for (k = 0; k != v59; ++k)
          {
            if (*v71 != v60)
            {
              objc_enumerationMutation(triggers4);
            }

            v62 = *(*(&v70 + 1) + 8 * k);
            hmd_supportedFeatures = [coderCopy hmd_supportedFeatures];
            hmd_user = [coderCopy hmd_user];
            v65 = [v62 compatible:hmd_supportedFeatures user:hmd_user];

            if (v65)
            {
              [array4 addObject:v62];
            }
          }

          v59 = [triggers4 countByEnumeratingWithState:&v70 objects:v82 count:16];
        }

        while (v59);
      }

      v66 = [array4 copy];
      [coderCopy encodeObject:v66 forKey:@"HM.triggers"];
    }
  }

  else
  {
    [(HMDHome *)self __encodeAccessoriesWithCoder:coderCopy options:hmd_homeManagerOptions];
    [(HMDHome *)self encodeMediaSystemsWithCoder:coderCopy modifiedOptions:v12];
  }

  v51 = *MEMORY[0x277D85DE8];
}

- (void)__encodeAccessoriesWithCoder:(id)coder options:(unint64_t)options
{
  optionsCopy = options;
  v91 = *MEMORY[0x277D85DE8];
  coderCopy = coder;
  accessories = [(HMDHome *)self accessories];
  v6 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v7 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v76 = 0u;
  v77 = 0u;
  v78 = 0u;
  v79 = 0u;
  v8 = accessories;
  v9 = [v8 countByEnumeratingWithState:&v76 objects:v90 count:16];
  v65 = v6;
  v66 = v7;
  v67 = v8;
  if (v9)
  {
    v10 = v9;
    v11 = *v77;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v77 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v76 + 1) + 8 * i);
        isCurrentAccessory = [v13 isCurrentAccessory];
        if ((optionsCopy & 0x10) != 0 && isCurrentAccessory)
        {
          [v7 addObject:v13];
          continue;
        }

        v15 = v13;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v16 = v15;
        }

        else
        {
          v16 = 0;
        }

        v17 = v16;

        if (v17)
        {
          if ((optionsCopy & 0x100) != 0)
          {
            [v6 addObject:v17];
          }

          goto LABEL_51;
        }

        v18 = v15;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (v20)
        {
          if ((optionsCopy & 0x40) != 0 || (optionsCopy & 0x800) != 0 && ([v20 device], v21 = objc_claimAutoreleasedReturnValue(), v21, v21))
          {
            [v7 addObject:v20];
          }

          goto LABEL_50;
        }

        v22 = v18;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v23 = v22;
        }

        else
        {
          v23 = 0;
        }

        v24 = v23;

        if (!v24)
        {
LABEL_41:
          v31 = v22;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v32 = v31;
          }

          else
          {
            v32 = 0;
          }

          v33 = v32;

          if (v33)
          {
            [v66 addObject:v33];
          }

          goto LABEL_49;
        }

        hostAccessory = [v24 hostAccessory];
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & 1) == 0 || !hostAccessory)
        {
          if ([v24 hasTelevisionService])
          {
            if ((optionsCopy & 0x400) == 0)
            {
              goto LABEL_49;
            }

LABEL_47:
            v30 = v66;
          }

          else
          {
            networkRouterController = [v24 networkRouterController];

            if (networkRouterController)
            {
              if ((optionsCopy & 0x1000) == 0)
              {
                goto LABEL_49;
              }

              goto LABEL_47;
            }

            if ((optionsCopy & 0x200) != 0)
            {
              goto LABEL_47;
            }

            hasSmartSpeakerService = [v24 hasSmartSpeakerService];
            if ((optionsCopy & 0x100) == 0 || !hasSmartSpeakerService)
            {
              siriEndpointProfile = [v24 siriEndpointProfile];

              if ((optionsCopy & 0x8000) == 0 || !siriEndpointProfile)
              {
                goto LABEL_41;
              }
            }

            v30 = v66;
          }

          [v30 addObject:v22];
        }

LABEL_49:

        v6 = v65;
        v7 = v66;
LABEL_50:

        v8 = v67;
LABEL_51:
      }

      v10 = [v8 countByEnumeratingWithState:&v76 objects:v90 count:16];
    }

    while (v10);
  }

  v34 = objc_autoreleasePoolPush();
  selfCopy = self;
  v36 = HMFGetOSLogHandle();
  v37 = coderCopy;
  if (os_log_type_enabled(v36, OS_LOG_TYPE_DEBUG))
  {
    v38 = HMFGetLogIdentifier();
    hmd_clientIdentifier = [coderCopy hmd_clientIdentifier];
    v40 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v66, "count")}];
    shortDescription = [v66 shortDescription];
    *buf = 138544130;
    v83 = v38;
    v84 = 2112;
    v85 = hmd_clientIdentifier;
    v86 = 2112;
    v87 = v40;
    v88 = 2112;
    v89 = shortDescription;
    _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_DEBUG, "%{public}@encoded Accessories [%@]: %@, %@", buf, 0x2Au);

    v6 = v65;
    v7 = v66;

    v8 = v67;
  }

  objc_autoreleasePoolPop(v34);
  v42 = [v7 copy];
  [coderCopy encodeObject:v42 forKey:@"accessories"];

  v43 = [v6 copy];
  [coderCopy encodeObject:v43 forKey:@"accessories.airplay"];

  if ((optionsCopy & 5) == 0)
  {
    v44 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v8, "count")}];
    v72 = 0u;
    v73 = 0u;
    v74 = 0u;
    v75 = 0u;
    v45 = v7;
    v46 = [v45 countByEnumeratingWithState:&v72 objects:v81 count:16];
    if (v46)
    {
      v47 = v46;
      v48 = *v73;
      do
      {
        for (j = 0; j != v47; ++j)
        {
          if (*v73 != v48)
          {
            objc_enumerationMutation(v45);
          }

          v50 = *(*(&v72 + 1) + 8 * j);
          room = [v50 room];

          if (room)
          {
            room2 = [v50 room];
            [v44 addObject:room2];
          }
        }

        v47 = [v45 countByEnumeratingWithState:&v72 objects:v81 count:16];
      }

      while (v47);
    }

    v70 = 0u;
    v71 = 0u;
    v68 = 0u;
    v69 = 0u;
    v53 = v6;
    v54 = [v53 countByEnumeratingWithState:&v68 objects:v80 count:16];
    if (v54)
    {
      v55 = v54;
      v56 = *v69;
      do
      {
        for (k = 0; k != v55; ++k)
        {
          if (*v69 != v56)
          {
            objc_enumerationMutation(v53);
          }

          v58 = *(*(&v68 + 1) + 8 * k);
          room3 = [v58 room];

          if (room3)
          {
            room4 = [v58 room];
            [v44 addObject:room4];
          }
        }

        v55 = [v53 countByEnumeratingWithState:&v68 objects:v80 count:16];
      }

      while (v55);
    }

    allObjects = [v44 allObjects];
    v37 = coderCopy;
    [coderCopy encodeObject:allObjects forKey:@"rooms"];

    v7 = v66;
  }

  v62 = *MEMORY[0x277D85DE8];
}

- (void)_encodeWithCoder:(id)coder
{
  v306 = *MEMORY[0x277D85DE8];
  coderCopy = coder;
  hmd_isForXPCTransport = [coderCopy hmd_isForXPCTransport];
  hmd_isForLocalStore = [coderCopy hmd_isForLocalStore];
  hmd_isForXPCTransportEntitledForSPIAccess = [coderCopy hmd_isForXPCTransportEntitledForSPIAccess];
  hmd_isForRemoteTransportOnSameAccount = [coderCopy hmd_isForRemoteTransportOnSameAccount];
  hmd_homeManagerOptions = [coderCopy hmd_homeManagerOptions];
  v243 = hmd_isForLocalStore;
  if (hmd_isForLocalStore)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
    {
      v10 = HMFGetLogIdentifier();
      [(HMDHome *)selfCopy isOwnerUser];
      v11 = HMFBooleanToString();
      *buf = 138543618;
      v291 = v10;
      v292 = 2112;
      v293 = v11;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Encoding isOwnerUser : %@ for HH2 migration", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    [coderCopy encodeBool:-[HMDHome isOwnerUser](selfCopy forKey:{"isOwnerUser"), @"HM.Owner.HH2.MI"}];
  }

  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];
  [coderCopy encodeObject:uUIDString forKey:@"homeUUID"];

  ownerName = [(HMDHome *)self ownerName];
  [coderCopy encodeObject:ownerName forKey:@"homeAdmin"];

  owner = [(HMDHome *)self owner];
  uuid2 = [owner uuid];
  uUIDString2 = [uuid2 UUIDString];
  [coderCopy encodeObject:uUIDString2 forKey:@"kHomeOwnerUUID"];

  creationDate = [(HMDHome *)self creationDate];
  [coderCopy encodeObject:creationDate forKey:@"creationDate"];

  firstHAPAccessoryAddedDate = [(HMDHome *)self firstHAPAccessoryAddedDate];
  [coderCopy encodeObject:firstHAPAccessoryAddedDate forKey:@"firstHAPAccessoryAddedDate"];

  configurationVersion = [(HMDHome *)self configurationVersion];
  v21 = [MEMORY[0x277CCABB0] numberWithInteger:configurationVersion];
  [coderCopy encodeObject:v21 forKey:@"homeConfigVersion"];

  name = [(HMDHome *)self name];
  [coderCopy encodeObject:name forKey:@"homeName"];

  homeHubState = [(HMDHome *)self homeHubState];
  [coderCopy encodeInteger:homeHubState forKey:*MEMORY[0x277CCFFE8]];
  isMultiUserEnabled = [(HMDHome *)self isMultiUserEnabled];
  [coderCopy encodeBool:isMultiUserEnabled forKey:*MEMORY[0x277CD0450]];
  if (isFeatureHomeTheaterQFAEnabledForTests)
  {
    bOOLValue = [isFeatureHomeTheaterQFAEnabledForTests BOOLValue];
  }

  else
  {
    bOOLValue = 1;
  }

  [coderCopy encodeBool:bOOLValue forKey:*MEMORY[0x277CD0618]];
  soundCheckEnabled = [(HMDHome *)self soundCheckEnabled];
  [coderCopy encodeBool:soundCheckEnabled forKey:*MEMORY[0x277CD05F0]];
  v27 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome audioAnalysisClassifierOptions](self, "audioAnalysisClassifierOptions")}];
  [coderCopy encodeObject:v27 forKey:*MEMORY[0x277CCFE50]];

  didOnboardAudioAnalysis = [(HMDHome *)self didOnboardAudioAnalysis];
  [coderCopy encodeBool:didOnboardAudioAnalysis forKey:*MEMORY[0x277CCFE70]];
  v29 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome siriPhraseOptions](self, "siriPhraseOptions")}];
  [coderCopy encodeObject:v29 forKey:*MEMORY[0x277CD05E0]];

  locationServicesEnabled = [(HMDHome *)self locationServicesEnabled];
  [coderCopy encodeBool:locationServicesEnabled forKey:*MEMORY[0x277CD0050]];
  didOnboardLocationServices = [(HMDHome *)self didOnboardLocationServices];
  [coderCopy encodeBool:didOnboardLocationServices forKey:*MEMORY[0x277CCFEB0]];
  hasAnyUserAcknowledgedCameraRecordingOnboarding = [(HMDHome *)self hasAnyUserAcknowledgedCameraRecordingOnboarding];
  [coderCopy encodeBool:hasAnyUserAcknowledgedCameraRecordingOnboarding forKey:*MEMORY[0x277CCFFD0]];
  hasOnboardedForAccessCode = [(HMDHome *)self hasOnboardedForAccessCode];
  [coderCopy encodeBool:hasOnboardedForAccessCode forKey:*MEMORY[0x277CCFFD8]];
  hasOnboardedForWalletKey = [(HMDHome *)self hasOnboardedForWalletKey];
  [coderCopy encodeBool:hasOnboardedForWalletKey forKey:*MEMORY[0x277CCFFE0]];
  dismissedWalletKeyUWBUnlockOnboarding = [(HMDHome *)self dismissedWalletKeyUWBUnlockOnboarding];
  [coderCopy encodeBool:dismissedWalletKeyUWBUnlockOnboarding forKey:*MEMORY[0x277CCFEC8]];
  if (hmd_isForXPCTransport)
  {
    isAllowedToEnableAdaptiveTemperatureAutomations = [(HMDHome *)self isAllowedToEnableAdaptiveTemperatureAutomations];
    [coderCopy encodeBool:isAllowedToEnableAdaptiveTemperatureAutomations forKey:*MEMORY[0x277CCFE38]];
  }

  hmd_supportedFeatures = [coderCopy hmd_supportedFeatures];
  v38 = [hmd_supportedFeatures containsObject:&unk_283E71B28];

  v39 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v41 = HMFGetOSLogHandle();
  v42 = os_log_type_enabled(v41, OS_LOG_TYPE_INFO);
  if (v38)
  {
    if (v42)
    {
      v43 = HMFGetLogIdentifier();
      *buf = 138543362;
      v291 = v43;
      _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Forcing isUpdatedToHH2 to YES", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v39);
    isUpdatedToHH2 = 1;
  }

  else
  {
    if (v42)
    {
      v45 = HMFGetLogIdentifier();
      [(HMDHome *)selfCopy2 isUpdatedToHH2];
      v46 = HMFBooleanToString();
      *buf = 138543618;
      v291 = v45;
      v292 = 2112;
      v293 = v46;
      _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@isUpdatedToHH2 is set to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v39);
    isUpdatedToHH2 = [(HMDHome *)selfCopy2 isUpdatedToHH2];
  }

  [coderCopy encodeBool:isUpdatedToHH2 forKey:*MEMORY[0x277CD0698]];
  v47 = hmd_homeManagerOptions;
  if ([coderCopy hmd_isForXPCTransportEntitledForSPIAccess])
  {
    bulletinNotificationsSupported = [(HMDHome *)selfCopy2 bulletinNotificationsSupported];
    [coderCopy encodeBool:bulletinNotificationsSupported forKey:*MEMORY[0x277CCFE90]];
  }

  if (([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
  {
    if ((hmd_isForXPCTransport & hmd_isForXPCTransportEntitledForSPIAccess) != 1)
    {
      homeLocationHandler = [(HMDHome *)selfCopy2 homeLocationHandler];
      v56 = &kHomeLocationHandlerCodingKey;
      goto LABEL_27;
    }

    if ([coderCopy hmd_isForXPCTransportAuthorizedForLocationAccess])
    {
      homeLocationHandler2 = [(HMDHome *)selfCopy2 homeLocationHandler];
      location = [homeLocationHandler2 location];
      [coderCopy encodeObject:location forKey:@"homeLocation"];

      if ([coderCopy hmd_isForXPCTransportEntitledForHomeLocationAccess])
      {
        homeLocation = [(HMDHome *)selfCopy2 homeLocation];
        [coderCopy encodeInteger:homeLocation forKey:*MEMORY[0x277CD0060]];
      }
    }

    primaryResident = [(HMDHome *)selfCopy2 primaryResident];
    capabilities = [primaryResident capabilities];
    supportsSiriEndpointSetup = [capabilities supportsSiriEndpointSetup];

    v47 = hmd_homeManagerOptions;
    if (supportsSiriEndpointSetup)
    {
      homeLocationHandler = [objc_alloc(MEMORY[0x277D0F940]) initWithMajorVersion:7 minorVersion:2 updateVersion:2];
      v56 = MEMORY[0x277CD05D8];
LABEL_27:
      [coderCopy encodeObject:homeLocationHandler forKey:*v56];
    }
  }

  if (v243)
  {
    v57 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome lastSyncedConfigurationVersion](selfCopy2, "lastSyncedConfigurationVersion")}];
    [coderCopy encodeObject:v57 forKey:@"lastSyncedHomeConfigVersion"];

    reachabilityNotificationManager = [(HMDHome *)selfCopy2 reachabilityNotificationManager];
    reachabilityContext = [reachabilityNotificationManager reachabilityContext];
    [coderCopy encodeObject:reachabilityContext forKey:@"HMHH.residentReachabilityContext"];

    v47 = hmd_homeManagerOptions;
  }

  v244 = selfCopy2;
  if ((v47 & 9) != 0)
  {
    v238 = hmd_isForXPCTransport;
    strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v285 = 0u;
    v286 = 0u;
    v287 = 0u;
    v288 = 0u;
    _residentUsers = [(HMDHome *)selfCopy2 _residentUsers];
    v62 = [_residentUsers countByEnumeratingWithState:&v285 objects:v305 count:16];
    if (v62)
    {
      v63 = v62;
      v64 = *v286;
      do
      {
        for (i = 0; i != v63; ++i)
        {
          if (*v286 != v64)
          {
            objc_enumerationMutation(_residentUsers);
          }

          v66 = *(*(&v285 + 1) + 8 * i);
          userID = [v66 userID];
          v68 = [HMDDevice deviceWithDestination:userID];

          if (v68)
          {
            [strongToStrongObjectsMapTable setObject:v66 forKey:v68];
          }
        }

        v63 = [_residentUsers countByEnumeratingWithState:&v285 objects:v305 count:16];
      }

      while (v63);
    }

    objectEnumerator = [strongToStrongObjectsMapTable objectEnumerator];
    allObjects = [objectEnumerator allObjects];

    v246 = strongToStrongObjectsMapTable;
    if (hmd_isForXPCTransport && hmd_isForXPCTransportEntitledForSPIAccess & 1 | !isAppleTV())
    {
      array = [MEMORY[0x277CBEB18] array];
      selfCopy2 = v244;
      if (hmd_isForXPCTransportEntitledForSPIAccess)
      {
        v251 = coderCopy;
        owner2 = [(HMDHome *)v244 owner];
        isOwnerUser = [(HMDHome *)v244 isOwnerUser];
        v281 = 0u;
        v282 = 0u;
        v283 = 0u;
        v284 = 0u;
        users = [(HMDHome *)v244 users];
        v73 = [users countByEnumeratingWithState:&v281 objects:v304 count:16];
        if (v73)
        {
          v74 = v73;
          v75 = *v282;
          do
          {
            for (j = 0; j != v74; ++j)
            {
              if (*v282 != v75)
              {
                objc_enumerationMutation(users);
              }

              v77 = *(*(&v281 + 1) + 8 * j);
              if (!isOwnerUser || ([*(*(&v281 + 1) + 8 * j) isEqual:owner2] & 1) == 0)
              {
                userID2 = [v77 userID];
                if (!userID2)
                {
                  continue;
                }

                v79 = userID2;
                isRemoteGateway = [v77 isRemoteGateway];

                if (isRemoteGateway)
                {
                  continue;
                }
              }

              [array addObject:v77];
            }

            v74 = [users countByEnumeratingWithState:&v281 objects:v304 count:16];
          }

          while (v74);
        }

        selfCopy2 = v244;
        coderCopy = v251;
        hmd_isForXPCTransport = v238;
        strongToStrongObjectsMapTable = v246;
        if ([(HMDHome *)v244 isAdminUser])
        {
          v81 = MEMORY[0x277CBEB18];
          outgoingInvitations = [(HMDHome *)v244 outgoingInvitations];
          v83 = [v81 arrayWithCapacity:{objc_msgSend(outgoingInvitations, "count")}];

          v279 = 0u;
          v280 = 0u;
          v277 = 0u;
          v278 = 0u;
          outgoingInvitations2 = [(HMDHome *)v244 outgoingInvitations];
          v85 = [outgoingInvitations2 countByEnumeratingWithState:&v277 objects:v303 count:16];
          if (v85)
          {
            v86 = v85;
            v87 = *v278;
            do
            {
              for (k = 0; k != v86; ++k)
              {
                if (*v278 != v87)
                {
                  objc_enumerationMutation(outgoingInvitations2);
                }

                v89 = *(*(&v277 + 1) + 8 * k);
                user = [v89 user];
                isRemoteGateway2 = [user isRemoteGateway];

                if ((isRemoteGateway2 & 1) == 0)
                {
                  [v83 addObject:v89];
                }
              }

              v86 = [outgoingInvitations2 countByEnumeratingWithState:&v277 objects:v303 count:16];
            }

            while (v86);
          }

          v92 = [v83 copy];
          [v251 encodeObject:v92 forKey:@"HM.invitations"];

          hmd_isForXPCTransport = v238;
          selfCopy2 = v244;
        }
      }

      else
      {
        [(HMDHome *)v244 isAdminUser];
      }

      array2 = array;
      v159 = [array copy];
      [coderCopy encodeObject:v159 forKey:@"users"];

      [coderCopy encodeBool:-[HMDHome isAdminUser](selfCopy2 forKey:{"isAdminUser"), @"isAdminUser"}];
      [coderCopy encodeBool:-[HMDHome isOwnerUser](selfCopy2 forKey:{"isOwnerUser"), @"HM.isOwnerUser"}];
      isAccessToHomeAllowed = [(HMDHome *)selfCopy2 isAccessToHomeAllowed];
      [coderCopy encodeBool:isAccessToHomeAllowed forKey:*MEMORY[0x277CD0018]];
      v47 = hmd_homeManagerOptions;
      if ((isAccessToHomeAllowed & 1) == 0)
      {
        accessNotAllowedReasonCode = [(HMDHome *)selfCopy2 accessNotAllowedReasonCode];
        [coderCopy encodeInteger:accessNotAllowedReasonCode forKey:*MEMORY[0x277CCFD90]];
      }

      overriddenHomeAccessControl = [(HMDHome *)selfCopy2 overriddenHomeAccessControl];

      if (!overriddenHomeAccessControl)
      {
        goto LABEL_136;
      }

      overriddenHomeAccessControl2 = [(HMDHome *)selfCopy2 overriddenHomeAccessControl];
      unsignedIntegerValue = [overriddenHomeAccessControl2 unsignedIntegerValue];
      [coderCopy encodeInteger:unsignedIntegerValue forKey:*MEMORY[0x277CCFD88]];
    }

    else
    {
      selfCopy2 = v244;
      if ((v243 | hmd_isForRemoteTransportOnSameAccount))
      {
        v93 = MEMORY[0x277CBEB18];
        users2 = [(HMDHome *)v244 users];
        array2 = [v93 arrayWithArray:users2];

        if ([coderCopy hmd_isForRemoteTransportOnSameAccount])
        {
          hmd_supportedFeatures2 = [coderCopy hmd_supportedFeatures];
          v97 = [hmd_supportedFeatures2 containsObject:&unk_283E71B40];

          if ((v97 & 1) == 0)
          {
            v275 = 0u;
            v276 = 0u;
            v273 = 0u;
            v274 = 0u;
            users3 = [(HMDHome *)v244 users];
            v99 = [users3 copy];

            v100 = [v99 countByEnumeratingWithState:&v273 objects:v302 count:16];
            if (v100)
            {
              v101 = v100;
              v102 = *v274;
              do
              {
                for (m = 0; m != v101; ++m)
                {
                  if (*v274 != v102)
                  {
                    objc_enumerationMutation(v99);
                  }

                  v104 = *(*(&v273 + 1) + 8 * m);
                  if ([v104 requiresMakoSupport])
                  {
                    [array2 removeObject:v104];
                  }
                }

                v101 = [v99 countByEnumeratingWithState:&v273 objects:v302 count:16];
              }

              while (v101);
            }
          }
        }

        v105 = [allObjects mutableCopy];
        [array2 removeObjectsInArray:allObjects];
        if (([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
        {
          usersPendingUserManagementOperations = [(HMDHome *)v244 usersPendingUserManagementOperations];
          [array2 removeObjectsInArray:usersPendingUserManagementOperations];

          usersPendingUserManagementOperations2 = [(HMDHome *)v244 usersPendingUserManagementOperations];
          [v105 removeObjectsInArray:usersPendingUserManagementOperations2];
        }

        v271 = 0u;
        v272 = 0u;
        v269 = 0u;
        v270 = 0u;
        overriddenHomeAccessControl2 = v105;
        v109 = [overriddenHomeAccessControl2 countByEnumeratingWithState:&v269 objects:v301 count:16];
        if (v109)
        {
          v110 = v109;
          v111 = *v270;
          do
          {
            for (n = 0; n != v110; ++n)
            {
              if (*v270 != v111)
              {
                objc_enumerationMutation(overriddenHomeAccessControl2);
              }

              legacyUser = [*(*(&v269 + 1) + 8 * n) legacyUser];
              [array2 addObject:legacyUser];
            }

            v110 = [overriddenHomeAccessControl2 countByEnumeratingWithState:&v269 objects:v301 count:16];
          }

          while (v110);
        }

        v114 = [array2 copy];
        [coderCopy encodeObject:v114 forKey:@"users"];

        v115 = [overriddenHomeAccessControl2 copy];
        [coderCopy encodeObject:v115 forKey:@"residentDevices"];
      }

      else
      {
        v47 = hmd_homeManagerOptions;
        if (![coderCopy hmd_isForRemoteTransport])
        {
LABEL_137:

          goto LABEL_138;
        }

        array2 = [MEMORY[0x277CBEB18] array];
        owner3 = [(HMDHome *)v244 owner];

        if (owner3)
        {
          owner4 = [(HMDHome *)v244 owner];
          [array2 addObject:owner4];

          hmd_user = [coderCopy hmd_user];

          if (hmd_user)
          {
            hmd_user2 = [coderCopy hmd_user];
            [array2 addObject:hmd_user2];
          }
        }

        v267 = 0u;
        v268 = 0u;
        v265 = 0u;
        v266 = 0u;
        v120 = allObjects;
        v121 = [v120 countByEnumeratingWithState:&v265 objects:v300 count:16];
        if (v121)
        {
          v122 = v121;
          v123 = *v266;
          do
          {
            for (ii = 0; ii != v122; ++ii)
            {
              if (*v266 != v123)
              {
                objc_enumerationMutation(v120);
              }

              legacyUser2 = [*(*(&v265 + 1) + 8 * ii) legacyUser];
              [array2 addObject:legacyUser2];
            }

            v122 = [v120 countByEnumeratingWithState:&v265 objects:v300 count:16];
          }

          while (v122);
        }

        v126 = [array2 copy];
        [coderCopy encodeObject:v126 forKey:@"users"];

        [coderCopy encodeObject:v120 forKey:@"residentDevices"];
        v250 = array2;
        if ([coderCopy hmd_isForRemoteUserAdministrator])
        {
          v127 = MEMORY[0x277CBEB18];
          users4 = [(HMDHome *)v244 users];
          v129 = [v127 arrayWithCapacity:{objc_msgSend(users4, "count")}];

          v263 = 0u;
          v264 = 0u;
          v261 = 0u;
          v262 = 0u;
          users5 = [(HMDHome *)v244 users];
          v131 = [users5 countByEnumeratingWithState:&v261 objects:v299 count:16];
          if (v131)
          {
            v132 = v131;
            v133 = *v262;
            do
            {
              for (jj = 0; jj != v132; ++jj)
              {
                if (*v262 != v133)
                {
                  objc_enumerationMutation(users5);
                }

                v135 = *(*(&v261 + 1) + 8 * jj);
                if (([v135 isRemoteGateway] & 1) == 0 && (objc_msgSend(v135, "privilege") == 4 || !objc_msgSend(v135, "privilege")))
                {
                  if (![v135 requiresMakoSupport] || (objc_msgSend(coderCopy, "hmd_supportedFeatures"), v136 = objc_claimAutoreleasedReturnValue(), v137 = objc_msgSend(v136, "containsObject:", &unk_283E71B40), v136, v137))
                  {
                    [v129 addObject:v135];
                  }
                }
              }

              v132 = [users5 countByEnumeratingWithState:&v261 objects:v299 count:16];
            }

            while (v132);
          }

          v138 = [v129 copy];
          [coderCopy encodeObject:v138 forKey:@"HM.sharedUsers"];

          hmd_isForXPCTransport = v238;
          strongToStrongObjectsMapTable = v246;
          array2 = v250;
        }

        v139 = objc_autoreleasePoolPush();
        selfCopy2 = v244;
        v140 = v244;
        v141 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v141, OS_LOG_TYPE_INFO))
        {
          v142 = HMFGetLogIdentifier();
          users6 = [(HMDHome *)v140 users];
          hmd_user3 = [coderCopy hmd_user];
          *buf = 138543874;
          v291 = v142;
          v292 = 2112;
          v293 = users6;
          v294 = 2112;
          v295 = hmd_user3;
          _os_log_impl(&dword_229538000, v141, OS_LOG_TYPE_INFO, "%{public}@encode users: %@, coder username: %@", buf, 0x20u);

          selfCopy2 = v244;
        }

        objc_autoreleasePoolPop(v139);
        v259 = 0u;
        v260 = 0u;
        v257 = 0u;
        v258 = 0u;
        overriddenHomeAccessControl2 = [(HMDHome *)v140 users];
        v252 = [overriddenHomeAccessControl2 countByEnumeratingWithState:&v257 objects:v298 count:16];
        if (v252)
        {
          v145 = *v258;
          v247 = *v258;
          v248 = overriddenHomeAccessControl2;
          v245 = v140;
          do
          {
            for (kk = 0; kk != v252; ++kk)
            {
              if (*v258 != v145)
              {
                objc_enumerationMutation(overriddenHomeAccessControl2);
              }

              v147 = *(*(&v257 + 1) + 8 * kk);
              hmd_user4 = [coderCopy hmd_user];
              v149 = [v147 isEqual:hmd_user4];

              if (v149)
              {
                v150 = objc_autoreleasePoolPush();
                v151 = v140;
                v152 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v152, OS_LOG_TYPE_INFO))
                {
                  v153 = HMFGetLogIdentifier();
                  users7 = [(HMDHome *)v151 users];
                  hmd_user5 = [coderCopy hmd_user];
                  [v147 presenceAuthStatus];
                  v157 = v156 = coderCopy;
                  *buf = 138544130;
                  v291 = v153;
                  v292 = 2112;
                  v293 = users7;
                  v294 = 2112;
                  v295 = hmd_user5;
                  v296 = 2112;
                  v297 = v157;
                  _os_log_impl(&dword_229538000, v152, OS_LOG_TYPE_INFO, "%{public}@encode users: %@, coder username: %@, %@", buf, 0x2Au);

                  coderCopy = v156;
                  strongToStrongObjectsMapTable = v246;

                  array2 = v250;
                  v140 = v245;
                }

                objc_autoreleasePoolPop(v150);
                presenceAuthStatus = [v147 presenceAuthStatus];
                [presenceAuthStatus addToCoder:coderCopy];

                v145 = v247;
                overriddenHomeAccessControl2 = v248;
              }
            }

            v252 = [overriddenHomeAccessControl2 countByEnumeratingWithState:&v257 objects:v298 count:16];
          }

          while (v252);
          hmd_isForXPCTransport = v238;
          selfCopy2 = v244;
        }
      }

      v47 = hmd_homeManagerOptions;
    }

LABEL_136:
    goto LABEL_137;
  }

LABEL_138:
  if ((v47 & 0x9FD1) != 0)
  {
    [(HMDHome *)selfCopy2 _encodeObjectsWithAccessoriesWithCoder:coderCopy];
  }

  roomForEntireHome = [(HMDHome *)selfCopy2 roomForEntireHome];
  [coderCopy encodeObject:roomForEntireHome forKey:@"roomForEntireHome"];

  if ((v47 & 5) != 0 && ([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
  {
    rooms = [(HMDHome *)selfCopy2 rooms];
    [coderCopy encodeObject:rooms forKey:@"rooms"];

    zones = [(HMDHome *)selfCopy2 zones];
    [coderCopy encodeObject:zones forKey:@"zones"];
  }

  if ((v47 & 0x801) != 0)
  {
    if (hmd_isForXPCTransport)
    {
      if (!hmd_isForXPCTransportEntitledForSPIAccess)
      {
        goto LABEL_149;
      }

      residentDeviceManager = [(HMDHome *)selfCopy2 residentDeviceManager];
      residentDevices = [residentDeviceManager residentDevices];

      v169 = @"residentDevices";
    }

    else
    {
      enabledResidents = [(HMDHome *)selfCopy2 enabledResidents];
      v171 = [enabledResidents na_filter:&__block_literal_global_2015];

      [coderCopy encodeInteger:objc_msgSend(v171 forKey:{"count"), @"HMD.nonIPadResidentDeviceCount"}];
      residentDevices = [(HMDHome *)selfCopy2 primaryNetworkRouterManagingDeviceUUID];
      v169 = @"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey";
    }

    [coderCopy encodeObject:residentDevices forKey:v169];

    v47 = hmd_homeManagerOptions;
  }

LABEL_149:
  if ((v47 & 0x85D1) != 0 && (![coderCopy hmd_isForXPCTransport] || objc_msgSend(coderCopy, "hmd_isForXPCTransportEntitledForSPIAccess")))
  {
    minimumMediaUserPrivilege = [(HMDHome *)selfCopy2 minimumMediaUserPrivilege];
    [coderCopy encodeInteger:minimumMediaUserPrivilege forKey:*MEMORY[0x277CD03F8]];
    isMediaPeerToPeerEnabled = [(HMDHome *)selfCopy2 isMediaPeerToPeerEnabled];
    [coderCopy encodeBool:isMediaPeerToPeerEnabled forKey:*MEMORY[0x277CD0410]];
    if (([coderCopy hmd_isForNonAdminSharedUser] & 1) == 0)
    {
      mediaPassword = [(HMDHome *)selfCopy2 mediaPassword];
      [coderCopy encodeObject:mediaPassword forKey:*MEMORY[0x277CD0400]];
    }
  }

  if ((v47 & 0x11) != 0 && (![coderCopy hmd_isForXPCTransport] || objc_msgSend(coderCopy, "hmd_isForXPCTransportEntitledForSPIAccess")))
  {
    isAutomaticSoftwareUpdateEnabled = [(HMDHome *)selfCopy2 isAutomaticSoftwareUpdateEnabled];
    [coderCopy encodeBool:isAutomaticSoftwareUpdateEnabled forKey:*MEMORY[0x277CCFE80]];
    isAutomaticThirdPartyAccessorySoftwareUpdateEnabled = [(HMDHome *)selfCopy2 isAutomaticThirdPartyAccessorySoftwareUpdateEnabled];
    [coderCopy encodeBool:isAutomaticThirdPartyAccessorySoftwareUpdateEnabled forKey:*MEMORY[0x277CCFE88]];
  }

  matterFabricID = [(HMDHome *)selfCopy2 matterFabricID];
  [coderCopy encodeObject:matterFabricID forKey:@"HM.matterFabricID"];

  if (v47)
  {
    if (v243)
    {
      featuresDataSource = [(HMDHome *)selfCopy2 featuresDataSource];
      isHomeActivityStateReplacesPresenceMonitorFeatureEnabled = [featuresDataSource isHomeActivityStateReplacesPresenceMonitorFeatureEnabled];

      if ((isHomeActivityStateReplacesPresenceMonitorFeatureEnabled & 1) == 0)
      {
        presenceMonitor = [(HMDHome *)selfCopy2 presenceMonitor];
        [coderCopy encodeObject:presenceMonitor forKey:@"kHMDHomePresenceMonitorCodingKey"];
      }

      unfilteredThreadNetworkID = [(HMDHome *)selfCopy2 unfilteredThreadNetworkID];
      [coderCopy encodeObject:unfilteredThreadNetworkID forKey:@"HMHM.threadNetworkID"];
    }

    if ([coderCopy hmd_isForRemoteGatewayCoder])
    {
      if (!hmd_isForXPCTransport)
      {
        goto LABEL_171;
      }
    }

    else
    {
      if ((hmd_isForXPCTransport & 1) == 0)
      {
        v185 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome allowsRemoteAccess](selfCopy2, "allowsRemoteAccess")}];
        [coderCopy encodeObject:v185 forKey:@"HM.allowsRemoteAccess"];

        networkProtectionGroupRegistry = [(HMDHome *)selfCopy2 networkProtectionGroupRegistry];
        persistedGroups = [networkProtectionGroupRegistry persistedGroups];
        [coderCopy encodeObject:persistedGroups forKey:*MEMORY[0x277CCFDB0]];

LABEL_171:
        appData = [(HMDHome *)selfCopy2 appData];
        [coderCopy encodeObject:appData forKey:@"HM.appDataRepository"];
LABEL_172:

        if (v243)
        {
          removedUsers = [(HMDHome *)selfCopy2 removedUsers];
          [coderCopy encodeObject:removedUsers forKey:@"HM.removedUsersCodingKey"];
        }

        else if (!hmd_isForRemoteTransportOnSameAccount)
        {
LABEL_176:
          if ((v243 | hmd_isForRemoteTransportOnSameAccount))
          {
            isWatch();
            if (([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
            {
              v191 = MEMORY[0x277CBEB18];
              outgoingInvitations3 = [(HMDHome *)v244 outgoingInvitations];
              v193 = [v191 arrayWithArray:outgoingInvitations3];

              if ([coderCopy hmd_isForRemoteTransportOnSameAccount])
              {
                hmd_supportedFeatures3 = [coderCopy hmd_supportedFeatures];
                v195 = [hmd_supportedFeatures3 containsObject:&unk_283E71B40];

                if ((v195 & 1) == 0)
                {
                  v196 = hmd_isForXPCTransport;
                  v255 = 0u;
                  v256 = 0u;
                  v253 = 0u;
                  v254 = 0u;
                  outgoingInvitations4 = [(HMDHome *)v244 outgoingInvitations];
                  v198 = [outgoingInvitations4 countByEnumeratingWithState:&v253 objects:v289 count:16];
                  if (v198)
                  {
                    v199 = v198;
                    v200 = *v254;
                    do
                    {
                      for (mm = 0; mm != v199; ++mm)
                      {
                        if (*v254 != v200)
                        {
                          objc_enumerationMutation(outgoingInvitations4);
                        }

                        v202 = *(*(&v253 + 1) + 8 * mm);
                        user2 = [v202 user];
                        if ([user2 requiresMakoSupport])
                        {
                          [v193 removeObject:v202];
                        }
                      }

                      v199 = [outgoingInvitations4 countByEnumeratingWithState:&v253 objects:v289 count:16];
                    }

                    while (v199);
                  }

                  hmd_isForXPCTransport = v196;
                }
              }

              v204 = [v193 copy];
              [coderCopy encodeObject:v204 forKey:@"HM.invitations"];
            }
          }

          if (![coderCopy hmd_isForXPCTransport] || objc_msgSend(coderCopy, "hmd_isForXPCTransportEntitledForSPIAccess"))
          {
            protectionMode = [(HMDHome *)v244 protectionMode];
            [coderCopy encodeInteger:protectionMode forKey:*MEMORY[0x277CD0458]];
          }

          if ([coderCopy hmd_isForXPCTransport])
          {
            if ([coderCopy hmd_isForXPCTransportEntitledForSPIAccess])
            {
              networkRouterSupportDisableReason = [(HMDHome *)v244 networkRouterSupportDisableReason];
              [coderCopy encodeInteger:networkRouterSupportDisableReason forKey:*MEMORY[0x277CD0460]];
            }

            networkRouterSupport = [(HMDHome *)v244 networkRouterSupport];
            [coderCopy encodeBool:(networkRouterSupport >> 2) & 1 forKey:*MEMORY[0x277CCFE10]];
          }

          threadNetworkID = [(HMDHome *)v244 threadNetworkID];
          if (threadNetworkID && [coderCopy hmd_isForXPCTransport])
          {
            hmd_isForXPCTransportEntitledForSPIAccess2 = [coderCopy hmd_isForXPCTransportEntitledForSPIAccess];

            if (!hmd_isForXPCTransportEntitledForSPIAccess2)
            {
              goto LABEL_203;
            }

            threadNetworkID = [(HMDHome *)v244 threadNetworkID];
            [coderCopy encodeObject:threadNetworkID forKey:*MEMORY[0x277CD0628]];
          }

LABEL_203:
          if (([coderCopy hmd_isForXPCTransport] & 1) == 0)
          {
            activeNetworkRouterUUID = [(HMDHome *)v244 activeNetworkRouterUUID];
            uUIDString3 = [activeNetworkRouterUUID UUIDString];
            [coderCopy encodeObject:uUIDString3 forKey:@"HMHM.activeNetworkRouter"];

            minimumNetworkRouterSupportHomeKitVersion = [(HMDHome *)v244 minimumNetworkRouterSupportHomeKitVersion];
            versionString = [minimumNetworkRouterSupportHomeKitVersion versionString];
            [coderCopy encodeObject:versionString forKey:@"HMHM.minimumNetworkRouterSupportHomeKitVersion"];

            minHomeKitVersionForAccessoryNetworkProtectionChange = [(HMDHome *)v244 minHomeKitVersionForAccessoryNetworkProtectionChange];
            versionString2 = [minHomeKitVersionForAccessoryNetworkProtectionChange versionString];
            [coderCopy encodeObject:versionString2 forKey:@"HMHM.minHomeKitVersionForAccessoryNetworkProtectionChangeCodingKey"];
          }

          if (hmd_isForXPCTransport)
          {
            if (![coderCopy hmd_isForXPCTransportEntitledForSPIAccess])
            {
LABEL_213:
              if ([coderCopy hmd_isForXPCTransportEntitledForSPIAccess])
              {
                primaryResidentNetworkInfo = [(HMDHome *)v244 primaryResidentNetworkInfo];
                [coderCopy encodeObject:primaryResidentNetworkInfo forKey:*MEMORY[0x277CD04F0]];
              }

              if ((v243 | hmd_isForRemoteTransportOnSameAccount))
              {
                chipStorage = [(HMDHome *)v244 chipStorage];
                [coderCopy encodeObject:chipStorage forKey:@"HMHM.chipStorage"];
              }

              if (!-[HMDHome isOwnerUser](v244, "isOwnerUser") && (([coderCopy hmd_isForLocalStore] & 1) != 0 || objc_msgSend(coderCopy, "hmd_isForRemoteTransportOnSameAccount")))
              {
                sharedHomeSourceVersion = [(HMDHome *)v244 sharedHomeSourceVersion];
                [coderCopy encodeObject:sharedHomeSourceVersion forKey:@"kHomeKitVersionStringKey"];
              }

              if ((hmd_isForXPCTransport & hmd_isForXPCTransportEntitledForSPIAccess) == 1)
              {
                primaryResident2 = [(HMDHome *)v244 primaryResident];
                capabilities2 = [primaryResident2 capabilities];
                supportsResidentActionSetStateEvaluation = [capabilities2 supportsResidentActionSetStateEvaluation];
                [coderCopy encodeBool:supportsResidentActionSetStateEvaluation forKey:*MEMORY[0x277CD05F8]];

                isEventLogEnabled = [(HMDHome *)v244 isEventLogEnabled];
                [coderCopy encodeBool:isEventLogEnabled forKey:*MEMORY[0x277CCFF08]];
                didOnboardEventLog = [(HMDHome *)v244 didOnboardEventLog];
                [coderCopy encodeBool:didOnboardEventLog forKey:*MEMORY[0x277CCFF10]];
                eventLogDuration = [(HMDHome *)v244 eventLogDuration];
                [coderCopy encodeInteger:eventLogDuration forKey:*MEMORY[0x277CCFF00]];
                timeZone = [(HMDHome *)v244 timeZone];
                [coderCopy encodeObject:timeZone forKey:*MEMORY[0x277CD0630]];

                numberOfCameras = [(HMDHome *)v244 numberOfCameras];
                [coderCopy encodeObject:numberOfCameras forKey:*MEMORY[0x277CD0478]];

                [coderCopy encodeBool:-[HMDHome supportsResidentSelection](v244 forKey:{"supportsResidentSelection"), @"HMHomeResidentSelectionSupported"}];
                userSelectedPreferredResident = [(HMDHome *)v244 userSelectedPreferredResident];
                [coderCopy encodeObject:userSelectedPreferredResident forKey:@"HMHomeUserSelectedPreferredResident"];

                autoSelectedPreferredResidents = [(HMDHome *)v244 autoSelectedPreferredResidents];
                [coderCopy encodeObject:autoSelectedPreferredResidents forKey:@"HMHomeAutoSelectedPreferredResidents"];
              }

              goto LABEL_223;
            }

            personManagerSettings = [(HMDHome *)v244 personManagerSettings];
            [coderCopy encodeObject:personManagerSettings forKey:*MEMORY[0x277CD04A0]];

            personManagerZoneUUID = [(HMDHome *)v244 personManagerZoneUUID];
            v218 = *MEMORY[0x277CD04B8];
          }

          else
          {
            personManagerSettings2 = [(HMDHome *)v244 personManagerSettings];
            [coderCopy encodeObject:personManagerSettings2 forKey:*MEMORY[0x277CD04A0]];

            personManagerZoneUUID2 = [(HMDHome *)v244 personManagerZoneUUID];
            [coderCopy encodeObject:personManagerZoneUUID2 forKey:*MEMORY[0x277CD04B8]];

            naturalLightingContext = [(HMDHome *)v244 naturalLightingContext];
            [coderCopy encodeObject:naturalLightingContext forKey:@"HM.nlcck"];

            if (([coderCopy hmd_isForLocalStore] & 1) != 0 || objc_msgSend(coderCopy, "hmd_isForRemoteUserAdministrator"))
            {
              labelsByAccessCode = [(HMDHome *)v244 labelsByAccessCode];
              [coderCopy encodeObject:labelsByAccessCode forKey:@"HMDHomeLabelsByAccessCodeCodingKey"];

              removedUserInfoByAccessCode = [(HMDHome *)v244 removedUserInfoByAccessCode];
              [coderCopy encodeObject:removedUserInfoByAccessCode forKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"];
            }

            personManagerZoneUUID = [(HMDHome *)v244 nfcReaderKey];
            v218 = @"HMDHomeNFCReaderKeyCodingKey";
          }

          [coderCopy encodeObject:personManagerZoneUUID forKey:v218];

          goto LABEL_213;
        }

        presenceAuthStatus2 = [(HMDHome *)selfCopy2 presenceAuthStatus];
        [presenceAuthStatus2 addToCoder:coderCopy];

        presenceComputeStatus = [(HMDHome *)selfCopy2 presenceComputeStatus];
        [presenceComputeStatus addToCoder:coderCopy];

        goto LABEL_176;
      }

      if (hmd_isForXPCTransportEntitledForSPIAccess)
      {
        networkProtectionGroupRegistry2 = [(HMDHome *)selfCopy2 networkProtectionGroupRegistry];
        activeGroups = [networkProtectionGroupRegistry2 activeGroups];
        [coderCopy encodeObject:activeGroups forKey:*MEMORY[0x277CCFDB0]];
      }
    }

    appData = [(HMDHome *)selfCopy2 appData];
    [appData encodeForXPCTransportWithCoder:coderCopy key:@"HM.appData"];
    goto LABEL_172;
  }

LABEL_223:

  v237 = *MEMORY[0x277D85DE8];
}

BOOL __28__HMDHome__encodeWithCoder___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 device];
  v3 = [v2 productInfo];
  v4 = [v3 productClass] != 3;

  return v4;
}

- (void)encodeWithCoder:(id)coder
{
  coderCopy = coder;
  v4 = objc_autoreleasePoolPush();
  [(HMDHome *)self _encodeWithCoder:coderCopy];
  objc_autoreleasePoolPop(v4);
}

- (id)_initWithCoder:(id)coder
{
  v401 = *MEMORY[0x277D85DE8];
  coderCopy = coder;
  v5 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"homeName"];
  v6 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"homeUUID"];
  v7 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v6];
  v8 = objc_alloc_init(HMDHomeDefaultDataSource);
  v342 = v5;
  v343 = v7;
  v9 = [(HMDHome *)self initWithName:v5 uuid:v7 defaultRoomUUID:0 owner:0 homeManager:0 presenceAuth:0 dataSource:v8];

  if (!v9)
  {
    v27 = v6;
    v28 = v5;
    goto LABEL_219;
  }

  v340 = v6;
  v10 = [HMDHome zoneIDFromHomeUUID:v9->_uuid];
  zoneID = v9->_zoneID;
  v9->_zoneID = v10;

  v353 = v9;
  v12 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"creationDate"];
  creationDate = v9->_creationDate;
  v9->_creationDate = v12;

  v14 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"firstHAPAccessoryAddedDate"];
  firstHAPAccessoryAddedDate = v9->_firstHAPAccessoryAddedDate;
  v9->_firstHAPAccessoryAddedDate = v14;

  v16 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"homeAdmin"];
  ownerName = v9->_ownerName;
  v9->_ownerName = v16;

  v344 = coderCopy;
  if ([coderCopy hmd_isHH2MigrationInProgress])
  {
    v9->_ownerUser = [coderCopy decodeBoolForKey:@"HM.Owner.HH2.MI"];
    v18 = objc_autoreleasePoolPush();
    v19 = v9;
    v20 = v18;
    v21 = v19;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      v23 = HMFGetLogIdentifier();
      ownerUser = v353->_ownerUser;
      v25 = HMFBooleanToString();
      [(HMDHome *)v21 isOwnerUser];
      v26 = HMFBooleanToString();
      *buf = 138543874;
      v396 = v23;
      v397 = 2112;
      v398 = v25;
      v399 = 2112;
      v400 = v26;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@HH2 Migration : isOwnerUser : %@ / %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v20);
    v9 = v353;
  }

  if (v9->_ownerUser)
  {
    localCapabilitiesDataSource = [(HMDHome *)v9 localCapabilitiesDataSource];
    isResidentCapable = [localCapabilitiesDataSource isResidentCapable];

    v9 = v353;
    if (isResidentCapable)
    {
      featuresDataSource = [(HMDHome *)v353 featuresDataSource];
      isHomeActivityStateReplacesPresenceMonitorFeatureEnabled = [featuresDataSource isHomeActivityStateReplacesPresenceMonitorFeatureEnabled];

      if ((isHomeActivityStateReplacesPresenceMonitorFeatureEnabled & 1) == 0)
      {
        v33 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"kHMDHomePresenceMonitorCodingKey"];
        makeHomePresenceMonitor = v33;
        if (!v33)
        {
          isHomeActivityStateReplacesPresenceMonitorFeatureEnabled = [(HMDHome *)v353 dataSource];
          makeHomePresenceMonitor = [isHomeActivityStateReplacesPresenceMonitorFeatureEnabled makeHomePresenceMonitor];
        }

        objc_storeStrong(&v353->_presenceMonitor, makeHomePresenceMonitor);
        if (!v33)
        {
        }
      }

      v35 = objc_alloc_init(HMDHomePeriodicReader);
      v9 = v353;
      periodicReader = v353->_periodicReader;
      v353->_periodicReader = v35;
    }
  }

  v37 = [[HMDHomeAdministratorHandler alloc] initWithHome:v9];
  administratorHandler = v9->_administratorHandler;
  v9->_administratorHandler = v37;

  if (v9->_ownerUser)
  {
    sharedHomeUpdateHandler = v9->_sharedHomeUpdateHandler;
    v9->_sharedHomeUpdateHandler = 0;
  }

  else
  {
    isWatch();
    v40 = objc_alloc_init(HMDSharedHomeUpdateHandler);
    v41 = v9->_sharedHomeUpdateHandler;
    v9->_sharedHomeUpdateHandler = v40;

    [(HMDSharedHomeUpdateHandler *)v9->_sharedHomeUpdateHandler configureWithHome:v9];
  }

  v42 = v344;
  v43 = [v344 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD2448]];
  mediaSystemController = v43;
  if (!v43)
  {
    mediaSystemController = v353->_mediaSystemController;
  }

  objc_storeStrong(&v353->_mediaSystemController, mediaSystemController);

  rooms = v353->_rooms;
  v46 = MEMORY[0x277CBEB98];
  v394[0] = objc_opt_class();
  v394[1] = objc_opt_class();
  v47 = [MEMORY[0x277CBEA60] arrayWithObjects:v394 count:2];
  v48 = [v46 setWithArray:v47];
  v49 = [v344 decodeObjectOfClasses:v48 forKey:@"rooms"];
  [(NSMutableArray *)rooms setArray:v49];

  zones = v353->_zones;
  v51 = MEMORY[0x277CBEB98];
  v393[0] = objc_opt_class();
  v393[1] = objc_opt_class();
  v52 = [MEMORY[0x277CBEA60] arrayWithObjects:v393 count:2];
  v53 = [v51 setWithArray:v52];
  v54 = [v344 decodeObjectOfClasses:v53 forKey:@"zones"];
  [(NSMutableArray *)zones setArray:v54];

  if ([v344 containsValueForKey:@"accessories"])
  {
    v55 = +[HMDHome supportedAccessoryClasses];
    v56 = [v344 decodeObjectOfClasses:v55 forKey:@"accessories"];
    [(HMDHome *)v353 _addAccessories:v56];

    v42 = v344;
  }

  if ([v42 containsValueForKey:@"accessories.airplay"])
  {
    v57 = +[HMDHome supportedAccessoryClasses];
    v58 = [v42 decodeObjectOfClasses:v57 forKey:@"accessories.airplay"];
    [(HMDHome *)v353 _addAccessories:v58];

    v42 = v344;
  }

  if ([v42 containsValueForKey:@"accessories.homepod"])
  {
    v59 = +[HMDHome supportedAccessoryClasses];
    v60 = [v42 decodeObjectOfClasses:v59 forKey:@"accessories.homepod"];
    [(HMDHome *)v353 _addAccessories:v60];

    v42 = v344;
  }

  if ([v42 containsValueForKey:@"accessories.homepod_6_1"])
  {
    v61 = +[HMDHome supportedAccessoryClasses];
    v62 = [v42 decodeObjectOfClasses:v61 forKey:@"accessories.homepod_6_1"];
    [(HMDHome *)v353 _addAccessories:v62];

    v42 = v344;
  }

  if ([v42 containsValueForKey:@"HM.AppleMediaAccessorySensor"])
  {
    v63 = +[HMDHome supportedAccessoryClasses];
    v64 = [v42 decodeObjectOfClasses:v63 forKey:@"HM.AppleMediaAccessorySensor"];
    [(HMDHome *)v353 _addAccessories:v64];

    v42 = v344;
  }

  v65 = *MEMORY[0x277CD0450];
  if ([v42 containsValueForKey:*MEMORY[0x277CD0450]])
  {
    -[HMDHome setMultiUserEnabled:](v353, "setMultiUserEnabled:", [v42 decodeBoolForKey:v65]);
  }

  v353->_soundCheckEnabled = [v42 decodeBoolForKey:*MEMORY[0x277CD05F0]];
  v66 = [v42 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CCFE50]];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v67 = v66;
  }

  else
  {
    v67 = 0;
  }

  v68 = v67;

  v353->_audioAnalysisClassifierOptions = [v68 unsignedIntegerValue];
  v353->_didOnboardAudioAnalysis = [v344 decodeBoolForKey:*MEMORY[0x277CCFE70]];
  v69 = [v344 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD05E0]];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v70 = v69;
  }

  else
  {
    v70 = 0;
  }

  v71 = v70;

  v353->_siriPhraseOptions = [v71 unsignedIntegerValue];
  v353->_locationServicesEnabled = [v344 decodeBoolForKey:*MEMORY[0x277CD0050]];
  v353->_didOnboardLocationServices = [v344 decodeBoolForKey:*MEMORY[0x277CCFEB0]];
  v72 = *MEMORY[0x277CCFFD0];
  if ([v344 containsValueForKey:*MEMORY[0x277CCFFD0]])
  {
    -[HMDHome setHasAnyUserAcknowledgedCameraRecordingOnboarding:](v353, "setHasAnyUserAcknowledgedCameraRecordingOnboarding:", [v344 decodeBoolForKey:v72]);
  }

  v73 = *MEMORY[0x277CCFFD8];
  if ([v344 containsValueForKey:*MEMORY[0x277CCFFD8]])
  {
    v353->_hasOnboardedForAccessCode = [v344 decodeBoolForKey:v73];
  }

  v74 = *MEMORY[0x277CCFFE0];
  if ([v344 containsValueForKey:*MEMORY[0x277CCFFE0]])
  {
    v353->_hasOnboardedForWalletKey = [v344 decodeBoolForKey:v74];
  }

  else
  {
    v353->_shouldEncodeHasOnboardedForWalletKey = 0;
  }

  serviceGroups = v353->_serviceGroups;
  v76 = MEMORY[0x277CBEB98];
  v392[0] = objc_opt_class();
  v392[1] = objc_opt_class();
  v77 = [MEMORY[0x277CBEA60] arrayWithObjects:v392 count:2];
  v78 = [v76 setWithArray:v77];
  v79 = [v344 decodeObjectOfClasses:v78 forKey:*MEMORY[0x277CD25E8]];
  [(NSMutableArray *)serviceGroups setArray:v79];

  v80 = MEMORY[0x277CBEB98];
  v391[0] = objc_opt_class();
  v391[1] = objc_opt_class();
  v81 = [MEMORY[0x277CBEA60] arrayWithObjects:v391 count:2];
  v82 = [v80 setWithArray:v81];

  actionSets = v353->_actionSets;
  v84 = [v344 decodeObjectOfClasses:v82 forKey:@"actionSets"];
  [(NSMutableArray *)actionSets setArray:v84];

  triggerOwnedActionSets = v353->_triggerOwnedActionSets;
  v86 = [v344 decodeObjectOfClasses:v82 forKey:@"HM.triggerOwnedActionSets"];
  [(NSMutableArray *)triggerOwnedActionSets setArray:v86];

  array = [MEMORY[0x277CBEB18] array];
  v339 = v82;
  v88 = [v344 decodeObjectOfClasses:v82 forKey:@"builtinActionSets"];
  [array setArray:v88];

  v338 = array;
  if ([array count])
  {
    [(NSMutableArray *)v353->_actionSets addObjectsFromArray:array];
  }

  else if ([(HMDHome *)v353 isOwnerUser])
  {
    v89 = objc_autoreleasePoolPush();
    v90 = v353;
    v91 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v91, OS_LOG_TYPE_INFO))
    {
      v92 = HMFGetLogIdentifier();
      v93 = [(NSMutableArray *)v353->_actionSets count];
      *buf = 138543618;
      v396 = v92;
      v397 = 2048;
      v398 = v93;
      _os_log_impl(&dword_229538000, v91, OS_LOG_TYPE_INFO, "%{public}@init: %ld user-defined actionSets; no builtin actionSets - creating....", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v89);
    v94 = v353->_actionSets;
    _createBuiltinActionSets = [(HMDHome *)v90 _createBuiltinActionSets];
    [(NSMutableArray *)v94 addObjectsFromArray:_createBuiltinActionSets];
  }

  removedUsers = v353->_removedUsers;
  v97 = MEMORY[0x277CBEB98];
  v390[0] = objc_opt_class();
  v390[1] = objc_opt_class();
  v98 = [MEMORY[0x277CBEA60] arrayWithObjects:v390 count:2];
  v99 = [v97 setWithArray:v98];
  v100 = v344;
  v101 = [v344 decodeObjectOfClasses:v99 forKey:@"HM.removedUsersCodingKey"];
  [(NSMutableArray *)removedUsers setArray:v101];

  v352 = [MEMORY[0x277CBEB58] set];
  v102 = [MEMORY[0x277CBEB58] set];
  if ([v344 containsValueForKey:@"residentDevices"])
  {
    v103 = MEMORY[0x277CBEB98];
    v389[0] = objc_opt_class();
    v389[1] = objc_opt_class();
    v104 = [MEMORY[0x277CBEA60] arrayWithObjects:v389 count:2];
    v105 = [v103 setWithArray:v104];
    v106 = [v344 decodeObjectOfClasses:v105 forKey:@"residentDevices"];
    [v352 addObjectsFromArray:v106];

    v100 = v344;
  }

  if ([v100 containsValueForKey:@"HM.sharedUsers"])
  {
    v107 = MEMORY[0x277CBEB98];
    v388[0] = objc_opt_class();
    v388[1] = objc_opt_class();
    v108 = [MEMORY[0x277CBEA60] arrayWithObjects:v388 count:2];
    v109 = [v107 setWithArray:v108];
    v110 = [v100 decodeObjectOfClasses:v109 forKey:@"HM.sharedUsers"];
    [v102 addObjectsFromArray:v110];
  }

  v111 = MEMORY[0x277CBEB98];
  v387[0] = objc_opt_class();
  v387[1] = objc_opt_class();
  v112 = [MEMORY[0x277CBEA60] arrayWithObjects:v387 count:2];
  v113 = [v111 setWithArray:v112];
  v114 = [v100 decodeObjectOfClasses:v113 forKey:@"users"];
  [v102 addObjectsFromArray:v114];

  v372 = 0u;
  v373 = 0u;
  v370 = 0u;
  v371 = 0u;
  obj = v102;
  v115 = [obj countByEnumeratingWithState:&v370 objects:v386 count:16];
  if (v115)
  {
    v116 = v115;
    v350 = *v371;
    do
    {
      for (i = 0; i != v116; ++i)
      {
        if (*v371 != v350)
        {
          objc_enumerationMutation(obj);
        }

        v118 = *(*(&v370 + 1) + 8 * i);
        v366 = 0u;
        v367 = 0u;
        v368 = 0u;
        v369 = 0u;
        v119 = v352;
        v120 = [v119 countByEnumeratingWithState:&v366 objects:v385 count:16];
        if (v120)
        {
          v121 = v120;
          v122 = *v367;
          while (2)
          {
            for (j = 0; j != v121; ++j)
            {
              if (*v367 != v122)
              {
                objc_enumerationMutation(v119);
              }

              userID = [*(*(&v366 + 1) + 8 * j) userID];
              userID2 = [v118 userID];
              v126 = [userID isEqualToString:userID2];

              if (v126)
              {

                goto LABEL_71;
              }
            }

            v121 = [v119 countByEnumeratingWithState:&v366 objects:v385 count:16];
            if (v121)
            {
              continue;
            }

            break;
          }
        }

        [(NSMutableArray *)v353->_users addObject:v118];
LABEL_71:
        ;
      }

      v116 = [obj countByEnumeratingWithState:&v370 objects:v386 count:16];
    }

    while (v116);
  }

  users = v353->_users;
  allObjects = [v352 allObjects];
  [(NSMutableArray *)users addObjectsFromArray:allObjects];

  v129 = objc_autoreleasePoolPush();
  v130 = v353;
  v131 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v131, OS_LOG_TYPE_DEBUG))
  {
    v132 = HMFGetLogIdentifier();
    v133 = v353->_users;
    *buf = 138543618;
    v396 = v132;
    v397 = 2112;
    v398 = v133;
    _os_log_impl(&dword_229538000, v131, OS_LOG_TYPE_DEBUG, "%{public}@Received users in the home data: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v129);
  v134 = v344;
  v135 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"roomForEntireHome"];
  v136 = HMDDefaultRoomName();
  v341 = v136;
  if (v135)
  {
    [(HMDRoom *)v135 setName:v136];
  }

  else
  {
    v137 = objc_autoreleasePoolPush();
    v138 = v130;
    v139 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v139, OS_LOG_TYPE_INFO))
    {
      v140 = HMFGetLogIdentifier();
      *buf = 138543362;
      v396 = v140;
      _os_log_impl(&dword_229538000, v139, OS_LOG_TYPE_INFO, "%{public}@Missing roomForEntireHome - creating one", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v137);
    v135 = [[HMDRoom alloc] initWithName:v341 uuid:0 home:v138];
    v134 = v344;
  }

  v337 = v135;
  objc_storeStrong(v130 + 166, v135);
  isWatch();
  v141 = [v134 decodeObjectOfClass:objc_opt_class() forKey:@"homeLocationHandler"];
  if (v141)
  {
    objc_storeStrong(v130 + 76, v141);
  }

  v142 = [v134 decodeObjectOfClass:objc_opt_class() forKey:@"homeConfigVersion"];
  v130[167] = [v142 integerValue];

  if ([v134 containsValueForKey:@"lastSyncedHomeConfigVersion"])
  {
    v143 = [v134 decodeObjectOfClass:objc_opt_class() forKey:@"lastSyncedHomeConfigVersion"];
    v130[168] = [v143 integerValue];
  }

  isWatch();
  v144 = objc_alloc_init(HMDNotificationRegistry);
  v145 = v130[173];
  v130[173] = v144;

  [v130[173] configureWithHome:v130];
  if (isiOSDevice() || isTVOSDevice())
  {
    v146 = [v134 decodeObjectOfClass:objc_opt_class() forKey:@"HM.allowsRemoteAccess"];
    v147 = v146;
    if (v146)
    {
      *(v130 + 321) = [v146 BOOLValue];
    }
  }

  isWatch();
  v148 = v130[7];
  v149 = MEMORY[0x277CBEB98];
  v384[0] = objc_opt_class();
  v384[1] = objc_opt_class();
  v150 = [MEMORY[0x277CBEA60] arrayWithObjects:v384 count:2];
  v151 = [v149 setWithArray:v150];
  v152 = [v134 decodeObjectOfClasses:v151 forKey:@"HM.invitations"];
  [v148 setArray:v152];

  v364 = 0u;
  v365 = 0u;
  v362 = 0u;
  v363 = 0u;
  v153 = v130;
  v154 = [v130[7] copy];
  v155 = [v154 countByEnumeratingWithState:&v362 objects:v383 count:16];
  if (v155)
  {
    v156 = v155;
    v157 = *v363;
    do
    {
      for (k = 0; k != v156; ++k)
      {
        if (*v363 != v157)
        {
          objc_enumerationMutation(v154);
        }

        v159 = *(*(&v362 + 1) + 8 * k);
        user = [v159 user];
        v161 = user;
        if (user)
        {
          v162 = v353->_users;
          userID3 = [user userID];
          v164 = [(NSMutableArray *)v162 hmf_firstObjectWithValue:userID3 forKeyPath:@"userID"];

          if (v164 && [v159 isComplete])
          {
            [v153[7] removeObject:v159];
          }

          else if ([v159 isAccepted])
          {
            [(NSMutableArray *)v353->_users addObject:v161];
            [v153[4] addObject:v161];
            [v161 setHome:v153];
          }
        }
      }

      v156 = [v154 countByEnumeratingWithState:&v362 objects:v383 count:16];
    }

    while (v156);
  }

  hmd_isHH2MigrationInProgress = [v344 hmd_isHH2MigrationInProgress];
  v166 = objc_autoreleasePoolPush();
  v167 = v153;
  v168 = HMFGetOSLogHandle();
  v169 = os_log_type_enabled(v168, OS_LOG_TYPE_INFO);
  if (hmd_isHH2MigrationInProgress)
  {
    p_cache = (&OBJC_METACLASS___HMDAccessoryFirmwareUpdateManagerWingman + 16);
    if (v169)
    {
      v171 = HMFGetLogIdentifier();
      *buf = 138543362;
      v396 = v171;
      _os_log_impl(&dword_229538000, v168, OS_LOG_TYPE_INFO, "%{public}@HH2 Migration is in progress. Not decoding HMDResidentDeviceManagerLegacy as it does not exist in HH2", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v166);
  }

  else
  {
    p_cache = &OBJC_METACLASS___HMDAccessoryFirmwareUpdateManagerWingman.cache;
    if (v169)
    {
      v172 = HMFGetLogIdentifier();
      *buf = 138543362;
      v396 = v172;
      _os_log_impl(&dword_229538000, v168, OS_LOG_TYPE_INFO, "%{public}@Allocating a new resident device manager", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v166);
    v173 = [HMDResidentDeviceManagerFactory createManagerForHomeUUID:v343];
    v174 = v167[180];
    v167[180] = v173;
  }

  v175 = v344;
  v167[193] = [v344 decodeIntegerForKey:@"HMD.nonIPadResidentDeviceCount"];
  if ([v167 isOwnerUser])
  {
    if ([v344 hmd_isHH2MigrationInProgress])
    {
      v176 = [p_cache + 308 currentUserWithPrivilege:3 forHome:v167 forceHH1Key:1];
    }

    else
    {
      v192 = objc_autoreleasePoolPush();
      v193 = v167;
      v194 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v194, OS_LOG_TYPE_INFO))
      {
        v195 = HMFGetLogIdentifier();
        *buf = 138543362;
        v396 = v195;
        _os_log_impl(&dword_229538000, v194, OS_LOG_TYPE_INFO, "%{public}@Not creating a new owner user in HH2", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v192);
      v176 = 0;
      v175 = v344;
    }

    v196 = v353;
    v197 = [v175 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeOwnerUUID"];
    if (v197)
    {
      v198 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v197];
      [v176 setUUID:v198];

      v196 = v353;
    }

    v336 = v197;
    array2 = [MEMORY[0x277CBEB18] array];
    v358 = 0u;
    v359 = 0u;
    v360 = 0u;
    v361 = 0u;
    v200 = v196->_users;
    v201 = [(NSMutableArray *)v200 countByEnumeratingWithState:&v358 objects:v382 count:16];
    v345 = array2;
    v346 = v176;
    if (v201)
    {
      v202 = v201;
      v347 = 0;
      v203 = *v359;
      do
      {
        for (m = 0; m != v202; ++m)
        {
          if (*v359 != v203)
          {
            objc_enumerationMutation(v200);
          }

          v205 = *(*(&v358 + 1) + 8 * m);
          if ([v205 privilege] == 3 && (objc_msgSend(v205, "isRemoteGateway") & 1) == 0)
          {
            if (v347)
            {
              goto LABEL_138;
            }

            pairingUsername = [v205 pairingUsername];
            pairingUsername2 = [v176 pairingUsername];
            v208 = [pairingUsername isEqual:pairingUsername2];

            v176 = v346;
            array2 = v345;
            if (!v208)
            {
LABEL_138:
              [array2 addObject:v205];
            }

            else
            {
              v347 = v205;
            }
          }
        }

        v202 = [(NSMutableArray *)v200 countByEnumeratingWithState:&v358 objects:v382 count:16];
      }

      while (v202);
    }

    else
    {
      v347 = 0;
    }

    [(NSMutableArray *)v353->_users removeObjectsInArray:array2];
    if (v347)
    {
      [v167 setOwner:?];
    }

    else
    {
      [v167 setOwner:v176];
      [(NSMutableArray *)v353->_users addObject:v176];
      [v176 setHome:v167];
      if ([v344 hmd_isHH2MigrationInProgress])
      {
        pairingUsername3 = [v176 pairingUsername];
        v210 = v353->_ownerName;
        v353->_ownerName = pairingUsername3;
      }
    }

    owner = [v167 owner];
    [v167 setCurrentUser:owner];

    array3 = [MEMORY[0x277CBEB18] array];
    v354 = 0u;
    v355 = 0u;
    v356 = 0u;
    v357 = 0u;
    v213 = v353->_users;
    v214 = [(NSMutableArray *)v213 countByEnumeratingWithState:&v354 objects:v381 count:16];
    if (v214)
    {
      v215 = v214;
      v216 = *v355;
      v348 = v167;
      do
      {
        for (n = 0; n != v215; ++n)
        {
          if (*v355 != v216)
          {
            objc_enumerationMutation(v213);
          }

          v218 = *(*(&v354 + 1) + 8 * n);
          pairingUsername4 = [v218 pairingUsername];
          owner2 = [v167 owner];
          pairingUsername5 = [owner2 pairingUsername];
          if ([pairingUsername4 isEqual:pairingUsername5])
          {
            if (![v218 privilege])
            {

              goto LABEL_163;
            }

            privilege = [v218 privilege];

            v223 = privilege == 4;
            v167 = v348;
            if (v223)
            {
              goto LABEL_163;
            }
          }

          else
          {
          }

          if ([v218 isValid])
          {
            continue;
          }

          v224 = objc_autoreleasePoolPush();
          v225 = v167;
          v226 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v226, OS_LOG_TYPE_DEFAULT))
          {
            v227 = HMFGetLogIdentifier();
            *buf = 138543618;
            v396 = v227;
            v397 = 2112;
            v398 = v218;
            _os_log_impl(&dword_229538000, v226, OS_LOG_TYPE_DEFAULT, "%{public}@Removing invalid user %@", buf, 0x16u);

            v167 = v348;
          }

          objc_autoreleasePoolPop(v224);
LABEL_163:
          [array3 addObject:v218];
        }

        v215 = [(NSMutableArray *)v213 countByEnumeratingWithState:&v354 objects:v381 count:16];
      }

      while (v215);
    }

    [(NSMutableArray *)v353->_users removeObjectsInArray:array3];
    v175 = v344;
    v189 = v346;
    v190 = v336;
  }

  else
  {
    currentUser = [v167 currentUser];

    if (currentUser)
    {
      goto LABEL_168;
    }

    v178 = objc_autoreleasePoolPush();
    v179 = v167;
    v180 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v180, OS_LOG_TYPE_DEBUG))
    {
      v181 = HMFGetLogIdentifier();
      [v344 hmd_isHH2MigrationInProgress];
      v182 = HMFBooleanToString();
      v183 = v353->_users;
      *buf = 138543874;
      v396 = v181;
      v397 = 2112;
      v398 = v182;
      v399 = 2112;
      v400 = v183;
      _os_log_impl(&dword_229538000, v180, OS_LOG_TYPE_DEBUG, "%{public}@No current user found for this home: isHH2MigrationInProgress = %@, users = %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v178);
    v175 = v344;
    if ([v344 hmd_isHH2MigrationInProgress])
    {
      goto LABEL_168;
    }

    v184 = objc_autoreleasePoolPush();
    v185 = v179;
    v186 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v186, OS_LOG_TYPE_DEFAULT))
    {
      v187 = HMFGetLogIdentifier();
      *buf = 138543362;
      v396 = v187;
      _os_log_impl(&dword_229538000, v186, OS_LOG_TYPE_DEFAULT, "%{public}@Current user not found, creating", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v184);
    dataSource = [v185 dataSource];
    v189 = [dataSource makeCurrentUserWithUserPrivilege:0 home:v185];

    if (!v189)
    {
      v332 = objc_autoreleasePoolPush();
      v333 = v185;
      v334 = HMFGetOSLogHandle();
      v27 = v340;
      if (os_log_type_enabled(v334, OS_LOG_TYPE_ERROR))
      {
        v335 = HMFGetLogIdentifier();
        *buf = 138543362;
        v396 = v335;
        _os_log_impl(&dword_229538000, v334, OS_LOG_TYPE_ERROR, "%{public}@Current user cannot be found or created, failing to deserialize home", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v332);
      v327 = 0;
      goto LABEL_217;
    }

    v175 = v344;
    v190 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeOwnerUUID"];
    if (v190)
    {
      v191 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v190];
      [v189 setUUID:v191];

      v175 = v344;
    }

    [v185 setCurrentUser:v189];
    [(NSMutableArray *)v353->_users addObject:v189];
    [v189 setHome:v185];
  }

LABEL_168:
  v228 = [MEMORY[0x277CD1F00] authWithCoder:v175];
  v229 = v167[77];
  v167[77] = v228;

  v230 = v167[77];
  [v167 currentUser];
  v232 = v231 = v175;
  [v232 setPresenceAuthStatus:v230];

  v233 = [MEMORY[0x277CD1F08] computeWithCoder:v231];
  v234 = v167[78];
  v167[78] = v233;

  v235 = objc_autoreleasePoolPush();
  v236 = v167;
  v237 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v237, OS_LOG_TYPE_INFO))
  {
    v238 = HMFGetLogIdentifier();
    currentUser2 = [v236 currentUser];
    *buf = 138543618;
    v396 = v238;
    v397 = 2112;
    v398 = currentUser2;
    _os_log_impl(&dword_229538000, v237, OS_LOG_TYPE_INFO, "%{public}@Current user is %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v235);
  array4 = [MEMORY[0x277CBEB18] array];
  v241 = v344;
  if ([v344 containsValueForKey:@"triggers"])
  {
    v242 = MEMORY[0x277CBEB98];
    v380[0] = objc_opt_class();
    v380[1] = objc_opt_class();
    v380[2] = objc_opt_class();
    v380[3] = objc_opt_class();
    v243 = [MEMORY[0x277CBEA60] arrayWithObjects:v380 count:4];
    v244 = [v242 setWithArray:v243];
    v245 = [v344 decodeObjectOfClasses:v244 forKey:@"triggers"];
    [array4 addObjectsFromArray:v245];

    v241 = v344;
  }

  if ([v241 containsValueForKey:@"HM.triggers"])
  {
    v246 = MEMORY[0x277CBEB98];
    v379[0] = objc_opt_class();
    v379[1] = objc_opt_class();
    v379[2] = objc_opt_class();
    v379[3] = objc_opt_class();
    v247 = [MEMORY[0x277CBEA60] arrayWithObjects:v379 count:4];
    v248 = [v246 setWithArray:v247];
    v249 = [v344 decodeObjectOfClasses:v248 forKey:@"HM.triggers"];
    [array4 addObjectsFromArray:v249];

    v241 = v344;
  }

  if ([v241 containsValueForKey:@"HM.sharedActivationTriggers"])
  {
    v250 = MEMORY[0x277CBEB98];
    v378[0] = objc_opt_class();
    v378[1] = objc_opt_class();
    v378[2] = objc_opt_class();
    v378[3] = objc_opt_class();
    v251 = [MEMORY[0x277CBEA60] arrayWithObjects:v378 count:4];
    v252 = [v250 setWithArray:v251];
    v253 = [v241 decodeObjectOfClasses:v252 forKey:@"HM.sharedActivationTriggers"];
    [array4 addObjectsFromArray:v253];
  }

  [v236[57] setArray:array4];
  v254 = v236[12];
  v255 = MEMORY[0x277CBEB98];
  v377[0] = objc_opt_class();
  v377[1] = objc_opt_class();
  v256 = [MEMORY[0x277CBEA60] arrayWithObjects:v377 count:2];
  v257 = [v255 setWithArray:v256];
  v258 = [v241 decodeObjectOfClasses:v257 forKey:@"HM.deviceOwnedTriggers"];
  [v254 setArray:v258];

  v259 = [v241 decodeObjectOfClass:objc_opt_class() forKey:@"HM.appDataRepository"];
  v260 = v236[151];
  v236[151] = v259;

  [v236[151] updateParentUUIDIfNil:v353->_uuid];
  v261 = *MEMORY[0x277CCFE80];
  v262 = v241;
  if ([v241 containsValueForKey:*MEMORY[0x277CCFE80]])
  {
    *(v236 + 128) = [v241 decodeBoolForKey:v261];
  }

  v263 = *MEMORY[0x277CCFE88];
  if ([v241 containsValueForKey:*MEMORY[0x277CCFE88]])
  {
    *(v236 + 129) = [v241 decodeBoolForKey:v263];
  }

  v264 = *MEMORY[0x277CD03F8];
  if ([v241 containsValueForKey:*MEMORY[0x277CD03F8]])
  {
    v236[17] = [v241 decodeIntegerForKey:v264];
  }

  v265 = *MEMORY[0x277CD0410];
  if ([v241 containsValueForKey:*MEMORY[0x277CD0410]])
  {
    *(v236 + 144) = [v241 decodeBoolForKey:v265];
  }

  v266 = *MEMORY[0x277CD0400];
  if ([v241 containsValueForKey:*MEMORY[0x277CD0400]])
  {
    v267 = [v241 decodeObjectOfClass:objc_opt_class() forKey:v266];
    v268 = v236[19];
    v236[19] = v267;
  }

  v269 = [v241 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeKitVersionStringKey"];
  v270 = v236[187];
  v236[187] = v269;

  v271 = v236[187];
  if (v271)
  {
    v272 = +[HMDHomeKitVersion version6];
    v273 = [v271 isAtLeastVersion:v272];

    v262 = v344;
    if (v273)
    {
      *(v236 + 299) = 1;
    }
  }

  v274 = *MEMORY[0x277CD0458];
  if ([v262 containsValueForKey:*MEMORY[0x277CD0458]])
  {
    v275 = [v262 decodeIntegerForKey:v274];
  }

  else
  {
    v275 = 0;
  }

  v236[44] = v275;
  v276 = [v262 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.minimumNetworkRouterSupportHomeKitVersion"];
  if (v276)
  {
    v277 = [[HMDHomeKitVersion alloc] initWithString:v276];
    v278 = v236[52];
    v236[52] = v277;
  }

  v279 = [v262 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.minHomeKitVersionForAccessoryNetworkProtectionChangeCodingKey"];

  if (v279)
  {
    v280 = [[HMDHomeKitVersion alloc] initWithString:v279];
    v281 = v236[53];
    v236[53] = v280;
  }

  v351 = v279;
  v27 = [v262 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.activeNetworkRouter"];

  if (v27)
  {
    v282 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v27];
    v283 = v236[47];
    v236[47] = v282;
  }

  if ([v262 containsValueForKey:@"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey"])
  {
    v284 = [v262 decodeObjectOfClass:objc_opt_class() forKey:@"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey"];
    v285 = v236[50];
    v236[50] = v284;
  }

  v286 = MEMORY[0x277CBEB98];
  v376[0] = objc_opt_class();
  v376[1] = objc_opt_class();
  [MEMORY[0x277CBEA60] arrayWithObjects:v376 count:2];
  v288 = v287 = v262;
  v289 = [v286 setWithArray:v288];
  v290 = [v287 decodeObjectOfClasses:v289 forKey:*MEMORY[0x277CCFDB0]];

  v291 = [HMDAccessoryNetworkProtectionGroupRegistry alloc];
  notificationCenter = [v236 notificationCenter];
  v293 = [(HMDAccessoryNetworkProtectionGroupRegistry *)v291 initWithHome:v236 notificationCenter:notificationCenter persistedGroups:v290];
  v294 = v236[46];
  v236[46] = v293;

  v295 = [v287 decodeObjectOfClass:objc_opt_class() forKey:@"HMHH.residentReachabilityContext"];
  v296 = v295;
  if (v295)
  {
    v297 = v295;
  }

  else
  {
    v297 = objc_alloc_init(HMDResidentReachabilityContext);
  }

  v298 = [[HMDResidentReachabilityNotificationManager alloc] initWithResidentReachabilityContext:v297 workQueue:v236[157]];
  v299 = v236[191];
  v236[191] = v298;

  if ([v344 containsValueForKey:@"HMHM.threadNetworkID"])
  {
    v300 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.threadNetworkID"];
    v301 = v236[58];
    v236[58] = v300;
  }

  v302 = [v344 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD04A0]];
  v303 = v236[70];
  v236[70] = v302;

  v304 = [v344 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD04B8]];
  v305 = v236[190];
  v236[190] = v304;

  v306 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"HM.nlcck"];
  v307 = v236[71];
  v236[71] = v306;

  if ([v344 containsValueForKey:@"HMDHomeLabelsByAccessCodeCodingKey"])
  {
    v308 = MEMORY[0x277CBEB98];
    v375[0] = objc_opt_class();
    v375[1] = objc_opt_class();
    v309 = [MEMORY[0x277CBEA60] arrayWithObjects:v375 count:2];
    v310 = [v308 setWithArray:v309];
    [v344 decodeObjectOfClasses:v310 forKey:@"HMDHomeLabelsByAccessCodeCodingKey"];
    v312 = v311 = array4;

    v313 = [v312 mutableCopy];
    v314 = v236[95];
    v236[95] = v313;

    array4 = v311;
  }

  if ([v344 containsValueForKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"])
  {
    v315 = MEMORY[0x277CBEB98];
    v374[0] = objc_opt_class();
    v374[1] = objc_opt_class();
    v374[2] = objc_opt_class();
    v316 = [MEMORY[0x277CBEA60] arrayWithObjects:v374 count:3];
    v317 = [v315 setWithArray:v316];
    [v344 decodeObjectOfClasses:v317 forKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"];
    v319 = v318 = array4;

    v320 = [v319 mutableCopy];
    v321 = v236[97];
    v236[97] = v320;

    array4 = v318;
  }

  if ([v344 containsValueForKey:@"HMDHomeNFCReaderKeyCodingKey"])
  {
    v322 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"HMDHomeNFCReaderKeyCodingKey"];
    v323 = v236[61];
    v236[61] = v322;
  }

  else
  {
    *(v236 + 313) = 0;
  }

  v324 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.chipStorage"];
  if (v324)
  {
    objc_storeStrong(v236 + 195, v324);
    if (isFeatureMatterLocalFabricConfigEnabled())
    {
      fabricID = [v324 fabricID];

      if (fabricID)
      {
        fabricID2 = [v324 fabricID];
        [v236[198] setFabricID:fabricID2];
      }
    }
  }

  *(v236 + 324) = [v344 decodeBoolForKey:*MEMORY[0x277CD0698]];

  v327 = 1;
LABEL_217:

  coderCopy = v344;
  v28 = v342;
  if (!v327)
  {
    v329 = 0;
    v328 = v353;
    goto LABEL_221;
  }

  v9 = v353;
LABEL_219:
  v328 = v9;
  v329 = v9;
LABEL_221:

  v330 = *MEMORY[0x277D85DE8];
  return v329;
}

- (HMDHome)initWithCoder:(id)coder
{
  coderCopy = coder;
  v5 = objc_autoreleasePoolPush();
  v6 = [(HMDHome *)self _initWithCoder:coderCopy];
  objc_autoreleasePoolPop(v5);

  return v6;
}

- (void)fixupHomeAfterDecoding
{
  v125 = *MEMORY[0x277D85DE8];
  v92 = +[HMDProcessInfo privateClientIdentifierSalt];
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  selfCopy = self;
  if ([(HMDHome *)self isOwnerUser])
  {
    v110 = 0u;
    v111 = 0u;
    v108 = 0u;
    v109 = 0u;
    accessories = [(HMDHome *)self accessories];
    v4 = [accessories countByEnumeratingWithState:&v108 objects:v124 count:16];
    if (v4)
    {
      v6 = v4;
      v7 = *v109;
      p_superclass = HMDIDSActivityRegistrationModel.superclass;
      *&v5 = 138543874;
      v80 = v5;
      v84 = accessories;
      v85 = *v109;
      do
      {
        v9 = 0;
        v86 = v6;
        do
        {
          if (*v109 != v7)
          {
            objc_enumerationMutation(accessories);
          }

          v10 = *(*(&v108 + 1) + 8 * v9);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v11 = v10;
          }

          else
          {
            v11 = 0;
          }

          v12 = v11;

          bridge = [v12 bridge];
          v14 = bridge;
          if (v12)
          {
            v15 = bridge == 0;
          }

          else
          {
            v15 = 1;
          }

          if (!v15)
          {
            uniqueIdentifier = [v12 uniqueIdentifier];

            if (uniqueIdentifier)
            {
              v87 = v14;
              v88 = v9;
              v17 = MEMORY[0x277CCAD78];
              uuid = [v14 uuid];
              v19 = MEMORY[0x277CFE9F8];
              uniqueIdentifier2 = [v12 uniqueIdentifier];
              v21 = [v19 instanceIDForUniqueIdentifier:uniqueIdentifier2];
              stringValue = [v21 stringValue];
              v123 = stringValue;
              v23 = [MEMORY[0x277CBEA60] arrayWithObjects:&v123 count:1];
              v24 = [v17 hm_deriveUUIDFromBaseUUID:uuid withSalts:v23];

              uuid2 = [v12 uuid];
              LOBYTE(v17) = [v24 isEqual:uuid2];

              if (v17)
              {

                v6 = v86;
                v14 = v87;
                v9 = v88;
                v7 = v85;
              }

              else
              {
                v36 = objc_autoreleasePoolPush();
                v37 = selfCopy;
                v38 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v38, OS_LOG_TYPE_DEFAULT))
                {
                  v39 = HMFGetLogIdentifier();
                  uuid3 = [v12 uuid];
                  *buf = v80;
                  v118 = v39;
                  v119 = 2112;
                  v120 = uuid3;
                  v121 = 2112;
                  v122 = v24;
                  _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_DEFAULT, "%{public}@Fixup of accessory uuid from legacy archive %@ -> %@", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v36);
                uuid4 = [v12 uuid];
                [v12 setUuid:v24];
                appData = [v12 appData];

                if (appData)
                {
                  uuid5 = [v12 uuid];
                  appData2 = [v12 appData];
                  [appData2 setParentUUID:uuid5];
                }

                v81 = uuid4;
                v94 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:uuid4 identifierSalt:v92 withSalts:{0, v80}];
                v82 = v24;
                v93 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:v24 identifierSalt:v92 withSalts:0];
                v104 = 0u;
                v105 = 0u;
                v106 = 0u;
                v107 = 0u;
                v83 = v12;
                obj = [v12 services];
                v45 = [obj countByEnumeratingWithState:&v104 objects:v116 count:16];
                if (v45)
                {
                  v46 = v45;
                  v91 = *v105;
                  do
                  {
                    for (i = 0; i != v46; ++i)
                    {
                      if (*v105 != v91)
                      {
                        objc_enumerationMutation(obj);
                      }

                      v48 = *(*(&v104 + 1) + 8 * i);
                      [v48 _recalculateUUID];
                      v49 = MEMORY[0x277CCAD78];
                      instanceID = [v48 instanceID];
                      stringValue2 = [instanceID stringValue];
                      v115 = stringValue2;
                      v52 = [MEMORY[0x277CBEA60] arrayWithObjects:&v115 count:1];
                      v53 = [v49 hm_deriveUUIDFromBaseUUID:v94 identifierSalt:v92 withSalts:v52];

                      v54 = MEMORY[0x277CCAD78];
                      instanceID2 = [v48 instanceID];
                      stringValue3 = [instanceID2 stringValue];
                      v114 = stringValue3;
                      v57 = [MEMORY[0x277CBEA60] arrayWithObjects:&v114 count:1];
                      v58 = [v54 hm_deriveUUIDFromBaseUUID:v93 identifierSalt:v92 withSalts:v57];

                      uUIDString = [v58 UUIDString];
                      uUIDString2 = [v53 UUIDString];
                      [dictionary setObject:uUIDString forKey:uUIDString2];

                      appData3 = [v48 appData];

                      if (appData3)
                      {
                        uuid6 = [v48 uuid];
                        appData4 = [v48 appData];
                        [appData4 setParentUUID:uuid6];
                      }
                    }

                    v46 = [obj countByEnumeratingWithState:&v104 objects:v116 count:16];
                  }

                  while (v46);
                }

                accessories = v84;
                v7 = v85;
                p_superclass = (HMDIDSActivityRegistrationModel + 8);
                v6 = v86;
                v14 = v87;
                v9 = v88;
                v12 = v83;
              }
            }

            else
            {
              v26 = v14;
              v27 = objc_autoreleasePoolPush();
              v28 = selfCopy;
              v29 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
              {
                v30 = HMFGetLogIdentifier();
                uuid7 = [v12 uuid];
                [uuid7 UUIDString];
                v32 = p_superclass;
                v33 = v12;
                v35 = v34 = v9;
                *buf = 138543618;
                v118 = v30;
                v119 = 2112;
                v120 = v35;
                _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to check validity of uuid %@ (accessory has nil uniqueIdentifier)", buf, 0x16u);

                v9 = v34;
                v12 = v33;
                p_superclass = v32;

                v6 = v86;
                v7 = v85;
              }

              objc_autoreleasePoolPop(v27);
              v14 = v26;
              accessories = v84;
            }
          }

          ++v9;
        }

        while (v9 != v6);
        v6 = [accessories countByEnumeratingWithState:&v108 objects:v124 count:16];
      }

      while (v6);
    }

    v102 = 0u;
    v103 = 0u;
    v100 = 0u;
    v101 = 0u;
    rooms = [(HMDHome *)selfCopy rooms];
    v65 = [rooms countByEnumeratingWithState:&v100 objects:v113 count:16];
    if (v65)
    {
      v66 = v65;
      v67 = *v101;
      do
      {
        for (j = 0; j != v66; ++j)
        {
          if (*v101 != v67)
          {
            objc_enumerationMutation(rooms);
          }

          v69 = *(*(&v100 + 1) + 8 * j);
          appData5 = [v69 appData];

          if (appData5)
          {
            appData6 = [v69 appData];
            [(HMDHome *)selfCopy updateAppData:appData6 identifierKey:@"HFSortedIdentifierStrings_roomServices" lookup:dictionary];
          }
        }

        v66 = [rooms countByEnumeratingWithState:&v100 objects:v113 count:16];
      }

      while (v66);
    }

    appData7 = [(HMDHome *)selfCopy appData];

    if (appData7)
    {
      appData8 = [(HMDHome *)selfCopy appData];
      [(HMDHome *)selfCopy updateAppData:appData8 identifierKey:@"HFSortedIdentifierStrings_homeServices" lookup:dictionary];
    }

    [(HMDHome *)selfCopy computeBridgedAccessoriesForAllBridges];
  }

  v98 = 0u;
  v99 = 0u;
  v96 = 0u;
  v97 = 0u;
  serviceGroups = [(HMDHome *)selfCopy serviceGroups];
  v75 = [serviceGroups countByEnumeratingWithState:&v96 objects:v112 count:16];
  if (v75)
  {
    v76 = v75;
    v77 = *v97;
    do
    {
      for (k = 0; k != v76; ++k)
      {
        if (*v97 != v77)
        {
          objc_enumerationMutation(serviceGroups);
        }

        [*(*(&v96 + 1) + 8 * k) fixupServiceGroup];
      }

      v76 = [serviceGroups countByEnumeratingWithState:&v96 objects:v112 count:16];
    }

    while (v76);
  }

  v79 = *MEMORY[0x277D85DE8];
}

- (void)updateAppData:(id)data identifierKey:(id)key lookup:(id)lookup
{
  v53 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  keyCopy = key;
  lookupCopy = lookup;
  dictionary = [dataCopy dictionary];
  v12 = [dictionary hmf_dictionaryForKey:@"com.apple.homekit-entitledclient.identifer"];

  v37 = keyCopy;
  v13 = [v12 objectForKey:keyCopy];
  v14 = v13;
  if (v13 && [v13 count])
  {
    v34 = v12;
    v35 = dataCopy;
    v32 = [v12 mutableCopy];
    v15 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v14, "count")}];
    v40 = 0u;
    v41 = 0u;
    v42 = 0u;
    v43 = 0u;
    v33 = v14;
    obj = v14;
    v39 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
    if (v39)
    {
      v16 = *v41;
      v36 = *v41;
      do
      {
        for (i = 0; i != v39; ++i)
        {
          if (*v41 != v16)
          {
            objc_enumerationMutation(obj);
          }

          v18 = *(*(&v40 + 1) + 8 * i);
          v19 = [lookupCopy objectForKey:v18];
          if (v19)
          {
            v20 = objc_autoreleasePoolPush();
            selfCopy = self;
            v22 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
            {
              HMFGetLogIdentifier();
              v23 = v15;
              selfCopy2 = self;
              v26 = v25 = lookupCopy;
              *buf = 138544130;
              v45 = v26;
              v46 = 2112;
              v47 = v37;
              v48 = 2112;
              v49 = v18;
              v50 = 2112;
              v51 = v19;
              _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Fixup of service uuid list %@ from legacy archive %@ -> %@", buf, 0x2Au);

              lookupCopy = v25;
              self = selfCopy2;
              v15 = v23;
              v16 = v36;
            }

            objc_autoreleasePoolPop(v20);
            v27 = v15;
            v28 = v19;
          }

          else
          {
            v27 = v15;
            v28 = v18;
          }

          [v27 addObject:v28];
        }

        v39 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
      }

      while (v39);
    }

    v29 = [v15 copy];
    [v32 setObject:v29 forKey:v37];

    v30 = [v32 copy];
    dataCopy = v35;
    [v35 setApplicationData:v30 forIdentifier:@"com.apple.homekit-entitledclient.identifer"];

    v14 = v33;
    v12 = v34;
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateMediaPassword:(id)password
{
  v39 = *MEMORY[0x277D85DE8];
  passwordCopy = password;
  messagePayload = [passwordCopy messagePayload];
  v6 = [messagePayload objectForKeyedSubscript:*MEMORY[0x277CD0408]];

  if (!v6)
  {
    goto LABEL_5;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v34 = v16;
      v35 = 2112;
      v36 = v6;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Invalid password: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    responseHandler = [passwordCopy responseHandler];

    if (!responseHandler)
    {
      goto LABEL_18;
    }

    responseHandler5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:22];
LABEL_16:
    responseHandler2 = [passwordCopy responseHandler];
    (responseHandler2)[2](responseHandler2, responseHandler5, 0);

    goto LABEL_17;
  }

  v32 = 0;
  v7 = [MEMORY[0x277CD1A60] isValidMediaPassword:v6 error:&v32];
  v8 = v32;
  responseHandler5 = v8;
  if ((v7 & 1) == 0)
  {
    v25 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543874;
      v34 = v28;
      v35 = 2112;
      v36 = v6;
      v37 = 2112;
      v38 = responseHandler5;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to validate password, %@, with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v25);
    responseHandler3 = [passwordCopy responseHandler];

    if (!responseHandler3)
    {
      goto LABEL_17;
    }

    goto LABEL_16;
  }

LABEL_5:
  mediaPassword = [(HMDHome *)self mediaPassword];
  v11 = HMFEqualObjects();

  if (!v11)
  {
    v18 = [HMDHomeMediaSettingsModel alloc];
    uuid = [(HMDHome *)self uuid];
    v20 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:uuid];
    uuid2 = [(HMDHome *)self uuid];
    responseHandler5 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:2 uuid:v20 parentUUID:uuid2];

    [(HMDHomeMediaSettingsModel *)responseHandler5 setMediaPassword:v6];
    backingStore = [(HMDHome *)self backingStore];
    v23 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v24 = [backingStore transaction:@"Update Media Password" options:v23];

    [v24 add:responseHandler5 withMessage:passwordCopy];
    [v24 run];

    goto LABEL_17;
  }

  responseHandler4 = [passwordCopy responseHandler];

  if (responseHandler4)
  {
    responseHandler5 = [passwordCopy responseHandler];
    (*&responseHandler5->super.super._bsoDataVersionOverride)(responseHandler5, 0, 0);
LABEL_17:
  }

LABEL_18:

  v31 = *MEMORY[0x277D85DE8];
}

- (void)setMediaPassword:(id)password
{
  v19 = *MEMORY[0x277D85DE8];
  passwordCopy = password;
  v5 = [passwordCopy copy];
  os_unfair_recursive_lock_lock_with_options();
  mediaPassword = self->_mediaPassword;
  if (HMFEqualObjects())
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    objc_storeStrong(&self->_mediaPassword, v5);
    os_unfair_recursive_lock_unlock();
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543618;
      v16 = v10;
      v17 = 2112;
      v18 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Updated media password to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    workQueue = selfCopy->_workQueue;
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __28__HMDHome_setMediaPassword___block_invoke;
    v13[3] = &unk_27868A750;
    v13[4] = selfCopy;
    v14 = v5;
    dispatch_async(workQueue, v13);
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __28__HMDHome_setMediaPassword___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [*(a1 + 32) accessories];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    do
    {
      v6 = 0;
      do
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * v6);
        if ([v7 conformsToProtocol:&unk_283F00888])
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        if (v9 && [v9 supportsMinimumUserPrivilege])
        {
          [v9 handleUpdatedPassword:*(a1 + 40)];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (id)mediaPassword
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_mediaPassword;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleUpdateMediaPeerToPeerEnabled:(id)enabled
{
  v27 = *MEMORY[0x277D85DE8];
  enabledCopy = enabled;
  v24 = 0;
  v5 = [enabledCopy BOOLForKey:@"kEnabledKey" keyPresent:&v24];
  if (v24)
  {
    v6 = v5;
    if (v5 != [(HMDHome *)self isMediaPeerToPeerEnabled])
    {
      v7 = [HMDHomeMediaSettingsModel alloc];
      uuid = [(HMDHome *)self uuid];
      v9 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:uuid];
      uuid2 = [(HMDHome *)self uuid];
      responseHandler2 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:2 uuid:v9 parentUUID:uuid2];

      v12 = [MEMORY[0x277CCABB0] numberWithBool:v6];
      [(HMDHomeMediaSettingsModel *)responseHandler2 setMediaPeerToPeerEnabled:v12];

      backingStore = [(HMDHome *)self backingStore];
      v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v15 = [backingStore transaction:@"Update Media Peer-to-peer Enabled" options:v14];

      [v15 add:responseHandler2 withMessage:enabledCopy];
      [v15 run];

LABEL_10:
      goto LABEL_11;
    }

    responseHandler = [enabledCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [enabledCopy responseHandler];
      (*&responseHandler2->super.super._bsoDataVersionOverride)(responseHandler2, 0, 0);
      goto LABEL_10;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    responseHandler3 = [enabledCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      responseHandler4 = [enabledCopy responseHandler];
      (responseHandler4)[2](responseHandler4, responseHandler2, 0);

      goto LABEL_10;
    }
  }

LABEL_11:

  v23 = *MEMORY[0x277D85DE8];
}

- (void)setMediaPeerToPeerEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  v26 = *MEMORY[0x277D85DE8];
  featuresDataSource = [(HMDHome *)self featuresDataSource];
  isMediaPrivilegeEnabled = [featuresDataSource isMediaPrivilegeEnabled];

  os_unfair_recursive_lock_lock_with_options();
  if (isMediaPrivilegeEnabled)
  {
    if (self->_mediaPeerToPeerEnabled == enabledCopy)
    {
      os_unfair_recursive_lock_unlock();
      v7 = objc_autoreleasePoolPush();
      selfCopy = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        v11 = HMFBooleanToString();
        *buf = 138543618;
        v23 = v10;
        v24 = 2112;
        v25 = v11;
      }

      objc_autoreleasePoolPop(v7);
    }

    else
    {
      self->_mediaPeerToPeerEnabled = enabledCopy;
      os_unfair_recursive_lock_unlock();
      v13 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        v17 = HMFBooleanToString();
        *buf = 138543618;
        v23 = v16;
        v24 = 2112;
        v25 = v17;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Updated media peer to peer enabled to: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v13);
      workQueue = selfCopy2->_workQueue;
      v20[0] = MEMORY[0x277D85DD0];
      v20[1] = 3221225472;
      v20[2] = __37__HMDHome_setMediaPeerToPeerEnabled___block_invoke;
      v20[3] = &unk_278688650;
      v20[4] = selfCopy2;
      v21 = enabledCopy;
      dispatch_async(workQueue, v20);
    }

    v19 = *MEMORY[0x277D85DE8];
  }

  else
  {
    self->_mediaPeerToPeerEnabled = enabledCopy;
    v12 = *MEMORY[0x277D85DE8];

    os_unfair_recursive_lock_unlock();
  }
}

void __37__HMDHome_setMediaPeerToPeerEnabled___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [*(a1 + 32) hapAccessories];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    do
    {
      v6 = 0;
      do
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * v6);
        if ([v7 conformsToProtocol:&unk_283F00918])
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        if (v9 && [v9 supportsMinimumUserPrivilege])
        {
          [v9 handleUpdatedMediaPeerToPeerEnabled:*(a1 + 40)];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)isMediaPeerToPeerEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  mediaPeerToPeerEnabled = self->_mediaPeerToPeerEnabled;
  os_unfair_recursive_lock_unlock();
  return mediaPeerToPeerEnabled;
}

- (void)_handleUpdateMinimumMediaUserPrivilege:(id)privilege
{
  v28 = *MEMORY[0x277D85DE8];
  privilegeCopy = privilege;
  v5 = [privilegeCopy numberForKey:@"kUserPrivilegeLevelKey"];
  v6 = v5;
  if (v5)
  {
    integerValue = [v5 integerValue];
    if ([(HMDHome *)self minimumMediaUserPrivilege]!= integerValue)
    {
      v16 = [HMDHomeMediaSettingsModel alloc];
      uuid = [(HMDHome *)self uuid];
      v18 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:uuid];
      uuid2 = [(HMDHome *)self uuid];
      v20 = [(HMDBackingStoreModelObject *)v16 initWithObjectChangeType:2 uuid:v18 parentUUID:uuid2];

      v21 = [MEMORY[0x277CCABB0] numberWithInteger:integerValue];
      [(HMDHomeMediaSettingsModel *)v20 setMinimumMediaUserPrivilege:v21];

      backingStore = [(HMDHome *)self backingStore];
      v23 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v24 = [backingStore transaction:@"Update Minimum User Privilege" options:v23];

      [v24 add:v20 withMessage:privilegeCopy];
      [v24 run];

      goto LABEL_11;
    }

    responseHandler = [privilegeCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [privilegeCopy responseHandler];
      responseHandler2[2](responseHandler2, 0, 0);
LABEL_9:
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v26 = 138543362;
      v27 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", &v26, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    responseHandler3 = [privilegeCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      responseHandler4 = [privilegeCopy responseHandler];
      responseHandler4[2](responseHandler4, responseHandler2, 0);

      goto LABEL_9;
    }
  }

LABEL_11:

  v25 = *MEMORY[0x277D85DE8];
}

- (void)setMinimumMediaUserPrivilege:(int64_t)privilege
{
  v22 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (self->_minimumMediaUserPrivilege == privilege)
  {
    os_unfair_recursive_lock_unlock();
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = HMUserPrivilegeToString();
      *buf = 138543618;
      v19 = v8;
      v20 = 2112;
      v21 = v9;
    }

    objc_autoreleasePoolPop(v5);
  }

  else
  {
    self->_minimumMediaUserPrivilege = privilege;
    os_unfair_recursive_lock_unlock();
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMUserPrivilegeToString();
      *buf = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Updated minimum user privilege to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    workQueue = selfCopy2->_workQueue;
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __40__HMDHome_setMinimumMediaUserPrivilege___block_invoke;
    v17[3] = &unk_27868A0D0;
    v17[4] = selfCopy2;
    v17[5] = privilege;
    dispatch_async(workQueue, v17);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome_setMinimumMediaUserPrivilege___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [*(a1 + 32) accessories];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    do
    {
      v6 = 0;
      do
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * v6);
        if ([v7 conformsToProtocol:&unk_283F00888])
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        if (v9 && [v9 supportsMinimumUserPrivilege])
        {
          [v9 handleUpdatedMinimumUserPrivilege:*(a1 + 40)];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (int64_t)minimumMediaUserPrivilege
{
  os_unfair_recursive_lock_lock_with_options();
  minimumMediaUserPrivilege = self->_minimumMediaUserPrivilege;
  os_unfair_recursive_lock_unlock();
  return minimumMediaUserPrivilege;
}

- (void)queryPrimaryResidentReachabilityForAccessories:(id)accessories completion:(id)completion
{
  v49 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  completionCopy = completion;
  isCurrentDeviceConfirmedPrimaryResident = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident];
  v9 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessoriesCopy, "count")}];
  if (isCurrentDeviceConfirmedPrimaryResident)
  {
    v32 = completionCopy;
    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v10 = accessoriesCopy;
    v11 = [v10 countByEnumeratingWithState:&v39 objects:v48 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v40;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v40 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v39 + 1) + 8 * i);
          v46 = @"kAccessoryIsReachableKey";
          v16 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v15, "isReachable", v32)}];
          v47 = v16;
          v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v47 forKeys:&v46 count:1];

          [v9 addObject:v17];
        }

        v12 = [v10 countByEnumeratingWithState:&v39 objects:v48 count:16];
      }

      while (v12);
    }

    completionCopy = v32;
    v32[2](v32, v9);
  }

  else
  {
    v37 = 0u;
    v38 = 0u;
    v35 = 0u;
    v36 = 0u;
    v18 = accessoriesCopy;
    v19 = [v18 countByEnumeratingWithState:&v35 objects:v45 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v36;
      do
      {
        for (j = 0; j != v20; ++j)
        {
          if (*v36 != v21)
          {
            objc_enumerationMutation(v18);
          }

          uuid = [*(*(&v35 + 1) + 8 * j) uuid];
          uUIDString = [uuid UUIDString];
          [v9 addObject:uUIDString];
        }

        v20 = [v18 countByEnumeratingWithState:&v35 objects:v45 count:16];
      }

      while (v20);
    }

    v43 = @"kAccessoriesUUIDKey";
    v44 = v9;
    v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v44 forKeys:&v43 count:1];
    v26 = MEMORY[0x277D0F818];
    uUID = [MEMORY[0x277CCAD78] UUID];
    v28 = [v26 messageWithName:@"HMDHomeQueryResidentReachabilityForAccessoriesMessageKey" identifier:uUID messagePayload:v25];

    v33[0] = MEMORY[0x277D85DD0];
    v33[1] = 3221225472;
    v33[2] = __69__HMDHome_queryPrimaryResidentReachabilityForAccessories_completion___block_invoke;
    v33[3] = &unk_278685AF8;
    v33[4] = self;
    v34 = completionCopy;
    [v28 setResponseHandler:v33];
    uuid2 = [(HMDHome *)self uuid];
    workQueue = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v28 target:uuid2 responseQueue:workQueue];
  }

  v31 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome_queryPrimaryResidentReachabilityForAccessories_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (v5)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v11;
      v18 = 2112;
      v19 = v5;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Query reachability response error: %@", &v16, 0x16u);
    }

    v12 = 0;
LABEL_5:

    objc_autoreleasePoolPop(v8);
    goto LABEL_6;
  }

  v14 = [v6 hmf_arrayForKey:@"kAccessoriesInfoDictionaryKey"];
  v12 = v14;
  if (!v14 || ![v14 count])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v15;
      v18 = 2112;
      v19 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@No reachability setting in query reachability response: %@", &v16, 0x16u);
    }

    goto LABEL_5;
  }

LABEL_6:
  (*(*(a1 + 40) + 16))();

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleQueryResidentReachabilityForAccessories:(id)accessories
{
  v39 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  messagePayload = [accessoriesCopy messagePayload];
  v6 = [messagePayload hmf_arrayForKey:@"kAccessoriesUUIDKey"];
  v7 = v6;
  if (v6)
  {
    v26 = accessoriesCopy;
    v8 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    v25 = v7;
    obj = v7;
    v9 = [obj countByEnumeratingWithState:&v28 objects:v36 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v29;
      v12 = *MEMORY[0x277CCF0B0];
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v29 != v11)
          {
            objc_enumerationMutation(obj);
          }

          v14 = *(*(&v28 + 1) + 8 * i);
          v15 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v14];
          v16 = [(HMDHome *)self accessoryWithUUID:v15];

          if (v16)
          {
            v34[0] = v12;
            v34[1] = @"kAccessoryIsReachableKey";
            v35[0] = v14;
            v17 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v16, "isReachable")}];
            v35[1] = v17;
            v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:2];

            [v8 addObject:v18];
          }
        }

        v10 = [obj countByEnumeratingWithState:&v28 objects:v36 count:16];
      }

      while (v10);
    }

    v32 = @"kAccessoriesInfoDictionaryKey";
    v33 = v8;
    v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v33 forKeys:&v32 count:1];
    accessoriesCopy = v26;
    [v26 respondWithPayload:v19];

    v7 = v25;
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    selfCopy = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v38 = v23;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Query reachability request is missing accessory UUID in payload", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v8 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
    [accessoriesCopy respondWithError:v8];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate:(id)update
{
  v27 = *MEMORY[0x277D85DE8];
  updateCopy = update;
  v24 = 0;
  v5 = [updateCopy BOOLForKey:@"kEnabledKey" keyPresent:&v24];
  if (v24)
  {
    v6 = v5;
    if (v5 != [(HMDHome *)self isAutomaticThirdPartyAccessorySoftwareUpdateEnabled])
    {
      v7 = [HMDHomeSettingsModel alloc];
      uuid = [(HMDHome *)self uuid];
      v9 = [HMDHomeSettingsModel modelIDForHomeUUID:uuid];
      uuid2 = [(HMDHome *)self uuid];
      responseHandler2 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:2 uuid:v9 parentUUID:uuid2];

      v12 = [MEMORY[0x277CCABB0] numberWithBool:v6];
      [(HMDHomeSettingsModel *)responseHandler2 setAutomaticThirdPartyAccessorySoftwareUpdateEnabled:v12];

      backingStore = [(HMDHome *)self backingStore];
      v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v15 = [backingStore transaction:@"Update Automatic Accessory Firmware Update" options:v14];

      [v15 add:responseHandler2 withMessage:updateCopy];
      [v15 run];

LABEL_10:
      goto LABEL_11;
    }

    responseHandler = [updateCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [updateCopy responseHandler];
      (*&responseHandler2->super.super._bsoDataVersionOverride)(responseHandler2, 0, 0);
      goto LABEL_10;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    responseHandler3 = [updateCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      responseHandler4 = [updateCopy responseHandler];
      (responseHandler4)[2](responseHandler4, responseHandler2, 0);

      goto LABEL_10;
    }
  }

LABEL_11:

  v23 = *MEMORY[0x277D85DE8];
}

- (BOOL)isAutomaticThirdPartyAccessorySoftwareUpdateEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  automaticThirdPartyAccessorySoftwareUpdateEnabled = self->_automaticThirdPartyAccessorySoftwareUpdateEnabled;
  os_unfair_recursive_lock_unlock();
  return automaticThirdPartyAccessorySoftwareUpdateEnabled;
}

- (void)_handleUpdateAutomaticSoftwareUpdate:(id)update
{
  v44 = *MEMORY[0x277D85DE8];
  updateCopy = update;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v41 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling update automatic software update message", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v39 = 0;
  v9 = [updateCopy BOOLForKey:@"kEnabledKey" keyPresent:&v39];
  if (v39)
  {
    v10 = v9;
    isAutomaticSoftwareUpdateEnabled = [(HMDHome *)selfCopy isAutomaticSoftwareUpdateEnabled];
    v12 = objc_autoreleasePoolPush();
    v13 = selfCopy;
    v14 = HMFGetOSLogHandle();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_INFO);
    if (v10 != isAutomaticSoftwareUpdateEnabled)
    {
      if (v15)
      {
        v16 = HMFGetLogIdentifier();
        v17 = HMFBooleanToString();
        *buf = 138543618;
        v41 = v16;
        v42 = 2112;
        v43 = v17;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Updating automatic software update to: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v12);
      responseHandler2 = [HMDSoftwareUpdateAutomaticUpdateToggledEvent eventWithAutomaticUpdateEnabled:v10];
      logEventSubmitter = [(HMDHome *)v13 logEventSubmitter];
      [logEventSubmitter submitLogEvent:responseHandler2];

      v20 = [HMDHomeSettingsModel alloc];
      uuid = [(HMDHome *)v13 uuid];
      v22 = [HMDHomeSettingsModel modelIDForHomeUUID:uuid];
      uuid2 = [(HMDHome *)v13 uuid];
      v24 = [(HMDBackingStoreModelObject *)v20 initWithObjectChangeType:2 uuid:v22 parentUUID:uuid2];

      v25 = [MEMORY[0x277CCABB0] numberWithBool:v10];
      [(HMDHomeSettingsModel *)v24 setAutomaticSoftwareUpdateEnabled:v25];

      backingStore = [(HMDHome *)v13 backingStore];
      v27 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v28 = [backingStore transaction:@"Update Automatic Software Update" options:v27];

      [v28 add:v24 withMessage:updateCopy];
      [v28 run];

      goto LABEL_16;
    }

    if (v15)
    {
      v35 = HMFGetLogIdentifier();
      v36 = HMFBooleanToString();
      *buf = 138543618;
      v41 = v35;
      v42 = 2112;
      v43 = v36;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Not changing the setting because it is already set to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    responseHandler = [updateCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [updateCopy responseHandler];
      responseHandler2[2](responseHandler2, 0, 0);
      goto LABEL_16;
    }
  }

  else
  {
    v29 = objc_autoreleasePoolPush();
    v30 = selfCopy;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v32;
      _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v29);
    responseHandler3 = [updateCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      responseHandler4 = [updateCopy responseHandler];
      responseHandler4[2](responseHandler4, responseHandler2, 0);

LABEL_16:
    }
  }

  v38 = *MEMORY[0x277D85DE8];
}

- (void)setAutomaticSoftwareUpdateEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  v17 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (self->_automaticSoftwareUpdateEnabled == enabledCopy)
  {
    v5 = *MEMORY[0x277D85DE8];

    os_unfair_recursive_lock_unlock();
  }

  else
  {
    self->_automaticSoftwareUpdateEnabled = enabledCopy;
    os_unfair_recursive_lock_unlock();
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = HMFGetLogIdentifier();
      v10 = v9;
      v11 = @"disabled";
      if (enabledCopy)
      {
        v11 = @"enabled";
      }

      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Automatic software updates %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    [(HMDHome *)selfCopy _reevaluateAccessoryInfoWithBadgeRefresh:1];
    v12 = *MEMORY[0x277D85DE8];
  }
}

- (BOOL)isAutomaticSoftwareUpdateEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  automaticSoftwareUpdateEnabled = self->_automaticSoftwareUpdateEnabled;
  os_unfair_recursive_lock_unlock();
  return automaticSoftwareUpdateEnabled;
}

- (void)_handleHomeLocationUpdateFromSharedAdmin:(id)admin
{
  v32 = *MEMORY[0x277D85DE8];
  adminCopy = admin;
  v5 = [adminCopy dataForKey:@"kHomeLocationDataKey"];
  if (v5)
  {
    v25 = 0;
    v6 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v5 error:&v25];
    v7 = v25;
    if (!v6)
    {
      v18 = objc_autoreleasePoolPush();
      selfCopy = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543618;
        v27 = v21;
        v28 = 2112;
        v29 = v7;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive location from data: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
      goto LABEL_13;
    }

    v8 = [adminCopy numberForKey:@"HMD.LOC.SRC"];
    intValue = [v8 intValue];

    v10 = isInternalBuild();
    v11 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v13 = HMFGetOSLogHandle();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_INFO);
    if (v10)
    {
      if (v14)
      {
        v15 = HMFGetLogIdentifier();
        v16 = HMDHomeLocationSourceToString(intValue);
        *buf = 138543874;
        v27 = v15;
        v28 = 2112;
        v29 = v6;
        v30 = 2112;
        v31 = v16;
        v17 = "%{public}@Received new home location from shared admin: %@, source : %@";
LABEL_11:
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, v17, buf, 0x20u);
      }
    }

    else if (v14)
    {
      v15 = HMFGetLogIdentifier();
      v16 = HMDHomeLocationSourceToString(intValue);
      *buf = 138543875;
      v27 = v15;
      v28 = 2117;
      v29 = v6;
      v30 = 2112;
      v31 = v16;
      v17 = "%{public}@Received new home location from shared admin: %{sensitive}@, source : %@";
      goto LABEL_11;
    }

    objc_autoreleasePoolPop(v11);
    homeLocationHandler = [(HMDHome *)selfCopy2 homeLocationHandler];
    date = [MEMORY[0x277CBEAA8] date];
    [homeLocationHandler runTransactionWithLocation:v6 updatedTime:date source:intValue];

LABEL_13:
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_updateHomeLocation
{
  v40 = *MEMORY[0x277D85DE8];
  homeLocationHandler = [(HMDHome *)self homeLocationHandler];
  if (![homeLocationHandler regionStateAtHome])
  {

    goto LABEL_8;
  }

  homeLocationHandler2 = [(HMDHome *)self homeLocationHandler];
  regionStateNearbyHome = [homeLocationHandler2 regionStateNearbyHome];

  if (!regionStateNearbyHome)
  {
LABEL_8:
    v20 = objc_autoreleasePoolPush();
    selfCopy = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v31 = v23;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@No reachable accessories found and not all regions are determined. Setting Home location to unknown & home level to Not at Home.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v19 = 0;
    v18 = 0;
    goto LABEL_11;
  }

  v6 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    HMFGetLogIdentifier();
    v9 = v29 = v6;
    homeLocationHandler3 = [(HMDHome *)selfCopy2 homeLocationHandler];
    [homeLocationHandler3 regionStateAtHome];
    v11 = HMRegionStateString();
    homeLocationHandler4 = [(HMDHome *)selfCopy2 homeLocationHandler];
    [homeLocationHandler4 regionStateNearbyHome];
    v13 = HMRegionStateString();
    reachableAccessoriesCount = [(HMDHome *)selfCopy2 reachableAccessoriesCount];
    v15 = HMFBooleanToString();
    *buf = 138544386;
    v31 = v9;
    v32 = 2112;
    v33 = v11;
    v34 = 2112;
    v35 = v13;
    v36 = 2048;
    v37 = reachableAccessoriesCount;
    v38 = 2112;
    v39 = v15;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@RegionStateAtHome : %@, RegionStateNearbyHome : %@, reachableAccessoriesCount : %lu/%@", buf, 0x34u);

    v6 = v29;
  }

  objc_autoreleasePoolPop(v6);
  homeLocationHandler5 = [(HMDHome *)selfCopy2 homeLocationHandler];
  regionStateAtHome = [homeLocationHandler5 regionStateAtHome];

  if (regionStateAtHome == 1)
  {
    v18 = 2;
    v19 = 1;
  }

  else
  {
    homeLocationHandler6 = [(HMDHome *)selfCopy2 homeLocationHandler];
    regionStateNearbyHome2 = [homeLocationHandler6 regionStateNearbyHome];

    if (regionStateNearbyHome2 == 1)
    {
      v18 = 1;
      v19 = 3;
    }

    else
    {
      homeLocationHandler7 = [(HMDHome *)selfCopy2 homeLocationHandler];
      regionStateNearbyHome3 = [homeLocationHandler7 regionStateNearbyHome];

      if (regionStateNearbyHome3 != 2)
      {
        v18 = 0;
        goto LABEL_12;
      }

      v18 = 1;
      v19 = 2;
    }
  }

LABEL_11:
  [(HMDHome *)self setHomeLocation:v19];
LABEL_12:
  [(HMDHome *)self setAtHomeLevel:v18];
  v24 = *MEMORY[0x277D85DE8];
}

- (void)updateHomeLocation
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_updateHomeLocation__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)matterAccessoryBecameReachable
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __41__HMDHome_matterAccessoryBecameReachable__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __41__HMDHome_matterAccessoryBecameReachable__block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) homeLocationHandler];
  [v1 matterAccessoryBecameReachable];
}

- (void)updateHomeLocationForPairing
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __39__HMDHome_updateHomeLocationForPairing__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __39__HMDHome_updateHomeLocationForPairing__block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) homeLocationHandler];
  [v1 updateHomeLocationForPairing];
}

- (void)setHomeLocation:(int64_t)location
{
  v23 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  v5 = 0;
  homeLocation = self->_homeLocation;
  if (homeLocation != location)
  {
    self->_homeLocation = location;
    v5 = !self->_overrideHomeLocation;
  }

  os_unfair_recursive_lock_unlock();
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    if (v5)
    {
      v11 = @"Updated";
    }

    else
    {
      v11 = @"Did not update";
    }

    v12 = HMStringFromHomeLocation();
    v13 = HMStringFromHomeLocation();
    v15 = 138544130;
    v16 = v10;
    v17 = 2112;
    v18 = v11;
    v19 = 2112;
    v20 = v12;
    v21 = 2112;
    v22 = v13;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ home location from %@ to %@", &v15, 0x2Au);
  }

  objc_autoreleasePoolPop(v7);
  if (v5)
  {
    [(HMDHome *)selfCopy _handleHomeLocationChange:location previousLocation:homeLocation];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeLocationChange:(int64_t)change previousLocation:(int64_t)location
{
  v41[1] = *MEMORY[0x277D85DE8];
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    name = [(HMDHome *)selfCopy name];
    shortDescription = [(HMDHome *)selfCopy shortDescription];
    v13 = HMStringFromHomeLocation();
    v14 = HMStringFromHomeLocation();
    *buf = 138544386;
    *&buf[4] = v10;
    v33 = 2112;
    v34 = name;
    v35 = 2112;
    v36 = shortDescription;
    v37 = 2112;
    v38 = v13;
    v39 = 2112;
    v40 = v14;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Location status for home %@/%@ changing from %@ to %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v7);
  notificationCenter = [(HMDHome *)selfCopy notificationCenter];
  [notificationCenter postNotificationName:@"HMDHomeLocationChangedNotification" object:selfCopy];

  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid = [(HMDHome *)selfCopy uuid];
  [homeManager updateGenerationCounterWithReason:@"HomeLocationChanged" sourceUUID:uuid shouldNotifyClients:0];

  v18 = MEMORY[0x277D0F818];
  v19 = *MEMORY[0x277CD0058];
  v20 = selfCopy;
  uuid2 = [(HMDHome *)v20 uuid];
  v41[0] = *MEMORY[0x277CD0068];
  v22 = [MEMORY[0x277CCABB0] numberWithInteger:change];
  *buf = v22;
  v23 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:buf forKeys:v41 count:1];
  v24 = [v18 homeLocationAuthorizedAndEntitledMessageWithName:v19 target:uuid2 messagePayload:v23];

  msgDispatcher = [(HMDHome *)v20 msgDispatcher];

  [msgDispatcher sendMessage:v24 completionHandler:0];
  if (change == 1)
  {
    workQueue = [(HMDHome *)v20 workQueue];
    v27 = workQueue;
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke;
    v31[3] = &unk_27868A728;
    v31[4] = v20;
    v28 = v31;
LABEL_10:
    dispatch_async(workQueue, v28);

    goto LABEL_11;
  }

  if (change == 3 && location != 2 || change == 2 && location != 3)
  {
    workQueue = [(HMDHome *)v20 workQueue];
    v27 = workQueue;
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke_1939;
    v30[3] = &unk_27868A728;
    v30[4] = v20;
    v28 = v30;
    goto LABEL_10;
  }

LABEL_11:
  v29 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Did arrive home", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeDidArriveHomeNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke_1939(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Did leave home", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeDidLeaveHomeNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

- (int64_t)homeLocation
{
  os_unfair_recursive_lock_lock_with_options();
  if (self->_overrideHomeLocation)
  {
    v3 = &OBJC_IVAR___HMDHome__overriddenHomeLocation;
  }

  else
  {
    v3 = &OBJC_IVAR___HMDHome__homeLocation;
  }

  v4 = *(&self->super.super.isa + *v3);
  os_unfair_recursive_lock_unlock();
  return v4;
}

- (void)setAtHomeLevel:(int64_t)level
{
  v26 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  atHomeLevel = self->_atHomeLevel;
  if (atHomeLevel != level)
  {
    self->_atHomeLevel = level;
  }

  os_unfair_recursive_lock_unlock();
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = v9;
    v11 = @"Updated";
    if (atHomeLevel == level)
    {
      v11 = @"Did not update";
    }

    if (atHomeLevel > 3)
    {
      v12 = @"HMDAtHomeLevelNotAtHome";
    }

    else
    {
      v12 = off_278670AF0[atHomeLevel];
    }

    if (level > 3)
    {
      v13 = @"HMDAtHomeLevelNotAtHome";
    }

    else
    {
      v13 = off_278670AF0[level];
    }

    v18 = 138544130;
    v19 = v9;
    v20 = 2112;
    v21 = v11;
    v22 = 2112;
    v23 = v12;
    v24 = 2112;
    v25 = v13;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@%@ atHomeLevel from %@ to %@", &v18, 0x2Au);
  }

  objc_autoreleasePoolPop(v6);
  if (atHomeLevel != level)
  {
    residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
    [residentDeviceManager atHomeLevelChanged:level];

    homeManager = [(HMDHome *)selfCopy homeManager];
    uuid = [(HMDHome *)selfCopy uuid];
    [homeManager atHomeLevelChanged:level formerLevel:atHomeLevel home:uuid];
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (int64_t)atHomeLevel
{
  os_unfair_recursive_lock_lock_with_options();
  atHomeLevel = self->_atHomeLevel;
  os_unfair_recursive_lock_unlock();
  return atHomeLevel;
}

- (BOOL)enabledResidentsSupportsHomeHub
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  availableResidentDevices = [residentDeviceManager availableResidentDevices];
  v4 = [availableResidentDevices na_any:&__block_literal_global_1929];

  return v4;
}

uint64_t __42__HMDHome_enabledResidentsSupportsHomeHub__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 capabilities];
  v3 = [v2 supportsHomeHub];

  return v3;
}

- (BOOL)currentDeviceSupportsSidekickSettings
{
  homeManager = [(HMDHome *)self homeManager];
  capabilitiesController = [homeManager capabilitiesController];
  currentResidentCapabilities = [capabilitiesController currentResidentCapabilities];
  supportsSiriEndpointSetup = [currentResidentCapabilities supportsSiriEndpointSetup];

  return supportsSiriEndpointSetup;
}

- (BOOL)supportsSiriEndpointOnBoarding
{
  v34 = *MEMORY[0x277D85DE8];
  primaryResident = [(HMDHome *)self primaryResident];
  capabilities = [primaryResident capabilities];
  supportsSiriEndpointSetup = [capabilities supportsSiriEndpointSetup];

  if (supportsSiriEndpointSetup)
  {
    array = [MEMORY[0x277CBEB18] array];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
    v8 = [appleMediaAccessories countByEnumeratingWithState:&v28 objects:v33 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v29;
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v29 != v10)
          {
            objc_enumerationMutation(appleMediaAccessories);
          }

          device = [*(*(&v28 + 1) + 8 * i) device];
          if (device)
          {
            [array addObject:device];
          }
        }

        v9 = [appleMediaAccessories countByEnumeratingWithState:&v28 objects:v33 count:16];
      }

      while (v9);
    }

    v26 = 0u;
    v27 = 0u;
    v24 = 0u;
    v25 = 0u;
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];

    v15 = [residentDevices countByEnumeratingWithState:&v24 objects:v32 count:16];
    if (v15)
    {
      v16 = *v25;
      do
      {
        for (j = 0; j != v15; ++j)
        {
          if (*v25 != v16)
          {
            objc_enumerationMutation(residentDevices);
          }

          v18 = *(*(&v24 + 1) + 8 * j);
          device2 = [v18 device];
          capabilities2 = [v18 capabilities];
          if ([capabilities2 supportsHomeHub])
          {
            v21 = [array containsObject:device2];

            if (v21)
            {

              LOBYTE(v15) = 1;
              goto LABEL_24;
            }
          }

          else
          {
          }
        }

        v15 = [residentDevices countByEnumeratingWithState:&v24 objects:v32 count:16];
      }

      while (v15);
    }

LABEL_24:
  }

  else
  {
    LOBYTE(v15) = 0;
  }

  v22 = *MEMORY[0x277D85DE8];
  return v15;
}

- (void)handleSiriEndPointAddedNotification:(id)notification
{
  v27 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  object = [notificationCopy object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = object;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (!v7)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v12;
      v23 = 2112;
      v24 = notificationCopy;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Unable to synchronize settings after receiving endpoint added notification with no HAP accessory. %@", &v21, 0x16u);
      goto LABEL_10;
    }

LABEL_11:

    objc_autoreleasePoolPop(v9);
    goto LABEL_12;
  }

  home = [v7 home];

  if (home != self)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      home2 = [v7 home];
      v21 = 138543874;
      v22 = v12;
      v23 = 2112;
      v24 = v7;
      v25 = 2112;
      v26 = home2;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@New accessory is added for another home for HAP accessory: %@ home:%@", &v21, 0x20u);

LABEL_10:
      goto LABEL_11;
    }

    goto LABEL_11;
  }

  siriEndpointProfile = [v7 siriEndpointProfile];

  if (siriEndpointProfile)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      v19 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v19;
      v23 = 2112;
      v24 = v7;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEFAULT, "%{public}@A siri endpoint accessory is added. Confirm resident device: %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    residentDeviceManager = [(HMDHome *)selfCopy3 residentDeviceManager];
    [residentDeviceManager confirmWithCompletionHandler:0];
  }

LABEL_12:

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleEnableNotifications:(id)notifications
{
  v51 = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v44 = 0;
  v6 = [notificationsCopy BOOLForKey:*MEMORY[0x277CD2158] keyPresent:&v44];
  v43 = 0;
  v7 = [notificationsCopy BOOLForKey:*MEMORY[0x277CCFED8] keyPresent:&v43];
  if (v44 == 1 && (v43 & 1) != 0)
  {
    v8 = v7;
    clientIdentifier = [notificationsCopy clientIdentifier];
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    v13 = v12;
    if (clientIdentifier)
    {
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v15 = HMFBooleanToString();
        *buf = 138543874;
        v46 = v14;
        v47 = 2112;
        v48 = clientIdentifier;
        v49 = 2112;
        v50 = v15;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Handling Enable Notifications from ClientIdentifier: %@, setting: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v10);
      if (v6)
      {
        [(HMDHome *)selfCopy removeNotificationDeregistrationForClientIdentifier:clientIdentifier];
        notificationRegistrations = [(HMDHome *)selfCopy notificationRegistrations];
        v17 = [notificationRegistrations count];

        notificationRegistrationsForAppleMediaAccessories = [(HMDHome *)selfCopy notificationRegistrationsForAppleMediaAccessories];
        v19 = ([notificationRegistrationsForAppleMediaAccessories count] == 0) & v8;

        [(HMDHome *)selfCopy addNotificationRegistrationForClientIdentifier:clientIdentifier includesAppleMediaAccessories:v8];
        if (v19 == 1)
        {
          v20 = objc_autoreleasePoolPush();
          v21 = selfCopy;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
          {
            v23 = HMFGetLogIdentifier();
            *buf = 138543362;
            v46 = v23;
            _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Modifying direct Apple Media notification registrations with resident due to HomeKit client request", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v20);
          mediaStateSubscriber = [(HMDHome *)v21 mediaStateSubscriber];
          [mediaStateSubscriber subscribeForAppleMediaStateWithSubscriptionToken:@"HMDHomeClientMediaStateRegistrationToken"];
        }

        if (!v17)
        {
          v25 = objc_autoreleasePoolPush();
          v26 = selfCopy;
          v27 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
          {
            v28 = HMFGetLogIdentifier();
            *buf = 138543362;
            v46 = v28;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to HomeKit client request", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v25);
          [(HMDHome *)v26 _subscribeForHomeNotificationsFromRemoteGateway:1];
          [(HMDHome *)v26 _subscribeForHomeNotificationsOnDirectTransports:?];
          date = [MEMORY[0x277CBEAA8] date];
          [(HMDHome *)v26 setNotificationsUpdatedTime:date];
        }

        homeManager = [(HMDHome *)selfCopy homeManager];
        chipDataSource = [homeManager chipDataSource];
        [chipDataSource updateNotificationsEnabled:1 forHome:selfCopy keepAliveOnly:0];

        logAndPostNotification(@"HMDHomeDidEnableCharacteristicNotifyEventNotification", selfCopy, 0);
        [(HMDHome *)selfCopy _refreshCharacteristicValuesOnHomeNotificationEnable];
      }

      else
      {
        [(HMDHome *)selfCopy addNotificationDeregistrationForClientIdentifier:clientIdentifier];
        [(HMDHome *)selfCopy _startHomeNotificationDeregistrationTimer];
      }

      mEMORY[0x277D0F8C0] = [MEMORY[0x277D0F8C0] sharedPowerLogger];
      [mEMORY[0x277D0F8C0] reportCharacteristicNotificationRegistrationEvent:v6 clientIdentifier:clientIdentifier];

      [notificationsCopy respondWithSuccess];
    }

    else
    {
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v39 = HMFGetLogIdentifier();
        *buf = 138543362;
        v46 = v39;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Unable to look up the client identifier from request to enable home notifications", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v10);
      clientIdentifier = [notificationsCopy responseHandler];

      if (clientIdentifier)
      {
        responseHandler = [notificationsCopy responseHandler];
        v41 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
        (responseHandler)[2](responseHandler, v41, 0);

        clientIdentifier = 0;
      }
    }
  }

  else
  {
    v32 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      v36 = HMFBooleanToString();
      v37 = HMFBooleanToString();
      *buf = 138543874;
      v46 = v35;
      v47 = 2112;
      v48 = v36;
      v49 = 2112;
      v50 = v37;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key (hasHAPKey: %@, hasAppleMediaKey: %@) to enable home notifications", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v32);
    clientIdentifier = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [notificationsCopy respondWithError:clientIdentifier];
  }

  v38 = *MEMORY[0x277D85DE8];
}

- (void)_refreshCharacteristicValuesOnHomeNotificationEnable
{
  v78 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v4 = [MEMORY[0x277CBEB58] set];
  v65 = 0u;
  v66 = 0u;
  v67 = 0u;
  v68 = 0u;
  selfCopy = self;
  obj = [(HMDHome *)self accessories];
  v49 = [obj countByEnumeratingWithState:&v65 objects:v77 count:16];
  if (v49)
  {
    v47 = *v66;
    p_info = &OBJC_METACLASS___HMDHAPAccessoryPrimaryResidentWriteTask.info;
    do
    {
      v6 = 0;
      do
      {
        if (*v66 != v47)
        {
          objc_enumerationMutation(obj);
        }

        v51 = v6;
        v7 = *(*(&v65 + 1) + 8 * v6);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        v64[0] = MEMORY[0x277D85DD0];
        v64[1] = 3221225472;
        v64[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke;
        v64[3] = &unk_278687EB0;
        v64[4] = selfCopy;
        v10 = [v9 characteristicsPassingTest:v64];
        v60 = 0u;
        v61 = 0u;
        v62 = 0u;
        v63 = 0u;
        v11 = [v10 countByEnumeratingWithState:&v60 objects:v76 count:16];
        if (v11)
        {
          v12 = v11;
          v13 = *v61;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v61 != v13)
              {
                objc_enumerationMutation(v10);
              }

              v15 = [p_info + 476 requestWithCharacteristic:*(*(&v60 + 1) + 8 * i)];
              [array addObject:v15];
            }

            v12 = [v10 countByEnumeratingWithState:&v60 objects:v76 count:16];
          }

          while (v12);
        }

        v58 = 0u;
        v59 = 0u;
        v56 = 0u;
        v57 = 0u;
        v50 = v9;
        lightProfiles = [v9 lightProfiles];
        allObjects = [lightProfiles allObjects];

        v18 = [allObjects countByEnumeratingWithState:&v56 objects:v75 count:16];
        if (v18)
        {
          v19 = v18;
          v20 = *v57;
          do
          {
            for (j = 0; j != v19; ++j)
            {
              if (*v57 != v20)
              {
                objc_enumerationMutation(allObjects);
              }

              v22 = *(*(&v56 + 1) + 8 * j);
              if (![v22 supportsCHIP] || (_os_feature_enabled_impl() & 1) == 0)
              {
                readCharacteristicRequests = [v22 readCharacteristicRequests];
                if ([readCharacteristicRequests count])
                {
                  [readCharacteristicRequests allObjects];
                  v25 = v24 = v4;
                  [array addObjectsFromArray:v25];

                  v4 = v24;
                  [v24 addObject:v22];
                }
              }
            }

            v19 = [allObjects countByEnumeratingWithState:&v56 objects:v75 count:16];
          }

          while (v19);
        }

        v6 = v51 + 1;
        p_info = (&OBJC_METACLASS___HMDHAPAccessoryPrimaryResidentWriteTask + 32);
      }

      while (v51 + 1 != v49);
      v49 = [obj countByEnumeratingWithState:&v65 objects:v77 count:16];
    }

    while (v49);
  }

  hmf_isEmpty = [array hmf_isEmpty];
  v27 = objc_autoreleasePoolPush();
  v28 = selfCopy;
  v29 = HMFGetOSLogHandle();
  v30 = os_log_type_enabled(v29, OS_LOG_TYPE_INFO);
  if (hmf_isEmpty)
  {
    if (v30)
    {
      v31 = HMFGetLogIdentifier();
      *buf = 138543362;
      v72 = v31;
      _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Not refreshing characteristics as read requests are empty", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v27);
  }

  else
  {
    if (v30)
    {
      v32 = HMFGetLogIdentifier();
      v33 = [array count];
      *buf = 138543618;
      v72 = v32;
      v73 = 2048;
      v74 = v33;
      _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Issuing %ld characteristic read requests when Home app enabled notifications", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v27);
    v34 = MEMORY[0x277D0F818];
    allMessageDestinations = [MEMORY[0x277D0F820] allMessageDestinations];
    v69 = @"kMultiPartResponseKey";
    v70 = MEMORY[0x277CBEC38];
    v36 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v70 forKeys:&v69 count:1];
    v37 = [v34 messageWithName:@"kMultipleCharacteristicReadRequestKey" destination:allMessageDestinations payload:v36];

    v38 = objc_autoreleasePoolPush();
    v39 = v28;
    v40 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
    {
      v41 = HMFGetLogIdentifier();
      [v37 identifier];
      v43 = v42 = v4;
      *buf = 138543618;
      v72 = v41;
      v73 = 2114;
      v74 = v43;
      _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: App enabled notifications", buf, 0x16u);

      v4 = v42;
    }

    objc_autoreleasePoolPop(v38);
    v44 = [array copy];
    v52[0] = MEMORY[0x277D85DD0];
    v52[1] = 3221225472;
    v52[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1925;
    v52[3] = &unk_278686658;
    v53 = array;
    v54 = v39;
    v55 = v4;
    [(HMDHome *)v39 _readCharacteristicValues:v44 requestMessage:v37 source:1120 withCompletionHandler:v52];
  }

  v45 = *MEMORY[0x277D85DE8];
}

uint64_t __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 type];
  v5 = [v3 service];

  v6 = [v5 type];

  v7 = [*(a1 + 32) dataSource];
  v8 = [v7 hapMetadata];
  v9 = [v8 shouldRefreshValueForCharacteristicWithType:v4 serviceType:v6];

  return v9;
}

void __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1925(uint64_t a1, void *a2, void *a3)
{
  v59 = *MEMORY[0x277D85DE8];
  v36 = a2;
  v37 = a3;
  v47 = 0u;
  v48 = 0u;
  v49 = 0u;
  v50 = 0u;
  v5 = a1;
  obj = *(a1 + 32);
  v6 = [obj countByEnumeratingWithState:&v47 objects:v58 count:16];
  if (v6)
  {
    v8 = v6;
    v9 = *v48;
    *&v7 = 138543874;
    v33 = v7;
    v34 = *v48;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v48 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v47 + 1) + 8 * i);
        v12 = [v11 characteristic];
        v46 = 0;
        v13 = [v37 hmd_valueOfCharacteristic:v12 error:&v46];
        v14 = v46;

        v15 = objc_autoreleasePoolPush();
        v16 = *(v5 + 40);
        v17 = HMFGetOSLogHandle();
        v18 = v17;
        if (v13)
        {
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
            goto LABEL_12;
          }

          v19 = HMFGetLogIdentifier();
          *buf = v33;
          v53 = v19;
          v54 = 2112;
          v55 = v11;
          v56 = 2112;
          v57 = v13;
          v20 = v18;
          v21 = OS_LOG_TYPE_INFO;
          v22 = "%{public}@Characteristic read request succeeded when Home app enabled notifications %@:%@";
        }

        else
        {
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_12;
          }

          v19 = HMFGetLogIdentifier();
          *buf = v33;
          v53 = v19;
          v54 = 2112;
          v55 = v11;
          v56 = 2112;
          v57 = v14;
          v20 = v18;
          v21 = OS_LOG_TYPE_ERROR;
          v22 = "%{public}@Characteristic read request when Home app enabled notification failed %@:%@";
        }

        _os_log_impl(&dword_229538000, v20, v21, v22, buf, 0x20u);

        v9 = v34;
LABEL_12:

        objc_autoreleasePoolPop(v15);
      }

      v8 = [obj countByEnumeratingWithState:&v47 objects:v58 count:16];
    }

    while (v8);
  }

  v44 = 0u;
  v45 = 0u;
  v42 = 0u;
  v43 = 0u;
  v23 = *(v5 + 48);
  v24 = [v23 countByEnumeratingWithState:&v42 objects:v51 count:16];
  if (v24)
  {
    v25 = v24;
    v26 = *v43;
    do
    {
      for (j = 0; j != v25; ++j)
      {
        if (*v43 != v26)
        {
          objc_enumerationMutation(v23);
        }

        v28 = *(*(&v42 + 1) + 8 * j);
        v29 = [v28 workQueue];
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1926;
        block[3] = &unk_2786891E0;
        block[4] = v28;
        v30 = v37;
        v31 = *(v5 + 40);
        v39 = v30;
        v40 = v31;
        v41 = v36;
        dispatch_async(v29, block);
      }

      v25 = [v23 countByEnumeratingWithState:&v42 objects:v51 count:16];
    }

    while (v25);
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1926(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v18 = 0;
  v4 = [v2 updateSettingsWithReadCharacteristicResponsePayload:v3 error:&v18];
  v5 = v18;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 48);
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v4)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 32);
      *buf = 138543874;
      v20 = v10;
      v21 = 2112;
      v22 = v11;
      v23 = 2112;
      v24 = v4;
      v12 = "%{public}@Successfully updated light profile settings %@:%@";
      v13 = v9;
      v14 = OS_LOG_TYPE_INFO;
LABEL_6:
      _os_log_impl(&dword_229538000, v13, v14, v12, buf, 0x20u);
    }
  }

  else if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v15 = *(a1 + 32);
    v16 = *(a1 + 56);
    *buf = 138543874;
    v20 = v10;
    v21 = 2112;
    v22 = v15;
    v23 = 2112;
    v24 = v16;
    v12 = "%{public}@Failed to update light profile settings %@:%@";
    v13 = v9;
    v14 = OS_LOG_TYPE_ERROR;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v6);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForWalletKeyChange:(id)change message:(id)message
{
  v17 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543362;
    v16 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has onboarded for wallet key value changed, sending notification", &v15, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  hasOnboardedForWalletKey = [changeCopy hasOnboardedForWalletKey];
  -[HMDHome setHasOnboardedForWalletKey:](selfCopy, "setHasOnboardedForWalletKey:", [hasOnboardedForWalletKey BOOLValue]);

  notificationCenter = [(HMDHome *)selfCopy notificationCenter];
  [notificationCenter postNotificationName:@"HMDHomeHasOnboardedForWalletKeyChangeNotification" object:selfCopy];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForAccessCodeChange:(id)change message:(id)message
{
  v17 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543362;
    v16 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has onboarded for access code value changed, sending notification", &v15, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  hasOnboardedForAccessCode = [changeCopy hasOnboardedForAccessCode];
  -[HMDHome setHasOnboardedForAccessCode:](selfCopy, "setHasOnboardedForAccessCode:", [hasOnboardedForAccessCode BOOLValue]);

  notificationCenter = [(HMDHome *)selfCopy notificationCenter];
  [notificationCenter postNotificationName:@"HMDHomeHasOnboardedForAccessCodeChangeNotification" object:selfCopy];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:(id)change message:(id)message
{
  v16 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v14 = 138543362;
    v15 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has any user acknowledged camera recording onboarding value changed, sending notification", &v14, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  hasAnyUserAcknowledgedCameraRecordingOnboarding = [changeCopy hasAnyUserAcknowledgedCameraRecordingOnboarding];
  -[HMDHome setHasAnyUserAcknowledgedCameraRecordingOnboarding:](selfCopy, "setHasAnyUserAcknowledgedCameraRecordingOnboarding:", [hasAnyUserAcknowledgedCameraRecordingOnboarding BOOLValue]);

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleResolveThreadNetworkRequest:(id)request
{
  v22 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v21 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve thread network credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = +[HMDThreadNetworkMetadataStore defaultStore];
  if (v9)
  {
    threadOperationalDataset = [(HMDHome *)selfCopy threadOperationalDataset];
    objc_initWeak(buf, selfCopy);
    doesHomeContainResident = [(HMDHome *)selfCopy doesHomeContainResident];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __46__HMDHome__handleResolveThreadNetworkRequest___block_invoke;
    v17[3] = &unk_278673288;
    objc_copyWeak(&v19, buf);
    v18 = requestCopy;
    [v9 retrieveMetadata:threadOperationalDataset homeHasResident:doesHomeContainResident completion:v17];

    objc_destroyWeak(&v19);
    objc_destroyWeak(buf);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = selfCopy;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v21 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    threadOperationalDataset = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [requestCopy respondWithError:threadOperationalDataset];
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleResolveThreadNetworkRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v34 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = WeakRetained;
  if (v5 && WeakRetained)
  {
    v25 = 0;
    v9 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v5 requiringSecureCoding:1 error:&v25];
    v10 = v25;
    if (v9)
    {
      v11 = *(a1 + 32);
      v26 = *MEMORY[0x277CD0620];
      v27 = v9;
      v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
      [v11 respondWithPayload:v12];
    }

    else
    {
      v19 = objc_autoreleasePoolPush();
      v20 = v8;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138543618;
        v29 = v22;
        v30 = 2112;
        v31 = v10;
        _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@Unable to encode credentials: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v19);
      v23 = *(a1 + 32);
      v12 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
      [v23 respondWithError:v12];
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = v8;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v14 threadNetworkID];
      *buf = 138543874;
      v29 = v16;
      v30 = 2112;
      v31 = v17;
      v32 = 2112;
      v33 = v6;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network '%@': %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v18 = *(a1 + 32);
    v10 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v18 respondWithError:v10];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeUpdateDidOnboardLocationServicesRequest:(id)request
{
  v35 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v32 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update did onboard locations services request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  messagePayload = [requestCopy messagePayload];
  v11 = *MEMORY[0x277CCFEB0];
  v30 = 0;
  v12 = [messagePayload hmf_BOOLForKey:v11 error:&v30];
  v13 = v30;

  if (v13)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = selfCopy;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      messagePayload2 = [requestCopy messagePayload];
      *buf = 138543618;
      v32 = v17;
      v33 = 2112;
      v34 = messagePayload2;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode did onboard location services from update request payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    [requestCopy respondWithError:v13];
  }

  else
  {
    v19 = [HMDHomeModel alloc];
    uuid = [(HMDHome *)selfCopy uuid];
    homeManager = [(HMDHome *)selfCopy homeManager];
    uuid2 = [homeManager uuid];
    v23 = [(HMDBackingStoreModelObject *)v19 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

    v24 = [MEMORY[0x277CCABB0] numberWithBool:v12];
    [(HMDHomeModel *)v23 setDidOnboardLocationServices:v24];

    backingStore = [(HMDHome *)selfCopy backingStore];
    name = [requestCopy name];
    v27 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v28 = [backingStore transaction:name options:v27];

    [v28 add:v23 withMessage:requestCopy];
    [v28 run];
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleDidOnboardLocationServicesChange:(id)change message:(id)message
{
  v20 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  didOnboardLocationServices = [changeCopy didOnboardLocationServices];
  bOOLValue = [didOnboardLocationServices BOOLValue];

  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    v16 = 138543618;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Updating did onboard location services: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  [(HMDHome *)selfCopy setDidOnboardLocationServices:bOOLValue];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeUpdateLocationServicesEnabledRequest:(id)request
{
  v25 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v22 = v9;
    v23 = 2112;
    v24 = requestCopy;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update location services enabled request message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  messagePayload = [requestCopy messagePayload];
  v11 = *MEMORY[0x277CD0050];
  v20 = 0;
  v12 = [messagePayload hmf_BOOLForKey:v11 error:&v20];
  v13 = v20;

  if (v13)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = selfCopy;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      messagePayload2 = [requestCopy messagePayload];
      *buf = 138543618;
      v22 = v17;
      v23 = 2112;
      v24 = messagePayload2;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode location services enabled from update request payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    [requestCopy respondWithError:v13];
  }

  else
  {
    [(HMDHome *)selfCopy runLocationServicesEnabledUpdateWithValue:v12 message:requestCopy];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)_handleLocationServicesEnabledChange:(id)change message:(id)message
{
  v20 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  locationServicesEnabled = [changeCopy locationServicesEnabled];
  bOOLValue = [locationServicesEnabled BOOLValue];

  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    v16 = 138543618;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Updating location services enabled: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  [(HMDHome *)selfCopy setLocationServicesEnabled:bOOLValue];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleSoundCheckUpdateRequest:(id)request
{
  v28 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v27 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update soundCheck request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)selfCopy uuid];
  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid2 = [homeManager uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  messagePayload = [requestCopy messagePayload];
  v16 = *MEMORY[0x277CD05F0];
  v25 = 0;
  v17 = [messagePayload hmf_BOOLForKey:v16 error:&v25];
  v18 = v25;

  if (v18)
  {
    [requestCopy respondWithError:v18];
  }

  else
  {
    v19 = [MEMORY[0x277CCABB0] numberWithBool:v17];
    [(HMDHomeModel *)v14 setSoundCheckEnabled:v19];

    backingStore = [(HMDHome *)selfCopy backingStore];
    name = [requestCopy name];
    v22 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v23 = [backingStore transaction:name options:v22];

    [v23 add:v14 withMessage:requestCopy];
    [v23 run];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleSoundCheckChange:(id)change message:(id)message
{
  soundCheckEnabled = [change soundCheckEnabled];
  -[HMDHome setSoundCheckEnabled:](self, "setSoundCheckEnabled:", [soundCheckEnabled BOOLValue]);
}

- (BOOL)_validateSettingsUpdate:(id)update type:(int64_t *)type keyPath:(id *)path value:(id *)value error:(id *)error
{
  v44 = *MEMORY[0x277D85DE8];
  updateCopy = update;
  v13 = [updateCopy uuidForKey:@"kUserUUIDKey"];
  if (!v13)
  {
    if (error)
    {
      v19 = MEMORY[0x277CCA9B8];
      v20 = 27;
      goto LABEL_10;
    }

LABEL_11:
    v21 = 0;
    goto LABEL_33;
  }

  currentUser = [(HMDHome *)self currentUser];
  uuid = [currentUser uuid];
  v16 = [uuid hmf_isEqualToUUID:v13];

  if ((v16 & 1) == 0)
  {
    if (error)
    {
      v19 = MEMORY[0x277CCA9B8];
      v20 = 48;
      goto LABEL_10;
    }

    goto LABEL_11;
  }

  v17 = [updateCopy numberForKey:*MEMORY[0x277CD0F90]];
  integerValue = [v17 integerValue];

  if ((integerValue - 3) > 0xFFFFFFFFFFFFFFFDLL)
  {
    v22 = [updateCopy stringForKey:*MEMORY[0x277CD0F88]];
    if (!v22)
    {
      if (error)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
        *error = v21 = 0;
      }

      else
      {
        v21 = 0;
      }

      goto LABEL_32;
    }

    v23 = [updateCopy dataForKey:*MEMORY[0x277CCEDA8]];
    if (!v23)
    {
      if (error)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
        *error = v21 = 0;
        v23 = 0;
      }

      else
      {
        v21 = 0;
      }

      goto LABEL_31;
    }

    v37 = v22;
    v38 = v23;
    v39 = 0;
    v24 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v23 error:&v39];
    v35 = v39;
    v36 = v24;
    v21 = v24 != 0;
    if (v24)
    {
      v22 = v37;
      if (type)
      {
        *type = integerValue;
      }

      v25 = v35;
      if (path)
      {
        v26 = v37;
        *path = v37;
      }

      v27 = v36;
      if (!value)
      {
        goto LABEL_30;
      }

      numberValue = [v36 numberValue];
      error = value;
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      selfCopy = self;
      v31 = HMFGetOSLogHandle();
      v25 = v35;
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543618;
        v41 = v32;
        v42 = 2112;
        v43 = v35;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setting value from encoded value: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v29);
      v27 = 0;
      v22 = v37;
      if (!error)
      {
        goto LABEL_30;
      }

      numberValue = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    }

    *error = numberValue;
LABEL_30:

    v23 = v38;
LABEL_31:

LABEL_32:
    goto LABEL_33;
  }

  if (!error)
  {
    goto LABEL_11;
  }

  v19 = MEMORY[0x277CCA9B8];
  v20 = 3;
LABEL_10:
  [v19 hmErrorWithCode:v20];
  *error = v21 = 0;
LABEL_33:

  v33 = *MEMORY[0x277D85DE8];
  return v21;
}

- (void)_handleSharedUserSettingsUpdate:(id)update
{
  updateCopy = update;
  v21 = 0;
  v22 = 0;
  v19 = 0;
  v20 = 0;
  v5 = [(HMDHome *)self _validateSettingsUpdate:updateCopy type:&v22 keyPath:&v21 value:&v20 error:&v19];
  v6 = v21;
  v7 = v20;
  v8 = v19;
  v9 = v8;
  if (v5)
  {
    backingStore = [(HMDHome *)self backingStore];
    context = [backingStore context];
    managedObjectContext = [context managedObjectContext];

    homeManager = [(HMDHome *)self homeManager];
    sharedUserPrivateSettingsManager = [homeManager sharedUserPrivateSettingsManager];

    dictionary = [MEMORY[0x277CBEB38] dictionary];
    [dictionary setObject:v7 forKeyedSubscript:v6];
    if ([v6 isEqualToString:@"root.siri.identifyVoice"] && objc_msgSend(v7, "isEqualToNumber:", &unk_283E71B10))
    {
      [dictionary setObject:v7 forKeyedSubscript:@"root.music.allowiTunesAccount"];
    }

    uuid = [(HMDHome *)self uuid];
    v17 = [sharedUserPrivateSettingsManager updateSettingsForHome:uuid ofType:v22 withValues:dictionary context:managedObjectContext];
    [updateCopy respondWithOutcomeOf:v17];
  }

  else if (v8)
  {
    [updateCopy respondWithError:v8];
  }

  else
  {
    v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [updateCopy respondWithError:v18];
  }
}

- (void)_updateOwnerSettingDependents:(id)dependents keyPath:(id)path value:(id)value
{
  v65 = *MEMORY[0x277D85DE8];
  dependentsCopy = dependents;
  pathCopy = path;
  valueCopy = value;
  if ([pathCopy isEqualToString:@"root.siri.identifyVoice"])
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v56 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Updating owner setting dependents", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    if ([valueCopy isEqualToNumber:&unk_283E71A20])
    {
      v15 = +[_MKFUser entity];
      v16 = [v15 hmd_attributeForSettingsPath:@"root.music.playbackInfluencesForYou"];

      v47 = dependentsCopy;
      v17 = selfCopy;
      if (v16)
      {
        v18 = objc_autoreleasePoolPush();
        v19 = selfCopy;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
        {
          v21 = HMFGetLogIdentifier();
          name = [v16 name];
          *buf = 138544386;
          v56 = v21;
          v57 = 2112;
          v58 = @"root.music.playbackInfluencesForYou";
          v59 = 2112;
          v60 = name;
          v61 = 2112;
          v62 = valueCopy;
          v63 = 2112;
          v64 = @"root.siri.identifyVoice";
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Updating setting '%@' (%@) = %@ due to %@ is off", buf, 0x34u);

          dependentsCopy = v47;
        }

        objc_autoreleasePoolPop(v18);
        name2 = [v16 name];
        [dependentsCopy setValue:valueCopy forKey:name2];

        selfCopy = v17;
      }

      accessoriesWithPersonalRequestsEnabled = [dependentsCopy accessoriesWithPersonalRequestsEnabled];
      if (accessoriesWithPersonalRequestsEnabled)
      {
        v44 = v16;
        v45 = valueCopy;
        v46 = pathCopy;
        v52 = 0u;
        v53 = 0u;
        v50 = 0u;
        v51 = 0u;
        obj = accessoriesWithPersonalRequestsEnabled;
        v25 = [obj countByEnumeratingWithState:&v50 objects:v54 count:16];
        if (v25)
        {
          v26 = v25;
          v27 = *v51;
          do
          {
            for (i = 0; i != v26; ++i)
            {
              if (*v51 != v27)
              {
                objc_enumerationMutation(obj);
              }

              v29 = *(*(&v50 + 1) + 8 * i);
              castIfAppleMediaAccessory = [(__CFString *)v29 castIfAppleMediaAccessory];
              v31 = objc_autoreleasePoolPush();
              v32 = selfCopy;
              v33 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
              {
                v34 = HMFGetLogIdentifier();
                *buf = 138543618;
                v56 = v34;
                v57 = 2112;
                v58 = v29;
                _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Removing personal requests enabled accessory %@", buf, 0x16u);

                dependentsCopy = v47;
              }

              objc_autoreleasePoolPop(v31);
              [dependentsCopy removeAccessoriesWithPersonalRequestsEnabledObject:v29];

              selfCopy = v17;
            }

            v26 = [obj countByEnumeratingWithState:&v50 objects:v54 count:16];
          }

          while (v26);
        }

        name4 = obj;

        valueCopy = v45;
        pathCopy = v46;
        v16 = v44;
      }

      else
      {
        name4 = 0;
      }

      goto LABEL_26;
    }

    if ([valueCopy isEqualToNumber:&unk_283E71B10])
    {
      v36 = +[_MKFUser entity];
      v37 = [v36 hmd_attributeForSettingsPath:@"root.music.allowiTunesAccount"];

      if (!v37)
      {
        v16 = 0;
        goto LABEL_27;
      }

      v38 = objc_autoreleasePoolPush();
      v39 = selfCopy;
      v40 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v41 = obja = v38;
        name3 = [v37 name];
        *buf = 138544386;
        v56 = v41;
        v57 = 2112;
        v58 = @"root.music.allowiTunesAccount";
        v59 = 2112;
        v60 = name3;
        v61 = 2112;
        v62 = valueCopy;
        v63 = 2112;
        v64 = @"root.siri.identifyVoice";
        _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_INFO, "%{public}@Updating setting '%@' (%@) = %@ due to %@ is on", buf, 0x34u);

        v38 = obja;
      }

      objc_autoreleasePoolPop(v38);
      v16 = v37;
      name4 = [v37 name];
      [dependentsCopy setValue:valueCopy forKey:name4];
LABEL_26:

LABEL_27:
    }
  }

  v43 = *MEMORY[0x277D85DE8];
}

- (void)_handleOwnerSettingsUpdate:(id)update
{
  v33 = *MEMORY[0x277D85DE8];
  updateCopy = update;
  v27 = 0;
  v28 = 0;
  v25 = 0;
  v26 = 0;
  v5 = [(HMDHome *)self _validateSettingsUpdate:updateCopy type:&v28 keyPath:&v27 value:&v26 error:&v25];
  v6 = v27;
  v7 = v26;
  v8 = v25;
  v9 = v8;
  if (v5)
  {
    v10 = +[_MKFUser entity];
    v11 = [v10 hmd_attributeForSettingsPath:v6];

    if (v11)
    {
      backingStore = [(HMDHome *)self backingStore];
      context = [backingStore context];
      v20[0] = MEMORY[0x277D85DD0];
      v20[1] = 3221225472;
      v20[2] = __38__HMDHome__handleOwnerSettingsUpdate___block_invoke;
      v20[3] = &unk_278689550;
      v20[4] = self;
      v21 = updateCopy;
      v22 = v6;
      v23 = v11;
      v24 = v7;
      [context performBlock:v20];
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      selfCopy = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543618;
        v30 = v17;
        v31 = 2112;
        v32 = v6;
        _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Invalid settings key path: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
      v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [updateCopy respondWithError:v18];
    }

    goto LABEL_10;
  }

  if (!v8)
  {
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [updateCopy respondWithError:v11];
LABEL_10:

    goto LABEL_11;
  }

  [updateCopy respondWithError:v8];
LABEL_11:

  v19 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__handleOwnerSettingsUpdate___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) currentUser];
  v3 = [v2 uuid];

  v4 = [HMCContext findUserWithModelID:v3];
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 32);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (!v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v22 = 138543618;
      v23 = v17;
      v24 = 2112;
      v25 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to fetch the user with id [%@] from working store", &v22, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v16 = *(a1 + 40);
    v18 = MEMORY[0x277CCA9B8];
    v19 = 2;
    goto LABEL_10;
  }

  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = *(a1 + 48);
    v11 = [*(a1 + 56) name];
    v12 = *(a1 + 64);
    v22 = 138544130;
    v23 = v9;
    v24 = 2112;
    v25 = v10;
    v26 = 2112;
    v27 = v11;
    v28 = 2112;
    v29 = v12;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Updating owner setting '%@' (%@) = %@", &v22, 0x2Au);
  }

  objc_autoreleasePoolPop(v5);
  v13 = *(a1 + 64);
  v14 = [*(a1 + 56) name];
  [v4 setValue:v13 forKey:v14];

  [*(a1 + 32) _updateOwnerSettingDependents:v4 keyPath:*(a1 + 48) value:*(a1 + 64)];
  v15 = +[HMCContext currentContext];
  LOBYTE(v14) = [v15 save];

  v16 = *(a1 + 40);
  if ((v14 & 1) == 0)
  {
    v18 = MEMORY[0x277CCA9B8];
    v19 = -1;
LABEL_10:
    v20 = [v18 hmErrorWithCode:v19];
    [v16 respondWithError:v20];

    goto LABEL_11;
  }

  [v16 respondWithSuccess];
LABEL_11:

  v21 = *MEMORY[0x277D85DE8];
}

- (void)enableUserListeningHistoryForAccessoryUUID:(id)d userUUID:(id)iD
{
  v22 = *MEMORY[0x277D85DE8];
  dCopy = d;
  iDCopy = iD;
  v8 = [(HMDHome *)self userWithUUID:iDCopy];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  v12 = v11;
  if (v8)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v13;
      v18 = 2112;
      v19 = dCopy;
      v20 = 2112;
      v21 = v8;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Enable ULH: accessoryUUID %@ user %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [(HMDHome *)v8 enableUserListeningHistoryForAccessory:dCopy];
  }

  else
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v14;
      v18 = 2112;
      v19 = iDCopy;
      v20 = 2112;
      v21 = selfCopy;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@No user exist for userUUID %@ in home %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:(id)ds
{
  dsCopy = ds;
  v5 = __decodeAndVerifyCurrentUser(self, dsCopy);
  [v5 handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:dsCopy];
}

- (void)_handleMediaContentProfileAccessControlUpdate:(id)update
{
  updateCopy = update;
  v5 = __decodeAndVerifyCurrentUser(self, updateCopy);
  [v5 handleMediaContentProfileAccessControlUpdate:updateCopy];
}

- (void)_handleAssistantAccessControlUpdate:(id)update
{
  updateCopy = update;
  v5 = __decodeAndVerifyCurrentUser(self, updateCopy);
  [v5 handleAssistantAccessControlUpdate:updateCopy];
}

- (void)_handleSiriPhraseOptionsUpdateRequest:(id)request
{
  v26 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v24 = 138543362;
    v25 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update Siri phrase options request", &v24, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)selfCopy uuid];
  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid2 = [homeManager uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  messagePayload = [requestCopy messagePayload];
  v16 = [messagePayload hmf_numberForKey:*MEMORY[0x277CD05E0]];
  unsignedIntegerValue = [v16 unsignedIntegerValue];

  v18 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:unsignedIntegerValue];
  [(HMDHomeModel *)v14 setSiriPhraseOptions:v18];

  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [requestCopy name];
  v21 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v22 = [backingStore transaction:name options:v21];

  [v22 add:v14 withMessage:requestCopy];
  [v22 run];

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_handleSiriPhraseOptionsStatusChange:(id)change message:(id)message
{
  siriPhraseOptions = [change siriPhraseOptions];
  -[HMDHome setSiriPhraseOptions:](self, "setSiriPhraseOptions:", [siriPhraseOptions unsignedIntegerValue]);
}

- (void)_handleAudioAnalysisOnboardingUpdateRequest:(id)request
{
  v25 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v23 = 138543362;
    v24 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update audio analysis classifier options request", &v23, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)selfCopy uuid];
  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid2 = [homeManager uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  messagePayload = [requestCopy messagePayload];
  v16 = [messagePayload hmf_BOOLForKey:*MEMORY[0x277CCFE70]];

  v17 = [MEMORY[0x277CCABB0] numberWithBool:v16];
  [(HMDHomeModel *)v14 setDidOnboardAnalysis:v17];

  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [requestCopy name];
  v20 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v21 = [backingStore transaction:name options:v20];

  [v21 add:v14 withMessage:requestCopy];
  [v21 run];

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_handleAudioAnalysisOnboardingStatusChange:(id)change message:(id)message
{
  didOnboardAnalysis = [change didOnboardAnalysis];
  -[HMDHome setDidOnboardAudioAnalysis:](self, "setDidOnboardAudioAnalysis:", [didOnboardAnalysis BOOLValue]);
}

- (void)_handleAudioAnalysisClassifierOptionsUpdateRequest:(id)request
{
  v26 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v24 = 138543362;
    v25 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update audio analysis classifier options request", &v24, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)selfCopy uuid];
  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid2 = [homeManager uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  messagePayload = [requestCopy messagePayload];
  v16 = [messagePayload hmf_numberForKey:*MEMORY[0x277CCFE50]];
  unsignedIntegerValue = [v16 unsignedIntegerValue];

  v18 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:unsignedIntegerValue];
  [(HMDHomeModel *)v14 setAnalysisOptions:v18];

  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [requestCopy name];
  v21 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v22 = [backingStore transaction:name options:v21];

  [v22 add:v14 withMessage:requestCopy];
  [v22 run];

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_handleAudioAnalysisClassifierOptionsChange:(id)change message:(id)message
{
  analysisOptions = [change analysisOptions];
  -[HMDHome setAudioAnalysisClassifierOptions:](self, "setAudioAnalysisClassifierOptions:", [analysisOptions unsignedIntegerValue]);

  notificationCenter = [(HMDHome *)self notificationCenter];
  [notificationCenter postNotificationName:@"HMDAudioAnalysisClassifierOptionsUpdatedNotification" object:self];
}

- (void)_handleMultiUserEnabledChange:(id)change message:(id)message
{
  v23 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v21 = 138543362;
    v22 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Multi-user enabled changed, sending notification", &v21, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  multiUserEnabled = [changeCopy multiUserEnabled];
  -[HMDHome setMultiUserEnabled:](selfCopy, "setMultiUserEnabled:", [multiUserEnabled BOOLValue]);

  notificationCenter = [(HMDHome *)selfCopy notificationCenter];
  v14 = *MEMORY[0x277CD0448];
  [notificationCenter postNotificationName:*MEMORY[0x277CD0448] object:0];

  v15 = MEMORY[0x277D0F848];
  messageDestination = [(HMDHome *)selfCopy messageDestination];
  v17 = [v15 messageWithName:v14 destination:messageDestination payload:0];

  identifier = [messageCopy identifier];
  [v17 setIdentifier:identifier];

  [v17 setRemote:{objc_msgSend(messageCopy, "isRemote")}];
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  [msgDispatcher sendMessage:v17 completionHandler:0];

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForAccessCodeMessage:(id)message
{
  v23 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v19 = 138543618;
    v20 = v8;
    v21 = 2112;
    v22 = messageCopy;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling message to set has onboarded for access code: %@", &v19, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)selfCopy uuid];
  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid2 = [homeManager uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  [(HMDHomeModel *)v13 setHasOnboardedForAccessCode:MEMORY[0x277CBEC38]];
  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [messageCopy name];
  v16 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v17 = [backingStore transaction:name options:v16];

  [v17 add:v13 withMessage:messageCopy];
  [v17 run];

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest:(id)request
{
  v24 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received set has any user acknowledged camera recording onboarding request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)selfCopy uuid];
  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid2 = [homeManager uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  [(HMDHomeModel *)v13 setHasAnyUserAcknowledgedCameraRecordingOnboarding:MEMORY[0x277CBEC38]];
  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [requestCopy name];
  v16 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v17 = [backingStore transaction:name options:v16];

  [v17 add:v13 withMessage:requestCopy];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __76__HMDHome__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest___block_invoke;
  v20[3] = &unk_27868A250;
  v21 = requestCopy;
  v18 = requestCopy;
  [v17 run:v20];

  v19 = *MEMORY[0x277D85DE8];
}

uint64_t __76__HMDHome__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithSuccess];
  }
}

- (void)enableMultiUser
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v12 = 138543362;
    v13 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Received local request to enable Multi-User", &v12, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v7 = MEMORY[0x277D0F818];
  v8 = *MEMORY[0x277CCFEE8];
  messageDestination = [(HMDHome *)selfCopy messageDestination];
  v10 = [v7 messageWithName:v8 destination:messageDestination payload:MEMORY[0x277CBEC10]];

  [(HMDHome *)selfCopy _enableMultiUserWithMessage:v10];
  v11 = *MEMORY[0x277D85DE8];
}

- (void)_enableMultiUserWithMessage:(void *)message
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (message)
  {
    if ([message isMultiUserEnabled])
    {
      [v3 respondWithSuccess];
    }

    else
    {
      v4 = objc_autoreleasePoolPush();
      messageCopy = message;
      v6 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = HMFGetLogIdentifier();
        v18 = 138543362;
        v19 = v7;
        _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Received enable multi-user request", &v18, 0xCu);
      }

      objc_autoreleasePoolPop(v4);
      v8 = [HMDHomeModel alloc];
      uuid = [messageCopy uuid];
      homeManager = [messageCopy homeManager];
      uuid2 = [homeManager uuid];
      v12 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

      [(HMDHomeModel *)v12 setMultiUserEnabled:MEMORY[0x277CBEC38]];
      backingStore = [messageCopy backingStore];
      name = [v3 name];
      v15 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
      v16 = [backingStore transaction:name options:v15];

      [v16 add:v12 withMessage:v3];
      [v16 run];
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleEnableMultiUserRequest:(id)request
{
  v41 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  if ([requestCopy isRemote] && (objc_msgSend(requestCopy, "isSecureRemote") & 1) == 0)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v38 = v13;
      v39 = 2112;
      v40 = requestCopy;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    [requestCopy respondWithError:v14];
  }

  else
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      [(HMDHome *)self _enableMultiUserWithMessage:requestCopy];
      goto LABEL_16;
    }

    primaryResident = [(HMDHome *)self primaryResident];
    if (!primaryResident)
    {
      v6 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v16;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to forward message to home owner no resident found", buf, 0xCu);
      }

      goto LABEL_15;
    }

    if (([requestCopy isRemote] & 1) != 0 || objc_msgSend(requestCopy, "BOOLForKey:", @"kDoNotForwardMessageKey"))
    {
      v6 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v9;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Did not expect remote message.", buf, 0xCu);
      }

LABEL_15:

      objc_autoreleasePoolPop(v6);
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [requestCopy respondWithError:v17];

      goto LABEL_16;
    }

    v19 = [requestCopy mutableCopy];
    [v19 setRemote:1];
    [v19 setSecureRemote:1];
    v35 = @"kDoNotForwardMessageKey";
    v36 = MEMORY[0x277CBEC38];
    v20 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    [v19 setMessagePayload:v20];

    v21 = [HMDRemoteDeviceMessageDestination alloc];
    destination = [requestCopy destination];
    target = [destination target];
    device = [primaryResident device];
    v25 = [(HMDRemoteDeviceMessageDestination *)v21 initWithTarget:target device:device];
    [v19 setDestination:v25];

    objc_initWeak(&location, self);
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __41__HMDHome__handleEnableMultiUserRequest___block_invoke;
    v31[3] = &unk_278687F40;
    objc_copyWeak(&v33, &location);
    v32 = requestCopy;
    [v19 setResponseHandler:v31];
    v26 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
    {
      v29 = HMFGetLogIdentifier();
      *buf = 138543362;
      v38 = v29;
      _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@Forwarding enable multi-user request to owner.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v26);
    msgDispatcher = [(HMDHome *)selfCopy4 msgDispatcher];
    [msgDispatcher sendMessage:v19];

    objc_destroyWeak(&v33);
    objc_destroyWeak(&location);
  }

LABEL_16:

  v18 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleEnableMultiUserRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v11;
    v17 = 2112;
    v18 = v5;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Enabled multi-user on the home error: %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [*(a1 + 32) responseHandler];

  if (v12)
  {
    v13 = [*(a1 + 32) responseHandler];
    (v13)[2](v13, v5, v6);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)handleFindResidentsNotification:(id)notification
{
  v27 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  userInfo = [notificationCopy userInfo];
  v6 = [userInfo hmf_UUIDForKey:*MEMORY[0x277CD0640]];

  if (v6)
  {
    uuid = [(HMDHome *)self uuid];
    v8 = [v6 isEqual:uuid];

    if (v8)
    {
      v9 = objc_autoreleasePoolPush();
      selfCopy = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 138543618;
        v24 = v12;
        v25 = 2112;
        v26 = v6;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Received notification to check if there are any residents for home with UUID: %@.", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      v13 = +[HMDCoreDataCloudTransform sharedInstance];
      v20[0] = MEMORY[0x277D85DD0];
      v20[1] = 3221225472;
      v20[2] = __43__HMDHome_handleFindResidentsNotification___block_invoke;
      v20[3] = &unk_2786706E0;
      v20[4] = selfCopy;
      v21 = v13;
      v22 = v6;
      v14 = v13;
      [v14 countResidentsInHomeWithUUID:v22 completion:v20];
    }
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543362;
      v24 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@homeUUID is nil", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  v19 = *MEMORY[0x277D85DE8];
}

void __43__HMDHome_handleFindResidentsNotification___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = v5;
  if (!a2 || v5)
  {
    if (v5)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = *(a1 + 32);
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v16 = 138543618;
        v17 = v14;
        v18 = 2112;
        v19 = v6;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Counting residents in the cloud store failed with error: %@. Starting a full import", &v16, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
    }

    [*(a1 + 40) runCompleteMergeTransformForHomeWithModelID:*(a1 + 48) completion:0];
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v10;
      v18 = 2048;
      v19 = a2;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Found %lu residents in the cloud store", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_configureConfiguredResident:(id)resident desiredConfigState:(unint64_t)state message:(id)message
{
  v32 = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  messageCopy = message;
  if (state == 1)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v28 = 138543362;
      v29 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Unconfiguring residents is not supported", &v28, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    responseHandler = [messageCopy responseHandler];

    if (responseHandler)
    {
      homeManager = [MEMORY[0x277CCA9B8] hmErrorWithCode:48 description:0 reason:0 suggestion:0];
      responseHandler2 = [messageCopy responseHandler];
      (responseHandler2)[2](responseHandler2, homeManager, 0);
LABEL_17:
    }
  }

  else
  {
    configurationState = [residentCopy configurationState];
    [(HMDHome *)self _updateConfigurationStateForResidentDevice:residentCopy desiredConfigState:state message:messageCopy];
    if (configurationState != state)
    {
      homeManager = [(HMDHome *)self homeManager];
      v18 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v20 = HMFGetOSLogHandle();
      v21 = os_log_type_enabled(v20, OS_LOG_TYPE_INFO);
      if (state == 2)
      {
        if (v21)
        {
          v22 = HMFGetLogIdentifier();
          displayName = [residentCopy displayName];
          v28 = 138543618;
          v29 = v22;
          v30 = 2112;
          v31 = displayName;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Enabling resident device %@, checking if we need to go remote", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
      }

      else
      {
        if (v21)
        {
          v24 = HMFGetLogIdentifier();
          displayName2 = [residentCopy displayName];
          v28 = 138543618;
          v29 = v24;
          v30 = 2112;
          v31 = displayName2;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Disabling resident device %@, checking if we need to go remote", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
        uuid = [(HMDHome *)selfCopy2 uuid];
        [homeManager teardownRemoteAccessForHome:uuid];
      }

      if (![(HMDHome *)selfCopy2 isResidentSupported])
      {
        [homeManager checkForRemotePeers];
      }

      responseHandler2 = [messageCopy name];
      [(HMDHome *)selfCopy2 saveWithReason:responseHandler2 postSyncNotification:0];
      goto LABEL_17;
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_addResidentWithUsername:(id)username publicKey:(id)key destination:(id)destination
{
  v38 = *MEMORY[0x277D85DE8];
  usernameCopy = username;
  keyCopy = key;
  destinationCopy = destination;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if (usernameCopy && keyCopy)
  {
    unconfiguredResidentDevices = [(HMDHome *)self unconfiguredResidentDevices];
    v13 = [unconfiguredResidentDevices hmf_firstObjectWithValue:destinationCopy forKeyPath:@"userID"];

    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    v18 = v17;
    if (isKindOfClass)
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        *buf = 138543362;
        v33 = v19;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Found user as unconfigured resident, creating an accepted invitation to track adding the resident", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v15);
      v20 = [[HMDOutgoingHomeInvitation alloc] initWithInvitee:v13 invitationState:5 forHome:selfCopy expiryDate:0 messageIdentifier:0];
      [(HMDHome *)selfCopy addOutgoingInvitation:v20];
      objc_initWeak(buf, selfCopy);
      v28[0] = MEMORY[0x277D85DD0];
      v28[1] = 3221225472;
      v28[2] = __58__HMDHome__addResidentWithUsername_publicKey_destination___block_invoke;
      v28[3] = &unk_278685D08;
      objc_copyWeak(&v31, buf);
      v29 = v13;
      v21 = v20;
      v30 = v21;
      [(HMDHome *)selfCopy __handleAcceptedOutgoingInvitationResponse:v21 destinationAddress:destinationCopy publicKey:keyCopy username:usernameCopy reverseShare:0 reverseShareToken:0 issuerPublicKeyER:0 presenceAuthStatus:0 completionHandler:v28];

      objc_destroyWeak(&v31);
      objc_destroyWeak(buf);
    }

    else
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543618;
        v33 = v26;
        v34 = 2112;
        v35 = destinationCopy;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Attempt to pair an unknown resident user '%@', aborting", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
    }
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543874;
      v33 = v25;
      v34 = 2112;
      v35 = usernameCopy;
      v36 = 2112;
      v37 = keyCopy;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Aborting adding resident due to missing userName '%@' and publicKey '%@'", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __58__HMDHome__addResidentWithUsername_publicKey_destination___block_invoke(id *a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (shouldLogPrivateInformation())
  {
    v5 = [a1[4] userID];
  }

  else
  {
    v5 = @"...";
    v6 = @"...";
  }

  v7 = objc_autoreleasePoolPush();
  v8 = WeakRetained;
  v9 = HMFGetOSLogHandle();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);
  if (v3)
  {
    if (v10)
    {
      v11 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = v5;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to add resident user '%@' invitation with error: %@", &v16, 0x20u);
    }
  }

  else if (v10)
  {
    v12 = HMFGetLogIdentifier();
    v13 = [a1[5] identifier];
    v14 = [v13 UUIDString];
    v16 = 138543874;
    v17 = v12;
    v18 = 2112;
    v19 = v5;
    v20 = 2112;
    v21 = v14;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Tracking adding resident user '%@' with accepted and pending invitation '%@'", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v15 = *MEMORY[0x277D85DE8];
}

- (void)_sendResidentInviteWithDestination:(id)destination
{
  v47 = *MEMORY[0x277D85DE8];
  destinationCopy = destination;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = destinationCopy;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v6)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      device = [v6 device];
      remoteDestinationString = [device remoteDestinationString];
      *buf = 138543618;
      v42 = v11;
      v43 = 2112;
      v44 = remoteDestinationString;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Adding user %@ as remote access point", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    homeManager = [(HMDHome *)selfCopy homeManager];
    v37 = 0;
    v38 = 0;
    v36 = 0;
    v15 = [homeManager getOrCreateControllerPublicKey:&v38 controllerUsername:&v37 error:&v36];
    v16 = v38;
    v32 = v37;
    v31 = v36;
    if (v15)
    {
      v39[0] = *MEMORY[0x277CD23D0];
      name = [(HMDHome *)selfCopy name];
      v40[0] = name;
      v39[1] = *MEMORY[0x277CD0640];
      uuid = [(HMDHome *)selfCopy uuid];
      uUIDString = [uuid UUIDString];
      v40[1] = uUIDString;
      v39[2] = @"kControllerPublicKey";
      null = v16;
      if (!v16)
      {
        null = [MEMORY[0x277CBEB68] null];
      }

      v39[3] = @"kControllerPairingNameKey";
      v40[2] = null;
      v40[3] = v32;
      v30 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v40 forKeys:v39 count:4];
      if (!v16)
      {
      }

      v21 = [MEMORY[0x277D0F818] internalMessageWithName:@"kAddRemoteAccessRequestKey" destination:destinationCopy messagePayload:v30];
      objc_initWeak(buf, selfCopy);
      v33[0] = MEMORY[0x277D85DD0];
      v33[1] = 3221225472;
      v33[2] = __46__HMDHome__sendResidentInviteWithDestination___block_invoke;
      v33[3] = &unk_278687F40;
      objc_copyWeak(&v35, buf);
      v34 = v6;
      [v21 setResponseHandler:v33];
      messageDispatcher = [homeManager messageDispatcher];
      [messageDispatcher sendMessage:v21 completionHandler:0];

      objc_destroyWeak(&v35);
      objc_destroyWeak(buf);
    }

    else
    {
      v25 = objc_autoreleasePoolPush();
      v26 = selfCopy;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        *buf = 138543362;
        v42 = v28;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Failed getting controller public key to add remote gateway", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
    }
  }

  else
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      shortDescription = [(HMDHome *)selfCopy shortDescription];
      *buf = 138543874;
      v42 = v23;
      v43 = 2112;
      v44 = shortDescription;
      v45 = 2112;
      v46 = destinationCopy;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@[%@] Invalid resident invite destination: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__sendResidentInviteWithDestination___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = WeakRetained;
  if (v5 || !v6)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = v8;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) device];
      v15 = [v14 remoteDestinationString];
      *buf = 138543874;
      v22 = v13;
      v23 = 2112;
      v24 = v15;
      v25 = 2112;
      v26 = v5;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to receive controller info to auto add user %@ due to error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
  }

  else if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __46__HMDHome__sendResidentInviteWithDestination___block_invoke_1903;
    block[3] = &unk_27868A010;
    v18 = v6;
    v19 = v8;
    v20 = *(a1 + 32);
    dispatch_async(v9, block);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__sendResidentInviteWithDestination___block_invoke_1903(uint64_t a1)
{
  v6 = [*(a1 + 32) hmf_stringForKey:@"kControllerPairingNameKey"];
  v2 = [*(a1 + 32) hmf_dataForKey:@"kControllerPublicKey"];
  v3 = *(a1 + 40);
  v4 = [*(a1 + 48) device];
  v5 = [v4 remoteDestinationString];
  [v3 _addResidentWithUsername:v6 publicKey:v2 destination:v5];
}

- (void)_configureUnconfiguredResident:(id)resident desiredConfigState:(unint64_t)state
{
  v77 = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v7 = residentCopy;
  configurationState = [residentCopy configurationState];
  if (configurationState != state)
  {
    v58 = configurationState;
    v66 = 0u;
    v67 = 0u;
    v64 = 0u;
    v65 = 0u;
    outgoingInvitations = [(HMDHome *)self outgoingInvitations];
    v10 = [outgoingInvitations countByEnumeratingWithState:&v64 objects:v76 count:16];
    if (v10)
    {
      v11 = *v65;
      while (2)
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v65 != v11)
          {
            objc_enumerationMutation(outgoingInvitations);
          }

          user = [*(*(&v64 + 1) + 8 * i) user];
          userID = [user userID];
          userID2 = [residentCopy userID];
          v16 = [userID isEqualToString:userID2];

          if (v16)
          {
            v32 = objc_autoreleasePoolPush();
            selfCopy = self;
            v34 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
            {
              v35 = HMFGetLogIdentifier();
              userID3 = [residentCopy userID];
              *buf = 138543618;
              v71 = v35;
              v72 = 2112;
              v73 = userID3;
              _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Already have a pending invitation for the resident user '%@', not setting up remote access", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v32);
            goto LABEL_34;
          }
        }

        v10 = [outgoingInvitations countByEnumeratingWithState:&v64 objects:v76 count:16];
        if (v10)
        {
          continue;
        }

        break;
      }
    }

    if (state != 2 || v58 != 1)
    {
      v37 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
      {
        v40 = HMFGetLogIdentifier();
        displayName = [residentCopy displayName];
        *buf = 138543618;
        v71 = v40;
        v72 = 2112;
        v73 = displayName;
        _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Cannot configure unconfigured resident %@ to desired state", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v37);
      goto LABEL_34;
    }

    userID4 = [residentCopy userID];
    homeManager = [(HMDHome *)self homeManager];
    v19 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      displayName2 = [residentCopy displayName];
      *buf = 138543874;
      v71 = v22;
      v72 = 2112;
      v73 = userID4;
      v74 = 2112;
      v75 = displayName2;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Configuring unconfigured resident %@/%@ for remote access", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v19);
    hapAccessoryUniqueIdentifiers = [(HMDHome *)selfCopy3 hapAccessoryUniqueIdentifiers];
    allObjects = [hapAccessoryUniqueIdentifiers allObjects];

    if ([allObjects count])
    {
      pendingResponsesForRemoteAccessSetup = [(HMDHome *)selfCopy3 pendingResponsesForRemoteAccessSetup];
      v27 = [pendingResponsesForRemoteAccessSetup containsObject:userID4];

      if (!v27)
      {
        uuid = [homeManager uuid];
        v45 = [HMDMessageDispatcher destinationWithTarget:uuid userID:0 destination:userID4 multicast:0];

        if (v45)
        {
          pendingResponsesForRemoteAccessSetup2 = [(HMDHome *)selfCopy3 pendingResponsesForRemoteAccessSetup];
          [pendingResponsesForRemoteAccessSetup2 addObject:userID4];

          v69[0] = allObjects;
          v47 = *MEMORY[0x277CD0640];
          v68[0] = @"kAccessoryIdentitiesKey";
          v68[1] = v47;
          uuid2 = [(HMDHome *)selfCopy3 uuid];
          uUIDString = [uuid2 UUIDString];
          v69[1] = uUIDString;
          v50 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v69 forKeys:v68 count:2];

          v51 = [MEMORY[0x277D0F818] internalMessageWithName:@"kDoYouSeeUnpairedAccessoriesKey" destination:v45 messagePayload:v50];
          objc_initWeak(buf, selfCopy3);
          v60[0] = MEMORY[0x277D85DD0];
          v60[1] = 3221225472;
          v60[2] = __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke;
          v60[3] = &unk_278689460;
          objc_copyWeak(&v63, buf);
          v61 = userID4;
          v62 = v45;
          [v51 setResponseHandler:v60];
          messageDispatcher = [homeManager messageDispatcher];
          [messageDispatcher sendMessage:v51 completionHandler:0];

          objc_destroyWeak(&v63);
          objc_destroyWeak(buf);
        }

        else
        {
          v53 = objc_autoreleasePoolPush();
          v54 = selfCopy3;
          v55 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v55, OS_LOG_TYPE_DEFAULT))
          {
            v56 = HMFGetLogIdentifier();
            *buf = 138543618;
            v71 = v56;
            v72 = 2112;
            v73 = userID4;
            _os_log_impl(&dword_229538000, v55, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: could not create message destination for address: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v53);
        }

        goto LABEL_34;
      }

      v28 = objc_autoreleasePoolPush();
      v29 = selfCopy3;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v31 = HMFGetLogIdentifier();
        *buf = 138543362;
        v71 = v31;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: there is already a pending request", buf, 0xCu);
      }
    }

    else
    {
      v28 = objc_autoreleasePoolPush();
      v42 = selfCopy3;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v43 = HMFGetLogIdentifier();
        *buf = 138543362;
        v71 = v43;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: no accessory identifiers found", buf, 0xCu);
      }
    }

    objc_autoreleasePoolPop(v28);
LABEL_34:
    v7 = residentCopy;
    goto LABEL_35;
  }

  [(HMDHome *)self _updateConfigurationStateForResidentDevice:residentCopy desiredConfigState:state message:0];
LABEL_35:

  v57 = *MEMORY[0x277D85DE8];
}

void __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v8 = WeakRetained;
  if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke_2;
    block[3] = &unk_278689550;
    block[4] = v8;
    v11 = a1[4];
    v12 = v5;
    v13 = v6;
    v14 = a1[5];
    dispatch_async(v9, block);
  }
}

void __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke_2(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) pendingResponsesForRemoteAccessSetup];
  [v2 removeObject:*(a1 + 40)];

  if (*(a1 + 48) || (v9 = *(a1 + 56)) == 0)
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 40);
      v8 = *(a1 + 48);
      v19 = 138543874;
      v20 = v6;
      v21 = 2112;
      v22 = v7;
      v23 = 2112;
      v24 = v8;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Remote peer %@ failed to look for accessories with error:%@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v3);
  }

  else
  {
    v10 = [v9 hmf_BOOLForKey:@"kAtHomeStateKey"];
    v11 = [*(a1 + 56) hmf_stringForKey:@"kDeviceNameKey"];
    v12 = v11;
    if (v10 && v11)
    {
      [*(a1 + 32) _sendResidentInviteWithDestination:*(a1 + 64)];
    }

    else
    {
      v13 = objc_autoreleasePoolPush();
      v14 = *(a1 + 32);
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        v17 = *(a1 + 40);
        v19 = 138543618;
        v20 = v16;
        v21 = 2112;
        v22 = v17;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Remote peer %@ is not at home", &v19, 0x16u);
      }

      objc_autoreleasePoolPop(v13);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_updateConfigurationStateForResidentDevice:(id)device desiredConfigState:(unint64_t)state message:(id)message
{
  v22 = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  messageCopy = message;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    displayName = [deviceCopy displayName];
    v16 = 138543874;
    v17 = v13;
    v18 = 2112;
    v19 = displayName;
    v20 = 2048;
    stateCopy = state;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Updated configuration state of resident %@ to %ld", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v10);
  if ([deviceCopy configurationState] != state)
  {
    [deviceCopy setConfigurationState:state];
    [(HMDHome *)selfCopy _notifyClientsOfUpdatedResidentUser:deviceCopy];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)notifyNewRemotePeersFound:(BOOL)found remoteUsersRemoved:(id)removed forceRemoteNotificationRegistration:(BOOL)registration
{
  removedCopy = removed;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __92__HMDHome_notifyNewRemotePeersFound_remoteUsersRemoved_forceRemoteNotificationRegistration___block_invoke;
  block[3] = &unk_278681260;
  block[4] = self;
  v12 = removedCopy;
  foundCopy = found;
  registrationCopy = registration;
  v10 = removedCopy;
  dispatch_async(workQueue, block);
}

void __92__HMDHome_notifyNewRemotePeersFound_remoteUsersRemoved_forceRemoteNotificationRegistration___block_invoke(uint64_t a1)
{
  v54 = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277CBEB58];
  v3 = [*(a1 + 32) users];
  v40 = [v2 setWithArray:v3];

  v39 = [MEMORY[0x277CBEB58] setWithArray:*(a1 + 40)];
  [v40 intersectSet:v39];
  if ([v40 count])
  {
    v42 = [MEMORY[0x277CBEB18] array];
    v45 = 0u;
    v46 = 0u;
    v43 = 0u;
    v44 = 0u;
    obj = [v40 allObjects];
    v4 = [obj countByEnumeratingWithState:&v43 objects:v53 count:16];
    if (v4)
    {
      v5 = *v44;
      do
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v44 != v5)
          {
            objc_enumerationMutation(obj);
          }

          v7 = *(*(&v43 + 1) + 8 * i);
          if (shouldLogPrivateInformation())
          {
            v8 = [v7 userID];
          }

          else
          {
            v8 = @"...";
            v9 = @"...";
          }

          v10 = objc_autoreleasePoolPush();
          v11 = *(a1 + 32);
          v12 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
          {
            v13 = HMFGetLogIdentifier();
            *buf = 138543618;
            v50 = v13;
            v51 = 2112;
            v52 = v8;
            _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Removing remote user %@ since it has de-registered", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v10);
          v14 = [v7 userID];

          if (v14)
          {
            v15 = [v7 userID];
            [v42 addObject:v15];
          }

          [*(a1 + 32) _removeOutgoingInvitationForUser:v7];
          [*(a1 + 32) _removeUserFromContainer:v7];
        }

        v4 = [obj countByEnumeratingWithState:&v43 objects:v53 count:16];
      }

      while (v4);
    }

    v16 = *(a1 + 32);
    os_unfair_recursive_lock_lock_with_options();
    v17 = *(*(a1 + 32) + 32);
    v18 = [v40 allObjects];
    [v17 removeObjectsInArray:v18];

    os_unfair_recursive_lock_unlock();
    v47[0] = @"kUserIDsKey";
    v19 = [v42 copy];
    v47[1] = *MEMORY[0x277CD0640];
    v48[0] = v19;
    v20 = [*(a1 + 32) uuid];
    v21 = [v20 UUIDString];
    v48[1] = v21;
    v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v48 forKeys:v47 count:2];

    [*(a1 + 32) saveWithReason:@"kRemoteUsersDeregistered" information:v22 postSyncNotification:0];
  }

  v23 = [*(a1 + 32) localCapabilitiesDataSource];
  v24 = [v23 supportsRemoteAccess];

  if (v24)
  {
    v25 = [*(a1 + 32) homeManager];
    if (*(a1 + 48) == 1)
    {
      if ([*(a1 + 32) reachableAccessoriesCount])
      {
        if ([*(a1 + 32) allowsRemoteAccess])
        {
          v26 = [*(a1 + 32) currentUser];
          v27 = [v26 isRemoteAccessAllowed];

          if (v27)
          {
            v28 = objc_autoreleasePoolPush();
            v29 = *(a1 + 32);
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
            {
              v31 = HMFGetLogIdentifier();
              *buf = 138543362;
              v50 = v31;
              _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@We have potential remote gateways that can be auto setup, triggering detection", buf, 0xCu);
            }

            objc_autoreleasePoolPop(v28);
            v32 = [*(a1 + 32) uuid];
            [v25 accessoriesAreLocallyReachableOnTransientDevice:1 forHome:v32];
          }
        }
      }
    }

    if (([*(a1 + 32) remoteAccessIsEnabled] & 1) == 0 && (objc_msgSend(*(a1 + 32), "isResidentSupported") & 1) == 0)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = *(a1 + 32);
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543362;
        v50 = v36;
        _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled, requesting electing a remote peer", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v33);
      v37 = [*(a1 + 32) uuid];
      [v25 electRemoteAccessPeerForHome:v37];
    }

    [(HMDHome *)*(a1 + 32) _subscribeForNotificationFromRemoteGateway:?];
  }

  v38 = *MEMORY[0x277D85DE8];
}

- (void)_subscribeForNotificationFromRemoteGateway:(void *)gateway
{
  v24 = *MEMORY[0x277D85DE8];
  if (gateway)
  {
    workQueue = [gateway workQueue];
    dispatch_assert_queue_V2(workQueue);

    if ((a2 & 1) != 0 || ![gateway registeredNotificationWithRemoteGateway])
    {
      notificationRegistrations = [gateway notificationRegistrations];
      v10 = [notificationRegistrations count];

      v11 = objc_autoreleasePoolPush();
      gatewayCopy = gateway;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        notificationRegistrations2 = [gatewayCopy notificationRegistrations];
        shortDescription = [notificationRegistrations2 shortDescription];
        v18 = 138543874;
        v19 = v14;
        v20 = 2112;
        v21 = shortDescription;
        v22 = 2048;
        v23 = v10;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with new remote gateway: %@/%lu", &v18, 0x20u);
      }

      objc_autoreleasePoolPop(v11);
      [gatewayCopy _subscribeForHomeNotificationsFromRemoteGateway:v10 != 0];
      [gatewayCopy setRegisteredNotificationWithRemoteGateway:1];
    }

    else
    {
      v5 = objc_autoreleasePoolPush();
      gatewayCopy2 = gateway;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        v18 = 138543362;
        v19 = v8;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Already registered for notification with remote gateway, skipping", &v18, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_remoteAccessEnabled:(BOOL)enabled
{
  hapAccessories = [(HMDHome *)self hapAccessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __32__HMDHome__remoteAccessEnabled___block_invoke;
  v9[3] = &__block_descriptor_33_e25_v16__0__HMDHAPAccessory_8l;
  enabledCopy = enabled;
  [hapAccessories na_each:v9];

  nativeMatterAccessories = [(HMDHome *)self nativeMatterAccessories];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __32__HMDHome__remoteAccessEnabled___block_invoke_2;
  v7[3] = &__block_descriptor_33_e56_v16__0__HMDMatterAccessory_HMDMatterAccessoryProtocol__8l;
  enabledCopy2 = enabled;
  [nativeMatterAccessories na_each:v7];
}

- (void)remoteAccessEnabled:(BOOL)enabled
{
  workQueue = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __31__HMDHome_remoteAccessEnabled___block_invoke;
  v6[3] = &unk_278688650;
  v6[4] = self;
  enabledCopy = enabled;
  dispatch_async(workQueue, v6);
}

uint64_t __31__HMDHome_remoteAccessEnabled___block_invoke(uint64_t a1)
{
  v48 = *MEMORY[0x277D85DE8];
  if (*(a1 + 40) == [*(a1 + 32) remoteAccessIsEnabled])
  {
    goto LABEL_25;
  }

  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v7 = HMFBooleanToString();
    *buf = 138543618;
    v45 = v5;
    v46 = 2112;
    v47 = v7;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Setting remote access enabled to %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  [*(a1 + 32) setRemoteAccessIsEnabled:*(a1 + 40)];
  if (*(a1 + 40) != 1)
  {
    v19 = [*(a1 + 32) WiFiAssertion];

    if (v19)
    {
      v20 = objc_autoreleasePoolPush();
      v21 = *(a1 + 32);
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Releasing WiFi assertion", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      v24 = [*(a1 + 32) wifiManager];
      v25 = [*(a1 + 32) WiFiAssertion];
      [v24 endActiveAssertion:v25];

      v26 = [*(a1 + 32) wifiManager];
      [v26 releaseWoWAssertion];

      [*(a1 + 32) setWiFiAssertion:0];
    }

    goto LABEL_16;
  }

  if (isWatch())
  {
    v8 = [*(a1 + 32) homeManager];
    if ([v8 isActive])
    {
      v9 = [*(a1 + 32) WiFiAssertion];

      if (v9)
      {
        goto LABEL_16;
      }

      v10 = objc_autoreleasePoolPush();
      v11 = *(a1 + 32);
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v13;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Taking WiFi assertion", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v10);
      v14 = [*(a1 + 32) wifiManager];
      v15 = MEMORY[0x277CCACA8];
      v16 = [*(a1 + 32) shortDescription];
      v17 = [v15 stringWithFormat:@"Remote Access for %@", v16];
      v18 = [v14 beginActiveAssertionWithOptions:0 reason:v17];
      [*(a1 + 32) setWiFiAssertion:v18];

      v8 = [*(a1 + 32) wifiManager];
      [v8 takeWoWAssertion];
    }
  }

LABEL_16:
  if (([*(a1 + 32) isResidentSupported] & 1) == 0)
  {
    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v27 = [*(a1 + 32) _residentUsers];
    v28 = [v27 countByEnumeratingWithState:&v39 objects:v43 count:16];
    if (v28)
    {
      v29 = v28;
      v30 = *v40;
      do
      {
        v31 = 0;
        do
        {
          if (*v40 != v30)
          {
            objc_enumerationMutation(v27);
          }

          [*(a1 + 32) _notifyClientsOfUpdatedResidentUser:*(*(&v39 + 1) + 8 * v31++)];
        }

        while (v29 != v31);
        v29 = [v27 countByEnumeratingWithState:&v39 objects:v43 count:16];
      }

      while (v29);
    }
  }

LABEL_25:
  v32 = objc_autoreleasePoolPush();
  v33 = *(a1 + 32);
  v34 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
  {
    v35 = HMFGetLogIdentifier();
    *buf = 138543362;
    v45 = v35;
    _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Clearing history of all heartbeat queued messages to server", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v32);
  v36 = [*(a1 + 32) heartbeatPingMessagesQueuedWithServer];
  [v36 removeAllObjects];

  result = [*(a1 + 32) _remoteAccessEnabled:*(a1 + 40)];
  v38 = *MEMORY[0x277D85DE8];
  return result;
}

- (BOOL)remoteAccessIsEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  remoteAccessIsEnabled = self->_remoteAccessIsEnabled;
  os_unfair_recursive_lock_unlock();
  return remoteAccessIsEnabled;
}

- (void)setRemoteAccessEnabled:(BOOL)enabled
{
  os_unfair_recursive_lock_lock_with_options();
  self->_remoteAccessIsEnabled = enabled;

  os_unfair_recursive_lock_unlock();
}

- (void)updateNetworkConnectivity:(BOOL)connectivity companionReachable:(BOOL)reachable
{
  workQueue = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __56__HMDHome_updateNetworkConnectivity_companionReachable___block_invoke;
  v8[3] = &unk_27867E0C8;
  v8[4] = self;
  connectivityCopy = connectivity;
  reachableCopy = reachable;
  dispatch_async(workQueue, v8);
}

uint64_t __56__HMDHome_updateNetworkConnectivity_companionReachable___block_invoke(uint64_t a1)
{
  v11 = *MEMORY[0x277D85DE8];
  if (*(a1 + 40) != [*(a1 + 32) isNetworkAvailable])
  {
    [*(a1 + 32) setIsNetworkAvailable:?];
  }

  v2 = [*(a1 + 32) remoteEventRouterClientController];
  [v2 networkAvailabilityDidChange:*(a1 + 40)];

  isWatch();
  result = [*(a1 + 32) remoteAccessIsEnabled];
  if (result)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v7;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@We have no network connectivity, setting reachability state for all accessories to reflect their state", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    result = [*(a1 + 32) _remoteAccessEnabled:*(a1 + 40)];
  }

  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (BOOL)_residentDeviceAvailable
{
  v14 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isResidentSupported])
  {
    LOBYTE(v3) = 1;
  }

  else
  {
    v11 = 0u;
    v12 = 0u;
    v9 = 0u;
    v10 = 0u;
    _residentUsers = [(HMDHome *)self _residentUsers];
    v3 = [_residentUsers countByEnumeratingWithState:&v9 objects:v13 count:16];
    if (v3)
    {
      v5 = *v10;
      while (2)
      {
        for (i = 0; i != v3; ++i)
        {
          if (*v10 != v5)
          {
            objc_enumerationMutation(_residentUsers);
          }

          if ([*(*(&v9 + 1) + 8 * i) configurationState] == 2)
          {
            LOBYTE(v3) = 1;
            goto LABEL_13;
          }
        }

        v3 = [_residentUsers countByEnumeratingWithState:&v9 objects:v13 count:16];
        if (v3)
        {
          continue;
        }

        break;
      }
    }

LABEL_13:
  }

  v7 = *MEMORY[0x277D85DE8];
  return v3;
}

- (id)_residentUsers
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = MEMORY[0x277CBEB18];
  users = [(HMDHome *)self users];
  v5 = [v3 arrayWithCapacity:{objc_msgSend(users, "count")}];

  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  users2 = [(HMDHome *)self users];
  v7 = [users2 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v15;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v15 != v9)
        {
          objc_enumerationMutation(users2);
        }

        v11 = *(*(&v14 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [v5 addObject:v11];
        }
      }

      v8 = [users2 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v8);
  }

  v12 = *MEMORY[0x277D85DE8];

  return v5;
}

- (BOOL)isRemoteAccessDeviceReachable
{
  if (![(HMDHome *)self remoteAccessIsEnabled])
  {
    return 0;
  }

  primaryResident = [(HMDHome *)self primaryResident];
  v4 = ([primaryResident isReachable] & 1) != 0 || -[HMDHome isCompanionReachable](self, "isCompanionReachable");

  return v4;
}

- (void)updateAccessoryBrowsing
{
  isCurrentDeviceConfirmedPrimaryResident = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident];
  isCurrentDeviceAvailableResident = [(HMDHome *)self isCurrentDeviceAvailableResident];
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  [accessoryBrowser updateRemoteAccessoryBrowsing:isCurrentDeviceAvailableResident whbScan:isCurrentDeviceConfirmedPrimaryResident];
}

- (void)handlePrimaryResidentChangeNotification:(id)notification
{
  v20 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    name = [notificationCopy name];
    *buf = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = name;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received resident update notification: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  workQueue = [(HMDHome *)selfCopy workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __51__HMDHome_handlePrimaryResidentChangeNotification___block_invoke;
  v13[3] = &unk_27868A750;
  v14 = notificationCopy;
  v15 = selfCopy;
  v11 = notificationCopy;
  dispatch_async(workQueue, v13);

  v12 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome_handlePrimaryResidentChangeNotification___block_invoke(uint64_t a1)
{
  v33 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_UUIDForKey:@"HMDResidentDeviceHomeUUIDNotificationKey"];

  v4 = [*(a1 + 40) uuid];
  v5 = [v4 hmf_isEqualToUUID:v3];

  if (v5)
  {
    if ([*(a1 + 40) isCurrentDeviceConfirmedPrimaryResident])
    {
      v6 = objc_autoreleasePoolPush();
      v7 = *(a1 + 40);
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = HMFGetLogIdentifier();
        LODWORD(v29) = 138543362;
        *(&v29 + 4) = v9;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Resetting accessory browsers", &v29, 0xCu);
      }

      objc_autoreleasePoolPop(v6);
      v10 = [*(a1 + 40) accessoryBrowser];
      [v10 restartBrowsers];

      [*(a1 + 40) _evaluateShouldRelaunchAndSetRelaunch];
      [*(a1 + 40) _processUnsentOutgoingInvitations];
      [*(a1 + 40) _processUnacceptReverseShareAccessForUsers];
      [*(a1 + 40) _fixupUsersWithoutMergeID];
      [*(a1 + 40) _fixupHindsightOnboarding];
      if ([*(a1 + 40) isOwnerUser])
      {
        v11 = [*(a1 + 40) homeManager];
        v12 = [v11 homeOwnerCloudShareManager];
        [v12 updateSharedOwnerAccountHandleForHome:*(a1 + 40)];
      }

      [*(a1 + 40) updateCATIDForUsersIfNeeded:0];
      [*(a1 + 40) updateMatterFabricIDIfNeeded];
      v13 = [*(a1 + 40) currentUser];
      [v13 scheduleRestrictedGuestAccessTimersWithReason:@"Primary changed on controller"];

      v14 = [*(a1 + 40) notificationRegistry];
      [v14 reprocessEnabledCharacteristicRegistrations];

      v15 = *(a1 + 40);
      if (v15)
      {
        v16 = [*(a1 + 40) homeManager];
        v17 = [v16 mobileAssetManager];
        *&v29 = MEMORY[0x277D85DD0];
        *(&v29 + 1) = 3221225472;
        v30 = __50__HMDHome__maybeCheckACWGLocksForMFiCertification__block_invoke;
        v31 = &unk_27866FDC8;
        v32 = v15;
        [v17 getCurrentContentVersionWithCompletion:&v29];

        v18 = *(a1 + 40);
      }

      else
      {
        v18 = 0;
      }

      v19 = [v18 lastSeenStatusManager];
      [v19 start];

      HMFUptime();
      v21 = *(a1 + 40);
    }

    else
    {
      v22 = [*(a1 + 40) notificationRegistry];
      [v22 disableAllRegistrations];

      v23 = [*(a1 + 40) lastSeenStatusManager];
      [v23 stop];

      v21 = *(a1 + 40);
      v20 = 0.0;
    }

    [v21 setCurrentDeviceBecamePrimaryTime:v20];
    if ([*(a1 + 40) isCurrentDeviceAvailableResident])
    {
      [*(a1 + 40) updateAccessoryBrowsing];
    }

    HMFUptime();
    [*(a1 + 40) setPrimaryResidentChangedTime:?];
    [*(a1 + 40) _notifyThreadLayerOfResidentChange];
    v24 = objc_autoreleasePoolPush();
    v25 = *(a1 + 40);
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      LODWORD(v29) = 138543362;
      *(&v29 + 4) = v27;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - primary resident changed", &v29, 0xCu);
    }

    objc_autoreleasePoolPop(v24);
    [*(a1 + 40) _configureUserActivityStateDetectorManager];
  }

  v28 = *MEMORY[0x277D85DE8];
}

void __50__HMDHome__maybeCheckACWGLocksForMFiCertification__block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v15 = *MEMORY[0x277D85DE8];
  v5 = a3;
  if (a2)
  {
    [(HMDHome *)*(a1 + 32) _maybeCheckACWGLocksForMFiCertificationWithContentVersion:a2];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 32);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v9;
      v13 = 2112;
      v14 = v5;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to get current mobile asset content version: %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_maybeCheckACWGLocksForMFiCertificationWithContentVersion:(void *)version
{
  if (version)
  {
    backingStore = [version backingStore];
    context = [backingStore context];

    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke;
    v7[3] = &unk_278685DF8;
    v8 = context;
    v9 = a2;
    v7[4] = version;
    v6 = context;
    [v6 performBlock:v7];
  }
}

void __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  if (v3)
  {
    v4 = [v3 currentMobileAssetVersion];
    v5 = [v4 integerValue];

    v6 = [*(a1 + 32) workQueue];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke_1487;
    v14[3] = &unk_27867D900;
    v8 = *(a1 + 40);
    v7 = *(a1 + 48);
    v14[4] = *(a1 + 32);
    v16 = v7;
    v17 = v5;
    v15 = v8;
    dispatch_async(v6, v14);
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v19 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Unable to find MKFHome for current home to look up current mobile asset version", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke_1487(uint64_t a1)
{
  v29 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (v2)
  {
    v3 = *(a1 + 48);
    v4 = *(a1 + 56);
    v5 = [*(a1 + 32) workQueue];
    dispatch_assert_queue_V2(v5);

    if (v4 >= v3)
    {
      v12 = objc_autoreleasePoolPush();
      v13 = v2;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        *buf = 138543874;
        *&buf[4] = v15;
        *&buf[12] = 1024;
        *&buf[14] = v4;
        *&buf[18] = 1024;
        *&buf[20] = v3;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Home mobile asset version %d is newer than or equal to latest installed version %d", buf, 0x18u);
      }

      objc_autoreleasePoolPop(v12);
      v2 = [MEMORY[0x277D0F7C0] futureWithError:0];
    }

    else
    {
      v6 = [v2 accessories];
      v7 = [v6 na_map:&__block_literal_global_1490];

      if ([v7 hmf_isEmpty])
      {
        v8 = objc_autoreleasePoolPush();
        v9 = v2;
        v10 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          v11 = HMFGetLogIdentifier();
          *buf = 138543362;
          *&buf[4] = v11;
          _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@No lock accessories, finished updating mobile asset version", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v8);
        v2 = [MEMORY[0x277D0F7C0] futureWithNoValue];
      }

      else
      {
        v16 = [v2 dataSource];
        v17 = [v16 makeAccessoryMatterCapabilitiesForFilename:0];

        *buf = MEMORY[0x277D85DD0];
        *&buf[8] = 3221225472;
        *&buf[16] = __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1491;
        v26 = &unk_2786755C8;
        v27 = v7;
        v28 = v2;
        v2 = [v17 then:buf];
      }
    }
  }

  v22[0] = MEMORY[0x277D85DD0];
  v22[1] = 3221225472;
  v22[2] = __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke_2;
  v22[3] = &unk_27866FDF0;
  v18 = *(a1 + 40);
  v19 = *(a1 + 48);
  v22[4] = *(a1 + 32);
  v24 = v19;
  v23 = v18;
  v20 = [v2 inContext:v23 then:v22];

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke_2(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [*(a1 + 32) uuid];
  v5 = [HMCContext findHomeWithModelID:v4];

  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 48);
      v16 = 138543618;
      v17 = v10;
      v18 = 2048;
      v19 = v11;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Updating home mobile asset version to %ld", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [MEMORY[0x277CCABB0] numberWithInteger:*(a1 + 48)];
    [v5 setCurrentMobileAssetVersion:v12];

    [*(a1 + 40) save];
  }

  else
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v16 = 138543362;
      v17 = v13;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Unable to find MKFHome for current home to update current mobile asset version", &v16, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
  }

  v14 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1491(uint64_t a1, void *a2)
{
  v30 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = *(a1 + 32);
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_2;
  v26[3] = &unk_27866FE18;
  v5 = v3;
  v6 = *(a1 + 40);
  v27 = v5;
  v28 = v6;
  v7 = [v4 na_map:v26];
  if ([v7 hmf_isEmpty])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 40);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543362;
      *&buf[4] = v11;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@No accessories needed updating updating mobile asset version", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    v12 = 1;
  }

  else
  {
    v13 = [*(a1 + 40) backingStore];
    v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v15 = [v13 transaction:@"UpdateACWGCertified" options:v14];

    [v15 addObjects:v7];
    *buf = 0;
    v16 = [MEMORY[0x277D0F7C0] futureWithPromise:buf];
    v17 = [*buf errorOnlyResolverBlock];
    [v15 run:v17];

    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1496;
    v24[3] = &unk_278689CB0;
    v25 = *(a1 + 40);
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1497;
    v23[3] = &unk_278689CD8;
    v23[4] = v25;
    v18 = [v16 then:v24 orRecover:v23];

    v19 = v18;
    if (!v19)
    {
      _HMFPreconditionFailure();
    }

    v20 = v19;
    v12 = 3;
  }

  v21 = *MEMORY[0x277D85DE8];
  return v12;
}

id __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_2(uint64_t a1, void *a2)
{
  v35 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 mfiCertifiedACWG];
  v5 = *(a1 + 32);
  v6 = [v3 matterVendorID];
  v7 = [v6 intValue];
  v8 = [v3 matterProductID];
  v9 = [v5 isCapabilityAllowed:0 vendorID:v7 productID:{objc_msgSend(v8, "intValue")}];

  v10 = 0;
  if (v4 != v9)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v3 shortDescription];
      v16 = [v3 matterVendorID];
      v17 = [v16 intValue];
      [v3 matterProductID];
      v18 = v22 = v11;
      *buf = 138544642;
      v24 = v14;
      v25 = 2114;
      v26 = v15;
      v27 = 1024;
      v28 = v17;
      v29 = 1024;
      v30 = [v18 intValue];
      v31 = 1024;
      v32 = v4;
      v33 = 1024;
      v34 = v9;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@ECB lock %{public}@ with VID %d, PID %d certified changed, old: %{BOOL}d, new: %{BOOL}d", buf, 0x2Eu);

      v11 = v22;
    }

    objc_autoreleasePoolPop(v11);
    v10 = [v3 transactionWithObjectChangeType:2];
    v19 = [MEMORY[0x277CCABB0] numberWithBool:v9];
    [v10 setMfiCertifiedACWG:v19];
  }

  v20 = *MEMORY[0x277D85DE8];

  return v10;
}

uint64_t __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1496(uint64_t a1, void *a2)
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v10 = 138543362;
    v11 = v7;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully updated ACWG status", &v10, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1497(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v13 = 138543618;
    v14 = v7;
    v15 = 2112;
    v16 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Unable to update certification status: %@", &v13, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = v3;
  v9 = v8;
  if (v8)
  {
    v10 = v8;
  }

  else
  {
    [MEMORY[0x277CCA9B8] hmfUnspecifiedError];
    objc_claimAutoreleasedReturnValue();
  }

  v11 = *MEMORY[0x277D85DE8];
  return 2;
}

id __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = 0;
  if ([v4 supportsACWGProvisioning])
  {
    v5 = v4;
  }

  return v5;
}

- (void)_handleResidentChange
{
  v24 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setMigratingAfterResidentChange:0];
  v20 = 0u;
  v21 = 0u;
  v18 = 0u;
  v19 = 0u;
  triggers = [(HMDHome *)self triggers];
  v4 = [triggers countByEnumeratingWithState:&v18 objects:v23 count:16];
  if (v4)
  {
    v5 = *v19;
    v6 = MEMORY[0x277D85DD0];
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v19 != v5)
        {
          objc_enumerationMutation(triggers);
        }

        v8 = *(*(&v18 + 1) + 8 * i);
        objc_initWeak(location, v8);
        v16[0] = v6;
        v16[1] = 3221225472;
        v16[2] = __32__HMDHome__handleResidentChange__block_invoke;
        v16[3] = &unk_278688A18;
        objc_copyWeak(&v17, location);
        [v8 activateAfterResidentChangeWithCompletion:v16];
        objc_destroyWeak(&v17);
        objc_destroyWeak(location);
      }

      v4 = [triggers countByEnumeratingWithState:&v18 objects:v23 count:16];
    }

    while (v4);
  }

  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    LODWORD(location[0]) = 138543362;
    *(location + 4) = v12;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Calling presence feeder to notify the presence status to the new resident", location, 0xCu);
  }

  objc_autoreleasePoolPop(v9);
  presenceMonitor = [(HMDHome *)selfCopy presenceMonitor];
  [presenceMonitor residentChanged];

  periodicReader = [(HMDHome *)selfCopy periodicReader];
  [periodicReader residentUpdated];

  [(HMDHome *)selfCopy _evaluateNetworkProtectionAndRouterManagement];
  v15 = *MEMORY[0x277D85DE8];
}

void __32__HMDHome__handleResidentChange__block_invoke(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543618;
      v11 = v8;
      v12 = 2112;
      v13 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Activating trigger after resident change finished with error (%@)", &v10, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)migrateAfterResidentChange
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v16 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@migrateAfterResidentChange", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  if ([(HMDHome *)selfCopy isMigratingAfterResidentChange])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = selfCopy;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v16 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Migration after resident change is already running", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
  }

  else
  {
    [(HMDHome *)selfCopy setMigratingAfterResidentChange:1];
    objc_initWeak(buf, selfCopy);
    backingStore = [(HMDHome *)selfCopy backingStore];
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __37__HMDHome_migrateAfterResidentChange__block_invoke;
    v13[3] = &unk_278688A18;
    objc_copyWeak(&v14, buf);
    [backingStore submitBlock:v13];

    objc_destroyWeak(&v14);
    objc_destroyWeak(buf);
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __37__HMDHome_migrateAfterResidentChange__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _handleResidentChange];
}

- (void)removeResidentCapableDevice:(id)device
{
  v30 = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  if ([(HMDHome *)self isOwnerUser])
  {
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];

    v7 = [residentDevices countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (v7)
    {
      v8 = v7;
      v9 = *v22;
      while (2)
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v22 != v9)
          {
            objc_enumerationMutation(residentDevices);
          }

          v11 = *(*(&v21 + 1) + 8 * i);
          device = [v11 device];
          v13 = [device isEqual:deviceCopy];

          if (v13)
          {
            residentDeviceManager2 = [(HMDHome *)self residentDeviceManager];
            [residentDeviceManager2 removeResidentDevice:v11];

            goto LABEL_16;
          }
        }

        v8 = [residentDevices countByEnumeratingWithState:&v21 objects:v25 count:16];
        if (v8)
        {
          continue;
        }

        break;
      }
    }

    if ([deviceCopy isCurrentDevice])
    {
      notificationRegistry = [(HMDHome *)self notificationRegistry];
      [notificationRegistry clearAllRegistrations];
    }
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v18;
      v28 = 2112;
      v29 = deviceCopy;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Attempting to remove resident on non-owner home -- device: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
  }

LABEL_16:

  v20 = *MEMORY[0x277D85DE8];
}

- (void)addResidentCapableDevice:(id)device
{
  v40 = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  if ([(HMDHome *)self isOwnerUser])
  {
    capabilities = [deviceCopy capabilities];
    isResidentCapable = [capabilities isResidentCapable];

    if (isResidentCapable)
    {
      v33 = 0u;
      v34 = 0u;
      v31 = 0u;
      v32 = 0u;
      residentDeviceManager = [(HMDHome *)self residentDeviceManager];
      residentDevices = [residentDeviceManager residentDevices];

      v9 = [residentDevices countByEnumeratingWithState:&v31 objects:v39 count:16];
      if (v9)
      {
        v10 = v9;
        v11 = *v32;
        while (2)
        {
          for (i = 0; i != v10; ++i)
          {
            if (*v32 != v11)
            {
              objc_enumerationMutation(residentDevices);
            }

            v13 = *(*(&v31 + 1) + 8 * i);
            device = [v13 device];
            v15 = [device isEqual:deviceCopy];

            if (v15)
            {
              v26 = objc_autoreleasePoolPush();
              selfCopy = self;
              v28 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v28, OS_LOG_TYPE_DEBUG))
              {
                v29 = HMFGetLogIdentifier();
                *buf = 138543618;
                v36 = v29;
                v37 = 2112;
                v38 = v13;
                _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_DEBUG, "%{public}@Resident device already exists, refraining from creating a new transaction: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v26);
              goto LABEL_17;
            }
          }

          v10 = [residentDevices countByEnumeratingWithState:&v31 objects:v39 count:16];
          if (v10)
          {
            continue;
          }

          break;
        }
      }

      uuid = [(HMDHome *)self uuid];
      identifier = [deviceCopy identifier];
      residentDevices = [HMDResidentDevice deriveUUIDFromHomeUUID:uuid deviceUUID:identifier];

      v18 = [HMDResidentDeviceModel alloc];
      uuid2 = [(HMDHome *)self uuid];
      v20 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:1 uuid:residentDevices parentUUID:uuid2];

      [(HMDResidentDeviceModel *)v20 setEnabled:MEMORY[0x277CBEC38]];
      identifier2 = [deviceCopy identifier];
      uUIDString = [identifier2 UUIDString];
      [(HMDResidentDeviceModel *)v20 setDeviceUUID:uUIDString];

      if ([deviceCopy isCurrentDevice])
      {
        [(HMDResidentDeviceModel *)v20 setDevice:deviceCopy];
      }

      backingStore = [(HMDHome *)self backingStore];
      v24 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v25 = [backingStore transaction:@"addResidentCapableDevice" options:v24];

      [v25 add:v20 withMessage:0];
      [v25 run];

LABEL_17:
    }
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (NSArray)enabledResidents
{
  v18 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];

  v6 = [residentDevices countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(residentDevices);
        }

        v10 = *(*(&v13 + 1) + 8 * i);
        if ([v10 isEnabled])
        {
          [array addObject:v10];
        }
      }

      v7 = [residentDevices countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return array;
}

- (NSArray)residentEnabledDevices
{
  v19 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];

  v6 = [residentDevices countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v15;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v15 != v8)
        {
          objc_enumerationMutation(residentDevices);
        }

        v10 = *(*(&v14 + 1) + 8 * i);
        if ([v10 isEnabled])
        {
          device = [v10 device];
          [array addObject:device];
        }
      }

      v7 = [residentDevices countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v7);
  }

  v12 = *MEMORY[0x277D85DE8];

  return array;
}

- (NSArray)residentCapableDevices
{
  v18 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];

  v6 = [residentDevices countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(residentDevices);
        }

        device = [*(*(&v13 + 1) + 8 * i) device];
        [array addObject:device];
      }

      v7 = [residentDevices countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return array;
}

- (void)_handleSetResidentElectionVersion:(id)version
{
  v30 = *MEMORY[0x277D85DE8];
  versionCopy = version;
  messagePayload = [versionCopy messagePayload];
  v6 = [messagePayload hmf_numberForKey:*MEMORY[0x277CD0440]];

  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      residentSelectionVersion = [(HMDHome *)selfCopy residentSelectionVersion];
      v24 = 138543874;
      v25 = v10;
      v26 = 2114;
      v27 = residentSelectionVersion;
      v28 = 2114;
      v29 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Received request to update resident selection version from %{public}@ to %{public}@", &v24, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
    v12 = [HMDHomeModel alloc];
    uuid = [(HMDHome *)selfCopy uuid];
    homeManager = [(HMDHome *)selfCopy homeManager];
    uuid2 = [homeManager uuid];
    v16 = [(HMDBackingStoreModelObject *)v12 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

    [(HMDHomeModel *)v16 setResidentSelectionVersion:v6];
    untrustedClientIdentifier = [versionCopy untrustedClientIdentifier];
    v18 = [HMDBackingStoreTransactionOptions defaultXPCOptionsWithCDTransactionAuthor:10 clientIdentifier:untrustedClientIdentifier];

    backingStore = [(HMDHome *)selfCopy backingStore];
    name = [versionCopy name];
    v21 = [backingStore transaction:name options:v18];

    [v21 add:v16 withMessage:versionCopy];
    [v21 run];
  }

  else
  {
    v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [versionCopy respondWithError:v22];
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)setResidentSelectionVersion:(id)version
{
  versionCopy = version;
  os_unfair_recursive_lock_lock_with_options();
  residentSelectionVersion = self->_residentSelectionVersion;
  self->_residentSelectionVersion = versionCopy;

  os_unfair_recursive_lock_unlock();

  logAndPostNotification(@"HMDHomeResidentSelectionVersionDidChangeNotification", self, 0);
}

- (NSNumber)residentSelectionVersion
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_residentSelectionVersion;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setPrimaryResidentNetworkInfo:(id)info
{
  infoCopy = info;
  os_unfair_recursive_lock_lock_with_options();
  primaryResidentNetworkInfo = self->_primaryResidentNetworkInfo;
  self->_primaryResidentNetworkInfo = infoCopy;

  os_unfair_recursive_lock_unlock();
}

- (HMHomeNetworkInfo)primaryResidentNetworkInfo
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_primaryResidentNetworkInfo;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (BOOL)hasAnyResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  hasAnyResident = [residentDeviceManager hasAnyResident];

  return hasAnyResident;
}

- (BOOL)doesHomeContainResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];
  v4 = [residentDevices count] != 0;

  return v4;
}

- (NSNumber)matterFabricID
{
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    [(HMDHome *)self fabric];
  }

  else
  {
    [(HMDHome *)self chipStorage];
  }
  v3 = ;
  fabricID = [v3 fabricID];

  return fabricID;
}

- (BOOL)isCurrentDeviceConfirmedPrimaryResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  isCurrentDeviceConfirmedPrimaryResident = [residentDeviceManager isCurrentDeviceConfirmedPrimaryResident];

  return isCurrentDeviceConfirmedPrimaryResident;
}

- (id)_hasConfirmedPrimaryResidentDevice
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  confirmedPrimaryResidentDevice = [residentDeviceManager confirmedPrimaryResidentDevice];

  return confirmedPrimaryResidentDevice;
}

- (BOOL)hasResidentDevicesForPrimaryResidentChangeMonitor:(id)monitor
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];
  v5 = [residentDevices count] != 0;

  return v5;
}

- (BOOL)residentSyncDidSync
{
  if ([(HMDHome *)self residentSyncClientDidSync])
  {
    return 1;
  }

  return [(HMDHome *)self isCurrentDevicePrimaryResident];
}

- (BOOL)isCurrentDevicePrimaryResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  isCurrentDevicePrimaryResident = [residentDeviceManager isCurrentDevicePrimaryResident];

  return isCurrentDevicePrimaryResident;
}

- (BOOL)isResidentSupported
{
  isWatch();
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  isResidentAvailable = [residentDeviceManager isResidentAvailable];

  return isResidentAvailable;
}

- (void)_handleHAPAccessoryCharacteristicsUpdatedForAccessory:(id)accessory
{
  v27 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  notificationRegistrations = [(HMDHome *)self notificationRegistrations];
  v7 = [notificationRegistrations count];

  if (!v7)
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v24 = v18;
      v25 = 2112;
      v26 = accessoryCopy;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote notifications for %@ as there are no home notification registered clients", buf, 0x16u);
    }

    v14 = v15;
    goto LABEL_9;
  }

  isCurrentDevicePrimaryResident = [(HMDHome *)self isCurrentDevicePrimaryResident];
  v9 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v11 = HMFGetOSLogHandle();
  v12 = v11;
  if (isCurrentDevicePrimaryResident)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v24 = v13;
      v25 = 2112;
      v26 = accessoryCopy;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote notifications for %@ as we are the primary resident", buf, 0x16u);
    }

    v14 = v9;
LABEL_9:
    objc_autoreleasePoolPop(v14);
    goto LABEL_13;
  }

  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    *buf = 138543618;
    v24 = v19;
    v25 = 2112;
    v26 = accessoryCopy;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Updating remote registrations for %@ as we have a client registered for all accessories and the characteristics on the accessory have changed", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v22 = accessoryCopy;
  v20 = [MEMORY[0x277CBEA60] arrayWithObjects:&v22 count:1];
  [(HMDHome *)selfCopy2 _subscribeForHomeNotificationsFromRemoteGateway:1 accessories:v20];

LABEL_13:
  v21 = *MEMORY[0x277D85DE8];
}

- (void)handleHAPAccessoryServicesAddedNotification:(id)notification
{
  v29 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  userInfo = [notificationCopy userInfo];
  v6 = [userInfo objectForKeyedSubscript:@"HMDAccessoryKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  if (!v8)
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v17;
      v18 = "%{public}@Got kHMDNotificationServicesUpdated notification without accessory";
      v19 = v16;
      v20 = OS_LOG_TYPE_ERROR;
      v21 = 12;
LABEL_11:
      _os_log_impl(&dword_229538000, v19, v20, v18, buf, v21);
    }

LABEL_12:

    objc_autoreleasePoolPop(v14);
    goto LABEL_13;
  }

  home = [v8 home];
  uuid = [home uuid];
  uuid2 = [(HMDHome *)self uuid];
  v12 = [uuid hmf_isEqualToUUID:uuid2];

  if ((v12 & 1) == 0)
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543618;
      v26 = v17;
      v27 = 2112;
      v28 = v8;
      v18 = "%{public}@%@ is not in our home, ignoring";
      v19 = v16;
      v20 = OS_LOG_TYPE_DEBUG;
      v21 = 22;
      goto LABEL_11;
    }

    goto LABEL_12;
  }

  workQueue = [(HMDHome *)self workQueue];
  v23[0] = MEMORY[0x277D85DD0];
  v23[1] = 3221225472;
  v23[2] = __55__HMDHome_handleHAPAccessoryServicesAddedNotification___block_invoke;
  v23[3] = &unk_27868A750;
  v23[4] = self;
  v24 = v8;
  dispatch_async(workQueue, v23);

LABEL_13:
  v22 = *MEMORY[0x277D85DE8];
}

- (void)handleHAPAccessoryCharacteristicsAddedNotification:(id)notification
{
  v23 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  userInfo = [notificationCopy userInfo];
  v6 = [userInfo objectForKeyedSubscript:@"HMDAccessoryKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  if (v8)
  {
    home = [v8 home];
    uuid = [home uuid];
    uuid2 = [(HMDHome *)self uuid];
    v12 = [uuid hmf_isEqualToUUID:uuid2];

    if (v12)
    {
      workQueue = [(HMDHome *)self workQueue];
      v19[0] = MEMORY[0x277D85DD0];
      v19[1] = 3221225472;
      v19[2] = __62__HMDHome_handleHAPAccessoryCharacteristicsAddedNotification___block_invoke;
      v19[3] = &unk_27868A750;
      v19[4] = self;
      v20 = v8;
      dispatch_async(workQueue, v19);
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v22 = v17;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Got kHMDNotificationServicesUpdated notification without accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleCharacteristicEnableNotification:(id)notification
{
  v95 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  v68 = notificationCopy;
  if ([notificationCopy isRemote] && (objc_msgSend(notificationCopy, "isSecureRemote") & 1) == 0)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v13;
      *&buf[12] = 2112;
      *&buf[14] = v68;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    responseHandler = [v68 responseHandler];

    if (responseHandler)
    {
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      responseHandler2 = [v68 responseHandler];
      (responseHandler2)[2](responseHandler2, v15, 0);
    }
  }

  else
  {
    messagePayload = [notificationCopy messagePayload];
    v66 = [messagePayload objectForKey:@"kNotificationEnablePayloadKey"];

    if (v66)
    {
      v5 = @"kNotificationEnablePayloadKey";
    }

    else
    {
      messagePayload2 = [v68 messagePayload];
      v7 = [messagePayload2 objectForKey:@"kNotificationDisablePayloadKey"];

      if (!v7)
      {
        responseHandler3 = [v68 responseHandler];
        v58 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        (responseHandler3)[2](responseHandler3, v58, 0);

        goto LABEL_49;
      }

      v5 = @"kNotificationDisablePayloadKey";
    }

    v67 = [v68 dictionaryForKey:v5];
    clientIdentifier = [v68 clientIdentifier];

    if (clientIdentifier)
    {
      clientIdentifier2 = [v68 clientIdentifier];
      v65 = [@"com.apple.HomeKit.client." stringByAppendingString:clientIdentifier2];
    }

    else
    {
      v65 = @"com.apple.HomeKitDaemon";
      v17 = @"com.apple.HomeKitDaemon";
    }

    strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v86 = 0u;
    v87 = 0u;
    v84 = 0u;
    v85 = 0u;
    obj = [v67 allKeys];
    v71 = [obj countByEnumeratingWithState:&v84 objects:v94 count:16];
    if (v71)
    {
      v69 = *v85;
      v19 = @"disable";
      if (v66)
      {
        v19 = @"enable";
      }

      v60 = v19;
      *&v18 = 138544642;
      v59 = v18;
      do
      {
        for (i = 0; i != v71; ++i)
        {
          if (*v85 != v69)
          {
            objc_enumerationMutation(obj);
          }

          v21 = *(*(&v84 + 1) + 8 * i);
          v22 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v21];
          v23 = [(HMDHome *)self accessoryWithUUID:v22];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          if (v25)
          {
            v26 = [v67 hmf_arrayForKey:v21];
            if ([v26 count])
            {
              [strongToStrongObjectsMapTable setObject:v26 forKey:v25];
            }

            else
            {
              context = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v35 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
              {
                v61 = HMFGetLogIdentifier();
                name = [(HMDHome *)selfCopy2 name];
                uuid = [(HMDHome *)selfCopy2 uuid];
                uUIDString = [uuid UUIDString];
                name2 = [v25 name];
                *buf = v59;
                *&buf[4] = v61;
                *&buf[12] = 2112;
                *&buf[14] = name;
                *&buf[22] = 2112;
                v90 = uUIDString;
                *v91 = 2112;
                *&v91[2] = v60;
                *&v91[10] = 2112;
                *&v91[12] = name2;
                v92 = 2112;
                v93 = v21;
                _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@%@/%@: Received notification %@ for zero characteristics on accessory %@/%@", buf, 0x3Eu);
              }

              objc_autoreleasePoolPop(context);
            }
          }

          else
          {
            v27 = objc_autoreleasePoolPush();
            selfCopy3 = self;
            v29 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
            {
              v30 = HMFGetLogIdentifier();
              name3 = [(HMDHome *)selfCopy3 name];
              uuid2 = [(HMDHome *)selfCopy3 uuid];
              uUIDString2 = [uuid2 UUIDString];
              *buf = 138544386;
              *&buf[4] = v30;
              *&buf[12] = 2112;
              *&buf[14] = name3;
              *&buf[22] = 2112;
              v90 = uUIDString2;
              *v91 = 2112;
              *&v91[2] = v60;
              *&v91[10] = 2112;
              *&v91[12] = v21;
              _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@%@/%@: Received notification %@ for different accessory: %@", buf, 0x34u);
            }

            objc_autoreleasePoolPop(v27);
          }
        }

        v71 = [obj countByEnumeratingWithState:&v84 objects:v94 count:16];
      }

      while (v71);
    }

    v40 = [strongToStrongObjectsMapTable count];
    if (v40)
    {
      responseHandler4 = dispatch_group_create();
      *buf = 0;
      *&buf[8] = buf;
      *&buf[16] = 0x3032000000;
      v90 = __Block_byref_object_copy__14759;
      *v91 = __Block_byref_object_dispose__14760;
      *&v91[8] = 0;
      v80 = 0u;
      v81 = 0u;
      v82 = 0u;
      v83 = 0u;
      v42 = strongToStrongObjectsMapTable;
      v43 = [v42 countByEnumeratingWithState:&v80 objects:v88 count:16];
      if (v43)
      {
        v44 = 0;
        v45 = *v81;
        v70 = v40 - 1;
        do
        {
          v46 = 0;
          v47 = v70 - v44;
          v72 = v44 + v43;
          do
          {
            if (*v81 != v45)
            {
              objc_enumerationMutation(v42);
            }

            v48 = *(*(&v80 + 1) + 8 * v46);
            dispatch_group_enter(responseHandler4);
            v49 = MEMORY[0x277D0F818];
            v77[0] = MEMORY[0x277D85DD0];
            v77[1] = 3221225472;
            v77[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke;
            v77[3] = &unk_278670C30;
            v77[4] = self;
            v79 = buf;
            v78 = responseHandler4;
            v50 = [v49 messageWithMessage:v68 messagePayload:0 responseHandler:v77];
            v51 = [v50 mutableCopy];

            if (v47 != v46)
            {
              uUID = [MEMORY[0x277CCAD78] UUID];
              [v51 setIdentifier:uUID];
            }

            v53 = [v42 objectForKey:{v48, v59}];
            [v48 enableNotification:v66 != 0 forCharacteristicIDs:v53 message:v51 clientIdentifier:v65];

            ++v46;
          }

          while (v43 != v46);
          v43 = [v42 countByEnumeratingWithState:&v80 objects:v88 count:16];
          v44 = v72;
        }

        while (v43);
      }

      workQueue = [(HMDHome *)self workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_3;
      block[3] = &unk_27868A688;
      v75 = v68;
      v76 = buf;
      dispatch_group_notify(responseHandler4, workQueue, block);

      _Block_object_dispose(buf, 8);
    }

    else
    {
      responseHandler4 = [v68 responseHandler];
      v55 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (*(responseHandler4 + 16))(responseHandler4, v55, 0);
    }
  }

LABEL_49:

  v56 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_2;
  block[3] = &unk_27868A4D8;
  v9 = v3;
  v7 = *(a1 + 40);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  dispatch_async(v4, block);
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_3(uint64_t a1)
{
  v2 = [*(a1 + 32) responseHandler];

  if (v2)
  {
    v3 = [*(a1 + 32) responseHandler];
    (*(v3 + 2))(v3, *(*(*(a1 + 40) + 8) + 40), 0);
  }
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_2(uint64_t a1)
{
  v2 = *(*(a1 + 48) + 8);
  v4 = *(v2 + 40);
  v3 = (v2 + 40);
  if (!v4)
  {
    objc_storeStrong(v3, *(a1 + 32));
  }

  v5 = *(a1 + 40);

  dispatch_group_leave(v5);
}

HMDCharacteristicUpdateTuple *__45__HMDHome__handlePendingResponsesTimerFired___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 error];

  if (v3)
  {
    v4 = 0;
  }

  else
  {
    v5 = [HMDCharacteristicUpdateTuple alloc];
    v6 = [v2 request];
    v7 = [v6 characteristic];
    v8 = [v2 value];
    v4 = [(HMDCharacteristicUpdateTuple *)v5 initWithCharacteristic:v7 updatedValue:v8 isBroadcast:0];
  }

  return v4;
}

- (void)_handleSendingNotificationsForRequest:(id)request requestIdentifier:(id)identifier supportsMultiPartResponse:(BOOL)response characteristicUpdates:(id)updates completion:(id)completion
{
  responseCopy = response;
  v53 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  identifierCopy = identifier;
  updatesCopy = updates;
  completionCopy = completion;
  destination = [requestCopy destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = destination;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  if ([requestCopy isRemote] && (objc_msgSend(v18, "device"), v19 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v19, "remoteDestinationString"), v20 = objc_claimAutoreleasedReturnValue(), v20, v19, v20))
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      v38 = v24;
      shortDescription = [requestCopy shortDescription];
      v26 = "single";
      if (responseCopy)
      {
        v26 = "multi";
      }

      v35 = v26;
      v36 = shortDescription;
      v27 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(updatesCopy, "count")}];
      device = [v18 device];
      [device remoteDestinationString];
      *buf = 138544898;
      v40 = v24;
      v41 = 2112;
      v42 = v36;
      v43 = 2080;
      v44 = v35;
      v45 = 2112;
      v46 = v27;
      v47 = 2112;
      v48 = updatesCopy;
      v49 = 2112;
      v50 = identifierCopy;
      v52 = v51 = 2112;
      v28 = v52;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Response notification for %@ (%s part) [%@] with chars: %@ with id: %@ to device: %@", buf, 0x48u);
    }

    objc_autoreleasePoolPop(v21);
    uUID = [MEMORY[0x277CCAD78] UUID];
    uUIDString = [uUID UUIDString];
    device2 = [v18 device];
    remoteDestinationString = [device2 remoteDestinationString];
    [(HMDHome *)selfCopy _notifyUpdatedCharacteristic:updatesCopy withRequestIdentifier:identifierCopy notificationUpdateIdentifier:uUIDString toUserDeviceAddress:remoteDestinationString completion:completionCopy];
  }

  else if (completionCopy)
  {
    v33 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    completionCopy[2](completionCopy, v33);
  }

  v34 = *MEMORY[0x277D85DE8];
}

- (void)_handleMultipleCharacteristicRead:(id)read
{
  v47 = *MEMORY[0x277D85DE8];
  readCopy = read;
  currentActivity = [MEMORY[0x277D0F770] currentActivity];
  if ([readCopy isRemote] && (objc_msgSend(readCopy, "isSecureRemote") & 1) == 0)
  {
    v17 = objc_autoreleasePoolPush();
    selfCopy5 = self;
    v19 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
    {
      goto LABEL_22;
    }

    v20 = HMFGetLogIdentifier();
    *buf = 138543618;
    v40 = v20;
    v41 = 2112;
    v42 = readCopy;
    v21 = "%{public}@Message not supported: %@";
    v22 = v19;
    v23 = 22;
    goto LABEL_21;
  }

  if ([readCopy isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(readCopy, "isRemote"))
  {
    v38 = 0;
    responseHandler4 = [(HMDHome *)self _readRequestTuplesFromMessage:readCopy outUnhandledRequests:&v38];
    v7 = v38;
    if ([responseHandler4 count])
    {
      if ([v7 count])
      {
        v8 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v10 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          v11 = HMFGetLogIdentifier();
          shortDescription = [readCopy shortDescription];
          *buf = 138543874;
          v40 = v11;
          v41 = 2112;
          v42 = shortDescription;
          v43 = 2112;
          v44 = v7;
          _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@%@ has characteristic requests that cannot be handled: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v8);
      }

      source = [readCopy source];
      [responseHandler4 count];
      [readCopy isRemote];
      v14 = HMDRequestSourceAsString(source);
      v15 = [readCopy userForHome:self];
      if (v15 && ![(HMDHome *)self areCharacteristicRequests:responseHandler4 allowedForUser:v15])
      {
        v30 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v32 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
        {
          v33 = HMFGetLogIdentifier();
          restrictedGuestAccessSettings = [v15 restrictedGuestAccessSettings];
          [restrictedGuestAccessSettings uuidsOfAllowedAccessories];
          v35 = v37 = v30;
          *buf = 138544130;
          v40 = v33;
          v41 = 2112;
          v42 = readCopy;
          v43 = 2112;
          v44 = v15;
          v45 = 2112;
          v46 = v35;
          _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Rejecting message which is not allowed for user. Message: %@, user: %@, allowedAccessories: %@", buf, 0x2Au);

          v30 = v37;
        }

        objc_autoreleasePoolPop(v30);
        responseHandler2 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2906];
        [readCopy respondWithError:responseHandler2];
      }

      else
      {
        [(HMDHome *)self startReportingSessionForMessage:readCopy];
        responseHandler2 = [(HMDHome *)self __readWriteResponseHandler:readCopy unhandledRequests:v7];
        [(HMDHome *)self _readCharacteristicValues:responseHandler4 requestMessage:readCopy source:source withCompletionHandler:responseHandler2];
      }
    }

    else
    {
      v24 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v26 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
      {
        v27 = HMFGetLogIdentifier();
        *buf = 138543362;
        v40 = v27;
        _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_DEFAULT, "%{public}@None of the characteristics/properties in multi-read are valid", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v24);
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v15 domain];

      [v15 code];
      responseHandler = [readCopy responseHandler];

      if (!responseHandler)
      {
        goto LABEL_28;
      }

      responseHandler2 = [readCopy responseHandler];
      (responseHandler2)[2](responseHandler2, v15, 0);
    }

LABEL_28:
    goto LABEL_29;
  }

  v17 = objc_autoreleasePoolPush();
  selfCopy5 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 138543362;
    v40 = v20;
    v21 = "%{public}@Client does not have entitlement to use SPI";
    v22 = v19;
    v23 = 12;
LABEL_21:
    _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEFAULT, v21, buf, v23);
  }

LABEL_22:

  objc_autoreleasePoolPop(v17);
  v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
  [v7 domain];

  [v7 code];
  responseHandler3 = [readCopy responseHandler];

  if (responseHandler3)
  {
    responseHandler4 = [readCopy responseHandler];
    (responseHandler4)[2](responseHandler4, v7, 0);
LABEL_29:
  }

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleCharacteristicRead:(id)read
{
  v65[1] = *MEMORY[0x277D85DE8];
  readCopy = read;
  messagePayload = [readCopy messagePayload];
  v6 = [messagePayload hmf_UUIDForKey:*MEMORY[0x277CCF0B0]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  if (v9)
  {
    messagePayload2 = [readCopy messagePayload];
    v11 = [messagePayload2 objectForKeyedSubscript:*MEMORY[0x277CD25F8]];

    messagePayload3 = [readCopy messagePayload];
    v13 = [messagePayload3 objectForKeyedSubscript:*MEMORY[0x277CD2140]];

    v14 = [v9 findService:v11];
    v15 = [v14 findCharacteristic:v13];
    v16 = v15;
    if (v15)
    {
      v49 = v11;
      v65[0] = v15;
      v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v65 count:1];
      v50 = 0;
      v18 = [(HMDHome *)self _isReadRequestAllowForCharacteristics:v17 message:readCopy error:&v50];
      v19 = v50;

      if (v18)
      {
        v46 = v19;
        v20 = [HMDCharacteristicRequest requestWithCharacteristic:v16];
        source = [readCopy source];
        v21 = [readCopy userForHome:self];
        v47 = v21;
        v48 = v20;
        if (v21 && (v22 = v21, v64 = v20, [MEMORY[0x277CBEA60] arrayWithObjects:&v64 count:1], v23 = objc_claimAutoreleasedReturnValue(), LOBYTE(v22) = -[HMDHome areCharacteristicRequests:allowedForUser:](self, "areCharacteristicRequests:allowedForUser:", v23, v22), v23, v20 = v48, (v22 & 1) == 0))
        {
          v45 = objc_autoreleasePoolPush();
          selfCopy = self;
          v35 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
          {
            v36 = HMFGetLogIdentifier();
            contexta = [v47 restrictedGuestAccessSettings];
            uuidsOfAllowedAccessories = [contexta uuidsOfAllowedAccessories];
            *buf = 138544130;
            v53 = v36;
            v54 = 2112;
            v55 = readCopy;
            v56 = 2112;
            v57 = v47;
            v58 = 2112;
            v59 = uuidsOfAllowedAccessories;
            v38 = uuidsOfAllowedAccessories;
            _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Rejecting message which is not allowed for user. Message: %@, user: %@, allowedAccessories: %@", buf, 0x2Au);

            v20 = v48;
          }

          objc_autoreleasePoolPop(v45);
          v31 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2906];
          [readCopy respondWithError:v31];
        }

        else
        {
          context = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v25 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
          {
            v40 = HMFGetLogIdentifier();
            shortDescription = [readCopy shortDescription];
            [v6 UUIDString];
            v27 = v41 = v14;
            uniqueIdentifier = [v9 uniqueIdentifier];
            *buf = 138544642;
            v53 = v40;
            v54 = 2112;
            v55 = shortDescription;
            v29 = shortDescription;
            v56 = 2112;
            v57 = v27;
            v58 = 2112;
            v59 = uniqueIdentifier;
            v30 = uniqueIdentifier;
            v60 = 2112;
            v61 = v49;
            v62 = 2112;
            v63 = v13;
            _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Processing single characteristic read request: %@ (%@/%@/%@/%@) as a special case of multiple characteristic read requests", buf, 0x3Eu);

            v20 = v48;
            v14 = v41;
          }

          objc_autoreleasePoolPop(context);
          v51 = v20;
          v31 = [MEMORY[0x277CBEA60] arrayWithObjects:&v51 count:1];
          v32 = [(HMDHome *)selfCopy2 __readWriteResponseHandler:readCopy unhandledRequests:0];
          [(HMDHome *)selfCopy2 _readCharacteristicValues:v31 requestMessage:readCopy source:source withCompletionHandler:v32];

          v20 = v48;
        }

        v19 = v46;
      }

      else
      {
        [readCopy respondWithError:v19];
      }

      v11 = v49;
    }

    else
    {
      v33 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [readCopy respondWithError:v33];
    }
  }

  else
  {
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [readCopy respondWithError:v11];
  }

  v39 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isReadRequestAllowForCharacteristics:(id)characteristics message:(id)message error:(id *)error
{
  messageCopy = message;
  if ([(HMDHome *)self requiresUnlockToAccessCharacteristics:characteristics withMessage:messageCopy]&& ![(HMDHome *)self isAccessAllowedForCharacteristicsWithMessage:messageCopy])
  {
    if (error)
    {
      HMDSecureAccessErrorCodeForMessage(messageCopy, [messageCopy source]);
      *error = v9 = 0;
    }

    else
    {
      v9 = 0;
    }
  }

  else
  {
    v9 = 1;
  }

  return v9;
}

- (id)_readRequestTuplesFromMessage:(id)message outUnhandledRequests:(id *)requests
{
  requestsCopy = requests;
  v66 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v4 = [messageCopy dictionaryForKey:*MEMORY[0x277CCE7A8]];
  array = [MEMORY[0x277CBEB18] array];
  v48 = objc_alloc_init(MEMORY[0x277CBEB38]);
  v59 = 0u;
  v60 = 0u;
  v61 = 0u;
  v62 = 0u;
  obj = v4;
  v37 = [obj countByEnumeratingWithState:&v59 objects:v65 count:16];
  if (v37)
  {
    v35 = *v60;
    v47 = array;
    do
    {
      v6 = 0;
      do
      {
        if (*v60 != v35)
        {
          objc_enumerationMutation(obj);
        }

        v39 = v6;
        v7 = *(*(&v59 + 1) + 8 * v6);
        v8 = [obj hmf_dictionaryForKey:{v7, requestsCopy}];
        v49 = v7;
        v9 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v7];
        v10 = [(HMDHome *)self accessoryWithUUID:v9];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v41 = v11;

        v57 = 0u;
        v58 = 0u;
        v55 = 0u;
        v56 = 0u;
        v12 = v8;
        array = v47;
        v43 = [v12 countByEnumeratingWithState:&v55 objects:v64 count:16];
        if (v43)
        {
          v42 = *v56;
          v40 = v12;
          do
          {
            for (i = 0; i != v43; ++i)
            {
              if (*v56 != v42)
              {
                objc_enumerationMutation(v12);
              }

              v14 = *(*(&v55 + 1) + 8 * i);
              v15 = [v12 hmf_arrayForKey:v14];
              v16 = [v15 na_map:&__block_literal_global_1862];

              v17 = HAPInstanceIDFromValue();
              if (v17)
              {
                v46 = i;
                v44 = v17;
                v18 = [v41 findService:v17];
                v51 = 0u;
                v52 = 0u;
                v53 = 0u;
                v54 = 0u;
                v45 = v16;
                v19 = v16;
                v20 = [v19 countByEnumeratingWithState:&v51 objects:v63 count:16];
                if (v20)
                {
                  v21 = v20;
                  v22 = *v52;
                  do
                  {
                    for (j = 0; j != v21; ++j)
                    {
                      if (*v52 != v22)
                      {
                        objc_enumerationMutation(v19);
                      }

                      v24 = *(*(&v51 + 1) + 8 * j);
                      v25 = [v18 findCharacteristic:v24];
                      if (v25)
                      {
                        [array addObject:v25];
                      }

                      else
                      {
                        v26 = [v48 hmf_mutableDictionaryForKey:v49];
                        if (!v26)
                        {
                          v26 = objc_alloc_init(MEMORY[0x277CBEB38]);
                          [v48 setObject:v26 forKeyedSubscript:v49];
                        }

                        v27 = [v26 hmf_mutableArrayForKey:v14];
                        if (!v27)
                        {
                          v27 = objc_alloc_init(MEMORY[0x277CBEB18]);
                          [v26 setObject:v27 forKeyedSubscript:v14];
                        }

                        [v27 addObject:v24];

                        array = v47;
                      }
                    }

                    v21 = [v19 countByEnumeratingWithState:&v51 objects:v63 count:16];
                  }

                  while (v21);
                }

                v12 = v40;
                v16 = v45;
                i = v46;
                v17 = v44;
              }
            }

            v43 = [v12 countByEnumeratingWithState:&v55 objects:v64 count:16];
          }

          while (v43);
        }

        v6 = v39 + 1;
      }

      while (v39 + 1 != v37);
      v37 = [obj countByEnumeratingWithState:&v59 objects:v65 count:16];
    }

    while (v37);
  }

  if (requestsCopy)
  {
    *requestsCopy = [v48 copy];
  }

  v50 = 0;
  requestsCopy = [(HMDHome *)self _isReadRequestAllowForCharacteristics:array message:messageCopy error:&v50, requestsCopy];
  v29 = v50;
  if (requestsCopy)
  {
    v30 = [array na_map:&__block_literal_global_1864];
  }

  else
  {
    [messageCopy respondWithError:v29];
    v30 = 0;
  }

  v31 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_readCharacteristicValues:(id)values requestMessage:(id)message source:(unint64_t)source withCompletionHandler:(id)handler
{
  v33 = *MEMORY[0x277D85DE8];
  valuesCopy = values;
  messageCopy = message;
  handlerCopy = handler;
  v14 = objc_alloc(MEMORY[0x277D0F770]);
  v15 = MEMORY[0x277CCACA8];
  v16 = MEMORY[0x22AAD2510](self, a2);
  27461 = [v15 stringWithFormat:@"%@, %s:%ld", v16, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 27461];
  v28 = [v14 initWithName:27461];

  LOBYTE(v14) = [(HMDHome *)self isCurrentDeviceAvailableResident];
  v18 = objc_autoreleasePoolPush();
  selfCopy = self;
  if (v14)
  {
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      shortDescription = [messageCopy shortDescription];
      *buf = 138543618;
      v30 = v21;
      v31 = 2112;
      v32 = shortDescription;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Running new accessory communication logic for resident. %@", buf, 0x16u);
    }
  }

  else
  {
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      shortDescription2 = [messageCopy shortDescription];
      *buf = 138543618;
      v30 = v23;
      v31 = 2112;
      v32 = shortDescription2;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Routing accessory read requests using Resident First logic. %@", buf, 0x16u);
    }
  }

  objc_autoreleasePoolPop(v18);
  v25 = [(HMDHome *)selfCopy _createMessageForReadWriteRequest:messageCopy source:source withCompletionHandler:handlerCopy];
  accessoryReaderWriter = [(HMDHome *)selfCopy accessoryReaderWriter];
  [accessoryReaderWriter submitReadRequests:valuesCopy sourceType:source requestMessage:v25];

  __HMFActivityScopeLeave();
  v27 = *MEMORY[0x277D85DE8];
}

- (void)readCharacteristicValues:(id)values source:(unint64_t)source sourceForLogging:(id)logging qualityOfService:(int64_t)service withCompletionHandler:(id)handler
{
  valuesCopy = values;
  loggingCopy = logging;
  handlerCopy = handler;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x22AAD2510](self, a2);
  27070 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 27070];
  v32 = [v16 initWithName:27070];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __99__HMDHome_readCharacteristicValues_source_sourceForLogging_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_278670678;
  v25 = v32;
  selfCopy = self;
  v27 = loggingCopy;
  v28 = valuesCopy;
  serviceCopy = service;
  sourceCopy = source;
  v29 = handlerCopy;
  v21 = handlerCopy;
  v22 = valuesCopy;
  v23 = loggingCopy;
  dispatch_async(workQueue, block);

  __HMFActivityScopeLeave();
}

void __99__HMDHome_readCharacteristicValues_source_sourceForLogging_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  v21[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277D0F818];
  v3 = *(a1 + 72);
  v4 = [MEMORY[0x277D0F820] allMessageDestinations];
  v20 = @"kMultiPartResponseKey";
  v21[0] = MEMORY[0x277CBEC28];
  v5 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v21 forKeys:&v20 count:1];
  v6 = [v2 messageWithName:@"kMultipleCharacteristicReadRequestKey" qualityOfService:v3 destination:v4 payload:v5];

  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 40);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [v6 identifier];
    v12 = *(a1 + 48);
    v14 = 138543874;
    v15 = v10;
    v16 = 2114;
    v17 = v11;
    v18 = 2114;
    v19 = v12;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: %{public}@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  [*(a1 + 40) _readCharacteristicValues:*(a1 + 56) requestMessage:v6 source:*(a1 + 80) withCompletionHandler:*(a1 + 64)];

  v13 = *MEMORY[0x277D85DE8];
}

- (void)readCharacteristicValues:(id)values identifier:(id)identifier source:(unint64_t)source qualityOfService:(int64_t)service withCompletionHandler:(id)handler
{
  valuesCopy = values;
  identifierCopy = identifier;
  handlerCopy = handler;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x22AAD2510](self, a2);
  26602 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 26602];
  v20 = [v16 initWithName:26602];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_278670678;
  v27 = v20;
  v28 = valuesCopy;
  v31 = handlerCopy;
  sourceCopy = source;
  serviceCopy = service;
  selfCopy = self;
  v30 = identifierCopy;
  v22 = identifierCopy;
  v23 = handlerCopy;
  v24 = valuesCopy;
  v25 = v20;
  dispatch_async(workQueue, block);
}

void __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  location[3] = *MEMORY[0x277D85DE8];
  if ([*(a1 + 40) count])
  {
    objc_initWeak(location, *(a1 + 48));
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke_1858;
    aBlock[3] = &unk_278670650;
    objc_copyWeak(&v18, location);
    v17 = *(a1 + 64);
    v14 = *(a1 + 32);
    v19 = *(a1 + 72);
    v15 = *(a1 + 56);
    v16 = *(a1 + 40);
    v2 = _Block_copy(aBlock);
    if ([*(a1 + 48) _shouldWaitForAccessoriesToBeReachable])
    {
      v3 = *(a1 + 40);
      v4 = [*(a1 + 48) workQueue];
      v5 = [HMDHomeAssistantOperation homeAssistantOperationWithReadRequests:v3 queue:v4];

      [*(a1 + 48) _performOperation:v5 completion:v2];
    }

    else
    {
      v2[2](v2);
    }

    objc_destroyWeak(&v18);
    objc_destroyWeak(location);
    v10 = 0;
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 48);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v9;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Empty characteristics array was given", location, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
    v10 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    v11 = *(a1 + 64);
    if (v11)
    {
      (*(v11 + 16))(v11, v10, 0);
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke_1858(uint64_t a1)
{
  v28[2] = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained)
  {
    [*(a1 + 32) begin];
    v27[0] = @"sourceType";
    v3 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 72)];
    v27[1] = @"kMultiPartResponseKey";
    v28[0] = v3;
    v28[1] = MEMORY[0x277CBEC38];
    v4 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];

    v5 = objc_alloc(MEMORY[0x277D0F848]);
    v6 = *(a1 + 80);
    v7 = [MEMORY[0x277D0F820] allMessageDestinations];
    v8 = [v5 initWithName:@"kMultipleCharacteristicReadRequestKey" qualityOfService:v6 destination:v7 payload:v4];

    [v8 setIdentifier:*(a1 + 40)];
    v9 = objc_autoreleasePoolPush();
    v10 = WeakRetained;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v8 identifier];
      v14 = HMDRequestSourceAsString(*(a1 + 72));
      v21 = 138543874;
      v22 = v12;
      v23 = 2114;
      v24 = v13;
      v25 = 2114;
      v26 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: %{public}@", &v21, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [v10 _readCharacteristicValues:*(a1 + 48) requestMessage:v8 source:*(a1 + 72) withCompletionHandler:*(a1 + 56)];
    [*(a1 + 32) end];
  }

  else
  {
    v15 = *(a1 + 56);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      (*(v15 + 16))(v15, v16, 0);
    }

    v17 = objc_autoreleasePoolPush();
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform read request", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_performOperation:(id)operation completion:(id)completion
{
  operationCopy = operation;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  assistantOperations = [(HMDHome *)self assistantOperations];

  if (!assistantOperations)
  {
    array = [MEMORY[0x277CBEB18] array];
    [(HMDHome *)self setAssistantOperations:array];
  }

  assistantOperations2 = [(HMDHome *)self assistantOperations];
  [assistantOperations2 addObject:operationCopy];

  objc_initWeak(&location, self);
  objc_initWeak(&from, operationCopy);
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __40__HMDHome__performOperation_completion___block_invoke;
  v13[3] = &unk_278670628;
  v12 = completionCopy;
  v14 = v12;
  objc_copyWeak(&v15, &from);
  objc_copyWeak(&v16, &location);
  [operationCopy startWithCompletion:v13];
  objc_destroyWeak(&v16);
  objc_destroyWeak(&v15);

  objc_destroyWeak(&from);
  objc_destroyWeak(&location);
}

void __40__HMDHome__performOperation_completion___block_invoke(uint64_t a1)
{
  (*(*(a1 + 32) + 16))();
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = WeakRetained;
    v3 = objc_loadWeakRetained((a1 + 48));
    v4 = [v3 assistantOperations];
    [v4 removeObject:v5];

    WeakRetained = v5;
  }
}

- (BOOL)_shouldWaitForAccessoriesToBeReachable
{
  v3 = isWatch();
  isWatch();
  if (v3)
  {
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    primaryResidentDevice = [residentDeviceManager primaryResidentDevice];
    v6 = [primaryResidentDevice isReachable] ^ 1;
  }

  else
  {
    LOBYTE(v6) = 0;
  }

  return v6;
}

- (id)writeRequestTuplesFromMessage:(id)message outUnhandledRequests:(id *)requests
{
  v79 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v6 = [messageCopy dictionaryForKey:*MEMORY[0x277CCE7A8]];
  array = [MEMORY[0x277CBEB18] array];
  requestsCopy = requests;
  if (requests)
  {
    v55 = objc_alloc_init(MEMORY[0x277CBEB38]);
  }

  else
  {
    v55 = 0;
  }

  v7 = [messageCopy uuidForKey:*MEMORY[0x277CD2050]];
  if (v7)
  {
    v8 = 1;
  }

  else
  {
    v8 = [messageCopy BOOLForKey:*MEMORY[0x277CD2678]];
  }

  v58 = v8;

  v74 = 0u;
  v75 = 0u;
  v72 = 0u;
  v73 = 0u;
  obj = v6;
  v9 = v55;
  v43 = [obj countByEnumeratingWithState:&v72 objects:v78 count:16];
  if (v43)
  {
    v42 = *v73;
    v54 = *MEMORY[0x277CD2120];
    v62 = messageCopy;
    do
    {
      v10 = 0;
      do
      {
        if (*v73 != v42)
        {
          objc_enumerationMutation(obj);
        }

        v45 = v10;
        v11 = *(*(&v72 + 1) + 8 * v10);
        v12 = [obj hmf_dictionaryForKey:v11];
        v56 = v11;
        v13 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v11];
        v14 = [(HMDHome *)self accessoryWithUUID:v13];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v47 = v15;

        v70 = 0u;
        v71 = 0u;
        v68 = 0u;
        v69 = 0u;
        v16 = v12;
        v9 = v55;
        v49 = [v16 countByEnumeratingWithState:&v68 objects:v77 count:16];
        if (v49)
        {
          v48 = *v69;
          v46 = v16;
          do
          {
            for (i = 0; i != v49; ++i)
            {
              if (*v69 != v48)
              {
                objc_enumerationMutation(v16);
              }

              v18 = *(*(&v68 + 1) + 8 * i);
              v19 = [v16 hmf_dictionaryForKey:v18];
              v57 = v18;
              v20 = HAPInstanceIDFromValue();
              if (v20)
              {
                v52 = i;
                v50 = v20;
                v61 = [v47 findService:v20];
                v64 = 0u;
                v65 = 0u;
                v66 = 0u;
                v67 = 0u;
                v51 = v19;
                v21 = v19;
                v63 = [v21 countByEnumeratingWithState:&v64 objects:v76 count:16];
                if (!v63)
                {
                  goto LABEL_51;
                }

                v22 = *v65;
                v60 = *v65;
                while (1)
                {
                  for (j = 0; j != v63; ++j)
                  {
                    if (*v65 != v22)
                    {
                      objc_enumerationMutation(v21);
                    }

                    v24 = *(*(&v64 + 1) + 8 * j);
                    v25 = HAPInstanceIDFromValue();
                    if (v25)
                    {
                      v26 = [v61 findCharacteristic:v25];
                      if (v26)
                      {
                        if ([messageCopy isRemote])
                        {
                          v27 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v24, @"kAuthorizationDataKey"];
                          authorizationData = [v21 hmf_dataForKey:v27];
                          if (!authorizationData)
                          {
                            v29 = [messageCopy userForHome:self];
                            isRestrictedGuest = [v29 isRestrictedGuest];

                            if (isRestrictedGuest)
                            {
                              authorizationData = [v26 authorizationData];
                            }

                            else
                            {
                              authorizationData = 0;
                            }

                            messageCopy = v62;
                          }
                        }

                        else
                        {
                          authorizationData = [v26 authorizationData];
                        }

                        v32 = [v21 hmf_BOOLForKey:@"HMDCharacteristicWriteRequestIncludeResponseValueKey"];
                        if ([messageCopy isRemote])
                        {
                          currentUser = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v24, v54];
                          v31 = [v21 hmf_dataForKey:currentUser];
                          goto LABEL_46;
                        }

                        v34 = [HMDHome sanitizedOriginalSourceForMessage:messageCopy];
                        v31 = 0;
                        if (v34 != 1 && v34 != 10)
                        {
                          currentUser = [(HMDHome *)self currentUser];
                          notificationContextHAPIdentifier = [currentUser notificationContextHAPIdentifier];
                          v31 = [v26 contextDataForWriteRequestWithIdentifier:notificationContextHAPIdentifier];

LABEL_46:
                          messageCopy = v62;
                        }

                        v36 = [v21 objectForKeyedSubscript:v24];
                        identifier = [messageCopy identifier];
                        v38 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:v26 value:v36 authorizationData:authorizationData identifier:identifier type:v58 includeResponseValue:v32 contextData:v31];

                        messageCopy = v62;
                        [array addObject:v38];

                        v22 = v60;
                      }

                      else
                      {
                        authorizationData = [v55 hmf_mutableDictionaryForKey:v56];
                        if (!authorizationData)
                        {
                          authorizationData = objc_alloc_init(MEMORY[0x277CBEB38]);
                          [v55 setObject:authorizationData forKeyedSubscript:v56];
                        }

                        v31 = [authorizationData hmf_mutableArrayForKey:v57];
                        if (!v31)
                        {
                          v31 = objc_alloc_init(MEMORY[0x277CBEB18]);
                          [authorizationData setObject:v31 forKeyedSubscript:v57];
                        }

                        [v31 addObject:v25];
                      }
                    }
                  }

                  v63 = [v21 countByEnumeratingWithState:&v64 objects:v76 count:16];
                  if (!v63)
                  {
LABEL_51:

                    v9 = v55;
                    v16 = v46;
                    v19 = v51;
                    i = v52;
                    v20 = v50;
                    break;
                  }
                }
              }
            }

            v49 = [v16 countByEnumeratingWithState:&v68 objects:v77 count:16];
          }

          while (v49);
        }

        v10 = v45 + 1;
      }

      while (v45 + 1 != v43);
      v43 = [obj countByEnumeratingWithState:&v72 objects:v78 count:16];
    }

    while (v43);
  }

  if (requestsCopy)
  {
    *requestsCopy = [v9 copy];
  }

  v39 = *MEMORY[0x277D85DE8];

  return array;
}

+ (uint64_t)sanitizedOriginalSourceForMessage:(uint64_t)message
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = a2;
  v3 = objc_opt_self();
  messagePayload = [v2 messagePayload];
  v5 = [messagePayload hmf_numberForKey:@"kMessageOriginalSourceKey"];

  if (!v5)
  {
    source = [v2 source];
    goto LABEL_15;
  }

  unsignedIntegerValue = [v5 unsignedIntegerValue];
  source = unsignedIntegerValue;
  if (unsignedIntegerValue > 1069)
  {
    if (unsignedIntegerValue > 1139)
    {
      if ((unsignedIntegerValue - 1140) <= 0x3C && ((1 << (unsignedIntegerValue - 116)) & 0x1004010040100401) != 0 || unsignedIntegerValue == 1210 || unsignedIntegerValue == 1220)
      {
        goto LABEL_15;
      }

      goto LABEL_16;
    }

    v8 = unsignedIntegerValue - 1070;
  }

  else
  {
    if (unsignedIntegerValue < 0xB)
    {
      goto LABEL_15;
    }

    v8 = unsignedIntegerValue - 1000;
  }

  if (v8 <= 0x3C && ((1 << v8) & 0x1004010040100401) != 0)
  {
    goto LABEL_15;
  }

LABEL_16:
  v11 = objc_autoreleasePoolPush();
  v12 = v3;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
  {
    v14 = HMFGetLogIdentifier();
    v15 = 138543874;
    v16 = v14;
    v17 = 2114;
    v18 = @"kMessageOriginalSourceKey";
    v19 = 2114;
    v20 = v5;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Unknown value for '%{public}@': %{public}@", &v15, 0x20u);
  }

  objc_autoreleasePoolPop(v11);
  source = 0;
LABEL_15:

  v9 = *MEMORY[0x277D85DE8];
  return source;
}

- (void)_areWriteRequestsAllowed:(id)allowed message:(id)message completion:(id)completion
{
  v31 = *MEMORY[0x277D85DE8];
  allowedCopy = allowed;
  messageCopy = message;
  completionCopy = completion;
  v11 = [messageCopy userForHome:self];
  if (v11 && ![(HMDHome *)self areCharacteristicRequests:allowedCopy allowedForUser:v11])
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      restrictedGuestAccessSettings = [v11 restrictedGuestAccessSettings];
      uuidsOfAllowedAccessories = [restrictedGuestAccessSettings uuidsOfAllowedAccessories];
      v23 = 138544130;
      v24 = v18;
      v25 = 2112;
      v26 = messageCopy;
      v27 = 2112;
      v28 = v11;
      v29 = 2112;
      v30 = uuidsOfAllowedAccessories;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Rejecting message which is not allowed for user. Message: %@, user: %@, allowedAccessories: %@", &v23, 0x2Au);
    }

    objc_autoreleasePoolPop(v15);
    v14 = _Block_copy(completionCopy);
    if (v14)
    {
      v21 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2906];
      v14[2](v14, 0, v21);
    }

    goto LABEL_11;
  }

  source = [messageCopy source];
  if (![(HMDHome *)self applyDeviceLockStatus:messageCopy])
  {
    v13 = _Block_copy(completionCopy);
    v14 = v13;
    if (v13)
    {
      v13[2](v13, 1, 0);
    }

LABEL_11:

    goto LABEL_12;
  }

  [(HMDHome *)self _applyDeviceLockCheck:allowedCopy forSource:source message:messageCopy completion:completionCopy];
LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_applyDeviceLockCheck:(uint64_t)check forSource:(void *)source message:(void *)message completion:
{
  v77 = *MEMORY[0x277D85DE8];
  v51 = a2;
  sourceCopy = source;
  messageCopy = message;
  if (self)
  {
    synchronouslyFetchIsCarPlayConnectedStatus = [self synchronouslyFetchIsCarPlayConnectedStatus];
    selfCopy = self;
    dataSource = [self dataSource];
    deviceLockStateDataSource = [dataSource deviceLockStateDataSource];
    isPasscodeEnabled = [deviceLockStateDataSource isPasscodeEnabled];

    v66 = 0u;
    v67 = 0u;
    v64 = 0u;
    v65 = 0u;
    obj = v51;
    v57 = [(__CFString *)obj countByEnumeratingWithState:&v64 objects:v76 count:16];
    if (v57)
    {
      v56 = *v65;
      v52 = isPasscodeEnabled & synchronouslyFetchIsCarPlayConnectedStatus;
LABEL_4:
      v12 = 0;
      while (1)
      {
        if (*v65 != v56)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v64 + 1) + 8 * v12);
        characteristic = [(__CFString *)v13 characteristic];
        service = [(__CFString *)characteristic service];
        dataSource2 = [selfCopy dataSource];
        hapMetadata = [dataSource2 hapMetadata];
        type = [(__CFString *)characteristic type];
        type2 = [service type];
        v20 = [hapMetadata requiresDeviceUnlock:type forService:type2];

        if (v20)
        {
          dataSource3 = [selfCopy dataSource];
          hapMetadata2 = [dataSource3 hapMetadata];
          type3 = [(__CFString *)characteristic type];
          value = [(__CFString *)v13 value];
          v25 = [hapMetadata2 allowsSecuringWriteFor:type3 withValue:value];

          if (((check == 1) & v25) == 0)
          {
            v26 = v52 ? [selfCopy isCarPlayAccessAllowedForCharacteristic:characteristic withMessage:sourceCopy fromSource:check] : 0;
            if ((([selfCopy isAccessAllowedForCharacteristicsWithMessage:sourceCopy] | v26) & 1) == 0)
            {
              break;
            }
          }
        }

        if (v57 == ++v12)
        {
          v57 = [(__CFString *)obj countByEnumeratingWithState:&v64 objects:v76 count:16];
          if (v57)
          {
            goto LABEL_4;
          }

          goto LABEL_23;
        }
      }

      v27 = HMDSecureAccessErrorCodeForMessage(sourceCopy, check);
      v28 = objc_autoreleasePoolPush();
      v29 = selfCopy;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
      {
        v31 = HMFGetLogIdentifier();
        v32 = HMDRequestSourceAsString(check);
        *buf = 138544130;
        v69 = v31;
        v70 = 2112;
        v71 = v13;
        v72 = 2112;
        v73 = characteristic;
        v74 = 2112;
        v75 = v32;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Write request (%@) for characteristic: %@ from source: %@ is attempting to perform a securing write", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v28);
      if (check != 1)
      {
        goto LABEL_28;
      }

      if (!v27)
      {
        goto LABEL_24;
      }

      v33 = objc_autoreleasePoolPush();
      v34 = v29;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543362;
        v69 = v36;
        _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Checking siri unlock access for siri triggered write request", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v33);
      objc_initWeak(buf, v34);
      siriSecureAccessoryAccessController = [v34 siriSecureAccessoryAccessController];
      v59[0] = MEMORY[0x277D85DD0];
      v59[1] = 3221225472;
      v59[2] = __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke;
      v59[3] = &unk_278670588;
      objc_copyWeak(&v63, buf);
      v62 = messageCopy;
      v60 = obj;
      v38 = v27;
      v61 = v38;
      [siriSecureAccessoryAccessController isUnsecuringSiriActionAllowedWithCompletion:v59];

      objc_destroyWeak(&v63);
      objc_destroyWeak(buf);
    }

    else
    {
LABEL_23:

      if (check == 1)
      {
LABEL_24:
        v39 = objc_autoreleasePoolPush();
        v40 = selfCopy;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          *buf = 138543874;
          v69 = v42;
          v70 = 2112;
          v71 = obj;
          v72 = 2112;
          v73 = @"Siri";
          _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Access is allowed for write requests (%@) from source: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v39);
        (*(messageCopy + 2))(messageCopy, 1, 0);
      }

      else
      {
        v27 = 0;
LABEL_28:
        v43 = objc_autoreleasePoolPush();
        v44 = selfCopy;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
        {
          v46 = HMFGetLogIdentifier();
          if (v27)
          {
            v47 = @"denied";
          }

          else
          {
            v47 = @"allowed";
          }

          v48 = HMDRequestSourceAsString(check);
          *buf = 138544130;
          v69 = v46;
          v70 = 2112;
          v71 = v47;
          v72 = 2112;
          v73 = obj;
          v74 = 2112;
          v75 = v48;
          _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_INFO, "%{public}@Access is %@ for write requests (%@) from source: %@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v43);
        (*(messageCopy + 2))(messageCopy, v27 == 0, v27);
      }
    }
  }

  v49 = *MEMORY[0x277D85DE8];
}

void __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke(uint64_t a1, int a2)
{
  v25 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = @"denied";
      v10 = *(a1 + 32);
      *buf = 138543874;
      v20 = v8;
      if (a2)
      {
        v9 = @"allowed";
      }

      v21 = 2112;
      v22 = v9;
      v23 = 2112;
      v24 = v10;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Access is %@ for write requests (%@) by siri watch authentication", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = [v6 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke_1845;
    block[3] = &unk_278687F18;
    v17 = *(a1 + 48);
    v18 = a2;
    v16 = *(a1 + 40);
    dispatch_async(v11, block);
  }

  else
  {
    v12 = *(a1 + 48);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    (*(v12 + 16))(v12, 0, v13);
  }

  v14 = *MEMORY[0x277D85DE8];
}

uint64_t __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke_1845(uint64_t a1)
{
  v2 = *(a1 + 40);
  if ((*(a1 + 48) & 1) == 0)
  {
    v3 = *(a1 + 32);
  }

  return (*(v2 + 16))();
}

- (void)_handleMultipleCharacteristicWrite:(id)write
{
  v30 = *MEMORY[0x277D85DE8];
  writeCopy = write;
  v23 = 0;
  v5 = [(HMDHome *)self writeRequestTuplesFromMessage:writeCopy outUnhandledRequests:&v23];
  v6 = v23;
  if ([v6 count])
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      shortDescription = [writeCopy shortDescription];
      *buf = 138543874;
      v25 = v10;
      v26 = 2112;
      v27 = shortDescription;
      v28 = 2112;
      v29 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ has characteristic requests that cannot be handled: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
  }

  source = [writeCopy source];
  [v5 count];
  [writeCopy isRemote];
  v13 = HMDRequestSourceAsString(source);
  objc_initWeak(buf, self);
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __46__HMDHome__handleMultipleCharacteristicWrite___block_invoke;
  v18[3] = &unk_278670600;
  objc_copyWeak(v22, buf);
  v14 = writeCopy;
  v19 = v14;
  v22[1] = source;
  v15 = v5;
  v20 = v15;
  v16 = v6;
  v21 = v16;
  [(HMDHome *)self _areWriteRequestsAllowed:v15 message:v14 completion:v18];

  objc_destroyWeak(v22);
  objc_destroyWeak(buf);

  v17 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleMultipleCharacteristicWrite___block_invoke(uint64_t a1, char a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v7 = WeakRetained;
  if (a2)
  {
    v8 = *(a1 + 32);
    if (WeakRetained)
    {
      [WeakRetained startReportingSessionForMessage:*(a1 + 32)];
      v9 = objc_autoreleasePoolPush();
      v10 = v7;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 0;
        *&buf[8] = 0;
        v13 = [*(a1 + 32) identifier];

        if (v13)
        {
          v14 = [*(a1 + 32) identifier];
          [v14 getUUIDBytes:buf];
        }

        else
        {
          *buf = *MEMORY[0x277D0F960];
        }

        v21 = *buf;
        v16 = HMDRequestSourceAsString(*(a1 + 64));
        *buf = 138544130;
        *&buf[4] = v12;
        *&buf[12] = 1042;
        *&buf[14] = 16;
        v23 = 2098;
        v24 = &v21;
        v25 = 2114;
        v26 = v16;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Handling multiple characteristics write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
      }

      objc_autoreleasePoolPop(v9);
      v18 = *(a1 + 32);
      v17 = *(a1 + 40);
      v19 = *(a1 + 64);
      v15 = [v10 __readWriteResponseHandler:v18 unhandledRequests:*(a1 + 48)];
      [v10 _writeCharacteristicValues:v17 requestMessage:v18 source:v19 biomeSource:0 withCompletionHandler:v15];
    }

    else
    {
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v8 respondWithError:v15];
    }
  }

  else
  {
    [*(a1 + 32) respondWithError:v5];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleCharacteristicWrite:(id)write
{
  v39[1] = *MEMORY[0x277D85DE8];
  writeCopy = write;
  messagePayload = [writeCopy messagePayload];
  v6 = [messagePayload hmf_UUIDForKey:*MEMORY[0x277CCF0B0]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  if (v9)
  {
    messagePayload2 = [writeCopy messagePayload];
    v11 = [messagePayload2 objectForKeyedSubscript:*MEMORY[0x277CD25F8]];
    v29 = HAPInstanceIDFromValue();

    messagePayload3 = [writeCopy messagePayload];
    v13 = [messagePayload3 objectForKeyedSubscript:*MEMORY[0x277CD2140]];
    v14 = HAPInstanceIDFromValue();

    v28 = [v9 findService:v29];
    v15 = [v28 findCharacteristic:v14];
    if (!v15)
    {
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [writeCopy respondWithError:v25];

      goto LABEL_13;
    }

    if ([writeCopy isRemote])
    {
      authorizationData = [writeCopy dataForKey:@"kAuthorizationDataKey"];
      if (authorizationData)
      {
LABEL_10:
        messagePayload4 = [writeCopy messagePayload];
        v19 = [messagePayload4 objectForKeyedSubscript:*MEMORY[0x277CD21B8]];
        identifier = [writeCopy identifier];
        v21 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:v15 value:v19 authorizationData:authorizationData identifier:identifier type:0 includeResponseValue:0];

        objc_initWeak(&location, self);
        v39[0] = v21;
        v22 = [MEMORY[0x277CBEA60] arrayWithObjects:v39 count:1];
        v30[0] = MEMORY[0x277D85DD0];
        v30[1] = 3221225472;
        v30[2] = __38__HMDHome__handleCharacteristicWrite___block_invoke;
        v30[3] = &unk_2786705D8;
        objc_copyWeak(&v37, &location);
        v31 = writeCopy;
        v32 = v6;
        v33 = v9;
        v34 = v29;
        v35 = v14;
        v23 = v21;
        v36 = v23;
        [(HMDHome *)self _areWriteRequestsAllowed:v22 message:v31 completion:v30];

        objc_destroyWeak(&v37);
        objc_destroyWeak(&location);

LABEL_13:
        goto LABEL_14;
      }

      v16 = [writeCopy userForHome:self];
      isRestrictedGuest = [v16 isRestrictedGuest];

      if (!isRestrictedGuest)
      {
        authorizationData = 0;
        goto LABEL_10;
      }
    }

    authorizationData = [v15 authorizationData];
    goto LABEL_10;
  }

  v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
  [writeCopy respondWithError:v24];

LABEL_14:
  v26 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__handleCharacteristicWrite___block_invoke(uint64_t a1, char a2, void *a3)
{
  v38 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v7 = WeakRetained;
  if (a2)
  {
    if (WeakRetained)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = v7;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = [*(a1 + 32) shortDescription];
        v13 = [*(a1 + 40) UUIDString];
        v14 = [*(a1 + 48) uniqueIdentifier];
        v15 = *(a1 + 56);
        v16 = *(a1 + 64);
        *buf = 138544642;
        *&buf[4] = v11;
        *&buf[12] = 2112;
        *&buf[14] = v12;
        *&buf[22] = 2112;
        *&buf[24] = v13;
        *&buf[32] = 2112;
        *&buf[34] = v14;
        v34 = 2112;
        v35 = v15;
        v36 = 2112;
        v37 = v16;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Processing single characteristic write request: %@ (%@/%@/%@/%@) as a special case of multiple characteristic write requests", buf, 0x3Eu);
      }

      objc_autoreleasePoolPop(v8);
      v17 = [*(a1 + 32) source];
      v18 = objc_autoreleasePoolPush();
      v19 = v9;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 0;
        *&buf[8] = 0;
        v22 = [*(a1 + 32) identifier];

        if (v22)
        {
          v23 = [*(a1 + 32) identifier];
          [v23 getUUIDBytes:buf];
        }

        else
        {
          *buf = *MEMORY[0x277D0F960];
        }

        v32 = *buf;
        v26 = HMDRequestSourceAsString(v17);
        *buf = 138544130;
        *&buf[4] = v21;
        *&buf[12] = 1042;
        *&buf[14] = 16;
        *&buf[18] = 2098;
        *&buf[20] = &v32;
        *&buf[28] = 2114;
        *&buf[30] = v26;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Handling single characteristic write request with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
      }

      objc_autoreleasePoolPop(v18);
      v31 = *(a1 + 72);
      v27 = [MEMORY[0x277CBEA60] arrayWithObjects:&v31 count:1];
      v28 = *(a1 + 32);
      v29 = [v19 __readWriteResponseHandler:v28 unhandledRequests:0];
      [v19 _writeCharacteristicValues:v27 requestMessage:v28 source:v17 biomeSource:0 withCompletionHandler:v29];
    }

    else
    {
      v24 = *(a1 + 32);
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v24 respondWithError:v25];
    }
  }

  else
  {
    [*(a1 + 32) respondWithError:v5];
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (id)__readWriteResponseHandler:(id)handler unhandledRequests:(id)requests
{
  handlerCopy = handler;
  requestsCopy = requests;
  objc_initWeak(&location, self);
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __56__HMDHome___readWriteResponseHandler_unhandledRequests___block_invoke;
  v12[3] = &unk_278689460;
  objc_copyWeak(&v15, &location);
  v13 = requestsCopy;
  v14 = handlerCopy;
  v8 = handlerCopy;
  v9 = requestsCopy;
  v10 = _Block_copy(v12);

  objc_destroyWeak(&v15);
  objc_destroyWeak(&location);

  return v10;
}

void __56__HMDHome___readWriteResponseHandler_unhandledRequests___block_invoke(id *a1, void *a2, void *a3)
{
  v24 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if ([a1[4] count])
  {
    v8 = [HMDCharacteristicResponseNotificationContext updateMultipleCharacteristicReadWriteResponsePayload:v6 withUnhandledRequests:a1[4]];

    v6 = v8;
  }

  v9 = +[HMDCharacteristicResponseNotificationContext updateLastSeenStatusDataForResponsePayload:home:isRemote:isNotification:](HMDCharacteristicResponseNotificationContext, "updateLastSeenStatusDataForResponsePayload:home:isRemote:isNotification:", v6, WeakRetained, [a1[5] isRemote], 0);

  v10 = objc_autoreleasePoolPush();
  v11 = WeakRetained;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [a1[5] shortDescription];
    v16 = 138544130;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    v20 = 2112;
    v21 = v9;
    v22 = 2112;
    v23 = v5;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Responding to the client: %@ with payload : %@, error: %@", &v16, 0x2Au);
  }

  objc_autoreleasePoolPop(v10);
  [a1[5] respondWithPayload:v9 error:v5];
  [a1[5] setResponseHandler:0];
  [v11 endReportingSessionForMessage:a1[5]];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_addResponseTuplesFromDictionary:(id)dictionary accessoryRequestMapTable:(id)table responseTuples:(id)tuples completedGroup:(id)group logEvents:(id)events
{
  v55 = *MEMORY[0x277D85DE8];
  dictionaryCopy = dictionary;
  tableCopy = table;
  tuplesCopy = tuples;
  group = group;
  eventsCopy = events;
  if (tuplesCopy)
  {
    _HMFPreconditionFailure();
  }

  v33 = dictionaryCopy;
  [dictionaryCopy hmf_dictionaryForKey:@"kModifiedCharacteristicsForAccessoryKey"];
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  obj = v53 = 0u;
  v38 = [obj countByEnumeratingWithState:&v50 objects:v54 count:16];
  if (v38)
  {
    v37 = *v51;
    v32 = v41;
    do
    {
      for (i = 0; i != v38; ++i)
      {
        if (*v51 != v37)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v50 + 1) + 8 * i);
        v16 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:{v15, v32}];
        v17 = [(HMDHome *)self accessoryWithUUID:v16];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v18 = v17;
        }

        else
        {
          v18 = 0;
        }

        v19 = v18;

        if (v19)
        {
          bridge = [v19 bridge];
          v21 = bridge;
          if (bridge)
          {
            v22 = bridge;
          }

          else
          {
            v22 = v19;
          }

          v23 = v22;

          uuid = [v23 uuid];
          uUIDString = [uuid UUIDString];

          v26 = [tableCopy objectForKey:v23];
          v27 = [obj hmf_dictionaryForKey:v15];
          dispatch_group_enter(group);
          v40[0] = MEMORY[0x277D85DD0];
          v40[1] = 3221225472;
          v41[0] = __109__HMDHome__addResponseTuplesFromDictionary_accessoryRequestMapTable_responseTuples_completedGroup_logEvents___block_invoke;
          v41[1] = &unk_2786705B0;
          v42 = v26;
          v28 = v19;
          v43 = v28;
          v44 = eventsCopy;
          v45 = uUIDString;
          v46 = v33;
          selfCopy = self;
          v48 = 0;
          groupCopy = group;
          v29 = uUIDString;
          v30 = v26;
          [v28 handleMultipleCharacteristicsUpdated:v27 message:0 completionQueue:0 completionHandler:v40];
        }
      }

      v38 = [obj countByEnumeratingWithState:&v50 objects:v54 count:16];
    }

    while (v38);
  }

  dispatch_group_leave(group);

  v31 = *MEMORY[0x277D85DE8];
}

void __109__HMDHome__addResponseTuplesFromDictionary_accessoryRequestMapTable_responseTuples_completedGroup_logEvents___block_invoke(uint64_t a1, void *a2)
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v4 = *(a1 + 32);
  v5 = [v4 countByEnumeratingWithState:&v34 objects:v38 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v35;
    v30 = v3;
    v31 = *v35;
    v29 = a1;
    do
    {
      v8 = 0;
      v33 = v6;
      do
      {
        if (*v35 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v34 + 1) + 8 * v8);
        v10 = [v9 characteristic];
        v11 = [v10 accessory];
        v12 = *(a1 + 40);

        if (v11 == v12)
        {
          v13 = [v9 characteristic];
          v14 = [v3 objectForKey:v13];

          v15 = [*(a1 + 48) objectForKeyedSubscript:*(a1 + 56)];
          v16 = v15;
          if (v15 && ([v15 isSubmitted] & 1) == 0)
          {
            v17 = [*(a1 + 64) objectForKeyedSubscript:@"kRemoteMessageTransportAttributionKey"];
            [v16 setTransportType:{objc_msgSend(v17, "intValue")}];

            v18 = [*(a1 + 72) logEventSubmitter];
            v19 = [v14 error];
            [v18 submitLogEvent:v16 error:v19];

            v6 = v33;
            v7 = v31;
          }

          if (v14 && *(a1 + 80))
          {
            v20 = [v14 error];
            v21 = [HMDCharacteristicResponse responseWithRequest:v9 error:v20];

            v32 = [v9 characteristic];
            v22 = [v32 value];
            v23 = [v14 valueUpdatedTime];
            v24 = [v14 valueUpdatedStateNumber];
            v25 = [v9 characteristic];
            [v25 notificationContext];
            v27 = v26 = v4;
            [v21 setValue:v22 updatedTime:v23 stateNumber:v24 notificationContext:v27];

            v4 = v26;
            v7 = v31;

            v3 = v30;
            a1 = v29;

            v6 = v33;
            [*(v29 + 80) addObject:v21];
          }
        }

        ++v8;
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v34 objects:v38 count:16];
    }

    while (v6);
  }

  dispatch_group_leave(*(a1 + 88));
  v28 = *MEMORY[0x277D85DE8];
}

- (void)_writeCharacteristicValues:(id)values requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource withCompletionHandler:(id)handler
{
  v35 = *MEMORY[0x277D85DE8];
  valuesCopy = values;
  messageCopy = message;
  handlerCopy = handler;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x22AAD2510](self, a2);
  26007 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 26007];
  v30 = [v16 initWithName:26007];

  LOBYTE(v16) = [(HMDHome *)self isCurrentDeviceAvailableResident];
  v20 = objc_autoreleasePoolPush();
  selfCopy = self;
  if (v16)
  {
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      shortDescription = [messageCopy shortDescription];
      *buf = 138543618;
      v32 = v23;
      v33 = 2112;
      v34 = shortDescription;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Running new accessory communication logic for resident. %@", buf, 0x16u);
    }
  }

  else
  {
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      shortDescription2 = [messageCopy shortDescription];
      *buf = 138543618;
      v32 = v25;
      v33 = 2112;
      v34 = shortDescription2;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Routing accessory write requests using Resident First logic. %@", buf, 0x16u);
    }
  }

  objc_autoreleasePoolPop(v20);
  v27 = [(HMDHome *)selfCopy _createMessageForReadWriteRequest:messageCopy source:source withCompletionHandler:handlerCopy];
  accessoryReaderWriter = [(HMDHome *)selfCopy accessoryReaderWriter];
  [accessoryReaderWriter submitWriteRequests:valuesCopy sourceType:source biomeSource:biomeSource requestMessage:v27];

  __HMFActivityScopeLeave();
  v29 = *MEMORY[0x277D85DE8];
}

- (id)_createMessageForReadWriteRequest:(id)request source:(unint64_t)source withCompletionHandler:(id)handler
{
  requestCopy = request;
  handlerCopy = handler;
  internal = [requestCopy internal];
  v11 = [internal copy];

  messagePayload = [v11 messagePayload];
  v13 = [messagePayload hmf_numberForKey:@"kMessageOriginalSourceKey"];

  if (v13)
  {
    v14 = 0;
  }

  else
  {
    v14 = [messagePayload mutableCopy];
    v15 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:source];
    [v14 setObject:v15 forKeyedSubscript:@"kMessageOriginalSourceKey"];
  }

  if (source == 1 && !isTVOSDevice())
  {
    v16 = [requestCopy userForHome:self];
    if (v16)
    {
      if (!v14)
      {
        v14 = [messagePayload mutableCopy];
      }

      uuid = [v16 uuid];
      uUIDString = [uuid UUIDString];
      [v14 setObject:uUIDString forKeyedSubscript:@"kMessageUserOverrideKey"];
    }
  }

  if (v14)
  {
    v19 = [v14 copy];
    [v11 setMessagePayload:v19];
  }

  v20 = [objc_alloc(objc_opt_class()) initWithInternalMessage:v11];

  objc_initWeak(&location, v20);
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __74__HMDHome__createMessageForReadWriteRequest_source_withCompletionHandler___block_invoke;
  v24[3] = &unk_278686110;
  objc_copyWeak(&v28, &location);
  v21 = handlerCopy;
  v27 = v21;
  v22 = requestCopy;
  v25 = v22;
  selfCopy = self;
  [v20 setResponseHandler:v24];

  objc_destroyWeak(&v28);
  objc_destroyWeak(&location);

  return v20;
}

void __74__HMDHome__createMessageForReadWriteRequest_source_withCompletionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v8 = _Block_copy(*(a1 + 48));
  v9 = v8;
  if (v8)
  {
    (*(v8 + 2))(v8, v5, v6);
  }

  v10 = [*(a1 + 32) responseHandler];

  if (!v10)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [*(a1 + 32) shortDescription];
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEBUG, "%{public}@The response handler became nil for read/write request message: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    [WeakRetained setResponseHandler:0];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)requiresUnlockToAccessCharacteristics:(id)characteristics withMessage:(id)message
{
  characteristicsCopy = characteristics;
  if ([(HMDHome *)self applyDeviceLockStatus:message])
  {
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __61__HMDHome_requiresUnlockToAccessCharacteristics_withMessage___block_invoke;
    v9[3] = &unk_278687EB0;
    v9[4] = self;
    v7 = [characteristicsCopy na_any:v9];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

uint64_t __61__HMDHome_requiresUnlockToAccessCharacteristics_withMessage___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = [v2 dataSource];
  v5 = [v4 hapMetadata];
  v6 = [v3 type];
  v7 = [v3 service];

  v8 = [v7 type];
  v9 = [v5 requiresDeviceUnlock:v6 forService:v8];

  return v9;
}

- (BOOL)isAccessAllowedForCharacteristicsWithMessage:(id)message
{
  v17 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if ([messageCopy isEntitledForSecureAccess] && (objc_msgSend(messageCopy, "isEntitledForSPIAccess") & 1) != 0)
  {
    v5 = 1;
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      shortDescription = [messageCopy shortDescription];
      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = shortDescription;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Insufficient entitlements, access is not allowed for characteristic with message: %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v5 = 0;
  }

  v11 = *MEMORY[0x277D85DE8];
  return v5;
}

- (void)writeCharacteristicValues:(id)values source:(unint64_t)source message:(id)message identifier:(id)identifier qualityOfService:(int64_t)service withCompletionHandler:(id)handler
{
  valuesCopy = values;
  messageCopy = message;
  identifierCopy = identifier;
  handlerCopy = handler;
  v19 = objc_alloc(MEMORY[0x277D0F770]);
  v20 = MEMORY[0x277CCACA8];
  v21 = MEMORY[0x22AAD2510](self, a2);
  24831 = [v20 stringWithFormat:@"%@, %s:%ld", v21, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 24831];
  v23 = [v19 initWithName:24831];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_278675F08;
  block[4] = self;
  v31 = valuesCopy;
  v32 = v23;
  v33 = messageCopy;
  v34 = identifierCopy;
  v35 = handlerCopy;
  sourceCopy = source;
  serviceCopy = service;
  v25 = identifierCopy;
  v26 = messageCopy;
  v27 = v23;
  v28 = handlerCopy;
  v29 = valuesCopy;
  dispatch_async(workQueue, block);
}

void __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke(id *a1)
{
  if ([a1[4] _shouldWaitForAccessoriesToBeReachable])
  {
    v2 = a1[5];
    v3 = [a1[4] workQueue];
    v4 = [HMDHomeAssistantOperation homeAssistantOperationWithWriteRequests:v2 queue:v3];

    objc_initWeak(&location, a1[4]);
    v5 = a1[4];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke_2;
    v20[3] = &unk_278670538;
    objc_copyWeak(v24, &location);
    v23 = a1[9];
    v6 = a1[6];
    v7 = a1[5];
    v24[1] = a1[10];
    v8 = a1[7];
    v9 = a1[8];
    *&v10 = v8;
    *(&v10 + 1) = v9;
    *&v11 = v6;
    *(&v11 + 1) = v7;
    v21 = v11;
    v22 = v10;
    v24[2] = a1[11];
    [v5 _performOperation:v4 completion:v20];

    objc_destroyWeak(v24);
    objc_destroyWeak(&location);
  }

  else
  {
    [a1[6] begin];
    v12 = a1[4];
    v13 = a1[5];
    v14 = a1[10];
    v15 = a1[11];
    v16 = a1[8];
    v17 = a1[9];
    v19 = a1[6];
    v18 = a1[7];

    [(HMDHome *)v12 _writeCharacteristicValues:v13 source:v14 message:v18 identifier:v16 qualityOfService:v15 withCompletionHandler:v17 activity:v19];
  }
}

void __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke_2(id *a1)
{
  v11 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 9);
  if (WeakRetained)
  {
    [a1[4] begin];
    [(HMDHome *)WeakRetained _writeCharacteristicValues:a1[10] source:a1[6] message:a1[7] identifier:a1[11] qualityOfService:a1[8] withCompletionHandler:a1[4] activity:?];
  }

  else
  {
    v3 = objc_autoreleasePoolPush();
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v5;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform write request", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v6 = _Block_copy(a1[8]);
    if (v6)
    {
      v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      v6[2](v6, v7, 0);
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_writeCharacteristicValues:(void *)values source:(void *)source message:(void *)message identifier:(void *)identifier qualityOfService:(void *)service withCompletionHandler:(void *)handler activity:
{
  v60 = *MEMORY[0x277D85DE8];
  v42 = a2;
  sourceCopy = source;
  messageCopy = message;
  serviceCopy = service;
  handlerCopy = handler;
  val = self;
  if (self)
  {
    v44 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v42, "count")}];
    v55 = 0u;
    v56 = 0u;
    v53 = 0u;
    v54 = 0u;
    obj = v42;
    v13 = [obj countByEnumeratingWithState:&v53 objects:v59 count:16];
    if (v13)
    {
      v14 = *v54;
      do
      {
        for (i = 0; i != v13; ++i)
        {
          if (*v54 != v14)
          {
            objc_enumerationMutation(obj);
          }

          v16 = *(*(&v53 + 1) + 8 * i);
          characteristic = [v16 characteristic];
          authorizationData = [characteristic authorizationData];
          home = [val home];
          currentUser = [home currentUser];
          notificationContextHAPIdentifier = [currentUser notificationContextHAPIdentifier];
          v22 = [characteristic contextDataForWriteRequestWithIdentifier:notificationContextHAPIdentifier];

          value = [v16 value];
          v24 = +[HMDCharacteristicWriteRequest writeRequestWithCharacteristic:value:authorizationData:identifier:type:includeResponseValue:contextData:](HMDCharacteristicWriteRequest, "writeRequestWithCharacteristic:value:authorizationData:identifier:type:includeResponseValue:contextData:", characteristic, value, authorizationData, 0, [v16 requestType], objc_msgSend(v16, "includeResponseValue"), v22);

          [v44 addObject:v24];
        }

        v13 = [obj countByEnumeratingWithState:&v53 objects:v59 count:16];
      }

      while (v13);
    }

    dataSource = [val dataSource];
    deviceLockStateDataSource = [dataSource deviceLockStateDataSource];
    if ([deviceLockStateDataSource isPasscodeEnabled])
    {
      dataSource2 = [val dataSource];
      deviceLockStateDataSource2 = [dataSource2 deviceLockStateDataSource];
      isLocked = [deviceLockStateDataSource2 isLocked];

      if (!isLocked)
      {
        v30 = objc_autoreleasePoolPush();
        v31 = val;
        v32 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
        {
          v33 = HMFGetLogIdentifier();
          *buf = 138543362;
          v58 = v33;
          _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Allowing characteristic write because device lock check is not required", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v30);
        [(HMDHome *)v31 _performAllowedWriteCharacteristicValues:v44 source:values identifier:messageCopy qualityOfService:identifier withCompletionHandler:serviceCopy activity:handlerCopy];
        goto LABEL_16;
      }
    }

    else
    {
    }

    objc_initWeak(buf, val);
    v46[0] = MEMORY[0x277D85DD0];
    v46[1] = 3221225472;
    v46[2] = __112__HMDHome__writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler_activity___block_invoke;
    v46[3] = &unk_278670560;
    objc_copyWeak(v51, buf);
    v34 = serviceCopy;
    v52 = 1;
    v50 = v34;
    v51[1] = values;
    v47 = handlerCopy;
    v48 = v44;
    v49 = messageCopy;
    v51[2] = identifier;
    [(HMDHome *)val _applyDeviceLockCheck:v48 forSource:values message:sourceCopy completion:v46];

    objc_destroyWeak(v51);
    objc_destroyWeak(buf);
LABEL_16:
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __112__HMDHome__writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler_activity___block_invoke(uint64_t a1, int a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      if (a2)
      {
        v11 = @"Allowing";
      }

      else
      {
        v11 = @"Denying";
      }

      v12 = *(a1 + 88);
      v13 = NSStringFromBOOL();
      v14 = *(a1 + 72);
      v22 = 138544386;
      v23 = v10;
      v24 = 2112;
      v25 = v11;
      v26 = 2112;
      v27 = v13;
      v28 = 2048;
      v29 = v14;
      v30 = 2112;
      v31 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ characteristic write passcode=%@, source=%lu : %@", &v22, 0x34u);
    }

    objc_autoreleasePoolPop(v7);
    if (a2)
    {
      [(HMDHome *)v8 _performAllowedWriteCharacteristicValues:*(a1 + 72) source:*(a1 + 48) identifier:*(a1 + 80) qualityOfService:*(a1 + 56) withCompletionHandler:*(a1 + 32) activity:?];
    }

    else
    {
      v20 = *(a1 + 56);
      if (v20)
      {
        (*(v20 + 16))(v20, v5, 0);
      }

      [*(a1 + 32) end];
    }
  }

  else
  {
    v15 = *(a1 + 56);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
      (*(v15 + 16))(v15, v16, 0);
    }

    v17 = objc_autoreleasePoolPush();
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform write request", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_performAllowedWriteCharacteristicValues:(uint64_t)values source:(void *)source identifier:(uint64_t)identifier qualityOfService:(void *)service withCompletionHandler:(void *)handler activity:
{
  v38[2] = *MEMORY[0x277D85DE8];
  v30 = a2;
  sourceCopy = source;
  serviceCopy = service;
  handlerCopy = handler;
  v37[0] = @"sourceType";
  v16 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:values];
  v37[1] = @"kMultiPartResponseKey";
  v38[0] = v16;
  v38[1] = MEMORY[0x277CBEC38];
  v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:v37 count:2];

  v18 = objc_alloc(MEMORY[0x277D0F848]);
  allMessageDestinations = [MEMORY[0x277D0F820] allMessageDestinations];
  v20 = [v18 initWithName:@"kMultipleCharacteristicWriteRequestKey" qualityOfService:identifier destination:allMessageDestinations payload:v17];

  [v20 setIdentifier:sourceCopy];
  v21 = objc_autoreleasePoolPush();
  selfCopy = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
  {
    v29 = sourceCopy;
    v24 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    identifier = [v20 identifier];

    if (identifier)
    {
      identifier2 = [v20 identifier];
      [identifier2 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v31 = *buf;
    v27 = HMDRequestSourceAsString(values);
    *buf = 138544130;
    *&buf[4] = v24;
    *&buf[12] = 1042;
    *&buf[14] = 16;
    v33 = 2098;
    v34 = &v31;
    v35 = 2114;
    v36 = v27;
    _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Performing allowed write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);

    sourceCopy = v29;
  }

  objc_autoreleasePoolPop(v21);
  [selfCopy _writeCharacteristicValues:v30 requestMessage:v20 source:values biomeSource:0 withCompletionHandler:serviceCopy];
  [handlerCopy end];

  v28 = *MEMORY[0x277D85DE8];
}

- (void)writeCharacteristicValues:(id)values message:(id)message withCompletionHandler:(id)handler
{
  handlerCopy = handler;
  messageCopy = message;
  valuesCopy = values;
  source = [messageCopy source];
  identifier = [messageCopy identifier];
  -[HMDHome writeCharacteristicValues:source:message:identifier:qualityOfService:withCompletionHandler:](self, "writeCharacteristicValues:source:message:identifier:qualityOfService:withCompletionHandler:", valuesCopy, source, messageCopy, identifier, [messageCopy qualityOfService], handlerCopy);
}

- (void)_handleMatterLockChangedCharacteristics:(id)characteristics message:(id)message remoteRequest:(BOOL)request
{
  v30 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  messageCopy = message;
  primaryResident = [(HMDHome *)self primaryResident];
  isCurrentDevice = [primaryResident isCurrentDevice];

  if (isCurrentDevice)
  {
    name = [messageCopy name];
    if ([name isEqualToString:@"kMultipleCharacteristicReadRequestKey"])
    {
    }

    else
    {
      name2 = [messageCopy name];
      v21 = [name2 isEqualToString:@"kCharacteristicReadRequestKey"];

      if (!v21)
      {
        v23[0] = MEMORY[0x277D85DD0];
        v23[1] = 3221225472;
        v23[2] = __73__HMDHome__handleMatterLockChangedCharacteristics_message_remoteRequest___block_invoke;
        v23[3] = &unk_2786762A0;
        v23[4] = self;
        v24 = messageCopy;
        requestCopy = request;
        [characteristicsCopy na_each:v23];

        goto LABEL_11;
      }
    }

    v13 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v16;
      v28 = 2112;
      v29 = messageCopy;
      v17 = "%{public}@_handleMatterLockChangedCharacteristics: We are seeing characteristics changed, but from a characteristic read request. These values have not just actually changed, so we should not show a bulletin. message=%@";
      v18 = v15;
      v19 = 22;
      goto LABEL_9;
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543362;
      v27 = v16;
      v17 = "%{public}@Not handling Matter lock changed characteristic notification because this device is not the primary resident.";
      v18 = v15;
      v19 = 12;
LABEL_9:
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, v17, buf, v19);
    }
  }

  objc_autoreleasePoolPop(v13);
LABEL_11:

  v22 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome__handleMatterLockChangedCharacteristics_message_remoteRequest___block_invoke(uint64_t a1, void *a2)
{
  v84 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 accessory];
  if ([v4 supportsCHIP])
  {
    v5 = [v4 findServiceWithServiceType:*MEMORY[0x277CD0EB0]];

    if (v5)
    {
      v6 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
      v7 = objc_autoreleasePoolPush();
      v8 = *(a1 + 32);
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        v11 = [v6 UUID];
        v12 = [v4 uuid];
        v13 = v12;
        v14 = *(a1 + 40);
        v15 = *(a1 + 48);
        *buf = 138544642;
        if (v15)
        {
          v16 = @"YES";
        }

        else
        {
          v16 = @"NO";
        }

        v73 = v10;
        v74 = 2112;
        v75 = v11;
        v76 = 2112;
        v77 = v12;
        v78 = 2112;
        v79 = v3;
        v80 = 2112;
        v81 = v14;
        v82 = 2112;
        v83 = v16;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Lock Notifications}] _handleMatterLockChangedCharacteristics: Matter lock characteristic changed, preparing to populate bulletin for accessory=%@ characteristic=%@ message=%@ remoteRequest=%@", buf, 0x3Eu);
      }

      objc_autoreleasePoolPop(v7);
      v17 = [v3 value];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v18 = v17;
      }

      else
      {
        v18 = 0;
      }

      v19 = v18;

      if (v19)
      {
        v20 = [v19 integerValue];
        if (!v20)
        {
          v21 = &unk_283E71AC8;
LABEL_18:
          v67 = v21;
          if (*(a1 + 48) != 1)
          {
            v40 = 0;
LABEL_36:
            v66 = v19;
            v71 = v6;
            v52 = objc_autoreleasePoolPush();
            v53 = *(a1 + 32);
            v54 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v54, OS_LOG_TYPE_INFO))
            {
              v55 = HMFGetLogIdentifier();
              [v71 UUID];
              v56 = v62 = v52;
              v57 = [v40 uuid];
              v58 = [v4 uuid];
              *buf = 138544386;
              v73 = v55;
              v74 = 2112;
              v75 = v56;
              v76 = 2112;
              v77 = v57;
              v78 = 2112;
              v79 = v67;
              v80 = 2112;
              v81 = v58;
              _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Handling changed matter lock characteristic (For notifications- HMDHome path) with userUUID=%@ operationType=%@ accessory=%@", buf, 0x34u);

              v52 = v62;
            }

            objc_autoreleasePoolPop(v52);
            v59 = [*(a1 + 32) lockNotificationManager];
            v60 = [MEMORY[0x277CBEAA8] now];
            [v59 sendLockOperationEventNotification:v40 userUniqueID:0 lockOperationType:v67 lockOperationSource:&unk_283E71AF8 fabricIndex:0 accessory:v4 timestamp:v60 flow:v71];

            v6 = v71;
            v19 = v66;
            goto LABEL_39;
          }

          v31 = [*(a1 + 40) remoteSourceDevice];
          v32 = [v31 productInfo];
          v33 = [v32 productClass];

          if (v33)
          {
            if ((v33 & 0xFFFFFFFFFFFFFFFDLL) == 4)
            {
              v68 = v31;
              v34 = objc_autoreleasePoolPush();
              v35 = *(a1 + 32);
              v36 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
              {
                HMFGetLogIdentifier();
                v37 = v63 = v34;
                v38 = [v6 UUID];
                v39 = HMFProductClassToString();
                *buf = 138543874;
                v73 = v37;
                v74 = 2112;
                v75 = v38;
                v76 = 2112;
                v77 = v39;
                _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Product class for this request is %@, which is either a HomePod or ATV, so we should not try to attribute a user to this request.", buf, 0x20u);

                v34 = v63;
              }

              objc_autoreleasePoolPop(v34);
              v40 = 0;
              v31 = v68;
LABEL_35:

              goto LABEL_36;
            }
          }

          else
          {
            v41 = objc_autoreleasePoolPush();
            v42 = *(a1 + 32);
            v43 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
            {
              HMFGetLogIdentifier();
              v44 = v64 = v41;
              [v6 UUID];
              v45 = v69 = v31;
              *buf = 138543618;
              v73 = v44;
              v74 = 2112;
              v75 = v45;
              _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Cannot determine product class for this request.", buf, 0x16u);

              v31 = v69;
              v41 = v64;
            }

            objc_autoreleasePoolPop(v41);
          }

          v46 = objc_autoreleasePoolPush();
          v47 = *(a1 + 32);
          v48 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v49 = v65 = v46;
            [v6 UUID];
            v50 = v70 = v31;
            v51 = HMFProductClassToString();
            *buf = 138543874;
            v73 = v49;
            v74 = 2112;
            v75 = v50;
            v76 = 2112;
            v77 = v51;
            _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Product class for this request is %@, which is not a HomePod or ATV, so we can try to attribute a user to this request.", buf, 0x20u);

            v31 = v70;
            v46 = v65;
          }

          objc_autoreleasePoolPop(v46);
          v40 = [*(a1 + 40) userForHome:*(a1 + 32)];
          goto LABEL_35;
        }

        if (v20 == 1)
        {
          v21 = &unk_283E71AE0;
          goto LABEL_18;
        }

        v22 = objc_autoreleasePoolPush();
        v23 = *(a1 + 32);
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          v26 = [v6 UUID];
          v27 = [v4 uuid];
          *buf = 138544130;
          v73 = v25;
          v74 = 2112;
          v75 = v26;
          v76 = 2112;
          v77 = v19;
          v78 = 2112;
          v79 = v27;
          v28 = "%{public}@[Flow: %@] Error retrieving characteristic value from characteristic. Value should be either 0 or 1, value=%@. accessoryUUID=%@";
          v29 = v24;
          v30 = 42;
          goto LABEL_27;
        }
      }

      else
      {
        v22 = objc_autoreleasePoolPush();
        v23 = *(a1 + 32);
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          v26 = [v6 UUID];
          v27 = [v4 uuid];
          *buf = 138543874;
          v73 = v25;
          v74 = 2112;
          v75 = v26;
          v76 = 2112;
          v77 = v27;
          v28 = "%{public}@[Flow: %@] Error retrieving characteristic value from characteristic. Value is not an NSNumber. accessoryUUID=%@";
          v29 = v24;
          v30 = 32;
LABEL_27:
          _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, v28, buf, v30);
        }
      }

      objc_autoreleasePoolPop(v22);
LABEL_39:
    }
  }

  v61 = *MEMORY[0x277D85DE8];
}

void __131__HMDHome__notifyChangedCharacteristics_identifier_multiPartResponse_moreMessagesInMultipart_requestMessage_withCompletionHandler___block_invoke(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  if (v2)
  {
    v3 = v2;
    (*(v2 + 2))(v2, 0, *(a1 + 32));
    v2 = v3;
  }
}

- (void)_sendClientCharacteristicsChangedNotificationWithIdentifier:(id)identifier requestMessage:(id)message multiPartResponse:(BOOL)response moreInMultiPartResponse:(BOOL)partResponse characteristicChanges:(id)changes completionHandler:(id)handler
{
  partResponseCopy = partResponse;
  responseCopy = response;
  v84 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  messageCopy = message;
  changesCopy = changes;
  handlerCopy = handler;
  v57 = changesCopy;
  characteristicUpdatesForAllClients = [changesCopy characteristicUpdatesForAllClients];
  if (responseCopy)
  {
    v14 = [MEMORY[0x277CCABB0] numberWithBool:partResponseCopy];
    v52 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:characteristicUpdatesForAllClients moreMessagesInMultipart:v14];
  }

  else
  {
    v52 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:characteristicUpdatesForAllClients moreMessagesInMultipart:0];
  }

  if ([v57 hasEntitledClientOnlyChanges])
  {
    characteristicUpdatesForEntitledClients = [v57 characteristicUpdatesForEntitledClients];
    if (responseCopy)
    {
      v16 = [MEMORY[0x277CCABB0] numberWithBool:partResponseCopy];
      v17 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:characteristicUpdatesForEntitledClients moreMessagesInMultipart:v16];
    }

    else
    {
      v17 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:characteristicUpdatesForEntitledClients moreMessagesInMultipart:0];
    }

    v51 = [HMDCharacteristicResponseNotificationContext updateLastSeenStatusDataForResponsePayload:v17 home:self isRemote:0 isNotification:1];
  }

  else
  {
    v51 = 0;
  }

  proxyConnection = [messageCopy proxyConnection];
  orderedSet = [MEMORY[0x277CBEB40] orderedSet];
  if (proxyConnection)
  {
    [orderedSet addObject:proxyConnection];
  }

  if ([characteristicUpdatesForAllClients count] || objc_msgSend(v57, "hasEntitledClientOnlyChanges"))
  {
    dataSource = [(HMDHome *)self dataSource];
    xpcMessageTransport = [dataSource xpcMessageTransport];
    connections = [xpcMessageTransport connections];
    [orderedSet addObjectsFromArray:connections];
  }

  if ([messageCopy qualityOfService] < 17)
  {
    qualityOfService = 17;
  }

  else
  {
    qualityOfService = [messageCopy qualityOfService];
  }

  v23 = objc_alloc(MEMORY[0x277D0F820]);
  uuid = [(HMDHome *)self uuid];
  v25 = [v23 initWithTarget:uuid];

  v50 = v25;
  v26 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"kMultipleCharacteristicValuesUpdatedNotificationKey" qualityOfService:qualityOfService destination:v25 payload:0];
  v27 = v26;
  if (identifierCopy)
  {
    [v26 setIdentifier:?];
  }

  v28 = objc_autoreleasePoolPush();
  selfCopy = self;
  v30 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
  {
    v31 = HMFGetLogIdentifier();
    v32 = [orderedSet count];
    *buf = 0;
    *&buf[8] = 0;
    identifier = [v27 identifier];

    if (identifier)
    {
      identifier2 = [v27 identifier];
      [identifier2 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v71 = *buf;
    v35 = [characteristicUpdatesForAllClients count] != 0;
    hasEntitledClientOnlyChanges = [v57 hasEntitledClientOnlyChanges];
    *buf = 138545154;
    *&buf[4] = v31;
    *&buf[12] = 2048;
    *&buf[14] = v32;
    *&buf[22] = 1040;
    v73 = 16;
    v74 = 2096;
    v75 = &v71;
    v76 = 1024;
    v77 = v35;
    v78 = 1024;
    v79 = hasEntitledClientOnlyChanges;
    v80 = 1024;
    v81 = responseCopy;
    v82 = 1024;
    v83 = partResponseCopy;
    _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Notifying %ld clients of characteristic changes with message identifier: %{uuid_t}.16P, allClients: %{BOOL}d, entitledClients: %{BOOL}d, multiPartResponse: %{BOOL}d, moreMessagesInMultipartResponse: %{BOOL}d", buf, 0x3Eu);
  }

  objc_autoreleasePoolPop(v28);
  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x2020000000;
  LOBYTE(v73) = handlerCopy != 0;
  v37 = dispatch_group_create();
  array = [orderedSet array];
  v62[0] = MEMORY[0x277D85DD0];
  v62[1] = 3221225472;
  v62[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke;
  v62[3] = &unk_278670510;
  v39 = v51;
  v63 = v39;
  v40 = v27;
  v64 = v40;
  v41 = v52;
  v65 = v41;
  v42 = proxyConnection;
  v66 = v42;
  v69 = buf;
  v70 = 34305;
  v43 = v37;
  v67 = v43;
  v44 = handlerCopy;
  v68 = v44;
  [array na_each:v62];

  reportingSessionManager = [(HMDHome *)selfCopy reportingSessionManager];
  messagePayload = [v40 messagePayload];
  identifier3 = [v40 identifier];
  [reportingSessionManager addResponseMessagePayload:messagePayload toSessionWithUUID:identifier3];

  if (*(*&buf[8] + 24) == 1)
  {
    workQueue = [(HMDHome *)selfCopy workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_3;
    block[3] = &unk_278688B80;
    v61 = v44;
    dispatch_group_notify(v43, workQueue, block);
  }

  _Block_object_dispose(buf, 8);
  v49 = *MEMORY[0x277D85DE8];
}

void __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = v3;
  v5 = (a1 + 32);
  if (*(a1 + 32) && ([v3 isEntitledForSPIAccess] & 1) != 0)
  {
    v6 = 1;
    v7 = 5;
  }

  else
  {
    v6 = 0;
    v5 = (a1 + 48);
    v7 = 1;
  }

  [*(a1 + 40) setMessagePayload:*v5];
  [*(a1 + 40) setRequiresSPIEntitlement:v6];
  if (*(a1 + 56) == v4)
  {
    *(*(*(a1 + 80) + 8) + 24) = 0;
  }

  else
  {
    [*(a1 + 40) setQualityOfService:17];
    v8 = [[HMDHomeManagerXPCMessageSendPolicy alloc] initWithEntitlements:v7 options:*(a1 + 88) active:1];
    [*(a1 + 40) setSendPolicy:v8];
  }

  dispatch_group_enter(*(a1 + 64));
  v9 = [*(a1 + 40) copy];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_2;
  v11[3] = &unk_27868A528;
  v12 = v4;
  v13 = *(a1 + 56);
  v15 = *(a1 + 72);
  v14 = *(a1 + 64);
  v10 = v4;
  [v10 sendMessage:v9 completionHandler:v11];
}

void __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v4 = a2;
  if (*(a1 + 32) == *(a1 + 40))
  {
    v3 = *(a1 + 56);
    if (v3)
    {
      (*(v3 + 16))();
    }
  }

  dispatch_group_leave(*(a1 + 48));
}

- (void)notifyRemoteUsersOfChangedCharacteristics:(id)characteristics message:(id)message broadcast:(BOOL)broadcast
{
  characteristicsCopy = characteristics;
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __71__HMDHome_notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke;
  v13[3] = &unk_278685AA8;
  v13[4] = self;
  v14 = characteristicsCopy;
  v15 = messageCopy;
  broadcastCopy = broadcast;
  v11 = messageCopy;
  v12 = characteristicsCopy;
  dispatch_async(workQueue, v13);
}

- (void)notifyOfChangedCharacteristic:(id)characteristic changedByThisDevice:(BOOL)device residentShouldNotifyPeers:(BOOL)peers message:(id)message
{
  characteristicCopy = characteristic;
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __95__HMDHome_notifyOfChangedCharacteristic_changedByThisDevice_residentShouldNotifyPeers_message___block_invoke;
  v15[3] = &unk_278684B18;
  v15[4] = self;
  v16 = characteristicCopy;
  deviceCopy = device;
  peersCopy = peers;
  v17 = messageCopy;
  v13 = messageCopy;
  v14 = characteristicCopy;
  dispatch_async(workQueue, v15);
}

void __95__HMDHome_notifyOfChangedCharacteristic_changedByThisDevice_residentShouldNotifyPeers_message___block_invoke(uint64_t a1)
{
  v6[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v6[0] = *(a1 + 40);
  v3 = [MEMORY[0x277CBEA60] arrayWithObjects:v6 count:1];
  LOBYTE(v5) = 0;
  [v2 _postInternalNotificationForChangedCharacteristics:v3 previouslyNilChangedCharacteristics:MEMORY[0x277CBEBF8] modifiedCharacteristics:0 changedByThisDevice:*(a1 + 56) residentShouldNotifyPeers:*(a1 + 57) message:*(a1 + 48) broadcast:v5];

  v4 = *MEMORY[0x277D85DE8];
}

- (void)_postInternalNotificationForChangedCharacteristics:(id)characteristics previouslyNilChangedCharacteristics:(id)changedCharacteristics modifiedCharacteristics:(id)modifiedCharacteristics changedByThisDevice:(BOOL)device residentShouldNotifyPeers:(BOOL)peers message:(id)message broadcast:(BOOL)broadcast
{
  peersCopy = peers;
  deviceCopy = device;
  v159 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  changedCharacteristicsCopy = changedCharacteristics;
  modifiedCharacteristicsCopy = modifiedCharacteristics;
  messageCopy = message;
  v15 = objc_autoreleasePoolPush();
  selfCopy = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    shortDescription = [messageCopy shortDescription];
    *buf = 138544642;
    v150 = v18;
    v151 = 1024;
    *v152 = deviceCopy;
    *&v152[4] = 1024;
    *&v152[6] = peersCopy;
    v153 = 1024;
    broadcastCopy = broadcast;
    v155 = 2112;
    v156 = characteristicsCopy;
    v157 = 2112;
    v158 = shortDescription;
    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Posting internal notification and notifying remote users with changedByThisDevice: %{BOOL}d residentShouldNotifyPeers: %{BOOL}d broadcast: %{BOOL}d about changed characteristics: %@ message: %@ ", buf, 0x32u);
  }

  objc_autoreleasePoolPop(v15);
  v20 = messageCopy;
  if (![characteristicsCopy count] && !objc_msgSend(changedCharacteristicsCopy, "count"))
  {
    goto LABEL_95;
  }

  v21 = [messageCopy dictionaryForKey:@"kPresenceDictionaryForNotificationKey"];
  v22 = [messageCopy dictionaryForKey:@"kPresencePairingIdentifierDictionaryForNotificationKey"];
  v144[0] = MEMORY[0x277D85DD0];
  v144[1] = 3221225472;
  v144[2] = __186__HMDHome__postInternalNotificationForChangedCharacteristics_previouslyNilChangedCharacteristics_modifiedCharacteristics_changedByThisDevice_residentShouldNotifyPeers_message_broadcast___block_invoke;
  v144[3] = &unk_278687EB0;
  v144[4] = selfCopy;
  v23 = [characteristicsCopy na_filter:v144];
  name = [messageCopy name];
  v25 = [name isEqual:@"kCharacterisiticsChangedInternalNotificationKey"];

  accessoryBulletinNotificationManager = [(HMDHome *)selfCopy accessoryBulletinNotificationManager];
  v108 = v23;
  v27 = [accessoryBulletinNotificationManager bulletinCharacteristicsFromChangedCharacteristics:v23 message:messageCopy];

  v119 = selfCopy;
  v115 = v22;
  v116 = v21;
  v114 = v27;
  if (!v27)
  {
    if (v22)
    {
      v28 = [[HMDHomePresenceRemote alloc] initWithPresenceByPairingIdentity:v22];
    }

    else
    {
      if (!v21)
      {
        v29 = 0;
        goto LABEL_12;
      }

      v28 = [[HMDHomePresenceRemote alloc] initWithPresenceByUserId:v21];
    }

    v29 = v28;
LABEL_12:
    localCapabilitiesDataSource = [(HMDHome *)selfCopy localCapabilitiesDataSource];
    supportsBulletinBoard = [localCapabilitiesDataSource supportsBulletinBoard];

    if (supportsBulletinBoard)
    {
      v140[0] = MEMORY[0x277D85DD0];
      v140[1] = 3221225472;
      v140[2] = __186__HMDHome__postInternalNotificationForChangedCharacteristics_previouslyNilChangedCharacteristics_modifiedCharacteristics_changedByThisDevice_residentShouldNotifyPeers_message_broadcast___block_invoke_2;
      v140[3] = &unk_2786704E8;
      v140[4] = selfCopy;
      v141 = modifiedCharacteristicsCopy;
      v142 = deviceCopy;
      v143 = v25;
      [(HMDHome *)selfCopy evaluateNotificationConditionForCharacteristics:v108 homePresence:v29 completion:v140];
    }

    goto LABEL_15;
  }

  [(HMDHome *)selfCopy _updateBulletinBoardOfChangedCharacteristics:v27 modifiedCharacteristics:modifiedCharacteristicsCopy changedByThisDevice:deviceCopy changeNotificationFromPrimary:v25];
LABEL_15:
  v106 = peersCopy;
  weakToStrongObjectsMapTable = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
  v136 = 0u;
  v137 = 0u;
  v138 = 0u;
  v139 = 0u;
  v107 = characteristicsCopy;
  obj = characteristicsCopy;
  v32 = [obj countByEnumeratingWithState:&v136 objects:v148 count:16];
  if (v32)
  {
    v33 = v32;
    v34 = *v137;
    do
    {
      for (i = 0; i != v33; ++i)
      {
        if (*v137 != v34)
        {
          objc_enumerationMutation(obj);
        }

        v36 = *(*(&v136 + 1) + 8 * i);
        accessory = [v36 accessory];
        if (accessory)
        {
          v38 = [weakToStrongObjectsMapTable objectForKey:accessory];
          if (!v38)
          {
            v38 = [MEMORY[0x277CBEB58] set];
            [weakToStrongObjectsMapTable setObject:v38 forKey:accessory];
          }

          [v38 addObject:v36];
          v39 = [[HMDHAPAccessoryNotificationEvent alloc] initWithAccessory:accessory characteristic:v36];
          logEventSubmitter = [(HMDHome *)v119 logEventSubmitter];
          [logEventSubmitter submitLogEvent:v39 error:0];
        }
      }

      v33 = [obj countByEnumeratingWithState:&v136 objects:v148 count:16];
    }

    while (v33);
  }

  weakToStrongObjectsMapTable2 = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
  v132 = 0u;
  v133 = 0u;
  v134 = 0u;
  v135 = 0u;
  v41 = changedCharacteristicsCopy;
  v42 = [v41 countByEnumeratingWithState:&v132 objects:v147 count:16];
  if (v42)
  {
    v43 = v42;
    v44 = *v133;
    do
    {
      for (j = 0; j != v43; ++j)
      {
        if (*v133 != v44)
        {
          objc_enumerationMutation(v41);
        }

        v46 = *(*(&v132 + 1) + 8 * j);
        accessory2 = [v46 accessory];
        if (accessory2)
        {
          v48 = [weakToStrongObjectsMapTable2 objectForKey:accessory2];
          if (!v48)
          {
            v48 = [MEMORY[0x277CBEB58] set];
            [weakToStrongObjectsMapTable2 setObject:v48 forKey:accessory2];
          }

          [v48 addObject:v46];
        }
      }

      v43 = [v41 countByEnumeratingWithState:&v132 objects:v147 count:16];
    }

    while (v43);
  }

  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v128 = 0u;
  v129 = 0u;
  v130 = 0u;
  v131 = 0u;
  v49 = v114;
  v50 = [v49 countByEnumeratingWithState:&v128 objects:v146 count:16];
  v51 = v119;
  if (v50)
  {
    v52 = v50;
    v53 = *v129;
    do
    {
      for (k = 0; k != v52; ++k)
      {
        if (*v129 != v53)
        {
          objc_enumerationMutation(v49);
        }

        v55 = *(*(&v128 + 1) + 8 * k);
        accessory3 = [v55 accessory];
        v57 = accessory3;
        if (accessory3)
        {
          uuid = [accessory3 uuid];
          v59 = [dictionary objectForKeyedSubscript:uuid];
          if (!v59)
          {
            v59 = [MEMORY[0x277CBEB58] set];
            [dictionary setObject:v59 forKeyedSubscript:uuid];
          }

          [v59 addObject:v55];
        }
      }

      v52 = [v49 countByEnumeratingWithState:&v128 objects:v146 count:16];
    }

    while (v52);
  }

  v105 = v49;

  v60 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(weakToStrongObjectsMapTable2, "count") + objc_msgSend(weakToStrongObjectsMapTable, "count")}];
  hm_allKeys = [weakToStrongObjectsMapTable hm_allKeys];
  [v60 addObjectsFromArray:hm_allKeys];

  hm_allKeys2 = [weakToStrongObjectsMapTable2 hm_allKeys];
  [v60 addObjectsFromArray:hm_allKeys2];

  v126 = 0u;
  v127 = 0u;
  v124 = 0u;
  v125 = 0u;
  v112 = v60;
  v20 = messageCopy;
  v118 = [v112 countByEnumeratingWithState:&v124 objects:v145 count:16];
  if (v118)
  {
    v63 = MEMORY[0x277CBEBF8];
    v113 = *v125;
    do
    {
      for (m = 0; m != v118; ++m)
      {
        if (*v125 != v113)
        {
          objc_enumerationMutation(v112);
        }

        v65 = *(*(&v124 + 1) + 8 * m);
        dictionary2 = [MEMORY[0x277CBEB38] dictionary];
        v67 = [weakToStrongObjectsMapTable objectForKey:v65];
        allObjects = [v67 allObjects];
        v69 = allObjects;
        if (allObjects)
        {
          v70 = allObjects;
        }

        else
        {
          v70 = v63;
        }

        [dictionary2 setObject:v70 forKeyedSubscript:@"kModifiedCharacteristicsKey"];

        v71 = [weakToStrongObjectsMapTable2 objectForKey:v65];
        allObjects2 = [v71 allObjects];
        v73 = allObjects2;
        if (allObjects2)
        {
          v74 = allObjects2;
        }

        else
        {
          v74 = v63;
        }

        [dictionary2 setObject:v74 forKeyedSubscript:@"HMDModifiedPreviouslyNilValuedCharacteristicsKey"];

        if (v114)
        {
          uuid2 = [v65 uuid];
          v76 = [dictionary objectForKeyedSubscript:uuid2];

          allObjects3 = [v76 allObjects];
          v78 = allObjects3;
          if (allObjects3)
          {
            v79 = allObjects3;
          }

          else
          {
            v79 = v63;
          }

          [dictionary2 setObject:v79 forKeyedSubscript:@"kCharacteristicsToShowBulletinsKey"];
        }

        else
        {
          v80 = objc_autoreleasePoolPush();
          v81 = v51;
          v82 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
          {
            v83 = HMFGetLogIdentifier();
            *buf = 138543362;
            v150 = v83;
            _os_log_impl(&dword_229538000, v82, OS_LOG_TYPE_INFO, "%{public}@Not inserting HMDCharacteristicsToShowBulletinsKey, had to fall back to legacy evaluation", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v80);
        }

        v20 = messageCopy;
        if (messageCopy)
        {
          name2 = [messageCopy name];
          if ([name2 isEqualToString:@"kCharacterisiticsChangedInternalNotificationKey"])
          {
            goto LABEL_82;
          }

          name3 = [messageCopy name];
          if ([name3 isEqualToString:@"kMultipleCharacteristicReadRequestKey"])
          {
            v51 = v119;
LABEL_81:

            v20 = messageCopy;
LABEL_82:

            goto LABEL_83;
          }

          name4 = [messageCopy name];
          v92 = [name4 isEqualToString:@"kCharacteristicReadRequestKey"];

          v20 = messageCopy;
          v51 = v119;
          if ((v92 & 1) == 0)
          {
            v93 = objc_autoreleasePoolPush();
            v94 = v119;
            v95 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v95, OS_LOG_TYPE_DEBUG))
            {
              v96 = HMFGetLogIdentifier();
              *buf = 138543618;
              v150 = v96;
              v151 = 2112;
              *v152 = messageCopy;
              _os_log_impl(&dword_229538000, v95, OS_LOG_TYPE_DEBUG, "%{public}@Adding user context to changed characteristics notification using message: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v93);
            v20 = messageCopy;
            name2 = [messageCopy userForHome:v94];
            if (name2)
            {
              goto LABEL_80;
            }
          }
        }

        else if (deviceCopy)
        {
          v86 = objc_autoreleasePoolPush();
          v87 = v51;
          v88 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v88, OS_LOG_TYPE_DEBUG))
          {
            v89 = HMFGetLogIdentifier();
            currentUser = [(HMDHome *)v87 currentUser];
            *buf = 138543618;
            v150 = v89;
            v151 = 2112;
            *v152 = currentUser;
            _os_log_impl(&dword_229538000, v88, OS_LOG_TYPE_DEBUG, "%{public}@Adding user context to changed characteristics notification using currentUser: %@", buf, 0x16u);

            v51 = v119;
          }

          objc_autoreleasePoolPop(v86);
          name2 = [(HMDHome *)v87 currentUser];
          v20 = 0;
          if (name2)
          {
LABEL_80:
            name3 = [name2 uuid];
            [dictionary2 setObject:name3 forKeyedSubscript:@"kUserUUIDKey"];
            goto LABEL_81;
          }
        }

LABEL_83:
        v97 = [v20 uuidForKey:@"kMessageUserOverrideKey"];
        if (v97)
        {
          [dictionary2 setObject:v97 forKeyedSubscript:@"kMessageUserOverrideKey"];
        }

        if (v20)
        {
          v98 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{+[HMDHome sanitizedOriginalSourceForMessage:](HMDHome, v20)}];
          [dictionary2 setObject:v98 forKeyedSubscript:@"kMessageSourceForNotificationKey"];
        }

        [dictionary2 setObject:modifiedCharacteristicsCopy forKeyedSubscript:@"kModifiedCharacteristicsMapKey"];
        [dictionary2 setObject:v116 forKeyedSubscript:@"kPresenceDictionaryForNotificationKey"];
        [dictionary2 setObject:v115 forKeyedSubscript:@"kPresencePairingIdentifierDictionaryForNotificationKey"];
        v99 = [dictionary2 copy];
        logAndPostNotification(@"HMDAccessoryCharacteristicsChangedNotification", v65, v99);

        v63 = MEMORY[0x277CBEBF8];
      }

      v118 = [v112 countByEnumeratingWithState:&v124 objects:v145 count:16];
    }

    while (v118);
  }

  characteristicsCopy = v107;
  if (v106 && [(HMDHome *)v51 shouldRelayNotificationToRegisteredDevicesForSource:v20])
  {
    v100 = objc_autoreleasePoolPush();
    v101 = v51;
    v102 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v102, OS_LOG_TYPE_INFO))
    {
      v103 = HMFGetLogIdentifier();
      *buf = 138543362;
      v150 = v103;
      _os_log_impl(&dword_229538000, v102, OS_LOG_TYPE_INFO, "%{public}@Posting notification to remote users since this is a resident device or is paired with a watch", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v100);
    v20 = messageCopy;
    [(HMDHome *)v101 notifyRemoteUsersOfChangedCharacteristics:obj message:messageCopy broadcast:broadcast];
  }

LABEL_95:
  v104 = *MEMORY[0x277D85DE8];
}

- (id)_disablePayloadFromRemotelyUpdatedCharacteristicNotifications:(id)notifications
{
  v59 = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    v52 = 0u;
    v53 = 0u;
    v54 = 0u;
    v55 = 0u;
    obj = [notificationsCopy allKeys];
    v5 = [obj countByEnumeratingWithState:&v52 objects:v58 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v53;
      v8 = 0x277CBE000uLL;
      v9 = 0x277CCA000uLL;
      selfCopy = self;
      v36 = notificationsCopy;
      v34 = *v53;
      do
      {
        v10 = 0;
        v37 = v6;
        do
        {
          if (*v53 != v7)
          {
            objc_enumerationMutation(obj);
          }

          v40 = v10;
          v11 = *(*(&v52 + 1) + 8 * v10);
          array = [*(v8 + 2840) array];
          v43 = [notificationsCopy hmf_dictionaryForKey:v11];
          v41 = [objc_alloc(*(v9 + 3448)) initWithUUIDString:v11];
          v13 = [(HMDHome *)self accessoryWithUUID:?];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v14 = v13;
          }

          else
          {
            v14 = 0;
          }

          v15 = v14;

          if (v15 && ([v15 hasBTLELink] & 1) == 0 && objc_msgSend(v15, "hasIPLink"))
          {
            v38 = v15;
            v50 = 0u;
            v51 = 0u;
            v48 = 0u;
            v49 = 0u;
            allKeys = [v43 allKeys];
            v16 = [allKeys countByEnumeratingWithState:&v48 objects:v57 count:16];
            if (v16)
            {
              v17 = v16;
              v18 = *v49;
              do
              {
                for (i = 0; i != v17; ++i)
                {
                  if (*v49 != v18)
                  {
                    objc_enumerationMutation(allKeys);
                  }

                  v20 = [v43 hmf_dictionaryForKey:*(*(&v48 + 1) + 8 * i)];
                  v44 = 0u;
                  v45 = 0u;
                  v46 = 0u;
                  v47 = 0u;
                  allKeys2 = [v20 allKeys];
                  v22 = [allKeys2 countByEnumeratingWithState:&v44 objects:v56 count:16];
                  if (v22)
                  {
                    v23 = v22;
                    v24 = *v45;
                    do
                    {
                      for (j = 0; j != v23; ++j)
                      {
                        if (*v45 != v24)
                        {
                          objc_enumerationMutation(allKeys2);
                        }

                        v26 = *(*(&v44 + 1) + 8 * j);
                        v27 = HAPInstanceIDFromValue();
                        if (v27)
                        {
                          [array addObject:v27];
                        }
                      }

                      v23 = [allKeys2 countByEnumeratingWithState:&v44 objects:v56 count:16];
                    }

                    while (v23);
                  }
                }

                v17 = [allKeys countByEnumeratingWithState:&v48 objects:v57 count:16];
              }

              while (v17);
            }

            self = selfCopy;
            notificationsCopy = v36;
            v7 = v34;
            v8 = 0x277CBE000;
            v9 = 0x277CCA000;
            v6 = v37;
            v15 = v38;
            if ([array count])
            {
              v28 = [array copy];
              uUIDString = [v41 UUIDString];
              [dictionary setObject:v28 forKeyedSubscript:uUIDString];

              v6 = v37;
              v15 = v38;
            }
          }

          v10 = v40 + 1;
        }

        while (v40 + 1 != v6);
        v6 = [obj countByEnumeratingWithState:&v52 objects:v58 count:16];
      }

      while (v6);
    }

    v30 = [dictionary copy];
  }

  else
  {
    v30 = MEMORY[0x277CBEC10];
  }

  v31 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_handleCharacteristicsChangedNotification:(id)notification
{
  v164 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  v112 = [notificationCopy dictionaryForKey:@"kCharacteristicNotificationsKey"];
  v113 = [notificationCopy stringForKey:@"kRequestIdentifierKey"];
  array = [MEMORY[0x277CBEB18] array];
  if (v113)
  {
    accessoryReaderWriter = [(HMDHome *)self accessoryReaderWriter];
    [accessoryReaderWriter handleRemotelyUpdatedCharacteristicsMessage:notificationCopy];

    v109 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v113];
    pendingResponses = [(HMDHome *)self pendingResponses];
    v122 = [pendingResponses objectForKeyedSubscript:v113];

    array2 = [MEMORY[0x277CBEB18] array];
    if (v122)
    {
      v150 = 0u;
      v151 = 0u;
      v148 = 0u;
      v149 = 0u;
      obj = [v112 allKeys];
      v108 = [obj countByEnumeratingWithState:&v148 objects:v163 count:16];
      if (v108)
      {
        v106 = *v149;
        do
        {
          v6 = 0;
          do
          {
            if (*v149 != v106)
            {
              v7 = v6;
              objc_enumerationMutation(obj);
              v6 = v7;
            }

            v107 = v6;
            v8 = *(*(&v148 + 1) + 8 * v6);
            v9 = [v112 objectForKeyedSubscript:v8];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v10 = v9;
            }

            else
            {
              v10 = 0;
            }

            v116 = v10;

            v111 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v8];
            v11 = [(HMDHome *)self accessoryWithUUID:v111];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v12 = v11;
            }

            else
            {
              v12 = 0;
            }

            v13 = v12;

            v146 = 0u;
            v147 = 0u;
            v144 = 0u;
            v145 = 0u;
            allKeys = [v116 allKeys];
            v118 = [allKeys countByEnumeratingWithState:&v144 objects:v162 count:16];
            if (v118)
            {
              v115 = *v145;
              do
              {
                v14 = 0;
                do
                {
                  if (*v145 != v115)
                  {
                    v15 = v14;
                    objc_enumerationMutation(allKeys);
                    v14 = v15;
                  }

                  v120 = v14;
                  v16 = [v116 objectForKeyedSubscript:*(*(&v144 + 1) + 8 * v14)];
                  objc_opt_class();
                  if (objc_opt_isKindOfClass())
                  {
                    v17 = v16;
                  }

                  else
                  {
                    v17 = 0;
                  }

                  v125 = v17;

                  v18 = HAPInstanceIDFromValue();
                  pendingResponseCount = [v122 pendingResponseCount];
                  if (pendingResponseCount >= [v125 count])
                  {
                    v21 = [v125 count];
                    v20 = [v122 pendingResponseCount] - v21;
                  }

                  else
                  {
                    v20 = 0;
                  }

                  [v122 setPendingResponseCount:v20];
                  v142 = 0u;
                  v143 = 0u;
                  v140 = 0u;
                  v141 = 0u;
                  allKeys2 = [v125 allKeys];
                  v23 = [allKeys2 countByEnumeratingWithState:&v140 objects:v161 count:16];
                  if (v23)
                  {
                    v24 = 0;
                    v25 = *v141;
                    do
                    {
                      v26 = 0;
                      v27 = v24;
                      do
                      {
                        if (*v141 != v25)
                        {
                          objc_enumerationMutation(allKeys2);
                        }

                        v28 = *(*(&v140 + 1) + 8 * v26);
                        v29 = HAPInstanceIDFromValue();
                        v24 = [v13 findCharacteristic:v29 forService:v18];

                        if (v24)
                        {
                          [array2 addObject:v24];
                          if ([v24 isNotificationEnabledForClientIdentifierPrefix:@"com.apple.HomeKitDaemon.Local"])
                          {
                            [array addObject:v24];
                          }
                        }

                        ++v26;
                        v27 = v24;
                      }

                      while (v23 != v26);
                      v23 = [allKeys2 countByEnumeratingWithState:&v140 objects:v161 count:16];
                    }

                    while (v23);
                  }

                  v14 = v120 + 1;
                }

                while (v120 + 1 != v118);
                v118 = [allKeys countByEnumeratingWithState:&v144 objects:v162 count:16];
              }

              while (v118);
            }

            v6 = v107 + 1;
          }

          while (v107 + 1 != v108);
          v108 = [obj countByEnumeratingWithState:&v148 objects:v163 count:16];
        }

        while (v108);
      }

      v30 = objc_autoreleasePoolPush();
      selfCopy = self;
      v32 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_DEBUG))
      {
        v33 = HMFGetLogIdentifier();
        *buf = 138543874;
        v156 = v33;
        v157 = 2112;
        v158 = v113;
        v159 = 2112;
        v160 = v112;
        _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_DEBUG, "%{public}@Notifying changes for requestIdentifier %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v30);
      v34 = objc_autoreleasePoolPush();
      v35 = [(HMDHome *)selfCopy _splitCharacteristicChanges:array2 changedAccessories:v112];
      requestMessage = [v122 requestMessage];
      [(HMDHome *)selfCopy _sendClientCharacteristicsChangedNotificationWithIdentifier:v109 requestMessage:requestMessage multiPartResponse:1 moreInMultiPartResponse:1 characteristicChanges:v35 completionHandler:0];

      objc_autoreleasePoolPop(v34);
    }

    v117 = MEMORY[0x277CBEBF8];
  }

  else
  {
    v138 = 0u;
    v139 = 0u;
    v136 = 0u;
    v137 = 0u;
    v37 = v112;
    v38 = [v37 countByEnumeratingWithState:&v136 objects:v154 count:16];
    if (v38)
    {
      v39 = *v137;
      do
      {
        for (i = 0; i != v38; ++i)
        {
          if (*v137 != v39)
          {
            objc_enumerationMutation(v37);
          }

          v41 = *(*(&v136 + 1) + 8 * i);
          objc_initWeak(buf, self);
          v42 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v41];
          v43 = [(HMDHome *)self accessoryWithUUID:v42];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v44 = v43;
          }

          else
          {
            v44 = 0;
          }

          v45 = v44;

          v46 = [v37 hmf_dictionaryForKey:v41];
          workQueue = [(HMDHome *)self workQueue];
          v133[0] = MEMORY[0x277D85DD0];
          v133[1] = 3221225472;
          v133[2] = __53__HMDHome__handleCharacteristicsChangedNotification___block_invoke;
          v133[3] = &unk_278670F98;
          objc_copyWeak(&v135, buf);
          v134 = notificationCopy;
          [v45 handleMultipleCharacteristicsUpdated:v46 message:v134 completionQueue:workQueue completionHandler:v133];

          objc_destroyWeak(&v135);
          objc_destroyWeak(buf);
        }

        v38 = [v37 countByEnumeratingWithState:&v136 objects:v154 count:16];
      }

      while (v38);
    }

    v117 = [(HMDHome *)self _unexpectedCharacteristicsFromCharacteristicNotifications:v37];
  }

  array3 = [MEMORY[0x277CBEB18] array];
  v121 = [notificationCopy dictionaryForKey:@"HMDDeviceNotificationActionSetsKey"];
  [HMDActionSetResponse responsesFromSerializedResponses:v121];
  v131 = 0u;
  v132 = 0u;
  v129 = 0u;
  v48 = v130 = 0u;
  v49 = [v48 countByEnumeratingWithState:&v129 objects:v153 count:16];
  if (v49)
  {
    v50 = *v130;
    do
    {
      for (j = 0; j != v49; ++j)
      {
        if (*v130 != v50)
        {
          objc_enumerationMutation(v48);
        }

        v52 = *(*(&v129 + 1) + 8 * j);
        actionSetUUID = [v52 actionSetUUID];
        v54 = [(HMDHome *)self actionSetWithUUID:actionSetUUID];

        if (v54)
        {
          actionSetStateSubscriptionManager = [(HMDHome *)self actionSetStateSubscriptionManager];
          uuid = [v54 uuid];
          v57 = [actionSetStateSubscriptionManager isMonitoringActionSet:uuid];

          if (v57)
          {
            actionSetStateSubscriptionManager2 = [(HMDHome *)self actionSetStateSubscriptionManager];
            actionSetUUID2 = [v52 actionSetUUID];
            [actionSetStateSubscriptionManager2 actionSetStateDidChange:actionSetUUID2 state:{objc_msgSend(v52, "state")}];
          }

          else
          {
            uuid2 = [v54 uuid];
            uUIDString = [uuid2 UUIDString];
            [array3 addObject:uUIDString];

            v69 = objc_autoreleasePoolPush();
            selfCopy2 = self;
            v71 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v71, OS_LOG_TYPE_DEFAULT))
            {
              v72 = HMFGetLogIdentifier();
              actionSetUUID3 = [v52 actionSetUUID];
              *buf = 138543618;
              v156 = v72;
              v157 = 2112;
              v158 = actionSetUUID3;
              _os_log_impl(&dword_229538000, v71, OS_LOG_TYPE_DEFAULT, "%{public}@Got action set response for unregistered action set %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v69);
          }
        }

        else
        {
          v60 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v62 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v62, OS_LOG_TYPE_ERROR))
          {
            v63 = HMFGetLogIdentifier();
            actionSetUUID4 = [v52 actionSetUUID];
            *buf = 138543618;
            v156 = v63;
            v157 = 2112;
            v158 = actionSetUUID4;
            _os_log_impl(&dword_229538000, v62, OS_LOG_TYPE_ERROR, "%{public}@Got action set response for unknown action set %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v60);
          uuid3 = [0 uuid];
          uUIDString2 = [uuid3 UUIDString];
          [array3 addObject:uUIDString2];
        }
      }

      v49 = [v48 countByEnumeratingWithState:&v129 objects:v153 count:16];
    }

    while (v49);
  }

  v74 = [notificationCopy dictionaryForKey:@"kMediaNotificationsKey"];
  v75 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v74 requests:0 home:self];
  v119 = [[HMDMediaSessionRequestMessageInformation alloc] initWithMessage:notificationCopy];
  [(HMDHome *)self updateMediaStateWithResponses:v75 requestMessageInformation:v119];
  remoteSourceDevice = [notificationCopy remoteSourceDevice];
  if ([(HMDHome *)self _shouldRegisterForNotificationsWithDevice:remoteSourceDevice])
  {
    primaryResident = [(HMDHome *)self primaryResident];
    device = [primaryResident device];
    if ([remoteSourceDevice isEqual:device])
    {
      v78 = [v117 count] == 0;

      if (!v78)
      {
        v79 = objc_autoreleasePoolPush();
        selfCopy4 = self;
        v81 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v81, OS_LOG_TYPE_INFO))
        {
          v82 = HMFGetLogIdentifier();
          v83 = [v117 count];
          *buf = 138543618;
          v156 = v82;
          v157 = 2048;
          v158 = v83;
          _os_log_impl(&dword_229538000, v81, OS_LOG_TYPE_INFO, "%{public}@Disabling %tu registrations with primary resident due to unexpected characteristic notification received", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v79);
        logEventSubmitter = [(HMDHome *)selfCopy4 logEventSubmitter];
        v85 = [[HMDUnexpectedNotificationLogEvent alloc] initWithCount:1];
        [logEventSubmitter submitLogEvent:v85];

        [(HMDHome *)selfCopy4 _remotelySetNotificationsEnabled:0 forCharacteristics:v117 characteristicChangeThresholds:0];
      }
    }

    else
    {
    }

    if ([array count])
    {
      if ([(HMDHome *)self isCurrentDeviceAvailableResident])
      {
        if (![(HMDHome *)self isCurrentDevicePrimaryResident])
        {
          device2 = [primaryResident device];
          v93 = [remoteSourceDevice isEqual:device2];

          if (v93)
          {
            v94 = objc_autoreleasePoolPush();
            selfCopy5 = self;
            v96 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v96, OS_LOG_TYPE_INFO))
            {
              v97 = HMFGetLogIdentifier();
              v98 = [array count];
              *buf = 138543874;
              v156 = v97;
              v157 = 2048;
              v158 = v98;
              v159 = 2112;
              v160 = array;
              _os_log_impl(&dword_229538000, v96, OS_LOG_TYPE_INFO, "%{public}@Disabling %tu notifications on primary resident: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v94);
            [(HMDHome *)selfCopy5 _remotelySetNotificationsEnabled:0 forCharacteristics:array characteristicChangeThresholds:0];
          }
        }
      }
    }

    v99 = [(HMDHome *)self _disablePayloadFromRemotelyUpdatedCharacteristicNotifications:v112];
    if ([v99 count] || objc_msgSend(array3, "count"))
    {
      v100 = objc_autoreleasePoolPush();
      selfCopy6 = self;
      v102 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v102, OS_LOG_TYPE_INFO))
      {
        v103 = HMFGetLogIdentifier();
        shortDescription = [remoteSourceDevice shortDescription];
        *buf = 138543618;
        v156 = v103;
        v157 = 2112;
        v158 = shortDescription;
        _os_log_impl(&dword_229538000, v102, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations due to unexpected characteristic notification received on primary resident from remote device: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v100);
      [(HMDHome *)selfCopy6 _modifyCharacteristicNotifications:v99 characteristicChangeThresholds:MEMORY[0x277CBEC10] mediaNotifications:MEMORY[0x277CBEC10] actionSetNotificationPayload:array3 enableNotification:0 withDevice:remoteSourceDevice];
    }
  }

  else
  {
    v86 = objc_autoreleasePoolPush();
    selfCopy7 = self;
    v88 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v88, OS_LOG_TYPE_INFO))
    {
      v89 = HMFGetLogIdentifier();
      *buf = 138543618;
      v156 = v89;
      v157 = 2112;
      v158 = remoteSourceDevice;
      _os_log_impl(&dword_229538000, v88, OS_LOG_TYPE_INFO, "%{public}@Disabling notification registrations with resident: %@ due to unexpected characteristic notification received", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v86);
    logEventSubmitter2 = [(HMDHome *)selfCopy7 logEventSubmitter];
    v91 = [[HMDUnexpectedNotificationLogEvent alloc] initWithCount:1];
    [logEventSubmitter2 submitLogEvent:v91];

    v152 = remoteSourceDevice;
    primaryResident = [MEMORY[0x277CBEA60] arrayWithObjects:&v152 count:1];
    [(HMDHome *)selfCopy7 _disableNotificationsForDevices:primaryResident];
  }

  [notificationCopy respondWithPayload:0];
  v105 = *MEMORY[0x277D85DE8];
}

void __53__HMDHome__handleCharacteristicsChangedNotification___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if ([v5 count])
  {
    v4 = [v5 hm_allKeys];
    [WeakRetained _notifyChangedCharacteristics:v4 message:*(a1 + 32) modifiedCharacteristics:v5 broadcast:0];
  }
}

- (void)updateMediaStateWithResponses:(void *)responses requestMessageInformation:
{
  v43 = *MEMORY[0x277D85DE8];
  v5 = a2;
  responsesCopy = responses;
  v7 = responsesCopy;
  if (self)
  {
    v30 = responsesCopy;
    strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v37 = 0u;
    v38 = 0u;
    v39 = 0u;
    v40 = 0u;
    v29 = v5;
    obj = v5;
    v8 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v38;
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v38 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v37 + 1) + 8 * i);
          firstObject = [v12 firstObject];
          request = [firstObject request];
          mediaProfile = [request mediaProfile];
          v16 = mediaProfile;
          if (mediaProfile)
          {
            mediaSession = [mediaProfile mediaSession];
            if (mediaSession)
            {
              v18 = [strongToStrongObjectsMapTable objectForKey:mediaSession];
              v19 = [v18 mutableCopy];

              if (v19)
              {
                [v19 addObjectsFromArray:v12];
              }

              else
              {
                v19 = [v12 mutableCopy];
              }

              v20 = [v19 copy];
              [strongToStrongObjectsMapTable setObject:v20 forKey:mediaSession];
            }

            else
            {
              [v16 updateWithResponses:v12 requestMessageInformation:v30];
            }
          }
        }

        v9 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
      }

      while (v9);
    }

    v35 = 0u;
    v36 = 0u;
    v33 = 0u;
    v34 = 0u;
    hm_allKeys = [strongToStrongObjectsMapTable hm_allKeys];
    v22 = [hm_allKeys countByEnumeratingWithState:&v33 objects:v41 count:16];
    v7 = v30;
    if (v22)
    {
      v23 = v22;
      v24 = *v34;
      do
      {
        for (j = 0; j != v23; ++j)
        {
          if (*v34 != v24)
          {
            objc_enumerationMutation(hm_allKeys);
          }

          v26 = *(*(&v33 + 1) + 8 * j);
          v27 = [strongToStrongObjectsMapTable objectForKey:{v26, v29}];
          [v26 updateWithResponses:v27 requestMessageInformation:v30];
        }

        v23 = [hm_allKeys countByEnumeratingWithState:&v33 objects:v41 count:16];
      }

      while (v23);
    }

    v5 = v29;
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_notifyChangedProperties:(id)properties withRequestIdentifier:(id)identifier notificationUpdateIdentifier:(id)updateIdentifier toUserDeviceAddress:(id)address
{
  v35 = *MEMORY[0x277D85DE8];
  propertiesCopy = properties;
  identifierCopy = identifier;
  updateIdentifierCopy = updateIdentifier;
  addressCopy = address;
  if (addressCopy)
  {
    notificationHandlerMap = [(HMDHome *)self notificationHandlerMap];
    v15 = [notificationHandlerMap objectForKey:addressCopy];

    if (!v15)
    {
      homeManager = [(HMDHome *)self homeManager];
      v30 = 0u;
      v31 = 0u;
      v32 = 0u;
      v33 = 0u;
      watchManager = [homeManager watchManager];
      connectedWatches = [watchManager connectedWatches];

      v19 = [connectedWatches countByEnumeratingWithState:&v30 objects:v34 count:16];
      if (v19)
      {
        v28 = homeManager;
        v29 = propertiesCopy;
        v20 = *v31;
        while (2)
        {
          for (i = 0; i != v19; ++i)
          {
            if (*v31 != v20)
            {
              objc_enumerationMutation(connectedWatches);
            }

            remoteDestinationString = [*(*(&v30 + 1) + 8 * i) remoteDestinationString];
            v23 = [remoteDestinationString isEqual:addressCopy];

            if (v23)
            {
              v19 = 1;
              goto LABEL_13;
            }
          }

          v19 = [connectedWatches countByEnumeratingWithState:&v30 objects:v34 count:16];
          if (v19)
          {
            continue;
          }

          break;
        }

LABEL_13:
        homeManager = v28;
        propertiesCopy = v29;
      }

      v24 = [HMDDeviceNotificationHandler alloc];
      msgDispatcher = [(HMDHome *)self msgDispatcher];
      v15 = [(HMDDeviceNotificationHandler *)v24 initWithDestination:addressCopy watchDevice:v19 withRequestIdentifier:identifierCopy messageDispatcher:msgDispatcher home:self];

      notificationHandlerMap2 = [(HMDHome *)self notificationHandlerMap];
      [notificationHandlerMap2 setObject:v15 forKey:addressCopy];
    }

    [(HMDDeviceNotificationHandler *)v15 sendNotificationForMediaProperties:propertiesCopy withRequestIdentifier:identifierCopy notificationUpdateIdentifier:updateIdentifierCopy];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_notifyRemoteUsersOfChangedProperties:(id)properties requestMessageInformation:(id)information
{
  v57 = *MEMORY[0x277D85DE8];
  propertiesCopy = properties;
  informationCopy = information;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543362;
    v51 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Notifying users registered with resident of changes in properties", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v39 = informationCopy;
  remoteSourceDevice = [informationCopy remoteSourceDevice];
  notificationRegistry = [(HMDHome *)selfCopy notificationRegistry];
  v14 = [notificationRegistry destinationsRegisteredForNotificationsForProperties:propertiesCopy];

  v15 = [MEMORY[0x277CBEB58] set];
  skippedInterDeviceChangeNotifications = selfCopy->_skippedInterDeviceChangeNotifications;
  uUID = [MEMORY[0x277CCAD78] UUID];
  uUIDString = [uUID UUIDString];

  v48 = 0u;
  v49 = 0u;
  v46 = 0u;
  v47 = 0u;
  obj = v14;
  v17 = [obj countByEnumeratingWithState:&v46 objects:v56 count:16];
  v42 = remoteSourceDevice;
  if (v17)
  {
    v18 = v17;
    v19 = *v47;
    p_superclass = HMDIDSActivityRegistrationModel.superclass;
    v40 = propertiesCopy;
    v41 = selfCopy;
    v44 = *v47;
    do
    {
      for (i = 0; i != v18; ++i)
      {
        if (*v47 != v19)
        {
          objc_enumerationMutation(obj);
        }

        v22 = *(*(&v46 + 1) + 8 * i);
        v23 = [p_superclass + 324 deviceWithDestination:v22];
        if (v23)
        {
          [v15 addObject:v23];
          if ([(HMDHome *)selfCopy _shouldSendToDestination:v22 device:v23 remoteSourceDevice:remoteSourceDevice])
          {
            v24 = v15;
            notificationRegistry2 = [(HMDHome *)selfCopy notificationRegistry];
            v26 = [notificationRegistry2 filterProperties:propertiesCopy deviceIdsDestination:v22];

            if ([v26 count])
            {
              v27 = objc_autoreleasePoolPush();
              v28 = selfCopy;
              v29 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
              {
                v30 = HMFGetLogIdentifier();
                *buf = 138543874;
                v51 = v30;
                v52 = 2112;
                v53 = v22;
                v54 = 2112;
                v55 = uUIDString;
                _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Fanning out to device %@ with the properties that changed with notificationUpdateIdentifier: %@", buf, 0x20u);

                propertiesCopy = v40;
              }

              objc_autoreleasePoolPop(v27);
              [(HMDHome *)v28 _notifyChangedProperties:v26 withRequestIdentifier:0 notificationUpdateIdentifier:uUIDString toUserDeviceAddress:v22];
              selfCopy = v41;
              remoteSourceDevice = v42;
            }

            v15 = v24;
            v19 = v44;
            p_superclass = (HMDIDSActivityRegistrationModel + 8);
          }
        }
      }

      v18 = [obj countByEnumeratingWithState:&v46 objects:v56 count:16];
    }

    while (v18);
  }

  if (isInternalBuild() && skippedInterDeviceChangeNotifications != selfCopy->_skippedInterDeviceChangeNotifications)
  {
    v31 = objc_autoreleasePoolPush();
    v32 = selfCopy;
    HMFGetOSLogHandle();
    v34 = v33 = selfCopy;
    if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
    {
      v35 = HMFGetLogIdentifier();
      v36 = v33->_skippedInterDeviceChangeNotifications;
      *buf = 138543618;
      v51 = v35;
      v52 = 2048;
      v53 = v36;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Skipped %lu spurious inter-device media property change notifications", buf, 0x16u);

      remoteSourceDevice = v42;
    }

    objc_autoreleasePoolPop(v31);
  }

  v37 = *MEMORY[0x277D85DE8];
}

- (void)notifyRemoteUsersOfChangedProperties:(id)properties requestMessageInformation:(id)information
{
  propertiesCopy = properties;
  informationCopy = information;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __74__HMDHome_notifyRemoteUsersOfChangedProperties_requestMessageInformation___block_invoke;
  block[3] = &unk_27868A010;
  block[4] = self;
  v12 = propertiesCopy;
  v13 = informationCopy;
  v9 = informationCopy;
  v10 = propertiesCopy;
  dispatch_async(workQueue, block);
}

- (void)_notifyUpdatedCharacteristic:(id)characteristic withRequestIdentifier:(id)identifier notificationUpdateIdentifier:(id)updateIdentifier toUserDeviceAddress:(id)address completion:(id)completion
{
  v38 = *MEMORY[0x277D85DE8];
  characteristicCopy = characteristic;
  identifierCopy = identifier;
  updateIdentifierCopy = updateIdentifier;
  addressCopy = address;
  completionCopy = completion;
  if (addressCopy)
  {
    notificationHandlerMap = [(HMDHome *)self notificationHandlerMap];
    v18 = [notificationHandlerMap objectForKey:addressCopy];

    if (!v18)
    {
      [(HMDHome *)self homeManager];
      v33 = 0u;
      v34 = 0u;
      v35 = 0u;
      v32 = v36 = 0u;
      watchManager = [v32 watchManager];
      connectedWatches = [watchManager connectedWatches];

      v21 = [connectedWatches countByEnumeratingWithState:&v33 objects:v37 count:16];
      if (v21)
      {
        v30 = updateIdentifierCopy;
        v31 = characteristicCopy;
        v22 = *v34;
        while (2)
        {
          for (i = 0; i != v21; ++i)
          {
            if (*v34 != v22)
            {
              objc_enumerationMutation(connectedWatches);
            }

            remoteDestinationString = [*(*(&v33 + 1) + 8 * i) remoteDestinationString];
            v25 = [remoteDestinationString isEqual:addressCopy];

            if (v25)
            {
              v21 = 1;
              goto LABEL_13;
            }
          }

          v21 = [connectedWatches countByEnumeratingWithState:&v33 objects:v37 count:16];
          if (v21)
          {
            continue;
          }

          break;
        }

LABEL_13:
        updateIdentifierCopy = v30;
        characteristicCopy = v31;
      }

      v26 = [HMDDeviceNotificationHandler alloc];
      msgDispatcher = [(HMDHome *)self msgDispatcher];
      v18 = [(HMDDeviceNotificationHandler *)v26 initWithDestination:addressCopy watchDevice:v21 withRequestIdentifier:identifierCopy messageDispatcher:msgDispatcher home:self];

      notificationHandlerMap2 = [(HMDHome *)self notificationHandlerMap];
      [notificationHandlerMap2 setObject:v18 forKey:addressCopy];
    }

    [(HMDDeviceNotificationHandler *)v18 sendNotificationForCharacteristicUpdates:characteristicCopy withRequestIdentifier:identifierCopy notificationUpdateIdentifier:updateIdentifierCopy completion:completionCopy];
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_sendCoalescedRemoteNotificationsForRequestMessage:(id)message accessories:(id)accessories
{
  accessoriesCopy = accessories;
  messageCopy = message;
  destination = [messageCopy destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = destination;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  isRemote = [messageCopy isRemote];
  if (isRemote)
  {
    device = [v9 device];
    remoteDestinationString = [device remoteDestinationString];

    if (remoteDestinationString)
    {
      notificationHandlerMap = [(HMDHome *)self notificationHandlerMap];
      v14 = [notificationHandlerMap objectForKey:remoteDestinationString];

      [v14 sendCoalescedRemoteNotificationForAccessories:accessoriesCopy];
    }
  }
}

- (BOOL)_shouldSendToDestination:(id)destination device:(id)device remoteSourceDevice:(id)sourceDevice
{
  v41 = *MEMORY[0x277D85DE8];
  destinationCopy = destination;
  deviceCopy = device;
  sourceDeviceCopy = sourceDevice;
  v11 = [HMDDeviceHandle deviceHandleForDestination:destinationCopy];
  v12 = +[HMDAccountRegistry sharedRegistry];
  v13 = [v12 deviceForHandle:v11];

  account = [v13 account];

  if (!account)
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      shortDescription = [v13 shortDescription];
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = shortDescription;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Device %@ has no user attached to it", &v37, 0x16u);

LABEL_28:
      goto LABEL_29;
    }

    goto LABEL_29;
  }

  if (deviceCopy && [sourceDeviceCopy isEqual:deviceCopy])
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
    {
      v18 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = destinationCopy;
      v19 = "%{public}@Skipping device %@ since it is the original sender";
LABEL_9:
      v20 = v17;
      v21 = OS_LOG_TYPE_DEBUG;
LABEL_27:
      _os_log_impl(&dword_229538000, v20, v21, v19, &v37, 0x16u);
      goto LABEL_28;
    }

    goto LABEL_29;
  }

  if ([v13 isCurrentDevice])
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
    {
      v18 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = destinationCopy;
      v19 = "%{public}@Skipping device %@ - ourselves";
      goto LABEL_9;
    }

LABEL_29:

    objc_autoreleasePoolPop(v15);
    v34 = 0;
    goto LABEL_30;
  }

  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  if ([localCapabilitiesDataSource isCompanionCapable])
  {
  }

  else
  {
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    isCurrentDeviceAvailableResident = [residentDeviceManager isCurrentDeviceAvailableResident];

    if ((isCurrentDeviceAvailableResident & 1) == 0)
    {
      ++self->_skippedInterDeviceChangeNotifications;
      v15 = objc_autoreleasePoolPush();
      selfCopy6 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_29;
      }

      v18 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = destinationCopy;
      v19 = "%{public}@Skipping device %@ since this device is not a companion or enabled resident";
      goto LABEL_26;
    }
  }

  localCapabilitiesDataSource2 = [(HMDHome *)self localCapabilitiesDataSource];
  isCompanionCapable = [localCapabilitiesDataSource2 isCompanionCapable];

  if (isCompanionCapable)
  {
    productInfo = [v13 productInfo];
    if (productInfo && (v29 = productInfo, [v13 productInfo], v30 = objc_claimAutoreleasedReturnValue(), v31 = objc_msgSend(v30, "productClass"), v30, v29, v31 != 5))
    {
      ++self->_skippedInterDeviceChangeNotifications;
      v15 = objc_autoreleasePoolPush();
      selfCopy6 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_29;
      }

      v18 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = destinationCopy;
      v19 = "%{public}@Skipping device %@ since this device is a companion but sending to non-watch";
    }

    else
    {
      homeManager = [(HMDHome *)self homeManager];
      isPairedWithWatch = [homeManager isPairedWithWatch];

      if (isPairedWithWatch)
      {
        goto LABEL_19;
      }

      ++self->_skippedInterDeviceChangeNotifications;
      v15 = objc_autoreleasePoolPush();
      selfCopy6 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_29;
      }

      v18 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = destinationCopy;
      v19 = "%{public}@Skipping device %@ since this device is a companion but not paired with a watch";
    }

LABEL_26:
    v20 = v17;
    v21 = OS_LOG_TYPE_INFO;
    goto LABEL_27;
  }

LABEL_19:
  v34 = 1;
LABEL_30:

  v35 = *MEMORY[0x277D85DE8];
  return v34;
}

- (id)_userForDevice:(id)device
{
  deviceCopy = device;
  users = [(HMDHome *)self users];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __26__HMDHome__userForDevice___block_invoke;
  v9[3] = &unk_2786704C0;
  v10 = deviceCopy;
  v6 = deviceCopy;
  v7 = [users hmf_objectPassingTest:v9];

  return v7;
}

uint64_t __26__HMDHome__userForDevice___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 account];
  v4 = [*(a1 + 32) account];
  v5 = [v3 isEqual:v4];

  return v5;
}

- (void)saveAttributedUserUUID:(id)d forTargetStateCharacteristic:(id)characteristic
{
  characteristicCopy = characteristic;
  dCopy = d;
  bulletinUserAttributionManager = [(HMDHome *)self bulletinUserAttributionManager];

  if (!bulletinUserAttributionManager)
  {
    v9 = [HMDBulletinUserAttributionManager alloc];
    v10 = +[HMDAccountRegistry sharedRegistry];
    v11 = [(HMDBulletinUserAttributionManager *)v9 initWithAccountRegistry:v10];
    [(HMDHome *)self setBulletinUserAttributionManager:v11];
  }

  bulletinUserAttributionManager2 = [(HMDHome *)self bulletinUserAttributionManager];
  [bulletinUserAttributionManager2 saveAttributedUserUUID:dCopy forTargetStateCharacteristic:characteristicCopy];
}

- (BOOL)_shouldUseAttributeReportForBulletin:(id)bulletin
{
  v17 = *MEMORY[0x277D85DE8];
  bulletinCopy = bulletin;
  if ((_os_feature_enabled_impl() & 1) == 0 && !CFPreferencesGetAppBooleanValue(@"MatterTTU", @"/Library/Managed Preferences/mobile/com.apple.homed.plist", 0))
  {
    goto LABEL_9;
  }

  accessory = [bulletinCopy accessory];
  if (([accessory supportsCHIP] & 1) == 0)
  {

    goto LABEL_9;
  }

  type = [bulletinCopy type];
  v7 = [type isEqualToString:*MEMORY[0x277CCF838]];

  if (!v7)
  {
LABEL_9:
    v12 = 1;
    goto LABEL_10;
  }

  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543362;
    v16 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Not notifying matter lock characteristic change, this is handled upon receiving event report", &v15, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = 0;
LABEL_10:

  v13 = *MEMORY[0x277D85DE8];
  return v12;
}

- (id)_characteristicUpdatesForChangedCharacteristics:(id)characteristics bulletinCharacteristics:(id)bulletinCharacteristics broadcast:(BOOL)broadcast
{
  bulletinCharacteristicsCopy = bulletinCharacteristics;
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __93__HMDHome__characteristicUpdatesForChangedCharacteristics_bulletinCharacteristics_broadcast___block_invoke;
  v12[3] = &unk_278670498;
  v13 = bulletinCharacteristicsCopy;
  selfCopy = self;
  broadcastCopy = broadcast;
  v9 = bulletinCharacteristicsCopy;
  v10 = [characteristics na_map:v12];

  return v10;
}

HMDCharacteristicUpdateTuple *__93__HMDHome__characteristicUpdatesForChangedCharacteristics_bulletinCharacteristics_broadcast___block_invoke(uint64_t a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [*(a1 + 32) containsObject:v3];
  v5 = [*(a1 + 40) _shouldUseAttributeReportForBulletin:v3];
  if (v4)
  {
    v6 = v5 == 0;
  }

  else
  {
    v6 = 1;
  }

  if (v6)
  {
LABEL_6:
    v7 = 0;
    goto LABEL_10;
  }

  v8 = [v3 type];
  v9 = [v8 isEqualToString:*MEMORY[0x277CCF910]];

  if ((v9 & 1) == 0)
  {
    v10 = [v3 previousValue];

    if (!v10)
    {
      v16 = objc_autoreleasePoolPush();
      v17 = *(a1 + 40);
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        v20 = [v3 shortDescription];
        v21 = 138543618;
        v22 = v19;
        v23 = 2112;
        v24 = v20;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Initial update for characteristic: %@, receiver should not display bulletin", &v21, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      goto LABEL_6;
    }
  }

  v7 = 1;
LABEL_10:
  v11 = [HMDCharacteristicUpdateTuple alloc];
  v12 = [v3 value];
  v13 = [(HMDCharacteristicUpdateTuple *)v11 initWithCharacteristic:v3 updatedValue:v12 isBroadcast:*(a1 + 48) reasons:v7];

  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)_pushTokenToDestinationMappingForDestinations:(id)destinations
{
  v4 = MEMORY[0x277CBEB38];
  destinationsCopy = destinations;
  dictionary = [v4 dictionary];
  v10 = MEMORY[0x277D85DD0];
  v11 = 3221225472;
  v12 = __57__HMDHome__pushTokenToDestinationMappingForDestinations___block_invoke;
  v13 = &unk_27867E4C8;
  selfCopy = self;
  v15 = dictionary;
  v7 = dictionary;
  [destinationsCopy hmf_enumerateWithAutoreleasePoolUsingBlock:&v10];

  v8 = [v7 copy];

  return v8;
}

void __57__HMDHome__pushTokenToDestinationMappingForDestinations___block_invoke(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [HMDDeviceHandle deviceHandleForDestination:v3];
  v5 = [v4 pushToken];
  if (v5)
  {
    [*(a1 + 40) setObject:v3 forKeyedSubscript:v5];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 32);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v9;
      v13 = 2112;
      v14 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to parse push token for destination: %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (id)_characteristicUpdatesByDestinationForNotificationRegistryDestinations:(id)destinations bulletinDestinations:(id)bulletinDestinations broadcast:(BOOL)broadcast
{
  destinationsCopy = destinations;
  bulletinDestinationsCopy = bulletinDestinations;
  allKeys = [bulletinDestinationsCopy allKeys];
  v11 = [(HMDHome *)self _pushTokenToDestinationMappingForDestinations:allKeys];

  allKeys2 = [destinationsCopy allKeys];
  v13 = [(HMDHome *)self _pushTokenToDestinationMappingForDestinations:allKeys2];

  v14 = [MEMORY[0x277CBEB58] set];
  allKeys3 = [v11 allKeys];
  [v14 addObjectsFromArray:allKeys3];

  allKeys4 = [v13 allKeys];
  [v14 addObjectsFromArray:allKeys4];

  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __113__HMDHome__characteristicUpdatesByDestinationForNotificationRegistryDestinations_bulletinDestinations_broadcast___block_invoke;
  v25[3] = &unk_278670470;
  v26 = v11;
  v27 = bulletinDestinationsCopy;
  v28 = v13;
  v29 = destinationsCopy;
  broadcastCopy = broadcast;
  selfCopy = self;
  v31 = dictionary;
  v18 = dictionary;
  v19 = destinationsCopy;
  v20 = v13;
  v21 = bulletinDestinationsCopy;
  v22 = v11;
  [v14 hmf_enumerateWithAutoreleasePoolUsingBlock:v25];
  v23 = [v18 copy];

  return v23;
}

void __113__HMDHome__characteristicUpdatesByDestinationForNotificationRegistryDestinations_bulletinDestinations_broadcast___block_invoke(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [MEMORY[0x277CBEB58] set];
  v5 = [*(a1 + 32) objectForKeyedSubscript:v3];
  v6 = [*(a1 + 40) objectForKeyedSubscript:v5];
  v7 = [v6 allObjects];
  [v4 addObjectsFromArray:v7];

  v8 = [*(a1 + 48) objectForKeyedSubscript:v3];
  v9 = [*(a1 + 56) objectForKeyedSubscript:v8];
  v10 = [v9 allObjects];
  [v4 addObjectsFromArray:v10];

  if ([v4 count])
  {
    v11 = [*(a1 + 64) _characteristicUpdatesForChangedCharacteristics:v4 bulletinCharacteristics:v6 broadcast:*(a1 + 80)];
    if (v8)
    {
      v12 = v8;
    }

    else
    {
      v12 = v5;
    }

    [*(a1 + 72) setObject:v11 forKeyedSubscript:v12];
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = *(a1 + 64);
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v18 = 138543874;
      v19 = v16;
      v20 = 2112;
      v21 = v5;
      v22 = 2112;
      v23 = v8;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@No changed characteristics found for destination: %@ / %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldRateLimitChangeNotificationsForCharacteristic:(id)characteristic
{
  characteristicCopy = characteristic;
  service = [characteristicCopy service];
  type = [characteristicCopy type];
  if (([type isEqualToString:*MEMORY[0x277CFE628]] & 1) == 0)
  {

    goto LABEL_5;
  }

  type2 = [service type];
  if (![type2 isEqualToString:*MEMORY[0x277CFE900]])
  {
    type3 = [service type];
    v9 = [type3 isEqualToString:*MEMORY[0x277CFE860]];

    if (v9)
    {
      goto LABEL_7;
    }

LABEL_5:
    v7 = 0;
    goto LABEL_14;
  }

LABEL_7:
  previousValue = [characteristicCopy previousValue];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = previousValue;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;

  [v12 doubleValue];
  v27 = v13;

  value = [characteristicCopy value];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = value;
  }

  else
  {
    v15 = 0;
  }

  v16 = v15;

  [v16 doubleValue];
  v26 = v17;

  v18.f64[0] = v27;
  v18.f64[1] = v26;
  __asm { FMOV            V1.2D, #0.5 }

  v24 = vmulq_f64(vrndaq_f64(vaddq_f64(v18, v18)), _Q1);
  v7 = fabs(vsubq_f64(v24, vdupq_laneq_s64(v24, 1)).f64[0]) < 2.22044605e-16;
LABEL_14:

  return v7;
}

- (void)_notifyRemoteUsersOfChangedCharacteristics:(id)characteristics message:(id)message broadcast:(BOOL)broadcast
{
  broadcastCopy = broadcast;
  v149 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  messageCopy = message;
  v115 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(characteristicsCopy, "count")}];
  v110 = [MEMORY[0x277CBEB58] set];
  v136 = 0u;
  v137 = 0u;
  v138 = 0u;
  v139 = 0u;
  v8 = characteristicsCopy;
  v9 = [v8 countByEnumeratingWithState:&v136 objects:v148 count:16];
  obj = v8;
  if (v9)
  {
    v10 = v9;
    v119 = 0;
    v120 = *v137;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v137 != v120)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v136 + 1) + 8 * i);
        accessory = [v12 accessory];
        stateNumber = [v12 stateNumber];
        [accessory updateTrackedAccessoryStateNumber:stateNumber];

        dataSource = [(HMDHome *)self dataSource];
        hapMetadata = [dataSource hapMetadata];
        type = [v12 type];
        [v12 service];
        v19 = v18 = self;
        type2 = [v19 type];
        v21 = [hapMetadata shouldFilterChangeNotificationsForCharacteristicType:type serviceType:type2];

        if (v21)
        {
          self = v18;
        }

        else
        {
          self = v18;
          if ([(HMDHome *)v18 _shouldRateLimitChangeNotificationsForCharacteristic:v12])
          {
            v22 = objc_autoreleasePoolPush();
            v23 = v18;
            v24 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
            {
              v25 = HMFGetLogIdentifier();
              *buf = 138543618;
              v141 = v25;
              v142 = 2112;
              v143 = v12;
              _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Filtering out characteristic for remote notification due to rate limiting: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v22);
          }

          else
          {
            accessory2 = [v12 accessory];
            if ([accessory2 hasBTLELink])
            {
              identifier = [accessory2 identifier];
              v28 = [accessory2 matchingTransportInformationWithServerIdentifier:identifier instanceID:0 linkType:1];

              if (([v28 isReachable] & 1) == 0)
              {
                [v110 addObject:v12];
              }
            }

            v119 |= [HMDBulletinUserAttributionManager currentStateCharacteristicSupportsUserAttribution:v12];
            [v115 addObject:v12];
          }
        }
      }

      v8 = obj;
      v10 = [obj countByEnumeratingWithState:&v136 objects:v148 count:16];
    }

    while (v10);
  }

  else
  {
    LOBYTE(v119) = 0;
  }

  v29 = v115;
  if ([v115 count])
  {
    v30 = messageCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v31 = v30;
    }

    else
    {
      v31 = 0;
    }

    v32 = v31;

    v103 = v32;
    destination = [v32 destination];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v34 = destination;
    }

    else
    {
      v34 = 0;
    }

    v35 = v34;

    v102 = v35;
    device = [v35 device];
    primaryResident = [(HMDHome *)self primaryResident];
    device2 = [primaryResident device];

    v38 = [MEMORY[0x277CBEB58] set];
    notificationRegistry = [(HMDHome *)self notificationRegistry];
    v107 = [notificationRegistry characteristicsByDestinationForCharacteristics:v115 applyChangeThresholding:1];

    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    LODWORD(v35) = [residentDeviceManager isCurrentDeviceConfirmedPrimaryResident];

    if (v35)
    {
      accessoryBulletinNotificationManager = [(HMDHome *)self accessoryBulletinNotificationManager];
      v42 = [accessoryBulletinNotificationManager characteristicsByDestinationForCharacteristics:v115];
    }

    else
    {
      v42 = MEMORY[0x277CBEC10];
    }

    v104 = v42;
    v47 = [(HMDHome *)self _characteristicUpdatesByDestinationForNotificationRegistryDestinations:v107 bulletinDestinations:v42 broadcast:broadcastCopy];
    v48 = MEMORY[0x277CBEB58];
    v114 = v47;
    allKeys = [v47 allKeys];
    v116 = [v48 setWithArray:allKeys];

    residentDeviceManager2 = [(HMDHome *)self residentDeviceManager];
    LODWORD(allKeys) = [residentDeviceManager2 isCurrentDeviceAvailableResident];

    selfCopy = self;
    v100 = allKeys;
    v111 = device;
    v113 = v38;
    if (allKeys)
    {
      v134 = 0u;
      v135 = 0u;
      v132 = 0u;
      v133 = 0u;
      residentEnabledDevices = [(HMDHome *)self residentEnabledDevices];
      v52 = [residentEnabledDevices countByEnumeratingWithState:&v132 objects:v147 count:16];
      if (!v52)
      {
        goto LABEL_47;
      }

      v53 = v52;
      v54 = *v133;
      while (1)
      {
        for (j = 0; j != v53; ++j)
        {
          if (*v133 != v54)
          {
            objc_enumerationMutation(residentEnabledDevices);
          }

          v56 = *(*(&v132 + 1) + 8 * j);
          primaryResident2 = [(HMDHome *)self primaryResident];
          if (([primaryResident2 isCurrentDevice] & 1) == 0)
          {
            primaryResident3 = [(HMDHome *)self primaryResident];
            device3 = [primaryResident3 device];
            remoteDestinationString = [device3 remoteDestinationString];
            v61 = [v116 containsObject:remoteDestinationString];

            if (v61)
            {
              goto LABEL_45;
            }

            primaryResident2 = [v56 remoteDestinationString];
            [v116 addObject:primaryResident2];
          }

LABEL_45:
          self = selfCopy;
        }

        v53 = [residentEnabledDevices countByEnumeratingWithState:&v132 objects:v147 count:16];
        if (!v53)
        {
LABEL_47:

          device = v111;
          v38 = v113;
          break;
        }
      }
    }

    uUID = [MEMORY[0x277CCAD78] UUID];
    uUIDString = [uUID UUIDString];

    skippedInterDeviceChangeNotifications = self->_skippedInterDeviceChangeNotifications;
    if (v119)
    {
      v63 = dispatch_group_create();
    }

    else
    {
      v63 = 0;
    }

    v130 = 0u;
    v131 = 0u;
    v128 = 0u;
    v129 = 0u;
    v117 = v116;
    v64 = [v117 countByEnumeratingWithState:&v128 objects:v146 count:16];
    v109 = v63;
    if (v64)
    {
      v65 = v64;
      v66 = *v129;
      p_superclass = HMDIDSActivityRegistrationModel.superclass;
      do
      {
        for (k = 0; k != v65; ++k)
        {
          if (*v129 != v66)
          {
            objc_enumerationMutation(v117);
          }

          v69 = *(*(&v128 + 1) + 8 * k);
          v70 = [p_superclass + 324 deviceWithDestination:v69];
          if (v70)
          {
            [v38 addObject:v70];
            if ([(HMDHome *)self _shouldSendToDestination:v69 device:v70 remoteSourceDevice:device])
            {
              v71 = [v114 objectForKeyedSubscript:v69];
              allObjects = [v71 allObjects];

              if ([allObjects count])
              {
                v73 = objc_autoreleasePoolPush();
                selfCopy2 = self;
                v75 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v75, OS_LOG_TYPE_INFO))
                {
                  v76 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v141 = v76;
                  v142 = 2112;
                  v143 = v69;
                  v144 = 2112;
                  v145 = uUIDString;
                  _os_log_impl(&dword_229538000, v75, OS_LOG_TYPE_INFO, "%{public}@Fanning out to device %@ with the characteristics that changed for notificationUpdateIdentifier: %@", buf, 0x20u);

                  v63 = v109;
                }

                objc_autoreleasePoolPop(v73);
                if (v119)
                {
                  dispatch_group_enter(v63);
                }

                v125[0] = MEMORY[0x277D85DD0];
                v125[1] = 3221225472;
                v125[2] = __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke;
                v125[3] = &unk_2786765E0;
                v127 = v119 & 1;
                v126 = v63;
                [(HMDHome *)selfCopy2 _notifyUpdatedCharacteristic:allObjects withRequestIdentifier:0 notificationUpdateIdentifier:uUIDString toUserDeviceAddress:v69 completion:v125];

                self = selfCopy;
                device = v111;
              }

              v38 = v113;
              p_superclass = (HMDIDSActivityRegistrationModel + 8);
            }
          }
        }

        v65 = [v117 countByEnumeratingWithState:&v128 objects:v146 count:16];
      }

      while (v65);
    }

    v29 = v115;
    if (v119)
    {
      workQueue = [(HMDHome *)self workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke_2;
      block[3] = &unk_27868A750;
      v123 = v115;
      selfCopy3 = self;
      dispatch_group_notify(v63, workQueue, block);
    }

    v78 = v104;
    v79 = device2;
    if (![v115 count] || !device2 || (objc_msgSend(device2, "isCurrentDevice") & 1) != 0 || (objc_msgSend(v38, "containsObject:", device2) & 1) != 0 || (objc_msgSend(device, "isEqual:", device2) & 1) != 0)
    {
      goto LABEL_83;
    }

    if (v100)
    {
      v80 = v38;
      v81 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v83 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v83, OS_LOG_TYPE_INFO))
      {
        v84 = HMFGetLogIdentifier();
        remoteDestinationString2 = [device2 remoteDestinationString];
        *buf = 138543874;
        v141 = v84;
        v142 = 2112;
        v143 = remoteDestinationString2;
        v144 = 2112;
        v145 = uUIDString;
        _os_log_impl(&dword_229538000, v83, OS_LOG_TYPE_INFO, "%{public}@Fanning to primary resident destination %@ with notificationUpdateIdentifier: %@", buf, 0x20u);

        v63 = v109;
      }

      objc_autoreleasePoolPop(v81);
      v79 = device2;
      remoteDestinationString3 = [device2 remoteDestinationString];
      [(HMDHome *)selfCopy4 _notifyChangedCharacteristics:v115 withRequestIdentifier:0 notificationUpdateIdentifier:uUIDString toUserDeviceAddress:remoteDestinationString3 broadcast:broadcastCopy];
    }

    else
    {
      if (![v110 count])
      {
        ++self->_skippedInterDeviceChangeNotifications;
LABEL_83:
        if (isInternalBuild() && skippedInterDeviceChangeNotifications != self->_skippedInterDeviceChangeNotifications)
        {
          v93 = v38;
          v94 = objc_autoreleasePoolPush();
          selfCopy5 = self;
          v96 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v96, OS_LOG_TYPE_INFO))
          {
            v97 = HMFGetLogIdentifier();
            v98 = self->_skippedInterDeviceChangeNotifications;
            *buf = 138543618;
            v141 = v97;
            v142 = 2048;
            v143 = v98;
            _os_log_impl(&dword_229538000, v96, OS_LOG_TYPE_INFO, "%{public}@Skipped %lu spurious inter-device characteristic change notifications", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v94);
          v78 = v104;
          v79 = device2;
          v38 = v93;
          v63 = v109;
        }

        goto LABEL_89;
      }

      v80 = v38;
      v87 = objc_autoreleasePoolPush();
      selfCopy6 = self;
      v89 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v89, OS_LOG_TYPE_INFO))
      {
        v90 = HMFGetLogIdentifier();
        remoteDestinationString4 = [device2 remoteDestinationString];
        *buf = 138543874;
        v141 = v90;
        v142 = 2112;
        v143 = remoteDestinationString4;
        v144 = 2112;
        v145 = uUIDString;
        _os_log_impl(&dword_229538000, v89, OS_LOG_TYPE_INFO, "%{public}@Fanning the characteristics changed over BTLE to primary resident destination %@ with notificationUpdateIdentifier: %@", buf, 0x20u);

        v63 = v109;
      }

      objc_autoreleasePoolPop(v87);
      remoteDestinationString3 = [v110 allObjects];
      v79 = device2;
      remoteDestinationString5 = [device2 remoteDestinationString];
      [(HMDHome *)selfCopy6 _notifyChangedCharacteristics:remoteDestinationString3 withRequestIdentifier:0 notificationUpdateIdentifier:uUIDString toUserDeviceAddress:remoteDestinationString5 broadcast:broadcastCopy];
    }

    v38 = v80;
    v78 = v104;
    goto LABEL_83;
  }

  if ([v8 count])
  {
    v43 = objc_autoreleasePoolPush();
    selfCopy7 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
    {
      v46 = HMFGetLogIdentifier();
      *buf = 138543362;
      v141 = v46;
      _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_DEBUG, "%{public}@No changes to notify remote devices of changed characteristics after filtering", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v43);
  }

LABEL_89:

  v99 = *MEMORY[0x277D85DE8];
}

void __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke(uint64_t a1)
{
  if (*(a1 + 40) == 1)
  {
    dispatch_group_leave(*(a1 + 32));
  }
}

void __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke_2(uint64_t a1)
{
  v41 = *MEMORY[0x277D85DE8];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  obj = *(a1 + 32);
  v1 = [obj countByEnumeratingWithState:&v30 objects:v40 count:16];
  if (v1)
  {
    v3 = v1;
    v4 = *v31;
    *&v2 = 138543874;
    v23 = v2;
    v24 = *v31;
    do
    {
      v5 = 0;
      v26 = v3;
      do
      {
        if (*v31 != v4)
        {
          objc_enumerationMutation(obj);
        }

        v6 = *(*(&v30 + 1) + 8 * v5);
        v7 = [v6 service];
        if ([HMDBulletinUserAttributionManager currentStateCharacteristicSupportsUserAttribution:v6])
        {
          v8 = [objc_opt_class() currentTargetStateCharacteristicTypeMap];
          v9 = [v6 type];
          v10 = [v8 hmf_stringForKey:v9];

          v11 = [v7 characteristics];
          v28[0] = MEMORY[0x277D85DD0];
          v28[1] = 3221225472;
          v28[2] = __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke_3;
          v28[3] = &unk_278687EB0;
          v12 = v10;
          v29 = v12;
          v13 = [v11 na_firstObjectPassingTest:v28];

          v14 = [v13 value];
          v15 = [v6 value];
          v16 = [v14 isEqual:v15];

          if (v16)
          {
            v17 = [*(a1 + 40) bulletinUserAttributionManager];
            [v17 removeAttributedUserUUIDForTargetStateCharacteristic:v13];

            v4 = v24;
          }

          else
          {
            v18 = objc_autoreleasePoolPush();
            v19 = *(a1 + 40);
            v20 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
            {
              v21 = HMFGetLogIdentifier();
              *buf = v23;
              v35 = v21;
              v36 = 2112;
              v37 = v6;
              v38 = 2112;
              v39 = v13;
              _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Not removing attributed user yet for currentStateCharacteristic=%@ because value is not the same as saved targetStateCharacteristic=%@", buf, 0x20u);

              v4 = v24;
            }

            objc_autoreleasePoolPop(v18);
          }

          v3 = v26;
        }

        ++v5;
      }

      while (v3 != v5);
      v3 = [obj countByEnumeratingWithState:&v30 objects:v40 count:16];
    }

    while (v3);
  }

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke_3(uint64_t a1, void *a2)
{
  v3 = [a2 type];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (BOOL)_shouldRegisterForNotificationsWithDevice:(id)device
{
  deviceCopy = device;
  primaryResident = [(HMDHome *)self primaryResident];
  isWatch();
  if (primaryResident)
  {
    device = [primaryResident device];
    isCurrentDevice = [device isCurrentDevice];

    if (isCurrentDevice)
    {
      v8 = 1;
    }

    else
    {
      device2 = [primaryResident device];
      v8 = [deviceCopy isEqual:device2];
    }
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (BOOL)shouldRelayNotificationToRegisteredDevicesForSource:(id)source
{
  sourceCopy = source;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = sourceCopy;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;
  destination = [sourceCopy destination];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (![v6 isRemote] || (isKindOfClass & 1) == 0 || !destination)
  {
    goto LABEL_15;
  }

  name = [v6 name];
  if ([name isEqualToString:@"kCharacteristicValueUpdatedNotificationKey"])
  {
LABEL_10:

    goto LABEL_11;
  }

  name2 = [v6 name];
  if ([name2 isEqualToString:@"kMultipleCharacteristicValuesUpdatedNotificationKey"])
  {

    goto LABEL_10;
  }

  name3 = [v6 name];
  v15 = [name3 isEqualToString:@"kCharacterisiticsChangedInternalNotificationKey"];

  if ((v15 & 1) == 0)
  {
LABEL_15:
    isWatch();
    goto LABEL_16;
  }

LABEL_11:
  primaryResident = [(HMDHome *)self primaryResident];
  if ([primaryResident isCurrentDevice])
  {

LABEL_16:
    isPairedWithWatch = 1;
    goto LABEL_17;
  }

  homeManager = [(HMDHome *)self homeManager];
  isPairedWithWatch = [homeManager isPairedWithWatch];

LABEL_17:
  return isPairedWithWatch;
}

- (id)_splitCharacteristicChanges:(id)changes changedAccessories:(id)accessories
{
  v79 = *MEMORY[0x277D85DE8];
  changesCopy = changes;
  accessoriesCopy = accessories;
  v57 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(accessoriesCopy, "count")}];
  v59 = accessoriesCopy;
  v58 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(accessoriesCopy, "count")}];
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  v77 = 0u;
  obj = changesCopy;
  v8 = [obj countByEnumeratingWithState:&v74 objects:v78 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v75;
    selfCopy = self;
    v62 = *v75;
    do
    {
      v11 = 0;
      v63 = v9;
      do
      {
        if (*v75 != v10)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v74 + 1) + 8 * v11);
        service = [v12 service];
        accessory = [service accessory];
        v15 = accessory;
        if (service)
        {
          v16 = accessory == 0;
        }

        else
        {
          v16 = 1;
        }

        if (!v16)
        {
          dataSource = [(HMDHome *)self dataSource];
          hapMetadata = [dataSource hapMetadata];
          type = [v12 type];
          v73 = hapMetadata;
          if (([hapMetadata shouldFilterCharacteristicOfTypeFromApp:type] & 1) == 0)
          {
            v70 = dataSource;
            v72 = type;
            dataSource2 = [(HMDHome *)self dataSource];
            hapMetadata2 = [dataSource2 hapMetadata];
            type2 = [service type];
            if ([hapMetadata2 shouldFilterServiceOfTypeFromApp:type2])
            {
              v67 = hapMetadata2;
              goto LABEL_13;
            }

            dataSource3 = [(HMDHome *)self dataSource];
            [dataSource3 hapMetadata];
            v24 = v64 = dataSource2;
            type3 = [v12 type];
            type4 = [service type];
            v68 = [v24 shouldFilterChangeNotificationsForCharacteristicType:type3 serviceType:type4];

            self = selfCopy;
            v9 = v63;

            v10 = v62;
            if (v68)
            {
              goto LABEL_31;
            }

            uuid = [v15 uuid];
            uUIDString = [uuid UUIDString];

            v70 = uUIDString;
            v29 = [v59 objectForKey:uUIDString];
            instanceID = [service instanceID];
            stringValue = [instanceID stringValue];

            v72 = stringValue;
            v73 = v29;
            dataSource2 = [v29 objectForKey:stringValue];
            instanceID2 = [v12 instanceID];
            stringValue2 = [instanceID2 stringValue];

            v34 = [dataSource2 objectForKey:stringValue2];
            v67 = stringValue2;
            if (v34)
            {
              v60 = v34;
              v35 = v58;
              if (isAppleTV())
              {
                v65 = dataSource2;
                dataSource4 = [(HMDHome *)selfCopy dataSource];
                hapMetadata3 = [dataSource4 hapMetadata];
                type5 = [v12 type];
                type6 = [service type];
                v40 = [hapMetadata3 requiresDeviceUnlock:type5 forService:type6];

                dataSource = v70;
                if (v40)
                {
                  v41 = v57;

                  v35 = v41;
                }

                self = selfCopy;
                dataSource2 = v65;
              }

              else
              {
                dataSource = v70;
              }

              v42 = accessoryToEncodeForXPCTransportForAccessory(v15);
              v66 = v42;
              if (v42 != v15)
              {
                uuid2 = [v42 uuid];
                uUIDString2 = [uuid2 UUIDString];

                v45 = v57;
                dataSource = uUIDString2;
                v35 = v45;
              }

              v9 = v63;
              v46 = [v35 objectForKey:dataSource];
              if (!v46)
              {
                v47 = MEMORY[0x277CBEB38];
                v48 = [v73 count];
                v49 = v47;
                v9 = v63;
                v46 = [v49 dictionaryWithCapacity:v48];
                [v35 setObject:v46 forKey:dataSource];
              }

              v71 = v35;
              v50 = [v46 objectForKey:v72];
              if (!v50)
              {
                v51 = MEMORY[0x277CBEB38];
                v52 = [dataSource2 count];
                v53 = v51;
                v9 = v63;
                v50 = [v53 dictionaryWithCapacity:v52];
                [v46 setObject:v50 forKey:v72];
              }

              type2 = v60;
              [v50 setObject:v60 forKey:v67];

              v10 = v62;
            }

            else
            {
              type2 = 0;
              v9 = v63;
LABEL_13:
              dataSource = v70;
            }

            type = v72;
          }
        }

LABEL_31:

        ++v11;
      }

      while (v9 != v11);
      v9 = [obj countByEnumeratingWithState:&v74 objects:v78 count:16];
    }

    while (v9);
  }

  v54 = [[HMDCharacteristicUpdatesNotificationPayload alloc] initWithSPIEntitledClientUpdates:v57 allClientUpdates:v58];
  v55 = *MEMORY[0x277D85DE8];

  return v54;
}

- (void)_handleRequestHomeDataSync:(id)sync
{
  v60 = *MEMORY[0x277D85DE8];
  syncCopy = sync;
  isOwnerUser = [(HMDHome *)self isOwnerUser];
  v6 = MEMORY[0x277CCFD28];
  if (!isOwnerUser)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      identifier = [syncCopy identifier];
      uUIDString = [identifier UUIDString];
      *buf = 138543618;
      v57 = v10;
      v58 = 2112;
      v59 = uUIDString;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Not owner, cannot send for message: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    v13 = [MEMORY[0x277CCA9B8] errorWithDomain:*v6 code:10 userInfo:0];
    responseHandler = [syncCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [syncCopy responseHandler];
      (responseHandler2)[2](responseHandler2, v13, 0);
    }
  }

  v16 = [syncCopy stringForKey:@"pairingUsername"];
  if (!v16)
  {
    v17 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      identifier2 = [syncCopy identifier];
      uUIDString2 = [identifier2 UUIDString];
      *buf = 138543618;
      v57 = v20;
      v58 = 2112;
      v59 = uUIDString2;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@User is not specified for message: %@", buf, 0x16u);

      v6 = MEMORY[0x277CCFD28];
    }

    objc_autoreleasePoolPop(v17);
    v23 = [MEMORY[0x277CCA9B8] errorWithDomain:*v6 code:2 userInfo:0];
    responseHandler3 = [syncCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler4 = [syncCopy responseHandler];
      (responseHandler4)[2](responseHandler4, v23, 0);
    }
  }

  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  users = [(HMDHome *)self users];
  v27 = [users countByEnumeratingWithState:&v51 objects:v55 count:16];
  if (v27)
  {
    v28 = v27;
    v29 = *v52;
LABEL_15:
    v30 = 0;
    while (1)
    {
      if (*v52 != v29)
      {
        objc_enumerationMutation(users);
      }

      v31 = *(*(&v51 + 1) + 8 * v30);
      if (([v31 isRemoteGateway] & 1) == 0)
      {
        pairingUsername = [v31 pairingUsername];
        v33 = [v16 isEqualToString:pairingUsername];

        if (v33)
        {
          break;
        }
      }

      if (v28 == ++v30)
      {
        v28 = [users countByEnumeratingWithState:&v51 objects:v55 count:16];
        if (v28)
        {
          goto LABEL_15;
        }

        goto LABEL_22;
      }
    }

    v34 = v31;

    if (v34)
    {
      goto LABEL_29;
    }
  }

  else
  {
LABEL_22:
  }

  v35 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v37 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
  {
    v38 = HMFGetLogIdentifier();
    identifier3 = [syncCopy identifier];
    uUIDString3 = [identifier3 UUIDString];
    *buf = 138543618;
    v57 = v38;
    v58 = 2112;
    v59 = uUIDString3;
    _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_INFO, "%{public}@Unable to find user for message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v35);
  v41 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  responseHandler5 = [syncCopy responseHandler];

  if (responseHandler5)
  {
    responseHandler6 = [syncCopy responseHandler];
    (responseHandler6)[2](responseHandler6, v41, 0);
  }

  v34 = 0;
LABEL_29:
  destination = [syncCopy destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v45 = destination;
  }

  else
  {
    v45 = 0;
  }

  v46 = v45;

  if (v46)
  {
    homeManager = [(HMDHome *)self homeManager];
    device = [v46 device];
    remoteDestinationString = [device remoteDestinationString];
    [homeManager sendUserAdded:v34 destination:remoteDestinationString toHome:self];
  }

  [syncCopy respondWithPayload:0];

  v50 = *MEMORY[0x277D85DE8];
}

- (void)_sendInvitationCancelationRequestToInvitee:(id)invitee
{
  inviteeCopy = invitee;
  homeManager = [(HMDHome *)self homeManager];
  idsInvitationManager = [homeManager idsInvitationManager];
  idsInvitationUUID = [inviteeCopy idsInvitationUUID];
  identifier = [inviteeCopy identifier];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __54__HMDHome__sendInvitationCancelationRequestToInvitee___block_invoke;
  v10[3] = &unk_278670448;
  v10[4] = self;
  v11 = inviteeCopy;
  v9 = inviteeCopy;
  [idsInvitationManager cancelInvitationWithIDSIdentifier:idsInvitationUUID homeInvitationID:identifier completionBlock:v10];
}

void __54__HMDHome__sendInvitationCancelationRequestToInvitee___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v24 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v6)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [*(a1 + 40) idsInvitationUUID];
      v13 = [v12 UUIDString];
      v18 = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = v13;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to cancel invitation state for invitee with ids identifier %@ due to error %@", &v18, 0x20u);

LABEL_6:
    }
  }

  else if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v14 = [*(a1 + 40) idsInvitationUUID];
    v13 = [v14 UUIDString];
    v15 = [*(a1 + 40) identifier];
    v16 = [v15 UUIDString];
    v18 = 138543874;
    v19 = v11;
    v20 = 2112;
    v21 = v13;
    v22 = 2112;
    v23 = v16;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Canceled invitation state for invitee with ids identifier %@, home identifier %@", &v18, 0x20u);

    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v7);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)__handleCompletedOutgoingInvitation:(id)invitation
{
  v17 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    identifier = [invitationCopy identifier];
    uUIDString = [identifier UUIDString];
    v13 = 138543618;
    v14 = v8;
    v15 = 2112;
    v16 = uUIDString;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Removing outgoing invitation '%@' since it completed", &v13, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  [invitationCopy updateInvitationState:3];
  user = [invitationCopy user];
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)selfCopy->_usersPendingUserManagementOperations removeObject:user];
  os_unfair_recursive_lock_unlock();

  v12 = *MEMORY[0x277D85DE8];
}

- (BOOL)_doesInvitedUserHasTheSamePairingIdentityAsOwner:(id)owner
{
  v32 = *MEMORY[0x277D85DE8];
  ownerCopy = owner;
  if (ownerCopy)
  {
    keychainStore = [(HMDHome *)self keychainStore];
    getPreferredHH2ControllerKey = [keychainStore getPreferredHH2ControllerKey];

    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    v10 = v9;
    if (getPreferredHH2ControllerKey)
    {
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        identifier = [getPreferredHH2ControllerKey identifier];
        v26 = 138543874;
        v27 = v11;
        v28 = 2112;
        v29 = identifier;
        v30 = 2112;
        v31 = ownerCopy;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Owner HH2 pairing identifier: %@, Shared user pairing identifier: %@", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v7);
      identifier2 = [getPreferredHH2ControllerKey identifier];
      v14 = HMFEqualObjects();
    }

    else
    {
      if (os_log_type_enabled(v9, OS_LOG_TYPE_FAULT))
      {
        v19 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v19;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_FAULT, "%{public}@We are doomed. Could not find owner's HH2 Key and we are in HH2", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v7);
      v20 = objc_autoreleasePoolPush();
      v21 = selfCopy;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@We are doomed. Could not find owner's HH2 Key and we are in HH2", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      v14 = 0;
    }
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v26 = 138543362;
      v27 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@shared user pairing identifier is nil.", &v26, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
    v14 = 0;
  }

  v24 = *MEMORY[0x277D85DE8];
  return v14;
}

- (unint64_t)pendingUserPrivilegeFromOutgoingInvitationUUID:(id)d
{
  dCopy = d;
  v13 = 0;
  v14 = &v13;
  v15 = 0x2020000000;
  v16 = 0;
  if (dCopy)
  {
    backingStore = [(HMDHome *)self backingStore];
    context = [backingStore context];

    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __58__HMDHome_pendingUserPrivilegeFromOutgoingInvitationUUID___block_invoke;
    v9[3] = &unk_27868A4D8;
    v10 = dCopy;
    selfCopy = self;
    v12 = &v13;
    [context unsafeSynchronousBlock:v9];
    v7 = v14[3];
  }

  else
  {
    v7 = 0;
  }

  _Block_object_dispose(&v13, 8);

  return v7;
}

void __58__HMDHome_pendingUserPrivilegeFromOutgoingInvitationUUID___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [HMCContext findOutgoingInvitationWithModelID:*(a1 + 32)];
  v3 = v2;
  if (v2)
  {
    v4 = [v2 privilege];
    *(*(*(a1 + 48) + 8) + 24) = [v4 intValue];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 40);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 32);
      v11 = 138543618;
      v12 = v8;
      v13 = 2112;
      v14 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the outgoing invitation with UUID in database: %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (id)addUserAccessCodeForUser:(id)user fromOutgoingInvitation:(id)invitation
{
  v23 = *MEMORY[0x277D85DE8];
  userCopy = user;
  invitationCopy = invitation;
  accessCode = [invitationCopy accessCode];

  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (accessCode)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      v19 = 138543618;
      v20 = v13;
      v21 = 2112;
      v22 = userCopy;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Migrating access code from HH1 to HH2 for user : %@", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    accessCode2 = [invitationCopy accessCode];
    v15 = [HMDAccessCodeDataManager createUserAccessCodeModelFromAccessCode:accessCode2 forUserUUID:userCopy changedByUserUUID:0];
  }

  else
  {
    if (v12)
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v16;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@This user does not have any access code in outgoing invitation. Not adding one.", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v15 = 0;
  }

  v17 = *MEMORY[0x277D85DE8];

  return v15;
}

- (void)__handleAcceptedOutgoingInvitationResponse:(id)response destinationAddress:(id)address publicKey:(id)key username:(id)username reverseShare:(id)share reverseShareToken:(id)token issuerPublicKeyER:(id)r presenceAuthStatus:(id)self0 completionHandler:(id)self1
{
  v135 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  addressCopy = address;
  keyCopy = key;
  usernameCopy = username;
  shareCopy = share;
  tokenCopy = token;
  rCopy = r;
  statusCopy = status;
  handlerCopy = handler;
  v117 = responseCopy;
  user = [responseCopy user];
  v20 = objc_autoreleasePoolPush();
  selfCopy = self;
  v22 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
  {
    v23 = HMFGetLogIdentifier();
    privilege = [(__CFString *)user privilege];
    if (privilege > 5)
    {
      v25 = @"None";
    }

    else
    {
      v25 = off_278684178[privilege];
    }

    v26 = v25;
    *buf = 138543874;
    v130 = v23;
    v131 = 2112;
    v132 = user;
    v133 = 2112;
    v134 = v26;
    _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@User: %@, has accepted an invitation, processing acceptance. %@", buf, 0x20u);
  }

  v112 = handlerCopy;

  objc_autoreleasePoolPop(v20);
  [(__CFString *)user setHome:selfCopy];
  v27 = [(__CFString *)user modelObjectWithChangeType:1];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v28 = v27;
  }

  else
  {
    v28 = 0;
  }

  v29 = v28;

  identifier = [responseCopy identifier];
  v31 = [(HMDHome *)selfCopy pendingUserPrivilegeFromOutgoingInvitationUUID:identifier];

  v32 = objc_autoreleasePoolPush();
  v33 = selfCopy;
  v34 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
  {
    v35 = HMFGetLogIdentifier();
    if (v31 > 5)
    {
      v36 = @"None";
    }

    else
    {
      v36 = off_278684178[v31];
    }

    v37 = v36;
    *buf = 138543618;
    v130 = v35;
    v131 = 2112;
    v132 = v37;
    _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Stored shared user privilege is : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v32);
  pendingUsers = [(HMDHome *)v33 pendingUsers];
  uuid = [(__CFString *)user uuid];
  v40 = [pendingUsers hmf_firstObjectWithUUID:uuid];

  if (v40)
  {
    [v29 setObjectChangeType:2];
    v41 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v31];
    [v29 setPrivilege:v41];
  }

  if (user && v29)
  {
    v42 = usernameCopy;
    v43 = shareCopy;
    if ([(__CFString *)user isRemoteGateway])
    {
      keychainStore = [(HMDHome *)v33 keychainStore];
      v126 = 0;
      v127 = 0;
      v45 = [keychainStore getControllerPublicKey:0 secretKey:0 keyPair:0 username:&v127 allowCreation:0 error:&v126];
      v46 = v127;
      v109 = v126;

      if ((v45 & 1) == 0)
      {
        v81 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3 description:@"Failed to set resident pairing name" reason:0 suggestion:0];
        v95 = v112;
        v99 = _Block_copy(v112);
        if (v99)
        {
          v107 = v99;
          (*(v99 + 2))(v99, v81);
        }

        else
        {
          v107 = 0;
        }

        v82 = usernameCopy;
LABEL_48:

        goto LABEL_49;
      }

      if ([v46 isEqualToString:v42])
      {
        v47 = [HMDDevice deviceWithDestination:addressCopy];
        identifier2 = [v47 identifier];
        uUIDString = [identifier2 UUIDString];
        v50 = v42;
        v51 = v40;
        v52 = uUIDString;

        v53 = v52;
        v40 = v51;
        v42 = v53;
      }
    }

    v109 = [objc_alloc(MEMORY[0x277D0F8B0]) initWithPairingKeyData:keyCopy];
    v106 = [objc_alloc(MEMORY[0x277CFEC20]) initWithIdentifier:v42 publicKey:v109 privateKey:0 permissions:0];
    hmd_dictionaryEncoding = [v106 hmd_dictionaryEncoding];
    [v29 setPairingIdentity:hmd_dictionaryEncoding];

    number = [statusCopy number];
    [v29 setPresenceAuthorizationStatus:number];

    if (shareCopy)
    {
      recordID = [shareCopy recordID];
      [v29 setReverseShareID:recordID];
    }

    v57 = encodeRootObject();
    [v29 setReverseShareToken:v57];

    v58 = objc_opt_class();
    uniqueIDsOfAllUsers = [(HMDHome *)v33 uniqueIDsOfAllUsers];
    v60 = [v58 createUserUniqueIDForAccessoriesWithoutDuplicatingExistingIDs:uniqueIDsOfAllUsers];

    v107 = v60;
    if (v60)
    {
      [v29 setUniqueIDForAccessories:v60];
      if (v31 == 5)
      {
        v61 = v29;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v62 = v61;
        }

        else
        {
          v62 = 0;
        }

        v63 = v62;

        [(HMDHome *)v33 _updateRestrictedGuestHomeAccessSettingsFromOutgoingInvitation:v117 forUserModel:v63];
      }

      v104 = v42;
      v105 = v40;
      if (rCopy && _os_feature_enabled_impl())
      {
        [v29 setMatCredIPKExternalRepresentation:rCopy];
      }

      [(__CFString *)user setPairingIdentity:v106];
      v64 = [HMDOutgoingHomeInvitationModel alloc];
      identifier3 = [v117 identifier];
      uuid2 = [(HMDHome *)v33 uuid];
      v67 = [(HMDBackingStoreModelObject *)v64 initWithObjectChangeType:3 uuid:identifier3 parentUUID:uuid2];

      [(HMDOutgoingHomeInvitationModel *)v67 setInvitationState:&unk_283E71AB0];
      [(HMDOutgoingHomeInvitationModel *)v67 setInviteeDestinationAddress:addressCopy];
      [(HMDOutgoingHomeInvitationModel *)v67 setPendingUserUUID:0];
      homeManager = [(HMDHome *)v33 homeManager];
      backingStore = [homeManager backingStore];
      v69 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v102 = [backingStore transaction:@"kUserManagementOperationAddedKey" options:v69];

      v101 = dispatch_group_create();
      backingStore2 = [(HMDHome *)v33 backingStore];
      v71 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v72 = [backingStore2 transaction:@"kAddUserRequestKey" options:v71];

      v73 = MEMORY[0x277D0F818];
      identifier4 = [v117 identifier];
      v75 = [v73 messageWithName:@"kAddUserRequestKey" identifier:identifier4 messagePayload:0];
      [v72 add:v29 withMessage:v75];

      [v72 add:v67];
      uuid3 = [v29 uuid];
      v77 = [(HMDHome *)v33 addUserAccessCodeForUser:uuid3 fromOutgoingInvitation:v117];

      if (v77)
      {
        [v72 add:v77];
      }

      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1784;
      aBlock[3] = &unk_278689B08;
      aBlock[4] = v33;
      v121 = user;
      v122 = v101;
      v123 = v102;
      v124 = 0;
      v125 = v112;
      v78 = v102;
      v79 = v101;
      v80 = _Block_copy(aBlock);
      v118[0] = MEMORY[0x277D85DD0];
      v118[1] = 3221225472;
      v118[2] = __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_3;
      v118[3] = &unk_278670420;
      v118[4] = v33;
      v119 = v117;
      [v72 runWithCoreDataBlock:v118 withCompletionBlock:v80];

      v81 = 0;
      v82 = usernameCopy;
      v43 = shareCopy;
      v42 = v104;
      v40 = v105;
      v46 = v106;
    }

    else
    {
      v81 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1 description:@"Failed to create uniqueIDForAccessories" reason:0 suggestion:0];
      v98 = _Block_copy(v112);
      v67 = v98;
      v46 = v106;
      if (v98)
      {
        (*&v98->super._bsoDataVersionOverride)(v98, v81);
      }

      v82 = usernameCopy;
    }

    v95 = v112;
    goto LABEL_48;
  }

  v83 = v40;
  backingStore3 = [(HMDHome *)v33 backingStore];
  v85 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v86 = [backingStore3 transaction:@"kUpdateInvitationStateRequestKey" options:v85];

  v87 = [HMDOutgoingHomeInvitationModel alloc];
  identifier5 = [v117 identifier];
  uuid4 = [(HMDHome *)v33 uuid];
  v90 = [(HMDBackingStoreModelObject *)v87 initWithObjectChangeType:3 uuid:identifier5 parentUUID:uuid4];

  v109 = v90;
  [v86 add:v90];
  v42 = v86;
  v91 = [HMDUserModel alloc];
  uuid5 = [(__CFString *)user uuid];
  uuid6 = [(HMDHome *)v33 uuid];
  v94 = [(HMDBackingStoreModelObject *)v91 initWithObjectChangeType:3 uuid:uuid5 parentUUID:uuid6];

  v46 = v94;
  [v42 add:v94];
  v128[0] = MEMORY[0x277D85DD0];
  v128[1] = 3221225472;
  v128[2] = __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke;
  v128[3] = &unk_27868A250;
  v128[4] = v33;
  [v42 run:v128];
  v81 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3 description:@"Outgoing Invitation does not have a valid invitee. Cancelling the invite." reason:0 suggestion:0];
  v95 = v112;
  v96 = _Block_copy(v112);
  v97 = v96;
  if (v96)
  {
    (*(v96 + 2))(v96, v81);
  }

  v43 = shareCopy;
  v40 = v83;
  v82 = usernameCopy;
LABEL_49:

  v100 = *MEMORY[0x277D85DE8];
}

void __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543618;
    v10 = v7;
    v11 = 2112;
    v12 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Finished deleting the outgoing invitation with error: %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

void __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1784(uint64_t a1, void *a2)
{
  v44 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = shouldLogPrivateInformation();
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 32);
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v4)
  {
    if (!v8)
    {
      goto LABEL_7;
    }

    v9 = HMFGetLogIdentifier();
    v10 = [*(a1 + 40) userID];
    v11 = [*(a1 + 40) displayName];
    *buf = 138544130;
    v37 = v9;
    v38 = 2112;
    v39 = v10;
    v40 = 2112;
    v41 = v11;
    v42 = 2112;
    v43 = v3;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Added user with userID: %@ and displayName: %@ with error: %@", buf, 0x2Au);
  }

  else
  {
    if (!v8)
    {
      goto LABEL_7;
    }

    v9 = HMFGetLogIdentifier();
    *buf = 138544130;
    v37 = v9;
    v38 = 2112;
    v39 = @"...";
    v40 = 2112;
    v41 = @"...";
    v42 = 2112;
    v43 = v3;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Added user with userID: %@ and displayName: %@ with error: %@", buf, 0x2Au);
  }

LABEL_7:
  objc_autoreleasePoolPop(v5);
  v12 = objc_autoreleasePoolPush();
  v13 = *(a1 + 32);
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    v32 = v12;
    v16 = MEMORY[0x277CCABB0];
    v17 = [*(a1 + 32) users];
    v18 = [v16 numberWithUnsignedInteger:{objc_msgSend(v17, "count")}];
    v19 = MEMORY[0x277CCABB0];
    [*(a1 + 32) pendingUsers];
    v20 = v33 = v3;
    v21 = [v19 numberWithUnsignedInteger:{objc_msgSend(v20, "count")}];
    v22 = MEMORY[0x277CCABB0];
    v23 = [*(a1 + 32) usersIncludingPendingUsers:1];
    v24 = [v22 numberWithUnsignedInteger:{objc_msgSend(v23, "count")}];
    *buf = 138544130;
    v37 = v15;
    v38 = 2112;
    v39 = v18;
    v40 = 2112;
    v41 = v21;
    v42 = 2112;
    v43 = v24;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Users: %@, PendingUsers: %@, All Users: %@", buf, 0x2Au);

    v12 = v32;
    v3 = v33;
  }

  objc_autoreleasePoolPop(v12);
  v25 = *(a1 + 48);
  v26 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1785;
  block[3] = &unk_27868A728;
  v35 = *(a1 + 56);
  dispatch_group_notify(v25, v26, block);

  if (!v3)
  {
    v27 = *(a1 + 32);
    v28 = [*(a1 + 40) uuid];
    [v27 _loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance:v28];
  }

  v29 = _Block_copy(*(a1 + 72));
  v30 = v29;
  if (v29)
  {
    (*(v29 + 2))(v29, *(a1 + 64));
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveUserModel:(id)model message:(id)message
{
  v30 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];
  v9 = [(HMDHome *)self userIncludingPendingUserWithUUID:uuid];

  if (v9)
  {
    currentUser = [(HMDHome *)self currentUser];

    if (v9 == currentUser)
    {
      v11 = objc_autoreleasePoolPush();
      selfCopy = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v14;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Attempting to remove current user", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v11);
      [(HMDHome *)selfCopy setCurrentUser:0];
    }

    [(HMDHome *)self _removeUserFromContainer:v9];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_usersPendingUserManagementOperations removeObject:v9];
    os_unfair_recursive_lock_unlock();
    [v9 setHome:0];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    if ([transactionResult source] != 1)
    {
      v16 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
      {
        v19 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v19;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEBUG, "%{public}@Skipping remove user due to non-xpc backingstore transaction", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v16);
      [messageCopy respondWithPayload:0];
    }
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      uuid2 = [modelCopy uuid];
      v26 = 138543618;
      v27 = v23;
      v28 = 2112;
      v29 = uuid2;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Cannot find the user with UUID %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    transactionResult = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [messageCopy respondWithError:transactionResult];
  }

  v25 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddUserModel:(id)model message:(id)message
{
  v100 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v8 = [(HMDHome *)self usersIncludingPendingUsers:1];
  uuid = [modelCopy uuid];
  v86 = v8;
  v10 = [v8 hmf_firstObjectWithUUID:uuid];

  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = [modelCopy debugString:1];
    *buf = 138543618;
    v95 = v14;
    v96 = 2112;
    v97 = v15;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Adding HMDUserModel: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v11);
  if (!v10)
  {
    v85 = selfCopy;
    homeManager = [(HMDHome *)selfCopy homeManager];
    v22 = modelCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v23 = v22;
    }

    else
    {
      v23 = 0;
    }

    v24 = v23;

    if (v24)
    {
      v10 = [[HMDResidentUser alloc] initWithModelObject:v24];
    }

    else
    {
      v10 = [[HMDUser alloc] initWithModelObject:v22];
      [(HMDResidentUser *)v10 refreshDisplayName];
      userID = [(HMDResidentUser *)v10 userID];

      if (!userID)
      {
        if (shouldLogPrivateInformation())
        {
          userID2 = [v22 userID];
        }

        else
        {
          userID2 = @"...";
          v74 = @"...";
        }

        v75 = objc_autoreleasePoolPush();
        v76 = selfCopy;
        v77 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v77, OS_LOG_TYPE_ERROR))
        {
          v78 = HMFGetLogIdentifier();
          *buf = 138543618;
          v95 = v78;
          v96 = 2112;
          v97 = userID2;
          _os_log_impl(&dword_229538000, v77, OS_LOG_TYPE_ERROR, "%{public}@User created from model no longer has userID, model userID invalid %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v75);
        v24 = 0;
LABEL_56:

        goto LABEL_57;
      }
    }

    if (v10)
    {
      v82 = v24;
      v83 = messageCopy;
      v84 = homeManager;
      v81 = modelCopy;
      [(HMDResidentUser *)v10 configureWithHome:selfCopy];
      [(HMDUser *)v10 updateRestrictedGuestSettingsFromWorkingStoreIfNeeded];
      [(HMDHome *)selfCopy _addUserToContainer:v10];
      [(HMDHome *)selfCopy _cleanRemovedUsers:v10];
      v89 = 0u;
      v90 = 0u;
      v87 = 0u;
      v88 = 0u;
      outgoingInvitations = [(HMDHome *)selfCopy outgoingInvitations];
      v27 = [outgoingInvitations countByEnumeratingWithState:&v87 objects:v93 count:16];
      if (v27)
      {
        v28 = v27;
        v29 = *v88;
        while (2)
        {
          for (i = 0; i != v28; ++i)
          {
            if (*v88 != v29)
            {
              objc_enumerationMutation(outgoingInvitations);
            }

            v31 = *(*(&v87 + 1) + 8 * i);
            user = [v31 user];
            pairingIdentity = [user pairingIdentity];
            pairingIdentity2 = [(HMDUser *)v10 pairingIdentity];
            v35 = [pairingIdentity isEqual:pairingIdentity2];

            if (v35)
            {
              [v31 setUser:v10];
              goto LABEL_24;
            }
          }

          v28 = [outgoingInvitations countByEnumeratingWithState:&v87 objects:v93 count:16];
          if (v28)
          {
            continue;
          }

          break;
        }
      }

LABEL_24:

      v36 = v85;
      [(HMDHome *)v85 _addUserToIdentityRegistry:v10];
      v10 = v10;
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();
      if (isKindOfClass)
      {
        v38 = v10;
      }

      else
      {
        v38 = 0;
      }

      v80 = v38;

      if (isKindOfClass)
      {
        [(HMDHome *)v85 _updateConfigurationStateForResidentDevice:v10 desiredConfigState:2 message:0];
        v39 = objc_autoreleasePoolPush();
        v40 = v85;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          userID3 = [(HMDResidentUser *)v10 userID];
          *buf = 138543618;
          v95 = v42;
          v96 = 2112;
          v97 = userID3;
          _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Removing resident user %@ from unassociated list", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v39);
        userID4 = [(HMDResidentUser *)v10 userID];
        [v84 removeFromUnassociatedPeers:userID4 home:v40];

        v45 = objc_autoreleasePoolPush();
        v46 = v40;
        v47 = HMFGetOSLogHandle();
        modelCopy = v81;
        if (os_log_type_enabled(v47, OS_LOG_TYPE_DEBUG))
        {
          v48 = HMFGetLogIdentifier();
          *buf = 138543362;
          v95 = v48;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_DEBUG, "%{public}@Add resident device", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v45);
      }

      else
      {
        v91[0] = @"kUserUUIDKey";
        uuid2 = [(HMDUser *)v10 uuid];
        uUIDString = [uuid2 UUIDString];
        v92[0] = uUIDString;
        v91[1] = @"kUserIDKey";
        userID5 = [(HMDResidentUser *)v10 userID];
        v92[1] = userID5;
        v91[2] = @"kUserDisplayNameKey";
        displayName = [(HMDResidentUser *)v10 displayName];
        v92[2] = displayName;
        v54 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v92 forKeys:v91 count:3];

        v55 = [v54 mutableCopy];
        userID6 = [(HMDResidentUser *)v10 userID];
        [v55 setObject:userID6 forKeyedSubscript:@"kUserIDKey"];

        identifier = [v83 identifier];
        if (identifier)
        {
          [v83 identifier];
        }

        else
        {
          [MEMORY[0x277CCAD78] UUID];
        }
        v63 = ;
        modelCopy = v81;

        v64 = [MEMORY[0x277D0F818] entitledMessageWithName:@"kUserAddedNotificationKey" identifier:v63 messagePayload:v55];
        v36 = v85;
        msgDispatcher = [(HMDHome *)v85 msgDispatcher];
        uuid3 = [(HMDHome *)v85 uuid];
        [msgDispatcher sendMessage:v64 target:uuid3];
      }

      messageCopy = v83;
      homeManager = v84;
      v24 = v82;
      userID2 = v80;
      if ([(HMDUser *)v10 isCurrentUser])
      {
        walletKeyManager = [(HMDHome *)v36 walletKeyManager];
        [walletKeyManager didAddCurrentUserWithUUID:v10];

        if (![(HMDHome *)v36 isOwnerUser]&& (_os_feature_enabled_impl() & 1) == 0)
        {
          v68 = objc_autoreleasePoolPush();
          v69 = v36;
          v70 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v70, OS_LOG_TYPE_INFO))
          {
            v71 = HMFGetLogIdentifier();
            *buf = 138543362;
            v95 = v71;
            _os_log_impl(&dword_229538000, v70, OS_LOG_TYPE_INFO, "%{public}@Calling replaceWalletKeyAfterHH2MigrationIfNecessary because the current shared user has been synced from the primary resident", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v68);
          walletKeyManager2 = [(HMDHome *)v69 walletKeyManager];
          [walletKeyManager2 replaceWalletKeyAfterHH2MigrationIfNecessary];

          homeManager = v84;
          v24 = v82;
        }
      }

      transactionResult = [v83 transactionResult];
      [transactionResult markChanged];
    }

    else
    {
      if (shouldLogPrivateInformation())
      {
        userID2 = [v22 userID];
      }

      else
      {
        userID2 = @"...";
        v58 = @"...";
      }

      v59 = objc_autoreleasePoolPush();
      v60 = selfCopy;
      v61 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
      {
        v62 = HMFGetLogIdentifier();
        *buf = 138543618;
        v95 = v62;
        v96 = 2112;
        v97 = userID2;
        _os_log_impl(&dword_229538000, v61, OS_LOG_TYPE_ERROR, "%{public}@Failed to create new user %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v59);
      v10 = 0;
    }

    goto LABEL_56;
  }

  v16 = objc_autoreleasePoolPush();
  v17 = selfCopy;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
  {
    v19 = HMFGetLogIdentifier();
    uuid4 = [modelCopy uuid];
    *buf = 138543874;
    v95 = v19;
    v96 = 2112;
    v97 = uuid4;
    v98 = 2112;
    v99 = v10;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@HMDUserModel %@ passed as add for existing user %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v16);
  [(HMDResidentUser *)v10 transactionObjectUpdated:0 newValues:modelCopy message:messageCopy];
LABEL_57:

  v79 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateRequestForHomeInvitation:(id)invitation controllerPublicKey:(id)key controllerUsername:(id)username invitationState:(int64_t)state presenceAuthStatus:(id)status preferredUserID:(id)d fromHandle:(id)handle fromAddress:(id)self0 fromMergeID:(id)self1 reverseShareURL:(id)self2 reverseShareToken:(id)self3 issuerPublicKeyER:(id)self4 message:(id)self5 messageResponseHandler:(id)self6
{
  v142 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  keyCopy = key;
  usernameCopy = username;
  statusCopy = status;
  dCopy = d;
  handleCopy = handle;
  addressCopy = address;
  iDCopy = iD;
  lCopy = l;
  tokenCopy = token;
  rCopy = r;
  messageCopy = message;
  v116 = invitationCopy;
  v108 = handleCopy;
  handlerCopy = handler;
  if ([invitationCopy isExpired])
  {
    v26 = objc_autoreleasePoolPush();
    selfCopy = self;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
    {
      v29 = HMFGetLogIdentifier();
      [invitationCopy identifier];
      v30 = lCopy;
      v32 = v31 = iDCopy;
      *buf = 138543618;
      v137 = v29;
      v138 = 2112;
      stateCopy = v32;
      _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@Invitation (%@) has already expired, invitee cannot accept or decline", buf, 0x16u);

      iDCopy = v31;
      lCopy = v30;
    }

    objc_autoreleasePoolPop(v26);
    userID = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:1006 userInfo:0];
    v34 = handlerCopy;
    if (handlerCopy)
    {
      (*(handlerCopy + 2))(handlerCopy, userID, 0);
    }

    v35 = keyCopy;
LABEL_17:
    v48 = usernameCopy;
    goto LABEL_18;
  }

  if ([invitationCopy responseReceived])
  {
    v36 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
    {
      v39 = HMFGetLogIdentifier();
      [invitationCopy identifier];
      v40 = lCopy;
      v42 = v41 = iDCopy;
      isDeclined = [invitationCopy isDeclined];
      v44 = @"accepted";
      *buf = 138543874;
      v137 = v39;
      v138 = 2112;
      if (isDeclined)
      {
        v44 = @"declined";
      }

      stateCopy = v42;
      v140 = 2112;
      v141 = v44;
      _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Invitation (%@) has already been %@, invitee cannot accept or decline", buf, 0x20u);

      iDCopy = v41;
      lCopy = v40;
    }

    objc_autoreleasePoolPop(v36);
    v45 = MEMORY[0x277CCA9B8];
    v46 = *MEMORY[0x277CCFD28];
    if ([invitationCopy isDeclined])
    {
      v47 = 1008;
    }

    else
    {
      v47 = 1007;
    }

    userID = [v45 errorWithDomain:v46 code:v47 userInfo:0];
    v35 = keyCopy;
    v34 = handlerCopy;
    if (handlerCopy)
    {
      (*(handlerCopy + 2))(handlerCopy, userID, 0);
    }

    goto LABEL_17;
  }

  if ((state - 3) > 1)
  {
    v68 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v70 = HMFGetOSLogHandle();
    v48 = usernameCopy;
    if (os_log_type_enabled(v70, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v72 = v71 = iDCopy;
      *buf = 138543618;
      v137 = v72;
      v138 = 2048;
      stateCopy = state;
      _os_log_impl(&dword_229538000, v70, OS_LOG_TYPE_INFO, "%{public}@Failed to update invite state since the value %ld was incorrect", buf, 0x16u);

      iDCopy = v71;
    }

    objc_autoreleasePoolPop(v68);
    userID = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:43 userInfo:0];
    v34 = handlerCopy;
    if (handlerCopy)
    {
      (*(handlerCopy + 2))(handlerCopy, userID, 0);
    }

    v35 = keyCopy;
  }

  else
  {
    v104 = lCopy;
    v105 = rCopy;
    if (state == 3)
    {
      v50 = iDCopy;
      v51 = handleCopy;
      user = [invitationCopy user];
      isPending = [user isPending];

      if (isPending)
      {
        v54 = 4;
      }

      else
      {
        v54 = 1;
      }

      v55 = [HMDSharedUserInviteOwnerResponseLogEventBuilder alloc];
      identifier = [invitationCopy identifier];
      user2 = [invitationCopy user];
      privilege = [user2 privilege];
      [invitationCopy age];
      userID = [(HMDSharedUserInviteOwnerResponseLogEventBuilder *)v55 initWithHome:self sessionIdentifier:identifier invitationType:privilege invitationAge:v54 invitationSource:?];

      [(HMDHome *)self addSharedUserResponseEventBuilder:userID];
      v48 = usernameCopy;
      v35 = keyCopy;
      if (!keyCopy || !usernameCopy)
      {
        v74 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
        [(__CFString *)userID markError:v74];
        rCopy = v105;
        v34 = handlerCopy;
        if (handlerCopy)
        {
          (*(handlerCopy + 2))(handlerCopy, v74, 0);
        }

        goto LABEL_44;
      }

      rCopy = v105;
      if ([(HMDHome *)self _doesInvitedUserHasTheSamePairingIdentityAsOwner:usernameCopy])
      {
        v59 = objc_autoreleasePoolPush();
        selfCopy4 = self;
        v61 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_FAULT))
        {
          v62 = HMFGetLogIdentifier();
          *buf = 138543362;
          v137 = v62;
          _os_log_impl(&dword_229538000, v61, OS_LOG_TYPE_FAULT, "%{public}@Owner and shared user has the same pairing identities.", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v59);
        v63 = objc_autoreleasePoolPush();
        v64 = selfCopy4;
        v65 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v65, OS_LOG_TYPE_ERROR))
        {
          v66 = HMFGetLogIdentifier();
          *buf = 138543618;
          v137 = v66;
          v138 = 2112;
          stateCopy = &unk_283E71A98;
          _os_log_impl(&dword_229538000, v65, OS_LOG_TYPE_ERROR, "%{public}@Owner and shared user has the same pairing identities : %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v63);
        v67 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2722];
        [(__CFString *)userID markError:v67];
        v34 = handlerCopy;
        if (handlerCopy)
        {
          (*(handlerCopy + 2))(handlerCopy, v67, 0);
        }

        v48 = usernameCopy;
        v35 = keyCopy;
LABEL_44:
        iDCopy = v50;
        lCopy = v104;
        goto LABEL_18;
      }

      if (dCopy)
      {
        v99 = +[HMDAccountHandleFormatter defaultFormatter];
        v100 = [v99 accountHandleFromString:dCopy];
      }

      else
      {
        v100 = 0;
      }

      [(__CFString *)userID markAuthenticateUserBegin];
      v121[0] = MEMORY[0x277D85DD0];
      v121[1] = 3221225472;
      v121[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke;
      v121[3] = &unk_2786703F8;
      v122 = userID;
      v135 = handlerCopy;
      v123 = v100;
      v124 = v116;
      v125 = keyCopy;
      v48 = usernameCopy;
      v126 = usernameCopy;
      selfCopy5 = self;
      v101 = v50;
      v128 = v50;
      lCopy = v104;
      v129 = v104;
      v130 = tokenCopy;
      v131 = v51;
      v132 = addressCopy;
      v133 = v105;
      v134 = statusCopy;
      v102 = userID;
      userID = v100;
      rCopy = v105;
      iDCopy = v101;
      v34 = handlerCopy;
      v35 = keyCopy;
      __authenticateAcceptedOutgoingInvitation(self, v124, v131, userID, v121);
    }

    else
    {
      v103 = iDCopy;
      if (shouldLogPrivateInformation())
      {
        user3 = [invitationCopy user];
        userID = [user3 userID];
      }

      else
      {
        userID = @"...";
        v75 = @"...";
      }

      v76 = objc_autoreleasePoolPush();
      selfCopy6 = self;
      v78 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v78, OS_LOG_TYPE_INFO))
      {
        v79 = HMFGetLogIdentifier();
        *buf = 138543618;
        v137 = v79;
        v138 = 2112;
        stateCopy = userID;
        _os_log_impl(&dword_229538000, v78, OS_LOG_TYPE_INFO, "%{public}@User %@ declined invite", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v76);
      v80 = objc_alloc(MEMORY[0x277D0F7A8]);
      workQueue = [(HMDHome *)selfCopy6 workQueue];
      v82 = [v80 initWithQueue:workQueue];

      homeManager = [(HMDHome *)selfCopy6 homeManager];
      homeOwnerCloudShareManager = [homeManager homeOwnerCloudShareManager];
      user4 = [invitationCopy user];
      v86 = [homeOwnerCloudShareManager revokeAccessForUser:user4 home:selfCopy6];
      v119[0] = MEMORY[0x277D85DD0];
      v119[1] = 3221225472;
      v119[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1762;
      v119[3] = &unk_278687050;
      v119[4] = selfCopy6;
      v87 = v82;
      v120 = v116;
      v117[0] = MEMORY[0x277D85DD0];
      v117[1] = 3221225472;
      v117[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1763;
      v117[3] = &unk_2786882F0;
      v117[4] = selfCopy6;
      v88 = v120;
      v118 = v88;
      v89 = [v86 inContext:v87 then:v119 orRecover:v117];

      name = [messageCopy name];
      v91 = name;
      v92 = @"UpdateOutgoingInvitationToAccept";
      if (name)
      {
        v92 = name;
      }

      v93 = v92;

      backingStore = [(HMDHome *)selfCopy6 backingStore];
      v95 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v96 = [backingStore transaction:v93 options:v95];

      v97 = [v88 emptyModelObjectWithChangeType:2];
      v98 = [MEMORY[0x277CCABB0] numberWithInteger:state];
      [v97 setInvitationState:v98];

      if (messageCopy)
      {
        [v96 add:v97 withMessage:messageCopy];
      }

      else
      {
        [v96 add:v97];
      }

      v48 = usernameCopy;
      iDCopy = v103;
      lCopy = v104;
      rCopy = v105;
      [v96 run];

      v35 = keyCopy;
      v34 = handlerCopy;
    }
  }

LABEL_18:

  v49 = *MEMORY[0x277D85DE8];
}

void __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  if (!v3)
  {
    [v4 markAuthenticateUserEnd];
    if (*(a1 + 40))
    {
      v6 = [*(a1 + 48) user];
      v7 = [HMDUser userIDForAccountHandle:*(a1 + 40)];
      [v6 setUserID:v7];
    }

    v8 = [objc_alloc(MEMORY[0x277D0F8B0]) initWithPairingKeyData:*(a1 + 56)];
    v9 = [objc_alloc(MEMORY[0x277CFEC20]) initWithIdentifier:*(a1 + 64) publicKey:v8 privateKey:0 permissions:0];
    v10 = [*(a1 + 72) homeManager];
    v11 = [*(a1 + 48) user];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v12 = v11;
    }

    else
    {
      v12 = 0;
    }

    v13 = v12;

    if (v13)
    {
      v14 = [v13 device];
      if (v14)
      {
        v15 = [v10 identityRegistry];
        v16 = [*(a1 + 48) user];
        [v15 registerIdentity:v9 device:v14 object:v16];

LABEL_14:
      }
    }

    else
    {
      v17 = [*(a1 + 48) user];
      v14 = [v17 account];

      if (v14)
      {
        v15 = [v10 identityRegistry];
        [v15 registerIdentity:v9 account:v14 object:*(a1 + 48)];
        goto LABEL_14;
      }
    }

    v18 = [*(a1 + 48) user];
    v19 = [HMDAccountIdentifier accountIdentifierForSenderCorrelationIdentifier:*(a1 + 80)];
    [v18 setAccountIdentifier:v19];

    v20 = [*(a1 + 48) user];
    [v20 setMergeIdentifier:*(a1 + 80)];

    v21 = [[HMDCoreDataCloudShareInvitation alloc] initWithURL:*(a1 + 88) token:*(a1 + 96)];
    v22 = [v10 homeOwnerCloudShareManager];
    v23 = objc_alloc(MEMORY[0x277D0F7A8]);
    v24 = [*(a1 + 72) workQueue];
    v25 = [v23 initWithQueue:v24];

    [*(a1 + 32) markJoiningReverseShareBegin];
    v26 = [v22 acceptShareInvitation:v21];
    v39[0] = MEMORY[0x277D85DD0];
    v39[1] = 3221225472;
    v39[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_2;
    v39[3] = &unk_2786703A8;
    v39[4] = *(a1 + 72);
    v40 = *(a1 + 104);
    v41 = *(a1 + 48);
    v42 = *(a1 + 32);
    v43 = *(a1 + 112);
    v44 = *(a1 + 56);
    v45 = *(a1 + 64);
    v46 = *(a1 + 120);
    v47 = *(a1 + 128);
    v48 = *(a1 + 136);
    v28[0] = MEMORY[0x277D85DD0];
    v28[1] = 3221225472;
    v28[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_2_1759;
    v28[3] = &unk_2786703D0;
    v28[4] = *(a1 + 72);
    v29 = *(a1 + 104);
    v30 = *(a1 + 32);
    v31 = *(a1 + 48);
    v32 = *(a1 + 112);
    v33 = *(a1 + 56);
    v34 = *(a1 + 64);
    v35 = *(a1 + 96);
    v36 = *(a1 + 120);
    v37 = *(a1 + 128);
    v38 = *(a1 + 136);
    v27 = [v26 inContext:v25 then:v39 orRecover:v28];

    goto LABEL_16;
  }

  [v4 markError:v3];
  v5 = *(a1 + 136);
  if (v5)
  {
    (*(v5 + 16))(v5, v3, 0);
  }

LABEL_16:
}

uint64_t __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1762(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) user];
    v9 = [v8 uuid];
    v10 = [*(a1 + 32) name];
    v11 = [*(a1 + 32) uuid];
    v14 = 138544130;
    v15 = v7;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully revoked cloud share for declined invite %@ for home %@/%@", &v14, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1763(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) user];
    v9 = [v8 uuid];
    v10 = [*(a1 + 32) name];
    v11 = [*(a1 + 32) uuid];
    v14 = 138544386;
    v15 = v7;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    v22 = 2112;
    v23 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to revoke cloud share for declined invite %@ for home %@/%@ due to %@", &v14, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v23 = *(a1 + 40);
    v8 = [*(a1 + 32) name];
    v9 = [*(a1 + 32) uuid];
    v10 = [*(a1 + 48) user];
    v11 = [v10 privilege];
    if (v11 > 5)
    {
      v12 = @"None";
    }

    else
    {
      v12 = off_278684178[v11];
    }

    v13 = v12;
    *buf = 138544642;
    v28 = v7;
    v29 = 2112;
    v30 = v3;
    v31 = 2112;
    v32 = v23;
    v33 = 2112;
    v34 = v8;
    v35 = 2112;
    v36 = v9;
    v37 = 2112;
    v38 = v13;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Joined cloud share %@ from shared user %@ for home %@ /%@ / %@", buf, 0x3Eu);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 56) markJoiningReverseShareEnd];
  [*(a1 + 56) markAddUserToHomeBegin];
  v14 = *(a1 + 32);
  v15 = *(a1 + 64);
  v16 = *(a1 + 72);
  v17 = *(a1 + 80);
  v18 = *(a1 + 88);
  v19 = *(a1 + 96);
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1758;
  v24[3] = &unk_278689A68;
  v20 = *(a1 + 48);
  v25 = *(a1 + 56);
  v26 = *(a1 + 104);
  [v14 __handleAcceptedOutgoingInvitationResponse:v20 destinationAddress:v15 publicKey:v16 username:v17 reverseShare:v3 reverseShareToken:0 issuerPublicKeyER:v18 presenceAuthStatus:v19 completionHandler:v24];

  v21 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_2_1759(uint64_t a1, void *a2)
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v9 = [*(a1 + 32) name];
    v10 = [*(a1 + 32) uuid];
    *buf = 138544386;
    v27 = v7;
    v28 = 2112;
    v29 = v8;
    v30 = 2112;
    v31 = v9;
    v32 = 2112;
    v33 = v10;
    v34 = 2112;
    v35 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to accept cloud share from shared user %@ for home %@/%@ due to %@, will try later", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 48) markError:v3];
  v11 = *(a1 + 32);
  v12 = *(a1 + 56);
  v13 = *(a1 + 64);
  v14 = *(a1 + 72);
  v15 = *(a1 + 80);
  v16 = *(a1 + 88);
  v17 = *(a1 + 96);
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1760;
  v24[3] = &unk_278688DD0;
  v18 = *(a1 + 104);
  v25 = *(a1 + 112);
  [v11 __handleAcceptedOutgoingInvitationResponse:v12 destinationAddress:v13 publicKey:v14 username:v15 reverseShare:0 reverseShareToken:v16 issuerPublicKeyER:v17 presenceAuthStatus:v18 completionHandler:v24];
  v19 = dispatch_time(0, 300000000000);
  v20 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_2_1761;
  block[3] = &unk_27868A728;
  block[4] = *(a1 + 32);
  dispatch_after(v19, v20, block);

  v21 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1760(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, a2, 0);
  }

  return result;
}

void __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1758(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  if (v3)
  {
    [v4 markError:?];
  }

  else
  {
    [v4 markAddUserToHomeEnd];
  }

  v5 = *(a1 + 40);
  v6 = v7;
  if (v5)
  {
    (*(v5 + 16))(v5, v7, 0);
    v6 = v7;
  }
}

- (void)_processUnacceptReverseShareAccessForUsers
{
  v58 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v46[0] = 0;
    v46[1] = v46;
    v46[2] = 0x2020000000;
    v47 = 0;
    objc_initWeak(&location, self);
    futureWithNoValue = [MEMORY[0x277D0F7C0] futureWithNoValue];
    v3 = objc_alloc(MEMORY[0x277D0F7A8]);
    workQueue = [(HMDHome *)self workQueue];
    v26 = [v3 initWithQueue:workQueue];

    v44 = _HMFThreadLocalAsyncContextPush();
    home = [(HMDHome *)self home];
    usersSupportingPresence = [home usersSupportingPresence];

    v42 = 0u;
    v43 = 0u;
    v40 = 0u;
    v41 = 0u;
    obj = usersSupportingPresence;
    v7 = [obj countByEnumeratingWithState:&v40 objects:v57 count:16];
    if (v7)
    {
      v8 = *v41;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v41 != v8)
          {
            objc_enumerationMutation(obj);
          }

          v10 = *(*(&v40 + 1) + 8 * i);
          if (([v10 isOwner] & 1) == 0)
          {
            *&v52 = 0;
            *(&v52 + 1) = &v52;
            v53 = 0x3032000000;
            v54 = __Block_byref_object_copy__14759;
            v55 = __Block_byref_object_dispose__14760;
            v56 = 0;
            backingStore = [(HMDHome *)self backingStore];
            context = [backingStore context];

            v36[0] = MEMORY[0x277D85DD0];
            v36[1] = 3221225472;
            v36[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke;
            v36[3] = &unk_278689D20;
            v36[4] = v10;
            v13 = context;
            v37 = v13;
            selfCopy = self;
            v39 = &v52;
            [v13 unsafeSynchronousBlock:v36];
            if (*(*(&v52 + 1) + 40))
            {
              v31[0] = MEMORY[0x277D85DD0];
              v31[1] = 3221225472;
              v31[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1740;
              v31[3] = &unk_278670358;
              objc_copyWeak(&v35, &location);
              v33 = &v52;
              v31[4] = v10;
              v32 = v13;
              v34 = v46;
              v14 = [futureWithNoValue then:v31];

              objc_destroyWeak(&v35);
              futureWithNoValue = v14;
            }

            else
            {
              v15 = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v17 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
              {
                v18 = HMFGetLogIdentifier();
                uuid = [v10 uuid];
                *buf = 138543618;
                v49 = v18;
                v50 = 2112;
                v51 = uuid;
                _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_DEBUG, "%{public}@Unable to find user with UUID %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v15);
            }

            _Block_object_dispose(&v52, 8);
          }
        }

        v7 = [obj countByEnumeratingWithState:&v40 objects:v57 count:16];
      }

      while (v7);
    }

    v29[0] = MEMORY[0x277D85DD0];
    v29[1] = 3221225472;
    v29[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1745;
    v29[3] = &unk_278670380;
    objc_copyWeak(&v30, &location);
    v29[4] = v46;
    v20 = [futureWithNoValue then:v29];
    objc_destroyWeak(&v30);

    _HMFThreadLocalAsyncContextPop();
    objc_destroyWeak(&location);
    _Block_object_dispose(v46, 8);
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      LODWORD(v52) = 138543362;
      *(&v52 + 4) = v24;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Will not try to accept reverse shares because this is not longer the primary resident", &v52, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
  }

  v25 = *MEMORY[0x277D85DE8];
}

void __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [*(a1 + 40) managedObjectContext];
  v4 = [_MKFHome findHomeMemberWithUUID:v2 context:v3];

  if (v4)
  {
    v5 = [v4 reverseShareToken];
    v6 = *(*(a1 + 56) + 8);
    v7 = *(v6 + 40);
    *(v6 + 40) = v5;
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 48);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [*(a1 + 32) uuid];
      v14 = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to find home member with UUID %@", &v14, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1740(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v5 = [HMDCoreDataCloudShareInvitation alloc];
  v6 = [*(*(*(a1 + 48) + 8) + 40) shareURL];
  v7 = [(HMDCoreDataCloudShareInvitation *)v5 initWithURL:v6 token:*(*(*(a1 + 48) + 8) + 40)];

  v8 = [WeakRetained homeManager];
  v9 = [v8 homeOwnerCloudShareManager];

  v10 = objc_alloc(MEMORY[0x277D0F7A8]);
  v11 = [WeakRetained workQueue];
  v12 = [v10 initWithQueue:v11];

  v13 = [v9 acceptShareInvitation:v7];
  v21[0] = MEMORY[0x277D85DD0];
  v21[1] = 3221225472;
  v21[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_2;
  v21[3] = &unk_278670308;
  objc_copyWeak(&v23, (a1 + 64));
  v14 = *(a1 + 40);
  v21[4] = *(a1 + 32);
  v22 = v14;
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1744;
  v19[3] = &unk_278670330;
  objc_copyWeak(&v20, (a1 + 64));
  v15 = *(a1 + 56);
  v19[4] = *(a1 + 32);
  v19[5] = v15;
  v16 = [v13 inContext:v12 then:v21 orRecover:v19];
  if (v16)
  {
    v17 = v16;

    objc_destroyWeak(&v20);
    objc_destroyWeak(&v23);

    return 3;
  }

  else
  {
    result = _HMFPreconditionFailure();
    __break(1u);
  }

  return result;
}

uint64_t __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1745(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained && *(*(*(a1 + 32) + 8) + 24) == 1)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v16 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@At least one shared user reverse share not accepted, scheduling retry", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = dispatch_time(0, 300000000000);
    v10 = [v6 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1746;
    block[3] = &unk_278686B80;
    objc_copyWeak(&v14, (a1 + 40));
    dispatch_after(v9, v10, block);

    objc_destroyWeak(&v14);
  }

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

void __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1746(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _processUnacceptReverseShareAccessForUsers];
}

uint64_t __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_2(uint64_t a1, void *a2)
{
  v30 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 32) accountHandle];
      v10 = [v6 name];
      v11 = [v6 uuid];
      *buf = 138544386;
      v21 = v8;
      v22 = 2112;
      v23 = v3;
      v24 = 2112;
      v25 = v9;
      v26 = 2112;
      v27 = v10;
      v28 = 2112;
      v29 = v11;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Joined cloud share %@ from shared user %@ for home %@/%@", buf, 0x34u);
    }

    objc_autoreleasePoolPop(v5);
    v12 = [v6 backingStore];
    v13 = [v12 context];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1742;
    v17[3] = &unk_27868A010;
    v14 = *(a1 + 40);
    v17[4] = *(a1 + 32);
    v18 = v14;
    v19 = v6;
    [v13 unsafeSynchronousBlock:v17];
  }

  v15 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1744(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [*(a1 + 32) accountHandle];
    v10 = [v6 name];
    v11 = [v6 uuid];
    v14 = 138544386;
    v15 = v8;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    v22 = 2112;
    v23 = v3;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to accept cloud share from shared user %@ for home %@/%@ due to %@", &v14, 0x34u);
  }

  objc_autoreleasePoolPop(v5);
  *(*(*(a1 + 40) + 8) + 24) = 1;

  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

void __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1742(id *a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] uuid];
  v3 = [a1[5] managedObjectContext];
  v4 = [_MKFHome findHomeMemberWithUUID:v2 context:v3];

  if (v4)
  {
    [v4 setReverseShareToken:0];
    v5 = +[HMCContext currentContext];
    [v5 save];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = a1[6];
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [a1[4] uuid];
      v12 = 138543618;
      v13 = v9;
      v14 = 2112;
      v15 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@After accepting share, unable to find home member with UUID %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleAcceptRequestForIDSInvitationWithIdentifier:(id)identifier payload:(id)payload fromAddress:(id)address fromMergeID:(id)d
{
  v98 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  payloadCopy = payload;
  addressCopy = address;
  dCopy = d;
  v13 = [payloadCopy hmf_UUIDForKey:@"kInvitationIdentifierKey"];
  v14 = [payloadCopy hmf_dataForKey:@"kControllerPublicKey"];
  v84 = [payloadCopy hmf_stringForKey:@"kControllerPairingNameKey"];
  v15 = [payloadCopy hmf_dataForKey:@"HMDIssuerPublicKeyExternalRepresentationKey"];
  v86 = [MEMORY[0x277CD1F00] authWithDict:payloadCopy];
  v85 = [payloadCopy hmf_stringForKey:@"kUserIDKey"];
  v16 = [(HMDHome *)self invitationWithIDSInvitationIdentifier:identifierCopy];
  v17 = [(HMDHome *)self invitationWithInvitationIdentifier:v13];
  v88 = v17;
  if (!(v16 | v17))
  {
    v41 = objc_autoreleasePoolPush();
    selfCopy = self;
    v43 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v43, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v44 = v83 = v15;
      [identifierCopy UUIDString];
      v45 = v79 = addressCopy;
      [v13 UUIDString];
      v46 = v14;
      v48 = v47 = identifierCopy;
      *buf = 138543874;
      v91 = v44;
      v92 = 2112;
      v93 = v45;
      v94 = 2112;
      v95 = v48;
      _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_ERROR, "%{public}@Could not find matching outgoingInvitation for idsIdentifier %@ homeIdentifier %@ to handle accept.", buf, 0x20u);

      identifierCopy = v47;
      v14 = v46;

      addressCopy = v79;
      v15 = v83;
    }

    objc_autoreleasePoolPop(v41);
    v16 = 0;
    goto LABEL_19;
  }

  v81 = v14;
  v82 = v15;
  if (!v16 && v17)
  {
    v18 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      [identifierCopy UUIDString];
      v22 = v73 = identifierCopy;
      [v13 UUIDString];
      v23 = v70 = v18;
      [0 idsInvitationUUID];
      v77 = v13;
      v25 = v24 = addressCopy;
      uUIDString = [v25 UUIDString];
      *buf = 138544130;
      v91 = v21;
      v92 = 2112;
      v93 = v22;
      v94 = 2112;
      v95 = v23;
      v96 = 2112;
      v97 = uUIDString;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Could not find matching outgoingInvitation for idsIdentifier %@, but found one for homeIdentifier %@ with idsIdentifier %@. Using homeIdentifier accept invite.", buf, 0x2Au);

      addressCopy = v24;
      v13 = v77;

      v18 = v70;
      identifierCopy = v73;
    }

    objc_autoreleasePoolPop(v18);
    v16 = v88;
    v15 = v82;
  }

  identifier = [v16 identifier];
  v28 = [identifier hmf_isEqualToUUID:v13];

  if ((v28 & 1) == 0)
  {
    v49 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v51 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_ERROR))
    {
      v52 = HMFGetLogIdentifier();
      [identifierCopy UUIDString];
      v53 = v75 = identifierCopy;
      [v16 identifier];
      v54 = v72 = v49;
      uUIDString2 = [v54 UUIDString];
      [v13 UUIDString];
      v80 = v13;
      v57 = v56 = addressCopy;
      *buf = 138544130;
      v91 = v52;
      v92 = 2112;
      v93 = v53;
      v94 = 2112;
      v95 = uUIDString2;
      v96 = 2112;
      v97 = v57;
      _os_log_impl(&dword_229538000, v51, OS_LOG_TYPE_ERROR, "%{public}@Found matching outgoingInvitation for idsIdentifier %@, but homeIdentifier on IDS invitation: %@ did not match the one of the found invitation %@ to handle accept.", buf, 0x2Au);

      v49 = v72;
      addressCopy = v56;
      v13 = v80;

      identifierCopy = v75;
    }

    objc_autoreleasePoolPop(v49);
    v14 = v81;
    v15 = v82;
LABEL_19:
    v39 = v84;
    goto LABEL_26;
  }

  v78 = addressCopy;
  v29 = [payloadCopy hmf_stringForKey:@"HMDHomeInvitationShareURLKey"];
  v71 = [MEMORY[0x277CBEBC0] URLWithString:v29];
  if (v29)
  {
    v67 = v29;
    v30 = [payloadCopy hmf_dataForKey:@"HMDHomeInvitationShareTokenKey"];
    v31 = MEMORY[0x277CCAAC8];
    v32 = [MEMORY[0x277CBEB98] setWithObject:objc_opt_class()];
    v89 = 0;
    v68 = v30;
    v33 = [v31 _strictlyUnarchivedObjectOfClasses:v32 fromData:v30 error:&v89];
    v34 = v89;

    if (v34)
    {
      v74 = identifierCopy;
      v35 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
      {
        v38 = HMFGetLogIdentifier();
        *buf = 138543618;
        v91 = v38;
        v92 = 2112;
        v93 = v34;
        _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@Unarchive share token due to error %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v35);
      identifierCopy = v74;
      addressCopy = v78;
      v39 = v84;
      v40 = v33;
      v29 = v67;
    }

    else
    {
      addressCopy = v78;
      v64 = [HMDAccountHandle accountHandleForDestination:v78];
      selfCopy5 = self;
      v39 = v84;
      [(HMDHome *)selfCopy5 _handleUpdateRequestForHomeInvitation:v16 controllerPublicKey:v81 controllerUsername:v84 invitationState:3 presenceAuthStatus:v86 preferredUserID:v85 fromHandle:v64 fromAddress:v78 fromMergeID:dCopy reverseShareURL:v71 reverseShareToken:v33 issuerPublicKeyER:v82 message:0 messageResponseHandler:&__block_literal_global_1739];

      v40 = v33;
      v29 = v67;
    }

    v14 = v81;
    v15 = v82;
  }

  else
  {
    v58 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v60 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v60, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v61 = v69 = v58;
      [(HMDHome *)selfCopy6 name];
      v62 = v76 = identifierCopy;
      uuid = [(HMDHome *)selfCopy6 uuid];
      *buf = 138543874;
      v91 = v61;
      v92 = 2112;
      v93 = v62;
      v94 = 2112;
      v95 = uuid;
      _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_ERROR, "%{public}@Share URL is missing from invite for home %@/%@", buf, 0x20u);

      v15 = v82;
      identifierCopy = v76;

      v58 = v69;
    }

    objc_autoreleasePoolPop(v58);
    addressCopy = v78;
    v14 = v81;
    v39 = v84;
  }

LABEL_26:
  v66 = *MEMORY[0x277D85DE8];
}

- (id)invitationWithIDSInvitationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v6 = [outgoingInvitations hmf_firstObjectWithValue:identifierCopy forKeyPath:@"idsInvitationUUID"];

  return v6;
}

- (id)invitationWithInvitationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v6 = [outgoingInvitations hmf_firstObjectWithValue:identifierCopy forKeyPath:@"identifier"];

  return v6;
}

- (void)handleDeclineRequestForIDSInvitationWithIdentifier:(id)identifier fromAddress:(id)address
{
  v19 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  addressCopy = address;
  v8 = [(HMDHome *)self invitationWithIDSInvitationIdentifier:identifierCopy];
  if (v8)
  {
    [(HMDHome *)self _handleUpdateRequestForHomeInvitation:v8 controllerPublicKey:0 controllerUsername:0 invitationState:4 presenceAuthStatus:0 preferredUserID:0 fromHandle:0 fromAddress:addressCopy fromMergeID:0 reverseShareURL:0 reverseShareToken:0 issuerPublicKeyER:0 message:0 messageResponseHandler:&__block_literal_global_1731];
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      uUIDString = [identifierCopy UUIDString];
      *buf = 138543618;
      v16 = v12;
      v17 = 2112;
      v18 = uUIDString;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Could not find matching outgoingInvitation for idsIdentifier %@ to handle decline.", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateOutgoingInvitationState:(id)state
{
  v72 = *MEMORY[0x277D85DE8];
  stateCopy = state;
  v5 = [stateCopy uuidForKey:@"kInvitationIdentifierKey"];
  v6 = [stateCopy numberForKey:@"kInvitationStateKey"];
  v7 = v6;
  if (!v5 || !v6)
  {
    v45 = objc_autoreleasePoolPush();
    selfCopy = self;
    v47 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
    {
      v48 = HMFGetLogIdentifier();
      *buf = 138543362;
      v67 = v48;
      _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Unable to accept the invitation as could not find the invite", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v45);
    v9 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    responseHandler = [stateCopy responseHandler];
    (responseHandler)[2](responseHandler, v9, 0);
LABEL_22:

    goto LABEL_23;
  }

  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v9 = [outgoingInvitations hmf_firstObjectWithValue:v5 forKeyPath:@"identifier"];

  if (v9)
  {
    if ([v7 integerValue] == 1)
    {
      v10 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v13 = HMFGetLogIdentifier();
        identifier = [v9 identifier];
        uUIDString = [identifier UUIDString];
        [MEMORY[0x277CD1A88] homeInvitationStateDescription:1];
        v16 = v60 = v10;
        *buf = 138543874;
        v67 = v13;
        v68 = 2112;
        v69 = uUIDString;
        v70 = 2112;
        v71 = v16;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@[Home] Processing request to update invitation %@ to state %@", buf, 0x20u);

        v10 = v60;
      }

      objc_autoreleasePoolPop(v10);
      if (([v9 invitationState] & 0xFFFFFFFFFFFFFFFDLL) != 4)
      {
        [(HMDHome *)selfCopy2 _sendInvitationCancelationRequestToInvitee:v9];
        v17 = objc_alloc(MEMORY[0x277D0F7A8]);
        workQueue = [(HMDHome *)selfCopy2 workQueue];
        v19 = [v17 initWithQueue:workQueue];

        homeManager = [(HMDHome *)selfCopy2 homeManager];
        homeOwnerCloudShareManager = [homeManager homeOwnerCloudShareManager];
        user = [v9 user];
        v23 = [homeOwnerCloudShareManager revokeAccessForUser:user home:selfCopy2];
        v64[0] = MEMORY[0x277D85DD0];
        v64[1] = 3221225472;
        v64[2] = __48__HMDHome__handleUpdateOutgoingInvitationState___block_invoke;
        v64[3] = &unk_278687050;
        v64[4] = selfCopy2;
        v65 = v9;
        v62[0] = MEMORY[0x277D85DD0];
        v62[1] = 3221225472;
        v62[2] = __48__HMDHome__handleUpdateOutgoingInvitationState___block_invoke_1729;
        v62[3] = &unk_2786882F0;
        v62[4] = selfCopy2;
        v63 = v65;
        v24 = [v23 inContext:v19 then:v64 orRecover:v62];
      }

      backingStore = [(HMDHome *)selfCopy2 backingStore];
      name = [stateCopy name];
      v27 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v28 = [backingStore transaction:name options:v27];

      v29 = [v9 emptyModelObjectWithChangeType:3];
      [v28 add:v29 withMessage:stateCopy];

      pendingUserUUID = [v9 pendingUserUUID];
      if (!pendingUserUUID)
      {
        goto LABEL_26;
      }

      v31 = pendingUserUUID;
      user2 = [v9 user];
      if ([user2 isPending])
      {
        pendingUserUUID2 = [v9 pendingUserUUID];
        [v9 user];
        v34 = v61 = v28;
        uuid = [v34 uuid];
        v59 = [pendingUserUUID2 isEqual:uuid];

        v28 = v61;
        if (!v59)
        {
LABEL_26:
          [v28 run];

          goto LABEL_23;
        }

        v36 = objc_autoreleasePoolPush();
        v37 = selfCopy2;
        v38 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
        {
          v39 = HMFGetLogIdentifier();
          user3 = [v9 user];
          *buf = 138543874;
          v67 = v39;
          v68 = 2112;
          v69 = user3;
          v70 = 2112;
          v71 = v9;
          _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Found pending user [%@] associated with this invitation [%@]. Going to delete it as well.", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v36);
        v41 = [HMDUserModel alloc];
        user4 = [v9 user];
        uuid2 = [user4 uuid];
        uuid3 = [(HMDHome *)v37 uuid];
        v31 = [(HMDBackingStoreModelObject *)v41 initWithObjectChangeType:3 uuid:uuid2 parentUUID:uuid3];

        [v61 add:v31];
      }

      else
      {
      }

      goto LABEL_26;
    }

    responseHandler = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:43 userInfo:0];
    responseHandler2 = [stateCopy responseHandler];
    responseHandler2[2](responseHandler2, responseHandler, 0);

    goto LABEL_22;
  }

  v50 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v52 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
  {
    v53 = HMFGetLogIdentifier();
    uUIDString2 = [v5 UUIDString];
    *buf = 138543618;
    v67 = v53;
    v68 = 2112;
    v69 = uUIDString2;
    _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@Invalid invite identifier specified %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v50);
  v55 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  responseHandler3 = [stateCopy responseHandler];
  (responseHandler3)[2](responseHandler3, v55, 0);

  v9 = 0;
LABEL_23:

  v58 = *MEMORY[0x277D85DE8];
}

uint64_t __48__HMDHome__handleUpdateOutgoingInvitationState___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) user];
    v9 = [v8 uuid];
    v10 = [*(a1 + 32) name];
    v11 = [*(a1 + 32) uuid];
    v14 = 138544130;
    v15 = v7;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully revoked cloud share for canceled invite %@ for home %@/%@", &v14, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __48__HMDHome__handleUpdateOutgoingInvitationState___block_invoke_1729(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) user];
    v9 = [v8 uuid];
    v10 = [*(a1 + 32) name];
    v11 = [*(a1 + 32) uuid];
    v14 = 138544386;
    v15 = v7;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    v22 = 2112;
    v23 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to revoke cloud share for canceled invite %@ for home %@/%@ due to %@", &v14, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)doesThisHomeHaveCameras
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_any:&__block_literal_global_1727];

  return v3;
}

uint64_t __34__HMDHome_doesThisHomeHaveCameras__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = v4;
  if (v4)
  {
    v6 = [v4 hasCameraStreamService];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)_sendInvitation:(id)invitation message:(id)message shareURL:(id)l shareToken:(id)token suppressHomeInviteNotification:(BOOL)notification logEventBuilder:(id)builder
{
  v133[2] = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  messageCopy = message;
  lCopy = l;
  tokenCopy = token;
  builderCopy = builder;
  user = [invitationCopy user];
  accountHandle = [user accountHandle];

  identifier = [invitationCopy identifier];
  endDate = [invitationCopy endDate];
  if (notification)
  {
    isPending = 1;
  }

  else
  {
    user2 = [invitationCopy user];
    isPending = [user2 isPending];
  }

  objc_initWeak(&location, self);
  expirationHandler = [invitationCopy expirationHandler];
  v25 = expirationHandler == 0;

  if (v25)
  {
    workQueue = [(HMDHome *)self workQueue];
    [invitationCopy setClientQueue:workQueue];

    objc_initWeak(from, invitationCopy);
    v105[0] = MEMORY[0x277D85DD0];
    v105[1] = 3221225472;
    v105[2] = __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke;
    v105[3] = &unk_278687590;
    objc_copyWeak(&v107, &location);
    objc_copyWeak(&v108, from);
    v106 = messageCopy;
    [invitationCopy setExpirationHandler:v105];

    objc_destroyWeak(&v108);
    objc_destroyWeak(&v107);
    objc_destroyWeak(from);
  }

  [builderCopy markSendInviteBegin];
  user3 = [invitationCopy user];
  v98[0] = MEMORY[0x277D85DD0];
  v98[1] = 3221225472;
  v99 = __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke_1716;
  v100 = &unk_278681F48;
  objc_copyWeak(&v104, &location);
  v101 = accountHandle;
  v91 = builderCopy;
  v102 = v91;
  v90 = messageCopy;
  v103 = v90;
  v28 = v101;
  v94 = identifier;
  v95 = endDate;
  v97 = lCopy;
  v96 = tokenCopy;
  v29 = user3;
  v92 = v98;
  if (self)
  {
    v30 = objc_autoreleasePoolPush();
    selfCopy = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      v33 = HMFGetLogIdentifier();
      *from = 138543874;
      *&from[4] = v33;
      *&from[12] = 2112;
      *&from[14] = v28;
      *&from[22] = 2112;
      v122 = v29;
      _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Sending invite to: %@ for user: %@", from, 0x20u);
    }

    objc_autoreleasePoolPop(v30);
    homeManager = [(HMDHome *)selfCopy homeManager];
    appleAccountManager = [homeManager appleAccountManager];
    account = [appleAccountManager account];
    handles = [account handles];
    v37 = [handles containsObject:v28];

    if (v37)
    {
      v38 = objc_autoreleasePoolPush();
      v39 = selfCopy;
      v40 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_DEFAULT))
      {
        v41 = HMFGetLogIdentifier();
        *from = 138543618;
        *&from[4] = v41;
        *&from[12] = 2112;
        *&from[14] = v28;
        _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_DEFAULT, "%{public}@Attempt to add local user: %@", from, 0x16u);
      }

      objc_autoreleasePoolPop(v38);
      getPreferredHH2ControllerKey = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      v99(v92, getPreferredHH2ControllerKey);
    }

    else
    {
      keychainStore = [(HMDHome *)selfCopy keychainStore];
      getPreferredHH2ControllerKey = [keychainStore getPreferredHH2ControllerKey];

      if (getPreferredHH2ControllerKey)
      {
        if (!v97 || !v96)
        {
          _HMFPreconditionFailure();
          __break(1u);
        }

        v119 = 0;
        v85 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v96 requiringSecureCoding:1 error:&v119];
        v88 = v119;
        if (v88)
        {
          v44 = objc_autoreleasePoolPush();
          v45 = selfCopy;
          v46 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v46, OS_LOG_TYPE_ERROR))
          {
            v47 = HMFGetLogIdentifier();
            *from = 138543618;
            *&from[4] = v47;
            *&from[12] = 2112;
            *&from[14] = v96;
            _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_ERROR, "%{public}@Failed to encode share token %@", from, 0x16u);
          }

          objc_autoreleasePoolPop(v44);
          v99(v92, v88);
        }

        else
        {
          v132[0] = @"kHomedVersionKey";
          v56 = homedVersion;
          v132[1] = @"kHomedSupportedFeaturesKey";
          v133[0] = v56;
          v133[1] = &unk_283E75590;
          v76 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v133 forKeys:v132 count:2];

          restrictedGuestAccessSettings = [v29 restrictedGuestAccessSettings];
          schedule = [restrictedGuestAccessSettings schedule];

          if (schedule)
          {
            restrictedGuestAccessSettings2 = [v29 restrictedGuestAccessSettings];
            schedule2 = [restrictedGuestAccessSettings2 schedule];
            dictionaryRepresentation = [schedule2 dictionaryRepresentation];
          }

          else
          {
            dictionaryRepresentation = MEMORY[0x277CBEC10];
          }

          v120[0] = *MEMORY[0x277CD23D0];
          name = [(HMDHome *)selfCopy name];
          *from = name;
          v120[1] = *MEMORY[0x277CD0640];
          uuid = [(HMDHome *)selfCopy uuid];
          uUIDString = [uuid UUIDString];
          *&from[8] = uUIDString;
          *&from[16] = v95;
          v120[2] = @"kInvitationExpiryDateKey";
          v120[3] = @"kControllerPublicKey";
          publicKey = [getPreferredHH2ControllerKey publicKey];
          data = [publicKey data];
          v122 = data;
          v120[4] = @"kControllerPairingNameKey";
          identifier2 = [getPreferredHH2ControllerKey identifier];
          v123 = identifier2;
          v120[5] = @"kInvitationIdentifierKey";
          uUIDString2 = [v94 UUIDString];
          v124 = uUIDString2;
          v125 = v76;
          v120[6] = @"kRequestedCapabilitiesKey";
          v120[7] = @"HMDHomeInvitationShareURLKey";
          absoluteString = [v97 absoluteString];
          v126 = absoluteString;
          v127 = v85;
          v120[8] = @"HMDHomeInvitationShareTokenKey";
          v120[9] = @"HMDHomeSuppressInviteNotificationKey";
          v62 = [MEMORY[0x277CCABB0] numberWithBool:isPending];
          v128 = v62;
          v120[10] = *MEMORY[0x277CD0010];
          v63 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v29, "privilege")}];
          v129 = v63;
          v120[11] = *MEMORY[0x277CD0748];
          v64 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome doesThisHomeHaveCameras](selfCopy, "doesThisHomeHaveCameras")}];
          v120[12] = *MEMORY[0x277CD0D18];
          v130 = v64;
          v131 = dictionaryRepresentation;
          v87 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:from forKeys:v120 count:13];

          v65 = [HMDRemoteAccountMessageDestination alloc];
          v66 = objc_alloc(MEMORY[0x277CCAD78]);
          v67 = [v66 initWithUUIDString:*MEMORY[0x277CD23C8]];
          v84 = [(HMDRemoteAccountMessageDestination *)v65 initWithTarget:v67 handle:v28 multicast:1];

          v68 = [MEMORY[0x277D0F848] messageWithName:@"kAccessHomeInviteRequestKey" destination:v84 payload:v87];
          objc_initWeak(&v118, selfCopy);
          v115[0] = MEMORY[0x277D85DD0];
          v115[1] = 3221225472;
          v115[2] = __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke;
          v115[3] = &unk_278689460;
          v115[4] = selfCopy;
          v69 = v28;
          v116 = v69;
          objc_copyWeak(&v117, &v118);
          [v68 setResponseHandler:v115];
          idsInvitationManager = [homeManager idsInvitationManager];
          remoteDestinationString = [(HMDRemoteAccountMessageDestination *)v84 remoteDestinationString];
          isRestrictedGuest = [v29 isRestrictedGuest];
          v110[0] = MEMORY[0x277D85DD0];
          v110[1] = 3221225472;
          v110[2] = __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke_1724;
          v110[3] = &unk_2786702E0;
          objc_copyWeak(&v114, &v118);
          v73 = v94;
          v111 = v73;
          v112 = v69;
          v113 = v92;
          [idsInvitationManager sendInvitationToDestination:remoteDestinationString expirationDate:v95 dictionary:v87 homeInvitationID:v73 isRestrictedGuestInvitation:isRestrictedGuest completionBlock:v110];

          objc_destroyWeak(&v114);
          objc_destroyWeak(&v117);

          objc_destroyWeak(&v118);
        }
      }

      else
      {
        v48 = objc_autoreleasePoolPush();
        v49 = selfCopy;
        v50 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v50, OS_LOG_TYPE_FAULT))
        {
          v51 = HMFGetLogIdentifier();
          *from = 138543362;
          *&from[4] = v51;
          _os_log_impl(&dword_229538000, v50, OS_LOG_TYPE_FAULT, "%{public}@We are doomed. Could not find owner's HH2 Key and we are in HH2. Cannot send the invite.", from, 0xCu);
        }

        objc_autoreleasePoolPop(v48);
        v52 = objc_autoreleasePoolPush();
        v53 = v49;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_ERROR))
        {
          v55 = HMFGetLogIdentifier();
          *from = 138543362;
          *&from[4] = v55;
          _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_ERROR, "%{public}@We are doomed. Could not find owner's HH2 Key and we are in HH2. Cannot send the invite.", from, 0xCu);
        }

        objc_autoreleasePoolPop(v52);
        v89 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2723];
        v99(v92, v89);
      }
    }
  }

  objc_destroyWeak(&v104);
  objc_destroyWeak(&location);

  v74 = *MEMORY[0x277D85DE8];
}

void __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke(id *a1)
{
  v15 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 5);
  v3 = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = WeakRetained;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [v3 identifier];
      v11 = 138543618;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Expiring invitation %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [v3 updateInvitationState:{objc_msgSend(v3, "invitationState")}];
    v9 = [a1[4] name];
    [v5 saveWithReason:v9 postSyncNotification:0];
  }

  v10 = *MEMORY[0x277D85DE8];
}

void __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke_1716(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v3)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 32);
      v18 = 138543874;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to send invite to user, %@, with error: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = *(a1 + 40);
    v12 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3503 underlyingError:v3];
    [v11 markError:v12];
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 32);
      v18 = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Successfully sent invite to user: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 40) markSendInviteEnd];
  }

  v15 = [*(a1 + 48) responseHandler];

  if (v15)
  {
    v16 = [*(a1 + 48) responseHandler];
    (v16)[2](v16, v3, 0);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = *(a1 + 40);
    v25 = 138543618;
    v26 = v10;
    v27 = 2112;
    v28 = v11;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Attempting to send home invitation: %@", &v25, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (v5 && [v5 code] != 8)
  {
    v13 = objc_autoreleasePoolPush();
    v22 = WeakRetained;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = HMFGetLogIdentifier();
      v23 = *(a1 + 40);
      v25 = 138543874;
      v26 = v16;
      v27 = 2112;
      v28 = v23;
      v29 = 2112;
      v30 = v5;
      v18 = "%{public}@Failed to send invitation request to user, %@, due to error: %@";
      v19 = v15;
      v20 = OS_LOG_TYPE_DEFAULT;
      v21 = 32;
      goto LABEL_9;
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = WeakRetained;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = *(a1 + 40);
      v25 = 138543618;
      v26 = v16;
      v27 = 2112;
      v28 = v17;
      v18 = "%{public}@Successfully sent invitation to: %@";
      v19 = v15;
      v20 = OS_LOG_TYPE_INFO;
      v21 = 22;
LABEL_9:
      _os_log_impl(&dword_229538000, v19, v20, v18, &v25, v21);
    }
  }

  objc_autoreleasePoolPop(v13);
  v24 = *MEMORY[0x277D85DE8];
}

void __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke_1724(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 7);
  v8 = WeakRetained;
  if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke_2;
    v10[3] = &unk_278688B58;
    v10[4] = v8;
    v11 = a1[4];
    v12 = v6;
    v13 = a1[5];
    v14 = v5;
    v15 = a1[6];
    dispatch_async(v9, v10);
  }
}

void __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke_2(uint64_t a1)
{
  v35 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outgoingInvitations];
  v3 = [v2 hmf_firstObjectWithValue:*(a1 + 40) forKeyPath:@"identifier"];

  if (*(a1 + 48))
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
LABEL_5:

      objc_autoreleasePoolPop(v4);
      goto LABEL_10;
    }

    v7 = HMFGetLogIdentifier();
    v9 = *(a1 + 48);
    v8 = *(a1 + 56);
    v29 = 138543874;
    v30 = v7;
    v31 = 2112;
    v32 = v8;
    v33 = 2112;
    v34 = v9;
    v10 = "%{public}@Failed to send ids invitation request to user, %@, due to error: %@";
    v11 = v6;
    v12 = OS_LOG_TYPE_ERROR;
LABEL_4:
    _os_log_impl(&dword_229538000, v11, v12, v10, &v29, 0x20u);

    goto LABEL_5;
  }

  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v13 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (!v3)
  {
    if (!v13)
    {
      goto LABEL_5;
    }

    v7 = HMFGetLogIdentifier();
    v27 = *(a1 + 40);
    v28 = *(a1 + 56);
    v29 = 138543874;
    v30 = v7;
    v31 = 2112;
    v32 = v27;
    v33 = 2112;
    v34 = v28;
    v10 = "%{public}@Outgoing invite %@ has been removed while sending it %@";
    v11 = v6;
    v12 = OS_LOG_TYPE_INFO;
    goto LABEL_4;
  }

  if (v13)
  {
    v14 = HMFGetLogIdentifier();
    v15 = *(a1 + 56);
    v16 = *(a1 + 64);
    v29 = 138543874;
    v30 = v14;
    v31 = 2112;
    v32 = v15;
    v33 = 2112;
    v34 = v16;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully sent invitation to: %@, updating home invitation with IDS invite uuid %@", &v29, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v17 = [*(a1 + 32) backingStore];
  v18 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v19 = [v17 transaction:@"kUpdateInvitationStateRequestKey" options:v18];

  v20 = [HMDOutgoingHomeInvitationModel alloc];
  v21 = [v3 identifier];
  v22 = [*(a1 + 32) uuid];
  v23 = [(HMDBackingStoreModelObject *)v20 initWithObjectChangeType:2 uuid:v21 parentUUID:v22];

  [(HMDOutgoingHomeInvitationModel *)v23 setIdsInvitationUUID:*(a1 + 64)];
  v24 = [MEMORY[0x277CBEAA8] now];
  [(HMDOutgoingHomeInvitationModel *)v23 setDateSent:v24];

  [v19 add:v23];
  [v19 run];

LABEL_10:
  v25 = *(a1 + 72);
  if (v25)
  {
    (*(v25 + 16))(v25, *(a1 + 48));
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)_addOutgoingInvitations:(id)invitations message:(id)message transactionCompleted:(id)completed
{
  v46 = *MEMORY[0x277D85DE8];
  invitationsCopy = invitations;
  messageCopy = message;
  completedCopy = completed;
  backingStore = [(HMDHome *)self backingStore];
  v33 = messageCopy;
  name = [messageCopy name];
  v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v13 = [backingStore transaction:name options:v12];

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  obj = invitationsCopy;
  v34 = [obj countByEnumeratingWithState:&v35 objects:v45 count:16];
  if (v34)
  {
    v32 = *v36;
    do
    {
      for (i = 0; i != v34; ++i)
      {
        if (*v36 != v32)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v35 + 1) + 8 * i);
        [v15 setHome:self];
        v16 = [v15 modelObjectWithChangeType:1 version:4];
        [v13 add:v16 withMessage:v33];
        user = [v15 user];
        userID = [user userID];

        pendingUsers = [(HMDHome *)self pendingUsers];
        v20 = [pendingUsers hmf_firstObjectWithValue:userID forKeyPath:@"userID"];

        if (v20)
        {
          v21 = objc_autoreleasePoolPush();
          selfCopy = self;
          v23 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
          {
            v24 = HMFGetLogIdentifier();
            *buf = 138543874;
            v40 = v24;
            v41 = 2112;
            v42 = v20;
            v43 = 2112;
            v44 = userID;
            _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Found stale pending user instance %@ that we need to remove since the owner is manually re-inviting %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v21);
          v25 = [HMDUserModel alloc];
          uuid = [v20 uuid];
          uuid2 = [(HMDHome *)selfCopy uuid];
          v28 = [(HMDBackingStoreModelObject *)v25 initWithObjectChangeType:3 uuid:uuid parentUUID:uuid2];

          [v13 add:v28];
        }
      }

      v34 = [obj countByEnumeratingWithState:&v35 objects:v45 count:16];
    }

    while (v34);
  }

  [(HMDHome *)self _saveOutgoingInvitationsWithRestrictedGuestSettings:obj inTransaction:v13 message:v33 transactionCompleted:completedCopy];
  v29 = *MEMORY[0x277D85DE8];
}

- (id)_outgoingInvitationForUserWithHandle:(id)handle
{
  v20 = *MEMORY[0x277D85DE8];
  handleCopy = handle;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v6 = [outgoingInvitations countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(outgoingInvitations);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        user = [v9 user];
        accountHandle = [user accountHandle];
        v12 = [accountHandle isEqual:handleCopy];

        if (v12)
        {
          v6 = v9;
          goto LABEL_11;
        }
      }

      v6 = [outgoingInvitations countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)_processOutgoingInvitationsRequest:(id)request
{
  v48[2] = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = [requestCopy dataForKey:@"HM.invitations"];
  if (v5)
  {
    v6 = MEMORY[0x277CCAAC8];
    v7 = MEMORY[0x277CBEB98];
    v48[0] = objc_opt_class();
    v48[1] = objc_opt_class();
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v48 count:2];
    v9 = [v7 setWithArray:v8];
    v41 = 0;
    v10 = [v6 unarchivedObjectOfClasses:v9 fromData:v5 error:&v41];
    v11 = v41;

    if (v10)
    {
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke;
      aBlock[3] = &unk_27868A010;
      v12 = requestCopy;
      v38 = v12;
      selfCopy = self;
      v13 = v10;
      v40 = v13;
      v14 = _Block_copy(aBlock);
      featuresDataSource = [(HMDHome *)self featuresDataSource];
      isHomeActivityStateFeatureEnabled = [featuresDataSource isHomeActivityStateFeatureEnabled];

      if (isHomeActivityStateFeatureEnabled)
      {
        v34[0] = MEMORY[0x277D85DD0];
        v34[1] = 3221225472;
        v34[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_4;
        v34[3] = &unk_278689358;
        v34[4] = self;
        v35 = v12;
        v36 = v14;
        v17 = _Block_copy(v34);
        dataSource = [(HMDHome *)self dataSource];
        idsIDQueryController = [dataSource idsIDQueryController];
        [(HMDHome *)self verifyAdaptiveTemperatureAutomationsEnabledHomeShouldSendInvitations:v13 withQueryController:idsIDQueryController completion:v17];
      }

      else
      {
        v14[2](v14);
      }

      v32 = v38;
    }

    else
    {
      v26 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
      {
        v29 = HMFGetLogIdentifier();
        identifier = [requestCopy identifier];
        uUIDString = [identifier UUIDString];
        *buf = 138543874;
        v43 = v29;
        v44 = 2112;
        v45 = uUIDString;
        v46 = 2112;
        v47 = v11;
        _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@Failed to unarchive outgoing home invitations from serialized outgoing home invitation data: %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v26);
      v32 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      [requestCopy respondWithError:v32];
    }
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      identifier2 = [requestCopy identifier];
      uUIDString2 = [identifier2 UUIDString];
      *buf = 138543618;
      v43 = v23;
      v44 = 2112;
      v45 = uUIDString2;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Unable to find outgoing invitations to add for message: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v11 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    [requestCopy respondWithError:v11];
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__processOutgoingInvitationsRequest___block_invoke(id *a1)
{
  v2 = [a1[4] BOOLForKey:@"HMDHomeSuppressInviteNotificationKey"];
  objc_initWeak(&location, a1[5]);
  v4 = a1[5];
  v3 = a1[6];
  v5 = a1[4];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_2;
  v6[3] = &unk_278681A08;
  objc_copyWeak(&v8, &location);
  v7 = a1[6];
  v9 = v2;
  [v4 _addOutgoingInvitations:v3 message:v5 transactionCompleted:v6];

  objc_destroyWeak(&v8);
  objc_destroyWeak(&location);
}

void __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_4(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Rejecting invitations with verification error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 40) respondWithError:v3];
  }

  else
  {
    (*(*(a1 + 48) + 16))();
  }

  v8 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_3;
  block[3] = &unk_278688BD0;
  block[4] = WeakRetained;
  v5 = *(a1 + 32);
  v6 = *(a1 + 48);
  dispatch_async(v3, block);
}

- (void)_handleOutgoingInvitations:(id)invitations
{
  invitationsCopy = invitations;
  residentSyncManager = [(HMDHome *)self residentSyncManager];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __38__HMDHome__handleOutgoingInvitations___block_invoke;
  v6[3] = &unk_27868A398;
  v6[4] = self;
  [residentSyncManager interceptRemoteResidentRequest:invitationsCopy proceed:v6];
}

- (void)setOverriddenHomeAccessControl:(id)control
{
  controlCopy = control;
  os_unfair_recursive_lock_lock_with_options();
  overriddenHomeAccessControl = self->_overriddenHomeAccessControl;
  self->_overriddenHomeAccessControl = controlCopy;

  os_unfair_recursive_lock_unlock();
}

- (NSNumber)overriddenHomeAccessControl
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_overriddenHomeAccessControl;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)handleCurrentUserPrivilegeChanged:(id)changed
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __45__HMDHome_handleCurrentUserPrivilegeChanged___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

uint64_t __45__HMDHome_handleCurrentUserPrivilegeChanged___block_invoke(uint64_t a1)
{
  v29 = *MEMORY[0x277D85DE8];
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 32);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 32) currentUser];
      v7 = [v6 privilege];
      if (v7 > 5)
      {
        v8 = @"None";
      }

      else
      {
        v8 = off_278684178[v7];
      }

      v9 = v8;
      v10 = [*(a1 + 32) fabric];
      v11 = [v10 accessControl];
      [v11 currentUserPrivilege];
      v12 = HMMTRUserPrivilegeAsString();
      v23 = 138543874;
      v24 = v5;
      v25 = 2112;
      v26 = v9;
      v27 = 2112;
      v28 = v12;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Updating Fabric user privilege to %@ from priv %@", &v23, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
    v13 = [*(a1 + 32) currentUser];
    v14 = +[HMDUser hmmtrUserPrivilegeFromHMDUserPrivilege:](HMDUser, "hmmtrUserPrivilegeFromHMDUserPrivilege:", [v13 privilege]);
    v15 = [*(a1 + 32) fabric];
    v16 = [v15 accessControl];
    [v16 setCurrentUserPrivilege:v14];
  }

  [*(a1 + 32) _evaluateNetworkProtectionAndRouterManagement];
  v17 = objc_autoreleasePoolPush();
  v18 = *(a1 + 32);
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v23 = 138543362;
    v24 = v20;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - handleCurrentUserPrivilegeChanged", &v23, 0xCu);
  }

  objc_autoreleasePoolPop(v17);
  result = [*(a1 + 32) _configureUserActivityStateDetectorManager];
  v22 = *MEMORY[0x277D85DE8];
  return result;
}

- (BOOL)_shouldResendOutgoingInvitation:(id)invitation
{
  v19 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  dateSent = [invitationCopy dateSent];
  v6 = +[HMDHomeInvitation noRetryDate];
  v7 = [dateSent isEqualToDate:v6];

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v11;
      v17 = 2112;
      v18 = invitationCopy;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Should not resend abandoned invitation %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    goto LABEL_7;
  }

  if ([invitationCopy invitationState] != 2)
  {
LABEL_7:
    LOBYTE(v12) = 0;
    goto LABEL_8;
  }

  v12 = ![(HMDHome *)self _justSentInvitation:invitationCopy];
LABEL_8:

  v13 = *MEMORY[0x277D85DE8];
  return v12;
}

- (BOOL)_justSentInvitation:(id)invitation
{
  v23 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  dateSent = [invitationCopy dateSent];
  if (dateSent)
  {
    dateSent2 = [invitationCopy dateSent];
    [dateSent2 timeIntervalSinceNow];
    v8 = fabs(v7);
    v9 = vabdd_f64(60.0, v8) >= 2.22044605e-16 && v8 < 60.0;
  }

  else
  {
    v9 = 0;
  }

  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    v17 = 138543874;
    v18 = v13;
    v19 = 2112;
    v20 = invitationCopy;
    v21 = 2112;
    v22 = v14;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Invitation %@ was just sent: %@", &v17, 0x20u);
  }

  objc_autoreleasePoolPop(v10);
  v15 = *MEMORY[0x277D85DE8];
  return v9;
}

- (id)outgoingInvitationToResendForUser:(id)user
{
  v38 = *MEMORY[0x277D85DE8];
  userCopy = user;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  v25 = selfCopy;
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    outgoingInvitations = [(HMDHome *)selfCopy outgoingInvitations];
    *buf = 138543618;
    v32 = v8;
    v33 = 2048;
    v34 = [outgoingInvitations count];
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@There are %lu outgoing invitations", buf, 0x16u);

    selfCopy = v25;
  }

  objc_autoreleasePoolPop(v5);
  v29 = 0u;
  v30 = 0u;
  v27 = 0u;
  v28 = 0u;
  obj = [(HMDHome *)selfCopy outgoingInvitations];
  v10 = [obj countByEnumeratingWithState:&v27 objects:v37 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v28;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v28 != v12)
        {
          objc_enumerationMutation(obj);
        }

        v14 = *(*(&v27 + 1) + 8 * i);
        v15 = objc_autoreleasePoolPush();
        v16 = selfCopy;
        v17 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
        {
          v18 = HMFGetLogIdentifier();
          user = [v14 user];
          *buf = 138543874;
          v32 = v18;
          v33 = 2112;
          v34 = user;
          v35 = 2112;
          v36 = userCopy;
          _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_DEBUG, "%{public}@Inspecting outgoing invite to user %@ to see if it matches %@", buf, 0x20u);

          selfCopy = v25;
        }

        objc_autoreleasePoolPop(v15);
        user2 = [v14 user];
        if ([user2 isAccountEqualWithUser:userCopy])
        {
          v21 = [(HMDHome *)v16 _shouldResendOutgoingInvitation:v14];

          if (v21)
          {
            v22 = v14;
            goto LABEL_17;
          }
        }

        else
        {
        }
      }

      v11 = [obj countByEnumeratingWithState:&v27 objects:v37 count:16];
    }

    while (v11);
  }

  v22 = 0;
LABEL_17:

  v23 = *MEMORY[0x277D85DE8];

  return v22;
}

- (void)removeRemovedUser:(id)user
{
  userCopy = user;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_removedUsers removeObject:userCopy];
  os_unfair_recursive_lock_unlock();
}

- (BOOL)containsRemovedUser:(id)user
{
  v16 = *MEMORY[0x277D85DE8];
  userCopy = user;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  removedUsers = [(HMDHome *)self removedUsers];
  v6 = [removedUsers countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v6)
  {
    v7 = *v12;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(removedUsers);
        }

        if ([*(*(&v11 + 1) + 8 * i) isEqualToUser:userCopy])
        {
          LOBYTE(v6) = 1;
          goto LABEL_11;
        }
      }

      v6 = [removedUsers countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v9 = *MEMORY[0x277D85DE8];
  return v6;
}

- (void)_refreshUserDisplayNames
{
  v49 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB58] set];
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  selfCopy = self;
  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v5 = [outgoingInvitations countByEnumeratingWithState:&v39 objects:v48 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v40;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v40 != v7)
        {
          objc_enumerationMutation(outgoingInvitations);
        }

        v9 = *(*(&v39 + 1) + 8 * i);
        if ([v9 refreshDisplayName])
        {
          if (isInternalBuild())
          {
            v10 = MEMORY[0x277CCACA8];
            uuid = [v9 uuid];
            v12 = [v10 stringWithFormat:@"OutgoingInviteDisplayNameUpdate_%@", uuid];
            [v3 addObject:v12];
          }

          else
          {
            [v3 addObject:@"OutgoingInviteDisplayNameUpdate"];
          }
        }
      }

      v6 = [outgoingInvitations countByEnumeratingWithState:&v39 objects:v48 count:16];
    }

    while (v6);
  }

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  users = [(HMDHome *)selfCopy users];
  v14 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v36;
    do
    {
      for (j = 0; j != v15; ++j)
      {
        if (*v36 != v16)
        {
          objc_enumerationMutation(users);
        }

        v18 = *(*(&v35 + 1) + 8 * j);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (!v20 && [v18 refreshDisplayName])
        {
          if (isInternalBuild())
          {
            v21 = MEMORY[0x277CCACA8];
            uuid2 = [v18 uuid];
            v23 = [v21 stringWithFormat:@"UserDisplayNameUpdate_%@", uuid2];
            [v3 addObject:v23];
          }

          else
          {
            [v3 addObject:@"UserDisplayNameUpdate"];
          }
        }
      }

      v15 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
    }

    while (v15);
  }

  if ([v3 count])
  {
    v24 = objc_autoreleasePoolPush();
    v25 = selfCopy;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      allObjects = [v3 allObjects];
      v29 = [allObjects componentsJoinedByString:{@", "}];
      *buf = 138543618;
      v44 = v27;
      v45 = 2112;
      v46 = v29;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@User display names updated: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    [(HMDHome *)v25 saveToCurrentAccountWithReason:@"userDisplayNameUpdated"];
    home = [(HMDHome *)v25 home];
    homeManager = [home homeManager];
    uuid3 = [(HMDHome *)v25 uuid];
    [homeManager updateGenerationCounterWithReason:@"userDisplayNameUpdated" sourceUUID:uuid3 shouldNotifyClients:1];
  }

  v33 = *MEMORY[0x277D85DE8];
}

- (void)refreshUserDisplayNames
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __34__HMDHome_refreshUserDisplayNames__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)_addUserToContainer:(id)container
{
  v16[1] = *MEMORY[0x277D85DE8];
  containerCopy = container;
  [(HMDHome *)self addUser:containerCopy];
  presenceMonitor = [(HMDHome *)self presenceMonitor];
  [presenceMonitor addNewUser:containerCopy];

  notificationCenter = [(HMDHome *)self notificationCenter];
  v15 = @"HMDUserNotificationKey";
  v16[0] = containerCopy;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v16 forKeys:&v15 count:1];
  [notificationCenter postNotificationName:@"HMDHomeUserAddedNotification" object:self userInfo:v7];

  [(HMDHome *)self updateCATIDForUsersIfNeeded:0];
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v13 = 138543362;
    v14 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Setting up shared user fabric data per user addition", &v13, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  [(HMDHome *)selfCopy setUpSharedUserFabricDataWithForceFetch:0 completion:0];

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_removeUserFromContainer:(id)container
{
  v10[1] = *MEMORY[0x277D85DE8];
  containerCopy = container;
  presenceMonitor = [(HMDHome *)self presenceMonitor];
  [presenceMonitor removeUser:containerCopy];

  [containerCopy removeCloudData];
  [(HMDHome *)self _removeUser:containerCopy];
  [containerCopy unconfigure];
  notificationCenter = [(HMDHome *)self notificationCenter];
  v9 = @"HMDUserNotificationKey";
  v10[0] = containerCopy;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v10 forKeys:&v9 count:1];

  [notificationCenter postNotificationName:@"HMDHomeUserRemovedNotification" object:self userInfo:v7];
  v8 = *MEMORY[0x277D85DE8];
}

- (id)findAdditionalUUIDsForUser:(id)user
{
  userCopy = user;
  v14 = 0;
  v15 = &v14;
  v16 = 0x3032000000;
  v17 = __Block_byref_object_copy__14759;
  v18 = __Block_byref_object_dispose__14760;
  v19 = 0;
  backingStore = [(HMDHome *)self backingStore];
  context = [backingStore context];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __38__HMDHome_findAdditionalUUIDsForUser___block_invoke;
  v10[3] = &unk_27868A4D8;
  v7 = userCopy;
  v11 = v7;
  selfCopy = self;
  v13 = &v14;
  [context unsafeSynchronousBlock:v10];

  v8 = v15[5];
  _Block_object_dispose(&v14, 8);

  return v8;
}

void __38__HMDHome_findAdditionalUUIDsForUser___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findUserWithModelID:v2];

  if (v3)
  {
    v4 = [v3 additionalModelsForSameUser];
    v5 = v4;
    if (v4)
    {
      if ([v4 count])
      {
        v6 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v5, "count")}];
        v24[0] = MEMORY[0x277D85DD0];
        v24[1] = 3221225472;
        v24[2] = __38__HMDHome_findAdditionalUUIDsForUser___block_invoke_1699;
        v24[3] = &unk_2786702B8;
        v25 = v6;
        v7 = v6;
        [v5 hmf_enumerateWithAutoreleasePoolUsingBlock:v24];
        v8 = [v7 copy];
        v9 = *(*(a1 + 48) + 8);
        v10 = *(v9 + 40);
        *(v9 + 40) = v8;
      }

      else
      {
        v20 = [MEMORY[0x277CBEB98] set];
        v21 = *(*(a1 + 48) + 8);
        v22 = *(v21 + 40);
        *(v21 + 40) = v20;
      }
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = *(a1 + 40);
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v19 = HMFGetLogIdentifier();
        *buf = 138543618;
        v27 = v19;
        v28 = 2112;
        v29 = v3;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to find potential additional users with model: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [*(a1 + 32) uuid];
      *buf = 138543618;
      v27 = v14;
      v28 = 2112;
      v29 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to find user model with modelID %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
  }

  v23 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome_findAdditionalUUIDsForUser___block_invoke_1699(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 modelID];
  [v2 addObject:v3];
}

- (void)_removeUser:(id)user message:(id)message
{
  v32 = *MEMORY[0x277D85DE8];
  userCopy = user;
  messageCopy = message;
  if (shouldLogPrivateInformation())
  {
    userID = [userCopy userID];
  }

  else
  {
    userID = @"...";
    v9 = @"...";
  }

  pairingIdentity = [userCopy pairingIdentity];

  if (pairingIdentity)
  {
    homeManager = [(HMDHome *)self homeManager];
    if (isFeatureMatterLocalFabricConfigEnabled() && (![userCopy privilege] || objc_msgSend(userCopy, "privilege") == 4))
    {
      v27[0] = MEMORY[0x277D85DD0];
      v27[1] = 3221225472;
      v27[2] = __31__HMDHome__removeUser_message___block_invoke;
      v27[3] = &unk_2786845E8;
      v27[4] = self;
      [(HMDHome *)self incrementOperatePrivilegeCATVersion:v27];
    }

    backingStore = [homeManager backingStore];
    v13 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v14 = [backingStore transaction:@"kUserManagementOperationAddedKey" options:v13];

    responseHandler = dispatch_group_create();
    workQueue = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __31__HMDHome__removeUser_message___block_invoke_2;
    block[3] = &unk_2786891E0;
    block[4] = self;
    v24 = v14;
    v25 = userCopy;
    v26 = messageCopy;
    v17 = v14;
    dispatch_group_notify(responseHandler, workQueue, block);

    goto LABEL_14;
  }

  v18 = objc_autoreleasePoolPush();
  selfCopy = self;
  v20 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
  {
    v21 = HMFGetLogIdentifier();
    *buf = 138543618;
    v29 = v21;
    v30 = 2112;
    v31 = userID;
    _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve user with name: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v18);
  if (messageCopy)
  {
    homeManager = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    responseHandler = [messageCopy responseHandler];
    (*(responseHandler + 16))(responseHandler, homeManager, 0);
LABEL_14:
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __31__HMDHome__removeUser_message___block_invoke_2(uint64_t a1)
{
  objc_initWeak(&location, *(a1 + 32));
  v2 = *(a1 + 40);
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __31__HMDHome__removeUser_message___block_invoke_3;
  v3[3] = &unk_278685D08;
  objc_copyWeak(&v6, &location);
  v4 = *(a1 + 48);
  v5 = *(a1 + 56);
  [v2 run:v3];

  objc_destroyWeak(&v6);
  objc_destroyWeak(&location);
}

void __31__HMDHome__removeUser_message___block_invoke_3(id *a1, void *a2)
{
  v48 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v31 = v3;
    v6 = [WeakRetained backingStore];
    v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v8 = [v6 transaction:@"kRemoveUserRequestKey" options:v7];

    v9 = [v5 __modelObjectsForRemovingOutgoingInvitationForUser:a1[4]];
    [v8 addObjects:v9];

    v41 = 0u;
    v42 = 0u;
    v40 = 0u;
    v39 = 0u;
    v10 = [v5 triggers];
    v11 = [v10 countByEnumeratingWithState:&v39 objects:v43 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v40;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v40 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v39 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v16 = v15;
          }

          else
          {
            v16 = 0;
          }

          v17 = v16;

          [v17 handleRemovalOfUser:a1[4] transaction:v8];
        }

        v12 = [v10 countByEnumeratingWithState:&v39 objects:v43 count:16];
      }

      while (v12);
    }

    v18 = objc_alloc(MEMORY[0x277D0F7A8]);
    v19 = [v5 workQueue];
    v20 = [v18 initWithQueue:v19];

    v21 = [v5 homeManager];
    v22 = [v21 homeOwnerCloudShareManager];
    v23 = [v22 revokeAccessForUser:a1[4] home:v5];
    v35[0] = MEMORY[0x277D85DD0];
    v35[1] = 3221225472;
    v35[2] = __31__HMDHome__removeUser_message___block_invoke_1694;
    v35[3] = &unk_278686878;
    v35[4] = v5;
    v36 = a1[4];
    v37 = v8;
    v38 = a1[5];
    v32[0] = MEMORY[0x277D85DD0];
    v32[1] = 3221225472;
    v32[2] = __31__HMDHome__removeUser_message___block_invoke_1698;
    v32[3] = &unk_278685D80;
    v32[4] = v5;
    v33 = a1[4];
    v34 = a1[5];
    v24 = v8;
    v25 = [v23 inContext:v20 then:v35 orRecover:v32];

    v3 = v31;
  }

  else
  {
    v26 = objc_autoreleasePoolPush();
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      v29 = a1[4];
      *buf = 138543618;
      v45 = v28;
      v46 = 2112;
      v47 = v29;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Home disappeared, cannot remove user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v26);
  }

  v30 = *MEMORY[0x277D85DE8];
}

uint64_t __31__HMDHome__removeUser_message___block_invoke_1694(id *a1, void *a2)
{
  v37 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = a1[4];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [a1[5] uuid];
    v9 = [a1[4] name];
    v10 = [a1[4] uuid];
    *buf = 138544130;
    v30 = v7;
    v31 = 2112;
    v32 = v8;
    v33 = 2112;
    v34 = v9;
    v35 = 2112;
    v36 = v10;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully revoked cloud share for shared user %@ for home %@/%@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v11 = [HMDUserModel alloc];
  v12 = [a1[5] uuid];
  v13 = [a1[4] uuid];
  v14 = [(HMDBackingStoreModelObject *)v11 initWithObjectChangeType:3 uuid:v12 parentUUID:v13];

  [a1[6] add:v14];
  v15 = [a1[4] findAdditionalUUIDsForUser:a1[5]];
  if ([v15 count])
  {
    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __31__HMDHome__removeUser_message___block_invoke_1695;
    v27[3] = &unk_278676860;
    v27[4] = a1[4];
    v28 = a1[6];
    [v15 hmf_enumerateWithAutoreleasePoolUsingBlock:v27];
  }

  v16 = objc_autoreleasePoolPush();
  v17 = a1[4];
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    v20 = a1[5];
    v21 = [a1[6] objects];
    *buf = 138543874;
    v30 = v19;
    v31 = 2112;
    v32 = v20;
    v33 = 2112;
    v34 = v21;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Going to run V4 transaction to remove user: %@ / %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v16);
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __31__HMDHome__removeUser_message___block_invoke_1697;
  v25[3] = &unk_27868A1D8;
  v25[4] = a1[4];
  v22 = a1[6];
  v26 = a1[7];
  [v22 run:v25];

  v23 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __31__HMDHome__removeUser_message___block_invoke_1698(uint64_t a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) uuid];
    v9 = [*(a1 + 32) name];
    v10 = [*(a1 + 32) uuid];
    v15 = 138544386;
    v16 = v7;
    v17 = 2112;
    v18 = v8;
    v19 = 2112;
    v20 = v9;
    v21 = 2112;
    v22 = v10;
    v23 = 2112;
    v24 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to revoke cloud share for shared user %@ for home %@/%@ due to %@", &v15, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *(a1 + 48);
  v12 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:52 userInfo:0];
  [v11 respondWithError:v12];

  v13 = *MEMORY[0x277D85DE8];
  return 1;
}

void __31__HMDHome__removeUser_message___block_invoke_1695(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [HMDUserModel alloc];
  v5 = [*(a1 + 32) uuid];
  v6 = [(HMDBackingStoreModelObject *)v4 initWithObjectChangeType:3 uuid:v3 parentUUID:v5];

  [*(a1 + 40) add:v6];
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v12 = 138543618;
    v13 = v10;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Created transaction to remove duplicate user with UUID %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *MEMORY[0x277D85DE8];
}

void __31__HMDHome__removeUser_message___block_invoke_1697(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit removeUser transaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  [*(a1 + 40) respondWithPayload:0 error:v3];

  v8 = *MEMORY[0x277D85DE8];
}

- (id)__modelObjectsForRemovingOutgoingInvitationForUser:(id)user
{
  v52 = *MEMORY[0x277D85DE8];
  userCopy = user;
  if (userCopy)
  {
    v45 = 0u;
    v46 = 0u;
    v43 = 0u;
    v44 = 0u;
    outgoingInvitations = [(HMDHome *)self outgoingInvitations];
    v6 = [outgoingInvitations countByEnumeratingWithState:&v43 objects:v51 count:16];
    if (v6)
    {
      selfCopy = self;
      v7 = *v44;
LABEL_4:
      v8 = 0;
      while (1)
      {
        if (*v44 != v7)
        {
          objc_enumerationMutation(outgoingInvitations);
        }

        v9 = *(*(&v43 + 1) + 8 * v8);
        user = [v9 user];
        if (user)
        {
          userID = [userCopy userID];
          userID2 = [user userID];
          v13 = [userID isEqualToString:userID2];

          if (v13)
          {
            break;
          }
        }

        if (v6 == ++v8)
        {
          v6 = [outgoingInvitations countByEnumeratingWithState:&v43 objects:v51 count:16];
          if (v6)
          {
            goto LABEL_4;
          }

          v14 = outgoingInvitations;
          v15 = MEMORY[0x277CBEBF8];
          goto LABEL_23;
        }
      }

      v14 = v9;
      if ([user isPending])
      {
        v6 = user;
      }

      else
      {
        v6 = 0;
      }

      if (!v14)
      {
        v15 = MEMORY[0x277CBEBF8];
        goto LABEL_25;
      }

      v16 = [MEMORY[0x277CBEB18] arrayWithCapacity:2];
      v17 = objc_alloc(MEMORY[0x277D0F7A8]);
      workQueue = [(HMDHome *)selfCopy workQueue];
      v19 = [v17 initWithQueue:workQueue];

      homeManager = [(HMDHome *)selfCopy homeManager];
      homeOwnerCloudShareManager = [homeManager homeOwnerCloudShareManager];
      v22 = [homeOwnerCloudShareManager revokeAccessForUser:userCopy home:selfCopy];
      v41[0] = MEMORY[0x277D85DD0];
      v41[1] = 3221225472;
      v41[2] = __62__HMDHome___modelObjectsForRemovingOutgoingInvitationForUser___block_invoke;
      v41[3] = &unk_278687050;
      v41[4] = selfCopy;
      v42 = userCopy;
      v39[0] = MEMORY[0x277D85DD0];
      v39[1] = 3221225472;
      v39[2] = __62__HMDHome___modelObjectsForRemovingOutgoingInvitationForUser___block_invoke_1691;
      v39[3] = &unk_2786882F0;
      v39[4] = selfCopy;
      v40 = v42;
      v23 = [v22 inContext:v19 then:v41 orRecover:v39];

      v24 = [HMDOutgoingHomeInvitationModel alloc];
      identifier = [v14 identifier];
      uuid = [(HMDHome *)selfCopy uuid];
      v27 = [(HMDBackingStoreModelObject *)v24 initWithObjectChangeType:3 uuid:identifier parentUUID:uuid];

      [v16 addObject:v27];
      if (v6)
      {
        v28 = objc_autoreleasePoolPush();
        v29 = selfCopy;
        v30 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
        {
          v31 = HMFGetLogIdentifier();
          *buf = 138543618;
          v48 = v31;
          v49 = 2112;
          v50 = v6;
          _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Going to remove pending user with invitation : %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v28);
        v32 = [HMDUserModel alloc];
        uuid2 = [v6 uuid];
        uuid3 = [(HMDHome *)v29 uuid];
        v35 = [(HMDBackingStoreModelObject *)v32 initWithObjectChangeType:3 uuid:uuid2 parentUUID:uuid3];

        [v16 addObject:v35];
      }

      v15 = [v16 copy];
    }

    else
    {
      v15 = MEMORY[0x277CBEBF8];
      v14 = outgoingInvitations;
    }

LABEL_23:

LABEL_25:
  }

  else
  {
    v15 = MEMORY[0x277CBEBF8];
  }

  v36 = *MEMORY[0x277D85DE8];

  return v15;
}

uint64_t __62__HMDHome___modelObjectsForRemovingOutgoingInvitationForUser___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) uuid];
    v9 = [*(a1 + 32) name];
    v10 = [*(a1 + 32) uuid];
    v13 = 138544130;
    v14 = v7;
    v15 = 2112;
    v16 = v8;
    v17 = 2112;
    v18 = v9;
    v19 = 2112;
    v20 = v10;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully revoked cloud share for pending user %@ for home %@/%@", &v13, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __62__HMDHome___modelObjectsForRemovingOutgoingInvitationForUser___block_invoke_1691(uint64_t a1, void *a2)
{
  v23 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) uuid];
    v9 = [*(a1 + 32) name];
    v10 = [*(a1 + 32) uuid];
    v13 = 138544386;
    v14 = v7;
    v15 = 2112;
    v16 = v8;
    v17 = 2112;
    v18 = v9;
    v19 = 2112;
    v20 = v10;
    v21 = 2112;
    v22 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to revoke cloud share for pending user %@ for home %@/%@ due to %@", &v13, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

- (void)_removeOutgoingInvitationForUser:(id)user
{
  userCopy = user;
  v5 = [(HMDHome *)self __modelObjectsForRemovingOutgoingInvitationForUser:userCopy];
  if (([v5 hmf_isEmpty] & 1) == 0)
  {
    backingStore = [(HMDHome *)self backingStore];
    v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v8 = [backingStore transaction:@"removeOutgoingInvitation" options:v7];

    [v8 addObjects:v5];
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __44__HMDHome__removeOutgoingInvitationForUser___block_invoke;
    v9[3] = &unk_278688D58;
    v9[4] = self;
    v10 = userCopy;
    v11 = v5;
    [v8 run:v9];
  }
}

void __44__HMDHome__removeOutgoingInvitationForUser___block_invoke(uint64_t a1, void *a2)
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 40);
      v9 = *(a1 + 48);
      v11 = 138544130;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      v15 = 2112;
      v16 = v9;
      v17 = 2112;
      v18 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to run transaction to remove the invitation for the user: %@ / %@ / %@", &v11, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)removeUser:(id)user
{
  v16 = *MEMORY[0x277D85DE8];
  userCopy = user;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v13 = v8;
    v14 = 2112;
    v15 = userCopy;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to remove user: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __22__HMDHome_removeUser___block_invoke;
  v11[3] = &unk_278689DC0;
  v11[4] = selfCopy;
  v9 = [MEMORY[0x277D0F818] messageWithName:@"kDataSyncResponseNAckKey" messagePayload:0 responseHandler:v11];
  [(HMDHome *)selfCopy _removeUser:userCopy message:v9];

  v10 = *MEMORY[0x277D85DE8];
}

void __22__HMDHome_removeUser___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v10;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Failed to remove user due to %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)removeUserWithUserID:(id)d
{
  dCopy = d;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __32__HMDHome_removeUserWithUserID___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = dCopy;
  v6 = dCopy;
  dispatch_async(workQueue, v7);
}

void __32__HMDHome_removeUserWithUserID___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) users];
  v4 = [v2 hmf_firstObjectWithValue:*(a1 + 40) forKeyPath:@"userID"];

  v3 = v4;
  if (v4)
  {
    [*(a1 + 32) removeUser:v4];
    v3 = v4;
  }
}

- (void)_handleRemoveUser:(id)user
{
  v56 = *MEMORY[0x277D85DE8];
  userCopy = user;
  if ([userCopy isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(userCopy, "isRemote"))
  {
    v5 = [userCopy uuidForKey:@"kUserUUIDKey"];
    if (v5)
    {
      v6 = [userCopy stringForKey:*MEMORY[0x277CD1450]];
      if (v6)
      {
        goto LABEL_9;
      }

      v7 = objc_autoreleasePoolPush();
      selfCopy = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        uUIDString = [v5 UUIDString];
        *buf = 138543618;
        *&buf[4] = v10;
        *&buf[12] = 2112;
        *&buf[14] = uUIDString;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Message does not contain a mergeID for user being removed, looking mergeID from UUID: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      v12 = v5;
      v13 = v12;
      if (selfCopy)
      {
        v45 = &v44;
        v46 = 0x3032000000;
        v47 = __Block_byref_object_copy__14759;
        v48 = __Block_byref_object_dispose__14760;
        v49 = 0;
        backingStore = [(HMDHome *)selfCopy backingStore];
        context = [backingStore context];

        managedObjectContext = [context managedObjectContext];
        *buf = MEMORY[0x277D85DD0];
        *&buf[8] = 3221225472;
        *&buf[16] = __35__HMDHome__findMergeIDForUserUUID___block_invoke;
        v51 = &unk_278689D20;
        v17 = v13;
        v52 = v17;
        v18 = managedObjectContext;
        v53 = v18;
        v54 = selfCopy;
        v55 = &v44;
        [context unsafeSynchronousBlock:buf];
        v6 = v45[5];

        _Block_object_dispose(&v44, 8);
        if (v6)
        {
LABEL_9:
          v19 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v21 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            v22 = HMFGetLogIdentifier();
            *buf = 138543618;
            *&buf[4] = v22;
            *&buf[12] = 2112;
            *&buf[14] = v6;
            _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Looking for user based on mergeID: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v19);
          v23 = [(HMDHome *)selfCopy2 userWithMergeID:v6];
          if (v23)
          {
            goto LABEL_13;
          }
        }
      }

      else
      {

        v6 = 0;
      }

      users = [(HMDHome *)self users];
      v23 = [users hmf_firstObjectWithUUID:v5];

      if (!v23)
      {
        v23 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
        responseHandler = [userCopy responseHandler];
        (responseHandler)[2](responseHandler, v23, 0);

LABEL_26:
        goto LABEL_27;
      }

LABEL_13:
      isOwner = [v23 isOwner];
      v26 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v28 = HMFGetOSLogHandle();
      v29 = v28;
      if (isOwner)
      {
        if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543362;
          *&buf[4] = v30;
          _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Owner cannot be removed from home", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v26);
        v31 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
        responseHandler2 = [userCopy responseHandler];
        (responseHandler2)[2](responseHandler2, v31, 0);
      }

      else
      {
        if (os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT))
        {
          v41 = HMFGetLogIdentifier();
          *buf = 138543618;
          *&buf[4] = v41;
          *&buf[12] = 2112;
          *&buf[14] = v23;
          _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Removing user: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v26);
        [(HMDHome *)selfCopy3 _removeUser:v23 message:userCopy];
      }

      goto LABEL_26;
    }

    v33 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
    responseHandler3 = [userCopy responseHandler];
    (responseHandler3)[2](responseHandler3, v33, 0);

    v5 = 0;
LABEL_27:

    goto LABEL_28;
  }

  v35 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v37 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
  {
    v38 = HMFGetLogIdentifier();
    *buf = 138543362;
    *&buf[4] = v38;
    _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@User management (remove) not supported for non-SPI clients", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v35);
  responseHandler4 = [userCopy responseHandler];

  if (responseHandler4)
  {
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    responseHandler5 = [userCopy responseHandler];
    (responseHandler5)[2](responseHandler5, v5, 0);

    goto LABEL_27;
  }

LABEL_28:

  v43 = *MEMORY[0x277D85DE8];
}

void __35__HMDHome__findMergeIDForUserUUID___block_invoke(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = [_MKFHome findHomeMemberWithUUID:*(a1 + 32) context:*(a1 + 40)];
  v3 = v2;
  if (!v2)
  {
    goto LABEL_4;
  }

  v4 = [v2 home];
  v5 = [v4 modelID];
  v6 = [*(a1 + 48) uuid];
  v7 = [v5 isEqual:v6];

  if (v7)
  {
    v8 = [v3 idsMergeIdentifier];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;
  }

  else
  {
LABEL_4:
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 48);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v15 = *(a1 + 32);
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to find home member model with modelID %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdatePresenceConsent:(id)consent
{
  v40 = *MEMORY[0x277D85DE8];
  consentCopy = consent;
  v5 = [MEMORY[0x277CD1F00] authWithMessage:consentCopy];
  if (!v5)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v37 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Received nil presence auth", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    responseHandler = [consentCopy responseHandler];
    v17 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
    goto LABEL_15;
  }

  presenceAuthStatus = [(HMDHome *)self presenceAuthStatus];
  v7 = HMFEqualObjects();

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v11;
      v38 = 2112;
      v39 = v5;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Presence auth status is already set to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
LABEL_14:
    responseHandler = [consentCopy responseHandler];
    v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
LABEL_15:
    v26 = v17;
    (*&responseHandler->super._bsoDataVersionOverride)(responseHandler, v17, 0);
    goto LABEL_16;
  }

  if (([v5 value] - 1) < 2)
  {
    v18 = [HMDHomeModel alloc];
    uuid = [(HMDHome *)self uuid];
    homeManager = [(HMDHome *)self homeManager];
    uuid2 = [homeManager uuid];
    responseHandler = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

    number = [v5 number];
    [(HMDHomeModel *)responseHandler setPresenceAuthorizationStatus:number];

    backingStore = [(HMDHome *)self backingStore];
    name = [consentCopy name];
    v25 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v26 = [backingStore transaction:name options:v25];

    [v26 add:responseHandler];
    v33[0] = MEMORY[0x277D85DD0];
    v33[1] = 3221225472;
    v33[2] = __40__HMDHome__handleUpdatePresenceConsent___block_invoke;
    v33[3] = &unk_27868A1D8;
    v34 = consentCopy;
    selfCopy3 = self;
    [v26 run:v33];

LABEL_16:
    goto LABEL_17;
  }

  v27 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v29 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
  {
    v30 = HMFGetLogIdentifier();
    *buf = 138543618;
    v37 = v30;
    v38 = 2112;
    v39 = v5;
    _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Received invalid parameter for presence authorization: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v27);
  responseHandler2 = [consentCopy responseHandler];

  if (responseHandler2)
  {
    goto LABEL_14;
  }

LABEL_17:

  v32 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome__handleUpdatePresenceConsent___block_invoke(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v8 = [MEMORY[0x277CBEB38] dictionary];
    v4 = [*(a1 + 40) currentUser];
    v5 = [v4 presenceAuthStatus];
    [v5 addToPayload:v8];

    v6 = *(a1 + 32);
    v7 = [v8 copy];
    [v6 respondWithPayload:v7];
  }
}

- (void)_readLocalHomeKeyMiscInfo
{
  uuid = [(HMDHome *)self uuid];
  backingStore = [(HMDHome *)self backingStore];
  context = [backingStore context];

  managedObjectContext = [context managedObjectContext];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __36__HMDHome__readLocalHomeKeyMiscInfo__block_invoke;
  v9[3] = &unk_27868A010;
  v10 = uuid;
  v11 = managedObjectContext;
  selfCopy = self;
  v7 = managedObjectContext;
  v8 = uuid;
  [v7 performBlockAndWait:v9];
}

void __36__HMDHome__readLocalHomeKeyMiscInfo__block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = [MKFLocalHomeKeyMiscInfo fetchLocalHomeKeyMiscInfoWithHomeUUID:*(a1 + 32) managedObjectContext:*(a1 + 40)];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 48);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_INFO);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v7;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Reading local home key miscellaneous info.", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v8 = [v2 dismissedWalletKeyUWBUnlockOnboarding];
    [*(a1 + 48) setDismissedWalletKeyUWBUnlockOnboarding:{objc_msgSend(v8, "BOOLValue")}];

    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 48);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [*(a1 + 48) dismissedWalletKeyUWBUnlockOnboarding];
      v19 = 138543618;
      v20 = v12;
      v21 = 1024;
      LODWORD(v22) = v13;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Dismissed Wallet Key UWB Unlock Onboarding settings read from local store as : %d", &v19, 0x12u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = [v2 clientWalletKeyUUID];
    [*(a1 + 48) setClientWalletKeyUUID:v14];

    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 48);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [*(a1 + 48) clientWalletKeyUUID];
      v19 = 138543618;
      v20 = v15;
      v21 = 2112;
      v22 = v16;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Client Wallet Key UUID read from local store as : %@", &v19, 0x16u);
    }
  }

  else if (v6)
  {
    v17 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v17;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Did not find home key misc info in local store.", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v18 = *MEMORY[0x277D85DE8];
}

- (void)resetHomeKeyMiscInfo
{
  v31 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self dismissedWalletKeyUWBUnlockOnboarding]|| ([(HMDHome *)self clientWalletKeyUUID], v3 = objc_claimAutoreleasedReturnValue(), v3, v3))
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      [(HMDHome *)selfCopy dismissedWalletKeyUWBUnlockOnboarding];
      v8 = HMFBooleanToString();
      clientWalletKeyUUID = [(HMDHome *)selfCopy clientWalletKeyUUID];
      *buf = 138543874;
      v26 = v7;
      v27 = 2112;
      v28 = v8;
      v29 = 2112;
      v30 = clientWalletKeyUUID;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Resetting HomeKeyMiscInfo with dismissedUWB: %@ and clientWalletKeyUUID: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    uuid = [(HMDHome *)selfCopy uuid];
    v11 = +[HMDCoreData sharedInstance];
    newManagedObjectContext = [v11 newManagedObjectContext];

    v13 = HMDWorkingContextNameForHomeUUID(uuid);
    [newManagedObjectContext setName:v13];

    v14 = @"HMD.1P";
    [newManagedObjectContext setTransactionAuthor:@"HMD.1P"];

    os_unfair_lock_lock_with_options();
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __31__HMDHome_resetHomeKeyMiscInfo__block_invoke;
    v22[3] = &unk_27868A010;
    v22[4] = selfCopy;
    v15 = uuid;
    v23 = v15;
    v16 = newManagedObjectContext;
    v24 = v16;
    [v16 performBlockAndWait:v22];
    [(HMDHome *)selfCopy setDismissedWalletKeyUWBUnlockOnboarding:0];
    [(HMDHome *)selfCopy setClientWalletKeyUUID:0];

    os_unfair_lock_unlock(&selfCopy->_dbWriteLock);
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v21;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Dismissed Wallet Key UWB Unlock Onboarding and clientWalletKeyUUID already unset, nothing to be done", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v18);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __31__HMDHome_resetHomeKeyMiscInfo__block_invoke(uint64_t a1)
{
  v27 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    *buf = 138543362;
    v22 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Going to reset HomeKeyMiscInfo Attributes", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [MKFLocalHomeKeyMiscInfo fetchLocalHomeKeyMiscInfoWithHomeUUID:*(a1 + 40) managedObjectContext:*(a1 + 48)];
  v7 = v6;
  if (v6)
  {
    [v6 setDismissedWalletKeyUWBUnlockOnboarding:MEMORY[0x277CBEC28]];
    [v7 setClientWalletKeyUUID:0];
    v8 = *(a1 + 48);
    v20 = 0;
    [v8 save:&v20];
    v9 = v20;
    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 32);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMFBooleanToString();
      *buf = 138543874;
      v22 = v13;
      v23 = 2112;
      v24 = v9;
      v25 = 2112;
      v26 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Resetting HomeKeyMiscInfo to local store with error :%@, Success : %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 32);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543362;
      v22 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Expected to find HomeKeyMiscInfo since cached home properties were not nil when attempting to reset HomeKeyMiscInfo", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)saveClientWalletKeyUUIDToLocalStore:(id)store
{
  storeCopy = store;
  uuid = [(HMDHome *)self uuid];
  v6 = +[HMDCoreData sharedInstance];
  newManagedObjectContext = [v6 newManagedObjectContext];

  v8 = HMDWorkingContextNameForHomeUUID(uuid);
  [newManagedObjectContext setName:v8];

  v9 = @"HMD.1P";
  [newManagedObjectContext setTransactionAuthor:@"HMD.1P"];

  os_unfair_lock_lock_with_options();
  v13 = MEMORY[0x277D85DD0];
  v14 = 3221225472;
  v15 = __47__HMDHome_saveClientWalletKeyUUIDToLocalStore___block_invoke;
  v16 = &unk_2786891E0;
  selfCopy = self;
  v10 = storeCopy;
  v18 = v10;
  v11 = uuid;
  v19 = v11;
  v12 = newManagedObjectContext;
  v20 = v12;
  [v12 performBlockAndWait:&v13];
  [(HMDHome *)self setClientWalletKeyUUID:v10, v13, v14, v15, v16, selfCopy];

  os_unfair_lock_unlock(&self->_dbWriteLock);
}

void __47__HMDHome_saveClientWalletKeyUUIDToLocalStore___block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    *buf = 138543618;
    v18 = v5;
    v19 = 2112;
    v20 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Going to store client Wallet Key UUID : %@ to local store", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = [MKFLocalHomeKeyMiscInfo fetchLocalHomeKeyMiscInfoWithHomeUUID:*(a1 + 48) managedObjectContext:*(a1 + 56)];
  if (!v7)
  {
    v7 = [[MKFLocalHomeKeyMiscInfo alloc] initWithContext:*(a1 + 56)];
    [(MKFLocalHomeKeyMiscInfo *)v7 setHomeUUID:*(a1 + 48)];
  }

  [(MKFLocalHomeKeyMiscInfo *)v7 setClientWalletKeyUUID:*(a1 + 40)];
  v8 = *(a1 + 56);
  v16 = 0;
  [v8 save:&v16];
  v9 = v16;
  v10 = objc_autoreleasePoolPush();
  v11 = *(a1 + 32);
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    *buf = 138543874;
    v18 = v13;
    v19 = 2112;
    v20 = v9;
    v21 = 2112;
    v22 = v14;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Storing client Wallet Key UUID to local store with error :%@, Success : %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v10);
  v15 = *MEMORY[0x277D85DE8];
}

- (void)updateLocalUWBOnboardingDismissed:(BOOL)dismissed
{
  uuid = [(HMDHome *)self uuid];
  v6 = +[HMDCoreData sharedInstance];
  newManagedObjectContext = [v6 newManagedObjectContext];

  v8 = HMDWorkingContextNameForHomeUUID(uuid);
  [newManagedObjectContext setName:v8];

  v9 = @"HMD.1P";
  [newManagedObjectContext setTransactionAuthor:@"HMD.1P"];

  os_unfair_lock_lock_with_options();
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __45__HMDHome_updateLocalUWBOnboardingDismissed___block_invoke;
  v12[3] = &unk_278685AA8;
  v12[4] = self;
  dismissedCopy = dismissed;
  v10 = uuid;
  v13 = v10;
  v11 = newManagedObjectContext;
  v14 = v11;
  [v11 performBlockAndWait:v12];

  os_unfair_lock_unlock(&self->_dbWriteLock);
}

void __45__HMDHome_updateLocalUWBOnboardingDismissed___block_invoke(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 56);
    v7 = HMFBooleanToString();
    *buf = 138543618;
    v20 = v5;
    v21 = 2112;
    v22 = v7;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Going to store dismissedWalletKeyUWBUnlockOnboarding to %@ in local store", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v8 = [MKFLocalHomeKeyMiscInfo fetchLocalHomeKeyMiscInfoWithHomeUUID:*(a1 + 40) managedObjectContext:*(a1 + 48)];
  if (!v8)
  {
    v8 = [[MKFLocalHomeKeyMiscInfo alloc] initWithContext:*(a1 + 48)];
    [(MKFLocalHomeKeyMiscInfo *)v8 setHomeUUID:*(a1 + 40)];
  }

  v9 = [MEMORY[0x277CCABB0] numberWithBool:*(a1 + 56)];
  [(MKFLocalHomeKeyMiscInfo *)v8 setDismissedWalletKeyUWBUnlockOnboarding:v9];

  v10 = *(a1 + 48);
  v18 = 0;
  [v10 save:&v18];
  v11 = v18;
  v12 = objc_autoreleasePoolPush();
  v13 = *(a1 + 32);
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    v16 = HMFBooleanToString();
    *buf = 138543874;
    v20 = v15;
    v21 = 2112;
    v22 = v11;
    v23 = 2112;
    v24 = v16;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Storing dismissedWalletKeyUWBUnlockOnboarding to local store with error :%@, Success : %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v12);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetDismissedUWBOnboarding:(id)onboarding
{
  v28 = *MEMORY[0x277D85DE8];
  onboardingCopy = onboarding;
  if ([onboardingCopy isRemote])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v27 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Received remote message for a local setting of DismissedUWBOnboarding", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    responseHandler = [onboardingCopy responseHandler];
    v10 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
    (responseHandler)[2](responseHandler, v10, 0);
  }

  else
  {
    dismissedWalletKeyUWBUnlockOnboarding = [(HMDHome *)self dismissedWalletKeyUWBUnlockOnboarding];
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_INFO);
    if (dismissedWalletKeyUWBUnlockOnboarding)
    {
      if (v15)
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543362;
        v27 = v16;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Home has already been onboarded for UWB unlock", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v12);
    }

    else
    {
      if (v15)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v27 = v17;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Setting Dismissed Wallet Key UWB Unlock Onboarding", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v12);
      [(HMDHome *)selfCopy2 updateLocalUWBOnboardingDismissed:1];
      [(HMDHome *)selfCopy2 setDismissedWalletKeyUWBUnlockOnboarding:1];
      v18 = +[HMDACWGKeyManager shared];
      uuid = [(HMDHome *)selfCopy2 uuid];
      currentUser = [(HMDHome *)selfCopy2 currentUser];
      uuid2 = [currentUser uuid];
      backingStore = [(HMDHome *)selfCopy2 backingStore];
      context = [backingStore context];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __44__HMDHome__handleSetDismissedUWBOnboarding___block_invoke;
      v25[3] = &unk_278670290;
      v25[4] = selfCopy2;
      [v18 getOrCreateIssuerKeyAndSaveIfNeededWithHome:uuid user:uuid2 context:context shouldRoll:0 completionHandler:v25];
    }

    [onboardingCopy respondWithSuccess];
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__handleSetDismissedUWBOnboarding___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (!v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v10;
      v14 = 2112;
      v15 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to create ACWG issuer key with error on onboarding flow: %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateUserAnnounceAccess:(id)access
{
  v35 = *MEMORY[0x277D85DE8];
  accessCopy = access;
  if ([accessCopy isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(accessCopy, "isRemote"))
  {
    responseHandler2 = [accessCopy stringForKey:@"kUserIDKey"];
    users = [(HMDHome *)self users];
    v7 = [users hmf_firstObjectWithValue:responseHandler2 forKeyPath:@"userID"];

    if (v7)
    {
      currentUser = [(HMDHome *)self currentUser];
      if ([currentUser isAdministrator])
      {
        v9 = [v7 newModelWithChangeType:2];
        v10 = [accessCopy numberForKey:*MEMORY[0x277CD06A0]];
        if (v10)
        {
          [v9 setAnnounceAccessAllowed:v10];
          if ([v10 BOOLValue])
          {
            v11 = &unk_283E71A68;
          }

          else
          {
            v11 = &unk_283E71A80;
          }

          [v9 setAnnounceAccessLevel:v11];
        }

        backingStore = [(HMDHome *)self backingStore];
        name = [accessCopy name];
        v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v15 = [backingStore transaction:name options:v14];

        [v15 add:v9 withMessage:accessCopy];
        [v15 run];

        goto LABEL_21;
      }

      v25 = objc_autoreleasePoolPush();
      selfCopy = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        v31 = 138543618;
        v32 = v28;
        v33 = 2112;
        v34 = currentUser;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Current user is not an administrator, cannot modify access: %@", &v31, 0x16u);
      }

      objc_autoreleasePoolPop(v25);
      responseHandler = [accessCopy responseHandler];
      v29 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
      (responseHandler)[2](responseHandler, v29, 0);
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        v31 = 138543618;
        v32 = v19;
        v33 = 2112;
        v34 = responseHandler2;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", &v31, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      currentUser = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      responseHandler = [accessCopy responseHandler];
      (responseHandler)[2](responseHandler, currentUser, 0);
    }

LABEL_21:
    goto LABEL_22;
  }

  v21 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    v31 = 138543362;
    v32 = v24;
    _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to update users to home", &v31, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  responseHandler2 = [accessCopy responseHandler];
  v7 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
  (responseHandler2)[2](responseHandler2, v7, 0);
LABEL_22:

  v30 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateAudioAnalysisAccess:(id)access
{
  v47 = *MEMORY[0x277D85DE8];
  accessCopy = access;
  v5 = [accessCopy stringForKey:@"kUserIDKey"];
  users = [(HMDHome *)self users];
  v7 = [users hmf_firstObjectWithValue:v5 forKeyPath:@"userID"];

  if (v7)
  {
    currentUser = [(HMDHome *)self currentUser];
    if ([currentUser isAdministrator])
    {
      responseHandler = [v7 newModelWithChangeType:2];
      v10 = [accessCopy numberForKey:*MEMORY[0x277CCFE60]];
      v11 = v10;
      if (v10)
      {
        integerValue = [v10 integerValue];
        v13 = objc_autoreleasePoolPush();
        selfCopy = self;
        v15 = HMFGetOSLogHandle();
        v37 = integerValue;
        if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v16 = v36 = v13;
          v17 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:integerValue];
          *buf = 138543874;
          v42 = v16;
          v43 = 2112;
          v44 = v17;
          v45 = 2112;
          v46 = v7;
          _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Updating audio analysis access level to %@ for user: %@", buf, 0x20u);

          integerValue = v37;
          v13 = v36;
        }

        objc_autoreleasePoolPop(v13);
        v18 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:integerValue];
        [responseHandler setAudioAnalysisUserDropInAccessLevel:v18];

        backingStore = [(HMDHome *)selfCopy backingStore];
        name = [accessCopy name];
        v21 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v22 = [backingStore transaction:name options:v21];

        [v22 add:responseHandler withMessage:accessCopy];
        v38[0] = MEMORY[0x277D85DD0];
        v38[1] = 3221225472;
        v38[2] = __44__HMDHome__handleUpdateAudioAnalysisAccess___block_invoke;
        v38[3] = &unk_27868A188;
        v39 = accessCopy;
        v40 = v37;
        [v22 run:v38];
      }

      else
      {
        v31 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v33 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
        {
          v34 = HMFGetLogIdentifier();
          *buf = 138543362;
          v42 = v34;
          _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Missing access level for audio analysis dropIn", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v31);
        v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        [accessCopy respondWithError:v22];
      }
    }

    else
    {
      v27 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v30;
        v43 = 2112;
        v44 = currentUser;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Current user is not an administrator, cannot modify access: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v27);
      responseHandler = [accessCopy responseHandler];
      v11 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
      (responseHandler)[2](responseHandler, v11, 0);
    }
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v42 = v26;
      v43 = 2112;
      v44 = v5;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    currentUser = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [accessCopy respondWithError:currentUser];
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__handleUpdateAudioAnalysisAccess___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = *(a1 + 32);
    v4 = *MEMORY[0x277D85DE8];

    [v3 respondWithError:a2];
  }

  else
  {
    v8 = *MEMORY[0x277CCFE60];
    v5 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 40)];
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];

    [*(a1 + 32) respondWithPayload:v6];
    v7 = *MEMORY[0x277D85DE8];
  }
}

- (void)_handleUpdateUserAccess:(id)access
{
  v62 = *MEMORY[0x277D85DE8];
  accessCopy = access;
  if ([accessCopy isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(accessCopy, "isRemote"))
  {
    responseHandler3 = [accessCopy stringForKey:@"kUserIDKey"];
    users = [(HMDHome *)self users];
    v7 = [users hmf_firstObjectWithValue:responseHandler3 forKeyPath:@"userID"];

    if (!v7)
    {
      v15 = objc_autoreleasePoolPush();
      selfCopy = self;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v18;
        v58 = 2112;
        v59 = responseHandler3;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
      v12 = MEMORY[0x277CCA9B8];
      v13 = *MEMORY[0x277CCFD28];
      v14 = 2;
      goto LABEL_11;
    }

    if ([v7 isOwner])
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v11;
        v58 = 2112;
        v59 = responseHandler3;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot modify the owner of the home: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      v12 = MEMORY[0x277CCA9B8];
      v13 = *MEMORY[0x277CCFD28];
      v14 = 17;
LABEL_11:
      currentUser = [v12 errorWithDomain:v13 code:v14 userInfo:0];
      responseHandler = [accessCopy responseHandler];
      (responseHandler)[2](responseHandler, currentUser, 0);
LABEL_42:

      goto LABEL_43;
    }

    currentUser = [(HMDHome *)self currentUser];
    if (([currentUser isAdministrator] & 1) == 0)
    {
      v34 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
      {
        v37 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v37;
        v58 = 2112;
        v59 = currentUser;
        _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_ERROR, "%{public}@Current user is not an administrator, cannot modify access: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v34);
      responseHandler = [accessCopy responseHandler];
      v26 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
      (responseHandler)[2](responseHandler, v26, 0);
      goto LABEL_41;
    }

    responseHandler = [v7 newModelWithChangeType:2];
    v25 = [accessCopy numberForKey:@"kUserAdministratorInformationKey"];
    v26 = v25;
    if (!v25)
    {
      goto LABEL_25;
    }

    bOOLValue = [v25 BOOLValue];
    if (bOOLValue && ![(HMDHome *)self isResidentSupported])
    {
      v38 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v40 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
      {
        v41 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v41;
        v58 = 2112;
        v59 = responseHandler3;
        _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_INFO, "%{public}@Cannot update user %@ to administrator because it requires a resident", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v38);
      v42 = MEMORY[0x277CCA9B8];
      v43 = *MEMORY[0x277CCFD28];
      v44 = 48;
    }

    else
    {
      if (![v7 privilege] || objc_msgSend(v7, "privilege") == 4)
      {
        if (bOOLValue)
        {
          v28 = &unk_283E71A50;
        }

        else
        {
          v28 = &unk_283E71A38;
        }

        [responseHandler setPrivilege:v28];
        [v7 privilege];
LABEL_25:
        v51 = v26;
        v29 = [accessCopy numberForKey:@"kUserRemoteAccessInformationKey"];
        if (v29)
        {
          [responseHandler setRemoteAccessAllowed:v29];
        }

        backingStore = [(HMDHome *)self backingStore];
        name = [accessCopy name];
        v32 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        responseHandler2 = [backingStore transaction:name options:v32];

        [responseHandler2 add:responseHandler];
        v53[0] = MEMORY[0x277D85DD0];
        v53[1] = 3221225472;
        v53[2] = __35__HMDHome__handleUpdateUserAccess___block_invoke;
        v53[3] = &unk_27868A1D8;
        v54 = accessCopy;
        v55 = v7;
        [responseHandler2 run:v53];

        v26 = v51;
        goto LABEL_40;
      }

      v45 = objc_autoreleasePoolPush();
      selfCopy5 = self;
      v47 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v48 = v52 = v45;
        v49 = @"non-";
        *buf = 138543874;
        v57 = v48;
        v58 = 2112;
        if (bOOLValue)
        {
          v49 = &stru_283CF9D50;
        }

        v59 = responseHandler3;
        v60 = 2112;
        v61 = v49;
        _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Failed to update user %@ to %@administrator", buf, 0x20u);

        v45 = v52;
      }

      objc_autoreleasePoolPop(v45);
      v42 = MEMORY[0x277CCA9B8];
      v43 = *MEMORY[0x277CCFD28];
      v44 = 10;
    }

    v29 = [v42 errorWithDomain:v43 code:v44 userInfo:0];
    responseHandler2 = [accessCopy responseHandler];
    (responseHandler2)[2](responseHandler2, v29, 0);
LABEL_40:

LABEL_41:
    goto LABEL_42;
  }

  v21 = objc_autoreleasePoolPush();
  selfCopy6 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    *buf = 138543362;
    v57 = v24;
    _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to update users to home", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  responseHandler3 = [accessCopy responseHandler];
  v7 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
  (responseHandler3)[2](responseHandler3, v7, 0);
LABEL_43:

  v50 = *MEMORY[0x277D85DE8];
}

void __35__HMDHome__handleUpdateUserAccess___block_invoke(uint64_t a1, uint64_t a2)
{
  v13[5] = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = *(a1 + 32);
    v4 = *MEMORY[0x277D85DE8];

    [v3 respondWithError:a2];
  }

  else
  {
    v12[0] = @"kUserAdministratorInformationKey";
    v5 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isAdministrator")}];
    v13[0] = v5;
    v12[1] = @"kUserRemoteAccessInformationKey";
    v6 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isRemoteAccessAllowed")}];
    v13[1] = v6;
    v12[2] = @"kUserCamerasAccessLevelInformationKey";
    v7 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(*(a1 + 40), "camerasAccessLevel")}];
    v13[2] = v7;
    v12[3] = *MEMORY[0x277CD06A0];
    v8 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isAnnounceAccessAllowed")}];
    v13[3] = v8;
    v12[4] = *MEMORY[0x277CCFE60];
    v9 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(*(a1 + 40), "audioAnalysisUserDropInAccessLevel")}];
    v13[4] = v9;
    v10 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v13 forKeys:v12 count:5];

    [*(a1 + 32) respondWithPayload:v10];
    v11 = *MEMORY[0x277D85DE8];
  }
}

- (void)_handleUpdateUserCamerasAccessLevel:(id)level
{
  v53 = *MEMORY[0x277D85DE8];
  levelCopy = level;
  v5 = [levelCopy stringForKey:@"kUserIDKey"];
  users = [(HMDHome *)self users];
  v7 = [users hmf_firstObjectWithValue:v5 forKeyPath:@"userID"];

  if (!v7)
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543618;
      v48 = v17;
      v49 = 2112;
      v50 = v5;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v12 = MEMORY[0x277CCA9B8];
    v13 = 2;
    goto LABEL_9;
  }

  if (![v7 isOwner])
  {
    v18 = [v7 newModelWithChangeType:2];
    v19 = [levelCopy numberForKey:@"kUserCamerasAccessLevelInformationKey"];
    v20 = v19;
    if (v19)
    {
      integerValue = [v19 integerValue];
      if (HMUserIsValidCameraAccessLevel())
      {
        camerasAccessLevel = [v7 camerasAccessLevel];
        v23 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v25 = HMFGetOSLogHandle();
        v26 = v25;
        if (camerasAccessLevel != integerValue)
        {
          if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
          {
            v39 = HMFGetLogIdentifier();
            v40 = HMUserCameraAccessLevelAsString();
            *buf = 138543874;
            v48 = v39;
            v49 = 2112;
            v50 = v40;
            v51 = 2112;
            v52 = v7;
            _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Updating cameras access level to %@ for user: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v23);
          [v18 setCamerasAccessLevel:v20];
          backingStore = [(HMDHome *)selfCopy2 backingStore];
          name = [levelCopy name];
          v43 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v37 = [backingStore transaction:name options:v43];

          [v37 add:v18];
          v44[0] = MEMORY[0x277D85DD0];
          v44[1] = 3221225472;
          v44[2] = __47__HMDHome__handleUpdateUserCamerasAccessLevel___block_invoke;
          v44[3] = &unk_27868A1D8;
          v45 = levelCopy;
          v46 = v20;
          [v37 run:v44];

          goto LABEL_24;
        }

        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          v27 = HMFGetLogIdentifier();
          v28 = HMUserCameraAccessLevelAsString();
          *buf = 138543618;
          v48 = v27;
          v49 = 2112;
          v50 = v28;
          _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Cameras access level: %@ already set", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
        v29 = MEMORY[0x277CCA9B8];
        v30 = 1;
LABEL_23:
        v37 = [v29 hmErrorWithCode:v30];
        [levelCopy respondWithError:v37];
LABEL_24:

        goto LABEL_25;
      }

      v31 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543618;
        v48 = v36;
        v49 = 2048;
        v50 = integerValue;
        _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Invalid cameras access level value: %ld", buf, 0x16u);
      }
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
      {
        v34 = HMFGetLogIdentifier();
        *buf = 138543618;
        v48 = v34;
        v49 = 2112;
        v50 = @"kUserCamerasAccessLevelInformationKey";
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Missing value for key: %@", buf, 0x16u);
      }
    }

    objc_autoreleasePoolPop(v31);
    v29 = MEMORY[0x277CCA9B8];
    v30 = 3;
    goto LABEL_23;
  }

  v8 = objc_autoreleasePoolPush();
  selfCopy5 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543618;
    v48 = v11;
    v49 = 2112;
    v50 = v5;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot modify cameras access level for owner of the home: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  v12 = MEMORY[0x277CCA9B8];
  v13 = 48;
LABEL_9:
  v18 = [v12 hmErrorWithCode:v13];
  [levelCopy respondWithError:v18];
LABEL_25:

  v38 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleUpdateUserCamerasAccessLevel___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = *(a1 + 32);
    v4 = *MEMORY[0x277D85DE8];

    [v3 respondWithError:a2];
  }

  else
  {
    v5 = *(a1 + 40);
    v8 = @"kUserCamerasAccessLevelInformationKey";
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [*(a1 + 32) respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (void)_addUsersWithInviteInformations:(id)informations message:(id)message
{
  v70 = *MEMORY[0x277D85DE8];
  informationsCopy = informations;
  messageCopy = message;
  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  v61 = 0u;
  v62 = 0u;
  v59 = 0u;
  v60 = 0u;
  obj = informationsCopy;
  v7 = [obj countByEnumeratingWithState:&v59 objects:v69 count:16];
  if (v7)
  {
    v43 = *v60;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v60 != v43)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v59 + 1) + 8 * i);
        v10 = [objc_opt_class() privilegeFromUserInviteInformation:v9];
        v11 = +[HMDAccountHandleFormatter defaultFormatter];
        userID = [v9 userID];
        v13 = [v11 accountHandleFromString:userID];

        v14 = [[HMDUser alloc] initWithAccountHandle:v13 home:self pairingIdentity:0 privilege:v10];
        [(HMDUser *)v14 refreshDisplayName];
        -[HMDUser setRemoteAccessAllowed:](v14, "setRemoteAccessAllowed:", [v9 isRemoteAccessAllowed]);
        -[HMDUser setCamerasAccessLevel:](v14, "setCamerasAccessLevel:", [v9 camerasAccessLevel]);
        if ([v9 isAnnounceAccessAllowed])
        {
          v15 = 2;
        }

        else
        {
          v15 = 1;
        }

        [(HMDUser *)v14 setAnnounceAccessLevel:v15];
        if ([v9 isRestrictedGuest])
        {
          v16 = [HMDRestrictedGuestHomeAccessSettings alloc];
          restrictedGuestHomeAccessSettings = [v9 restrictedGuestHomeAccessSettings];
          v18 = [(HMDRestrictedGuestHomeAccessSettings *)v16 initWithRestrictedGuestHomeAccessSettings:restrictedGuestHomeAccessSettings];

          if (v18)
          {
            [(HMDUser *)v14 setRestrictedGuestAccessSettings:v18];
          }

          v19 = objc_autoreleasePoolPush();
          selfCopy = self;
          v21 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            v22 = HMFGetLogIdentifier();
            *buf = 138543618;
            v66 = v22;
            v67 = 2112;
            v68 = v14;
            _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Received user invite request with restricted access settings : %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v19);
        }

        v23 = [[HMDOutgoingHomeInvitation alloc] initWithInvitee:v14 invitationState:2 forHome:self expiryDate:0 messageIdentifier:0];
        [array addObject:v23];
        invitationData = [(HMDHomeInvitation *)v23 invitationData];
        [array2 addObject:invitationData];
      }

      v7 = [obj countByEnumeratingWithState:&v59 objects:v69 count:16];
    }

    while (v7);
  }

  v25 = _os_feature_enabled_impl();
  objc_initWeak(buf, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke;
  aBlock[3] = &unk_278681A08;
  objc_copyWeak(&v57, buf);
  v26 = array;
  v56 = v26;
  v58 = v25;
  v47 = _Block_copy(aBlock);
  administratorHandler = [(HMDHome *)self administratorHandler];
  if ([administratorHandler shouldRelayMessages])
  {
    v28 = encodeRootObject();
    v63[0] = @"HM.invitations";
    v63[1] = @"HMDHomeSuppressInviteNotificationKey";
    v64[0] = v28;
    v29 = [MEMORY[0x277CCABB0] numberWithBool:v25];
    v64[1] = v29;
    v44 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v64 forKeys:v63 count:2];

    v30 = MEMORY[0x277D0F848];
    v51[0] = MEMORY[0x277D85DD0];
    v51[1] = 3221225472;
    v51[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_2;
    v51[3] = &unk_278689460;
    objc_copyWeak(&v54, buf);
    v52 = v26;
    v31 = messageCopy;
    v53 = v31;
    v32 = [v30 messageWithName:@"kAddHomeInvitesInternalRequestKey" messagePayload:v44 responseHandler:v51];
    v33 = objc_alloc(MEMORY[0x277D0F820]);
    uuid = [(HMDHome *)self uuid];
    v35 = [v33 initWithTarget:uuid];

    [v32 setDestination:v35];
    [v32 setQualityOfService:33];
    v50 = 0;
    v36 = [administratorHandler operationForMessage:v32 error:&v50];
    v37 = v50;
    v38 = v37;
    if (v36)
    {
      [administratorHandler addOperation:v36];
    }

    else
    {
      v39 = v37;
      if (!v37)
      {
        v39 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
      }

      [v31 respondWithError:v39];
      if (!v38)
      {
      }
    }

    objc_destroyWeak(&v54);
  }

  else
  {
    v48[0] = MEMORY[0x277D85DD0];
    v48[1] = 3221225472;
    v48[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_1677;
    v48[3] = &unk_278688B80;
    v49 = v47;
    [(HMDHome *)self _addOutgoingInvitations:v26 message:messageCopy transactionCompleted:v48];
    v28 = v49;
  }

  objc_destroyWeak(&v57);
  objc_destroyWeak(buf);

  v40 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__addUsersWithInviteInformations_message___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained __sendOutgoingInvitations:*(a1 + 32) suppressHomeInviteNotification:*(a1 + 48)];
}

void __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_2(id *a1, void *a2, void *a3)
{
  v34 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v21 = v6;
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v29 = v11;
      v30 = 2112;
      v31 = @"kAddHomeInvitesInternalRequestKey";
      v32 = 2112;
      v33 = v5;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Relayed message %@ with error %@", buf, 0x20u);
    }

    v22 = v5;

    objc_autoreleasePoolPop(v8);
    v25 = 0u;
    v26 = 0u;
    v23 = 0u;
    v24 = 0u;
    v12 = a1[4];
    v13 = [v12 countByEnumeratingWithState:&v23 objects:v27 count:16];
    if (v13)
    {
      v14 = v13;
      v15 = *v24;
      do
      {
        v16 = 0;
        do
        {
          if (*v24 != v15)
          {
            objc_enumerationMutation(v12);
          }

          v17 = [*(*(&v23 + 1) + 8 * v16) user];
          v18 = [v17 accountHandle];
          v19 = [v9 _outgoingInvitationForUserWithHandle:v18];

          [v19 notifyStateChangedForMessage:a1[5]];
          ++v16;
        }

        while (v14 != v16);
        v14 = [v12 countByEnumeratingWithState:&v23 objects:v27 count:16];
      }

      while (v14);
    }

    v5 = v22;
    [a1[5] respondWithPayload:0 error:v22];
    v6 = v21;
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)__sendOutgoingInvitation:(void *)invitation shareURL:(void *)l shareToken:(uint64_t)token suppressHomeInviteNotification:(void *)notification logEventBuilder:
{
  if (self)
  {
    notificationCopy = notification;
    lCopy = l;
    invitationCopy = invitation;
    v15 = a2;
    user = [v15 user];
    [self _cleanRemovedUsers:user];

    [self _sendInvitation:v15 message:0 shareURL:invitationCopy shareToken:lCopy suppressHomeInviteNotification:token logEventBuilder:notificationCopy];
  }
}

- (void)_fixupUsersWithoutMergeID
{
  backingStore = [(HMDHome *)self backingStore];
  context = [backingStore context];

  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __36__HMDHome__fixupUsersWithoutMergeID__block_invoke;
  v6[3] = &unk_27868A750;
  v6[4] = self;
  v7 = context;
  v5 = context;
  [v5 performBlock:v6];
}

void __36__HMDHome__fixupUsersWithoutMergeID__block_invoke(uint64_t a1)
{
  v50 = *MEMORY[0x277D85DE8];
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v1 = [*(a1 + 32) users];
  v2 = [v1 countByEnumeratingWithState:&v39 objects:v49 count:16];
  if (v2)
  {
    v4 = v2;
    v5 = 0;
    v6 = *v40;
    *&v3 = 138543874;
    v35 = v3;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v40 != v6)
        {
          objc_enumerationMutation(v1);
        }

        v8 = *(*(&v39 + 1) + 8 * i);
        v9 = [v8 mergeIdentifier];

        if (!v9)
        {
          v10 = [v8 account];
          v11 = [v10 senderCorrelationIdentifier];

          if (v11)
          {
            v12 = [v8 uuid];
            v13 = [*(a1 + 40) managedObjectContext];
            v14 = [_MKFHome findHomeMemberWithUUID:v12 context:v13];

            v15 = [v10 senderCorrelationIdentifier];
            [v14 setIdsMergeIdentifier:v15];

            ++v5;
          }

          else
          {
            v16 = objc_autoreleasePoolPush();
            v17 = *(a1 + 32);
            v18 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
            {
              HMFGetLogIdentifier();
              v19 = v36 = v5;
              v20 = [v8 shortDescription];
              *buf = v35;
              v44 = v19;
              v45 = 2112;
              v46 = v20;
              v47 = 2112;
              v48 = v10;
              _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to fix up mergeID for user %@ with account %@", buf, 0x20u);

              v5 = v36;
            }

            objc_autoreleasePoolPop(v16);
          }
        }
      }

      v4 = [v1 countByEnumeratingWithState:&v39 objects:v49 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  v21 = v5;

  v22 = objc_autoreleasePoolPush();
  v23 = *(a1 + 32);
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
  {
    v25 = HMFGetLogIdentifier();
    v26 = [MEMORY[0x277CCABB0] numberWithInteger:v21];
    *buf = 138543618;
    v44 = v25;
    v45 = 2112;
    v46 = v26;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Fixing up mergeIdentifier for %@ users", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v22);
  if (v21 >= 1)
  {
    v27 = *(a1 + 40);
    v38 = 0;
    v28 = [v27 save:&v38];
    v29 = v38;
    if ((v28 & 1) == 0)
    {
      v30 = objc_autoreleasePoolPush();
      v31 = *(a1 + 32);
      v32 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        v33 = HMFGetLogIdentifier();
        *buf = 138543618;
        v44 = v33;
        v45 = 2112;
        v46 = v29;
        _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_ERROR, "%{public}@Failed to save fixup mergeID for users: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v30);
    }
  }

  v34 = *MEMORY[0x277D85DE8];
}

- (void)_auditAccessForUsers
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if ([(HMDHome *)self isOwnerUser])
  {
    usersSupportingPresence = [(HMDHome *)self usersSupportingPresence];
    v5 = [usersSupportingPresence mutableCopy];

    owner = [(HMDHome *)self owner];
    [v5 removeObject:owner];

    if ([v5 count])
    {
      v7 = objc_alloc(MEMORY[0x277D0F7A8]);
      workQueue2 = [(HMDHome *)self workQueue];
      v9 = [v7 initWithQueue:workQueue2];

      v14[5] = _HMFThreadLocalAsyncContextPush();
      homeManager = [(HMDHome *)self homeManager];
      homeOwnerCloudShareManager = [homeManager homeOwnerCloudShareManager];
      v12 = [homeOwnerCloudShareManager auditAccessForUsers:v5 home:self];
      v14[0] = MEMORY[0x277D85DD0];
      v14[1] = 3221225472;
      v14[2] = __31__HMDHome__auditAccessForUsers__block_invoke;
      v14[3] = &unk_2786868A0;
      v14[4] = self;
      v13 = [v12 then:v14];

      _HMFThreadLocalAsyncContextPop();
    }
  }
}

uint64_t __31__HMDHome__auditAccessForUsers__block_invoke(uint64_t a1, void *a2)
{
  v27 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    *buf = 138543618;
    v24 = v7;
    v25 = 2112;
    v26 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Removing users that are no longer a participant in the share: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v20 = 0u;
  v21 = 0u;
  v18 = 0u;
  v19 = 0u;
  v8 = v3;
  v9 = [v8 countByEnumeratingWithState:&v18 objects:v22 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v19;
    do
    {
      v12 = 0;
      do
      {
        if (*v19 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v18 + 1) + 8 * v12);
        v14 = [*(a1 + 32) workQueue];
        v17[0] = MEMORY[0x277D85DD0];
        v17[1] = 3221225472;
        v17[2] = __31__HMDHome__auditAccessForUsers__block_invoke_1672;
        v17[3] = &unk_27868A750;
        v17[4] = *(a1 + 32);
        v17[5] = v13;
        dispatch_async(v14, v17);

        ++v12;
      }

      while (v10 != v12);
      v10 = [v8 countByEnumeratingWithState:&v18 objects:v22 count:16];
    }

    while (v10);
  }

  v15 = *MEMORY[0x277D85DE8];
  return 1;
}

- (void)auditAccessForUsers
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __30__HMDHome_auditAccessForUsers__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

uint64_t __30__HMDHome_auditAccessForUsers__block_invoke(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Auditing shared users for home", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  result = [*(a1 + 32) _auditAccessForUsers];
  v7 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_processUnsentOutgoingInvitations
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = MEMORY[0x277CBEB18];
  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v5 = [v3 arrayWithCapacity:{objc_msgSend(outgoingInvitations, "count")}];

  v19 = 0u;
  v20 = 0u;
  v17 = 0u;
  v18 = 0u;
  outgoingInvitations2 = [(HMDHome *)self outgoingInvitations];
  v7 = [outgoingInvitations2 countByEnumeratingWithState:&v17 objects:v25 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v18;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v18 != v9)
        {
          objc_enumerationMutation(outgoingInvitations2);
        }

        v11 = *(*(&v17 + 1) + 8 * i);
        if ([(HMDHome *)self _shouldResendOutgoingInvitation:v11])
        {
          [v5 addObject:v11];
        }
      }

      v8 = [outgoingInvitations2 countByEnumeratingWithState:&v17 objects:v25 count:16];
    }

    while (v8);
  }

  if ([v5 count])
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v22 = v15;
      v23 = 2112;
      v24 = v5;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Resending unsent outgoing invitations %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    [(HMDHome *)selfCopy _grantAccessAndSendOutgoingInvitation:v5 suppressHomeInviteNotification:1];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)resendOutgoingInvitationToUser:(id)user
{
  userCopy = user;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_resendOutgoingInvitationToUser___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = userCopy;
  v6 = userCopy;
  dispatch_async(workQueue, v7);
}

void __42__HMDHome_resendOutgoingInvitationToUser___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) isCurrentDeviceConfirmedPrimaryResident];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_INFO);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 40);
      *buf = 138543618;
      v17 = v7;
      v18 = 2112;
      v19 = v8;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Resending outgoing invitation (if any) to %@ as prompted by shared user's HH2 upgrade", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v9 = [*(a1 + 32) outgoingInvitationToResendForUser:*(a1 + 40)];
    v10 = v9;
    if (v9)
    {
      v11 = *(a1 + 32);
      v15 = v9;
      v12 = [MEMORY[0x277CBEA60] arrayWithObjects:&v15 count:1];
      [v11 _grantAccessAndSendOutgoingInvitation:v12 suppressHomeInviteNotification:1];
    }
  }

  else
  {
    if (v6)
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v17 = v13;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Not resending outgoing invitations as this is not the primary resident.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_grantAccessAndSendOutgoingInvitation:(id)invitation suppressHomeInviteNotification:(BOOL)notification
{
  v93 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  if (!invitationCopy)
  {
    _HMFPreconditionFailure();
  }

  v6 = invitationCopy;
  objc_initWeak(&location, self);
  futureWithNoValue = [MEMORY[0x277D0F7C0] futureWithNoValue];
  v7 = objc_alloc(MEMORY[0x277D0F7A8]);
  workQueue = [(HMDHome *)self workQueue];
  v58 = [v7 initWithQueue:workQueue];

  v82 = _HMFThreadLocalAsyncContextPush();
  v80[0] = 0;
  v80[1] = v80;
  v80[2] = 0x2020000000;
  v81 = 0;
  v78[0] = 0;
  v78[1] = v78;
  v78[2] = 0x2020000000;
  v79 = 0;
  homeManager = [(HMDHome *)self homeManager];
  homeOwnerCloudShareManager = [homeManager homeOwnerCloudShareManager];
  [homeOwnerCloudShareManager shareAgeForHome:self];
  v12 = v11;

  mEMORY[0x277D0F8D0] = [MEMORY[0x277D0F8D0] sharedPreferences];
  v14 = [mEMORY[0x277D0F8D0] preferenceForKey:@"migrationInvitationExpirationInterval"];
  numberValue = [v14 numberValue];
  [numberValue doubleValue];
  v17 = v16;

  v18 = objc_autoreleasePoolPush();
  selfCopy = self;
  v20 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
  {
    v21 = HMFGetLogIdentifier();
    v22 = HMFBooleanToString();
    *buf = 138544130;
    v86 = v21;
    v87 = 2048;
    v88 = v12 / 86400.0;
    v89 = 2048;
    v90 = v17 / 86400.0;
    v91 = 2112;
    v92 = v22;
    _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEFAULT, "%{public}@Home is %f days old (threshold: %f days). Too old for migration invitations? %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v18);
  v76 = 0u;
  v77 = 0u;
  v74 = 0u;
  v75 = 0u;
  obj = v6;
  v62 = [obj countByEnumeratingWithState:&v74 objects:v84 count:16];
  if (!v62)
  {
    goto LABEL_33;
  }

  v61 = *v75;
  while (2)
  {
    for (i = 0; i != v62; ++i)
    {
      if (*v75 != v61)
      {
        objc_enumerationMutation(obj);
      }

      v24 = *(*(&v74 + 1) + 8 * i);
      if (![(HMDHome *)selfCopy isCurrentDevicePrimaryResident])
      {
        v52 = objc_autoreleasePoolPush();
        v53 = selfCopy;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_ERROR))
        {
          v55 = HMFGetLogIdentifier();
          *buf = 138543362;
          v86 = v55;
          _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_ERROR, "%{public}@Current device is no longer primary, aborting the sending of outgoing invitations.", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v52);
        goto LABEL_33;
      }

      isMigrationInvitation = [v24 isMigrationInvitation];
      if (v12 > v17)
      {
        v26 = isMigrationInvitation;
      }

      else
      {
        v26 = 0;
      }

      if (v26 == 1)
      {
        v27 = objc_autoreleasePoolPush();
        v28 = selfCopy;
        v29 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543618;
          v86 = v30;
          v87 = 2112;
          v88 = *&v24;
          _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Skipping migration invitation %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v27);
        backingStore = [(HMDHome *)v28 backingStore];
        context = [backingStore context];
        v73[0] = MEMORY[0x277D85DD0];
        v73[1] = 3221225472;
        v73[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke;
        v73[3] = &unk_27868A750;
        v73[4] = v24;
        v73[5] = v28;
        [context performBlock:v73];

        continue;
      }

      if ([v24 isMigrationInvitation])
      {
        v33 = 4;
      }

      else
      {
        v33 = 1;
      }

      shareToken = [v24 shareToken];
      if (shareToken)
      {

LABEL_23:
        v33 |= 2uLL;
        goto LABEL_24;
      }

      dateSent = [v24 dateSent];
      v36 = dateSent == 0;

      if (!v36)
      {
        goto LABEL_23;
      }

LABEL_24:
      [v24 setSendAttemptCount:{objc_msgSend(v24, "sendAttemptCount") + 1}];
      v37 = objc_autoreleasePoolPush();
      v38 = selfCopy;
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
      {
        v40 = HMFGetLogIdentifier();
        v41 = COERCE_DOUBLE([v24 sendAttemptCount]);
        *buf = 138544130;
        v86 = v40;
        v87 = 2048;
        v88 = v41;
        v89 = 2048;
        v90 = *&v24;
        v91 = 2112;
        v92 = v24;
        _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Begin shared user invitation attempt %lu %p %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v37);
      v42 = [HMDSharedUserInviteOwnerSendLogEventBuilder alloc];
      identifier = [v24 identifier];
      user = [v24 user];
      privilege = [user privilege];
      [v24 age];
      v46 = [(HMDSharedUserInviteOwnerSendLogEventBuilder *)v42 initWithHome:v38 sessionIdentifier:identifier invitationType:privilege invitationAge:v33 invitationSource:?];

      [(HMDHome *)v38 addSharedUserEventBuilder:v46];
      v47 = [MEMORY[0x277CBEAA8] now];
      [v24 setDateSent:v47];

      backingStore2 = [(HMDHome *)v38 backingStore];
      context2 = [backingStore2 context];
      v72[0] = MEMORY[0x277D85DD0];
      v72[1] = 3221225472;
      v72[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1663;
      v72[3] = &unk_27868A750;
      v72[4] = v24;
      v72[5] = v38;
      [context2 unsafeSynchronousBlock:v72];

      v66[0] = MEMORY[0x277D85DD0];
      v66[1] = 3221225472;
      v66[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1664;
      v66[3] = &unk_278670240;
      objc_copyWeak(v70, &location);
      v66[4] = v24;
      v50 = v46;
      notificationCopy = notification;
      v67 = v50;
      v68 = v80;
      v70[1] = v33;
      v69 = v78;
      v51 = [futureWithNoValue then:v66];

      objc_destroyWeak(v70);
      futureWithNoValue = v51;
    }

    v62 = [obj countByEnumeratingWithState:&v74 objects:v84 count:16];
    if (v62)
    {
      continue;
    }

    break;
  }

LABEL_33:

  v64[0] = MEMORY[0x277D85DD0];
  v64[1] = 3221225472;
  v64[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1670;
  v64[3] = &unk_278670268;
  objc_copyWeak(&v65, &location);
  v64[4] = v80;
  v64[5] = v78;
  v56 = [futureWithNoValue then:v64];
  objc_destroyWeak(&v65);
  _Block_object_dispose(v78, 8);
  _Block_object_dispose(v80, 8);
  _HMFThreadLocalAsyncContextPop();

  objc_destroyWeak(&location);
  v57 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) identifier];
  v3 = [HMCContext findOutgoingInvitationWithModelID:v2];

  if (v3)
  {
    v4 = +[HMDHomeInvitation noRetryDate];
    [v3 setDateSent:v4];

    v5 = +[HMCContext currentContext];
    [v5 save];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 32) identifier];
      v12 = 138543618;
      v13 = v9;
      v14 = 2112;
      v15 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to find outgoing invitation with UUID %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1663(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) identifier];
  v3 = [HMCContext findOutgoingInvitationWithModelID:v2];

  if (v3)
  {
    v4 = [*(a1 + 32) dateSent];
    [v3 setDateSent:v4];

    v5 = +[HMCContext currentContext];
    [v5 save];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 32) identifier];
      v12 = 138543618;
      v13 = v9;
      v14 = 2112;
      v15 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to find outgoing invitation with UUID %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
}

uint64_t __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1664(uint64_t a1, void *a2)
{
  v61 = *MEMORY[0x277D85DE8];
  v40 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v51 = 0;
  v52 = &v51;
  v53 = 0x3032000000;
  v54 = __Block_byref_object_copy__14759;
  v55 = __Block_byref_object_dispose__14760;
  v56 = 0;
  v4 = [WeakRetained backingStore];
  v5 = [v4 context];
  v50[0] = MEMORY[0x277D85DD0];
  v50[1] = 3221225472;
  v50[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_2;
  v50[3] = &unk_27868A4D8;
  v50[4] = *(a1 + 32);
  v50[5] = WeakRetained;
  v50[6] = &v51;
  [v5 unsafeSynchronousBlock:v50];

  v6 = [v52[5] shareURL];

  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [*(a1 + 32) user];
      *buf = 138543618;
      v58 = v10;
      v59 = 2112;
      v60 = v11;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Resending invite, user already granted access %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    [*(a1 + 40) markUserAlreadyAddedToShare];
    v12 = *(a1 + 32);
    v13 = [v52[5] shareURL];
    [(HMDHome *)v8 __sendOutgoingInvitation:v12 shareURL:v13 shareToken:v52[5] suppressHomeInviteNotification:*(a1 + 80) logEventBuilder:*(a1 + 40)];
    v14 = 1;
  }

  else
  {
    v15 = v52[5];
    if (v15)
    {
      v16 = [v15 shareURL];
      v17 = v16 == 0;

      if (v17)
      {
        v18 = objc_autoreleasePoolPush();
        v19 = WeakRetained;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
        {
          v21 = HMFGetLogIdentifier();
          v22 = [*(a1 + 32) user];
          *buf = 138543618;
          v58 = v21;
          v59 = 2112;
          v60 = v22;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@nil shareURL on share token, will attempt to re-grant access for user: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
      }
    }

    v23 = objc_autoreleasePoolPush();
    v24 = WeakRetained;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      v27 = [*(a1 + 32) user];
      *buf = 138543618;
      v58 = v26;
      v59 = 2112;
      v60 = v27;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Granting share access for user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    v13 = [v24 homeManager];
    v28 = [v13 homeOwnerCloudShareManager];
    v29 = [*(a1 + 32) user];
    v30 = [v28 grantAccessForUser:v29 home:v24 logEventBuilder:*(a1 + 40)];
    v45[0] = MEMORY[0x277D85DD0];
    v45[1] = 3221225472;
    v45[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1665;
    v45[3] = &unk_2786701F0;
    objc_copyWeak(v48, (a1 + 64));
    v31 = *(a1 + 40);
    v32 = *(a1 + 32);
    v46 = v31;
    v47 = v32;
    v48[1] = *(a1 + 72);
    v49 = *(a1 + 80);
    v41[0] = MEMORY[0x277D85DD0];
    v41[1] = 3221225472;
    v41[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1668;
    v41[3] = &unk_278670218;
    objc_copyWeak(&v44, (a1 + 64));
    v33 = *(a1 + 56);
    v41[4] = *(a1 + 32);
    v43 = v33;
    v39 = *(a1 + 40);
    v34 = v39;
    v42 = v39;
    v35 = [v30 then:v45 orRecover:v41];
    if (!v35)
    {
      _HMFPreconditionFailure();
      __break(1u);
    }

    v36 = v35;

    objc_destroyWeak(&v44);
    objc_destroyWeak(v48);

    v14 = 3;
  }

  _Block_object_dispose(&v51, 8);
  v37 = *MEMORY[0x277D85DE8];
  return v14;
}

uint64_t __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1670(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained && *(*(*(a1 + 32) + 8) + 24) == 1)
  {
    if (*(*(*(a1 + 40) + 8) + 24))
    {
      v5 = 60.0;
    }

    else
    {
      v5 = 300.0;
    }

    v6 = objc_autoreleasePoolPush();
    v7 = WeakRetained;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v17 = v9;
      v18 = 2048;
      v19 = v5;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@At least one invite appears to have not been sent, scheduling resend in %f", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v10 = dispatch_time(0, (v5 * 1000000000.0));
    v11 = [v7 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1671;
    block[3] = &unk_278686B80;
    objc_copyWeak(&v15, (a1 + 48));
    dispatch_after(v10, v11, block);

    objc_destroyWeak(&v15);
  }

  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1671(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _processUnsentOutgoingInvitations];
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_2(uint64_t a1)
{
  v17 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) identifier];
  v3 = [HMCContext findOutgoingInvitationWithModelID:v2];

  if (v3)
  {
    v4 = [v3 shareToken];
    v5 = *(*(a1 + 48) + 8);
    v6 = *(v5 + 40);
    *(v5 + 40) = v4;
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 40);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [*(a1 + 32) identifier];
      v13 = 138543618;
      v14 = v10;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Unable to find outgoing invitation with UUID %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v12 = *MEMORY[0x277D85DE8];
}

uint64_t __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1665(uint64_t a1, void *a2)
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v5 = [v3 token];
    v6 = v5;
    if (v5 && ([v5 shareURL], v7 = objc_claimAutoreleasedReturnValue(), v7, v7))
    {
      v8 = [WeakRetained backingStore];
      v9 = [v8 context];
      v32[0] = MEMORY[0x277D85DD0];
      v32[1] = 3221225472;
      v32[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1666;
      v32[3] = &unk_27868A010;
      v32[4] = *(a1 + 40);
      v32[5] = WeakRetained;
      v33 = v6;
      [v9 unsafeSynchronousBlock:v32];

      v10 = [WeakRetained isCurrentDevicePrimaryResident];
      v11 = objc_autoreleasePoolPush();
      v12 = WeakRetained;
      v13 = HMFGetOSLogHandle();
      v14 = v13;
      if (v10)
      {
        if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
        {
          v15 = HMFGetLogIdentifier();
          v16 = [*(a1 + 40) user];
          *buf = 138543618;
          v35 = v15;
          v36 = 2112;
          v37 = v16;
          _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Sending outgoing invite for user %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v11);
        v17 = *(a1 + 40);
        v18 = [v3 url];
        v19 = [v3 token];
        [(HMDHome *)v12 __sendOutgoingInvitation:v17 shareURL:v18 shareToken:v19 suppressHomeInviteNotification:*(a1 + 64) logEventBuilder:*(a1 + 32)];
      }

      else
      {
        if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
        {
          v27 = HMFGetLogIdentifier();
          *buf = 138543362;
          v35 = v27;
          _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Current device is no longer primary after granting share access, do not send outgoing invitation from here.", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v11);
        v28 = *(a1 + 32);
        if ((*(a1 + 56) & 2) != 0)
        {
          [*(a1 + 32) cancel];
        }

        else
        {
          v29 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3202];
          [v28 markError:v29];
        }
      }
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      v21 = WeakRetained;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        v24 = [v6 shareURL];
        *buf = 138543874;
        v35 = v23;
        v36 = 2112;
        v37 = v6;
        v38 = 2112;
        v39 = v24;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Nil token (%@) and/or shareURL (%@) on share invitation, not saving token, not sending outgoing invitation", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v20);
      v25 = *(a1 + 32);
      v26 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3501];
      [v25 markError:v26];
    }
  }

  else
  {
    [*(a1 + 32) cancel];
  }

  v30 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1668(uint64_t a1, void *a2)
{
  v28 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if ([*(a1 + 32) shouldRetrySendingInvitationForError:v3])
  {
    *(*(*(a1 + 48) + 8) + 24) = 1;
    if (([*(a1 + 32) isMigrationInvitation] & 1) == 0)
    {
      *(*(*(a1 + 56) + 8) + 24) = 1;
    }
  }

  else if (([*(a1 + 32) isMigrationInvitation] & 1) == 0)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 32);
      *buf = 138543618;
      v23 = v8;
      v24 = 2112;
      v25 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Will not retry anymore invitation %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = [v6 backingStore];
    v11 = [v10 context];
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1669;
    v21[3] = &unk_27868A750;
    v21[4] = *(a1 + 32);
    v21[5] = v6;
    [v11 unsafeSynchronousBlock:v21];
  }

  v12 = objc_autoreleasePoolPush();
  v13 = WeakRetained;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
  {
    v15 = HMFGetLogIdentifier();
    v16 = [*(a1 + 32) user];
    *buf = 138543874;
    v23 = v15;
    v24 = 2112;
    v25 = v16;
    v26 = 2112;
    v27 = v3;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to add user %@ to share with error %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v12);
  v17 = *(a1 + 40);
  v18 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3502 underlyingError:v3];
  [v17 markError:v18];

  v19 = *MEMORY[0x277D85DE8];
  return 1;
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1669(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) identifier];
  v3 = [HMCContext findOutgoingInvitationWithModelID:v2];

  if (v3)
  {
    v4 = +[HMDHomeInvitation noRetryDate];
    [v3 setDateSent:v4];

    v5 = +[HMCContext currentContext];
    [v5 save];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 32) identifier];
      v12 = 138543618;
      v13 = v9;
      v14 = 2112;
      v15 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to find outgoing invitation with UUID %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1666(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) identifier];
  v3 = [HMCContext findOutgoingInvitationWithModelID:v2];

  if (v3)
  {
    [v3 setShareToken:*(a1 + 48)];
    v4 = +[HMCContext currentContext];
    [v4 save];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 40);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 32) identifier];
      v11 = 138543618;
      v12 = v8;
      v13 = 2112;
      v14 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@After granting share, unable to find outgoing invitation with UUID %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveOutgoingHomeInvitationModel:(id)model message:(id)message
{
  messageCopy = message;
  uuid = [model uuid];
  v7 = [(HMDHome *)self outgoingInvitationWithUUID:uuid];

  if (v7)
  {
    [(HMDHome *)self removeOutgoingInvitation:v7];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    user = [v7 user];
    uuid2 = [user uuid];
    v11 = [(HMDHome *)self userWithUUID:uuid2];

    if (v11)
    {
      [(HMDHome *)self __handleCompletedOutgoingInvitation:v7];
    }

    else
    {
      if ([transactionResult source] == 2 || objc_msgSend(transactionResult, "source") == 3)
      {
        [v7 cancel];
      }

      else
      {
        [(HMDHome *)self __handleCancelledOutgoingInvitation:v7];
      }

      [v7 updateInvitationState:1];
    }
  }

  [messageCopy respondWithPayload:0];
}

- (void)_handleAddOutgoingHomeInvitationModel:(id)model message:(id)message
{
  v44 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];
  v9 = [(HMDHome *)self outgoingInvitationWithUUID:uuid];

  if (!v9)
  {
    v10 = [(HMDHome *)self userFromOutgoingInvitationModel:modelCopy];
    [v10 refreshDisplayName];
    v11 = [HMDOutgoingHomeInvitation alloc];
    uuid2 = [modelCopy uuid];
    invitationState = [modelCopy invitationState];
    integerValue = [invitationState integerValue];
    expiryDate = [modelCopy expiryDate];
    v16 = [(HMDOutgoingHomeInvitation *)v11 initWithUUID:uuid2 invitee:v10 invitationState:integerValue forHome:self expiryDate:expiryDate messageIdentifier:0];

    v17 = objc_autoreleasePoolPush();
    selfCopy = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138544130;
      v37 = v20;
      v38 = 2112;
      v39 = v10;
      v40 = 2112;
      v41 = 0;
      v42 = 2112;
      v43 = v16;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Created user [%@] from outgoing invitation: %@ / %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v17);
    v21 = objc_alloc(MEMORY[0x277D0F818]);
    allMessageDestinations = [MEMORY[0x277D0F820] allMessageDestinations];
    v23 = [v21 initWithName:@"kTransactionUpdate" destination:allMessageDestinations payload:0];
    [(HMDOutgoingHomeInvitation *)v16 transactionObjectUpdated:0 newValues:modelCopy message:v23];

    workQueue = [(HMDHome *)selfCopy workQueue];
    [(HMDHomeInvitation *)v16 setClientQueue:workQueue];

    objc_initWeak(buf, selfCopy);
    objc_initWeak(&location, v16);
    v28 = MEMORY[0x277D85DD0];
    v29 = 3221225472;
    v30 = __57__HMDHome__handleAddOutgoingHomeInvitationModel_message___block_invoke;
    v31 = &unk_278687590;
    objc_copyWeak(&v33, buf);
    objc_copyWeak(&v34, &location);
    v25 = messageCopy;
    v32 = v25;
    [(HMDHomeInvitation *)v16 setExpirationHandler:&v28];
    [(HMDHome *)selfCopy addOutgoingInvitation:v16, v28, v29, v30, v31];
    [(HMDHome *)selfCopy _cleanRemovedUsers:v10];
    transactionResult = [v25 transactionResult];
    [transactionResult markChanged];

    objc_destroyWeak(&v34);
    objc_destroyWeak(&v33);
    objc_destroyWeak(&location);
    objc_destroyWeak(buf);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome__handleAddOutgoingHomeInvitationModel_message___block_invoke(id *a1)
{
  v15 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 5);
  v3 = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = WeakRetained;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [v3 identifier];
      v11 = 138543618;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Expiring invitation %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [v5 removeOutgoingInvitation:v3];
    [v5 __handleCancelledOutgoingInvitation:v3];
    [v3 updateInvitationState:{objc_msgSend(v3, "invitationState")}];
    v9 = [a1[4] name];
    [v5 saveWithReason:v9 postSyncNotification:0];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (id)userFromOutgoingInvitationModel:(id)model
{
  v38 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  pendingUserUUID = [modelCopy pendingUserUUID];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = MEMORY[0x277CCABB0];
    pendingUsers = [(HMDHome *)selfCopy pendingUsers];
    v12 = [v10 numberWithUnsignedInteger:{objc_msgSend(pendingUsers, "count")}];
    v30 = 138544130;
    v31 = v9;
    v32 = 2112;
    v33 = pendingUserUUID;
    v34 = 2112;
    v35 = v12;
    v36 = 2112;
    v37 = modelCopy;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@pending User UUID : %@ / %@ / %@", &v30, 0x2Au);
  }

  objc_autoreleasePoolPop(v6);
  if (pendingUserUUID)
  {
    v13 = objc_autoreleasePoolPush();
    v14 = selfCopy;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v30 = 138543618;
      v31 = v16;
      v32 = 2112;
      v33 = pendingUserUUID;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Going to find existing pending user with UUID: %@", &v30, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    pendingUsers2 = [(HMDHome *)v14 pendingUsers];
    v18 = [pendingUsers2 hmf_firstObjectWithUUID:pendingUserUUID];

    v19 = objc_autoreleasePoolPush();
    v20 = v14;
    v21 = HMFGetOSLogHandle();
    v22 = v21;
    if (v18)
    {
      if (!os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        goto LABEL_15;
      }

      v23 = HMFGetLogIdentifier();
      v30 = 138543618;
      v31 = v23;
      v32 = 2112;
      v33 = v18;
      v24 = "%{public}@Found the pending user from the list. Going to use it : %@";
      goto LABEL_14;
    }

    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      v30 = 138543618;
      v31 = v25;
      v32 = 2112;
      v33 = pendingUserUUID;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Did not find existing pending user with UUID: %@. Will go ahead and create a brand new user with random UUID", &v30, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
  }

  user = [modelCopy user];
  v18 = [HMDUser userWithDictionary:user];

  [v18 setHome:selfCopy];
  v19 = objc_autoreleasePoolPush();
  v27 = selfCopy;
  v22 = HMFGetOSLogHandle();
  if (!os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
  {
    goto LABEL_15;
  }

  v23 = HMFGetLogIdentifier();
  v30 = 138543618;
  v31 = v23;
  v32 = 2112;
  v33 = v18;
  v24 = "%{public}@No Pending user found for the invite. Creating a brand new user : %@";
LABEL_14:
  _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, v24, &v30, 0x16u);

LABEL_15:
  objc_autoreleasePoolPop(v19);

  v28 = *MEMORY[0x277D85DE8];

  return v18;
}

- (void)_handleUserInvitations:(id)invitations
{
  v96[2] = *MEMORY[0x277D85DE8];
  invitationsCopy = invitations;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  availableResidentDevices = [residentDeviceManager availableResidentDevices];
  v7 = [availableResidentDevices count];

  if (!v7)
  {
    v46 = objc_autoreleasePoolPush();
    selfCopy = self;
    v48 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
    {
      v49 = HMFGetLogIdentifier();
      *buf = 138543362;
      v91 = v49;
      _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_ERROR, "%{public}@Failed to invite user(s), no resident devices in home", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v46);
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    [invitationsCopy respondWithError:v8];
    goto LABEL_47;
  }

  v8 = [invitationsCopy dataForKey:*MEMORY[0x277CD06B8]];
  if (!v8)
  {
    v50 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v52 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
    {
      v53 = HMFGetLogIdentifier();
      messagePayload = [invitationsCopy messagePayload];
      *buf = 138543618;
      v91 = v53;
      v92 = 2112;
      v93 = messagePayload;
      _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@Failed to send invitations, missing user invite information: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v50);
    v14 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    [invitationsCopy respondWithError:v14];
    goto LABEL_46;
  }

  v9 = MEMORY[0x277CCAAC8];
  v10 = MEMORY[0x277CBEB98];
  v96[0] = objc_opt_class();
  v96[1] = objc_opt_class();
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v96 count:2];
  v12 = [v10 setWithArray:v11];
  v88 = 0;
  v13 = [v9 unarchivedObjectOfClasses:v12 fromData:v8 error:&v88];
  v14 = v88;

  v15 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v17 = HMFGetOSLogHandle();
  v18 = v17;
  if (!v13)
  {
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v55 = HMFGetLogIdentifier();
      *buf = 138543618;
      v91 = v55;
      v92 = 2112;
      v93 = v14;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode user invite information: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    v56 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    [invitationsCopy respondWithError:v56];
    goto LABEL_36;
  }

  v81 = v14;
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    users = [(HMDHome *)selfCopy3 users];
    v21 = [users count];
    *buf = 138543874;
    v91 = v19;
    v92 = 2048;
    v93 = v21;
    v94 = 2048;
    v95 = maximumUsersPerHome;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Adding users; current user count is %ld and max is %ld", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  users2 = [(HMDHome *)selfCopy3 users];
  v23 = [users2 count];
  v24 = v13;
  v25 = [v13 count] + v23;
  v26 = maximumUsersPerHome;

  if (v25 >= v26)
  {
    v13 = v24;
    v57 = objc_autoreleasePoolPush();
    v58 = selfCopy3;
    v59 = HMFGetOSLogHandle();
    v14 = v81;
    if (os_log_type_enabled(v59, OS_LOG_TYPE_INFO))
    {
      v60 = HMFGetLogIdentifier();
      *buf = 138543362;
      v91 = v60;
      _os_log_impl(&dword_229538000, v59, OS_LOG_TYPE_INFO, "%{public}@Can't add users; already at maximum users for home", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v57);
    v56 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:49 userInfo:0];
    responseHandler = [invitationsCopy responseHandler];
    (responseHandler)[2](responseHandler, v56, 0);

LABEL_36:
    goto LABEL_45;
  }

  v79 = v24;
  v80 = invitationsCopy;
  v86 = 0u;
  v87 = 0u;
  v84 = 0u;
  v85 = 0u;
  obj = v24;
  v27 = [obj countByEnumeratingWithState:&v84 objects:v89 count:16];
  if (!v27)
  {
    goto LABEL_23;
  }

  v28 = v27;
  v29 = *v85;
  v78 = v8;
  while (2)
  {
    for (i = 0; i != v28; ++i)
    {
      if (*v85 != v29)
      {
        objc_enumerationMutation(obj);
      }

      v31 = *(*(&v84 + 1) + 8 * i);
      v32 = objc_autoreleasePoolPush();
      v33 = selfCopy3;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543618;
        v91 = v35;
        v92 = 2112;
        v93 = v31;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Processing invite information : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v32);
      userID = [v31 userID];
      users3 = [(HMDHome *)v33 users];
      v38 = [users3 hmf_firstObjectWithValue:userID forKeyPath:@"userID"];

      if (v38)
      {
        v62 = objc_autoreleasePoolPush();
        v63 = v33;
        v64 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v64, OS_LOG_TYPE_INFO))
        {
          v65 = HMFGetLogIdentifier();
          *buf = 138543618;
          v91 = v65;
          v92 = 2112;
          v93 = userID;
          v66 = "%{public}@Failed to invite user %@ since the user is already part of the home";
LABEL_41:
          _os_log_impl(&dword_229538000, v64, OS_LOG_TYPE_INFO, v66, buf, 0x16u);
        }

LABEL_42:

        objc_autoreleasePoolPop(v62);
        responseHandler3 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:1 userInfo:0];
        invitationsCopy = v80;
        responseHandler2 = [v80 responseHandler];
        responseHandler2[2](responseHandler2, responseHandler3, 0);

        goto LABEL_43;
      }

      outgoingInvitations = [(HMDHome *)v33 outgoingInvitations];
      v38 = [outgoingInvitations hmf_firstObjectWithValue:userID forKeyPath:@"user.userID"];

      if (v38)
      {
        v62 = objc_autoreleasePoolPush();
        v63 = v33;
        v64 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v64, OS_LOG_TYPE_INFO))
        {
          v65 = HMFGetLogIdentifier();
          *buf = 138543618;
          v91 = v65;
          v92 = 2112;
          v93 = userID;
          v66 = "%{public}@Failed to invite user %@ since the user is already invited to the home";
          goto LABEL_41;
        }

        goto LABEL_42;
      }

      if ([v31 isAdministrator] && !-[HMDHome isResidentSupported](v33, "isResidentSupported"))
      {
        v70 = objc_autoreleasePoolPush();
        v71 = v33;
        v72 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v72, OS_LOG_TYPE_INFO))
        {
          v73 = HMFGetLogIdentifier();
          *buf = 138543618;
          v91 = v73;
          v92 = 2112;
          v93 = userID;
          _os_log_impl(&dword_229538000, v72, OS_LOG_TYPE_INFO, "%{public}@Cannot invite admin user %@ because it requires a resident", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v70);
        v38 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:48 userInfo:0];
        invitationsCopy = v80;
        responseHandler3 = [v80 responseHandler];
        (responseHandler3)[2](responseHandler3, v38, 0);
LABEL_43:

LABEL_44:
        v14 = v81;
        v13 = v79;

        v8 = v78;
        goto LABEL_45;
      }

      if ([v31 isRestrictedGuest])
      {
        restrictedGuestHomeAccessSettings = [v31 restrictedGuestHomeAccessSettings];
        identifiersOfAccessAllowedToAccessories = [restrictedGuestHomeAccessSettings identifiersOfAccessAllowedToAccessories];
        v42 = [identifiersOfAccessAllowedToAccessories count];

        if (v42)
        {
          restrictedGuestHomeAccessSettings2 = [v31 restrictedGuestHomeAccessSettings];
          identifiersOfAccessAllowedToAccessories2 = [restrictedGuestHomeAccessSettings2 identifiersOfAccessAllowedToAccessories];
          v83[0] = MEMORY[0x277D85DD0];
          v83[1] = 3221225472;
          v83[2] = __34__HMDHome__handleUserInvitations___block_invoke;
          v83[3] = &unk_27868A1B0;
          v83[4] = v33;
          v45 = [identifiersOfAccessAllowedToAccessories2 na_all:v83];

          if ((v45 & 1) == 0)
          {
            v74 = objc_autoreleasePoolPush();
            v75 = v33;
            v76 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v76, OS_LOG_TYPE_ERROR))
            {
              v77 = HMFGetLogIdentifier();
              *buf = 138543362;
              v91 = v77;
              _os_log_impl(&dword_229538000, v76, OS_LOG_TYPE_ERROR, "%{public}@Failed to invite guest user as could not find all the accessories in the home.", buf, 0xCu);
            }

            objc_autoreleasePoolPop(v74);
            v38 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2903];
            invitationsCopy = v80;
            [v80 respondWithError:v38];
            goto LABEL_44;
          }
        }
      }
    }

    v28 = [obj countByEnumeratingWithState:&v84 objects:v89 count:16];
    v8 = v78;
    if (v28)
    {
      continue;
    }

    break;
  }

LABEL_23:

  invitationsCopy = v80;
  [(HMDHome *)selfCopy3 _addUsersWithInviteInformations:obj message:v80];
  v14 = v81;
  v13 = v79;
LABEL_45:

LABEL_46:
LABEL_47:

  v69 = *MEMORY[0x277D85DE8];
}

BOOL __34__HMDHome__handleUserInvitations___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = [*(a1 + 32) accessoryWithUUID:a2];
  v3 = v2 != 0;

  return v3;
}

- (void)_cleanRemovedUsers:(id)users
{
  v17 = *MEMORY[0x277D85DE8];
  usersCopy = users;
  array = [MEMORY[0x277CBEB18] array];
  os_unfair_recursive_lock_lock_with_options();
  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  v6 = self->_removedUsers;
  v7 = [(NSMutableArray *)v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v7)
  {
    v8 = *v13;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(v6);
        }

        v10 = *(*(&v12 + 1) + 8 * i);
        if ([v10 isEqualToUser:{usersCopy, v12}])
        {
          [array addObject:v10];
        }
      }

      v7 = [(NSMutableArray *)v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v7);
  }

  [(NSMutableArray *)self->_removedUsers removeObjectsInArray:array];
  os_unfair_recursive_lock_unlock();

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_addAllUsersToAccessory:(id)accessory
{
  accessoryCopy = accessory;
  users = [(HMDHome *)self users];
  [(HMDHome *)self _addUsers:users accessory:accessoryCopy];
}

- (void)removeAllUsersAndCloudDataFromAccessory:(id)accessory completionHandler:(id)handler
{
  v37 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  handlerCopy = handler;
  isOwnerUser = [(HMDHome *)self isOwnerUser];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (isOwnerUser)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v34 = v13;
      v35 = 2112;
      v36 = accessoryCopy;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Removing cloud data from primary accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = accessoryCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;

    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    identifiersForBridgedAccessories = [v16 identifiersForBridgedAccessories];
    v18 = [identifiersForBridgedAccessories countByEnumeratingWithState:&v28 objects:v32 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = *v29;
      do
      {
        v21 = 0;
        do
        {
          if (*v29 != v20)
          {
            objc_enumerationMutation(identifiersForBridgedAccessories);
          }

          v22 = [(HMDHome *)selfCopy accessoryWithUUID:*(*(&v28 + 1) + 8 * v21)];
          [v22 removeCloudData];

          ++v21;
        }

        while (v19 != v21);
        v19 = [identifiersForBridgedAccessories countByEnumeratingWithState:&v28 objects:v32 count:16];
      }

      while (v19);
    }

    [v14 removeCloudData];
    v23 = objc_autoreleasePoolPush();
    [HMDBackgroundOperationManagerHelper removeAllUsersFromAccessory:v14 withCompletionHandler:handlerCopy];
    objc_autoreleasePoolPop(v23);
  }

  else
  {
    if (v12)
    {
      v24 = HMFGetLogIdentifier();
      shortDescription = [accessoryCopy shortDescription];
      *buf = 138543618;
      v34 = v24;
      v35 = 2112;
      v36 = shortDescription;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Not owner of home - bypassing removing users from accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v26 = _Block_copy(handlerCopy);
    v16 = v26;
    if (v26)
    {
      (*(v26 + 2))(v26);
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isUserValid:(id)valid error:(id *)error
{
  v24 = *MEMORY[0x277D85DE8];
  validCopy = valid;
  v7 = validCopy;
  if (!validCopy)
  {
    if (error)
    {
      v10 = MEMORY[0x277CCA9B8];
      v11 = @"Missing required parameter to validate user";
      v12 = 3;
LABEL_10:
      [v10 hmErrorWithCode:v12 description:v11 reason:0 suggestion:0];
      *error = v9 = 0;
      goto LABEL_12;
    }

LABEL_11:
    v9 = 0;
    goto LABEL_12;
  }

  pairingIdentity = [validCopy pairingIdentity];

  if (!pairingIdentity)
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      userID = [v7 userID];
      v20 = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = userID;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Invalid user '%@', missing either pairing username or public key", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    if (error)
    {
      v10 = MEMORY[0x277CCA9B8];
      v11 = @"Invalid user information";
      v12 = 21;
      goto LABEL_10;
    }

    goto LABEL_11;
  }

  v9 = 1;
LABEL_12:

  v18 = *MEMORY[0x277D85DE8];
  return v9;
}

- (BOOL)_verifyUserManagementPermissionForAccessory:(id)accessory error:(id *)error
{
  v31 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  if (![(HMDHome *)self isAdminUser])
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543362;
      v28 = v11;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_DEFAULT, "%{public}@Non administrator cannot perform user management", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    if (error)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:17 description:@"Must be administrator to perform user management" reason:0 suggestion:0];
      *error = v7 = 0;
      goto LABEL_13;
    }

LABEL_12:
    v7 = 0;
    goto LABEL_13;
  }

  if (([accessoryCopy supportsUserManagement] & 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      name = [accessoryCopy name];
      *buf = 138543618;
      v28 = v15;
      v29 = 2112;
      v30 = name;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Cannot perform user management on '%@' since it is does not support user management operations", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    if (error)
    {
      v25[0] = *MEMORY[0x277CCA450];
      v17 = MEMORY[0x277CCACA8];
      name2 = [accessoryCopy name];
      v19 = [v17 stringWithFormat:@"Cannot perform user management on '%@'", name2];
      v26[0] = v19;
      v25[1] = *MEMORY[0x277CCA470];
      mainBundle = [MEMORY[0x277CCA8D8] mainBundle];
      v21 = [mainBundle localizedStringForKey:@"Accessory is not a primary accessory." value:&stru_283CF9D50 table:0];
      v26[1] = v21;
      v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v26 forKeys:v25 count:2];

      *error = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:48 userInfo:v22];
    }

    goto LABEL_12;
  }

  v7 = 1;
LABEL_13:

  v23 = *MEMORY[0x277D85DE8];
  return v7;
}

- (void)_purgeResidentUsers
{
  selfCopy = self;
  v33 = *MEMORY[0x277D85DE8];
  residentCapableDevices = [(HMDHome *)self residentCapableDevices];
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  _residentUsers = [(HMDHome *)selfCopy _residentUsers];
  v5 = [_residentUsers copy];

  v23 = [v5 countByEnumeratingWithState:&v24 objects:v32 count:16];
  if (v23)
  {
    v7 = *v25;
    p_superclass = HMDIDSActivityRegistrationModel.superclass;
    *&v6 = 138543618;
    v21 = v6;
    v22 = *v25;
    do
    {
      for (i = 0; i != v23; ++i)
      {
        if (*v25 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v24 + 1) + 8 * i);
        userID = [v10 userID];
        v12 = [p_superclass + 324 deviceWithDestination:userID];

        if (v12 && [residentCapableDevices containsObject:v12])
        {
          v13 = objc_autoreleasePoolPush();
          v14 = selfCopy;
          v15 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v16 = v5;
            v17 = residentCapableDevices;
            v19 = v18 = selfCopy;
            *buf = v21;
            v29 = v19;
            v30 = 2112;
            v31 = v10;
            _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Removing non-legacy resident user from home: %@", buf, 0x16u);

            selfCopy = v18;
            residentCapableDevices = v17;
            v5 = v16;
            v7 = v22;
          }

          objc_autoreleasePoolPop(v13);
          [(HMDHome *)v14 _removeUser:v10];
          p_superclass = (HMDIDSActivityRegistrationModel + 8);
        }
      }

      v23 = [v5 countByEnumeratingWithState:&v24 objects:v32 count:16];
    }

    while (v23);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientsOfUpdatedResidentUser:(id)user
{
  v19 = *MEMORY[0x277D85DE8];
  userCopy = user;
  v5 = [(HMDHome *)self _residentDeviceForResidentUser:userCopy];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v10;
      v17 = 2112;
      v18 = userCopy;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Notifying clients of updated remote access gateway: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    homeManager = [(HMDHome *)selfCopy homeManager];
    identifier = [v5 identifier];
    [homeManager updateGenerationCounterWithReason:@"ResidentUserUpdated" sourceUUID:identifier shouldNotifyClients:1];
  }

  else
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = userCopy;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to find resident for resident user: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)_residentDeviceForResidentUser:(id)user
{
  v22 = *MEMORY[0x277D85DE8];
  userCopy = user;
  device = [userCopy device];
  if (device)
  {
    v6 = [HMDResidentDevice alloc];
    uuid = [userCopy uuid];
    v8 = [(HMDResidentDevice *)v6 initWithDevice:device identifier:uuid];

    if (-[HMDHome isResidentSupported](self, "isResidentSupported") || [userCopy configurationState] != 2)
    {
      [(HMDResidentDevice *)v8 setEnabled:0];
    }

    homeManager = [(HMDHome *)self homeManager];
    messageDispatcher = [homeManager messageDispatcher];
    v11 = [messageDispatcher remoteAccessDeviceForHome:self];

    if (([v11 isEqual:device] & 1) == 0)
    {
      [(HMDResidentDevice *)v8 setReachable:0];
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = userCopy;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Unable to find matching device for resident user: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v8 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v8;
}

- (id)_residentUserForResidentDevice:(id)device
{
  v28 = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  owner = [(HMDHome *)self owner];
  pairingIdentity = [owner pairingIdentity];

  if (pairingIdentity)
  {
    device = [deviceCopy device];
    if (device)
    {
      v8 = objc_alloc(MEMORY[0x277CFEC20]);
      identifier = [device identifier];
      uUIDString = [identifier UUIDString];
      publicKey = [pairingIdentity publicKey];
      privateKey = [pairingIdentity privateKey];
      v13 = [v8 initWithIdentifier:uUIDString publicKey:publicKey privateKey:privateKey permissions:{objc_msgSend(pairingIdentity, "permissions")}];

      if ([deviceCopy isEnabled])
      {
        v14 = 2;
      }

      else
      {
        v14 = 3;
      }

      v15 = [HMDResidentUser alloc];
      home = [deviceCopy home];
      v17 = [(HMDResidentUser *)v15 initWithDevice:device home:home pairingIdentity:v13 configurationState:v14];

      [(HMDUser *)v17 setHome:self];
      if ([(HMDResidentUser *)v17 isBlocked])
      {
        [(HMDResidentUser *)v17 setConfigurationState:3];
      }
    }

    else
    {
      v17 = 0;
    }
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    selfCopy = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
    {
      v21 = HMFGetLogIdentifier();
      v24 = 138543618;
      v25 = v21;
      v26 = 2112;
      v27 = deviceCopy;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to retrieve owner's pairing identity to create legacy resident user for device: %@", &v24, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
    v17 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v17;
}

- (id)userWithMergeID:(id)d
{
  v43 = *MEMORY[0x277D85DE8];
  dCopy = d;
  if (!dCopy)
  {
    goto LABEL_13;
  }

  v34 = 0u;
  v35 = 0u;
  v32 = 0u;
  v33 = 0u;
  users = [(HMDHome *)self users];
  v6 = [users countByEnumeratingWithState:&v32 objects:v42 count:16];
  if (!v6)
  {
    goto LABEL_12;
  }

  v7 = v6;
  v8 = *v33;
  selfCopy = self;
  while (2)
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v33 != v8)
      {
        objc_enumerationMutation(users);
      }

      v10 = *(*(&v32 + 1) + 8 * i);
      account = [v10 account];
      senderCorrelationIdentifier = [account senderCorrelationIdentifier];
      v13 = [senderCorrelationIdentifier isEqualToString:dCopy];

      if (v13)
      {
        v23 = objc_autoreleasePoolPush();
        v24 = selfCopy;
        v25 = selfCopy;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
        {
LABEL_20:
          v28 = HMFGetLogIdentifier();
          *buf = 138543874;
          v37 = v28;
          v38 = 2112;
          v39 = dCopy;
          v40 = 2112;
          v41 = v10;
          _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_DEBUG, "%{public}@Found user with mergeID %@: %@", buf, 0x20u);
        }

LABEL_21:

        objc_autoreleasePoolPop(v23);
        v22 = v10;

        goto LABEL_22;
      }

      mergeIdentifier = [v10 mergeIdentifier];
      if ([mergeIdentifier isEqual:dCopy])
      {

LABEL_19:
        v23 = objc_autoreleasePoolPush();
        v24 = selfCopy;
        v27 = selfCopy;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
        {
          goto LABEL_20;
        }

        goto LABEL_21;
      }

      accountIdentifier = [v10 accountIdentifier];
      senderCorrelationIdentifier2 = [accountIdentifier senderCorrelationIdentifier];
      v17 = [senderCorrelationIdentifier2 isEqual:dCopy];

      if (v17)
      {
        goto LABEL_19;
      }
    }

    v7 = [users countByEnumeratingWithState:&v32 objects:v42 count:16];
    self = selfCopy;
    if (v7)
    {
      continue;
    }

    break;
  }

LABEL_12:

LABEL_13:
  v18 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v20 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
  {
    v21 = HMFGetLogIdentifier();
    *buf = 138543618;
    v37 = v21;
    v38 = 2112;
    v39 = dCopy;
    _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEBUG, "%{public}@No user found with mergeID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v18);
  v22 = 0;
LABEL_22:

  v29 = *MEMORY[0x277D85DE8];

  return v22;
}

- (id)userWithPairingIdentityIdentifier:(id)identifier
{
  v17 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  if (identifierCopy)
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    users = [(HMDHome *)self users];
    v6 = [users countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v6)
    {
      v7 = *v13;
      while (2)
      {
        for (i = 0; i != v6; i = i + 1)
        {
          if (*v13 != v7)
          {
            objc_enumerationMutation(users);
          }

          v9 = *(*(&v12 + 1) + 8 * i);
          if ([v9 matchingPairingIdentityIdentifier:identifierCopy])
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        v6 = [users countByEnumeratingWithState:&v12 objects:v16 count:16];
        if (v6)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  else
  {
    v6 = 0;
  }

  v10 = *MEMORY[0x277D85DE8];

  return v6;
}

- (id)userWithPairingIdentity:(id)identity
{
  v19 = *MEMORY[0x277D85DE8];
  identityCopy = identity;
  if (identityCopy)
  {
    v16 = 0u;
    v17 = 0u;
    v14 = 0u;
    v15 = 0u;
    users = [(HMDHome *)self users];
    v6 = [users countByEnumeratingWithState:&v14 objects:v18 count:16];
    if (v6)
    {
      v7 = *v15;
      while (2)
      {
        for (i = 0; i != v6; i = i + 1)
        {
          if (*v15 != v7)
          {
            objc_enumerationMutation(users);
          }

          v9 = *(*(&v14 + 1) + 8 * i);
          pairingIdentity = [v9 pairingIdentity];
          v11 = [identityCopy isEqual:pairingIdentity];

          if (v11)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        v6 = [users countByEnumeratingWithState:&v14 objects:v18 count:16];
        if (v6)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  else
  {
    v6 = 0;
  }

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (BOOL)isSiriPhraseOptionsJustSiriEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = (self->_siriPhraseOptions >> 1) & 1;
  os_unfair_recursive_lock_unlock();
  return v3;
}

- (BOOL)isSiriPhraseOptionsHeySiriEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  siriPhraseOptions = self->_siriPhraseOptions;
  os_unfair_recursive_lock_unlock();
  return siriPhraseOptions & 1;
}

- (BOOL)isSmokeAlarmEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  audioAnalysisClassifierOptions = self->_audioAnalysisClassifierOptions;
  os_unfair_recursive_lock_unlock();
  return audioAnalysisClassifierOptions & 1;
}

- (NSArray)removedUsers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_removedUsers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSArray)usersPendingUserManagementOperations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_usersPendingUserManagementOperations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (BOOL)isOwnerUser
{
  os_unfair_recursive_lock_lock_with_options();
  ownerUser = self->_ownerUser;
  os_unfair_recursive_lock_unlock();
  return ownerUser;
}

- (void)setOwnerUser:(BOOL)user
{
  os_unfair_recursive_lock_lock_with_options();
  self->_ownerUser = user;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isSharedAdmin
{
  isAdminUser = [(HMDHome *)self isAdminUser];
  if (isAdminUser)
  {
    LOBYTE(isAdminUser) = ![(HMDHome *)self isOwnerUser];
  }

  return isAdminUser;
}

- (BOOL)isAdminUser
{
  currentUser = [(HMDHome *)self currentUser];
  isAdministrator = [currentUser isAdministrator];

  return isAdministrator;
}

- (HMDUser)currentUser
{
  v17 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (!self->_currentUser)
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    users = [(HMDHome *)self users];
    v4 = [users countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v4)
    {
      v5 = *v13;
      while (2)
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v13 != v5)
          {
            objc_enumerationMutation(users);
          }

          v7 = *(*(&v12 + 1) + 8 * i);
          if ([v7 isCurrentUser])
          {
            objc_storeStrong(&self->_currentUser, v7);
            presenceAuthStatus = [(HMDHome *)self presenceAuthStatus];
            [(HMDUser *)self->_currentUser setPresenceAuthStatus:presenceAuthStatus];

            goto LABEL_12;
          }
        }

        v4 = [users countByEnumeratingWithState:&v12 objects:v16 count:16];
        if (v4)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  os_unfair_recursive_lock_unlock();
  currentUser = self->_currentUser;
  v10 = *MEMORY[0x277D85DE8];

  return currentUser;
}

- (void)setCurrentUser:(id)user
{
  userCopy = user;
  os_unfair_recursive_lock_lock_with_options();
  currentUser = self->_currentUser;
  self->_currentUser = userCopy;

  os_unfair_recursive_lock_unlock();
}

- (id)owner
{
  v16 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (!self->_owner)
  {
    v13 = 0u;
    v14 = 0u;
    v11 = 0u;
    v12 = 0u;
    users = [(HMDHome *)self users];
    v4 = [users countByEnumeratingWithState:&v11 objects:v15 count:16];
    if (v4)
    {
      v5 = *v12;
      while (2)
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v12 != v5)
          {
            objc_enumerationMutation(users);
          }

          v7 = *(*(&v11 + 1) + 8 * i);
          if ([v7 privilege] == 3)
          {
            objc_storeStrong(&self->_owner, v7);
            goto LABEL_12;
          }
        }

        v4 = [users countByEnumeratingWithState:&v11 objects:v15 count:16];
        if (v4)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  os_unfair_recursive_lock_unlock();
  owner = self->_owner;
  v9 = *MEMORY[0x277D85DE8];

  return owner;
}

- (void)setOwner:(id)owner
{
  ownerCopy = owner;
  os_unfair_recursive_lock_lock_with_options();
  owner = self->_owner;
  self->_owner = ownerCopy;

  os_unfair_recursive_lock_unlock();
}

- (void)_removeUser:(id)user
{
  userCopy = user;
  if (userCopy)
  {
    v5 = userCopy;
    os_unfair_recursive_lock_lock_with_options();
    if ([(NSMutableArray *)self->_users containsObject:v5])
    {
      [(NSMutableArray *)self->_users removeObject:v5];
    }

    os_unfair_recursive_lock_unlock();
    userCopy = v5;
  }
}

- (void)addUser:(id)user
{
  v34 = *MEMORY[0x277D85DE8];
  userCopy = user;
  homeManager = [(HMDHome *)self homeManager];
  if (userCopy)
  {
    os_unfair_recursive_lock_lock_with_options();
    if (([(NSMutableArray *)self->_users containsObject:userCopy]& 1) == 0)
    {
      v6 = objc_autoreleasePoolPush();
      selfCopy = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = HMFGetLogIdentifier();
        v30 = 138543618;
        v31 = v9;
        v32 = 2112;
        v33 = userCopy;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Adding a new user : %@", &v30, 0x16u);
      }

      objc_autoreleasePoolPop(v6);
      [(NSMutableArray *)self->_users addObject:userCopy];
    }

    os_unfair_recursive_lock_unlock();
    if (([userCopy isCurrentUser] & 1) != 0 && (objc_msgSend(userCopy, "isPending") & 1) == 0)
    {
      v10 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v13 = HMFGetLogIdentifier();
        uuid = [userCopy uuid];
        v30 = 138543618;
        v31 = v13;
        v32 = 2112;
        v33 = uuid;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Setting user %@ as current user", &v30, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      [(HMDHome *)selfCopy2 setCurrentUser:userCopy];
      if (homeManager)
      {
        owner = [(HMDHome *)selfCopy2 owner];
        isCurrentUser = [owner isCurrentUser];

        if ((isCurrentUser & 1) == 0)
        {
          homeSharedUserCloudShareManager = [homeManager homeSharedUserCloudShareManager];
          uuid2 = [(HMDHome *)selfCopy2 uuid];
          [homeSharedUserCloudShareManager removeSharesWithNoParticipantForHomeWithModelID:uuid2];
        }

        uuid3 = [(HMDHome *)selfCopy2 uuid];
        [homeManager removeHomeFromSharedHomesNotYetMigrated:uuid3];
      }

      v20 = objc_autoreleasePoolPush();
      v21 = selfCopy2;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
      {
        v23 = HMFGetLogIdentifier();
        v30 = 138543362;
        v31 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Send the initial presence update to primary.", &v30, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      presenceFeeder = [(HMDHome *)v21 presenceFeeder];
      [presenceFeeder sendInitialPresenceUpdate];

      v25 = objc_autoreleasePoolPush();
      v26 = v21;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
      {
        v28 = HMFGetLogIdentifier();
        v30 = 138543362;
        v31 = v28;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - addUser", &v30, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
      [(HMDHome *)v26 _configureUserActivityStateDetectorManager];
    }
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (NSArray)usersSupportingPresence
{
  users = [(HMDHome *)self users];
  v3 = [HMDHome filterUsersSupportingPresence:users];

  return v3;
}

- (id)usersIncludingPendingUsers:(BOOL)users
{
  usersCopy = users;
  os_unfair_recursive_lock_lock_with_options();
  users = self->_users;
  if (usersCopy)
  {
    v6 = [(NSMutableArray *)users copy];
  }

  else
  {
    v6 = [(NSMutableArray *)users na_filter:&__block_literal_global_1631];
  }

  v7 = v6;
  os_unfair_recursive_lock_unlock();

  return v7;
}

- (id)pendingUsers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_users na_filter:&__block_literal_global_1629];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (id)userIncludingPendingUserWithUUID:(id)d
{
  dCopy = d;
  v5 = [(HMDHome *)self usersIncludingPendingUsers:1];
  v6 = [v5 hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)restrictedGuests
{
  users = [(HMDHome *)self users];
  v3 = [users na_filter:&__block_literal_global_1627];

  return v3;
}

- (id)sharedUsers
{
  users = [(HMDHome *)self users];
  v3 = [users na_map:&__block_literal_global_1624];

  return v3;
}

id __22__HMDHome_sharedUsers__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 privilege] == 3)
  {
    v3 = 0;
  }

  else
  {
    v3 = v2;
  }

  return v3;
}

- (void)_handleRemoveAppDataModel:(id)model message:(id)message
{
  messageCopy = message;
  [(HMDHome *)self setAppData:0];
  transactionResult = [messageCopy transactionResult];
  [transactionResult markChanged];
  [messageCopy respondWithPayload:0];
}

- (void)_handleUpdateAppDataModel:(id)model message:(id)message
{
  v25 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  appData = [(HMDHome *)self appData];

  if (appData)
  {
    appData2 = [(HMDHome *)self appData];
    [appData2 updateWithModel:modelCopy];
  }

  else
  {
    v10 = [HMDApplicationData alloc];
    appDataDictionary = [modelCopy appDataDictionary];
    uuid = [(HMDHome *)self uuid];
    v13 = [(HMDApplicationData *)v10 initWithDictionary:appDataDictionary parentUUID:uuid];
    [(HMDHome *)self setAppData:v13];

    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
    {
      v17 = HMFGetLogIdentifier();
      appDataDictionary2 = [modelCopy appDataDictionary];
      v21 = 138543618;
      v22 = v17;
      v23 = 2112;
      v24 = appDataDictionary2;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_DEBUG, "%{public}@Updating the application data : %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
  }

  transactionResult = [messageCopy transactionResult];
  [transactionResult markChanged];
  [messageCopy respondWithPayload:0];

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetAppData:(id)data
{
  v28 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  v21 = 0;
  v5 = [dataCopy appDataDictionaryWithError:&v21];
  v6 = v21;
  if (v5)
  {
    v7 = [(HMDHome *)self _appDataContainerForMessage:dataCopy];
    if (v7)
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543874;
        v23 = v11;
        v24 = 2112;
        v25 = v7;
        v26 = 2112;
        v27 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Going to update appData for %@ to: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v8);
      appData = [v7 appData];
      uuid = [v7 uuid];
      v14 = [HMDApplicationDataModel modelWithAppDataPayload:v5 existingAppData:appData parentUUID:uuid];
      if (v14)
      {
        backingStore = [(HMDHome *)selfCopy backingStore];
        name = [dataCopy name];
        v17 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        [backingStore transaction:name options:v17];
        v18 = v20 = v6;

        [v18 add:v14 withMessage:dataCopy];
        [v18 run];

        v6 = v20;
      }

      else
      {
        [dataCopy respondWithSuccess];
      }
    }

    else
    {
      appData = [dataCopy responseHandler];
      uuid = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (appData)[2](appData, uuid, 0);
    }
  }

  else
  {
    [dataCopy respondWithError:v6];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (id)_appDataContainerForMessage:(id)message
{
  messageCopy = message;
  v5 = [messageCopy uuidForKey:*MEMORY[0x277CD0D40]];
  if (v5)
  {
    v6 = [(HMDHome *)self roomWithUUID:v5];
  }

  else
  {
    v7 = [messageCopy uuidForKey:*MEMORY[0x277CD25E0]];
    if (v7)
    {
      v6 = [(HMDHome *)self serviceGroupWithUUID:v7];
    }

    else
    {
      v8 = [messageCopy uuidForKey:*MEMORY[0x277CD2050]];
      if (v8)
      {
        selfCopy = [(HMDHome *)self actionSetWithUUID:v8];
      }

      else
      {
        selfCopy = self;
      }

      v6 = selfCopy;
    }
  }

  return v6;
}

- (void)_handleAllowUserManagementMessage:(id)message
{
  v23 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  availableResidentDevices = [residentDeviceManager availableResidentDevices];
  v7 = [availableResidentDevices count];

  if (!v7)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Unable to allow user management, no resident devices in home", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v13 = MEMORY[0x277CCA9B8];
    v14 = 91;
    goto LABEL_10;
  }

  if (![(HMDHome *)self isAdminUser])
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Unable to allow user management, insufficient privileges", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
    v13 = MEMORY[0x277CCA9B8];
    v14 = 17;
LABEL_10:
    responseHandler2 = [v13 hmErrorWithCode:v14];
    responseHandler = [messageCopy responseHandler];
    responseHandler[2](responseHandler, responseHandler2, MEMORY[0x277CBEC10]);

    goto LABEL_11;
  }

  responseHandler2 = [messageCopy responseHandler];
  responseHandler2[2](responseHandler2, 0, MEMORY[0x277CBEC10]);
LABEL_11:

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleExecuteConfirmationOfTrigger:(id)trigger
{
  v55 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  if (([(__CFString *)triggerCopy isEntitledForSPIAccess]& 1) != 0 || ([(__CFString *)triggerCopy isRemote]& 1) != 0)
  {
    responseHandler4 = [(__CFString *)triggerCopy uuidForKey:*MEMORY[0x277CD2768]];
    triggers = [(HMDHome *)self triggers];
    v7 = [triggers hmf_firstObjectWithSPIUniqueIdentifier:responseHandler4];

    v8 = v7;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    isWatch();
    if (isWatch() && ([v10 hasUserConfirmationSession] & 1) == 0)
    {
      v24 = objc_autoreleasePoolPush();
      selfCopy = self;
      v26 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
      {
        v27 = HMFGetLogIdentifier();
        isWatch();
        *buf = 138543874;
        v50 = v27;
        v51 = 2112;
        v52 = @"non-Tinker HH2";
        v53 = 2112;
        v54 = triggerCopy;
        _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Received trigger execution confirmation for relay in %@ Watch, %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v24);
      homeManager = [(HMDHome *)selfCopy homeManager];
      companionDevice = [homeManager companionDevice];
      if (companionDevice && [homeManager companionReachable])
      {
        v28 = [HMDRemoteDeviceMessageDestination alloc];
        uuid = [(HMDHome *)selfCopy uuid];
        v43 = companionDevice;
        v30 = [(HMDRemoteDeviceMessageDestination *)v28 initWithTarget:uuid device:companionDevice];

        v31 = MEMORY[0x277D0F818];
        messagePayload = [(__CFString *)triggerCopy messagePayload];
        v33 = [messagePayload copy];
        v34 = [v31 messageWithName:@"kConfirmExecuteTriggerRequestKey" qualityOfService:25 destination:v30 payload:v33];

        v47[0] = MEMORY[0x277D85DD0];
        v47[1] = 3221225472;
        v47[2] = __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke;
        v47[3] = &unk_278689DC0;
        v48 = triggerCopy;
        [v34 setResponseHandler:v47];
        v35 = objc_autoreleasePoolPush();
        v36 = selfCopy;
        v37 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v38 = v42 = v35;
          *buf = 138543362;
          v50 = v38;
          _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_INFO, "%{public}@Sending confirmation to companion", buf, 0xCu);

          v35 = v42;
        }

        objc_autoreleasePoolPop(v35);
        messageDispatcher = [homeManager messageDispatcher];
        [messageDispatcher sendMessage:v34 completionHandler:0];

        companionDevice = v43;
      }

      else
      {
        v30 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:63 userInfo:0];
        responseHandler = [(__CFString *)triggerCopy responseHandler];
        v34 = responseHandler;
        if (responseHandler)
        {
          (*(responseHandler + 16))(responseHandler, v30, 0);
        }
      }
    }

    else
    {
      v11 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        *buf = 138543618;
        v50 = v14;
        v51 = 2112;
        v52 = triggerCopy;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Received trigger execution confirmation on iOS or HH2 Watch: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
      if (v8)
      {
        v15 = [(__CFString *)triggerCopy BOOLForKey:*MEMORY[0x277CD2740]];
        v44[0] = MEMORY[0x277D85DD0];
        v44[1] = 3221225472;
        v44[2] = __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke_1619;
        v44[3] = &unk_27868A1D8;
        v45 = v8;
        v46 = triggerCopy;
        [v45 userDidConfirmExecute:v15 completionHandler:v44];

        homeManager = v45;
LABEL_29:

        goto LABEL_30;
      }

      homeManager = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      responseHandler2 = [(__CFString *)triggerCopy responseHandler];
      companionDevice = responseHandler2;
      if (responseHandler2)
      {
        (*(responseHandler2 + 16))(responseHandler2, homeManager, 0);
      }
    }

    goto LABEL_29;
  }

  v17 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 138543362;
    v50 = v20;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI and it's not relayed from watch.", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v17);
  responseHandler3 = [(__CFString *)triggerCopy responseHandler];

  if (responseHandler3)
  {
    responseHandler4 = [(__CFString *)triggerCopy responseHandler];
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    (responseHandler4)[2](responseHandler4, v8, 0);
LABEL_30:
  }

  v41 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  v3 = [*(a1 + 32) responseHandler];
  v4 = v3;
  if (v3)
  {
    (*(v3 + 16))(v3, v5, 0);
  }
}

void __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke_1619(uint64_t a1, void *a2)
{
  v5 = a2;
  if (v5 && isiOSDevice())
  {
    +[HMDBulletinUIManager presentExecutionErrorDialogForTrigger:partialSuccess:](HMDBulletinUIManager, "presentExecutionErrorDialogForTrigger:partialSuccess:", *(a1 + 32), [v5 code] == 64);
  }

  v3 = [*(a1 + 40) responseHandler];
  v4 = v3;
  if (v3)
  {
    (*(v3 + 16))(v3, v5, 0);
  }
}

- (void)_removeTrigger:(id)trigger message:(id)message
{
  v34 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  messageCopy = message;
  if (triggerCopy)
  {
    [(HMDHome *)self removeTriggerNoNotification:triggerCopy];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v12;
      v32 = 2112;
      v33 = triggerCopy;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Remove trigger: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    uuid = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid UUIDString];
    v29[0] = uUIDString;
    v28[1] = *MEMORY[0x277CD2758];
    name = [triggerCopy name];
    v29[1] = name;
    v28[2] = *MEMORY[0x277CD2768];
    uuid2 = [triggerCopy uuid];
    uUIDString2 = [uuid2 UUIDString];
    v29[2] = uUIDString2;
    v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:3];

    v19 = objc_autoreleasePoolPush();
    v20 = selfCopy;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v22;
      v32 = 2112;
      v33 = v18;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Successfully Removed trigger : sending back the result: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    [messageCopy respondWithPayload:v18];
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v26;
      v32 = 2112;
      v33 = 0;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Could not find the Trigger : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    transactionResult = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    [messageCopy respondWithError:transactionResult];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)removeTriggerNoNotification:(id)notification
{
  notificationCopy = notification;
  if (notificationCopy)
  {
    v9 = notificationCopy;
    [notificationCopy invalidate];
    name = [v9 name];
    v6 = [(HMDHome *)self removeName:name];

    [(HMDHome *)self removeFromCurrentTriggers:v9];
    os_unfair_recursive_lock_lock_with_options();
    ownedTriggers = self->_ownedTriggers;
    uuid = [v9 uuid];
    [(NSMutableArray *)ownedTriggers removeObject:uuid];

    os_unfair_recursive_lock_unlock();
    notificationCopy = v9;
  }
}

- (void)removeTrigger:(id)trigger
{
  triggerCopy = trigger;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __25__HMDHome_removeTrigger___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = triggerCopy;
  v6 = triggerCopy;
  dispatch_async(workQueue, v7);
}

void __25__HMDHome_removeTrigger___block_invoke(uint64_t a1)
{
  v12[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277D0F818];
  v3 = objc_alloc(MEMORY[0x277D0F820]);
  v4 = [*(a1 + 32) uuid];
  v5 = [v3 initWithTarget:v4];
  v11 = *MEMORY[0x277CD2768];
  v6 = [*(a1 + 40) uuid];
  v7 = [v6 UUIDString];
  v12[0] = v7;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:&v11 count:1];
  v9 = [v2 messageWithName:@"kRemoveTriggerRequestKey" destination:v5 payload:v8];

  [*(a1 + 32) _handleRemoveTrigger:v9];
  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveTriggerModel:(id)model message:(id)message
{
  v21 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];
  v9 = [(HMDHome *)self triggerWithUUID:uuid];

  if (v9)
  {
    [(HMDHome *)self _removeTrigger:v9 message:messageCopy];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      uuid2 = [modelCopy uuid];
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = uuid2;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Couldn't find trigger with UUID %@ to remove.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    transactionResult = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:transactionResult];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveTrigger:(id)trigger
{
  v25 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  v5 = [triggerCopy uuidForKey:*MEMORY[0x277CD2768]];
  v6 = [(HMDHome *)self triggerWithUUID:v5];
  if (v6)
  {
    v7 = [HMDTriggerModel alloc];
    uuid = [v6 uuid];
    uuid2 = [(HMDHome *)self uuid];
    v10 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:uuid parentUUID:uuid2];

    backingStore = [(HMDHome *)self backingStore];
    name = [triggerCopy name];
    v13 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v14 = [backingStore transaction:name options:v13];

    [v14 add:v10 withMessage:triggerCopy];
    [v14 run];
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v18;
      v23 = 2112;
      v24 = v5;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Cannot find the trigger with UUID %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [triggerCopy respondWithError:v19];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_addNewTrigger:(id)trigger message:(id)message payloadAnnex:(id)annex triggerModel:(id)model
{
  v43 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  messageCopy = message;
  annexCopy = annex;
  modelCopy = model;
  [(HMDHome *)self addToCurrentTriggers:triggerCopy];
  os_unfair_recursive_lock_lock_with_options();
  ownedTriggers = self->_ownedTriggers;
  uuid = [triggerCopy uuid];
  if (([(NSMutableArray *)ownedTriggers containsObject:uuid]& 1) == 0)
  {
    owner = [triggerCopy owner];
    isOwner = [owner isOwner];

    if (!isOwner)
    {
      goto LABEL_5;
    }

    v18 = self->_ownedTriggers;
    uuid = [triggerCopy uuid];
    [(NSMutableArray *)v18 addObject:uuid];
  }

LABEL_5:
  os_unfair_recursive_lock_unlock();
  msgDispatcher = [(HMDHome *)self msgDispatcher];
  workQueue = [(HMDHome *)self workQueue];
  [triggerCopy configure:self messageDispatcher:msgDispatcher queue:workQueue];

  transactionResult = [messageCopy transactionResult];
  [transactionResult markChanged];
  name = [messageCopy name];
  if ([name isEqualToString:@"kAddEventTriggerRequestKey"])
  {
  }

  else
  {
    name2 = [messageCopy name];
    v24 = [name2 isEqualToString:@"kAddTimerTriggerRequestKey"];

    if ((v24 & 1) == 0)
    {
      [messageCopy respondWithSuccess];
      goto LABEL_14;
    }
  }

  v25 = objc_autoreleasePoolPush();
  selfCopy = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
  {
    v28 = HMFGetLogIdentifier();
    name3 = [triggerCopy name];
    v37 = 138543874;
    v38 = v28;
    v39 = 2112;
    v40 = name3;
    v41 = 2112;
    v42 = messageCopy;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Add trigger Transaction marked for change. The client will be updated next: %@, %@", &v37, 0x20u);
  }

  objc_autoreleasePoolPop(v25);
  v30 = MEMORY[0x277CBEB38];
  messagePayload = [messageCopy messagePayload];
  v32 = [v30 dictionaryWithDictionary:messagePayload];

  v33 = HMDRemoteMessagePayloadKeysForTransportMetadata();
  [v32 removeObjectsForKeys:v33];

  uuid2 = [triggerCopy uuid];
  uUIDString = [uuid2 UUIDString];
  [v32 setObject:uUIDString forKey:*MEMORY[0x277CD2768]];

  if (annexCopy)
  {
    [v32 addEntriesFromDictionary:annexCopy];
  }

  [messageCopy respondWithPayload:v32];

LABEL_14:
  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTimerTriggerModel:(id)model message:(id)message
{
  v19 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v8 = [[HMDTimerTrigger alloc] initWithModel:modelCopy home:self];
  if (v8)
  {
    createPayload = [modelCopy createPayload];
    [(HMDHome *)self _addNewTrigger:v8 message:messageCopy payloadAnnex:createPayload triggerModel:modelCopy];
LABEL_7:

    goto LABEL_8;
  }

  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v17 = 138543362;
    v18 = v13;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Could not create timer trigger object from model", &v17, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  responseHandler = [messageCopy responseHandler];

  if (responseHandler)
  {
    createPayload = [messageCopy responseHandler];
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (createPayload)[2](createPayload, v15, 0);

    goto LABEL_7;
  }

LABEL_8:

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTimerTrigger:(id)trigger
{
  v40 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  residentEnabledDevices = [(HMDHome *)self residentEnabledDevices];
  v6 = [residentEnabledDevices count];

  if (v6)
  {
    name = [triggerCopy name];
    v8 = [name isEqualToString:*MEMORY[0x277CCF200]];

    v9 = [triggerCopy stringForKey:*MEMORY[0x277CD2758]];
    if ([(HMDHome *)self _validateAddingNewTriggerWithName:v9 message:triggerCopy])
    {
      v10 = [triggerCopy stringForKey:*MEMORY[0x277CD1250]];
      uUID = [MEMORY[0x277CCAD78] UUID];
      v12 = [HMDTimerTriggerModel alloc];
      uuid = [(HMDHome *)self uuid];
      v14 = [(HMDBackingStoreModelObject *)v12 initWithObjectChangeType:1 uuid:uUID parentUUID:uuid];

      [(HMDTimerTriggerModel *)v14 setName:v9];
      [(HMDTimerTriggerModel *)v14 setConfiguredName:v10];
      [(HMDTimerTriggerModel *)v14 setActive:MEMORY[0x277CBEC28]];
      v15 = [HMDTimerTrigger validateTriggerModel:v14 message:triggerCopy currentFireDate:0];

      if (!v15)
      {
LABEL_16:

        goto LABEL_17;
      }

      v33 = uUID;
      v16 = v10;
      backingStore = [(HMDHome *)self backingStore];
      name2 = [triggerCopy name];
      +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v20 = v19 = v8;
      v21 = [backingStore transaction:name2 options:v20];

      v22 = v19;
      if (v19)
      {
        v23 = objc_alloc_init(MEMORY[0x277CBEB38]);
        v10 = v16;
        uUID = v33;
        v24 = v21;
        if (![(HMDHome *)self _populateTriggerModel:v15 fromBuilderMessage:triggerCopy transaction:v21 responsePayload:v23])
        {
LABEL_15:

          goto LABEL_16;
        }
      }

      else
      {
        v23 = 0;
        v10 = v16;
        uUID = v33;
        v24 = v21;
      }

      [triggerCopy userForHome:self];
      v30 = v29 = v22;
      [v15 setOwner:v30];

      currentDevice = [(HMDHome *)self currentDevice];
      [v15 setOwningDevice:currentDevice];

      if (v29)
      {
        [v24 add:v15];
        v34[0] = MEMORY[0x277D85DD0];
        v34[1] = 3221225472;
        v34[2] = __34__HMDHome__handleAddTimerTrigger___block_invoke;
        v34[3] = &unk_278688D58;
        v35 = triggerCopy;
        v23 = v23;
        v36 = v23;
        v37 = v15;
        [v24 run:v34];
      }

      else
      {
        [v24 add:v15 withMessage:triggerCopy];
        [v24 run];
      }

      goto LABEL_15;
    }

    v25 = objc_autoreleasePoolPush();
    selfCopy = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543362;
      v39 = v28;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Trigger name is not valid", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v25);
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    [triggerCopy respondWithError:v9];
  }

LABEL_17:

  v32 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddTimerTrigger___block_invoke(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v4 = *(a1 + 40);
    v5 = [*(a1 + 48) createPayload];
    [v4 addEntriesFromDictionary:v5];

    v6 = *(a1 + 32);
    v7 = [*(a1 + 40) copy];
    [v6 respondWithPayload:v7];
  }
}

- (void)_relayAddTriggerToResident:(id)resident
{
  v24[1] = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  v24[0] = residentCopy;
  v5 = [MEMORY[0x277CBEA60] arrayWithObjects:v24 count:1];
  v6 = encodeRootObject();

  v22 = @"HM.triggers";
  v23 = v6;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v23 forKeys:&v22 count:1];
  objc_initWeak(&location, self);
  v8 = MEMORY[0x277D0F848];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __38__HMDHome__relayAddTriggerToResident___block_invoke;
  v18[3] = &unk_278687F40;
  objc_copyWeak(&v20, &location);
  v9 = residentCopy;
  v19 = v9;
  v10 = [v8 messageWithName:@"kAddTriggersInternalRequestKey" messagePayload:v7 responseHandler:v18];
  v11 = objc_alloc(MEMORY[0x277D0F820]);
  uuid = [(HMDHome *)self uuid];
  v13 = [v11 initWithTarget:uuid];

  [v10 setDestination:v13];
  [v10 setQualityOfService:33];
  administratorHandler = [(HMDHome *)self administratorHandler];
  v15 = [v10 copy];
  v16 = [administratorHandler operationForMessage:v15 error:0];

  if (v16)
  {
    [administratorHandler addOperation:v16];
  }

  objc_destroyWeak(&v20);
  objc_destroyWeak(&location);

  v17 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__relayAddTriggerToResident___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = @"kAddTriggersInternalRequestKey";
      v20 = 2112;
      v21 = v5;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Relayed message %@ with error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    if (v5)
    {
      v12 = [v9 workQueue];
      v14[0] = MEMORY[0x277D85DD0];
      v14[1] = 3221225472;
      v14[2] = __38__HMDHome__relayAddTriggerToResident___block_invoke_1607;
      v14[3] = &unk_27868A750;
      v14[4] = v9;
      v15 = *(a1 + 32);
      dispatch_async(v12, v14);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__relayAddTriggerToResident___block_invoke_1607(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v15 = 138543618;
    v16 = v5;
    v17 = 2112;
    v18 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Removing trigger that was not added to resident: %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = [HMDTriggerModel alloc];
  v8 = [*(a1 + 40) uuid];
  v9 = [*(a1 + 32) uuid];
  v10 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v8 parentUUID:v9];

  v11 = [*(a1 + 32) backingStore];
  v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v13 = [v11 transaction:@"relayAddTrigger" options:v12];

  [v13 add:v10 withMessage:0];
  [v13 run];

  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)_validateAddingNewTriggerWithName:(id)name message:(id)message
{
  v34 = *MEMORY[0x277D85DE8];
  nameCopy = name;
  messageCopy = message;
  if (nameCopy)
  {
    if ([nameCopy length])
    {
      v8 = HMMaxLengthForNaming();
      if ([nameCopy length] > v8)
      {
        v9 = objc_autoreleasePoolPush();
        selfCopy = self;
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
        {
          v12 = HMFGetLogIdentifier();
          v30 = 138543362;
          v31 = v12;
          _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v30, 0xCu);
        }

        objc_autoreleasePoolPop(v9);
        v13 = MEMORY[0x277CCA9B8];
        v14 = 46;
        goto LABEL_9;
      }

      v19 = [(HMDHome *)self triggerWithName:nameCopy];
      if (v19)
      {
        v20 = MEMORY[0x277CCA9B8];
        v21 = 1;
      }

      else
      {
        triggers = [(HMDHome *)self triggers];
        v23 = [triggers count];
        v24 = maximumTriggersPerHome;

        if (v23 < v24)
        {
          v16 = 1;
LABEL_19:

          goto LABEL_10;
        }

        v25 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          v30 = 138543618;
          v31 = v28;
          v32 = 2112;
          v33 = nameCopy;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Can't add trigger %@; already at maximum triggers for home", &v30, 0x16u);
        }

        objc_autoreleasePoolPop(v25);
        v20 = MEMORY[0x277CCA9B8];
        v21 = 49;
      }

      v29 = [v20 hmErrorWithCode:v21];
      [messageCopy respondWithError:v29];

      v16 = 0;
      goto LABEL_19;
    }

    v13 = MEMORY[0x277CCA9B8];
    v14 = 3;
  }

  else
  {
    v13 = MEMORY[0x277CCA9B8];
    v14 = 20;
  }

LABEL_9:
  v15 = [v13 hmErrorWithCode:v14];
  [messageCopy respondWithError:v15];

  v16 = 0;
LABEL_10:

  v17 = *MEMORY[0x277D85DE8];
  return v16;
}

- (void)_handleAddEventTriggerModel:(id)model message:(id)message
{
  v19 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v8 = [[HMDEventTrigger alloc] initWithModel:modelCopy home:self message:messageCopy];
  if (v8)
  {
    createPayload = [modelCopy createPayload];
    [(HMDHome *)self _addNewTrigger:v8 message:messageCopy payloadAnnex:createPayload triggerModel:modelCopy];
LABEL_7:

    goto LABEL_8;
  }

  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v17 = 138543362;
    v18 = v13;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Could not create event trigger object from model", &v17, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  responseHandler = [messageCopy responseHandler];

  if (responseHandler)
  {
    createPayload = [messageCopy responseHandler];
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (createPayload)[2](createPayload, v15, 0);

    goto LABEL_7;
  }

LABEL_8:

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)_populateTriggerModel:(id)model fromBuilderMessage:(id)message transaction:(id)transaction responsePayload:(id)payload
{
  v76 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  transactionCopy = transaction;
  payloadCopy = payload;
  v12 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(messageCopy, "BOOLForKey:", *MEMORY[0x277CD2730])}];
  [modelCopy setActive:v12];

  v13 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(messageCopy, "BOOLForKey:", *MEMORY[0x277CD1260])}];
  [modelCopy setAutoDelete:v13];

  v64 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  v70 = 0u;
  v61 = messageCopy;
  obj = [messageCopy arrayForKey:*MEMORY[0x277CD2728]];
  v14 = [obj countByEnumeratingWithState:&v67 objects:v75 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v68;
    v59 = modelCopy;
    while (2)
    {
      for (i = 0; i != v15; ++i)
      {
        if (*v68 != v16)
        {
          objc_enumerationMutation(obj);
        }

        v18 = *(*(&v67 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (!v20)
        {
          goto LABEL_18;
        }

        v21 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v20];
        if (!v21)
        {
          v20 = v18;
LABEL_18:
          v40 = objc_autoreleasePoolPush();
          selfCopy = self;
          v42 = HMFGetOSLogHandle();
          v29 = transactionCopy;
          v28 = v61;
          if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
          {
            v43 = HMFGetLogIdentifier();
            *buf = 138543618;
            v72 = v43;
            v73 = 2112;
            v74 = v20;
            _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_ERROR, "%{public}@Invalid ActionSet reference: '%@'", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v40);
          v44 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          [v61 respondWithError:v44];

          v45 = 0;
          modelCopy = v59;
          goto LABEL_29;
        }

        v22 = v21;
        v23 = [(HMDHome *)self actionSetWithUUID:v21];
        if (!v23)
        {
          v46 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v48 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
          {
            v49 = HMFGetLogIdentifier();
            *buf = 138543618;
            v72 = v49;
            v73 = 2112;
            v74 = v22;
            _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_ERROR, "%{public}@Failed to resolve ActionSet reference: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v46);
          v50 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v28 = v61;
          [v61 respondWithError:v50];

          v45 = 0;
          modelCopy = v59;
          v29 = transactionCopy;
          goto LABEL_29;
        }

        v24 = v23;
        uuid = [v23 uuid];
        uUIDString = [uuid UUIDString];
        [v64 addObject:uUIDString];
      }

      v15 = [obj countByEnumeratingWithState:&v67 objects:v75 count:16];
      modelCopy = v59;
      if (v15)
      {
        continue;
      }

      break;
    }
  }

  v27 = *MEMORY[0x277CD2760];
  v28 = v61;
  [v61 dictionaryForKey:*MEMORY[0x277CD2760]];
  obj = v29 = transactionCopy;
  if (!obj)
  {
    goto LABEL_28;
  }

  uUID = [MEMORY[0x277CCAD78] UUID];
  v31 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:uUID];
  uUIDString2 = [v31 UUIDString];

  v33 = *MEMORY[0x277CCF1A0];
  v65 = 0;
  v66 = 0;
  selfCopy3 = self;
  v35 = uUIDString2;
  v36 = [(HMDHome *)selfCopy3 _createActionSetWithUUID:uUID name:uUIDString2 type:v33 fromDictionary:obj transaction:transactionCopy response:&v66 error:&v65];
  v37 = v66;
  v38 = v65;

  if (v36)
  {
    [payloadCopy setObject:v37 forKeyedSubscript:v27];
    uUIDString3 = [uUID UUIDString];
    [v64 addObject:uUIDString3];
  }

  else
  {
    v58 = v35;
    v51 = modelCopy;
    context = objc_autoreleasePoolPush();
    v52 = selfCopy3;
    v53 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v53, OS_LOG_TYPE_ERROR))
    {
      v54 = HMFGetLogIdentifier();
      *buf = 138543362;
      v72 = v54;
      _os_log_impl(&dword_229538000, v53, OS_LOG_TYPE_ERROR, "%{public}@Failed to create trigger-owned action set", buf, 0xCu);
    }

    objc_autoreleasePoolPop(context);
    [v61 respondWithError:v38];
    modelCopy = v51;
    v35 = v58;
  }

  if (!v36)
  {
    v45 = 0;
  }

  else
  {
LABEL_28:
    v20 = [v64 copy];
    [modelCopy setCurrentActionSets:v20];
    v45 = 1;
LABEL_29:
  }

  v55 = *MEMORY[0x277D85DE8];
  return v45;
}

- (HMDActionSet)_createActionSetWithUUID:(void *)d name:(void *)name type:(void *)type fromDictionary:(void *)dictionary transaction:(void *)transaction response:(void *)response error:
{
  v78 = *MEMORY[0x277D85DE8];
  v13 = a2;
  dCopy = d;
  nameCopy = name;
  typeCopy = type;
  dictionaryCopy = dictionary;
  if (self)
  {
    v62 = nameCopy;
    v63 = dCopy;
    v18 = [[HMDActionSet alloc] initWithName:dCopy uuid:v13 type:nameCopy home:self queue:0];
    v19 = [(HMDActionSet *)v18 modelObjectWithChangeType:1];
    [dictionaryCopy add:v19];

    v64 = typeCopy;
    v20 = typeCopy;
    v21 = v18;
    v22 = [v20 hmf_arrayForKey:*MEMORY[0x277CD2030]];
    v68 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{objc_msgSend(v22, "count")}];
    v69 = 0u;
    v70 = 0u;
    v71 = 0u;
    v72 = 0u;
    obj = v22;
    v23 = [obj countByEnumeratingWithState:&v69 objects:v77 count:16];
    v66 = v18;
    if (v23)
    {
      v24 = v23;
      v25 = *v70;
      v61 = v13;
LABEL_4:
      v26 = 0;
      while (1)
      {
        if (*v70 != v25)
        {
          objc_enumerationMutation(obj);
        }

        v27 = *(*(&v69 + 1) + 8 * v26);
        objc_opt_class();
        v28 = (objc_opt_isKindOfClass() & 1) != 0 ? v27 : 0;
        v29 = v28;

        if (!v29)
        {
          break;
        }

        v30 = [self actionWithDictionaryRepresentation:v29];
        if (!v30)
        {
          v50 = objc_autoreleasePoolPush();
          selfCopy = self;
          v52 = HMFGetOSLogHandle();
          v13 = v61;
          nameCopy = v62;
          typeCopy = v64;
          if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
          {
            v53 = HMFGetLogIdentifier();
            *buf = 138543618;
            v74 = v53;
            v75 = 2112;
            v76 = v29;
            _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@Failed to deserialize action: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v50);
          dCopy = v63;
          if (response)
          {
            *response = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          }

          v49 = obj;
LABEL_37:

          v44 = 0;
          goto LABEL_46;
        }

        v31 = v30;
        v32 = +[HMDCoreData featuresDataSource];
        isRVCEnabled = [v32 isRVCEnabled];

        if (isRVCEnabled)
        {
          v34 = dictionaryCopy;
          v35 = v31;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();
          if (isKindOfClass)
          {
            v37 = v35;
          }

          else
          {
            v37 = 0;
          }

          v38 = v37;

          if (isKindOfClass)
          {
            [v35 addMatterPathsToTransactionIfNotStored:v34];
          }

          dictionaryCopy = v34;
          v21 = v66;
        }

        [v68 addObject:v31];
        [v31 updateActionSetIfNil:v21];
        v39 = [v31 modelObjectWithChangeType:1];
        [dictionaryCopy add:v39];

        if (v24 == ++v26)
        {
          v24 = [obj countByEnumeratingWithState:&v69 objects:v77 count:16];
          v13 = v61;
          if (v24)
          {
            goto LABEL_4;
          }

          goto LABEL_21;
        }
      }

      v45 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v47 = HMFGetOSLogHandle();
      dCopy = v63;
      if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
      {
        v48 = HMFGetLogIdentifier();
        *buf = 138543618;
        v74 = v48;
        v75 = 2112;
        v76 = v63;
        _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; invalid serialized action", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v45);
      v13 = v61;
      nameCopy = v62;
      typeCopy = v64;
      v49 = obj;
      if (response)
      {
        *response = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      }

      goto LABEL_37;
    }

LABEL_21:

    [(HMDActionSet *)v21 setActions:v68];
    if ([self validateActionsDoNotConflict:v68])
    {
      typeCopy = v64;
      v40 = [v64 hmd_appDataDictionaryWithError:response];
      if (v40)
      {
        v41 = [HMDApplicationDataModel modelWithAppDataPayload:v40 existingAppData:0 parentUUID:v13];
        if (v41)
        {
          [dictionaryCopy add:v41];
        }

        nameCopy = v62;
        dCopy = v63;
        if (transaction)
        {
          createPayload = [(HMDActionSet *)v66 createPayload];
          v43 = [createPayload mutableCopy];

          [v43 setObject:v40 forKeyedSubscript:@"kAppDataInformationKey"];
          *transaction = [v43 copy];
        }

        v44 = v66;
      }

      else
      {
        v44 = 0;
        nameCopy = v62;
        dCopy = v63;
      }

      v49 = obj;
    }

    else
    {
      v54 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v56 = HMFGetOSLogHandle();
      dCopy = v63;
      typeCopy = v64;
      if (os_log_type_enabled(v56, OS_LOG_TYPE_ERROR))
      {
        v57 = HMFGetLogIdentifier();
        *buf = 138543618;
        v74 = v57;
        v75 = 2112;
        v76 = v63;
        _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; conflicting actions", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v54);
      v49 = obj;
      if (response)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        *response = v44 = 0;
      }

      else
      {
        v44 = 0;
      }

      nameCopy = v62;
    }

LABEL_46:
  }

  else
  {
    v44 = 0;
  }

  v58 = *MEMORY[0x277D85DE8];

  return v44;
}

- (void)_handleAddEventTrigger:(id)trigger
{
  v75 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v72 = v8;
    v73 = 2112;
    v74 = triggerCopy;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received message %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  residentEnabledDevices = [(HMDHome *)selfCopy residentEnabledDevices];
  v10 = [residentEnabledDevices count] == 0;

  if (!v10)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = selfCopy;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      messagePayload = [triggerCopy messagePayload];
      *buf = 138543618;
      v72 = v14;
      v73 = 2112;
      v74 = messagePayload;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Add event trigger payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    name = [triggerCopy name];
    v17 = [name isEqualToString:*MEMORY[0x277CCF1F0]];

    v18 = [triggerCopy stringForKey:*MEMORY[0x277CD2758]];
    v50 = [triggerCopy stringForKey:*MEMORY[0x277CD1250]];
    v51 = [triggerCopy uuidForKey:*MEMORY[0x277CD0B10]];
    v54 = [triggerCopy predicateForKey:*MEMORY[0x277CD2298]];
    v19 = *MEMORY[0x277CD22C8];
    v20 = [triggerCopy numberForKey:*MEMORY[0x277CD22C8]];
    v53 = v20;
    if (v20)
    {
      [v20 unsignedIntegerValue];
      HMDaysOfTheWeekToDateComponents();
    }

    else
    {
      [triggerCopy arrayOfDateComponentsForKey:v19];
    }
    v52 = ;
    v21 = [triggerCopy userForHome:v12];
    v22 = [HMDEventTriggerModel alloc];
    uuid = [(HMDHome *)v12 uuid];
    v24 = [(HMDBackingStoreModelObject *)v22 initWithObjectChangeType:1 uuid:v51 parentUUID:uuid];

    [(HMDEventTriggerModel *)v24 setName:v18];
    [(HMDEventTriggerModel *)v24 setConfiguredName:v50];
    [(HMDEventTriggerModel *)v24 setActive:MEMORY[0x277CBEC28]];
    [(HMDEventTriggerModel *)v24 setOwner:v21];
    currentDevice = [(HMDHome *)v12 currentDevice];
    [(HMDEventTriggerModel *)v24 setOwningDevice:currentDevice];

    if (v54)
    {
      predicateUtility = [(HMDHome *)v12 predicateUtility];
      v27 = [predicateUtility rewritePredicateForDaemon:v54 message:triggerCopy];

      v28 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v27 requiringSecureCoding:1 error:0];
      [(HMDEventTriggerModel *)v24 setEvaluationCondition:v28];
    }

    v29 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v52 requiringSecureCoding:1 error:0];
    [(HMDEventTriggerModel *)v24 setRecurrences:v29];

    v30 = [triggerCopy mutableCopy];
    objc_initWeak(&location, v12);
    v64[0] = MEMORY[0x277D85DD0];
    v64[1] = 3221225472;
    v64[2] = __34__HMDHome__handleAddEventTrigger___block_invoke;
    v64[3] = &unk_278670180;
    objc_copyWeak(&v68, &location);
    v31 = triggerCopy;
    v65 = v31;
    v32 = v24;
    v66 = v32;
    v69 = v17;
    v49 = v21;
    v67 = v49;
    [v30 setResponseHandler:v64];
    if (![(HMDHome *)v12 _validateAddingNewTriggerWithName:v18 message:v30])
    {
      goto LABEL_33;
    }

    if (!v53 && ![HMDEventTrigger __validateRecurrences:v52])
    {
      v43 = objc_autoreleasePoolPush();
      v44 = v12;
      v45 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
      {
        v46 = HMFGetLogIdentifier();
        *buf = 138543618;
        v72 = v46;
        v73 = 2112;
        v74 = v52;
        _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_ERROR, "%{public}@Received invalid values for recurrences: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v43);
      v36 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v30 respondWithError:v36];
      goto LABEL_32;
    }

    backingStore = [(HMDHome *)v12 backingStore];
    name2 = [v31 name];
    v35 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v48 = [backingStore transaction:name2 options:v35];

    if (v17)
    {
      v36 = objc_alloc_init(MEMORY[0x277CBEB38]);
      if (![(HMDHome *)v12 _populateTriggerModel:v32 fromBuilderMessage:v30 transaction:v48 responsePayload:v36])
      {
LABEL_31:

LABEL_32:
LABEL_33:

        objc_destroyWeak(&v68);
        objc_destroyWeak(&location);

        goto LABEL_34;
      }

      v37 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v31, "BOOLForKey:", *MEMORY[0x277CD22B8])}];
      [(HMDEventTriggerModel *)v32 setExecuteOnce:v37];
    }

    else
    {
      v36 = 0;
    }

    v38 = [[HMDEventTrigger alloc] initWithModel:v32 home:v12 message:v31];
    v39 = v38;
    if (v17)
    {
      v40 = v48;
    }

    else
    {
      v40 = 0;
    }

    v63 = 0;
    v41 = [(HMDEventTrigger *)v38 addEventsFromMessage:v31 preserveUUIDs:v17 ^ 1u transaction:v40 error:&v63];
    v42 = v63;
    if (v41)
    {
      if (v17)
      {
        [v48 add:v32];
        v55[0] = MEMORY[0x277D85DD0];
        v55[1] = 3221225472;
        v55[2] = __34__HMDHome__handleAddEventTrigger___block_invoke_1606;
        v55[3] = &unk_2786701A8;
        v56 = v30;
        v57 = v36;
        v58 = v32;
        v59 = v54;
        v60 = v12;
        v61 = v39;
        v62 = v49;
        [v48 run:v55];
      }

      else
      {
        [v48 add:v32 withMessage:v30];
        [v48 run];
      }
    }

    else
    {
      [v30 respondWithError:v42];
    }

    goto LABEL_31;
  }

  v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
  [triggerCopy respondWithError:v18];
LABEL_34:

  v47 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddEventTrigger___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v34 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v28 = 138543874;
    v29 = v11;
    v30 = 2112;
    v31 = v6;
    v32 = 2112;
    v33 = v5;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Responding to the client about add event trigger status : Payload : [%@], error : [%@]", &v28, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 32) respondWithPayload:v6 error:v5];
  if (v9)
  {
    v12 = [[HMDEventTrigger alloc] initWithModel:*(a1 + 40) home:v9 message:*(a1 + 32)];
    v13 = 1;
    [(HMDEventTrigger *)v12 addEventsFromMessage:*(a1 + 32) preserveUUIDs:(*(a1 + 64) & 1) == 0 transaction:0 error:0];
    v14 = [HomeKitEventTriggerAddLogEvent alloc];
    v15 = [v9 uuid];
    v16 = [(HomeKitEventTriggerAddLogEvent *)v14 initWithHomeUUID:v15];

    v17 = [[HMDAnalyticsEventTriggerData alloc] initWithEventTrigger:v12 isAdding:1];
    v18 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v18 setEventTrigger:v17];

    v19 = [v5 code];
    v20 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v20 setResultErrorCode:v19];

    if (([*(a1 + 48) isOwner] & 1) == 0)
    {
      if ([*(a1 + 48) isAdministrator])
      {
        v13 = 2;
      }

      else
      {
        v13 = 0;
      }
    }

    v21 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v21 setRequestOrigin:v13];

    v22 = objc_autoreleasePoolPush();
    v23 = v9;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      v28 = 138543618;
      v29 = v25;
      v30 = 2112;
      v31 = v16;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Prepared the metric %@, submitting", &v28, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v26 = [v23 logEventSubmitter];
    [v26 submitLogEvent:v16];
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddEventTrigger___block_invoke_1606(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v4 = *(a1 + 40);
    v5 = [*(a1 + 48) createPayloadWithCondition:*(a1 + 56)];
    [v4 addEntriesFromDictionary:v5];

    v6 = *(a1 + 64);
    v7 = [*(a1 + 72) triggerEvents];
    v8 = [(HMDHome *)v6 _createEventsPayload:v7];
    [*(a1 + 40) setObject:v8 forKeyedSubscript:*MEMORY[0x277CD22B0]];

    v9 = *(a1 + 64);
    v10 = [*(a1 + 72) endEvents];
    v11 = [(HMDHome *)v9 _createEventsPayload:v10];
    [*(a1 + 40) setObject:v11 forKeyedSubscript:*MEMORY[0x277CD22A8]];

    v12 = [*(a1 + 80) uuid];
    v13 = [v12 UUIDString];
    [*(a1 + 40) setObject:v13 forKeyedSubscript:*MEMORY[0x277CD1268]];

    v14 = *(a1 + 32);
    v15 = [*(a1 + 40) copy];
    [v14 respondWithPayload:v15];
  }
}

- (id)_createEventsPayload:(uint64_t)payload
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (payload)
  {
    v4 = objc_alloc_init(MEMORY[0x277CBEB18]);
    v14 = 0u;
    v15 = 0u;
    v16 = 0u;
    v17 = 0u;
    v5 = v3;
    v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v15;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v15 != v8)
          {
            objc_enumerationMutation(v5);
          }

          createPayload = [*(*(&v14 + 1) + 8 * i) createPayload];
          [v4 addObject:createPayload];
        }

        v7 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
      }

      while (v7);
    }

    v11 = [v4 copy];
  }

  else
  {
    v11 = 0;
  }

  v12 = *MEMORY[0x277D85DE8];

  return v11;
}

- (id)_updateAndGetOwnedTriggers
{
  v18 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  triggers = [(HMDHome *)self triggers];
  v5 = [triggers countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v5)
  {
    v6 = *v14;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(triggers);
        }

        v8 = *(*(&v13 + 1) + 8 * i);
        if ([v8 isOwnedByThisDevice])
        {
          uuid = [v8 uuid];
          [array addObject:uuid];
        }
      }

      v5 = [triggers countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v5);
  }

  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_ownedTriggers setArray:array];
  os_unfair_recursive_lock_unlock();
  v10 = [array copy];

  v11 = *MEMORY[0x277D85DE8];

  return v10;
}

- (void)_handleExecuteActionSet:(id)set
{
  setCopy = set;
  v4 = [setCopy uuidForKey:*MEMORY[0x277CD2050]];
  v5 = [(HMDHome *)self actionSetWithUUID:v4];
  if (v5 || isInternalBuild() && ([(HMDHome *)self triggerOwnedActionSetWithUUID:v4], (v5 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v6 = v5;
    type = [v5 type];
    if ([type isEqualToString:*MEMORY[0x277CCF1A0]])
    {
      v8 = isInternalBuild();

      if ((v8 & 1) == 0)
      {
        responseHandler = [setCopy responseHandler];
        v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
        (responseHandler)[2](responseHandler, v10, 0);

        goto LABEL_10;
      }
    }

    else
    {
    }

    responseHandler = +[HMDDonationHandler sharedDonationHandler];
    [responseHandler donateActionSet:v6 withMessage:setCopy];
    [v6 execute:setCopy];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    responseHandler = [setCopy responseHandler];
    (responseHandler)[2](responseHandler, v6, 0);
  }

LABEL_10:
}

- (void)executeActionSet:(id)set
{
  setCopy = set;
  v6 = objc_alloc(MEMORY[0x277D0F770]);
  v7 = MEMORY[0x277CCACA8];
  v8 = MEMORY[0x22AAD2510](self, a2);
  17891 = [v7 stringWithFormat:@"%@, %s:%ld", v8, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 17891];
  v10 = [v6 initWithName:17891];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __28__HMDHome_executeActionSet___block_invoke;
  block[3] = &unk_27868A010;
  block[4] = self;
  v15 = setCopy;
  v16 = v10;
  v12 = v10;
  v13 = setCopy;
  dispatch_async(workQueue, block);
}

void __28__HMDHome_executeActionSet___block_invoke(id *a1)
{
  objc_initWeak(&location, a1[4]);
  v7 = MEMORY[0x277D85DD0];
  v8 = 3221225472;
  v9 = __28__HMDHome_executeActionSet___block_invoke_2;
  v10 = &unk_278685F38;
  objc_copyWeak(&v13, &location);
  v11 = a1[5];
  v12 = a1[6];
  v2 = _Block_copy(&v7);
  if ([a1[4] _shouldWaitForAccessoriesToBeReachable])
  {
    v3 = [a1[5] uuidForKey:*MEMORY[0x277CD2050]];
    v4 = [a1[4] actionSetWithUUID:v3];
    v5 = [a1[4] workQueue];
    v6 = [HMDHomeAssistantOperation homeAssistantOperationWithActionSet:v4 queue:v5];

    [a1[4] _performOperation:v6 completion:v2];
  }

  else
  {
    v2[2](v2);
  }

  objc_destroyWeak(&v13);
  objc_destroyWeak(&location);
}

void __28__HMDHome_executeActionSet___block_invoke_2(id *a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    [a1[5] begin];
    [WeakRetained _handleExecuteActionSet:a1[4]];
    [a1[5] end];
  }

  else
  {
    v3 = [a1[4] responseHandler];

    if (v3)
    {
      v4 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      v5 = [a1[4] responseHandler];
      (v5)[2](v5, v4, 0);
    }

    v6 = objc_autoreleasePoolPush();
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot execute action set", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveActionSetModel:(id)model message:(id)message
{
  v63 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v46 = modelCopy;
  uuid = [modelCopy uuid];
  v7 = [(HMDHome *)self actionSetWithUUID:uuid];
  if (v7 || ([(HMDHome *)self triggerOwnedActionSetWithUUID:uuid], (v7 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    workQueue = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __47__HMDHome__handleRemoveActionSetModel_message___block_invoke;
    block[3] = &unk_27868A750;
    block[4] = self;
    v9 = uuid;
    v55 = v9;
    dispatch_async(workQueue, block);

    actionSetStateSubscriptionManager = [(HMDHome *)self actionSetStateSubscriptionManager];
    [actionSetStateSubscriptionManager stopAllMonitoringForActionSetUUID:v9 completion:&__block_literal_global_1600];

    actionSetStateObserver = [(HMDHome *)self actionSetStateObserver];
    [actionSetStateObserver stopMonitoringActionSet:v7];

    name = [v7 name];
    v13 = [(HMDHome *)self removeName:name];

    v52 = 0u;
    v53 = 0u;
    v50 = 0u;
    v51 = 0u;
    triggers = [(HMDHome *)self triggers];
    v15 = [triggers countByEnumeratingWithState:&v50 objects:v58 count:16];
    if (v15)
    {
      v16 = *v51;
      do
      {
        v17 = 0;
        do
        {
          if (*v51 != v16)
          {
            objc_enumerationMutation(triggers);
          }

          [*(*(&v50 + 1) + 8 * v17++) removeActionSet:v7 postUpdate:1];
        }

        while (v15 != v17);
        v15 = [triggers countByEnumeratingWithState:&v50 objects:v58 count:16];
      }

      while (v15);
    }

    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    type = [v7 type];
    v19 = [type isEqualToString:*MEMORY[0x277CCF1A0]];

    v20 = objc_autoreleasePoolPush();
    selfCopy = self;
    v22 = HMFGetOSLogHandle();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_INFO);
    if (v19)
    {
      if (v23)
      {
        v24 = HMFGetLogIdentifier();
        name2 = [v7 name];
        *buf = 138543618;
        v60 = v24;
        v61 = 2112;
        v62 = name2;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Remove trigger owned action set: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)selfCopy->_triggerOwnedActionSets removeObject:v7];
      os_unfair_recursive_lock_unlock();
    }

    else
    {
      if (v23)
      {
        v26 = HMFGetLogIdentifier();
        name3 = [v7 name];
        *buf = 138543618;
        v60 = v26;
        v61 = 2112;
        v62 = name3;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Remove action set: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)selfCopy->_actionSets removeObject:v7];
      os_unfair_recursive_lock_unlock();
      [transactionResult markSaveToAssistant];
    }

    [v7 invalidate];
    v56[0] = *MEMORY[0x277CD0640];
    uuid2 = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid2 UUIDString];
    v57[0] = uUIDString;
    v56[1] = *MEMORY[0x277CD2040];
    name4 = [v7 name];
    v57[1] = name4;
    v56[2] = *MEMORY[0x277CD2050];
    uUIDString2 = [v9 UUIDString];
    v57[2] = uUIDString2;
    v56[3] = *MEMORY[0x277CCF150];
    spiClientIdentifier = [v7 spiClientIdentifier];
    uUIDString3 = [spiClientIdentifier UUIDString];
    v57[3] = uUIDString3;
    v56[4] = *MEMORY[0x277CCF128];
    urlString = [v7 urlString];
    v57[4] = urlString;
    v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v57 forKeys:v56 count:5];

    logAndPostNotification(@"HMDActionSetRemovedNotification", selfCopy, v35);
    [messageCopy respondWithPayload:v35];
    v36 = objc_autoreleasePoolPush();
    v37 = selfCopy;
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
    {
      v39 = HMFGetLogIdentifier();
      *buf = 138543618;
      v60 = v39;
      v61 = 2112;
      v62 = v35;
      _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Responding back to clients after removing actionSet: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v36);
  }

  else
  {
    v41 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v43 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v43, OS_LOG_TYPE_ERROR))
    {
      v44 = HMFGetLogIdentifier();
      uUIDString4 = [uuid UUIDString];
      *buf = 138543618;
      v60 = v44;
      v61 = 2112;
      v62 = uUIDString4;
      _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_ERROR, "%{public}@Count not find action set with UUID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v41);
    v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v7];
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleRemoveActionSetModel_message___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) notificationRegistry];
  [v2 removeRegistrationsForActionSetUUID:*(a1 + 40)];
}

- (void)_handleRemoveActionSet:(id)set
{
  v41 = *MEMORY[0x277D85DE8];
  setCopy = set;
  v5 = [setCopy uuidForKey:*MEMORY[0x277CD2050]];
  v6 = [(HMDHome *)self actionSetWithUUID:v5];
  v7 = v6;
  if (!v6)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v19;
      v39 = 2112;
      v40 = v5;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Did not find the action set with UUID : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
    goto LABEL_9;
  }

  type = [v6 type];
  v9 = [type isEqualToString:*MEMORY[0x277CCF1A0]];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v13;
      v39 = 2112;
      v40 = v7;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Removing this action Set is not supported. : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 48;
LABEL_9:
    v20 = [v14 hmErrorWithCode:v15];
    [setCopy respondWithError:v20];
    goto LABEL_16;
  }

  v20 = +[HMDHome getBuiltinActionSets];
  type2 = [v7 type];
  v22 = [v20 objectForKey:type2];

  if (v22)
  {
    v23 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:83 userInfo:0];
    responseHandler = [setCopy responseHandler];
    (responseHandler)[2](responseHandler, v23, 0);

    v25 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      type3 = [v7 type];
      v37 = 138543618;
      v38 = v28;
      v39 = 2112;
      v40 = type3;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Cannot remove built in action set : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v25);
    [setCopy respondWithError:v23];
  }

  else
  {
    v30 = [HMDActionSetModel alloc];
    uuid = [(HMDHome *)self uuid];
    v23 = [(HMDBackingStoreModelObject *)v30 initWithObjectChangeType:3 uuid:v5 parentUUID:uuid];

    backingStore = [(HMDHome *)self backingStore];
    name = [setCopy name];
    v34 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v35 = [backingStore transaction:name options:v34];

    [v35 add:v23 withMessage:setCopy];
    [v35 run];
  }

LABEL_16:
  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddActionSetModel:(id)model message:(id)message
{
  v56 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  selfCopy = self;
  v8 = modelCopy;
  name = [v8 name];
  if (name)
  {
    uuid = [v8 uuid];
    type = [v8 type];
    if (type)
    {
      type2 = [v8 type];
    }

    else
    {
      type2 = *MEMORY[0x277CCF1A8];
    }

    v17 = type2;

    v48 = [(HMDHome *)selfCopy createActionSetWithName:name uuid:uuid type:v17];
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = selfCopy;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v16;
      *&buf[12] = 2112;
      *&buf[14] = v8;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@ActionSet model does not have a name %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v48 = 0;
  }

  if (v48)
  {
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    type3 = [v8 type];
    v19 = [type3 isEqualToString:*MEMORY[0x277CCF1A0]];

    os_unfair_recursive_lock_lock_with_options();
    if (v19)
    {
      v20 = v48;
      [(NSMutableArray *)selfCopy->_triggerOwnedActionSets addObject:v48];
      os_unfair_recursive_lock_unlock();
    }

    else
    {
      [(NSMutableArray *)selfCopy->_actionSets addObject:v48];
      os_unfair_recursive_lock_unlock();
      actions = [v48 actions];
      v26 = [actions count];

      v20 = v48;
      if (v26)
      {
        [transactionResult markSaveToAssistant];
        v20 = v48;
      }
    }

    v27 = selfCopy;
    v28 = v20;
    v45 = messageCopy;
    context = objc_autoreleasePoolPush();
    v53[0] = *MEMORY[0x277CD0640];
    uuid2 = [(HMDHome *)v27 uuid];
    uUIDString = [uuid2 UUIDString];
    *buf = uUIDString;
    v53[1] = *MEMORY[0x277CD2040];
    name2 = [v28 name];
    *&buf[8] = name2;
    v53[2] = *MEMORY[0x277CD2050];
    uuid3 = [v28 uuid];
    uUIDString2 = [uuid3 UUIDString];
    *&buf[16] = uUIDString2;
    v53[3] = *MEMORY[0x277CD2048];
    type4 = [v28 type];
    v55 = type4;
    v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:buf forKeys:v53 count:4];

    v36 = objc_autoreleasePoolPush();
    v37 = v27;
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
    {
      v39 = HMFGetLogIdentifier();
      *v49 = 138543618;
      v50 = v39;
      v51 = 2112;
      v52 = v35;
      _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Add action set finished. Responding to clients with : %@", v49, 0x16u);
    }

    objc_autoreleasePoolPop(v36);
    v40 = [MEMORY[0x277CBEB38] dictionaryWithDictionary:v35];
    [v40 setObject:v28 forKeyedSubscript:@"HMDActionSetNotificationKey"];
    notificationCenter = [(HMDHome *)v37 notificationCenter];
    v42 = [v40 copy];
    [notificationCenter postNotificationName:@"HMDActionSetAddedNotification" object:v37 userInfo:v42];

    [v45 respondWithPayload:v35];
    objc_autoreleasePoolPop(context);
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = selfCopy;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v24;
      *&buf[12] = 2112;
      *&buf[14] = messageCopy;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to create action set model. %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v21);
  }

  v43 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddHomeOwnedActionSet:(id)set
{
  v51 = *MEMORY[0x277D85DE8];
  setCopy = set;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v45 = 138543362;
    v46 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding Home owned action set", &v45, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = *MEMORY[0x277CD2040];
  v10 = [setCopy stringForKey:*MEMORY[0x277CD2040]];
  v11 = [(HMDHome *)selfCopy actionSetWithName:v10];
  if (v11)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = selfCopy;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v45 = 138543618;
      v46 = v15;
      v47 = 2112;
      v48 = v10;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@ as it already exists.", &v45, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v16 = MEMORY[0x277CCA9B8];
    v17 = 1;
LABEL_15:
    v22 = [v16 hmErrorWithCode:v17];
LABEL_16:
    [setCopy respondWithError:v22];
    goto LABEL_17;
  }

  actionSets = [(HMDHome *)selfCopy actionSets];
  v19 = [actionSets count];
  v20 = maximumActionSetsPerHome;

  if (v19 >= v20)
  {
    v27 = objc_autoreleasePoolPush();
    v28 = selfCopy;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      v30 = HMFGetLogIdentifier();
      v45 = 138543618;
      v46 = v30;
      v47 = 2112;
      v48 = v10;
      _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; already at maximum action sets for home", &v45, 0x16u);
    }

    objc_autoreleasePoolPop(v27);
    v16 = MEMORY[0x277CCA9B8];
    v17 = 49;
    goto LABEL_15;
  }

  v21 = [(HMDHome *)selfCopy addActionSetName:v10];
  if (v21)
  {
    v22 = v21;
    v23 = objc_autoreleasePoolPush();
    v24 = selfCopy;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      v45 = 138543874;
      v46 = v26;
      v47 = 2112;
      v48 = v10;
      v49 = 2112;
      v50 = v22;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; namespace error %@", &v45, 0x20u);
    }

    objc_autoreleasePoolPop(v23);
    goto LABEL_16;
  }

  v32 = [HMDActionSetModel alloc];
  v33 = [setCopy uuidForKey:*MEMORY[0x277CD0B10]];
  uuid = [(HMDHome *)selfCopy uuid];
  v35 = [(HMDBackingStoreModelObject *)v32 initWithObjectChangeType:1 uuid:v33 parentUUID:uuid];

  v36 = [setCopy stringForKey:v9];
  [(HMDActionSetModel *)v35 setName:v36];

  v37 = [setCopy stringForKey:*MEMORY[0x277CD2048]];
  v38 = v37;
  v39 = *MEMORY[0x277CCF1A8];
  if (v37)
  {
    v40 = v37;
  }

  else
  {
    v40 = *MEMORY[0x277CCF1A8];
  }

  [(HMDActionSetModel *)v35 setType:v40];
  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [setCopy name];
  v43 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v44 = [backingStore transaction:name options:v43];

  [v44 add:v35 withMessage:setCopy];
  [v44 run];

  v22 = 0;
LABEL_17:

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTriggerOwnedActionSet:(id)set
{
  v21 = *MEMORY[0x277D85DE8];
  setCopy = set;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding trigger owned action set", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDActionSetModel alloc];
  v10 = [setCopy uuidForKey:*MEMORY[0x277CD0B10]];
  uuid = [(HMDHome *)selfCopy uuid];
  v12 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:1 uuid:v10 parentUUID:uuid];

  v13 = [setCopy stringForKey:*MEMORY[0x277CD2040]];
  [(HMDActionSetModel *)v12 setName:v13];

  [(HMDActionSetModel *)v12 setType:*MEMORY[0x277CCF1A0]];
  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [setCopy name];
  v16 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v17 = [backingStore transaction:name options:v16];

  [v17 add:v12 withMessage:setCopy];
  [v17 run];

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddActionSetFromBuilder:(id)builder
{
  v58 = *MEMORY[0x277D85DE8];
  builderCopy = builder;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v53 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding Home owned action set (from builder)", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [builderCopy uuidForKey:*MEMORY[0x277CD0B10]];
  v10 = v9;
  if (v9)
  {
    uUID = v9;
  }

  else
  {
    uUID = [MEMORY[0x277CCAD78] UUID];
  }

  v12 = uUID;

  v13 = [builderCopy stringForKey:*MEMORY[0x277CD2048]];
  v14 = v13;
  v15 = *MEMORY[0x277CCF1A8];
  if (v13)
  {
    v15 = v13;
  }

  v16 = v15;

  v17 = [builderCopy stringForKey:*MEMORY[0x277CD2040]];
  v18 = [(HMDHome *)selfCopy actionSetWithName:v17];
  if (!v18)
  {
    actionSets = [(HMDHome *)selfCopy actionSets];
    v26 = [actionSets count];
    v27 = maximumActionSetsPerHome;

    if (v26 >= v27)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = selfCopy;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543618;
        v53 = v36;
        v54 = 2112;
        v55 = v17;
        _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; already at maximum action sets for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v33);
      v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    }

    else
    {
      v28 = [(HMDHome *)selfCopy addActionSetName:v17];
      if (!v28)
      {
        backingStore = [(HMDHome *)selfCopy backingStore];
        name = [builderCopy name];
        v40 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v41 = [backingStore transaction:name options:v40];

        messagePayload = [builderCopy messagePayload];
        v50 = 0;
        v51 = 0;
        v43 = [(HMDHome *)selfCopy _createActionSetWithUUID:v12 name:v17 type:v16 fromDictionary:messagePayload transaction:v41 response:&v51 error:&v50];
        v44 = v51;
        v19 = v50;

        if (v43)
        {
          v46[0] = MEMORY[0x277D85DD0];
          v46[1] = 3221225472;
          v46[2] = __42__HMDHome__handleAddActionSetFromBuilder___block_invoke;
          v46[3] = &unk_278683340;
          v46[4] = selfCopy;
          v47 = v17;
          v48 = builderCopy;
          v49 = v44;
          [v41 run:v46];
        }

        else
        {
          v45 = [(HMDHome *)selfCopy removeName:v17];
          [builderCopy respondWithError:v19];
        }

        goto LABEL_21;
      }

      v19 = v28;
      v29 = objc_autoreleasePoolPush();
      v30 = selfCopy;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543874;
        v53 = v32;
        v54 = 2112;
        v55 = v17;
        v56 = 2112;
        v57 = v19;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; namespace error %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
    }

    [builderCopy respondWithError:v19];
    goto LABEL_21;
  }

  v19 = v18;
  v20 = objc_autoreleasePoolPush();
  v21 = selfCopy;
  v22 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
  {
    v23 = HMFGetLogIdentifier();
    *buf = 138543618;
    v53 = v23;
    v54 = 2112;
    v55 = v17;
    _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@ as it already exists.", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v20);
  v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:1];
  [builderCopy respondWithError:v24];

LABEL_21:
  v37 = *MEMORY[0x277D85DE8];
}

void __42__HMDHome__handleAddActionSetFromBuilder___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  if (v4)
  {
    v3 = [*(a1 + 32) removeName:*(a1 + 40)];
    [*(a1 + 48) respondWithError:v4];
  }

  else
  {
    [*(a1 + 48) respondWithPayload:*(a1 + 56)];
  }
}

- (void)_handleAddActionSet:(id)set
{
  v27 = *MEMORY[0x277D85DE8];
  setCopy = set;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v23 = 138543618;
    v24 = v8;
    v25 = 2112;
    v26 = setCopy;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received a request to add a new action set : %@", &v23, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [setCopy stringForKey:*MEMORY[0x277CD2048]];
  if (!v9)
  {
    v9 = *MEMORY[0x277CCF1A8];
  }

  v10 = [setCopy stringForKey:*MEMORY[0x277CD2040]];
  v11 = HMMaxLengthForNaming();
  if ([v10 length] <= v11)
  {
    logEventSubmitter = [(HMDHome *)selfCopy logEventSubmitter];
    v18 = [HMDAddActionSetLogEvent alloc];
    uuid = [(HMDHome *)selfCopy uuid];
    v20 = [(HMDAddActionSetLogEvent *)v18 initWithActionSetType:v9 homeUUID:uuid];
    [logEventSubmitter submitLogEvent:v20];

    name = [setCopy name];
    LODWORD(v20) = [name isEqualToString:*MEMORY[0x277CCF1E8]];

    if (v20)
    {
      [(HMDHome *)selfCopy _handleAddActionSetFromBuilder:setCopy];
    }

    else if ([v9 isEqualToString:*MEMORY[0x277CCF1A0]])
    {
      [(HMDHome *)selfCopy _handleAddTriggerOwnedActionSet:setCopy];
    }

    else
    {
      [(HMDHome *)selfCopy _handleAddHomeOwnedActionSet:setCopy];
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = selfCopy;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v23 = 138543362;
      v24 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v23, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
    [setCopy respondWithError:v16];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (id)builtInActionSetInfo
{
  array = [MEMORY[0x277CBEB18] array];
  workQueue = [(HMDHome *)self workQueue];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __31__HMDHome_builtInActionSetInfo__block_invoke;
  v9[3] = &unk_27868A750;
  v9[4] = self;
  v5 = array;
  v10 = v5;
  dispatch_sync(workQueue, v9);

  v6 = v10;
  v7 = v5;

  return v5;
}

void __31__HMDHome_builtInActionSetInfo__block_invoke(uint64_t a1)
{
  v29 = *MEMORY[0x277D85DE8];
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v1 = [*(a1 + 32) actionSets];
  v2 = [v1 countByEnumeratingWithState:&v22 objects:v28 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = *v23;
    v5 = *MEMORY[0x277CCF1A8];
    v19 = *MEMORY[0x277CD2048];
    v20 = *MEMORY[0x277CD2040];
    v18 = *MEMORY[0x277CD2050];
    do
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v23 != v4)
        {
          objc_enumerationMutation(v1);
        }

        v7 = *(*(&v22 + 1) + 8 * i);
        v8 = [v7 type];
        if (v8)
        {
          v9 = v8;
          v10 = [v7 type];
          v11 = [v10 isEqualToString:v5];

          if ((v11 & 1) == 0)
          {
            v26[0] = v20;
            v12 = [v7 name];
            v27[0] = v12;
            v26[1] = v19;
            v13 = [v7 type];
            v27[1] = v13;
            v26[2] = v18;
            v14 = [v7 uuid];
            v15 = [v14 UUIDString];
            v27[2] = v15;
            v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:v26 count:3];

            [*(a1 + 40) addObject:v16];
          }
        }
      }

      v3 = [v1 countByEnumeratingWithState:&v22 objects:v28 count:16];
    }

    while (v3);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)test_addTriggerOwnedActionSets:(id)sets
{
  setsCopy = sets;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_triggerOwnedActionSets addObjectsFromArray:setsCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)triggerOwnedActionSets
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_triggerOwnedActionSets copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)test_addActionSets:(id)sets
{
  setsCopy = sets;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_actionSets addObjectsFromArray:setsCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)actionSets
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_actionSets copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleRemoveServiceGroupModel:(id)model message:(id)message
{
  v34 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v27 = modelCopy;
  uuid = [modelCopy uuid];
  v9 = [(HMDHome *)self serviceGroupWithUUID:uuid];
  v10 = v9;
  if (v9)
  {
    name = [v9 name];
    v12 = [(HMDHome *)self removeName:name];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_serviceGroups removeObject:v10];
    os_unfair_recursive_lock_unlock();
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    [transactionResult markSaveToAssistant];
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      name2 = [v10 name];
      *buf = 138543618;
      v31 = v17;
      v32 = 2112;
      v33 = name2;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Removed service group: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v28[0] = *MEMORY[0x277CD25C0];
    name3 = [v10 name];
    v29[0] = name3;
    v28[1] = *MEMORY[0x277CD25E0];
    uuid2 = [v10 uuid];
    uUIDString = [uuid2 UUIDString];
    v29[1] = uUIDString;
    v28[2] = *MEMORY[0x277CD0D58];
    spiClientIdentifier = [v10 spiClientIdentifier];
    uUIDString2 = [spiClientIdentifier UUIDString];
    v29[2] = uUIDString2;
    v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:3];

    logAndPostNotification(@"HMDServiceGroupRemovedNotification", v10, v24);
    [messageCopy respondWithSuccess];
  }

  else
  {
    v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v25];
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveServiceGroup:(id)group
{
  groupCopy = group;
  v5 = [groupCopy uuidForKey:*MEMORY[0x277CD25E0]];
  v6 = [(HMDHome *)self serviceGroupWithUUID:v5];
  if (v6)
  {
    v7 = [HMDServiceGroupModel alloc];
    uuid = [(HMDHome *)self uuid];
    v9 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v5 parentUUID:uuid];

    backingStore = [(HMDHome *)self backingStore];
    name = [groupCopy name];
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [backingStore transaction:name options:v12];

    [v13 add:v9];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __37__HMDHome__handleRemoveServiceGroup___block_invoke;
    v14[3] = &unk_27868A250;
    v15 = groupCopy;
    [v13 run:v14];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [groupCopy respondWithError:v9];
  }
}

- (void)_handleAddServiceGroupModel:(id)model message:(id)message
{
  v40 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  name = [modelCopy name];
  uuid = [modelCopy uuid];
  v10 = uuid;
  if (name && uuid)
  {
    hm_truncatedNameString = [name hm_truncatedNameString];

    v11 = [HMDServiceGroup alloc];
    workQueue = [(HMDHome *)self workQueue];
    v13 = [(HMDServiceGroup *)v11 initWithName:hm_truncatedNameString uuid:v10 home:self queue:workQueue];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_serviceGroups addObject:v13];
    os_unfair_recursive_lock_unlock();
    msgDispatcher = [(HMDHome *)self msgDispatcher];
    workQueue2 = [(HMDHome *)self workQueue];
    [(HMDServiceGroup *)v13 configure:msgDispatcher queue:workQueue2];

    v16 = [(HMDServiceGroup *)v13 updateServiceGroupWithModel:modelCopy message:messageCopy];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    serviceUUIDs = [(HMDServiceGroup *)v13 serviceUUIDs];
    v19 = [serviceUUIDs count];

    if (v19)
    {
      [transactionResult markSaveToAssistant];
    }

    v20 = objc_autoreleasePoolPush();
    selfCopy = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v23;
      v38 = 2112;
      v39 = hm_truncatedNameString;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Added service group: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v34[0] = *MEMORY[0x277CD25C0];
    name2 = [(HMDServiceGroup *)v13 name];
    v35[0] = name2;
    v34[1] = *MEMORY[0x277CD25E0];
    uuid2 = [(HMDServiceGroup *)v13 uuid];
    uUIDString = [uuid2 UUIDString];
    v35[1] = uUIDString;
    v27 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:2];

    logAndPostNotification(@"HMDServiceGroupAddedNotification", v13, v27);
    [messageCopy respondWithPayload:0 error:v16];

    name = hm_truncatedNameString;
  }

  else
  {
    v28 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v30 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
    {
      v31 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v31;
      v38 = 2112;
      v39 = name;
      _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; invalid parameter", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v28);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [messageCopy respondWithError:v13];
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddServiceGroup:(id)group
{
  v47 = *MEMORY[0x277D85DE8];
  groupCopy = group;
  v5 = [groupCopy stringForKey:*MEMORY[0x277CD25C0]];
  if (v5)
  {
    v6 = HMMaxLengthForNaming();
    if ([v5 length] > v6)
    {
      v7 = objc_autoreleasePoolPush();
      selfCopy = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543362;
        v42 = v10;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v7);
      v11 = MEMORY[0x277CCA9B8];
      v12 = 46;
      goto LABEL_7;
    }

    v13 = [(HMDHome *)self serviceGroupWithName:v5];
    if (v13)
    {
      v14 = MEMORY[0x277CCA9B8];
      v15 = 1;
    }

    else
    {
      serviceGroups = [(HMDHome *)self serviceGroups];
      v17 = [serviceGroups count];
      v18 = maximumServiceGroupsPerHome;

      if (v17 < v18)
      {
        v19 = [(HMDHome *)self addName:v5];
        if (!v19)
        {
          v29 = [HMDServiceGroupModel alloc];
          v30 = [groupCopy uuidForKey:*MEMORY[0x277CD0B10]];
          uuid = [(HMDHome *)self uuid];
          v32 = [(HMDBackingStoreModelObject *)v29 initWithObjectChangeType:1 uuid:v30 parentUUID:uuid];

          [(HMDServiceGroupModel *)v32 setName:v5];
          backingStore = [(HMDHome *)self backingStore];
          name = [groupCopy name];
          v35 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v36 = [backingStore transaction:name options:v35];

          [v36 add:v32];
          v38[0] = MEMORY[0x277D85DD0];
          v38[1] = 3221225472;
          v38[2] = __34__HMDHome__handleAddServiceGroup___block_invoke;
          v38[3] = &unk_27868A1D8;
          v39 = groupCopy;
          v40 = v32;
          v37 = v32;
          [v36 run:v38];

          goto LABEL_20;
        }

        v20 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
        {
          v23 = HMFGetLogIdentifier();
          *buf = 138543874;
          v42 = v23;
          v43 = 2112;
          v44 = v5;
          v45 = 2112;
          v46 = v19;
          _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; namespace error %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v20);
LABEL_19:
        [groupCopy respondWithError:v19];
LABEL_20:

        goto LABEL_21;
      }

      v24 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v26 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        v27 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v27;
        v43 = 2112;
        v44 = v5;
        _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; already at maximum service groups for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v24);
      v14 = MEMORY[0x277CCA9B8];
      v15 = 49;
    }

    v19 = [v14 hmErrorWithCode:v15];
    goto LABEL_19;
  }

  v11 = MEMORY[0x277CCA9B8];
  v12 = 20;
LABEL_7:
  v13 = [v11 hmErrorWithCode:v12];
  [groupCopy respondWithError:v13];
LABEL_21:

  v28 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddServiceGroup___block_invoke(uint64_t a1, uint64_t a2)
{
  v12[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v11[0] = *MEMORY[0x277CD25C0];
    v6 = [*(a1 + 40) name];
    v12[0] = v6;
    v11[1] = *MEMORY[0x277CD25E0];
    v7 = [*(a1 + 40) uuid];
    v8 = [v7 UUIDString];
    v12[1] = v8;
    v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:v11 count:2];
    [v2 respondWithPayload:v9];

    v10 = *MEMORY[0x277D85DE8];
  }
}

- (void)test_addServiceGroups:(id)groups
{
  groupsCopy = groups;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_serviceGroups addObjectsFromArray:groupsCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)serviceGroups
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_serviceGroups copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)updateHomeFirstHAPAccessoryAddedDateToNow
{
  v3 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)self uuid];
  homeManager = [(HMDHome *)self homeManager];
  uuid2 = [homeManager uuid];
  v11 = [(HMDBackingStoreModelObject *)v3 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  v7 = objc_alloc_init(MEMORY[0x277CBEAA8]);
  [(HMDHomeModel *)v11 setFirstHAPAccessoryAddedDate:v7];

  backingStore = [(HMDHome *)self backingStore];
  v9 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v10 = [backingStore transaction:@"updateHomeFirstHAPAccessoryAddedDate" options:v9];

  [v10 add:v11];
  [v10 run];
}

- (void)_processAccessoriesToAddForUnpairedAccessory:(id)accessory certificationStatus:(int64_t)status accessoryServer:(id)server networkCredential:(id)credential pairingEvent:(id)event message:(id)message completionHandler:(id)handler
{
  accessoryCopy = accessory;
  serverCopy = server;
  credentialCopy = credential;
  eventCopy = event;
  messageCopy = message;
  handlerCopy = handler;
  v19 = objc_alloc(MEMORY[0x277D0F770]);
  v20 = MEMORY[0x277CCACA8];
  v21 = MEMORY[0x22AAD2510](self, a2);
  16894 = [v20 stringWithFormat:@"%@, %s:%ld", v21, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 16894];
  v40 = [v19 initWithName:16894];

  v23 = accessoryCopy;
  if (self)
  {
    currentAccessory = [(HMDHome *)self currentAccessory];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v25 = currentAccessory;
    }

    else
    {
      v25 = 0;
    }

    v26 = v25;

    v27 = 0;
    if (v23 && v26)
    {
      sensorAccessoryUUID = [v26 sensorAccessoryUUID];
      v29 = [sensorAccessoryUUID hmf_isEqualToUUID:v23];

      if (v29)
      {
        uuid = [v26 uuid];
        v27 = [MKFModelFactory createAppleMediaAccessoryModelWithModelID:uuid];

        room = [v26 room];
        uuid2 = [room uuid];
        v33 = [MKFModelFactory createRoomModelWithModelID:uuid2];
        [v27 setRoom:v33];
      }

      else
      {
        v27 = 0;
      }
    }
  }

  else
  {
    v27 = 0;
  }

  modelID = [v27 modelID];
  v35 = [[HMDNewPairedAccessoryServerInfo alloc] initWithServer:serverCopy home:self primaryAccessoryUUID:v23 certificationStatus:status hostAccessory:v27 networkCredential:credentialCopy pairingEvent:eventCopy];
  [v40 begin];
  v39 = v40;
  [(HMDHome *)self _processNewlyPairedAccessoryServerInfo:v35 message:messageCopy completionHandler:handlerCopy];
  __HMFActivityScopeLeave();

  __HMFActivityScopeLeave();
}

- (id)_removeUserFromNewlyPairedAccessoryServer:(id)server user:(id)user
{
  v22 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  userCopy = user;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    identifier = [serverCopy identifier];
    *v19 = 138543618;
    *&v19[4] = v11;
    v20 = 2112;
    v21 = identifier;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Removing user from newly paired accessory server: %@", v19, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  *v19 = 0;
  v13 = [MEMORY[0x277D0F7C0] futureWithPromise:v19];
  if ([userCopy isCurrentUser])
  {
    workQueue = [(HMDHome *)selfCopy workQueue];
    errorOnlyResolverBlock = [*v19 errorOnlyResolverBlock];
    [serverCopy removePairingForCurrentControllerOnQueue:workQueue completion:errorOnlyResolverBlock];
  }

  else
  {
    workQueue = [userCopy pairingIdentity];
    errorOnlyResolverBlock = [(HMDHome *)selfCopy workQueue];
    errorOnlyResolverBlock2 = [*v19 errorOnlyResolverBlock];
    [serverCopy removePairing:workQueue completionQueue:errorOnlyResolverBlock completionHandler:errorOnlyResolverBlock2];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)_addOwnerToNewlyPairedAccessoryServer:(id)server
{
  v25 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    identifier = [serverCopy identifier];
    *buf = 138543618;
    *&buf[4] = v8;
    v23 = 2112;
    v24 = identifier;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding owner to newly paired accessory server: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  if ([(HMDHome *)selfCopy isSharedAdmin])
  {
    *buf = 0;
    v10 = [MEMORY[0x277D0F7C0] futureWithPromise:buf];
    v11 = objc_alloc(MEMORY[0x277D0F7A8]);
    workQueue = [(HMDHome *)selfCopy workQueue];
    v13 = [v11 initWithQueue:workQueue];

    ignoreErrors = [v10 ignoreErrors];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __49__HMDHome__addOwnerToNewlyPairedAccessoryServer___block_invoke;
    v20[3] = &unk_278687050;
    v20[4] = selfCopy;
    v21 = serverCopy;
    v15 = [ignoreErrors inContext:v13 then:v20];
  }

  else
  {
    v16 = MEMORY[0x277D0F7C0];
    v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    v15 = [v16 futureWithError:v17];
  }

  v18 = *MEMORY[0x277D85DE8];

  return v15;
}

uint64_t __49__HMDHome__addOwnerToNewlyPairedAccessoryServer___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) owner];
  v5 = [v4 pairingIdentity];

  v6 = objc_alloc(MEMORY[0x277CFEC20]);
  v7 = [v5 identifier];
  v8 = [v5 publicKey];
  v9 = [v6 initWithIdentifier:v7 publicKey:v8 privateKey:0 permissions:1];

  v21 = 0;
  v10 = [MEMORY[0x277D0F7C0] futureWithPromise:&v21];
  v11 = *(a1 + 40);
  v12 = [*(a1 + 32) workQueue];
  v13 = [v21 errorOnlyResolverBlock];
  [v11 addPairing:v9 completionQueue:v12 completionHandler:v13];

  v14 = v10;
  if (v14)
  {
    v15 = v14;

    return 3;
  }

  else
  {
    v17 = _HMFPreconditionFailure();
    return [(HMDHome *)v17 _readDataNeededImmediatelyAfterPairing:v18 intoModel:v19, v20];
  }
}

- (id)_readDataNeededImmediatelyAfterPairing:(id)pairing intoModel:(id)model
{
  v43 = *MEMORY[0x277D85DE8];
  pairingCopy = pairing;
  modelCopy = model;
  internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    uUID = [internalOnlyInitializer UUID];
    *buf = 138543618;
    v38 = v12;
    v39 = 2112;
    v40 = uUID;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Reading data needed immediately after pairing", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  server = [pairingCopy server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = server;
  }

  else
  {
    v15 = 0;
  }

  v16 = v15;

  if (v16)
  {
    untrackedPlaceholderFlow = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
    v18 = [v16 createDoorLockClusterObjectWithFlow:untrackedPlaceholderFlow];
    v29 = MEMORY[0x277D85DD0];
    v30 = 3221225472;
    v31 = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke;
    v32 = &unk_278670130;
    v33 = internalOnlyInitializer;
    v34 = modelCopy;
    v35 = selfCopy;
    v36 = v16;
    v19 = [v18 then:&v29];
    ignoreOutcome = [v19 ignoreOutcome];
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = selfCopy;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      uUID2 = [internalOnlyInitializer UUID];
      server2 = [pairingCopy server];
      *buf = 138543874;
      v38 = v24;
      v39 = 2112;
      v40 = uUID2;
      v41 = 2112;
      v42 = server2;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] The accessory server is not a HMMTRAccessoryServer. server: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v21);
    ignoreOutcome = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v27 = *MEMORY[0x277D85DE8];

  return ignoreOutcome;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 fetchAccessorySupportsPinCodesWithFlow:*(a1 + 32)];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2;
  v45[3] = &unk_278679B80;
  v5 = *(a1 + 40);
  v6 = *(a1 + 48);
  v46 = v5;
  v47 = v6;
  v48 = *(a1 + 32);
  v29 = v4;
  v7 = [v4 then:v45];
  v8 = [v7 ignoreOutcome];
  v40[0] = MEMORY[0x277D85DD0];
  v40[1] = 3221225472;
  v40[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1557;
  v40[3] = &unk_2786868C8;
  v9 = v3;
  v41 = v9;
  v10 = *(a1 + 40);
  v11 = *(a1 + 48);
  v42 = v10;
  v43 = v11;
  v44 = *(a1 + 32);
  v12 = [v8 then:v40];
  v13 = [v12 ignoreOutcome];
  v35[0] = MEMORY[0x277D85DD0];
  v35[1] = 3221225472;
  v35[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1559;
  v35[3] = &unk_2786868C8;
  v14 = v9;
  v36 = v14;
  v37 = *(a1 + 32);
  v15 = *(a1 + 40);
  v16 = *(a1 + 48);
  v38 = v15;
  v39 = v16;
  v17 = [v13 then:v35];
  v18 = [v17 ignoreOutcome];
  v31[0] = MEMORY[0x277D85DD0];
  v31[1] = 3221225472;
  v31[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1564;
  v31[3] = &unk_278670108;
  v19 = v14;
  v32 = v19;
  v20 = *(a1 + 40);
  v21 = *(a1 + 32);
  v30 = *(a1 + 48);
  v22 = *(&v30 + 1);
  *&v23 = v20;
  *(&v23 + 1) = v21;
  v33 = v23;
  v34 = v30;
  v24 = [v18 then:v31];
  if (v24)
  {
    v25 = v24;

    return 3;
  }

  else
  {
    v27 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2(v27, v28);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2(id *a1, void *a2)
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [a1[4] supportsMatterAccessCode];
  v5 = HMFEqualObjects();

  if ((v5 & 1) == 0)
  {
    [a1[4] setSupportsMatterAccessCode:v3];
    v6 = objc_autoreleasePoolPush();
    v7 = a1[5];
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [a1[6] UUID];
      v13 = 138543874;
      v14 = v9;
      v15 = 2112;
      v16 = v10;
      v17 = 2112;
      v18 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsPinCodes: %@", &v13, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1557(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) fetchAccessorySupportsTapToUnlock];
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1558;
  v12[3] = &unk_278679B80;
  v5 = *(a1 + 40);
  v6 = *(a1 + 48);
  v7 = *(a1 + 56);
  v13 = v5;
  v14 = v6;
  v15 = v7;
  v8 = [v4 then:v12];
  if (v8)
  {
    v9 = v8;

    return 3;
  }

  else
  {
    v11 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1559(v11);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1559(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) fetchFeatureMapForSupportingWeekAndYearDayScheduleWithFlow:*(a1 + 40)];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1560;
  v14[3] = &unk_27867C338;
  *&v5 = *(a1 + 48);
  *(&v5 + 1) = *(a1 + 56);
  v13 = v5;
  v6 = *(a1 + 40);
  v7 = *(a1 + 32);
  *&v8 = v6;
  *(&v8 + 1) = v7;
  v15 = v13;
  v16 = v8;
  v9 = [v4 then:v14];
  if (v9)
  {
    v10 = v9;

    return 3;
  }

  else
  {
    v12 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1564(v12);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1564(uint64_t a1, void *a2)
{
  v26 = a2;
  v3 = [*(a1 + 32) fetchReaderGroupSubIdentifier];
  v37[0] = MEMORY[0x277D85DD0];
  v37[1] = 3221225472;
  v37[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1565;
  v37[3] = &unk_278670068;
  v38 = *(a1 + 40);
  v4 = [v3 then:v37];
  v5 = [v4 ignoreOutcome];
  v34[0] = MEMORY[0x277D85DD0];
  v34[1] = 3221225472;
  v34[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_3;
  v34[3] = &unk_2786868C8;
  v6 = *(a1 + 32);
  v7 = *(a1 + 48);
  *&v8 = *(a1 + 40);
  *(&v8 + 1) = *(a1 + 56);
  *&v9 = v6;
  *(&v9 + 1) = v7;
  v35 = v9;
  v36 = v8;
  v10 = [v5 then:v34];
  v11 = [v10 ignoreOutcome];
  v31[0] = MEMORY[0x277D85DD0];
  v31[1] = 3221225472;
  v31[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1567;
  v31[3] = &unk_278686878;
  v12 = *(a1 + 32);
  v13 = *(a1 + 48);
  *&v14 = *(a1 + 40);
  *(&v14 + 1) = *(a1 + 56);
  *&v15 = v12;
  *(&v15 + 1) = v13;
  v32 = v15;
  v33 = v14;
  v16 = [v11 then:v31];
  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1571;
  v27[3] = &unk_2786700E0;
  v17 = *(a1 + 32);
  v18 = *(a1 + 48);
  *&v19 = *(a1 + 40);
  *(&v19 + 1) = *(a1 + 56);
  *&v20 = v17;
  *(&v20 + 1) = v18;
  v28 = v20;
  v29 = v19;
  v30 = *(a1 + 64);
  v21 = [v16 then:v27];
  if (v21)
  {
    v22 = v21;

    return 3;
  }

  else
  {
    v24 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1565(v24, v25);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_3(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) fetchAccessorySupportsAliroProvisioningWithFlow:*(a1 + 40)];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_4;
  v11[3] = &unk_278679B80;
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v12 = v5;
  v13 = v6;
  v14 = *(a1 + 40);
  v7 = [v4 then:v11];
  if (v7)
  {
    v8 = v7;

    return 3;
  }

  else
  {
    v10 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1567(v10);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1567(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) readAliroSupportedVersionWithFlow:*(a1 + 40)];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1568;
  v11[3] = &unk_278670090;
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v12 = v5;
  v13 = v6;
  v14 = *(a1 + 40);
  v7 = [v4 then:v11];
  if (v7)
  {
    v8 = v7;

    return 3;
  }

  else
  {
    v10 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1571(v10);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1571(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) fetchAccessorySupportsAliroBLEUWBWithFlow:*(a1 + 40)];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1572;
  v15[3] = &unk_27867C338;
  *&v5 = *(a1 + 48);
  *(&v5 + 1) = *(a1 + 56);
  v14 = v5;
  v6 = *(a1 + 40);
  v7 = *(a1 + 64);
  *&v8 = v6;
  *(&v8 + 1) = v7;
  v16 = v14;
  v17 = v8;
  v9 = [v4 then:v15];
  if (v9)
  {
    v10 = v9;

    return 3;
  }

  else
  {
    v12 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1572(v12, v13);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1572(id *a1, void *a2)
{
  v34 = *MEMORY[0x277D85DE8];
  v3 = a2;
  [a1[4] setSupportsMatCredACB:v3];
  v4 = objc_autoreleasePoolPush();
  v5 = a1[5];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [a1[6] UUID];
    *buf = 138543874;
    v29 = v7;
    v30 = 2112;
    v31 = v8;
    v32 = 2112;
    v33 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsMatCredACB: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = objc_autoreleasePoolPush();
  v10 = a1[5];
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [a1[6] UUID];
    *buf = 138543618;
    v29 = v12;
    v30 = 2112;
    v31 = v13;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Checking if this matter lock is MFi approved", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = [a1[5] dataSource];
  v15 = [v14 makeAccessoryMatterCapabilitiesForFilename:0];

  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1573;
  v25[3] = &unk_2786700B8;
  *&v16 = a1[7];
  *(&v16 + 1) = a1[5];
  v24 = v16;
  v17 = a1[6];
  v18 = a1[4];
  *&v19 = v17;
  *(&v19 + 1) = v18;
  v26 = v24;
  v27 = v19;
  v20 = [v15 then:v25];
  if (!v20)
  {
    _HMFPreconditionFailure();
  }

  v21 = v20;

  v22 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1573(id *a1, void *a2)
{
  v28 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [a1[4] vendorID];
  v5 = [v4 intValue];
  v6 = [a1[4] productID];
  v7 = [v3 isCapabilityAllowed:0 vendorID:v5 productID:{objc_msgSend(v6, "intValue")}];

  v8 = objc_autoreleasePoolPush();
  v9 = a1[5];
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = [a1[6] UUID];
    v13 = [a1[4] vendorID];
    v14 = [a1[4] productID];
    v18 = 138544386;
    v19 = v11;
    v20 = 2112;
    v21 = v12;
    v22 = 2112;
    v23 = v13;
    v24 = 2112;
    v25 = v14;
    v26 = 1024;
    v27 = v7;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] ECB lock with VID %@, PID %@ is certified: %{BOOL}d", &v18, 0x30u);
  }

  objc_autoreleasePoolPop(v8);
  v15 = [MEMORY[0x277CCABB0] numberWithBool:v7];
  [a1[7] setMfiCertifiedACWG:v15];

  v16 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1568(id *a1, void *a2)
{
  v29 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 expeditedTransactionSupportedVersions];
  v5 = [HMDAliroVersionUtilities concatenate:v4];
  [a1[4] setExpeditedTransactionSupportedVersions:v5];

  v6 = [v3 bleUWBSupportedVersions];
  v7 = [HMDAliroVersionUtilities concatenate:v6];
  [a1[4] setBleUWBSupportedVersions:v7];

  v8 = [v3 bleAdvertisingVersion];
  [a1[4] setBleAdvertisingVersion:v8];

  v9 = objc_autoreleasePoolPush();
  v10 = a1[5];
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [a1[6] UUID];
    v14 = [a1[4] expeditedTransactionSupportedVersions];
    v15 = [a1[4] bleUWBSupportedVersions];
    v16 = [a1[4] bleAdvertisingVersion];
    v19 = 138544386;
    v20 = v12;
    v21 = 2112;
    v22 = v13;
    v23 = 2112;
    v24 = v14;
    v25 = 2112;
    v26 = v15;
    v27 = 2112;
    v28 = v16;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] expeditedTransactionSupportedVersions: %@, bleUWBSupportedVersions: %@, bleAdvertisingVersion: %@", &v19, 0x34u);
  }

  objc_autoreleasePoolPop(v9);
  v17 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_4(id *a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  [a1[4] setSupportsMatCredACP:v3];
  v4 = objc_autoreleasePoolPush();
  v5 = a1[5];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [a1[6] UUID];
    v11 = 138543874;
    v12 = v7;
    v13 = 2112;
    v14 = v8;
    v15 = 2112;
    v16 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsMatCredACP: %@", &v11, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1560(uint64_t a1, void *a2)
{
  v47 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [MEMORY[0x277D17B88] doorLockFeatureMapSupportsWeekDaySchedule:v3];
  v5 = [*(a1 + 32) supportsMatterWeekDaySchedule];
  v6 = HMFEqualObjects();

  if ((v6 & 1) == 0)
  {
    [*(a1 + 32) setSupportsMatterWeekDaySchedule:v4];
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 40);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [*(a1 + 48) UUID];
      *buf = 138543874;
      v42 = v10;
      v43 = 2112;
      v44 = v11;
      v45 = 2112;
      v46 = v4;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsMatterWeekDaySchedule: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v12 = [MEMORY[0x277D17B88] doorLockFeatureMapSupportsYearDaySchedule:v3];
  v13 = [*(a1 + 32) supportsMatterYearDaySchedule];
  v14 = HMFEqualObjects();

  if ((v14 & 1) == 0)
  {
    [*(a1 + 32) setSupportsMatterYearDaySchedule:v12];
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 40);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [*(a1 + 48) UUID];
      *buf = 138543874;
      v42 = v18;
      v43 = 2112;
      v44 = v19;
      v45 = 2112;
      v46 = v12;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsMatterYearDaySchedule: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v15);
  }

  v20 = MEMORY[0x277D0F7C0];
  v21 = *(a1 + 56);
  v22 = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
  v23 = [v21 numberOfWeekDaySchedulesSupportedWithFlow:v22];
  v40[0] = v23;
  v24 = *(a1 + 56);
  v25 = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
  v26 = [v24 numberOfYearDaySchedulesSupportedWithFlow:v25];
  v40[1] = v26;
  v27 = [MEMORY[0x277CBEA60] arrayWithObjects:v40 count:2];
  v28 = [v20 allSettled:v27];
  v36[0] = MEMORY[0x277D85DD0];
  v36[1] = 3221225472;
  v36[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1562;
  v36[3] = &unk_278679B30;
  v29 = *(a1 + 32);
  v30 = *(a1 + 40);
  v31 = *(a1 + 48);
  v37 = v29;
  v38 = v30;
  v39 = v31;
  v32 = [v28 then:v36];
  if (!v32)
  {
    _HMFPreconditionFailure();
  }

  v33 = v32;

  v34 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1562(id *a1, void *a2)
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 objectAtIndexedSubscript:0];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  v7 = [v3 objectAtIndexedSubscript:1];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  if (v6)
  {
    v10 = [a1[4] matterWeekDayScheduleCapacity];
    v11 = HMFEqualObjects();

    if ((v11 & 1) == 0)
    {
      [a1[4] setMatterWeekDayScheduleCapacity:v6];
      v12 = objc_autoreleasePoolPush();
      v13 = a1[5];
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v16 = [a1[6] UUID];
        v26 = 138543874;
        v27 = v15;
        v28 = 2112;
        v29 = v16;
        v30 = 2112;
        v31 = v6;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] weekDayScheduleCapacity: %@", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v12);
    }

    v17 = [a1[4] matterYearDayScheduleCapacity];
    v18 = HMFEqualObjects();

    if ((v18 & 1) == 0)
    {
      [a1[4] setMatterYearDayScheduleCapacity:v9];
      v19 = objc_autoreleasePoolPush();
      v20 = a1[5];
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v22 = HMFGetLogIdentifier();
        v23 = [a1[6] UUID];
        v26 = 138543874;
        v27 = v22;
        v28 = 2112;
        v29 = v23;
        v30 = 2112;
        v31 = v9;
        _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] yearDayScheduleCapacity: %@", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v19);
    }
  }

  v24 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1558(id *a1, void *a2)
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [a1[4] supportsMatterWalletKey];
  v5 = HMFEqualObjects();

  if ((v5 & 1) == 0)
  {
    [a1[4] setSupportsMatterWalletKey:v3];
    v6 = objc_autoreleasePoolPush();
    v7 = a1[5];
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [a1[6] UUID];
      v13 = 138543874;
      v14 = v9;
      v15 = 2112;
      v16 = v10;
      v17 = 2112;
      v18 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsMatterWalletKey: %@", &v13, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

- (id)_configureTTUAndUWBOnAccessory:(id)accessory accessoryModel:(id)model
{
  v42 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  modelCopy = model;
  internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    uUID = [internalOnlyInitializer UUID];
    *buf = 138544130;
    v35 = v12;
    v36 = 2112;
    v37 = uUID;
    v38 = 2112;
    v39 = accessoryCopy;
    v40 = 2112;
    v41 = modelCopy;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Configuring ACWG on accessory with serverInfo: %@, model: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v9);
  notifyMatterMetricPairingStep(selfCopy, 0x19uLL);
  server = [accessoryCopy server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = server;
  }

  else
  {
    v15 = 0;
  }

  v16 = v15;

  if (v16)
  {
    v17 = [v16 createDoorLockClusterObjectWithFlow:internalOnlyInitializer];
    naFuture = [v17 naFuture];
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke;
    v30[3] = &unk_278670040;
    v31 = internalOnlyInitializer;
    v32 = selfCopy;
    v33 = modelCopy;
    v19 = [naFuture flatMap:v30];
    hmfFuture = [v19 hmfFuture];
    ignoreResult = [hmfFuture ignoreResult];
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = selfCopy;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      uUID2 = [internalOnlyInitializer UUID];
      server2 = [accessoryCopy server];
      *buf = 138543874;
      v35 = v25;
      v36 = 2112;
      v37 = uUID2;
      v38 = 2112;
      v39 = server2;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find HMMTRAccessoryServer: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v22);
    ignoreResult = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v28 = *MEMORY[0x277D85DE8];

  return ignoreResult;
}

id __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 clearAllUsersWithDeletedCreatorFabricIndexWithFlow:*(a1 + 32)];
  v5 = [v4 naFuture];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2;
  v18[3] = &unk_27866FFA0;
  v13 = *(a1 + 32);
  v6 = v13.i64[0];
  v19 = vextq_s8(v13, v13, 8uLL);
  v20 = *(a1 + 48);
  v7 = v3;
  v21 = v7;
  v8 = [v5 flatMap:v18];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1545;
  v15[3] = &unk_278670018;
  v14 = *(a1 + 32);
  v9 = v14.i64[0];
  v16 = vextq_s8(v14, v14, 8uLL);
  v17 = v7;
  v10 = v7;
  v11 = [v8 flatMap:v15];

  return v11;
}

id __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) nfcReaderKeyManager];
  v3 = [v2 fetchOrCreateReaderKeyForPairingWithFlow:*(a1 + 40)];
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_3;
  v12[3] = &unk_27866FF78;
  v4 = *(a1 + 48);
  v11 = *(a1 + 32);
  v5 = v11.i64[1];
  v6 = *(a1 + 56);
  v7.i64[0] = v4;
  v7.i64[1] = v6;
  v8 = vzip2q_s64(v11, v7);
  v7.i64[1] = v11.i64[0];
  v13 = v7;
  v14 = v8;
  v9 = [v3 flatMap:v12];

  return v9;
}

id __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1545(uint64_t a1)
{
  v2 = objc_opt_new();
  v3 = +[HMDACWGKeyManager shared];
  v4 = [*(a1 + 32) uuid];
  v5 = [*(a1 + 32) currentUser];
  v6 = [v5 uuid];
  v7 = [*(a1 + 32) backingStore];
  v8 = [v7 context];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2_1547;
  v14[3] = &unk_27866FFF0;
  v9 = *(a1 + 40);
  v14[4] = *(a1 + 32);
  v15 = v9;
  v10 = v2;
  v16 = v10;
  v17 = *(a1 + 48);
  [v3 getOrCreateIssuerKeyAndSaveIfNeededWithHome:v4 user:v6 context:v8 shouldRoll:0 completionHandler:v14];

  v11 = v17;
  v12 = v10;

  return v10;
}

void __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2_1547(id *a1, void *a2, void *a3)
{
  v47 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = [HMDNIST256Utilities publicKeyExternalRepresentationFromKeyPairExternalRepresentation:v5];
    v8 = [a1[4] users];
    v9 = [MEMORY[0x277CBEB18] array];
    v10 = [MEMORY[0x277CBEB18] array];
    v35[0] = MEMORY[0x277D85DD0];
    v35[1] = 3221225472;
    v35[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1548;
    v35[3] = &unk_27866FFC8;
    v11 = a1[4];
    v12 = a1[5];
    v36 = v7;
    v37 = v11;
    v38 = v12;
    v13 = v9;
    v39 = v13;
    v14 = v10;
    v40 = v14;
    v15 = v7;
    [v8 hmf_enumerateWithAutoreleasePoolUsingBlock:v35];
    v16 = objc_alloc(MEMORY[0x277D0F7A8]);
    v17 = [a1[4] workQueue];
    v18 = [v16 initWithQueue:v17];

    v19 = MEMORY[0x277D0F7C0];
    v29[0] = MEMORY[0x277D85DD0];
    v29[1] = 3221225472;
    v29[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1550;
    v29[3] = &unk_278679AE0;
    v30 = a1[7];
    v31 = v13;
    v32 = v14;
    v33 = a1[5];
    v34 = a1[6];
    v20 = v14;
    v21 = v13;
    v22 = [v19 inContext:v18 perform:v29];
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    v24 = a1[4];
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      v27 = [a1[5] UUID];
      *buf = 138543874;
      v42 = v26;
      v43 = 2112;
      v44 = v27;
      v45 = 2112;
      v46 = v6;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to create ACWG issuer key with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v23);
    [a1[6] finishWithError:v6];
  }

  v28 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1548(id *a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (([v3 isRestrictedGuest] & 1) == 0)
  {
    v4 = [v3 uniqueIDForAccessories];
    if ([v3 isCurrentUser])
    {
      v5 = a1[4];
    }

    else
    {
      v5 = [v3 acwgIssuerPublicKeyExternalRepresentation];
    }

    v6 = v5;
    if (v4 && v5)
    {
      [a1[7] addObject:v4];
      [a1[8] addObject:v6];
    }

    else
    {
      v7 = objc_autoreleasePoolPush();
      v8 = a1[5];
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v10 = HMFGetLogIdentifier();
        v11 = [a1[6] UUID];
        v12 = [v3 uuid];
        v14 = 138544386;
        v15 = v10;
        v16 = 2112;
        v17 = v11;
        v18 = 2112;
        v19 = v12;
        v20 = 2112;
        v21 = v4;
        v22 = 2112;
        v23 = v6;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] User is missing either uniqueIDForAccessories or issuerPublicKey. User: %@, uniqueIDForAccessories: %@, issuerPublicKey: %@", &v14, 0x34u);
      }

      objc_autoreleasePoolPop(v7);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1550(uint64_t a1)
{
  v2 = [*(a1 + 32) addNewUsersWithUserUniqueIDs:*(a1 + 40) withCorrespondingIssuerKeys:*(a1 + 48) flow:*(a1 + 56)];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2_1551;
  v9[3] = &unk_278689CB0;
  v10 = *(a1 + 64);
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_3_1552;
  v7[3] = &unk_278689CD8;
  v8 = *(a1 + 64);
  v3 = [v2 then:v9 orRecover:v7];
  if (v3)
  {
    v4 = v3;

    return 3;
  }

  else
  {
    v6 = _HMFPreconditionFailure();
    return __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2_1551(v6);
  }
}

id __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_3(id *a1, void *a2)
{
  v60 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_opt_new();
  v5 = [v3 privateKey];
  [v4 setReaderPrivateKey:v5];

  v6 = [v3 publicKeyExternalRepresentation];
  [v4 setReaderPublicKeyExternalRepresentation:v6];

  v7 = [v3 publicKey];
  v8 = [HMDNIST256Utilities identifier16BytesForKey:v7];
  [v4 setReaderGroupIdentifier:v8];

  v9 = [a1[4] supportsMatCredACB];
  LODWORD(v7) = [v9 BOOLValue];

  if (v7)
  {
    v10 = [a1[5] acwgGroupResolvingKey];

    if (!v10)
    {
      v31 = objc_autoreleasePoolPush();
      v32 = a1[5];
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
      {
        v34 = HMFGetLogIdentifier();
        v35 = [a1[6] UUID];
        *buf = 138543618;
        v51 = v34;
        v52 = 2112;
        v53 = v35;
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Missing acwgGroupResolvingKey", buf, 0x16u);
        goto LABEL_15;
      }

LABEL_16:

      objc_autoreleasePoolPop(v31);
      v38 = MEMORY[0x277D2C900];
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      v30 = [v38 futureWithError:v25];
      goto LABEL_17;
    }

    v11 = [a1[5] acwgGroupResolvingKey];
    [v4 setGroupResolvingKey:v11];
  }

  v12 = [v4 readerPrivateKey];
  if (!v12)
  {
LABEL_11:
    v31 = objc_autoreleasePoolPush();
    v32 = a1[5];
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
    {
      v34 = HMFGetLogIdentifier();
      v35 = [a1[6] UUID];
      v36 = [v4 readerPublicKeyExternalRepresentation];
      v37 = [v4 readerGroupIdentifier];
      *buf = 138544130;
      v51 = v34;
      v52 = 2112;
      v53 = v35;
      v54 = 2112;
      v55 = v36;
      v56 = 2112;
      v57 = v37;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] User is missing either readerPrivateKey or readerPublicKey or readerGroupIdentifier. readerPublicKeyExternalRepresentation: %@, readerGroupIdentifier: %@", buf, 0x2Au);

LABEL_15:
      goto LABEL_16;
    }

    goto LABEL_16;
  }

  v13 = v12;
  v14 = [v4 readerPublicKeyExternalRepresentation];
  if (!v14)
  {

    goto LABEL_11;
  }

  v15 = v14;
  v16 = [v4 readerGroupIdentifier];

  if (!v16)
  {
    goto LABEL_11;
  }

  v17 = objc_autoreleasePoolPush();
  v18 = a1[5];
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v21 = [a1[6] UUID];
    v43 = [v4 readerPublicKeyExternalRepresentation];
    v22 = [v43 hmf_hexadecimalRepresentation];
    v42 = [v4 readerGroupIdentifier];
    [v42 hmf_hexadecimalRepresentation];
    v23 = v44 = v17;
    v41 = [v4 groupResolvingKey];
    v24 = [v41 hmf_hexadecimalRepresentation];
    *buf = 138544386;
    v51 = v20;
    v52 = 2112;
    v53 = v21;
    v54 = 2112;
    v55 = v22;
    v56 = 2112;
    v57 = v23;
    v58 = 2112;
    v59 = v24;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Setting reader config on lock. RPK: %@, RGI: %@, GRK: %@", buf, 0x34u);

    v17 = v44;
  }

  objc_autoreleasePoolPop(v17);
  v25 = [a1[7] setOrReadReaderConfig:v4 flow:a1[6]];
  v26 = [v25 naFuture];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1540;
  v45[3] = &unk_27866FF50;
  v27 = v4;
  v28 = a1[5];
  v29 = a1[6];
  v46 = v27;
  v47 = v28;
  v48 = v29;
  v49 = a1[4];
  v30 = [v26 flatMap:v45];

LABEL_17:
  v39 = *MEMORY[0x277D85DE8];

  return v30;
}

id __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1540(id *a1, void *a2)
{
  v43 = *MEMORY[0x277D85DE8];
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (v5)
  {
    v6 = [v3 readerPublicKeyExternalRepresentation];
    v7 = [a1[4] readerPublicKeyExternalRepresentation];
    v8 = HMFEqualObjects();

    if (v8 && ([v3 readerGroupIdentifier], v9 = objc_claimAutoreleasedReturnValue(), objc_msgSend(a1[4], "readerGroupIdentifier"), v10 = objc_claimAutoreleasedReturnValue(), v11 = HMFEqualObjects(), v10, v9, v11))
    {
      v12 = [v3 groupResolvingKey];
      v13 = [a1[4] groupResolvingKey];
      v14 = HMFEqualObjects();

      if (v14)
      {
        goto LABEL_13;
      }
    }

    else
    {
    }

    v15 = objc_autoreleasePoolPush();
    v16 = a1[5];
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [a1[6] UUID];
      v31 = [v3 readerPublicKeyExternalRepresentation];
      v20 = [v31 hmf_hexadecimalRepresentation];
      v30 = [v3 readerGroupIdentifier];
      v21 = [v30 hmf_hexadecimalRepresentation];
      [v3 groupResolvingKey];
      v22 = v32 = v15;
      v23 = [v22 hmf_hexadecimalRepresentation];
      *buf = 138544386;
      v34 = v18;
      v35 = 2112;
      v36 = v19;
      v37 = 2112;
      v38 = v20;
      v39 = 2112;
      v40 = v21;
      v41 = 2112;
      v42 = v23;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Found existing reader config on lock. RPK: %@, RGI: %@, GRK: %@", buf, 0x34u);

      v15 = v32;
    }

    objc_autoreleasePoolPop(v15);
    v24 = [v3 readerPublicKeyExternalRepresentation];
    [a1[7] setPreexistingMatCredRPK:v24];

    v25 = [v3 readerGroupIdentifier];
    [a1[7] setPreexistingMatCredRGI:v25];

    v26 = [v3 groupResolvingKey];
    [a1[7] setPreexistingMatCredGRK:v26];
  }

LABEL_13:
  v27 = [MEMORY[0x277D2C900] futureWithNoResult];

  v28 = *MEMORY[0x277D85DE8];

  return v27;
}

- (id)_configureMatterV1Accessory:(id)accessory accessoryModel:(id)model
{
  v37 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  modelCopy = model;
  internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    uUID = [internalOnlyInitializer UUID];
    *buf = 138544130;
    v30 = v12;
    v31 = 2112;
    v32 = uUID;
    v33 = 2112;
    v34 = accessoryCopy;
    v35 = 2112;
    v36 = modelCopy;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Configuring matter v1 accessory with serverInfo: %@, model: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v9);
  notifyMatterMetricPairingStep(selfCopy, 0x19uLL);
  server = [accessoryCopy server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = server;
  }

  else
  {
    v15 = 0;
  }

  v16 = v15;

  if (v16)
  {
    v17 = [v16 createDoorLockClusterObjectWithFlow:internalOnlyInitializer];
    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __54__HMDHome__configureMatterV1Accessory_accessoryModel___block_invoke;
    v27[3] = &unk_278683930;
    v28 = internalOnlyInitializer;
    futureWithNoValue = [v17 then:v27];
  }

  else
  {
    v19 = objc_autoreleasePoolPush();
    v20 = selfCopy;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = HMFGetLogIdentifier();
      uUID2 = [internalOnlyInitializer UUID];
      server2 = [accessoryCopy server];
      *buf = 138543874;
      v30 = v22;
      v31 = 2112;
      v32 = uUID2;
      v33 = 2112;
      v34 = server2;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find HMMTRAccessoryServer: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v19);
    futureWithNoValue = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v25 = *MEMORY[0x277D85DE8];

  return futureWithNoValue;
}

uint64_t __54__HMDHome__configureMatterV1Accessory_accessoryModel___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 clearAllUsersWithDeletedCreatorFabricIndexWithFlow:*(a1 + 32)];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return [(HMDHome *)v7 _configureWithFeatureSpecificDataAccessory:v8 accessoryModel:v9, v10];
  }
}

- (id)_configureWithFeatureSpecificDataAccessory:(id)accessory accessoryModel:(id)model
{
  accessoryCopy = accessory;
  modelCopy = model;
  array = [MEMORY[0x277CBEB18] array];
  supportsMatCredACP = [modelCopy supportsMatCredACP];
  bOOLValue = [supportsMatCredACP BOOLValue];

  if (bOOLValue)
  {
    v11 = [(HMDHome *)self _configureTTUAndUWBOnAccessory:accessoryCopy accessoryModel:modelCopy];
  }

  else
  {
    if (![modelCopy supportsAnyMatterV1InPersonAccess])
    {
      goto LABEL_6;
    }

    v11 = [(HMDHome *)self _configureMatterV1Accessory:accessoryCopy accessoryModel:modelCopy];
  }

  v12 = v11;
  [array addObject:v11];

LABEL_6:
  v13 = [MEMORY[0x277D0F7C0] all:array];

  return v13;
}

- (void)_removeFailedAddWithAccessoryServerInfo:(id)info
{
  infoCopy = info;
  v5 = objc_alloc(MEMORY[0x277D0F7A8]);
  workQueue = [(HMDHome *)self workQueue];
  v7 = [v5 initWithQueue:workQueue];

  v20 = _HMFThreadLocalAsyncContextPush();
  if ([(HMDHome *)self isSharedAdmin])
  {
    server = [infoCopy server];
    owner = [(HMDHome *)self owner];
    futureWithNoValue = [(HMDHome *)self _removeUserFromNewlyPairedAccessoryServer:server user:owner];
  }

  else
  {
    futureWithNoValue = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __51__HMDHome__removeFailedAddWithAccessoryServerInfo___block_invoke;
  v18[3] = &unk_2786898D8;
  v18[4] = self;
  v11 = infoCopy;
  v19 = v11;
  v12 = [futureWithNoValue finally:v18];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __51__HMDHome__removeFailedAddWithAccessoryServerInfo___block_invoke_2;
  v15[3] = &unk_2786898D8;
  v13 = v11;
  v16 = v13;
  selfCopy = self;
  v14 = [v12 finally:v15];

  _HMFThreadLocalAsyncContextPop();
}

uint64_t __51__HMDHome__removeFailedAddWithAccessoryServerInfo___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) server];
  v4 = [*(a1 + 32) currentUser];
  v5 = [v2 _removeUserFromNewlyPairedAccessoryServer:v3 user:v4];
  if (v5)
  {
    v6 = v5;

    return 3;
  }

  else
  {
    v8 = _HMFPreconditionFailure();
    return __51__HMDHome__removeFailedAddWithAccessoryServerInfo___block_invoke_2(v8);
  }
}

uint64_t __51__HMDHome__removeFailedAddWithAccessoryServerInfo___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) networkCredential];
  v3 = [v2 clientIdentifier];

  if (v3)
  {
    [*(a1 + 40) _removeClientConfigurationWithIdentifier:v3];
  }

  return 1;
}

- (void)_processNewlyPairedAccessoryServerInfo:(id)info message:(id)message completionHandler:(id)handler
{
  v92 = *MEMORY[0x277D85DE8];
  infoCopy = info;
  messageCopy = message;
  handlerCopy = handler;
  server = [infoCopy server];
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    accessories = [server accessories];
    *buf = 138543874;
    *&buf[4] = v13;
    *&buf[12] = 2048;
    *&buf[14] = [accessories count];
    *&buf[22] = 2112;
    v88 = infoCopy;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Creating %tu new accessory objects for a newly paired accessory server: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v10);
  uuidToHAPAccessoryConfigTable = [(HMDHome *)selfCopy uuidToHAPAccessoryConfigTable];
  primaryAccessory = [server primaryAccessory];
  primaryAccessoryUUID = [infoCopy primaryAccessoryUUID];
  [uuidToHAPAccessoryConfigTable setObject:primaryAccessory forKey:primaryAccessoryUUID];

  v18 = MEMORY[0x277CBEB38];
  accessories2 = [server accessories];
  v20 = [v18 dictionaryWithCapacity:{objc_msgSend(accessories2, "count")}];

  v85 = 0u;
  v86 = 0u;
  v83 = 0u;
  v84 = 0u;
  accessories3 = [server accessories];
  v22 = [accessories3 countByEnumeratingWithState:&v83 objects:v91 count:16];
  if (v22)
  {
    v23 = *v84;
    do
    {
      for (i = 0; i != v22; ++i)
      {
        if (*v84 != v23)
        {
          objc_enumerationMutation(accessories3);
        }

        v25 = *(*(&v83 + 1) + 8 * i);
        uniqueIdentifier = [v25 uniqueIdentifier];
        [v20 setObject:v25 forKey:uniqueIdentifier];
      }

      v22 = [accessories3 countByEnumeratingWithState:&v83 objects:v91 count:16];
    }

    while (v22);
  }

  if ([(HMDHome *)selfCopy hasNeverAddedAnyHAPAccessory])
  {
    pairingEvent = [infoCopy pairingEvent];
    [pairingEvent setFirstHAPAccessoryInHome:1];

    homeManager = [(HMDHome *)selfCopy homeManager];
    hasHAPAccessoryInAnyHome = [homeManager hasHAPAccessoryInAnyHome];
    pairingEvent2 = [infoCopy pairingEvent];
    [pairingEvent2 setFirstHAPAccessoryInAnyHome:hasHAPAccessoryInAnyHome ^ 1u];
  }

  pairingEvent3 = [infoCopy pairingEvent];
  primaryAccessory2 = [server primaryAccessory];
  [pairingEvent3 updateEventPropertiesWithHAPAccessory:primaryAccessory2];

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v88 = __Block_byref_object_copy__14759;
  v89 = __Block_byref_object_dispose__14760;
  v90 = 0;
  v33 = objc_alloc(MEMORY[0x277D0F7A8]);
  workQueue = [(HMDHome *)selfCopy workQueue];
  v59 = [v33 initWithQueue:workQueue];

  v82 = _HMFThreadLocalAsyncContextPush();
  if ([(HMDHome *)selfCopy isSharedAdmin])
  {
    server2 = [infoCopy server];
    futureWithNoValue = [(HMDHome *)selfCopy _addOwnerToNewlyPairedAccessoryServer:server2];
  }

  else
  {
    futureWithNoValue = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v79[0] = MEMORY[0x277D85DD0];
  v79[1] = 3221225472;
  v79[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke;
  v79[3] = &unk_27867C6C8;
  v79[4] = selfCopy;
  v36 = infoCopy;
  v80 = v36;
  v37 = messageCopy;
  v81 = v37;
  v38 = [futureWithNoValue then:v79];
  v39 = [v38 timeout:180.0];
  v74[0] = MEMORY[0x277D85DD0];
  v74[1] = 3221225472;
  v74[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_2;
  v74[3] = &unk_27866FE90;
  v74[4] = selfCopy;
  v78 = buf;
  v40 = v36;
  v75 = v40;
  v41 = v37;
  v76 = v41;
  v57 = v20;
  v77 = v57;
  v42 = [v39 then:v74];
  v71[0] = MEMORY[0x277D85DD0];
  v71[1] = 3221225472;
  v71[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_3;
  v71[3] = &unk_27866FED8;
  v71[4] = selfCopy;
  v73 = buf;
  v43 = v40;
  v72 = v43;
  v44 = [v42 then:v71];
  v68[0] = MEMORY[0x277D85DD0];
  v68[1] = 3221225472;
  v68[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_4;
  v68[3] = &unk_27866FED8;
  v68[4] = selfCopy;
  v54 = server;
  v69 = v54;
  v70 = buf;
  v45 = [v44 then:v68];
  v64[0] = MEMORY[0x277D85DD0];
  v64[1] = 3221225472;
  v64[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_6;
  v64[3] = &unk_27866FF00;
  v64[4] = selfCopy;
  v67 = buf;
  v46 = v41;
  v65 = v46;
  v47 = handlerCopy;
  v66 = v47;
  v48 = [v45 then:v64];
  v60[0] = MEMORY[0x277D85DD0];
  v60[1] = 3221225472;
  v60[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_7;
  v60[3] = &unk_27866FF28;
  v60[4] = selfCopy;
  v49 = v43;
  v61 = v49;
  v50 = v46;
  v62 = v50;
  v51 = v47;
  v63 = v51;
  v52 = [v48 recover:v60];

  _HMFThreadLocalAsyncContextPop();
  _Block_object_dispose(buf, 8);

  v53 = *MEMORY[0x277D85DE8];
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke(void *a1, void *a2)
{
  v165 = *MEMORY[0x277D85DE8];
  v140 = a2;
  v4 = a1[4];
  v3 = a1[5];
  v5 = a1[6];
  v6 = v3;
  v7 = v5;
  v142 = v4;
  v143 = v6;
  if (!v4)
  {
    goto LABEL_63;
  }

  v8 = v6;
  v9 = [v8 server];
  v10 = [v9 primaryAccessory];

  v11 = [v8 primaryAccessoryUUID];
  v12 = [v8 certificationStatus];
  v13 = [v8 networkCredential];
  v145 = v8;
  v14 = [v8 hostAccessory];
  v15 = v10;
  v16 = v11;
  obj = v13;
  v17 = v14;
  v18 = [MKFModelFactory createHAPAccessoryModelWithModelID:v16];
  HMDPopulateAccessoryModelFromHAPAccessory(v18, v15, v12, v17);
  v19 = v15;
  v20 = [v19 server];
  v21 = [v20 productData];

  v141 = v7;
  v144 = v19;
  if (v21)
  {
    v22 = [v20 productData];
    v23 = [HMDAccessory validateProductData:v22];

    if (v23)
    {
      v24 = v144;
      v25 = [v144 productData];
      if (v25)
      {
        v26 = v25;
        v27 = [v20 productData];
        v28 = [v144 productData];
        v29 = [v27 isEqualToString:v28];

        v24 = v144;
        if ((v29 & 1) == 0)
        {
          v30 = objc_autoreleasePoolPush();
          v31 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
          {
            v32 = HMFGetLogIdentifier();
            v33 = [v144 uniqueIdentifier];
            v34 = [v20 productData];
            v35 = [v144 productData];
            *buf = 138544130;
            *&buf[4] = v32;
            *&buf[12] = 2112;
            *&buf[14] = v33;
            *&buf[22] = 2112;
            v161 = v34;
            LOWORD(v162) = 2112;
            *(&v162 + 2) = v35;
            _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Accessory with identifier %@ is using productData from pair setup that differs from productData published on AIS: %@ != %@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v30);
          v24 = v144;
        }
      }

      v36 = [v20 productData];
      goto LABEL_29;
    }

    v37 = objc_autoreleasePoolPush();
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
    {
      v39 = HMFGetLogIdentifier();
      v40 = [v144 uniqueIdentifier];
      v41 = [v20 productData];
      *buf = 138543874;
      *&buf[4] = v39;
      *&buf[12] = 2112;
      *&buf[14] = v40;
      *&buf[22] = 2112;
      v161 = v41;
      _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_ERROR, "%{public}@Accessory with identifier %@ has invalid productData from pair setup: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v37);
    v19 = v144;
  }

  v42 = [v19 productData];

  if (!v42)
  {
LABEL_19:
    v51 = +[HMDVendorDataManager sharedVendorDataManager];
    v52 = [v19 manufacturer];
    v53 = [v19 model];
    v54 = [v51 vendorModelEntryForManufacturer:v52 model:v53];

    if (v54)
    {
      v55 = [v54 productData];

      if (v55)
      {
        v36 = [v54 productData];
LABEL_28:

        v24 = v144;
        goto LABEL_29;
      }

      v56 = objc_autoreleasePoolPush();
      v57 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v57, OS_LOG_TYPE_ERROR))
      {
        v58 = HMFGetLogIdentifier();
        v147 = v56;
        v59 = [v144 uniqueIdentifier];
        v60 = [v144 manufacturer];
        v61 = [v144 model];
        *buf = 138544130;
        *&buf[4] = v58;
        *&buf[12] = 2112;
        *&buf[14] = v59;
        *&buf[22] = 2112;
        v161 = v60;
        LOWORD(v162) = 2112;
        *(&v162 + 2) = v61;
        v62 = "%{public}@Accessory with identifier %@ does not have productData in the VIDB (manufacturer: '%@', model: '%@')";
        goto LABEL_26;
      }
    }

    else
    {
      v56 = objc_autoreleasePoolPush();
      v57 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v57, OS_LOG_TYPE_ERROR))
      {
        v58 = HMFGetLogIdentifier();
        v147 = v56;
        v59 = [v144 uniqueIdentifier];
        v60 = [v144 manufacturer];
        v61 = [v144 model];
        *buf = 138544130;
        *&buf[4] = v58;
        *&buf[12] = 2112;
        *&buf[14] = v59;
        *&buf[22] = 2112;
        v161 = v60;
        LOWORD(v162) = 2112;
        *(&v162 + 2) = v61;
        v62 = "%{public}@Accessory with identifier %@ could not be found in the VIDB (manufacturer: '%@', model: '%@')";
LABEL_26:
        _os_log_impl(&dword_229538000, v57, OS_LOG_TYPE_ERROR, v62, buf, 0x2Au);

        v56 = v147;
      }
    }

    objc_autoreleasePoolPop(v56);
    v36 = 0;
    goto LABEL_28;
  }

  [v19 productData];
  v44 = v43 = v19;
  v45 = [HMDAccessory validateProductData:v44];

  if (!v45)
  {
    v46 = objc_autoreleasePoolPush();
    v47 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
    {
      v48 = HMFGetLogIdentifier();
      v49 = [v144 uniqueIdentifier];
      v50 = [v144 productData];
      *buf = 138543874;
      *&buf[4] = v48;
      *&buf[12] = 2112;
      *&buf[14] = v49;
      *&buf[22] = 2112;
      v161 = v50;
      _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Accessory with identifier %@ has invalid productData published on AIS: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v46);
    v19 = v144;
    goto LABEL_19;
  }

  v36 = [v43 productData];
  v24 = v43;
LABEL_29:

  if (v36)
  {
    v63 = v18;
    v64 = v36;
    v65 = objc_autoreleasePoolPush();
    v66 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v66, OS_LOG_TYPE_DEFAULT))
    {
      v67 = HMFGetLogIdentifier();
      v68 = [v63 uniqueIdentifier];
      *buf = 138543874;
      *&buf[4] = v67;
      *&buf[12] = 2112;
      *&buf[14] = v68;
      *&buf[22] = 2112;
      v161 = v64;
      _os_log_impl(&dword_229538000, v66, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory with identifier %@ is now bound to productData %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v65);
    [v63 setProductData:v64];

    v24 = v144;
  }

  v69 = [v24 server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v70 = v69;
  }

  else
  {
    v70 = 0;
  }

  v71 = v70;

  v72 = v24;
  v73 = [v71 isWacComplete];

  v74 = v18;
  v75 = obj;
  v76 = [v75 clientIdentifier];
  [v74 setNetworkClientIdentifier:v76];

  [v74 setNetworkClientLAN:&unk_283E74750];
  v77 = [v75 networkRouterUUID];
  v78 = [v77 UUIDString];
  [v74 setNetworkRouterUUID:v78];

  v79 = [v75 wiFiPSK];
  [v74 setWiFiUniquePreSharedKey:v79];

  v80 = [v75 wiFiPSK];

  v81 = 2;
  if (!v73)
  {
    v81 = 0;
  }

  if (v80)
  {
    v82 = 3;
  }

  else
  {
    v82 = v81;
  }

  v83 = [MEMORY[0x277CCABB0] numberWithInteger:v82];
  [v74 setWiFiCredentialType:v83];

  v84 = v145;
  v85 = [v145 server];
  v86 = [v145 home];
  LODWORD(v83) = shouldCreateNativeMatterAccessoryFromServer(v85, v86);

  if (v83)
  {
    v87 = objc_autoreleasePoolPush();
    v88 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v88, OS_LOG_TYPE_INFO))
    {
      v89 = HMFGetLogIdentifier();
      v90 = [v145 primaryAccessoryUUID];
      *buf = 138543618;
      *&buf[4] = v89;
      *&buf[12] = 2112;
      *&buf[14] = v90;
      _os_log_impl(&dword_229538000, v88, OS_LOG_TYPE_INFO, "%{public}@Creating native matter accessory model uuid %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v87);
    [v74 setSupportsNativeMatter:MEMORY[0x277CBEC38]];
    v91 = [v74 providedName];

    if (!v91)
    {
      v92 = [v145 server];
      v93 = [v92 name];
      [v74 setProvidedName:v93];
    }

    v94 = [v74 configuredName];

    if (!v94)
    {
      v95 = [v74 providedName];
      [v74 setConfiguredName:v95];
    }
  }

  v96 = [v144 services];
  v97 = [v96 copy];
  v98 = HMDNewModelsFromHAPServices(v97, v74);

  v153 = 0u;
  v154 = 0u;
  v151 = 0u;
  v152 = 0u;
  v99 = [v145 server];
  v100 = [v99 accessories];

  obja = v100;
  v101 = [v100 countByEnumeratingWithState:&v151 objects:buf count:16];
  if (v101)
  {
    v102 = v101;
    v103 = *v152;
    v146 = *v152;
    do
    {
      v104 = 0;
      v148 = v102;
      do
      {
        if (*v152 != v103)
        {
          objc_enumerationMutation(obja);
        }

        v105 = *(*(&v151 + 1) + 8 * v104);
        if (([v105 isPrimary] & 1) == 0)
        {
          v106 = [v84 certificationStatus];
          v107 = v74;
          v108 = v74;
          v109 = v105;
          v110 = [v109 instanceID];
          v111 = [v110 stringValue];
          *v155 = v111;
          v112 = [MEMORY[0x277CBEA60] arrayWithObjects:v155 count:1];

          v113 = MEMORY[0x277CCAD78];
          v114 = [v108 modelID];
          v115 = [v113 hm_deriveUUIDFromBaseUUID:v114 withSalts:v112];

          v116 = [MKFModelFactory createHAPAccessoryModelWithModelID:v115];
          [v108 addHostedAccessoriesObject:v116];
          HMDPopulateAccessoryModelFromHAPAccessory(v116, v109, v106, v108);

          [v116 setWiFiCredentialType:&unk_283E74750];
          v117 = objc_autoreleasePoolPush();
          v118 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v118, OS_LOG_TYPE_INFO))
          {
            v119 = HMFGetLogIdentifier();
            v120 = [v109 uniqueIdentifier];
            v121 = [v116 modelID];
            v122 = [v121 UUIDString];
            *v155 = 138543874;
            *&v155[4] = v119;
            *&v155[12] = 2112;
            *&v155[14] = v120;
            *&v155[22] = 2112;
            v156 = v122;
            _os_log_impl(&dword_229538000, v118, OS_LOG_TYPE_INFO, "%{public}@Created secondary accessory with identifier %@ and uuid %@", v155, 0x20u);

            v84 = v145;
          }

          objc_autoreleasePoolPop(v117);
          v123 = [v109 services];
          v124 = [v123 copy];
          v125 = HMDNewModelsFromHAPServices(v124, v116);

          v74 = v107;
          v103 = v146;
          v102 = v148;
        }

        ++v104;
      }

      while (v102 != v104);
      v102 = [obja countByEnumeratingWithState:&v151 objects:buf count:16];
    }

    while (v102);
  }

  v126 = [v84 server];
  v127 = [HMDHome updatedHomeModelCHIPPropertiesForAddedHAPAccessoryServer:v126];

  v128 = [v142 _readDataNeededImmediatelyAfterPairing:v84 intoModel:v74];
  *&v151 = MEMORY[0x277D85DD0];
  *(&v151 + 1) = 3221225472;
  *&v152 = __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke;
  *(&v152 + 1) = &unk_278685D58;
  v129 = v74;
  *&v153 = v129;
  v130 = v84;
  *(&v153 + 1) = v130;
  *&v154 = v142;
  v131 = [v128 then:&v151];
  *v155 = MEMORY[0x277D85DD0];
  *&v155[8] = 3221225472;
  *&v155[16] = __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_1534;
  v156 = &unk_27867C6C8;
  v157 = v142;
  v158 = v130;
  v132 = v129;
  v159 = v132;
  v133 = [v131 then:v155];
  *buf = MEMORY[0x277D85DD0];
  *&buf[8] = 3221225472;
  *&buf[16] = __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_2;
  v161 = &unk_2786868C8;
  *&v162 = v142;
  *(&v162 + 1) = v132;
  v163 = v127;
  v134 = v141;
  v164 = v141;
  v135 = v127;
  v7 = v132;
  v4 = [v133 then:buf];

  while (1)
  {

    v136 = v4;
    if (v136)
    {
      break;
    }

    _HMFPreconditionFailure();
LABEL_63:
    v134 = v7;
  }

  v137 = v136;

  v138 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v52 = *MEMORY[0x277D85DE8];
  v38 = a2;
  v3 = [*(a1 + 32) administratorHandler];
  v4 = [v3 shouldRelayMessages];

  v5 = *(a1 + 32);
  if (v4)
  {
    v6 = [*(a1 + 32) retrieveNewlyAddedAccessoriesForPairedAccessoryServerInfo:*(a1 + 40)];
    v7 = *(*(a1 + 64) + 8);
    v8 = *(v7 + 40);
    *(v7 + 40) = v6;
  }

  else
  {
    v8 = [*(a1 + 48) identifier];
    v9 = [v5 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v8];
    v10 = *(*(a1 + 64) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;
  }

  v12 = *(a1 + 32);
  v13 = *(a1 + 56);
  v14 = *(*(*(a1 + 64) + 8) + 40);
  v15 = v13;
  v39 = v14;
  if (v12)
  {
    v42 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v14, "count")}];
    v16 = [v12 notificationRegistrations];
    v41 = [v16 count];

    v49 = 0u;
    v50 = 0u;
    v47 = 0u;
    v48 = 0u;
    obj = v14;
    v17 = [obj countByEnumeratingWithState:&v47 objects:v51 count:16];
    if (v17)
    {
      v18 = v17;
      v19 = *v48;
      p_superclass = HMDIDSActivityRegistrationModel.superclass;
      v40 = *v48;
      do
      {
        v21 = 0;
        do
        {
          if (*v48 != v19)
          {
            objc_enumerationMutation(obj);
          }

          v22 = *(*(&v47 + 1) + 8 * v21);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v23 = v22;
          }

          else
          {
            v23 = 0;
          }

          v24 = v23;

          v25 = [v24 uniqueIdentifier];
          v26 = [v15 objectForKey:v25];

          if (v24)
          {
            v27 = v26 == 0;
          }

          else
          {
            v27 = 1;
          }

          if (!v27)
          {
            v46 = 0;
            [MEMORY[0x277D0F7C0] futureWithPromise:&v46];
            v28 = v15;
            v30 = v29 = p_superclass;
            [v12 workQueue];
            v32 = v31 = v12;
            v44[0] = MEMORY[0x277D85DD0];
            v44[1] = 3221225472;
            v44[2] = __83__HMDHome__associateAccessoriesWithHAPAccessories_uniqueIdentifierHAPAccessoryMap___block_invoke;
            v44[3] = &unk_27868A728;
            v45 = v46;
            [v24 configureWithAccessory:v26 homeNotificationsEnabled:v41 != 0 queue:v32 completion:v44];

            v12 = v31;
            [v42 addObject:v30];

            p_superclass = v29;
            v15 = v28;
            v19 = v40;
          }

          ++v21;
        }

        while (v18 != v21);
        v18 = [obj countByEnumeratingWithState:&v47 objects:v51 count:16];
      }

      while (v18);
    }

    v33 = [MEMORY[0x277D0F7C0] allSettled:v42];
    v12 = [v33 ignoreOutcome];
  }

  v34 = v12;
  if (!v34)
  {
    _HMFPreconditionFailure();
  }

  v35 = v34;

  v36 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_3(uint64_t a1, void *a2)
{
  v60 = *MEMORY[0x277D85DE8];
  v35 = a2;
  v3 = *(*(*(a1 + 48) + 8) + 40);
  v4 = *(a1 + 32);
  v5 = [*(a1 + 40) pairingEvent];
  v37 = v3;
  v36 = v5;
  if (!v4)
  {
    goto LABEL_20;
  }

  v6 = objc_autoreleasePoolPush();
  v38 = v4;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v37, "count")}];
    v10 = [v36 accessoryUUID];
    *buf = 138543874;
    v55 = v8;
    v56 = 2112;
    v57 = v9;
    v58 = 2112;
    v59 = v10;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Performing post add configuration for %@ new accessories for pairing: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = objc_alloc(MEMORY[0x277D0F770]);
  v12 = MEMORY[0x277CCACA8];
  v13 = MEMORY[0x22AAD2510](v38, sel__configureNewlyAddedAccessories_pairingEvent_);
  v14 = [v12 stringWithFormat:@"%@, %s:%ld", v13, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 16778];
  v53 = [v11 initWithName:v14];

  v51[0] = 0;
  v51[1] = v51;
  v51[2] = 0x3032000000;
  v51[3] = __Block_byref_object_copy__14759;
  v51[4] = __Block_byref_object_dispose__14760;
  v52 = 0;
  v15 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v37, "count")}];
  v49 = 0u;
  v50 = 0u;
  v47 = 0u;
  v48 = 0u;
  v16 = v37;
  v17 = [v16 countByEnumeratingWithState:&v47 objects:buf count:16];
  if (v17)
  {
    v18 = *v48;
    do
    {
      v19 = 0;
      do
      {
        if (*v48 != v18)
        {
          objc_enumerationMutation(v16);
        }

        v20 = *(*(&v47 + 1) + 8 * v19);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v21 = v20;
        }

        else
        {
          v21 = 0;
        }

        v22 = v21;

        if (v22)
        {
          v39[0] = 0;
          v23 = [MEMORY[0x277D0F7C0] futureWithPromise:v39];
          v42[0] = MEMORY[0x277D85DD0];
          v42[1] = 3221225472;
          v42[2] = __56__HMDHome__configureNewlyAddedAccessories_pairingEvent___block_invoke;
          v42[3] = &unk_27867B0F8;
          v42[4] = v38;
          v24 = v22;
          v43 = v24;
          v46 = v51;
          v44 = v53;
          v45 = v39[0];
          [v24 readInitialRequiredCharacteristicsForAccessory:v42];
          [v24 checkHAPSessionRestore];
          [v15 addObject:v23];
        }

        ++v19;
      }

      while (v17 != v19);
      v17 = [v16 countByEnumeratingWithState:&v47 objects:buf count:16];
    }

    while (v17);
  }

  v25 = objc_alloc(MEMORY[0x277D0F7A8]);
  v26 = [v38 workQueue];
  v27 = [v25 initWithQueue:v26];

  v28 = [MEMORY[0x277D0F7C0] allSettled:v15];
  v29 = [v28 ignoreOutcome];
  v39[0] = MEMORY[0x277D85DD0];
  v39[1] = 3221225472;
  v39[2] = __56__HMDHome__configureNewlyAddedAccessories_pairingEvent___block_invoke_3;
  v39[3] = &unk_278670158;
  v39[4] = v38;
  v41 = v51;
  v40 = v36;
  v30 = [v29 inContext:v27 then:v39];

  _Block_object_dispose(v51, 8);
  __HMFActivityScopeLeave();

  while (1)
  {

    v31 = v30;
    if (v31)
    {
      break;
    }

    _HMFPreconditionFailure();
LABEL_20:
    v30 = 0;
  }

  v32 = v31;

  v33 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_4(uint64_t a1)
{
  [*(a1 + 32) finishPairingForServer:*(a1 + 40)];
  [*(*(*(a1 + 48) + 8) + 40) na_each:&__block_literal_global_1531];
  return 1;
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_6(uint64_t a1)
{
  [*(a1 + 32) _notifyClientOfNewlyAddedAccessories:*(*(*(a1 + 56) + 8) + 40) requestMessage:*(a1 + 40)];
  (*(*(a1 + 48) + 16))();
  return 1;
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_7(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v11 = 138543874;
    v12 = v7;
    v13 = 2112;
    v14 = v8;
    v15 = 2112;
    v16 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Add accessory failed for %@ with error %@", &v11, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 32) _removeFailedAddWithAccessoryServerInfo:*(a1 + 40)];
  [*(a1 + 48) respondWithError:v3];
  (*(*(a1 + 56) + 16))();

  v9 = *MEMORY[0x277D85DE8];
  return 1;
}

void __56__HMDHome__configureNewlyAddedAccessories_pairingEvent___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) administratorHandler];
  v5 = [v4 shouldRelayMessages];

  if ((v5 & 1) == 0)
  {
    [*(a1 + 40) autoConfigureTargetController];
  }

  if ([*(a1 + 40) isPrimary])
  {
    objc_storeStrong((*(*(a1 + 64) + 8) + 40), *(a1 + 40));
    [*(a1 + 48) begin];
    v9 = *(a1 + 48);
    v6 = *(a1 + 40);
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __56__HMDHome__configureNewlyAddedAccessories_pairingEvent___block_invoke_2;
    v7[3] = &unk_27868A728;
    v8 = *(a1 + 56);
    [v6 handleUpdatedServicesForThreadManagementWithCompletion:v7];

    __HMFActivityScopeLeave();
  }

  else
  {
    [*(a1 + 56) fulfillWithValue:0];
  }
}

uint64_t __56__HMDHome__configureNewlyAddedAccessories_pairingEvent___block_invoke_3(void *a1, void *a2)
{
  v3 = a2;
  v4 = a1[5];
  v5 = a1[4];
  v6 = *(*(a1[6] + 8) + 40);
  v7 = v4;
  if (v5)
  {
    v8 = [MEMORY[0x277D0F770] currentActivity];
    v22 = 0;
    v5 = [MEMORY[0x277D0F7C0] futureWithPromise:&v22];
    if ([v6 isPrimary])
    {
      [v8 begin];
      v21 = v8;
      v9 = [MEMORY[0x277CBEAA8] date];
      v15[0] = MEMORY[0x277D85DD0];
      v15[1] = 3221225472;
      v15[2] = __60__HMDHome__commissionAccessoryToThreadNetwork_pairingEvent___block_invoke;
      v15[3] = &unk_278676CB8;
      v10 = v9;
      v16 = v10;
      v17 = v21;
      v18 = v6;
      v19 = v7;
      v20 = v22;
      [v18 commissionToThreadNetworkWithPairingEvent:v19 completion:v15];

      __HMFActivityScopeLeave();
    }

    else
    {
      [v22 fulfillWithValue:0];
    }
  }

  v11 = v5;
  if (!v11)
  {
    v14 = _HMFPreconditionFailure();
    __HMFActivityScopeLeave();
    _Unwind_Resume(v14);
  }

  v12 = v11;

  return 3;
}

uint64_t __60__HMDHome__commissionAccessoryToThreadNetwork_pairingEvent___block_invoke(uint64_t a1, void *a2)
{
  v3 = MEMORY[0x277CBEAA8];
  v4 = a2;
  v5 = [v3 date];
  [v5 timeIntervalSinceDate:*(a1 + 32)];
  v7 = v6;

  [*(a1 + 48) uuid];
  v8 = [MEMORY[0x277CCABB0] numberWithDouble:v7];
  [v4 domain];

  [v4 code];
  [*(a1 + 56) setThreadCommissioningDuration:v7];
  [*(a1 + 56) setThreadCommissioningError:v4];

  v9 = *(a1 + 64);

  return [v9 fulfillWithValue:0];
}

uint64_t __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke(id *a1, void *a2)
{
  v41 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [a1[4] supportsMatCredACP];
  if (![v4 BOOLValue])
  {
    goto LABEL_10;
  }

  v5 = [a1[4] mfiCertifiedACWG];
  if (([v5 BOOLValue] & 1) != 0 || objc_msgSend(a1[5], "certificationStatus") != 2)
  {

LABEL_10:
    goto LABEL_11;
  }

  v6 = skipAuthPromptDialog;

  if ((v6 & 1) == 0)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = a1[6];
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [a1[4] mfiCertifiedACWG];
      v12 = [v11 BOOLValue];
      [a1[5] certificationStatus];
      v13 = HMAccessoryCertificationStatusToString();
      *buf = 138544130;
      *&buf[4] = v10;
      v35 = 1024;
      v36 = v12;
      v37 = 2112;
      v38 = v13;
      v39 = 1024;
      v40 = skipAuthPromptDialog;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Uncertified ECB lock detected, showing the uncertified accessory dialog. ACWG Certification status: %{BOOL}d, certification status: %@, shouldSkipAuthPrompt: %{BOOL}d", buf, 0x22u);
    }

    objc_autoreleasePoolPop(v7);
    *buf = 0;
    v14 = [MEMORY[0x277D0F7C0] futureWithPromise:buf];
    v15 = +[HMDUIDialogPresenter sharedUIDialogPresenter];
    v16 = a1[4];
    v17 = [a1[6] workQueue];
    v32[0] = MEMORY[0x277D85DD0];
    v32[1] = 3221225472;
    v32[2] = __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_1533;
    v32[3] = &unk_27867F418;
    v32[4] = a1[6];
    v33 = *buf;
    [v15 requestUserPermissionForUnauthenticatedAliroLockWithContext:v16 queue:v17 completionHandler:v32];

    v18 = v14;
    if (!v18)
    {
      _HMFPreconditionFailure();
    }

    v19 = v18;
    v20 = 3;

    goto LABEL_16;
  }

LABEL_11:
  v21 = [a1[4] supportsMatCredACP];
  v22 = [v21 BOOLValue];

  if (v22)
  {
    v23 = objc_autoreleasePoolPush();
    v24 = a1[6];
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      v27 = [a1[4] mfiCertifiedACWG];
      v28 = [v27 BOOLValue];
      [a1[5] certificationStatus];
      v29 = HMAccessoryCertificationStatusToString();
      *buf = 138544130;
      *&buf[4] = v26;
      v35 = 1024;
      v36 = v28;
      v37 = 2112;
      v38 = v29;
      v39 = 1024;
      v40 = skipAuthPromptDialog;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Not showing uncertified dialog for ECB lock. ACWG Certification status: %{BOOL}d, certification status: %@, shouldSkipAuthPrompt: %{BOOL}d", buf, 0x22u);
    }

    objc_autoreleasePoolPop(v23);
  }

  v20 = 1;
LABEL_16:

  v30 = *MEMORY[0x277D85DE8];
  return v20;
}

uint64_t __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_1534(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) _configureWithFeatureSpecificDataAccessory:*(a1 + 40) accessoryModel:*(a1 + 48)];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_2(v7);
  }
}

uint64_t __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_2(void **a1, void *a2)
{
  v63 = *MEMORY[0x277D85DE8];
  v3 = a2;
  notifyMatterMetricPairingStep(a1[4], 0x1AuLL);
  v4 = [a1[4] administratorHandler];
  v5 = [v4 shouldRelayMessages];

  if (!v5)
  {
    v44 = objc_autoreleasePoolPush();
    v45 = a1[4];
    v46 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
    {
      v4 = HMFGetLogIdentifier();
      v47 = a1[5];
      v48 = [a1[7] shortDescription];
      *buf = 138543874;
      *&buf[4] = v4;
      *&buf[12] = 2112;
      *&buf[14] = v47;
      *&buf[22] = 2112;
      v59 = v48;
      _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_INFO, "%{public}@Locally adding accessories for the home using primary accessory model: %@, message: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v44);
    v49 = [(HMDHome *)a1[4] _addAccessoriesUsingPrimaryAccessoryModel:a1[6] updatedHomeInfo:a1[7] message:?];
    if (v49)
    {
      v50 = v49;

      goto LABEL_25;
    }

    goto LABEL_26;
  }

  v4 = a1[4];
  v6 = a1[5];
  v7 = a1[6];
  v8 = v6;
  v9 = v7;
  v54 = v3;
  v55 = v8;
  if (v4)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = v4;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v13;
      *&buf[12] = 2112;
      *&buf[14] = v8;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Remotely adding accessories via primary resident using primary accessory model: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = objc_alloc_init(MEMORY[0x277CBEB38]);
    v15 = v8;
    v4 = 0x277CBE000;
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
LABEL_27:
      v53 = v4[135];
      objc_opt_class();
      _HMFPreconditionFailureWithFormat();
    }

    v57 = 0;
    v16 = [HMDStructuredWriter writerIntoObject:&v57 extendedTypeOptions:9];
    v17 = HMDRemoteAddCodingModel();
    [v17 encodeRootObject:v15 withWriter:v16];

    v18 = objc_autoreleasePoolPush();
    v19 = v11;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v21;
      *&buf[12] = 2112;
      *&buf[14] = v57;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Including serialized accessories: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
    [v14 setObject:v57 forKeyedSubscript:@"HMDSerializedAccessoriesMessageKey"];
    if (v9)
    {
      v22 = objc_autoreleasePoolPush();
      v23 = v19;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEBUG))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543618;
        *&buf[4] = v25;
        *&buf[12] = 2112;
        *&buf[14] = v9;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_DEBUG, "%{public}@Including updated home info: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v22);
      [v14 setObject:v9 forKeyedSubscript:@"HMDUpdatedHomeInfoMessageKey"];
    }

    v26 = [v15 hostAccessory];
    v27 = [v26 modelID];

    if (v27)
    {
      v28 = objc_autoreleasePoolPush();
      v29 = v19;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
      {
        v31 = HMFGetLogIdentifier();
        *buf = 138543618;
        *&buf[4] = v31;
        *&buf[12] = 2112;
        *&buf[14] = v27;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_DEBUG, "%{public}@Including host accessory uuid: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v28);
      v32 = [v27 UUIDString];
      [v14 setObject:v32 forKeyedSubscript:@"HMDHostAccessoryIdentifierMessageKey"];
    }

    v56 = 0;
    v33 = [MEMORY[0x277D0F7C0] futureWithPromise:&v56];
    v34 = MEMORY[0x277D0F848];
    v35 = [v14 copy];
    *buf = MEMORY[0x277D85DD0];
    *&buf[8] = 3221225472;
    *&buf[16] = __76__HMDHome__remotelyAddAccessoriesFromPrimaryAccessoryModel_updatedHomeInfo___block_invoke;
    v59 = &unk_278686658;
    v60 = v19;
    v36 = v15;
    v61 = v36;
    v62 = v56;
    v37 = [v34 messageWithName:@"HMDRemoteAddHAPAccessoriesMessage" messagePayload:v35 responseHandler:buf];

    v38 = objc_alloc(MEMORY[0x277D0F820]);
    v39 = [v19 uuid];
    v4 = [v38 initWithTarget:v39];

    [v37 setDestination:v4];
    [v37 setQualityOfService:33];
    v40 = [v19 administratorHandler];
    v41 = [v40 operationForMessage:v37 error:0];
    if (v41)
    {
      [v40 addOperation:v41];
    }
  }

  else
  {
    v33 = 0;
  }

  v42 = v33;
  if (!v42)
  {
LABEL_26:
    _HMFPreconditionFailure();
    goto LABEL_27;
  }

  v43 = v42;

  v3 = v54;
LABEL_25:

  v51 = *MEMORY[0x277D85DE8];
  return 3;
}

- (id)_addAccessoriesUsingPrimaryAccessoryModel:(void *)model updatedHomeInfo:(void *)info message:
{
  v56 = *MEMORY[0x277D85DE8];
  v7 = a2;
  modelCopy = model;
  infoCopy = info;
  if (self)
  {
    v10 = dispatch_group_create();
    backingStore = [self backingStore];
    name = [infoCopy name];
    v13 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v14 = [backingStore transaction:name options:v13];

    v15 = v14;
    v16 = v7;
    selfCopy = self;
    v18 = v10;
    v42 = infoCopy;
    v19 = infoCopy;
    v20 = HMDAddToTransactionBlockFromHAPAccessoryModel(v15, v16, selfCopy, v18, v19);
    if (!v20)
    {
      v49 = 0u;
      v50 = 0u;
      v47 = 0u;
      v48 = 0u;
      hostedAccessories = [v16 hostedAccessories];
      v20 = [hostedAccessories countByEnumeratingWithState:&v47 objects:buf count:16];
      if (v20)
      {
        v40 = modelCopy;
        v41 = v7;
        v22 = *v48;
        while (2)
        {
          for (i = 0; i != v20; i = i + 1)
          {
            if (*v48 != v22)
            {
              objc_enumerationMutation(hostedAccessories);
            }

            castIfHAPAccessory = [*(*(&v47 + 1) + 8 * i) castIfHAPAccessory];
            if (castIfHAPAccessory)
            {
              v25 = castIfHAPAccessory;
              v26 = HMDAddToTransactionBlockFromHAPAccessoryModel(v15, castIfHAPAccessory, selfCopy, v18, v19);
              if (v26)
              {
                v20 = v26;

                hostedAccessories = v20;
                goto LABEL_15;
              }
            }
          }

          v20 = [hostedAccessories countByEnumeratingWithState:&v47 objects:buf count:16];
          if (v20)
          {
            continue;
          }

          break;
        }

LABEL_15:
        modelCopy = v40;
        v7 = v41;
      }
    }

    if (v20)
    {
      v27 = objc_autoreleasePoolPush();
      v28 = selfCopy;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543874;
        *&buf[4] = v30;
        v52 = 2112;
        v53 = v16;
        v54 = 2112;
        v55 = v20;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Failed to add to transaction block from primary accessory model %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v27);
      v31 = [MEMORY[0x277D0F7C0] futureWithError:v20];

      goto LABEL_29;
    }

    v32 = v15;
    v33 = modelCopy;
    v34 = selfCopy;
    v35 = [v34 emptyModelObjectWithChangeType:2];
    if (v33)
    {
      v36 = [v34 updateCHIPPropertiesOnHomeModel:v35 usingUpdatedHomeInfo:v33];
      if (([v34 hasNeverAddedAnyHAPAccessory] & 1) == 0)
      {
        if (!v36)
        {
          goto LABEL_28;
        }

        goto LABEL_27;
      }
    }

    else if (![v34 hasNeverAddedAnyHAPAccessory])
    {
LABEL_28:

      *buf = 0;
      v31 = [MEMORY[0x277D0F7C0] futureWithPromise:buf];
      v43[0] = MEMORY[0x277D85DD0];
      v43[1] = 3221225472;
      v43[2] = __77__HMDHome__addAccessoriesUsingPrimaryAccessoryModel_updatedHomeInfo_message___block_invoke;
      v43[3] = &unk_278688D58;
      v44 = v18;
      v45 = v34;
      v46 = *buf;
      [v32 run:v43];

LABEL_29:
      infoCopy = v42;
      goto LABEL_30;
    }

    date = [MEMORY[0x277CBEAA8] date];
    [v35 setFirstHAPAccessoryAddedDate:date];

LABEL_27:
    [v32 add:v35];
    goto LABEL_28;
  }

  v31 = 0;
LABEL_30:

  v38 = *MEMORY[0x277D85DE8];

  return v31;
}

void __77__HMDHome__addAccessoriesUsingPrimaryAccessoryModel_updatedHomeInfo_message___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v5 = [*(a1 + 40) workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __77__HMDHome__addAccessoriesUsingPrimaryAccessoryModel_updatedHomeInfo_message___block_invoke_2;
  v7[3] = &unk_27868A750;
  v8 = v3;
  v9 = *(a1 + 48);
  v6 = v3;
  dispatch_group_notify(v4, v5, v7);
}

uint64_t __77__HMDHome__addAccessoriesUsingPrimaryAccessoryModel_updatedHomeInfo_message___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  v1 = *(a1 + 40);
  if (v2)
  {
    return [v1 rejectWithError:?];
  }

  else
  {
    return [v1 fulfillWithValue:?];
  }
}

void __76__HMDHome__remotelyAddAccessoriesFromPrimaryAccessoryModel_updatedHomeInfo___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 40);
      v13 = 138543874;
      v14 = v10;
      v15 = 2112;
      v16 = v11;
      v17 = 2112;
      v18 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to remotely add accessories using primary accessory model %@: %@", &v13, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
    [*(a1 + 48) rejectWithError:v5];
  }

  else
  {
    [*(a1 + 48) fulfillWithValue:0];
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_1533(uint64_t a1, int a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (a2)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Uncertified ECB lock detected, user canceled pairing", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    [v9 rejectWithError:v10];
  }

  else
  {
    if (v7)
    {
      v11 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v11;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Uncertified ECB lock detected, user continued pairing", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 40) fulfillWithNoValue];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (id)retrieveNewlyAddedAccessoriesForPairedAccessoryServerInfo:(id)info
{
  v36 = *MEMORY[0x277D85DE8];
  infoCopy = info;
  array = [MEMORY[0x277CBEB18] array];
  primaryAccessoryUUID = [infoCopy primaryAccessoryUUID];
  v7 = [(HMDHome *)self accessoryWithUUID:primaryAccessoryUUID];

  if (v7)
  {
    [array addObject:v7];
    v8 = v7;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v10 = v8;
    }

    else
    {
      v10 = 0;
    }

    v30 = v10;

    if (isKindOfClass)
    {
      v27 = v7;
      v28 = infoCopy;
      v29 = array;
      v33 = 0u;
      v34 = 0u;
      v31 = 0u;
      v32 = 0u;
      accessories = [(HMDHome *)self accessories];
      v12 = [accessories countByEnumeratingWithState:&v31 objects:v35 count:16];
      if (v12)
      {
        v13 = v12;
        v14 = *v32;
        do
        {
          for (i = 0; i != v13; ++i)
          {
            if (*v32 != v14)
            {
              objc_enumerationMutation(accessories);
            }

            v16 = *(*(&v31 + 1) + 8 * i);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v17 = v16;
            }

            else
            {
              v17 = 0;
            }

            v18 = v17;

            bridge = [v18 bridge];
            v20 = bridge;
            if (bridge)
            {
              uuid = [bridge uuid];
              uuid2 = [v30 uuid];
              v23 = [uuid isEqual:uuid2];

              if (v23)
              {
                [v29 addObject:v16];
              }
            }
          }

          v13 = [accessories countByEnumeratingWithState:&v31 objects:v35 count:16];
        }

        while (v13);
      }

      infoCopy = v28;
      array = v29;
      v7 = v27;
    }
  }

  v24 = [array copy];

  v25 = *MEMORY[0x277D85DE8];

  return v24;
}

- (BOOL)hasNeverAddedAnyHAPAccessory
{
  firstHAPAccessoryAddedDate = [(HMDHome *)self firstHAPAccessoryAddedDate];
  if (firstHAPAccessoryAddedDate)
  {
    v4 = 0;
  }

  else
  {
    hapAccessories = [(HMDHome *)self hapAccessories];
    v4 = [hapAccessories count] == 0;
  }

  return v4;
}

- (void)_processLegacyPairingRequestForMessage:(id)message cancelPairing:(BOOL)pairing context:(id)context
{
  pairingCopy = pairing;
  v61 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  contextCopy = context;
  v9 = [messageCopy uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v9)
  {
    if (pairingCopy)
    {
      responseHandler = [messageCopy responseHandler];
      [(HMDHome *)self _cancelPairingWithAccessoryUUID:v9 context:contextCopy completionHandler:responseHandler];
    }

    else
    {
      v50 = [messageCopy stringForKey:*MEMORY[0x277CD1FD8]];
      v49 = [messageCopy stringForKey:@"kAccessoryOnboardingSetupPayloadStringKey"];
      v54 = 0u;
      v55 = 0u;
      v52 = 0u;
      v53 = 0u;
      addPendingAccessories = [(HMDHome *)self addPendingAccessories];
      hm_allKeys = [addPendingAccessories hm_allKeys];

      v19 = [hm_allKeys countByEnumeratingWithState:&v52 objects:v56 count:16];
      if (v19)
      {
        v20 = *v53;
LABEL_9:
        v21 = 0;
        while (1)
        {
          if (*v53 != v20)
          {
            objc_enumerationMutation(hm_allKeys);
          }

          v22 = *(*(&v52 + 1) + 8 * v21);
          accessoryUUID = [v22 accessoryUUID];
          v24 = [accessoryUUID isEqual:v9];

          if (v24)
          {
            break;
          }

          if (v19 == ++v21)
          {
            v19 = [hm_allKeys countByEnumeratingWithState:&v52 objects:v56 count:16];
            if (v19)
            {
              goto LABEL_9;
            }

            goto LABEL_15;
          }
        }

        v25 = v22;

        if (!v25)
        {
          goto LABEL_24;
        }

        v26 = objc_autoreleasePoolPush();
        selfCopy = self;
        v28 = HMFGetOSLogHandle();
        v29 = os_log_type_enabled(v28, OS_LOG_TYPE_INFO);
        if (v50)
        {
          if (v29)
          {
            v30 = HMFGetLogIdentifier();
            *buf = 138543618;
            v58 = v30;
            v59 = 2112;
            v60 = v9;
            _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@Storing the setupCode for accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v26);
          addPendingAccessorySetupCodes = [(HMDHome *)selfCopy addPendingAccessorySetupCodes];
          [addPendingAccessorySetupCodes setObject:v50 forKey:v9];

          addPendingAccessoryOnboardingSetupPayloadStrings = [(HMDHome *)selfCopy addPendingAccessoryOnboardingSetupPayloadStrings];
          [addPendingAccessoryOnboardingSetupPayloadStrings setObject:v49 forKeyedSubscript:v9];

          accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
          v34 = [accessoryBrowser unpairedAccessoryWithUUID:v9];

          if (v34)
          {
            accessoryBrowser2 = [(HMDHome *)selfCopy accessoryBrowser];
            [accessoryBrowser2 handleSetupCodeAvailable:v34];
          }

          addPendingAccessorySetupCodeHandlers = [(HMDHome *)selfCopy addPendingAccessorySetupCodeHandlers];
          v37 = [addPendingAccessorySetupCodeHandlers objectForKeyedSubscript:v9];

          if (v37)
          {
            os_unfair_recursive_lock_lock_with_options();
            [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v9];
            os_unfair_recursive_lock_unlock();
            (v37)[2](v37, v50, v49, 0);
          }

          else
          {
            v44 = objc_autoreleasePoolPush();
            v45 = selfCopy;
            v46 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
            {
              v47 = HMFGetLogIdentifier();
              *buf = 138543618;
              v58 = v47;
              v59 = 2112;
              v60 = v9;
              _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_INFO, "%{public}@No handler to provide the setup code to for accessory: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v44);
          }

          [messageCopy respondWithSuccess];
        }

        else
        {
          if (v29)
          {
            v42 = HMFGetLogIdentifier();
            *buf = 138543618;
            v58 = v42;
            v59 = 2112;
            v60 = v9;
            _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@No setupCode specified to continue pairing with accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v26);
          v43 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          [messageCopy respondWithError:v43];
        }
      }

      else
      {
LABEL_15:

LABEL_24:
        v38 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v40 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
        {
          v41 = HMFGetLogIdentifier();
          *buf = 138543618;
          v58 = v41;
          v59 = 2112;
          v60 = v9;
          _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_INFO, "%{public}@Accessory with UUID %@ not being added to the home", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v38);
        v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:79];
        [messageCopy respondWithError:v25];
      }
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      messagePayload = [messageCopy messagePayload];
      *buf = 138543618;
      v58 = v14;
      v59 = 2112;
      v60 = messagePayload;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@No accessory UUID found in payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [messageCopy respondWithError:v16];
  }

  v48 = *MEMORY[0x277D85DE8];
}

- (void)_cancelPairingWithAccessoryUUID:(id)d context:(id)context completionHandler:(id)handler
{
  v48 = *MEMORY[0x277D85DE8];
  dCopy = d;
  contextCopy = context;
  handlerCopy = handler;
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  unassociatedAccessories = [accessoryBrowser unassociatedAccessories];
  v12 = [unassociatedAccessories hmf_firstObjectWithUUID:dCopy];

  v13 = v12;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  v15 = v14;

  if (v15)
  {
    v42[0] = MEMORY[0x277D85DD0];
    v42[1] = 3221225472;
    v42[2] = __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke;
    v42[3] = &unk_278688B80;
    v43 = handlerCopy;
    [v15 cancelConfigurationWithCompletionHandler:v42];
    v16 = v43;
  }

  else
  {
    accessoryBrowser2 = [(HMDHome *)self accessoryBrowser];
    v38 = [accessoryBrowser2 unpairedAccessoryWithUUID:dCopy];

    addPendingAccessorySetupCodeHandlers = [(HMDHome *)self addPendingAccessorySetupCodeHandlers];
    v37 = [addPendingAccessorySetupCodeHandlers objectForKeyedSubscript:dCopy];

    v19 = objc_autoreleasePoolPush();
    selfCopy = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      uUIDString = [dCopy UUIDString];
      *buf = 138543618;
      v45 = v22;
      v46 = 2112;
      v47 = uUIDString;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Canceling pairing and removing all state for accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    os_unfair_recursive_lock_lock_with_options();
    hm_allKeys = [(NSMapTable *)selfCopy->_addPendingAccessories hm_allKeys];
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke_1527;
    v40[3] = &unk_27866FE40;
    v25 = dCopy;
    v41 = v25;
    v26 = [hm_allKeys na_firstObjectPassingTest:v40];

    [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v25];
    if (v26)
    {
      [(NSMapTable *)selfCopy->_addPendingAccessories removeObjectForKey:v26];
    }

    os_unfair_recursive_lock_unlock();
    if (v38)
    {
      accessoryBrowser3 = [(HMDHome *)selfCopy accessoryBrowser];
      v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      [accessoryBrowser3 cancelPairingWithAccessory:v38 error:v28 context:contextCopy];
    }

    if (v37)
    {
      v29 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      (v37)[2](v37, 0, 0, v29);

      if (handlerCopy)
      {
        (*(handlerCopy + 2))(handlerCopy, 0, 0);
      }
    }

    else
    {
      context = objc_autoreleasePoolPush();
      v30 = selfCopy;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
      {
        v32 = HMFGetLogIdentifier();
        uUIDString2 = [v25 UUIDString];
        *buf = 138543618;
        v45 = v32;
        v46 = 2112;
        v47 = uUIDString2;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_INFO, "%{public}@Unable to find setup available completion handler for accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(context);
      if (handlerCopy)
      {
        v34 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        (*(handlerCopy + 2))(handlerCopy, v34, 0);
      }
    }

    v16 = v38;
  }

  v35 = *MEMORY[0x277D85DE8];
}

uint64_t __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0);
  }

  return result;
}

uint64_t __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke_1527(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 accessoryUUID];
  v4 = [v2 isEqual:v3];

  return v4;
}

- (void)_processPairingRequestForMessage:(id)message cancelPairing:(BOOL)pairing context:(id)context
{
  pairingCopy = pairing;
  v24 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  contextCopy = context;
  v10 = [messageCopy dataForKey:*MEMORY[0x277CD1F90]];
  v19 = 0;
  v11 = [(HMDHome *)self _setupDescriptionFromData:v10 error:&v19];
  v12 = v19;
  if (v11)
  {
    if (pairingCopy)
    {
      [(HMDHome *)self _cancelPairingWithAccessoryDescription:v11 context:contextCopy];
      [messageCopy respondWithPayload:0];
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = v12;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [messageCopy respondWithError:v17];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_cancelPairingWithAccessoryDescription:(id)description context:(id)context
{
  v20 = *MEMORY[0x277D85DE8];
  descriptionCopy = description;
  contextCopy = context;
  accessoryUUID = [descriptionCopy accessoryUUID];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v12;
    v18 = 2112;
    v19 = descriptionCopy;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Canceling pairing and removing all state for accessory with description %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)selfCopy->_addPendingAccessories removeObjectForKey:descriptionCopy];
  if (accessoryUUID)
  {
    [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodes removeObjectForKey:accessoryUUID];
    [(NSMutableDictionary *)selfCopy->_addPendingAccessoryOnboardingSetupPayloadStrings removeObjectForKey:accessoryUUID];
    [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodeHandlers removeObjectForKey:accessoryUUID];
  }

  os_unfair_recursive_lock_unlock();
  accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
  v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
  [accessoryBrowser cancelPairingWithAccessoryDescription:descriptionCopy error:v14 context:contextCopy];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleCancelPairingAccessory:(id)accessory
{
  v4 = MEMORY[0x277CCA9B8];
  accessoryCopy = accessory;
  v6 = [v4 hmInternalErrorWithCode:1090];
  v8 = [HMDMatterAccessoryPairingEndContext hmContextWithCancelledError:v6];

  v7 = [accessoryCopy dataForKey:*MEMORY[0x277CD1F90]];

  if (v7)
  {
    [(HMDHome *)self _processPairingRequestForMessage:accessoryCopy cancelPairing:1 context:v8];
  }

  else
  {
    [(HMDHome *)self _processLegacyPairingRequestForMessage:accessoryCopy cancelPairing:1 context:v8];
  }
}

- (id)_setupCodeProviderForMessage:(id)message
{
  messageCopy = message;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke;
  aBlock[3] = &unk_27866FE68;
  objc_copyWeak(&v11, &location);
  v5 = messageCopy;
  v10 = v5;
  v6 = _Block_copy(aBlock);
  v7 = [v6 copy];

  objc_destroyWeak(&v11);
  objc_destroyWeak(&location);

  return v7;
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v11 = WeakRetained;
  if (WeakRetained)
  {
    v12 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_2;
    block[3] = &unk_278688978;
    block[4] = v11;
    v15 = v7;
    v16 = v8;
    v18 = v9;
    v17 = *(a1 + 32);
    dispatch_async(v12, block);
  }

  else
  {
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(v9 + 2))(v9, 0, 0, v13);
  }
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke_2(id *a1)
{
  v81 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] homeManager];
  v3 = [a1[5] uuid];
  v4 = [a1[5] name];
  v5 = v4;
  if (v3)
  {
    v6 = v4 == 0;
  }

  else
  {
    v6 = 1;
  }

  if (v6 || (v7 = a1[6]) == 0)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = a1[4];
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v3 UUIDString];
      *buf = 138543874;
      v74 = v19;
      v75 = 2112;
      v76 = v5;
      v77 = 2112;
      v78 = v20;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ went away while being added to home", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    v21 = a1[8];
    v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    (*(v21 + 2))(v21, 0, 0, v22);
  }

  else
  {
    if ([v7 isEqualToString:@"HMSetupCodeProviderReasonBadPassword"])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = a1[4];
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v74 = v11;
        v75 = 2112;
        v76 = v3;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Clearing previous password on bad-password error for accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      v12 = [a1[4] addPendingAccessorySetupCodes];
      [v12 removeObjectForKey:v3];

      v13 = [a1[4] addPendingAccessoryOnboardingSetupPayloadStrings];
      [v13 removeObjectForKey:v3];
    }

    v14 = *MEMORY[0x277CD1FD8];
    v15 = [a1[7] stringForKey:*MEMORY[0x277CD1FD8]];
    if (v15 && [a1[7] isEntitledForSPIAccess])
    {
      if ([a1[6] isEqualToString:@"HMSetupCodeProviderReasonBadPassword"])
      {

LABEL_27:
        v46 = objc_autoreleasePoolPush();
        v47 = a1[4];
        v48 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
        {
          v49 = HMFGetLogIdentifier();
          v50 = [a1[7] stringForKey:v14];
          v51 = [v3 UUIDString];
          *buf = 138544130;
          v74 = v49;
          v75 = 2112;
          v76 = v50;
          v77 = 2112;
          v78 = v5;
          v79 = 2112;
          v80 = v51;
          _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_INFO, "%{public}@Provided password %@ incorrect for accessory %@/%@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v46);
        v52 = a1[8];
        v22 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2002];
        (*(v52 + 2))(v52, 0, 0, v22);
        goto LABEL_17;
      }

      v45 = [a1[6] isEqualToString:@"HMSetupCodeProviderReasontTimeoutRetry"];

      if (v45)
      {
        goto LABEL_27;
      }
    }

    else
    {
    }

    v24 = a1[4];
    os_unfair_recursive_lock_lock_with_options();
    v25 = [a1[8] copy];
    v26 = _Block_copy(v25);
    [*(a1[4] + 113) setObject:v26 forKeyedSubscript:v3];

    os_unfair_recursive_lock_unlock();
    if ([a1[6] isEqualToString:@"HMSetupCodeProviderReasonInitial"])
    {
      v27 = [a1[4] addPendingAccessorySetupCodes];
      v22 = [v27 objectForKey:v3];

      v28 = [a1[4] addPendingAccessoryOnboardingSetupPayloadStrings];
      v29 = [v28 objectForKeyedSubscript:v3];

      v30 = objc_autoreleasePoolPush();
      v31 = a1[4];
      v32 = HMFGetOSLogHandle();
      v33 = os_log_type_enabled(v32, OS_LOG_TYPE_INFO);
      if (v22)
      {
        if (v33)
        {
          v34 = HMFGetLogIdentifier();
          v35 = a1[5];
          *buf = 138543618;
          v74 = v34;
          v75 = 2112;
          v76 = v35;
          _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Providing setupCode for accessory %@ and removing from tracking", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v30);
        (*(a1[8] + 2))();
      }

      else
      {
        if (v33)
        {
          v53 = HMFGetLogIdentifier();
          *buf = 138543874;
          v74 = v53;
          v75 = 2112;
          v76 = v5;
          v77 = 2112;
          v78 = v3;
          _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ prompted for pairing setupCode but did not receive it from HomeUIService", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v30);
        if ([a1[7] BOOLForKey:*MEMORY[0x277CD2010]])
        {
          v54 = objc_autoreleasePoolPush();
          v55 = a1[4];
          v56 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
          {
            v57 = HMFGetLogIdentifier();
            v58 = [v3 UUIDString];
            *buf = 138543874;
            v74 = v57;
            v75 = 2112;
            v76 = v5;
            v77 = 2112;
            v78 = v58;
            _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_INFO, "%{public}@addAccessory request from HomeUIService - waiting for setupCode for accessory %@/%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v54);
        }

        else
        {
          v64 = [v2 accessorySetupManager];
          v65 = [a1[4] uuid];
          v66 = [a1[7] proxyConnection];
          v68[0] = MEMORY[0x277D85DD0];
          v68[1] = 3221225472;
          v68[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_1522;
          v68[3] = &unk_278689358;
          v68[4] = a1[4];
          v70 = a1[8];
          v69 = v3;
          [v64 launchAccessorySetupHostToRequestSetupCodeForAccessoryWithUUID:v69 accessoryName:v5 homeUUID:v65 clientConnection:v66 completionHandler:v68];
        }

        v22 = v29;
      }
    }

    else
    {
      v36 = objc_alloc(MEMORY[0x277D0F820]);
      v37 = [a1[4] uuid];
      v22 = [v36 initWithTarget:v37];

      v38 = objc_alloc(MEMORY[0x277D0F848]);
      v39 = a1[6];
      v71 = *MEMORY[0x277CD2018];
      v72 = v39;
      v40 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v72 forKeys:&v71 count:1];
      v41 = [v38 initWithName:*MEMORY[0x277CCFDB8] qualityOfService:33 destination:v22 payload:v40];

      v42 = [v2 accessorySetupManager];
      v43 = [v42 accessorySetupHostClientConnection];

      if (v43)
      {
        [v41 setTransport:v43];
        v44 = [a1[4] msgDispatcher];
        [v44 sendMessage:v41];
      }

      else
      {
        context = objc_autoreleasePoolPush();
        v59 = a1[4];
        v60 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v60, OS_LOG_TYPE_INFO))
        {
          v61 = HMFGetLogIdentifier();
          v62 = a1[5];
          *buf = 138543618;
          v74 = v61;
          v75 = 2112;
          v76 = v62;
          _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_INFO, "%{public}@No HomeUIService connection for accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(context);
        v63 = a1[8];
        v44 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2002];
        (*(v63 + 2))(v63, 0, 0, v44);
      }
    }
  }

LABEL_17:

  v23 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke_1522(id *a1, void *a2)
{
  v3 = a2;
  if (v3)
  {
    v4 = [a1[4] workQueue];
    v5[0] = MEMORY[0x277D85DD0];
    v5[1] = 3221225472;
    v5[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_2_1523;
    v5[3] = &unk_278689AB8;
    v5[4] = a1[4];
    v6 = v3;
    v8 = a1[6];
    v7 = a1[5];
    dispatch_async(v4, v5);
  }
}

uint64_t __40__HMDHome__setupCodeProviderForMessage___block_invoke_2_1523(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_ERROR))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    *buf = 138543618;
    v16 = v5;
    v17 = 2112;
    v18 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_ERROR, "%{public}@Failed to request setup code for accessory: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = *(a1 + 40);
  (*(*(a1 + 56) + 16))();
  v8 = *(a1 + 32);
  os_unfair_recursive_lock_lock_with_options();
  v9 = [*(*(a1 + 32) + 1192) hm_allKeys];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_1524;
  v13[3] = &unk_27866FE40;
  v14 = *(a1 + 48);
  v10 = [v9 na_firstObjectPassingTest:v13];

  if (v10)
  {
    [*(*(a1 + 32) + 1192) removeObjectForKey:v10];
  }

  [*(*(a1 + 32) + 904) removeObjectForKey:*(a1 + 48)];
  [*(*(a1 + 32) + 912) removeObjectForKey:*(a1 + 48)];
  [*(*(a1 + 32) + 920) removeObjectForKey:*(a1 + 48)];

  result = os_unfair_recursive_lock_unlock();
  v12 = *MEMORY[0x277D85DE8];
  return result;
}

uint64_t __40__HMDHome__setupCodeProviderForMessage___block_invoke_1524(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 accessoryUUID];
  v4 = [v2 isEqual:v3];

  return v4;
}

- (BOOL)hasAnyReachableAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_any:&__block_literal_global_1521];

  return v3;
}

- (void)retrieveStateForTrackedAccessory:(id)accessory stateNumber:(id *)number isReachable:(BOOL *)reachable linkQuality:(unint64_t *)quality lastSeen:(id *)seen
{
  accessoryCopy = accessory;
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  accessoryBrowserHapProtocol = [accessoryBrowser accessoryBrowserHapProtocol];
  [accessoryBrowserHapProtocol retrieveCurrentStateForIdentifier:accessoryCopy stateNumber:number isReachable:reachable linkQuality:quality lastSeen:seen];
}

- (void)getReachableIPAccessories:(unint64_t *)accessories btleAccessories:(unint64_t *)btleAccessories mediaAccessories:(unint64_t *)mediaAccessories
{
  v31 = *MEMORY[0x277D85DE8];
  if (accessories | btleAccessories)
  {
    v28 = 0u;
    v29 = 0u;
    v26 = 0u;
    v27 = 0u;
    obj = [(HMDHome *)self accessories];
    v5 = [obj countByEnumeratingWithState:&v26 objects:v30 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = 0;
      v8 = 0;
      v9 = 0;
      v10 = *v27;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v27 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v26 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v13 = v12;
          }

          else
          {
            v13 = 0;
          }

          v14 = v13;

          if (v14)
          {
            v15 = [v14 matchingHAPAccessoryWithLinkType:1];
            v9 += [v15 isReachable];
            v16 = [v14 matchingHAPAccessoryWithLinkType:2];

            v8 += [v16 isReachable];
          }

          v17 = v12;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v18 = v17;
          }

          else
          {
            v18 = 0;
          }

          v19 = v18;

          isReachable = [v19 isReachable];
          v7 += isReachable;
        }

        v6 = [obj countByEnumeratingWithState:&v26 objects:v30 count:16];
      }

      while (v6);
    }

    else
    {
      v7 = 0;
      v8 = 0;
      v9 = 0;
    }

    if (accessories)
    {
      *accessories = v9;
    }

    if (btleAccessories)
    {
      *btleAccessories = v8;
    }

    if (mediaAccessories)
    {
      *mediaAccessories = v7;
    }
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (int64_t)reachableAppleMediaAccessoriesCount
{
  v18 = *MEMORY[0x277D85DE8];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v14;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(accessories);
        }

        v8 = *(*(&v13 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        if (v10)
        {
          v5 += [v8 isReachable];
        }
      }

      v4 = [accessories countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  v11 = *MEMORY[0x277D85DE8];
  return v5;
}

- (int64_t)reachableAccessoriesCountExcludingMatter
{
  selfCopy = self;
  v41 = *MEMORY[0x277D85DE8];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  accessories = [(HMDHome *)self accessories];
  v4 = [accessories countByEnumeratingWithState:&v30 objects:v40 count:16];
  if (v4)
  {
    v6 = v4;
    v29 = 0;
    v7 = *v31;
    *&v5 = 138543618;
    v26 = v5;
    v27 = accessories;
    v28 = selfCopy;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v31 != v7)
        {
          objc_enumerationMutation(accessories);
        }

        v9 = *(*(&v30 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          if ([v11 isReachable] && (objc_msgSend(v11, "supportsCHIP") & 1) == 0)
          {
            v12 = objc_autoreleasePoolPush();
            v13 = selfCopy;
            v14 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
            {
              v15 = HMFGetLogIdentifier();
              name = [v11 name];
              *buf = v26;
              v35 = v15;
              v36 = 2112;
              v37 = name;
              _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Accessory: %@ is reachable", buf, 0x16u);

              selfCopy = v28;
              accessories = v27;
            }

            objc_autoreleasePoolPop(v12);
            ++v29;
          }

          if ([v11 supportsCHIP])
          {
            v17 = objc_autoreleasePoolPush();
            v18 = selfCopy;
            v19 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
            {
              v20 = HMFGetLogIdentifier();
              name2 = [v11 name];
              isReachable = [v11 isReachable];
              *buf = 138543874;
              v23 = @"NO";
              if (isReachable)
              {
                v23 = @"YES";
              }

              v35 = v20;
              v36 = 2112;
              v37 = name2;
              v38 = 2112;
              v39 = v23;
              _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Ignoring Matter Accessory: %@ isReachable: %@", buf, 0x20u);

              accessories = v27;
              selfCopy = v28;
            }

            objc_autoreleasePoolPop(v17);
          }
        }
      }

      v6 = [accessories countByEnumeratingWithState:&v30 objects:v40 count:16];
    }

    while (v6);
  }

  else
  {
    v29 = 0;
  }

  v24 = *MEMORY[0x277D85DE8];
  return v29;
}

- (int64_t)reachableAccessoriesCount
{
  v21 = *MEMORY[0x277D85DE8];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  obj = [(HMDHome *)self accessories];
  v2 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = 0;
    v5 = *v17;
    do
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v17 != v5)
        {
          objc_enumerationMutation(obj);
        }

        v7 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        v10 = v7;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v9 && [v9 isReachable])
        {
          ++v4;
        }

        else if (v12 && [v12 isCurrentAccessory])
        {
          v4 += [v12 isReachable];
        }
      }

      v3 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v3);
  }

  else
  {
    v4 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];
  return v4;
}

- (void)_reachabilityChangedForAccessory:(id)accessory reachable:(BOOL)reachable
{
  reachableCopy = reachable;
  v68 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  reachableAccessoriesCount = [(HMDHome *)self reachableAccessoriesCount];
  previousReachableAccessoriesCount = [(HMDHome *)self previousReachableAccessoriesCount];
  reachableAppleMediaAccessoriesCount = [(HMDHome *)self reachableAppleMediaAccessoriesCount];
  previousReachableAppleMediaAccessoriesCount = [(HMDHome *)self previousReachableAppleMediaAccessoriesCount];
  [(HMDHome *)self setPreviousReachableAccessoriesCount:reachableAccessoriesCount];
  [(HMDHome *)self setPreviousReachableAppleMediaAccessoriesCount:reachableAppleMediaAccessoriesCount];
  v11 = reachableAppleMediaAccessoriesCount + reachableAccessoriesCount < 1;
  if ((previousReachableAppleMediaAccessoriesCount + previousReachableAccessoriesCount < 0) ^ __OFADD__(previousReachableAppleMediaAccessoriesCount, previousReachableAccessoriesCount) | (previousReachableAppleMediaAccessoriesCount + previousReachableAccessoriesCount == 0))
  {
    v12 = 0;
  }

  else
  {
    v12 = 1;
  }

  v13 = v11 ^ v12;
  if (((v11 ^ v12) & 1) == 0)
  {
    v52 = accessoryCopy;
    v14 = v11 ^ v12;
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138544642;
      v57 = v18;
      v58 = 2048;
      v59 = reachableAccessoriesCount;
      v60 = 2048;
      v61 = reachableAppleMediaAccessoriesCount;
      v62 = 1024;
      v63 = reachableCopy;
      v64 = 2048;
      v65 = previousReachableAccessoriesCount;
      v66 = 2048;
      v67 = previousReachableAppleMediaAccessoriesCount;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Total reachable accessories %ld, apple media accessories: %ld, reachable = %d,                      last known reachable = %ld, last known apple media reachable = %ld", buf, 0x3Au);
    }

    objc_autoreleasePoolPop(v15);
    v13 = v14;
    accessoryCopy = v52;
  }

  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsRemoteAccess = [localCapabilitiesDataSource supportsRemoteAccess];

  if (supportsRemoteAccess)
  {
    v55 = 0;
    [(HMDHome *)self getReachableIPAccessories:&v55 btleAccessories:0 mediaAccessories:0];
    reachableAccessoriesCountExcludingMatter = [(HMDHome *)self reachableAccessoriesCountExcludingMatter];
    previousReachableAccessoriesCountExcludingMatter = [(HMDHome *)self previousReachableAccessoriesCountExcludingMatter];
    [(HMDHome *)self setPreviousReachableAccessoriesCountExcludingMatter:reachableAccessoriesCountExcludingMatter];
    homeLocationHandler = [(HMDHome *)self homeLocationHandler];
    [homeLocationHandler accessoryReachabilityChanged:reachableAccessoriesCountExcludingMatter previousReachableAccessoriesCount:previousReachableAccessoriesCountExcludingMatter reachableAppleMediaAccessoriesCount:reachableAppleMediaAccessoriesCount previousReachableAppleMediaAccessoriesCount:previousReachableAppleMediaAccessoriesCount];

    v24 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      v28 = v27;
      v29 = @"don't ";
      if (reachableAccessoriesCount > 0)
      {
        v29 = &stru_283CF9D50;
      }

      *buf = 138543618;
      v57 = v27;
      v58 = 2112;
      v59 = v29;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Notifying home manager that we %@have locally reachable accessories", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    homeManager = [(HMDHome *)selfCopy2 homeManager];
    uuid = [(HMDHome *)selfCopy2 uuid];
    [homeManager accessoriesAreLocallyReachableOnTransientDevice:reachableAccessoriesCount > 0 forHome:uuid];

    if ([accessoryCopy accessoryReprovisionState] && reachableCopy)
    {
      v54 = v13;
      v32 = objc_autoreleasePoolPush();
      v33 = selfCopy2;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
      {
        v35 = HMFGetLogIdentifier();
        name = [accessoryCopy name];
        *buf = 138543618;
        v57 = v35;
        v58 = 2112;
        v59 = name;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ reprovision state is updated to Not Required", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v32);
      [accessoryCopy setAccessoryReprovisionState:0];
      uuid2 = [accessoryCopy uuid];
      [homeManager updateGenerationCounterWithReason:@"ReprovisionStateChange" sourceUUID:uuid2 shouldNotifyClients:0];

      dictionary = [MEMORY[0x277CBEB38] dictionary];
      uuid3 = [accessoryCopy uuid];
      uUIDString = [uuid3 UUIDString];
      [dictionary setObject:uUIDString forKeyedSubscript:*MEMORY[0x277CCF0B0]];

      [dictionary setObject:&unk_283E71A38 forKeyedSubscript:*MEMORY[0x277CD2008]];
      v41 = MEMORY[0x277D0F848];
      v42 = *MEMORY[0x277CD1FF8];
      messageDestination = [(HMDHome *)v33 messageDestination];
      v44 = [v41 messageWithName:v42 destination:messageDestination payload:dictionary];

      msgDispatcher = [(HMDHome *)v33 msgDispatcher];
      [msgDispatcher sendMessage:v44 completionHandler:0];

      v13 = v54;
    }
  }

  if (reachableAccessoriesCount >= 1 && previousReachableAccessoriesCount <= 0)
  {
    v46 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v48 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
    {
      v49 = HMFGetLogIdentifier();
      *buf = 138543362;
      v57 = v49;
      _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_INFO, "%{public}@Notifying that we see at least one reachable accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v46);
    notificationCenter = [(HMDHome *)selfCopy3 notificationCenter];
    [notificationCenter postNotificationName:@"HMDHomeCurrentDeviceHasReachableAccessories" object:selfCopy3];
  }

  if ((v13 & 1) == 0)
  {
    [(HMFTimer *)self->_homeLocationTimer resume];
  }

  v51 = *MEMORY[0x277D85DE8];
}

- (void)_handleAccessoryReachabilityChange:(id)change
{
  v100 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  v64 = *MEMORY[0x277CD0640];
  v5 = [changeCopy stringForKey:?];
  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];
  v8 = [v5 isEqualToString:uUIDString];

  selfCopy = self;
  v66 = v5;
  if (v8)
  {
    v65 = 0;
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      uuid2 = [(HMDHome *)selfCopy2 uuid];
      uUIDString2 = [uuid2 UUIDString];
      *buf = 138543874;
      v91 = v12;
      v92 = 2112;
      v93 = v5;
      v94 = 2112;
      v95 = uUIDString2;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Home does not match, received: %@, current: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    v65 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  }

  v67 = changeCopy;
  messagePayload = [changeCopy messagePayload];
  v16 = [messagePayload hmf_arrayForKey:*MEMORY[0x277CCE7A8]];

  v86 = 0u;
  v87 = 0u;
  v84 = 0u;
  v85 = 0u;
  obj = v16;
  v17 = selfCopy;
  v70 = [obj countByEnumeratingWithState:&v84 objects:v99 count:16];
  if (v70)
  {
    v69 = *v85;
    do
    {
      v18 = 0;
      do
      {
        if (*v85 != v69)
        {
          objc_enumerationMutation(obj);
        }

        v71 = v18;
        v19 = *(*(&v84 + 1) + 8 * v18);
        v80 = 0u;
        v81 = 0u;
        v82 = 0u;
        v83 = 0u;
        accessories = [(HMDHome *)v17 accessories];
        v79 = [accessories countByEnumeratingWithState:&v80 objects:v98 count:16];
        if (v79)
        {
          v78 = *v81;
          v76 = v19;
          do
          {
            for (i = 0; i != v79; ++i)
            {
              if (*v81 != v78)
              {
                objc_enumerationMutation(accessories);
              }

              v21 = *(*(&v80 + 1) + 8 * i);
              uuid3 = [v21 uuid];
              uUIDString3 = [uuid3 UUIDString];

              v24 = [v19 objectForKeyedSubscript:uUIDString3];
              if (v24)
              {
                v25 = objc_autoreleasePoolPush();
                v26 = v17;
                v27 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
                {
                  v28 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v91 = v28;
                  v92 = 2112;
                  v93 = uUIDString3;
                  v94 = 2112;
                  v95 = v24;
                  _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Setting remote reachability for accessory: %@ to: %@", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v25);
                [v21 setRemotelyReachable:{objc_msgSend(v24, "BOOLValue")}];
              }

              v29 = v21;
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v30 = v29;
              }

              else
              {
                v30 = 0;
              }

              v31 = v30;

              identifier = [v31 identifier];

              if (identifier)
              {
                identifier2 = [v31 identifier];
                v34 = [v19 objectForKeyedSubscript:identifier2];

                if (v34)
                {
                  unsignedIntegerValue = [v34 unsignedIntegerValue];
                  context = objc_autoreleasePoolPush();
                  v36 = v17;
                  v37 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v37, OS_LOG_TYPE_DEBUG))
                  {
                    v38 = HMFGetLogIdentifier();
                    identifier3 = [v29 identifier];
                    [v31 suspendedState];
                    HAPAccessorySuspendedStateDescription();
                    v40 = v73 = uUIDString3;
                    HAPAccessorySuspendedStateDescription();
                    v41 = v74 = unsignedIntegerValue;
                    *buf = 138544130;
                    v91 = v38;
                    v92 = 2112;
                    v93 = identifier3;
                    v94 = 2112;
                    v95 = v40;
                    v96 = 2112;
                    v97 = v41;
                    _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_DEBUG, "%{public}@Handle Reachability change. Setting suspended state of accessory: %@ from '%@' to '%@'", buf, 0x2Au);

                    unsignedIntegerValue = v74;
                    uUIDString3 = v73;

                    v17 = selfCopy;
                  }

                  objc_autoreleasePoolPop(context);
                  [v31 setSuspendedState:unsignedIntegerValue shouldNotify:0 saveToBackingStore:1];
                }

                v19 = v76;
              }
            }

            v79 = [accessories countByEnumeratingWithState:&v80 objects:v98 count:16];
          }

          while (v79);
        }

        v18 = v71 + 1;
      }

      while (v71 + 1 != v70);
      v70 = [obj countByEnumeratingWithState:&v84 objects:v99 count:16];
    }

    while (v70);
  }

  responseHandler = [v67 responseHandler];

  if (responseHandler)
  {
    responseHandler2 = [v67 responseHandler];
    (responseHandler2)[2](responseHandler2, v65, 0);
  }

  remoteSourceDevice = [v67 remoteSourceDevice];
  primaryResident = [(HMDHome *)selfCopy primaryResident];
  device = [primaryResident device];
  if ([remoteSourceDevice isEqual:device])
  {
    currentRemoteReachabilityRegistration = [(HMDHome *)selfCopy currentRemoteReachabilityRegistration];

    if (currentRemoteReachabilityRegistration)
    {
      goto LABEL_42;
    }
  }

  else
  {
  }

  v48 = objc_autoreleasePoolPush();
  v49 = selfCopy;
  v50 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
  {
    v51 = HMFGetLogIdentifier();
    *buf = 138543618;
    v91 = v51;
    v92 = 2112;
    v93 = remoteSourceDevice;
    _os_log_impl(&dword_229538000, v50, OS_LOG_TYPE_INFO, "%{public}@De-registering stale remote reachability for accessories with device = %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v48);
  v52 = objc_alloc(MEMORY[0x277D0F818]);
  allMessageDestinations = [MEMORY[0x277D0F820] allMessageDestinations];
  v88 = v64;
  uuid4 = [(HMDHome *)v49 uuid];
  uUIDString4 = [uuid4 UUIDString];
  v89 = uUIDString4;
  v56 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v89 forKeys:&v88 count:1];
  v57 = [v52 initWithName:@"kDisableAccessoryReachabilityNotificationRequestKey" destination:allMessageDestinations payload:v56];

  homeManager = [(HMDHome *)v49 homeManager];
  messageDispatcher = [homeManager messageDispatcher];
  uuid5 = [(HMDHome *)v49 uuid];
  remoteDestinationString = [remoteSourceDevice remoteDestinationString];
  workQueue = [(HMDHome *)v49 workQueue];
  [messageDispatcher sendSecureMessage:v57 target:uuid5 userID:0 destination:remoteDestinationString responseQueue:workQueue responseHandler:0];

LABEL_42:
  v63 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoteReachabilityNotificationTimerFired
{
  v82 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v4 = objc_autoreleasePoolPush();
  selfCopy = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    remoteReachabilityNotificationPendingAccessories = [(HMDHome *)selfCopy remoteReachabilityNotificationPendingAccessories];
    *buf = 138543618;
    v75 = v7;
    v76 = 2112;
    v77 = remoteReachabilityNotificationPendingAccessories;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Reachability notification timer fired, pending list: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v70 = 0u;
  v71 = 0u;
  v68 = 0u;
  v69 = 0u;
  obj = [(HMDHome *)selfCopy reachabilityRegisteredDevices];
  v58 = [obj countByEnumeratingWithState:&v68 objects:v81 count:16];
  if (v58)
  {
    v57 = *v69;
    v55 = *MEMORY[0x277CD0640];
    v56 = *MEMORY[0x277CCE7A8];
    *&v9 = 138543874;
    v53 = v9;
    v10 = 0x277CCA000uLL;
    v62 = selfCopy;
    do
    {
      v11 = 0;
      do
      {
        if (*v69 != v57)
        {
          objc_enumerationMutation(obj);
        }

        v59 = *(*(&v68 + 1) + 8 * v11);
        v60 = v11;
        v12 = MEMORY[0x277CBEB18];
        remoteReachabilityNotificationPendingAccessories2 = [(HMDHome *)selfCopy remoteReachabilityNotificationPendingAccessories];
        v63 = [v12 arrayWithCapacity:{objc_msgSend(remoteReachabilityNotificationPendingAccessories2, "count")}];

        v66 = 0u;
        v67 = 0u;
        v64 = 0u;
        v65 = 0u;
        accessories = [(HMDHome *)selfCopy accessories];
        v14 = [accessories countByEnumeratingWithState:&v64 objects:v80 count:16];
        if (v14)
        {
          v15 = v14;
          v16 = *v65;
          do
          {
            for (i = 0; i != v15; ++i)
            {
              if (*v65 != v16)
              {
                objc_enumerationMutation(accessories);
              }

              v18 = *(*(&v64 + 1) + 8 * i);
              uuid = [v18 uuid];
              uUIDString = [uuid UUIDString];
              v21 = [(HMDHome *)selfCopy _getReachabilityTupleForAccessoryUUID:uUIDString];

              if (v21)
              {
                v22 = MEMORY[0x277CBEB38];
                v23 = [*(v10 + 2992) numberWithBool:{objc_msgSend(v21, "currentReachability")}];
                accessoryUUID = [v21 accessoryUUID];
                v25 = [v22 dictionaryWithObject:v23 forKey:accessoryUUID];

                v26 = v18;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v27 = v26;
                }

                else
                {
                  v27 = 0;
                }

                v28 = v27;

                identifier = [v28 identifier];

                if (identifier)
                {
                  v30 = [*(v10 + 2992) numberWithUnsignedInteger:{objc_msgSend(v28, "suspendedState")}];
                  identifier2 = [v28 identifier];
                  [v25 setObject:v30 forKey:identifier2];
                }

                [v63 addObject:v25];

                selfCopy = v62;
              }
            }

            v15 = [accessories countByEnumeratingWithState:&v64 objects:v80 count:16];
          }

          while (v15);
        }

        if ([v63 count])
        {
          v32 = v10;
          v33 = objc_autoreleasePoolPush();
          v34 = selfCopy;
          v35 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
          {
            v36 = HMFGetLogIdentifier();
            v37 = [v63 count];
            device = [v59 device];
            remoteDestinationString = [device remoteDestinationString];
            *buf = v53;
            v75 = v36;
            v76 = 2048;
            v77 = v37;
            v78 = 2112;
            v79 = remoteDestinationString;
            _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Sending current reachability for %tu accessories to destination:%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v33);
          v72[0] = v56;
          v40 = [v63 copy];
          v72[1] = v55;
          v73[0] = v40;
          uuid2 = [(HMDHome *)v34 uuid];
          uUIDString2 = [uuid2 UUIDString];
          v73[1] = uUIDString2;
          v43 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v73 forKeys:v72 count:2];

          v44 = [MEMORY[0x277D0F818] messageWithName:@"kRemoteReachabilityChangedNotificationKey" identifier:0 messagePayload:v43];
          homeManager = [(HMDHome *)v34 homeManager];
          messageDispatcher = [homeManager messageDispatcher];
          uuid3 = [(HMDHome *)v34 uuid];
          device2 = [v59 device];
          remoteDestinationString2 = [device2 remoteDestinationString];
          workQueue2 = [(HMDHome *)v34 workQueue];
          [messageDispatcher sendSecureMessage:v44 target:uuid3 userID:0 destination:remoteDestinationString2 responseQueue:workQueue2 responseHandler:0];

          selfCopy = v62;
          v10 = v32;
        }

        v11 = v60 + 1;
      }

      while (v60 + 1 != v58);
      v58 = [obj countByEnumeratingWithState:&v68 objects:v81 count:16];
    }

    while (v58);
  }

  remoteReachabilityNotificationPendingAccessories3 = [(HMDHome *)selfCopy remoteReachabilityNotificationPendingAccessories];
  [remoteReachabilityNotificationPendingAccessories3 removeAllObjects];

  [(HMDHome *)selfCopy setReachabilityNotificationTimer:0];
  v52 = *MEMORY[0x277D85DE8];
}

- (void)_updateReachabilityChangeToRegisteredDevices:(id)devices
{
  v40 = *MEMORY[0x277D85DE8];
  devicesCopy = devices;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  uuid = [devicesCopy uuid];
  uUIDString = [uuid UUIDString];

  v8 = [(HMDHome *)self _getReachabilityTupleForAccessoryUUID:uUIDString];
  isReachable = [devicesCopy isReachable];
  v10 = devicesCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v10;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;

  if (v12)
  {
    [v8 setPreviouslySentSuspendedState:{objc_msgSend(v8, "currentSuspendedState")}];
    [v8 setCurrentSuspendedState:{objc_msgSend(v12, "suspendedState")}];
  }

  if (!v8)
  {
    remoteReachabilityNotificationPendingAccessories2 = [HMDAccessoryReachabilityTuple tupleWithAccessoryUUID:uUIDString reachable:isReachable];
    [remoteReachabilityNotificationPendingAccessories2 setCurrentSuspendedState:{objc_msgSend(v12, "suspendedState")}];
    remoteReachabilityNotificationPendingAccessories = [(HMDHome *)self remoteReachabilityNotificationPendingAccessories];
    [remoteReachabilityNotificationPendingAccessories addObject:remoteReachabilityNotificationPendingAccessories2];

    reachabilityNotificationTimer = [(HMDHome *)self reachabilityNotificationTimer];

    if (!reachabilityNotificationTimer)
    {
      v23 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:1 options:*&remoteReachabilityNotificationsDeferPeriod];
      [(HMDHome *)self setReachabilityNotificationTimer:v23];

      workQueue2 = [(HMDHome *)self workQueue];
      reachabilityNotificationTimer2 = [(HMDHome *)self reachabilityNotificationTimer];
      [reachabilityNotificationTimer2 setDelegateQueue:workQueue2];

      reachabilityNotificationTimer3 = [(HMDHome *)self reachabilityNotificationTimer];
      [reachabilityNotificationTimer3 setDelegate:self];

      reachabilityNotificationTimer4 = [(HMDHome *)self reachabilityNotificationTimer];
      [reachabilityNotificationTimer4 resume];

      v28 = objc_autoreleasePoolPush();
      selfCopy = self;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
      {
        v31 = HMFGetLogIdentifier();
        reachabilityNotificationTimer5 = [(HMDHome *)selfCopy reachabilityNotificationTimer];
        v34 = 138543874;
        v35 = v31;
        v36 = 2048;
        v37 = reachabilityNotificationTimer5;
        v38 = 2048;
        v39 = remoteReachabilityNotificationsDeferPeriod;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Started reachability notification defer timer %p for %f sec", &v34, 0x20u);
      }

      objc_autoreleasePoolPop(v28);
    }

    goto LABEL_16;
  }

  [v8 setCurrentReachability:isReachable];
  previouslySentReachability = [v8 previouslySentReachability];
  if (previouslySentReachability == [v8 currentReachability])
  {
    previouslySentSuspendedState = [v8 previouslySentSuspendedState];
    if (previouslySentSuspendedState == [v8 currentSuspendedState])
    {
      v15 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v19 = HMFBooleanToString();
        v34 = 138543874;
        v35 = v18;
        v36 = 2112;
        v37 = v10;
        v38 = 2112;
        v39 = v19;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ toggled reachability back to %@ ignoring", &v34, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
      remoteReachabilityNotificationPendingAccessories2 = [(HMDHome *)selfCopy2 remoteReachabilityNotificationPendingAccessories];
      [remoteReachabilityNotificationPendingAccessories2 removeObject:v8];
LABEL_16:
    }
  }

  v33 = *MEMORY[0x277D85DE8];
}

- (id)_getReachabilityTupleForAccessoryUUID:(id)d
{
  v20 = *MEMORY[0x277D85DE8];
  dCopy = d;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v17 = 0u;
  v18 = 0u;
  v15 = 0u;
  v16 = 0u;
  remoteReachabilityNotificationPendingAccessories = [(HMDHome *)self remoteReachabilityNotificationPendingAccessories];
  v7 = [remoteReachabilityNotificationPendingAccessories countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v7)
  {
    v8 = *v16;
    while (2)
    {
      for (i = 0; i != v7; i = i + 1)
      {
        if (*v16 != v8)
        {
          objc_enumerationMutation(remoteReachabilityNotificationPendingAccessories);
        }

        v10 = *(*(&v15 + 1) + 8 * i);
        accessoryUUID = [v10 accessoryUUID];
        v12 = [accessoryUUID isEqual:dCopy];

        if (v12)
        {
          v7 = v10;
          goto LABEL_11;
        }
      }

      v7 = [remoteReachabilityNotificationPendingAccessories countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v7;
}

- (void)_deregisterDeviceForReachabilityNotification:(id)notification
{
  v30 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v27 = v9;
    v28 = 2112;
    v29 = notificationCopy;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@De-registering device %@ for reachability notification", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v23 = 0u;
  v24 = 0u;
  v21 = 0u;
  v22 = 0u;
  reachabilityRegisteredDevices = [(HMDHome *)selfCopy reachabilityRegisteredDevices];
  v11 = [reachabilityRegisteredDevices copy];

  v12 = [v11 countByEnumeratingWithState:&v21 objects:v25 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v22;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v22 != v14)
        {
          objc_enumerationMutation(v11);
        }

        v16 = *(*(&v21 + 1) + 8 * i);
        device = [v16 device];
        v18 = [device isEqual:notificationCopy];

        if (v18)
        {
          reachabilityRegisteredDevices2 = [(HMDHome *)selfCopy reachabilityRegisteredDevices];
          [reachabilityRegisteredDevices2 removeObject:v16];
        }
      }

      v13 = [v11 countByEnumeratingWithState:&v21 objects:v25 count:16];
    }

    while (v13);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_registerDeviceForReachabilityNotification:(id)notification accessoryList:(id)list
{
  v20 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  listCopy = list;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)self _deregisterDeviceForReachabilityNotification:notificationCopy];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v12;
    v18 = 2112;
    v19 = notificationCopy;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Registering device %@ for reachability notification", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v13 = [[HMDDeviceRegistrationEntry alloc] initWithDevice:notificationCopy accessoryList:listCopy];
  if (v13)
  {
    reachabilityRegisteredDevices = [(HMDHome *)selfCopy reachabilityRegisteredDevices];
    [reachabilityRegisteredDevices addObject:v13];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)resetAccessoryHashedRouteIdentifiers
{
  v13 = *MEMORY[0x277D85DE8];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v9;
    do
    {
      v6 = 0;
      do
      {
        if (*v9 != v5)
        {
          objc_enumerationMutation(accessories);
        }

        [*(*(&v8 + 1) + 8 * v6++) resetHashedRoute];
      }

      while (v4 != v6);
      v4 = [accessories countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v4);
  }

  v7 = *MEMORY[0x277D85DE8];
}

- (void)btleAccessoryReachabilityProbeTimer:(BOOL)timer
{
  workQueue = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __47__HMDHome_btleAccessoryReachabilityProbeTimer___block_invoke;
  v6[3] = &unk_278688650;
  v6[4] = self;
  timerCopy = timer;
  dispatch_async(workQueue, v6);
}

void __47__HMDHome_btleAccessoryReachabilityProbeTimer___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) accessoryBrowser];
  [v2 btleAccessoryReachabilityProbeTimer:*(a1 + 40)];
}

- (BOOL)evaluatePredicate:(id)predicate
{
  v27[1] = *MEMORY[0x277D85DE8];
  predicateCopy = predicate;
  predicateUtility = [(HMDHome *)self predicateUtility];
  v6 = [predicateUtility rewritePredicate:predicateCopy currentCharacteristicInPredicate:0 characteristicsToRead:0 homePresence:0];

  v26 = @"THIS_OBJECT";
  predicateUtility2 = [(HMDHome *)self predicateUtility];
  v27[0] = predicateUtility2;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];

  [v6 allowEvaluation];
  predicateUtility3 = [(HMDHome *)self predicateUtility];
  v10 = [v6 evaluateWithObject:predicateUtility3 substitutionVariables:v8];

  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = HMFBooleanToString();
    v18 = 138544130;
    v19 = v14;
    v20 = 2112;
    v21 = predicateCopy;
    v22 = 2112;
    v23 = v6;
    v24 = 2112;
    v25 = v15;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Evaluating predicate %@ (rewritten %@) with result %@", &v18, 0x2Au);
  }

  objc_autoreleasePoolPop(v11);
  v16 = *MEMORY[0x277D85DE8];
  return v10;
}

- (void)handleEvaluatePredicateMessage:(id)message
{
  v38[1] = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = [messageCopy predicateForKey:*MEMORY[0x277CD24A8]];
  v6 = [messageCopy stringForKey:*MEMORY[0x277CD2660]];
  v7 = v6;
  if (v5)
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (v8)
  {
    responseHandler = [messageCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [messageCopy responseHandler];
      v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      (responseHandler2)[2](responseHandler2, v11, 0);
    }
  }

  else
  {
    v31 = v5;
    v12 = [(HMDHome *)self evaluatePredicate:v5];
    responseHandler3 = [messageCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler4 = [messageCopy responseHandler];
      v37 = *MEMORY[0x277CD24B8];
      v15 = [MEMORY[0x277CCABB0] numberWithBool:v12];
      v38[0] = v15;
      v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:&v37 count:1];
      (responseHandler4)[2](responseHandler4, 0, v16);
    }

    v17 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v7];
    v32 = 0u;
    v33 = 0u;
    v34 = 0u;
    v35 = 0u;
    accessories = [(HMDHome *)self accessories];
    v19 = [accessories countByEnumeratingWithState:&v32 objects:v36 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v33;
      while (2)
      {
        for (i = 0; i != v20; ++i)
        {
          if (*v33 != v21)
          {
            objc_enumerationMutation(accessories);
          }

          v23 = *(*(&v32 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          v26 = [v25 serviceWithUUID:v17];
          if (v26)
          {
            v27 = v26;
            remoteSourceDevice = [messageCopy remoteSourceDevice];
            remoteDestinationString = [remoteSourceDevice remoteDestinationString];
            [v27 updatePresenceRequestTimeForDeviceWithDestination:remoteDestinationString];

            goto LABEL_23;
          }
        }

        v20 = [accessories countByEnumeratingWithState:&v32 objects:v36 count:16];
        if (v20)
        {
          continue;
        }

        break;
      }
    }

LABEL_23:

    v5 = v31;
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)dispatchRequestToEvaluateCondition:(id)condition forCharacteristics:(id)characteristics completion:(id)completion
{
  v63 = *MEMORY[0x277D85DE8];
  conditionCopy = condition;
  characteristicsCopy = characteristics;
  completionCopy = completion;
  if (completionCopy && [characteristicsCopy count])
  {
    primaryResident = [(HMDHome *)self primaryResident];
    isCurrentDevice = [primaryResident isCurrentDevice];

    if (isCurrentDevice)
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543362;
        v60 = v16;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Current device is the resident device itself, evaluating locally.", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
      if ([(HMDHome *)selfCopy evaluatePredicate:conditionCopy])
      {
        completionCopy[2](completionCopy, 0, characteristicsCopy);
      }
    }

    else
    {
      primaryResident2 = [(HMDHome *)self primaryResident];
      device = [primaryResident2 device];

      primaryResident3 = [(HMDHome *)self primaryResident];
      supportsSharedEventTriggerActivation = [primaryResident3 supportsSharedEventTriggerActivation];

      if (supportsSharedEventTriggerActivation)
      {
        v20 = MEMORY[0x277CCACA8];
        logIdentifier = [(HMDHome *)self logIdentifier];
        v48 = [v20 stringWithFormat:@"Bulletin-%@", logIdentifier];

        v45 = [[HMDPredicateUtilities alloc] initWithHome:self logIdentifier:v48];
        v47 = [(HMDPredicateUtilities *)v45 rewritePredicateForDaemon:conditionCopy message:0];
        v57[0] = *MEMORY[0x277CD24A8];
        v22 = encodeRootObject();
        v58[0] = v22;
        v57[1] = *MEMORY[0x277CD2660];
        firstObject = [characteristicsCopy firstObject];
        service = [firstObject service];
        uuid = [service uuid];
        uUIDString = [uuid UUIDString];
        v58[1] = uUIDString;
        v46 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v58 forKeys:v57 count:2];

        v27 = [HMDRemoteDeviceMessageDestination alloc];
        uuid2 = [(HMDHome *)self uuid];
        v29 = [(HMDRemoteDeviceMessageDestination *)v27 initWithTarget:uuid2 device:device];

        v30 = [HMDRemoteMessage secureMessageWithName:*MEMORY[0x277CD24B0] destination:v29 messagePayload:v46];
        identifier = [v30 identifier];
        objc_initWeak(&location, self);
        v50[0] = MEMORY[0x277D85DD0];
        v50[1] = 3221225472;
        v50[2] = __76__HMDHome_dispatchRequestToEvaluateCondition_forCharacteristics_completion___block_invoke;
        v50[3] = &unk_278670ED0;
        objc_copyWeak(&v55, &location);
        v32 = identifier;
        v51 = v32;
        v52 = conditionCopy;
        v53 = characteristicsCopy;
        v54 = completionCopy;
        [v30 setResponseHandler:v50];
        v33 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v35 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
        {
          v36 = HMFGetLogIdentifier();
          *buf = 138543618;
          v60 = v36;
          v61 = 2114;
          v62 = v32;
          _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Sending message with identifier %{public}@ to evaluate bulletin condition to resident", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v33);
        homeManager = [(HMDHome *)selfCopy2 homeManager];
        messageDispatcher = [homeManager messageDispatcher];

        [messageDispatcher sendMessage:v30 completionHandler:0];
        objc_destroyWeak(&v55);
        objc_destroyWeak(&location);
      }

      else
      {
        v39 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          primaryResident4 = [(HMDHome *)selfCopy3 primaryResident];
          *buf = 138543618;
          v60 = v42;
          v61 = 2112;
          v62 = primaryResident4;
          _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Remote access device %@ is not capable of presence status. Directly send the notification.", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v39);
        completionCopy[2](completionCopy, 0, characteristicsCopy);
      }
    }
  }

  v44 = *MEMORY[0x277D85DE8];
}

void __76__HMDHome_dispatchRequestToEvaluateCondition_forCharacteristics_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    v13 = *(a1 + 40);
    v14 = *(a1 + 48);
    *buf = 138544386;
    v26 = v11;
    v27 = 2112;
    v28 = v12;
    v29 = 2112;
    v30 = v13;
    v31 = 2112;
    v32 = v14;
    v33 = 2112;
    v34 = v5;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Message with identifier %@ to evaluate condition %@ for characteristics %@ has been sent with error %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v8);
  if (v5)
  {
    goto LABEL_7;
  }

  v15 = [v6 hmf_BOOLForKey:*MEMORY[0x277CD24B8]];
  v16 = objc_autoreleasePoolPush();
  v17 = v9;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    v20 = *(a1 + 40);
    HMFBooleanToString();
    v21 = v24 = v15;
    *buf = 138543874;
    v26 = v19;
    v27 = 2112;
    v28 = v20;
    v29 = 2112;
    v30 = v21;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Resident evaluate predicate %@ to %@.", buf, 0x20u);

    v15 = v24;
  }

  objc_autoreleasePoolPop(v16);
  if (v15)
  {
LABEL_7:
    v22 = *(a1 + 48);
    (*(*(a1 + 56) + 16))();
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)evaluateNotificationConditionForCharacteristics:(id)characteristics homePresence:(id)presence completion:(id)completion
{
  v91 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  presenceCopy = presence;
  completionCopy = completion;
  if (completionCopy)
  {
    if ([(HMDHome *)self bulletinNotificationsSupported])
    {
      v63 = completionCopy;
      v65 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(characteristicsCopy, "count")}];
      v67 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(characteristicsCopy, "count")}];
      v77 = 0u;
      v78 = 0u;
      v79 = 0u;
      v80 = 0u;
      v64 = characteristicsCopy;
      obj = characteristicsCopy;
      v11 = [obj countByEnumeratingWithState:&v77 objects:v90 count:16];
      v66 = presenceCopy;
      selfCopy = self;
      if (v11)
      {
        v12 = v11;
        v13 = *v78;
        v69 = *v78;
        do
        {
          v14 = 0;
          v70 = v12;
          do
          {
            if (*v78 != v13)
            {
              objc_enumerationMutation(obj);
            }

            v15 = *(*(&v77 + 1) + 8 * v14);
            service = [v15 service];
            bulletinBoardNotification = [service bulletinBoardNotification];
            isEnabled = [bulletinBoardNotification isEnabled];

            if (isEnabled)
            {
              v19 = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v21 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
              {
                v22 = HMFGetLogIdentifier();
                shortDescription = [v15 shortDescription];
                *buf = 138543618;
                v83 = v22;
                v84 = 2112;
                v85 = shortDescription;
                _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Notification is enabled for characteristic: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v19);
              bulletinBoardNotification2 = [service bulletinBoardNotification];
              condition = [bulletinBoardNotification2 condition];

              if (condition)
              {
                predicateUtility = [(HMDHome *)selfCopy2 predicateUtility];
                v27 = [predicateUtility containsPresenceEvents:condition];
                if (presenceCopy || (v27 & 1) == 0)
                {
                  array = [predicateUtility rewritePredicate:condition currentCharacteristicInPredicate:0 characteristicsToRead:0 homePresence:presenceCopy];
                  v88 = @"THIS_OBJECT";
                  v89 = predicateUtility;
                  v39 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v89 forKeys:&v88 count:1];
                  [array allowEvaluation];
                  v40 = [array evaluateWithObject:predicateUtility substitutionVariables:v39];
                  context = objc_autoreleasePoolPush();
                  v41 = selfCopy2;
                  v42 = HMFGetOSLogHandle();
                  v43 = os_log_type_enabled(v42, OS_LOG_TYPE_INFO);
                  if (v40)
                  {
                    if (v43)
                    {
                      v44 = HMFGetLogIdentifier();
                      *buf = 138543874;
                      v83 = v44;
                      v84 = 2112;
                      v85 = condition;
                      v86 = 2112;
                      v87 = v15;
                      _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_INFO, "%{public}@Condition %@ for characteristic (%@) evaluates to true, posting bulletin for it.", buf, 0x20u);
                    }

                    objc_autoreleasePoolPop(context);
                    [v67 addObject:v15];
                  }

                  else
                  {
                    if (v43)
                    {
                      v45 = HMFGetLogIdentifier();
                      *buf = 138543874;
                      v83 = v45;
                      v84 = 2112;
                      v85 = condition;
                      v86 = 2112;
                      v87 = v15;
                      _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_INFO, "%{public}@Condition %@ for characteristic (%@) evaluates to false, not posting bulletin for it.", buf, 0x20u);
                    }

                    objc_autoreleasePoolPop(context);
                  }

                  presenceCopy = v66;
                }

                else
                {
                  v28 = objc_autoreleasePoolPush();
                  v29 = selfCopy2;
                  v30 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
                  {
                    v31 = HMFGetLogIdentifier();
                    *buf = 138543874;
                    v83 = v31;
                    v84 = 2112;
                    v85 = condition;
                    v86 = 2112;
                    v87 = v15;
                    _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Condition %@ contains presence and no homePresence presents, delaying bulletin for characteristic %@", buf, 0x20u);

                    presenceCopy = v66;
                  }

                  objc_autoreleasePoolPop(v28);
                  uuid = [service uuid];
                  array = [v65 objectForKeyedSubscript:uuid];

                  if (!array)
                  {
                    array = [MEMORY[0x277CBEB18] array];
                    uuid2 = [service uuid];
                    [v65 setObject:array forKeyedSubscript:uuid2];
                  }

                  [array addObject:v15];
                }

                v13 = v69;

                self = selfCopy;
              }

              else
              {
                v35 = objc_autoreleasePoolPush();
                v36 = selfCopy2;
                v37 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
                {
                  v38 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v83 = v38;
                  v84 = 2112;
                  v85 = v15;
                  _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_INFO, "%{public}@No condition is present in chr (%@)", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v35);
                [v67 addObject:v15];
                v13 = v69;
              }

              v12 = v70;
            }

            ++v14;
          }

          while (v12 != v14);
          v12 = [obj countByEnumeratingWithState:&v77 objects:v90 count:16];
        }

        while (v12);
      }

      v46 = v67;
      completionCopy = v63;
      if ([v67 count])
      {
        (*(v63 + 2))(v63, 0, v67);
      }

      v47 = v65;
      if ([v65 count])
      {
        v75 = 0u;
        v76 = 0u;
        v73 = 0u;
        v74 = 0u;
        allValues = [v65 allValues];
        v49 = [allValues countByEnumeratingWithState:&v73 objects:v81 count:16];
        if (v49)
        {
          v50 = v49;
          v51 = *v74;
          do
          {
            for (i = 0; i != v50; ++i)
            {
              if (*v74 != v51)
              {
                objc_enumerationMutation(allValues);
              }

              v53 = *(*(&v73 + 1) + 8 * i);
              firstObject = [v53 firstObject];
              service2 = [firstObject service];
              bulletinBoardNotification3 = [service2 bulletinBoardNotification];
              condition2 = [bulletinBoardNotification3 condition];
              [(HMDHome *)selfCopy dispatchRequestToEvaluateCondition:condition2 forCharacteristics:v53 completion:v63];
            }

            v50 = [allValues countByEnumeratingWithState:&v73 objects:v81 count:16];
          }

          while (v50);
        }

        v47 = v65;
        presenceCopy = v66;
        v46 = v67;
      }

      characteristicsCopy = v64;
    }

    else
    {
      v58 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v60 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v60, OS_LOG_TYPE_DEBUG))
      {
        v61 = HMFGetLogIdentifier();
        *buf = 138543618;
        v83 = v61;
        v84 = 2112;
        v85 = characteristicsCopy;
        _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_DEBUG, "%{public}@Bulletin notifications are not supported, skipping evaluating bulletin for characteristics: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v58);
      (*(completionCopy + 2))(completionCopy, 0, MEMORY[0x277CBEBF8]);
    }
  }

  v62 = *MEMORY[0x277D85DE8];
}

- (void)reevaluateAccessoryInfo
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v11 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Re-evaluating accessory info", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  workQueue = [(HMDHome *)selfCopy workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __34__HMDHome_reevaluateAccessoryInfo__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = selfCopy;
  dispatch_async(workQueue, block);

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_reevaluateAccessoryInfoWithBadgeRefresh:(BOOL)refresh
{
  refreshCopy = refresh;
  v22 = *MEMORY[0x277D85DE8];
  isOwnerUser = [(HMDHome *)self isOwnerUser];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = HMFBooleanToString();
    v11 = HMFBooleanToString();
    v16 = 138543874;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Re-evaluating accessory info with shouldRefreshBadge: %@, isOwnerUser: %@, ", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v6);
  if (isOwnerUser)
  {
    v12 = +[HMDBulletinBoard sharedBulletinBoard];
    v13 = [v12 updateBulletinForFirmwareUpdateInHome:selfCopy];
  }

  if (refreshCopy)
  {
    v14 = +[HMDBulletinBoard sharedBulletinBoard];
    [v14 refreshHomeBadgeNumber];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)sendFirmwareUpdateUINotification:(id)notification
{
  v21 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  isOwnerUser = [(HMDHome *)self isOwnerUser];
  isSharedAdmin = [(HMDHome *)self isSharedAdmin];
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = HMFBooleanToString();
    v12 = HMFBooleanToString();
    v15 = 138543874;
    v16 = v10;
    v17 = 2112;
    v18 = v11;
    v19 = 2112;
    v20 = v12;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Firmware update UI notification is issued, isOwnerUser: %@, isSharedAdminUser:%@ ", &v15, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  if (isOwnerUser || isSharedAdmin)
  {
    v13 = +[HMDBulletinBoard sharedBulletinBoard];
    [v13 insertBulletinsForMatterFirmwareUpdateInstalledInHome:selfCopy hmdHAPAccessory:notificationCopy];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)accessories shouldRefreshBadge:(BOOL)badge withCompletion:(id)completion
{
  badgeCopy = badge;
  v84 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  completionCopy = completion;
  if ([accessoriesCopy count])
  {
    selfCopy = self;
    v65 = badgeCopy;
    v66 = completionCopy;
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    dictionary2 = [MEMORY[0x277CBEB38] dictionary];
    v73 = 0u;
    v74 = 0u;
    v75 = 0u;
    v76 = 0u;
    v67 = accessoriesCopy;
    obj = accessoriesCopy;
    v10 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
    v62 = v10;
    v11 = 0;
    if (!v10)
    {
      goto LABEL_36;
    }

    v71 = *v74;
    v72 = v10;
    while (1)
    {
      for (i = 0; i != v72; ++i)
      {
        if (*v74 != v71)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v73 + 1) + 8 * i);
        vendorInfo = [v13 vendorInfo];
        firmwareVersion = [v13 firmwareVersion];
        if (firmwareVersion)
        {
          firmwareVersion2 = [vendorInfo firmwareVersion];
          firmwareVersion3 = [v13 firmwareVersion];
          v18 = [firmwareVersion2 isGreaterThanVersion:firmwareVersion3];
        }

        else
        {
          v18 = 0;
        }

        dictionary3 = [MEMORY[0x277CBEB38] dictionary];
        dictionary4 = [MEMORY[0x277CBEB38] dictionary];
        appBundleID = [vendorInfo appBundleID];

        if (appBundleID)
        {
          appBundleID2 = [vendorInfo appBundleID];
          [dictionary4 setObject:appBundleID2 forKeyedSubscript:@"kAccessoryVendorInfoBundleIDKey"];

          v11 = 1;
        }

        appStoreID = [vendorInfo appStoreID];

        if (appStoreID)
        {
          appStoreID2 = [vendorInfo appStoreID];
          [dictionary4 setObject:appStoreID2 forKeyedSubscript:@"kAccessoryVendorInfoStoreIDKey"];

          v11 = 1;
        }

        v25 = [MEMORY[0x277CCABB0] numberWithBool:v18];
        [dictionary4 setObject:v25 forKeyedSubscript:@"kAccessoryVendorInfoFirmwareUpdateAvailableKey"];

        serialNumber = [v13 serialNumber];

        if (serialNumber)
        {
          serialNumber2 = [v13 serialNumber];
          [dictionary4 setObject:serialNumber2 forKeyedSubscript:@"kAccessoryInfoSerialNumberKey"];

          v11 = 1;
        }

        manufacturer = [v13 manufacturer];

        if (manufacturer)
        {
          manufacturer2 = [v13 manufacturer];
          [dictionary3 setObject:manufacturer2 forKeyedSubscript:@"kAccessoryInfoManufacturerKey"];

          manufacturer3 = [v13 manufacturer];
          [dictionary4 setObject:manufacturer3 forKeyedSubscript:@"kAccessoryInfoManufacturerKey"];
        }

        model = [v13 model];

        if (model)
        {
          model2 = [v13 model];
          [dictionary3 setObject:model2 forKeyedSubscript:@"kAccessoryInfoModelKey"];

          model3 = [v13 model];
          [dictionary4 setObject:model3 forKeyedSubscript:@"kAccessoryInfoModelKey"];
        }

        v34 = v13;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v35 = v34;
        }

        else
        {
          v35 = 0;
        }

        v36 = v35;

        if (v36 && [v36 supportsCHIP])
        {
          displayableFirmwareVersion = [v34 displayableFirmwareVersion];

          if (!displayableFirmwareVersion)
          {
            goto LABEL_30;
          }

          displayableFirmwareVersion2 = [v34 displayableFirmwareVersion];
          [dictionary3 setObject:displayableFirmwareVersion2 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];

          displayableFirmwareVersion3 = [v34 displayableFirmwareVersion];
          [dictionary4 setObject:displayableFirmwareVersion3 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];
        }

        else
        {
          firmwareVersion4 = [v34 firmwareVersion];

          if (!firmwareVersion4)
          {
            goto LABEL_30;
          }

          firmwareVersion5 = [v34 firmwareVersion];
          shortVersionString = [firmwareVersion5 shortVersionString];
          [dictionary3 setObject:shortVersionString forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];

          displayableFirmwareVersion3 = [v34 firmwareVersion];
          shortVersionString2 = [displayableFirmwareVersion3 shortVersionString];
          [dictionary4 setObject:shortVersionString2 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];
        }

LABEL_30:
        if ([dictionary4 count])
        {
          uuid = [v34 uuid];
          uUIDString = [uuid UUIDString];
          [dictionary2 setObject:dictionary4 forKeyedSubscript:uUIDString];
        }

        if ([dictionary3 count])
        {
          uuid2 = [v34 uuid];
          uUIDString2 = [uuid2 UUIDString];
          [dictionary setObject:dictionary3 forKeyedSubscript:uUIDString2];
        }
      }

      v72 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
      if (!v72)
      {
LABEL_36:

        v48 = objc_autoreleasePoolPush();
        v49 = selfCopy;
        v50 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
        {
          v51 = HMFGetLogIdentifier();
          *buf = 138543874;
          v78 = v51;
          v79 = 2112;
          v80 = dictionary;
          v81 = 2112;
          v82 = dictionary2;
          _os_log_impl(&dword_229538000, v50, OS_LOG_TYPE_INFO, "%{public}@Notify clients that vendor info has updated: %@  entitledInfo %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v48);
        v52 = dictionary;
        v53 = [dictionary count];
        v54 = MEMORY[0x277CD1F98];
        if (v53)
        {
          v55 = [MEMORY[0x277D0F818] messageWithName:*MEMORY[0x277CD1F98] messagePayload:dictionary];
          msgDispatcher = [(HMDHome *)v49 msgDispatcher];
          messageTargetUUID = [(HMDHome *)v49 messageTargetUUID];
          [msgDispatcher sendMessage:v55 target:messageTargetUUID];

          v52 = dictionary;
        }

        if (v11)
        {
          v58 = [MEMORY[0x277D0F818] entitledMessageWithName:*v54 messagePayload:dictionary2];
          msgDispatcher2 = [(HMDHome *)v49 msgDispatcher];
          messageTargetUUID2 = [(HMDHome *)v49 messageTargetUUID];
          [msgDispatcher2 sendMessage:v58 target:messageTargetUUID2];
        }

        [(HMDHome *)v49 _reevaluateAccessoryInfoWithBadgeRefresh:v65, v62];
        completionCopy = v66;
        if (v66)
        {
          (v66)[2](v66, v63 != 0);
        }

        accessoriesCopy = v67;
        goto LABEL_47;
      }
    }
  }

  if (completionCopy)
  {
    completionCopy[2](completionCopy, 0);
  }

LABEL_47:

  v61 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)accessories
{
  accessoriesCopy = accessories;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __61__HMDHome_notifyClientsOfAccessoryInfoUpdatedForAccessories___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = accessoriesCopy;
  v6 = accessoriesCopy;
  dispatch_async(workQueue, v7);
}

- (void)_removeCloudData
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __27__HMDHome__removeCloudData__block_invoke;
  v6[3] = &unk_27868A250;
  v6[4] = self;
  [(HMDHome *)self _clearEventsWithCompletion:v6];
  userActionPredictionManager = [(HMDHome *)self userActionPredictionManager];
  [userActionPredictionManager removeZones];

  personDataManager = [(HMDHome *)self personDataManager];
  [personDataManager removeCloudDataDueToHomeRemoval];
}

void __27__HMDHome__removeCloudData__block_invoke(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_ERROR);
  if (v3)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543618;
      v14 = v8;
      v15 = 2112;
      v16 = v3;
      v9 = "%{public}@Failed to clear events %@";
      v10 = v6;
      v11 = 22;
LABEL_6:
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, v9, &v13, v11);
    }
  }

  else if (v7)
  {
    v8 = HMFGetLogIdentifier();
    v13 = 138543362;
    v14 = v8;
    v9 = "%{public}@Successfully cleared events";
    v10 = v6;
    v11 = 12;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v4);
  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleHomeWasRemoved
{
  walletKeyManager = [(HMDHome *)self walletKeyManager];
  [walletKeyManager handleHomeWasRemoved];
}

- (void)_removeAllHomeContentsAndAccessoryPairings:(BOOL)pairings queue:(id)queue completionHandler:(id)handler
{
  pairingsCopy = pairings;
  v75 = *MEMORY[0x277D85DE8];
  queueCopy = queue;
  handlerCopy = handler;
  v7 = objc_autoreleasePoolPush();
  val = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v68 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Removing all home contents and accessory pairings", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v7);
  walletKeyManager = [(HMDHome *)val walletKeyManager];
  [walletKeyManager handleHomeWillBeRemoved];

  v65 = 0u;
  v66 = 0u;
  v63 = 0u;
  v64 = 0u;
  triggers = [(HMDHome *)val triggers];
  v12 = [triggers countByEnumeratingWithState:&v63 objects:v74 count:16];
  if (v12)
  {
    v13 = *v64;
    do
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v64 != v13)
        {
          objc_enumerationMutation(triggers);
        }

        [*(*(&v63 + 1) + 8 * i) invalidate];
      }

      v12 = [triggers countByEnumeratingWithState:&v63 objects:v74 count:16];
    }

    while (v12);
  }

  v61 = 0u;
  v62 = 0u;
  v59 = 0u;
  v60 = 0u;
  actionSets = [(HMDHome *)val actionSets];
  v16 = [actionSets countByEnumeratingWithState:&v59 objects:v73 count:16];
  if (v16)
  {
    v17 = *v60;
    do
    {
      for (j = 0; j != v16; ++j)
      {
        if (*v60 != v17)
        {
          objc_enumerationMutation(actionSets);
        }

        [*(*(&v59 + 1) + 8 * j) invalidate];
      }

      v16 = [actionSets countByEnumeratingWithState:&v59 objects:v73 count:16];
    }

    while (v16);
  }

  v57 = 0u;
  v58 = 0u;
  v55 = 0u;
  v56 = 0u;
  users = [(HMDHome *)val users];
  v20 = [users copy];

  v21 = [v20 countByEnumeratingWithState:&v55 objects:v72 count:16];
  if (v21)
  {
    v22 = *v56;
    do
    {
      for (k = 0; k != v21; ++k)
      {
        if (*v56 != v22)
        {
          objc_enumerationMutation(v20);
        }

        v24 = *(*(&v55 + 1) + 8 * k);
        [v24 removeCloudData];
        [v24 unconfigure];
      }

      v21 = [v20 countByEnumeratingWithState:&v55 objects:v72 count:16];
    }

    while (v21);
  }

  residentSyncManager = [(HMDHome *)val residentSyncManager];
  [residentSyncManager stop];

  [(HMDHome *)val setResidentSyncManager:0];
  objc_initWeak(&location, val);
  group = dispatch_group_create();
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  accessories = [(HMDHome *)val accessories];
  v27 = [accessories countByEnumeratingWithState:&v50 objects:v71 count:16];
  if (v27)
  {
    v28 = *v51;
    do
    {
      for (m = 0; m != v27; ++m)
      {
        if (*v51 != v28)
        {
          objc_enumerationMutation(accessories);
        }

        v30 = *(*(&v50 + 1) + 8 * m);
        if ([v30 isPrimary])
        {
          v31 = objc_autoreleasePoolPush();
          v32 = val;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v68 = v34;
            v69 = 2112;
            v70 = v30;
            _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Removing primary accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          dispatch_group_enter(group);
          aBlock[0] = MEMORY[0x277D85DD0];
          aBlock[1] = 3221225472;
          aBlock[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke;
          aBlock[3] = &unk_278685F38;
          objc_copyWeak(&v49, &location);
          aBlock[4] = v30;
          v48 = group;
          v35 = _Block_copy(aBlock);
          v36 = v35;
          if (pairingsCopy)
          {
            [(HMDHome *)v32 removeAllUsersAndCloudDataFromAccessory:v30 completionHandler:v35];
          }

          else
          {
            (*(v35 + 2))(v35);
          }

          objc_destroyWeak(&v49);
        }
      }

      v27 = [accessories countByEnumeratingWithState:&v50 objects:v71 count:16];
    }

    while (v27);
  }

  [(HMDHome *)val _removeCloudData];
  dispatch_group_notify(group, queueCopy, handlerCopy);
  v37 = objc_autoreleasePoolPush();
  v38 = val;
  v39 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
  {
    v40 = HMFGetLogIdentifier();
    *buf = 138543362;
    v68 = v40;
    _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Removed all accessories", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v37);
  [(HMDHome *)v38 removeSharedHomeFabricData];

  objc_destroyWeak(&location);
  v41 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v3 = *(a1 + 32);
    v5[0] = MEMORY[0x277D85DD0];
    v5[1] = 3221225472;
    v5[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_2;
    v5[3] = &unk_278689578;
    objc_copyWeak(&v7, (a1 + 48));
    v4 = *(a1 + 40);
    v5[4] = *(a1 + 32);
    v6 = v4;
    [WeakRetained _removeAccessory:v3 completionHandler:v5];

    objc_destroyWeak(&v7);
  }

  else
  {
    dispatch_group_leave(*(a1 + 40));
  }
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v30 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    *buf = 138543874;
    v25 = v11;
    v26 = 2112;
    v27 = v12;
    v28 = 2112;
    v29 = v6;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed primary accessory, %@, with error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  if (v9)
  {
    v13 = [v9 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1500;
    block[3] = &unk_278689550;
    v19 = v6;
    v20 = v9;
    v14 = v5;
    v15 = *(a1 + 32);
    v16 = *(a1 + 40);
    v21 = v14;
    v22 = v15;
    v23 = v16;
    dispatch_async(v13, block);
  }

  else
  {
    dispatch_group_leave(*(a1 + 40));
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1500(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  if (*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v6 = *(a1 + 56);
      v7 = *(a1 + 32);
      v9 = 138543874;
      v10 = v5;
      v11 = 2112;
      v12 = v6;
      v13 = 2112;
      v14 = v7;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove accessory %@ with error: %@", &v9, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
  }

  else
  {
    [*(a1 + 40) _removeAccessories:*(a1 + 48) message:0];
  }

  dispatch_group_leave(*(a1 + 64));
  v8 = *MEMORY[0x277D85DE8];
}

- (void)_removeAccessories:(id)accessories message:(id)message
{
  v60 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  messageCopy = message;
  selfCopy = self;
  v8 = [(HMDHome *)self _removeAccessoriesCommon:accessoriesCopy];
  name = [messageCopy name];
  v10 = [name isEqualToString:*MEMORY[0x277CD24F0]];

  v45 = v8;
  v46 = messageCopy;
  if (v10)
  {
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    [dictionary setObject:v8 forKeyedSubscript:*MEMORY[0x277CCE7A8]];
    v12 = [dictionary copy];
    [messageCopy respondWithPayload:v12];
  }

  else
  {
    [messageCopy respondWithSuccess];
  }

  v51 = 0u;
  v52 = 0u;
  v49 = 0u;
  v50 = 0u;
  obj = accessoriesCopy;
  v13 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v50;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v50 != v15)
        {
          objc_enumerationMutation(obj);
        }

        v17 = *(*(&v49 + 1) + 8 * i);
        v18 = objc_autoreleasePoolPush();
        v19 = selfCopy;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
        {
          v21 = HMFGetLogIdentifier();
          *buf = 138543618;
          v56 = v21;
          v57 = 2112;
          v58 = v17;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Removing accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
        v22 = v17;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v23 = v22;
        }

        else
        {
          v23 = 0;
        }

        v24 = v23;

        if (v24)
        {
          isCurrentAccessory = [v24 isCurrentAccessory];
          if ([v24 isDemoAccessory])
          {
            v26 = 1;
          }

          else
          {
            v26 = isCurrentAccessory == 0;
          }

          if (!v26)
          {
            v27 = objc_autoreleasePoolPush();
            v28 = v19;
            v29 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
            {
              v30 = HMFGetLogIdentifier();
              *buf = 138543618;
              v56 = v30;
              v57 = 2112;
              v58 = v22;
              _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Posting notification about current accessory removal %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v27);
            notificationCenter = [(HMDHome *)v28 notificationCenter];
            v53 = @"HMDLastRemovedCurrentAccessoryUUIDKey";
            uuid = [v24 uuid];
            v54 = uuid;
            v33 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v54 forKeys:&v53 count:1];
            [notificationCenter postNotificationName:@"HMDHomeManagerDidRemoveCurrentAccessoryNotification" object:v28 userInfo:v33];
          }

          homeManager = [(HMDHome *)v19 homeManager];
          capabilitiesAggregator = [(HMDHome *)v19 capabilitiesAggregator];
          uuid2 = [v24 uuid];
          [capabilitiesAggregator didRemoveAccessory:uuid2];

          uuid3 = [v24 uuid];
          v38 = [homeManager accessorySetupMetricDispatcherForAccessoryUUID:uuid3];

          [v38 markAccessoryRemoved];
          fetchedAccessorySettingsSubscriber = [(HMDHome *)v19 fetchedAccessorySettingsSubscriber];
          uuid4 = [v24 uuid];
          [fetchedAccessorySettingsSubscriber unsubscribeForAccessory:uuid4];

          legacyAccessoryPairingController = [homeManager legacyAccessoryPairingController];

          if (legacyAccessoryPairingController)
          {
            legacyAccessoryPairingController2 = [homeManager legacyAccessoryPairingController];
            [legacyAccessoryPairingController2 handleMessage:v46 from:v19];
          }
        }

        else
        {
          [0 isDemoAccessory];
        }

        if ([v22 isPrimary])
        {
          identifier = [v22 identifier];
          [(HMDHome *)v19 _deregisterPairedAccessory:identifier];
        }

        [v22 setHome:0];
        [v22 unconfigure];
      }

      v14 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
    }

    while (v14);
  }

  v44 = *MEMORY[0x277D85DE8];
}

- (id)_removeAccessoriesCommon:(id)common
{
  v44 = *MEMORY[0x277D85DE8];
  commonCopy = common;
  v30 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(commonCopy, "count")}];
  [(HMDHome *)self _removeAccessoriesFromContainers:commonCopy];
  v38 = 0u;
  v39 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = commonCopy;
  v31 = [obj countByEnumeratingWithState:&v36 objects:v43 count:16];
  if (v31)
  {
    v29 = *v37;
    v28 = *MEMORY[0x277CCF0B0];
    do
    {
      for (i = 0; i != v31; ++i)
      {
        if (*v37 != v29)
        {
          objc_enumerationMutation(obj);
        }

        v6 = *(*(&v36 + 1) + 8 * i);
        [(HMDHome *)self removeAccessory:v6];
        getConfiguredName = [v6 getConfiguredName];

        if (getConfiguredName)
        {
          getConfiguredName2 = [v6 getConfiguredName];
          v9 = [(HMDHome *)self removeName:getConfiguredName2];
        }

        v10 = v6;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v12)
        {
          v34 = 0u;
          v35 = 0u;
          v32 = 0u;
          v33 = 0u;
          services = [v12 services];
          v14 = [services countByEnumeratingWithState:&v32 objects:v42 count:16];
          if (v14)
          {
            v15 = v14;
            v16 = *v33;
            do
            {
              for (j = 0; j != v15; ++j)
              {
                if (*v33 != v16)
                {
                  objc_enumerationMutation(services);
                }

                v18 = *(*(&v32 + 1) + 8 * j);
                getConfiguredName3 = [v18 getConfiguredName];

                if (getConfiguredName3)
                {
                  getConfiguredName4 = [v18 getConfiguredName];
                  v21 = [(HMDHome *)self removeName:getConfiguredName4];
                }
              }

              v15 = [services countByEnumeratingWithState:&v32 objects:v42 count:16];
            }

            while (v15);
          }
        }

        v40 = v28;
        uuid = [v10 uuid];
        uUIDString = [uuid UUIDString];
        v41 = uUIDString;
        v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v41 forKeys:&v40 count:1];
        [v30 addObject:v24];
      }

      v31 = [obj countByEnumeratingWithState:&v36 objects:v43 count:16];
    }

    while (v31);
  }

  v25 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_removeAccessoriesFromContainers:(id)containers
{
  v75 = *MEMORY[0x277D85DE8];
  containersCopy = containers;
  if ([containersCopy count])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v72 = v8;
      v73 = 2112;
      v74 = containersCopy;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Removing accessories from containers : [%@]", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    backingStore = [(HMDHome *)selfCopy backingStore];
    v10 = *MEMORY[0x277CD24E8];
    v11 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v12 = [backingStore transaction:v10 options:v11];

    v64 = 0u;
    v65 = 0u;
    v62 = 0u;
    v63 = 0u;
    v41 = containersCopy;
    obj = containersCopy;
    v13 = [obj countByEnumeratingWithState:&v62 objects:v70 count:16];
    if (v13)
    {
      v14 = v13;
      v43 = *v63;
      do
      {
        v15 = 0;
        do
        {
          if (*v63 != v43)
          {
            objc_enumerationMutation(obj);
          }

          v16 = *(*(&v62 + 1) + 8 * v15);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v17 = v16;
          }

          else
          {
            v17 = 0;
          }

          v18 = v17;

          if (v18)
          {
            v60 = 0u;
            v61 = 0u;
            v58 = 0u;
            v59 = 0u;
            serviceGroups = [(HMDHome *)selfCopy serviceGroups];
            v20 = [serviceGroups countByEnumeratingWithState:&v58 objects:v69 count:16];
            if (v20)
            {
              v21 = v20;
              v22 = *v59;
              do
              {
                v23 = 0;
                do
                {
                  if (*v59 != v22)
                  {
                    objc_enumerationMutation(serviceGroups);
                  }

                  [*(*(&v58 + 1) + 8 * v23++) removeServicesForAccessory:{v18, v41}];
                }

                while (v21 != v23);
                v21 = [serviceGroups countByEnumeratingWithState:&v58 objects:v69 count:16];
              }

              while (v21);
            }
          }

          v56 = 0u;
          v57 = 0u;
          v54 = 0u;
          v55 = 0u;
          actionSets = [(HMDHome *)selfCopy actionSets];
          v25 = [actionSets countByEnumeratingWithState:&v54 objects:v68 count:16];
          if (v25)
          {
            v26 = v25;
            v27 = *v55;
            do
            {
              v28 = 0;
              do
              {
                if (*v55 != v27)
                {
                  objc_enumerationMutation(actionSets);
                }

                [*(*(&v54 + 1) + 8 * v28++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v26 != v28);
              v26 = [actionSets countByEnumeratingWithState:&v54 objects:v68 count:16];
            }

            while (v26);
          }

          v52 = 0u;
          v53 = 0u;
          v50 = 0u;
          v51 = 0u;
          triggerOwnedActionSets = [(HMDHome *)selfCopy triggerOwnedActionSets];
          v30 = [triggerOwnedActionSets countByEnumeratingWithState:&v50 objects:v67 count:16];
          if (v30)
          {
            v31 = v30;
            v32 = *v51;
            do
            {
              v33 = 0;
              do
              {
                if (*v51 != v32)
                {
                  objc_enumerationMutation(triggerOwnedActionSets);
                }

                [*(*(&v50 + 1) + 8 * v33++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v31 != v33);
              v31 = [triggerOwnedActionSets countByEnumeratingWithState:&v50 objects:v67 count:16];
            }

            while (v31);
          }

          v48 = 0u;
          v49 = 0u;
          v46 = 0u;
          v47 = 0u;
          triggers = [(HMDHome *)selfCopy triggers];
          v35 = [triggers countByEnumeratingWithState:&v46 objects:v66 count:16];
          if (v35)
          {
            v36 = v35;
            v37 = *v47;
            do
            {
              v38 = 0;
              do
              {
                if (*v47 != v37)
                {
                  objc_enumerationMutation(triggers);
                }

                [*(*(&v46 + 1) + 8 * v38++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v36 != v38);
              v36 = [triggers countByEnumeratingWithState:&v46 objects:v66 count:16];
            }

            while (v36);
          }

          v44[0] = MEMORY[0x277D85DD0];
          v44[1] = 3221225472;
          v44[2] = __44__HMDHome__removeAccessoriesFromContainers___block_invoke;
          v44[3] = &unk_27868A1D8;
          v44[4] = selfCopy;
          v45 = v18;
          v39 = v18;
          [v12 run:v44];

          ++v15;
        }

        while (v15 != v14);
        v14 = [obj countByEnumeratingWithState:&v62 objects:v70 count:16];
      }

      while (v14);
    }

    [(HMDHome *)selfCopy _evaluateShouldRelaunchAndSetRelaunch];
    containersCopy = v41;
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__removeAccessoriesFromContainers___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 40);
      v16 = 138543874;
      v17 = v8;
      v18 = 2112;
      v19 = v9;
      v20 = 2112;
      v21 = v3;
      v10 = "%{public}@Failed to commit removeAccessoriesFromContainersTransaction [%@]: %@";
      v11 = v7;
      v12 = OS_LOG_TYPE_ERROR;
      v13 = 32;
LABEL_6:
      _os_log_impl(&dword_229538000, v11, v12, v10, &v16, v13);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v14 = *(a1 + 40);
    v16 = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = v14;
    v10 = "%{public}@Successfully finished running removeAccessoriesFromContainersTransaction : %@";
    v11 = v7;
    v12 = OS_LOG_TYPE_INFO;
    v13 = 22;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v4);
  v15 = *MEMORY[0x277D85DE8];
}

- (void)_removeService:(id)service
{
  v64 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  backingStore = [(HMDHome *)self backingStore];
  v6 = *MEMORY[0x277CD2528];
  v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v8 = [backingStore transaction:v6 options:v7];

  v56 = 0u;
  v57 = 0u;
  v54 = 0u;
  v55 = 0u;
  serviceGroups = [(HMDHome *)self serviceGroups];
  v10 = [serviceGroups countByEnumeratingWithState:&v54 objects:v63 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v55;
    do
    {
      v13 = 0;
      do
      {
        if (*v55 != v12)
        {
          objc_enumerationMutation(serviceGroups);
        }

        [*(*(&v54 + 1) + 8 * v13++) removeService:serviceCopy];
      }

      while (v11 != v13);
      v11 = [serviceGroups countByEnumeratingWithState:&v54 objects:v63 count:16];
    }

    while (v11);
  }

  v52 = 0u;
  v53 = 0u;
  v50 = 0u;
  v51 = 0u;
  actionSets = [(HMDHome *)self actionSets];
  v15 = [actionSets countByEnumeratingWithState:&v50 objects:v62 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v51;
    do
    {
      v18 = 0;
      do
      {
        if (*v51 != v17)
        {
          objc_enumerationMutation(actionSets);
        }

        [*(*(&v50 + 1) + 8 * v18++) handleRemovalOfService:serviceCopy transaction:v8];
      }

      while (v16 != v18);
      v16 = [actionSets countByEnumeratingWithState:&v50 objects:v62 count:16];
    }

    while (v16);
  }

  v48 = 0u;
  v49 = 0u;
  v46 = 0u;
  v47 = 0u;
  triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
  v20 = [triggerOwnedActionSets countByEnumeratingWithState:&v46 objects:v61 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v47;
    do
    {
      v23 = 0;
      do
      {
        if (*v47 != v22)
        {
          objc_enumerationMutation(triggerOwnedActionSets);
        }

        [*(*(&v46 + 1) + 8 * v23++) handleRemovalOfService:serviceCopy transaction:v8];
      }

      while (v21 != v23);
      v21 = [triggerOwnedActionSets countByEnumeratingWithState:&v46 objects:v61 count:16];
    }

    while (v21);
  }

  getConfiguredName = [serviceCopy getConfiguredName];

  if (getConfiguredName)
  {
    getConfiguredName2 = [serviceCopy getConfiguredName];
    v26 = [(HMDHome *)self removeName:getConfiguredName2];
  }

  v45 = 0u;
  v43 = 0u;
  v44 = 0u;
  v42 = 0u;
  triggers = [(HMDHome *)self triggers];
  v28 = [triggers countByEnumeratingWithState:&v42 objects:v60 count:16];
  if (v28)
  {
    v29 = v28;
    v30 = *v43;
    do
    {
      v31 = 0;
      do
      {
        if (*v43 != v30)
        {
          objc_enumerationMutation(triggers);
        }

        [*(*(&v42 + 1) + 8 * v31++) handleRemovalOfService:serviceCopy transaction:v8];
      }

      while (v29 != v31);
      v29 = [triggers countByEnumeratingWithState:&v42 objects:v60 count:16];
    }

    while (v29);
  }

  v41[0] = MEMORY[0x277D85DD0];
  v41[1] = 3221225472;
  v41[2] = __26__HMDHome__removeService___block_invoke;
  v41[3] = &unk_27868A250;
  v41[4] = self;
  [v8 run:v41];
  notificationCenter = [(HMDHome *)self notificationCenter];
  v58 = @"HMDServiceNotificationKey";
  v59 = serviceCopy;
  v33 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v59 forKeys:&v58 count:1];
  [notificationCenter postNotificationName:@"HMDHomeServiceRemovedNotification" object:self userInfo:v33];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __26__HMDHome__removeService___block_invoke_1499;
  block[3] = &unk_27868A750;
  block[4] = self;
  v35 = serviceCopy;
  v40 = v35;
  dispatch_async(workQueue, block);

  bulletinBoardNotification = [v35 bulletinBoardNotification];

  if (bulletinBoardNotification)
  {
    accessoryBulletinNotificationManager = [(HMDHome *)self accessoryBulletinNotificationManager];
    [accessoryBulletinNotificationManager handleRemovedService:v35];
  }

  v38 = *MEMORY[0x277D85DE8];
}

void __26__HMDHome__removeService___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit removeServiceTransaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = *MEMORY[0x277D85DE8];
}

void __26__HMDHome__removeService___block_invoke_1499(uint64_t a1)
{
  v3 = [*(a1 + 32) notificationRegistry];
  v2 = [*(a1 + 40) characteristics];
  [v3 removeRegistrationsForCharacteristics:v2];
}

- (void)handleMobileAssetsUpdatedNotification:(id)notification
{
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_handleMobileAssetsUpdatedNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = notificationCopy;
  v6 = notificationCopy;
  dispatch_async(workQueue, v7);
}

void __49__HMDHome_handleMobileAssetsUpdatedNotification___block_invoke(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) isCurrentDeviceConfirmedPrimaryResident])
  {
    v2 = [*(a1 + 40) userInfo];
    v16 = 0;
    v3 = [v2 hmf_integerForKey:@"currentContentVersion" error:&v16];
    v4 = v16;

    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    v8 = v7;
    if (v3)
    {
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v9 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v9;
        v19 = 1024;
        LODWORD(v20) = v3;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Handling mobile assets updated notification with current version: %d", buf, 0x12u);
      }

      objc_autoreleasePoolPop(v5);
      [(HMDHome *)*(a1 + 32) _maybeCheckACWGLocksForMFiCertificationWithContentVersion:v3];
    }

    else
    {
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v14;
        v19 = 2112;
        v20 = v4;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Invalid notification without content version: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v5);
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 32);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Ignoring mobile assets updated notification because we're not primary resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_auditActionSetsAndTriggersForAccessory:(id)accessory
{
  v59 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if ([(HMDHome *)self isCurrentDevicePrimaryResident]|| ![(HMDHome *)self isResidentSupported])
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      shortDescription = [accessoryCopy shortDescription];
      *buf = 138543618;
      v56 = v14;
      v57 = 2112;
      v58 = shortDescription;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Auditing actions/events for ActionSets and Triggers for accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    backingStore = [(HMDHome *)selfCopy backingStore];
    v17 = *MEMORY[0x277CD20C8];
    v18 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v19 = [backingStore transaction:v17 options:v18];

    v50 = 0u;
    v51 = 0u;
    v48 = 0u;
    v49 = 0u;
    actionSets = [(HMDHome *)selfCopy actionSets];
    v21 = [actionSets countByEnumeratingWithState:&v48 objects:v54 count:16];
    if (v21)
    {
      v22 = v21;
      v23 = *v49;
      do
      {
        v24 = 0;
        do
        {
          if (*v49 != v23)
          {
            objc_enumerationMutation(actionSets);
          }

          [*(*(&v48 + 1) + 8 * v24++) auditActionsForAccessory:accessoryCopy transaction:v19];
        }

        while (v22 != v24);
        v22 = [actionSets countByEnumeratingWithState:&v48 objects:v54 count:16];
      }

      while (v22);
    }

    v46 = 0u;
    v47 = 0u;
    v44 = 0u;
    v45 = 0u;
    triggerOwnedActionSets = [(HMDHome *)selfCopy triggerOwnedActionSets];
    v26 = [triggerOwnedActionSets countByEnumeratingWithState:&v44 objects:v53 count:16];
    if (v26)
    {
      v27 = v26;
      v28 = *v45;
      do
      {
        v29 = 0;
        do
        {
          if (*v45 != v28)
          {
            objc_enumerationMutation(triggerOwnedActionSets);
          }

          [*(*(&v44 + 1) + 8 * v29++) auditActionsForAccessory:accessoryCopy transaction:v19];
        }

        while (v27 != v29);
        v27 = [triggerOwnedActionSets countByEnumeratingWithState:&v44 objects:v53 count:16];
      }

      while (v27);
    }

    v42 = 0u;
    v43 = 0u;
    v40 = 0u;
    v41 = 0u;
    triggers = [(HMDHome *)selfCopy triggers];
    v31 = [triggers countByEnumeratingWithState:&v40 objects:v52 count:16];
    if (v31)
    {
      v32 = v31;
      v33 = *v41;
      do
      {
        v34 = 0;
        do
        {
          if (*v41 != v33)
          {
            objc_enumerationMutation(triggers);
          }

          v35 = *(*(&v40 + 1) + 8 * v34);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v36 = v35;
          }

          else
          {
            v36 = 0;
          }

          v37 = v36;

          if ([v37 isConfigured])
          {
            [v37 auditForStaleEventsWithAccessory:accessoryCopy transaction:v19];
          }

          ++v34;
        }

        while (v32 != v34);
        v32 = [triggers countByEnumeratingWithState:&v40 objects:v52 count:16];
      }

      while (v32);
    }

    v39[0] = MEMORY[0x277D85DD0];
    v39[1] = 3221225472;
    v39[2] = __51__HMDHome__auditActionSetsAndTriggersForAccessory___block_invoke;
    v39[3] = &unk_27868A250;
    v39[4] = selfCopy;
    [v19 run:v39];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      shortDescription2 = [accessoryCopy shortDescription];
      *buf = 138543618;
      v56 = v9;
      v57 = 2112;
      v58 = shortDescription2;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Skipping audit of actions/events for ActionSets and Triggers for accessory %@ on non-primary resident", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v38 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__auditActionSetsAndTriggersForAccessory___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit auditActionSetsAndTriggersTransaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)checkForCATIDUpdate:(id)update
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __31__HMDHome_checkForCATIDUpdate___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)handleHomeDataLoaded:(id)loaded
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __32__HMDHome_handleHomeDataLoaded___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

uint64_t __32__HMDHome_handleHomeDataLoaded___block_invoke(uint64_t a1)
{
  [*(a1 + 32) updateCATIDForUsersIfNeeded:0];
  v2 = *(a1 + 32);

  return [v2 prepareOperationalFabricData];
}

- (void)_removeAccessoryWithUUID:(id)d message:(id)message
{
  v29 = *MEMORY[0x277D85DE8];
  dCopy = d;
  messageCopy = message;
  objc_initWeak(&location, self);
  v8 = [(HMDHome *)self accessoryWithUUID:dCopy];
  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v12;
      v27 = 2112;
      v28 = v8;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Remove accessory name: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v13 = v8;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    *buf = 0;
    v16 = [v15 preferredHAPAccessoryForOperation:8 linkType:buf];
    v17 = [HMDAccessoryPairingEvent removingAccessory:v13 hapAccessory:v16];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __44__HMDHome__removeAccessoryWithUUID_message___block_invoke;
    v20[3] = &unk_27866FDA0;
    objc_copyWeak(&v24, &location);
    v21 = messageCopy;
    v18 = v17;
    v22 = v18;
    v23 = v13;
    [(HMDHome *)selfCopy _removeAccessory:v23 completionHandler:v20];

    objc_destroyWeak(&v24);
  }

  else
  {
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v15];
  }

  objc_destroyWeak(&location);
  v19 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__removeAccessoryWithUUID_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 7);
  v8 = WeakRetained;
  if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __44__HMDHome__removeAccessoryWithUUID_message___block_invoke_2;
    v12[3] = &unk_278683598;
    v12[4] = v8;
    v13 = a1[5];
    v14 = v6;
    v15 = v5;
    v16 = a1[4];
    v17 = a1[6];
    dispatch_async(v9, v12);
  }

  else
  {
    v10 = a1[4];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
    [v10 respondWithError:v11];
  }
}

void __44__HMDHome__removeAccessoryWithUUID_message___block_invoke_2(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) logEventSubmitter];
  [v2 submitLogEvent:*(a1 + 40) error:*(a1 + 48)];

  if (*(a1 + 48))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      v6 = HMFGetLogIdentifier();
      v7 = [*(a1 + 72) name];
      v8 = *(a1 + 48);
      *buf = 138543874;
      v14 = v6;
      v15 = 2112;
      v16 = v7;
      v17 = 2112;
      v18 = v8;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove accessory %@ with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 64) respondWithError:*(a1 + 48)];
    v9 = *MEMORY[0x277D85DE8];
  }

  else
  {
    [*(a1 + 32) _removeAccessories:*(a1 + 56) message:*(a1 + 64)];
    [*(a1 + 32) updateHomeLocation];
    v10 = *(a1 + 32);
    v12 = [*(a1 + 64) name];
    [v10 saveWithReason:? postSyncNotification:?];
    v11 = *MEMORY[0x277D85DE8];
  }
}

- (void)_removeAccessory:(id)accessory completionHandler:(id)handler
{
  v42 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  handlerCopy = handler;
  if ([accessoryCopy isPrimary])
  {
    removeAccessoryInProgressForHMDAccessories = [(HMDHome *)self removeAccessoryInProgressForHMDAccessories];
    v9 = [removeAccessoryInProgressForHMDAccessories containsObject:accessoryCopy];

    if (v9)
    {
      v10 = objc_autoreleasePoolPush();
      selfCopy = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543618;
        v39 = v13;
        v40 = 2112;
        v41 = accessoryCopy;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Already have a remove operation queued for accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      v36[0] = *MEMORY[0x277CCA450];
      v14 = MEMORY[0x277CCACA8];
      name = [accessoryCopy name];
      uuid = [accessoryCopy uuid];
      v17 = [v14 stringWithFormat:@"Failed to remove accessory %@(%@)", name, uuid];
      v36[1] = *MEMORY[0x277CCA470];
      v37[0] = v17;
      v18 = MEMORY[0x277CCACA8];
      v19 = [MEMORY[0x277CCA9B8] hmStringFromErrorCode:15];
      v20 = [v18 stringWithFormat:@"%ld (%@) This accessory is already being removed from the home.", 15, v19];
      v37[1] = v20;
      v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v37 forKeys:v36 count:2];

      v22 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:15 userInfo:v21];
      if (handlerCopy)
      {
        handlerCopy[2](handlerCopy, 0, v22);
      }
    }

    else
    {
      v27 = accessoryCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v28 = v27;
      }

      else
      {
        v28 = 0;
      }

      v21 = v28;

      home = [v27 home];
      if ([home isAdminUser])
      {
        isPaired = [v21 isPaired];

        if (isPaired)
        {
          os_unfair_recursive_lock_lock_with_options();
          [(NSHashTable *)self->_removeAccessoryInProgressForHMDAccessories addObject:v21];
          os_unfair_recursive_lock_unlock();
          v31 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v39 = v34;
            v40 = 2112;
            v41 = v21;
            _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Removing accessory %@. Also added accessory in removal-in-progress array", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          [(HMDHome *)selfCopy2 _removeAccessoriesForPrimaryAccessory:v21 error:0 completionHandler:handlerCopy];
          goto LABEL_22;
        }
      }

      else
      {
      }

      [(HMDHome *)self _removeAccessoriesForPrimaryAccessory:v27 error:0 completionHandler:handlerCopy];
    }

LABEL_22:

    goto LABEL_23;
  }

  v23 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v25 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
  {
    v26 = HMFGetLogIdentifier();
    *buf = 138543618;
    v39 = v26;
    v40 = 2112;
    v41 = accessoryCopy;
    _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@cannot remove non-primary accessory %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v23);
  if (handlerCopy)
  {
    v21 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:34 userInfo:0];
    handlerCopy[2](handlerCopy, 0, v21);
    goto LABEL_22;
  }

LABEL_23:

  v35 = *MEMORY[0x277D85DE8];
}

- (void)removeAccessory:(id)accessory completionHandler:(id)handler
{
  accessoryCopy = accessory;
  handlerCopy = handler;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __45__HMDHome_removeAccessory_completionHandler___block_invoke;
  block[3] = &unk_278689F98;
  block[4] = self;
  v12 = accessoryCopy;
  v13 = handlerCopy;
  v9 = handlerCopy;
  v10 = accessoryCopy;
  dispatch_async(workQueue, block);
}

- (void)_removeAccessoriesForPrimaryAccessory:(id)accessory error:(id)error completionHandler:(id)handler
{
  v86 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  errorCopy = error;
  handlerCopy = handler;
  if (!accessoryCopy)
  {
    v54 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v56 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v56, OS_LOG_TYPE_ERROR))
    {
      v57 = HMFGetLogIdentifier();
      *buf = 138543362;
      v80 = v57;
      _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_ERROR, "%{public}@Nil accessory was passed to remove it from the home.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v54);
    v58 = MEMORY[0x277CCA9B8];
    v59 = *MEMORY[0x277CCFD28];
    v60 = 20;
    goto LABEL_50;
  }

  selfCopy2 = self;
  if (([accessoryCopy isPrimary] & 1) == 0)
  {
    v61 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v62 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v62, OS_LOG_TYPE_ERROR))
    {
      v63 = HMFGetLogIdentifier();
      *buf = 138543618;
      v80 = v63;
      v81 = 2112;
      v82 = accessoryCopy;
      _os_log_impl(&dword_229538000, v62, OS_LOG_TYPE_ERROR, "%{public}@Accessory is not primary (Bridged). Not moving further. [%@]", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v61);
    v58 = MEMORY[0x277CCA9B8];
    v59 = *MEMORY[0x277CCFD28];
    v60 = 34;
LABEL_50:
    array = [v58 errorWithDomain:v59 code:v60 userInfo:0];
    [(HMDHome *)selfCopy3 _sendRemoveCompletionStatusForHMDAccessories:0 withCompletion:handlerCopy error:array];
    goto LABEL_51;
  }

  array = [MEMORY[0x277CBEB18] array];
  selfCopy4 = self;
  [(HMDHome *)self removeAccessory:accessoryCopy];
  [array addObject:accessoryCopy];
  v13 = +[HMDBulletinBoard sharedBulletinBoard];
  [v13 removeBulletinsForAccessory:accessoryCopy];

  v14 = accessoryCopy;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  if (isKindOfClass)
  {
    v16 = v14;
  }

  else
  {
    v16 = 0;
  }

  v71 = v16;

  if (isKindOfClass)
  {
    v66 = v14;
    v67 = handlerCopy;
    v68 = errorCopy;
    v69 = array;
    v65 = accessoryCopy;
    v77 = 0u;
    v78 = 0u;
    v75 = 0u;
    v76 = 0u;
    accessories = [(HMDHome *)selfCopy2 accessories];
    v18 = [accessories countByEnumeratingWithState:&v75 objects:v85 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = *v76;
      do
      {
        for (i = 0; i != v19; ++i)
        {
          if (*v76 != v20)
          {
            objc_enumerationMutation(accessories);
          }

          v22 = *(*(&v75 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v23 = v22;
          }

          else
          {
            v23 = 0;
          }

          v24 = v23;

          identifier = [v24 identifier];
          identifier2 = [v71 identifier];
          if (([identifier isEqualToString:identifier2] & 1) == 0)
          {

            goto LABEL_20;
          }

          hostAccessory = [v24 hostAccessory];
          objc_opt_class();
          v28 = objc_opt_isKindOfClass();

          if ((v28 & 1) == 0 || !hostAccessory)
          {
            [(HMDHome *)selfCopy2 removeAccessory:v22];
            [v69 addObject:v22];
            identifier = +[HMDBulletinBoard sharedBulletinBoard];
            [identifier removeBulletinsForAccessory:v22];
LABEL_20:
          }
        }

        v19 = [accessories countByEnumeratingWithState:&v75 objects:v85 count:16];
      }

      while (v19);
    }

    v14 = v66;
    isReachable = [v66 isReachable];
    accessoryCopy = v65;
    handlerCopy = v67;
    errorCopy = v68;
    array = v69;
    selfCopy4 = selfCopy2;
    if (v68 || !isReachable || ([v66 home], v30 = objc_claimAutoreleasedReturnValue(), v31 = objc_msgSend(v30, "isAdminUser"), v30, (v31 & 1) == 0))
    {
      keychainStore = [(HMDHome *)selfCopy2 keychainStore];
      identifier3 = [v71 identifier];
      v74 = 0;
      [keychainStore removeAccessoryKeyForName:identifier3 error:&v74];
      v34 = v74;

      if (v34)
      {
        v35 = objc_autoreleasePoolPush();
        v36 = selfCopy2;
        v37 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
        {
          v38 = HMFGetLogIdentifier();
          name = [v66 name];
          identifier4 = [v71 identifier];
          *buf = 138543874;
          v80 = v38;
          v81 = 2112;
          v82 = name;
          v83 = 2112;
          v84 = identifier4;
          _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove keychain entry for accessory %@ with identifier: %@", buf, 0x20u);

          array = v69;
          v14 = v66;
        }

        objc_autoreleasePoolPop(v35);
        handlerCopy = v67;
        errorCopy = v68;
      }
    }

    identifier5 = [v71 identifier];
    [(HMDHome *)selfCopy2 _deregisterPairedAccessory:identifier5];
  }

  v42 = v14;
  objc_opt_class();
  v43 = objc_opt_isKindOfClass();
  if (v43)
  {
    v44 = v42;
  }

  else
  {
    v44 = 0;
  }

  v45 = v44;

  if (v43)
  {
    mediaProfile = [v42 mediaProfile];
    if (mediaProfile)
    {
      workQueue = [(HMDHome *)selfCopy4 workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __73__HMDHome__removeAccessoriesForPrimaryAccessory_error_completionHandler___block_invoke;
      block[3] = &unk_27868A750;
      block[4] = selfCopy4;
      v73 = mediaProfile;
      dispatch_async(workQueue, block);

      identifier6 = [v42 identifier];
      v49 = [(HMDHome *)selfCopy4 mediaSessionStateWithIdentifier:identifier6];

      if (v49)
      {
        [(HMDHome *)selfCopy4 removeMediaSessionState:v49];
      }
    }
  }

  v50 = objc_autoreleasePoolPush();
  v51 = selfCopy4;
  v52 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
  {
    v53 = HMFGetLogIdentifier();
    *buf = 138543618;
    v80 = v53;
    v81 = 2112;
    v82 = array;
    _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_INFO, "%{public}@removedAccessories %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v50);
  [(HMDHome *)v51 _sendRemoveCompletionStatusForHMDAccessories:array withCompletion:handlerCopy error:0];

LABEL_51:
  v64 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome__removeAccessoriesForPrimaryAccessory_error_completionHandler___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) notificationRegistry];
  [v2 removeRegistrationsForMediaProfile:*(a1 + 40)];
}

- (void)_sendRemoveCompletionStatusForHMDAccessories:(id)accessories withCompletion:(id)completion error:(id)error
{
  v42 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  completionCopy = completion;
  errorCopy = error;
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (completionCopy)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543874;
      v37 = v13;
      v38 = 2112;
      v39 = errorCopy;
      v40 = 2112;
      v41 = accessoriesCopy;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Sending removal completion with error %@, accessories %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    completionCopy[2](completionCopy, accessoriesCopy, errorCopy);
  }

  else
  {
    if (v12)
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v37 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@sending removal completion for accessory removal: no completion found", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
  }

  v33 = 0u;
  v34 = 0u;
  v31 = 0u;
  v32 = 0u;
  obj = accessoriesCopy;
  v15 = [obj countByEnumeratingWithState:&v31 objects:v35 count:16];
  if (v15)
  {
    v16 = *v32;
    do
    {
      v17 = 0;
      do
      {
        if (*v32 != v16)
        {
          objc_enumerationMutation(obj);
        }

        v18 = *(*(&v31 + 1) + 8 * v17);
        os_unfair_recursive_lock_lock_with_options();
        [(NSHashTable *)selfCopy->_removeAccessoryInProgressForHMDAccessories removeObject:v18];
        os_unfair_recursive_lock_unlock();
        v19 = v18;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v20 = v19;
        }

        else
        {
          v20 = 0;
        }

        v21 = v20;

        if (v21 && [v19 isPrimary])
        {
          getPrimaryHAPAccessories = [v21 getPrimaryHAPAccessories];
          firstObject = [getPrimaryHAPAccessories firstObject];
          server = [firstObject server];

          accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
          identifier = [v21 identifier];
          [accessoryBrowser addUnpairedAccessoryServer:server identifier:identifier];
        }

        ++v17;
      }

      while (v15 != v17);
      v15 = [obj countByEnumeratingWithState:&v31 objects:v35 count:16];
    }

    while (v15);
  }

  if ([obj count])
  {
    [(HMDHome *)selfCopy _reevaluateAccessoryInfoWithBadgeRefresh:1];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientOfNewlyAddedAccessories:(id)accessories requestMessage:(id)message
{
  v79 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  messageCopy = message;
  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  v66 = 0u;
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  obj = accessoriesCopy;
  v7 = [obj countByEnumeratingWithState:&v66 objects:v78 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v67;
    v61 = *MEMORY[0x277CCF0B0];
    v60 = *MEMORY[0x277CCEA00];
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v67 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v66 + 1) + 8 * i);
        v12 = accessoryToEncodeForXPCTransportForAccessory(v11);
        if (v12 == v11)
        {
          v72[0] = v61;
          uuid = [v11 uuid];
          v72[1] = v60;
          v73[0] = uuid;
          v18 = encodeRootObjectForSPIClients(v11);
          v73[1] = v18;
          v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v73 forKeys:v72 count:2];

          v20 = [v19 copy];
          [array2 addObject:v20];

          v21 = v11;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v22 = v21;
          }

          else
          {
            v22 = 0;
          }

          v23 = v22;

          v24 = v21;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();

          if (v23 || (isKindOfClass & (v24 != 0)) != 0)
          {
            [array addObject:v19];
          }
        }

        else
        {
          v13 = objc_autoreleasePoolPush();
          selfCopy = self;
          v15 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
          {
            v16 = HMFGetLogIdentifier();
            *buf = 138543618;
            v75 = v16;
            v76 = 2112;
            v77 = v11;
            _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Skipping notifying clients of added accessory: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v13);
        }
      }

      v8 = [obj countByEnumeratingWithState:&v66 objects:v78 count:16];
    }

    while (v8);
  }

  v70 = *MEMORY[0x277CD0640];
  uuid2 = [(HMDHome *)self uuid];
  v71 = uuid2;
  v27 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v71 forKeys:&v70 count:1];

  if ([array count])
  {
    v28 = [v27 mutableCopy];
    v29 = [array copy];
    v30 = *MEMORY[0x277CCE7A8];
    [v28 setObject:v29 forKeyedSubscript:*MEMORY[0x277CCE7A8]];

    v31 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543618;
      v75 = v34;
      v76 = 2112;
      v77 = v28;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Notifying non-SPI-entitled clients of added accessories using payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v31);
    v35 = [MEMORY[0x277D0F848] nonSPIEntitledMessageWithName:*MEMORY[0x277CCFD98] messagePayload:v28];
    v36 = messageCopy;
    identifier = [messageCopy identifier];
    [v35 setIdentifier:identifier];

    msgDispatcher = [(HMDHome *)selfCopy2 msgDispatcher];
    uuid3 = [(HMDHome *)selfCopy2 uuid];
    [msgDispatcher sendMessage:v35 target:uuid3];
  }

  else
  {
    v40 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v42 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v42, OS_LOG_TYPE_INFO))
    {
      v43 = HMFGetLogIdentifier();
      *buf = 138543362;
      v75 = v43;
      _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_INFO, "%{public}@Not notifying non-SPI-entitled clients of empty list of added accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v40);
    v30 = *MEMORY[0x277CCE7A8];
    v36 = messageCopy;
  }

  v44 = [v27 mutableCopy];
  v45 = [array2 copy];
  [v44 setObject:v45 forKeyedSubscript:v30];

  v46 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v48 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
  {
    v49 = HMFGetLogIdentifier();
    *buf = 138543618;
    v75 = v49;
    v76 = 2112;
    v77 = v44;
    _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_INFO, "%{public}@Notifying SPI-entitled clients of added accessories using payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v46);
  v50 = MEMORY[0x277D0F848];
  v51 = *MEMORY[0x277CCFD98];
  identifier2 = [v36 identifier];
  v53 = [v50 entitledMessageWithName:v51 identifier:identifier2 messagePayload:v44];

  msgDispatcher2 = [(HMDHome *)selfCopy4 msgDispatcher];
  uuid4 = [(HMDHome *)selfCopy4 uuid];
  v64[0] = MEMORY[0x277D85DD0];
  v64[1] = 3221225472;
  v64[2] = __63__HMDHome__notifyClientOfNewlyAddedAccessories_requestMessage___block_invoke;
  v64[3] = &unk_27868A728;
  v65 = v36;
  v56 = v36;
  [msgDispatcher2 sendMessage:v53 target:uuid4 andInvokeCompletionHandler:v64];

  v57 = *MEMORY[0x277D85DE8];
}

- (void)_deregisterPairedAccessory:(id)accessory
{
  accessoryCopy = accessory;
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  [accessoryBrowser deregisterPairedAccessory:accessoryCopy];
}

- (void)_registerPairedAccessory:(id)accessory transports:(unint64_t)transports setupHash:(id)hash
{
  hashCopy = hash;
  accessoryCopy = accessory;
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  [accessoryBrowser registerPairedAccessory:accessoryCopy transports:transports setupHash:hashCopy delegate:self];
}

- (id)hapAccessoryUniqueIdentifiers
{
  v21 = *MEMORY[0x277D85DE8];
  accessories = [(HMDHome *)self accessories];
  v3 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(accessories, "count")}];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v4 = accessories;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          uniqueIdentifier = [v11 uniqueIdentifier];
          [v3 addObject:uniqueIdentifier];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)hapAccessoryServerIdentifiers
{
  v21 = *MEMORY[0x277D85DE8];
  accessories = [(HMDHome *)self accessories];
  v3 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(accessories, "count")}];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v4 = accessories;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11 && [v11 isPrimary])
        {
          identifier = [v11 identifier];
          [v3 addObject:identifier];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (unint64_t)accessoryCountForRoom:(id)room
{
  room = [MEMORY[0x277CCAC30] predicateWithFormat:@"room == %@", room];
  accessories = [(HMDHome *)self accessories];
  v6 = [accessories filteredArrayUsingPredicate:room];

  v7 = [v6 count];
  return v7;
}

- (void)scheduleRemoval
{
  homeManager = [(HMDHome *)self homeManager];
  v3 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  [homeManager scheduleRemovalForHome:self message:0 options:v3];
}

- (id)hmdHAPAccessoryWithHAPAccessory:(id)accessory
{
  v20 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  accessories = [(HMDHome *)self accessories];
  v6 = [accessories countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v16;
LABEL_3:
    v9 = 0;
    while (1)
    {
      if (*v16 != v8)
      {
        objc_enumerationMutation(accessories);
      }

      v10 = *(*(&v15 + 1) + 8 * v9);
      objc_opt_class();
      v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
      v12 = v11;

      if ([v12 matchesHAPAccessory:accessoryCopy])
      {
        break;
      }

      if (v7 == ++v9)
      {
        v7 = [accessories countByEnumeratingWithState:&v15 objects:v19 count:16];
        if (v7)
        {
          goto LABEL_3;
        }

        goto LABEL_12;
      }
    }
  }

  else
  {
LABEL_12:
    v12 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)hapAccessoryWithIdentifier:(id)identifier instanceID:(id)d
{
  v28 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  dCopy = d;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  accessories = [(HMDHome *)self accessories];
  v9 = [accessories countByEnumeratingWithState:&v23 objects:v27 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v24;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v24 != v11)
        {
          objc_enumerationMutation(accessories);
        }

        v13 = *(*(&v23 + 1) + 8 * i);
        identifier = [v13 identifier];
        v15 = [identifier isEqualToString:identifierCopy];

        if (v15)
        {
          v16 = v13;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v17 = v16;
          }

          else
          {
            v17 = 0;
          }

          v18 = v17;

          if (v18)
          {
            if (!dCopy)
            {
              goto LABEL_17;
            }

            hapInstanceId = [v18 hapInstanceId];
            v20 = [hapInstanceId isEqualToNumber:dCopy];

            if (v20)
            {
              goto LABEL_17;
            }
          }
        }
      }

      v10 = [accessories countByEnumeratingWithState:&v23 objects:v27 count:16];
    }

    while (v10);
  }

  v16 = 0;
LABEL_17:

  v21 = *MEMORY[0x277D85DE8];

  return v16;
}

- (id)hapAccessoryWithIdentifier:(id)identifier
{
  v3 = [(HMDHome *)self accessoryWithIdentifier:identifier];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (id)accessoryWithIdentifier:(id)identifier
{
  v19 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  accessories = [(HMDHome *)self accessories];
  v6 = [accessories countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v6)
  {
    v7 = *v15;
    do
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v15 != v7)
        {
          objc_enumerationMutation(accessories);
        }

        v9 = *(*(&v14 + 1) + 8 * i);
        identifier = [v9 identifier];
        if ([identifier isEqualToString:identifierCopy])
        {
          isPrimary = [v9 isPrimary];

          if (isPrimary)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        else
        {
        }
      }

      v6 = [accessories countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v6);
  }

LABEL_12:

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)_removeWithMergeSecondaryAccessory:(id)accessory removedFromBridgeAccessory:(id)bridgeAccessory completionHandler:(id)handler
{
  v13[1] = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  handlerCopy = handler;
  [bridgeAccessory removeHostedAccessory:accessoryCopy];
  [(HMDHome *)self removeAccessory:accessoryCopy];
  v10 = +[HMDBulletinBoard sharedBulletinBoard];
  [v10 removeBulletinsForAccessory:accessoryCopy];

  [(HMDHome *)self _reevaluateAccessoryInfoWithBadgeRefresh:1];
  if (handlerCopy)
  {
    v13[0] = accessoryCopy;
    v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
    handlerCopy[2](handlerCopy, v11, 0);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeWithMergeSecondaryAccessory:(id)accessory removedFromBridgeAccessory:(id)bridgeAccessory completionHandler:(id)handler
{
  accessoryCopy = accessory;
  bridgeAccessoryCopy = bridgeAccessory;
  handlerCopy = handler;
  workQueue = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __90__HMDHome_removeWithMergeSecondaryAccessory_removedFromBridgeAccessory_completionHandler___block_invoke;
  v15[3] = &unk_278689AB8;
  v15[4] = self;
  v16 = accessoryCopy;
  v17 = bridgeAccessoryCopy;
  v18 = handlerCopy;
  v12 = handlerCopy;
  v13 = bridgeAccessoryCopy;
  v14 = accessoryCopy;
  dispatch_async(workQueue, v15);
}

- (void)notifyOfNewlyAddedAccessoryByThisOwnerDevice:(id)device
{
  v17[1] = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = deviceCopy;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;
  if (v6)
  {
    v7 = v6;
    isOwnerUser = [(HMDHome *)self isOwnerUser];

    if (!isOwnerUser)
    {
      goto LABEL_13;
    }

    goto LABEL_12;
  }

  v9 = deviceCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = v9;
  }

  else
  {
    v10 = 0;
  }

  v11 = v10;

  if (v11)
  {
    isOwnerUser2 = [(HMDHome *)self isOwnerUser];

    if (isOwnerUser2)
    {
LABEL_12:
      notificationCenter = [(HMDHome *)self notificationCenter];
      v16 = @"HMDAccessoryNotificationKey";
      v17[0] = deviceCopy;
      v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:&v16 count:1];
      [notificationCenter postNotificationName:@"HMDHomeThisOwnerDeviceAddedAccessoryNotification" object:self userInfo:v14];
    }
  }

LABEL_13:

  v15 = *MEMORY[0x277D85DE8];
}

- (void)notifyOfAddedAccessory:(id)accessory
{
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __34__HMDHome_notifyOfAddedAccessory___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = accessoryCopy;
  v6 = accessoryCopy;
  dispatch_async(workQueue, v7);
}

void __34__HMDHome_notifyOfAddedAccessory___block_invoke(uint64_t a1)
{
  v6[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v1 = *(a1 + 40);
  v5[0] = @"HMDNotificationAddedAccessoryKey";
  v5[1] = @"HMDAccessoryKey";
  v6[0] = v1;
  v6[1] = v1;
  v3 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v6 forKeys:v5 count:2];
  logAndPostNotification(@"HMDNotificationHomeAddedAccessory", v2, v3);

  v4 = *MEMORY[0x277D85DE8];
}

- (void)notifyOfRemovedAccessory:(id)accessory source:(unint64_t)source
{
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __43__HMDHome_notifyOfRemovedAccessory_source___block_invoke;
  block[3] = &unk_278685DF8;
  block[4] = self;
  v10 = accessoryCopy;
  sourceCopy = source;
  v8 = accessoryCopy;
  dispatch_async(workQueue, block);
}

void __43__HMDHome_notifyOfRemovedAccessory_source___block_invoke(uint64_t a1)
{
  v9[4] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) notificationCenter];
  v4 = *(a1 + 32);
  v3 = *(a1 + 40);
  v8[0] = @"HMDAccessoryNotificationKey";
  v8[1] = @"HMDAccessoryKey";
  v9[0] = v3;
  v9[1] = v3;
  v9[2] = v4;
  v8[2] = @"HMDHomeKey";
  v8[3] = @"HMDNotificationSourceKey";
  v5 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 48)];
  v9[3] = v5;
  v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:v8 count:4];
  [v2 postNotificationName:@"HMDHomeAccessoryRemovedNotification" object:v4 userInfo:v6];

  v7 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveAccessoryModel:(id)model message:(id)message
{
  v77 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];

  if (uuid)
  {
    transactionResult = [messageCopy transactionResult];
    uuid2 = [modelCopy uuid];
    v11 = [(HMDHome *)self accessoryWithUUID:uuid2];

    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [modelCopy debugString:1];
      *buf = 138543618;
      v74 = v15;
      v75 = 2112;
      v76 = v16;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Going to remove accessory : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v17 = v11;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    if (v17)
    {
      if (isInternalBuild() && ([v17 shouldProcessTransactionRemoval] & 1) == 0)
      {
        v59 = objc_autoreleasePoolPush();
        v60 = selfCopy;
        v61 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v63 = v62 = v19;
          *buf = 138543362;
          v74 = v63;
          _os_log_impl(&dword_229538000, v61, OS_LOG_TYPE_ERROR, "%{public}@Failed to process transaction removal due to internal flag set to simulate this failure", buf, 0xCu);

          v19 = v62;
        }

        objc_autoreleasePoolPop(v59);
        [messageCopy respondWithSuccess];
        goto LABEL_34;
      }

      if ([v17 isPrimary])
      {
        v67 = v19;
        v20 = v17;
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();
        if (isKindOfClass)
        {
          v22 = v20;
        }

        else
        {
          v22 = 0;
        }

        v65 = v22;

        if (isKindOfClass)
        {
          mediaStateSubscriber = [(HMDHome *)selfCopy mediaStateSubscriber];
          [mediaStateSubscriber unsubscribeForAppleMediaStateForAccessory:v20 subscriptionToken:@"HMDHomeClientMediaStateRegistrationToken"];

          mediaStateSubscriber2 = [(HMDHome *)selfCopy mediaStateSubscriber];
          [mediaStateSubscriber2 localUnsubscribeForAppleMediaStateForAccessory:v20];
        }

        selfRemovalWatchdog = [(HMDHome *)selfCopy selfRemovalWatchdog];
        if (!selfRemovalWatchdog)
        {
          goto LABEL_21;
        }

        v26 = selfRemovalWatchdog;
        [v20 uuid];
        v27 = v64 = transactionResult;
        selfRemovalWatchdog2 = [(HMDHome *)selfCopy selfRemovalWatchdog];
        currentAccessoryUUID = [selfRemovalWatchdog2 currentAccessoryUUID];
        v30 = [v27 hmf_isEqualToUUID:currentAccessoryUUID];

        transactionResult = v64;
        if (v30)
        {
          selfRemovalWatchdog3 = [(HMDHome *)selfCopy selfRemovalWatchdog];
          v69[0] = MEMORY[0x277D85DD0];
          v69[1] = 3221225472;
          v69[2] = __47__HMDHome__handleRemoveAccessoryModel_message___block_invoke;
          v69[3] = &unk_278688D58;
          v69[4] = selfCopy;
          v70 = modelCopy;
          v71 = messageCopy;
          [selfRemovalWatchdog3 startWithCompletion:v69];
        }

        else
        {
LABEL_21:
          uuid3 = [modelCopy uuid];
          [(HMDHome *)selfCopy _removeAccessoryWithUUID:uuid3 message:messageCopy];
        }

        networkProtectionGroupRegistry = [(HMDHome *)selfCopy networkProtectionGroupRegistry];
        [networkProtectionGroupRegistry handleRemovedAccessory:v20];

        uuid4 = [v20 uuid];
        activeNetworkRouterUUID = [(HMDHome *)selfCopy activeNetworkRouterUUID];
        v40 = [uuid4 isEqual:activeNetworkRouterUUID];

        v19 = v67;
        if (v40)
        {
          [(HMDHome *)selfCopy _evaluateNetworkRouterManagementForTransaction:transactionResult];
        }

        bridge = v65;
      }

      else
      {
        bridge = [v19 bridge];
        [bridge removeHostedAccessory:v17];
        [(HMDHome *)selfCopy removeAccessory:v17];
        v72 = v17;
        v35 = [MEMORY[0x277CBEA60] arrayWithObjects:&v72 count:1];
        [(HMDHome *)selfCopy _removeAccessories:v35 message:0];
      }

      transactionResult2 = [messageCopy transactionResult];
      -[HMDHome notifyOfRemovedAccessory:source:](selfCopy, "notifyOfRemovedAccessory:source:", v17, [transactionResult2 source]);
      homeManager = [(HMDHome *)selfCopy homeManager];
      if ([v19 isPrimary])
      {
        matterNodeID = [v19 matterNodeID];
        unsignedIntValue = [matterNodeID unsignedIntValue];

        if (unsignedIntValue)
        {
          accessoryBrowser = [homeManager accessoryBrowser];
          chipAccessoryServerBrowser = [accessoryBrowser chipAccessoryServerBrowser];
          [v19 matterNodeID];
          v46 = v68 = v19;
          [(HMDHome *)selfCopy targetFabricUUID];
          v47 = messageCopy;
          v49 = v48 = transactionResult;
          [chipAccessoryServerBrowser handleHomeRemovedAccessoryWithNodeID:v46 fabricUUID:v49];

          transactionResult = v48;
          messageCopy = v47;

          v19 = v68;
        }
      }

      lastEventStoreController = [homeManager lastEventStoreController];
      uuid5 = [v17 uuid];
      [lastEventStoreController didRemoveAccessory:uuid5];
    }

    supportsAdaptiveTemperatureAutomations = [v19 supportsAdaptiveTemperatureAutomations];
    bOOLValue = [supportsAdaptiveTemperatureAutomations BOOLValue];

    if (bOOLValue)
    {
      v54 = objc_autoreleasePoolPush();
      v55 = selfCopy;
      v56 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
      {
        v57 = HMFGetLogIdentifier();
        *buf = 138543362;
        v74 = v57;
        _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - accessory removed", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v54);
      [(HMDHome *)v55 configureUserActivityStateDetectorManager];
    }

    [transactionResult markChanged];
    [transactionResult markSaveToAssistant];
LABEL_34:

    goto LABEL_35;
  }

  v32 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
  responseHandler = [messageCopy responseHandler];
  (responseHandler)[2](responseHandler, v32, 0);

LABEL_35:
  v58 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleRemoveAccessoryModel_message___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __47__HMDHome__handleRemoveAccessoryModel_message___block_invoke_2;
  block[3] = &unk_27868A010;
  v3 = *(a1 + 40);
  block[4] = *(a1 + 32);
  v5 = v3;
  v6 = *(a1 + 48);
  dispatch_async(v2, block);
}

void __47__HMDHome__handleRemoveAccessoryModel_message___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) setSelfRemovalWatchdog:0];
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) uuid];
  [v2 _removeAccessoryWithUUID:v3 message:*(a1 + 48)];
}

- (void)_handleRemoveAccessoryAfterUserConsent:(id)consent message:(id)message
{
  v38 = *MEMORY[0x277D85DE8];
  consentCopy = consent;
  messageCopy = message;
  if ([(HMDHome *)self isAdminUser])
  {
    administratorHandler = [(HMDHome *)self administratorHandler];
    if ([administratorHandler shouldRelayMessages] && (!isFeatureMatteriPhoneOnlyPairingControlEnabled() || -[HMDHome hasAnyResident](self, "hasAnyResident")))
    {
      v9 = objc_autoreleasePoolPush();
      selfCopy = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 138543362;
        v35 = v12;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Sending remove accessory request to owner / primary resident", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
      v13 = [messageCopy mutableCopy];
      [v13 setRemoteRestriction:9];
      v31[0] = MEMORY[0x277D85DD0];
      v31[1] = 3221225472;
      v31[2] = __58__HMDHome__handleRemoveAccessoryAfterUserConsent_message___block_invoke;
      v31[3] = &unk_278686658;
      v31[4] = selfCopy;
      v32 = consentCopy;
      v33 = messageCopy;
      [v13 setResponseHandler:v31];
      messageCopy = [v13 copy];
      v30 = 0;
      v14 = [administratorHandler operationForMessage:messageCopy error:&v30];
      v15 = v30;
      if (v14)
      {
        [administratorHandler addOperation:v14];
      }

      else
      {
        v24 = objc_autoreleasePoolPush();
        v25 = selfCopy;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
        {
          v27 = HMFGetLogIdentifier();
          *buf = 138543618;
          v35 = v27;
          v36 = 2112;
          v37 = v15;
          _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Failed to create home administrator configuration operation for accessory removal: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v24);
        v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
        [messageCopy respondWithError:v28];
      }
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543362;
        v35 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Removing accessory locally", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      [(HMDHome *)selfCopy2 __removeAccessory:consentCopy isBeingReplaced:0 isForceUpdate:0 message:messageCopy];
      [(HMDHome *)selfCopy2 _submitRemovalLogEventForAccessory:consentCopy isLocalRemoval:1 isLocalFallback:0 isDuplicate:0 duplicateCount:0 error:0];
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v35 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Not removing accessory due to insufficient privileges", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    administratorHandler = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    [messageCopy respondWithError:administratorHandler];
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)__removeAccessory:(char)accessory isBeingReplaced:(int)replaced isForceUpdate:(void *)update message:
{
  v65 = *MEMORY[0x277D85DE8];
  v8 = a2;
  updateCopy = update;
  v10 = updateCopy;
  selfCopy = self;
  if (self)
  {
    if (replaced)
    {
      untrustedClientIdentifier = [updateCopy untrustedClientIdentifier];
      v12 = [HMDBackingStoreTransactionOptions defaultXPCOptionsWithCDTransactionAuthor:10 clientIdentifier:untrustedClientIdentifier];
    }

    else
    {
      v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    }

    backingStore = [self backingStore];
    name = [v10 name];
    v38 = v12;
    v46 = [backingStore transaction:name options:v12];

    v40 = v8;
    v15 = [MEMORY[0x277CBEB18] arrayWithObject:v8];
    v59 = 0u;
    v60 = 0u;
    v61 = 0u;
    v62 = 0u;
    v16 = [v15 countByEnumeratingWithState:&v59 objects:v64 count:16];
    if (v16)
    {
      v17 = v16;
      v18 = *v60;
      do
      {
        for (i = 0; i != v17; ++i)
        {
          if (*v60 != v18)
          {
            objc_enumerationMutation(v15);
          }

          v20 = [*(*(&v59 + 1) + 8 * i) transactionWithObjectChangeType:3];
          [v46 add:v20 withMessage:v10];
        }

        v17 = [v15 countByEnumeratingWithState:&v59 objects:v64 count:16];
      }

      while (v17);
    }

    v39 = v10;
    group = dispatch_group_create();
    v55 = 0u;
    v56 = 0u;
    v57 = 0u;
    v58 = 0u;
    obj = v15;
    v21 = [obj countByEnumeratingWithState:&v55 objects:v63 count:16];
    if (v21)
    {
      v22 = v21;
      v23 = *v56;
      do
      {
        v24 = 0;
        v41 = v22;
        do
        {
          if (*v56 != v23)
          {
            objc_enumerationMutation(obj);
          }

          v25 = *(*(&v55 + 1) + 8 * v24);
          dispatch_group_enter(group);
          v49[0] = MEMORY[0x277D85DD0];
          v49[1] = 3221225472;
          v26 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke;
          v50 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke;
          v51 = &unk_27868A010;
          v52 = selfCopy;
          v53 = v25;
          v54 = group;
          v27 = selfCopy;
          v28 = v25;
          v29 = v46;
          v30 = v49;
          if ((accessory & 1) == 0)
          {
            v31 = v23;
            uuid = [v28 uuid];
            activeNetworkRouterUUID = [v27 activeNetworkRouterUUID];
            v34 = [uuid isEqual:activeNetworkRouterUUID];

            if (v34)
            {
              [v27 _updateActiveNetworkRouterAccessory:0 isReplacement:0 withTransaction:v29];
              [v27 _clearAccessoryNetworkProtectionStateWithTransaction:v29];
              [v27 _reconfigureAccessoriesOnRouterRemovalWithCompletion:v30];
              v23 = v31;
              v22 = v41;
              goto LABEL_22;
            }

            v26 = v50;
            v23 = v31;
            v22 = v41;
          }

          v26(v30);
LABEL_22:

          ++v24;
        }

        while (v22 != v24);
        v22 = [obj countByEnumeratingWithState:&v55 objects:v63 count:16];
      }

      while (v22);
    }

    workQueue = [selfCopy workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_3;
    block[3] = &unk_27868A728;
    v48 = v46;
    v36 = v46;
    dispatch_group_notify(group, workQueue, block);

    v10 = v39;
    v8 = v40;
  }

  v37 = *MEMORY[0x277D85DE8];
}

void __58__HMDHome__handleRemoveAccessoryAfterUserConsent_message___block_invoke(id *a1, void *a2, void *a3)
{
  v14 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (!v5)
  {
    [a1[4] _submitRemovalLogEventForAccessory:a1[5] isLocalRemoval:0 isLocalFallback:0 isDuplicate:0 duplicateCount:0 error:0];
  }

  if ([a1[4] shouldAccessoryRemovalFallbackToLocalRemovalOnError:v5 accessory:a1[5]])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = a1[4];
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove an apple media accessory via the primary resident. Removing it locally", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    [(HMDHome *)a1[4] __removeAccessory:0 isBeingReplaced:1 isForceUpdate:a1[6] message:?];
    [a1[4] _submitRemovalLogEventForAccessory:a1[5] isLocalRemoval:1 isLocalFallback:1 isDuplicate:0 duplicateCount:0 error:v5];
  }

  else
  {
    [a1[6] respondWithPayload:v6 error:v5];
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v7 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_2;
  v8 = &unk_27868A728;
  v9 = *(a1 + 48);
  v3 = v1;
  v4 = v2;
  v5 = v6;
  if (([v4 isPrimary] & 1) != 0 || objc_msgSend(v4, "conformsToProtocol:", &unk_283F01280) && objc_msgSend(v4, "supportsUserManagement"))
  {
    [v3 removeAllUsersAndCloudDataFromAccessory:v4 completionHandler:v5];
  }

  else
  {
    v7(v5);
  }
}

- (BOOL)shouldAccessoryRemovalFallbackToLocalRemovalOnError:(id)error accessory:(id)accessory
{
  errorCopy = error;
  accessoryCopy = accessory;
  if ([errorCopy isHMError] && objc_msgSend(errorCopy, "code") == 8 || objc_msgSend(errorCopy, "isHMFError") && objc_msgSend(errorCopy, "code") == 13 || objc_msgSend(errorCopy, "isHMError") && objc_msgSend(errorCopy, "code") == 91)
  {
    homeManager = [(HMDHome *)self homeManager];
    if ([homeManager isNetworkConnectionAvailable] && ((v9 = accessoryCopy, objc_opt_class(), (objc_opt_isKindOfClass() & 1) == 0) ? (v10 = 0) : (v10 = v9), v11 = v10, v9, v11))
    {
      owner = [(HMDHome *)self owner];
      isCurrentUser = [owner isCurrentUser];
    }

    else
    {
      isCurrentUser = 0;
    }
  }

  else
  {
    isCurrentUser = 0;
  }

  return isCurrentUser;
}

- (void)_handleRemoveAccessoryMessage:(id)message
{
  v66 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = [messageCopy uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v6)
  {
    v7 = [(HMDHome *)self accessoryWithUUID:v6];
    if (!v7)
    {
      v23 = objc_autoreleasePoolPush();
      selfCopy = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543618;
        v63 = v26;
        v64 = 2112;
        v65 = v6;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to find accessory with UUID: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v23);
      responseHandler = [messageCopy responseHandler];

      if (responseHandler)
      {
        v27 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        responseHandler2 = [messageCopy responseHandler];
        (responseHandler2)[2](responseHandler2, v27, 0);

        responseHandler = 0;
      }

      goto LABEL_21;
    }

    responseHandler = v7;
    if ([v7 isPrimary])
    {
      isRemote = [messageCopy isRemote];
      v10 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v12 = HMFGetOSLogHandle();
      v13 = os_log_type_enabled(v12, OS_LOG_TYPE_INFO);
      if (isRemote)
      {
        if (v13)
        {
          v14 = HMFGetLogIdentifier();
          *buf = 138543618;
          v63 = v14;
          v64 = 2112;
          v65 = responseHandler;
          _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Received remote request to remove accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v10);
        residentSyncManager = [(HMDHome *)selfCopy2 residentSyncManager];
        v59[0] = MEMORY[0x277D85DD0];
        v59[1] = 3221225472;
        v59[2] = __41__HMDHome__handleRemoveAccessoryMessage___block_invoke;
        v59[3] = &unk_2786858B0;
        responseHandler = responseHandler;
        v60 = responseHandler;
        v61 = selfCopy2;
        [residentSyncManager interceptRemoteResidentRequest:messageCopy proceed:v59];

        goto LABEL_21;
      }

      if (v13)
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543618;
        v63 = v36;
        v64 = 2112;
        v65 = responseHandler;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Received request to remove accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      if ([messageCopy isRemote] & 1) != 0 || (objc_msgSend(messageCopy, "isEntitledForSPIAccess"))
      {
        goto LABEL_27;
      }

      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __41__HMDHome__handleRemoveAccessoryMessage___block_invoke_1467;
      aBlock[3] = &unk_278685E48;
      aBlock[4] = selfCopy2;
      v57 = messageCopy;
      v37 = responseHandler;
      v58 = v37;
      v38 = _Block_copy(aBlock);
      uuid = [v37 uuid];
      activeNetworkRouterUUID = [(HMDHome *)selfCopy2 activeNetworkRouterUUID];
      v41 = [uuid isEqual:activeNetworkRouterUUID];

      if (v41)
      {
        accessoriesRequiringManualReconfigurationOnRouterRemoval = [(HMDHome *)selfCopy2 accessoriesRequiringManualReconfigurationOnRouterRemoval];
        v43 = [accessoriesRequiringManualReconfigurationOnRouterRemoval na_map:&__block_literal_global_1471];

        v44 = objc_autoreleasePoolPush();
        v45 = selfCopy2;
        v46 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
        {
          v47 = HMFGetLogIdentifier();
          *buf = 138543362;
          v63 = v47;
          _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_INFO, "%{public}@Requesting permission to remove active network router accessory", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v44);
        name2 = +[HMDUIDialogPresenter sharedUIDialogPresenter];
        name = [v37 name];
        uuid2 = [v37 uuid];
        workQueue2 = [(HMDHome *)v45 workQueue];
        [name2 requestUserPermissionForRemovalOfRouter:name accessoriesRequiringManualReconfiguration:v43 withContext:uuid2 queue:workQueue2 completionHandler:v38];
      }

      else
      {
        if ([v37 wiFiCredentialType] != 3)
        {

LABEL_27:
          [(HMDHome *)selfCopy2 _handleRemoveAccessoryAfterUserConsent:responseHandler message:messageCopy];
          goto LABEL_21;
        }

        v52 = objc_autoreleasePoolPush();
        v53 = selfCopy2;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_INFO))
        {
          v55 = HMFGetLogIdentifier();
          *buf = 138543362;
          v63 = v55;
          _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_INFO, "%{public}@Requesting permission to remove accessory with specific WiFi credential", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v52);
        v43 = +[HMDUIDialogPresenter sharedUIDialogPresenter];
        name2 = [v37 name];
        name = [v37 uuid];
        uuid2 = [(HMDHome *)v53 workQueue];
        [v43 requestUserPermissionForRemovalOfSpecificWiFiCredentialedAccessory:name2 withContext:name queue:uuid2 completionHandler:v38];
      }

      responseHandler = v37;
      goto LABEL_21;
    }

    v29 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543618;
      v63 = v32;
      v64 = 2112;
      v65 = responseHandler;
      _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@cannot remove bridged accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v29);
    responseHandler3 = [messageCopy responseHandler];

    if (!responseHandler3)
    {
      goto LABEL_21;
    }

    responseHandler4 = [messageCopy responseHandler];
    v34 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:34 userInfo:0];
    (responseHandler4)[2](responseHandler4, v34, 0);

LABEL_20:
LABEL_21:

    goto LABEL_22;
  }

  v16 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
  {
    v19 = HMFGetLogIdentifier();
    messagePayload = [messageCopy messagePayload];
    *buf = 138543618;
    v63 = v19;
    v64 = 2112;
    v65 = messagePayload;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEFAULT, "%{public}@Missing target accessory UUID from message payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v16);
  responseHandler5 = [messageCopy responseHandler];

  if (responseHandler5)
  {
    responseHandler = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    responseHandler4 = [messageCopy responseHandler];
    (responseHandler4)[2](responseHandler4, responseHandler, 0);
    goto LABEL_20;
  }

LABEL_22:

  v35 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleRemoveAccessoryMessage___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if ([*(a1 + 32) isCurrentAccessory] && objc_msgSend(*(a1 + 40), "isCurrentDevicePrimaryResident"))
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 40);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v14 = 138543362;
      v15 = v7;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Processing self removal from home", &v14, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v8 = [HMDSelfRemovalWatchdog alloc];
    v9 = [*(a1 + 32) uuid];
    v10 = [*(a1 + 40) workQueue];
    v11 = [(HMDSelfRemovalWatchdog *)v8 initWithCurrentAccessoryUUID:v9 workQueue:v10];
    [*(a1 + 40) setSelfRemovalWatchdog:v11];

    v12 = [*(a1 + 40) selfRemovalWatchdog];
    [v12 configure];
  }

  [(HMDHome *)*(a1 + 40) __removeAccessory:0 isBeingReplaced:0 isForceUpdate:v3 message:?];

  v13 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleRemoveAccessoryMessage___block_invoke_1467(uint64_t a1, int a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (a2)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@User canceled consent for removing accessory", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    [v9 respondWithError:v10];
  }

  else
  {
    if (v7)
    {
      v11 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v11;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@User accepted consent for removing accessory", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 32) _handleRemoveAccessoryAfterUserConsent:*(a1 + 48) message:*(a1 + 40)];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleRemoveAccessoryMessage:(id)message
{
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __40__HMDHome_handleRemoveAccessoryMessage___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = messageCopy;
  v6 = messageCopy;
  dispatch_async(workQueue, v7);
}

- (void)handleRemoveAccessory:(id)accessory completion:(id)completion
{
  v27[1] = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v7 = MEMORY[0x277D0F848];
  accessoryCopy = accessory;
  v9 = [v7 alloc];
  v10 = *MEMORY[0x277CD24F0];
  v11 = objc_alloc(MEMORY[0x277D0F820]);
  uuid = [(HMDHome *)self uuid];
  v13 = [v11 initWithTarget:uuid];
  v26 = *MEMORY[0x277CCF0B0];
  uuid2 = [accessoryCopy uuid];

  uUIDString = [uuid2 UUIDString];
  v27[0] = uUIDString;
  v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v17 = [v9 initWithName:v10 destination:v13 payload:v16];

  [v17 setRemoteRestriction:9];
  v21 = MEMORY[0x277D85DD0];
  v22 = 3221225472;
  v23 = __44__HMDHome_handleRemoveAccessory_completion___block_invoke;
  v24 = &unk_2786818D0;
  v25 = completionCopy;
  v18 = completionCopy;
  [v17 setResponseHandler:&v21];
  if ([(HMDHome *)self isCurrentDevicePrimaryResident:v21]|| isFeatureMatteriPhoneOnlyPairingControlEnabled() && ![(HMDHome *)self hasAnyResident])
  {
    [(HMDHome *)self handleRemoveAccessoryMessage:v17];
  }

  else
  {
    residentSyncManager = [(HMDHome *)self residentSyncManager];
    [residentSyncManager performResidentRequest:v17 options:0];
  }

  v20 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome_handleRemoveAccessory_completion___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  v3 = _Block_copy(*(a1 + 32));
  v4 = v3;
  if (v3)
  {
    (*(v3 + 2))(v3, v5);
  }
}

- (void)__handleAddMediaAccessoryModel:(id)model message:(id)message
{
  v81 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v8 = HMFGetOSLogHandle();
  if (os_signpost_enabled(v8))
  {
    uuid = [modelCopy uuid];
    parentUUID = [modelCopy parentUUID];
    bsoRecord = [modelCopy bsoRecord];
    recordID = [bsoRecord recordID];
    recordName = [recordID recordName];
    v14 = recordName;
    v15 = &stru_283CF9D50;
    *buf = 138412802;
    v76 = uuid;
    if (recordName)
    {
      v15 = recordName;
    }

    v77 = 2112;
    v78 = parentUUID;
    v79 = 2112;
    v80 = v15;
    _os_signpost_emit_with_name_impl(&dword_229538000, v8, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "AddMediaAccessoryModel", "Identifier=%{signpost.description:attribute}@ parentUUID=%{signpost.description:attribute}@ recordName=%{signpost.description:attribute}@ ", buf, 0x20u);
  }

  v16 = objc_autoreleasePoolPush();
  selfCopy = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    uuid2 = [modelCopy uuid];
    *buf = 138543618;
    v76 = v19;
    v77 = 2112;
    v78 = uuid2;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Creating new media accessory from model with UUID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v16);
  v21 = modelCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v22 = v21;
  }

  else
  {
    v22 = 0;
  }

  v23 = v22;

  v24 = v21;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v25 = v24;
  }

  else
  {
    v25 = 0;
  }

  v26 = v25;

  if (v23)
  {
    v27 = [[HMDAppleMediaAccessory alloc] initWithTransaction:v23 home:selfCopy];
    isCurrentDevicePrimaryResident = 0;
    if (!v27)
    {
      goto LABEL_31;
    }

    goto LABEL_18;
  }

  if (v26)
  {
    v29 = [[HMDAirPlayAccessory alloc] initWithTransaction:v26 home:selfCopy];
    isCurrentDevicePrimaryResident = [(HMDHome *)selfCopy isCurrentDevicePrimaryResident];
    workQueue = [(HMDHome *)selfCopy workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke;
    block[3] = &unk_27868A750;
    block[4] = selfCopy;
    v27 = v29;
    v73 = v27;
    dispatch_async(workQueue, block);

    if (!v27)
    {
      goto LABEL_31;
    }

LABEL_18:
    v62 = v26;
    v63 = v24;
    v31 = v27;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v33 = v31;
    }

    else
    {
      v33 = 0;
    }

    v34 = v33;

    [(HMDAppleMediaAccessory *)v34 setDataSource:selfCopy];
    [(HMDHome *)selfCopy addAccessory:v31];
    homeManager = [(HMDHome *)selfCopy homeManager];
    uuid3 = [(HMDAccessory *)v31 uuid];
    v37 = [homeManager accessorySetupMetricDispatcherForAccessoryUUID:uuid3];

    [v37 markAccessoryAddCompleted];
    _hasConfirmedPrimaryResidentDevice = [(HMDHome *)selfCopy _hasConfirmedPrimaryResidentDevice];

    if (_hasConfirmedPrimaryResidentDevice)
    {
      [v37 markPrimaryResidentChanged];
      remoteEventRouterClientController = [(HMDHome *)selfCopy remoteEventRouterClientController];
      isPrimaryResidentClientConnected = [remoteEventRouterClientController isPrimaryResidentClientConnected];

      if (isPrimaryResidentClientConnected)
      {
        [v37 markEventRouterPrimaryClientConnectStatusChanged:1];
      }
    }

    v60 = v37;
    v41 = dispatch_group_create();
    msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
    [(HMDAppleMediaAccessory *)v31 configureWithHome:selfCopy msgDispatcher:msgDispatcher configurationTracker:v41 initialConfiguration:0];

    homeManager2 = [(HMDHome *)selfCopy homeManager];
    if ((isKindOfClass & 1) != 0 && [(HMDAppleMediaAccessory *)v31 isCurrentAccessory])
    {
      currentAccessorySetupMetricDispatcher = [homeManager2 currentAccessorySetupMetricDispatcher];
      [currentAccessorySetupMetricDispatcher markSetupBeginStage:7 error:0];
    }

    v74 = v31;
    v45 = [MEMORY[0x277CBEA60] arrayWithObjects:&v74 count:{1, v60}];
    identifier = [messageCopy identifier];
    [(HMDHome *)selfCopy addNewlyConfiguredAccessories:v45 addSessionIdentifier:identifier];

    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    [transactionResult markSaveToAssistant];
    workQueue2 = [(HMDHome *)selfCopy workQueue];
    v64[0] = MEMORY[0x277D85DD0];
    v64[1] = 3221225472;
    v64[2] = __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke_1465;
    v64[3] = &unk_2786834F8;
    v64[4] = selfCopy;
    v65 = v31;
    v66 = messageCopy;
    v67 = v23;
    v68 = v34;
    v71 = isCurrentDevicePrimaryResident;
    v69 = homeManager2;
    v70 = transactionResult;
    v49 = v23;
    v50 = transactionResult;
    v51 = homeManager2;
    v52 = v34;
    v53 = v31;
    dispatch_group_notify(v41, workQueue2, v64);

    v23 = v49;
    v26 = v62;
    v24 = v63;
    goto LABEL_31;
  }

  v54 = objc_autoreleasePoolPush();
  v55 = selfCopy;
  v56 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v56, OS_LOG_TYPE_DEFAULT))
  {
    v57 = HMFGetLogIdentifier();
    *buf = 138543618;
    v76 = v57;
    v77 = 2112;
    v78 = v24;
    _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_DEFAULT, "%{public}@Invalid WHA accessory: %@", buf, 0x16u);

    v23 = 0;
  }

  objc_autoreleasePoolPop(v54);
LABEL_31:
  v58 = HMFGetOSLogHandle();
  if (os_signpost_enabled(v58))
  {
    *buf = 0;
    _os_signpost_emit_with_name_impl(&dword_229538000, v58, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "AddMediaAccessoryModel", "", buf, 2u);
  }

  v59 = *MEMORY[0x277D85DE8];
}

uint64_t __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 40) shortDescription];
    v11 = 138543618;
    v12 = v5;
    v13 = 2112;
    v14 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Going to schedule key roll operation for device if necessary for airplay accessory: %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = [*(a1 + 32) homeManager];
  v8 = [v7 bgOpsManager];
  [v8 scheduleHH2KeyRollForAirPlayAccessory:*(a1 + 40)];

  result = [HMDBackgroundOperationManagerHelper auditSharedUserEntriesInDatabaseForAccessory:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];
  return result;
}

void __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke_1465(uint64_t a1)
{
  v83 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessoryBrowser];
  v3 = [*(a1 + 40) identifier];
  [v2 registerPairedAccessory:v3 transports:objc_msgSend(*(a1 + 40) setupHash:"supportedTransports") delegate:{0, *(a1 + 32)}];

  v70 = 0u;
  v71 = 0u;
  v68 = 0u;
  v69 = 0u;
  v4 = [*(a1 + 32) accessoryBrowser];
  v5 = [v4 mediaBrowser];
  v6 = [v5 accessoryAdvertisements];

  v7 = [v6 countByEnumeratingWithState:&v68 objects:v82 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v69;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v69 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v68 + 1) + 8 * i);
        v12 = [v11 identifier];
        v13 = [*(a1 + 40) identifier];
        v14 = [v12 isEqualToString:v13];

        if (v14)
        {
          [*(a1 + 40) addAdvertisement:v11];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v68 objects:v82 count:16];
    }

    while (v8);
  }

  [*(a1 + 32) _reachabilityChangedForAccessory:*(a1 + 40) reachable:{objc_msgSend(*(a1 + 40), "isReachable")}];
  if ([*(a1 + 32) remoteAccessIsEnabled])
  {
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 32);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [*(a1 + 40) name];
      *buf = 138543618;
      *&buf[4] = v18;
      v76 = 2112;
      v77 = v19;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ setting remote access enabled", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    [*(a1 + 40) remoteAccessEnabled:1];
  }

  v20 = [*(a1 + 48) transactionResult];
  v21 = [v20 source];

  v22 = objc_autoreleasePoolPush();
  v23 = *(a1 + 32);
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
  {
    v25 = HMFGetLogIdentifier();
    v26 = [*(a1 + 40) shortDescription];
    [*(a1 + 32) isCurrentDeviceConfirmedPrimaryResident];
    v27 = HMFBooleanToString();
    *buf = 138544130;
    *&buf[4] = v25;
    v76 = 2112;
    v77 = v26;
    v78 = 2048;
    v79 = v21;
    v80 = 2112;
    v81 = v27;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Apple media accessory %@ being added to home - source %tu. IsPrimary: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v22);
  if (*(a1 + 56) && [*(a1 + 40) isCurrentAccessory])
  {
    v28 = objc_autoreleasePoolPush();
    v29 = *(a1 + 32);
    v30 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
    {
      v31 = HMFGetLogIdentifier();
      v32 = *(a1 + 40);
      *buf = 138543618;
      *&buf[4] = v31;
      v76 = 2112;
      v77 = v32;
      _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Setting up media session for current accessory during add - %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v28);
    v33 = [*(a1 + 32) _addMediaSessionForCurrentAccessory:*(a1 + 40)];
  }

  v34 = *(a1 + 64);
  if (v34)
  {
    [v34 configureAudioDestinationController];
    if ([*(a1 + 64) isCurrentAccessory])
    {
      v35 = [*(a1 + 32) accessoryBrowser];
      [v35 resetUnassociatedCurrentAccessory];

      [*(a1 + 32) createRemoteEventRouterServerIfNeeded];
      v36 = [*(a1 + 32) notificationCenter];
      v37 = *(a1 + 32);
      v38 = *(a1 + 64);
      v73 = @"HMDAccessoryNotificationKey";
      v74 = v38;
      v39 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v74 forKeys:&v73 count:1];
      [v36 postNotificationName:@"HMDHomeManagerDidAddCurrentAccessoryNotification" object:v37 userInfo:v39];

      v40 = [*(a1 + 72) currentAccessorySetupMetricDispatcher];
      [v40 markSetupEndStage:7 error:0];
    }

    v41 = *(a1 + 32);
    v72 = *(a1 + 64);
    v42 = [MEMORY[0x277CBEA60] arrayWithObjects:&v72 count:1];
    [v41 configureRemoteEventRouterClientControllerForAccessories:v42];

    v43 = [*(a1 + 32) capabilitiesAggregator];
    v44 = [*(a1 + 64) uuid];
    [v43 didAddAccessory:v44];

    v45 = *(a1 + 32);
    v46 = *(a1 + 64);
    v47 = v46;
    if (v45 && [v46 isHomePod] && objc_msgSend(v45, "isCurrentDevicePrimaryResident"))
    {
      v48 = [v45 fetchedAccessorySettingsSubscriber];
      v49 = [v47 uuid];
      *buf = v49;
      v50 = [MEMORY[0x277CBEA60] arrayWithObjects:buf count:1];
      [v48 subscribeToSettingsForAccessoryUUIDs:v50];
    }

    v51 = [*(a1 + 32) notificationRegistrationsForAppleMediaAccessories];
    v52 = [v51 count];

    if (v52)
    {
      v53 = [*(a1 + 32) mediaStateSubscriber];
      [v53 subscribeForAppleMediaStateForAccessory:*(a1 + 64) subscriptionToken:@"HMDHomeClientMediaStateRegistrationToken"];
    }

    v54 = [*(a1 + 32) mediaStateSubscriber];
    [v54 localSubscribeForAppleMediaStateForAccessory:*(a1 + 64)];
  }

  if ([*(a1 + 40) isCurrentAccessory])
  {
    v55 = objc_autoreleasePoolPush();
    v56 = *(a1 + 32);
    v57 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
    {
      v58 = HMFGetLogIdentifier();
      *buf = 138543362;
      *&buf[4] = v58;
      _os_log_impl(&dword_229538000, v57, OS_LOG_TYPE_INFO, "%{public}@Notifying that we are a reachable accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v55);
    v59 = [*(a1 + 32) notificationCenter];
    [v59 postNotificationName:@"HMDHomeCurrentDeviceHasReachableAccessories" object:*(a1 + 32)];

    v60 = *(a1 + 64);
    if (v60)
    {
      [v60 configureSensors];
    }
  }

  if (*(a1 + 88) == 1)
  {
    v61 = [*(a1 + 32) residentDeviceManager];
    [v61 confirmWithCompletionHandler:0];
  }

  v62 = *(a1 + 32);
  v63 = [*(a1 + 48) identifier];
  v64 = [v62 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v63];

  if ([*(a1 + 80) source] == 1)
  {
    [*(a1 + 32) _notifyClientOfNewlyAddedAccessories:v64 requestMessage:*(a1 + 48)];
    [*(a1 + 32) notifyOfNewlyAddedAccessoryByThisOwnerDevice:*(a1 + 40)];
  }

  else
  {
    [*(a1 + 48) respondWithPayload:0];
  }

  v65 = [*(a1 + 32) accessoryBrowser];
  v66 = [*(a1 + 40) identifier];
  [v65 removeUnassociatedAccessoryWithIdentifier:v66];

  [*(a1 + 32) notifyOfAddedAccessory:*(a1 + 40)];
  v67 = *MEMORY[0x277D85DE8];
}

- (void)__handleAddHAPAccessoryModel:(id)model message:(id)message
{
  v95 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  supportsNativeMatter = [modelCopy supportsNativeMatter];
  bOOLValue = [supportsNativeMatter BOOLValue];

  if (!bOOLValue)
  {
    bridgeUUID = [modelCopy bridgeUUID];
    if (!bridgeUUID)
    {
      goto LABEL_5;
    }

    v11 = objc_alloc(MEMORY[0x277CCAD78]);
    bridgeUUID2 = [modelCopy bridgeUUID];
    v13 = [v11 initWithUUIDString:bridgeUUID2];
    v14 = [(HMDHome *)self accessoryWithUUID:v13];

    if (!v14)
    {
      v56 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v58 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v59 = HMFGetLogIdentifier();
        bridgeUUID3 = [modelCopy bridgeUUID];
        uuid = [modelCopy uuid];
        *buf = 138543874;
        v86 = v59;
        v87 = 2112;
        v88 = bridgeUUID3;
        v89 = 2112;
        v90 = uuid;
        _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_ERROR, "%{public}@No bridge accessory %@ for added bridged accessory %@", buf, 0x20u);
      }
    }

    else
    {
LABEL_5:
      hostAccessoryUUID = [modelCopy hostAccessoryUUID];
      if (!hostAccessoryUUID)
      {
        goto LABEL_7;
      }

      v16 = objc_alloc(MEMORY[0x277CCAD78]);
      hostAccessoryUUID2 = [modelCopy hostAccessoryUUID];
      v18 = [v16 initWithUUIDString:hostAccessoryUUID2];
      v19 = [(HMDHome *)self accessoryWithUUID:v18];

      if (v19)
      {
LABEL_7:
        v20 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          v23 = HMFGetLogIdentifier();
          uuid2 = [modelCopy uuid];
          name = [modelCopy name];
          uniqueIdentifier = [modelCopy uniqueIdentifier];
          shortDescription = [messageCopy shortDescription];
          *buf = 138544386;
          v86 = v23;
          v87 = 2112;
          v88 = uuid2;
          v89 = 2112;
          v90 = name;
          v91 = 2112;
          v92 = uniqueIdentifier;
          v93 = 2112;
          v94 = shortDescription;
          _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Creating new HAP accessory from model with UUID %@/%@/%@ from message: %@", buf, 0x34u);
        }

        objc_autoreleasePoolPop(v20);
        v28 = [[HMDHAPAccessory alloc] initWithTransaction:modelCopy home:selfCopy2];
        if (v28)
        {
          configurationTracker = [modelCopy configurationTracker];
          if (!configurationTracker)
          {
            configurationTracker = dispatch_group_create();
          }

          notificationRegistrations = [(HMDHome *)selfCopy2 notificationRegistrations];
          v31 = [notificationRegistrations count];
          v32 = v31 != 0;

          uuidToHAPAccessoryConfigTable = [(HMDHome *)selfCopy2 uuidToHAPAccessoryConfigTable];
          uuid3 = [modelCopy uuid];
          v35 = [uuidToHAPAccessoryConfigTable objectForKey:uuid3];

          if (v35)
          {
            uuidToHAPAccessoryConfigTable2 = [(HMDHome *)selfCopy2 uuidToHAPAccessoryConfigTable];
            uuid4 = [modelCopy uuid];
            [uuidToHAPAccessoryConfigTable2 removeObjectForKey:uuid4];

            dispatch_group_enter(configurationTracker);
            workQueue = [(HMDHome *)selfCopy2 workQueue];
            v82[0] = MEMORY[0x277D85DD0];
            v82[1] = 3221225472;
            v82[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke;
            v82[3] = &unk_27868A728;
            v83 = configurationTracker;
            [(HMDHAPAccessory *)v28 configureWithAccessory:v35 homeNotificationsEnabled:v31 != 0 queue:workQueue completion:v82];
          }

          if ([(HMDHAPAccessory *)v28 isPrimary])
          {
            name2 = [messageCopy name];
            v40 = [name2 isEqualToString:*MEMORY[0x277CD2070]];

            if ((v40 & 1) == 0)
            {
              [(HMDHAPAccessory *)v28 savePublicKeyToKeychain];
            }

            identifier = [(HMDAccessory *)v28 identifier];
            supportedTransports = [(HMDHAPAccessory *)v28 supportedTransports];
            setupHash = [(HMDHAPAccessory *)v28 setupHash];
            [(HMDHome *)selfCopy2 _registerPairedAccessory:identifier transports:supportedTransports setupHash:setupHash];
          }

          [(HMDHome *)selfCopy2 addAccessory:v28];
          msgDispatcher = [(HMDHome *)selfCopy2 msgDispatcher];
          [(HMDHAPAccessory *)v28 configureWithHome:selfCopy2 msgDispatcher:msgDispatcher configurationTracker:configurationTracker initialConfiguration:0];

          v84 = v28;
          v45 = [MEMORY[0x277CBEA60] arrayWithObjects:&v84 count:1];
          identifier2 = [messageCopy identifier];
          [(HMDHome *)selfCopy2 addNewlyConfiguredAccessories:v45 addSessionIdentifier:identifier2];

          accessoryBrowser = [(HMDHome *)selfCopy2 accessoryBrowser];
          [accessoryBrowser evaluateAccessoryDiscoveryState];

          matterNodeID = [(HMDHAPAccessory *)v28 matterNodeID];
          if (matterNodeID)
          {
            matterNodeID2 = [(HMDHAPAccessory *)v28 matterNodeID];
            v50 = [matterNodeID2 isEqual:&unk_283E71A20];

            if ((v50 & 1) == 0)
            {
              if ((isFeatureMatteriPhoneOnlyPairingControlEnabled() & 1) != 0 || (-[HMDHome featuresDataSource](selfCopy2, "featuresDataSource"), v51 = objc_claimAutoreleasedReturnValue(), v52 = [v51 isRVCEnabled], v51, v52))
              {
                objc_initWeak(buf, selfCopy2);
                v79[0] = MEMORY[0x277D85DD0];
                v79[1] = 3221225472;
                v79[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1460;
                v79[3] = &unk_278687540;
                objc_copyWeak(&v81, buf);
                v80 = v28;
                [(HMDHome *)selfCopy2 setUpSharedUserFabricDataWithForceFetch:0 completion:v79];

                objc_destroyWeak(&v81);
                objc_destroyWeak(buf);
              }
            }
          }

          transactionResult = [messageCopy transactionResult];
          [transactionResult markChanged];
          [transactionResult markSaveToAssistant];
          workQueue2 = [(HMDHome *)selfCopy2 workQueue];
          block[0] = MEMORY[0x277D85DD0];
          block[1] = 3221225472;
          block[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_2;
          block[3] = &unk_2786899C8;
          block[4] = selfCopy2;
          v75 = v28;
          v76 = messageCopy;
          v77 = v35;
          v78 = v32;
          v55 = v35;
          dispatch_group_notify(configurationTracker, workQueue2, block);
        }

        else
        {
          v62 = objc_autoreleasePoolPush();
          v63 = selfCopy2;
          v64 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v64, OS_LOG_TYPE_ERROR))
          {
            v65 = HMFGetLogIdentifier();
            uuid5 = [modelCopy uuid];
            uUIDString = [uuid5 UUIDString];
            *buf = 138543618;
            v86 = v65;
            v87 = 2112;
            v88 = uUIDString;
            _os_log_impl(&dword_229538000, v64, OS_LOG_TYPE_ERROR, "%{public}@Unable to create accessory from object (null accessory) %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v62);
          responseHandler = [messageCopy responseHandler];
          v69 = responseHandler == 0;

          if (v69)
          {
            goto LABEL_32;
          }

          configurationTracker = [messageCopy responseHandler];
          transactionResult = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
          (*(configurationTracker + 16))(configurationTracker, transactionResult, 0);
        }

LABEL_32:
        goto LABEL_36;
      }

      v56 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v58 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v70 = HMFGetLogIdentifier();
        hostAccessoryUUID3 = [modelCopy hostAccessoryUUID];
        uuid6 = [modelCopy uuid];
        *buf = 138543874;
        v86 = v70;
        v87 = 2112;
        v88 = hostAccessoryUUID3;
        v89 = 2112;
        v90 = uuid6;
        _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_ERROR, "%{public}@No host accessory %@ for added hosted accessory %@", buf, 0x20u);
      }
    }

    objc_autoreleasePoolPop(v56);
    goto LABEL_36;
  }

  [(HMDHome *)self handleAddMatterAccessoryModel:modelCopy message:messageCopy];
LABEL_36:

  v73 = *MEMORY[0x277D85DE8];
}

void __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1460(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v2 = [WeakRetained homeManager];
  v3 = [v2 accessoryBrowser];
  v4 = [v3 chipAccessoryServerBrowser];
  v5 = [*(a1 + 32) matterNodeID];
  v6 = [WeakRetained targetFabricUUID];
  [v4 handleHomeAddedAccessoryWithNodeID:v5 fabricUUID:v6 localControl:{objc_msgSend(WeakRetained, "isCurrentDevicePrimaryResident")}];
}

void __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_2(uint64_t a1)
{
  v46 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) remoteAccessIsEnabled])
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 32);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 40) shortDescription];
      *buf = 138543618;
      *&buf[4] = v5;
      v42 = 2112;
      v43 = v6;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@accessory %@ setting remote access enabled", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) remoteAccessEnabled:1];
  }

  [*(a1 + 32) _reachabilityChangedForAccessory:*(a1 + 40) reachable:{objc_msgSend(*(a1 + 40), "isReachable")}];
  v7 = [*(a1 + 48) transactionResult];
  v8 = [v7 source];

  if ([*(a1 + 40) isPrimary])
  {
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [*(a1 + 40) shortDescription];
      v14 = *(a1 + 56);
      *buf = 138543874;
      *&buf[4] = v12;
      v42 = 2112;
      v43 = v13;
      v44 = 2112;
      v45 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@accessory %@ handling added primary HAPAccessory: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    if (!*(a1 + 56))
    {
      v15 = [*(a1 + 40) identifier];
      *buf = 0;
      [*(a1 + 40) matchesHAPAccessoryWithServerIdentifier:v15 linkType:buf];
      v16 = [*(a1 + 32) accessoryBrowser];
      [v16 handleNewlyPairedAccessory:v15 linkType:*buf];

      isWatch();
      [*(a1 + 32) __requestAccessoryBrowsing];
    }

    v17 = [*(a1 + 32) accessoryBrowser];
    v18 = [*(a1 + 40) identifier];
    [v17 removeUnassociatedAccessoryWithIdentifier:v18];

    v19 = [*(a1 + 32) networkProtectionGroupRegistry];
    [v19 handleAddedAccessory:*(a1 + 40)];
  }

  v20 = *(a1 + 56);
  if (v20)
  {
    [*(a1 + 40) enableNotificationsWithHAPAccessory:v20 homeNotificationsEnabled:*(a1 + 64)];
  }

  else if (*(a1 + 64) == 1)
  {
    v21 = *(a1 + 32);
    v40 = *(a1 + 40);
    v22 = [MEMORY[0x277CBEA60] arrayWithObjects:&v40 count:1];
    [v21 _subscribeForHomeNotificationsFromRemoteGateway:1 accessories:v22];
  }

  if (*(a1 + 56))
  {
    logAndPostNotification(@"HMDAccessoryConnectedNotification", *(a1 + 40), 0);
    [*(a1 + 40) updateLightProfilesSettings];
  }

  v23 = [*(a1 + 48) name];
  if ([v23 isEqualToString:*MEMORY[0x277CD2070]])
  {
  }

  else
  {
    v24 = [*(a1 + 48) name];
    v25 = [v24 isEqualToString:@"HMDRemoteAddHAPAccessoriesMessage"];

    if ((v25 & 1) == 0)
    {
      v26 = *(a1 + 32);
      v27 = [*(a1 + 48) identifier];
      v28 = [v26 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v27];

      [*(a1 + 48) respondWithPayload:0];
    }
  }

  if (v8 == 1)
  {
    [*(a1 + 32) notifyOfNewlyAddedAccessoryByThisOwnerDevice:*(a1 + 40)];
  }

  [*(a1 + 32) notifyOfAddedAccessory:*(a1 + 40)];
  [*(a1 + 32) reevaluateAccessoryInfo];
  v29 = [*(a1 + 40) supportsAdaptiveTemperatureAutomations];
  v30 = [v29 BOOLValue];

  if (v30)
  {
    v31 = objc_autoreleasePoolPush();
    v32 = *(a1 + 32);
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543362;
      *&buf[4] = v34;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - accessory added", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v31);
    [*(a1 + 32) configureUserActivityStateDetectorManager];
  }

  if ([*(a1 + 40) isPrimary])
  {
    v35 = [*(a1 + 32) workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1461;
    block[3] = &unk_27868A750;
    v36 = *(a1 + 40);
    block[4] = *(a1 + 32);
    v39 = v36;
    dispatch_async(v35, block);
  }

  v37 = *MEMORY[0x277D85DE8];
}

uint64_t __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1461(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 40) shortDescription];
    v11 = 138543618;
    v12 = v5;
    v13 = 2112;
    v14 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Going to schedule key roll operation for device if necessary for accessory: %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = [*(a1 + 32) homeManager];
  v8 = [v7 bgOpsManager];
  [v8 scheduleHH2KeyRollForAccessory:*(a1 + 40)];

  result = [HMDBackgroundOperationManagerHelper auditSharedUserEntriesInDatabaseForAccessory:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)__requestAccessoryBrowsing
{
  homeManager = [(HMDHome *)self homeManager];
  [homeManager setAccessoryBrowsingRequested];
  [homeManager requestAccessoryBrowsing];
}

- (void)_handleAddAccessoryModel:(id)model message:(id)message
{
  v32 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = modelCopy;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;
  v10 = modelCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v10;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;

  identifier = [v10 identifier];

  if (!identifier)
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      uuid = [v10 uuid];
      uUIDString = [uuid UUIDString];
      v28 = 138543618;
      v29 = v17;
      v30 = 2112;
      v31 = uUIDString;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Unable to create accessory from object (null identifier) %@", &v28, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [messageCopy respondWithError:v20];
    goto LABEL_13;
  }

  if (v9)
  {
    [(HMDHome *)self __handleAddHAPAccessoryModel:v9 message:messageCopy];
    goto LABEL_16;
  }

  if (v12)
  {
    [(HMDHome *)self __handleAddMediaAccessoryModel:v12 message:messageCopy];
    goto LABEL_16;
  }

  v22 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
  {
    v25 = HMFGetLogIdentifier();
    v28 = 138543362;
    v29 = v25;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Only HAP accessories can be added to the home currently", &v28, 0xCu);
  }

  objc_autoreleasePoolPop(v22);
  responseHandler = [messageCopy responseHandler];

  if (responseHandler)
  {
    v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    responseHandler2 = [messageCopy responseHandler];
    (responseHandler2)[2](responseHandler2, v20, 0);

LABEL_13:
  }

LABEL_16:

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserConsentResponseForAccessory:(id)accessory
{
  v35 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  if ([accessoryCopy isEntitledForSPIAccess])
  {
    v5 = [accessoryCopy dataForKey:*MEMORY[0x277CD1F90]];
    v30 = 0;
    v6 = [(HMDHome *)self _setupDescriptionFromData:v5 error:&v30];
    v7 = v30;
    if (v6)
    {
      v8 = [accessoryCopy numberForKey:*MEMORY[0x277CD06B0]];
      if (v8)
      {
        addPendingAccessories = [(HMDHome *)self addPendingAccessories];
        v10 = [addPendingAccessories objectForKey:v6];

        integerValue = [v8 integerValue];
        if (integerValue > 1)
        {
          if ((integerValue & 0xFFFFFFFFFFFFFFFELL) == 2)
          {
            [(HMDHome *)self _handleUserConsentForAccessoryReplacement:v6 consent:integerValue == 3 message:v10];
          }

          else
          {
            v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];

            v7 = v26;
          }
        }

        else
        {
          v12 = integerValue == 1;
          accessoryBrowser = [(HMDHome *)self accessoryBrowser];
          [accessoryBrowser didReceiveUserConsentResponseForSetupAccessoryDetail:v6 consent:v12];
        }

        responseHandler = [accessoryCopy responseHandler];

        if (responseHandler)
        {
          responseHandler2 = [accessoryCopy responseHandler];
          (responseHandler2)[2](responseHandler2, v7, 0);
        }
      }

      else
      {
        v22 = objc_autoreleasePoolPush();
        selfCopy = self;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          *buf = 138543362;
          v32 = v25;
          _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@user consent response is absent", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v22);
      }
    }

    else
    {
      v18 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543618;
        v32 = v21;
        v33 = 2112;
        v34 = v7;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v32 = v17;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI for user consent response", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserConsentForAccessoryReplacement:(id)replacement consent:(BOOL)consent message:(id)message
{
  v36 = *MEMORY[0x277D85DE8];
  replacementCopy = replacement;
  messageCopy = message;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_INFO);
  if (consent)
  {
    if (v13)
    {
      v14 = HMFGetLogIdentifier();
      name = [messageCopy name];
      identifier = [messageCopy identifier];
      messagePayload = [messageCopy messagePayload];
      v28 = 138544130;
      v29 = v14;
      v30 = 2112;
      v31 = name;
      v32 = 2112;
      v33 = identifier;
      v34 = 2112;
      v35 = messagePayload;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@User consented to Wi-Fi router replacement; continue to adding new Wi-Fi router - message %@/%@/%@", &v28, 0x2Au);
    }

    objc_autoreleasePoolPop(v10);
    [replacementCopy setUserConsentedForReplace:1];
    accessoryUUID = [replacementCopy accessoryUUID];

    if (accessoryUUID)
    {
      accessoryUUID2 = [replacementCopy accessoryUUID];
      [(HMDHome *)selfCopy _continuePairingAfterUserConsentWithAccessoryUUID:accessoryUUID2 orUnassociatedAccessory:0 message:messageCopy];
    }

    else
    {
      [(HMDHome *)selfCopy _continuePairingAfterUserConsentWithAccessoryDescription:replacementCopy progressHandlerDelegate:0 message:messageCopy];
    }
  }

  else
  {
    if (v13)
    {
      v20 = HMFGetLogIdentifier();
      name2 = [messageCopy name];
      identifier2 = [messageCopy identifier];
      messagePayload2 = [messageCopy messagePayload];
      v28 = 138544130;
      v29 = v20;
      v30 = 2112;
      v31 = name2;
      v32 = 2112;
      v33 = identifier2;
      v34 = 2112;
      v35 = messagePayload2;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@User did not consent to Wi-Fi router replacement; cancelling adding new Wi-Fi router - message %@/%@/%@", &v28, 0x2Au);
    }

    objc_autoreleasePoolPop(v10);
    v24 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:1091];
    v25 = [HMDMatterAccessoryPairingEndContext hmContextWithCancelledError:v24];
    [(HMDHome *)selfCopy _cancelPairingWithAccessoryDescription:replacementCopy context:v25];

    v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    [messageCopy respondWithError:v26];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_performRemoteAddHAPAccessories:(id)accessories
{
  v44 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    shortDescription = [accessoriesCopy shortDescription];
    *buf = 138543618;
    *&buf[4] = v8;
    v42 = 2112;
    v43 = shortDescription;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@performRemoteAddHAPAccessories: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  messagePayload = [accessoriesCopy messagePayload];
  v11 = [messagePayload objectForKey:@"HMDSerializedAccessoriesMessageKey"];

  if (v11)
  {
    v12 = [HMDStructuredReader readerFromObjectWithExtendedTypes:v11];
    v13 = HMDRemoteAddCodingModel();
    v14 = [v13 decodeRootObjectFromReader:v12];

    if (v14)
    {
      v15 = [accessoriesCopy dictionaryForKey:@"HMDUpdatedHomeInfoMessageKey"];
      v16 = objc_alloc(MEMORY[0x277D0F7A8]);
      workQueue = [(HMDHome *)selfCopy workQueue];
      v18 = [v16 initWithQueue:workQueue];

      wiFiRouterAccessories = [(HMDHome *)selfCopy wiFiRouterAccessories];
      *buf = _HMFThreadLocalAsyncContextPush();
      v20 = [(HMDHome *)selfCopy _addAccessoriesUsingPrimaryAccessoryModel:v14 updatedHomeInfo:v15 message:accessoriesCopy];
      v37[0] = MEMORY[0x277D85DD0];
      v37[1] = 3221225472;
      v37[2] = __43__HMDHome__performRemoteAddHAPAccessories___block_invoke;
      v37[3] = &unk_278686878;
      v37[4] = selfCopy;
      v21 = accessoriesCopy;
      v38 = v21;
      v22 = wiFiRouterAccessories;
      v39 = v22;
      v40 = v14;
      v23 = [v20 then:v37];
      v35[0] = MEMORY[0x277D85DD0];
      v35[1] = 3221225472;
      v35[2] = __43__HMDHome__performRemoteAddHAPAccessories___block_invoke_2;
      v35[3] = &unk_278689CD8;
      v36 = v21;
      v24 = [v23 recover:v35];

      _HMFThreadLocalAsyncContextPop();
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      v30 = selfCopy;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        error = [v12 error];
        *buf = 138543618;
        *&buf[4] = v32;
        v42 = 2112;
        v43 = error;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Failed to deserialize accessories in remote add request: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v29);
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [accessoriesCopy respondWithError:v15];
    }
  }

  else
  {
    v25 = objc_autoreleasePoolPush();
    v26 = selfCopy;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543362;
      *&buf[4] = v28;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Received a nil serialized accessories value in remote add message payload", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v25);
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [accessoriesCopy respondWithError:v12];
  }

  v34 = *MEMORY[0x277D85DE8];
}

uint64_t __43__HMDHome__performRemoteAddHAPAccessories___block_invoke(uint64_t a1, void *a2)
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = *(a1 + 32);
  v5 = [*(a1 + 40) identifier];
  v6 = [v4 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v5];

  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [*(a1 + 40) shortDescription];
    *buf = 138543874;
    v35 = v10;
    v36 = 2112;
    v37 = v6;
    v38 = 2112;
    v39 = v11;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Retrieved and reset newly configured accessories: %@. Message: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  [*(a1 + 32) _setupActiveNetworkRouterAccessory:v6 existingRouterAccessories:*(a1 + 48)];
  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  v12 = v6;
  v13 = [v12 countByEnumeratingWithState:&v29 objects:v33 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v30;
    do
    {
      v16 = 0;
      do
      {
        if (*v30 != v15)
        {
          objc_enumerationMutation(v12);
        }

        v17 = *(*(&v29 + 1) + 8 * v16);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v18 = v17;
        }

        else
        {
          v18 = 0;
        }

        v19 = v18;

        [v19 autoConfigureTargetController];
        ++v16;
      }

      while (v14 != v16);
      v14 = [v12 countByEnumeratingWithState:&v29 objects:v33 count:16];
    }

    while (v14);
  }

  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __43__HMDHome__performRemoteAddHAPAccessories___block_invoke_1451;
  v27[3] = &unk_278677308;
  v28 = *(a1 + 56);
  v20 = [v12 hmf_objectPassingTest:v27];
  if ([v20 requiresWaitingToBecomeReachableAfterRemoteAdd])
  {
    v21 = [HMDRemotelyAddedAccessoryReachabilityObserver alloc];
    v22 = *(a1 + 40);
    v23 = [*(a1 + 32) workQueue];
    v24 = [(HMDRemotelyAddedAccessoryReachabilityObserver *)v21 initWithAccessory:v20 message:v22 workQueue:v23];

    [(HMDRemotelyAddedAccessoryReachabilityObserver *)v24 start];
  }

  else
  {
    [*(a1 + 40) respondWithSuccess];
  }

  v25 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __43__HMDHome__performRemoteAddHAPAccessories___block_invoke_1451(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [*(a1 + 32) modelID];
  v5 = [v3 isEqual:v4];

  return v5;
}

- (void)_handleRemoteAddHAPAccessories:(id)accessories
{
  accessoriesCopy = accessories;
  [(HMDHome *)self updateCATIDForUsersIfNeeded:1];
  residentSyncManager = [(HMDHome *)self residentSyncManager];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __42__HMDHome__handleRemoteAddHAPAccessories___block_invoke;
  v6[3] = &unk_27868A398;
  v6[4] = self;
  [residentSyncManager interceptRemoteResidentRequest:accessoriesCopy proceed:v6];
}

- (void)_pairAccessoryWithAccessoryDescription:(id)description configuration:(id)configuration pairingEvent:(id)event progressHandler:(id)handler requestMessage:(id)message
{
  handlerCopy = handler;
  configurationCopy = configuration;
  descriptionCopy = description;
  v16 = __createAccessoryBrowserAddAccessoryCompletionHandler(self, descriptionCopy, configurationCopy, event, message);
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  [accessoryBrowser pairAccessoryWithDescription:descriptionCopy configuration:configurationCopy progressHandler:handlerCopy completionHandler:v16];
}

- (void)_continuePairingAfterUserConsentWithAccessoryDescription:(id)description progressHandlerDelegate:(id)delegate message:(id)message
{
  v59 = *MEMORY[0x277D85DE8];
  descriptionCopy = description;
  delegateCopy = delegate;
  messageCopy = message;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543618;
    *&buf[4] = v13;
    *&buf[12] = 2112;
    *&buf[14] = descriptionCopy;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Continue pairing after user consent with accessoryDescription %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  v14 = objc_alloc_init(HMDUnpairedHAPAccessoryConfiguration);
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setRequiresUserConsent:1];
  homeLocationHandler = [(HMDHome *)selfCopy homeLocationHandler];
  isoCountryCode = [homeLocationHandler isoCountryCode];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setIsoCountryCode:isoCountryCode];

  matterFabricID = [(HMDHome *)selfCopy matterFabricID];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setChipFabricID:matterFabricID];

  uuid = [(HMDHome *)selfCopy uuid];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setHomeUUID:uuid];

  v19 = [HMDAccessoryPairingEvent pairingAccessoryWithDescription:descriptionCopy home:selfCopy];
  if ([v19 isMatterAccessory])
  {
    notifyMatterMetricPairingStep(selfCopy, 2uLL);
  }

  setupAccessoryPayload = [descriptionCopy setupAccessoryPayload];
  v20 = objc_alloc(MEMORY[0x277D0F770]);
  v21 = MEMORY[0x277CCACA8];
  v22 = MEMORY[0x22AAD2510](selfCopy, a2);
  12372 = [v21 stringWithFormat:@"%@, %s:%ld", v22, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 12372];
  v24 = [v20 initWithName:12372];

  v45 = v24;
  [descriptionCopy accessoryUUID];

  [setupAccessoryPayload categoryNumber];
  [v19 linkType];
  v25 = HAPLinkTypeDescription();
  [v19 communicationProtocol];
  v26 = HAPCommunicationProtocolDescription();
  [setupAccessoryPayload supportsWAC];
  v27 = HMFBooleanToString();
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 requiresUserConsent];
  v28 = HMFBooleanToString();
  v29 = HMDNetworkRouterSupportAsString([(HMDHome *)selfCopy networkRouterSupport]);
  v30 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome networkRouterSupportDisableReason](selfCopy, "networkRouterSupportDisableReason")}];
  [descriptionCopy appIdentifier];

  [v19 isThreadAccessory];
  v31 = HMFBooleanToString();

  if (delegateCopy)
  {
    v32 = delegateCopy;
    if (selfCopy)
    {
      objc_initWeak(&location, selfCopy);
      *buf = MEMORY[0x277D85DD0];
      *&buf[8] = 3221225472;
      *&buf[16] = __74__HMDHome_createLocalAddAccessoryProgressHandler_progressHandlerDelegate___block_invoke;
      v55 = &unk_27866FC88;
      objc_copyWeak(&v56[8], &location);
      *v56 = v32;
      v41 = _Block_copy(buf);

      objc_destroyWeak(&v56[8]);
      objc_destroyWeak(&location);
    }

    else
    {
      v41 = 0;
    }
  }

  else
  {
    v41 = HMDHomeCreateAddAccessoryProgressHandler(selfCopy, descriptionCopy, messageCopy);
  }

  v33 = objc_autoreleasePoolPush();
  v34 = selfCopy;
  v35 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
  {
    v36 = HMFGetLogIdentifier();
    [descriptionCopy supportsWAC];
    v37 = HMFBooleanToString();
    v38 = HMDNetworkRouterSupportAsString([(HMDHome *)v34 networkRouterSupport]);
    [(HMDHome *)v34 networkRouterSupportDisableReason];
    v39 = HMNetworkRouterSupportDisableReasonAsString();
    *buf = 138544386;
    *&buf[4] = v36;
    *&buf[12] = 2112;
    *&buf[14] = descriptionCopy;
    *&buf[22] = 2112;
    v55 = v37;
    *v56 = 2112;
    *&v56[2] = v38;
    v57 = 2112;
    v58 = v39;
    _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Adding unpaired accessory with description: %@, supports WAC: %@, network router support: %@ (Reason: %@)", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v33);
  if ([descriptionCopy supportsWAC] && (-[HMDHome networkRouterSupport](v34, "networkRouterSupport") & 8) != 0)
  {
    v46[0] = MEMORY[0x277D85DD0];
    v46[1] = 3221225472;
    v46[2] = __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke;
    v46[3] = &unk_27866FD78;
    v46[4] = v34;
    v47 = v45;
    v48 = descriptionCopy;
    v49 = v19;
    v50 = messageCopy;
    v51 = v14;
    v52 = v41;
    [(HMDHome *)v34 _createUniquePSKClientConfigurationWithRequestMessage:v50 pairingEvent:v49 completion:v46];
  }

  else
  {
    [v45 begin];
    *buf = v45;
    [(HMDHome *)v34 _pairAccessoryWithAccessoryDescription:descriptionCopy configuration:v14 pairingEvent:v19 progressHandler:v41 requestMessage:messageCopy];
    __HMFActivityScopeLeave();
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke_2;
  block[3] = &unk_278681528;
  v11 = a1[5];
  v12 = a1[6];
  v13 = v6;
  v14 = a1[4];
  v15 = a1[7];
  v16 = a1[8];
  v17 = a1[9];
  v18 = v5;
  v19 = a1[10];
  v8 = v5;
  v9 = v6;
  dispatch_async(v7, block);
}

void __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke_2(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 40);
  v3 = *(a1 + 32);
  [v2 accessoryUUID];

  [*(a1 + 48) domain];
  [*(a1 + 48) code];

  v4 = *(a1 + 48) == 0;
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 56);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *v15 = 138543362;
      *&v15[4] = v13;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Client configuration with WiFi unique PSK created successfully", v15, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 80) setNetworkCredential:*(a1 + 88)];
    [*(a1 + 64) setUsedWiFiPPSK:1];
    [*(a1 + 32) begin];
    *v15 = *(a1 + 32);
    [*(a1 + 56) _pairAccessoryWithAccessoryDescription:*(a1 + 40) configuration:*(a1 + 80) pairingEvent:*(a1 + 64) progressHandler:*(a1 + 96) requestMessage:*(a1 + 72)];
    __HMFActivityScopeLeave();
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 40);
      v11 = *(a1 + 48);
      *v15 = 138543874;
      *&v15[4] = v9;
      v16 = 2112;
      v17 = v10;
      v18 = 2112;
      v19 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate WiFi credential for accessory %@ with error: %@", v15, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v12 = [*(a1 + 56) logEventSubmitter];
    [v12 submitLogEvent:*(a1 + 64) error:*(a1 + 48)];

    [*(a1 + 72) respondWithError:*(a1 + 48)];
    [*(a1 + 56) _removePendingAccessoryAdd:*(a1 + 40)];
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __74__HMDHome_createLocalAddAccessoryProgressHandler_progressHandlerDelegate___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v7 = objc_autoreleasePoolPush();
  v8 = WeakRetained;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = HMSetupAccessoryProgressAsString();
    v16 = 138543618;
    v17 = v10;
    v18 = 2112;
    v19 = v11;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Local add accessory progress handler called with progress: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  if (v8)
  {
    if (*(a1 + 32))
    {
      v12 = [v5 accessoryUUID];

      if (a2 == 6)
      {
        if (v12)
        {
          v13 = *(a1 + 32);
          v14 = [v5 accessoryUUID];
          [v13 localAccessoryAddRequiresConsent:v14];
        }
      }
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessoryWithDescription:(id)description
{
  v19 = *MEMORY[0x277D85DE8];
  descriptionCopy = description;
  v5 = [descriptionCopy dataForKey:*MEMORY[0x277CD1F90]];
  v14 = 0;
  v6 = [(HMDHome *)self _setupDescriptionFromData:v5 error:&v14];
  v7 = v14;
  if (v6)
  {
    [(HMDHome *)&self->super.super.isa _handleAddAccessoryWithDescription:v6 progressHandlerDelegate:0 message:descriptionCopy];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v16 = v11;
      v17 = 2112;
      v18 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [descriptionCopy respondWithError:v12];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessoryWithDescription:(void *)description progressHandlerDelegate:(void *)delegate message:
{
  v59 = *MEMORY[0x277D85DE8];
  v7 = a2;
  descriptionCopy = description;
  delegateCopy = delegate;
  v10 = delegateCopy;
  if (self)
  {
    if (([delegateCopy isEntitledForSPIAccess] & 1) == 0)
    {
      v30 = objc_autoreleasePoolPush();
      selfCopy = self;
      v32 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        v33 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v33;
        _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v30);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [v10 respondWithError:v16];
      goto LABEL_32;
    }

    accessories = [self accessories];
    v12 = [accessories count];
    v13 = maximumAccessoriesPerHome;

    if (v12 >= v13)
    {
      v34 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
      {
        v37 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v37;
        _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_INFO, "%{public}@Can't add additional accessories; already at maximum accessories for home", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v34);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
      [v10 respondWithError:v16];
      goto LABEL_32;
    }

    v52 = 0;
    v14 = [self _shouldAllowAddingAccessoryWithDescription:v7 requestMessage:v10 error:&v52];
    v15 = v52;
    v16 = v15;
    if (v14)
    {
      goto LABEL_5;
    }

    domain = [v15 domain];
    if ([domain isEqualToString:*MEMORY[0x277CCFD28]])
    {
      v39 = [v16 code] == 97;

      if (v39)
      {
LABEL_5:
        appIdentifier = [v7 appIdentifier];
        v18 = appIdentifier == 0;

        if (v18)
        {
          clientIdentifier = [v10 clientIdentifier];
          v20 = clientIdentifier;
          if (clientIdentifier)
          {
            v21 = clientIdentifier;
          }

          else
          {
            v21 = &stru_283CF9D50;
          }

          [v7 updateAppIdentifier:v21];
        }

        os_unfair_recursive_lock_lock_with_options();
        [self[149] setObject:v10 forKey:v7];
        os_unfair_recursive_lock_unlock();
        accessoryBrowser = [self accessoryBrowser];
        v23 = [accessoryBrowser unpairedHAPAccessoryWithAccessoryDescription:v7];

        uuid = [v23 uuid];
        v25 = HMDHomeCreateAddAccessoryProgressHandler(self, v7, v10);

        accessoryBrowser2 = [self accessoryBrowser];
        uuid2 = [v23 uuid];
        [accessoryBrowser2 registerProgressHandler:v25 unpairedAccessoryUUID:uuid2];

        if (v14)
        {
          accessoryUUID = [v7 accessoryUUID];

          if (accessoryUUID)
          {
            accessoryUUID2 = [v7 accessoryUUID];
            [self _continuePairingAfterUserConsentWithAccessoryUUID:accessoryUUID2 orUnassociatedAccessory:0 message:v10];
          }

          else
          {
            [self _continuePairingAfterUserConsentWithAccessoryDescription:v7 progressHandlerDelegate:descriptionCopy message:v10];
          }
        }

        else
        {
          category = [v23 category];
          v41 = category == 0;

          if (v41)
          {
            setupAccessoryPayload = [v7 setupAccessoryPayload];
            categoryNumber = [setupAccessoryPayload categoryNumber];
          }

          else
          {
            categoryNumber = 0;
          }

          v50 = [[HMDAddAccessoryProgressState alloc] initWithUnpairedAccessory:v23 server:0 categoryIdentifier:categoryNumber certificationStatus:0];
          (v25)[2](v25, 9, v50);
        }

LABEL_32:
        goto LABEL_33;
      }
    }

    else
    {
    }

    v43 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
    {
      v46 = HMFGetLogIdentifier();
      category2 = [v7 category];
      localizedDescription = [category2 localizedDescription];
      *buf = 138543874;
      v54 = v46;
      v55 = 2112;
      v56 = localizedDescription;
      v57 = 2112;
      v58 = v16;
      _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_INFO, "%{public}@Cannot add an accessory of category '%@', error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v43);
    [v10 respondWithError:v16];
    goto LABEL_32;
  }

LABEL_33:

  v51 = *MEMORY[0x277D85DE8];
}

- (void)_addMediaAccessory:(id)accessory message:(id)message
{
  v45 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  messageCopy = message;
  if (self && ([accessoryCopy identifier], v8 = objc_claimAutoreleasedReturnValue(), v9 = objc_msgSend(v8, "isEqualToString:", @"00000000-0000-0000-0000-C2EE6102B308"), v8, v9))
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v13;
      *&buf[12] = 2112;
      *&buf[14] = accessoryCopy;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@The accessory %@ has an unknown media route identifier", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:9001];
    [messageCopy respondWithError:v14];
  }

  else
  {
    v35 = 0;
    v36 = &v35;
    v37 = 0x2020000000;
    v38 = 0;
    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v42 = __Block_byref_object_copy__14759;
    v43 = __Block_byref_object_dispose__14760;
    v44 = 0;
    appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __38__HMDHome__addMediaAccessory_message___block_invoke;
    v31[3] = &unk_27866FD50;
    v16 = accessoryCopy;
    v32 = v16;
    v33 = &v35;
    v34 = buf;
    [appleMediaAccessories na_each:v31];

    if (v36[3] >= 1)
    {
      v17 = *(*&buf[8] + 40);
      if (v17)
      {
        [HMDHome _submitRemovalLogEventForAccessory:"_submitRemovalLogEventForAccessory:isLocalRemoval:isLocalFallback:isDuplicate:duplicateCount:error:" isLocalRemoval:v17 isLocalFallback:0 isDuplicate:0 duplicateCount:1 error:?];
      }
    }

    homeManager = [(HMDHome *)self homeManager];
    uuid = [v16 uuid];
    v20 = [homeManager accessorySetupMetricDispatcherForAccessoryUUID:uuid];

    serialNumber = [v16 serialNumber];
    [v20 markRemoteAccessoryAddWillStart:serialNumber];

    administratorHandler = [(HMDHome *)self administratorHandler];
    LODWORD(uuid) = [administratorHandler shouldRelayMessages];

    if (uuid)
    {
      v23 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        v26 = HMFGetLogIdentifier();
        *v39 = 138543362;
        v40 = v26;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@This is not the primary resident, so sending the add media accessory request to primary", v39, 0xCu);
      }

      objc_autoreleasePoolPop(v23);
      v28[0] = MEMORY[0x277D85DD0];
      v28[1] = 3221225472;
      v28[2] = __38__HMDHome__addMediaAccessory_message___block_invoke_1434;
      v28[3] = &unk_27868A010;
      v28[4] = selfCopy2;
      v29 = v16;
      v30 = messageCopy;
      [(HMDHome *)selfCopy2 _remotelyAddMediaAccessory:v29 usingRemoteMessageName:@"HMDRemoteAddMediaAccessoryRequestMessage" message:v30 fallbackBlock:v28];
    }

    else
    {
      [(HMDHome *)self _locallyAddMediaAccessory:v16 message:messageCopy];
    }

    _Block_object_dispose(buf, 8);
    _Block_object_dispose(&v35, 8);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__addMediaAccessory_message___block_invoke(uint64_t a1, void *a2)
{
  v7 = a2;
  if ([v7 isHomePod])
  {
    v4 = [*(a1 + 32) serialNumber];
    v5 = [v7 serialNumber];
    v6 = [v4 isEqualToString:v5];

    if (v6)
    {
      ++*(*(*(a1 + 40) + 8) + 24);
      objc_storeStrong((*(*(a1 + 48) + 8) + 40), a2);
    }
  }
}

- (void)_remotelyAddMediaAccessory:(void *)accessory usingRemoteMessageName:(void *)name message:(void *)message fallbackBlock:
{
  v73 = *MEMORY[0x277D85DE8];
  v9 = a2;
  accessoryCopy = accessory;
  nameCopy = name;
  messageCopy = message;
  if (self)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v70 = v15;
      v71 = 2112;
      v72 = v9;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEFAULT, "%{public}@Remotely adding unassociated media accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v66 = 0;
    v16 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v9 requiringSecureCoding:1 error:&v66];
    v17 = v66;
    if (v16)
    {
      v18 = MEMORY[0x277CCAAB0];
      uUID = [MEMORY[0x277CCAD78] UUID];
      v65 = v17;
      v20 = [v18 archivedDataWithRootObject:uUID requiringSecureCoding:1 error:&v65];
      v21 = v65;

      if (v20)
      {
        v22 = selfCopy[27];
        if (os_signpost_enabled(v22))
        {
          v23 = v22;
          uuid = [v9 uuid];
          *buf = 138412290;
          v70 = uuid;
          _os_signpost_emit_with_name_impl(&dword_229538000, v23, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "RemotelyAddAccessory", "accessoryUUID=%{signpost.description:attribute}@ ", buf, 0xCu);
        }

        v55 = v20;
        homeManager = [selfCopy homeManager];
        v56 = v9;
        uuid2 = [v9 uuid];
        v27 = [homeManager accessorySetupMetricDispatcherForAccessoryUUID:uuid2];

        [v27 markRemoteAccessoryAddStarted];
        v28 = [nameCopy mutableCopy];
        [v28 setName:accessoryCopy];
        identifier = [nameCopy identifier];
        [v28 setIdentifier:identifier];

        untrustedClientIdentifier = [nameCopy untrustedClientIdentifier];

        v57 = messageCopy;
        v31 = v16;
        if (untrustedClientIdentifier)
        {
          v67 = *MEMORY[0x277D0F1D0];
          untrustedClientIdentifier2 = [nameCopy untrustedClientIdentifier];
          v68 = untrustedClientIdentifier2;
          v33 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v68 forKeys:&v67 count:1];
          [v28 setHeaders:v33];
        }

        else
        {
          [v28 setHeaders:MEMORY[0x277CBEC10]];
        }

        v42 = [HMDRemoteHomeMessageDestination alloc];
        destination = [nameCopy destination];
        target = [destination target];
        uuid3 = [selfCopy uuid];
        v46 = [(HMDRemoteHomeMessageDestination *)v42 initWithTarget:target homeUUID:uuid3 queueTimeout:&unk_283E75E88];
        [v28 setDestination:v46];

        messagePayload = [nameCopy messagePayload];
        v48 = [messagePayload mutableCopy];

        v54 = v31;
        [v48 setObject:v31 forKey:@"kAccessoryEncodedMediaAccessoryKey"];
        [v48 setObject:v55 forKey:@"HMDEncodedResidentUUIDKey"];
        v49 = [v48 copy];
        [v28 setMessagePayload:v49];

        v59[0] = MEMORY[0x277D85DD0];
        v59[1] = 3221225472;
        v59[2] = __83__HMDHome__remotelyAddMediaAccessory_usingRemoteMessageName_message_fallbackBlock___block_invoke;
        v59[3] = &unk_278681920;
        v59[4] = selfCopy;
        v60 = v27;
        v9 = v56;
        v61 = v56;
        v62 = nameCopy;
        v63 = v57;
        v64 = 0xEEEEB0B5B2B2EEEELL;
        v50 = v27;
        [v28 setResponseHandler:v59];
        residentSyncManager = [selfCopy residentSyncManager];
        v52 = [v28 copy];
        [residentSyncManager performResidentRequest:v52 options:0];

        messageCopy = v57;
        v16 = v54;

        v20 = v55;
      }

      else
      {
        v38 = objc_autoreleasePoolPush();
        v39 = selfCopy;
        v40 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
        {
          v41 = HMFGetLogIdentifier();
          *buf = 138543618;
          v70 = v41;
          v71 = 2112;
          v72 = v21;
          _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_ERROR, "%{public}@Failed to encode uuid for remotely add accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v38);
        v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
        [nameCopy respondWithError:v28];
      }

      v17 = v21;
    }

    else
    {
      v34 = objc_autoreleasePoolPush();
      v35 = selfCopy;
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
      {
        v37 = HMFGetLogIdentifier();
        *buf = 138543618;
        v70 = v37;
        v71 = 2112;
        v72 = v17;
        _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_ERROR, "%{public}@Unable to encode media accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v34);
      v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [nameCopy respondWithError:v20];
    }
  }

  v53 = *MEMORY[0x277D85DE8];
}

- (void)_locallyAddMediaAccessory:(void *)accessory message:
{
  v58 = *MEMORY[0x277D85DE8];
  v41 = a2;
  accessoryCopy = accessory;
  if (self)
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      shortDescription = [accessoryCopy shortDescription];
      [selfCopy isCurrentDevicePrimaryResident];
      v11 = HMFBooleanToString();
      *buf = 138544130;
      v51 = v9;
      v52 = 2112;
      v53 = v41;
      v54 = 2112;
      v55 = shortDescription;
      v56 = 2112;
      v57 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Performing local add of media accessory: %@. Message: %@ - isPrimaryResident: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v6);
    v12 = HMFGetOSLogHandle();
    if (os_signpost_enabled(v12))
    {
      uuid = [v41 uuid];
      *buf = 138412290;
      v51 = uuid;
      _os_signpost_emit_with_name_impl(&dword_229538000, v12, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "AddAccessory", "accessoryUUID=%{signpost.description:attribute}@ ", buf, 0xCu);
    }

    homeManager = [selfCopy homeManager];
    uuid2 = [v41 uuid];
    v39 = [homeManager accessorySetupMetricDispatcherForAccessoryUUID:uuid2];

    [v39 markLocalAccessoryAddStarted];
    v40 = [v41 addTransactionForHome:selfCopy];
    roomForEntireHome = [selfCopy roomForEntireHome];
    uuid3 = [roomForEntireHome uuid];
    uUIDString = [uuid3 UUIDString];
    [v40 setRoomUUID:uUIDString];

    untrustedClientIdentifier = [accessoryCopy untrustedClientIdentifier];
    v38 = [HMDBackingStoreTransactionOptions defaultXPCOptionsWithClientIdentifier:untrustedClientIdentifier];

    backingStore = [selfCopy backingStore];
    name = [accessoryCopy name];
    v22 = [backingStore transaction:name options:v38];

    objc_initWeak(&location, selfCopy);
    v23 = [accessoryCopy mutableCopy];
    v24 = MEMORY[0x277CCAAB0];
    uUID = [MEMORY[0x277CCAD78] UUID];
    v48 = 0;
    v26 = [v24 archivedDataWithRootObject:uUID requiringSecureCoding:1 error:&v48];
    v37 = v48;

    if (v26)
    {
      messagePayload = [accessoryCopy messagePayload];
      v28 = [messagePayload mutableCopy];

      [v28 setObject:v26 forKey:@"HMDEncodedResidentUUIDKey"];
      v29 = [v28 copy];
      [v23 setMessagePayload:v29];

      v44[0] = MEMORY[0x277D85DD0];
      v44[1] = 3221225472;
      v44[2] = __45__HMDHome__locallyAddMediaAccessory_message___block_invoke;
      v44[3] = &unk_278689460;
      v45 = accessoryCopy;
      objc_copyWeak(&v47, &location);
      v30 = v41;
      v46 = v30;
      [v23 setResponseHandler:v44];
      v31 = [v23 copy];
      [v22 add:v40 withMessage:v31];

      v42[0] = MEMORY[0x277D85DD0];
      v42[1] = 3221225472;
      v42[2] = __45__HMDHome__locallyAddMediaAccessory_message___block_invoke_2;
      v42[3] = &unk_27868A1D8;
      v42[4] = selfCopy;
      v43 = v30;
      [v22 run:v42];
      if (os_signpost_enabled(v12))
      {
        *buf = 0;
        _os_signpost_emit_with_name_impl(&dword_229538000, v12, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "AddAccessory", "", buf, 2u);
      }

      objc_destroyWeak(&v47);
    }

    else
    {
      v32 = objc_autoreleasePoolPush();
      v33 = selfCopy;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543618;
        v51 = v35;
        v52 = 2112;
        v53 = v37;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Failed to encode uuid for locally add accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v32);
      v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [accessoryCopy respondWithError:v28];
    }

    objc_destroyWeak(&location);
  }

  v36 = *MEMORY[0x277D85DE8];
}

void __45__HMDHome__locallyAddMediaAccessory_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    [a1[4] respondWithError:v5];
  }

  else
  {
    WeakRetained = objc_loadWeakRetained(a1 + 6);
    v8 = a1[4];
    if (WeakRetained)
    {
      v9 = [a1[4] dataForKey:@"HMDEncodedResidentUUIDKey"];
      v26 = v9;
      if (v9)
      {
        v27 = 0;
        v9 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v9 error:&v27];
        v5 = v27;
      }

      else
      {
        v5 = 0;
      }

      v11 = a1[5];
      v24 = v9;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v12 = v11;
      }

      else
      {
        v12 = 0;
      }

      v13 = v12;
      v14 = [v13 device];
      if (v14)
      {
        v15 = [HMDCoreData sharedInstance:v24];
        v16 = [v15 contextWithRootPartition];

        v33[0] = MEMORY[0x277D85DD0];
        v33[1] = 3221225472;
        v33[2] = __75__HMDHome__associateResidentAndDeviceWithAddedMediaAccessory_residentUUID___block_invoke;
        v33[3] = &unk_27868A010;
        v33[4] = WeakRetained;
        v34 = v14;
        v35 = v16;
        v17 = v16;
        [v17 unsafeSynchronousBlock:v33];
      }

      v18 = [WeakRetained backingStore];
      v19 = [v18 context];
      v28[0] = MEMORY[0x277D85DD0];
      v28[1] = 3221225472;
      v28[2] = __75__HMDHome__associateResidentAndDeviceWithAddedMediaAccessory_residentUUID___block_invoke_2;
      v28[3] = &unk_278689550;
      v28[4] = WeakRetained;
      v20 = v11;
      v29 = v20;
      v21 = v25;
      v30 = v21;
      v31 = v13;
      v32 = v14;
      v22 = v14;
      v23 = v13;
      [v19 unsafeSynchronousBlock:v28];

      [a1[4] respondWithPayload:v6];
    }

    else
    {
      v10 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2018];
      [v8 respondWithError:v10];

      v5 = 0;
    }
  }
}

void __45__HMDHome__locallyAddMediaAccessory_message___block_invoke_2(uint64_t a1)
{
  v33 = *MEMORY[0x277D85DE8];
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v3 = v2;
  if (v1)
  {
    v4 = [v2 uuid];
    v5 = [v1 accessoryWithUUID:v4];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if ([v7 supportsTargetControl])
    {
      v8 = 1;
    }

    else
    {
      v9 = v3;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v10 = v9;
      }

      else
      {
        v10 = 0;
      }

      v11 = v10;

      v12 = [v11 device];

      v13 = [v12 capabilities];
      v8 = [v13 supportsTargetControl];
    }

    v14 = objc_autoreleasePoolPush();
    v15 = v1;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v7 shortDescription];
      [v7 supportsTargetControl];
      v19 = HMFBooleanToString();
      v20 = HMFBooleanToString();
      v25 = 138544130;
      v26 = v17;
      v27 = 2112;
      v28 = v18;
      v29 = 2112;
      v30 = v19;
      v31 = 2112;
      v32 = v20;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Checking for auto-Configuring current target controllers with the newly added media accessory: %@ (%@/%@)", &v25, 0x2Au);
    }

    objc_autoreleasePoolPop(v14);
    if (v8)
    {
      v21 = [MEMORY[0x277D0F8D0] sharedPreferences];
      v22 = [v21 preferenceForKey:@"autoConfigureNewTargets"];
      v23 = [v22 BOOLValue];

      if (v23)
      {
        [v7 autoConfigureTargetControllers];
      }
    }
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __75__HMDHome__associateResidentAndDeviceWithAddedMediaAccessory_residentUUID___block_invoke(uint64_t a1)
{
  v33 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  if (v2)
  {
    v28 = v3;
    v4 = [v3 identifier];
    v5 = [HMCContext findDeviceWithDeviceIdentifier:v4];

    if (v5)
    {
LABEL_3:
      [v28 updateBackingModel:v5 error:0];

      v6 = *(a1 + 48);
      v7 = *MEMORY[0x277D85DE8];

      [v6 save];
      return;
    }

    v8 = +[HMDAppleAccountManager sharedManager];
    v9 = [v8 account];

    if (v9)
    {
      v10 = [v9 modelIdentifier];
      v11 = [HMCContext findAccountWithModelID:v10];

      if (v11)
      {
        [v28 setAccount:v9];
        v12 = objc_autoreleasePoolPush();
        v13 = v2;
        v14 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
        {
          v15 = HMFGetLogIdentifier();
          *buf = 138543618;
          v30 = v15;
          v31 = 2112;
          v32 = v28;
          _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEFAULT, "%{public}@Creating MKFDevice for incoming accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v12);
        v16 = [v28 modelIdentifier];
        v5 = [v11 materializeOrCreateDevicesRelationWithModelID:v16 createdNew:0];

        goto LABEL_3;
      }

      v22 = objc_autoreleasePoolPush();
      v23 = v2;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543618;
        v30 = v25;
        v31 = 2112;
        v32 = v9;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@MKFAccount not found for account %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v22);
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = v2;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        v21 = [v28 identifier];
        *buf = 138543618;
        v30 = v20;
        v31 = 2112;
        v32 = v21;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@No MKFDevice found with identifier %@ and no HMDAccount available to create one", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v17);
    }

    v26 = *MEMORY[0x277D85DE8];
    return;
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __75__HMDHome__associateResidentAndDeviceWithAddedMediaAccessory_residentUUID___block_invoke_2(uint64_t a1)
{
  v83[1] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  v4 = [*(a1 + 40) uuid];
  v5 = [HMCContext findAppleMediaAccessoryWithModelID:v4];
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543618;
      v76 = v10;
      v77 = 2112;
      v78 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Creating resident object for newly added accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v74 = 0;
    v11 = MEMORY[0x277CCAD78];
    v12 = [*(a1 + 32) uuid];
    v13 = [v4 UUIDString];
    v83[0] = v13;
    v14 = [MEMORY[0x277CBEA60] arrayWithObjects:v83 count:1];
    v15 = [v11 hm_deriveUUIDFromBaseUUID:v12 withSalts:v14];

    v16 = objc_autoreleasePoolPush();
    v17 = *(a1 + 32);
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = *(a1 + 48);
      v21 = @"random";
      *buf = 138543874;
      v76 = v19;
      if (!v20)
      {
        v21 = @"derived";
      }

      v77 = 2112;
      if (!v20)
      {
        v20 = v15;
      }

      v78 = v21;
      v79 = 2112;
      v80 = v20;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Create resident with %@ UUID: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    if (*(a1 + 48))
    {
      v22 = *(a1 + 48);
    }

    else
    {
      v22 = v15;
    }

    v23 = [v3 materializeOrCreateResidentsRelationWithModelID:v22 createdNew:&v74];
    [v23 setAppleMediaAccessory:v5];
    v24 = [*(a1 + 56) rawResidentCapabilities];
    [v23 setResidentCapabilities:v24];

    v25 = [*(a1 + 32) accessoryWithUUID:v4];
    v26 = [v25 name];
    [v23 setName:v26];

    v27 = [v5 idsIdentifier];
    v73 = v3;
    if (v27)
    {
      v28 = v27;
      v29 = [v23 idsIdentifier];

      if (!v29)
      {
        v30 = objc_autoreleasePoolPush();
        v31 = *(a1 + 32);
        v32 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
        {
          v33 = HMFGetLogIdentifier();
          v34 = [v5 idsIdentifier];
          *buf = 138544130;
          v76 = v33;
          v77 = 2160;
          v78 = 1752392040;
          v79 = 2112;
          v80 = v34;
          v81 = 2112;
          v82 = v5;
          _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_DEFAULT, "%{public}@Setting IDS identifier=%{mask.hash}@ from accessory: %@", buf, 0x2Au);

          v3 = v73;
        }

        objc_autoreleasePoolPop(v30);
        v35 = [v5 idsIdentifier];
        [v23 setIdsIdentifier:v35];
      }
    }

    v36 = [v5 pairingIdentity];

    if (v36)
    {
      v37 = objc_autoreleasePoolPush();
      v38 = *(a1 + 32);
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_DEFAULT))
      {
        v40 = HMFGetLogIdentifier();
        v41 = [v5 pairingIdentity];
        *buf = 138543874;
        v76 = v40;
        v77 = 2112;
        v78 = v41;
        v79 = 2112;
        v80 = v5;
        _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_DEFAULT, "%{public}@Setting pairingIdentity=%@ from accessory: %@", buf, 0x20u);

        v3 = v73;
      }

      objc_autoreleasePoolPop(v37);
      v42 = [v5 pairingIdentity];
      [v23 setPairingIdentity:v42];
    }

    v43 = [v5 deviceIRKData];

    if (v43)
    {
      v44 = objc_autoreleasePoolPush();
      v45 = *(a1 + 32);
      v46 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v46, OS_LOG_TYPE_DEFAULT))
      {
        v47 = HMFGetLogIdentifier();
        v48 = [v5 deviceIRKData];
        *buf = 138543874;
        v76 = v47;
        v77 = 2112;
        v78 = v48;
        v79 = 2112;
        v80 = v5;
        _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_DEFAULT, "%{public}@Setting deviceIRKData=%@ from accessory: %@", buf, 0x20u);

        v3 = v73;
      }

      objc_autoreleasePoolPop(v44);
      v49 = [v5 deviceIRKData];
      [v23 setDeviceIRKData:v49];
    }

    v50 = *(a1 + 64);
    if (v50)
    {
      v51 = [v50 identifier];
      v52 = [HMCContext findDeviceWithDeviceIdentifier:v51];

      if (v52)
      {
        v53 = objc_autoreleasePoolPush();
        v54 = *(a1 + 32);
        v55 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v55, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          v57 = *(a1 + 64);
          *buf = 138544130;
          v76 = v56;
          v77 = 2112;
          v78 = v57;
          v79 = 2112;
          v80 = v5;
          v81 = 2112;
          v82 = v23;
          _os_log_impl(&dword_229538000, v55, OS_LOG_TYPE_INFO, "%{public}@Setting device %@ on accessory model: %@, resident model: %@", buf, 0x2Au);

          v3 = v73;
        }

        objc_autoreleasePoolPop(v53);
        [v5 setDevice:v52];
        [v23 setDevice:v52];
      }

      v58 = [*(a1 + 64) idsIdentifier];
      if (v58)
      {
        v59 = objc_autoreleasePoolPush();
        v60 = *(a1 + 32);
        v61 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_DEFAULT))
        {
          HMFGetLogIdentifier();
          v62 = v71 = v15;
          *buf = 138544130;
          v76 = v62;
          v77 = 2160;
          v78 = 1752392040;
          v79 = 2112;
          v80 = v58;
          v81 = 2112;
          v82 = v5;
          _os_log_impl(&dword_229538000, v61, OS_LOG_TYPE_DEFAULT, "%{public}@Setting IDS identifier=%{mask.hash}@ for newly added accessory: %@", buf, 0x2Au);

          v15 = v71;
        }

        objc_autoreleasePoolPop(v59);
        [v5 setIdsIdentifier:v58];
        [v23 setIdsIdentifier:v58];
        v3 = v73;
      }

      v63 = [*(a1 + 64) globalDestination];
      if (v63)
      {
        v64 = objc_autoreleasePoolPush();
        v65 = *(a1 + 32);
        v66 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v66, OS_LOG_TYPE_DEFAULT))
        {
          HMFGetLogIdentifier();
          v67 = v72 = v15;
          *buf = 138544130;
          v76 = v67;
          v77 = 2160;
          v78 = 1752392040;
          v79 = 2112;
          v80 = v63;
          v81 = 2112;
          v82 = v5;
          _os_log_impl(&dword_229538000, v66, OS_LOG_TYPE_DEFAULT, "%{public}@Setting IDS destination=%{mask.hash}@ for newly added accessory: %@", buf, 0x2Au);

          v15 = v72;
        }

        objc_autoreleasePoolPop(v64);
        [v5 setIdsDestination:v63];
        [v23 setIdsDestination:v63];
        v3 = v73;
      }
    }

    v68 = +[HMCContext currentContext];
    [v68 save];
  }

  else
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v69 = HMFGetLogIdentifier();
      *buf = 138543618;
      v76 = v69;
      v77 = 2112;
      v78 = v4;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Unable to find newly added accessory with UUID %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v70 = *MEMORY[0x277D85DE8];
}

void __83__HMDHome__remotelyAddMediaAccessory_usingRemoteMessageName_message_fallbackBlock___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v39 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v34 = v10;
    v35 = 2112;
    v36 = v6;
    v37 = 2112;
    v38 = v5;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Resident responded with : %@, %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  [*(a1 + 40) markRemoteAccessoryAddEndedWithError:v5];
  if (v5)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v15 = *(a1 + 48);
      *buf = 138543874;
      v34 = v14;
      v35 = 2112;
      v36 = v15;
      v37 = 2112;
      v38 = v5;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while adding accessory [%@] on resident : %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    if (HMDIsAllowedFallbackRemoteError(v5) && ([*(a1 + 32) administratorHandler], v16 = objc_claimAutoreleasedReturnValue(), v17 = objc_msgSend(v16, "allowLocalFallbackForMessage:", *(a1 + 56)), v16, v17))
    {
      v18 = [*(a1 + 32) deviceHomeKitSetupSession];
      [v18 markHasFailedRelayAttempt];

      v19 = objc_autoreleasePoolPush();
      v20 = *(a1 + 32);
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v22 = HMFGetLogIdentifier();
        v23 = [*(a1 + 56) shortDescription];
        *buf = 138543874;
        v34 = v22;
        v35 = 2114;
        v36 = v23;
        v37 = 2112;
        v38 = v5;
        _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Allowing local fallback processing of message %{public}@ due to error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v19);
      (*(*(a1 + 64) + 16))();
    }

    else
    {
      [*(a1 + 56) respondWithError:v5];
    }
  }

  else
  {
    v24 = [*(a1 + 32) backingStore];
    v25 = [v24 context];
    v29[0] = MEMORY[0x277D85DD0];
    v29[1] = 3221225472;
    v29[2] = __83__HMDHome__remotelyAddMediaAccessory_usingRemoteMessageName_message_fallbackBlock___block_invoke_1436;
    v29[3] = &unk_278685330;
    v29[4] = *(a1 + 32);
    v30 = *(a1 + 48);
    v26 = *(a1 + 56);
    v27 = *(a1 + 72);
    v31 = v26;
    v32 = v27;
    [v25 performBlock:v29];
  }

  v28 = *MEMORY[0x277D85DE8];
}

void __83__HMDHome__remotelyAddMediaAccessory_usingRemoteMessageName_message_fallbackBlock___block_invoke_1436(uint64_t a1)
{
  v19[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) uuid];
  v4 = [v2 accessoryWithUUID:v3];

  if (v4)
  {
    v5 = *(a1 + 32);
    v19[0] = v4;
    v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v19 count:1];
    [v5 _notifyClientOfNewlyAddedAccessories:v6 requestMessage:*(a1 + 48)];
  }

  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v10;
    v17 = 2112;
    v18 = v4;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Successfully remote added accessory : %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(*(a1 + 32) + 216);
  v12 = v11;
  v13 = *(a1 + 56);
  if (v13 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v11))
  {
    LOWORD(v15) = 0;
    _os_signpost_emit_with_name_impl(&dword_229538000, v12, OS_SIGNPOST_INTERVAL_END, v13, "RemotelyAddAccessory", "", &v15, 2u);
  }

  [*(a1 + 48) respondWithSuccess];
  v14 = *MEMORY[0x277D85DE8];
}

- (void)_removePendingAccessoryAdd:(id)add
{
  v16 = *MEMORY[0x277D85DE8];
  addCopy = add;
  accessoryUUID = [addCopy accessoryUUID];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    uUIDString = [accessoryUUID UUIDString];
    v12 = 138543618;
    v13 = v9;
    v14 = 2112;
    v15 = uUIDString;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Removing accessoryDescription, setupCode and handlers for accessory %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)selfCopy->_addPendingAccessories removeObjectForKey:addCopy];
  if (accessoryUUID)
  {
    [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodeHandlers removeObjectForKey:accessoryUUID];
    [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodes removeObjectForKey:accessoryUUID];
    [(NSMutableDictionary *)selfCopy->_addPendingAccessoryOnboardingSetupPayloadStrings removeObjectForKey:accessoryUUID];
  }

  os_unfair_recursive_lock_unlock();

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_accessoryPairingDidComplete:(id)complete configuration:(id)configuration pairingEvent:(id)event accessoryServer:(id)server certificationStatus:(int64_t)status requestMessage:(id)message
{
  v42 = *MEMORY[0x277D85DE8];
  completeCopy = complete;
  configurationCopy = configuration;
  eventCopy = event;
  serverCopy = server;
  messageCopy = message;
  [(HMDHome *)self _removePendingAccessoryAdd:completeCopy];
  v17 = serverCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v18 = v17;
  }

  else
  {
    v18 = 0;
  }

  v19 = v18;

  networkCredential = 0;
  if ([v19 isWacComplete])
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v24;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@WAC was completed as part of accessory pairing.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
    networkCredential = [configurationCopy networkCredential];
  }

  if ([eventCopy isMatterAccessory])
  {
    notifyMatterMetricPairingStep(self, 0x18uLL);
  }

  currentActivity = [MEMORY[0x277D0F770] currentActivity];
  objc_initWeak(buf, self);
  accessoryUUID = [completeCopy accessoryUUID];
  v34[0] = MEMORY[0x277D85DD0];
  v34[1] = 3221225472;
  v34[2] = __118__HMDHome__accessoryPairingDidComplete_configuration_pairingEvent_accessoryServer_certificationStatus_requestMessage___block_invoke;
  v34[3] = &unk_27866FD00;
  objc_copyWeak(v39, buf);
  v27 = v17;
  v35 = v27;
  v28 = eventCopy;
  v36 = v28;
  v29 = completeCopy;
  v37 = v29;
  v30 = currentActivity;
  v38 = v30;
  v39[1] = status;
  [(HMDHome *)self _processAccessoriesToAddForUnpairedAccessory:accessoryUUID certificationStatus:status accessoryServer:v27 networkCredential:networkCredential pairingEvent:v28 message:messageCopy completionHandler:v34];

  objc_destroyWeak(v39);
  objc_destroyWeak(buf);

  v31 = *MEMORY[0x277D85DE8];
}

void __118__HMDHome__accessoryPairingDidComplete_configuration_pairingEvent_accessoryServer_certificationStatus_requestMessage___block_invoke(uint64_t a1, void *a2)
{
  v33 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v5 = [WeakRetained _primaryAccessoryForServer:*(a1 + 32)];
  v28 = 0;
  v6 = [v5 preferredHAPAccessoryForOperation:1 linkType:&v28];
  v7 = [*(a1 + 32) pairingMetricDictionary];
  v8 = [v7 copy];
  [*(a1 + 40) setMatterMetrics:v8];

  [*(a1 + 32) clearPairingMetrics];
  [*(a1 + 40) updateEventPropertiesWithPairedAccessory:v5];
  if ([*(a1 + 40) isMatterAccessory] && objc_msgSend(*(a1 + 40), "isAddOperation"))
  {
    if (v3)
    {
      [HMDMatterAccessoryPairingEndContext hmdContextWithError:v3];
    }

    else
    {
      +[HMDMatterAccessoryPairingEndContext pairingCompletedContext];
    }
    v9 = ;
    notifyMatterMetricPairingEnded(WeakRetained, v9);
  }

  else
  {
    v9 = [WeakRetained logEventSubmitter];
    [v9 submitLogEvent:*(a1 + 40) error:v3];
  }

  v10 = objc_autoreleasePoolPush();
  v11 = WeakRetained;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [*(a1 + 48) accessoryName];
    *buf = 138543618;
    v30 = v13;
    v31 = 2112;
    v32 = v14;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@_handleAddAccessory: added accessories for accessory %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  v15 = [v5 metricLoggingVendorDetails];
  v16 = [v6 server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = v16;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  v19 = *(a1 + 48);
  v20 = *(a1 + 56);
  [v19 accessoryUUID];

  [*(a1 + 32) category];
  [v15 model];

  [v15 manufacturer];
  [v15 firmwareVersion];

  v21 = HAPLinkTypeDescription();
  [v18 isWacAccessory];

  v22 = HMFBooleanToString();
  v23 = [MEMORY[0x277CCABB0] numberWithInteger:*(a1 + 72)];
  [*(a1 + 40) isThreadAccessory];
  v24 = HMFBooleanToString();
  [*(a1 + 40) accessorySupportsWoL];

  v25 = HMFBooleanToString();
  v26 = [v11 homeLocationHandler];
  [v26 updateHomeLocation];

  [v11 _evaluateShouldRelaunchAndSetRelaunch];
  v27 = *MEMORY[0x277D85DE8];
}

- (void)_pairAccessoryWithAccessoryDescription:(id)description unpairedAccessory:(id)accessory configuration:(id)configuration pairingEvent:(id)event requestMessage:(id)message
{
  messageCopy = message;
  eventCopy = event;
  configurationCopy = configuration;
  accessoryCopy = accessory;
  descriptionCopy = description;
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  v17 = __createAccessoryBrowserAddAccessoryCompletionHandler(self, descriptionCopy, configurationCopy, eventCopy, messageCopy);

  [accessoryBrowser pairAccessory:accessoryCopy configuration:configurationCopy completionHandler:v17];
}

- (void)_continuePairingAfterUserConsentWithAccessoryUUID:(id)d orUnassociatedAccessory:(id)accessory message:(id)message
{
  v113 = *MEMORY[0x277D85DE8];
  dCopy = d;
  accessoryCopy = accessory;
  messageCopy = message;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543618;
    *&buf[4] = v13;
    *&buf[12] = 2112;
    *&buf[14] = dCopy;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Continue pairing after user consent with accessoryUUID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  if (accessoryCopy)
  {
    goto LABEL_5;
  }

  accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
  unassociatedAccessories = [accessoryBrowser unassociatedAccessories];
  accessoryCopy = [unassociatedAccessories hmf_firstObjectWithUUID:dCopy];

  if (accessoryCopy)
  {
LABEL_5:
    responseHandler2 = accessoryCopy;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v17 = responseHandler2;
    }

    else
    {
      v17 = 0;
    }

    v94 = v17;

    if (isKindOfClass)
    {
      v107 = 0u;
      v105 = 0u;
      v106 = 0u;
      v104 = 0u;
      addPendingAccessories = [(HMDHome *)selfCopy addPendingAccessories];
      hm_allKeys = [addPendingAccessories hm_allKeys];

      v20 = [hm_allKeys countByEnumeratingWithState:&v104 objects:v109 count:16];
      if (v20)
      {
        v21 = *v105;
        while (2)
        {
          for (i = 0; i != v20; ++i)
          {
            if (*v105 != v21)
            {
              objc_enumerationMutation(hm_allKeys);
            }

            v23 = *(*(&v104 + 1) + 8 * i);
            accessoryUUID = [v23 accessoryUUID];
            v25 = [accessoryUUID isEqual:dCopy];

            if (v25)
            {
              v93 = v23;
              addPendingAccessories2 = [(HMDHome *)selfCopy addPendingAccessories];
              v35 = [addPendingAccessories2 objectForKey:v93];

              messageCopy = v35;
              goto LABEL_27;
            }
          }

          v20 = [hm_allKeys countByEnumeratingWithState:&v104 objects:v109 count:16];
          if (v20)
          {
            continue;
          }

          break;
        }
      }

      v93 = 0;
LABEL_27:

      setupCode = [messageCopy stringForKey:*MEMORY[0x277CD1FD8]];
      if (setupCode)
      {
        v36 = objc_autoreleasePoolPush();
        v37 = selfCopy;
        v38 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
        {
          v39 = HMFGetLogIdentifier();
          *buf = 138543618;
          *&buf[4] = v39;
          *&buf[12] = 2112;
          *&buf[14] = v94;
          _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Storing setupCode accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v36);
        addPendingAccessorySetupCodes = [(HMDHome *)v37 addPendingAccessorySetupCodes];
        [addPendingAccessorySetupCodes setObject:setupCode forKey:dCopy];
      }

      else
      {
        setupCode = [v93 setupCode];
      }

      appIdentifier = [v93 appIdentifier];
      v92 = +[HMDAccessoryPairingEvent pairingAccessory:home:appIdentifier:retry:](HMDAccessoryPairingEvent, "pairingAccessory:home:appIdentifier:retry:", v94, selfCopy, appIdentifier, [v93 retry]);

      if ([v92 isMatterAccessory])
      {
        notifyMatterMetricPairingStep(selfCopy, 2uLL);
      }

      v46 = objc_alloc_init(HMDUnpairedHAPAccessoryConfiguration);
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setSetupCode:setupCode];
      v47 = [(HMDHome *)selfCopy _setupCodeProviderForMessage:messageCopy];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setSetupCodeProvider:v47];

      homeLocationHandler = [(HMDHome *)selfCopy homeLocationHandler];
      isoCountryCode = [homeLocationHandler isoCountryCode];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setIsoCountryCode:isoCountryCode];

      matterFabricID = [(HMDHome *)selfCopy matterFabricID];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setChipFabricID:matterFabricID];

      uuid = [(HMDHome *)selfCopy uuid];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setHomeUUID:uuid];

      preferredAccessoryServer = [v94 preferredAccessoryServer];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v53 = preferredAccessoryServer;
      }

      else
      {
        v53 = 0;
      }

      v90 = v53;

      v54 = objc_autoreleasePoolPush();
      v55 = selfCopy;
      v56 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
      {
        v57 = HMFGetLogIdentifier();
        uUIDString = [dCopy UUIDString];
        [v90 isWacNeeded];
        v59 = HMFBooleanToString();
        v60 = HMDNetworkRouterSupportAsString([(HMDHome *)v55 networkRouterSupport]);
        [(HMDHome *)v55 networkRouterSupportDisableReason];
        v61 = HMNetworkRouterSupportDisableReasonAsString();
        *buf = 138544386;
        *&buf[4] = v57;
        *&buf[12] = 2112;
        *&buf[14] = uUIDString;
        *&buf[22] = 2112;
        v111 = v59;
        *v112 = 2112;
        *&v112[2] = v60;
        *&v112[10] = 2112;
        *&v112[12] = v61;
        _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_INFO, "%{public}@Adding unpaired accessory with uuid: %@, WAC needed: %@, network router support: %@ (Reason %@)", buf, 0x34u);
      }

      objc_autoreleasePoolPop(v54);
      currentActivity = [MEMORY[0x277D0F770] currentActivity];
      [v93 accessoryUUID];

      preferredAccessoryServer2 = [v94 preferredAccessoryServer];
      [preferredAccessoryServer2 category];

      v64 = HMDNetworkRouterSupportAsString([(HMDHome *)v55 networkRouterSupport]);
      v65 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome networkRouterSupportDisableReason](v55, "networkRouterSupportDisableReason")}];
      [v92 linkType];
      v66 = HAPLinkTypeDescription();
      [v92 communicationProtocol];
      v67 = HAPCommunicationProtocolDescription();
      [v90 isWacNeeded];
      v68 = HMFBooleanToString();
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 requiresUserConsent];
      v69 = HMFBooleanToString();
      [v93 appIdentifier];

      [v92 isThreadAccessory];
      v70 = HMFBooleanToString();
      if ([v90 isWacNeeded] && (-[HMDHome networkRouterSupport](v55, "networkRouterSupport") & 8) != 0)
      {
        v97[0] = MEMORY[0x277D85DD0];
        v97[1] = 3221225472;
        v97[2] = __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke;
        v97[3] = &unk_27866FCD8;
        v97[4] = v55;
        v98 = currentActivity;
        v99 = v93;
        v100 = v92;
        v101 = messageCopy;
        v102 = v46;
        v103 = v94;
        [(HMDHome *)v55 _createUniquePSKClientConfigurationWithRequestMessage:v101 pairingEvent:v100 completion:v97];
      }

      else
      {
        [currentActivity begin];
        *buf = currentActivity;
        [(HMDHome *)v55 _pairAccessoryWithAccessoryDescription:v93 unpairedAccessory:v94 configuration:v46 pairingEvent:v92 requestMessage:messageCopy];
        __HMFActivityScopeLeave();
      }
    }

    else
    {
      responseHandler2 = responseHandler2;
      messageCopy = messageCopy;
      if (selfCopy)
      {
        objc_initWeak(&location, selfCopy);
        v26 = responseHandler2;
        objc_opt_class();
        v27 = objc_opt_isKindOfClass();
        if (v27)
        {
          v28 = v26;
        }

        else
        {
          v28 = 0;
        }

        v29 = v28;

        if (v27)
        {
          v30 = objc_autoreleasePoolPush();
          v31 = selfCopy;
          v32 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
          {
            v33 = HMFGetLogIdentifier();
            *buf = 138543618;
            *&buf[4] = v33;
            *&buf[12] = 2112;
            *&buf[14] = v29;
            _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_DEFAULT, "%{public}@Starting WAC for %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v30);
          *buf = MEMORY[0x277D85DD0];
          *&buf[8] = 3221225472;
          *&buf[16] = __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke;
          v111 = &unk_27866FD28;
          objc_copyWeak(&v112[16], &location);
          *v112 = messageCopy;
          *&v112[8] = v29;
          [*&v112[8] startConfigurationWithCompletionHandler:buf];

          objc_destroyWeak(&v112[16]);
        }

        else
        {
          v41 = v26;
          objc_opt_class();
          v42 = objc_opt_isKindOfClass();
          if (v42)
          {
            v43 = v41;
          }

          else
          {
            v43 = 0;
          }

          v44 = v43;

          if (v42)
          {
            [(HMDHome *)selfCopy _addAndMaybeAssociateMediaAccessory:v44 message:messageCopy];
          }

          else
          {
            v84 = objc_autoreleasePoolPush();
            v85 = selfCopy;
            v86 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v86, OS_LOG_TYPE_DEFAULT))
            {
              v87 = HMFGetLogIdentifier();
              *buf = 138543618;
              *&buf[4] = v87;
              *&buf[12] = 2112;
              *&buf[14] = v41;
              _os_log_impl(&dword_229538000, v86, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to add unknown unassociated accessory: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v84);
            v88 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
            [messageCopy respondWithError:v88];
          }
        }

        objc_destroyWeak(&location);
      }
    }

    goto LABEL_61;
  }

  v71 = objc_autoreleasePoolPush();
  v72 = selfCopy;
  v73 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v73, OS_LOG_TYPE_DEFAULT))
  {
    v74 = HMFGetLogIdentifier();
    uUIDString2 = [dCopy UUIDString];
    *buf = 138543618;
    *&buf[4] = v74;
    *&buf[12] = 2112;
    *&buf[14] = uUIDString2;
    _os_log_impl(&dword_229538000, v73, OS_LOG_TYPE_DEFAULT, "%{public}@Unknown accessory with identifier: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v71);
  v76 = objc_autoreleasePoolPush();
  v77 = v72;
  v78 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v78, OS_LOG_TYPE_DEFAULT))
  {
    v79 = HMFGetLogIdentifier();
    accessoryBrowser2 = [(HMDHome *)v77 accessoryBrowser];
    accessoryBrowser3 = [(HMDHome *)v77 accessoryBrowser];
    unassociatedAccessories2 = [accessoryBrowser3 unassociatedAccessories];
    *buf = 138543874;
    *&buf[4] = v79;
    *&buf[12] = 2112;
    *&buf[14] = accessoryBrowser2;
    *&buf[22] = 2112;
    v111 = unassociatedAccessories2;
    _os_log_impl(&dword_229538000, v78, OS_LOG_TYPE_DEFAULT, "%{public}@AccessoryBrowser %@, Unassociated accessories: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v76);
  responseHandler = [messageCopy responseHandler];

  if (responseHandler)
  {
    responseHandler2 = [messageCopy responseHandler];
    v94 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(responseHandler2 + 2))(responseHandler2, v94, 0);
LABEL_61:
  }

  v89 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke_2;
  block[3] = &unk_27866FCB0;
  v11 = a1[5];
  v12 = a1[6];
  v13 = v6;
  v14 = a1[4];
  v15 = a1[7];
  v16 = a1[8];
  v17 = a1[9];
  v18 = v5;
  v19 = a1[10];
  v8 = v5;
  v9 = v6;
  dispatch_async(v7, block);
}

void __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (!WeakRetained)
  {
    v13 = *(a1 + 32);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
LABEL_7:
    v16 = [v14 hmErrorWithCode:v15];
    [v13 respondWithError:v16];
    goto LABEL_8;
  }

  if (v5)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = *(a1 + 40);
      *buf = 138543618;
      v32 = v11;
      v33 = 2112;
      v34 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@WAC failed for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = *(a1 + 32);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 48;
    goto LABEL_7;
  }

  v18 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v19 = v18;
  }

  else
  {
    v19 = 0;
  }

  v16 = v19;

  if (v16)
  {
    v20 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke_1388;
    block[3] = &unk_27868A010;
    block[4] = WeakRetained;
    v29 = v16;
    v30 = *(a1 + 32);
    dispatch_async(v20, block);
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = WeakRetained;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v32 = v24;
      v33 = 2112;
      v34 = objc_opt_class();
      v25 = v34;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Post-WAC not supported for type %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v21);
    v26 = *(a1 + 32);
    v27 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [v26 respondWithError:v27];
  }

LABEL_8:

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_addAndMaybeAssociateMediaAccessory:(void *)accessory message:
{
  v28 = *MEMORY[0x277D85DE8];
  v5 = a2;
  accessoryCopy = accessory;
  if (self)
  {
    if ([self isOwnerUser])
    {
      homeManager = [self homeManager];
      uuid = [v5 uuid];
      v9 = [homeManager accessorySetupMetricDispatcherForAccessoryUUID:uuid];

      [v9 addHome:self];
      if ([v5 conformsToProtocol:&unk_283EE9CC8] && objc_msgSend(v5, "supportsAssociation"))
      {
        objc_initWeak(&location, self);
        v10 = objc_autoreleasePoolPush();
        selfCopy = self;
        v12 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          v13 = HMFGetLogIdentifier();
          *buf = 138543618;
          v25 = v13;
          v26 = 2112;
          v27 = v5;
          _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Starting association for media accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v10);
        v19[0] = MEMORY[0x277D85DD0];
        v19[1] = 3221225472;
        v19[2] = __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke;
        v19[3] = &unk_278685D08;
        objc_copyWeak(&v22, &location);
        v20 = v5;
        v21 = accessoryCopy;
        [v20 associateToHome:selfCopy completionHandler:v19];

        objc_destroyWeak(&v22);
        objc_destroyWeak(&location);
      }

      else
      {
        [self _addMediaAccessory:v5 message:accessoryCopy];
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v25 = v17;
        _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_DEFAULT, "%{public}@Must be owner to add WHA accessory", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v14);
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [accessoryCopy respondWithError:v9];
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke(id *a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (v3)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = v5;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = HMFGetLogIdentifier();
      v10 = a1[4];
      *buf = 138543874;
      v20 = v9;
      v21 = 2112;
      v22 = v10;
      v23 = 2112;
      v24 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to add accessory, %@, with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    [a1[5] respondWithError:v3];
  }

  else if (WeakRetained)
  {
    v11 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke_1433;
    block[3] = &unk_278685F38;
    objc_copyWeak(&v18, a1 + 6);
    v16 = a1[5];
    v17 = a1[4];
    dispatch_async(v11, block);

    objc_destroyWeak(&v18);
  }

  else
  {
    v12 = a1[5];
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v12 respondWithError:v13];
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke_1433(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v5 = WeakRetained;
  if (WeakRetained)
  {
    [WeakRetained _addMediaAccessory:*(a1 + 40) message:*(a1 + 32)];
  }

  else
  {
    v3 = *(a1 + 32);
    v4 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v3 respondWithError:v4];
  }
}

void __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke_1388(id *a1)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = a1[4];
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v7 = 138543362;
    v8 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Continuing to add accessory post-WAC", &v7, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  [(HMDHome *)a1[4] _addAndMaybeAssociateMediaAccessory:a1[6] message:?];
  v6 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke_2(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 40);
  v3 = *(a1 + 32);
  [v2 accessoryUUID];

  [*(a1 + 48) domain];
  [*(a1 + 48) code];

  v4 = *(a1 + 48) == 0;
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 56);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *v15 = 138543362;
      *&v15[4] = v13;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Client configuration with WiFi unique PSK created successfully", v15, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 80) setNetworkCredential:*(a1 + 88)];
    [*(a1 + 64) setUsedWiFiPPSK:1];
    [*(a1 + 32) begin];
    *v15 = *(a1 + 32);
    [*(a1 + 56) _pairAccessoryWithAccessoryDescription:*(a1 + 40) unpairedAccessory:*(a1 + 96) configuration:*(a1 + 80) pairingEvent:*(a1 + 64) requestMessage:*(a1 + 72)];
    __HMFActivityScopeLeave();
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 40);
      v11 = *(a1 + 48);
      *v15 = 138543874;
      *&v15[4] = v9;
      v16 = 2112;
      v17 = v10;
      v18 = 2112;
      v19 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate WiFi credential for accessory %@ with error: %@", v15, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v12 = [*(a1 + 56) logEventSubmitter];
    [v12 submitLogEvent:*(a1 + 64) error:*(a1 + 48)];

    [*(a1 + 72) respondWithError:*(a1 + 48)];
    [*(a1 + 56) _removePendingAccessoryAdd:*(a1 + 40)];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_continueLegacyAddAccessoryWithUUID:(id)d unassociatedAccessory:(id)accessory setupCode:(id)code appID:(id)iD message:(id)message
{
  v83 = *MEMORY[0x277D85DE8];
  dCopy = d;
  accessoryCopy = accessory;
  codeCopy = code;
  iDCopy = iD;
  messageCopy = message;
  v17 = [(HMDHome *)self accessoryWithUUID:dCopy];
  if (v17)
  {
    v18 = objc_autoreleasePoolPush();
    selfCopy = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543874;
      v78 = v21;
      v79 = 2112;
      v80 = dCopy;
      v81 = 2112;
      v82 = v17;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Can't add unassociated accessory: this home already has an accessory with UUID %@: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v18);
    if (_os_feature_enabled_impl() && [messageCopy isEntitledForSPIAccess] && objc_msgSend(messageCopy, "isEntitledToProvideAccessorySetupPayload"))
    {
      v22 = objc_autoreleasePoolPush();
      v23 = selfCopy;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v25;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Creating temporary progress handler to invoke with already-associated error", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v22);
      v26 = objc_alloc(MEMORY[0x277CD1DE8]);
      uuid = [(HMDHome *)v23 uuid];
      v28 = [v26 initWithAccessoryUUID:dCopy accessoryName:0 appID:iDCopy homeUUID:uuid];

      v29 = HMDHomeCreateAddAccessoryProgressHandler(v23, v28, messageCopy);
      v30 = [[HMDAddAccessoryProgressState alloc] initWithPairedAccessory:v17];
      (v29)[2](v29, 47, v30);
    }

    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:13];
    [messageCopy respondWithError:v31];
    goto LABEL_47;
  }

  accessories = [(HMDHome *)self accessories];
  v33 = [accessories count];
  v34 = maximumAccessoriesPerHome;

  if (v33 >= v34)
  {
    v39 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v41 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
    {
      v42 = HMFGetLogIdentifier();
      *buf = 138543362;
      v78 = v42;
      _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_ERROR, "%{public}@Can't add unassociated accessory: already at maximum accessories for home", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v39);
    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    [messageCopy respondWithError:v31];
  }

  else if (([accessoryCopy associationOptions] & 2) != 0)
  {
    v43 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
    {
      v46 = HMFGetLogIdentifier();
      *buf = 138543362;
      v78 = v46;
      _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_INFO, "%{public}@Can't add unassociated accessory: software update needed on the accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v43);
    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [messageCopy respondWithError:v31];
  }

  else
  {
    category = [accessoryCopy category];
    v76 = 0;
    context = [(HMDHome *)self _shouldAllowAddingAccessoryOfCategory:category requestMessage:messageCopy error:&v76];
    v31 = v76;

    if (context)
    {
LABEL_14:
      v70 = accessoryCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v36 = v70;
      }

      else
      {
        v36 = 0;
      }

      v67 = v36;

      if (v67)
      {
        v37 = objc_alloc(MEMORY[0x277CD1DE8]);
        uuid2 = [(HMDHome *)self uuid];
        v68 = [v37 initWithAccessoryUUID:dCopy accessoryName:0 appID:iDCopy homeUUID:uuid2];

        [v68 setSetupCode:codeCopy];
        os_unfair_recursive_lock_lock_with_options();
        [(NSMapTable *)self->_addPendingAccessories setObject:messageCopy forKey:v68];
        os_unfair_recursive_lock_unlock();
      }

      else
      {
        v68 = 0;
      }

      if ([messageCopy isEntitledForSPIAccess] && objc_msgSend(messageCopy, "isEntitledToProvideAccessorySetupPayload"))
      {
        v66 = objc_autoreleasePoolPush();
        selfCopy4 = self;
        v53 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v53, OS_LOG_TYPE_DEBUG))
        {
          v54 = HMFGetLogIdentifier();
          *buf = 138543362;
          v65 = v54;
          v78 = v54;
          _os_log_impl(&dword_229538000, v53, OS_LOG_TYPE_DEBUG, "%{public}@Registering Progress Handler", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v66);
        v55 = HMDHomeCreateAddAccessoryProgressHandler(selfCopy4, v68, messageCopy);
        v56 = selfCopy4;
        v57 = v55;
        accessoryBrowser = [(HMDHome *)v56 accessoryBrowser];
        [accessoryBrowser registerProgressHandler:v57 unpairedAccessoryUUID:dCopy];
      }

      else
      {
        v57 = 0;
      }

      if (context)
      {
        [(HMDHome *)self _continuePairingAfterUserConsentWithAccessoryUUID:dCopy orUnassociatedAccessory:v70 message:messageCopy];
      }

      else if (v57)
      {
        v59 = [[HMDAddAccessoryProgressState alloc] initWithUnpairedAccessory:v67 server:0];
        (v57)[2](v57, 9, v59);
      }

      else
      {
        contextb = objc_autoreleasePoolPush();
        selfCopy5 = self;
        v61 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_INFO))
        {
          v62 = HMFGetLogIdentifier();
          *buf = 138543362;
          v72 = v62;
          v78 = v62;
          _os_log_impl(&dword_229538000, v61, OS_LOG_TYPE_INFO, "%{public}@No progress handler but need to request user consent to replace accessory in home", buf, 0xCu);
        }

        objc_autoreleasePoolPop(contextb);
        v63 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
        [messageCopy respondWithError:v63];
      }

      goto LABEL_47;
    }

    domain = [v31 domain];
    if ([domain isEqualToString:*MEMORY[0x277CCFD28]])
    {
      v48 = [v31 code] == 97;

      if (v48)
      {
        goto LABEL_14;
      }
    }

    else
    {
    }

    contexta = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v50 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
    {
      v69 = HMFGetLogIdentifier();
      category2 = [accessoryCopy category];
      localizedDescription = [category2 localizedDescription];
      *buf = 138543874;
      v78 = v69;
      v79 = 2112;
      v80 = localizedDescription;
      v81 = 2112;
      v82 = v31;
      _os_log_impl(&dword_229538000, v50, OS_LOG_TYPE_ERROR, "%{public}@Can't add an accessory of category %@: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(contexta);
    [messageCopy respondWithError:v31];
  }

LABEL_47:

  v64 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoteAddMediaAccessoryRequest:(id)request
{
  requestCopy = request;
  residentSyncManager = [(HMDHome *)self residentSyncManager];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __49__HMDHome__handleRemoteAddMediaAccessoryRequest___block_invoke;
  v6[3] = &unk_27868A398;
  v6[4] = self;
  [residentSyncManager interceptRemoteResidentRequest:requestCopy proceed:v6];
}

void __49__HMDHome__handleRemoteAddMediaAccessoryRequest___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 dataForKey:@"kAccessoryEncodedMediaAccessoryKey"];
  if (v4)
  {
    v16 = 0;
    v5 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v4 error:&v16];
    v6 = v16;
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    v10 = v9;
    if (v5)
    {
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v11;
        v19 = 2112;
        v20 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Proceeding to add media accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      [(HMDHome *)*(a1 + 32) _locallyAddMediaAccessory:v5 message:v3];
    }

    else
    {
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v13;
        v19 = 2112;
        v20 = v6;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to decode unassociated media accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v3 respondWithError:v14];
    }
  }

  else
  {
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [v3 respondWithError:v12];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoteAddMediaAccessory:(id)accessory
{
  accessoryCopy = accessory;
  residentSyncManager = [(HMDHome *)self residentSyncManager];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __42__HMDHome__handleRemoteAddMediaAccessory___block_invoke;
  v6[3] = &unk_27868A398;
  v6[4] = self;
  [residentSyncManager interceptRemoteResidentRequest:accessoryCopy proceed:v6];
}

void __42__HMDHome__handleRemoteAddMediaAccessory___block_invoke(uint64_t a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v4)
  {
    v5 = [v3 dataForKey:@"kAccessoryEncodedMediaAccessoryKey"];
    if (v5)
    {
      v21 = 0;
      v6 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v5 error:&v21];
      v7 = v21;
      if (v6)
      {
        v8 = [v3 stringForKey:*MEMORY[0x277CD1FD8]];
        v9 = [v3 clientIdentifier];
        context = objc_autoreleasePoolPush();
        v10 = *(a1 + 32);
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v12 = v19 = v7;
          *buf = 138543618;
          v23 = v12;
          v24 = 2112;
          v25 = v6;
          _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Proceeding to add unassociated media accessory: %@", buf, 0x16u);

          v7 = v19;
        }

        objc_autoreleasePoolPop(context);
        [*(a1 + 32) _continueLegacyAddAccessoryWithUUID:v4 unassociatedAccessory:v6 setupCode:v8 appID:v9 message:v3];
      }

      else
      {
        v14 = objc_autoreleasePoolPush();
        v15 = *(a1 + 32);
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          v17 = HMFGetLogIdentifier();
          *buf = 138543618;
          v23 = v17;
          v24 = 2112;
          v25 = v7;
          _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Unable to decode unassociated media accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v14);
        v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        [v3 respondWithError:v8];
      }
    }

    else
    {
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      [v3 respondWithError:v13];
    }
  }

  else
  {
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [v3 respondWithError:v5];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldUseDeprecatedAddAccessoryMessage:(id)message minimumVersion:(id)version primaryResident:(id)resident shouldRelayMessages:(BOOL)messages
{
  versionCopy = version;
  device = [resident device];
  version = [device version];

  LOBYTE(v12) = 0;
  if (versionCopy && resident)
  {
    v12 = [version isAtLeastVersion:versionCopy] ^ 1;
  }

  v13 = v12 & messages;
  if (message)
  {
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  return v14;
}

- (void)_handleLegacyAddAccessory:(id)accessory
{
  v78 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v73 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling legacy add accessory", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [accessoryCopy uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v9)
  {
    v10 = [accessoryCopy stringForKey:*MEMORY[0x277CD1FD8]];
    if (v10 && ([accessoryCopy isEntitledForSPIAccess] & 1) == 0)
    {
      v45 = objc_autoreleasePoolPush();
      v46 = selfCopy;
      v47 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
      {
        v48 = HMFGetLogIdentifier();
        *buf = 138543362;
        v73 = v48;
        _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Client provided a setup code but does not have entitlement to use SPI", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v45);
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [accessoryCopy respondWithError:v13];
      goto LABEL_38;
    }

    accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
    unassociatedAccessories = [accessoryBrowser unassociatedAccessories];
    v13 = [unassociatedAccessories hmf_firstObjectWithUUID:v9];

    v14 = objc_autoreleasePoolPush();
    v15 = selfCopy;
    v16 = HMFGetOSLogHandle();
    v17 = v16;
    if (!v13)
    {
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v49 = HMFGetLogIdentifier();
        accessoryBrowser2 = [(HMDHome *)v15 accessoryBrowser];
        unassociatedAccessories2 = [accessoryBrowser2 unassociatedAccessories];
        *buf = 138543874;
        v73 = v49;
        v74 = 2112;
        v75 = v9;
        v76 = 2112;
        v77 = unassociatedAccessories2;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Could not find unassociated accessory with UUID %@ for legacy add accessory flow. All unassociated accessories: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v14);
      v52 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [accessoryCopy respondWithError:v52];
      goto LABEL_37;
    }

    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v73 = v18;
      v74 = 2112;
      v75 = v13;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Found matching unassociated accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v19 = v13;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v21 = v19;
    }

    else
    {
      v21 = 0;
    }

    v65 = v21;

    if (isKindOfClass)
    {
      v22 = objc_autoreleasePoolPush();
      v23 = v15;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v61 = HMFGetLogIdentifier();
        proxyConnection = [accessoryCopy proxyConnection];
        shortDescription = [proxyConnection shortDescription];
        [(HMDHome *)v23 hasAnyResident];
        v25 = HMFBooleanToString();
        *buf = 138543874;
        v73 = v61;
        v74 = 2112;
        v75 = shortDescription;
        v76 = 2112;
        v77 = v25;
        v26 = v25;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Creating a device HomeKit setup session for connection %@, home.hasAnyResident = %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v22);
      v27 = [HMDDeviceHomeKitSetupSession alloc];
      hasAnyResident = [(HMDHome *)v23 hasAnyResident];
      proxyConnection2 = [accessoryCopy proxyConnection];
      v30 = [(HMDDeviceHomeKitSetupSession *)v27 initWithFirstResidentForHome:!hasAnyResident clientConnection:proxyConnection2];
      [(HMDHome *)v23 setDeviceHomeKitSetupSession:v30];
    }

    v31 = v19;
    objc_opt_class();
    v32 = objc_opt_isKindOfClass();
    if (v32)
    {
      v33 = v31;
    }

    else
    {
      v33 = 0;
    }

    v34 = v33;

    primaryResident = [(HMDHome *)v15 primaryResident];
    v36 = primaryResident;
    if ((v32 & 1) != 0 && primaryResident)
    {
      clientIdentifier = +[HMDHomeKitVersion version10];
      administratorHandler = [(HMDHome *)v15 administratorHandler];
      v63 = v34;
      v39 = -[HMDHome _shouldUseDeprecatedAddAccessoryMessage:minimumVersion:primaryResident:shouldRelayMessages:](v15, "_shouldUseDeprecatedAddAccessoryMessage:minimumVersion:primaryResident:shouldRelayMessages:", v34, clientIdentifier, v36, [administratorHandler shouldRelayMessages]);

      if (v39)
      {
        v66[0] = MEMORY[0x277D85DD0];
        v66[1] = 3221225472;
        v66[2] = __37__HMDHome__handleLegacyAddAccessory___block_invoke;
        v66[3] = &unk_278689550;
        v67 = accessoryCopy;
        v68 = v15;
        v69 = v9;
        v70 = v63;
        v71 = v10;
        [(HMDHome *)v15 _remotelyAddMediaAccessory:v70 usingRemoteMessageName:@"HMDRemoteAddMediaAccessoryMessage" message:v67 fallbackBlock:v66];

        v34 = v63;
LABEL_36:

        v52 = v65;
LABEL_37:

LABEL_38:
        goto LABEL_39;
      }

      v34 = v63;
    }

    v53 = objc_autoreleasePoolPush();
    v54 = v15;
    v55 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v55, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v64 = v36;
      v56 = v13;
      v58 = v57 = v34;
      *buf = 138543618;
      v73 = v58;
      v74 = 2112;
      v75 = v31;
      _os_log_impl(&dword_229538000, v55, OS_LOG_TYPE_INFO, "%{public}@Continuing legacy add for unassociated accessory: %@", buf, 0x16u);

      v34 = v57;
      v13 = v56;
      v36 = v64;
    }

    objc_autoreleasePoolPop(v53);
    clientIdentifier = [accessoryCopy clientIdentifier];
    [(HMDHome *)v54 _continueLegacyAddAccessoryWithUUID:v9 unassociatedAccessory:v31 setupCode:v10 appID:clientIdentifier message:accessoryCopy];
    goto LABEL_36;
  }

  v40 = objc_autoreleasePoolPush();
  v41 = selfCopy;
  v42 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
  {
    v43 = HMFGetLogIdentifier();
    shortDescription2 = [accessoryCopy shortDescription];
    *buf = 138543618;
    v73 = v43;
    v74 = 2112;
    v75 = shortDescription2;
    _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_ERROR, "%{public}@Legacy add accessory message is missing accessory uuid: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v40);
  v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
  [accessoryCopy respondWithError:v10];
LABEL_39:

  v59 = *MEMORY[0x277D85DE8];
}

void __37__HMDHome__handleLegacyAddAccessory___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) clientIdentifier];
  [*(a1 + 40) _continueLegacyAddAccessoryWithUUID:*(a1 + 48) unassociatedAccessory:*(a1 + 56) setupCode:*(a1 + 64) appID:v2 message:*(a1 + 32)];
}

- (BOOL)_shouldAllowAddingAccessoryWithDescription:(id)description requestMessage:(id)message error:(id *)error
{
  messageCopy = message;
  v9 = MEMORY[0x277CD1680];
  descriptionCopy = description;
  setupAccessoryPayload = [descriptionCopy setupAccessoryPayload];
  categoryNumber = [setupAccessoryPayload categoryNumber];
  v13 = [v9 categoryWithCategoryIdentifier:categoryNumber];

  category = [descriptionCopy category];

  if ([category isWiFiRouterAccessoryCategory])
  {
  }

  else
  {
    isWiFiRouterAccessoryCategory = [v13 isWiFiRouterAccessoryCategory];

    if ((isWiFiRouterAccessoryCategory & 1) == 0)
    {
      v16 = 1;
      goto LABEL_6;
    }
  }

  v16 = [(HMDHome *)self __shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:messageCopy error:error];
LABEL_6:

  return v16;
}

- (BOOL)_shouldAllowAddingAccessoryOfCategory:(id)category requestMessage:(id)message error:(id *)error
{
  messageCopy = message;
  if ([category isWiFiRouterAccessoryCategory])
  {
    v9 = [(HMDHome *)self __shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:messageCopy error:error];
  }

  else
  {
    v9 = 1;
  }

  return v9;
}

- (id)_setupDescriptionFromData:(id)data error:(id *)error
{
  v35 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  v7 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:dataCopy error:error];
  v8 = v7;
  if (v7)
  {
    addRequestIdentifier = [v7 addRequestIdentifier];
    v30 = 0u;
    v31 = 0u;
    v32 = 0u;
    v33 = 0u;
    addPendingAccessories = [(HMDHome *)self addPendingAccessories];
    hm_allKeys = [addPendingAccessories hm_allKeys];

    obj = hm_allKeys;
    v26 = [hm_allKeys countByEnumeratingWithState:&v30 objects:v34 count:16];
    if (v26)
    {
      v27 = *v31;
      v24 = dataCopy;
      while (2)
      {
        for (i = 0; i != v26; ++i)
        {
          if (*v31 != v27)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v30 + 1) + 8 * i);
          setupAccessoryPayload = [v12 setupAccessoryPayload];
          setupID = [setupAccessoryPayload setupID];
          setupAccessoryPayload2 = [v8 setupAccessoryPayload];
          setupID2 = [setupAccessoryPayload2 setupID];
          if ([setupID isEqual:setupID2])
          {
            goto LABEL_15;
          }

          accessoryUUID = [v12 accessoryUUID];
          accessoryUUID2 = [v8 accessoryUUID];
          if ([accessoryUUID isEqual:accessoryUUID2])
          {

LABEL_15:
LABEL_16:
            cancellationReason = [v8 cancellationReason];
            [v12 setCancellationReason:cancellationReason];

            v20 = v12;
            dataCopy = v24;
            goto LABEL_17;
          }

          addRequestIdentifier2 = [v12 addRequestIdentifier];
          v29 = [addRequestIdentifier2 isEqual:addRequestIdentifier];

          if (v29)
          {
            goto LABEL_16;
          }
        }

        dataCopy = v24;
        v26 = [obj countByEnumeratingWithState:&v30 objects:v34 count:16];
        if (v26)
        {
          continue;
        }

        break;
      }
    }

    v20 = v8;
LABEL_17:
  }

  else
  {
    v20 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v20;
}

- (BOOL)__shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:(id)message error:(id *)error
{
  v25 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if (![(HMDHome *)self checkForNetworkRouterSupport:4 error:error])
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMDNetworkRouterSupportAsString([(HMDHome *)selfCopy networkRouterSupport]);
      v15 = v14;
      if (error)
      {
        v16 = *error;
      }

      else
      {
        v16 = 0;
      }

      v19 = 138543874;
      v20 = v13;
      v21 = 2112;
      v22 = v14;
      v23 = 2112;
      v24 = v16;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Cannot add network router to the home - networkRouterSupport %@ error %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    goto LABEL_12;
  }

  wiFiRouterAccessories = [(HMDHome *)self wiFiRouterAccessories];
  v8 = [wiFiRouterAccessories count];

  if (!v8)
  {
    v9 = 1;
    goto LABEL_13;
  }

  if (!error)
  {
LABEL_12:
    v9 = 0;
    goto LABEL_13;
  }

  [MEMORY[0x277CCA9B8] hmErrorWithCode:97];
  *error = v9 = 0;
LABEL_13:

  v17 = *MEMORY[0x277D85DE8];
  return v9;
}

- (void)performLocalAddAccessoryWithDescription:(id)description progressHandlerDelegate:(id)delegate completion:(id)completion
{
  v42 = *MEMORY[0x277D85DE8];
  descriptionCopy = description;
  delegateCopy = delegate;
  completionCopy = completion;
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsAddingAccessory = [localCapabilitiesDataSource supportsAddingAccessory];

  if (supportsAddingAccessory)
  {
    currentAccessory = [(HMDHome *)self currentAccessory];
    if (currentAccessory)
    {
      selfRemovalWatchdog = [(HMDHome *)self selfRemovalWatchdog];
      currentAccessoryUUID = [selfRemovalWatchdog currentAccessoryUUID];

      if (currentAccessoryUUID && ([currentAccessory uuid], v16 = objc_claimAutoreleasedReturnValue(), v17 = objc_msgSend(currentAccessoryUUID, "hmf_isEqualToUUID:", v16), v16, v17))
      {
        v18 = objc_autoreleasePoolPush();
        selfCopy = self;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
        {
          v21 = HMFGetLogIdentifier();
          *buf = 138543874;
          v37 = v21;
          v38 = 2112;
          v39 = descriptionCopy;
          v40 = 2112;
          v41 = currentAccessory;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Will not perform local add accessory with setup description %@ when current accessory (%@) self removal is pending", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v18);
        if (!completionCopy)
        {
          goto LABEL_19;
        }

        v22 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2505];
        completionCopy[2](completionCopy, v22);
      }

      else
      {
        v24 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
        {
          v27 = HMFGetLogIdentifier();
          *buf = 138543618;
          v37 = v27;
          v38 = 2112;
          v39 = descriptionCopy;
          _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Performing local add accessory with setup description %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v24);
        v22 = [MEMORY[0x277D0F848] internalMessageWithName:*MEMORY[0x277CD2070] messagePayload:0];
        [v22 setQualityOfService:25];
        objc_initWeak(buf, selfCopy2);
        v33[0] = MEMORY[0x277D85DD0];
        v33[1] = 3221225472;
        v33[2] = __86__HMDHome_performLocalAddAccessoryWithDescription_progressHandlerDelegate_completion___block_invoke;
        v33[3] = &unk_278689728;
        objc_copyWeak(&v35, buf);
        v34 = completionCopy;
        [v22 setResponseHandler:v33];
        [(HMDHome *)&selfCopy2->super.super.isa _handleAddAccessoryWithDescription:descriptionCopy progressHandlerDelegate:delegateCopy message:v22];

        objc_destroyWeak(&v35);
        objc_destroyWeak(buf);
      }
    }

    else
    {
      v28 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
      {
        v31 = HMFGetLogIdentifier();
        *buf = 138543618;
        v37 = v31;
        v38 = 2112;
        v39 = descriptionCopy;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, "%{public}@Will not perform local add accessory with setup description %@ without current accessory present", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v28);
      if (!completionCopy)
      {
        goto LABEL_20;
      }

      currentAccessoryUUID = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2020];
      completionCopy[2](completionCopy, currentAccessoryUUID);
    }

LABEL_19:

LABEL_20:
    goto LABEL_21;
  }

  if (completionCopy)
  {
    v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    completionCopy[2](completionCopy, v23);
  }

LABEL_21:

  v32 = *MEMORY[0x277D85DE8];
}

void __86__HMDHome_performLocalAddAccessoryWithDescription_progressHandlerDelegate_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    if (v5)
    {
      v12 = [MEMORY[0x277CCACA8] stringWithFormat:@"failed with error: %@", v5];
    }

    else
    {
      v12 = @"completed";
    }

    *buf = 138543618;
    v16 = v11;
    v17 = 2112;
    v18 = v12;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Perform local add accessory %@", buf, 0x16u);
    if (v5)
    {
    }
  }

  objc_autoreleasePoolPop(v8);
  v13 = *(a1 + 32);
  if (v13)
  {
    (*(v13 + 16))(v13, v5);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessory:(id)accessory
{
  accessoryCopy = accessory;
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsAddingAccessory = [localCapabilitiesDataSource supportsAddingAccessory];

  if (supportsAddingAccessory)
  {
    homeManager = [(HMDHome *)self homeManager];
    legacyAccessoryPairingController = [homeManager legacyAccessoryPairingController];
    if (legacyAccessoryPairingController)
    {
      v8 = legacyAccessoryPairingController;
      legacyAccessoryPairingController2 = [homeManager legacyAccessoryPairingController];
      v10 = [legacyAccessoryPairingController2 handleMessage:accessoryCopy from:self];

      if (v10)
      {
        goto LABEL_11;
      }
    }

    else
    {
    }

    v14 = [accessoryCopy dataForKey:*MEMORY[0x277CD1F90]];

    if (v14)
    {
      [(HMDHome *)self _handleAddAccessoryWithDescription:accessoryCopy];
    }

    else
    {
      [(HMDHome *)self _handleLegacyAddAccessory:accessoryCopy];
    }
  }

  else
  {
    responseHandler = [accessoryCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [accessoryCopy responseHandler];
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      (responseHandler2)[2](responseHandler2, v13, 0);
    }
  }

LABEL_11:
}

- (BOOL)_removeAccessory:(id)accessory
{
  v24 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  os_unfair_recursive_lock_lock_with_options();
  accessories = self->_accessories;
  uuid = [accessoryCopy uuid];
  v7 = [(NSMutableDictionary *)accessories objectForKeyedSubscript:uuid];

  if (v7)
  {
    v8 = self->_accessories;
    uuid2 = [accessoryCopy uuid];
    [(NSMutableDictionary *)v8 setObject:0 forKeyedSubscript:uuid2];

    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      uuid3 = [accessoryCopy uuid];
      v20 = 138543618;
      v21 = v13;
      v22 = 2112;
      v23 = uuid3;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Successfully removed accessory from list: %@", &v20, 0x16u);
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      shortDescription = [accessoryCopy shortDescription];
      v20 = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = shortDescription;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Asked to remove accessory that doesn't exist in list of accessories: %@", &v20, 0x16u);
    }
  }

  objc_autoreleasePoolPop(v10);
  os_unfair_recursive_lock_unlock();

  v18 = *MEMORY[0x277D85DE8];
  return v7 != 0;
}

- (void)removeAccessory:(id)accessory
{
  v34 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  if (accessoryCopy && [(HMDHome *)self _removeAccessory:accessoryCopy])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v8;
      v32 = 2112;
      v33 = accessoryCopy;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Removed accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    if ([accessoryCopy isPrimary])
    {
      v9 = accessoryCopy;
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();
      if (isKindOfClass)
      {
        v11 = v9;
      }

      else
      {
        v11 = 0;
      }

      v12 = v11;

      v13 = v9;
      objc_opt_class();
      v14 = objc_opt_isKindOfClass();
      if (v14)
      {
        v15 = v13;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;

      v17 = v13;
      objc_opt_class();
      v18 = objc_opt_isKindOfClass();
      if (v18)
      {
        v19 = v17;
      }

      else
      {
        v19 = 0;
      }

      v20 = v19;

      if (isKindOfClass)
      {
        workQueue = selfCopy->_workQueue;
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __27__HMDHome_removeAccessory___block_invoke;
        block[3] = &unk_27868A750;
        block[4] = selfCopy;
        v29 = v17;
        dispatch_async(workQueue, block);
        v22 = v29;
      }

      else
      {
        if ((v14 & 1) == 0)
        {
          if (v18)
          {
            accessoryBulletinNotificationManager = [(HMDHome *)selfCopy accessoryBulletinNotificationManager];
            [accessoryBulletinNotificationManager handleRemovedAccessory:v17];
          }

          goto LABEL_20;
        }

        v23 = selfCopy->_workQueue;
        v26[0] = MEMORY[0x277D85DD0];
        v26[1] = 3221225472;
        v26[2] = __27__HMDHome_removeAccessory___block_invoke_2;
        v26[3] = &unk_27868A750;
        v26[4] = selfCopy;
        v27 = v17;
        dispatch_async(v23, v26);
        v22 = v27;
      }

LABEL_20:
    }
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __27__HMDHome_removeAccessory___block_invoke(uint64_t a1)
{
  v22 = *MEMORY[0x277D85DE8];
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23 description:@"Retrieval cancelled reason:accessory removed" suggestion:{0, 0}];
  v3 = *(a1 + 32);
  v4 = [*(a1 + 40) identifier];
  [v3 _notifyRetrievalError:v2 accessoryServer:v4 linkType:0 accessoryOperationBlock:0];

  v19 = 0u;
  v20 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [*(a1 + 40) services];
  v6 = [v5 copy];

  v7 = [v6 countByEnumeratingWithState:&v17 objects:v21 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v18;
    do
    {
      v10 = 0;
      do
      {
        if (*v18 != v9)
        {
          objc_enumerationMutation(v6);
        }

        [*(a1 + 32) _removeService:*(*(&v17 + 1) + 8 * v10++)];
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v17 objects:v21 count:16];
    }

    while (v8);
  }

  v11 = [*(a1 + 40) cameraProfiles];
  v12 = [v11 count];

  if (v12)
  {
    v13 = [*(a1 + 32) cameraBulletinNotificationManager];
    [v13 handleRemovedCameraAccessory:*(a1 + 40)];
  }

  v14 = [*(a1 + 32) homeActivityStateManager];
  v15 = [v14 homeActivityStateAggregatorManager];
  [v15 handleRemovedAccessory:*(a1 + 40)];

  v16 = *MEMORY[0x277D85DE8];
}

void __27__HMDHome_removeAccessory___block_invoke_2(uint64_t a1)
{
  v3 = [*(a1 + 32) remoteEventRouterClientController];
  v2 = [*(a1 + 40) uuid];
  [v3 removeResidentRouterForAccessoryUUID:v2];
}

- (void)_addAccessories:(id)accessories
{
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __27__HMDHome__addAccessories___block_invoke;
  v3[3] = &unk_27866FC38;
  v3[4] = self;
  [accessories na_each:v3];
}

- (BOOL)_addAccessory:(id)accessory
{
  v21 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  os_unfair_recursive_lock_lock_with_options();
  accessories = self->_accessories;
  uuid = [accessoryCopy uuid];
  v7 = [(NSMutableDictionary *)accessories objectForKey:uuid];

  if (!v7)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      uuid2 = [accessoryCopy uuid];
      v17 = 138543618;
      v18 = v11;
      v19 = 2112;
      v20 = uuid2;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Added accessory to the home's list: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = self->_accessories;
    uuid3 = [accessoryCopy uuid];
    [(NSMutableDictionary *)v13 setObject:accessoryCopy forKey:uuid3];
  }

  os_unfair_recursive_lock_unlock();

  v15 = *MEMORY[0x277D85DE8];
  return v7 == 0;
}

- (void)addAccessory:(id)accessory
{
  v29 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v5 = accessoryCopy;
  if (!accessoryCopy)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v10;
      v11 = "%{public}@Attempting to add a nil accessory";
      v12 = v9;
      v13 = 12;
      goto LABEL_8;
    }

LABEL_9:

    objc_autoreleasePoolPop(v7);
    goto LABEL_11;
  }

  uuid = [accessoryCopy uuid];

  if (uuid)
  {
    if (![(HMDHome *)self _addAccessory:v5])
    {
      v7 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543618;
        v26 = v10;
        v27 = 2112;
        v28 = v5;
        v11 = "%{public}@Attempted to add an accessory that is already present: %@";
        v12 = v9;
        v13 = 22;
LABEL_8:
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, v11, buf, v13);

        goto LABEL_9;
      }

      goto LABEL_9;
    }
  }

  else
  {
    uuid2 = [v5 uuid];

    if (!uuid2)
    {
      v16 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_FAULT))
      {
        v19 = HMFGetLogIdentifier();
        shortDescription = [v5 shortDescription];
        *buf = 138543618;
        v26 = v19;
        v27 = 2112;
        v28 = shortDescription;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_FAULT, "%{public}@Submitting ABC event for failure: Attempted to add an accessory that does not have an uuid: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      v21 = [HMDAssertionLogEvent alloc];
      shortDescription2 = [v5 shortDescription];
      v23 = [(HMDAssertionLogEvent *)v21 initWithReason:@"Attempted to add an accessory that does not have an uuid: %@", shortDescription2];

      v24 = +[HMDMetricsManager sharedLogEventSubmitter];
      [v24 submitLogEvent:v23];
    }
  }

LABEL_11:

  v15 = *MEMORY[0x277D85DE8];
}

- (unint64_t)assistantAccessCapableAccessoryCount
{
  v15 = *MEMORY[0x277D85DE8];
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v11;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v11 != v6)
        {
          objc_enumerationMutation(accessories);
        }

        v5 += [HMDAssistantAccessControl isAccessorySupported:*(*(&v10 + 1) + 8 * i)];
      }

      v4 = [accessories countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  v8 = *MEMORY[0x277D85DE8];
  return v5;
}

- (BOOL)shouldEncodeLegacyLocationServiceSettingForSettingsParentUUID:(id)d
{
  v20 = *MEMORY[0x277D85DE8];
  dCopy = d;
  v5 = [(HMDHome *)self mediaSystemWithUUID:dCopy];
  v6 = v5;
  if (v5)
  {
    LODWORD(v7) = [v5 componentsSupportsHomeLevelLocationServiceSetting] ^ 1;
  }

  else
  {
    v8 = [(HMDHome *)self accessoryWithUUID:dCopy];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    if (v10)
    {
      LODWORD(v7) = [v10 supportsHomeLevelLocationServiceSetting] ^ 1;
    }

    else
    {
      v7 = objc_autoreleasePoolPush();
      selfCopy = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        v16 = 138543618;
        v17 = v13;
        v18 = 2112;
        v19 = dCopy;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to filter legacy location service setting due to no parent found with uuid: %@", &v16, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      LOBYTE(v7) = 0;
    }
  }

  v14 = *MEMORY[0x277D85DE8];
  return v7;
}

- (id)destinationControllerWithCommittedDestinationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  destinationControllers = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __67__HMDHome_destinationControllerWithCommittedDestinationIdentifier___block_invoke;
  v9[3] = &unk_27866FC10;
  v10 = identifierCopy;
  v6 = identifierCopy;
  v7 = [destinationControllers na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __67__HMDHome_destinationControllerWithCommittedDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 committedData];
  v4 = [v3 destinationIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationControllerWithDestinationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  destinationControllers = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __58__HMDHome_destinationControllerWithDestinationIdentifier___block_invoke;
  v9[3] = &unk_27866FC10;
  v10 = identifierCopy;
  v6 = identifierCopy;
  v7 = [destinationControllers na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __58__HMDHome_destinationControllerWithDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 data];
  v4 = [v3 destinationIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationControllerWithIdentifier:(id)identifier
{
  identifierCopy = identifier;
  destinationControllers = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __47__HMDHome_destinationControllerWithIdentifier___block_invoke;
  v9[3] = &unk_27866FC10;
  v10 = identifierCopy;
  v6 = identifierCopy;
  v7 = [destinationControllers na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __47__HMDHome_destinationControllerWithIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 identifier];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (id)destinationControllers
{
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v3 = [appleMediaAccessories na_map:&__block_literal_global_1341];

  return v3;
}

- (int64_t)destinationTypeForDestinationWithIdentifier:(id)identifier
{
  v40 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  [(HMDHome *)self appleMediaAccessories];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v5 = v37 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v35;
    v9 = 3;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v11 = *(*(&v34 + 1) + 8 * i);
        uuid = [v11 uuid];
        v13 = [uuid hmf_isEqualToUUID:identifierCopy];

        if (v13)
        {
          v17 = v5;
          goto LABEL_26;
        }

        audioDestination = [v11 audioDestination];
        uniqueIdentifier = [audioDestination uniqueIdentifier];
        v16 = [uniqueIdentifier hmf_isEqualToUUID:identifierCopy];

        if (v16)
        {
          v17 = v5;
          v9 = 1;
          goto LABEL_26;
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  [(HMDHome *)self mediaSystems];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v17 = v33 = 0u;
  v18 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
  if (v18)
  {
    v19 = v18;
    v20 = *v31;
    while (2)
    {
      for (j = 0; j != v19; ++j)
      {
        if (*v31 != v20)
        {
          objc_enumerationMutation(v17);
        }

        v22 = *(*(&v30 + 1) + 8 * j);
        uuid2 = [v22 uuid];
        v24 = [uuid2 hmf_isEqualToUUID:identifierCopy];

        if (v24)
        {
          v9 = 4;
          goto LABEL_25;
        }

        audioDestination2 = [v22 audioDestination];
        uniqueIdentifier2 = [audioDestination2 uniqueIdentifier];
        v27 = [uniqueIdentifier2 hmf_isEqualToUUID:identifierCopy];

        if (v27)
        {
          v9 = 2;
          goto LABEL_25;
        }
      }

      v19 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
      v9 = 0;
      if (v19)
      {
        continue;
      }

      break;
    }
  }

  else
  {
    v9 = 0;
  }

LABEL_25:

LABEL_26:
  v28 = *MEMORY[0x277D85DE8];
  return v9;
}

- (id)mediaDestinationsInRoom:(id)room
{
  v45 = *MEMORY[0x277D85DE8];
  roomCopy = room;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  mediaSystems = [(HMDHome *)self mediaSystems];
  v32 = appleMediaAccessories;
  v34 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{objc_msgSend(mediaSystems, "count") + objc_msgSend(appleMediaAccessories, "count")}];
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v7 = mediaSystems;
  v8 = [v7 countByEnumeratingWithState:&v39 objects:v44 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v40;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v40 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v39 + 1) + 8 * i);
        audioDestination = [v12 audioDestination];
        if (audioDestination)
        {
          if (!roomCopy)
          {
            goto LABEL_9;
          }

          room = [v12 room];
          uuid = [room uuid];
          uuid2 = [roomCopy uuid];
          v17 = [uuid hmf_isEqualToUUID:uuid2];

          if (v17)
          {
LABEL_9:
            [v34 addObject:audioDestination];
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v39 objects:v44 count:16];
    }

    while (v9);
  }

  v33 = v7;

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v18 = v32;
  v19 = [v18 countByEnumeratingWithState:&v35 objects:v43 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v36;
    do
    {
      for (j = 0; j != v20; ++j)
      {
        if (*v36 != v21)
        {
          objc_enumerationMutation(v18);
        }

        v23 = *(*(&v35 + 1) + 8 * j);
        audioDestination2 = [v23 audioDestination];
        if (audioDestination2)
        {
          if (!roomCopy)
          {
            if (_mediaSystemsContainsAccessory(v33, v23))
            {
              goto LABEL_25;
            }

LABEL_23:
            [v34 addObject:audioDestination2];
            goto LABEL_25;
          }

          room2 = [v23 room];
          uuid3 = [room2 uuid];
          uuid4 = [roomCopy uuid];
          if ([uuid3 hmf_isEqualToUUID:uuid4])
          {
            v28 = _mediaSystemsContainsAccessory(v33, v23);

            if ((v28 & 1) == 0)
            {
              goto LABEL_23;
            }
          }

          else
          {
          }
        }

LABEL_25:
      }

      v20 = [v18 countByEnumeratingWithState:&v35 objects:v43 count:16];
    }

    while (v20);
  }

  v29 = [v34 copy];
  v30 = *MEMORY[0x277D85DE8];

  return v29;
}

- (id)mediaDestinationManagersWithSupportedOptions:(unint64_t)options
{
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  mediaSystems = [(HMDHome *)self mediaSystems];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke;
  v15[3] = &__block_descriptor_40_e54____HMDMediaDestinationManager__16__0__HMDMediaSystem_8l;
  v15[4] = options;
  v7 = [mediaSystems na_map:v15];
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke_2;
  v12[3] = &unk_27866FBC8;
  v13 = mediaSystems;
  optionsCopy = options;
  v8 = mediaSystems;
  v9 = [appleMediaAccessories na_map:v12];
  v10 = [v9 arrayByAddingObjectsFromArray:v7];

  return v10;
}

id __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 audioDestinationManager];
  v4 = [v3 destination];
  LODWORD(a1) = [v4 containsSupportedOptions:*(a1 + 32)];

  if (a1)
  {
    v5 = v3;
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

id __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = [v4 destination];
  if ([v5 containsSupportedOptions:*(a1 + 40)])
  {
    v6 = _mediaSystemsContainsAccessory(*(a1 + 32), v3);

    if ((v6 & 1) == 0)
    {
      v7 = v4;
      goto LABEL_6;
    }
  }

  else
  {
  }

  v7 = 0;
LABEL_6:

  return v7;
}

- (id)mediaDestinationManagersWithHomeTheaterSupportedOptions
{
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  mediaSystems = [(HMDHome *)self mediaSystems];
  v5 = [mediaSystems na_map:&__block_literal_global_1336];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke_2;
  v10[3] = &unk_27866FB80;
  v11 = mediaSystems;
  v6 = mediaSystems;
  v7 = [appleMediaAccessories na_map:v10];
  v8 = [v7 arrayByAddingObjectsFromArray:v5];

  return v8;
}

id __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = [v4 destination];
  if ([v5 containsHomeTheaterSupportedOptions])
  {
    v6 = _mediaSystemsContainsAccessory(*(a1 + 32), v3);

    if ((v6 & 1) == 0)
    {
      v7 = v4;
      goto LABEL_6;
    }
  }

  else
  {
  }

  v7 = 0;
LABEL_6:

  return v7;
}

id __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 audioDestinationManager];
  v3 = [v2 destination];
  v4 = [v3 containsHomeTheaterSupportedOptions];

  if (v4)
  {
    v5 = v2;
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)destinationManagerPassingTest:(id)test
{
  v28 = *MEMORY[0x277D85DE8];
  testCopy = test;
  [(HMDHome *)self appleMediaAccessories];
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v5 = v25 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v22 objects:v27 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v23;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v23 != v8)
        {
          objc_enumerationMutation(v5);
        }

        audioDestinationManager = [*(*(&v22 + 1) + 8 * i) audioDestinationManager];
        if (audioDestinationManager && (testCopy[2](testCopy, audioDestinationManager) & 1) != 0)
        {
          v11 = v5;
          goto LABEL_22;
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v22 objects:v27 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  [(HMDHome *)self mediaSystems];
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v11 = v21 = 0u;
  v12 = [v11 countByEnumeratingWithState:&v18 objects:v26 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v19;
LABEL_12:
    v15 = 0;
    while (1)
    {
      if (*v19 != v14)
      {
        objc_enumerationMutation(v11);
      }

      audioDestinationManager = [*(*(&v18 + 1) + 8 * v15) audioDestinationManager];
      if (audioDestinationManager)
      {
        if (testCopy[2](testCopy, audioDestinationManager))
        {
          break;
        }
      }

      if (v13 == ++v15)
      {
        v13 = [v11 countByEnumeratingWithState:&v18 objects:v26 count:16];
        if (v13)
        {
          goto LABEL_12;
        }

        goto LABEL_19;
      }
    }
  }

  else
  {
LABEL_19:
    audioDestinationManager = 0;
  }

LABEL_22:
  v16 = *MEMORY[0x277D85DE8];

  return audioDestinationManager;
}

- (id)destinationManagerWithDestinationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __55__HMDHome_destinationManagerWithDestinationIdentifier___block_invoke;
  v8[3] = &unk_27867ADF8;
  v9 = identifierCopy;
  v5 = identifierCopy;
  v6 = [(HMDHome *)self destinationManagerPassingTest:v8];

  return v6;
}

uint64_t __55__HMDHome_destinationManagerWithDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 destination];
  v4 = [v3 uniqueIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationManagerWithParentIdentifier:(id)identifier
{
  identifierCopy = identifier;
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __50__HMDHome_destinationManagerWithParentIdentifier___block_invoke;
  v8[3] = &unk_27867ADF8;
  v9 = identifierCopy;
  v5 = identifierCopy;
  v6 = [(HMDHome *)self destinationManagerPassingTest:v8];

  return v6;
}

uint64_t __50__HMDHome_destinationManagerWithParentIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 destination];
  v4 = [v3 parentIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)rootDestinationManagerWithDescendantDestinationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  mediaSystems = [(HMDHome *)self mediaSystems];
  v10 = MEMORY[0x277D85DD0];
  v11 = 3221225472;
  v12 = __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke;
  v13 = &unk_278689258;
  selfCopy = self;
  v15 = identifierCopy;
  v6 = identifierCopy;
  v7 = [mediaSystems na_firstObjectPassingTest:&v10];
  audioDestinationManager = [v7 audioDestinationManager];

  return audioDestinationManager;
}

uint64_t __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 components];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke_2;
  v7[3] = &unk_27866FB38;
  v4 = *(a1 + 40);
  v7[4] = *(a1 + 32);
  v8 = v4;
  v5 = [v3 na_any:v7];

  return v5;
}

uint64_t __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke_2(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 accessory];
  v5 = [v3 accessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v8 = *(a1 + 40);
    v9 = [v7 audioDestination];
    v10 = [v9 uniqueIdentifier];
    v11 = [v8 hmf_isEqualToUUID:v10];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = *(a1 + 32);
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543874;
      v19 = v15;
      v20 = 2112;
      v21 = v3;
      v22 = 2112;
      v23 = v4;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to apple media accessory from component: %@ accessory: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];
  return v11;
}

- (id)destinationManagersWithDestinationIdentifiers:(id)identifiers supportedOptions:(unint64_t)options
{
  identifiersCopy = identifiers;
  v7 = [(HMDHome *)self mediaDestinationManagersWithSupportedOptions:options];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __74__HMDHome_destinationManagersWithDestinationIdentifiers_supportedOptions___block_invoke;
  v11[3] = &unk_27867ADF8;
  v12 = identifiersCopy;
  v8 = identifiersCopy;
  v9 = [v7 na_filter:v11];

  return v9;
}

uint64_t __74__HMDHome_destinationManagersWithDestinationIdentifiers_supportedOptions___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 identifier];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (id)targetAccessoriesWithDestinationIdentifiers:(id)identifiers
{
  v32 = *MEMORY[0x277D85DE8];
  identifiersCopy = identifiers;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  mediaSystems = [(HMDHome *)self mediaSystems];
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke;
  v24[3] = &unk_27866FAE8;
  v7 = identifiersCopy;
  v25 = v7;
  v8 = [mediaSystems na_map:v24];
  v19 = MEMORY[0x277D85DD0];
  v20 = 3221225472;
  v21 = __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke_2;
  v22 = &unk_27866FB10;
  v9 = v7;
  v23 = v9;
  v10 = [appleMediaAccessories na_map:&v19];
  v11 = [v8 arrayByAddingObjectsFromArray:{v10, v19, v20, v21, v22}];
  v12 = [v11 count];
  if (v12 != [v9 count])
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543874;
      v27 = v16;
      v28 = 2112;
      v29 = v9;
      v30 = 2112;
      v31 = v11;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to get target accessories for destination identifiers: %@ targets: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v11 = MEMORY[0x277CBEBF8];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

id __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = *(a1 + 32);
  v6 = [v4 identifier];
  LODWORD(v5) = [v5 containsObject:v6];

  if (v5)
  {
    v7 = [v3 targetAccessory];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

id __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = *(a1 + 32);
  v6 = [v4 identifier];
  LODWORD(v5) = [v5 containsObject:v6];

  if (v5)
  {
    v7 = v3;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)audioDestinationControllerDataForDestination:(id)destination
{
  destinationCopy = destination;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __56__HMDHome_audioDestinationControllerDataForDestination___block_invoke;
  v10[3] = &unk_278688F28;
  v11 = destinationCopy;
  v6 = destinationCopy;
  v7 = [appleMediaAccessories na_firstObjectPassingTest:v10];

  audioDestinationControllerData = [v7 audioDestinationControllerData];

  return audioDestinationControllerData;
}

uint64_t __56__HMDHome_audioDestinationControllerDataForDestination___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 audioDestinationControllerData];
  v4 = [v3 destinationIdentifier];
  v5 = [*(a1 + 32) uniqueIdentifier];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

- (id)mediaSystemForAppleMediaAccessory:(id)accessory
{
  v17 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  mediaSystems = [(HMDHome *)self mediaSystems];
  v6 = [mediaSystems countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v6)
  {
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(mediaSystems);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if (_mediaSystemContainsAccessory(v9, accessoryCopy))
        {
          v6 = v9;
          goto LABEL_11;
        }
      }

      v6 = [mediaSystems countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v10 = *MEMORY[0x277D85DE8];

  return v6;
}

- (NSArray)appleMediaAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_1329];

  return v3;
}

void *__32__HMDHome_appleMediaAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)_setAccessories:(id)accessories
{
  accessoriesCopy = accessories;
  os_unfair_recursive_lock_lock_with_options();
  if (accessoriesCopy)
  {
    v4 = [accessoriesCopy na_dictionaryWithKeyGenerator:&__block_literal_global_1327];
    v5 = [v4 mutableCopy];
    accessories = self->_accessories;
    self->_accessories = v5;
  }

  else
  {
    [(NSMutableDictionary *)self->_accessories removeAllObjects];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)setAccessories:(id)accessories
{
  v29 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  [(HMDHome *)self _setAccessories:accessoriesCopy];
  v25 = 0u;
  v26 = 0u;
  v23 = 0u;
  v24 = 0u;
  v5 = accessoriesCopy;
  v6 = [v5 countByEnumeratingWithState:&v23 objects:v28 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v24;
    do
    {
      v9 = 0;
      do
      {
        if (*v24 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v23 + 1) + 8 * v9);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v12)
        {
          v21 = 0u;
          v22 = 0u;
          v19 = 0u;
          v20 = 0u;
          serviceGroups = [(HMDHome *)self serviceGroups];
          v14 = [serviceGroups countByEnumeratingWithState:&v19 objects:v27 count:16];
          if (v14)
          {
            v15 = v14;
            v16 = *v20;
            do
            {
              v17 = 0;
              do
              {
                if (*v20 != v16)
                {
                  objc_enumerationMutation(serviceGroups);
                }

                [*(*(&v19 + 1) + 8 * v17++) fixupServicesForReplacementAccessory:v12];
              }

              while (v15 != v17);
              v15 = [serviceGroups countByEnumeratingWithState:&v19 objects:v27 count:16];
            }

            while (v15);
          }
        }

        ++v9;
      }

      while (v9 != v7);
      v7 = [v5 countByEnumeratingWithState:&v23 objects:v28 count:16];
    }

    while (v7);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (NSArray)accessories
{
  os_unfair_recursive_lock_lock_with_options();
  allValues = [(NSMutableDictionary *)self->_accessories allValues];
  os_unfair_recursive_lock_unlock();

  return allValues;
}

- (HMDAccessory)currentAccessory
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_firstObjectPassingTest:&__block_literal_global_1325];

  return v3;
}

uint64_t __27__HMDHome_currentAccessory__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = v4;
  if (v4)
  {
    v6 = [v4 isCurrentAccessory];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)_handleRemoveZoneModel:(id)model message:(id)message
{
  v35[5] = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];
  v6 = [(HMDHome *)self zoneWithUUID:uuid];
  v7 = v6;
  if (v6)
  {
    name = [v6 name];
    v9 = [(HMDHome *)self removeName:name];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_zones removeObject:v7];
    os_unfair_recursive_lock_unlock();
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    [transactionResult markSaveToAssistant];
    v34[0] = *MEMORY[0x277CD0640];
    uuid2 = [(HMDHome *)self uuid];
    uUIDString = [uuid2 UUIDString];
    v35[0] = uUIDString;
    v34[1] = *MEMORY[0x277CD27B0];
    name2 = [v7 name];
    v35[1] = name2;
    v34[2] = *MEMORY[0x277CD27B8];
    uuid3 = [v7 uuid];
    uUIDString2 = [uuid3 UUIDString];
    v35[2] = uUIDString2;
    v34[3] = *MEMORY[0x277CD15F0];
    spiClientIdentifier = [v7 spiClientIdentifier];
    uUIDString3 = [spiClientIdentifier UUIDString];
    v35[3] = uUIDString3;
    v34[4] = *MEMORY[0x277CD15E8];
    urlString = [v7 urlString];
    v35[4] = urlString;
    v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:5];

    logAndPostNotification(@"HMDZoneRemovedNotification", v7, v25);
    v18 = objc_autoreleasePoolPush();
    selfCopy = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      name3 = [v7 name];
      *buf = 138543618;
      v31 = v21;
      v32 = 2112;
      v33 = name3;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Removed zone: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
  }

  else
  {
    v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v23];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveZone:(id)zone
{
  zoneCopy = zone;
  v5 = [zoneCopy uuidForKey:*MEMORY[0x277CD27B8]];
  v6 = [(HMDHome *)self zoneWithUUID:v5];
  if (v6)
  {
    v7 = [HMDZoneModel alloc];
    uuid = [(HMDHome *)self uuid];
    v9 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v5 parentUUID:uuid];

    backingStore = [(HMDHome *)self backingStore];
    name = [zoneCopy name];
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [backingStore transaction:name options:v12];

    [v13 add:v9];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __29__HMDHome__handleRemoveZone___block_invoke;
    v14[3] = &unk_27868A250;
    v15 = zoneCopy;
    [v13 run:v14];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [zoneCopy respondWithError:v9];
  }
}

- (void)_handleAddZoneModel:(id)model message:(id)message
{
  v35 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  name = [modelCopy name];
  hm_truncatedNameString = [name hm_truncatedNameString];

  uuid = [modelCopy uuid];
  if (hm_truncatedNameString && uuid)
  {
    v10 = [[HMDZone alloc] initWithName:hm_truncatedNameString uuid:uuid home:self];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_zones addObject:v10];
    os_unfair_recursive_lock_unlock();
    msgDispatcher = [(HMDHome *)self msgDispatcher];
    workQueue = [(HMDHome *)self workQueue];
    [(HMDZone *)v10 configure:msgDispatcher queue:workQueue];

    [(HMDZone *)v10 updateZoneWithModel:modelCopy message:messageCopy error:0];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    roomUUIDs = [(HMDZone *)v10 roomUUIDs];
    v15 = [roomUUIDs count];

    if (v15)
    {
      [transactionResult markSaveToAssistant];
    }

    v29[0] = *MEMORY[0x277CD0640];
    uuid2 = [(HMDHome *)self uuid];
    uUIDString = [uuid2 UUIDString];
    v18 = *MEMORY[0x277CD27B0];
    v30[0] = uUIDString;
    v30[1] = hm_truncatedNameString;
    v19 = *MEMORY[0x277CD27B8];
    v29[1] = v18;
    v29[2] = v19;
    uuid3 = [(HMDZone *)v10 uuid];
    uUIDString2 = [uuid3 UUIDString];
    v30[2] = uUIDString2;
    v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:v29 count:3];

    logAndPostNotification(@"HMDZoneAddedNotification", v10, v22);
    [messageCopy respondWithPayload:0];
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    selfCopy = self;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v32 = v26;
      v33 = 2112;
      v34 = hm_truncatedNameString;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; invalid parameter", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [messageCopy respondWithError:v10];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddZone:(id)zone
{
  v47 = *MEMORY[0x277D85DE8];
  zoneCopy = zone;
  v5 = [zoneCopy stringForKey:*MEMORY[0x277CD27B0]];
  v6 = [zoneCopy uuidForKey:*MEMORY[0x277CD0B10]];
  v7 = v6;
  if (v5)
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (!v8)
  {
    v11 = HMMaxLengthForNaming();
    if ([v5 length] > v11)
    {
      v12 = objc_autoreleasePoolPush();
      selfCopy = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        v15 = HMFGetLogIdentifier();
        *buf = 138543362;
        v44 = v15;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v12);
      v9 = MEMORY[0x277CCA9B8];
      v10 = 46;
      goto LABEL_11;
    }

    v16 = [(HMDHome *)self zoneWithName:v5];
    if (v16)
    {
      v17 = MEMORY[0x277CCA9B8];
      v18 = 1;
    }

    else
    {
      zones = [(HMDHome *)self zones];
      v20 = [zones count];
      v21 = maximumZonesPerHome;

      if (v20 < v21)
      {
        v22 = [(HMDHome *)self addName:v5];
        if (!v22)
        {
          v32 = [HMDZoneModel alloc];
          uuid = [(HMDHome *)self uuid];
          v34 = [(HMDBackingStoreModelObject *)v32 initWithObjectChangeType:1 uuid:v7 parentUUID:uuid];

          [(HMDZoneModel *)v34 setName:v5];
          backingStore = [(HMDHome *)self backingStore];
          name = [zoneCopy name];
          v37 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v38 = [backingStore transaction:name options:v37];

          [v38 add:v34];
          v39[0] = MEMORY[0x277D85DD0];
          v39[1] = 3221225472;
          v39[2] = __26__HMDHome__handleAddZone___block_invoke;
          v39[3] = &unk_278688D58;
          v40 = zoneCopy;
          v41 = v7;
          v42 = v5;
          [v38 run:v39];

          goto LABEL_24;
        }

        v23 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          v26 = HMFGetLogIdentifier();
          *buf = 138543618;
          v44 = v26;
          v45 = 2112;
          v46 = v5;
          _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; invalid parameter", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
LABEL_23:
        [zoneCopy respondWithError:v22];
LABEL_24:

        goto LABEL_25;
      }

      v27 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543618;
        v44 = v30;
        v45 = 2112;
        v46 = v5;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; already at maximum zones for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v27);
      v17 = MEMORY[0x277CCA9B8];
      v18 = 49;
    }

    v22 = [v17 hmErrorWithCode:v18];
    goto LABEL_23;
  }

  v9 = MEMORY[0x277CCA9B8];
  v10 = 20;
LABEL_11:
  v16 = [v9 hmErrorWithCode:v10];
  [zoneCopy respondWithError:v16];
LABEL_25:

  v31 = *MEMORY[0x277D85DE8];
}

void __26__HMDHome__handleAddZone___block_invoke(uint64_t a1, uint64_t a2)
{
  v10[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v9[0] = *MEMORY[0x277CD27B8];
    v6 = [*(a1 + 40) UUIDString];
    v9[1] = *MEMORY[0x277CD27B0];
    v10[0] = v6;
    v10[1] = *(a1 + 48);
    v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v10 forKeys:v9 count:2];
    [v2 respondWithPayload:v7];

    v8 = *MEMORY[0x277D85DE8];
  }
}

- (void)test_addZones:(id)zones
{
  zonesCopy = zones;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_zones addObjectsFromArray:zonesCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)zones
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_zones copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleRemoveRoomModel:(id)model message:(id)message
{
  v67 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v47 = modelCopy;
  uuid = [modelCopy uuid];
  v7 = [(HMDHome *)self roomWithUUID:uuid];
  v8 = v7;
  if (!v7)
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v14];
    goto LABEL_6;
  }

  uuid2 = [v7 uuid];
  roomForEntireHome = [(HMDHome *)self roomForEntireHome];
  uuid3 = [roomForEntireHome uuid];
  v12 = [uuid2 isEqual:uuid3];

  if (v12)
  {
    responseHandler = [messageCopy responseHandler];

    if (responseHandler)
    {
      v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:29];
      responseHandler2 = [messageCopy responseHandler];
      (responseHandler2)[2](responseHandler2, v14, 0);

LABEL_6:
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      name = [v8 name];
      *buf = 138543618;
      v64 = v18;
      v65 = 2112;
      v66 = name;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Remove room: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v61[0] = *MEMORY[0x277CD0640];
    uuid4 = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid4 UUIDString];
    v62[0] = uUIDString;
    v61[1] = *MEMORY[0x277CD0D30];
    name2 = [v8 name];
    v62[1] = name2;
    v61[2] = *MEMORY[0x277CD0D40];
    uUIDString2 = [uuid UUIDString];
    v62[2] = uUIDString2;
    v61[3] = *MEMORY[0x277CD0D38];
    spiClientIdentifier = [v8 spiClientIdentifier];
    uUIDString3 = [spiClientIdentifier UUIDString];
    v62[3] = uUIDString3;
    v61[4] = *MEMORY[0x277CD0D28];
    urlString = [v8 urlString];
    v62[4] = urlString;
    v46 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v62 forKeys:v61 count:5];

    logAndPostNotification(@"HMDRoomRemovedNotification", v8, v46);
    v57 = 0u;
    v58 = 0u;
    v55 = 0u;
    v56 = 0u;
    zones = [(HMDHome *)selfCopy zones];
    v28 = [zones countByEnumeratingWithState:&v55 objects:v60 count:16];
    if (v28)
    {
      v29 = *v56;
      do
      {
        for (i = 0; i != v28; ++i)
        {
          if (*v56 != v29)
          {
            objc_enumerationMutation(zones);
          }

          [*(*(&v55 + 1) + 8 * i) removeRoom:v8];
        }

        v28 = [zones countByEnumeratingWithState:&v55 objects:v60 count:16];
      }

      while (v28);
    }

    v53 = 0u;
    v54 = 0u;
    v51 = 0u;
    v52 = 0u;
    accessories = [(HMDHome *)selfCopy accessories];
    v32 = [accessories countByEnumeratingWithState:&v51 objects:v59 count:16];
    if (v32)
    {
      v33 = *v52;
      do
      {
        for (j = 0; j != v32; ++j)
        {
          if (*v52 != v33)
          {
            objc_enumerationMutation(accessories);
          }

          v35 = *(*(&v51 + 1) + 8 * j);
          uuid5 = [v8 uuid];
          room = [v35 room];
          uuid6 = [room uuid];
          v39 = [uuid5 isEqual:uuid6];

          if (v39)
          {
            transactionResult = [messageCopy transactionResult];
            roomForEntireHome2 = [(HMDHome *)selfCopy roomForEntireHome];
            [v35 updateRoom:roomForEntireHome2 source:{objc_msgSend(transactionResult, "source")}];
          }
        }

        v32 = [accessories countByEnumeratingWithState:&v51 objects:v59 count:16];
      }

      while (v32);
    }

    name3 = [v8 name];
    v43 = [(HMDHome *)selfCopy removeName:name3];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)selfCopy->_rooms removeObject:v8];
    os_unfair_recursive_lock_unlock();
    transactionResult2 = [messageCopy transactionResult];
    [transactionResult2 markChanged];
    [transactionResult2 markSaveToAssistant];
    [messageCopy respondWithPayload:v46];
  }

  v45 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveRoom:(id)room
{
  v61 = *MEMORY[0x277D85DE8];
  roomCopy = room;
  v5 = [roomCopy uuidForKey:*MEMORY[0x277CD0D40]];
  if (!v5)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      messagePayload = [roomCopy messagePayload];
      *buf = 138543618;
      v58 = v19;
      v59 = 2112;
      v60 = messagePayload;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot find room UUID in remove room message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
    goto LABEL_9;
  }

  roomForEntireHome = [(HMDHome *)self roomForEntireHome];
  uuid = [roomForEntireHome uuid];
  v8 = [v5 isEqual:uuid];

  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      roomForEntireHome2 = [(HMDHome *)selfCopy2 roomForEntireHome];
      *buf = 138543618;
      v58 = v12;
      v59 = 2112;
      v60 = roomForEntireHome2;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle request to remove roomForEntireHome: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 29;
LABEL_9:
    v21 = [v14 hmErrorWithCode:v15];
    [roomCopy respondWithError:v21];
    goto LABEL_29;
  }

  v21 = [(HMDHome *)self roomWithUUID:v5];
  v22 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v23 = HMFGetOSLogHandle();
  v24 = v23;
  if (v21)
  {
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v25;
      v59 = 2112;
      v60 = v21;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Removing room: %@", buf, 0x16u);
    }

    v49 = v21;

    objc_autoreleasePoolPop(v22);
    v26 = [HMDRoomModel alloc];
    uuid2 = [(HMDHome *)selfCopy3 uuid];
    v28 = [(HMDBackingStoreModelObject *)v26 initWithObjectChangeType:3 uuid:v5 parentUUID:uuid2];

    backingStore = [(HMDHome *)selfCopy3 backingStore];
    [roomCopy name];
    v31 = v30 = roomCopy;
    v32 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v33 = [backingStore transaction:v31 options:v32];

    v48 = v28;
    v50 = v30;
    [v33 add:v28 withMessage:v30];
    v54 = 0u;
    v55 = 0u;
    v52 = 0u;
    v53 = 0u;
    accessories = [(HMDHome *)selfCopy3 accessories];
    v35 = [accessories countByEnumeratingWithState:&v52 objects:v56 count:16];
    if (v35)
    {
      v36 = v35;
      v37 = *v53;
      do
      {
        for (i = 0; i != v36; ++i)
        {
          if (*v53 != v37)
          {
            objc_enumerationMutation(accessories);
          }

          v39 = *(*(&v52 + 1) + 8 * i);
          room = [v39 room];
          uuid3 = [room uuid];
          v42 = [v5 isEqual:uuid3];

          if (v42)
          {
            roomForEntireHome3 = [(HMDHome *)selfCopy3 roomForEntireHome];
            v44 = [v39 modelWithUpdatedRoom:roomForEntireHome3];

            if (v44)
            {
              [v33 add:v44];
            }
          }
        }

        v36 = [accessories countByEnumeratingWithState:&v52 objects:v56 count:16];
      }

      while (v36);
    }

    [v33 run];
    v21 = v49;
    roomCopy = v50;
    v45 = v48;
  }

  else
  {
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v46;
      v59 = 2112;
      v60 = v5;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Could not find room to remove with UUID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v45 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [roomCopy respondWithError:v45];
  }

LABEL_29:
  v47 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddRoomModel:(id)model message:(id)message
{
  v38 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  name = [modelCopy name];
  uuid = [modelCopy uuid];
  if (name && uuid)
  {
    hm_truncatedNameString = [name hm_truncatedNameString];

    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v35 = v13;
      v36 = 2112;
      v37 = hm_truncatedNameString;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Add room: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [[HMDRoom alloc] initWithName:hm_truncatedNameString uuid:uuid home:selfCopy];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)selfCopy->_rooms addObject:v14];
    os_unfair_recursive_lock_unlock();
    msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
    workQueue = [(HMDHome *)selfCopy workQueue];
    [(HMDRoom *)v14 configure:msgDispatcher queue:workQueue];

    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    [transactionResult markSaveToAssistant];
    v32[0] = *MEMORY[0x277CD0640];
    uuid2 = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid2 UUIDString];
    v20 = *MEMORY[0x277CD0D30];
    v33[0] = uUIDString;
    v33[1] = hm_truncatedNameString;
    v21 = *MEMORY[0x277CD0D40];
    v32[1] = v20;
    v32[2] = v21;
    uuid3 = [(HMDRoom *)v14 uuid];
    uUIDString2 = [uuid3 UUIDString];
    v33[2] = uUIDString2;
    v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v33 forKeys:v32 count:3];

    logAndPostNotification(@"HMDRoomAddedNotification", v14, v24);
    [messageCopy respondWithPayload:v24];

    name = hm_truncatedNameString;
    goto LABEL_10;
  }

  v25 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
  {
    v28 = HMFGetLogIdentifier();
    *buf = 138543618;
    v35 = v28;
    v36 = 2112;
    v37 = name;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@; invalid parameter", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v25);
  responseHandler = [messageCopy responseHandler];

  if (responseHandler)
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    transactionResult = [messageCopy responseHandler];
    (transactionResult)[2](transactionResult, v14, 0);
LABEL_10:
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddRoom:(id)room
{
  v41 = *MEMORY[0x277D85DE8];
  roomCopy = room;
  v5 = [roomCopy stringForKey:*MEMORY[0x277CD0D30]];
  v6 = HMMaxLengthForNaming();
  if ([v5 length] <= v6)
  {
    v12 = [(HMDHome *)self roomWithName:v5];
    if (v12)
    {
      v11 = v12;
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:1];
      [roomCopy respondWithError:v13];

      goto LABEL_17;
    }

    rooms = [(HMDHome *)self rooms];
    v15 = [rooms count];
    v16 = maximumRoomsPerHome;

    if (v15 >= v16)
    {
      v22 = objc_autoreleasePoolPush();
      selfCopy = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        v25 = HMFGetLogIdentifier();
        v35 = 138543618;
        v36 = v25;
        v37 = 2112;
        v38 = v5;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@ to home; already at maximum rooms for home", &v35, 0x16u);
      }

      objc_autoreleasePoolPop(v22);
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    }

    else
    {
      v17 = [(HMDHome *)self addName:v5];
      if (!v17)
      {
        v27 = [HMDRoomModel alloc];
        v28 = [roomCopy uuidForKey:*MEMORY[0x277CD0B10]];
        uuid = [(HMDHome *)self uuid];
        v30 = [(HMDBackingStoreModelObject *)v27 initWithObjectChangeType:1 uuid:v28 parentUUID:uuid];

        [(HMDRoomModel *)v30 setName:v5];
        backingStore = [(HMDHome *)self backingStore];
        name = [roomCopy name];
        v33 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v34 = [backingStore transaction:name options:v33];

        [v34 add:v30 withMessage:roomCopy];
        [v34 run];

        goto LABEL_16;
      }

      v18 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        v35 = 138543874;
        v36 = v21;
        v37 = 2112;
        v38 = v5;
        v39 = 2112;
        v40 = v17;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@ to home; namespace error %@", &v35, 0x20u);
      }

      objc_autoreleasePoolPop(v18);
    }

    [roomCopy respondWithError:v17];
LABEL_16:

    v11 = 0;
    goto LABEL_17;
  }

  v7 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v35 = 138543362;
    v36 = v10;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v35, 0xCu);
  }

  objc_autoreleasePoolPop(v7);
  v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
  [roomCopy respondWithError:v11];
LABEL_17:

  v26 = *MEMORY[0x277D85DE8];
}

- (void)test_addRooms:(id)rooms
{
  roomsCopy = rooms;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_rooms addObjectsFromArray:roomsCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)rooms
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_rooms copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleHomeDataRequest:(id)request
{
  requestCopy = request;
  residentSyncManager = [(HMDHome *)self residentSyncManager];
  [residentSyncManager performSync];

  [requestCopy respondWithSuccess];
}

- (id)_handleRenameHomeModel:(id)model message:(id)message
{
  v24[2] = *MEMORY[0x277D85DE8];
  messageCopy = message;
  name = [model name];
  hm_truncatedNameString = [name hm_truncatedNameString];

  if (hm_truncatedNameString && [hm_truncatedNameString length])
  {
    transactionResult = [messageCopy transactionResult];
    label = [transactionResult label];
    v11 = [label isEqualToString:*MEMORY[0x277CD2540]];

    if ((v11 & 1) == 0)
    {
      homeManager = [(HMDHome *)self homeManager];
      name2 = [(HMDHome *)self name];
      uuid = [homeManager uuid];
      v24[0] = uuid;
      uuid2 = [(HMDHome *)self uuid];
      v24[1] = uuid2;
      v16 = [MEMORY[0x277CBEA60] arrayWithObjects:v24 count:2];
      v17 = [homeManager replaceName:name2 withNewName:hm_truncatedNameString inNamespaces:v16];
    }

    [(HMDHome *)self setName:hm_truncatedNameString];
    v22 = @"HMDHomeNameNotificationKey";
    v23 = hm_truncatedNameString;
    v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v23 forKeys:&v22 count:1];
    logAndPostNotification(@"HMDHomeNameChangedNotification", self, v18);

    v19 = 0;
  }

  else
  {
    v19 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
  }

  v20 = *MEMORY[0x277D85DE8];

  return v19;
}

- (void)_handleRename:(id)rename
{
  v35 = *MEMORY[0x277D85DE8];
  renameCopy = rename;
  v5 = [renameCopy stringForKey:*MEMORY[0x277CD23D0]];
  v6 = HMMaxLengthForNaming();
  if ([v5 length] <= v6)
  {
    homeManager = [(HMDHome *)self homeManager];
    name = [(HMDHome *)self name];
    uuid = [homeManager uuid];
    v32[0] = uuid;
    uuid2 = [(HMDHome *)self uuid];
    v32[1] = uuid2;
    v15 = [MEMORY[0x277CBEA60] arrayWithObjects:v32 count:2];
    v16 = [homeManager replaceName:name withNewName:v5 inNamespaces:v15];

    if (v16)
    {
      if ([(HMDHomeModel *)v16 code]== 31)
      {
        v17 = MEMORY[0x277CCA9B8];
        v18 = *MEMORY[0x277CCFD28];
        userInfo = [(HMDHomeModel *)v16 userInfo];
        v20 = [v17 errorWithDomain:v18 code:32 userInfo:userInfo];

        v16 = v20;
      }

      [renameCopy respondWithError:v16];
    }

    else
    {
      v21 = [HMDHomeModel alloc];
      uuid3 = [(HMDHome *)self uuid];
      uuid4 = [homeManager uuid];
      v16 = [(HMDBackingStoreModelObject *)v21 initWithObjectChangeType:2 uuid:uuid3 parentUUID:uuid4];

      [(HMDHomeModel *)v16 setName:v5];
      backingStore = [(HMDHome *)self backingStore];
      name2 = [renameCopy name];
      v26 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v27 = [backingStore transaction:name2 options:v26];

      [v27 add:v16];
      v29[0] = MEMORY[0x277D85DD0];
      v29[1] = 3221225472;
      v29[2] = __25__HMDHome__handleRename___block_invoke;
      v29[3] = &unk_27868A1D8;
      v30 = renameCopy;
      v31 = v5;
      [v27 run:v29];
    }
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v34 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    homeManager = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
    [renameCopy respondWithError:homeManager];
  }

  v28 = *MEMORY[0x277D85DE8];
}

void __25__HMDHome__handleRename___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v5 = *(a1 + 40);
    v8 = *MEMORY[0x277CD23D0];
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [v2 respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (id)_unexpectedCharacteristicsFromCharacteristicNotifications:(id)notifications
{
  v94 = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  notificationRegistrations = [(HMDHome *)self notificationRegistrations];
  v6 = [notificationRegistrations count];

  if (v6)
  {
    v7 = MEMORY[0x277CBEBF8];
    goto LABEL_42;
  }

  array = [MEMORY[0x277CBEB18] array];
  context = objc_autoreleasePoolPush();
  allKeys = [notificationsCopy allKeys];
  v82[0] = MEMORY[0x277D85DD0];
  v82[1] = 3221225472;
  v82[2] = __69__HMDHome__unexpectedCharacteristicsFromCharacteristicNotifications___block_invoke;
  v82[3] = &unk_27866FAC0;
  v45 = notificationsCopy;
  v48 = notificationsCopy;
  v83 = v48;
  selfCopy = self;
  v43 = allKeys;
  v9 = [allKeys na_map:v82];
  v80 = 0;
  v81 = 0;
  [(HMDHome *)self _notificationPayloadsForRemoteGateway:v9 accessories:&v81 enableCharacteristicNotificationPayload:0 characteristicNotificationThresholdsPayload:&v80 disableCharacteristicNotificationPayload:0 enableMediaNotificationPayload:0 disableMediaNotificationPayload:?];
  v50 = v81;
  v49 = v80;
  v76 = 0u;
  v77 = 0u;
  v78 = 0u;
  v79 = 0u;
  obj = v9;
  v51 = [obj countByEnumeratingWithState:&v76 objects:v93 count:16];
  if (!v51)
  {
    goto LABEL_41;
  }

  v47 = *v77;
  v65 = *MEMORY[0x277CD21C0];
  selfCopy2 = self;
  do
  {
    v10 = 0;
    do
    {
      if (*v77 != v47)
      {
        objc_enumerationMutation(obj);
      }

      v52 = v10;
      v11 = *(*(&v76 + 1) + 8 * v10);
      uuid = [v11 uuid];
      uUIDString = [uuid UUIDString];

      v55 = [v48 hmf_dictionaryForKey:uUIDString];
      [v50 hmf_arrayForKey:uUIDString];
      v63 = v62 = uUIDString;
      v60 = [v49 hmf_arrayForKey:uUIDString];
      v72 = 0u;
      v73 = 0u;
      v74 = 0u;
      v75 = 0u;
      services = [v11 services];
      v56 = [services countByEnumeratingWithState:&v72 objects:v92 count:16];
      if (v56)
      {
        v54 = *v73;
        do
        {
          for (i = 0; i != v56; ++i)
          {
            if (*v73 != v54)
            {
              objc_enumerationMutation(services);
            }

            v15 = *(*(&v72 + 1) + 8 * i);
            instanceID = [v15 instanceID];
            stringValue = [instanceID stringValue];
            v18 = [v55 hmf_dictionaryForKey:stringValue];

            if (v18)
            {
              v57 = i;
              v70 = 0u;
              v71 = 0u;
              v68 = 0u;
              v69 = 0u;
              characteristics = [v15 characteristics];
              v67 = [characteristics countByEnumeratingWithState:&v68 objects:v91 count:16];
              if (!v67)
              {
                goto LABEL_36;
              }

              v66 = *v69;
              while (1)
              {
                for (j = 0; j != v67; ++j)
                {
                  if (*v69 != v66)
                  {
                    objc_enumerationMutation(characteristics);
                  }

                  v20 = *(*(&v68 + 1) + 8 * j);
                  instanceID2 = [v20 instanceID];
                  stringValue2 = [instanceID2 stringValue];
                  v23 = [v18 objectForKey:stringValue2];

                  if (v23)
                  {
                    stringValueSafe = [instanceID2 stringValueSafe];
                    v25 = [v18 hmf_dictionaryForKey:stringValueSafe];

                    v26 = [v25 hmf_numberForKey:v65];
                    v27 = v26;
                    if (v26 && ([v26 unsignedIntegerValue] & 1) != 0)
                    {
                      v28 = objc_autoreleasePoolPush();
                      selfCopy4 = self;
                      v30 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
                      {
                        v31 = HMFGetLogIdentifier();
                        shortDescription = [v20 shortDescription];
                        *buf = 138543874;
                        v86 = v31;
                        v87 = 2112;
                        v88 = shortDescription;
                        v89 = 2112;
                        v90 = v62;
                        v33 = v30;
                        v34 = OS_LOG_TYPE_INFO;
                        v35 = "%{public}@Received persistent characteristic changed notification for bulletin characteristic (%@), accessoryUUID %@";
LABEL_31:
                        _os_log_impl(&dword_229538000, v33, v34, v35, buf, 0x20u);

                        self = selfCopy2;
                      }

LABEL_32:

                      objc_autoreleasePoolPop(v28);
                    }

                    else
                    {
                      if ([v63 containsObject:instanceID2])
                      {
                        v28 = objc_autoreleasePoolPush();
                        selfCopy4 = self;
                        v30 = HMFGetOSLogHandle();
                        if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
                        {
                          v31 = HMFGetLogIdentifier();
                          shortDescription = [v20 shortDescription];
                          *buf = 138543874;
                          v86 = v31;
                          v87 = 2112;
                          v88 = shortDescription;
                          v89 = 2112;
                          v90 = v62;
                          v33 = v30;
                          v34 = OS_LOG_TYPE_DEBUG;
                          v35 = "%{public}@Received persistent characteristic changed notification for characteristic (%@), accessoryUUID %@";
                          goto LABEL_31;
                        }

                        goto LABEL_32;
                      }

                      if ([v60 containsObject:instanceID2])
                      {
                        v36 = objc_autoreleasePoolPush();
                        selfCopy5 = self;
                        v38 = HMFGetOSLogHandle();
                        if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
                        {
                          v39 = HMFGetLogIdentifier();
                          [v20 shortDescription];
                          v40 = v58 = v36;
                          *buf = 138543874;
                          v86 = v39;
                          v87 = 2112;
                          v88 = v40;
                          v89 = 2112;
                          v90 = v62;
                          _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_ERROR, "%{public}@Received unexpected characteristic changed notification for characteristic (%@), accessoryUUID %@", buf, 0x20u);

                          v36 = v58;
                          self = selfCopy2;
                        }

                        objc_autoreleasePoolPop(v36);
                        [array addObject:v20];
                      }
                    }
                  }
                }

                v67 = [characteristics countByEnumeratingWithState:&v68 objects:v91 count:16];
                if (!v67)
                {
LABEL_36:

                  i = v57;
                  break;
                }
              }
            }
          }

          v56 = [services countByEnumeratingWithState:&v72 objects:v92 count:16];
        }

        while (v56);
      }

      v10 = v52 + 1;
    }

    while (v52 + 1 != v51);
    v51 = [obj countByEnumeratingWithState:&v76 objects:v93 count:16];
  }

  while (v51);
LABEL_41:

  objc_autoreleasePoolPop(context);
  v7 = [array copy];

  notificationsCopy = v45;
LABEL_42:

  v41 = *MEMORY[0x277D85DE8];

  return v7;
}

id __69__HMDHome__unexpectedCharacteristicsFromCharacteristicNotifications___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) objectForKeyedSubscript:v3];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  v6 = 0;
  if ((isKindOfClass & 1) != 0 && v4)
  {
    v7 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v3];
    v8 = [*(a1 + 40) accessoryWithUUID:v7];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v6 = v9;
  }

  return v6;
}

- (void)_notificationPayloadsForRemoteGateway:(void *)gateway accessories:(void *)accessories enableCharacteristicNotificationPayload:(void *)payload characteristicNotificationThresholdsPayload:(void *)thresholdsPayload disableCharacteristicNotificationPayload:(void *)notificationPayload enableMediaNotificationPayload:(void *)mediaNotificationPayload disableMediaNotificationPayload:
{
  v174 = *MEMORY[0x277D85DE8];
  gatewayCopy = gateway;
  if (self)
  {
    array = [MEMORY[0x277CBEB18] array];
    v157 = 0u;
    v158 = 0u;
    v159 = 0u;
    v160 = 0u;
    obj = [self triggers];
    v10 = [obj countByEnumeratingWithState:&v157 objects:v173 count:16];
    v126 = array;
    selfCopy = self;
    if (v10)
    {
      v11 = v10;
      v12 = *v158;
      context = *v158;
      do
      {
        v13 = 0;
        v132 = v11;
        do
        {
          if (*v158 != v12)
          {
            objc_enumerationMutation(obj);
          }

          v14 = *(*(&v157 + 1) + 8 * v13);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v15 = v14;
          }

          else
          {
            v15 = 0;
          }

          v16 = v15;

          if ([v16 shouldActivateOnLocalDevice])
          {
            v136 = v16;
            v138 = v13;
            v155 = 0u;
            v156 = 0u;
            v153 = 0u;
            v154 = 0u;
            characteristicEvents = [v16 characteristicEvents];
            v18 = [characteristicEvents countByEnumeratingWithState:&v153 objects:v172 count:16];
            if (v18)
            {
              v19 = v18;
              v20 = *v154;
              do
              {
                for (i = 0; i != v19; ++i)
                {
                  if (*v154 != v20)
                  {
                    objc_enumerationMutation(characteristicEvents);
                  }

                  v22 = *(*(&v153 + 1) + 8 * i);
                  characteristic = [v22 characteristic];

                  if (characteristic)
                  {
                    characteristic2 = [v22 characteristic];
                    array = v126;
                    [v126 addObject:characteristic2];
                  }

                  else
                  {
                    v25 = objc_autoreleasePoolPush();
                    selfCopy2 = self;
                    v27 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
                    {
                      v28 = HMFGetLogIdentifier();
                      *buf = 138543618;
                      *&buf[4] = v28;
                      *&buf[12] = 2112;
                      *&buf[14] = v22;
                      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Characteristic of HMDCharacteristicEvent %@ is nil!", buf, 0x16u);
                    }

                    objc_autoreleasePoolPop(v25);
                    array = v126;
                    self = selfCopy;
                  }
                }

                v19 = [characteristicEvents countByEnumeratingWithState:&v153 objects:v172 count:16];
              }

              while (v19);
            }

            v12 = context;
            v11 = v132;
            v16 = v136;
            v13 = v138;
          }

          ++v13;
        }

        while (v13 != v11);
        v11 = [obj countByEnumeratingWithState:&v157 objects:v173 count:16];
      }

      while (v11);
    }

    v29 = 0x277CBE000uLL;
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    dictionary2 = [MEMORY[0x277CBEB38] dictionary];
    dictionary3 = [MEMORY[0x277CBEB38] dictionary];
    if (notificationPayload)
    {
      dictionary4 = [MEMORY[0x277CBEB38] dictionary];
    }

    else
    {
      dictionary4 = 0;
    }

    v105 = dictionary4;
    if (mediaNotificationPayload)
    {
      dictionary5 = [MEMORY[0x277CBEB38] dictionary];
    }

    else
    {
      dictionary5 = 0;
    }

    v31 = 0x277CBE000uLL;
    v151 = 0u;
    v152 = 0u;
    v149 = 0u;
    v150 = 0u;
    v117 = gatewayCopy;
    v32 = [v117 countByEnumeratingWithState:&v149 objects:v171 count:16];
    if (v32)
    {
      v33 = v32;
      v34 = *v150;
      v133 = *MEMORY[0x277CFE810];
      v115 = *v150;
      do
      {
        v35 = 0;
        v116 = v33;
        do
        {
          if (*v150 != v34)
          {
            objc_enumerationMutation(v117);
          }

          v36 = *(*(&v149 + 1) + 8 * v35);
          array2 = [*(v31 + 2840) array];
          array3 = [*(v31 + 2840) array];
          obja = [*(v29 + 2872) dictionary];
          v38 = v36;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v39 = v38;
          }

          else
          {
            v39 = 0;
          }

          v40 = v39;

          if (v40)
          {
            v119 = v35;
            v120 = v40;
            v128 = array2;
            if (shouldSkipRemoteAccessoryNotificationRegistration(self))
            {
              v41 = objc_autoreleasePoolPush();
              selfCopy3 = self;
              v43 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
              {
                v44 = HMFGetLogIdentifier();
                *&buf[8] = 0;
                *buf = 0;
                uuid = [v120 uuid];

                if (uuid)
                {
                  uuid2 = [v120 uuid];
                  [uuid2 getUUIDBytes:buf];
                }

                else
                {
                  *buf = *MEMORY[0x277D0F960];
                }

                v170 = *buf;
                *buf = 138543874;
                *&buf[4] = v44;
                *&buf[12] = 1040;
                *&buf[14] = 16;
                *&buf[18] = 2096;
                *&buf[20] = &v170;
                _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@Dropping all characteristics for %{uuid_t}.16P from remote notification as partitioned network is no longer supported by residents", buf, 0x1Cu);

                v31 = 0x277CBE000;
                v29 = 0x277CBE000;
              }

              objc_autoreleasePoolPop(v41);
              v35 = v119;
              array2 = v128;
            }

            else
            {
              v118 = v38;
              v147 = 0u;
              v148 = 0u;
              v145 = 0u;
              v146 = 0u;
              services = [v40 services];
              v47 = obja;
              v123 = [services countByEnumeratingWithState:&v145 objects:v169 count:16];
              if (v123)
              {
                v122 = *v146;
                do
                {
                  v48 = 0;
                  do
                  {
                    if (*v146 != v122)
                    {
                      objc_enumerationMutation(services);
                    }

                    v124 = v48;
                    v49 = *(*(&v145 + 1) + 8 * v48);
                    type = [v49 type];
                    v141 = 0u;
                    v142 = 0u;
                    v143 = 0u;
                    v144 = 0u;
                    characteristics = [v49 characteristics];
                    v51 = [characteristics countByEnumeratingWithState:&v141 objects:v168 count:16];
                    if (v51)
                    {
                      v52 = v51;
                      v137 = characteristics;
                      v139 = *v142;
                      do
                      {
                        v53 = 0;
                        do
                        {
                          if (*v142 != v139)
                          {
                            objc_enumerationMutation(characteristics);
                          }

                          v54 = *(*(&v141 + 1) + 8 * v53);
                          if ([v54 supportsNotification])
                          {
                            dataSource = [self dataSource];
                            hapMetadata = [dataSource hapMetadata];
                            v57 = [hapMetadata shouldFilterEnableNotificationsForCharacteristicType:0 serviceType:type];

                            if ((v57 & 1) == 0)
                            {
                              if ([type isEqualToString:v133])
                              {
                                type2 = [v54 type];
                                v59 = [type2 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"];
                              }

                              else
                              {
                                v59 = 0;
                              }

                              dataSource2 = [self dataSource];
                              hapMetadata2 = [dataSource2 hapMetadata];
                              type3 = [v54 type];
                              v63 = [hapMetadata2 shouldAutoEnableNotificationForCharacteristic:type3 ofService:type];

                              isNonHomeNotificationsEnabled = [v54 isNonHomeNotificationsEnabled];
                              if (([array containsObject:v54] & 1) != 0 || (isNonHomeNotificationsEnabled & 1) != 0 || (v63 & 1) != 0 || v59)
                              {
                                contexta = objc_autoreleasePoolPush();
                                selfCopy4 = self;
                                v71 = HMFGetOSLogHandle();
                                if (os_log_type_enabled(v71, OS_LOG_TYPE_DEBUG))
                                {
                                  v72 = HMFGetLogIdentifier();
                                  v73 = HMFBooleanToString();
                                  v74 = HMFBooleanToString();
                                  v75 = HMFBooleanToString();
                                  v76 = HMFBooleanToString();
                                  *buf = 138544642;
                                  *&buf[4] = v72;
                                  *&buf[12] = 2112;
                                  *&buf[14] = v54;
                                  *&buf[22] = 2112;
                                  *&buf[24] = v73;
                                  v162 = 2112;
                                  v163 = v74;
                                  v164 = 2112;
                                  v165 = v75;
                                  v166 = 2112;
                                  v167 = v76;
                                  _os_log_impl(&dword_229538000, v71, OS_LOG_TYPE_DEBUG, "%{public}@Enabling characteristic %@ because characteristicInEvent: %@ nonHomeNotificationsEnabled: %@ autoEnableNotification: %@ accessoryFlags: %@", buf, 0x3Eu);

                                  array = v126;
                                }

                                objc_autoreleasePoolPop(contexta);
                                changeThresholdForNonHomeClientEnabledNotifications = [v54 changeThresholdForNonHomeClientEnabledNotifications];
                                dataSource3 = [selfCopy4 dataSource];
                                hapMetadata3 = [dataSource3 hapMetadata];
                                type4 = [v54 type];
                                v81 = [hapMetadata3 shouldEnableHomeNotificationForCharacteristicType:type4 serviceType:type];

                                v47 = obja;
                                if (changeThresholdForNonHomeClientEnabledNotifications && (v81 & a2 & 1) == 0)
                                {
                                  instanceID = [v54 instanceID];
                                  stringValue = [instanceID stringValue];
                                  [obja setObject:changeThresholdForNonHomeClientEnabledNotifications forKeyedSubscript:stringValue];
                                }

                                instanceID2 = [v54 instanceID];
                                [v128 addObject:instanceID2];

                                self = selfCopy;
                                characteristics = v137;
                              }

                              else if (a2)
                              {
                                type5 = [v54 type];
                                dataSource4 = [self dataSource];
                                hapMetadata4 = [dataSource4 hapMetadata];
                                v68 = [hapMetadata4 shouldEnableHomeNotificationForCharacteristicType:type5 serviceType:type];

                                characteristics = v137;
                                if (v68)
                                {
                                  instanceID3 = [v54 instanceID];
                                  [v128 addObject:instanceID3];
                                }

                                v47 = obja;
                              }

                              else
                              {
                                v47 = obja;
                                characteristics = v137;
                                if ([v54 isClientNotificationEnabled])
                                {
                                  v85 = objc_autoreleasePoolPush();
                                  selfCopy5 = self;
                                  v87 = HMFGetOSLogHandle();
                                  if (os_log_type_enabled(v87, OS_LOG_TYPE_DEFAULT))
                                  {
                                    v88 = HMFGetLogIdentifier();
                                    notificationRegistrations = [v54 notificationRegistrations];
                                    *buf = 138543874;
                                    *&buf[4] = v88;
                                    *&buf[12] = 2112;
                                    *&buf[14] = v54;
                                    *&buf[22] = 2112;
                                    *&buf[24] = notificationRegistrations;
                                    _os_log_impl(&dword_229538000, v87, OS_LOG_TYPE_DEFAULT, "%{public}@Not disabling characteristic %@ because client(s) are registered: %@", buf, 0x20u);

                                    characteristics = v137;
                                    v47 = obja;
                                  }

                                  objc_autoreleasePoolPop(v85);
                                }

                                else
                                {
                                  instanceID4 = [v54 instanceID];
                                  [array3 addObject:instanceID4];
                                }
                              }
                            }
                          }

                          ++v53;
                        }

                        while (v52 != v53);
                        v91 = [characteristics countByEnumeratingWithState:&v141 objects:v168 count:16];
                        v52 = v91;
                      }

                      while (v91);
                    }

                    v48 = v124 + 1;
                  }

                  while (v124 + 1 != v123);
                  v123 = [services countByEnumeratingWithState:&v145 objects:v169 count:16];
                }

                while (v123);
              }

              uuid3 = [v118 uuid];
              uUIDString = [uuid3 UUIDString];

              array2 = v128;
              if ([v128 count])
              {
                v94 = [v128 copy];
                [dictionary setObject:v94 forKeyedSubscript:uUIDString];
              }

              v95 = [v47 count];
              v31 = 0x277CBE000;
              v96 = v47;
              v29 = 0x277CBE000;
              v34 = v115;
              v33 = v116;
              v35 = v119;
              if (v95)
              {
                v97 = [v96 copy];
                [dictionary2 setObject:v97 forKeyedSubscript:uUIDString];
              }

              if ([array3 count])
              {
                v98 = [array3 copy];
                [dictionary3 setObject:v98 forKeyedSubscript:uUIDString];
              }
            }

            v40 = v120;
          }

          ++v35;
        }

        while (v35 != v33);
        v33 = [v117 countByEnumeratingWithState:&v149 objects:v171 count:16];
      }

      while (v33);
    }

    v99 = [dictionary copy];
    payloadCopy = payload;
    *accessories = v99;
    if (payload)
    {
      *payloadCopy = [dictionary2 copy];
    }

    v101 = [dictionary3 copy];
    notificationPayloadCopy = notificationPayload;
    *thresholdsPayload = v101;
    if (notificationPayload)
    {
      *notificationPayloadCopy = [v105 copy];
    }

    if (mediaNotificationPayload)
    {
      *mediaNotificationPayload = [dictionary5 copy];
    }
  }

  v103 = *MEMORY[0x277D85DE8];
}

- (void)_updateWoWState:(id)state
{
  v21 = *MEMORY[0x277D85DE8];
  stateCopy = state;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v5 = [stateCopy countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(stateCopy);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        identifier = [v9 identifier];
        v11 = [v9 matchingHAPAccessoryWithServerIdentifier:identifier linkType:1];

        if ([v9 isReachable])
        {
          v12 = v11 == 0;
        }

        else
        {
          v12 = 1;
        }

        if (v12 || ![v9 isNonClientNotificationEnabled])
        {
          dataSource = [(HMDHome *)self dataSource];
          netManager = [dataSource netManager];
          [netManager deregisterWoWAssertionForObject:v9];
        }

        else
        {
          dataSource = [(HMDHome *)self dataSource];
          netManager = [dataSource netManager];
          [netManager registerWoWAssertionForObject:v9];
        }
      }

      v6 = [stateCopy countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (HMDUserPresenceFeeder)presenceFeeder
{
  userActivityStateDetectorManager = [(HMDHome *)self userActivityStateDetectorManager];
  presenceFeeder = [userActivityStateDetectorManager presenceFeeder];

  presenceFeeder = presenceFeeder;
  if (!presenceFeeder)
  {
    presenceFeeder = self->_presenceFeeder;
  }

  v6 = presenceFeeder;

  return v6;
}

- (void)_configureUserActivityStateDetectorManager
{
  v34 = *MEMORY[0x277D85DE8];
  featuresDataSource = [(HMDHome *)self featuresDataSource];
  isUserActivityStateDetectionFeatureEnabled = [featuresDataSource isUserActivityStateDetectionFeatureEnabled];

  if (isUserActivityStateDetectionFeatureEnabled)
  {
    if ([HMDUserActivityStateDetectorManager shouldRunManagerForHome:self])
    {
      userActivityStateDetectorManager = [(HMDHome *)self userActivityStateDetectorManager];

      if (userActivityStateDetectorManager)
      {
        v6 = objc_autoreleasePoolPush();
        selfCopy = self;
        v8 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
        {
          v9 = HMFGetLogIdentifier();
          v32 = 138543362;
          v33 = v9;
          _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@HMDUserActivityStateDetectorManager is already configured, updating configuration if needed", &v32, 0xCu);
        }

        objc_autoreleasePoolPop(v6);
        userActivityStateDetectorManager2 = [(HMDHome *)selfCopy userActivityStateDetectorManager];
        [userActivityStateDetectorManager2 updateConfiguration];
      }

      else
      {
        currentUser = [(HMDHome *)self currentUser];

        if (currentUser)
        {
          homeActivityStateManager = [(HMDHome *)self homeActivityStateManager];

          if (homeActivityStateManager)
          {
            homeActivityStateManager2 = [(HMDHome *)self homeActivityStateManager];
            dataSource = [homeActivityStateManager2 dataSource];
          }

          else
          {
            dataSource = [[HMDHomeActivityStateManagerDataSource alloc] initWithHome:self];
          }

          v25 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v27 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
          {
            v28 = HMFGetLogIdentifier();
            v32 = 138543362;
            v33 = v28;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Creating and configuring HMDUserActivityStateDetectorManager", &v32, 0xCu);
          }

          objc_autoreleasePoolPop(v25);
          v29 = [[HMDUserActivityStateDetectorManager alloc] initWithDataSource:dataSource];
          userActivityStateDetectorManager = selfCopy2->_userActivityStateDetectorManager;
          selfCopy2->_userActivityStateDetectorManager = v29;

          userActivityStateDetectorManager3 = [(HMDHome *)selfCopy2 userActivityStateDetectorManager];
          [userActivityStateDetectorManager3 configure];
        }

        else
        {
          v21 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v23 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
          {
            v24 = HMFGetLogIdentifier();
            v32 = 138543362;
            v33 = v24;
            _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Not initializing HMDUserActivityStateDetectorManager because the current user is not set", &v32, 0xCu);
          }

          objc_autoreleasePoolPop(v21);
        }
      }
    }

    else
    {
      v11 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v32 = 138543362;
        v33 = v14;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@HMDUserActivityStateDetectorManager is not expected to run", &v32, 0xCu);
      }

      objc_autoreleasePoolPop(v11);
      userActivityStateDetectorManager4 = [(HMDHome *)selfCopy4 userActivityStateDetectorManager];
      [userActivityStateDetectorManager4 unconfigure];

      [(HMDHome *)selfCopy4 setUserActivityStateDetectorManager:0];
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)configureUserActivityStateDetectorManager
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __52__HMDHome_configureUserActivityStateDetectorManager__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)handleUserActivityStateDetectorManagerChangeNotification:(id)notification
{
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __68__HMDHome_handleUserActivityStateDetectorManagerChangeNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = notificationCopy;
  v6 = notificationCopy;
  dispatch_async(workQueue, v7);
}

uint64_t __68__HMDHome_handleUserActivityStateDetectorManagerChangeNotification___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 40) name];
    v9 = 138543618;
    v10 = v5;
    v11 = 2112;
    v12 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  result = [*(a1 + 32) _configureUserActivityStateDetectorManager];
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_registerForNotifications
{
  notificationCenter = [(HMDHome *)self notificationCenter];
  homeManager = [(HMDHome *)self homeManager];
  connectionsManager = [homeManager connectionsManager];
  [notificationCenter addObserver:self selector:sel_handleFirstProcessDidBecomeActiveNotification_ name:@"HMDHomeManagerFirstProcessDidBecomeActiveNotification" object:connectionsManager];

  connectionsManager2 = [homeManager connectionsManager];
  [notificationCenter addObserver:self selector:sel_handleLastProcessDidBecomeInactiveNotification_ name:@"HMDHomeManagerLastProcessDidBecomeInactiveNotification" object:connectionsManager2];

  [notificationCenter addObserver:self selector:sel_handleClientProcessDisconnectedNotification_ name:@"HMDHomeManagerClientProcessDisconnectedNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleAccessoryDidAddNetworkRouterControllerNotification_ name:@"HMDAccessoryDidAddNetworkRouterControllerNotification" object:self];
  [notificationCenter addObserver:self selector:sel_handleAccessoryDidRemoveNetworkRouterControllerNotification_ name:@"HMDAccessoryDidRemoveNetworkRouterControllerNotification" object:self];
  currentUser = [(HMDHome *)self currentUser];
  [notificationCenter addObserver:self selector:sel_handleCurrentUserPrivilegeChanged_ name:@"HMDUserPrivilegeDidChangeNotification" object:currentUser];

  v7 = +[HMDAppleAccountManager sharedManager];
  [notificationCenter addObserver:self selector:sel_handleActiveAccountChanged_ name:@"HMDAppleAccountManagerAccountUpdatedNotification" object:v7];

  [notificationCenter addObserver:self selector:sel_handleAccountHandlesUpdated_ name:@"HMDAccountHandlesUpdatedNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleCurrentAccountMergeIdentifierUpdated_ name:@"HMDAppleAccountMergeIdentifierUpdatedNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleHAPAccessoryServicesAddedNotification_ name:@"kHMDNotificationServicesUpdated" object:0];
  [notificationCenter addObserver:self selector:sel_handleHAPAccessoryCharacteristicsAddedNotification_ name:@"kHMDNotificationCharacteristicsUpdated" object:0];
  [notificationCenter addObserver:self selector:sel___handleProcessStateChange_ name:HMDProcessMonitorProcessStateDidChangeNotification object:0];
  [notificationCenter addObserver:self selector:sel_handleAccessoryReachabilityChangeNotification_ name:@"HMDAccessoryIsReachableNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleAccessoryReachabilityChangeNotification_ name:@"HMDAccessoryIsNotReachableNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleRemovedMediaSessions_ name:@"HMDMediaSessionsRemovedNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleXPCConnectionInvalidated_ name:@"HMDXPCClientConnectionDidInvalidateNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handlePrimaryResidentChangeNotification_ name:@"HMDResidentDeviceConfirmedStateChangedNotification" object:0];
  if (isiOSDevice())
  {
    [notificationCenter addObserver:self selector:sel_handleDidReceiveIDSMessageWithNoListener_ name:@"HMDDidReceiveRemoteMessageWithNoListenerNotification" object:0];
  }

  [notificationCenter addObserver:self selector:sel_handleSiriEndPointAddedNotification_ name:@"HMDSiriEndpointProfileAddedNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleFindResidentsNotification_ name:@"HMDPrimaryResidentDiscoveryFindResidentsNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleHomeDataLoaded_ name:@"HMDHomeManagerHomeDataLoadedNotification" object:0];
  mobileAssetManager = [homeManager mobileAssetManager];
  [notificationCenter addObserver:self selector:sel_handleMobileAssetsUpdatedNotification_ name:@"HMDMobileAssetManagerFoundUpdateNotification" object:mobileAssetManager];

  defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
  [defaultCenter addObserver:self selector:sel_checkForCATIDUpdate_ name:@"HMDFMFStatusUpdateNotification" object:0];

  featuresDataSource = [(HMDHome *)self featuresDataSource];
  LODWORD(mobileAssetManager) = [featuresDataSource isUserActivityStateDetectionFeatureEnabled];

  if (mobileAssetManager)
  {
    defaultCenter2 = [MEMORY[0x277CCAB98] defaultCenter];
    [defaultCenter2 addObserver:self selector:sel_handleUserActivityStateDetectorManagerChangeNotification_ name:@"HMDFMFStatusUpdateNotification" object:0];
  }

  featuresDataSource2 = [(HMDHome *)self featuresDataSource];
  isUserActivityStateDetectionFeatureEnabled = [featuresDataSource2 isUserActivityStateDetectionFeatureEnabled];

  if (isUserActivityStateDetectionFeatureEnabled)
  {
    defaultCenter3 = [MEMORY[0x277CCAB98] defaultCenter];
    [defaultCenter3 addObserver:self selector:sel_handleUserActivityStateDetectorManagerChangeNotification_ name:@"HMDAccessorySupportsAdaptiveTemperatureAutomationsDidChangeNotification" object:self];
  }

  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  isResidentCapable = [localCapabilitiesDataSource isResidentCapable];

  if (isResidentCapable)
  {
    notificationCenter2 = [(HMDHome *)self notificationCenter];
    primaryResidentChangeMonitor = [(HMDHome *)self primaryResidentChangeMonitor];
    [notificationCenter2 addObserver:self selector:sel_handlePrimaryResidentIsCurrentDeviceChangeNotification_ name:@"HMDPrimaryResidentChangeMonitorIsCurrentDeviceChangeNotification" object:primaryResidentChangeMonitor];

    notificationCenter3 = [(HMDHome *)self notificationCenter];
    primaryResidentChangeMonitor2 = [(HMDHome *)self primaryResidentChangeMonitor];
    [notificationCenter3 addObserver:self selector:sel_handlePrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification_ name:@"HMDPrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification" object:primaryResidentChangeMonitor2];
  }

  defaultCenter4 = [MEMORY[0x277CCAB98] defaultCenter];
  [defaultCenter4 addObserver:self selector:sel_handleUserFabricKeyUpdate_ name:*MEMORY[0x277D17AB0] object:0];
}

- (void)_registerForMessages
{
  v624[2] = *MEMORY[0x277D85DE8];
  v506 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:3 remoteAccessRequired:0];
  v507 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:0 remoteAccessRequired:0];
  v508 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:0 remoteAccessRequired:1];
  v505 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:5 remoteAccessRequired:0];
  v501 = [HMDUserMessagePolicy userMessagePolicyUsingProofOfLocalityForHome:self userPrivilege:5];
  administratorHandler = [(HMDHome *)self administratorHandler];
  v4 = *MEMORY[0x277CD2540];
  v5 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v624[0] = v5;
  v6 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v624[1] = v6;
  v7 = [MEMORY[0x277CBEA60] arrayWithObjects:v624 count:2];
  [administratorHandler registerForMessage:v4 receiver:self policies:v7 selector:sel__handleRename_];

  msgDispatcher = [(HMDHome *)self msgDispatcher];
  v9 = *MEMORY[0x277CD1208];
  v10 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v623 = v10;
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:&v623 count:1];
  [msgDispatcher registerForMessage:v9 receiver:self policies:v11 selector:sel__handleHomeDataRequest_];

  administratorHandler2 = [(HMDHome *)self administratorHandler];
  v13 = *MEMORY[0x277CCF1F8];
  v14 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v622[0] = v14;
  v15 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v622[1] = v15;
  v16 = [MEMORY[0x277CBEA60] arrayWithObjects:v622 count:2];
  [administratorHandler2 registerForMessage:v13 receiver:self policies:v16 selector:sel__handleAddRoom_];

  administratorHandler3 = [(HMDHome *)self administratorHandler];
  v18 = *MEMORY[0x277CD0CA0];
  v19 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v621[0] = v19;
  v20 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v621[1] = v20;
  v21 = [MEMORY[0x277CBEA60] arrayWithObjects:v621 count:2];
  [administratorHandler3 registerForMessage:v18 receiver:self policies:v21 selector:sel__handleRemoveRoom_];

  administratorHandler4 = [(HMDHome *)self administratorHandler];
  v23 = *MEMORY[0x277CD20B0];
  v24 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v620[0] = v24;
  v25 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v620[1] = v25;
  v26 = [MEMORY[0x277CBEA60] arrayWithObjects:v620 count:2];
  [administratorHandler4 registerForMessage:v23 receiver:self policies:v26 selector:sel__handleAddZone_];

  administratorHandler5 = [(HMDHome *)self administratorHandler];
  v28 = *MEMORY[0x277CD2530];
  v29 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v619[0] = v29;
  v30 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v619[1] = v30;
  v31 = [MEMORY[0x277CBEA60] arrayWithObjects:v619 count:2];
  [administratorHandler5 registerForMessage:v28 receiver:self policies:v31 selector:sel__handleRemoveZone_];

  administratorHandler6 = [(HMDHome *)self administratorHandler];
  v33 = *MEMORY[0x277CD20A0];
  v34 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v618[0] = v34;
  v35 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v618[1] = v35;
  v36 = [MEMORY[0x277CBEA60] arrayWithObjects:v618 count:2];
  [administratorHandler6 registerForMessage:v33 receiver:self policies:v36 selector:sel__handleAddServiceGroup_];

  administratorHandler7 = [(HMDHome *)self administratorHandler];
  v38 = *MEMORY[0x277CD2520];
  v39 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v617[0] = v39;
  v40 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v617[1] = v40;
  v41 = [MEMORY[0x277CBEA60] arrayWithObjects:v617 count:2];
  [administratorHandler7 registerForMessage:v38 receiver:self policies:v41 selector:sel__handleRemoveServiceGroup_];

  administratorHandler8 = [(HMDHome *)self administratorHandler];
  v43 = *MEMORY[0x277CD2078];
  v44 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v616[0] = v44;
  v45 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v616[1] = v45;
  v46 = [MEMORY[0x277CBEA60] arrayWithObjects:v616 count:2];
  [administratorHandler8 registerForMessage:v43 receiver:self policies:v46 selector:sel__handleAddActionSet_];

  administratorHandler9 = [(HMDHome *)self administratorHandler];
  v48 = *MEMORY[0x277CCF1E8];
  v49 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v615[0] = v49;
  v50 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v615[1] = v50;
  v51 = [MEMORY[0x277CBEA60] arrayWithObjects:v615 count:2];
  [administratorHandler9 registerForMessage:v48 receiver:self policies:v51 selector:sel__handleAddActionSet_];

  msgDispatcher2 = [(HMDHome *)self msgDispatcher];
  v53 = *MEMORY[0x277CCFD60];
  v54 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v614 = v54;
  v55 = [MEMORY[0x277CBEA60] arrayWithObjects:&v614 count:1];
  [msgDispatcher2 registerForMessage:v53 receiver:self policies:v55 selector:sel_handleFetchPresenceMapMessage_];

  administratorHandler10 = [(HMDHome *)self administratorHandler];
  v57 = *MEMORY[0x277CD24F8];
  v58 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v613[0] = v58;
  v59 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v613[1] = v59;
  v60 = [MEMORY[0x277CBEA60] arrayWithObjects:v613 count:2];
  [administratorHandler10 registerForMessage:v57 receiver:self policies:v60 selector:sel__handleRemoveActionSet_];

  administratorHandler11 = [(HMDHome *)self administratorHandler];
  v62 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v612[0] = v62;
  v63 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v612[1] = v63;
  v64 = [MEMORY[0x277CBEA60] arrayWithObjects:v612 count:2];
  [administratorHandler11 registerForMessage:@"kRemoveTriggerRequestKey" receiver:self policies:v64 selector:sel__handleRemoveTrigger_];

  administratorHandler12 = [(HMDHome *)self administratorHandler];
  v66 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v611[0] = v66;
  v67 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v611[1] = v67;
  v68 = [MEMORY[0x277CBEA60] arrayWithObjects:v611 count:2];
  [administratorHandler12 registerForMessage:@"kUpdateUserAccessRequestKey" receiver:self policies:v68 selector:sel__handleUpdateUserAccess_];

  administratorHandler13 = [(HMDHome *)self administratorHandler];
  v70 = *MEMORY[0x277CD2788];
  v71 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v610[0] = v71;
  v72 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v610[1] = v72;
  v610[2] = v506;
  v73 = [MEMORY[0x277CBEA60] arrayWithObjects:v610 count:3];
  [administratorHandler13 registerForMessage:v70 receiver:self policies:v73 selector:sel__handleUpdateUserCamerasAccessLevel_];

  administratorHandler14 = [(HMDHome *)self administratorHandler];
  v75 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v609[0] = v75;
  v76 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v609[1] = v76;
  v77 = [MEMORY[0x277CBEA60] arrayWithObjects:v609 count:2];
  [administratorHandler14 registerForMessage:@"kRemoveUserRequestKey" receiver:self policies:v77 selector:sel__handleRemoveUser_];

  administratorHandler15 = [(HMDHome *)self administratorHandler];
  v79 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v608[0] = v79;
  v80 = [HMDConfigurationMessagePolicy policyWithOperationTypes:7];
  v608[1] = v80;
  v81 = [MEMORY[0x277CBEA60] arrayWithObjects:v608 count:2];
  [administratorHandler15 registerForMessage:@"kSetAppDataRequestKey" receiver:self policies:v81 selector:sel__handleSetAppData_];

  administratorHandler16 = [(HMDHome *)self administratorHandler];
  v83 = *MEMORY[0x277CD0678];
  v84 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v607[0] = v84;
  v85 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v607[1] = v85;
  v86 = [MEMORY[0x277CBEA60] arrayWithObjects:v607 count:2];
  [administratorHandler16 registerForMessage:v83 receiver:self policies:v86 selector:sel__handleUpdateMinimumMediaUserPrivilege_];

  administratorHandler17 = [(HMDHome *)self administratorHandler];
  v88 = *MEMORY[0x277CD0670];
  v89 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v606[0] = v89;
  v90 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v606[1] = v90;
  v91 = [MEMORY[0x277CBEA60] arrayWithObjects:v606 count:2];
  [administratorHandler17 registerForMessage:v88 receiver:self policies:v91 selector:sel__handleUpdateMediaPeerToPeerEnabled_];

  administratorHandler18 = [(HMDHome *)self administratorHandler];
  v93 = *MEMORY[0x277CD0668];
  v94 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v605[0] = v94;
  v95 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v605[1] = v95;
  v96 = [MEMORY[0x277CBEA60] arrayWithObjects:v605 count:2];
  [administratorHandler18 registerForMessage:v93 receiver:self policies:v96 selector:sel__handleUpdateMediaPassword_];

  administratorHandler19 = [(HMDHome *)self administratorHandler];
  v98 = *MEMORY[0x277CD0580];
  v99 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v604[0] = v99;
  v100 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v604[1] = v100;
  v101 = [MEMORY[0x277CBEA60] arrayWithObjects:v604 count:2];
  [administratorHandler19 registerForMessage:v98 receiver:self policies:v101 selector:sel__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest_];

  administratorHandler20 = [(HMDHome *)self administratorHandler];
  v103 = *MEMORY[0x277CD0588];
  v104 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v603[0] = v104;
  v105 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v603[1] = v105;
  v106 = [MEMORY[0x277CBEA60] arrayWithObjects:v603 count:2];
  [administratorHandler20 registerForMessage:v103 receiver:self policies:v106 selector:sel__handleSetHasOnboardedForAccessCodeMessage_];

  administratorHandler21 = [(HMDHome *)self administratorHandler];
  v108 = *MEMORY[0x277CD0590];
  v109 = [HMDXPCMessagePolicy policyWithEntitlements:131077];
  v602[0] = v109;
  v110 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v602[1] = v110;
  v111 = [MEMORY[0x277CBEA60] arrayWithObjects:v602 count:2];
  [administratorHandler21 registerForMessage:v108 receiver:self policies:v111 selector:sel__handleSetHasOnboardedForWalletKeyMessage_];

  administratorHandler22 = [(HMDHome *)self administratorHandler];
  v113 = *MEMORY[0x277CD0680];
  v114 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v601[0] = v114;
  v115 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v601[1] = v115;
  v116 = [MEMORY[0x277CBEA60] arrayWithObjects:v601 count:2];
  [administratorHandler22 registerForMessage:v113 receiver:self policies:v116 selector:sel__handleUpdateNetworkProtection_];

  administratorHandler23 = [(HMDHome *)self administratorHandler];
  v118 = *MEMORY[0x277CD0690];
  v119 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v600[0] = v119;
  v120 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v600[1] = v120;
  v121 = [MEMORY[0x277CBEA60] arrayWithObjects:v600 count:2];
  [administratorHandler23 registerForMessage:v118 receiver:self policies:v121 selector:sel__handleUpdateUserAnnounceAccess_];

  administratorHandler24 = [(HMDHome *)self administratorHandler];
  v123 = *MEMORY[0x277CCFE68];
  v124 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v599[0] = v124;
  v125 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v599[1] = v125;
  v126 = [MEMORY[0x277CBEA60] arrayWithObjects:v599 count:2];
  [administratorHandler24 registerForMessage:v123 receiver:self policies:v126 selector:sel__handleUpdateAudioAnalysisAccess_];

  administratorHandler25 = [(HMDHome *)self administratorHandler];
  v128 = *MEMORY[0x277CD0558];
  v129 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v598[0] = v129;
  v130 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v598[1] = v130;
  v131 = [MEMORY[0x277CBEA60] arrayWithObjects:v598 count:2];
  [administratorHandler25 registerForMessage:v128 receiver:self policies:v131 selector:sel__handleResolveThreadNetworkRequest_];

  isOwnerUser = [(HMDHome *)self isOwnerUser];
  v133 = MEMORY[0x277CD0F98];
  if (isOwnerUser)
  {
    administratorHandler26 = [(HMDHome *)self administratorHandler];
    v135 = *v133;
    v136 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v597[0] = v136;
    v137 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v597[1] = v137;
    v597[2] = v506;
    v138 = [MEMORY[0x277CBEA60] arrayWithObjects:v597 count:3];
    [administratorHandler26 registerForMessage:v135 receiver:self policies:v138 selector:sel__handleOwnerSettingsUpdate_];
  }

  else
  {
    administratorHandler26 = [(HMDHome *)self msgDispatcher];
    v139 = *v133;
    v136 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v596[0] = v136;
    v137 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v596[1] = v137;
    v596[2] = v505;
    v138 = [MEMORY[0x277CBEA60] arrayWithObjects:v596 count:3];
    [administratorHandler26 registerForMessage:v139 receiver:self policies:v138 selector:sel__handleSharedUserSettingsUpdate_];
  }

  administratorHandler27 = [(HMDHome *)self administratorHandler];
  v141 = *MEMORY[0x277CCFE58];
  v142 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v595[0] = v142;
  v143 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v595[1] = v143;
  v144 = [MEMORY[0x277CBEA60] arrayWithObjects:v595 count:2];
  [administratorHandler27 registerForMessage:v141 receiver:self policies:v144 selector:sel__handleAudioAnalysisClassifierOptionsUpdateRequest_];

  administratorHandler28 = [(HMDHome *)self administratorHandler];
  v146 = *MEMORY[0x277CCFE78];
  v147 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v594[0] = v147;
  v148 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v594[1] = v148;
  v149 = [MEMORY[0x277CBEA60] arrayWithObjects:v594 count:2];
  [administratorHandler28 registerForMessage:v146 receiver:self policies:v149 selector:sel__handleAudioAnalysisOnboardingUpdateRequest_];

  administratorHandler29 = [(HMDHome *)self administratorHandler];
  v151 = *MEMORY[0x277CD05E8];
  v152 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v593[0] = v152;
  v153 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v593[1] = v153;
  v154 = [MEMORY[0x277CBEA60] arrayWithObjects:v593 count:2];
  [administratorHandler29 registerForMessage:v151 receiver:self policies:v154 selector:sel__handleSiriPhraseOptionsUpdateRequest_];

  administratorHandler30 = [(HMDHome *)self administratorHandler];
  v156 = *MEMORY[0x277CD05D0];
  v157 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v592[0] = v157;
  v158 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v592[1] = v158;
  v159 = [MEMORY[0x277CBEA60] arrayWithObjects:v592 count:2];
  [administratorHandler30 registerForMessage:v156 receiver:self policies:v159 selector:sel__handleSoundCheckUpdateRequest_];

  administratorHandler31 = [(HMDHome *)self administratorHandler];
  v161 = *MEMORY[0x277CD0660];
  v162 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v591[0] = v162;
  v163 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v591[1] = v163;
  v164 = [MEMORY[0x277CBEA60] arrayWithObjects:v591 count:2];
  [administratorHandler31 registerForMessage:v161 receiver:self policies:v164 selector:sel__handleHomeUpdateLocationServicesEnabledRequest_];

  if (isInternalBuild())
  {
    administratorHandler32 = [(HMDHome *)self administratorHandler];
    v166 = *MEMORY[0x277CD0658];
    v167 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v590[0] = v167;
    v168 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v590[1] = v168;
    v169 = [MEMORY[0x277CBEA60] arrayWithObjects:v590 count:2];
    [administratorHandler32 registerForMessage:v166 receiver:self policies:v169 selector:sel__handleHomeUpdateDidOnboardLocationServicesRequest_];
  }

  if (!isWatch())
  {
    administratorHandler33 = [(HMDHome *)self administratorHandler];
    v171 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v589[0] = v171;
    v172 = [HMDConfigurationMessagePolicy policyWithOperationTypes:6];
    v589[1] = v172;
    v173 = [MEMORY[0x277CBEA60] arrayWithObjects:v589 count:2];
    [administratorHandler33 registerForMessage:@"kUpdateInvitationStateRequestKey" receiver:self policies:v173 selector:sel__handleUpdateOutgoingInvitationState_];
  }

  v174 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v174 setRoles:{objc_msgSend(v174, "roles") | 4}];
  v497 = v174;
  v502 = [v174 copy];
  v175 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:4 remoteAccessRequired:0];
  administratorHandler34 = [(HMDHome *)self administratorHandler];
  v177 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v588[0] = v177;
  v588[1] = v175;
  v499 = v175;
  v178 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v588[2] = v178;
  v179 = [MEMORY[0x277CBEA60] arrayWithObjects:v588 count:3];
  [administratorHandler34 registerForMessage:@"kAddEventTriggerRequestKey" receiver:self policies:v179 selector:sel__handleAddEventTrigger_];

  v180 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v587[0] = v180;
  v587[1] = v175;
  v181 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v587[2] = v181;
  v182 = [MEMORY[0x277CBEA60] arrayWithObjects:v587 count:3];
  v496 = administratorHandler34;
  [administratorHandler34 registerForMessage:@"kAddTimerTriggerRequestKey" receiver:self policies:v182 selector:sel__handleAddTimerTrigger_];

  administratorHandler35 = [(HMDHome *)self administratorHandler];
  v184 = *MEMORY[0x277CCF1F0];
  v185 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v586[0] = v185;
  v186 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v586[1] = v186;
  v187 = [MEMORY[0x277CBEA60] arrayWithObjects:v586 count:2];
  [administratorHandler35 registerForMessage:v184 receiver:self policies:v187 selector:sel__handleAddEventTrigger_];

  administratorHandler36 = [(HMDHome *)self administratorHandler];
  v189 = *MEMORY[0x277CCF200];
  v190 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v585[0] = v190;
  v191 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v585[1] = v191;
  v192 = [MEMORY[0x277CBEA60] arrayWithObjects:v585 count:2];
  [administratorHandler36 registerForMessage:v189 receiver:self policies:v192 selector:sel__handleAddTimerTrigger_];

  productInfo = [MEMORY[0x277D0F8E8] productInfo];
  productPlatform = [productInfo productPlatform];

  if (productPlatform == 1)
  {
    v195 = 5;
  }

  else
  {
    v195 = 1;
  }

  msgDispatcher3 = [(HMDHome *)self msgDispatcher];
  v197 = *MEMORY[0x277CD2070];
  v198 = [HMDXPCMessagePolicy policyWithEntitlements:v195];
  v584[0] = v198;
  v199 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v584[1] = v199;
  v200 = [MEMORY[0x277CBEA60] arrayWithObjects:v584 count:2];
  [msgDispatcher3 registerForMessage:v197 receiver:self policies:v200 selector:sel__handleAddAccessory_];

  msgDispatcher4 = [(HMDHome *)self msgDispatcher];
  v583[0] = v502;
  v583[1] = v499;
  v202 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v583[2] = v202;
  v203 = [MEMORY[0x277CBEA60] arrayWithObjects:v583 count:3];
  [msgDispatcher4 registerForMessage:@"HMDRemoteAddHAPAccessoriesMessage" receiver:self policies:v203 selector:sel__handleRemoteAddHAPAccessories_];

  msgDispatcher5 = [(HMDHome *)self msgDispatcher];
  v582[0] = v502;
  v582[1] = v499;
  v205 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v582[2] = v205;
  v206 = [MEMORY[0x277CBEA60] arrayWithObjects:v582 count:3];
  [msgDispatcher5 registerForMessage:@"HMDRemoteAddMediaAccessoryMessage" receiver:self policies:v206 selector:sel__handleRemoteAddMediaAccessory_];

  msgDispatcher6 = [(HMDHome *)self msgDispatcher];
  v581[0] = v502;
  v581[1] = v499;
  v208 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v581[2] = v208;
  v209 = [MEMORY[0x277CBEA60] arrayWithObjects:v581 count:3];
  [msgDispatcher6 registerForMessage:@"HMDRemoteAddMediaAccessoryRequestMessage" receiver:self policies:v209 selector:sel__handleRemoteAddMediaAccessoryRequest_];

  administratorHandler37 = [(HMDHome *)self administratorHandler];
  v211 = *MEMORY[0x277CD12A8];
  v212 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v580[0] = v212;
  v580[1] = v502;
  v580[2] = v499;
  v213 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v580[3] = v213;
  v214 = [MEMORY[0x277CBEA60] arrayWithObjects:v580 count:4];
  [administratorHandler37 registerForMessage:v211 receiver:self policies:v214 selector:sel__handleUpdateRestrictedGuestSettings_];

  msgDispatcher7 = [(HMDHome *)self msgDispatcher];
  v216 = *MEMORY[0x277CD0578];
  v217 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v579 = v217;
  v218 = [MEMORY[0x277CBEA60] arrayWithObjects:&v579 count:1];
  [msgDispatcher7 registerForMessage:v216 receiver:self policies:v218 selector:sel__handleSetDismissedUWBOnboarding_];

  msgDispatcher8 = [(HMDHome *)self msgDispatcher];
  v220 = *MEMORY[0x277CD06A8];
  v221 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v578[0] = v221;
  v578[1] = v499;
  v222 = [MEMORY[0x277CBEA60] arrayWithObjects:v578 count:2];
  [msgDispatcher8 registerForMessage:v220 receiver:self policies:v222 selector:sel__handleUserConsentResponseForAccessory_];

  msgDispatcher9 = [(HMDHome *)self msgDispatcher];
  v224 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v577[0] = v224;
  v577[1] = v499;
  v225 = [MEMORY[0x277CBEA60] arrayWithObjects:v577 count:2];
  [msgDispatcher9 registerForMessage:@"kContinuePairingAccessoryRequestKey" receiver:self policies:v225 selector:sel__handleContinuePairingAccessory_];

  msgDispatcher10 = [(HMDHome *)self msgDispatcher];
  v227 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v576[0] = v227;
  v576[1] = v499;
  v228 = [MEMORY[0x277CBEA60] arrayWithObjects:v576 count:2];
  [msgDispatcher10 registerForMessage:@"kCancelPairingAccessoryRequestKey" receiver:self policies:v228 selector:sel__handleCancelPairingAccessory_];

  msgDispatcher11 = [(HMDHome *)self msgDispatcher];
  v230 = *MEMORY[0x277CD24F0];
  v231 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v575[0] = v231;
  v575[1] = v502;
  v575[2] = v499;
  v232 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v575[3] = v232;
  v233 = [MEMORY[0x277CBEA60] arrayWithObjects:v575 count:4];
  [msgDispatcher11 registerForMessage:v230 receiver:self policies:v233 selector:sel__handleRemoveAccessoryMessage_];

  administratorHandler38 = [(HMDHome *)self administratorHandler];
  v235 = *MEMORY[0x277CD0518];
  v236 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v574[0] = v236;
  v574[1] = v502;
  v574[2] = v499;
  v237 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v574[3] = v237;
  v238 = [MEMORY[0x277CBEA60] arrayWithObjects:v574 count:4];
  [administratorHandler38 registerForMessage:v235 receiver:self policies:v238 selector:sel_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage_];

  administratorHandler39 = [(HMDHome *)self administratorHandler];
  v240 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v573[0] = v240;
  v573[1] = v502;
  v573[2] = v499;
  v241 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v573[3] = v241;
  v242 = [MEMORY[0x277CBEA60] arrayWithObjects:v573 count:4];
  [administratorHandler39 registerForMessage:@"HMDHomeRemoteUpdateCHIPKeyValueStoreMessage" receiver:self policies:v242 selector:sel_handleRemoteUpdateCHIPKeyValueStoreMessage_];

  msgDispatcher12 = [(HMDHome *)self msgDispatcher];
  v572[0] = v502;
  v572[1] = v508;
  v244 = [MEMORY[0x277CBEA60] arrayWithObjects:v572 count:2];
  [msgDispatcher12 registerForMessage:@"HMDHomeRequestCommissioningCertificatesMessage" receiver:self policies:v244 selector:sel_handleCommissioningCertificateRequest_];

  msgDispatcher13 = [(HMDHome *)self msgDispatcher];
  v246 = +[HMDRemoteMessagePolicy defaultSecurePrimaryResidentPolicy];
  v571[0] = v246;
  v571[1] = v499;
  v247 = [MEMORY[0x277CBEA60] arrayWithObjects:v571 count:2];
  [msgDispatcher13 registerForMessage:@"HMDHomeNotificationPairingCompletionMessage" receiver:self policies:v247 selector:sel_handleMatterPairingCompletionNotification_];

  msgDispatcher14 = [(HMDHome *)self msgDispatcher];
  v249 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v570[0] = v249;
  v570[1] = v499;
  v250 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v570[2] = v250;
  v251 = [MEMORY[0x277CBEA60] arrayWithObjects:v570 count:3];
  [msgDispatcher14 registerForMessage:@"kInviteUsersRequestKey" receiver:self policies:v251 selector:sel__handleUserInvitations_];

  administratorHandler40 = [(HMDHome *)self administratorHandler];
  v253 = *MEMORY[0x277CCFEE8];
  v254 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v569[0] = v254;
  v255 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v569[1] = v255;
  v569[2] = v508;
  v569[3] = v502;
  v256 = [MEMORY[0x277CBEA60] arrayWithObjects:v569 count:4];
  [administratorHandler40 registerForMessage:v253 receiver:self policies:v256 selector:sel__handleEnableMultiUserRequest_];

  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  LODWORD(v254) = [localCapabilitiesDataSource isResidentCapable];

  if (v254)
  {
    msgDispatcher15 = [(HMDHome *)self msgDispatcher];
    v568[0] = v502;
    v568[1] = v499;
    v259 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
    v568[2] = v259;
    v260 = [MEMORY[0x277CBEA60] arrayWithObjects:v568 count:3];
    [msgDispatcher15 registerForMessage:@"kAddHomeInvitesInternalRequestKey" receiver:self policies:v260 selector:sel__handleOutgoingInvitations_];

    msgDispatcher16 = [(HMDHome *)self msgDispatcher];
    v567[0] = v502;
    v567[1] = v499;
    v262 = [MEMORY[0x277CBEA60] arrayWithObjects:v567 count:2];
    [msgDispatcher16 registerForMessage:@"HMDHomeCreateUniquePSKClientConfigurationRequestKey" receiver:self policies:v262 selector:sel__handleCreateUniquePSKClientConfiguration_];

    msgDispatcher17 = [(HMDHome *)self msgDispatcher];
    v566[0] = v502;
    v566[1] = v499;
    v264 = [MEMORY[0x277CBEA60] arrayWithObjects:v566 count:2];
    [msgDispatcher17 registerForMessage:@"HMDHomeRemoveClientConfigurationRequestKey" receiver:self policies:v264 selector:sel__handleRemoveClientConfiguration_];
  }

  isWatch();
  msgDispatcher18 = [(HMDHome *)self msgDispatcher];
  v266 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v565[0] = v266;
  v565[1] = v499;
  v267 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v565[2] = v267;
  v268 = [MEMORY[0x277CBEA60] arrayWithObjects:v565 count:3];
  [msgDispatcher18 registerForMessage:@"kHomeLocationUpdatedNotificationKey" receiver:self policies:v268 selector:sel__handleHomeLocationUpdateFromSharedAdmin_];

  if (isInternalBuild())
  {
    msgDispatcher19 = [(HMDHome *)self msgDispatcher];
    v270 = *MEMORY[0x277CD0008];
    v271 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v564[0] = v271;
    v272 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v564[1] = v272;
    v273 = [MEMORY[0x277CBEA60] arrayWithObjects:v564 count:2];
    [msgDispatcher19 registerForMessage:v270 receiver:self policies:v273 selector:sel__handleSetMinimumNetworkRouterHomeKitVersion_];

    msgDispatcher20 = [(HMDHome *)self msgDispatcher];
    v275 = *MEMORY[0x277CD0000];
    v276 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v563[0] = v276;
    v277 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v563[1] = v277;
    v278 = [MEMORY[0x277CBEA60] arrayWithObjects:v563 count:2];
    [msgDispatcher20 registerForMessage:v275 receiver:self policies:v278 selector:sel__handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange_];
  }

  if (isInternalBuild() && isiOSDevice())
  {
    msgDispatcher21 = [(HMDHome *)self msgDispatcher];
    v280 = *MEMORY[0x277CD0568];
    v281 = [HMDXPCMessagePolicy policyWithEntitlements:1049605];
    v562[0] = v281;
    v282 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v562[1] = v282;
    v283 = [MEMORY[0x277CBEA60] arrayWithObjects:v562 count:2];
    [msgDispatcher21 registerForMessage:v280 receiver:self policies:v283 selector:sel__handleRetrieveHomeLocationForFeedback_];
  }

  administratorHandler41 = [(HMDHome *)self administratorHandler];
  v285 = *MEMORY[0x277CCFF18];
  v286 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v561[0] = v286;
  v287 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v561[1] = v287;
  v561[2] = v499;
  v288 = [MEMORY[0x277CBEA60] arrayWithObjects:v561 count:3];
  [administratorHandler41 registerForMessage:v285 receiver:self policies:v288 selector:sel__handleEventLogSetDidOnboard_];

  administratorHandler42 = [(HMDHome *)self administratorHandler];
  v290 = *MEMORY[0x277CCFF28];
  v291 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v560[0] = v291;
  v292 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v560[1] = v292;
  v560[2] = v499;
  v293 = [MEMORY[0x277CBEA60] arrayWithObjects:v560 count:3];
  [administratorHandler42 registerForMessage:v290 receiver:self policies:v293 selector:sel__handleEventLogSetEnabledMessage_];

  administratorHandler43 = [(HMDHome *)self administratorHandler];
  v295 = *MEMORY[0x277CCFF20];
  v296 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v559[0] = v296;
  v297 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v559[1] = v297;
  v559[2] = v499;
  v298 = [MEMORY[0x277CBEA60] arrayWithObjects:v559 count:3];
  [administratorHandler43 registerForMessage:v295 receiver:self policies:v298 selector:sel__handleEventLogSetDurationMessage_];

  administratorHandler44 = [(HMDHome *)self administratorHandler];
  v300 = *MEMORY[0x277CCFEF8];
  v301 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v558[0] = v301;
  v302 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v558[1] = v302;
  v558[2] = v499;
  v303 = [MEMORY[0x277CBEA60] arrayWithObjects:v558 count:3];
  [administratorHandler44 registerForMessage:v300 receiver:self policies:v303 selector:sel__handleEventLogClearMessage_];

  msgDispatcher22 = [(HMDHome *)self msgDispatcher];
  v305 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v557 = v305;
  v306 = [MEMORY[0x277CBEA60] arrayWithObjects:&v557 count:1];
  [msgDispatcher22 registerForMessage:@"HMDHome.ActivityHistory.Clear.Broadcast" receiver:self policies:v306 selector:sel__handleClearActivityHistoryBroadcastMessage_];

  msgDispatcher23 = [(HMDHome *)self msgDispatcher];
  v308 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v556[0] = v308;
  v556[1] = v507;
  v309 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v556[2] = v309;
  v310 = [MEMORY[0x277CBEA60] arrayWithObjects:v556 count:3];
  [msgDispatcher23 registerForMessage:@"kUpdateUserPresenceStatusConsentRequestKey" receiver:self policies:v310 selector:sel__handleUpdatePresenceConsent_];

  msgDispatcher24 = [(HMDHome *)self msgDispatcher];
  v312 = *MEMORY[0x277CD0560];
  v313 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v555[0] = v313;
  v314 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v555[1] = v314;
  v315 = [MEMORY[0x277CBEA60] arrayWithObjects:v555 count:2];
  [msgDispatcher24 registerForMessage:v312 receiver:self policies:v315 selector:sel__handleRetrieveAsyncResults_];

  v503 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v503 setRoles:{objc_msgSend(v503, "roles") | 6}];
  v316 = [v503 copy];
  msgDispatcher25 = [(HMDHome *)self msgDispatcher];
  v318 = *MEMORY[0x277CD2348];
  v319 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v554[0] = v319;
  v554[1] = v316;
  v554[2] = v508;
  v320 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v554[3] = v320;
  v321 = [MEMORY[0x277CBEA60] arrayWithObjects:v554 count:4];
  [msgDispatcher25 registerForMessage:v318 receiver:self policies:v321 selector:sel__handleExecuteActionSet_];

  msgDispatcher26 = [(HMDHome *)self msgDispatcher];
  v323 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v553[0] = v323;
  v553[1] = v316;
  v553[2] = v501;
  v324 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v553[3] = v324;
  v325 = [MEMORY[0x277CBEA60] arrayWithObjects:v553 count:4];
  [msgDispatcher26 registerForMessage:@"kMultipleCharacteristicWriteRequestKey" receiver:self policies:v325 selector:sel__handleMultipleCharacteristicWrite_];

  msgDispatcher27 = [(HMDHome *)self msgDispatcher];
  v327 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v552[0] = v327;
  v552[1] = v316;
  v552[2] = v501;
  v328 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v552[3] = v328;
  v329 = [MEMORY[0x277CBEA60] arrayWithObjects:v552 count:4];
  [msgDispatcher27 registerForMessage:@"kMultipleCharacteristicReadRequestKey" receiver:self policies:v329 selector:sel__handleMultipleCharacteristicRead_];

  msgDispatcher28 = [(HMDHome *)self msgDispatcher];
  v551[0] = v316;
  v551[1] = v501;
  v331 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v551[2] = v331;
  v332 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v551[3] = v332;
  v333 = [MEMORY[0x277CBEA60] arrayWithObjects:v551 count:4];
  [msgDispatcher28 registerForMessage:@"kCharacteristicWriteRequestKey" receiver:self policies:v333 selector:sel__handleCharacteristicWrite_];

  msgDispatcher29 = [(HMDHome *)self msgDispatcher];
  v550[0] = v316;
  v550[1] = v501;
  v335 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v550[2] = v335;
  v336 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v550[3] = v336;
  v337 = [MEMORY[0x277CBEA60] arrayWithObjects:v550 count:4];
  [msgDispatcher29 registerForMessage:@"kCharacteristicReadRequestKey" receiver:self policies:v337 selector:sel__handleCharacteristicRead_];

  msgDispatcher30 = [(HMDHome *)self msgDispatcher];
  v339 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v549[0] = v339;
  v549[1] = v316;
  v549[2] = v505;
  v340 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v549[3] = v340;
  v341 = [MEMORY[0x277CBEA60] arrayWithObjects:v549 count:4];
  [msgDispatcher30 registerForMessage:@"kCharacteristicEnableNotificationRequestKey" receiver:self policies:v341 selector:sel__handleCharacteristicEnableNotification_];

  isWatch();
  msgDispatcher31 = [(HMDHome *)self msgDispatcher];
  v548[0] = v316;
  v548[1] = v501;
  v343 = [MEMORY[0x277CBEA60] arrayWithObjects:v548 count:2];
  [msgDispatcher31 registerForMessage:@"kModifyCharacterisiticNotificationsRequestKey" receiver:self policies:v343 selector:sel__handleModifyCharacteristicNotifications_];

  msgDispatcher32 = [(HMDHome *)self msgDispatcher];
  v547[0] = v316;
  v547[1] = v501;
  v345 = [MEMORY[0x277CBEA60] arrayWithObjects:v547 count:2];
  [msgDispatcher32 registerForMessage:@"kEnableAccessoryReachabilityNotificationRequestKey" receiver:self policies:v345 selector:sel__handleAccessoryReachabilityRegistrationAndEnable_];

  msgDispatcher33 = [(HMDHome *)self msgDispatcher];
  v546[0] = v316;
  v546[1] = v501;
  v347 = [MEMORY[0x277CBEA60] arrayWithObjects:v546 count:2];
  [msgDispatcher33 registerForMessage:@"kDisableAccessoryReachabilityNotificationRequestKey" receiver:self policies:v347 selector:sel__handleAccessoryReachabilityRegistration_];

  msgDispatcher34 = [(HMDHome *)self msgDispatcher];
  v349 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v545[0] = v349;
  v545[1] = v505;
  v350 = [MEMORY[0x277CBEA60] arrayWithObjects:v545 count:2];
  [msgDispatcher34 registerForMessage:@"kCharacterisiticsChangedInternalNotificationKey" receiver:self policies:v350 selector:sel__handleCharacteristicsChangedNotification_];

  msgDispatcher35 = [(HMDHome *)self msgDispatcher];
  v352 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v544[0] = v352;
  v544[1] = v507;
  v353 = [MEMORY[0x277CBEA60] arrayWithObjects:v544 count:2];
  [msgDispatcher35 registerForMessage:@"HMHomeAllowUserManagementMessage" receiver:self policies:v353 selector:sel__handleAllowUserManagementMessage_];

  msgDispatcher36 = [(HMDHome *)self msgDispatcher];
  v355 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v543[0] = v355;
  v543[1] = v507;
  v356 = [MEMORY[0x277CBEA60] arrayWithObjects:v543 count:2];
  [msgDispatcher36 registerForMessage:@"kRemoteReachabilityChangedNotificationKey" receiver:self policies:v356 selector:sel__handleAccessoryReachabilityChange_];

  v357 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v357 setRequiresSecureMessage:1];
  [v357 setRoles:3];
  v504 = v357;
  v358 = [v357 copy];
  msgDispatcher37 = [(HMDHome *)self msgDispatcher];
  v360 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v542[0] = v360;
  v500 = v358;
  v542[1] = v358;
  v542[2] = v501;
  v361 = [MEMORY[0x277CBEA60] arrayWithObjects:v542 count:3];
  [msgDispatcher37 registerForMessage:@"kConfirmExecuteTriggerRequestKey" receiver:self policies:v361 selector:sel__handleExecuteConfirmationOfTrigger_];

  v362 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v362 setRoles:4];
  v363 = [v362 copy];
  msgDispatcher38 = [(HMDHome *)self msgDispatcher];
  v365 = *MEMORY[0x277CD24B0];
  v541[0] = v363;
  v541[1] = v507;
  v366 = [MEMORY[0x277CBEA60] arrayWithObjects:v541 count:2];
  [msgDispatcher38 registerForMessage:v365 receiver:self policies:v366 selector:sel_handleEvaluatePredicateMessage_];

  v367 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v367 setRoles:{objc_msgSend(v367, "roles") | 8}];
  v368 = [v367 copy];
  v540[0] = v368;
  v540[1] = v505;
  v369 = [MEMORY[0x277CBEA60] arrayWithObjects:v540 count:2];
  [(HMDHome *)self registerForBulletinNotificationRegistrationHandlersUsingPolicies:v369];

  msgDispatcher39 = [(HMDHome *)self msgDispatcher];
  administratorHandler45 = [(HMDHome *)self administratorHandler];

  v372 = *MEMORY[0x277CD0648];
  v373 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v539[0] = v373;
  v539[1] = v506;
  v374 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v539[2] = v374;
  v375 = [MEMORY[0x277CBEA60] arrayWithObjects:v539 count:3];
  [administratorHandler45 registerForMessage:v372 receiver:self policies:v375 selector:sel__handleUpdateAutomaticSoftwareUpdate_];

  v376 = *MEMORY[0x277CD0650];
  v377 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v538[0] = v377;
  v538[1] = v506;
  v378 = v507;
  p_info = HMDResidentReachabilityContext.info;
  v380 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v538[2] = v380;
  v381 = [MEMORY[0x277CBEA60] arrayWithObjects:v538 count:3];
  v498 = administratorHandler45;
  [administratorHandler45 registerForMessage:v376 receiver:self policies:v381 selector:sel__handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate_];

  msgDispatcher40 = [(HMDHome *)self msgDispatcher];
  v383 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v537[0] = v383;
  v537[1] = v508;
  v384 = [MEMORY[0x277CBEA60] arrayWithObjects:v537 count:2];
  [msgDispatcher40 registerForMessage:@"HMDHomeQueryResidentReachabilityForAccessoriesMessageKey" receiver:self policies:v384 selector:sel__handleQueryResidentReachabilityForAccessories_];

  msgDispatcher41 = [(HMDHome *)self msgDispatcher];
  v386 = *MEMORY[0x277CCFF40];
  v387 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v536[0] = v387;
  v536[1] = v507;
  v388 = [MEMORY[0x277CBEA60] arrayWithObjects:v536 count:2];
  [msgDispatcher41 registerForMessage:v386 receiver:self policies:v388 selector:sel_executeActionsFromMessage_];

  localCapabilitiesDataSource2 = [(HMDHome *)self localCapabilitiesDataSource];
  LODWORD(v386) = [localCapabilitiesDataSource2 supportsHomeNotificationEnablement];

  if (v386)
  {
    msgDispatcher42 = [(HMDHome *)self msgDispatcher];
    v391 = *MEMORY[0x277CCFEE0];
    v392 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v535[0] = v392;
    v535[1] = v505;
    v393 = [MEMORY[0x277CBEA60] arrayWithObjects:v535 count:2];
    [msgDispatcher42 registerForMessage:v391 receiver:self policies:v393 selector:sel__handleEnableNotifications_];
  }

  msgDispatcher43 = [(HMDHome *)self msgDispatcher];
  v395 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v534[0] = v395;
  v534[1] = v508;
  v396 = [MEMORY[0x277CBEA60] arrayWithObjects:v534 count:2];
  [msgDispatcher43 registerForMessage:@"kMediaPropertiesWriteRequestKey" receiver:self policies:v396 selector:sel__handleMediaPropertiesWrite_];

  msgDispatcher44 = [(HMDHome *)self msgDispatcher];
  v398 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v533[0] = v398;
  v533[1] = v508;
  v399 = [MEMORY[0x277CBEA60] arrayWithObjects:v533 count:2];
  [msgDispatcher44 registerForMessage:@"kMediaPropertiesReadRequestKey" receiver:self policies:v399 selector:sel__handleMediaPropertiesRead_];

  msgDispatcher45 = [(HMDHome *)self msgDispatcher];
  v401 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v402 = v506;
  v532[0] = v401;
  v532[1] = v506;
  v403 = [MEMORY[0x277CBEA60] arrayWithObjects:v532 count:2];
  [msgDispatcher45 registerForMessage:@"kStartDiscoveringSymptomsForNearbyDevicesRequestKey" receiver:self policies:v403 selector:sel__handleStartDiscoveringSymptomsForNearbyDevicesMessage_];

  msgDispatcher46 = [(HMDHome *)self msgDispatcher];
  v405 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v531[0] = v405;
  v531[1] = v506;
  v406 = [MEMORY[0x277CBEA60] arrayWithObjects:v531 count:2];
  [msgDispatcher46 registerForMessage:@"kStopDiscoveringSymptomsForNearbyDevicesRequestKey" receiver:self policies:v406 selector:sel__handleStopDiscoveringSymptomsForNearbyDevicesMessage_];

  if ([(HMDHome *)self isOwnerUser])
  {
    administratorHandler46 = [(HMDHome *)self administratorHandler];
    v408 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v530 = v408;
    v409 = &v530;
    v410 = v506;
  }

  else
  {
    administratorHandler46 = [(HMDHome *)self msgDispatcher];
    v408 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v529 = v408;
    v409 = &v529;
    v410 = v507;
  }

  v411 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v409[1] = v411;
  v409[2] = v410;
  v412 = [MEMORY[0x277CBEA60] arrayWithObjects:v409 count:3];

  [administratorHandler46 registerForMessage:*MEMORY[0x277CD1300] receiver:self policies:v412 selector:sel__handleAssistantAccessControlUpdate_];
  [administratorHandler46 registerForMessage:*MEMORY[0x277CD13C0] receiver:self policies:v412 selector:sel__handleMediaContentProfileAccessControlUpdate_];
  v495 = v412;
  [administratorHandler46 registerForMessage:*MEMORY[0x277CD13A8] receiver:self policies:v412 selector:sel__handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs_];
  msgDispatcher47 = [(HMDHome *)self msgDispatcher];
  v414 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v528[0] = v414;
  v528[1] = v507;
  v415 = [MEMORY[0x277CBEA60] arrayWithObjects:v528 count:2];
  [msgDispatcher47 registerForMessage:@"HMDUCM.rsr" receiver:self policies:v415 selector:sel__handleRemoteUserClientCloudShareRequest_];

  msgDispatcher48 = [(HMDHome *)self msgDispatcher];
  v417 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v527[0] = v417;
  v527[1] = v507;
  v418 = [MEMORY[0x277CBEA60] arrayWithObjects:v527 count:2];
  [msgDispatcher48 registerForMessage:@"HMDUCM.rRepr" receiver:self policies:v418 selector:sel__handleRemoteUserClientCloudShareRepairRequest_];

  msgDispatcher49 = [(HMDHome *)self msgDispatcher];
  v420 = +[HMDRemoteMessagePolicy defaultSecurePrimaryResidentPolicy];
  v526[0] = v420;
  v526[1] = v506;
  v421 = [MEMORY[0x277CBEA60] arrayWithObjects:v526 count:2];
  [msgDispatcher49 registerForMessage:@"HMDHomeSetHomeManagerAppData" receiver:self policies:v421 selector:sel__handleSetHomeManagerAppData_];

  if (isInternalBuild())
  {
    msgDispatcher50 = [(HMDHome *)self msgDispatcher];
    v423 = *MEMORY[0x277CCFEA0];
    v424 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v525[0] = v424;
    v525[1] = v506;
    v425 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v525[2] = v425;
    v426 = [MEMORY[0x277CBEA60] arrayWithObjects:v525 count:3];
    [msgDispatcher50 registerForMessage:v423 receiver:self policies:v426 selector:sel__handleConfirmResidentRequest_];

    msgDispatcher51 = [(HMDHome *)self msgDispatcher];
    v428 = *MEMORY[0x277CD05C8];
    v429 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v524[0] = v429;
    v524[1] = v506;
    v430 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v524[2] = v430;
    v431 = [MEMORY[0x277CBEA60] arrayWithObjects:v524 count:3];
    [msgDispatcher51 registerForMessage:v428 receiver:self policies:v431 selector:sel__handleSetResidentElectionVersion_];

    v378 = v507;
    p_info = (HMDResidentReachabilityContext + 32);
  }

  [(HMDHome *)self _registerThreadResidentCommissioningMessageHandlers];
  if (isInternalBuild())
  {
    msgDispatcher52 = [(HMDHome *)self msgDispatcher];
    v433 = *MEMORY[0x277CD0610];
    v434 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v523 = v434;
    v435 = [MEMORY[0x277CBEA60] arrayWithObjects:&v523 count:1];
    [msgDispatcher52 registerForMessage:v433 receiver:self policies:v435 selector:sel__handleTestUpgradeToROAR_];

    p_info = HMDResidentReachabilityContext.info;
  }

  msgDispatcher53 = [(HMDHome *)self msgDispatcher];
  defaultSecurePolicy = [p_info + 16 defaultSecurePolicy];
  v522[0] = defaultSecurePolicy;
  v522[1] = v378;
  v438 = [MEMORY[0x277CBEA60] arrayWithObjects:v522 count:2];
  [msgDispatcher53 registerForMessage:@"HMDHomeSetNaturalLightingEnabledForLightProfilesMessage" receiver:self policies:v438 selector:sel_handleSetNaturalLightingEnabledForLightProfilesMessage_];

  msgDispatcher54 = [(HMDHome *)self msgDispatcher];
  v440 = *MEMORY[0x277CCFF58];
  v441 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v521 = v441;
  [MEMORY[0x277CBEA60] arrayWithObjects:&v521 count:1];
  v443 = v442 = p_info;
  [msgDispatcher54 registerForMessage:v440 receiver:self policies:v443 selector:sel_handleFetchLightProfileSettingsMessage_];

  msgDispatcher55 = [(HMDHome *)self msgDispatcher];
  defaultSecurePrimaryResidentPolicy = [v442 + 16 defaultSecurePrimaryResidentPolicy];
  v520[0] = defaultSecurePrimaryResidentPolicy;
  v520[1] = v378;
  v446 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v520[2] = v446;
  v447 = [MEMORY[0x277CBEA60] arrayWithObjects:v520 count:3];
  [msgDispatcher55 registerForMessage:@"HMDHomeCHIPSendRemoteRequestMessage" receiver:self policies:v447 selector:sel_handleCHIPSendRemoteRequestMessage_];

  if (isInternalBuild())
  {
    v448 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:4 remoteAccessRequired:0];
    msgDispatcher56 = [(HMDHome *)self msgDispatcher];
    v450 = *MEMORY[0x277CD0548];
    defaultSecurePolicy2 = [v442 + 16 defaultSecurePolicy];
    v519[0] = defaultSecurePolicy2;
    v519[1] = v448;
    v452 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v519[2] = v452;
    v453 = [MEMORY[0x277CBEA60] arrayWithObjects:v519 count:3];
    [msgDispatcher56 registerForMessage:v450 receiver:self policies:v453 selector:sel_handleResetMatterStorageRequest_];

    msgDispatcher57 = [(HMDHome *)self msgDispatcher];
    v455 = *MEMORY[0x277CCFE98];
    defaultSecurePolicy3 = [v442 + 16 defaultSecurePolicy];
    v518[0] = defaultSecurePolicy3;
    v518[1] = v448;
    v457 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v518[2] = v457;
    v458 = [MEMORY[0x277CBEA60] arrayWithObjects:v518 count:3];
    [msgDispatcher57 registerForMessage:v455 receiver:self policies:v458 selector:sel_handleClearMatterControllerPrivateStorageRequest_];

    v402 = v506;
    v378 = v507;
  }

  msgDispatcher58 = [(HMDHome *)self msgDispatcher];
  defaultSecurePolicy4 = [v442 + 16 defaultSecurePolicy];
  v517[0] = defaultSecurePolicy4;
  v517[1] = v378;
  v461 = [MEMORY[0x277CBEA60] arrayWithObjects:v517 count:2];
  [msgDispatcher58 registerForMessage:@"HMDHomeCHIPSendReportMessage" receiver:self policies:v461 selector:sel_handleCHIPSendReportMessage_];

  if (isInternalBuild())
  {
    msgDispatcher59 = [(HMDHome *)self msgDispatcher];
    v463 = *MEMORY[0x277CD05A0];
    v464 = [HMDXPCMessagePolicy policyWithEntitlements:1];
    v516[0] = v464;
    v465 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
    v516[1] = v465;
    v466 = [MEMORY[0x277CBEA60] arrayWithObjects:v516 count:2];
    [msgDispatcher59 registerForMessage:v463 receiver:self policies:v466 selector:sel_handleSetPreferredPrimaryMessage_];

    msgDispatcher60 = [(HMDHome *)self msgDispatcher];
    v468 = *MEMORY[0x277CD0600];
    v469 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v515[0] = v469;
    v515[1] = v402;
    v470 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v515[2] = v470;
    v471 = [MEMORY[0x277CBEA60] arrayWithObjects:v515 count:3];
    [msgDispatcher60 registerForMessage:v468 receiver:self policies:v471 selector:sel_handleSwitchFromResidentSelectionToREV2_];

    v378 = v507;
  }

  msgDispatcher61 = [(HMDHome *)self msgDispatcher];
  v473 = *MEMORY[0x277CCFF90];
  v474 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v514 = v474;
  v475 = [MEMORY[0x277CBEA60] arrayWithObjects:&v514 count:1];
  [msgDispatcher61 registerForMessage:v473 receiver:self policies:v475 selector:sel__handleFetchUniqueIdentifierForBundleIdentifier_];

  msgDispatcher62 = [(HMDHome *)self msgDispatcher];
  v477 = *MEMORY[0x277CCFF88];
  v478 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v513 = v478;
  v479 = [MEMORY[0x277CBEA60] arrayWithObjects:&v513 count:1];
  [msgDispatcher62 registerForMessage:v477 receiver:self policies:v479 selector:sel__handleFetchTriggerNameRequest_];

  featuresDataSource = [(HMDHome *)self featuresDataSource];
  LODWORD(v477) = [featuresDataSource isLocalPresenceEnabled];

  if (v477)
  {
    msgDispatcher63 = [(HMDHome *)self msgDispatcher];
    v482 = *MEMORY[0x277CD0D48];
    v483 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v512 = v483;
    v484 = [MEMORY[0x277CBEA60] arrayWithObjects:&v512 count:1];
    [msgDispatcher63 registerForMessage:v482 receiver:self policies:v484 selector:sel_handleRoomsSupportingLocalPresenceMessage_];
  }

  [(HMDHome *)self registerForNetworkInfoMessages];
  if (isInternalBuild())
  {
    [(HMDHome *)self registerForPowerAssertionMessages];
  }

  if (isInternalBuild())
  {
    msgDispatcher64 = [(HMDHome *)self msgDispatcher];
    v486 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v511 = v486;
    v487 = [MEMORY[0x277CBEA60] arrayWithObjects:&v511 count:1];
    [msgDispatcher64 registerForMessage:@"HomeUtil.Command.Wallet.RollReaderKey" receiver:self policies:v487 selector:sel__handleRollReaderKey_];

    msgDispatcher65 = [(HMDHome *)self msgDispatcher];
    v489 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v510 = v489;
    v490 = [MEMORY[0x277CBEA60] arrayWithObjects:&v510 count:1];
    [msgDispatcher65 registerForMessage:@"HomeUtil.Command.Wallet.FetchOrCreateReaderKey" receiver:self policies:v490 selector:sel__handleFetchOrCreateReaderKey_];

    msgDispatcher66 = [(HMDHome *)self msgDispatcher];
    v492 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v509 = v492;
    v493 = [MEMORY[0x277CBEA60] arrayWithObjects:&v509 count:1];
    [msgDispatcher66 registerForMessage:@"HomeUtil.Command.Wallet.RollACWGIssuerKey" receiver:self policies:v493 selector:sel__handleRollACWGIssuerKey_];
  }

  [(HMDHome *)self _registerForMatterRequests];
  [(HMDHome *)self _registerPerformMediaGroupReadinessCheckMessage];

  v494 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientOfVendorInfoUpdatedForManufacturers:(id)manufacturers withCompletion:(id)completion
{
  manufacturersCopy = manufacturers;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __74__HMDHome_notifyClientOfVendorInfoUpdatedForManufacturers_withCompletion___block_invoke;
  block[3] = &unk_278689F98;
  block[4] = self;
  v12 = manufacturersCopy;
  v13 = completionCopy;
  v9 = completionCopy;
  v10 = manufacturersCopy;
  dispatch_async(workQueue, block);
}

void __74__HMDHome_notifyClientOfVendorInfoUpdatedForManufacturers_withCompletion___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessories];
  v18 = [v2 copy];

  v3 = [MEMORY[0x277CBEB18] array];
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v15 = a1;
  obj = *(a1 + 40);
  v19 = [obj countByEnumeratingWithState:&v24 objects:v29 count:16];
  if (v19)
  {
    v17 = *v25;
    do
    {
      for (i = 0; i != v19; ++i)
      {
        if (*v25 != v17)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v24 + 1) + 8 * i);
        v20 = 0u;
        v21 = 0u;
        v22 = 0u;
        v23 = 0u;
        v6 = v18;
        v7 = [v6 countByEnumeratingWithState:&v20 objects:v28 count:16];
        if (v7)
        {
          v8 = v7;
          v9 = *v21;
          do
          {
            for (j = 0; j != v8; ++j)
            {
              if (*v21 != v9)
              {
                objc_enumerationMutation(v6);
              }

              v11 = *(*(&v20 + 1) + 8 * j);
              v12 = [v11 manufacturer];
              v13 = [v12 caseInsensitiveCompare:v5];

              if (!v13)
              {
                [v11 updateVendorInfo];
                [v3 addObject:v11];
              }
            }

            v8 = [v6 countByEnumeratingWithState:&v20 objects:v28 count:16];
          }

          while (v8);
        }
      }

      v19 = [obj countByEnumeratingWithState:&v24 objects:v29 count:16];
    }

    while (v19);
  }

  [*(v15 + 32) _notifyClientsOfAccessoryInfoUpdatedForAccessories:v3 shouldRefreshBadge:0 withCompletion:*(v15 + 48)];
  v14 = *MEMORY[0x277D85DE8];
}

- (void)resetConfiguration
{
  [(HMDHome *)self unconfigure];
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_resetConfiguration__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __29__HMDHome_resetConfiguration__block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessories];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543618;
    v20 = v6;
    v21 = 2112;
    v22 = v2;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@resetConfiguration - removing accessories %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v7 = v2;
  v8 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * i);
        [*(a1 + 32) removeAccessory:{v12, v14}];
        [v12 unconfigure];
      }

      v9 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_evaluateShouldRelaunchAndSetRelaunch
{
  v17 = *MEMORY[0x277D85DE8];
  if (![(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    accessories = [(HMDHome *)self accessories];
    v4 = [accessories countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v4)
    {
      v5 = v4;
      v6 = 0;
      v7 = *v13;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v13 != v7)
          {
            objc_enumerationMutation(accessories);
          }

          v6 |= [*(*(&v12 + 1) + 8 * i) shouldEnableDaemonRelaunch];
        }

        v5 = [accessories countByEnumeratingWithState:&v12 objects:v16 count:16];
      }

      while (v5);

      if (v6)
      {
        goto LABEL_10;
      }
    }

    else
    {
    }

    launchHandler = [(HMDHome *)self launchHandler];
    uuid = [(HMDHome *)self uuid];
    [launchHandler deregisterRelaunchClientWithUUID:uuid];
    goto LABEL_13;
  }

LABEL_10:
  launchHandler = [(HMDHome *)self launchHandler];
  uuid = [(HMDHome *)self uuid];
  [launchHandler registerRelaunchClientWithUUID:uuid];
LABEL_13:

  v11 = *MEMORY[0x277D85DE8];
}

- (void)evaluateShouldRelaunchAndSetRelaunch
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __47__HMDHome_evaluateShouldRelaunchAndSetRelaunch__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (id)getTransactionFromHAPAccessory:(id)accessory hmdAccessory:(id)hmdAccessory uuid:(id)uuid hostAccessoryUUID:(id)d objectChangeType:(unint64_t)type
{
  v103 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  hmdAccessoryCopy = hmdAccessory;
  uuidCopy = uuid;
  dCopy = d;
  currentAccessory = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = currentAccessory;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  v19 = uuidCopy;
  if (hmdAccessoryCopy)
  {
    uuid = [hmdAccessoryCopy transactionWithObjectChangeType:type];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v21 = uuid;
    }

    else
    {
      v21 = 0;
    }

    v22 = v21;
  }

  else
  {
    v23 = [HMDHAPAccessoryTransaction alloc];
    uuid = [(HMDHome *)self uuid];
    v22 = [(HMDBackingStoreModelObject *)v23 initWithObjectChangeType:type uuid:v19 parentUUID:uuid];
  }

  v24 = v22;

  [(HMDHAPAccessoryTransaction *)v24 setHapAccessoryLocal:accessoryCopy];
  providedName = [hmdAccessoryCopy providedName];
  if (providedName)
  {
    goto LABEL_13;
  }

  if ([accessoryCopy linkType] != 2)
  {
    providedName = [accessoryCopy name];
    v26 = [providedName copy];
    [(HMDHAPAccessoryTransaction *)v24 setProvidedName:v26];

LABEL_13:
  }

  v84 = dCopy;
  uniqueIdentifier = [accessoryCopy uniqueIdentifier];
  [(HMDHAPAccessoryTransaction *)v24 setUniqueIdentifier:uniqueIdentifier];

  identifier = [accessoryCopy identifier];
  [(HMDHAPAccessoryTransaction *)v24 setIdentifier:identifier];

  identifier2 = [accessoryCopy identifier];
  v92 = 0;
  keychainStore = [(HMDHome *)self keychainStore];
  v91 = 0;
  v85 = [keychainStore readPublicKeyForAccessoryName:identifier2 registeredWithHomeKit:&v92 error:&v91];
  v83 = v91;

  if (identifier2 && v85 && v92 == 1)
  {
    v31 = objc_autoreleasePoolPush();
    selfCopy = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v34 = v77 = selfCopy;
      [accessoryCopy name];
      v35 = v78 = v31;
      [accessoryCopy uniqueIdentifier];
      selfCopy2 = self;
      v36 = hmdAccessoryCopy;
      v37 = identifier2;
      v38 = v19;
      v40 = v39 = v18;
      *buf = 138544386;
      v94 = v34;
      v95 = 2112;
      v96 = v35;
      v97 = 2112;
      v98 = v40;
      v99 = 2112;
      v100 = v37;
      v101 = 2112;
      v102 = v85;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ setting pairing username and pubkey to ('%@', '%@')", buf, 0x34u);

      v18 = v39;
      v19 = v38;
      identifier2 = v37;
      hmdAccessoryCopy = v36;
      self = selfCopy2;

      v31 = v78;
      selfCopy = v77;
    }

    objc_autoreleasePoolPop(v31);
    [(HMDHAPAccessoryTransaction *)v24 setPairingUsername:identifier2];
    [(HMDHAPAccessoryTransaction *)v24 setPublicKey:v85];
  }

  else
  {
    v41 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v43 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v43, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v79 = v18;
      v44 = v81 = hmdAccessoryCopy;
      [(HMDHAPAccessoryTransaction *)v24 providedName];
      selfCopy4 = self;
      v47 = v46 = v19;
      *buf = 138544130;
      v94 = v44;
      v95 = 2112;
      v96 = v47;
      v97 = 2112;
      v98 = identifier2;
      v99 = 2112;
      v100 = v83;
      _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_ERROR, "%{public}@Failed to read public key for accessory %@ with pairing username %@: %@", buf, 0x2Au);

      v19 = v46;
      self = selfCopy4;

      v18 = v79;
      hmdAccessoryCopy = v81;
    }

    objc_autoreleasePoolPop(v41);
  }

  uUIDString = [v84 UUIDString];
  [(HMDHAPAccessoryTransaction *)v24 setHostAccessoryUUID:uUIDString];

  hostAccessoryUUID = [(HMDHAPAccessoryTransaction *)v24 hostAccessoryUUID];
  uuid2 = hostAccessoryUUID;
  if (v19 && !hostAccessoryUUID && v18)
  {
    sensorAccessoryUUID = [v18 sensorAccessoryUUID];
    v52 = [sensorAccessoryUUID hmf_isEqualToUUID:v19];

    if (!v52)
    {
      goto LABEL_29;
    }

    uuid2 = [v18 uuid];
    uUIDString2 = [uuid2 UUIDString];
    [(HMDHAPAccessoryTransaction *)v24 setHostAccessoryUUID:uUIDString2];
  }

LABEL_29:
  v82 = v19;
  category = [hmdAccessoryCopy category];

  if (!category)
  {
    category2 = [accessoryCopy category];

    if (category2)
    {
      category3 = [accessoryCopy category];
      [(HMDHAPAccessoryTransaction *)v24 setAccessoryCategory:category3];
    }

    else
    {
      category3 = [(HMDHome *)self dataSource];
      hapMetadata = [category3 hapMetadata];
      categoryForOther = [hapMetadata categoryForOther];
      [categoryForOther identifier];
      v59 = hmdAccessoryCopy;
      v60 = identifier2;
      v62 = v61 = v18;
      [(HMDHAPAccessoryTransaction *)v24 setAccessoryCategory:v62];

      v18 = v61;
      identifier2 = v60;
      hmdAccessoryCopy = v59;
    }
  }

  v63 = [MEMORY[0x277CBEB58] set];
  v64 = MEMORY[0x277CBEB58];
  v65 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(accessoryCopy, "linkType")}];
  v66 = [v64 setWithObject:v65];

  v67 = [accessoryCopy servicesOfType:@"00000701-0000-1000-8000-0026BB765291"];
  v68 = [v67 count];

  if (v68)
  {
    [v66 addObject:&unk_283E71A08];
  }

  v88[0] = MEMORY[0x277D85DD0];
  v88[1] = 3221225472;
  v88[2] = __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke;
  v88[3] = &unk_27866FA70;
  v69 = v63;
  v89 = v69;
  v90 = accessoryCopy;
  v70 = accessoryCopy;
  [v66 na_each:v88];
  transportInformationInstances = [hmdAccessoryCopy transportInformationInstances];
  v86[0] = MEMORY[0x277D85DD0];
  v86[1] = 3221225472;
  v86[2] = __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke_2;
  v86[3] = &unk_27866FA98;
  v87 = v69;
  v72 = v69;
  [transportInformationInstances na_each:v86];

  allObjects = [v72 allObjects];
  [(HMDHAPAccessoryTransaction *)v24 setTransportInformation:allObjects];

  v74 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v70, "communicationProtocol")}];
  [(HMDHAPAccessoryTransaction *)v24 setCommunicationProtocol:v74];

  v75 = *MEMORY[0x277D85DE8];

  return v24;
}

void __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke(uint64_t a1, void *a2)
{
  v11[3] = *MEMORY[0x277D85DE8];
  v10[0] = @"HM.serverIdentifier";
  v3 = *(a1 + 32);
  v4 = *(a1 + 40);
  v5 = a2;
  v6 = [v4 serverIdentifier];
  v11[0] = v6;
  v10[1] = @"HM.instanceID";
  v7 = [*(a1 + 40) instanceID];
  v10[2] = @"linkType";
  v11[1] = v7;
  v11[2] = v5;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v11 forKeys:v10 count:3];
  [v3 addObject:v8];

  v9 = *MEMORY[0x277D85DE8];
}

void __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 transportInfoDictionary];
  [v2 addObject:v3];
}

- (id)getServiceTransaction:(id)transaction parentUUID:(id)d changeType:(unint64_t)type
{
  transactionCopy = transaction;
  dCopy = d;
  instanceID = [transactionCopy instanceID];
  v10 = [HMDService generateUUIDWithAccessoryUUID:dCopy serviceID:instanceID];

  v11 = [(HMDBackingStoreModelObject *)[HMDServiceTransaction alloc] initWithObjectChangeType:type uuid:v10 parentUUID:dCopy];
  if (transactionCopy)
  {
    instanceID2 = [transactionCopy instanceID];
    [(HMDServiceTransaction *)v11 setInstanceID:instanceID2];

    type = [transactionCopy type];
    [(HMDServiceTransaction *)v11 setServiceType:type];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = transactionCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v15 = v14;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;

      endpoint = [v16 endpoint];

      [(HMDServiceTransaction *)v11 setMatterEndpointID:endpoint];
    }

    linkedServices = [transactionCopy linkedServices];

    if (linkedServices)
    {
      linkedServices2 = [transactionCopy linkedServices];
      v20 = [linkedServices2 copy];
      [(HMDServiceTransaction *)v11 setLinkedServices:v20];
    }

    v21 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(transactionCopy, "serviceProperties")}];
    [(HMDServiceTransaction *)v11 setServiceProperties:v21];
  }

  return v11;
}

- (void)evaluateBulletinNotificationsSupported
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __49__HMDHome_evaluateBulletinNotificationsSupported__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __49__HMDHome_evaluateBulletinNotificationsSupported__block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) residentDeviceManager];
  v3 = [v2 availableResidentDevices];
  v4 = [v3 count];

  if ((v4 != 0) != [*(a1 + 32) bulletinNotificationsSupported])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      [*(a1 + 32) bulletinNotificationsSupported];
      v9 = HMFBooleanToString();
      v10 = HMFBooleanToString();
      v14 = 138543874;
      v15 = v8;
      v16 = 2112;
      v17 = v9;
      v18 = 2112;
      v19 = v10;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Bulletin notifications supported has changed from: %@ to: %@", &v14, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 32) setBulletinNotificationsSupported:v4 != 0];
    v11 = [*(a1 + 32) homeManager];
    v12 = [*(a1 + 32) uuid];
    [v11 updateGenerationCounterWithReason:@"Bulletin Notifications Supported Updated" sourceUUID:v12 shouldNotifyClients:1];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)evaluateResidentUpdate
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __33__HMDHome_evaluateResidentUpdate__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)reEvaluateHomeHubState
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __33__HMDHome_reEvaluateHomeHubState__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __33__HMDHome_reEvaluateHomeHubState__block_invoke(uint64_t a1)
{
  v17[1] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) residentDeviceManager];
  v3 = [v2 residentDevices];

  v4 = 2 * ([v3 count] != 0);
  v5 = [*(a1 + 32) residentDeviceManager];
  v6 = [v5 primaryResidentDevice];

  if ([v6 isEnabled] && objc_msgSend(v6, "isReachable"))
  {
    v4 = 1;
  }

  v7 = *(a1 + 32);
  if (*(v7 + 888) != v4)
  {
    *(v7 + 888) = v4;
    v8 = MEMORY[0x277D0F818];
    v9 = *MEMORY[0x277CCFFF8];
    v16 = *MEMORY[0x277CCFFF0];
    v10 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(*(a1 + 32), "homeHubState")}];
    v17[0] = v10;
    v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:&v16 count:1];
    v12 = [v8 messageWithName:v9 messagePayload:v11];

    v13 = [*(a1 + 32) msgDispatcher];
    v14 = [*(a1 + 32) uuid];
    [v13 sendMessage:v12 target:v14];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (id)matterAccessoriesWithNewFirmwareInstalledInHome
{
  v37 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  if (([(HMDHome *)self isOwnerUser]|| [(HMDHome *)self isSharedAdmin]) && ![(HMDHome *)self isAutomaticThirdPartyAccessorySoftwareUpdateEnabled])
  {
    v28 = 0u;
    v29 = 0u;
    v26 = 0u;
    v27 = 0u;
    accessories = [(HMDHome *)self accessories];
    v4 = [accessories copy];

    v5 = [v4 countByEnumeratingWithState:&v26 objects:v36 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v27;
      selfCopy = self;
      v23 = v4;
      v20 = *v27;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v27 != v7)
          {
            objc_enumerationMutation(v4);
          }

          v9 = *(*(&v26 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v10 = v9;
          }

          else
          {
            v10 = 0;
          }

          v11 = v10;

          if ([v11 supportsCHIP])
          {
            softwareUpdate = [v9 softwareUpdate];
            v13 = softwareUpdate;
            if (softwareUpdate && [softwareUpdate state] == 4)
            {
              context = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v15 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
              {
                v16 = HMFGetLogIdentifier();
                uuid = [v9 uuid];
                uUIDString = [uuid UUIDString];
                *buf = 138543874;
                v31 = v16;
                v32 = 2114;
                v33 = uUIDString;
                v34 = 2112;
                v35 = v13;
                _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ has a firmware recently installed, softwareUpdate %@", buf, 0x20u);

                self = selfCopy;
                v7 = v20;
              }

              objc_autoreleasePoolPop(context);
              [array addObject:v9];
              v4 = v23;
            }
          }
        }

        v6 = [v4 countByEnumeratingWithState:&v26 objects:v36 count:16];
      }

      while (v6);
    }
  }

  v18 = *MEMORY[0x277D85DE8];

  return array;
}

- (void)_handleConfirmResidentRequest:(id)request
{
  requestCopy = request;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome__handleConfirmResidentRequest___block_invoke;
  v7[3] = &unk_27868A250;
  v8 = requestCopy;
  v6 = requestCopy;
  [residentDeviceManager confirmWithCompletionHandler:v7];
}

- (id)namesOfServicesWithNewFirmwareAvailableInHome
{
  v86 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  if ([(HMDHome *)self isOwnerUser])
  {
    v75 = 0u;
    v76 = 0u;
    v73 = 0u;
    v74 = 0u;
    accessories = [(HMDHome *)self accessories];
    v4 = [accessories copy];

    obj = v4;
    v5 = [v4 countByEnumeratingWithState:&v73 objects:v85 count:16];
    if (!v5)
    {
      goto LABEL_56;
    }

    v7 = v5;
    v8 = *v74;
    *&v6 = 138544130;
    v61 = v6;
    v70 = *v74;
    while (1)
    {
      v9 = 0;
      v71 = v7;
      do
      {
        if (*v74 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v10 = *(*(&v73 + 1) + 8 * v9);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & 1) != 0 && v10)
        {
          if (![(HMDHome *)self isAutomaticThirdPartyAccessorySoftwareUpdateEnabled])
          {
            goto LABEL_11;
          }

          residentDeviceManager = [(HMDHome *)self residentDeviceManager];
          availableResidentDevices = [residentDeviceManager availableResidentDevices];
          v14 = [availableResidentDevices count];

          v7 = v71;
          if (!v14)
          {
LABEL_11:
            selfCopy = self;
            v16 = v10;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v17 = v16;
            }

            else
            {
              v17 = 0;
            }

            v18 = v17;

            if ([v18 supportsCHIP])
            {
              softwareUpdate = [v16 softwareUpdate];
              vendorInfo = softwareUpdate;
              if (softwareUpdate && [softwareUpdate state] == 2)
              {
                v21 = objc_autoreleasePoolPush();
                v22 = selfCopy;
                v23 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
                {
                  v24 = HMFGetLogIdentifier();
                  [v16 uuid];
                  v25 = v66 = v21;
                  uUIDString = [v25 UUIDString];
                  *buf = 138543618;
                  v78 = v24;
                  v79 = 2114;
                  v80 = uUIDString;
                  _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Matter accessory %{public}@ has a firmware update", buf, 0x16u);

                  v7 = v71;
                  v21 = v66;
                }

                objc_autoreleasePoolPop(v21);
                name = [v16 name];
                [array addObject:name];
LABEL_48:
              }

              self = selfCopy;
              v8 = v70;
LABEL_50:

              goto LABEL_51;
            }

            vendorInfo = [v16 vendorInfo];
            firmwareVersion = [v16 firmwareVersion];
            if (firmwareVersion && [v16 isPrimary])
            {
              firmwareVersion2 = [vendorInfo firmwareVersion];
              firmwareVersion3 = [v16 firmwareVersion];
              v39 = [firmwareVersion2 isGreaterThanVersion:firmwareVersion3];
            }

            else
            {
              v39 = 0;
            }

            if (vendorInfo && ([vendorInfo firmwareVersion], (v40 = objc_claimAutoreleasedReturnValue()) != 0) && (v41 = v40, v42 = objc_msgSend(v16, "isPrimary"), v41, (v42 & 1) != 0))
            {
              if (!v39)
              {
                self = selfCopy;
                v8 = v70;
                v7 = v71;
                goto LABEL_50;
              }

              v43 = objc_autoreleasePoolPush();
              v44 = selfCopy;
              v45 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
              {
                v46 = HMFGetLogIdentifier();
                uuid = [v16 uuid];
                uUIDString2 = [uuid UUIDString];
                [vendorInfo firmwareVersion];
                v48 = v67 = v43;
                [vendorInfo productData];
                v49 = v62 = v44;
                *buf = v61;
                v78 = v46;
                v79 = 2114;
                v80 = uUIDString2;
                v81 = 2114;
                v82 = v48;
                v83 = 2112;
                v84 = v49;
                _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ has a firmware update, vendor database indicates available firmware version %{public}@ for product data %@", buf, 0x2Au);

                v44 = v62;
                v43 = v67;
              }

              objc_autoreleasePoolPop(v43);
              name = [v16 namesOfServicesShowingTilesInHomeApp];
              [array addObjectsFromArray:name];
            }

            else
            {
              softwareUpdate2 = [v16 softwareUpdate];
              name = softwareUpdate2;
              if (softwareUpdate2 && [softwareUpdate2 state] == 2)
              {
                v51 = objc_autoreleasePoolPush();
                v52 = selfCopy;
                v53 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
                {
                  v63 = HMFGetLogIdentifier();
                  uuid2 = [v16 uuid];
                  [uuid2 UUIDString];
                  v54 = v68 = v51;
                  firmwareVersion4 = [v16 firmwareVersion];
                  *buf = 138543874;
                  v78 = v63;
                  v79 = 2114;
                  v80 = v54;
                  v81 = 2114;
                  v82 = firmwareVersion4;
                  v56 = firmwareVersion4;
                  _os_log_impl(&dword_229538000, v53, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ currentFirmwareVersion %{public}@ has a firmware update", buf, 0x20u);

                  v51 = v68;
                }

                objc_autoreleasePoolPop(v51);
                name2 = [v16 name];
                [array addObject:name2];
              }
            }

            v7 = v71;
            goto LABEL_48;
          }
        }

        else
        {
          v28 = v10;
          objc_opt_class();
          v29 = objc_opt_isKindOfClass();

          if ((v29 & 1) != 0 && v10 && ![(HMDHome *)self isAutomaticSoftwareUpdateEnabled])
          {
            v30 = v28;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v31 = v30;
            }

            else
            {
              v31 = 0;
            }

            v18 = v31;

            if ([v18 supportsTVOSUpdateManualUpdateAvailableNotification])
            {
              softwareUpdateListener = [v18 softwareUpdateListener];
              isSoftwareUpdateAvailable = [softwareUpdateListener isSoftwareUpdateAvailable];

              if (isSoftwareUpdateAvailable)
              {
                goto LABEL_30;
              }
            }

            if (([v18 supportsTVOSUpdateManualUpdateAvailableNotification] & 1) == 0)
            {
              softwareUpdateListener2 = [v18 softwareUpdateListener];
              isSoftwareUpdateDownloadedAndReadyForInstallation = [softwareUpdateListener2 isSoftwareUpdateDownloadedAndReadyForInstallation];

              if (isSoftwareUpdateDownloadedAndReadyForInstallation)
              {
LABEL_30:
                vendorInfo = [v18 name];
                [array addObject:vendorInfo];
                goto LABEL_50;
              }
            }

LABEL_51:
          }
        }

        ++v9;
      }

      while (v7 != v9);
      v58 = [obj countByEnumeratingWithState:&v73 objects:v85 count:16];
      v7 = v58;
      if (!v58)
      {
LABEL_56:

        break;
      }
    }
  }

  v59 = *MEMORY[0x277D85DE8];

  return array;
}

- (BOOL)_hasPairedReachableBTLEAccessories
{
  hapAccessories = [(HMDHome *)self hapAccessories];
  v3 = [hapAccessories na_any:&__block_literal_global_1012];

  return v3;
}

unint64_t __45__HMDHome__hasPairedReachableBTLEAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 hasBTLELink])
  {
    v3 = ([v2 reachableTransports] >> 1) & 1;
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)_registerForReachabilityChangeNotificationsEnabled:(BOOL)enabled completionHandler:(id)handler
{
  enabledCopy = enabled;
  v33 = *MEMORY[0x277D85DE8];
  handlerCopy = handler;
  isCurrentDevicePrimaryResident = [(HMDHome *)self isCurrentDevicePrimaryResident];
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  v11 = v10;
  if (isCurrentDevicePrimaryResident)
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v30 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability notifications because we are the primary resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    handlerCopy[2](handlerCopy, 1);
  }

  else
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMFBooleanToString();
      *buf = 138543618;
      v30 = v13;
      v31 = 2112;
      v32 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Setting remote accessory reachability notifications enabled to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    uuid = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid UUIDString];

    v27 = *MEMORY[0x277CD0640];
    v28 = uUIDString;
    v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v28 forKeys:&v27 count:1];
    objc_initWeak(buf, selfCopy);
    if (enabledCopy)
    {
      v18 = @"kEnableAccessoryReachabilityNotificationRequestKey";
    }

    else
    {
      v18 = @"kDisableAccessoryReachabilityNotificationRequestKey";
    }

    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __80__HMDHome__registerForReachabilityChangeNotificationsEnabled_completionHandler___block_invoke;
    v23[3] = &unk_27866FA48;
    objc_copyWeak(&v25, buf);
    v26 = enabledCopy;
    v24 = handlerCopy;
    v19 = [HMDRemoteMessage messageWithName:v18 messagePayload:v17 responseHandler:v23];
    uuid2 = [(HMDHome *)selfCopy uuid];
    workQueue = [(HMDHome *)selfCopy workQueue];
    [(HMDHome *)selfCopy redispatchToResidentMessage:v19 target:uuid2 responseQueue:workQueue];

    objc_destroyWeak(&v25);
    objc_destroyWeak(buf);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome__registerForReachabilityChangeNotificationsEnabled_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v28 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (!WeakRetained)
  {
    goto LABEL_15;
  }

  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (!v11)
    {
      goto LABEL_13;
    }

    v12 = HMFGetLogIdentifier();
    v13 = *(a1 + 48);
    v22 = 138543874;
    v23 = v12;
    if (v13)
    {
      v14 = "register";
    }

    else
    {
      v14 = "de-register";
    }

    v24 = 2080;
    v25 = v14;
    v26 = 2112;
    v27 = v5;
    v15 = "%{public}@Failed to %s remote accessory reachability notification with error: %@";
    v16 = v10;
    v17 = 32;
  }

  else
  {
    if (!v11)
    {
      goto LABEL_13;
    }

    v18 = HMFGetLogIdentifier();
    v12 = v18;
    v19 = "de-registered";
    if (*(a1 + 48))
    {
      v19 = "registered";
    }

    v22 = 138543618;
    v23 = v18;
    v24 = 2080;
    v25 = v19;
    v15 = "%{public}@Successfully %s remote accessory reachability notification";
    v16 = v10;
    v17 = 22;
  }

  _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, v15, &v22, v17);

LABEL_13:
  objc_autoreleasePoolPop(v8);
  v20 = *(a1 + 32);
  if (v20)
  {
    (*(v20 + 16))(v20, v5 == 0);
  }

LABEL_15:

  v21 = *MEMORY[0x277D85DE8];
}

- (BOOL)currentRemoteReachabilityRegistration
{
  stagedRemoteReachabilityRegistration = [(HMDHome *)self stagedRemoteReachabilityRegistration];
  value = [stagedRemoteReachabilityRegistration value];

  LOBYTE(stagedRemoteReachabilityRegistration) = [value BOOLValue];
  return stagedRemoteReachabilityRegistration;
}

- (id)_primaryAccessoryForServer:(id)server
{
  v20 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  [(HMDHome *)self hapAccessoriesForServer:serverCopy];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v5 = v18 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        if ([v9 isPrimary])
        {
          v14 = 0;
          identifier = [serverCopy identifier];
          v11 = [v9 matchesHAPAccessoryWithServerIdentifier:identifier linkType:&v14];

          if (v11)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_12:

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (id)hapAccessoriesForServer:(id)server
{
  serverCopy = server;
  identifier = [serverCopy identifier];
  linkType = [serverCopy linkType];

  v7 = [(HMDHome *)self hapAccessoriesForServer:identifier linkType:linkType];

  return v7;
}

- (id)hapAccessoriesForServer:(id)server linkType:(int64_t)type
{
  v25 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  accessories = [(HMDHome *)self accessories];
  v8 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v9 = accessories;
  v10 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v21;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v21 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = *(*(&v20 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v16 = v15;

        if (v16)
        {
          typeCopy = type;
          if ([v16 matchesHAPAccessoryWithServerIdentifier:serverCopy linkType:&typeCopy])
          {
            [v8 addObject:v16];
          }
        }
      }

      v11 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
    }

    while (v11);
  }

  v17 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)readProfileState:(id)state viaDevice:(id)device
{
  stateCopy = state;
  deviceCopy = device;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __38__HMDHome_readProfileState_viaDevice___block_invoke;
  block[3] = &unk_27868A010;
  block[4] = self;
  v12 = stateCopy;
  v13 = deviceCopy;
  v9 = deviceCopy;
  v10 = stateCopy;
  dispatch_async(workQueue, block);
}

- (void)_readProfileState:(void *)state viaDevice:
{
  v30 = *MEMORY[0x277D85DE8];
  v19 = a2;
  stateCopy = state;
  val = self;
  if (self)
  {
    v5 = MEMORY[0x277CBEB18];
    v6 = [v19 count];
    v7 = +[HMDMediaSession mediaPropertyMessageKeys];
    v8 = [v5 arrayWithCapacity:{objc_msgSend(v7, "count") * v6}];

    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    obj = v19;
    v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
    if (v9)
    {
      v10 = *v26;
      v11 = MEMORY[0x277D85DD0];
      do
      {
        v12 = 0;
        do
        {
          if (*v26 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v13 = *(*(&v25 + 1) + 8 * v12);
          v14 = +[HMDMediaSession mediaPropertyMessageKeys];
          v24[0] = v11;
          v24[1] = 3221225472;
          v24[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke;
          v24[3] = &unk_278686D38;
          v24[4] = v13;
          v15 = [v14 na_map:v24];

          [v8 addObjectsFromArray:v15];
          ++v12;
        }

        while (v9 != v12);
        v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
      }

      while (v9);
    }

    objc_initWeak(&location, val);
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke_2;
    v21[3] = &unk_2786895F0;
    objc_copyWeak(&v22, &location);
    [val redispatchMediaReadRequests:v8 viaDevice:stateCopy completion:v21];
    objc_destroyWeak(&v22);
    objc_destroyWeak(&location);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __39__HMDHome__readProfileState_viaDevice___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke_3;
    v7[3] = &unk_27868A750;
    v8 = v3;
    v9 = v5;
    dispatch_async(v6, v7);
  }
}

void __39__HMDHome__readProfileState_viaDevice___block_invoke_3(uint64_t a1)
{
  v1 = a1;
  v160 = *MEMORY[0x277D85DE8];
  v2 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(*(a1 + 32), "count")}];
  v130 = 0u;
  v131 = 0u;
  v132 = 0u;
  v133 = 0u;
  obj = *(v1 + 32);
  v103 = v1;
  v108 = v2;
  v106 = [obj countByEnumeratingWithState:&v130 objects:v159 count:16];
  if (v106)
  {
    v105 = *v131;
    v125 = *MEMORY[0x277CD0910];
    v122 = *MEMORY[0x277CD0938];
    v120 = *MEMORY[0x277CD0990];
    v118 = *MEMORY[0x277CD0960];
    v116 = *MEMORY[0x277CD09B0];
    v114 = *MEMORY[0x277CD0920];
    v112 = *MEMORY[0x277CD09A0];
    *&v3 = 138544130;
    v101 = v3;
    do
    {
      v4 = 0;
      do
      {
        if (*v131 != v105)
        {
          objc_enumerationMutation(obj);
        }

        v109 = v4;
        v5 = *(*(&v130 + 1) + 8 * v4);
        v126 = 0u;
        v127 = 0u;
        v128 = 0u;
        v129 = 0u;
        v6 = v5;
        v7 = [v6 countByEnumeratingWithState:&v126 objects:v158 count:16];
        if (!v7)
        {

          v9 = 0;
          v121 = 0;
          v119 = 0;
          v117 = 0;
          v115 = 0;
          v113 = 0;
LABEL_61:
          v34 = [v9 mediaSession];
          v40 = [v34 state];
          v8 = 0;
          goto LABEL_62;
        }

        v113 = 0;
        v115 = 0;
        v117 = 0;
        v119 = 0;
        v121 = 0;
        v123 = 0;
        v8 = 0;
        v9 = 0;
        v10 = *v127;
        do
        {
          for (i = 0; i != v7; i = i + 1)
          {
            if (*v127 != v10)
            {
              objc_enumerationMutation(v6);
            }

            v12 = *(*(&v126 + 1) + 8 * i);
            v13 = [v12 error];

            if (!v13)
            {
              v14 = [v12 request];
              v15 = [v14 mediaProfile];

              v16 = [v14 property];
              v17 = [v16 isEqual:v125];

              if (v17)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v8;
                v8 = v19;
                goto LABEL_47;
              }

              v21 = [v14 property];
              v22 = [v21 isEqual:v122];

              if (v22)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v123;
                v123 = v19;
                goto LABEL_47;
              }

              v23 = [v14 property];
              v24 = [v23 isEqual:v120];

              if (v24)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v121;
                v121 = v19;
                goto LABEL_47;
              }

              v25 = [v14 property];
              v26 = [v25 isEqual:v118];

              if (v26)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v119;
                v119 = v19;
                goto LABEL_47;
              }

              v27 = [v14 property];
              v28 = [v27 isEqual:v116];

              if (v28)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v117;
                v117 = v19;
                goto LABEL_47;
              }

              v29 = [v14 property];
              v30 = [v29 isEqual:v114];

              if (v30)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v115;
                v115 = v19;
                goto LABEL_47;
              }

              v31 = [v14 property];
              v32 = [v31 isEqual:v112];

              if (v32)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v113;
                v113 = v19;
LABEL_47:
                v33 = v19;
              }

              v9 = v15;
              continue;
            }
          }

          v7 = [v6 countByEnumeratingWithState:&v126 objects:v158 count:16];
        }

        while (v7);

        v2 = v108;
        if (!v8)
        {
          v1 = v103;
          v7 = v123;
          goto LABEL_61;
        }

        v34 = [v9 accessory];
        v35 = [v9 uniqueIdentifier];
        v36 = [v35 UUIDString];
        v37 = [v8 isEqualToString:v36];

        v1 = v103;
        v7 = v123;
        if (v37)
        {
          v38 = [v34 identifier];

          v8 = v38;
        }

        v39 = [v34 home];
        v40 = [v39 mediaSessionStateWithIdentifier:v8];
        if (!v40)
        {
          v41 = objc_autoreleasePoolPush();
          v42 = *(v103 + 40);
          v43 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v44 = v110 = v41;
            v45 = [v34 identifier];
            v46 = *(v103 + 32);
            *buf = v101;
            v151 = v44;
            v152 = 2112;
            v153 = v8;
            v154 = 2112;
            v155 = v45;
            v156 = 2112;
            v157 = v46;
            _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@Creating a media session state for a remote session (sessionIdentifier %@; accessoryIdentifier %@) update - responses %@", buf, 0x2Au);

            v41 = v110;
          }

          objc_autoreleasePoolPop(v41);
          v40 = [[HMDMediaSessionState alloc] initWithSessionIdentifier:v8];
          [v39 addMediaSessionState:v40];
          v7 = v123;
        }

LABEL_62:
        v47 = [v9 accessory];
        v48 = [v47 uuid];
        v49 = [v48 UUIDString];

        if (v49 && v40)
        {
          v104 = v47;
          v50 = MEMORY[0x277CBEB38];
          v107 = v49;
          v51 = [v2 hmf_dictionaryForKey:v49];
          v52 = [v50 dictionaryWithDictionary:v51];

          v53 = v7 != 0;
          v124 = v7;
          v111 = v40;
          v54 = v52;
          if (v7)
          {
            v55 = [v7 unsignedIntegerValue];
            [(HMDMediaSessionState *)v40 setPlaybackState:v55];
            v56 = objc_autoreleasePoolPush();
            v57 = *(v1 + 40);
            v58 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
            {
              v59 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v59;
              v152 = 2048;
              v153 = v55;
              _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_INFO, "%{public}@Read the profile playback state as %tu", buf, 0x16u);

              v40 = v111;
            }

            objc_autoreleasePoolPop(v56);
            v7 = v124;
            v148 = v122;
            v149 = v124;
            v60 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v149 forKeys:&v148 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v60];
          }

          if (v121)
          {
            v61 = [v121 unsignedIntegerValue];
            [(HMDMediaSessionState *)v40 setShuffleState:v61];
            v62 = objc_autoreleasePoolPush();
            v63 = *(v1 + 40);
            v64 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v64, OS_LOG_TYPE_INFO))
            {
              v65 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v65;
              v152 = 2048;
              v153 = v61;
              _os_log_impl(&dword_229538000, v64, OS_LOG_TYPE_INFO, "%{public}@Read the profile shuffle state as %tu", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v62);
            v146 = v120;
            v147 = v121;
            v53 = 1;
            v66 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v147 forKeys:&v146 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v66];

            v7 = v124;
          }

          if (v119)
          {
            v67 = [v119 unsignedIntegerValue];
            [(HMDMediaSessionState *)v111 setRepeatState:v67];
            v68 = objc_autoreleasePoolPush();
            v69 = *(v1 + 40);
            v70 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v70, OS_LOG_TYPE_INFO))
            {
              v71 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v71;
              v152 = 2048;
              v153 = v67;
              _os_log_impl(&dword_229538000, v70, OS_LOG_TYPE_INFO, "%{public}@Read the profile repeat state as %tu", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v68);
            v144 = v118;
            v145 = v119;
            v53 = 1;
            v72 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v145 forKeys:&v144 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v72];

            v7 = v124;
          }

          if (v117)
          {
            [(HMDMediaSessionState *)v111 setVolume:v117];
            v73 = objc_autoreleasePoolPush();
            v74 = *(v1 + 40);
            v75 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v75, OS_LOG_TYPE_INFO))
            {
              v76 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v76;
              v152 = 2112;
              v153 = v117;
              _os_log_impl(&dword_229538000, v75, OS_LOG_TYPE_INFO, "%{public}@Read the profile volume as %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v73);
            v142 = v116;
            v143 = v117;
            v53 = 1;
            v77 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v143 forKeys:&v142 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v77];
          }

          if (v115)
          {
            [(HMDMediaSessionState *)v111 setMediaUniqueIdentifier:v115];
            v78 = objc_autoreleasePoolPush();
            v79 = *(v1 + 40);
            v80 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v80, OS_LOG_TYPE_INFO))
            {
              v81 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v81;
              v152 = 2112;
              v153 = v115;
              _os_log_impl(&dword_229538000, v80, OS_LOG_TYPE_INFO, "%{public}@Read the profile mediaUniqueIdentifier state as %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v78);
            v140 = v114;
            v141 = v115;
            v82 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v141 forKeys:&v140 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v82];

            v40 = v111;
            v49 = v107;
            if (!v113)
            {
LABEL_89:
              [v108 setObject:v52 forKey:v49];
              goto LABEL_90;
            }

LABEL_86:
            v83 = [v113 unsignedIntegerValue];
            [(HMDMediaSessionState *)v40 setSleepWakeState:v83];
            v84 = objc_autoreleasePoolPush();
            v85 = *(v1 + 40);
            v86 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v86, OS_LOG_TYPE_INFO))
            {
              v87 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v87;
              v152 = 2048;
              v153 = v83;
              _os_log_impl(&dword_229538000, v86, OS_LOG_TYPE_INFO, "%{public}@Read the profile sleepWakeState as %tu", buf, 0x16u);

              v40 = v111;
            }

            objc_autoreleasePoolPop(v84);
            v138 = v112;
            v139 = v113;
            v88 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v139 forKeys:&v138 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v88];

            v7 = v124;
            v49 = v107;
            goto LABEL_89;
          }

          v40 = v111;
          v49 = v107;
          if (v113)
          {
            goto LABEL_86;
          }

          if (v53)
          {
            goto LABEL_89;
          }

LABEL_90:

          v2 = v108;
          v47 = v104;
        }

        v4 = v109 + 1;
      }

      while (v109 + 1 != v106);
      v89 = [obj countByEnumeratingWithState:&v130 objects:v159 count:16];
      v106 = v89;
    }

    while (v89);
  }

  if ([v2 count])
  {
    v90 = [*(v1 + 40) uuid];
    v91 = [v90 UUIDString];
    v136 = v91;
    v134 = *MEMORY[0x277CCE7A8];
    v92 = [v108 copy];
    v135 = v92;
    v93 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v135 forKeys:&v134 count:1];
    v137 = v93;
    v94 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v137 forKeys:&v136 count:1];

    v95 = [MEMORY[0x277D0F848] entitledMessageWithName:*MEMORY[0x277CD0340] messagePayload:v94];
    v96 = [[HMDHomeManagerXPCMessageSendPolicy alloc] initWithEntitlements:0 options:-1 active:1];
    [v95 setSendPolicy:v96];

    v97 = [*(v103 + 40) msgDispatcher];
    v98 = [*(v103 + 40) homeManager];
    v99 = [v98 uuid];
    [v97 sendMessage:v95 target:v99];

    v1 = v103;
    v2 = v108;
  }

  [(HMDHome *)*(v1 + 40) updateMediaStateWithResponses:0 requestMessageInformation:?];

  v100 = *MEMORY[0x277D85DE8];
}

- (void)_getRunTimeStateUpdateWithOptions:(unint64_t)options includeMediaAccessorySessionState:(BOOL)state includeResidentDeviceState:(BOOL)deviceState completion:(id)completion
{
  deviceStateCopy = deviceState;
  stateCopy = state;
  optionsCopy = options;
  v108 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v10 = completionCopy;
  if (!completionCopy)
  {
    goto LABEL_73;
  }

  v71 = deviceStateCopy;
  v73 = completionCopy;
  accessories = [(HMDHome *)self accessories];
  v85 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(accessories, "count")}];
  strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v74 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v99 = 0u;
  v100 = 0u;
  v101 = 0u;
  v102 = 0u;
  obj = accessories;
  selfCopy = self;
  v89 = [obj countByEnumeratingWithState:&v99 objects:v107 count:16];
  if (!v89)
  {
    goto LABEL_52;
  }

  v88 = optionsCopy & 0x201;
  v87 = optionsCopy & 0x50;
  v86 = *v100;
  v80 = *MEMORY[0x277CD0938];
  v79 = *MEMORY[0x277CD0990];
  v78 = *MEMORY[0x277CD0960];
  v77 = *MEMORY[0x277CD09B0];
  v76 = *MEMORY[0x277CD0920];
  v75 = *MEMORY[0x277CD09A0];
  v84 = optionsCopy;
  do
  {
    for (i = 0; i != v89; ++i)
    {
      if (*v100 != v86)
      {
        objc_enumerationMutation(obj);
      }

      v13 = *(*(&v99 + 1) + 8 * i);
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v14 = v13;
      }

      else
      {
        v14 = 0;
      }

      v15 = v14;

      v16 = v15;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v17 = v16;
      }

      else
      {
        v17 = 0;
      }

      v18 = v17;

      v19 = v16;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v20 = v19;
      }

      else
      {
        v20 = 0;
      }

      v21 = v20;

      v22 = v13;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v23 = v22;
      }

      else
      {
        v23 = 0;
      }

      v24 = v23;

      if (v19)
      {
        v25 = stateCopy;
      }

      else
      {
        v25 = 0;
      }

      if (v87)
      {
        v26 = v21 == 0;
      }

      else
      {
        v26 = 1;
      }

      v27 = !v26;
      if (v88)
      {
        v28 = v24 == 0;
      }

      else
      {
        v28 = 1;
      }

      v29 = !v28;
      if (v25 || (v27 & 1) != 0 || ((v18 != 0) & (optionsCopy >> 8)) != 0 || (v29 & 1) != 0 || (optionsCopy & 0x400) != 0 && [v24 hasTelevisionService])
      {
        runtimeState = [v22 runtimeState];
        v31 = [runtimeState mutableCopy];

        if (v19 && stateCopy)
        {
          mediaProfile = [v19 mediaProfile];
          v33 = mediaProfile;
          if (mediaProfile)
          {
            mediaSession = [mediaProfile mediaSession];
            state = [mediaSession state];
            if (state)
            {
              v35 = state;
              goto LABEL_46;
            }

            identifier = [v19 identifier];
            v35 = [(HMDHome *)selfCopy mediaSessionStateWithIdentifier:identifier];

            if (v35)
            {
LABEL_46:
              v37 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v35, "playbackState")}];
              [v31 setObject:v37 forKeyedSubscript:v80];

              v38 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v35, "shuffleState")}];
              [v31 setObject:v38 forKeyedSubscript:v79];

              v39 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v35, "repeatState")}];
              [v31 setObject:v39 forKeyedSubscript:v78];

              volume = [v35 volume];
              [v31 setObject:volume forKeyedSubscript:v77];

              mediaUniqueIdentifier = [v35 mediaUniqueIdentifier];
              [v31 setObject:mediaUniqueIdentifier forKeyedSubscript:v76];

              v42 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v35, "sleepWakeState")}];
              [v31 setObject:v42 forKeyedSubscript:v75];
            }

            self = selfCopy;
          }
        }

        v43 = [v31 copy];
        uuid = [v22 uuid];
        uUIDString = [uuid UUIDString];
        [v85 setObject:v43 forKeyedSubscript:uUIDString];

        optionsCopy = v84;
      }
    }

    v89 = [obj countByEnumeratingWithState:&v99 objects:v107 count:16];
  }

  while (v89);
LABEL_52:

  v105 = *MEMORY[0x277CCE7A8];
  v46 = [v85 copy];
  v106 = v46;
  v47 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v106 forKeys:&v105 count:1];
  v48 = [v47 mutableCopy];

  v10 = v73;
  if (v71)
  {
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];

    v51 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(residentDevices, "count")}];
    v95 = 0u;
    v96 = 0u;
    v97 = 0u;
    v98 = 0u;
    v52 = residentDevices;
    v53 = [v52 countByEnumeratingWithState:&v95 objects:v104 count:16];
    if (v53)
    {
      v54 = v53;
      v55 = *v96;
      do
      {
        for (j = 0; j != v54; ++j)
        {
          if (*v96 != v55)
          {
            objc_enumerationMutation(v52);
          }

          v57 = *(*(&v95 + 1) + 8 * j);
          identifier2 = [v57 identifier];
          uUIDString2 = [identifier2 UUIDString];

          runtimeState2 = [v57 runtimeState];
          [v51 setObject:runtimeState2 forKey:uUIDString2];
        }

        v54 = [v52 countByEnumeratingWithState:&v95 objects:v104 count:16];
      }

      while (v54);
    }

    v61 = [v51 copy];
    [v48 setObject:v61 forKey:*MEMORY[0x277CD0550]];

    self = selfCopy;
  }

  v62 = [v48 copy];
  v73[2](v73, v62);

  if ([v74 count])
  {
    [(HMDHome *)self _readProfileState:v74 viaDevice:0];
  }

  v93 = 0u;
  v94 = 0u;
  v91 = 0u;
  v92 = 0u;
  v63 = strongToStrongObjectsMapTable;
  v64 = [v63 countByEnumeratingWithState:&v91 objects:v103 count:16];
  if (v64)
  {
    v65 = v64;
    v66 = *v92;
    do
    {
      for (k = 0; k != v65; ++k)
      {
        if (*v92 != v66)
        {
          objc_enumerationMutation(v63);
        }

        v68 = *(*(&v91 + 1) + 8 * k);
        v69 = [v63 objectForKey:v68];
        if ([v69 count])
        {
          [(HMDHome *)self _readProfileState:v69 viaDevice:v68];
        }
      }

      v65 = [v63 countByEnumeratingWithState:&v91 objects:v103 count:16];
    }

    while (v65);
  }

LABEL_73:
  v70 = *MEMORY[0x277D85DE8];
}

- (void)getRunTimeStateUpdateWithOptions:(unint64_t)options includeMediaAccessorySessionState:(BOOL)state includeResidentDeviceState:(BOOL)deviceState completion:(id)completion
{
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __116__HMDHome_getRunTimeStateUpdateWithOptions_includeMediaAccessorySessionState_includeResidentDeviceState_completion___block_invoke;
  v13[3] = &unk_27866FA20;
  v14 = completionCopy;
  optionsCopy = options;
  stateCopy = state;
  deviceStateCopy = deviceState;
  v13[4] = self;
  v12 = completionCopy;
  dispatch_async(workQueue, v13);
}

- (id)performReadRequests:(id)requests withRetries:(int64_t)retries timeInterval:(double)interval loggingObject:(id)object flow:(id)flow
{
  v55 = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  objectCopy = object;
  flowCopy = flow;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v12 = requestsCopy;
  v13 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v51;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v51 != v15)
        {
          objc_enumerationMutation(v12);
        }

        v17 = *(*(&v50 + 1) + 8 * i);
        characteristic = [v17 characteristic];
        service = [characteristic service];
        accessory = [service accessory];
        uuid = [accessory uuid];

        v22 = [dictionary objectForKeyedSubscript:uuid];

        if (v22)
        {
          v23 = [dictionary objectForKeyedSubscript:uuid];
          [v23 addObject:v17];
        }

        else
        {
          v23 = [MEMORY[0x277CBEB18] arrayWithObject:v17];
          [dictionary setObject:v23 forKeyedSubscript:uuid];
        }
      }

      v14 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
    }

    while (v14);
  }

  allValues = [dictionary allValues];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke;
  v45[3] = &unk_27866F9D8;
  intervalCopy = interval;
  retriesCopy = retries;
  v45[4] = self;
  v25 = objectCopy;
  v46 = v25;
  v26 = flowCopy;
  v47 = v26;
  v27 = [allValues na_map:v45];

  v28 = MEMORY[0x277D2C900];
  v29 = MEMORY[0x277D2C938];
  workQueue = [(HMDHome *)self workQueue];
  v31 = [v29 schedulerWithDispatchQueue:workQueue];
  v32 = [v28 combineAllFutures:v27 ignoringErrors:1 scheduler:v31];
  v42[0] = MEMORY[0x277D85DD0];
  v42[1] = 3221225472;
  v42[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_997;
  v42[3] = &unk_278683980;
  v43 = v25;
  v44 = v26;
  v33 = v26;
  v34 = v25;
  v35 = [v32 flatMap:v42];

  v36 = *MEMORY[0x277D85DE8];

  return v35;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = MEMORY[0x277D2C900];
  v5 = *(a1 + 56);
  v6 = *(a1 + 64);
  v7 = [*(a1 + 32) workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2;
  v13[3] = &unk_27866F9B0;
  v14 = *(a1 + 40);
  v8 = *(a1 + 48);
  v9 = *(a1 + 32);
  v15 = v8;
  v16 = v9;
  v17 = v3;
  v10 = v3;
  v11 = [v4 futureWithRetries:v5 timeInterval:v7 workQueue:v13 block:v6];

  return v11;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_997(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 na_map:&__block_literal_global_1000];
  if ([v4 hmf_isEmpty])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 40) UUID];
      v17 = 138543618;
      v18 = v8;
      v19 = 2112;
      v20 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] All read request retries failed.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v12 = [v10 futureWithError:v11];
  }

  else
  {
    v13 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CBEAC0] dictionaryByCombiningNonOverlappingDictionaries:v4];
    v12 = [v13 futureWithResult:v11];
  }

  v14 = v12;

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

void *__75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2_998(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v12 = 138543874;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2048;
    v17 = a2;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Performing characteristic read requests with remaining retries: %ld", &v12, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = [*(a1 + 48) performReadRequests:*(a1 + 56) loggingObject:*(a1 + 32) flow:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)performWriteRequests:(id)requests withRetries:(int64_t)retries timeInterval:(double)interval loggingObject:(id)object flow:(id)flow
{
  v55 = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  objectCopy = object;
  flowCopy = flow;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v12 = requestsCopy;
  v13 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v51;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v51 != v15)
        {
          objc_enumerationMutation(v12);
        }

        v17 = *(*(&v50 + 1) + 8 * i);
        characteristic = [v17 characteristic];
        service = [characteristic service];
        accessory = [service accessory];
        uuid = [accessory uuid];

        v22 = [dictionary objectForKeyedSubscript:uuid];

        if (v22)
        {
          v23 = [dictionary objectForKeyedSubscript:uuid];
          [v23 addObject:v17];
        }

        else
        {
          v23 = [MEMORY[0x277CBEB18] arrayWithObject:v17];
          [dictionary setObject:v23 forKeyedSubscript:uuid];
        }
      }

      v14 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
    }

    while (v14);
  }

  allValues = [dictionary allValues];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke;
  v45[3] = &unk_27866F9D8;
  intervalCopy = interval;
  retriesCopy = retries;
  v45[4] = self;
  v25 = objectCopy;
  v46 = v25;
  v26 = flowCopy;
  v47 = v26;
  v27 = [allValues na_map:v45];

  v28 = MEMORY[0x277D2C900];
  v29 = MEMORY[0x277D2C938];
  workQueue = [(HMDHome *)self workQueue];
  v31 = [v29 schedulerWithDispatchQueue:workQueue];
  v32 = [v28 combineAllFutures:v27 ignoringErrors:1 scheduler:v31];
  v42[0] = MEMORY[0x277D85DD0];
  v42[1] = 3221225472;
  v42[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_991;
  v42[3] = &unk_278683980;
  v43 = v25;
  v44 = v26;
  v33 = v26;
  v34 = v25;
  v35 = [v32 flatMap:v42];

  v36 = *MEMORY[0x277D85DE8];

  return v35;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = MEMORY[0x277D2C900];
  v5 = *(a1 + 56);
  v6 = *(a1 + 64);
  v7 = [*(a1 + 32) workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2;
  v13[3] = &unk_27866F9B0;
  v14 = *(a1 + 40);
  v8 = *(a1 + 48);
  v9 = *(a1 + 32);
  v15 = v8;
  v16 = v9;
  v17 = v3;
  v10 = v3;
  v11 = [v4 futureWithRetries:v5 timeInterval:v7 workQueue:v13 block:v6];

  return v11;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_991(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 na_map:&__block_literal_global_995];
  if ([v4 hmf_isEmpty])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 40) UUID];
      v17 = 138543618;
      v18 = v8;
      v19 = 2112;
      v20 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] All write request retries failed.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v12 = [v10 futureWithError:v11];
  }

  else
  {
    v13 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CBEAC0] dictionaryByCombiningNonOverlappingDictionaries:v4];
    v12 = [v13 futureWithResult:v11];
  }

  v14 = v12;

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

void *__76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2_992(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v12 = 138543874;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2048;
    v17 = a2;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Performing characteristic write requests with remaining retries: %ld", &v12, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = [*(a1 + 48) performWriteRequests:*(a1 + 56) loggingObject:*(a1 + 32) flow:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)performReadRequests:(id)requests loggingObject:(id)object flow:(id)flow
{
  requestsCopy = requests;
  objectCopy = object;
  flowCopy = flow;
  v11 = objc_alloc_init(MEMORY[0x277D2C900]);
  v12 = [(HMDHome *)self description];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __50__HMDHome_performReadRequests_loggingObject_flow___block_invoke;
  v20[3] = &unk_27867E7E8;
  v21 = objectCopy;
  v22 = flowCopy;
  v13 = v11;
  v23 = v13;
  v24 = requestsCopy;
  v14 = requestsCopy;
  v15 = flowCopy;
  v16 = objectCopy;
  [(HMDHome *)self readCharacteristicValues:v14 source:1120 sourceForLogging:v12 qualityOfService:-1 withCompletionHandler:v20];

  v17 = v24;
  v18 = v13;

  return v13;
}

void __50__HMDHome_performReadRequests_loggingObject_flow___block_invoke(id *a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = [a1[7] firstObject];
    v8 = [v7 characteristic];

    v24 = 0;
    v9 = [v6 hmd_valueOfCharacteristic:v8 error:&v24];
    v10 = v24;
    if (v9)
    {
      [a1[6] finishWithResult:v6];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = a1[4];
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        [a1[5] UUID];
        v21 = v23 = v17;
        *buf = 138543874;
        v26 = v20;
        v27 = 2112;
        v28 = v21;
        v29 = 2112;
        v30 = v10;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform read requests with error: %@", buf, 0x20u);

        v17 = v23;
      }

      objc_autoreleasePoolPop(v17);
      [a1[6] finishWithError:v10];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = a1[4];
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [a1[5] UUID];
      *buf = 138543874;
      v26 = v14;
      v27 = 2112;
      v28 = v15;
      v29 = 2112;
      v30 = v5;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform read requests (no response payload) with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = a1[6];
    v8 = [MEMORY[0x277CBEB68] null];
    [v16 finishWithResult:v8];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (id)performWriteRequests:(id)requests loggingObject:(id)object flow:(id)flow
{
  v42 = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  objectCopy = object;
  flowCopy = flow;
  v11 = objc_alloc_init(MEMORY[0x277D2C900]);
  uUID = [MEMORY[0x277CCAD78] UUID];
  v13 = objc_autoreleasePoolPush();
  selfCopy = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
  {
    v16 = HMFGetLogIdentifier();
    uUID2 = [flowCopy UUID];
    *buf = 0;
    *&buf[8] = 0;
    if (uUID)
    {
      [uUID getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v32 = *buf;
    v18 = [requestsCopy count];
    *buf = 138544642;
    *&buf[4] = v16;
    *&buf[12] = 2112;
    *&buf[14] = uUID2;
    v34 = 1042;
    v35 = 16;
    v36 = 2098;
    v37 = &v32;
    v38 = 2114;
    v39 = selfCopy;
    v40 = 2048;
    v41 = v18;
    _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Executing write requests with identifier: %{public,uuid_t}.16P from home: %{public}@ count: %lu for perform write requests", buf, 0x3Au);
  }

  objc_autoreleasePoolPop(v13);
  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __51__HMDHome_performWriteRequests_loggingObject_flow___block_invoke;
  v27[3] = &unk_27867E7E8;
  v28 = objectCopy;
  v29 = flowCopy;
  v19 = v11;
  v30 = v19;
  v31 = requestsCopy;
  v20 = requestsCopy;
  v21 = flowCopy;
  v22 = objectCopy;
  [(HMDHome *)selfCopy writeCharacteristicValues:v20 source:1120 identifier:uUID transport:0 qualityOfService:-1 withCompletionHandler:v27];
  v23 = v31;
  v24 = v19;

  v25 = *MEMORY[0x277D85DE8];
  return v19;
}

void __51__HMDHome_performWriteRequests_loggingObject_flow___block_invoke(id *a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = [a1[7] firstObject];
    v8 = [v7 characteristic];

    v24 = 0;
    v9 = [v6 hmd_valueOfCharacteristic:v8 error:&v24];
    v10 = v24;
    if (v9)
    {
      [a1[6] finishWithResult:v6];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = a1[4];
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        [a1[5] UUID];
        v21 = v23 = v17;
        *buf = 138543874;
        v26 = v20;
        v27 = 2112;
        v28 = v21;
        v29 = 2112;
        v30 = v10;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform write requests with error: %@", buf, 0x20u);

        v17 = v23;
      }

      objc_autoreleasePoolPop(v17);
      [a1[6] finishWithError:v10];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = a1[4];
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [a1[5] UUID];
      *buf = 138543874;
      v26 = v14;
      v27 = 2112;
      v28 = v15;
      v29 = 2112;
      v30 = v5;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform write requests (no response payload) with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = a1[6];
    v8 = [MEMORY[0x277CBEB68] null];
    [v16 finishWithResult:v8];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (void)writeCharacteristicValues:(id)values source:(unint64_t)source biomeSource:(unint64_t)biomeSource identifier:(id)identifier transport:(id)transport qualityOfService:(int64_t)service withCompletionHandler:(id)handler
{
  valuesCopy = values;
  identifierCopy = identifier;
  transportCopy = transport;
  handlerCopy = handler;
  v19 = objc_alloc(MEMORY[0x277D0F770]);
  v20 = MEMORY[0x277CCACA8];
  v21 = MEMORY[0x22AAD2510](self, a2);
  7421 = [v20 stringWithFormat:@"%@, %s:%ld", v21, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 7421];
  v39 = [v19 initWithName:7421];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __116__HMDHome_writeCharacteristicValues_source_biomeSource_identifier_transport_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_27866F988;
  sourceCopy = source;
  serviceCopy = service;
  v30 = v39;
  v31 = identifierCopy;
  v32 = transportCopy;
  selfCopy = self;
  biomeSourceCopy = biomeSource;
  v34 = valuesCopy;
  v35 = handlerCopy;
  v24 = handlerCopy;
  v25 = valuesCopy;
  v26 = transportCopy;
  v27 = identifierCopy;
  dispatch_async(workQueue, block);

  __HMFActivityScopeLeave();
}

void __116__HMDHome_writeCharacteristicValues_source_biomeSource_identifier_transport_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  v23[2] = *MEMORY[0x277D85DE8];
  v22[0] = @"sourceType";
  v2 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 80)];
  v22[1] = @"kMultiPartResponseKey";
  v23[0] = v2;
  v23[1] = MEMORY[0x277CBEC28];
  v3 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v23 forKeys:v22 count:2];

  v4 = objc_alloc(MEMORY[0x277D0F848]);
  v5 = *(a1 + 88);
  v6 = [MEMORY[0x277D0F820] allMessageDestinations];
  v7 = [v4 initWithName:@"kMultipleCharacteristicWriteRequestKey" qualityOfService:v5 destination:v6 payload:v3];

  [v7 setIdentifier:*(a1 + 40)];
  [v7 setTransport:*(a1 + 48)];
  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 56);
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    v12 = [v7 identifier];

    if (v12)
    {
      v13 = [v7 identifier];
      [v13 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v16 = *buf;
    v14 = HMDRequestSourceAsString(*(a1 + 80));
    *buf = 138544130;
    *&buf[4] = v11;
    *&buf[12] = 1042;
    *&buf[14] = 16;
    v18 = 2098;
    v19 = &v16;
    v20 = 2114;
    v21 = v14;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Issuing write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 56) _writeCharacteristicValues:*(a1 + 64) requestMessage:v7 source:*(a1 + 80) biomeSource:*(a1 + 96) withCompletionHandler:*(a1 + 72)];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)regionStateUpdated
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_regionStateUpdated__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

uint64_t __29__HMDHome_regionStateUpdated__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) homeLocationHandler];
  v3 = [v2 regionStateAtHome];

  if (v3 == 1)
  {
    v4 = [*(a1 + 32) workQueue];
    v5 = v4;
    v8 = MEMORY[0x277D85DD0];
    v9 = 3221225472;
    v10 = __29__HMDHome_regionStateUpdated__block_invoke_980;
    v11 = &unk_27868A728;
    v12 = *(a1 + 32);
    v6 = &v8;
    goto LABEL_5;
  }

  if (v3 == 2)
  {
    v4 = [*(a1 + 32) workQueue];
    v5 = v4;
    v13 = MEMORY[0x277D85DD0];
    v14 = 3221225472;
    v15 = __29__HMDHome_regionStateUpdated__block_invoke_2;
    v16 = &unk_27868A728;
    v17 = *(a1 + 32);
    v6 = &v13;
LABEL_5:
    dispatch_async(v4, v6);
  }

  return [*(a1 + 32) _updateHomeLocation];
}

void __29__HMDHome_regionStateUpdated__block_invoke_2(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Did leave home region", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeRegionExitedNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

void __29__HMDHome_regionStateUpdated__block_invoke_980(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Did enter home region", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeRegionEnteredNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

- (void)suspendedStateChangedForAccessory:(id)accessory suspendedState:(unint64_t)state
{
  v26 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = accessoryCopy;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  if (v8)
  {
    if (state == 2)
    {
      v9 = objc_autoreleasePoolPush();
      selfCopy = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
      {
        v12 = HMFGetLogIdentifier();
        v13 = HAPAccessorySuspendedStateDescription();
        *buf = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = accessoryCopy;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEBUG, "%{public}@Skipping suspended state update: '%@' for accessory %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v9);
    }

    else
    {
      workQueue = [(HMDHome *)self workQueue];
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __60__HMDHome_suspendedStateChangedForAccessory_suspendedState___block_invoke;
      v16[3] = &unk_278685330;
      v16[4] = self;
      stateCopy = state;
      v17 = v8;
      v18 = accessoryCopy;
      dispatch_async(workQueue, v16);
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

uint64_t __60__HMDHome_suspendedStateChangedForAccessory_suspendedState___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) reachabilityRegisteredDevices];
  v3 = [v2 count];

  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 56);
      v10 = HAPAccessorySuspendedStateDescription();
      v11 = *(a1 + 40);
      v18 = 138543874;
      v19 = v8;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v11;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Notify registered devices of suspended state change to '%@' for accessory: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 32) _updateReachabilityChangeToRegisteredDevices:*(a1 + 48)];
  }

  else
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
    {
      v12 = HMFGetLogIdentifier();
      v13 = *(a1 + 56);
      v14 = HAPAccessorySuspendedStateDescription();
      v15 = *(a1 + 48);
      v18 = 138543874;
      v19 = v12;
      v20 = 2112;
      v21 = v14;
      v22 = 2112;
      v23 = v15;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@No registered devices to send the suspended state change '%@' for accessory %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
  }

  result = [*(a1 + 32) notifyClientsOfReachabilityUpdateForAccessory:*(a1 + 48)];
  v17 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)reachabilityChangedForAccessory:(id)accessory reachable:(BOOL)reachable
{
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __53__HMDHome_reachabilityChangedForAccessory_reachable___block_invoke;
  block[3] = &unk_278688BD0;
  v10 = accessoryCopy;
  selfCopy = self;
  reachableCopy = reachable;
  v8 = accessoryCopy;
  dispatch_async(workQueue, block);
}

void __53__HMDHome_reachabilityChangedForAccessory_reachable___block_invoke(uint64_t a1)
{
  v22[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  if (v4)
  {
    v5 = *(a1 + 40);
    v22[0] = v4;
    v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v22 count:1];
    [v5 _updateWoWState:v6];
  }

  [*(a1 + 40) _reachabilityChangedForAccessory:*(a1 + 32) reachable:*(a1 + 48)];
  v7 = [*(a1 + 40) reachabilityRegisteredDevices];
  v8 = [v7 count];

  v9 = objc_autoreleasePoolPush();
  v10 = *(a1 + 40);
  v11 = HMFGetOSLogHandle();
  v12 = v11;
  if (v8)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 32);
      v18 = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Notify registered devices of reachability change for accessory: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    [*(a1 + 40) _updateReachabilityChangeToRegisteredDevices:*(a1 + 32)];
  }

  else
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      v16 = *(a1 + 32);
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = v16;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@No registered devices available to notify reachability change update for accessory: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (id)replaceActionSetName:(id)name withNewName:(id)newName
{
  v15[1] = *MEMORY[0x277D85DE8];
  newNameCopy = newName;
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  uuid = [(HMDHome *)self uuid];
  v15[0] = uuid;
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v15 count:1];
  v12 = [nameValidator replaceActionSetName:nameCopy withNewName:newNameCopy inNamespaces:v11];

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)replaceName:(id)name withNewName:(id)newName
{
  v15[1] = *MEMORY[0x277D85DE8];
  newNameCopy = newName;
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  uuid = [(HMDHome *)self uuid];
  v15[0] = uuid;
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v15 count:1];
  v12 = [nameValidator replaceName:nameCopy withNewName:newNameCopy inNamespaces:v11];

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)removeName:(id)name
{
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  uuid = [(HMDHome *)self uuid];
  v8 = [nameValidator removeName:nameCopy namespace:uuid];

  return v8;
}

- (id)addActionSetName:(id)name
{
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  uuid = [(HMDHome *)self uuid];
  v8 = [nameValidator addActionSetName:nameCopy namespace:uuid];

  return v8;
}

- (id)addName:(id)name
{
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  uuid = [(HMDHome *)self uuid];
  v8 = [nameValidator addName:nameCopy namespace:uuid];

  return v8;
}

- (id)validateName:(id)name
{
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  v7 = [nameValidator validateName:nameCopy];

  return v7;
}

- (void)removeAllHomeContentsAndAccessoryPairings:(BOOL)pairings queue:(id)queue completionHandler:(id)handler
{
  v24 = *MEMORY[0x277D85DE8];
  queueCopy = queue;
  handlerCopy = handler;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v13;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Removed all home content and accessory pairings", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  workQueue = [(HMDHome *)selfCopy workQueue];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __77__HMDHome_removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke;
  v18[3] = &unk_278685C18;
  pairingsCopy = pairings;
  v18[4] = selfCopy;
  v19 = queueCopy;
  v20 = handlerCopy;
  v15 = handlerCopy;
  v16 = queueCopy;
  dispatch_async(workQueue, v18);

  v17 = *MEMORY[0x277D85DE8];
}

- (void)removeService:(id)service
{
  serviceCopy = service;
  objc_initWeak(&location, self);
  workQueue = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __25__HMDHome_removeService___block_invoke;
  v8[3] = &unk_27867DEF8;
  objc_copyWeak(v10, &location);
  v9 = serviceCopy;
  v10[1] = a2;
  v7 = serviceCopy;
  dispatch_async(workQueue, v8);

  objc_destroyWeak(v10);
  objc_destroyWeak(&location);
}

void __25__HMDHome_removeService___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained && *(a1 + 32))
  {
    v4 = WeakRetained;
    [WeakRetained _removeService:?];
    v3 = NSStringFromSelector(*(a1 + 48));
    [v4 saveWithReason:v3 postSyncNotification:1];

    WeakRetained = v4;
  }
}

- (void)handleSignificantTimeChange
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v19 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Going to re-evaluate all the triggers as time has changed significantly", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  triggers = [(HMDHome *)selfCopy triggers];
  v8 = [triggers countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v14;
    do
    {
      v11 = 0;
      do
      {
        if (*v14 != v10)
        {
          objc_enumerationMutation(triggers);
        }

        [*(*(&v13 + 1) + 8 * v11++) reEvaluate:1];
      }

      while (v9 != v11);
      v9 = [triggers countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v9);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)reEvaluateTriggers
{
  v13 = *MEMORY[0x277D85DE8];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  triggers = [(HMDHome *)self triggers];
  v3 = [triggers countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v9;
    do
    {
      v6 = 0;
      do
      {
        if (*v9 != v5)
        {
          objc_enumerationMutation(triggers);
        }

        [*(*(&v8 + 1) + 8 * v6++) reEvaluate:0];
      }

      while (v4 != v6);
      v4 = [triggers countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v4);
  }

  v7 = *MEMORY[0x277D85DE8];
}

- (id)mediaSystemWithUUID:(id)d
{
  dCopy = d;
  mediaSystems = [(HMDHome *)self mediaSystems];
  v6 = [mediaSystems hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)mediaSystemsWithUUIDs:(id)ds
{
  dsCopy = ds;
  mediaSystems = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __33__HMDHome_mediaSystemsWithUUIDs___block_invoke;
  v9[3] = &unk_278675410;
  v10 = dsCopy;
  v6 = dsCopy;
  v7 = [mediaSystems na_filter:v9];

  return v7;
}

uint64_t __33__HMDHome_mediaSystemsWithUUIDs___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 uuid];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (void)removeOutgoingInvitation:(id)invitation
{
  invitationCopy = invitation;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_outgoingInvitations removeObject:invitationCopy];
  os_unfair_recursive_lock_unlock();
}

- (void)addOutgoingInvitation:(id)invitation
{
  invitationCopy = invitation;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_outgoingInvitations addObject:invitationCopy];
  os_unfair_recursive_lock_unlock();
}

- (void)setOutgoingInvitations:(id)invitations
{
  invitationsCopy = invitations;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [invitationsCopy mutableCopy];
  outgoingInvitations = self->_outgoingInvitations;
  self->_outgoingInvitations = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSArray)outgoingInvitations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_outgoingInvitations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (id)outgoingInvitationWithUUID:(id)d
{
  dCopy = d;
  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v6 = [outgoingInvitations hmf_firstObjectWithValue:dCopy forKeyPath:@"identifier"];

  return v6;
}

- (id)userWithUUID:(id)d
{
  dCopy = d;
  users = [(HMDHome *)self users];
  v6 = [users hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)serviceGroupWithUUID:(id)d
{
  dCopy = d;
  serviceGroups = [(HMDHome *)self serviceGroups];
  v6 = [serviceGroups hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)serviceGroupWithName:(id)name
{
  nameCopy = name;
  serviceGroups = [(HMDHome *)self serviceGroups];
  v6 = [serviceGroups hmf_firstObjectWithName:nameCopy];

  return v6;
}

- (id)triggerWithUUID:(id)d
{
  dCopy = d;
  triggers = [(HMDHome *)self triggers];
  v6 = [triggers hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)triggerWithName:(id)name
{
  nameCopy = name;
  triggers = [(HMDHome *)self triggers];
  v6 = [triggers hmf_firstObjectWithName:nameCopy];

  return v6;
}

- (id)triggerOwnedActionSetWithUUID:(id)d
{
  dCopy = d;
  triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
  v6 = [triggerOwnedActionSets hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)actionSetWithUUID:(id)d
{
  dCopy = d;
  actionSets = [(HMDHome *)self actionSets];
  v6 = [actionSets hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)actionSetWithName:(id)name
{
  nameCopy = name;
  actionSets = [(HMDHome *)self actionSets];
  v6 = [actionSets hmf_firstObjectWithName:nameCopy];

  return v6;
}

- (void)_evaluateOwnerTrustZoneCapabilityAndNotify
{
  v13 = *MEMORY[0x277D85DE8];
  if (![(HMDHome *)self isOwnerTrustZoneCapable])
  {
    if (-[HMDHome _isSharedHomeVersionTrustZoneCapable](self, "_isSharedHomeVersionTrustZoneCapable") || (-[HMDHome residentDeviceManager](self, "residentDeviceManager"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 hasTrustZoneCapableResident], v3, v4))
    {
      v5 = objc_autoreleasePoolPush();
      selfCopy = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        v11 = 138543362;
        v12 = v8;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Owner became trust zone capable after evaluating owner trust zone capability", &v11, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
      [(HMDHome *)selfCopy setOwnerTrustZoneCapable:1];
      notificationCenter = [(HMDHome *)selfCopy notificationCenter];
      [notificationCenter postNotificationName:@"HMDHomeOwnerBecameTrustZoneCapableNotification" object:selfCopy];
    }
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleReceivedNonCloudSourcedSharedHomeModel
{
  v13 = *MEMORY[0x277D85DE8];
  if (-[HMDHome _isSharedHomeVersionTrustZoneCapable](self, "_isSharedHomeVersionTrustZoneCapable") || (-[HMDHome residentDeviceManager](self, "residentDeviceManager"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 hasTrustZoneCapableResident], v3, v4))
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Owner became trust zone capable after receiving shared home model", &v11, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy setOwnerTrustZoneCapable:1];
    notificationCenter = [(HMDHome *)selfCopy notificationCenter];
    [notificationCenter postNotificationName:@"HMDHomeOwnerBecameTrustZoneCapableNotification" object:selfCopy];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isSharedHomeVersionTrustZoneCapable
{
  sharedHomeSourceVersion = [(HMDHome *)self sharedHomeSourceVersion];
  v3 = +[HMDHomeKitVersion version6];
  v4 = [sharedHomeSourceVersion isAtLeastVersion:v3];

  return v4;
}

- (void)setOwnerTrustZoneCapable:(BOOL)capable
{
  os_unfair_recursive_lock_lock_with_options();
  self->_ownerTrustZoneCapable = capable;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)ownerTrustZoneCapable
{
  os_unfair_recursive_lock_lock_with_options();
  ownerTrustZoneCapable = self->_ownerTrustZoneCapable;
  os_unfair_recursive_lock_unlock();
  return ownerTrustZoneCapable;
}

- (id)zoneWithUUID:(id)d
{
  dCopy = d;
  zones = [(HMDHome *)self zones];
  v6 = [zones hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)zoneWithName:(id)name
{
  nameCopy = name;
  zones = [(HMDHome *)self zones];
  v6 = [zones hmf_firstObjectWithName:nameCopy];

  return v6;
}

- (id)mediaProfileWithUUID:(id)d
{
  v26 = *MEMORY[0x277D85DE8];
  dCopy = d;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  accessories = [(HMDHome *)self accessories];
  v6 = [accessories countByEnumeratingWithState:&v21 objects:v25 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v22;
LABEL_3:
    v9 = 0;
    while (1)
    {
      if (*v22 != v8)
      {
        objc_enumerationMutation(accessories);
      }

      v10 = *(*(&v21 + 1) + 8 * v9);
      objc_opt_class();
      v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
      v12 = v11;

      if (v12)
      {
        mediaProfile = [v12 mediaProfile];
      }

      else
      {
        v14 = v10;
        objc_opt_class();
        v15 = (objc_opt_isKindOfClass() & 1) != 0 ? v14 : 0;
        v16 = v15;

        mediaProfile = [v16 mediaProfile];
      }

      uniqueIdentifier = [mediaProfile uniqueIdentifier];
      v18 = [uniqueIdentifier isEqual:dCopy];

      if (v18)
      {
        break;
      }

      if (v7 == ++v9)
      {
        v7 = [accessories countByEnumeratingWithState:&v21 objects:v25 count:16];
        if (v7)
        {
          goto LABEL_3;
        }

        goto LABEL_18;
      }
    }
  }

  else
  {
LABEL_18:
    mediaProfile = 0;
  }

  v19 = *MEMORY[0x277D85DE8];

  return mediaProfile;
}

- (id)accessoryWithSPIClientIdentifier:(id)identifier
{
  identifierCopy = identifier;
  accessories = [(HMDHome *)self accessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __44__HMDHome_accessoryWithSPIClientIdentifier___block_invoke;
  v9[3] = &unk_278681708;
  v10 = identifierCopy;
  v6 = identifierCopy;
  v7 = [accessories na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __44__HMDHome_accessoryWithSPIClientIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 spiClientIdentifier];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (id)accessoryWithDeviceIdentifier:(id)identifier
{
  identifierCopy = identifier;
  accessories = [(HMDHome *)self accessories];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __41__HMDHome_accessoryWithDeviceIdentifier___block_invoke;
  v11[3] = &unk_278681708;
  v12 = identifierCopy;
  v6 = identifierCopy;
  v7 = [accessories na_firstObjectPassingTest:v11];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  return v8;
}

uint64_t __41__HMDHome_accessoryWithDeviceIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 deviceForDirectMessaging];

  v7 = [v6 identifier];
  v8 = [v7 hmf_isEqualToUUID:*(a1 + 32)];

  return v8;
}

- (id)accessoryWithEndpointIdentifier:(id)identifier
{
  v3 = [(HMDHome *)self accessoryWithSPIClientIdentifier:identifier];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (id)accessoryWithUUID:(id)d
{
  dCopy = d;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableDictionary *)self->_accessories objectForKeyedSubscript:dCopy];
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (id)roomWithUniqueIdentifier:(id)identifier forClientIdentifierSalt:(id)salt
{
  identifierCopy = identifier;
  saltCopy = salt;
  rooms = [(HMDHome *)self rooms];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __60__HMDHome_roomWithUniqueIdentifier_forClientIdentifierSalt___block_invoke;
  v13[3] = &unk_27866F960;
  v14 = saltCopy;
  v15 = identifierCopy;
  v9 = identifierCopy;
  v10 = saltCopy;
  v11 = [rooms na_firstObjectPassingTest:v13];

  return v11;
}

uint64_t __60__HMDHome_roomWithUniqueIdentifier_forClientIdentifierSalt___block_invoke(uint64_t a1, void *a2)
{
  v3 = MEMORY[0x277CCAD78];
  v4 = [a2 uuid];
  v5 = [v3 hm_deriveUUIDFromBaseUUID:v4 identifierSalt:*(a1 + 32)];

  v6 = [v5 isEqual:*(a1 + 40)];
  return v6;
}

- (id)roomWithUUID:(id)d
{
  dCopy = d;
  roomForEntireHome = [(HMDHome *)self roomForEntireHome];
  uuid = [roomForEntireHome uuid];
  v7 = [uuid isEqual:dCopy];

  if (v7)
  {
    roomForEntireHome2 = [(HMDHome *)self roomForEntireHome];
  }

  else
  {
    rooms = [(HMDHome *)self rooms];
    roomForEntireHome2 = [rooms hmf_firstObjectWithUUID:dCopy];
  }

  return roomForEntireHome2;
}

- (id)roomWithName:(id)name
{
  nameCopy = name;
  rooms = [(HMDHome *)self rooms];
  v6 = [rooms hmf_firstObjectWithName:nameCopy];

  return v6;
}

- (void)_configureBulletinNotification
{
  v15 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  hapAccessories = [(HMDHome *)self hapAccessories];
  v5 = [hapAccessories countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v11;
    do
    {
      v8 = 0;
      do
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(hapAccessories);
        }

        [*(*(&v10 + 1) + 8 * v8++) configureBulletinNotification];
      }

      while (v6 != v8);
      v6 = [hapAccessories countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)configureBulletinNotification
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __40__HMDHome_configureBulletinNotification__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)saveToCurrentAccountWithReason:(id)reason
{
  reasonCopy = reason;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_saveToCurrentAccountWithReason___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = reasonCopy;
  v6 = reasonCopy;
  dispatch_async(workQueue, v7);
}

uint64_t __42__HMDHome_saveToCurrentAccountWithReason___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v9 = 138543618;
    v10 = v5;
    v11 = 2112;
    v12 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Saving to current account with reason: %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  result = [*(a1 + 32) _configureBulletinNotification];
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_updateExpectConfigurationVersion
{
  v15 = *MEMORY[0x277D85DE8];
  expectedConfigurationVersion = [(HMDHome *)self expectedConfigurationVersion];
  if (expectedConfigurationVersion < [(HMDHome *)self configurationVersion])
  {
    [(HMDHome *)self setExpectedConfigurationVersion:[(HMDHome *)self configurationVersion]];
  }

  [(HMDHome *)self setExpectedConfigurationVersion:[(HMDHome *)self expectedConfigurationVersion]+ 1];
  v4 = objc_autoreleasePoolPush();
  selfCopy = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543874;
    v10 = v7;
    v11 = 2048;
    expectedConfigurationVersion2 = [(HMDHome *)selfCopy expectedConfigurationVersion];
    v13 = 2048;
    configurationVersion = [(HMDHome *)selfCopy configurationVersion];
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Increased expected configuration counter to %lu (current configurationVersion: %lu).", &v9, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

- (void)_updateConfigurationVersion
{
  v12 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setConfigurationVersion:[(HMDHome *)self configurationVersion]+ 1];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
  {
    v6 = HMFGetLogIdentifier();
    v8 = 138543618;
    v9 = v6;
    v10 = 2048;
    configurationVersion = [(HMDHome *)selfCopy configurationVersion];
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Incrementing configuration version to %lu", &v8, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  [(HMDHome *)selfCopy __saveConfigurationVersionTransaction];
  v7 = *MEMORY[0x277D85DE8];
}

- (void)_handleModifyCharacteristicNotifications:(id)notifications
{
  v130 = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  if (![notificationsCopy isRemote] || (objc_msgSend(notificationsCopy, "isSecureRemote") & 1) != 0)
  {
    v5 = [notificationsCopy dictionaryForKey:@"kCharacteristicNotificationsKey"];
    v6 = [notificationsCopy dictionaryForKey:@"kMediaNotificationsKey"];
    [notificationsCopy arrayForKey:@"HMDDeviceNotificationActionSetsKey"];
    v90 = v5;
    v93 = v92 = v6;
    v7 = (v93 | v5 | v6) != 0;
    if ([notificationsCopy isRemote])
    {
      primaryResident = [(HMDHome *)self primaryResident];
      device = [primaryResident device];
      isCurrentDevice = [device isCurrentDevice];

      if ((isCurrentDevice & 1) == 0 && ([v90 count] || objc_msgSend(v93, "count")))
      {
        v22 = objc_autoreleasePoolPush();
        selfCopy = self;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
        {
          v25 = HMFGetLogIdentifier();
          *buf = 138543362;
          v113 = v25;
          _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Received modify characteristic notification message from remote device, and this device is not the primary resident. Discarding.", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v22);
        v95 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3202];
        [notificationsCopy respondWithError:?];
        v21 = v90;
        goto LABEL_42;
      }
    }

    v89 = [notificationsCopy dataForKey:@"kMatterNotificationsKey"];
    if (!v89)
    {
      v95 = 0;
LABEL_28:
      LOBYTE(v109) = 0;
      v34 = [notificationsCopy BOOLForKey:*MEMORY[0x277CD2158] keyPresent:&v109];
      remoteSourceDevice = [notificationsCopy remoteSourceDevice];
      remoteDestinationString = [remoteSourceDevice remoteDestinationString];

      v94 = [notificationsCopy userForHome:self];
      if (v7 && remoteDestinationString && v94 && (v109 & 1) != 0)
      {
        v88 = remoteDestinationString;
        v91 = [notificationsCopy dictionaryForKey:@"CharacteristicNotificationThreshold"];
        v37 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
        {
          v40 = HMFGetLogIdentifier();
          v41 = HMFBooleanToString();
          shortDescription = [v94 shortDescription];
          *buf = 138545410;
          v113 = v40;
          v114 = 2112;
          v115 = v41;
          v116 = 2112;
          v117 = shortDescription;
          v118 = 2112;
          v119 = v88;
          v120 = 2112;
          v121 = v90;
          v122 = 2112;
          v123 = v92;
          v124 = 2112;
          v125 = v93;
          v126 = 2112;
          v127 = v91;
          v128 = 2112;
          v129 = v95;
          _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Received modify characteristic notification message with enable: %@ user: %@ deviceIdsDestination: %@ characteristicsPayload: %@ mediaPropertiesPayload: %@ actionSetsPayload: %@characteristicChangeThresholds: %@matterNotificationPayload: %@", buf, 0x5Cu);
        }

        objc_autoreleasePoolPop(v37);
        if (!v34)
        {
          v53 = objc_alloc_init(MEMORY[0x277CBEB18]);
          v86 = notificationsCopy;
          remoteSourceDevice2 = [notificationsCopy remoteSourceDevice];
          remoteDestinationString2 = [remoteSourceDevice2 remoteDestinationString];
          v98 = v53;
          [v53 addObject:remoteDestinationString2];

          v87 = remoteSourceDevice2;
          globalHandles = [remoteSourceDevice2 globalHandles];
          firstObject = [globalHandles firstObject];

          v96 = firstObject;
          if (firstObject)
          {
            v105 = 0u;
            v106 = 0u;
            v103 = 0u;
            v104 = 0u;
            account = [remoteSourceDevice2 account];
            handles = [account handles];

            obj = handles;
            v60 = [handles countByEnumeratingWithState:&v103 objects:v111 count:16];
            if (v60)
            {
              v61 = v60;
              v62 = *v104;
              do
              {
                for (i = 0; i != v61; ++i)
                {
                  if (*v104 != v62)
                  {
                    objc_enumerationMutation(obj);
                  }

                  v64 = *(*(&v103 + 1) + 8 * i);
                  pushToken = [firstObject pushToken];
                  v66 = [v64 URI];
                  prefixedURI = [v66 prefixedURI];
                  v68 = MEMORY[0x22AAD2AD0](pushToken, prefixedURI);

                  if (v68)
                  {
                    if (([v98 containsObject:v68] & 1) == 0)
                    {
                      [v98 addObject:v68];
                    }
                  }

                  else
                  {
                    v69 = objc_autoreleasePoolPush();
                    v70 = selfCopy2;
                    v71 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v71, OS_LOG_TYPE_ERROR))
                    {
                      HMFGetLogIdentifier();
                      v73 = v72 = selfCopy2;
                      *buf = 138543874;
                      v113 = v73;
                      v114 = 2112;
                      v115 = v96;
                      v116 = 2112;
                      v117 = v64;
                      _os_log_impl(&dword_229538000, v71, OS_LOG_TYPE_ERROR, "%{public}@Failed to create destination with globalHandle: %@, accountHandle: %@", buf, 0x20u);

                      selfCopy2 = v72;
                      firstObject = v96;
                    }

                    objc_autoreleasePoolPop(v69);
                  }
                }

                v61 = [obj countByEnumeratingWithState:&v103 objects:v111 count:16];
              }

              while (v61);
            }
          }

          v101 = 0u;
          v102 = 0u;
          v99 = 0u;
          v100 = 0u;
          v74 = v98;
          v75 = [v74 countByEnumeratingWithState:&v99 objects:v110 count:16];
          v21 = v90;
          if (v75)
          {
            v76 = v75;
            v77 = *v100;
            while (2)
            {
              for (j = 0; j != v76; ++j)
              {
                if (*v100 != v77)
                {
                  objc_enumerationMutation(v74);
                }

                v79 = *(*(&v99 + 1) + 8 * j);
                notificationRegistry = [(HMDHome *)selfCopy2 notificationRegistry];
                LOBYTE(v79) = [notificationRegistry setNotificationsEnabled:0 user:v94 deviceIdsDestination:v79 characteristicsPayload:v90 characteristicChangeThresholdsPayload:v91 mediaPropertiesPayload:v92 actionSetsPayload:v93 matterNotificationPayload:v95];

                if (v79)
                {

                  notificationsCopy = v86;
                  remoteDestinationString = v88;
                  v44 = v91;
                  goto LABEL_71;
                }
              }

              v76 = [v74 countByEnumeratingWithState:&v99 objects:v110 count:16];
              if (v76)
              {
                continue;
              }

              break;
            }
          }

          v81 = objc_autoreleasePoolPush();
          v82 = selfCopy2;
          v83 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v83, OS_LOG_TYPE_ERROR))
          {
            v84 = HMFGetLogIdentifier();
            *buf = 138543874;
            v113 = v84;
            v114 = 2112;
            v115 = v94;
            v116 = 2112;
            v117 = v74;
            _os_log_impl(&dword_229538000, v83, OS_LOG_TYPE_ERROR, "%{public}@Failed to disable notification for user: %@ with destinations: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v81);
          v85 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2 description:@"Failed to disable notification because registration was not found" reason:@"Could not find matching registration" suggestion:0];
          [v86 respondWithError:v85];

          notificationsCopy = v86;
          remoteDestinationString = v88;
          v51 = v89;
          v44 = v91;
          goto LABEL_41;
        }

        notificationRegistry2 = [(HMDHome *)selfCopy2 notificationRegistry];
        remoteDestinationString = v88;
        v21 = v90;
        v44 = v91;
        [notificationRegistry2 setNotificationsEnabled:1 user:v94 deviceIdsDestination:v88 characteristicsPayload:v90 characteristicChangeThresholdsPayload:v91 mediaPropertiesPayload:v92 actionSetsPayload:v93 matterNotificationPayload:v95];

        if ([v93 count])
        {
          v107[0] = MEMORY[0x277D85DD0];
          v107[1] = 3221225472;
          v107[2] = __52__HMDHome__handleModifyCharacteristicNotifications___block_invoke;
          v107[3] = &unk_278685C40;
          v108 = notificationsCopy;
          [(HMDHome *)selfCopy2 actionSetResponsePayloadForActionSetsPayload:v93 completion:v107];
        }

        else
        {
LABEL_71:
          [notificationsCopy respondWithSuccess];
        }
      }

      else
      {
        v45 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v47 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v49 = v48 = remoteDestinationString;
          messagePayload = [notificationsCopy messagePayload];
          *buf = 138543618;
          v113 = v49;
          v114 = 2112;
          v115 = messagePayload;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle modify characteristic notifications message payload: %@", buf, 0x16u);

          remoteDestinationString = v48;
        }

        objc_autoreleasePoolPop(v45);
        v44 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
        [notificationsCopy respondWithError:v44];
        v21 = v90;
      }

      v51 = v89;
LABEL_41:

LABEL_42:
      goto LABEL_43;
    }

    v109 = 0;
    v11 = OPACKDecodeData();
    v12 = v11;
    if (v11)
    {
      v13 = v11;
      objc_opt_class();
      v14 = objc_opt_isKindOfClass() & 1;
      if (v14)
      {
        v15 = v13;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;
      v95 = v13;

      if (v14)
      {
        v7 = 1;
LABEL_27:

        goto LABEL_28;
      }

      v26 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        v29 = HMFGetLogIdentifier();
        *buf = 138543618;
        v113 = v29;
        v114 = 2112;
        v115 = v95;
        v30 = "%{public}@Error casting decodedMatterNotificationData to NSDictionary. decodedMatterNotificationData=%@";
        v31 = v28;
        v32 = 22;
        goto LABEL_25;
      }
    }

    else
    {
      v26 = objc_autoreleasePoolPush();
      selfCopy5 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        v29 = HMFGetLogIdentifier();
        *buf = 138544130;
        v113 = v29;
        v114 = 2048;
        v115 = v109;
        v116 = 2112;
        v117 = v89;
        v118 = 2112;
        v119 = 0;
        v30 = "%{public}@Error decoding Matter notification payload. status=%ld encodedMatterNotificationData=%@ decodedMatterNotificationData=%@";
        v31 = v28;
        v32 = 42;
LABEL_25:
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, v30, buf, v32);
      }
    }

    objc_autoreleasePoolPop(v26);
    v95 = 0;
    goto LABEL_27;
  }

  v17 = objc_autoreleasePoolPush();
  selfCopy6 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 138543618;
    v113 = v20;
    v114 = 2112;
    v115 = notificationsCopy;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v17);
  v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
  [notificationsCopy respondWithError:v21];
LABEL_43:

  v52 = *MEMORY[0x277D85DE8];
}

void __52__HMDHome__handleModifyCharacteristicNotifications___block_invoke(uint64_t a1, void *a2)
{
  v8[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v7 = @"HMDDeviceNotificationActionSetsKey";
  v8[0] = a2;
  v3 = MEMORY[0x277CBEAC0];
  v4 = a2;
  v5 = [v3 dictionaryWithObjects:v8 forKeys:&v7 count:1];
  [v2 respondWithPayload:v5];

  v6 = *MEMORY[0x277D85DE8];
}

- (void)actionSetResponsePayloadForActionSetsPayload:(id)payload completion:(id)completion
{
  v48 = *MEMORY[0x277D85DE8];
  payloadCopy = payload;
  completionCopy = completion;
  if ([payloadCopy count] && (-[HMDHome actionSetStateObserver](self, "actionSetStateObserver"), v8 = objc_claimAutoreleasedReturnValue(), v8, v8))
  {
    v33 = completionCopy;
    v9 = [MEMORY[0x277CBEB58] set];
    v39 = 0u;
    v40 = 0u;
    v41 = 0u;
    v42 = 0u;
    v34 = payloadCopy;
    v10 = payloadCopy;
    v36 = [v10 countByEnumeratingWithState:&v39 objects:v47 count:16];
    if (v36)
    {
      v11 = *v40;
      v12 = 0x277CCA000uLL;
      v35 = *v40;
      do
      {
        for (i = 0; i != v36; ++i)
        {
          if (*v40 != v11)
          {
            objc_enumerationMutation(v10);
          }

          v14 = *(v12 + 3240);
          v15 = *(*(&v39 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v16 = v15;
          }

          else
          {
            v16 = 0;
          }

          v17 = v16;

          if (v17)
          {
            v18 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v17];
            if (v18)
            {
              [v9 addObject:v18];
            }

            else
            {
              v23 = objc_autoreleasePoolPush();
              selfCopy = self;
              v25 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
              {
                HMFGetLogIdentifier();
                v26 = v10;
                selfCopy2 = self;
                v29 = v28 = v9;
                *buf = 138543618;
                v44 = v29;
                v45 = 2112;
                v46 = v17;
                _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Action set uuid string (%@) could not be converted to a uuid", buf, 0x16u);

                v9 = v28;
                self = selfCopy2;
                v10 = v26;
                v11 = v35;
              }

              objc_autoreleasePoolPop(v23);
              v12 = 0x277CCA000;
            }
          }

          else
          {
            v19 = objc_autoreleasePoolPush();
            selfCopy3 = self;
            v21 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
            {
              v22 = HMFGetLogIdentifier();
              *buf = 138543362;
              v44 = v22;
              _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@Action set element was not a string", buf, 0xCu);

              v12 = 0x277CCA000;
            }

            objc_autoreleasePoolPop(v19);
          }
        }

        v36 = [v10 countByEnumeratingWithState:&v39 objects:v47 count:16];
      }

      while (v36);
    }

    if ([v9 count])
    {
      actionSetStateObserver = [(HMDHome *)self actionSetStateObserver];
      allObjects = [v9 allObjects];
      v37[0] = MEMORY[0x277D85DD0];
      v37[1] = 3221225472;
      v37[2] = __67__HMDHome_actionSetResponsePayloadForActionSetsPayload_completion___block_invoke;
      v37[3] = &unk_278683820;
      completionCopy = v33;
      v38 = v33;
      [actionSetStateObserver currentStateForActionSetUUIDs:allObjects completionHandler:v37];
    }

    else
    {
      completionCopy = v33;
      v33[2](v33, MEMORY[0x277CBEC10]);
    }

    payloadCopy = v34;
  }

  else
  {
    (*(completionCopy + 2))(completionCopy, MEMORY[0x277CBEC10]);
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __67__HMDHome_actionSetResponsePayloadForActionSetsPayload_completion___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  v3 = [HMDActionSetResponse serializeWithResponses:a2];
  (*(v2 + 16))(v2, v3);
}

- (void)auditDestinationsForNotifications:(id)notifications
{
  notificationsCopy = notifications;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __45__HMDHome_auditDestinationsForNotifications___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = notificationsCopy;
  v6 = notificationsCopy;
  dispatch_async(workQueue, v7);
}

void __45__HMDHome_auditDestinationsForNotifications___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) notificationRegistry];
  [v2 auditNotificationDestinations:*(a1 + 40) home:*(a1 + 32)];
}

void __195__HMDHome__modifyCharacteristicNotifications_characteristicChangeThresholds_mediaNotifications_actionSetNotificationPayload_matterAttributeNotifications_enableNotification_withDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v8 = WeakRetained;
  if (WeakRetained)
  {
    if (v5)
    {
      v9 = objc_autoreleasePoolPush();
      v10 = v8;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        *buf = 138543874;
        v27 = v12;
        v28 = 2112;
        v29 = v13;
        v30 = 2112;
        v31 = v5;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Failed to modify notifications with remote gateway %@ due to error %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v9);
      v14 = *(a1 + 48);
      if (v14)
      {
        (*(v14 + 16))(v14, v5);
      }
    }

    else
    {
      v17 = [WeakRetained workQueue];
      v19[0] = MEMORY[0x277D85DD0];
      v19[1] = 3221225472;
      v19[2] = __195__HMDHome__modifyCharacteristicNotifications_characteristicChangeThresholds_mediaNotifications_actionSetNotificationPayload_matterAttributeNotifications_enableNotification_withDevice_completion___block_invoke_968;
      v19[3] = &unk_278685AD0;
      objc_copyWeak(&v24, (a1 + 56));
      v20 = *(a1 + 32);
      v21 = *(a1 + 40);
      v25 = *(a1 + 64);
      v22 = v6;
      v23 = *(a1 + 48);
      dispatch_async(v17, v19);

      objc_destroyWeak(&v24);
    }
  }

  else
  {
    v15 = *(a1 + 48);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
      (*(v15 + 16))(v15, v16);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __195__HMDHome__modifyCharacteristicNotifications_characteristicChangeThresholds_mediaNotifications_actionSetNotificationPayload_matterAttributeNotifications_enableNotification_withDevice_completion___block_invoke_968(uint64_t a1)
{
  v42 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v3 = objc_autoreleasePoolPush();
  v4 = WeakRetained;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v7 = *(a1 + 32);
    *buf = 138543618;
    v39 = v6;
    v40 = 2112;
    v41 = v7;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Modified notifications with remote gateway %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  [v4 _handleRemoteGatewayNotificationRegistration:*(a1 + 40) enable:*(a1 + 72)];
  v31 = a1;
  v30 = [*(a1 + 48) hmf_dictionaryForKey:@"HMDDeviceNotificationActionSetsKey"];
  [HMDActionSetResponse responsesFromSerializedResponses:?];
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = v36 = 0u;
  v8 = [obj countByEnumeratingWithState:&v33 objects:v37 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v34;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v34 != v10)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v33 + 1) + 8 * i);
        v13 = [v12 actionSetUUID];
        v14 = [v4 actionSetWithUUID:v13];

        if (v14)
        {
          v15 = [v4 actionSetStateSubscriptionManager];
          v16 = [v14 uuid];
          v17 = [v15 isMonitoringActionSet:v16];

          if (v17)
          {
            v18 = [v4 actionSetStateSubscriptionManager];
            v19 = [v12 actionSetUUID];
            [v18 actionSetStateDidChange:v19 state:{objc_msgSend(v12, "state")}];

            goto LABEL_17;
          }

          v20 = objc_autoreleasePoolPush();
          v21 = v4;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
          {
            v23 = HMFGetLogIdentifier();
            v24 = [v12 actionSetUUID];
            *buf = 138543618;
            v39 = v23;
            v40 = 2112;
            v41 = v24;
            v25 = v22;
            v26 = OS_LOG_TYPE_DEFAULT;
            v27 = "%{public}@Got action set enable response for unregistered action set %@";
            goto LABEL_15;
          }
        }

        else
        {
          v20 = objc_autoreleasePoolPush();
          v21 = v4;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
          {
            v23 = HMFGetLogIdentifier();
            v24 = [v12 actionSetUUID];
            *buf = 138543618;
            v39 = v23;
            v40 = 2112;
            v41 = v24;
            v25 = v22;
            v26 = OS_LOG_TYPE_ERROR;
            v27 = "%{public}@Got action set enable response for unknown action set %@";
LABEL_15:
            _os_log_impl(&dword_229538000, v25, v26, v27, buf, 0x16u);
          }
        }

        objc_autoreleasePoolPop(v20);
LABEL_17:
      }

      v9 = [obj countByEnumeratingWithState:&v33 objects:v37 count:16];
    }

    while (v9);
  }

  v28 = *(v31 + 56);
  if (v28)
  {
    (*(v28 + 16))(v28, 0);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)modifyCharacteristicNotifications:(id)notifications characteristicChangeThresholds:(id)thresholds mediaNotifications:(id)mediaNotifications actionSetNotificationPayload:(id)payload enableNotification:(BOOL)notification withDevice:(id)device
{
  notificationsCopy = notifications;
  thresholdsCopy = thresholds;
  mediaNotificationsCopy = mediaNotifications;
  payloadCopy = payload;
  deviceCopy = device;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __154__HMDHome_modifyCharacteristicNotifications_characteristicChangeThresholds_mediaNotifications_actionSetNotificationPayload_enableNotification_withDevice___block_invoke;
  block[3] = &unk_27866F910;
  block[4] = self;
  v26 = notificationsCopy;
  v27 = thresholdsCopy;
  v28 = mediaNotificationsCopy;
  notificationCopy = notification;
  v29 = payloadCopy;
  v30 = deviceCopy;
  v20 = deviceCopy;
  v21 = payloadCopy;
  v22 = mediaNotificationsCopy;
  v23 = thresholdsCopy;
  v24 = notificationsCopy;
  dispatch_async(workQueue, block);
}

- (BOOL)shouldRestrictAllMessagingToLocalTransportsForUser:(id)user
{
  userCopy = user;
  v4 = isiOSDevice();
  LOBYTE(v5) = 0;
  if (userCopy && v4)
  {
    v5 = [userCopy isRemoteAccessAllowed] ^ 1;
  }

  return v5;
}

- (void)_resubscribeForNotificationsOnResident:(id)resident
{
  v48 = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  primaryResident = [(HMDHome *)self primaryResident];
  device = [primaryResident device];

  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543874;
    v43 = v11;
    v44 = 2112;
    v45 = residentCopy;
    v46 = 2112;
    v47 = device;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Resubscribing for notifications - previousResidentDevice: %@, current primaryResident: %@", buf, 0x20u);
  }

  v36 = residentCopy;

  objc_autoreleasePoolPop(v8);
  isWatch();
  residentEnabledDevices = [(HMDHome *)selfCopy residentEnabledDevices];
  array = [MEMORY[0x277CBEB18] array];
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v40 = 0u;
  _residentUsers = [(HMDHome *)selfCopy _residentUsers];
  v14 = [_residentUsers countByEnumeratingWithState:&v37 objects:v41 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v38;
    do
    {
      for (i = 0; i != v15; ++i)
      {
        if (*v38 != v16)
        {
          objc_enumerationMutation(_residentUsers);
        }

        v18 = *(*(&v37 + 1) + 8 * i);
        if ([v18 configurationState] == 2)
        {
          userID = [v18 userID];
          v20 = [HMDDevice deviceWithDestination:userID];

          if (v20 && ([v20 isCurrentDevice] & 1) == 0)
          {
            [array addObject:v20];
          }
        }
      }

      v15 = [_residentUsers countByEnumeratingWithState:&v37 objects:v41 count:16];
    }

    while (v15);
  }

  if ([residentEnabledDevices count] || objc_msgSend(array, "count"))
  {
    v21 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(array, "count") + objc_msgSend(residentEnabledDevices, "count")}];
    v22 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(array, "count") + objc_msgSend(residentEnabledDevices, "count")}];
    if ([device isCurrentDevice])
    {
      [v21 addObjectsFromArray:residentEnabledDevices];
      [v21 addObjectsFromArray:array];
      v23 = v36;
    }

    else
    {
      v23 = v36;
      if (v36)
      {
        [v22 addObject:v36];
      }

      else
      {
        [v22 addObjectsFromArray:array];
      }

      if (device)
      {
        [v21 addObject:device];
      }

      else
      {
        [v21 addObjectsFromArray:array];
      }
    }

    [v22 minusSet:v21];
    v24 = objc_autoreleasePoolPush();
    v25 = selfCopy;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      *buf = 138543362;
      v43 = v27;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to initial home launch or change in primary resident.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v24);
    if ([v22 count])
    {
      allObjects = [v22 allObjects];
      [(HMDHome *)v25 _disableNotificationsForDevices:allObjects];
    }

    if ([v21 count])
    {
      allObjects2 = [v21 allObjects];
      [(HMDHome *)v25 _enableNotificationsForDevices:allObjects2];
    }
  }

  else
  {
    v31 = objc_autoreleasePoolPush();
    v32 = selfCopy;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543362;
      v43 = v34;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@There are no resident devices or remote gateways to register with", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v31);
    v23 = v36;
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)resubscribeForNotificationsOnResident:(id)resident
{
  residentCopy = resident;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_resubscribeForNotificationsOnResident___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = residentCopy;
  v6 = residentCopy;
  dispatch_async(workQueue, v7);
}

- (void)_disableNotificationsForDevices:(id)devices
{
  v93 = *MEMORY[0x277D85DE8];
  devicesCopy = devices;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if ([devicesCopy count])
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v90 = v9;
      v91 = 2112;
      v92 = devicesCopy;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Disabling Notifications on %@", buf, 0x16u);
    }

    v55 = devicesCopy;

    objc_autoreleasePoolPop(v6);
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    v80 = 0u;
    v81 = 0u;
    v82 = 0u;
    v83 = 0u;
    v57 = selfCopy;
    obj = [(HMDHome *)selfCopy accessories];
    v59 = [obj countByEnumeratingWithState:&v80 objects:v88 count:16];
    if (v59)
    {
      v58 = *v81;
      do
      {
        for (i = 0; i != v59; ++i)
        {
          if (*v81 != v58)
          {
            objc_enumerationMutation(obj);
          }

          v11 = *(*(&v80 + 1) + 8 * i);
          array = [MEMORY[0x277CBEB18] array];
          v13 = v11;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v14 = v13;
          }

          else
          {
            v14 = 0;
          }

          v15 = v14;

          if (v15)
          {
            v60 = v13;
            v61 = v15;
            v62 = i;
            v78 = 0u;
            v79 = 0u;
            v76 = 0u;
            v77 = 0u;
            services = [v15 services];
            v17 = [services countByEnumeratingWithState:&v76 objects:v87 count:16];
            if (v17)
            {
              v18 = v17;
              v19 = *v77;
              do
              {
                for (j = 0; j != v18; ++j)
                {
                  if (*v77 != v19)
                  {
                    objc_enumerationMutation(services);
                  }

                  v21 = *(*(&v76 + 1) + 8 * j);
                  v72 = 0u;
                  v73 = 0u;
                  v74 = 0u;
                  v75 = 0u;
                  characteristics = [v21 characteristics];
                  v23 = [characteristics countByEnumeratingWithState:&v72 objects:v86 count:16];
                  if (v23)
                  {
                    v24 = v23;
                    v25 = *v73;
                    do
                    {
                      for (k = 0; k != v24; ++k)
                      {
                        if (*v73 != v25)
                        {
                          objc_enumerationMutation(characteristics);
                        }

                        v27 = *(*(&v72 + 1) + 8 * k);
                        if ([v27 supportsNotification])
                        {
                          instanceID = [v27 instanceID];
                          [array addObject:instanceID];
                        }
                      }

                      v24 = [characteristics countByEnumeratingWithState:&v72 objects:v86 count:16];
                    }

                    while (v24);
                  }
                }

                v18 = [services countByEnumeratingWithState:&v76 objects:v87 count:16];
              }

              while (v18);
            }

            uuid = [v60 uuid];
            uUIDString = [uuid UUIDString];

            if ([array count])
            {
              v31 = [array copy];
              [dictionary setObject:v31 forKeyedSubscript:uUIDString];
            }

            v15 = v61;
            i = v62;
          }
        }

        v59 = [obj countByEnumeratingWithState:&v80 objects:v88 count:16];
      }

      while (v59);
    }

    array2 = [MEMORY[0x277CBEB18] array];
    v68 = 0u;
    v69 = 0u;
    v70 = 0u;
    v71 = 0u;
    actionSets = [(HMDHome *)v57 actionSets];
    v34 = [actionSets countByEnumeratingWithState:&v68 objects:v85 count:16];
    if (v34)
    {
      v35 = v34;
      v36 = *v69;
      do
      {
        for (m = 0; m != v35; ++m)
        {
          if (*v69 != v36)
          {
            objc_enumerationMutation(actionSets);
          }

          uuid2 = [*(*(&v68 + 1) + 8 * m) uuid];
          uUIDString2 = [uuid2 UUIDString];
          [array2 addObject:uUIDString2];
        }

        v35 = [actionSets countByEnumeratingWithState:&v68 objects:v85 count:16];
      }

      while (v35);
    }

    if ([dictionary count] || objc_msgSend(array2, "count"))
    {
      v66 = 0u;
      v67 = 0u;
      v64 = 0u;
      v65 = 0u;
      v40 = v55;
      v41 = [v40 countByEnumeratingWithState:&v64 objects:v84 count:16];
      if (v41)
      {
        v42 = v41;
        v43 = *v65;
        v44 = MEMORY[0x277CBEC10];
        do
        {
          for (n = 0; n != v42; ++n)
          {
            if (*v65 != v43)
            {
              objc_enumerationMutation(v40);
            }

            v46 = *(*(&v64 + 1) + 8 * n);
            v47 = [dictionary copy];
            v48 = [0 copy];
            v49 = [array2 copy];
            [(HMDHome *)v57 _modifyCharacteristicNotifications:v47 characteristicChangeThresholds:v44 mediaNotifications:v48 actionSetNotificationPayload:v49 enableNotification:0 withDevice:v46];
          }

          v42 = [v40 countByEnumeratingWithState:&v64 objects:v84 count:16];
        }

        while (v42);
      }
    }

    else
    {
      v51 = objc_autoreleasePoolPush();
      v52 = v57;
      v53 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
      {
        v54 = HMFGetLogIdentifier();
        *buf = 138543362;
        v90 = v54;
        _os_log_impl(&dword_229538000, v53, OS_LOG_TYPE_INFO, "%{public}@There are no characteristics requiring deregistration", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v51);
    }

    devicesCopy = v55;
  }

  v50 = *MEMORY[0x277D85DE8];
}

- (void)disableNotificationsForDevices:(id)devices
{
  devicesCopy = devices;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_disableNotificationsForDevices___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = devicesCopy;
  v6 = devicesCopy;
  dispatch_async(workQueue, v7);
}

- (void)_enableNotificationsForDevices:(id)devices
{
  v208 = *MEMORY[0x277D85DE8];
  devicesCopy = devices;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if ([devicesCopy count])
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v205 = v9;
      v206 = 2112;
      v207 = devicesCopy;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Enabling Notifications on %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    notificationRegistrations = [(HMDHome *)selfCopy notificationRegistrations];
    v145 = [notificationRegistrations count];

    primaryResident = [(HMDHome *)selfCopy primaryResident];
    device = [primaryResident device];

    v125 = devicesCopy;
    if ([(HMDHome *)selfCopy isCurrentDeviceAvailableResident]&& ![(HMDHome *)selfCopy isCurrentDevicePrimaryResident])
    {
      v192 = 0u;
      v193 = 0u;
      v190 = 0u;
      v191 = 0u;
      v12 = devicesCopy;
      v13 = [v12 countByEnumeratingWithState:&v190 objects:v203 count:16];
      if (v13)
      {
        v14 = v13;
        v15 = *v191;
        while (2)
        {
          for (i = 0; i != v14; ++i)
          {
            if (*v191 != v15)
            {
              objc_enumerationMutation(v12);
            }

            if ([*(*(&v190 + 1) + 8 * i) isEqual:device])
            {
              v151 = 1;
              goto LABEL_17;
            }
          }

          v14 = [v12 countByEnumeratingWithState:&v190 objects:v203 count:16];
          if (v14)
          {
            continue;
          }

          break;
        }
      }

      v151 = 0;
LABEL_17:
    }

    else
    {
      v151 = 0;
    }

    array = [MEMORY[0x277CBEB18] array];
    v186 = 0u;
    v187 = 0u;
    v188 = 0u;
    v189 = 0u;
    obj = [(HMDHome *)selfCopy triggers];
    v156 = selfCopy;
    v149 = [obj countByEnumeratingWithState:&v186 objects:v202 count:16];
    if (v149)
    {
      v146 = *v187;
      do
      {
        v17 = 0;
        do
        {
          if (*v187 != v146)
          {
            objc_enumerationMutation(obj);
          }

          v157 = v17;
          v18 = *(*(&v186 + 1) + 8 * v17);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v19 = v18;
          }

          else
          {
            v19 = 0;
          }

          v20 = v19;

          v184 = 0u;
          v185 = 0u;
          v182 = 0u;
          v183 = 0u;
          v153 = v20;
          characteristicEvents = [v20 characteristicEvents];
          v22 = [characteristicEvents countByEnumeratingWithState:&v182 objects:v201 count:16];
          if (v22)
          {
            v23 = v22;
            v24 = *v183;
            do
            {
              for (j = 0; j != v23; ++j)
              {
                if (*v183 != v24)
                {
                  objc_enumerationMutation(characteristicEvents);
                }

                v26 = *(*(&v182 + 1) + 8 * j);
                characteristic = [v26 characteristic];

                if (characteristic)
                {
                  characteristic2 = [v26 characteristic];
                  [array addObject:characteristic2];
                }

                else
                {
                  v29 = objc_autoreleasePoolPush();
                  v30 = selfCopy;
                  v31 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
                  {
                    v32 = HMFGetLogIdentifier();
                    *buf = 138543618;
                    v205 = v32;
                    v206 = 2112;
                    v207 = v26;
                    _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Characteristic of HMDCharacteristicEvent %@ is nil!", buf, 0x16u);
                  }

                  objc_autoreleasePoolPop(v29);
                  selfCopy = v156;
                }
              }

              v23 = [characteristicEvents countByEnumeratingWithState:&v182 objects:v201 count:16];
            }

            while (v23);
          }

          v17 = v157 + 1;
        }

        while (v157 + 1 != v149);
        v149 = [obj countByEnumeratingWithState:&v186 objects:v202 count:16];
      }

      while (v149);
    }

    dictionary = [MEMORY[0x277CBEB38] dictionary];
    dictionary2 = [MEMORY[0x277CBEB38] dictionary];
    v178 = 0u;
    v179 = 0u;
    v180 = 0u;
    v181 = 0u;
    accessories = [(HMDHome *)selfCopy accessories];
    v33 = [accessories countByEnumeratingWithState:&v178 objects:v200 count:16];
    if (v33)
    {
      v34 = v33;
      v35 = *v179;
      v138 = *MEMORY[0x277CFE810];
      v126 = *v179;
      do
      {
        v36 = 0;
        v127 = v34;
        do
        {
          if (*v179 != v35)
          {
            objc_enumerationMutation(accessories);
          }

          v37 = *(*(&v178 + 1) + 8 * v36);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v38 = v37;
          }

          else
          {
            v38 = 0;
          }

          v39 = v38;

          if (v39)
          {
            if (shouldSkipRemoteAccessoryNotificationRegistration(selfCopy))
            {
              v40 = v39;
              v41 = objc_autoreleasePoolPush();
              v42 = selfCopy;
              v43 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
              {
                v44 = HMFGetLogIdentifier();
                *buf = 138543618;
                v205 = v44;
                v206 = 2112;
                v207 = v40;
                _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@Dropping all characteristics for %@ from remote notification as partitioned network is no longer supported by residents", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v41);
              v39 = v40;
              goto LABEL_106;
            }

            v129 = v37;
            v131 = v36;
            array2 = [MEMORY[0x277CBEB18] array];
            obja = [MEMORY[0x277CBEB38] dictionary];
            v174 = 0u;
            v175 = 0u;
            v176 = 0u;
            v177 = 0u;
            v130 = v39;
            services = [v39 services];
            v136 = [services countByEnumeratingWithState:&v174 objects:v199 count:16];
            if (!v136)
            {
              goto LABEL_101;
            }

            v135 = *v175;
            while (1)
            {
              v45 = 0;
              do
              {
                if (*v175 != v135)
                {
                  objc_enumerationMutation(services);
                }

                v137 = v45;
                v46 = *(*(&v174 + 1) + 8 * v45);
                v170 = 0u;
                v171 = 0u;
                v172 = 0u;
                v173 = 0u;
                characteristics = [v46 characteristics];
                v47 = [characteristics countByEnumeratingWithState:&v170 objects:v198 count:16];
                if (v47)
                {
                  v48 = v47;
                  v160 = *v171;
                  v154 = v46;
                  do
                  {
                    v49 = 0;
                    do
                    {
                      if (*v171 != v160)
                      {
                        objc_enumerationMutation(characteristics);
                      }

                      v50 = *(*(&v170 + 1) + 8 * v49);
                      if ([v50 supportsNotification])
                      {
                        dataSource = [(HMDHome *)selfCopy dataSource];
                        hapMetadata = [dataSource hapMetadata];
                        type = [v50 type];
                        type2 = [v46 type];
                        v55 = [hapMetadata shouldFilterEnableNotificationsForCharacteristicType:type serviceType:type2];

                        if ((v55 & 1) == 0)
                        {
                          type3 = [v50 type];
                          type4 = [v46 type];
                          notificationRegistry = [(HMDHome *)selfCopy notificationRegistry];
                          v197 = v50;
                          v59 = [MEMORY[0x277CBEA60] arrayWithObjects:&v197 count:1];
                          v60 = [notificationRegistry destinationsRegisteredForNotificationsForCharacteristics:v59 applyChangeThresholding:0];
                          v61 = [v60 mutableCopy];

                          remoteDestinationString = [device remoteDestinationString];
                          if (remoteDestinationString)
                          {
                            [v61 removeObject:remoteDestinationString];
                          }

                          v63 = [v61 count];
                          v64 = v63 != 0;
                          if ([array containsObject:v50] & 1) != 0 || (objc_msgSend(v50, "isNonHomeNotificationsEnabled"))
                          {
                            goto LABEL_73;
                          }

                          dataSource2 = [(HMDHome *)v156 dataSource];
                          hapMetadata2 = [dataSource2 hapMetadata];
                          v67 = type3;
                          v68 = hapMetadata2;
                          v147 = v67;
                          if ([hapMetadata2 requiresDeviceUnlock:? forService:?])
                          {
                            goto LABEL_72;
                          }

                          v141 = v68;
                          v142 = dataSource2;
                          dataSource3 = [(HMDHome *)v156 dataSource];
                          hapMetadata3 = [dataSource3 hapMetadata];
                          if ([hapMetadata3 shouldAutoEnableNotificationForCharacteristic:v147 ofService:?])
                          {

                            v68 = v141;
                            dataSource2 = v142;
LABEL_72:

                            type3 = v147;
LABEL_73:
                            if (v151 && [v50 isNotificationEnabledForClientIdentifierPrefix:@"com.apple.HomeKitDaemon.Local"])
                            {
                              v71 = objc_autoreleasePoolPush();
                              v72 = v156;
                              v73 = HMFGetOSLogHandle();
                              if (os_log_type_enabled(v73, OS_LOG_TYPE_INFO))
                              {
                                HMFGetLogIdentifier();
                                v74 = v148 = v71;
                                *buf = 138543618;
                                v205 = v74;
                                v206 = 2112;
                                v207 = v50;
                                _os_log_impl(&dword_229538000, v73, OS_LOG_TYPE_INFO, "%{public}@Dropping characteristic for remote notifications from primary resident because it should be local only: %@", buf, 0x16u);

                                v71 = v148;
                              }

                              objc_autoreleasePoolPop(v71);
                            }

                            else
                            {
                              instanceID = [v50 instanceID];
                              [array2 addObject:instanceID];

                              changeThresholdForEnabledNotifications = [v50 changeThresholdForEnabledNotifications];
                              if (changeThresholdForEnabledNotifications && !v145)
                              {
                                instanceID2 = [v50 instanceID];
                                stringValue = [instanceID2 stringValue];
                                [obja setObject:changeThresholdForEnabledNotifications forKeyedSubscript:stringValue];
                              }
                            }

LABEL_82:

                            selfCopy = v156;
                            v46 = v154;
                            goto LABEL_83;
                          }

                          v139 = hapMetadata3;
                          v140 = dataSource3;
                          if ([v147 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"])
                          {
                            v79 = [type4 isEqualToString:v138];
                            if (v63)
                            {
                              v64 = 1;
                            }

                            else
                            {
                              v64 = v79;
                            }

                            if (v79 & 1 | (v145 == 0))
                            {
LABEL_96:

                              type3 = v147;
                              if (v64)
                              {
                                goto LABEL_73;
                              }

                              goto LABEL_82;
                            }
                          }

                          else if (!v145)
                          {
                            goto LABEL_96;
                          }

                          dataSource4 = [(HMDHome *)v156 dataSource];
                          hapMetadata4 = [dataSource4 hapMetadata];
                          v82 = [hapMetadata4 shouldEnableHomeNotificationForCharacteristicType:v147 serviceType:type4];
                          if (v63)
                          {
                            v64 = 1;
                          }

                          else
                          {
                            v64 = v82;
                          }

                          goto LABEL_96;
                        }
                      }

LABEL_83:
                      ++v49;
                    }

                    while (v48 != v49);
                    v83 = [characteristics countByEnumeratingWithState:&v170 objects:v198 count:16];
                    v48 = v83;
                  }

                  while (v83);
                }

                v45 = v137 + 1;
              }

              while (v137 + 1 != v136);
              v136 = [services countByEnumeratingWithState:&v174 objects:v199 count:16];
              if (!v136)
              {
LABEL_101:

                uuid = [v129 uuid];
                uUIDString = [uuid UUIDString];

                if ([array2 count])
                {
                  v86 = [array2 copy];
                  [dictionary setObject:v86 forKeyedSubscript:uUIDString];
                }

                v87 = obja;
                v35 = v126;
                v34 = v127;
                v36 = v131;
                if ([obja count])
                {
                  v88 = [obja copy];
                  [dictionary2 setObject:v88 forKeyedSubscript:uUIDString];

                  v87 = obja;
                }

                v39 = v130;
                break;
              }
            }
          }

LABEL_106:

          ++v36;
        }

        while (v36 != v34);
        v34 = [accessories countByEnumeratingWithState:&v178 objects:v200 count:16];
      }

      while (v34);
    }

    array3 = [MEMORY[0x277CBEB18] array];
    [dictionary count];
    v166 = 0u;
    v167 = 0u;
    v168 = 0u;
    v169 = 0u;
    actionSets = [(HMDHome *)selfCopy actionSets];
    v89 = [actionSets countByEnumeratingWithState:&v166 objects:v196 count:16];
    if (v89)
    {
      v90 = v89;
      v91 = *v167;
      do
      {
        for (k = 0; k != v90; ++k)
        {
          if (*v167 != v91)
          {
            objc_enumerationMutation(actionSets);
          }

          v93 = *(*(&v166 + 1) + 8 * k);
          notificationRegistry2 = [(HMDHome *)selfCopy notificationRegistry];
          v95 = [HMDActionSetResponse alloc];
          uuid2 = [v93 uuid];
          v97 = [(HMDActionSetResponse *)v95 initWithActionSetUUID:uuid2 state:0];
          v195 = v97;
          v98 = [MEMORY[0x277CBEA60] arrayWithObjects:&v195 count:1];
          v99 = [notificationRegistry2 destinationsRegisteredForNotificationsForActionSetResponses:v98];
          v100 = [v99 mutableCopy];

          remoteDestinationString2 = [device remoteDestinationString];
          if (remoteDestinationString2)
          {
            [v100 removeObject:remoteDestinationString2];
          }

          if ([v100 count] || (-[HMDHome actionSetStateSubscriptionManager](v156, "actionSetStateSubscriptionManager"), v102 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v93, "uuid"), v103 = objc_claimAutoreleasedReturnValue(), v104 = objc_msgSend(v102, "isMonitoringActionSet:", v103), v103, v102, v104))
          {
            if (v151)
            {
              v105 = objc_autoreleasePoolPush();
              v106 = v156;
              v107 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v107, OS_LOG_TYPE_INFO))
              {
                v108 = HMFGetLogIdentifier();
                *buf = 138543618;
                v205 = v108;
                v206 = 2112;
                v207 = v93;
                _os_log_impl(&dword_229538000, v107, OS_LOG_TYPE_INFO, "%{public}@Dropping action set for remote notifications from primary resident because it should be local only: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v105);
            }

            else
            {
              uuid3 = [v93 uuid];
              uUIDString2 = [uuid3 UUIDString];
              [array3 addObject:uUIDString2];
            }
          }

          selfCopy = v156;
        }

        v90 = [actionSets countByEnumeratingWithState:&v166 objects:v196 count:16];
      }

      while (v90);
    }

    if ([dictionary count] || objc_msgSend(array3, "count"))
    {
      v164 = 0u;
      v165 = 0u;
      v162 = 0u;
      v163 = 0u;
      v111 = v125;
      v112 = [v111 countByEnumeratingWithState:&v162 objects:v194 count:16];
      if (v112)
      {
        v113 = v112;
        v114 = *v163;
        do
        {
          for (m = 0; m != v113; ++m)
          {
            if (*v163 != v114)
            {
              objc_enumerationMutation(v111);
            }

            v116 = *(*(&v162 + 1) + 8 * m);
            v117 = [dictionary copy];
            v118 = [0 copy];
            v119 = [array3 copy];
            [(HMDHome *)selfCopy _modifyCharacteristicNotifications:v117 characteristicChangeThresholds:dictionary2 mediaNotifications:v118 actionSetNotificationPayload:v119 enableNotification:1 withDevice:v116];
          }

          v113 = [v111 countByEnumeratingWithState:&v162 objects:v194 count:16];
        }

        while (v113);
      }
    }

    else
    {
      v121 = objc_autoreleasePoolPush();
      v122 = selfCopy;
      v123 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v123, OS_LOG_TYPE_INFO))
      {
        v124 = HMFGetLogIdentifier();
        *buf = 138543362;
        v205 = v124;
        _os_log_impl(&dword_229538000, v123, OS_LOG_TYPE_INFO, "%{public}@There are no characteristics/media properties requiring registration", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v121);
    }

    devicesCopy = v125;
  }

  v120 = *MEMORY[0x277D85DE8];
}

- (void)enableNotificationsForDevices:(id)devices
{
  devicesCopy = devices;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome_enableNotificationsForDevices___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = devicesCopy;
  v6 = devicesCopy;
  dispatch_async(workQueue, v7);
}

- (void)_subscribeForHomeNotificationsFromRemoteGateway:(BOOL)gateway accessories:(id)accessories
{
  gatewayCopy = gateway;
  v58 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v48 = 0;
  v49 = 0;
  v46 = 0;
  v47 = 0;
  v45 = 0;
  [(HMDHome *)self _notificationPayloadsForRemoteGateway:gatewayCopy accessories:accessoriesCopy enableCharacteristicNotificationPayload:&v49 characteristicNotificationThresholdsPayload:&v48 disableCharacteristicNotificationPayload:&v47 enableMediaNotificationPayload:&v46 disableMediaNotificationPayload:&v45];
  v8 = v49;
  v9 = v48;
  v10 = v47;
  v11 = v46;
  v12 = v45;
  if ([v10 count] || objc_msgSend(v8, "count") || objc_msgSend(v12, "count") || objc_msgSend(v11, "count"))
  {
    if ([v8 count] || objc_msgSend(v11, "count"))
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v38 = v13;
        v17 = v16 = v11;
        HMFBooleanToString();
        v18 = v39 = v12;
        [v8 shortDescription];
        v40 = v8;
        v42 = v10;
        v20 = v19 = accessoriesCopy;
        [v16 shortDescription];
        v22 = v21 = v9;
        *buf = 138544130;
        v51 = v17;
        v52 = 2112;
        v53 = v18;
        v54 = 2112;
        v55 = v20;
        v56 = 2112;
        v57 = v22;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Registering notifications with remote gateway when notificationEnabled: %@, characteristics: %@, properties: %@", buf, 0x2Au);

        v9 = v21;
        accessoriesCopy = v19;
        v8 = v40;
        v10 = v42;

        v12 = v39;
        v11 = v16;
        v13 = v38;
      }

      objc_autoreleasePoolPop(v13);
      [(HMDHome *)selfCopy _modifyCharacteristicNotificationsOnResident:v8 characteristicChangeThresholds:v9 mediaNotifications:v11 actionSetNotificationPayload:MEMORY[0x277CBEBF8] matterAttributeNotifications:0 enableNotification:1];
    }

    if ([v10 count] || objc_msgSend(v12, "count"))
    {
      v23 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v26 = v43 = v11;
        HMFBooleanToString();
        v27 = v44 = accessoriesCopy;
        [v10 shortDescription];
        v28 = v41 = v9;
        [v12 shortDescription];
        v30 = v29 = v12;
        *buf = 138544130;
        v51 = v26;
        v52 = 2112;
        v53 = v27;
        v54 = 2112;
        v55 = v28;
        v56 = 2112;
        v57 = v30;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@De-registering notifications with remote gateway when notificationEnabled: %@, characteristics: %@, properties: %@", buf, 0x2Au);

        v12 = v29;
        v9 = v41;

        accessoriesCopy = v44;
        v11 = v43;
      }

      objc_autoreleasePoolPop(v23);
      [(HMDHome *)selfCopy2 _modifyCharacteristicNotificationsOnResident:v10 characteristicChangeThresholds:0 mediaNotifications:v12 actionSetNotificationPayload:MEMORY[0x277CBEBF8] matterAttributeNotifications:0 enableNotification:0];
    }
  }

  else
  {
    v32 = v12;
    v33 = v11;
    v34 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v36 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
    {
      v37 = HMFGetLogIdentifier();
      *buf = 138543362;
      v51 = v37;
      _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_INFO, "%{public}@Not registering notifications with remote gateway since we have no modifications", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v34);
    v11 = v33;
    v12 = v32;
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)subscribeForNotificationsFromRemoteGateway
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __53__HMDHome_subscribeForNotificationsFromRemoteGateway__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)_remotelySetNotificationsEnabled:(BOOL)enabled forMatterAttributes:(id)attributes
{
  enabledCopy = enabled;
  v24 = *MEMORY[0x277D85DE8];
  attributesCopy = attributes;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543874;
    v19 = v11;
    v20 = 1024;
    v21 = enabledCopy;
    v22 = 2112;
    v23 = attributesCopy;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Setting remote notifications enabled=%{BOOL}d and adding matter attributes to registration payload. Attributes=%@", buf, 0x1Cu);
  }

  objc_autoreleasePoolPop(v8);
  if (enabledCopy)
  {
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __64__HMDHome__remotelySetNotificationsEnabled_forMatterAttributes___block_invoke;
    v17[3] = &unk_278685C40;
    v17[4] = selfCopy;
    [attributesCopy na_each:v17];
    [(HMDHome *)selfCopy _createModifyNotificationsCoalesceTimerIfNeeded];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = selfCopy;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v19 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Currently unsubscribing from Matter attributes is not supported. rdar://121935520 (Provide API for unsubscribing to attribute notifications)", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __64__HMDHome__remotelySetNotificationsEnabled_forMatterAttributes___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v18 = [v3 hmf_numberForKey:@"HMDHomeCHIPNodeIDMessageKey"];
  v4 = [v3 hmf_numberForKey:@"HMDHomeCHIPEndpointIDMessageKey"];
  v5 = [v3 hmf_numberForKey:@"HMDHomeCHIPClusterIDMessageKey"];
  v6 = [v3 hmf_numberForKey:@"HMDHomeCHIPAttributeIDMessageKey"];

  v7 = [*(a1 + 32) matterAttributesEnableNotificationPayload];
  v8 = [v7 objectForKeyedSubscript:v18];

  if (!v8)
  {
    v8 = [MEMORY[0x277CBEB38] dictionary];
    v9 = [*(a1 + 32) matterAttributesEnableNotificationPayload];
    [v9 setObject:v8 forKeyedSubscript:v18];

    v10 = [MEMORY[0x277CBEB38] dictionary];
    [v8 setObject:v10 forKeyedSubscript:@"HMDHomeCHIPEndpointsMessageKey"];

    [v8 setObject:MEMORY[0x277CBEC28] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
  }

  if (([v8 hmf_BOOLForKey:@"HMDHomeCHIPWildcardMessageKey"] & 1) == 0)
  {
    if (v4)
    {
      v11 = [v8 objectForKeyedSubscript:@"HMDHomeCHIPEndpointsMessageKey"];
      v12 = [v11 objectForKeyedSubscript:v4];
      if (!v12)
      {
        v12 = [MEMORY[0x277CBEB38] dictionary];
        [v11 setObject:v12 forKeyedSubscript:v4];
        v13 = [MEMORY[0x277CBEB38] dictionary];
        [v12 setObject:v13 forKeyedSubscript:@"HMDHomeCHIPClustersMessageKey"];

        [v12 setObject:MEMORY[0x277CBEC28] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
      }

      if (([v12 hmf_BOOLForKey:@"HMDHomeCHIPWildcardMessageKey"] & 1) == 0)
      {
        if (v5)
        {
          v14 = [v12 objectForKeyedSubscript:@"HMDHomeCHIPClustersMessageKey"];
          v15 = [v14 objectForKeyedSubscript:v5];
          if (!v15)
          {
            v15 = [MEMORY[0x277CBEB38] dictionary];
            [v14 setObject:v15 forKeyedSubscript:v5];
            v16 = [MEMORY[0x277CBEB18] array];
            [v15 setObject:v16 forKeyedSubscript:@"HMDHomeCHIPAttributesMessageKey"];

            [v15 setObject:MEMORY[0x277CBEC28] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
          }

          if (([v15 hmf_BOOLForKey:@"HMDHomeCHIPWildcardMessageKey"] & 1) == 0)
          {
            if (v6)
            {
              v17 = [v15 objectForKeyedSubscript:@"HMDHomeCHIPAttributesMessageKey"];
              if (([v17 containsObject:v6] & 1) == 0)
              {
                [v17 addObject:v6];
              }
            }

            else
            {
              [v15 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
              [v15 setObject:MEMORY[0x277CBEBF8] forKeyedSubscript:@"HMDHomeCHIPAttributesMessageKey"];
            }
          }
        }

        else
        {
          [v12 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
          [v12 setObject:MEMORY[0x277CBEC10] forKeyedSubscript:@"HMDHomeCHIPClustersMessageKey"];
        }
      }
    }

    else
    {
      [v8 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
      [v8 setObject:MEMORY[0x277CBEC10] forKeyedSubscript:@"HMDHomeCHIPEndpointsMessageKey"];
    }
  }
}

- (void)remotelySetNotificationsEnabled:(BOOL)enabled forMatterAttributes:(id)attributes
{
  attributesCopy = attributes;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __63__HMDHome_remotelySetNotificationsEnabled_forMatterAttributes___block_invoke;
  block[3] = &unk_278688BD0;
  enabledCopy = enabled;
  block[4] = self;
  v10 = attributesCopy;
  v8 = attributesCopy;
  dispatch_async(workQueue, block);
}

- (void)_createModifyNotificationsCoalesceTimerIfNeeded
{
  v19 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  modifyNotificationsCoalesceTimer = [(HMDHome *)self modifyNotificationsCoalesceTimer];

  if (!modifyNotificationsCoalesceTimer)
  {
    v5 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:0 options:0.5];
    [(HMDHome *)self setModifyNotificationsCoalesceTimer:v5];

    workQueue2 = [(HMDHome *)self workQueue];
    modifyNotificationsCoalesceTimer2 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [modifyNotificationsCoalesceTimer2 setDelegateQueue:workQueue2];

    modifyNotificationsCoalesceTimer3 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [modifyNotificationsCoalesceTimer3 setDelegate:self];

    modifyNotificationsCoalesceTimer4 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [modifyNotificationsCoalesceTimer4 resume];

    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = selfCopy;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@%@ Kicked off the modify notifications on resident request timer", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_remotelySetNotificationsEnabled:(BOOL)enabled forCharacteristics:(id)characteristics characteristicChangeThresholds:(id)thresholds
{
  enabledCopy = enabled;
  v66 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  thresholdsCopy = thresholds;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v53 = enabledCopy;
  if (enabledCopy)
  {
    enableNotificationPayload = [(HMDHome *)self enableNotificationPayload];
    [(HMDHome *)self disableNotificationPayload];
  }

  else
  {
    enableNotificationPayload = [(HMDHome *)self disableNotificationPayload];
    [(HMDHome *)self enableNotificationPayload];
  }
  v49 = ;
  v57 = 0u;
  v58 = 0u;
  v55 = 0u;
  v56 = 0u;
  obj = characteristicsCopy;
  v52 = [obj countByEnumeratingWithState:&v55 objects:v65 count:16];
  if (v52)
  {
    v51 = *v56;
    *&v10 = 138543874;
    v45 = v10;
    selfCopy = self;
    do
    {
      for (i = 0; i != v52; ++i)
      {
        if (*v56 != v51)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v55 + 1) + 8 * i);
        accessory = [v12 accessory];
        uuid = [accessory uuid];
        uUIDString = [uuid UUIDString];

        if (uUIDString)
        {
          array = [enableNotificationPayload objectForKeyedSubscript:uUIDString];
          if (!array)
          {
            array = [MEMORY[0x277CBEB18] array];
            [enableNotificationPayload setObject:array forKeyedSubscript:uUIDString];
          }

          instanceID = [v12 instanceID];
          v18 = [array containsObject:instanceID];

          if ((v18 & 1) == 0)
          {
            instanceID2 = [v12 instanceID];
            [array addObject:instanceID2];
          }

          v20 = [v49 objectForKeyedSubscript:uUIDString];

          instanceID3 = [v12 instanceID];
          v22 = [v20 containsObject:instanceID3];

          if (v22)
          {
            instanceID4 = [v12 instanceID];
            [v20 removeObject:instanceID4];

            v24 = objc_autoreleasePoolPush();
            selfCopy2 = self;
            v26 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
            {
              v27 = HMFGetLogIdentifier();
              v28 = HMFBooleanToString();
              *buf = v45;
              v60 = v27;
              v61 = 2112;
              v62 = v28;
              v63 = 2112;
              v64 = v12;
              _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Function call to set notification to %@, removing the entry %@ from the other payload", buf, 0x20u);

              self = selfCopy;
            }

            objc_autoreleasePoolPop(v24);
            if (![v20 count])
            {
              [v49 removeObjectForKey:uUIDString];
            }
          }

          v54[0] = MEMORY[0x277D85DD0];
          v54[1] = 3221225472;
          v54[2] = __94__HMDHome__remotelySetNotificationsEnabled_forCharacteristics_characteristicChangeThresholds___block_invoke;
          v54[3] = &unk_278676278;
          v54[4] = v12;
          v29 = [thresholdsCopy na_firstObjectPassingTest:v54];
          threshold = [v29 threshold];

          if (v53 && threshold)
          {
            pendingCharacteristicThresholdPayload = [(HMDHome *)self pendingCharacteristicThresholdPayload];
            dictionary = [pendingCharacteristicThresholdPayload objectForKeyedSubscript:uUIDString];

            if (!dictionary)
            {
              dictionary = [MEMORY[0x277CBEB38] dictionary];
              pendingCharacteristicThresholdPayload2 = [(HMDHome *)self pendingCharacteristicThresholdPayload];
              [pendingCharacteristicThresholdPayload2 setObject:dictionary forKeyedSubscript:uUIDString];
            }

            instanceID5 = [v12 instanceID];
            stringValue = [instanceID5 stringValue];
            [dictionary setObject:threshold forKeyedSubscript:stringValue];
          }

          if (!v53)
          {
            pendingCharacteristicThresholdPayload3 = [(HMDHome *)self pendingCharacteristicThresholdPayload];
            v37 = [pendingCharacteristicThresholdPayload3 objectForKeyedSubscript:uUIDString];
            instanceID6 = [v12 instanceID];
            stringValue2 = [instanceID6 stringValue];
            [v37 setObject:0 forKeyedSubscript:stringValue2];

            self = selfCopy;
            pendingCharacteristicThresholdPayload4 = [(HMDHome *)selfCopy pendingCharacteristicThresholdPayload];
            v41 = [pendingCharacteristicThresholdPayload4 objectForKeyedSubscript:uUIDString];
            v42 = [v41 count];

            if (!v42)
            {
              pendingCharacteristicThresholdPayload5 = [(HMDHome *)selfCopy pendingCharacteristicThresholdPayload];
              [pendingCharacteristicThresholdPayload5 setObject:0 forKeyedSubscript:uUIDString];
            }
          }
        }
      }

      v52 = [obj countByEnumeratingWithState:&v55 objects:v65 count:16];
    }

    while (v52);
  }

  if ([enableNotificationPayload count] || objc_msgSend(v49, "count"))
  {
    [(HMDHome *)self _createModifyNotificationsCoalesceTimerIfNeeded];
  }

  v44 = *MEMORY[0x277D85DE8];
}

BOOL __94__HMDHome__remotelySetNotificationsEnabled_forCharacteristics_characteristicChangeThresholds___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 characteristic];
  v4 = v3 == *(a1 + 32);

  return v4;
}

- (void)remotelySetNotificationsEnabled:(BOOL)enabled forCharacteristics:(id)characteristics characteristicChangeThresholds:(id)thresholds
{
  characteristicsCopy = characteristics;
  thresholdsCopy = thresholds;
  workQueue = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __93__HMDHome_remotelySetNotificationsEnabled_forCharacteristics_characteristicChangeThresholds___block_invoke;
  v13[3] = &unk_278685AA8;
  enabledCopy = enabled;
  v13[4] = self;
  v14 = characteristicsCopy;
  v15 = thresholdsCopy;
  v11 = thresholdsCopy;
  v12 = characteristicsCopy;
  dispatch_async(workQueue, v13);
}

- (void)redispatchToResidentMessage:(id)message target:(id)target responseQueue:(id)queue viaDevice:(id)device
{
  v95 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  targetCopy = target;
  queueCopy = queue;
  deviceCopy = device;
  if (targetCopy)
  {
    v13 = messageCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v15)
    {
      v16 = v13;
    }

    else
    {
      v16 = [v13 mutableCopy];
    }

    v17 = v16;

    responseHandler = [(HMDAssertionLogEvent *)v17 responseHandler];
    if (responseHandler)
    {
      v86[0] = MEMORY[0x277D85DD0];
      v86[1] = 3221225472;
      v86[2] = __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke;
      v86[3] = &unk_278685AF8;
      v87 = queueCopy;
      v88 = responseHandler;
      [(HMDAssertionLogEvent *)v17 setResponseHandler:v86];
    }

    name = [(HMDAssertionLogEvent *)v17 name];
    v20 = [name isEqualToString:@"kMultipleCharacteristicWriteRequestKey"];

    if (!isiOSDevice())
    {
      goto LABEL_15;
    }

    if (redispatchToResidentMessage_target_responseQueue_viaDevice__pred != -1)
    {
      dispatch_once(&redispatchToResidentMessage_target_responseQueue_viaDevice__pred, &__block_literal_global_949);
    }

    v21 = redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages;
    name2 = [(HMDAssertionLogEvent *)v17 name];
    LODWORD(v21) = [v21 containsObject:name2];

    if (!v21)
    {
      goto LABEL_15;
    }

    currentUser = [(HMDHome *)self currentUser];
    isRemoteAccessAllowed = [currentUser isRemoteAccessAllowed];

    if ((isRemoteAccessAllowed & 1) == 0)
    {
      v82 = responseHandler;
      v65 = objc_autoreleasePoolPush();
      selfCopy = self;
      v67 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v67, OS_LOG_TYPE_INFO))
      {
        v68 = HMFGetLogIdentifier();
        [(HMDHome *)selfCopy currentUser];
        v69 = v84 = v65;
        [v69 displayName];
        v70 = v80 = targetCopy;
        *buf = 138543618;
        v90 = v68;
        v91 = 2112;
        v92 = v70;
        _os_log_impl(&dword_229538000, v67, OS_LOG_TYPE_INFO, "%{public}@Remote access is disabled for the user %@, restricting to local transports...", buf, 0x16u);

        v65 = v84;
        targetCopy = v80;
      }

      objc_autoreleasePoolPop(v65);
      v25 = 1;
      responseHandler = v82;
    }

    else
    {
LABEL_15:
      v25 = 0;
    }

    messagePayload = [(HMDAssertionLogEvent *)v17 messagePayload];
    v27 = [messagePayload mutableCopy];

    if (v25)
    {
      [(HMDAssertionLogEvent *)v17 setRemoteDisallowsIDSRacing:1];
    }

    currentActivity = [MEMORY[0x277D0F770] currentActivity];
    v29 = currentActivity;
    v83 = v27;
    if (deviceCopy)
    {
      [(HMDAssertionLogEvent *)v17 setSecureRemote:1];
      v30 = [[HMDRemoteDeviceMessageDestination alloc] initWithTarget:targetCopy device:deviceCopy];
      [(HMDAssertionLogEvent *)v17 setDestination:v30];

      [v27 setObject:0 forKeyedSubscript:@"kIDSMessageSourceIDKey"];
      [(HMDAssertionLogEvent *)v17 setMessagePayload:v27];
      v31 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v78 = queueCopy;
        v81 = responseHandler;
        v35 = v34 = targetCopy;
        shortDescription = [(HMDAssertionLogEvent *)v17 shortDescription];
        [deviceCopy shortDescription];
        v38 = v37 = v29;
        *buf = 138543874;
        v90 = v35;
        v91 = 2112;
        v92 = shortDescription;
        v93 = 2112;
        v94 = v38;
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to device: %@", buf, 0x20u);

        v29 = v37;
        targetCopy = v34;
        queueCopy = v78;
        responseHandler = v81;
      }

      objc_autoreleasePoolPop(v31);
      [(HMDAssertionLogEvent *)v17 name];

      [(HMDAssertionLogEvent *)v17 identifier];
      [deviceCopy identifier];

      v39 = +[HMDSecureRemoteMessageTransport defaultTransport];
      v40 = [(HMDAssertionLogEvent *)v17 copy];
      [v39 sendMessage:v40 completionHandler:0];
    }

    else
    {
      v77 = currentActivity;
      v79 = targetCopy;
      v41 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v43 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
      {
        v44 = HMFGetLogIdentifier();
        shortDescription2 = [(HMDAssertionLogEvent *)v17 shortDescription];
        *buf = 138543618;
        v90 = v44;
        v91 = 2112;
        v92 = shortDescription2;
        _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to resident", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v41);
      homeManager = [(HMDHome *)selfCopy3 homeManager];
      messageDispatcher = [homeManager messageDispatcher];
      v39 = [messageDispatcher residentCommunicationHandlerForHome:selfCopy3];

      preferredDevice = [v39 preferredDevice];
      if (preferredDevice)
      {
        v40 = preferredDevice;
        if (v20)
        {
          [v83 setObject:0 forKeyedSubscript:@"kMultiPartResponseKey"];
        }

        [(HMDAssertionLogEvent *)v17 setMessagePayload:v83];
        v49 = objc_autoreleasePoolPush();
        v50 = selfCopy3;
        v51 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v52 = v76 = v49;
          [(HMDAssertionLogEvent *)v17 shortDescription];
          v54 = v53 = queueCopy;
          shortDescription3 = [v40 shortDescription];
          *buf = 138543874;
          v90 = v52;
          v91 = 2112;
          v92 = v54;
          v93 = 2112;
          v94 = shortDescription3;
          _os_log_impl(&dword_229538000, v51, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to remote device: %@", buf, 0x20u);

          queueCopy = v53;
          deviceCopy = 0;

          v49 = v76;
        }

        objc_autoreleasePoolPop(v49);
        targetCopy = v79;
        [v39 redispatchMessage:v17 target:v79 responseQueue:queueCopy];
      }

      else
      {
        v56 = objc_autoreleasePoolPush();
        v57 = selfCopy3;
        v58 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
        {
          v59 = HMFGetLogIdentifier();
          [(HMDAssertionLogEvent *)v17 shortDescription];
          v61 = v60 = queueCopy;
          shortDescription4 = [(HMDHome *)v57 shortDescription];
          *buf = 138543874;
          v90 = v59;
          v91 = 2112;
          v92 = v61;
          v93 = 2112;
          v94 = shortDescription4;
          _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_INFO, "%{public}@Cannot redispatch message %@ because there is no resident configured for home: %@", buf, 0x20u);

          queueCopy = v60;
          deviceCopy = 0;
        }

        objc_autoreleasePoolPop(v56);
        [(HMDHome *)v57 uuid];

        v63 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
        [(HMDAssertionLogEvent *)v17 respondWithError:v63];

        v40 = 0;
        targetCopy = v79;
      }

      v29 = v77;
    }
  }

  else
  {
    v71 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v73 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v73, OS_LOG_TYPE_FAULT))
    {
      HMFGetLogIdentifier();
      v75 = v74 = queueCopy;
      *buf = 138543362;
      v90 = v75;
      _os_log_impl(&dword_229538000, v73, OS_LOG_TYPE_FAULT, "%{public}@Submitting ABC event for failure: TargetUUID cannot be nil", buf, 0xCu);

      queueCopy = v74;
    }

    objc_autoreleasePoolPop(v71);
    v17 = [[HMDAssertionLogEvent alloc] initWithReason:@"TargetUUID cannot be nil"];
    responseHandler = +[HMDMetricsManager sharedLogEventSubmitter];
    [responseHandler submitLogEvent:v17];
  }

  v64 = *MEMORY[0x277D85DE8];
}

void __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke_2;
  block[3] = &unk_278689F98;
  v7 = *(a1 + 32);
  v8 = *(a1 + 40);
  v13 = v6;
  v14 = v8;
  v12 = v5;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);
}

void __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke_3()
{
  v3[8] = *MEMORY[0x277D85DE8];
  v3[0] = @"kCharacteristicWriteRequestKey";
  v3[1] = @"kCharacteristicReadRequestKey";
  v3[2] = @"kMultipleCharacteristicWriteRequestKey";
  v3[3] = @"kMultipleCharacteristicReadRequestKey";
  v3[4] = @"kIdentifyAccessoryRequestKey";
  v3[5] = @"kMediaPropertiesWriteRequestKey";
  v3[6] = @"kMediaPropertiesReadRequestKey";
  v3[7] = @"HMDHomeSetNaturalLightingEnabledForLightProfilesMessage";
  v0 = [MEMORY[0x277CBEA60] arrayWithObjects:v3 count:8];
  v1 = redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages;
  redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages = v0;

  v2 = *MEMORY[0x277D85DE8];
}

- (void)addCompanionAsResidentUser:(id)user
{
  userCopy = user;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __38__HMDHome_addCompanionAsResidentUser___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = userCopy;
  v6 = userCopy;
  dispatch_async(workQueue, v7);
}

void __38__HMDHome_addCompanionAsResidentUser___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) users];
  v3 = [*(a1 + 40) userID];
  v4 = [v2 hmf_firstObjectWithValue:v3 forKeyPath:@"userID"];

  if (!v4)
  {
    [*(a1 + 32) _addUserToContainer:*(a1 + 40)];
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Added a new resident user", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  [(HMDHome *)*(a1 + 32) _subscribeForNotificationFromRemoteGateway:?];

  v9 = *MEMORY[0x277D85DE8];
}

- (id)_characteristicNotificationPayloadsOnDirectTransports:(BOOL)transports
{
  transportsCopy = transports;
  v103 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v93 = 0u;
  v94 = 0u;
  v95 = 0u;
  v96 = 0u;
  selfCopy = self;
  obj = [(HMDHome *)self triggers];
  v4 = [obj countByEnumeratingWithState:&v93 objects:v102 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v94;
    do
    {
      v7 = 0;
      v72 = v5;
      do
      {
        if (*v94 != v6)
        {
          objc_enumerationMutation(obj);
        }

        v8 = *(*(&v93 + 1) + 8 * v7);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        if ([v10 shouldActivateOnLocalDevice])
        {
          v91 = 0u;
          v92 = 0u;
          v89 = 0u;
          v90 = 0u;
          characteristicEvents = [v10 characteristicEvents];
          v12 = [characteristicEvents countByEnumeratingWithState:&v89 objects:v101 count:16];
          if (v12)
          {
            v13 = v12;
            v14 = *v90;
            do
            {
              for (i = 0; i != v13; ++i)
              {
                if (*v90 != v14)
                {
                  objc_enumerationMutation(characteristicEvents);
                }

                v16 = *(*(&v89 + 1) + 8 * i);
                characteristic = [v16 characteristic];

                if (characteristic)
                {
                  characteristic2 = [v16 characteristic];
                  [array addObject:characteristic2];
                }
              }

              v13 = [characteristicEvents countByEnumeratingWithState:&v89 objects:v101 count:16];
            }

            while (v13);
          }

          v5 = v72;
        }

        ++v7;
      }

      while (v7 != v5);
      v5 = [obj countByEnumeratingWithState:&v93 objects:v102 count:16];
    }

    while (v5);
  }

  dictionary = [MEMORY[0x277CBEB38] dictionary];
  dictionary2 = [MEMORY[0x277CBEB38] dictionary];
  selfCopy2 = self;
  [(HMDHome *)self accessories];
  v85 = 0u;
  v86 = 0u;
  v87 = 0u;
  v56 = v88 = 0u;
  v60 = [v56 countByEnumeratingWithState:&v85 objects:v100 count:16];
  if (v60)
  {
    v59 = *v86;
    v73 = *MEMORY[0x277CFE810];
    do
    {
      for (j = 0; j != v60; ++j)
      {
        if (*v86 != v59)
        {
          objc_enumerationMutation(v56);
        }

        v21 = *(*(&v85 + 1) + 8 * j);
        array2 = [MEMORY[0x277CBEB18] array];
        array3 = [MEMORY[0x277CBEB18] array];
        v24 = v21;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v25 = v24;
        }

        else
        {
          v25 = 0;
        }

        v26 = v25;

        if (v26)
        {
          v61 = v24;
          v62 = v26;
          v68 = array3;
          v71 = array2;
          v63 = j;
          v83 = 0u;
          v84 = 0u;
          v81 = 0u;
          v82 = 0u;
          services = [v26 services];
          v66 = [services countByEnumeratingWithState:&v81 objects:v99 count:16];
          if (!v66)
          {
            goto LABEL_61;
          }

          v65 = *v82;
          while (1)
          {
            v27 = 0;
            do
            {
              if (*v82 != v65)
              {
                objc_enumerationMutation(services);
              }

              v67 = v27;
              v28 = *(*(&v81 + 1) + 8 * v27);
              type = [v28 type];
              v77 = 0u;
              v78 = 0u;
              v79 = 0u;
              v80 = 0u;
              obja = [v28 characteristics];
              v30 = [obja countByEnumeratingWithState:&v77 objects:v98 count:16];
              if (v30)
              {
                v31 = v30;
                v32 = *v78;
                do
                {
                  v33 = 0;
                  do
                  {
                    if (*v78 != v32)
                    {
                      objc_enumerationMutation(obja);
                    }

                    v34 = *(*(&v77 + 1) + 8 * v33);
                    if ([v34 supportsNotification])
                    {
                      dataSource = [(HMDHome *)selfCopy2 dataSource];
                      hapMetadata = [dataSource hapMetadata];
                      type2 = [v34 type];
                      v38 = [hapMetadata shouldFilterEnableNotificationsForCharacteristicType:type2 serviceType:type];

                      if ((v38 & 1) == 0)
                      {
                        if ([type isEqualToString:v73])
                        {
                          type3 = [v34 type];
                          v40 = [type3 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"];
                        }

                        else
                        {
                          v40 = 0;
                        }

                        dataSource2 = [(HMDHome *)selfCopy2 dataSource];
                        hapMetadata2 = [dataSource2 hapMetadata];
                        type4 = [v34 type];
                        v44 = [hapMetadata2 shouldAutoEnableNotificationForCharacteristic:type4 ofService:type];

                        if ([v34 isClientNotificationEnabled] & 1) != 0 || (objc_msgSend(array, "containsObject:", v34) & 1) != 0 || ((objc_msgSend(v34, "isNonHomeNotificationsEnabled") | v40 | v44))
                        {
                          v45 = v71;
LABEL_50:
                          [v45 addObject:v34];
                          selfCopy2 = selfCopy;
                          goto LABEL_51;
                        }

                        if (!transportsCopy)
                        {
                          v45 = v68;
                          goto LABEL_50;
                        }

                        type5 = [v34 type];
                        selfCopy2 = selfCopy;
                        dataSource3 = [(HMDHome *)selfCopy dataSource];
                        hapMetadata3 = [dataSource3 hapMetadata];
                        v49 = [hapMetadata3 shouldEnableHomeNotificationForCharacteristicType:type5 serviceType:type];

                        if (v49)
                        {
                          [v71 addObject:v34];
                        }
                      }
                    }

LABEL_51:
                    ++v33;
                  }

                  while (v31 != v33);
                  v50 = [obja countByEnumeratingWithState:&v77 objects:v98 count:16];
                  v31 = v50;
                }

                while (v50);
              }

              v27 = v67 + 1;
            }

            while (v67 + 1 != v66);
            v66 = [services countByEnumeratingWithState:&v81 objects:v99 count:16];
            if (!v66)
            {
LABEL_61:

              v26 = v62;
              j = v63;
              array2 = v71;
              array3 = v68;
              v24 = v61;
              break;
            }
          }
        }

        uuid = [v24 uuid];
        uUIDString = [uuid UUIDString];

        if ([array2 count])
        {
          [dictionary setObject:array2 forKeyedSubscript:uUIDString];
        }

        if ([array3 count])
        {
          [dictionary2 setObject:array3 forKeyedSubscript:uUIDString];
        }
      }

      v60 = [v56 countByEnumeratingWithState:&v85 objects:v100 count:16];
    }

    while (v60);
  }

  v97[0] = dictionary2;
  v97[1] = dictionary;
  v53 = [MEMORY[0x277CBEA60] arrayWithObjects:v97 count:2];

  v54 = *MEMORY[0x277D85DE8];

  return v53;
}

- (void)_handleRemoteGatewayNotificationRegistration:(id)registration enable:(BOOL)enable
{
  enableCopy = enable;
  v25 = *MEMORY[0x277D85DE8];
  registrationCopy = registration;
  date = [MEMORY[0x277CBEAA8] date];
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v6 = registrationCopy;
  v7 = [v6 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v21;
    do
    {
      v10 = 0;
      do
      {
        if (*v21 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v20 + 1) + 8 * v10);
        v12 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v11];
        v13 = [(HMDHome *)self accessoryWithUUID:v12];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if (v15)
        {
          v16 = [v6 hmf_arrayForKey:v11];
          if ([v16 count])
          {
            [v15 handleRemoteGatewayNotificationRegistration:v16 enable:enableCopy enableTime:date];
          }
        }

        ++v10;
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v20 objects:v24 count:16];
    }

    while (v8);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (BOOL)applyDeviceLockStatus:(id)status
{
  v23 = *MEMORY[0x277D85DE8];
  statusCopy = status;
  if ([statusCopy isRemote])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      shortDescription = [statusCopy shortDescription];
      v19 = 138543618;
      v20 = v8;
      v21 = 2112;
      v22 = shortDescription;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@%@ is from remote source; ignoring this device's lock status", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    isLocked = 0;
  }

  else if ([statusCopy BOOLForKey:@"kApplyDeviceUnlockKey"])
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Treating device as always locked.", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    isLocked = 1;
  }

  else
  {
    dataSource = [(HMDHome *)self dataSource];
    deviceLockStateDataSource = [dataSource deviceLockStateDataSource];
    isLocked = [deviceLockStateDataSource isLocked];
  }

  v17 = *MEMORY[0x277D85DE8];
  return isLocked;
}

- (id)mediaProfileForAppleMediaAccessoryUUID:(id)d mediaStateSubscriber:(id)subscriber
{
  dCopy = d;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __71__HMDHome_mediaProfileForAppleMediaAccessoryUUID_mediaStateSubscriber___block_invoke;
  v11[3] = &unk_278688F28;
  v12 = dCopy;
  v7 = dCopy;
  v8 = [appleMediaAccessories na_firstObjectPassingTest:v11];
  mediaProfile = [v8 mediaProfile];

  return mediaProfile;
}

uint64_t __71__HMDHome_mediaProfileForAppleMediaAccessoryUUID_mediaStateSubscriber___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (id)currentAccessoryUUIDsForMediaStateSubscriber:(id)subscriber
{
  currentAccessory = [(HMDHome *)self currentAccessory];
  uuid = [currentAccessory uuid];

  return uuid;
}

- (id)appleMediaAccessoryUUIDsForMediaStateSubscriber:(id)subscriber
{
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v4 = [appleMediaAccessories na_map:&__block_literal_global_936];

  return v4;
}

- (void)configureMediaGroupsAggregateConsumer
{
  v33 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) == 0)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is disabled", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
  }

  else
  {
    homeManager = [(HMDHome *)self homeManager];
    uuid = [(HMDHome *)self uuid];
    notificationCenter = [(HMDHome *)self notificationCenter];
    localAndRemoteSubscriptionProvider = [homeManager localAndRemoteSubscriptionProvider];
    userDefaults = [homeManager userDefaults];
    v8 = userDefaults;
    if (localAndRemoteSubscriptionProvider && uuid && notificationCenter && userDefaults)
    {
      v9 = [[HMDMediaGroupsStageManager alloc] initWithIdentifier:uuid userDefaults:userDefaults];
      v10 = [[HMDMediaGroupsAggregateConsumer alloc] initWithIdentifier:uuid subscriptionProvider:localAndRemoteSubscriptionProvider notificationCenter:notificationCenter stageManager:v9];
      mediaGroupsAggregateConsumer = self->_mediaGroupsAggregateConsumer;
      self->_mediaGroupsAggregateConsumer = v10;

      [(HMDMediaGroupsStageManager *)v9 setDelegate:self->_mediaGroupsAggregateConsumer];
      [(HMDMediaGroupsAggregateConsumer *)self->_mediaGroupsAggregateConsumer setDelegate:self];
      [(HMDMediaGroupsAggregateConsumer *)self->_mediaGroupsAggregateConsumer configureWithHome:self];
    }

    else
    {
      v12 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        v15 = HMFGetLogIdentifier();
        v21 = 138544642;
        v22 = v15;
        v23 = 2112;
        v24 = uuid;
        v25 = 2112;
        v26 = localAndRemoteSubscriptionProvider;
        v27 = 2112;
        v28 = notificationCenter;
        v29 = 2112;
        v30 = v8;
        v31 = 2112;
        v32 = homeManager;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups aggregate consumer with dependencies homeUUID: %@ subscriptionProvider: %@ notificationCenter: %@ userDefaults: %@ homeManager: %@", &v21, 0x3Eu);
      }

      objc_autoreleasePoolPop(v12);
    }
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (id)roomForAllDestinationParentIdentifiers:(id)identifiers
{
  v36 = *MEMORY[0x277D85DE8];
  identifiersCopy = identifiers;
  if ([identifiersCopy count])
  {
    v5 = [(HMDHome *)self accessoriesWithUUIDs:identifiersCopy];
    v6 = [(HMDHome *)self mediaSystemsWithUUIDs:identifiersCopy];
    v7 = [identifiersCopy count];
    v8 = [v5 count];
    if (v7 == [v6 count] + v8)
    {
      firstObject = [v5 firstObject];
      room = [firstObject room];
      v11 = room;
      if (room)
      {
        room2 = room;
      }

      else
      {
        firstObject2 = [v6 firstObject];
        room2 = [firstObject2 room];
      }

      v26[0] = MEMORY[0x277D85DD0];
      v26[1] = 3221225472;
      v26[2] = __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke;
      v26[3] = &unk_278681708;
      v19 = room2;
      v27 = v19;
      if ([v5 na_allObjectsPassTest:v26])
      {
        v24[0] = MEMORY[0x277D85DD0];
        v24[1] = 3221225472;
        v24[2] = __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke_2;
        v24[3] = &unk_278675410;
        v20 = v19;
        v25 = v20;
        if ([v6 na_allObjectsPassTest:v24])
        {
          v21 = v20;
        }

        else
        {
          v21 = 0;
        }

        v13 = v21;
      }

      else
      {
        v13 = 0;
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      selfCopy = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138544130;
        v29 = v17;
        v30 = 2112;
        v31 = identifiersCopy;
        v32 = 2112;
        v33 = v5;
        v34 = 2112;
        v35 = v6;
        _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to find room due to missing destination parent identifiers: %@ found accessories: %@ found media systems: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v14);
      v13 = 0;
    }
  }

  else
  {
    v13 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v13;
}

uint64_t __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 room];
  v4 = [v3 uuid];
  v5 = [*(a1 + 32) uuid];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

uint64_t __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 room];
  v4 = [v3 uuid];
  v5 = [*(a1 + 32) uuid];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

- (id)roomForAccessoryUUID:(id)d
{
  v3 = [(HMDHome *)self accessoryWithUUID:d];
  room = [v3 room];

  return room;
}

- (id)sameRoomAccessoryUUIDsForDestinationControllerData:(id)data mediaGroupsAggregator:(id)aggregator
{
  v25 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  aggregatorCopy = aggregator;
  parentIdentifier = [dataCopy parentIdentifier];
  v9 = [(HMDHome *)self roomForAccessoryUUID:parentIdentifier];

  if (v9)
  {
    accessories = [(HMDHome *)self accessories];
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __84__HMDHome_sameRoomAccessoryUUIDsForDestinationControllerData_mediaGroupsAggregator___block_invoke;
    v19[3] = &unk_27866F8E8;
    v20 = v9;
    v11 = [accessories na_map:v19];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      parentIdentifier2 = [dataCopy parentIdentifier];
      *buf = 138543618;
      v22 = v15;
      v23 = 2112;
      v24 = parentIdentifier2;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to get available destinations due to no room for accessory uuid: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = MEMORY[0x277CBEBF8];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

id __84__HMDHome_sameRoomAccessoryUUIDsForDestinationControllerData_mediaGroupsAggregator___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 room];
  v5 = [v4 uuid];
  v6 = [*(a1 + 32) uuid];
  if ([v5 hmf_isEqualToUUID:v6])
  {
    v7 = [v3 uuid];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)eventSourceForMediaGroupsAggregator:(id)aggregator
{
  homeManager = [(HMDHome *)self homeManager];
  currentEventSource = [homeManager currentEventSource];

  return currentEventSource;
}

- (id)participantDataTopicForAccessory:(id)accessory mediaGroupsAggregator:(id)aggregator
{
  v5 = MEMORY[0x277CD16F0];
  v6 = *MEMORY[0x277CCEA70];
  accessoryCopy = accessory;
  uuid = [(HMDHome *)self uuid];
  uuid2 = [accessoryCopy uuid];

  v10 = [v5 topicFromSuffixID:v6 homeUUID:uuid accessoryUUID:uuid2];

  return v10;
}

- (void)configureMediaGroupsAggregator
{
  v51 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) == 0)
  {
    v19 = objc_autoreleasePoolPush();
    selfCopy = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543362;
      v32 = v22;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v19);
  }

  else
  {
    uuid = [(HMDHome *)self uuid];
    homeManager = [(HMDHome *)self homeManager];
    uuid2 = [homeManager uuid];
    notificationCenter = [(HMDHome *)self notificationCenter];
    primaryResidentChangeMonitor = [(HMDHome *)self primaryResidentChangeMonitor];
    eventForwarder = [homeManager eventForwarder];
    localAndRemoteSubscriptionProvider = [homeManager localAndRemoteSubscriptionProvider];
    eventStoreReadHandle = [homeManager eventStoreReadHandle];
    msgDispatcher = [(HMDHome *)self msgDispatcher];
    v28 = msgDispatcher;
    if (uuid && notificationCenter && primaryResidentChangeMonitor && eventForwarder && localAndRemoteSubscriptionProvider && eventStoreReadHandle && msgDispatcher)
    {
      v10 = [[HMDMediaGroupsAggregatorBackupSender alloc] initWithIdentifier:uuid];
      v24 = [[HMDMediaGroupsLocalDataStorage alloc] initWithIdentifier:uuid backupSender:v10];
      v11 = objc_alloc_init(HMDMediaGroupsAggregatorMessenger);
      v26 = uuid2;
      v12 = [[HMDMediaGroupsAggregator alloc] initWithIdentifier:uuid messenger:v11 eventForwarder:eventForwarder subscriptionProvider:localAndRemoteSubscriptionProvider eventStoreReadHandle:eventStoreReadHandle groupsLocalDataStorage:v24];
      [(HMDMediaGroupsAggregatorBackupSender *)v10 setDataSource:v24];
      [(HMDMediaGroupsLocalDataStorage *)v24 setDataSource:self];
      [(HMDMediaGroupsAggregatorMessenger *)v11 setDataSource:self];
      [(HMDMediaGroupsAggregatorMessenger *)v11 setDelegate:v12];
      [(HMDMediaGroupsAggregator *)v12 setDataSource:self];
      [(HMDHome *)self setMediaGroupsAggregator:v12];
      mediaGroupsAggregator = [(HMDHome *)self mediaGroupsAggregator];
      selfCopy2 = self;
      v15 = v28;
      [mediaGroupsAggregator configureWithHome:selfCopy2 messageDispatcher:v28 notificationCenter:notificationCenter primaryResidentChangeMonitor:primaryResidentChangeMonitor];

      uuid2 = v26;
    }

    else
    {
      v27 = eventStoreReadHandle;
      context = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        v18 = HMFGetLogIdentifier();
        *buf = 138545666;
        v32 = v18;
        v33 = 2112;
        v34 = uuid;
        v35 = 2112;
        v36 = uuid2;
        v37 = 2112;
        v38 = notificationCenter;
        v39 = 2112;
        v40 = primaryResidentChangeMonitor;
        v41 = 2112;
        v42 = eventForwarder;
        v43 = 2112;
        v44 = localAndRemoteSubscriptionProvider;
        v45 = 2112;
        v46 = v27;
        v47 = 2112;
        v48 = homeManager;
        v49 = 2112;
        v50 = v28;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups aggregator with dependencies homeUUID: %@ homeManagerUUID: %@ notificationCenter: %@ primaryChangeMonitor: %@ eventForwarder: %@ subscriptionProvider: %@ eventStoreReadHandle: %@ homeManager: %@ message dispatcher: %@", buf, 0x66u);
      }

      objc_autoreleasePoolPop(context);
      eventStoreReadHandle = v27;
      v15 = v28;
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)configureMediaGroupsUnconfiguredParticipantOnboardingManager
{
  v23 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", &v17, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

  else
  {
    uuid = [(HMDHome *)self uuid];
    notificationCenter = [(HMDHome *)self notificationCenter];
    v5 = notificationCenter;
    if (uuid && notificationCenter)
    {
      v6 = [[HMDMediaGroupsUnconfiguredParticipantOnboardingManager alloc] initWithIdentifier:uuid];
      [(HMDMediaGroupsUnconfiguredParticipantOnboardingManager *)v6 setDataSource:self];
      [(HMDHome *)self setMediaGroupsUnconfiguredParticipantOnboardingManager:v6];
      mediaGroupsUnconfiguredParticipantOnboardingManager = [(HMDHome *)self mediaGroupsUnconfiguredParticipantOnboardingManager];
      [mediaGroupsUnconfiguredParticipantOnboardingManager configureWithNotificationCenter:v5];
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        v17 = 138543874;
        v18 = v11;
        v19 = 2112;
        v20 = uuid;
        v21 = 2112;
        v22 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups unconfigured participant onboarding manager with dependencies homeUUID: %@ notificationCenter: %@", &v17, 0x20u);
      }

      objc_autoreleasePoolPop(v8);
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (id)receiverForParticipantAccessoryUUID:(id)d mediaGroupsLocalDataStorage:(id)storage
{
  v25 = *MEMORY[0x277D85DE8];
  dCopy = d;
  storageCopy = storage;
  homeManager = [(HMDHome *)self homeManager];
  mediaGroupParticipantDataLocalStorage = [homeManager mediaGroupParticipantDataLocalStorage];
  groupsBackupReceiver = [mediaGroupParticipantDataLocalStorage groupsBackupReceiver];
  v11 = groupsBackupReceiver;
  if (groupsBackupReceiver)
  {
    v12 = groupsBackupReceiver;
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543874;
      v20 = v16;
      v21 = 2112;
      v22 = homeManager;
      v23 = 2112;
      v24 = mediaGroupParticipantDataLocalStorage;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to get groups backup receiver with homeManager: %@ participantStorage: %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

- (id)routerForParticipantAccessoryUUID:(id)d mediaGroupsLocalDataStorage:(id)storage
{
  v22 = *MEMORY[0x277D85DE8];
  dCopy = d;
  storageCopy = storage;
  v8 = [(HMDHome *)self accessoryWithUUID:dCopy];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  if (v10)
  {
    messageRouter = [v10 messageRouter];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = dCopy;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to get router for unknown accessory uuid: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    messageRouter = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return messageRouter;
}

- (void)mergeMediaDestinationsWithConsumer:(id)consumer
{
  consumerCopy = consumer;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke;
  v11[3] = &unk_27867BBE0;
  v6 = consumerCopy;
  v12 = v6;
  [appleMediaAccessories na_each:v11];

  mediaSystems = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke_2;
  v9[3] = &unk_27866F8C0;
  v10 = v6;
  v8 = v6;
  [mediaSystems na_each:v9];
}

void __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestination:v6];
  }
}

void __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestination:v6];
  }
}

- (void)mergeMediaDestinationControllerDataWithConsumer:(id)consumer
{
  consumerCopy = consumer;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __59__HMDHome_mergeMediaDestinationControllerDataWithConsumer___block_invoke;
  v7[3] = &unk_27867BBE0;
  v8 = consumerCopy;
  v6 = consumerCopy;
  [appleMediaAccessories na_each:v7];
}

void __59__HMDHome_mergeMediaDestinationControllerDataWithConsumer___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationControllerDataWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestinationControllerData:v6];
  }
}

- (void)mergeMediaGroupsAggregateDataWithConsumer:(id)consumer
{
  consumerCopy = consumer;
  [(HMDHome *)self mergeMediaDestinationsWithConsumer:consumerCopy];
  [(HMDHome *)self mergeMediaDestinationControllerDataWithConsumer:consumerCopy];
  mediaSystemController = [(HMDHome *)self mediaSystemController];
  allMediaSystemData = [consumerCopy allMediaSystemData];

  [mediaSystemController mergeMediaSystemData:allMediaSystemData];
}

- (void)didUpdateAggregateDataForMediaGroupsAggregateConsumer:(id)consumer
{
  v18 = *MEMORY[0x277D85DE8];
  consumerCopy = consumer;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Updating home graph due to updated media groups aggregate data", &v16, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  [(HMDHome *)selfCopy mergeMediaGroupsAggregateDataWithConsumer:consumerCopy];
  homeManager = [(HMDHome *)selfCopy homeManager];
  if (homeManager)
  {
    uuid = [(HMDHome *)selfCopy uuid];
    [homeManager updateGenerationCounterWithReason:@"HMDMediaGroupsAggregateConsumerDelegateUpdatedAggregateData" sourceUUID:uuid shouldNotifyClients:1];

    [homeManager assistantSyncDataChanged:@"HMDMediaGroupsAggregateConsumerDelegateUpdatedAggregateData"];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = selfCopy;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v16 = 138543362;
      v17 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Failed to update home graph for media groups due to no home manager", &v16, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (BOOL)isLocalPresenceSupported
{
  roomUUIDsSupportingLocalPresence = [(HMDHome *)self roomUUIDsSupportingLocalPresence];
  v3 = [roomUUIDsSupportingLocalPresence count] != 0;

  return v3;
}

- (HMDDevice)currentDevice
{
  v2 = +[HMDAppleAccountManager sharedManager];
  device = [v2 device];

  return device;
}

- (HMFWiFiManager)wifiManager
{
  dataSource = [(HMDHome *)self dataSource];
  wifiManager = [dataSource wifiManager];

  return wifiManager;
}

- (void)_handleFetchUniqueIdentifierForBundleIdentifier:(id)identifier
{
  v27 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  v5 = [identifierCopy stringForKey:*MEMORY[0x277CCFE48]];
  if (v5)
  {
    v18 = 0;
    v6 = [HMDApplicationInfo clientIdentifierSaltForBundleIdentifier:v5 error:&v18];
    v7 = v18;
    if (v6)
    {
      v8 = MEMORY[0x277CCAD78];
      uuid = [(HMDHome *)self uuid];
      v10 = [v8 hm_deriveUUIDFromBaseUUID:uuid identifierSalt:v6];

      v19 = *MEMORY[0x277CD0570];
      v20 = v10;
      v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v20 forKeys:&v19 count:1];
      [identifierCopy respondWithPayload:v11];
    }

    else
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543874;
        v22 = v16;
        v23 = 2112;
        v24 = v5;
        v25 = 2112;
        v26 = v7;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Failed to get client identifier salt for bundle identifier: %@, error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
      if (v7)
      {
        [identifierCopy respondWithError:v7];
        goto LABEL_10;
      }

      v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [identifierCopy respondWithError:v10];
    }

LABEL_10:
    goto LABEL_11;
  }

  v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2 description:0 reason:@"Payload is missing the bundle identifier." suggestion:0];
  [identifierCopy respondWithError:v12];

LABEL_11:
  v17 = *MEMORY[0x277D85DE8];
}

- (void)configureMediaGroupObjects
{
  v11 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) == 0)
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v7;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v8 = *MEMORY[0x277D85DE8];
  }

  else
  {
    [(HMDHome *)self configureMediaGroupsUnconfiguredParticipantOnboardingManager];
    [(HMDHome *)self configureMediaGroupsAggregator];
    v3 = *MEMORY[0x277D85DE8];

    [(HMDHome *)self configureMediaGroupsAggregateConsumer];
  }
}

- (id)accessoriesWithUUIDs:(id)ds
{
  dsCopy = ds;
  accessories = [(HMDHome *)self accessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __32__HMDHome_accessoriesWithUUIDs___block_invoke;
  v9[3] = &unk_278681708;
  v10 = dsCopy;
  v6 = dsCopy;
  v7 = [accessories na_filter:v9];

  return v7;
}

uint64_t __32__HMDHome_accessoriesWithUUIDs___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 uuid];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (void)configureNaturalLightingWithDemoModeEnabled:(BOOL)enabled
{
  workQueue = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __55__HMDHome_configureNaturalLightingWithDemoModeEnabled___block_invoke;
  v6[3] = &unk_278688650;
  v6[4] = self;
  enabledCopy = enabled;
  dispatch_async(workQueue, v6);
}

void __55__HMDHome_configureNaturalLightingWithDemoModeEnabled___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) localCapabilitiesDataSource];
  if ([v2 isResidentCapable])
  {
  }

  else
  {
    v3 = *(a1 + 40);

    if ((v3 & 1) == 0)
    {
      return;
    }
  }

  v4 = [[HMDHomeNaturalLightingContextUpdater alloc] initWithHome:*(a1 + 32) demoModeEnabled:*(a1 + 40)];
  [*(a1 + 32) setNaturalLightingContextUpdater:v4];

  v5 = [*(a1 + 32) naturalLightingContextUpdater];
  [v5 configure];
}

- (void)configureMediaDestinationControllersForAccessories:(id)accessories
{
  accessoriesCopy = accessories;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = [accessoriesCopy na_map:&__block_literal_global_910];

  [v6 na_each:&__block_literal_global_913];
}

void *__62__HMDHome_configureMediaDestinationControllersForAccessories___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)configureMediaSystems
{
  mediaSystemController = [(HMDHome *)self mediaSystemController];
  workQueue = [(HMDHome *)self workQueue];
  msgDispatcher = [(HMDHome *)self msgDispatcher];
  notificationCenter = [(HMDHome *)self notificationCenter];
  [mediaSystemController configure:self delegate:self dataSource:self queue:workQueue messageDispatcher:msgDispatcher notificationCenter:notificationCenter];
}

- (BOOL)hasSiriEndpointAccessory
{
  v17 = *MEMORY[0x277D85DE8];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v3)
  {
    v4 = *v13;
    while (2)
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v13 != v4)
        {
          objc_enumerationMutation(accessories);
        }

        v6 = *(*(&v12 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v7 = v6;
        }

        else
        {
          v7 = 0;
        }

        v8 = v7;

        if (v8)
        {
          siriEndpointProfile = [v8 siriEndpointProfile];

          if (siriEndpointProfile)
          {
            LOBYTE(v3) = 1;
            goto LABEL_15;
          }
        }
      }

      v3 = [accessories countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v3)
      {
        continue;
      }

      break;
    }
  }

LABEL_15:

  v10 = *MEMORY[0x277D85DE8];
  return v3;
}

- (BOOL)supportsDeviceWithCapabilities:(id)capabilities
{
  capabilitiesCopy = capabilities;
  if (-[HMDHome hasSiriEndpointAccessory](self, "hasSiriEndpointAccessory") && ![capabilitiesCopy supportsSiriEndpointSetup])
  {
    supportsResidentFirstAccessoryCommunication = 0;
  }

  else
  {
    supportsResidentFirstAccessoryCommunication = [capabilitiesCopy supportsResidentFirstAccessoryCommunication];
  }

  return supportsResidentFirstAccessoryCommunication;
}

- (void)registerForDeviceWithCapabilities
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v10 = 138543362;
    v11 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Registering for device with capabilities and confirming resident device", &v10, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
  [residentDeviceManager addDataSource:selfCopy];

  residentDeviceManager2 = [(HMDHome *)selfCopy residentDeviceManager];
  [residentDeviceManager2 confirmWithCompletionHandler:0];

  v9 = *MEMORY[0x277D85DE8];
}

- (id)eventRouterServerDiagnosticInfo
{
  remoteEventRouterServer = [(HMDHome *)self remoteEventRouterServer];
  diagnosticInfo = [remoteEventRouterServer diagnosticInfo];

  return diagnosticInfo;
}

- (void)createRemoteEventRouterServerIfNeeded
{
  v65 = *MEMORY[0x277D85DE8];
  homeManager = [(HMDHome *)self homeManager];
  currentAccessory = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = currentAccessory;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  remoteEventRouterServer = [(HMDHome *)self remoteEventRouterServer];
  residentModeUUID = [remoteEventRouterServer residentModeUUID];

  if (v6)
  {
    localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
    if ([localCapabilitiesDataSource isResidentCapable])
    {
      if (!residentModeUUID)
      {

LABEL_14:
        uuid = [v6 uuid];
        v19 = [residentModeUUID isEqual:uuid];

        if ((v19 & 1) == 0)
        {
          v20 = objc_autoreleasePoolPush();
          selfCopy = self;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
          {
            v23 = HMFGetLogIdentifier();
            uuid2 = [v6 uuid];
            *buf = 138543874;
            v58 = v23;
            v59 = 2112;
            v60 = residentModeUUID;
            v61 = 2112;
            v62 = uuid2;
            _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Overwriting stale remote event router server with uuid: %@ to current accessory uuid: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v20);
        }

        v25 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          *buf = 138543618;
          v58 = v28;
          v59 = 2112;
          v60 = v6;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Creating remote event router server with current accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v25);
        localOnlySubscriptionProvider = [homeManager localOnlySubscriptionProvider];
        if (objc_opt_respondsToSelector())
        {
          serverDelegatingEventRouter = [(HMDHome *)selfCopy2 serverDelegatingEventRouter];
          synchronousSubscriptionProvider = [localOnlySubscriptionProvider synchronousSubscriptionProvider];
          [serverDelegatingEventRouter registerSubRouter:synchronousSubscriptionProvider];

          serverDelegatingEventRouter2 = [(HMDHome *)selfCopy2 serverDelegatingEventRouter];

          localOnlySubscriptionProvider = serverDelegatingEventRouter2;
        }

        v54 = localOnlySubscriptionProvider;
        v55 = residentModeUUID;
        remoteEventRouterClientController = [(HMDHome *)selfCopy2 remoteEventRouterClientController];
        residentDelegatingEventRouter = [remoteEventRouterClientController residentDelegatingEventRouter];

        if (residentDelegatingEventRouter)
        {
          serverDelegatingEventRouter3 = [(HMDHome *)selfCopy2 serverDelegatingEventRouter];
          [serverDelegatingEventRouter3 registerSubRouter:residentDelegatingEventRouter];
        }

        v53 = residentDelegatingEventRouter;
        v51 = [HMDRemoteEventRouterServer alloc];
        uuid3 = [(HMDHome *)selfCopy2 uuid];
        uuid4 = [v6 uuid];
        [homeManager workQueue];
        v37 = v52 = v6;
        msgDispatcher = [(HMDHome *)selfCopy2 msgDispatcher];
        notificationCenter = [(HMDHome *)selfCopy2 notificationCenter];
        serverDelegatingEventRouter4 = [(HMDHome *)selfCopy2 serverDelegatingEventRouter];
        eventForwarder = [homeManager eventForwarder];
        eventStoreReadHandle = [homeManager eventStoreReadHandle];
        v43 = [(HMDRemoteEventRouterServer *)v51 initWithPrimaryModeUUID:uuid3 residentModeUUID:uuid4 queue:v37 messageDispatcher:msgDispatcher dataSource:selfCopy2 notificationCenter:notificationCenter requestMessageName:@"RemoteEventRouterRequestMessage" updateMessageName:@"RemoteEventRouterUpdateMessageName" multiHopFetchResponseMessageName:@"RER.MHF.ResponseMessageName" subscriptionProvider:serverDelegatingEventRouter4 registrationEventRouter:eventForwarder storeReadHandle:eventStoreReadHandle];
        [(HMDHome *)selfCopy2 setRemoteEventRouterServer:v43];

        v6 = v52;
        v44 = [HMDUserMessagePolicy userMessagePolicyWithHome:selfCopy2 userPrivilege:0 remoteAccessRequired:0];
        v45 = isTVOSDevice();
        remoteEventRouterServer2 = [(HMDHome *)selfCopy2 remoteEventRouterServer];
        isCurrentDevicePrimaryResident = [(HMDHome *)selfCopy2 isCurrentDevicePrimaryResident];
        v56 = v44;
        v48 = [MEMORY[0x277CBEA60] arrayWithObjects:&v56 count:1];
        [remoteEventRouterServer2 configureWithHome:selfCopy2 isPrimaryResident:isCurrentDevicePrimaryResident isResidentEventProviding:v45 additionalPolicies:v48];

        residentModeUUID = v55;
        goto LABEL_25;
      }

      uuid5 = [v6 uuid];
      v11 = [residentModeUUID isEqual:uuid5];

      if ((v11 & 1) == 0)
      {
        goto LABEL_14;
      }
    }

    else
    {
    }
  }

  v12 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    localCapabilitiesDataSource2 = [(HMDHome *)selfCopy3 localCapabilitiesDataSource];
    [localCapabilitiesDataSource2 isResidentCapable];
    v17 = HMFBooleanToString();
    *buf = 138544130;
    v58 = v15;
    v59 = 2112;
    v60 = v6;
    v61 = 2112;
    v62 = v17;
    v63 = 2112;
    v64 = residentModeUUID;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Cannot create remote event router server with currentAccessory: %@ isResidentCapable: %@ serverAccessoryUUID: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v12);
LABEL_25:

  v49 = *MEMORY[0x277D85DE8];
}

- (void)configureRemoteEventRouterClientControllerForAccessories:(id)accessories
{
  v21 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v5 = [accessoriesCopy countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(accessoriesCopy);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          isCurrentAccessory = [v9 isCurrentAccessory];
          remoteEventRouterClientController = [(HMDHome *)self remoteEventRouterClientController];
          uuid = [v9 uuid];
          if (isCurrentAccessory)
          {
            [remoteEventRouterClientController updateCurrentAccessoryUUID:uuid];
          }

          else
          {
            [remoteEventRouterClientController createResidentRouterForAccessoryUUID:uuid];
          }
        }
      }

      v6 = [accessoriesCopy countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)handlePrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification:(id)notification
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __89__HMDHome_handlePrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __89__HMDHome_handlePrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification___block_invoke(uint64_t a1)
{
  v14 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) homeManager];
  v3 = [*(a1 + 32) currentDevice];

  if (v3)
  {
    [*(a1 + 32) handlePrimaryResidentChanged];
    v4 = [v2 currentAccessorySetupMetricDispatcher];
    [v4 markSetupEndStage:14 error:0];
    v5 = [*(a1 + 32) remoteEventRouterServer];

    if (v5)
    {
      [v4 markSetupBeginStage:15 error:0];
    }

    else
    {
      v6 = objc_autoreleasePoolPush();
      v7 = *(a1 + 32);
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = HMFGetLogIdentifier();
        v12 = 138543362;
        v13 = v9;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Remote event router server does not exist.", &v12, 0xCu);
      }

      objc_autoreleasePoolPop(v6);
    }
  }

  v10 = [v2 accessorySetupMetricDispatchersForHome:*(a1 + 32)];
  [v10 na_each:&__block_literal_global_901];

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handlePrimaryResidentDidBecomeOtherDevice
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  fetchedAccessorySettingsSubscriber = [(HMDHome *)self fetchedAccessorySettingsSubscriber];
  [fetchedAccessorySettingsSubscriber unsubscribeToAllAccessories];

  [(HMDHome *)self updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange];
  homeActivityStateManager = [(HMDHome *)self homeActivityStateManager];
  [homeActivityStateManager handlePrimaryResidentDidBecomeOtherDevice];

  [(HMDHome *)self handlePrimaryResidentDidBecomeOtherDeviceSwiftExtensions];
}

- (void)_handlePrimaryResidentDidBecomeCurrentDevice
{
  v12 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)self subscribeToAccessoryLanguageSettingsIfNeeded];
  [(HMDHome *)self updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange];
  v4 = objc_autoreleasePoolPush();
  selfCopy = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    *buf = 138543362;
    v11 = v7;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Current device became primary resident. Setting up operational fabric data", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
  v9 = 0;
  [(HMDHome *)selfCopy setUpOperationalFabricDataWithError:&v9];
  [(HMDHome *)selfCopy handlePrimaryResidentDidBecomeCurrentDeviceSwiftExtensions];
  v8 = *MEMORY[0x277D85DE8];
}

- (void)subscribeToAccessoryLanguageSettingsIfNeeded
{
  if (self && [self isCurrentDevicePrimaryResident])
  {
    fetchedAccessorySettingsSubscriber = [self fetchedAccessorySettingsSubscriber];
    appleMediaAccessories = [self appleMediaAccessories];
    v3 = [appleMediaAccessories na_map:&__block_literal_global_904];
    [fetchedAccessorySettingsSubscriber subscribeToSettingsForAccessoryUUIDs:v3];
  }
}

id __55__HMDHome_subscribeToAccessoryLanguageSettingsIfNeeded__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 isHomePod])
  {
    v3 = [v2 uuid];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)handlePrimaryResidentIsCurrentDeviceChangeNotification:(id)notification
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __66__HMDHome_handlePrimaryResidentIsCurrentDeviceChangeNotification___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

uint64_t __66__HMDHome_handlePrimaryResidentIsCurrentDeviceChangeNotification___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) isCurrentDevicePrimaryResident];
  v3 = *(a1 + 32);
  if (v2)
  {

    return [v3 _handlePrimaryResidentDidBecomeCurrentDevice];
  }

  else
  {

    return [v3 _handlePrimaryResidentDidBecomeOtherDevice];
  }
}

- (void)createAndConfigureBulletinManagers
{
  v60 = *MEMORY[0x277D85DE8];
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  availableResidentDevices = [residentDeviceManager availableResidentDevices];
  -[HMDHome setBulletinNotificationsSupported:](self, "setBulletinNotificationsSupported:", [availableResidentDevices count] != 0);

  if (+[HMDDeviceCapabilities supportsBulletinBoard](HMDDeviceCapabilities, "supportsBulletinBoard") || (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 isResidentCapable], v5, (v6 & 1) != 0))
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v59 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Creating and Configuring Bulletin Notification Managers...", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v55 = [[HMDPresenceNotificationConditionHandler alloc] initWithHome:selfCopy];
    v54 = [[HMDTimePeriodNotificationConditionHandler alloc] initWithHome:selfCopy];
    v11 = [HMDNotificationConditionEvaluator alloc];
    v12 = MEMORY[0x277CBEB98];
    v57[0] = v55;
    v57[1] = v54;
    v13 = [MEMORY[0x277CBEA60] arrayWithObjects:v57 count:2];
    v14 = [v12 setWithArray:v13];
    v15 = [(HMDNotificationConditionEvaluator *)v11 initWithConditionHandlers:v14];

    v16 = [HMDAccessoryBulletinNotificationManager alloc];
    workQueue = [(HMDHome *)selfCopy workQueue];
    v18 = +[HMDAppleAccountManager sharedManager];
    defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
    v53 = v15;
    v20 = [(HMDAccessoryBulletinNotificationManager *)v16 initWithHome:selfCopy workQueue:workQueue accountManager:v18 evaluator:v15 notificationCenter:defaultCenter];
    [(HMDHome *)selfCopy setAccessoryBulletinNotificationManager:v20];

    accessoryBulletinNotificationManager = [(HMDHome *)selfCopy accessoryBulletinNotificationManager];
    v22 = +[HMDDeviceCapabilities deviceCapabilities];
    [accessoryBulletinNotificationManager configureWithDeviceIsResidentCapable:{objc_msgSend(v22, "isResidentCapable")}];

    v52 = [[HMDCameraSignificantEventFaceClassificationResolver alloc] initWithHome:selfCopy];
    v23 = [HMDDoorbellPressTracker alloc];
    workQueue2 = [(HMDHome *)selfCopy workQueue];
    notificationCenter = [(HMDHome *)selfCopy notificationCenter];
    v51 = [(HMDDoorbellPressTracker *)v23 initWithWorkQueue:workQueue2 notificationCenter:notificationCenter];

    v26 = [HMDCameraBulletinNotificationManager alloc];
    workQueue3 = [(HMDHome *)selfCopy workQueue];
    msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
    v29 = +[HMDAppleAccountManager sharedManager];
    defaultCenter2 = [MEMORY[0x277CCAB98] defaultCenter];
    v31 = [(HMDCameraBulletinNotificationManager *)v26 initWithHome:selfCopy workQueue:workQueue3 messageDispatcher:msgDispatcher accountManager:v29 faceClassificationResolver:v52 doorbellPressTracker:v51 evaluator:v15 notificationCenter:defaultCenter2];
    [(HMDHome *)selfCopy setCameraBulletinNotificationManager:v31];

    cameraBulletinNotificationManager = [(HMDHome *)selfCopy cameraBulletinNotificationManager];
    v33 = +[HMDDeviceCapabilities deviceCapabilities];
    [cameraBulletinNotificationManager configureWithDeviceIsResidentCapable:{objc_msgSend(v33, "isResidentCapable")}];

    v34 = [HMDAudioAnalysisBulletinNotificationManager alloc];
    workQueue4 = [(HMDHome *)selfCopy workQueue];
    msgDispatcher2 = [(HMDHome *)selfCopy msgDispatcher];
    v37 = +[HMDAppleAccountManager sharedManager];
    v38 = [HMDNotificationConditionEvaluator alloc];
    v39 = MEMORY[0x277CBEB98];
    v56[0] = v55;
    v56[1] = v54;
    v40 = [MEMORY[0x277CBEA60] arrayWithObjects:v56 count:2];
    v41 = [v39 setWithArray:v40];
    v42 = [(HMDNotificationConditionEvaluator *)v38 initWithConditionHandlers:v41];
    defaultCenter3 = [MEMORY[0x277CCAB98] defaultCenter];
    v44 = [(HMDAudioAnalysisBulletinNotificationManager *)v34 initWithHome:selfCopy workQueue:workQueue4 messageDispatcher:msgDispatcher2 accountManager:v37 evaluator:v42 notificationCenter:defaultCenter3];
    [(HMDHome *)selfCopy setAudioAnalysisBulletinNotificationManager:v44];

    audioAnalysisBulletinNotificationManager = [(HMDHome *)selfCopy audioAnalysisBulletinNotificationManager];
    [audioAnalysisBulletinNotificationManager configure];
  }

  else
  {
    v46 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v48 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
    {
      v49 = HMFGetLogIdentifier();
      *buf = 138543362;
      v59 = v49;
      _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_INFO, "%{public}@Not creating bulletin notification managers as bulletins are not supported on this non-resident capable device", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v46);
  }

  v50 = *MEMORY[0x277D85DE8];
}

- (void)configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:(id)accessory accessories:(id)accessories uncommittedTransactions:(id)transactions
{
  v53 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  accessoriesCopy = accessories;
  transactionsCopy = transactions;
  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    *buf = 138543362;
    v50 = v14;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Configuring after accessories configuration tracker notifications", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v11);
  workQueue = [(HMDHome *)selfCopy workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)selfCopy configureBulletinNotification];
  [(HMDHome *)selfCopy _evaluateNetworkProtectionAndRouterManagement];
  if (accessoryCopy)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = selfCopy;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v50 = v19;
      v51 = 2112;
      v52 = accessoryCopy;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Setting up media session for current accessory during configure - %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [(HMDHome *)v17 _addMediaSessionForCurrentAccessory:accessoryCopy];
    v21 = accessoryCopy;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v23 = v21;
    }

    else
    {
      v23 = 0;
    }

    v24 = v23;

    if (isKindOfClass)
    {
      [v21 configureSensors];
    }
  }

  homeManager = [(HMDHome *)selfCopy homeManager];
  localCapabilitiesDataSource = [(HMDHome *)selfCopy localCapabilitiesDataSource];
  isResidentCapable = [localCapabilitiesDataSource isResidentCapable];

  if (isResidentCapable)
  {
    v28 = [HMDFetchedAccessorySettingsSubscriber alloc];
    workQueue2 = [(HMDHome *)selfCopy workQueue];
    localAndRemoteSubscriptionProvider = [homeManager localAndRemoteSubscriptionProvider];
    v48 = @"root.siri.availableLanguages";
    v31 = [MEMORY[0x277CBEA60] arrayWithObjects:&v48 count:1];
    uuid = [(HMDHome *)selfCopy uuid];
    v33 = [(HMDFetchedAccessorySettingsSubscriber *)v28 initWithWorkQueue:workQueue2 subscriptionProvider:localAndRemoteSubscriptionProvider keyPaths:v31 homeUUID:uuid];
    [(HMDHome *)selfCopy setFetchedAccessorySettingsSubscriber:v33];

    fetchedAccessorySettingsSubscriber = [(HMDHome *)selfCopy fetchedAccessorySettingsSubscriber];
    [fetchedAccessorySettingsSubscriber setDelegate:selfCopy];

    [(HMDHome *)selfCopy subscribeToAccessoryLanguageSettingsIfNeeded];
  }

  v35 = [HMDHomeMediaStateSubscriber alloc];
  uuid2 = [(HMDHome *)selfCopy uuid];
  workQueue3 = [(HMDHome *)selfCopy workQueue];
  localAndRemoteSubscriptionProvider2 = [homeManager localAndRemoteSubscriptionProvider];
  localOnlySubscriptionProvider = [homeManager localOnlySubscriptionProvider];
  v40 = [(HMDHomeMediaStateSubscriber *)v35 initWithHomeUUID:uuid2 workQueue:workQueue3 dataSource:selfCopy remoteSubscriptionProvider:localAndRemoteSubscriptionProvider2 localSubscriptionProvider:localOnlySubscriptionProvider];
  [(HMDHome *)selfCopy setMediaStateSubscriber:v40];

  notificationRegistrationsForAppleMediaAccessories = [(HMDHome *)selfCopy notificationRegistrationsForAppleMediaAccessories];
  v42 = [notificationRegistrationsForAppleMediaAccessories count];

  if (v42)
  {
    mediaStateSubscriber = [(HMDHome *)selfCopy mediaStateSubscriber];
    [mediaStateSubscriber subscribeForAppleMediaStateWithSubscriptionToken:@"HMDHomeClientMediaStateRegistrationToken"];
  }

  mediaStateSubscriber2 = [(HMDHome *)selfCopy mediaStateSubscriber];
  [mediaStateSubscriber2 localSubscribeForAppleMediaState];

  [(HMDHome *)selfCopy configureMediaSystems];
  [(HMDHome *)selfCopy configureMediaDestinationControllersForAccessories:accessoriesCopy];
  if (isInternalBuild() && ((_os_feature_enabled_impl() & 1) != 0 || _os_feature_enabled_impl()))
  {
    homeIntelligenceActivityLogger = [(HMDHome *)selfCopy homeIntelligenceActivityLogger];
    [homeIntelligenceActivityLogger configure];
  }

  [(HMDHome *)selfCopy registerForDeviceWithCapabilities];
  [(HMDHome *)selfCopy configureMediaGroupObjects];
  accessories = [(HMDHome *)selfCopy accessories];
  [(HMDHome *)selfCopy configureRemoteEventRouterClientControllerForAccessories:accessories];

  v47 = *MEMORY[0x277D85DE8];
}

- (BOOL)configureWithHomeManager:(id)manager accessoriesPresent:(id)present uncommittedTransactions:(id)transactions source:(unint64_t)source
{
  v540 = *MEMORY[0x277D85DE8];
  managerCopy = manager;
  presentCopy = present;
  transactionsCopy = transactions;
  HMFUptime();
  v10 = v9;
  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    uuid = [(HMDHome *)selfCopy uuid];
    [(HMDHome *)selfCopy locationServicesEnabled];
    v16 = HMFBooleanToString();
    *buf = 138545410;
    v500 = v14;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configuring home with location service enabled";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"start";
    v509 = 2114;
    v510 = @"homeUUID";
    v511 = 2112;
    v512 = uuid;
    v513 = 2114;
    v514 = @"status";
    v515 = 2112;
    v516 = v16;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v11);
  mEMORY[0x277D17DE8] = [MEMORY[0x277D17DE8] sharedInstance];
  v18 = objc_alloc(MEMORY[0x277D17DF8]);
  uuid2 = [(HMDHome *)selfCopy uuid];
  [(HMDHome *)selfCopy locationServicesEnabled];
  v20 = HMFBooleanToString();
  v21 = HMDTaggedLoggingCreateDictionary();
  v22 = [v18 initWithTag:@"homeConfigureStart" data:{v21, @"state", @"start", @"homeUUID", uuid2, @"status", v20}];
  currentTagProcessorList = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8] submitTaggedEvent:v22 processorList:currentTagProcessorList];

  [(HMDHome *)selfCopy setHomeManager:managerCopy];
  messageDispatcher = [managerCopy messageDispatcher];
  [(HMDHome *)selfCopy setMsgDispatcher:messageDispatcher];

  accessoryBrowser = [managerCopy accessoryBrowser];
  [(HMDHome *)selfCopy setAccessoryBrowser:accessoryBrowser];

  metricsManager = [managerCopy metricsManager];
  logEventSubmitter = [metricsManager logEventSubmitter];
  logEventSubmitter = selfCopy->_logEventSubmitter;
  selfCopy->_logEventSubmitter = logEventSubmitter;

  if (!selfCopy->_metricsDispatcher)
  {
    dataSource = [(HMDHome *)selfCopy dataSource];
    uuid = selfCopy->_uuid;
    logEventSubmitter2 = [(HMDHome *)selfCopy logEventSubmitter];
    v32 = [dataSource makeHomeMetricsDispatcherWithIdentifier:uuid logEventSubmitter:logEventSubmitter2];
    metricsDispatcher = selfCopy->_metricsDispatcher;
    selfCopy->_metricsDispatcher = v32;
  }

  v34 = [HMDHomePrimaryResidentMessagingHandler alloc];
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  uuid3 = [(HMDHome *)selfCopy uuid];
  residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
  v38 = [(HMDHomePrimaryResidentMessagingHandler *)v34 initWithMessageDispatcher:msgDispatcher homeUUID:uuid3 residentDeviceManager:residentDeviceManager];
  primaryResidentMessagingHandler = selfCopy->_primaryResidentMessagingHandler;
  selfCopy->_primaryResidentMessagingHandler = v38;

  messageDispatcher2 = [managerCopy messageDispatcher];
  secureRemoteTransport = [messageDispatcher2 secureRemoteTransport];
  primaryResidentMessagingHandler = [(HMDHome *)selfCopy primaryResidentMessagingHandler];
  [secureRemoteTransport registerHomeMessageDestinationHandler:primaryResidentMessagingHandler];

  if ([(HMDHome *)selfCopy isOwnerUser])
  {
    selfCopy->_isUpdatedToHH2 = [(HMDHome *)selfCopy isThisHomeMigratedToHH2];
  }

  v43 = [MEMORY[0x277CD1F00] authWithValue:1];
  presenceAuthStatus = selfCopy->_presenceAuthStatus;
  selfCopy->_presenceAuthStatus = v43;

  v45 = objc_autoreleasePoolPush();
  v46 = selfCopy;
  v47 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
  {
    v48 = HMFGetLogIdentifier();
    v49 = selfCopy->_presenceAuthStatus;
    *buf = 138543618;
    v500 = v48;
    v501 = 2112;
    v502 = v49;
    _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Home Presence Auth Status : [%@]", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v45);
  [(HMDHome *)v46 _readLocalHomeKeyMiscInfo];
  v50 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:8 options:7.0];
  homeLocationTimer = v46->_homeLocationTimer;
  v46->_homeLocationTimer = v50;

  [(HMFTimer *)v46->_homeLocationTimer setDelegateQueue:v46->_workQueue];
  [(HMFTimer *)v46->_homeLocationTimer setDelegate:v46];
  mEMORY[0x277D0F8D0] = [MEMORY[0x277D0F8D0] sharedPreferences];
  v53 = [mEMORY[0x277D0F8D0] preferenceForKey:@"accessoryReachabilityCoalescePeriod"];
  numberValue = [v53 numberValue];

  LODWORD(mEMORY[0x277D0F8D0]) = [numberValue unsignedIntValue];
  v54 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:0 options:mEMORY[0x277D0F8D0]];
  accessoryReachabilityUpdatesTimer = v46->_accessoryReachabilityUpdatesTimer;
  v46->_accessoryReachabilityUpdatesTimer = v54;

  [(HMFTimer *)v46->_accessoryReachabilityUpdatesTimer setDelegate:v46];
  [(HMFTimer *)v46->_accessoryReachabilityUpdatesTimer setDelegateQueue:v46->_workQueue];
  roomForEntireHome = [(HMDHome *)v46 roomForEntireHome];
  msgDispatcher2 = [(HMDHome *)v46 msgDispatcher];
  workQueue = [(HMDHome *)v46 workQueue];
  [roomForEntireHome configure:msgDispatcher2 queue:workQueue];

  periodicReader = [(HMDHome *)v46 periodicReader];
  [periodicReader configure:v46];

  presenceMonitor = [(HMDHome *)v46 presenceMonitor];
  msgDispatcher3 = [(HMDHome *)v46 msgDispatcher];
  [presenceMonitor configure:v46 messageDispatcher:msgDispatcher3];

  featuresDataSource = [(HMDHome *)v46 featuresDataSource];
  LOBYTE(msgDispatcher3) = [featuresDataSource isUserActivityStateDetectionFeatureEnabled];

  if ((msgDispatcher3 & 1) == 0)
  {
    presenceFeeder = [(HMDHome *)v46 presenceFeeder];
    msgDispatcher4 = [(HMDHome *)v46 msgDispatcher];
    [presenceFeeder configure:v46 messageDispatcher:msgDispatcher4];

    v65 = objc_autoreleasePoolPush();
    v66 = v46;
    v67 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v67, OS_LOG_TYPE_INFO))
    {
      v68 = HMFGetLogIdentifier();
      presenceFeeder2 = [(HMDHome *)v66 presenceFeeder];
      *buf = 138543618;
      v500 = v68;
      v501 = 2112;
      v502 = presenceFeeder2;
      _os_log_impl(&dword_229538000, v67, OS_LOG_TYPE_INFO, "%{public}@Configured presenceFeeder: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v65);
  }

  homeLocationHandler = [(HMDHome *)v46 homeLocationHandler];
  workQueue2 = [(HMDHome *)v46 workQueue];
  msgDispatcher5 = [(HMDHome *)v46 msgDispatcher];
  [homeLocationHandler configure:v46 queue:workQueue2 messageDispatcher:msgDispatcher5];

  homeReprovisionHandler = [(HMDHome *)v46 homeReprovisionHandler];
  workQueue3 = [(HMDHome *)v46 workQueue];
  msgDispatcher6 = [(HMDHome *)v46 msgDispatcher];
  [homeReprovisionHandler configure:v46 queue:workQueue3 messageDispatcher:msgDispatcher6];

  sharedHomeUpdateHandler = [(HMDHome *)v46 sharedHomeUpdateHandler];
  [sharedHomeUpdateHandler registerForMessages];

  reachabilityChangedLogEventManager = [(HMDHome *)v46 reachabilityChangedLogEventManager];
  [reachabilityChangedLogEventManager configure];

  [(HMDHome *)v46 updateHomeLocation];
  featuresDataSource2 = [(HMDHome *)v46 featuresDataSource];
  LODWORD(workQueue3) = [featuresDataSource2 isStateSyncEnabled];

  if (workQueue3)
  {
    stateSyncManager = [(HMDHome *)v46 stateSyncManager];
    [stateSyncManager configure];
  }

  residentDeviceManager2 = [(HMDHome *)v46 residentDeviceManager];
  v81 = +[HMDMessageDispatcher defaultDispatcher];
  [residentDeviceManager2 configureWithHome:v46 messageDispatcher:v81];

  residentDeviceManager3 = [(HMDHome *)v46 residentDeviceManager];
  [residentDeviceManager3 setDelegate:v46];

  primaryResidentChangeMonitor = [(HMDHome *)v46 primaryResidentChangeMonitor];
  [primaryResidentChangeMonitor configureWithHome:v46];

  [(HMDHome *)v46 _purgeResidentUsers];
  if ([(HMDHome *)v46 isOwnerUser])
  {
    primaryResident = [(HMDHome *)v46 primaryResident];
    device = [primaryResident device];
    isCurrentDevice = [device isCurrentDevice];

    accessoryBrowser2 = [(HMDHome *)v46 accessoryBrowser];
    [accessoryBrowser2 setQOS:isCurrentDevice];
  }

  name = [(HMDHome *)v46 name];
  v89 = [(HMDHome *)v46 addName:name];

  roomForEntireHome2 = [(HMDHome *)v46 roomForEntireHome];
  name2 = [roomForEntireHome2 name];
  v92 = [(HMDHome *)v46 addName:name2];

  notificationRegistrations = [(HMDHome *)v46 notificationRegistrations];
  LOBYTE(name2) = [notificationRegistrations count] == 0;

  if ((name2 & 1) == 0)
  {
    v497 = 0u;
    v498 = 0u;
    v495 = 0u;
    v496 = 0u;
    mediaSessions = [(HMDHome *)v46 mediaSessions];
    v95 = [mediaSessions countByEnumeratingWithState:&v495 objects:v539 count:16];
    if (v95)
    {
      v96 = *v496;
      do
      {
        for (i = 0; i != v95; ++i)
        {
          if (*v496 != v96)
          {
            objc_enumerationMutation(mediaSessions);
          }

          [*(*(&v495 + 1) + 8 * i) registerForSessionUpdates:1];
        }

        v95 = [mediaSessions countByEnumeratingWithState:&v495 objects:v539 count:16];
      }

      while (v95);
    }
  }

  group = dispatch_group_create();
  [(HMDHome *)v46 createAndConfigureBulletinManagers];
  accessories = [(HMDHome *)v46 accessories];
  v445 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  HMFUptime();
  v100 = v99;
  v101 = objc_autoreleasePoolPush();
  v102 = v46;
  v103 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v103, OS_LOG_TYPE_DEBUG))
  {
    v104 = HMFGetLogIdentifier();
    uuid4 = [(HMDHome *)v102 uuid];
    *buf = 138544898;
    v500 = v104;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configuring accessories";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfigureAccessories";
    v509 = 2114;
    v510 = @"homeUUID";
    v511 = 2112;
    v512 = uuid4;
    _os_log_impl(&dword_229538000, v103, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v101);
  mEMORY[0x277D17DE8]2 = [MEMORY[0x277D17DE8] sharedInstance];
  v107 = objc_alloc(MEMORY[0x277D17DF8]);
  uuid5 = [(HMDHome *)v102 uuid];
  v109 = HMDTaggedLoggingCreateDictionary();
  v110 = [v107 initWithTag:@"homeConfigureStart" data:{v109, @"state", @"homeConfigureAccessories", @"homeUUID", uuid5}];
  currentTagProcessorList2 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]2 submitTaggedEvent:v110 processorList:currentTagProcessorList2];

  v493 = 0u;
  v494 = 0u;
  v491 = 0u;
  v492 = 0u;
  obj = accessories;
  v112 = [obj countByEnumeratingWithState:&v491 objects:v538 count:16];
  if (v112)
  {
    v442 = 0;
    v450 = *v492;
    do
    {
      for (j = 0; j != v112; ++j)
      {
        if (*v492 != v450)
        {
          objc_enumerationMutation(obj);
        }

        v114 = *(*(&v491 + 1) + 8 * j);
        v115 = objc_autoreleasePoolPush();
        v116 = v114;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v117 = v116;
        }

        else
        {
          v117 = 0;
        }

        v118 = v117;

        [v118 setDataSource:v102];
        v119 = v116;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v120 = v119;
        }

        else
        {
          v120 = 0;
        }

        v121 = v120;

        if (v121)
        {
          if ([v121 isPrimary])
          {
            identifier = [v121 identifier];
            supportedTransports = [v121 supportedTransports];
            setupHash = [v121 setupHash];
            [(HMDHome *)v102 _registerPairedAccessory:identifier transports:supportedTransports setupHash:setupHash];
          }

          [v445 addObject:v121];
        }

        v125 = v119;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v126 = v125;
        }

        else
        {
          v126 = 0;
        }

        v127 = v126;

        if (v127)
        {
          if (v118)
          {
            capabilitiesAggregator = [(HMDHome *)v102 capabilitiesAggregator];
            uuid6 = [v118 uuid];
            [capabilitiesAggregator didAddAccessory:uuid6];
          }

          if ([v118 isCurrentAccessory])
          {
            v130 = v118;

            v442 = v130;
          }

          identifier2 = [v127 identifier];
          -[HMDHome _registerPairedAccessory:transports:setupHash:](v102, "_registerPairedAccessory:transports:setupHash:", identifier2, [v127 supportedTransports], 0);
        }

        msgDispatcher7 = [(HMDHome *)v102 msgDispatcher];
        [v125 configureWithHome:v102 msgDispatcher:msgDispatcher7 configurationTracker:group initialConfiguration:1];

        uuid7 = [v125 uuid];
        uUIDString = [uuid7 UUIDString];
        [presentCopy addObject:uUIDString];

        objc_autoreleasePoolPop(v115);
      }

      v112 = [obj countByEnumeratingWithState:&v491 objects:v538 count:16];
    }

    while (v112);
  }

  else
  {
    v442 = 0;
  }

  v135 = objc_autoreleasePoolPush();
  v136 = v102;
  v137 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v137, OS_LOG_TYPE_INFO))
  {
    v138 = HMFGetLogIdentifier();
    v139 = MEMORY[0x277CCACA8];
    HMFUptime();
    v100 = [v139 stringWithFormat:@"%.3f", v140 - v100];
    uuid8 = [(HMDHome *)v136 uuid];
    v143 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(obj, "count")}];
    *buf = 138545922;
    v500 = v138;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configured accessories";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfiguredAccessories";
    v509 = 2114;
    v510 = @"duration";
    v511 = 2112;
    v512 = v100;
    v513 = 2114;
    v514 = @"homeUUID";
    v515 = 2112;
    v516 = uuid8;
    v517 = 2114;
    v518 = @"accessoriesCount";
    v519 = 2112;
    v520 = v143;
    _os_log_impl(&dword_229538000, v137, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x70u);
  }

  objc_autoreleasePoolPop(v135);
  mEMORY[0x277D17DE8]3 = [MEMORY[0x277D17DE8] sharedInstance];
  v145 = objc_alloc(MEMORY[0x277D17DF8]);
  v146 = MEMORY[0x277CCACA8];
  HMFUptime();
  v1002 = [v146 stringWithFormat:@"%.3f", v147 - v100];
  uuid9 = [(HMDHome *)v136 uuid];
  v150 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(obj, "count")}];
  v151 = HMDTaggedLoggingCreateDictionary();
  v152 = [v145 initWithTag:@"homeConfigureStart" data:{v151, @"state", @"homeConfiguredAccessories", @"duration", v1002, @"homeUUID", uuid9, @"accessoriesCount", v150}];
  currentTagProcessorList3 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]3 submitTaggedEvent:v152 processorList:currentTagProcessorList3];

  HMFUptime();
  v155 = v154;
  v156 = objc_autoreleasePoolPush();
  v157 = v136;
  v158 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v158, OS_LOG_TYPE_DEBUG))
  {
    v159 = HMFGetLogIdentifier();
    uuid10 = [(HMDHome *)v157 uuid];
    *buf = 138544898;
    v500 = v159;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configuring rooms, zones, groups, etc";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfigureProperties";
    v509 = 2114;
    v510 = @"homeUUID";
    v511 = 2112;
    v512 = uuid10;
    _os_log_impl(&dword_229538000, v158, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v156);
  mEMORY[0x277D17DE8]4 = [MEMORY[0x277D17DE8] sharedInstance];
  v162 = objc_alloc(MEMORY[0x277D17DF8]);
  uuid11 = [(HMDHome *)v157 uuid];
  v164 = HMDTaggedLoggingCreateDictionary();
  v165 = [v162 initWithTag:@"homeConfigureStart" data:{v164, @"state", @"homeConfigureProperties", @"homeUUID", uuid11}];
  currentTagProcessorList4 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]4 submitTaggedEvent:v165 processorList:currentTagProcessorList4];

  v489 = 0u;
  v490 = 0u;
  v487 = 0u;
  v488 = 0u;
  rooms = [(HMDHome *)v157 rooms];
  v168 = [rooms countByEnumeratingWithState:&v487 objects:v537 count:16];
  if (v168)
  {
    v169 = *v488;
    do
    {
      for (k = 0; k != v168; ++k)
      {
        if (*v488 != v169)
        {
          objc_enumerationMutation(rooms);
        }

        v171 = *(*(&v487 + 1) + 8 * k);
        msgDispatcher8 = [(HMDHome *)v157 msgDispatcher];
        workQueue4 = [(HMDHome *)v157 workQueue];
        [v171 configure:msgDispatcher8 queue:workQueue4];

        name3 = [v171 name];
        v175 = [(HMDHome *)v157 addName:name3];
      }

      v168 = [rooms countByEnumeratingWithState:&v487 objects:v537 count:16];
    }

    while (v168);
  }

  v485 = 0u;
  v486 = 0u;
  v483 = 0u;
  v484 = 0u;
  zones = [(HMDHome *)v157 zones];
  v177 = [zones countByEnumeratingWithState:&v483 objects:v536 count:16];
  if (v177)
  {
    v178 = *v484;
    do
    {
      for (m = 0; m != v177; ++m)
      {
        if (*v484 != v178)
        {
          objc_enumerationMutation(zones);
        }

        v180 = *(*(&v483 + 1) + 8 * m);
        msgDispatcher9 = [(HMDHome *)v157 msgDispatcher];
        workQueue5 = [(HMDHome *)v157 workQueue];
        [v180 configure:msgDispatcher9 queue:workQueue5];

        name4 = [v180 name];
        v184 = [(HMDHome *)v157 addName:name4];
      }

      v177 = [zones countByEnumeratingWithState:&v483 objects:v536 count:16];
    }

    while (v177);
  }

  v481 = 0u;
  v482 = 0u;
  v479 = 0u;
  v480 = 0u;
  serviceGroups = [(HMDHome *)v157 serviceGroups];
  v186 = [serviceGroups countByEnumeratingWithState:&v479 objects:v535 count:16];
  if (v186)
  {
    v187 = *v480;
    do
    {
      for (n = 0; n != v186; ++n)
      {
        if (*v480 != v187)
        {
          objc_enumerationMutation(serviceGroups);
        }

        v189 = *(*(&v479 + 1) + 8 * n);
        msgDispatcher10 = [(HMDHome *)v157 msgDispatcher];
        workQueue6 = [(HMDHome *)v157 workQueue];
        [v189 configure:msgDispatcher10 queue:workQueue6];

        name5 = [v189 name];
        v193 = [(HMDHome *)v157 addName:name5];
      }

      v186 = [serviceGroups countByEnumeratingWithState:&v479 objects:v535 count:16];
    }

    while (v186);
  }

  v477 = 0u;
  v478 = 0u;
  v475 = 0u;
  v476 = 0u;
  actionSets = [(HMDHome *)v157 actionSets];
  v195 = [actionSets countByEnumeratingWithState:&v475 objects:v534 count:16];
  if (v195)
  {
    v451 = 0;
    v196 = *v476;
    do
    {
      for (ii = 0; ii != v195; ++ii)
      {
        if (*v476 != v196)
        {
          objc_enumerationMutation(actionSets);
        }

        v198 = *(*(&v475 + 1) + 8 * ii);
        v199 = objc_autoreleasePoolPush();
        msgDispatcher11 = [(HMDHome *)v157 msgDispatcher];
        workQueue7 = [(HMDHome *)v157 workQueue];
        v202 = [v198 configure:v157 messageDispatcher:msgDispatcher11 queue:workQueue7];

        name6 = [v198 name];
        v204 = [(HMDHome *)v157 addName:name6];

        objc_autoreleasePoolPop(v199);
        v451 |= v202;
      }

      v195 = [actionSets countByEnumeratingWithState:&v475 objects:v534 count:16];
    }

    while (v195);
  }

  else
  {
    v451 = 0;
  }

  v473 = 0u;
  v474 = 0u;
  v471 = 0u;
  v472 = 0u;
  triggerOwnedActionSets = [(HMDHome *)v157 triggerOwnedActionSets];
  v206 = [triggerOwnedActionSets countByEnumeratingWithState:&v471 objects:v533 count:16];
  if (v206)
  {
    v207 = *v472;
    do
    {
      for (jj = 0; jj != v206; ++jj)
      {
        if (*v472 != v207)
        {
          objc_enumerationMutation(triggerOwnedActionSets);
        }

        v209 = *(*(&v471 + 1) + 8 * jj);
        v210 = objc_autoreleasePoolPush();
        msgDispatcher12 = [(HMDHome *)v157 msgDispatcher];
        workQueue8 = [(HMDHome *)v157 workQueue];
        LOBYTE(v209) = [v209 configure:v157 messageDispatcher:msgDispatcher12 queue:workQueue8];

        objc_autoreleasePoolPop(v210);
        v451 |= v209;
      }

      v206 = [triggerOwnedActionSets countByEnumeratingWithState:&v471 objects:v533 count:16];
    }

    while (v206);
  }

  v469 = 0u;
  v470 = 0u;
  v467 = 0u;
  v468 = 0u;
  triggers = [(HMDHome *)v157 triggers];
  v214 = [triggers countByEnumeratingWithState:&v467 objects:v532 count:16];
  if (v214)
  {
    v215 = *v468;
    do
    {
      for (kk = 0; kk != v214; ++kk)
      {
        if (*v468 != v215)
        {
          objc_enumerationMutation(triggers);
        }

        v217 = *(*(&v467 + 1) + 8 * kk);
        msgDispatcher13 = [(HMDHome *)v157 msgDispatcher];
        workQueue9 = [(HMDHome *)v157 workQueue];
        [v217 configure:v157 messageDispatcher:msgDispatcher13 queue:workQueue9];

        owner = [v217 owner];
        LODWORD(msgDispatcher13) = owner == 0;

        if (msgDispatcher13)
        {
          currentUser = [(HMDHome *)v157 currentUser];
          [v217 setOwner:currentUser];
        }

        v222 = objc_autoreleasePoolPush();
        v223 = v157;
        v224 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v224, OS_LOG_TYPE_INFO))
        {
          v225 = HMFGetLogIdentifier();
          *buf = 138543362;
          v500 = v225;
          _os_log_impl(&dword_229538000, v224, OS_LOG_TYPE_INFO, "%{public}@Not updating trigger owning device in HH2", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v222);
      }

      v214 = [triggers countByEnumeratingWithState:&v467 objects:v532 count:16];
    }

    while (v214);
  }

  v226 = objc_autoreleasePoolPush();
  v227 = v157;
  v228 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v228, OS_LOG_TYPE_INFO))
  {
    v229 = HMFGetLogIdentifier();
    v230 = MEMORY[0x277CCACA8];
    HMFUptime();
    v155 = [v230 stringWithFormat:@"%.3f", v231 - v155];
    uuid12 = [(HMDHome *)v227 uuid];
    *buf = 138545410;
    v500 = v229;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configured rooms, zones, triggers, etc.";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfiguredProperties";
    v509 = 2114;
    v510 = @"duration";
    v511 = 2112;
    v512 = v155;
    v513 = 2114;
    v514 = @"homeUUID";
    v515 = 2112;
    v516 = uuid12;
    _os_log_impl(&dword_229538000, v228, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v226);
  mEMORY[0x277D17DE8]5 = [MEMORY[0x277D17DE8] sharedInstance];
  v235 = objc_alloc(MEMORY[0x277D17DF8]);
  v236 = MEMORY[0x277CCACA8];
  HMFUptime();
  v1552 = [v236 stringWithFormat:@"%.3f", v237 - v155];
  uuid13 = [(HMDHome *)v227 uuid];
  v240 = HMDTaggedLoggingCreateDictionary();
  v241 = [v235 initWithTag:@"homeConfigureStart" data:{v240, @"state", @"homeConfiguredProperties", @"duration", v1552, @"homeUUID", uuid13}];
  currentTagProcessorList5 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]5 submitTaggedEvent:v241 processorList:currentTagProcessorList5];

  HMFUptime();
  v244 = v243;
  v245 = objc_autoreleasePoolPush();
  v246 = v227;
  v247 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v247, OS_LOG_TYPE_DEBUG))
  {
    v248 = HMFGetLogIdentifier();
    uuid14 = [(HMDHome *)v246 uuid];
    *buf = 138544898;
    v500 = v248;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configuring users";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfigureUsers";
    v509 = 2114;
    v510 = @"homeUUID";
    v511 = 2112;
    v512 = uuid14;
    _os_log_impl(&dword_229538000, v247, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v245);
  mEMORY[0x277D17DE8]6 = [MEMORY[0x277D17DE8] sharedInstance];
  v251 = objc_alloc(MEMORY[0x277D17DF8]);
  uuid15 = [(HMDHome *)v246 uuid];
  v253 = HMDTaggedLoggingCreateDictionary();
  v254 = [v251 initWithTag:@"homeConfigureStart" data:{v253, @"state", @"homeConfigureUsers", @"homeUUID", uuid15}];
  currentTagProcessorList6 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]6 submitTaggedEvent:v254 processorList:currentTagProcessorList6];

  v465 = 0u;
  v466 = 0u;
  v463 = 0u;
  v464 = 0u;
  removedUsers = [(HMDHome *)v246 removedUsers];
  v257 = [removedUsers countByEnumeratingWithState:&v463 objects:v531 count:16];
  if (v257)
  {
    v258 = *v464;
    do
    {
      for (mm = 0; mm != v257; ++mm)
      {
        if (*v464 != v258)
        {
          objc_enumerationMutation(removedUsers);
        }

        user = [*(*(&v463 + 1) + 8 * mm) user];
        [(HMDHome *)v246 _addUserToIdentityRegistry:user];
      }

      v257 = [removedUsers countByEnumeratingWithState:&v463 objects:v531 count:16];
    }

    while (v257);
  }

  v461 = 0u;
  v462 = 0u;
  v459 = 0u;
  v460 = 0u;
  users = [(HMDHome *)v246 users];
  v261 = [users countByEnumeratingWithState:&v459 objects:v530 count:16];
  if (v261)
  {
    v446 = *v460;
    do
    {
      for (nn = 0; nn != v261; ++nn)
      {
        if (*v460 != v446)
        {
          objc_enumerationMutation(users);
        }

        v263 = *(*(&v459 + 1) + 8 * nn);
        userID = [(__CFString *)v263 userID];
        isRemoteGateway = [(__CFString *)v263 isRemoteGateway];
        if (userID)
        {
          v266 = isRemoteGateway;
        }

        else
        {
          v266 = 1;
        }

        if ((v266 & 1) == 0)
        {
          v267 = [HMDDeviceHandle deviceHandleForDestination:userID];
          if (v267)
          {
            v268 = objc_autoreleasePoolPush();
            v269 = v246;
            v270 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v270, OS_LOG_TYPE_DEFAULT))
            {
              v271 = HMFGetLogIdentifier();
              *buf = 138543618;
              v500 = v271;
              v501 = 2112;
              v502 = v263;
              _os_log_impl(&dword_229538000, v270, OS_LOG_TYPE_DEFAULT, "%{public}@Migrating invalid resident user: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v268);
            [(HMDHome *)v269 _removeUser:v263];
            v272 = +[HMDAccountRegistry sharedRegistry];
            v273 = [v272 deviceForHandle:v267];

            v274 = [HMDResidentUser alloc];
            pairingIdentity = [(__CFString *)v263 pairingIdentity];
            v276 = [(HMDResidentUser *)v274 initWithDevice:v273 home:v269 pairingIdentity:pairingIdentity configurationState:0];

            uuid16 = [(__CFString *)v263 uuid];
            [(HMDUser *)v276 setUUID:uuid16];

            [(HMDHome *)v269 addUser:v276];
          }
        }

        [(HMDHome *)v246 _addUserToIdentityRegistry:v263];
        [(__CFString *)v263 configureWithHome:v246];
      }

      v261 = [users countByEnumeratingWithState:&v459 objects:v530 count:16];
    }

    while (v261);
  }

  v278 = objc_autoreleasePoolPush();
  v279 = v246;
  v280 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v280, OS_LOG_TYPE_INFO))
  {
    v281 = HMFGetLogIdentifier();
    v282 = MEMORY[0x277CCACA8];
    HMFUptime();
    v244 = [v282 stringWithFormat:@"%.3f", v283 - v244];
    v285 = MEMORY[0x277CCABB0];
    users2 = [(HMDHome *)v279 users];
    v287 = [v285 numberWithUnsignedInteger:{objc_msgSend(users2, "count")}];
    *buf = 138545410;
    v500 = v281;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configured users";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfiguredUsers";
    v509 = 2114;
    v510 = @"duration";
    v511 = 2112;
    v512 = v244;
    v513 = 2114;
    v514 = @"usersCount";
    v515 = 2112;
    v516 = v287;
    _os_log_impl(&dword_229538000, v280, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v278);
  mEMORY[0x277D17DE8]7 = [MEMORY[0x277D17DE8] sharedInstance];
  v289 = objc_alloc(MEMORY[0x277D17DF8]);
  v290 = MEMORY[0x277CCACA8];
  HMFUptime();
  v2442 = [v290 stringWithFormat:@"%.3f", v291 - v244];
  v293 = MEMORY[0x277CCABB0];
  users3 = [(HMDHome *)v279 users];
  v295 = [v293 numberWithUnsignedInteger:{objc_msgSend(users3, "count")}];
  v296 = HMDTaggedLoggingCreateDictionary();
  v297 = [v289 initWithTag:@"homeConfigureStart" data:{v296, @"state", @"homeConfiguredUsers", @"duration", v2442, @"usersCount", v295}];
  currentTagProcessorList7 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]7 submitTaggedEvent:v297 processorList:currentTagProcessorList7];

  networkProtectionGroupRegistry = [(HMDHome *)v279 networkProtectionGroupRegistry];
  [networkProtectionGroupRegistry configure];

  localCapabilitiesDataSource = [(HMDHome *)v279 localCapabilitiesDataSource];
  LODWORD(v2442) = [localCapabilitiesDataSource isResidentCapable];

  if (v2442)
  {
    uuid17 = [(HMDHome *)v279 uuid];
    uUIDString2 = [uuid17 UUIDString];
    v303 = [@"Home.EventRouter.Server.Delegating." stringByAppendingString:uUIDString2];

    v304 = objc_alloc(MEMORY[0x277D17498]);
    workQueue10 = [managerCopy workQueue];
    v306 = v303;
    uTF8String = [v303 UTF8String];
    uuid18 = [(HMDHome *)v279 uuid];
    v309 = [v304 initWithQueue:workQueue10 dataSource:v279 storeReadHandle:0 logCategory:uTF8String identifier:uuid18];
    serverDelegatingEventRouter = v279->_serverDelegatingEventRouter;
    v279->_serverDelegatingEventRouter = v309;

    [(HMDHome *)v279 createRemoteEventRouterServerIfNeeded];
  }

  v439 = [HMDUserMessagePolicy userMessagePolicyWithHome:v279 userPrivilege:3 remoteAccessRequired:0];
  eventRouterAssertionController = [managerCopy eventRouterAssertionController];
  v311 = [HMDHomeRemoteEventRouterClientController alloc];
  messageTargetUUID = [(HMDHome *)v279 messageTargetUUID];
  workQueue11 = [managerCopy workQueue];
  uuid19 = [v442 uuid];
  v315 = [(HMDHomeRemoteEventRouterClientController *)v311 initWithMessageTargetUUID:messageTargetUUID workQueue:workQueue11 dataSource:v279 requestMessageName:@"RemoteEventRouterRequestMessage" updateMessageName:@"RemoteEventRouterUpdateMessageName" multiHopFetchResponseMessageName:@"RER.MHF.ResponseMessageName" clientUserMessagePolicy:v439 currentAccessoryUUID:uuid19 assertionController:eventRouterAssertionController];
  [(HMDHome *)v279 setRemoteEventRouterClientController:v315];

  localAndRemoteSubscriptionProvider = [managerCopy localAndRemoteSubscriptionProvider];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v317 = localAndRemoteSubscriptionProvider;
  }

  else
  {
    v317 = 0;
  }

  v434 = v317;

  remoteEventRouterClientController = [(HMDHome *)v279 remoteEventRouterClientController];
  residentDelegatingEventRouter = [remoteEventRouterClientController residentDelegatingEventRouter];

  if (residentDelegatingEventRouter)
  {
    [v434 registerSubRouter:residentDelegatingEventRouter];
  }

  swiftExtensions = [(HMDHome *)v279 swiftExtensions];
  [swiftExtensions configureWithHome:v279];

  objc_initWeak(&location, v279);
  workQueue12 = [(HMDHome *)v279 workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke;
  block[3] = &unk_278687568;
  objc_copyWeak(&v457, &location);
  v431 = v442;
  v454 = v431;
  obja = obj;
  v455 = obja;
  v433 = transactionsCopy;
  v456 = v433;
  dispatch_group_notify(group, workQueue12, block);

  uuid20 = [(HMDHome *)v279 uuid];
  [managerCopy removeHomeFromAwaitingAutoAcceptHomes:uuid20];

  HMFUptime();
  v323 = v322;
  v324 = objc_autoreleasePoolPush();
  v325 = v279;
  v326 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v326, OS_LOG_TYPE_DEBUG))
  {
    v327 = HMFGetLogIdentifier();
    uuid21 = [(HMDHome *)v325 uuid];
    *buf = 138544898;
    v500 = v327;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configuring profiles and settings";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfigureProfiles";
    v509 = 2114;
    v510 = @"homeUUID";
    v511 = 2112;
    v512 = uuid21;
    _os_log_impl(&dword_229538000, v326, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v324);
  mEMORY[0x277D17DE8]8 = [MEMORY[0x277D17DE8] sharedInstance];
  v330 = objc_alloc(MEMORY[0x277D17DF8]);
  uuid22 = [(HMDHome *)v325 uuid];
  v332 = HMDTaggedLoggingCreateDictionary();
  v333 = [v330 initWithTag:@"homeConfigureStart" data:{v332, @"state", @"homeConfigureProfiles", @"homeUUID", uuid22}];
  currentTagProcessorList8 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]8 submitTaggedEvent:v333 processorList:currentTagProcessorList8];

  v335 = objc_autoreleasePoolPush();
  [(HMDHome *)v325 _registerForMessages];
  objc_autoreleasePoolPop(v335);
  [(HMDHome *)v325 _registerForNotifications];
  [(HMDHome *)v325 resubscribeForNotificationsOnResident:0];
  [(HMDHome *)v325 configureMultiuserSettingsMessengerWithMessengerFactory:v325];
  [(HMDHome *)v325 _evaluateShouldRelaunchAndSetRelaunch];
  [(HMDHome *)v325 reEvaluateHomeHubState];
  v336 = objc_autoreleasePoolPush();
  v337 = v325;
  v338 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v338, OS_LOG_TYPE_INFO))
  {
    v339 = HMFGetLogIdentifier();
    triggers2 = [v337 triggers];
    *buf = 138543618;
    v500 = v339;
    v501 = 2112;
    v502 = triggers2;
    _os_log_impl(&dword_229538000, v338, OS_LOG_TYPE_INFO, "%{public}@Triggers: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v336);
  [v337 migrateAfterResidentChange];
  [v337 _updateWoWState:v445];
  if ((v451 & 1) != 0 && [v337 isOwnerUser])
  {
    [v337 _updateConfigurationVersion];
  }

  v341 = [[HMDMediaActionRouter alloc] initWithDataSource:v337];
  [v337 setMediaActionRouter:v341];

  personDataManager = [v337 personDataManager];
  [personDataManager configure];

  v343 = [[HMDUserActionPredictionManager alloc] initWithHome:v337];
  [v337 setUserActionPredictionManager:v343];

  userActionPredictionManager = [v337 userActionPredictionManager];
  [userActionPredictionManager configure];

  reachabilityNotificationManager = [v337 reachabilityNotificationManager];
  messageDispatcher3 = [managerCopy messageDispatcher];
  secureRemoteTransport2 = [messageDispatcher3 secureRemoteTransport];
  deviceMonitor = [secureRemoteTransport2 deviceMonitor];
  [reachabilityNotificationManager configureWithHome:v337 deviceMonitor:deviceMonitor];

  [v337 configureNaturalLightingWithDemoModeEnabled:0];
  walletKeyManager = [v337 walletKeyManager];
  [walletKeyManager configureWithHome:v337];

  nfcReaderKeyManager = [v337 nfcReaderKeyManager];
  [nfcReaderKeyManager configureWithHome:v337];

  lockNotificationManager = [v337 lockNotificationManager];
  [lockNotificationManager configureWithHome:v337];

  analysisStatePublisher = [v337 analysisStatePublisher];
  [analysisStatePublisher configureWithHome:v337];

  [v337 configurePrimaryResidentMessageRouterWithFactory:v337 metricsDispatcherFactory:v337];
  v353 = [HMDAppleMediaAccessoryMessageRouter alloc];
  uuid23 = [v337 uuid];
  msgDispatcher14 = [v337 msgDispatcher];
  v356 = [(HMDAppleMediaAccessoryMessageRouter *)v353 initWithIdentifier:uuid23 messageDispatcher:msgDispatcher14];
  [v337 setAppleDeviceRouter:v356];

  appleDeviceRouter = [v337 appleDeviceRouter];
  [appleDeviceRouter setDataSource:v337];

  v358 = [HMDDelegatingMessageRouter alloc];
  msgDispatcher15 = [v337 msgDispatcher];
  appleDeviceRouter2 = [v337 appleDeviceRouter];
  v529[0] = appleDeviceRouter2;
  primaryResidentMessageRouter = [v337 primaryResidentMessageRouter];
  v529[1] = primaryResidentMessageRouter;
  v362 = [MEMORY[0x277CBEA60] arrayWithObjects:v529 count:2];
  v363 = [(HMDDelegatingMessageRouter *)v358 initWithMessageDispatcher:msgDispatcher15 routers:v362];
  [v337 setAccessoryMessageRouterViaPrimary:v363];

  accessoryMessageRouterViaPrimary = [v337 accessoryMessageRouterViaPrimary];
  [accessoryMessageRouterViaPrimary setDataSource:v337];

  [v337 configureUnifiedLanguageValueListSettingDataProviderWithFactory:v337];
  [v337 configureAccessorySettingsMessengerWithMessengerFactory:v337 messageHandlerFactory:v337];
  [v337 configureSiriEndpointProfilesMessengerWithMessengerFactory:v337 messageHandlerFactory:v337];
  accessoryConnectionCoordinator = [v337 accessoryConnectionCoordinator];
  localCapabilitiesDataSource2 = [v337 localCapabilitiesDataSource];
  [accessoryConnectionCoordinator configureWithIsResidentCapable:{objc_msgSend(localCapabilitiesDataSource2, "isResidentCapable")}];

  workQueue13 = [v337 workQueue];
  v452[0] = MEMORY[0x277D85DD0];
  v452[1] = 3221225472;
  v452[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_875;
  v452[3] = &unk_27868A728;
  v452[4] = v337;
  dispatch_async(workQueue13, v452);

  v368 = objc_autoreleasePoolPush();
  v369 = v337;
  v370 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v370, OS_LOG_TYPE_INFO))
  {
    v371 = HMFGetLogIdentifier();
    v372 = MEMORY[0x277CCACA8];
    HMFUptime();
    v323 = [v372 stringWithFormat:@"%.3f", v373 - v323];
    uuid24 = [v369 uuid];
    *buf = 138545410;
    v500 = v371;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configured profiles and settings";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfiguredProfiles";
    v509 = 2114;
    v510 = @"duration";
    v511 = 2112;
    v512 = v323;
    v513 = 2114;
    v514 = @"homeUUID";
    v515 = 2112;
    v516 = uuid24;
    _os_log_impl(&dword_229538000, v370, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v368);
  mEMORY[0x277D17DE8]9 = [MEMORY[0x277D17DE8] sharedInstance];
  v377 = objc_alloc(MEMORY[0x277D17DF8]);
  v378 = MEMORY[0x277CCACA8];
  HMFUptime();
  v3232 = [v378 stringWithFormat:@"%.3f", v379 - v323];
  uuid25 = [v369 uuid];
  v382 = HMDTaggedLoggingCreateDictionary();
  v383 = [v377 initWithTag:@"homeConfigureStart" data:{v382, @"state", @"homeConfiguredProfiles", @"duration", v3232, @"homeUUID", uuid25}];
  currentTagProcessorList9 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]9 submitTaggedEvent:v383 processorList:currentTagProcessorList9];

  v385 = [HMDResidentSyncManager alloc];
  defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
  v387 = +[HMDMainDriver driver];
  coreData = [v387 coreData];
  logEventSubmitter3 = [v369 logEventSubmitter];
  v390 = [(HMDResidentSyncManager *)v385 initWithHome:v369 notificationCenter:defaultCenter persistence:coreData logEventSubmitter:logEventSubmitter3];
  [v369 setResidentSyncManager:v390];

  residentSyncManager = [v369 residentSyncManager];
  start = [residentSyncManager start];

  [v369 updateAccessoryBrowsing];
  featuresDataSource3 = [v369 featuresDataSource];
  LODWORD(v387) = [featuresDataSource3 isHomeActivityStateFeatureEnabled];

  if (v387)
  {
    homeActivityStateManager = [v369 homeActivityStateManager];
    [homeActivityStateManager configure];
  }

  v395 = objc_autoreleasePoolPush();
  v396 = v369;
  v397 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v397, OS_LOG_TYPE_INFO))
  {
    v398 = HMFGetLogIdentifier();
    *buf = 138543362;
    v500 = v398;
    _os_log_impl(&dword_229538000, v397, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - configureWithHomeManager", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v395);
  [v396 _configureUserActivityStateDetectorManager];
  [v396[142] configureWithHome:v396];
  if ([managerCopy isDemoModeV2Active] && isDemoModeV2Locked())
  {
    [v396 deregisterForMessagesInDemoModeV2];
  }

  v399 = objc_autoreleasePoolPush();
  v400 = v396;
  v401 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v401, OS_LOG_TYPE_INFO))
  {
    v443 = v399;
    v402 = HMFGetLogIdentifier();
    v403 = MEMORY[0x277CCACA8];
    HMFUptime();
    v405 = [v403 stringWithFormat:@"%.3f", v404 - v10];
    uuid26 = [v400 uuid];
    v407 = HMFBooleanToString();
    v408 = MEMORY[0x277CCABB0];
    accessories2 = [v400 accessories];
    v410 = [v408 numberWithUnsignedInteger:{objc_msgSend(accessories2, "count")}];
    v411 = MEMORY[0x277CCABB0];
    users4 = [v400 users];
    v413 = [v411 numberWithUnsignedInteger:{objc_msgSend(users4, "count")}];
    *buf = 138546946;
    v500 = v402;
    v501 = 2114;
    v502 = @"homeConfigureDone";
    v503 = 2112;
    v504 = @"Configured home";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"end";
    v509 = 2114;
    v510 = @"duration";
    v511 = 2112;
    v512 = v405;
    v513 = 2114;
    v514 = @"homeUUID";
    v515 = 2112;
    v516 = uuid26;
    v517 = 2114;
    v518 = @"configChanged";
    v519 = 2112;
    v520 = v407;
    v521 = 2114;
    v522 = @"accessoriesCount";
    v523 = 2112;
    v524 = v410;
    v525 = 2114;
    v526 = @"usersCount";
    v527 = 2112;
    v528 = v413;
    _os_log_impl(&dword_229538000, v401, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x98u);

    v399 = v443;
  }

  objc_autoreleasePoolPop(v399);
  mEMORY[0x277D17DE8]10 = [MEMORY[0x277D17DE8] sharedInstance];
  v414 = objc_alloc(MEMORY[0x277D17DF8]);
  v415 = MEMORY[0x277CCACA8];
  HMFUptime();
  v417 = [v415 stringWithFormat:@"%.3f", v416 - v10];
  uuid27 = [v400 uuid];
  v419 = HMFBooleanToString();
  v420 = MEMORY[0x277CCABB0];
  accessories3 = [v400 accessories];
  v422 = [v420 numberWithUnsignedInteger:{objc_msgSend(accessories3, "count")}];
  v423 = MEMORY[0x277CCABB0];
  users5 = [v400 users];
  v425 = [v423 numberWithUnsignedInteger:{objc_msgSend(users5, "count")}];
  v426 = HMDTaggedLoggingCreateDictionary();
  v427 = [v414 initWithTag:@"homeConfigureDone" data:{v426, @"state", @"end", @"duration", v417, @"homeUUID", uuid27, @"configChanged", v419, @"accessoriesCount", v422, @"usersCount", v425}];
  currentTagProcessorList10 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]10 submitTaggedEvent:v427 processorList:currentTagProcessorList10];

  objc_destroyWeak(&v457);
  objc_destroyWeak(&location);

  v429 = *MEMORY[0x277D85DE8];
  return v451 & 1;
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:*(a1 + 32) accessories:*(a1 + 40) uncommittedTransactions:*(a1 + 48)];
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_875(uint64_t a1)
{
  v2 = [*(a1 + 32) accessCodeManager];
  v3 = [*(a1 + 32) msgDispatcher];
  [v2 configureWithMessageDispatcher:v3];

  v9 = objc_opt_new();
  v4 = [HMDHomeHindsightCloudShareManager alloc];
  v5 = *(a1 + 32);
  v6 = [v5 workQueue];
  v7 = [(HMDHomeHindsightCloudShareManager *)v4 initWithHome:v5 workQueue:v6 dataSource:v9];
  [*(a1 + 32) setHindsightCloudShareManager:v7];

  v8 = [*(a1 + 32) hindsightCloudShareManager];
  [v8 configure];
}

- (void)_setupActiveNetworkRouterAccessory:(id)accessory existingRouterAccessories:(id)accessories
{
  v63 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  accessoriesCopy = accessories;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  v8 = accessoryCopy;
  v9 = [v8 countByEnumeratingWithState:&v51 objects:v62 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v52;
    while (2)
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v52 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v51 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if ([v15 isPrimary])
        {
          networkRouterController = [v15 networkRouterController];

          if (networkRouterController)
          {
            v42 = v8;
            v43 = accessoriesCopy;
            v49 = 0u;
            v50 = 0u;
            v47 = 0u;
            v48 = 0u;
            v17 = accessoriesCopy;
            v18 = [v17 countByEnumeratingWithState:&v47 objects:v61 count:16];
            v19 = v15;
            v46 = v15;
            if (v18)
            {
              v20 = v18;
              v21 = *v48;
              v44 = v17;
              v45 = *v48;
              do
              {
                for (j = 0; j != v20; ++j)
                {
                  if (*v48 != v21)
                  {
                    objc_enumerationMutation(v17);
                  }

                  v23 = *(*(&v47 + 1) + 8 * j);
                  if (([v23 isEqual:{v19, v42, v43}] & 1) == 0)
                  {
                    v24 = objc_autoreleasePoolPush();
                    selfCopy = self;
                    v26 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
                    {
                      HMFGetLogIdentifier();
                      v28 = v27 = self;
                      [v23 shortDescription];
                      v30 = v29 = v20;
                      shortDescription = [v19 shortDescription];
                      *buf = 138543874;
                      v56 = v28;
                      v57 = 2112;
                      v58 = v30;
                      v59 = 2112;
                      v60 = shortDescription;
                      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Removing existing Wi-Fi router accessory '%@' while adding a new Wi-Fi router accessory '%@'", buf, 0x20u);

                      v19 = v46;
                      v20 = v29;

                      self = v27;
                      v17 = v44;
                      v21 = v45;
                    }

                    objc_autoreleasePoolPop(v24);
                    [(HMDHome *)selfCopy __removeAccessory:v23 isBeingReplaced:1 isForceUpdate:0 message:0];
                  }
                }

                v20 = [v17 countByEnumeratingWithState:&v47 objects:v61 count:16];
              }

              while (v20);
            }

            uuid = [v19 uuid];
            activeNetworkRouterUUID = [(HMDHome *)self activeNetworkRouterUUID];
            v34 = [uuid isEqual:activeNetworkRouterUUID];

            if (v34)
            {
              [(HMDHome *)self _evaluateNetworkProtectionAndRouterManagement];
              v8 = v42;
              accessoriesCopy = v43;
              v35 = v46;
            }

            else
            {
              v36 = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v38 = HMFGetOSLogHandle();
              v8 = v42;
              accessoriesCopy = v43;
              if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
              {
                v39 = HMFGetLogIdentifier();
                shortDescription2 = [v46 shortDescription];
                *buf = 138543618;
                v56 = v39;
                v57 = 2112;
                v58 = shortDescription2;
                _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Adding transaction to set %@ as active network router accessory", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v36);
              v35 = v46;
              -[HMDHome _addTransactionForActiveNetworkRouterAccessory:isReplacement:](selfCopy2, "_addTransactionForActiveNetworkRouterAccessory:isReplacement:", v46, [v17 count] != 0);
            }

            goto LABEL_31;
          }
        }
      }

      v10 = [v8 countByEnumeratingWithState:&v51 objects:v62 count:16];
      if (v10)
      {
        continue;
      }

      break;
    }
  }

LABEL_31:

  v41 = *MEMORY[0x277D85DE8];
}

- (void)setBackingStore:(id)store
{
  storeCopy = store;
  os_unfair_recursive_lock_lock_with_options();
  backingStore = self->_backingStore;
  self->_backingStore = storeCopy;

  os_unfair_recursive_lock_unlock();
}

- (HMDBackingStore)backingStore
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_backingStore;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setWatchSkipVersionCheck:(BOOL)check
{
  os_unfair_recursive_lock_lock_with_options();
  self->_watchSkipVersionCheck = check;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)watchSkipVersionCheck
{
  os_unfair_recursive_lock_lock_with_options();
  watchSkipVersionCheck = self->_watchSkipVersionCheck;
  os_unfair_recursive_lock_unlock();
  return watchSkipVersionCheck;
}

- (void)_addUserToIdentityRegistry:(id)registry
{
  registryCopy = registry;
  userID = [registryCopy userID];
  v4 = registryCopy;
  if (userID)
  {
    pairingIdentity = [registryCopy pairingIdentity];

    v4 = registryCopy;
    if (pairingIdentity)
    {
      v6 = registryCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v7 = v6;
      }

      else
      {
        v7 = 0;
      }

      v8 = v7;

      if (v8)
      {
        device = [v8 device];
        if (device)
        {
          v10 = +[HMDIdentityRegistry sharedRegistry];
          pairingIdentity2 = [v6 pairingIdentity];
          [v10 registerIdentity:pairingIdentity2 device:device object:v6];
LABEL_11:
        }
      }

      else
      {
        device = [v6 account];
        if (device)
        {
          v10 = +[HMDIdentityRegistry sharedRegistry];
          pairingIdentity2 = [v6 pairingIdentity];
          [v10 registerIdentity:pairingIdentity2 account:device object:v6];
          goto LABEL_11;
        }
      }

      v4 = registryCopy;
    }
  }
}

- (void)_removeMediaSessionWithIdentifier:(id)identifier
{
  v4 = [(HMDHome *)self mediaSessionWithIdentifier:identifier];
  if (v4)
  {
    v5 = v4;
    [v4 registerForSessionUpdates:0];
    [(HMDHome *)self removeMediaSession:v5];
    v4 = v5;
  }
}

- (id)_createMediaSessionWithEndpoint:(id)endpoint
{
  v20 = *MEMORY[0x277D85DE8];
  endpointCopy = endpoint;
  sessionIdentifier = [endpointCopy sessionIdentifier];
  if (sessionIdentifier)
  {
    v6 = [(HMDHome *)self mediaSessionStateWithIdentifier:sessionIdentifier];
    if (!v6)
    {
      v6 = [[HMDMediaSessionState alloc] initWithSessionIdentifier:sessionIdentifier];
      [(HMDHome *)self addMediaSessionState:v6];
    }

    v7 = [HMDMediaSession alloc];
    array = [MEMORY[0x277CBEA60] array];
    v9 = [(HMDMediaSession *)v7 initWithEndpoint:endpointCopy mediaProfiles:array state:v6];

    [(HMDHome *)self __addMediaSession:v9];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = endpointCopy;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Cannot create a mediaSession with nil sessionIdentifier for endpoint %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v9 = 0;
  }

  v14 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)_addMediaSessionForCurrentAccessory:(id)accessory
{
  v22 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = accessoryCopy;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  mediaProfile = [v6 mediaProfile];
  if (mediaProfile)
  {
    identifier = [accessoryCopy identifier];
    v9 = [HMDMediaSession sessionForCurrentAccessoryWithSessionIdentifier:identifier mediaProfile:mediaProfile];

    if (v9)
    {
      state = [v9 state];
      [(HMDHome *)self addMediaSessionState:state];

      [(HMDHome *)self __addMediaSession:v9];
      [accessoryCopy updateMediaSession:v9];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v14 = HMFGetLogIdentifier();
      name = [accessoryCopy name];
      v18 = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = name;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEFAULT, "%{public}@Current accessory '%@' not an Apple media accessory or no media profile", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v9 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)__addMediaSession:(id)session
{
  sessionCopy = session;
  if (sessionCopy)
  {
    v7 = sessionCopy;
    notificationRegistrations = [(HMDHome *)self notificationRegistrations];
    v6 = [notificationRegistrations count];

    if (v6)
    {
      [v7 registerForSessionUpdates:1];
    }

    [(HMDHome *)self addMediaSession:v7];
    sessionCopy = v7;
  }
}

- (id)_createBuiltinActionSets
{
  v36 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  +[HMDHome getBuiltinActionSets];
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v4 = v28 = 0u;
  v24 = [v4 countByEnumeratingWithState:&v25 objects:v35 count:16];
  if (v24)
  {
    v23 = *v26;
    *&v5 = 138543874;
    v20 = v5;
    selfCopy = self;
    v22 = v4;
    do
    {
      for (i = 0; i != v24; ++i)
      {
        if (*v26 != v23)
        {
          objc_enumerationMutation(v4);
        }

        v7 = *(*(&v25 + 1) + 8 * i);
        v8 = [v4 objectForKeyedSubscript:{v7, v20}];
        v9 = HMDLocalizedStringForKey(v8);

        v10 = [(HMDHome *)self addName:v9];
        if (v10)
        {
          v11 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
          {
            v14 = HMFGetLogIdentifier();
            [(HMDHome *)selfCopy2 name];
            v16 = v15 = array;
            *buf = v20;
            v30 = v14;
            v31 = 2112;
            v32 = v9;
            v33 = 2112;
            v34 = v16;
            _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEFAULT, "%{public}@Could not add builtin actionSet '%@' to home '%@' namespace", buf, 0x20u);

            array = v15;
            self = selfCopy;
          }

          objc_autoreleasePoolPop(v11);
          v4 = v22;
        }

        v17 = [(HMDHome *)self createActionSetWithName:v9 uuid:0 type:v7];
        [array addObject:v17];
      }

      v24 = [v4 countByEnumeratingWithState:&v25 objects:v35 count:16];
    }

    while (v24);
  }

  v18 = *MEMORY[0x277D85DE8];

  return array;
}

- (id)createActionSetWithName:(id)name uuid:(id)uuid type:(id)type
{
  typeCopy = type;
  uuidCopy = uuid;
  nameCopy = name;
  v11 = [HMDActionSet alloc];
  workQueue = [(HMDHome *)self workQueue];
  v13 = [(HMDActionSet *)v11 initWithName:nameCopy uuid:uuidCopy type:typeCopy home:self queue:workQueue];

  msgDispatcher = [(HMDHome *)self msgDispatcher];
  workQueue2 = [(HMDHome *)self workQueue];
  [(HMDActionSet *)v13 configure:self messageDispatcher:msgDispatcher queue:workQueue2];

  return v13;
}

- (id)filterBuiltinActionSets:(id)sets
{
  v22 = *MEMORY[0x277D85DE8];
  setsCopy = sets;
  v4 = +[HMDHome getBuiltinActionSets];
  allKeys = [v4 allKeys];

  array = [MEMORY[0x277CBEB18] array];
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v7 = setsCopy;
  v8 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v18;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v18 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v17 + 1) + 8 * i);
        type = [v12 type];
        v14 = [allKeys containsObject:type];

        if (v14)
        {
          [array addObject:v12];
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
    }

    while (v9);
  }

  v15 = *MEMORY[0x277D85DE8];

  return array;
}

- (void)computeBridgedAccessoriesForAllBridges
{
  v40 = *MEMORY[0x277D85DE8];
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  accessories = [(HMDHome *)self accessories];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v5 = [accessories countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v35;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v35 != v7)
        {
          objc_enumerationMutation(accessories);
        }

        v9 = *(*(&v34 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        bridge = [v11 bridge];
        v13 = bridge;
        if (bridge)
        {
          uuid = [bridge uuid];
          v15 = [dictionary hmf_mutableSetForKey:uuid];

          if (!v15)
          {
            v15 = [MEMORY[0x277CBEB58] set];
            uuid2 = [v13 uuid];
            [dictionary setObject:v15 forKey:uuid2];
          }

          uuid3 = [v9 uuid];
          [v15 addObject:uuid3];
        }
      }

      v6 = [accessories countByEnumeratingWithState:&v34 objects:v39 count:16];
    }

    while (v6);
  }

  v32 = 0u;
  v33 = 0u;
  v30 = 0u;
  v31 = 0u;
  v18 = dictionary;
  v19 = [v18 countByEnumeratingWithState:&v30 objects:v38 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v31;
    do
    {
      for (j = 0; j != v20; ++j)
      {
        if (*v31 != v21)
        {
          objc_enumerationMutation(v18);
        }

        v23 = *(*(&v30 + 1) + 8 * j);
        v24 = [v18 hmf_mutableSetForKey:{v23, v30}];
        v25 = [accessories hmf_firstObjectWithUUID:v23];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v26 = v25;
        }

        else
        {
          v26 = 0;
        }

        v27 = v26;

        if (v27)
        {
          v28 = v24 == 0;
        }

        else
        {
          v28 = 1;
        }

        if (!v28)
        {
          [v27 setIdentifiersForBridgedAccessories:v24];
        }
      }

      v20 = [v18 countByEnumeratingWithState:&v30 objects:v38 count:16];
    }

    while (v20);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)__handleProcessStateChange:(id)change
{
  userInfo = [change userInfo];
  v5 = [userInfo objectForKeyedSubscript:@"processInfo"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    bundleIdentifier = [v7 bundleIdentifier];
    state = [v7 state];
    if (bundleIdentifier)
    {
      v10 = state > 4;
    }

    else
    {
      v10 = 1;
    }

    if (!v10 && ((1 << state) & 0x1A) != 0)
    {
      workQueue = [(HMDHome *)self workQueue];
      v14 = MEMORY[0x277D85DD0];
      v15 = 3221225472;
      v16 = __38__HMDHome___handleProcessStateChange___block_invoke;
      v17 = &unk_27868A750;
      v18 = bundleIdentifier;
      selfCopy = self;
      dispatch_async(workQueue, &v14);
    }

    v13 = [(HMDHome *)self hapAccessories:v14];
    [v13 hmf_enumerateWithAutoreleasePoolUsingBlock:&__block_literal_global_818];
  }
}

uint64_t __38__HMDHome___handleProcessStateChange___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = +[HMDAccessorySetupManager accessorySetupHostBundleIdentifier];
  LODWORD(v2) = [v2 isEqualToString:v3];

  if (v2)
  {
    [*(a1 + 40) _cleanAddAccessoryOperations];
  }

  v5 = *(a1 + 32);
  v4 = *(a1 + 40);

  return [v4 _disableNotificationsForClient:v5];
}

- (void)_startHomeNotificationDeregistrationTimer
{
  v26 = *MEMORY[0x277D85DE8];
  disableNotificationTimer = [(HMDHome *)self disableNotificationTimer];

  if (disableNotificationTimer)
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      disableNotificationTimer2 = [(HMDHome *)selfCopy disableNotificationTimer];
      v22 = 138543618;
      v23 = v7;
      v24 = 2112;
      v25 = disableNotificationTimer2;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Kicking notification disable timer: %@", &v22, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    disableNotificationTimer3 = [(HMDHome *)selfCopy disableNotificationTimer];
    [disableNotificationTimer3 kick];
  }

  else
  {
    v10 = objc_alloc(MEMORY[0x277D0F920]);
    v11 = [v10 initWithTimeInterval:1 options:*&disableNotificationsDeferPeriod];
    [(HMDHome *)self setDisableNotificationTimer:v11];

    workQueue = [(HMDHome *)self workQueue];
    disableNotificationTimer4 = [(HMDHome *)self disableNotificationTimer];
    [disableNotificationTimer4 setDelegateQueue:workQueue];

    disableNotificationTimer5 = [(HMDHome *)self disableNotificationTimer];
    [disableNotificationTimer5 setDelegate:self];

    disableNotificationTimer6 = [(HMDHome *)self disableNotificationTimer];
    [disableNotificationTimer6 resume];

    v16 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      disableNotificationTimer7 = [(HMDHome *)selfCopy2 disableNotificationTimer];
      v22 = 138543618;
      v23 = v19;
      v24 = 2112;
      v25 = disableNotificationTimer7;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Started notification disable timer: %@", &v22, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_disableDirectCharacteristicNotificationsForClient:(id)client
{
  v28 = *MEMORY[0x277D85DE8];
  clientCopy = client;
  v25[0] = 0;
  v25[1] = v25;
  v25[2] = 0x2020000000;
  v26 = 0;
  v5 = dispatch_group_create();
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  accessories = [(HMDHome *)self accessories];
  v7 = [accessories copy];

  v8 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
  if (v8)
  {
    v9 = *v22;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v22 != v9)
        {
          objc_enumerationMutation(v7);
        }

        v11 = *(*(&v21 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = v11;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if (v13)
        {
          dispatch_group_enter(v5);
          aBlock[0] = MEMORY[0x277D85DD0];
          aBlock[1] = 3221225472;
          aBlock[2] = __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke;
          aBlock[3] = &unk_278685E20;
          v20 = v25;
          v19 = v5;
          v14 = _Block_copy(aBlock);
          [v13 disableNotificationsForBundleID:clientCopy completionHandler:v14];
        }
      }

      v8 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
    }

    while (v8);
  }

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke_2;
  block[3] = &unk_27868A688;
  block[4] = self;
  block[5] = v25;
  dispatch_group_notify(v5, workQueue, block);

  _Block_object_dispose(v25, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke(uint64_t a1, int a2)
{
  if (a2)
  {
    *(*(*(a1 + 40) + 8) + 24) = 1;
  }

  dispatch_group_leave(*(a1 + 32));
}

uint64_t __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke_2(uint64_t result)
{
  if (*(*(*(result + 40) + 8) + 24) == 1)
  {
    return [*(result + 32) saveToCurrentAccountWithReason:@"HMDApplicationTerminatedSaveReason"];
  }

  return result;
}

- (void)_disableNotificationsForClient:(id)client
{
  v19 = *MEMORY[0x277D85DE8];
  clientCopy = client;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v9;
    v17 = 2112;
    v18 = clientCopy;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Disabling notification for client %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  notificationRegistrations = [(HMDHome *)selfCopy notificationRegistrations];
  if ([notificationRegistrations containsObject:clientCopy])
  {
    notificationDeregistrations = [(HMDHome *)selfCopy notificationDeregistrations];
    v12 = [notificationDeregistrations containsObject:clientCopy];

    if ((v12 & 1) == 0)
    {
      [(HMDHome *)selfCopy addNotificationDeregistrationForClientIdentifier:clientCopy];
      [(HMDHome *)selfCopy _startHomeNotificationDeregistrationTimer];
    }
  }

  else
  {
  }

  v13 = [@"com.apple.HomeKit.client." stringByAppendingString:clientCopy];
  [(HMDHome *)selfCopy _disableDirectCharacteristicNotificationsForClient:v13];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_cleanAddAccessoryOperations
{
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)self->_addPendingAccessories removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessorySetupCodeHandlers removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessorySetupCodes removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessoryOnboardingSetupPayloadStrings removeAllObjects];

  os_unfair_recursive_lock_unlock();
}

- (void)handleAccessoryReachabilityChangeNotification:(id)notification
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __57__HMDHome_handleAccessoryReachabilityChangeNotification___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

uint64_t __57__HMDHome_handleAccessoryReachabilityChangeNotification___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) _hasPairedReachableBTLEAccessories];
  v3 = *(a1 + 32);

  return [v3 setAnyBTLEAccessoryReachable:v2];
}

- (void)handleClientProcessDisconnectedNotification:(id)notification
{
  object = [notification object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = object;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  if (v6)
  {
    bundleIdentifier = [v6 bundleIdentifier];
    if (bundleIdentifier)
    {
      workQueue = [(HMDHome *)self workQueue];
      v9[0] = MEMORY[0x277D85DD0];
      v9[1] = 3221225472;
      v9[2] = __55__HMDHome_handleClientProcessDisconnectedNotification___block_invoke;
      v9[3] = &unk_27868A750;
      v9[4] = self;
      v10 = bundleIdentifier;
      dispatch_async(workQueue, v9);
    }
  }
}

- (void)_registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier
{
  notificationsCopy = notifications;
  v49 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  clientIdentifierCopy = clientIdentifier;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if ([(HMDHome *)self isFeatureMatteriPhoneOnlyPairingControlEnabled])
  {
    if (clientIdentifierCopy)
    {
      v11 = clientIdentifierCopy;
    }

    else
    {
      v11 = identifierCopy;
    }

    v12 = v11;
    if (([v12 isEqualToString:*MEMORY[0x277CCFE40]] & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD09C8]) & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD11A0]) & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD06C8]) & 1) != 0 || objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD0638]))
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG);
      if (notificationsCopy)
      {
        if (v16)
        {
          v17 = HMFGetLogIdentifier();
          v43 = 138543874;
          v44 = v17;
          v45 = 2112;
          v46 = clientIdentifierCopy;
          v47 = 2112;
          v48 = identifierCopy;
          _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEBUG, "%{public}@registerForMatterFabricNotifications:YES - skip registering client %@, registrationIdentifier = %@", &v43, 0x20u);
        }

        objc_autoreleasePoolPop(v13);
        goto LABEL_35;
      }

      if (v16)
      {
        v18 = HMFGetLogIdentifier();
        v43 = 138543874;
        v44 = v18;
        v45 = 2112;
        v46 = clientIdentifierCopy;
        v47 = 2112;
        v48 = identifierCopy;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEBUG, "%{public}@registerForMatterFabricNotifications:NO - allow deregistration for client %@, registrationIdentifier = %@", &v43, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
    }

    else if (notificationsCopy)
    {
      matterFabricEnabledClients = [(HMDHome *)self matterFabricEnabledClients];
      v42 = [matterFabricEnabledClients containsObject:identifierCopy];

      if (v42)
      {
LABEL_19:
        homeManager = [(HMDHome *)self homeManager];
        matterFabricEnabledClients2 = [(HMDHome *)self matterFabricEnabledClients];
        v22 = [matterFabricEnabledClients2 count];

        if (v22)
        {
          currentMatterClientRegistration = [(HMDHome *)self currentMatterClientRegistration];
          v24 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v26 = HMFGetOSLogHandle();
          v27 = v26;
          if (currentMatterClientRegistration)
          {
            if (!os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
            {
LABEL_24:

              objc_autoreleasePoolPop(v24);
LABEL_34:

LABEL_35:
              goto LABEL_36;
            }

            v28 = HMFGetLogIdentifier();
            matterFabricEnabledClients3 = [(HMDHome *)selfCopy3 matterFabricEnabledClients];
            v43 = 138543618;
            v44 = v28;
            v45 = 2112;
            v46 = matterFabricEnabledClients3;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEBUG, "%{public}@Not updating matter fabric registration as we are registered and have the clients %@", &v43, 0x16u);

LABEL_23:
            goto LABEL_24;
          }

          if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
          {
            v38 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v38;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Updating matter fabric registration as we are not registered but have clients", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          chipDataSource = [homeManager chipDataSource];
          [chipDataSource updateNotificationsEnabled:1 forHome:selfCopy3 keepAliveOnly:1];

          v36 = selfCopy3;
          v37 = 1;
        }

        else
        {
          matterFabricEnabledClients4 = [(HMDHome *)self matterFabricEnabledClients];
          v31 = [matterFabricEnabledClients4 count];

          if (v31)
          {
            goto LABEL_34;
          }

          currentMatterClientRegistration2 = [(HMDHome *)self currentMatterClientRegistration];
          v24 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v33 = HMFGetOSLogHandle();
          v27 = v33;
          if (!currentMatterClientRegistration2)
          {
            if (!os_log_type_enabled(v33, OS_LOG_TYPE_DEBUG))
            {
              goto LABEL_24;
            }

            v28 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v28;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEBUG, "%{public}@Not updating matter fabric registration as we are not registered and have no clients", &v43, 0xCu);
            goto LABEL_23;
          }

          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            v34 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v34;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Updating matter fabric registration as we are registered but have no clients", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          chipDataSource2 = [homeManager chipDataSource];
          [chipDataSource2 updateNotificationsEnabled:0 forHome:selfCopy3 keepAliveOnly:1];

          v36 = selfCopy3;
          v37 = 0;
        }

        [(HMDHome *)v36 setCurrentMatterClientRegistration:v37];
        goto LABEL_34;
      }

      matterFabricEnabledClients5 = [(HMDHome *)self matterFabricEnabledClients];
      [matterFabricEnabledClients5 addObject:identifierCopy];
LABEL_18:

      goto LABEL_19;
    }

    matterFabricEnabledClients5 = [(HMDHome *)self matterFabricEnabledClients];
    [matterFabricEnabledClients5 removeObject:identifierCopy];
    goto LABEL_18;
  }

LABEL_36:

  v40 = *MEMORY[0x277D85DE8];
}

- (void)registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier
{
  clientIdentifierCopy = clientIdentifier;
  identifierCopy = identifier;
  workQueue = [(HMDHome *)self workQueue];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __88__HMDHome_registerForMatterFabricNotifications_registrationIdentifier_clientIdentifier___block_invoke;
  v11[3] = &unk_278685AA8;
  notificationsCopy = notifications;
  v11[4] = self;
  v11[5] = identifierCopy;
  v11[6] = clientIdentifierCopy;
  dispatch_async(workQueue, v11);
}

- (void)registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __71__HMDHome_registerForMatterFabricNotifications_registrationIdentifier___block_invoke;
  block[3] = &unk_278688BD0;
  notificationsCopy = notifications;
  block[4] = self;
  block[5] = identifierCopy;
  dispatch_async(workQueue, block);
}

- (void)_registerForAccessoryReachabilityNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier
{
  notificationsCopy = notifications;
  v40 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  clientIdentifierCopy = clientIdentifier;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  accessoryRemoteReachabilityEnabledClients = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  accessoryRemoteReachabilityEnabledClients2 = accessoryRemoteReachabilityEnabledClients;
  if (notificationsCopy)
  {
    v13 = [accessoryRemoteReachabilityEnabledClients containsObject:identifierCopy];

    if (v13)
    {
      goto LABEL_6;
    }

    accessoryRemoteReachabilityEnabledClients2 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
    [accessoryRemoteReachabilityEnabledClients2 addObject:identifierCopy];
  }

  else
  {
    [accessoryRemoteReachabilityEnabledClients removeObject:identifierCopy];
  }

LABEL_6:
  accessoryRemoteReachabilityEnabledClients3 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  v15 = [accessoryRemoteReachabilityEnabledClients3 count];

  if (v15)
  {
    currentRemoteReachabilityRegistration = [(HMDHome *)self currentRemoteReachabilityRegistration];
    v17 = objc_autoreleasePoolPush();
    selfCopy = self;
    v19 = HMFGetOSLogHandle();
    v20 = v19;
    if (currentRemoteReachabilityRegistration)
    {
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        v21 = HMFGetLogIdentifier();
        accessoryRemoteReachabilityEnabledClients4 = [(HMDHome *)selfCopy accessoryRemoteReachabilityEnabledClients];
        v36 = 138543618;
        v37 = v21;
        v38 = 2112;
        v39 = accessoryRemoteReachabilityEnabledClients4;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability registration as we are registered and have the clients %@", &v36, 0x16u);
      }

      objc_autoreleasePoolPop(v17);
    }

    else
    {
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v23;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEFAULT, "%{public}@Updating remote accessory reachability registration as we are not registered but have clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      if (clientIdentifierCopy)
      {
        v24 = clientIdentifierCopy;
      }

      else
      {
        v24 = identifierCopy;
      }

      [(HMDHome *)selfCopy __registerForRemoteAccessoryReachabilityNotifications:1 clientIdentifier:v24];
    }
  }

  accessoryRemoteReachabilityEnabledClients5 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  v26 = [accessoryRemoteReachabilityEnabledClients5 count];

  if (!v26)
  {
    currentRemoteReachabilityRegistration2 = [(HMDHome *)self currentRemoteReachabilityRegistration];
    v28 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v30 = HMFGetOSLogHandle();
    v31 = v30;
    if (currentRemoteReachabilityRegistration2)
    {
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v32 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v32;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_DEFAULT, "%{public}@Updating remote accessory reachability registration as we are registered but have no clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v28);
      if (clientIdentifierCopy)
      {
        v33 = clientIdentifierCopy;
      }

      else
      {
        v33 = identifierCopy;
      }

      [(HMDHome *)selfCopy2 __registerForRemoteAccessoryReachabilityNotifications:0 clientIdentifier:v33];
    }

    else
    {
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
      {
        v34 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v34;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability registration as we are not registered and have no clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v28);
    }
  }

  v35 = *MEMORY[0x277D85DE8];
}

- (void)registerForAccessoryReachabilityNotifications:(BOOL)notifications registrationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __80__HMDHome_registerForAccessoryReachabilityNotifications_registrationIdentifier___block_invoke;
  block[3] = &unk_278688BD0;
  notificationsCopy = notifications;
  block[4] = self;
  block[5] = identifierCopy;
  dispatch_async(workQueue, block);
}

- (void)handleLastProcessDidBecomeInactiveNotification:(id)notification
{
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __58__HMDHome_handleLastProcessDidBecomeInactiveNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = notificationCopy;
  selfCopy = self;
  v6 = notificationCopy;
  dispatch_async(workQueue, v7);
}

void __58__HMDHome_handleLastProcessDidBecomeInactiveNotification___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_stringForKey:@"HMDXPCConnectionClientIdentifierKey"];

  [*(a1 + 40) _registerForAccessoryReachabilityNotifications:0 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v3];
  [*(a1 + 40) _registerForMatterFabricNotifications:0 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v3];
  v4 = [*(a1 + 40) WiFiAssertion];

  if (v4)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 40);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Releasing WiFi assertion", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [*(a1 + 40) wifiManager];
    v10 = [*(a1 + 40) WiFiAssertion];
    [v9 endActiveAssertion:v10];

    v11 = [*(a1 + 40) wifiManager];
    [v11 releaseWoWAssertion];

    [*(a1 + 40) setWiFiAssertion:0];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleFirstProcessDidBecomeActiveNotification:(id)notification
{
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __57__HMDHome_handleFirstProcessDidBecomeActiveNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = notificationCopy;
  v6 = notificationCopy;
  dispatch_async(workQueue, v7);
}

void __57__HMDHome_handleFirstProcessDidBecomeActiveNotification___block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  if (isWatch())
  {
    if ([*(a1 + 32) remoteAccessIsEnabled])
    {
      v2 = [*(a1 + 32) WiFiAssertion];

      if (!v2)
      {
        v3 = objc_autoreleasePoolPush();
        v4 = *(a1 + 32);
        v5 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
        {
          v6 = HMFGetLogIdentifier();
          *buf = 138543362;
          v17 = v6;
          _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Taking WiFi assertion", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v3);
        v7 = [*(a1 + 32) wifiManager];
        v8 = MEMORY[0x277CCACA8];
        v9 = [*(a1 + 32) shortDescription];
        v10 = [v8 stringWithFormat:@"Remote Access for %@", v9];
        v11 = [v7 beginActiveAssertionWithOptions:0 reason:v10];
        [*(a1 + 32) setWiFiAssertion:v11];

        v12 = [*(a1 + 32) wifiManager];
        [v12 takeWoWAssertion];
      }
    }
  }

  v13 = [*(a1 + 40) userInfo];
  v14 = [v13 hmf_stringForKey:@"HMDXPCConnectionClientIdentifierKey"];

  [*(a1 + 32) _registerForAccessoryReachabilityNotifications:1 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v14];
  [*(a1 + 32) _registerForMatterFabricNotifications:1 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v14];

  v15 = *MEMORY[0x277D85DE8];
}

- (HMMDailyScheduler)dailyScheduler
{
  homeManager = [(HMDHome *)self homeManager];
  metricsManager = [homeManager metricsManager];
  dailyScheduler = [metricsManager dailyScheduler];

  return dailyScheduler;
}

- (void)setThreadOperationalDataset:(id)dataset
{
  datasetCopy = dataset;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [datasetCopy copy];
  threadOperationalDataset = self->_threadOperationalDataset;
  self->_threadOperationalDataset = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSData)threadOperationalDataset
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSData *)self->_threadOperationalDataset copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setPrimaryNetworkRouterManagingDeviceUUID:(id)d
{
  dCopy = d;
  os_unfair_recursive_lock_lock_with_options();
  primaryNetworkRouterManagingDeviceUUID = self->_primaryNetworkRouterManagingDeviceUUID;
  self->_primaryNetworkRouterManagingDeviceUUID = dCopy;

  os_unfair_recursive_lock_unlock();
}

- (NSUUID)primaryNetworkRouterManagingDeviceUUID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_primaryNetworkRouterManagingDeviceUUID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setActiveNetworkRouterInitialSetupNeeded:(BOOL)needed
{
  os_unfair_recursive_lock_lock_with_options();
  self->_activeNetworkRouterInitialSetupNeeded = needed;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isActiveNetworkRouterInitialSetupNeeded
{
  os_unfair_recursive_lock_lock_with_options();
  activeNetworkRouterInitialSetupNeeded = self->_activeNetworkRouterInitialSetupNeeded;
  os_unfair_recursive_lock_unlock();
  return activeNetworkRouterInitialSetupNeeded;
}

- (void)setActiveNetworkRouterUUID:(id)d
{
  dCopy = d;
  os_unfair_recursive_lock_lock_with_options();
  activeNetworkRouterUUID = self->_activeNetworkRouterUUID;
  self->_activeNetworkRouterUUID = dCopy;

  os_unfair_recursive_lock_unlock();
}

- (NSUUID)activeNetworkRouterUUID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_activeNetworkRouterUUID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setRouterClientManager:(id)manager
{
  managerCopy = manager;
  os_unfair_recursive_lock_lock_with_options();
  routerClientManager = self->_routerClientManager;
  self->_routerClientManager = managerCopy;

  os_unfair_recursive_lock_unlock();
}

- (HMDNetworkRouterClientManager)routerClientManager
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_routerClientManager;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)change
{
  changeCopy = change;
  os_unfair_recursive_lock_lock_with_options();
  minHomeKitVersionForAccessoryNetworkProtectionChange = self->_minHomeKitVersionForAccessoryNetworkProtectionChange;
  self->_minHomeKitVersionForAccessoryNetworkProtectionChange = changeCopy;

  os_unfair_recursive_lock_unlock();
}

- (HMDHomeKitVersion)minHomeKitVersionForAccessoryNetworkProtectionChange
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_minHomeKitVersionForAccessoryNetworkProtectionChange;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setMinimumNetworkRouterSupportHomeKitVersion:(id)version
{
  versionCopy = version;
  os_unfair_recursive_lock_lock_with_options();
  minimumNetworkRouterSupportHomeKitVersion = self->_minimumNetworkRouterSupportHomeKitVersion;
  self->_minimumNetworkRouterSupportHomeKitVersion = versionCopy;

  os_unfair_recursive_lock_unlock();
}

- (HMDHomeKitVersion)minimumNetworkRouterSupportHomeKitVersion
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_minimumNetworkRouterSupportHomeKitVersion;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNetworkRouterSupport:(unint64_t)support
{
  os_unfair_recursive_lock_lock_with_options();
  self->_networkRouterSupport = support;

  os_unfair_recursive_lock_unlock();
}

- (unint64_t)networkRouterSupport
{
  os_unfair_recursive_lock_lock_with_options();
  networkRouterSupport = self->_networkRouterSupport;
  os_unfair_recursive_lock_unlock();
  return networkRouterSupport;
}

- (void)setNetworkRouterSupportDisableReason:(unint64_t)reason
{
  os_unfair_recursive_lock_lock_with_options();
  self->_networkRouterSupportDisableReason = reason;

  os_unfair_recursive_lock_unlock();
}

- (unint64_t)networkRouterSupportDisableReason
{
  os_unfair_recursive_lock_lock_with_options();
  networkRouterSupportDisableReason = self->_networkRouterSupportDisableReason;
  os_unfair_recursive_lock_unlock();
  return networkRouterSupportDisableReason;
}

- (void)setProtectionMode:(int64_t)mode
{
  os_unfair_recursive_lock_lock_with_options();
  self->_protectionMode = mode;

  os_unfair_recursive_lock_unlock();
}

- (int64_t)protectionMode
{
  os_unfair_recursive_lock_lock_with_options();
  protectionMode = self->_protectionMode;
  os_unfair_recursive_lock_unlock();
  return protectionMode;
}

- (id)retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:(id)identifier
{
  identifierCopy = identifier;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableDictionary *)self->_newlyConfiguredAccessories objectForKeyedSubscript:identifierCopy];
  v6 = [v5 copy];

  if (v6)
  {
    [(NSMutableDictionary *)self->_newlyConfiguredAccessories removeObjectForKey:identifierCopy];
    v7 = v6;
  }

  else
  {
    v7 = MEMORY[0x277CBEBF8];
  }

  v8 = v7;

  os_unfair_recursive_lock_unlock();

  return v8;
}

- (NSMapTable)addPendingAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMapTable *)self->_addPendingAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSMutableDictionary)addPendingAccessorySetupCodeHandlers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableDictionary *)self->_addPendingAccessorySetupCodeHandlers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSHashTable)removeAccessoryInProgressForHMDAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSHashTable *)self->_removeAccessoryInProgressForHMDAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)removeFromCurrentTriggers:(id)triggers
{
  triggersCopy = triggers;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_currentTriggers containsObject:triggersCopy])
  {
    [(NSMutableArray *)self->_currentTriggers removeObject:triggersCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addToCurrentTriggers:(id)triggers
{
  triggersCopy = triggers;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_currentTriggers containsObject:triggersCopy]& 1) == 0)
  {
    [(NSMutableArray *)self->_currentTriggers addObject:triggersCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (NSArray)triggers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_currentTriggers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)addNewlyConfiguredAccessories:(id)accessories addSessionIdentifier:(id)identifier
{
  accessoriesCopy = accessories;
  identifierCopy = identifier;
  os_unfair_recursive_lock_lock_with_options();
  v7 = [(NSMutableDictionary *)self->_newlyConfiguredAccessories objectForKeyedSubscript:identifierCopy];
  if (!v7)
  {
    v7 = [MEMORY[0x277CBEB18] arrayWithCapacity:1];
    [(NSMutableDictionary *)self->_newlyConfiguredAccessories setObject:v7 forKeyedSubscript:identifierCopy];
  }

  [v7 addObjectsFromArray:accessoriesCopy];

  os_unfair_recursive_lock_unlock();
}

- (id)allNewlyConfiguredAccessories
{
  v16 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  array = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  allValues = [(NSMutableDictionary *)self->_newlyConfiguredAccessories allValues];
  v5 = [allValues countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = *v12;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(allValues);
        }

        [array addObjectsFromArray:*(*(&v11 + 1) + 8 * i)];
      }

      v5 = [allValues countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v5);
  }

  v8 = [array copy];
  os_unfair_recursive_lock_unlock();
  v9 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)setAnyBTLEAccessoryReachable:(BOOL)reachable
{
  os_unfair_recursive_lock_lock_with_options();
  self->_anyBTLEAccessoryReachable = reachable;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isAnyBTLEAccessoryReachable
{
  os_unfair_recursive_lock_lock_with_options();
  anyBTLEAccessoryReachable = self->_anyBTLEAccessoryReachable;
  os_unfair_recursive_lock_unlock();
  return anyBTLEAccessoryReachable;
}

- (void)setName:(id)name
{
  nameCopy = name;
  os_unfair_recursive_lock_lock_with_options();
  hm_truncatedNameString = [nameCopy hm_truncatedNameString];
  name = self->_name;
  self->_name = hm_truncatedNameString;

  os_unfair_recursive_lock_unlock();
}

- (NSString)name
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_name;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (HMDFeaturesDataSource)featuresDataSource
{
  dataSource = [(HMDHome *)self dataSource];
  featuresDataSource = [dataSource featuresDataSource];

  return featuresDataSource;
}

- (id)dumpStateWithPrivacyLevel:(unint64_t)level
{
  v200 = *MEMORY[0x277D85DE8];
  v158 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:12];
  v152 = MEMORY[0x277CCACA8];
  name = [(HMDHome *)self name];
  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];
  spiClientIdentifier = [(HMDHome *)self spiClientIdentifier];
  uUIDString2 = [spiClientIdentifier UUIDString];
  zoneID = [(HMDHome *)self zoneID];
  uUIDString3 = [zoneID UUIDString];
  [(HMDHome *)self isMultiUserEnabled];
  v9 = HMFBooleanToString();
  [(HMDHome *)self hasAnyUserAcknowledgedCameraRecordingOnboarding];
  v10 = HMFBooleanToString();
  urlString = [(HMDHome *)self urlString];
  v12 = [v152 stringWithFormat:@"name: %@, uuid: %@, spiClientIdentifier: %@, zoneID: %@, multiUserEnabled: %@, acknowledgedCameraOnboarding: %@, assistantIdentifier: %@", name, uUIDString, uUIDString2, uUIDString3, v9, v10, urlString];

  v146 = v12;
  [v158 setObject:v12 forKeyedSubscript:*MEMORY[0x277D0F170]];
  appData = [(HMDHome *)self appData];
  v14 = [appData dumpStateWithPrivacyLevel:level];
  [v158 setObject:v14 forKeyedSubscript:*MEMORY[0x277D0F050]];

  v15 = [(HMDHome *)self homeLocationWithPrivacyLevel:level];
  v16 = v15;
  v17 = MEMORY[0x277CCACA8];
  if (v15)
  {
    v18 = v15;
  }

  else
  {
    v18 = @"Unknown";
  }

  homeLocationHandler = [(HMDHome *)self homeLocationHandler];
  [homeLocationHandler regionStateAtHome];
  v20 = HMRegionStateString();
  homeLocationHandler2 = [(HMDHome *)self homeLocationHandler];
  [homeLocationHandler2 regionStateNearbyHome];
  v22 = HMRegionStateString();
  selfCopy = self;
  atHomeLevel = [(HMDHome *)self atHomeLevel];
  v145 = v16;
  v153 = homeLocationHandler2;
  v156 = homeLocationHandler;
  v24 = v20;
  if (atHomeLevel > 3)
  {
    v25 = @"HMDAtHomeLevelNotAtHome";
  }

  else
  {
    v25 = off_278670AF0[atHomeLevel];
  }

  [(HMDHome *)self homeLocation];
  v26 = HMStringFromHomeLocation();
  homeLocationHandler3 = [(HMDHome *)self homeLocationHandler];
  v28 = HMDHomeLocationSourceToString([homeLocationHandler3 locationSource]);
  v29 = [v17 stringWithFormat:@"Location: %@, At Home Region State: %@, Nearby Home Region State: %@, At Home Level: %@, State: %@, Source: %@", v18, v24, v22, v25, v26, v28];

  v30 = v158;
  v144 = v29;
  [v158 setObject:v29 forKeyedSubscript:*MEMORY[0x277D0F0F8]];
  featuresDataSource = [(HMDHome *)self featuresDataSource];
  isHomeActivityStateFeatureEnabled = [featuresDataSource isHomeActivityStateFeatureEnabled];

  if (isHomeActivityStateFeatureEnabled)
  {
    homeActivityStateManager = [(HMDHome *)self homeActivityStateManager];
    v34 = [homeActivityStateManager dumpStateWithPrivacyLevel:level];
    [v158 setObject:v34 forKeyedSubscript:@"HMDHomeActivityStateManager"];

    userActivityStateDetectorManager = [(HMDHome *)self userActivityStateDetectorManager];
    v36 = [userActivityStateDetectorManager dumpStateWithPrivacyLevel:level];
    [v158 setObject:v36 forKeyedSubscript:@"HMDUserActivityStateDetectorManager"];
  }

  v37 = MEMORY[0x277CCACA8];
  [(HMDHome *)self minimumMediaUserPrivilege];
  v38 = HMUserPrivilegeToString();
  [(HMDHome *)self isMediaPeerToPeerEnabled];
  v39 = HMFBooleanToString();
  mediaPassword = [(HMDHome *)self mediaPassword];
  v41 = @"<set>";
  if (!mediaPassword)
  {
    v41 = @"<null>";
  }

  v42 = [v37 stringWithFormat:@"Minimum Media User Privilege: %@, Media Peer to Peer Enabled: %@, has Media Password: %@", v38, v39, v41];

  v143 = v42;
  [v158 setObject:v42 forKeyedSubscript:@"User Privilege"];
  rooms = [(HMDHome *)self rooms];
  v44 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(rooms, "count") + 1}];
  roomForEntireHome = [(HMDHome *)self roomForEntireHome];

  if (roomForEntireHome)
  {
    roomForEntireHome2 = [(HMDHome *)self roomForEntireHome];
    v47 = [roomForEntireHome2 dumpStateWithPrivacyLevel:level];
    [v44 addObject:v47];
  }

  v187 = 0u;
  v188 = 0u;
  v185 = 0u;
  v186 = 0u;
  v48 = rooms;
  v49 = [v48 countByEnumeratingWithState:&v185 objects:v199 count:16];
  if (v49)
  {
    v50 = v49;
    v51 = *v186;
    do
    {
      for (i = 0; i != v50; ++i)
      {
        if (*v186 != v51)
        {
          objc_enumerationMutation(v48);
        }

        v53 = [*(*(&v185 + 1) + 8 * i) dumpStateWithPrivacyLevel:level];
        [v44 addObject:v53];
      }

      v50 = [v48 countByEnumeratingWithState:&v185 objects:v199 count:16];
    }

    while (v50);
  }

  if ([v44 count])
  {
    [v158 setObject:v44 forKeyedSubscript:*MEMORY[0x277D0F140]];
  }

  zones = [(HMDHome *)self zones];
  if ([zones count])
  {
    v54 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(zones, "count")}];
    v181 = 0u;
    v182 = 0u;
    v183 = 0u;
    v184 = 0u;
    v55 = zones;
    v56 = [v55 countByEnumeratingWithState:&v181 objects:v198 count:16];
    if (v56)
    {
      v57 = v56;
      v58 = *v182;
      do
      {
        for (j = 0; j != v57; ++j)
        {
          if (*v182 != v58)
          {
            objc_enumerationMutation(v55);
          }

          v60 = [*(*(&v181 + 1) + 8 * j) dumpStateWithPrivacyLevel:level];
          [v54 addObject:v60];
        }

        v57 = [v55 countByEnumeratingWithState:&v181 objects:v198 count:16];
      }

      while (v57);
    }

    [v158 setObject:v54 forKeyedSubscript:*MEMORY[0x277D0F198]];
    self = selfCopy;
  }

  accessories = [(HMDHome *)self accessories];
  v62 = [accessories copy];

  v154 = v62;
  if ([v62 count])
  {
    v63 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v62, "count")}];
    v177 = 0u;
    v178 = 0u;
    v179 = 0u;
    v180 = 0u;
    v64 = v154;
    v65 = [v64 countByEnumeratingWithState:&v177 objects:v197 count:16];
    if (v65)
    {
      v66 = v65;
      v67 = *v178;
      do
      {
        for (k = 0; k != v66; ++k)
        {
          if (*v178 != v67)
          {
            objc_enumerationMutation(v64);
          }

          v69 = *(*(&v177 + 1) + 8 * k);
          v70 = objc_autoreleasePoolPush();
          v71 = [v69 dumpStateWithPrivacyLevel:level];
          [v63 addObject:v71];

          objc_autoreleasePoolPop(v70);
        }

        v66 = [v64 countByEnumeratingWithState:&v177 objects:v197 count:16];
      }

      while (v66);
    }

    v30 = v158;
    [v158 setObject:v63 forKeyedSubscript:*MEMORY[0x277D0F028]];

    self = selfCopy;
  }

  serviceGroups = [(HMDHome *)self serviceGroups];
  if ([serviceGroups count])
  {
    v72 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(serviceGroups, "count")}];
    v173 = 0u;
    v174 = 0u;
    v175 = 0u;
    v176 = 0u;
    v73 = serviceGroups;
    v74 = [v73 countByEnumeratingWithState:&v173 objects:v196 count:16];
    if (v74)
    {
      v75 = v74;
      v76 = *v174;
      do
      {
        for (m = 0; m != v75; ++m)
        {
          if (*v174 != v76)
          {
            objc_enumerationMutation(v73);
          }

          v78 = [*(*(&v173 + 1) + 8 * m) dumpStateWithPrivacyLevel:level];
          [v72 addObject:v78];
        }

        v75 = [v73 countByEnumeratingWithState:&v173 objects:v196 count:16];
      }

      while (v75);
    }

    [v30 setObject:v72 forKeyedSubscript:*MEMORY[0x277D0F148]];
    self = selfCopy;
  }

  triggers = [(HMDHome *)self triggers];
  if ([triggers count])
  {
    v79 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(triggers, "count")}];
    v169 = 0u;
    v170 = 0u;
    v171 = 0u;
    v172 = 0u;
    v80 = triggers;
    v81 = [v80 countByEnumeratingWithState:&v169 objects:v195 count:16];
    if (v81)
    {
      v82 = v81;
      v83 = *v170;
      do
      {
        for (n = 0; n != v82; ++n)
        {
          if (*v170 != v83)
          {
            objc_enumerationMutation(v80);
          }

          v85 = [*(*(&v169 + 1) + 8 * n) dumpStateWithPrivacyLevel:level];
          [v79 addObject:v85];
        }

        v82 = [v80 countByEnumeratingWithState:&v169 objects:v195 count:16];
      }

      while (v82);
    }

    [v30 setObject:v79 forKeyedSubscript:*MEMORY[0x277D0F188]];
    self = selfCopy;
  }

  currentUser = [(HMDHome *)self currentUser];
  v87 = [currentUser dumpStateWithPrivacyLevel:level];
  [v30 setObject:v87 forKeyedSubscript:*MEMORY[0x277D0F090]];

  v148 = [(HMDHome *)self usersIncludingPendingUsers:1];
  if ([v148 count])
  {
    v88 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v148, "count")}];
    v165 = 0u;
    v166 = 0u;
    v167 = 0u;
    v168 = 0u;
    v89 = v148;
    v90 = [v89 countByEnumeratingWithState:&v165 objects:v194 count:16];
    if (v90)
    {
      v91 = v90;
      v92 = *v166;
      do
      {
        for (ii = 0; ii != v91; ++ii)
        {
          if (*v166 != v92)
          {
            objc_enumerationMutation(v89);
          }

          v94 = [*(*(&v165 + 1) + 8 * ii) dumpStateWithPrivacyLevel:level];
          [v88 addObject:v94];
        }

        v91 = [v89 countByEnumeratingWithState:&v165 objects:v194 count:16];
      }

      while (v91);
    }

    [v30 setObject:v88 forKeyedSubscript:*MEMORY[0x277D0F190]];
    self = selfCopy;
  }

  removedUsers = [(HMDHome *)self removedUsers];
  if ([removedUsers count])
  {
    v95 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(removedUsers, "count")}];
    v161 = 0u;
    v162 = 0u;
    v163 = 0u;
    v164 = 0u;
    v96 = removedUsers;
    v97 = [v96 countByEnumeratingWithState:&v161 objects:v193 count:16];
    if (v97)
    {
      v98 = v97;
      v99 = *v162;
      do
      {
        for (jj = 0; jj != v98; ++jj)
        {
          if (*v162 != v99)
          {
            objc_enumerationMutation(v96);
          }

          user = [*(*(&v161 + 1) + 8 * jj) user];
          v102 = [user dumpStateWithPrivacyLevel:level];
          [v95 addObject:v102];
        }

        v98 = [v96 countByEnumeratingWithState:&v161 objects:v193 count:16];
      }

      while (v98);
    }

    v30 = v158;
    [v158 setObject:v95 forKeyedSubscript:*MEMORY[0x277D0F130]];

    self = selfCopy;
  }

  residentDeviceManager = [(HMDHome *)self residentDeviceManager];

  if (residentDeviceManager)
  {
    residentDeviceManager2 = [(HMDHome *)self residentDeviceManager];
    dumpState = [residentDeviceManager2 dumpState];
    [v30 setObject:dumpState forKeyedSubscript:*MEMORY[0x277D0F138]];
  }

  v141 = MEMORY[0x277CBEB38];
  v191[0] = @"Registered";
  notificationRegistrations = [(HMDHome *)self notificationRegistrations];
  allObjects = [notificationRegistrations allObjects];
  v192[0] = allObjects;
  v191[1] = @"Apple Media Registered";
  notificationRegistrationsForAppleMediaAccessories = [(HMDHome *)selfCopy notificationRegistrationsForAppleMediaAccessories];
  allObjects2 = [notificationRegistrationsForAppleMediaAccessories allObjects];
  v192[1] = allObjects2;
  v191[2] = @"Deregistered";
  notificationDeregistrations = [(HMDHome *)selfCopy notificationDeregistrations];
  allObjects3 = [notificationDeregistrations allObjects];
  v192[2] = allObjects3;
  v111 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v192 forKeys:v191 count:3];
  v112 = [v141 dictionaryWithDictionary:v111];

  notificationsUpdatedTime = [(HMDHome *)selfCopy notificationsUpdatedTime];

  if (notificationsUpdatedTime)
  {
    notificationsUpdatedTime2 = [(HMDHome *)selfCopy notificationsUpdatedTime];
    shortDescription = [notificationsUpdatedTime2 shortDescription];
    [v112 setObject:shortDescription forKey:@"UpdateTime"];
  }

  [v158 setObject:v112 forKeyedSubscript:*MEMORY[0x277D0F0C8]];
  pendingResponses = [(HMDHome *)selfCopy pendingResponses];
  v117 = [pendingResponses description];
  [v158 setObject:v117 forKeyedSubscript:*MEMORY[0x277D0F118]];

  sharedHomeUpdateHandler = [(HMDHome *)selfCopy sharedHomeUpdateHandler];
  v119 = [sharedHomeUpdateHandler dumpStateWithPrivacyLevel:level];
  [v158 setObject:v119 forKeyedSubscript:*MEMORY[0x277D0F160]];

  sharedHomeSourceVersion = [(HMDHome *)selfCopy sharedHomeSourceVersion];
  versionString = [sharedHomeSourceVersion versionString];
  [v158 setObject:versionString forKeyedSubscript:*MEMORY[0x277D0F158]];

  v122 = MEMORY[0x277CCACA8];
  unfilteredThreadNetworkID = [(HMDHome *)selfCopy unfilteredThreadNetworkID];
  v123 = [v122 stringWithFormat:@"threadNetworkID=%@", unfilteredThreadNetworkID];
  [v158 setObject:v123 forKeyedSubscript:@"ThreadNetwork"];

  personManagerSettings = [(HMDHome *)selfCopy personManagerSettings];
  v126 = [personManagerSettings description];
  [v158 setObject:v126 forKeyedSubscript:@"Person Manager Settings"];

  labelsByAccessCode = [(HMDHome *)selfCopy labelsByAccessCode];
  v128 = [labelsByAccessCode description];
  [v158 setObject:v128 forKeyedSubscript:@"Simple Label Access Codes"];

  labelIdentifiersByAccessCode = [(HMDHome *)selfCopy labelIdentifiersByAccessCode];
  v130 = [labelIdentifiersByAccessCode description];
  [v158 setObject:v130 forKeyedSubscript:@"Simple Label Access Code Identifiers"];

  chipStorage = [(HMDHome *)selfCopy chipStorage];
  debugDictionaryRepresentation = [chipStorage debugDictionaryRepresentation];
  [v158 setObject:debugDictionaryRepresentation forKeyedSubscript:@"CHIP Home Storage"];

  controllerPrivateStorage = [(HMDHome *)selfCopy controllerPrivateStorage];
  debugDictionaryRepresentation2 = [controllerPrivateStorage debugDictionaryRepresentation];
  [v158 setObject:debugDictionaryRepresentation2 forKeyedSubscript:@"CHIP Controller Private Storage"];

  v189[0] = @"HomeSettingEnabled";
  [(HMDHome *)selfCopy isEventLogHomeSettingEnabled];
  v135 = HMFBooleanToString();
  v190[0] = v135;
  v189[1] = @"DidOnboard";
  [(HMDHome *)selfCopy didOnboardEventLog];
  v136 = HMFBooleanToString();
  v190[1] = v136;
  v189[2] = @"Duration";
  v137 = [MEMORY[0x277CCACA8] stringWithFormat:@"%lu", -[HMDHome eventLogDuration](selfCopy, "eventLogDuration")];
  v190[2] = v137;
  v138 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v190 forKeys:v189 count:3];
  [v158 setObject:v138 forKeyedSubscript:@"Activity History"];

  v139 = *MEMORY[0x277D85DE8];

  return v158;
}

- (id)homeLocationWithPrivacyLevel:(unint64_t)level
{
  if (level == 2)
  {
    homeLocationHandler = [(HMDHome *)self homeLocationHandler];
    location = [homeLocationHandler location];
  }

  else
  {
    location = 0;
  }

  return location;
}

- (id)descriptionWithPointer:(BOOL)pointer
{
  pointerCopy = pointer;
  v5 = MEMORY[0x277CCACA8];
  shortDescription = [objc_opt_class() shortDescription];
  if (pointerCopy)
  {
    v7 = [MEMORY[0x277CCACA8] stringWithFormat:@" %p", self];
  }

  else
  {
    v7 = &stru_283CF9D50;
  }

  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];
  spiClientIdentifier = [(HMDHome *)self spiClientIdentifier];
  uUIDString2 = [spiClientIdentifier UUIDString];
  name = [(HMDHome *)self name];
  v13 = [v5 stringWithFormat:@"<%@%@, ID = %@, spiID = %@, NM = %@>", shortDescription, v7, uUIDString, uUIDString2, name];

  if (pointerCopy)
  {
  }

  return v13;
}

- (id)shortDescription
{
  if (isInternalBuild())
  {
    v3 = MEMORY[0x277CCACA8];
    name = [(HMDHome *)self name];
    uuid = [(HMDHome *)self uuid];
    uUIDString = [v3 stringWithFormat:@"%@/%@", name, uuid];
  }

  else
  {
    name = [(HMDHome *)self uuid];
    uUIDString = [name UUIDString];
  }

  return uUIDString;
}

- (void)dealloc
{
  [(HMDHome *)self unconfigure];
  v3.receiver = self;
  v3.super_class = HMDHome;
  [(HMDHome *)&v3 dealloc];
}

- (void)unconfigure
{
  notificationCenter = [(HMDHome *)self notificationCenter];
  [notificationCenter removeObserver:self];

  msgDispatcher = [(HMDHome *)self msgDispatcher];
  [msgDispatcher deregisterReceiver:self];

  mediaGroupsAggregateConsumer = [(HMDHome *)self mediaGroupsAggregateConsumer];
  [mediaGroupsAggregateConsumer unconfigure];

  accessCodeManager = [(HMDHome *)self accessCodeManager];
  [accessCodeManager unconfigure];

  nfcReaderKeyManager = [(HMDHome *)self nfcReaderKeyManager];
  [nfcReaderKeyManager unconfigure];

  walletKeyManager = [(HMDHome *)self walletKeyManager];
  [walletKeyManager unconfigure];

  homeActivityStateManager = [(HMDHome *)self homeActivityStateManager];
  [homeActivityStateManager unconfigure];

  swiftExtensions = [(HMDHome *)self swiftExtensions];
  [swiftExtensions unconfigureWithHome:self];

  defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
  backingStore = [(HMDHome *)self backingStore];
  [defaultCenter removeObserver:backingStore];
}

- (HMDHome)initWithName:(id)name uuid:(id)uuid defaultRoomUUID:(id)d owner:(id)owner homeManager:(id)manager presenceAuth:(id)auth dataSource:(id)source logEventSubmitter:(id)self0 carPlayDataSource:(id)self1 administratorHandlerFactory:(id)self2 localCapabilitiesDataSource:(id)self3 notificationCenter:(id)self4 keychainStore:(id)self5
{
  v328 = *MEMORY[0x277D85DE8];
  nameCopy = name;
  uuidCopy = uuid;
  dCopy = d;
  ownerCopy = owner;
  obj = manager;
  authCopy = auth;
  authCopy2 = auth;
  sourceCopy = source;
  submitterCopy = submitter;
  dataSourceCopy = dataSource;
  factoryCopy = factory;
  capabilitiesDataSourceCopy = capabilitiesDataSource;
  centerCopy = center;
  storeCopy = store;
  v323.receiver = self;
  v323.super_class = HMDHome;
  v22 = [(HMDHome *)&v323 init];
  v23 = v22;
  if (v22)
  {
    objc_storeStrong(&v22->_dataSource, source);
    +[HMDHome _initialize];
    v302 = [obj sharedUserAcceptEventBuilderForHomeUuid:uuidCopy];
    [v302 markCreatedHome];
    objc_storeStrong(&v23->_localCapabilitiesDataSource, capabilitiesDataSource);
    v24 = HMFGetOSLogHandle();
    logger = v23->_logger;
    v23->_logger = v24;

    if (uuidCopy)
    {
      uUID = [uuidCopy copy];
    }

    else
    {
      uUID = [MEMORY[0x277CCAD78] UUID];
    }

    v26 = [MEMORY[0x277D0F890] hmf_cachedInstanceForNSUUID:uUID];
    uuid = v23->_uuid;
    v23->_uuid = v26;

    v300 = spiClientIdentifierForUUID(v23->_uuid);
    v28 = [MEMORY[0x277D0F890] hmf_cachedInstanceForNSUUID:v300];
    spiClientIdentifier = v23->_spiClientIdentifier;
    v23->_spiClientIdentifier = v28;

    uUIDString = [(NSUUID *)v23->_uuid UUIDString];
    v306 = [@"com.apple.hmd.home" stringByAppendingString:uUIDString];

    v31 = v306;
    uTF8String = [v306 UTF8String];
    v33 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
    v34 = dispatch_queue_create(uTF8String, v33);
    workQueue = v23->_workQueue;
    v23->_workQueue = v34;

    [MEMORY[0x277D0F7A8] blessWithImplicitContext:v23->_workQueue];
    objc_storeStrong(&v23->_notificationCenter, center);
    v36 = [[HMDPrimaryResidentChangeMonitor alloc] initWithIdentifier:v23->_uuid notificationCenter:centerCopy];
    primaryResidentChangeMonitor = v23->_primaryResidentChangeMonitor;
    v23->_primaryResidentChangeMonitor = v36;

    [(HMDPrimaryResidentChangeMonitor *)v23->_primaryResidentChangeMonitor setDataSource:v23];
    objc_storeStrong(&v23->_logEventSubmitter, submitter);
    objc_storeStrong(&v23->_keychainStore, store);
    makeReportingSessionManager = [sourceCopy makeReportingSessionManager];
    reportingSessionManager = v23->_reportingSessionManager;
    v23->_reportingSessionManager = makeReportingSessionManager;

    if (submitterCopy)
    {
      v40 = [sourceCopy makeHomeMetricsDispatcherWithIdentifier:v23->_uuid logEventSubmitter:submitterCopy];
      metricsDispatcher = v23->_metricsDispatcher;
      v23->_metricsDispatcher = v40;
    }

    hm_truncatedNameString = [nameCopy hm_truncatedNameString];
    v43 = [hm_truncatedNameString copy];
    name = v23->_name;
    v23->_name = v43;

    v45 = [HMDHome zoneIDFromHomeUUID:v23->_uuid];
    zoneID = v23->_zoneID;
    v23->_zoneID = v45;

    objc_storeWeak(&v23->_homeManager, obj);
    messageDispatcher = [obj messageDispatcher];
    msgDispatcher = v23->_msgDispatcher;
    v23->_msgDispatcher = messageDispatcher;

    objc_storeStrong(&v23->_owner, owner);
    v23->_ownerTrustZoneCapable = [ownerCopy isCurrentUser];
    pairingUsername = [ownerCopy pairingUsername];
    ownerName = v23->_ownerName;
    v23->_ownerName = pairingUsername;

    v23->_allowsRemoteAccess = 1;
    v51 = +[HMDHomeKitVersion currentVersion];
    currentHomeKitVersion = v23->_currentHomeKitVersion;
    v23->_currentHomeKitVersion = v51;

    v53 = objc_autoreleasePoolPush();
    v54 = v23;
    v55 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v55, OS_LOG_TYPE_INFO))
    {
      v56 = HMFGetLogIdentifier();
      *buf = 138543618;
      v325 = v56;
      v326 = 2112;
      v327 = authCopy2;
      _os_log_impl(&dword_229538000, v55, OS_LOG_TYPE_INFO, "%{public}@Home Presence auth : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v53);
    if (authCopy2)
    {
      objc_storeStrong(&v54->_presenceAuthStatus, authCopy);
    }

    presenceComputeStatus = v54->_presenceComputeStatus;
    v54->_presenceComputeStatus = 0;

    v54->_homeLocation = 0;
    v58 = [MEMORY[0x277CBEB58] set];
    reachabilityUpdatedAccessories = v54->_reachabilityUpdatedAccessories;
    v54->_reachabilityUpdatedAccessories = v58;

    v60 = [[HMDHomeObjectChangeHandler alloc] initWithHome:v54];
    homeObjectChangeHandler = v54->_homeObjectChangeHandler;
    v54->_homeObjectChangeHandler = v60;

    accessoryBrowser = [obj accessoryBrowser];
    accessoryBrowser = v54->_accessoryBrowser;
    v54->_accessoryBrowser = accessoryBrowser;

    array = [MEMORY[0x277CBEB18] array];
    rooms = v54->_rooms;
    v54->_rooms = array;

    array2 = [MEMORY[0x277CBEB18] array];
    zones = v54->_zones;
    v54->_zones = array2;

    dictionary = [MEMORY[0x277CBEB38] dictionary];
    accessories = v54->_accessories;
    v54->_accessories = dictionary;

    array3 = [MEMORY[0x277CBEB18] array];
    serviceGroups = v54->_serviceGroups;
    v54->_serviceGroups = array3;

    array4 = [MEMORY[0x277CBEB18] array];
    actionSets = v54->_actionSets;
    v54->_actionSets = array4;

    array5 = [MEMORY[0x277CBEB18] array];
    currentTriggers = v54->_currentTriggers;
    v54->_currentTriggers = array5;

    array6 = [MEMORY[0x277CBEB18] array];
    triggerOwnedActionSets = v54->_triggerOwnedActionSets;
    v54->_triggerOwnedActionSets = array6;

    array7 = [MEMORY[0x277CBEB18] array];
    users = v54->_users;
    v54->_users = array7;

    array8 = [MEMORY[0x277CBEB18] array];
    usersPendingUserManagementOperations = v54->_usersPendingUserManagementOperations;
    v54->_usersPendingUserManagementOperations = array8;

    array9 = [MEMORY[0x277CBEB18] array];
    removedUsers = v54->_removedUsers;
    v54->_removedUsers = array9;

    array10 = [MEMORY[0x277CBEB18] array];
    outgoingInvitations = v54->_outgoingInvitations;
    v54->_outgoingInvitations = array10;

    array11 = [MEMORY[0x277CBEB18] array];
    ownedTriggers = v54->_ownedTriggers;
    v54->_ownedTriggers = array11;

    v88 = [MEMORY[0x277CBEB58] set];
    pendingResponsesForRemoteAccessSetup = v54->_pendingResponsesForRemoteAccessSetup;
    v54->_pendingResponsesForRemoteAccessSetup = v88;

    dictionary2 = [MEMORY[0x277CBEB38] dictionary];
    enableNotificationPayload = v54->_enableNotificationPayload;
    v54->_enableNotificationPayload = dictionary2;

    dictionary3 = [MEMORY[0x277CBEB38] dictionary];
    disableNotificationPayload = v54->_disableNotificationPayload;
    v54->_disableNotificationPayload = dictionary3;

    dictionary4 = [MEMORY[0x277CBEB38] dictionary];
    pendingCharacteristicThresholdPayload = v54->_pendingCharacteristicThresholdPayload;
    v54->_pendingCharacteristicThresholdPayload = dictionary4;

    array12 = [MEMORY[0x277CBEB18] array];
    actionSetsEnableNotificationPayload = v54->_actionSetsEnableNotificationPayload;
    v54->_actionSetsEnableNotificationPayload = array12;

    array13 = [MEMORY[0x277CBEB18] array];
    actionSetsDisableNotificationPayload = v54->_actionSetsDisableNotificationPayload;
    v54->_actionSetsDisableNotificationPayload = array13;

    dictionary5 = [MEMORY[0x277CBEB38] dictionary];
    matterAttributesEnableNotificationPayload = v54->_matterAttributesEnableNotificationPayload;
    v54->_matterAttributesEnableNotificationPayload = dictionary5;

    dictionary6 = [MEMORY[0x277CBEB38] dictionary];
    notificationHandlerMap = v54->_notificationHandlerMap;
    v54->_notificationHandlerMap = dictionary6;

    v104 = [MEMORY[0x277CBEB58] set];
    notificationRegistrations = v54->_notificationRegistrations;
    v54->_notificationRegistrations = v104;

    v106 = [MEMORY[0x277CBEB58] set];
    notificationRegistrationsForAppleMediaAccessories = v54->_notificationRegistrationsForAppleMediaAccessories;
    v54->_notificationRegistrationsForAppleMediaAccessories = v106;

    v108 = [MEMORY[0x277CBEB58] set];
    notificationDeregistrations = v54->_notificationDeregistrations;
    v54->_notificationDeregistrations = v108;

    distantFuture = [MEMORY[0x277CBEAA8] distantFuture];
    notificationsUpdatedTime = v54->_notificationsUpdatedTime;
    v54->_notificationsUpdatedTime = distantFuture;

    strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    uuidToHAPAccessoryConfigTable = v54->_uuidToHAPAccessoryConfigTable;
    v54->_uuidToHAPAccessoryConfigTable = strongToStrongObjectsMapTable;

    v114 = +[HMDAppleAccountSettings sharedSettings];
    accountSettings = v54->_accountSettings;
    v54->_accountSettings = v114;

    objc_storeStrong(&v54->_carPlayDataSource, dataSource);
    if (isiOSDevice())
    {
      v116 = [MEMORY[0x277CBEB58] set];
      heartbeatPingMessagesQueuedWithServer = v54->_heartbeatPingMessagesQueuedWithServer;
      v54->_heartbeatPingMessagesQueuedWithServer = v116;
    }

    if (ownerCopy)
    {
      [(NSMutableArray *)v54->_users addObject:ownerCopy];
      [ownerCopy setHome:v54];
    }

    v118 = [HMDRoom alloc];
    v119 = HMDDefaultRoomName();
    v120 = [(HMDRoom *)v118 initWithName:v119 uuid:dCopy home:v54];
    roomForEntireHome = v54->_roomForEntireHome;
    v54->_roomForEntireHome = v120;

    v54->_configurationVersion = 0;
    v54->_previousReachableAccessoriesCount = 0;
    v54->_previousReachableAppleMediaAccessoriesCount = 0;
    array14 = [MEMORY[0x277CBEB18] array];
    unconfiguredResidentDevices = v54->_unconfiguredResidentDevices;
    v54->_unconfiguredResidentDevices = array14;

    weakObjectsHashTable = [MEMORY[0x277CCAA50] weakObjectsHashTable];
    removeAccessoryInProgressForHMDAccessories = v54->_removeAccessoryInProgressForHMDAccessories;
    v54->_removeAccessoryInProgressForHMDAccessories = weakObjectsHashTable;

    array15 = [MEMORY[0x277CBEB18] array];
    retrievalAccessoryCompletionTuples = v54->_retrievalAccessoryCompletionTuples;
    v54->_retrievalAccessoryCompletionTuples = array15;

    array16 = [MEMORY[0x277CBEB18] array];
    accessoryRemoteReachabilityEnabledClients = v54->_accessoryRemoteReachabilityEnabledClients;
    v54->_accessoryRemoteReachabilityEnabledClients = array16;

    objc_initWeak(&location, v54);
    v130 = [HMDManagedStagedValue alloc];
    v131 = [MEMORY[0x277D0F788] BOOLeanWithBool:0];
    v320[0] = MEMORY[0x277D85DD0];
    v320[1] = 3221225472;
    v320[2] = __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke;
    v320[3] = &unk_27866F810;
    objc_copyWeak(&v321, &location);
    v132 = [(HMDManagedStagedValue *)v130 initWithValue:v131 commitBlock:v320];
    stagedRemoteReachabilityRegistration = v54->_stagedRemoteReachabilityRegistration;
    v54->_stagedRemoteReachabilityRegistration = v132;

    array17 = [MEMORY[0x277CBEB18] array];
    reachabilityRegisteredDevices = v54->_reachabilityRegisteredDevices;
    v54->_reachabilityRegisteredDevices = array17;

    array18 = [MEMORY[0x277CBEB18] array];
    remoteReachabilityNotificationPendingAccessories = v54->_remoteReachabilityNotificationPendingAccessories;
    v54->_remoteReachabilityNotificationPendingAccessories = array18;

    dictionary7 = [MEMORY[0x277CBEB38] dictionary];
    pendingResponses = v54->_pendingResponses;
    v54->_pendingResponses = dictionary7;

    makeHomeLocationHandler = [sourceCopy makeHomeLocationHandler];
    homeLocationHandler = v54->_homeLocationHandler;
    v54->_homeLocationHandler = makeHomeLocationHandler;

    makeHomeReprovisionHandler = [sourceCopy makeHomeReprovisionHandler];
    homeReprovisionHandler = v54->_homeReprovisionHandler;
    v54->_homeReprovisionHandler = makeHomeReprovisionHandler;

    dictionary8 = [MEMORY[0x277CBEB38] dictionary];
    newlyConfiguredAccessories = v54->_newlyConfiguredAccessories;
    v54->_newlyConfiguredAccessories = dictionary8;

    v146 = [MEMORY[0x277CCAB00] mapTableWithKeyOptions:512 valueOptions:0];
    addPendingAccessories = v54->_addPendingAccessories;
    v54->_addPendingAccessories = v146;

    dictionary9 = [MEMORY[0x277CBEB38] dictionary];
    addPendingAccessorySetupCodes = v54->_addPendingAccessorySetupCodes;
    v54->_addPendingAccessorySetupCodes = dictionary9;

    dictionary10 = [MEMORY[0x277CBEB38] dictionary];
    addPendingAccessoryOnboardingSetupPayloadStrings = v54->_addPendingAccessoryOnboardingSetupPayloadStrings;
    v54->_addPendingAccessoryOnboardingSetupPayloadStrings = dictionary10;

    dictionary11 = [MEMORY[0x277CBEB38] dictionary];
    addPendingAccessorySetupCodeHandlers = v54->_addPendingAccessorySetupCodeHandlers;
    v54->_addPendingAccessorySetupCodeHandlers = dictionary11;

    v54->_anyBTLEAccessoryReachable = 0;
    v154 = [sourceCopy makeResidentDeviceManagerWithHomeUUID:v23->_uuid];
    residentDeviceManager = v54->_residentDeviceManager;
    v54->_residentDeviceManager = v154;

    [(HMDResidentDeviceManager *)v54->_residentDeviceManager setDelegate:v54];
    v319 = 0;
    v156 = [MEMORY[0x277D0F7C0] futureWithPromise:&v319];
    residentSyncClientDidSyncFuture = v54->_residentSyncClientDidSyncFuture;
    v54->_residentSyncClientDidSyncFuture = v156;

    objc_storeStrong(&v54->_residentSyncClientDidSyncPromise, v319);
    v158 = factoryCopy[2](factoryCopy, v54);
    administratorHandler = v54->_administratorHandler;
    v54->_administratorHandler = v158;

    v160 = [HMDHomeMediaSystemHandler alloc];
    v161 = [(HMDHomeMediaSystemHandler *)v160 initWithMediaSystems:MEMORY[0x277CBEBF8]];
    mediaSystemController = v54->_mediaSystemController;
    v54->_mediaSystemController = v161;

    v54->_automaticSoftwareUpdateEnabled = 1;
    v54->_automaticThirdPartyAccessorySoftwareUpdateEnabled = 0;
    v54->_protectionMode = 0;
    v54->_networkRouterSupportDisableReason = 0;
    v54->_networkRouterSupport = [(HMDHome *)v54 deriveNetworkRouterSupport:0];
    v54->_mediaPeerToPeerEnabled = 0;
    v54->_soundCheckEnabled = 1;
    makeNotificationRegistry = [sourceCopy makeNotificationRegistry];
    notificationRegistry = v54->_notificationRegistry;
    v54->_notificationRegistry = makeNotificationRegistry;

    [(HMDNotificationRegistry *)v54->_notificationRegistry configureWithHome:v54];
    array19 = [MEMORY[0x277CBEB18] array];
    mediaSessions = v54->_mediaSessions;
    v54->_mediaSessions = array19;

    array20 = [MEMORY[0x277CBEB18] array];
    mediaSessionStates = v54->_mediaSessionStates;
    v54->_mediaSessionStates = array20;

    weakObjectsHashTable2 = [MEMORY[0x277CCAA50] weakObjectsHashTable];
    connectionsDiscoveringSymptomsForNearbyDevices = v54->_connectionsDiscoveringSymptomsForNearbyDevices;
    v54->_connectionsDiscoveringSymptomsForNearbyDevices = weakObjectsHashTable2;

    isWatch();
    if (ownerCopy && [(HMDHomeLocalDeviceCapabilitiesDataSource *)v23->_localCapabilitiesDataSource isResidentCapable])
    {
      featuresDataSource = [(HMDHome *)v54 featuresDataSource];
      isHomeActivityStateReplacesPresenceMonitorFeatureEnabled = [featuresDataSource isHomeActivityStateReplacesPresenceMonitorFeatureEnabled];

      if ((isHomeActivityStateReplacesPresenceMonitorFeatureEnabled & 1) == 0)
      {
        dataSource = [(HMDHome *)v54 dataSource];
        makeHomePresenceMonitor = [dataSource makeHomePresenceMonitor];
        presenceMonitor = v54->_presenceMonitor;
        v54->_presenceMonitor = makeHomePresenceMonitor;
      }

      v176 = objc_alloc_init(HMDHomePeriodicReader);
      periodicReader = v54->_periodicReader;
      v54->_periodicReader = v176;
    }

    featuresDataSource2 = [(HMDHome *)v54 featuresDataSource];
    isHomeActivityStateFeatureEnabled = [featuresDataSource2 isHomeActivityStateFeatureEnabled];

    if ((isHomeActivityStateFeatureEnabled & 1) == 0)
    {
      v180 = objc_alloc_init(HMDUserPresenceFeeder);
      presenceFeeder = v54->_presenceFeeder;
      v54->_presenceFeeder = v180;

      v182 = objc_autoreleasePoolPush();
      v183 = v54;
      v184 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v184, OS_LOG_TYPE_INFO))
      {
        v185 = HMFGetLogIdentifier();
        presenceFeeder = [(HMDHome *)v183 presenceFeeder];
        *buf = 138543618;
        v325 = v185;
        v326 = 2112;
        v327 = presenceFeeder;
        _os_log_impl(&dword_229538000, v184, OS_LOG_TYPE_INFO, "%{public}@Allocated presenceFeeder on HMDHome: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v182);
    }

    v187 = [HMDPredicateUtilities alloc];
    name = [(HMDHome *)v54 name];
    v189 = [(HMDPredicateUtilities *)v187 initWithHome:v54 logIdentifier:name];
    predicateUtility = v54->_predicateUtility;
    v54->_predicateUtility = v189;

    v191 = [[HMDMediaActionRouter alloc] initWithDataSource:v54];
    mediaActionRouter = v54->_mediaActionRouter;
    v54->_mediaActionRouter = v191;

    v54->_multiUserEnabled = 1;
    v54->_hasAnyUserAcknowledgedCameraRecordingOnboarding = 0;
    v193 = [HMDAccessoryNetworkProtectionGroupRegistry alloc];
    notificationCenter = [(HMDHome *)v54 notificationCenter];
    v195 = [(HMDAccessoryNetworkProtectionGroupRegistry *)v193 initWithHome:v54 notificationCenter:notificationCenter];
    networkProtectionGroupRegistry = v54->_networkProtectionGroupRegistry;
    v54->_networkProtectionGroupRegistry = v195;

    v197 = [HMDResidentReachabilityNotificationManager alloc];
    v198 = objc_alloc_init(HMDResidentReachabilityContext);
    v199 = [(HMDResidentReachabilityNotificationManager *)v197 initWithResidentReachabilityContext:v198 workQueue:v23->_workQueue];
    reachabilityNotificationManager = v54->_reachabilityNotificationManager;
    v54->_reachabilityNotificationManager = v199;

    v201 = [[HMDAccessoryReachabilityChangedLogEventManager alloc] initWithHome:v54];
    reachabilityChangedLogEventManager = v54->_reachabilityChangedLogEventManager;
    v54->_reachabilityChangedLogEventManager = v201;

    v203 = [sourceCopy makeNaturalLightingCurveWriterWithHome:v54];
    naturalLightingCurveWriter = v54->_naturalLightingCurveWriter;
    v54->_naturalLightingCurveWriter = v203;

    if (isInternalBuild() && ((_os_feature_enabled_impl() & 1) != 0 || _os_feature_enabled_impl()))
    {
      v205 = objc_autoreleasePoolPush();
      v206 = v54;
      v207 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v207, OS_LOG_TYPE_INFO))
      {
        v208 = HMFGetLogIdentifier();
        *buf = 138543362;
        v325 = v208;
        _os_log_impl(&dword_229538000, v207, OS_LOG_TYPE_INFO, "%{public}@Initialized HomeIntelligenceActivityLogger", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v205);
      v209 = [[HomeIntelligenceActivityLogger alloc] initWithHome:v206];
      homeIntelligenceActivityLogger = v206->_homeIntelligenceActivityLogger;
      v206->_homeIntelligenceActivityLogger = v209;
    }

    v211 = [HMDHAPAccessoryConnectionCoordinator alloc];
    notificationCenter2 = [(HMDHome *)v54 notificationCenter];
    v213 = [(HMDHAPAccessoryConnectionCoordinator *)v211 initWithHome:v54 notificationCenter:notificationCenter2];
    accessoryConnectionCoordinator = v54->_accessoryConnectionCoordinator;
    v54->_accessoryConnectionCoordinator = v213;

    v215 = [[HMDHAPAccessoryReaderWriter alloc] initWithHome:v54];
    accessoryReaderWriter = v54->_accessoryReaderWriter;
    v54->_accessoryReaderWriter = v215;

    v217 = [[HMDHomePersonDataManager alloc] initWithHome:v54 workQueue:v23->_workQueue];
    personDataManager = v54->_personDataManager;
    v54->_personDataManager = v217;

    v219 = [[HMDHomeWalletKeyManager alloc] initWithUUID:v23->_uuid workQueue:v23->_workQueue];
    walletKeyManager = v54->_walletKeyManager;
    v54->_walletKeyManager = v219;

    v221 = objc_autoreleasePoolPush();
    v222 = v54;
    v223 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v223, OS_LOG_TYPE_DEFAULT))
    {
      v224 = HMFGetLogIdentifier();
      *buf = 138543362;
      v325 = v224;
      _os_log_impl(&dword_229538000, v223, OS_LOG_TYPE_DEFAULT, "%{public}@Created wallet key manager", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v221);
    v222->_dbWriteLock._os_unfair_lock_opaque = 0;
    v225 = [sourceCopy makeNFCReaderKeyManagerWithHomeUUID:v23->_uuid workQueue:v23->_workQueue];
    nfcReaderKeyManager = v222->_nfcReaderKeyManager;
    v222->_nfcReaderKeyManager = v225;

    v227 = objc_autoreleasePoolPush();
    v228 = v222;
    v229 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v229, OS_LOG_TYPE_DEFAULT))
    {
      v230 = HMFGetLogIdentifier();
      *buf = 138543362;
      v325 = v230;
      _os_log_impl(&dword_229538000, v229, OS_LOG_TYPE_DEFAULT, "%{public}@Created nfc reader key manager", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v227);
    v228->_shouldEncodeHasOnboardedForWalletKey = 1;
    v228->_shouldEncodeNFCReaderKey = 1;
    dictionary12 = [MEMORY[0x277CBEB38] dictionary];
    labelsByAccessCode = v228->_labelsByAccessCode;
    v228->_labelsByAccessCode = dictionary12;

    dictionary13 = [MEMORY[0x277CBEB38] dictionary];
    labelIdentifiersByAccessCode = v228->_labelIdentifiersByAccessCode;
    v228->_labelIdentifiersByAccessCode = dictionary13;

    v235 = [HMDLastSeenStatusManager alloc];
    workQueue = [(HMDHome *)v228 workQueue];
    v237 = [(HMDLastSeenStatusManager *)v235 initWithHome:v228 queue:workQueue];
    lastSeenStatusManager = v228->_lastSeenStatusManager;
    v228->_lastSeenStatusManager = v237;

    dictionary14 = [MEMORY[0x277CBEB38] dictionary];
    removedUserInfoByAccessCode = v228->_removedUserInfoByAccessCode;
    v228->_removedUserInfoByAccessCode = dictionary14;

    v241 = [HMDAccessCodeManagerContext alloc];
    workQueue2 = [(HMDHome *)v228 workQueue];
    v243 = [(HMDAccessCodeManagerContext *)v241 initWithHome:v228 workQueue:workQueue2];

    v244 = [[HMDAccessCodeManager alloc] initWithContext:v243];
    accessCodeManager = v228->_accessCodeManager;
    v228->_accessCodeManager = v244;

    uuid = [(HMDHome *)v228 uuid];
    workQueue3 = [(HMDHome *)v228 workQueue];
    v248 = [sourceCopy makeLockNotificationManagerWithHomeUUID:uuid workQueue:workQueue3];
    lockNotificationManager = v228->_lockNotificationManager;
    v228->_lockNotificationManager = v248;

    v250 = [[HMDCameraAnalysisStatePublisher alloc] initWithHome:v228];
    analysisStatePublisher = v228->_analysisStatePublisher;
    v228->_analysisStatePublisher = v250;

    if ([(HMDHomeLocalDeviceCapabilitiesDataSource *)v23->_localCapabilitiesDataSource isResidentCapable])
    {
      v252 = [[HMDHomeRemoteEventAccessController alloc] initWithDataSource:v228];
      homeRemoteEventAccessController = v228->_homeRemoteEventAccessController;
      v228->_homeRemoteEventAccessController = v252;
    }

    v254 = objc_alloc_init(HMDHomeAudioAnalysisStereoPairController);
    audioAnalysisStereoPairController = v228->_audioAnalysisStereoPairController;
    v228->_audioAnalysisStereoPairController = v254;

    v256 = objc_autoreleasePoolPush();
    v257 = v228;
    v258 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v258, OS_LOG_TYPE_DEFAULT))
    {
      v259 = HMFGetLogIdentifier();
      *buf = 138543362;
      v325 = v259;
      _os_log_impl(&dword_229538000, v258, OS_LOG_TYPE_DEFAULT, "%{public}@Creating setup metric dispatchers for media system and home theater", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v256);
    v260 = [[HMDMediaGroupSetupMetricDispatcher alloc] initWithDataSource:v257 logEventSubmitter:submitterCopy];
    v261 = v257[206];
    v257[206] = v260;

    v262 = [[HMDMediaGroupSetupMetricDispatcher alloc] initWithDataSource:v257 logEventSubmitter:submitterCopy];
    v263 = v257[207];
    v257[207] = v262;

    v264 = objc_alloc_init(HMDCHIPHomeStorage);
    v265 = v257[195];
    v257[195] = v264;

    if ([v257 isFeatureMatterLocalFabricConfigEnabled])
    {
      array21 = [MEMORY[0x277CBEB18] array];
      v267 = v257[150];
      v257[150] = array21;

      v268 = [[HMDCHIPControllerPrivateStorage alloc] initWithHome:v257];
      v269 = v257[197];
      v257[197] = v268;

      v270 = objc_alloc(MEMORY[0x277D17AE8]);
      workQueue4 = [v257 workQueue];
      v272 = [v270 initWithDelegate:v257 queue:workQueue4];
      v273 = v257[198];
      v257[198] = v272;

      [v257[198] setControllerEntityIdentifier:v23->_uuid];
      LODWORD(v270) = [ownerCopy isCurrentUser];
      accessControl = [v257[198] accessControl];
      [accessControl setCurrentUserPrivilege:v270];

      accessControl2 = [v257[198] accessControl];
      LODWORD(v270) = [accessControl2 currentUserPrivilege] == 0;

      if (v270)
      {
        objc_initWeak(buf, v257);
        v317[0] = MEMORY[0x277D85DD0];
        v317[1] = 3221225472;
        v317[2] = __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke_722;
        v317[3] = &unk_27866F838;
        objc_copyWeak(&v318, buf);
        accessControl3 = [v257[198] accessControl];
        [accessControl3 setPrivilegeGetter:v317];

        objc_destroyWeak(&v318);
        objc_destroyWeak(buf);
      }
    }

    v257[216] = 0;
    v257[217] = 0;
    uUID2 = [MEMORY[0x277CCAD78] UUID];
    v278 = v257[201];
    v257[201] = uUID2;

    array22 = [MEMORY[0x277CBEB18] array];
    v280 = v257[202];
    v257[202] = array22;

    featuresDataSource3 = [v257 featuresDataSource];
    isHomeActivityStateFeatureEnabled2 = [featuresDataSource3 isHomeActivityStateFeatureEnabled];

    if (isHomeActivityStateFeatureEnabled2)
    {
      dataSource2 = [v257 dataSource];
      v284 = [dataSource2 makeHomeActivityStateManagerWithHome:v257];
      v285 = v257[107];
      v257[107] = v284;
    }

    v286 = objc_alloc_init(MEMORY[0x277CBEB38]);
    [v286 setObject:@"com.apple.home.hh2.hmmm.rid" forKeyedSubscript:@"com.apple.DistributedTimers.request"];
    [v286 setObject:@"hmmm.client.rid.prefix_com.apple.private.alloy.energykit" forKeyedSubscript:@"EnergyKitShareRequest_v1"];
    v287 = [sourceCopy makeModernMessagingHandlerWithMappings:v286];
    v288 = v257[142];
    v257[142] = v287;

    featuresDataSource4 = [v257 featuresDataSource];
    isStateSyncEnabled = [featuresDataSource4 isStateSyncEnabled];

    if (isStateSyncEnabled)
    {
      v291 = v54->_residentDeviceManager;
      v292 = [HMDStateSyncManager alloc];
      workQueue5 = [v257 workQueue];
      v294 = [(HMDStateSyncManager *)v292 initWithHome:v257 queue:workQueue5 residentDeviceManagerContext:v291];
      v295 = v257[208];
      v257[208] = v294;
    }

    v296 = [sourceCopy makeSwiftExtensionsWithHome:v257];
    v297 = v257[109];
    v257[109] = v296;

    objc_destroyWeak(&v321);
    objc_destroyWeak(&location);
  }

  v298 = *MEMORY[0x277D85DE8];
  return v23;
}

void __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v7 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (v7)
  {
    [WeakRetained _registerForReachabilityChangeNotificationsEnabled:objc_msgSend(v7 completionHandler:{"BOOLValue"), v5}];
  }
}

unint64_t __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke_722(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained)
  {
    v3 = [WeakRetained currentUser];
    v4 = +[HMDUser hmmtrUserPrivilegeFromHMDUserPrivilege:](HMDUser, "hmmtrUserPrivilegeFromHMDUserPrivilege:", [v3 privilege]);
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (HMDHome)initWithName:(id)name uuid:(id)uuid defaultRoomUUID:(id)d owner:(id)owner homeManager:(id)manager presenceAuth:(id)auth dataSource:(id)source
{
  sourceCopy = source;
  authCopy = auth;
  managerCopy = manager;
  ownerCopy = owner;
  dCopy = d;
  uuidCopy = uuid;
  nameCopy = name;
  metricsManager = [managerCopy metricsManager];
  logEventSubmitter = [metricsManager logEventSubmitter];
  v25 = objc_alloc_init(HMDCarPlayDataSource);
  v24 = objc_alloc_init(HMDHomeLocalDeviceCapabilitiesDataSource);
  defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
  systemStore = [MEMORY[0x277CFEC78] systemStore];
  v28 = [(HMDHome *)self initWithName:nameCopy uuid:uuidCopy defaultRoomUUID:dCopy owner:ownerCopy homeManager:managerCopy presenceAuth:authCopy dataSource:sourceCopy logEventSubmitter:logEventSubmitter carPlayDataSource:v25 administratorHandlerFactory:&__block_literal_global_670 localCapabilitiesDataSource:v24 notificationCenter:defaultCenter keychainStore:systemStore];

  return v28;
}

HMDHomeAdministratorHandler *__87__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [[HMDHomeAdministratorHandler alloc] initWithHome:v2];

  return v3;
}

uint64_t __58__HMDHome_filterAllowedToPostBulletinFromCharacteristics___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 service];
  v3 = [v2 accessory];
  v4 = [v3 home];
  v5 = [v4 shouldPostBulletin];

  return v5;
}

+ (void)dumpAccessories:(id)accessories usingTag:(id)tag flow:(id)flow
{
  tagCopy = tag;
  flowCopy = flow;
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __41__HMDHome_dumpAccessories_usingTag_flow___block_invoke;
  v12[3] = &unk_278670A10;
  v14 = tagCopy;
  selfCopy = self;
  v13 = flowCopy;
  v10 = tagCopy;
  v11 = flowCopy;
  [accessories hmf_enumerateWithAutoreleasePoolUsingBlock:v12];
}

void __41__HMDHome_dumpAccessories_usingTag_flow___block_invoke(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 48);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 32) UUID];
    v9 = *(a1 + 40);
    v10 = [v3 modelID];
    v11 = [v3 castIfHAPAccessory];
    v14 = 138544386;
    v12 = @"YES";
    v15 = v7;
    if (!v11)
    {
      v12 = @"NO";
    }

    v16 = 2112;
    v17 = v8;
    v18 = 2112;
    v19 = v9;
    v20 = 2112;
    v21 = v10;
    v22 = 2112;
    v23 = v12;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] %@ : %@ (isHAPAccessory : %@)", &v14, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  v13 = *MEMORY[0x277D85DE8];
}

+ (id)logCategory
{
  if (logCategory__hmf_once_t1541 != -1)
  {
    dispatch_once(&logCategory__hmf_once_t1541, &__block_literal_global_2074);
  }

  v3 = logCategory__hmf_once_v1542;

  return v3;
}

void __22__HMDHome_logCategory__block_invoke()
{
  v0 = *MEMORY[0x277D0F1A8];
  v1 = HMFCreateOSLogHandle();
  v2 = logCategory__hmf_once_v1542;
  logCategory__hmf_once_v1542 = v1;
}

+ (id)supportedAccessoryClasses
{
  if (supportedAccessoryClasses_onceToken != -1)
  {
    dispatch_once(&supportedAccessoryClasses_onceToken, &__block_literal_global_1989);
  }

  v3 = supportedAccessoryClasses_supportedAccessoryClasses;

  return v3;
}

void __36__HMDHome_supportedAccessoryClasses__block_invoke()
{
  v5[2] = *MEMORY[0x277D85DE8];
  v0 = MEMORY[0x277CBEB98];
  v5[0] = objc_opt_class();
  v5[1] = objc_opt_class();
  v1 = [MEMORY[0x277CBEA60] arrayWithObjects:v5 count:2];
  v2 = [v0 setWithArray:v1];
  v3 = supportedAccessoryClasses_supportedAccessoryClasses;
  supportedAccessoryClasses_supportedAccessoryClasses = v2;

  v4 = *MEMORY[0x277D85DE8];
}

+ (void)appendCharacteristicsToAccessoryList:(id)list responseTuples:(id)tuples forMultipleCharacteristicsRemoteRead:(id)read
{
  v39 = *MEMORY[0x277D85DE8];
  listCopy = list;
  tuplesCopy = tuples;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = read;
  v7 = [obj countByEnumeratingWithState:&v34 objects:v38 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v35;
    v29 = *MEMORY[0x277CCFD28];
    do
    {
      v10 = 0;
      v31 = v8;
      do
      {
        if (*v35 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v34 + 1) + 8 * v10);
        characteristic = [v11 characteristic];
        service = [characteristic service];
        accessory = [service accessory];
        v15 = accessory;
        if (characteristic)
        {
          v16 = service == 0;
        }

        else
        {
          v16 = 1;
        }

        if (v16 || accessory == 0)
        {
          uUIDString = [MEMORY[0x277CCA9B8] errorWithDomain:v29 code:4 userInfo:0];
          dictionary = [HMDCharacteristicResponse responseWithRequest:v11 error:uUIDString];
          [tuplesCopy addObject:dictionary];
        }

        else
        {
          uuid = [accessory uuid];
          uUIDString = [uuid UUIDString];

          v21 = [listCopy hmf_mutableDictionaryForKey:uUIDString];
          dictionary = v21;
          if (!v21)
          {
            dictionary = [MEMORY[0x277CBEB38] dictionary];
            [listCopy setObject:dictionary forKey:uUIDString];
          }

          instanceID = [service instanceID];
          stringValue = [instanceID stringValue];
          array = [dictionary hmf_mutableArrayForKey:stringValue];

          if (!array)
          {
            array = [MEMORY[0x277CBEB18] array];
            instanceID2 = [service instanceID];
            stringValue2 = [instanceID2 stringValue];
            [dictionary setObject:array forKey:stringValue2];
          }

          instanceID3 = [characteristic instanceID];
          [array addObject:instanceID3];

          v8 = v31;
        }

        ++v10;
      }

      while (v8 != v10);
      v8 = [obj countByEnumeratingWithState:&v34 objects:v38 count:16];
    }

    while (v8);
  }

  v28 = *MEMORY[0x277D85DE8];
}

+ (void)appendCharacteristicsToAccessoryList:(id)list responseTuples:(id)tuples forMultipleCharacteristicsRemoteWrite:(id)write message:(id)message
{
  v64 = *MEMORY[0x277D85DE8];
  listCopy = list;
  tuplesCopy = tuples;
  writeCopy = write;
  messageCopy = message;
  v59 = 0u;
  v60 = 0u;
  v61 = 0u;
  v62 = 0u;
  obj = writeCopy;
  v10 = [writeCopy countByEnumeratingWithState:&v59 objects:v63 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v60;
    v46 = *MEMORY[0x277CCFD28];
    v13 = *MEMORY[0x277CD2120];
    v44 = *MEMORY[0x277CD2120];
    v45 = *MEMORY[0x277CD2050];
    v52 = *MEMORY[0x277CD2678];
    v47 = *v60;
    do
    {
      v14 = 0;
      v50 = v11;
      do
      {
        if (*v60 != v12)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v59 + 1) + 8 * v14);
        characteristic = [v15 characteristic];
        service = [characteristic service];
        accessory = [service accessory];
        v19 = accessory;
        if (characteristic)
        {
          v20 = service == 0;
        }

        else
        {
          v20 = 1;
        }

        if (v20 || accessory == 0)
        {
          v22 = [MEMORY[0x277CCA9B8] errorWithDomain:v46 code:4 userInfo:0];
          v23 = [HMDCharacteristicResponse responseWithRequest:v15 error:v22];
          [tuplesCopy addObject:v23];
        }

        else
        {
          uuid = [accessory uuid];
          uUIDString = [uuid UUIDString];

          instanceID = [service instanceID];
          stringValue = [instanceID stringValue];

          instanceID2 = [characteristic instanceID];
          stringValue2 = [instanceID2 stringValue];

          v29 = [listCopy hmf_mutableDictionaryForKey:uUIDString];
          dictionary = v29;
          if (!v29)
          {
            dictionary = [MEMORY[0x277CBEB38] dictionary];
            [listCopy setObject:dictionary forKeyedSubscript:uUIDString];
          }

          v57 = uUIDString;
          dictionary2 = [dictionary hmf_mutableDictionaryForKey:stringValue];
          if (!dictionary2)
          {
            dictionary2 = [MEMORY[0x277CBEB38] dictionary];
            [dictionary setObject:dictionary2 forKeyedSubscript:stringValue];
          }

          v55 = dictionary;
          v56 = stringValue;
          authorizationData = [characteristic authorizationData];
          if (authorizationData)
          {
            v33 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", stringValue2, @"kAuthorizationDataKey"];
            [dictionary2 setObject:authorizationData forKeyedSubscript:v33];
          }

          v54 = authorizationData;
          home = [v19 home];
          currentUser = [home currentUser];
          notificationContextHAPIdentifier = [currentUser notificationContextHAPIdentifier];
          v37 = [characteristic contextDataForWriteRequestWithIdentifier:notificationContextHAPIdentifier];

          if (v37)
          {
            v38 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", stringValue2, v44];
            [dictionary2 setObject:v37 forKeyedSubscript:v38];
          }

          v39 = [messageCopy uuidForKey:v45];
          v40 = [messageCopy BOOLForKey:v52];
          if (v39 || v40)
          {
            [listCopy setObject:MEMORY[0x277CBEC38] forKeyedSubscript:v52];
          }

          value = [v15 value];
          [dictionary2 setObject:value forKeyedSubscript:stringValue2];

          v42 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v15, "includeResponseValue")}];
          [dictionary2 setObject:v42 forKeyedSubscript:@"HMDCharacteristicWriteRequestIncludeResponseValueKey"];

          v12 = v47;
          v23 = v56;
          v22 = v57;
          v11 = v50;
        }

        ++v14;
      }

      while (v11 != v14);
      v11 = [obj countByEnumeratingWithState:&v59 objects:v63 count:16];
    }

    while (v11);
  }

  v43 = *MEMORY[0x277D85DE8];
}

+ (id)notificationPayloadForChangedCharacteristics:(id)characteristics destination:(id)destination destinationIsXPCTransport:(BOOL)transport
{
  transportCopy = transport;
  v108 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  destinationCopy = destination;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v7 = +[HMDHAPMetadata getSharedInstance];
  v93 = 0u;
  v94 = 0u;
  v95 = 0u;
  v96 = 0u;
  obj = characteristicsCopy;
  v8 = [obj countByEnumeratingWithState:&v93 objects:v107 count:16];
  if (v8)
  {
    v10 = v8;
    v11 = *v94;
    v72 = *MEMORY[0x277CD21B8];
    v69 = *MEMORY[0x277CD21E0];
    v67 = *MEMORY[0x277CD2150];
    v68 = *MEMORY[0x277CD21D0];
    v70 = *MEMORY[0x277CD2110];
    v66 = *MEMORY[0x277CD21C0];
    v65 = *MEMORY[0x277CD20F0];
    *&v9 = 138544130;
    v64 = v9;
    v87 = v7;
    v84 = *v94;
    do
    {
      v12 = 0;
      v85 = v10;
      do
      {
        if (*v94 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v93 + 1) + 8 * v12);
        characteristic = [v13 characteristic];
        service = [characteristic service];
        accessory = [service accessory];
        home = [accessory home];
        v18 = home;
        if (characteristic)
        {
          v19 = service == 0;
        }

        else
        {
          v19 = 1;
        }

        if (!v19 && accessory != 0 && home != 0)
        {
          updatedValue = [v13 updatedValue];
          v23 = updatedValue;
          if (updatedValue)
          {
            v24 = !transportCopy;
          }

          else
          {
            v24 = 1;
          }

          if (v24)
          {
            if (updatedValue)
            {
              goto LABEL_24;
            }
          }

          else
          {
            v25 = updatedValue;
            objc_opt_class();
            isKindOfClass = objc_opt_isKindOfClass();

            if ((isKindOfClass & 1) == 0)
            {
LABEL_24:
              if (!transportCopy)
              {
                goto LABEL_27;
              }

              type = [characteristic type];
              if ([v87 shouldFilterCharacteristicOfTypeFromApp:type])
              {
LABEL_52:
              }

              else
              {
                type2 = [service type];
                v29 = [v87 shouldFilterServiceOfTypeFromApp:type2];

                if ((v29 & 1) == 0)
                {
LABEL_27:
                  uuid = [accessory uuid];
                  uUIDString = [uuid UUIDString];

                  v32 = uUIDString;
                  dictionary2 = [dictionary hmf_mutableDictionaryForKey:uUIDString];
                  if (!dictionary2)
                  {
                    dictionary2 = [MEMORY[0x277CBEB38] dictionary];
                    [dictionary setObject:dictionary2 forKey:v32];
                  }

                  v81 = v32;
                  instanceID = [service instanceID];
                  stringValue = [instanceID stringValue];
                  v36 = dictionary2;
                  v37 = stringValue;
                  v83 = v36;
                  v38 = [v36 hmf_mutableDictionaryForKey:stringValue];

                  v82 = v38;
                  if (!v38)
                  {
                    dictionary3 = [MEMORY[0x277CBEB38] dictionary];
                    instanceID2 = [service instanceID];
                    stringValue2 = [instanceID2 stringValue];
                    v82 = dictionary3;
                    [v83 setObject:dictionary3 forKey:stringValue2];
                  }

                  v105 = v72;
                  v106 = v23;
                  v42 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v106 forKeys:&v105 count:1];
                  v43 = [v42 mutableCopy];

                  v91 = 0;
                  v92 = 0;
                  v90 = 0;
                  [characteristic getLastKnownValueUpdateTime:&v92 stateNumber:&v91 notificationContext:&v90];
                  v44 = v92;
                  v45 = v91;
                  v88 = v90;
                  if (v44)
                  {
                    [v43 setObject:v44 forKey:v69];
                  }

                  if (v45)
                  {
                    [v43 setObject:v45 forKey:v68];
                  }

                  v79 = v45;
                  v80 = v44;
                  if (v88)
                  {
                    v77 = v43;
                    context = objc_autoreleasePoolPush();
                    selfCopy = self;
                    v47 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
                    {
                      v48 = HMFGetLogIdentifier();
                      *buf = 138543618;
                      v98 = v48;
                      v99 = 2112;
                      v100 = v88;
                      _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Setting notification context in notification payload to %@ ", buf, 0x16u);
                    }

                    objc_autoreleasePoolPop(context);
                    v43 = v77;
                    [v77 setObject:v88 forKey:v67];
                  }

                  isBroadcast = [v13 isBroadcast];
                  v50 = MEMORY[0x277CBEC38];
                  if ((isBroadcast & 1) != 0 || (v51 = [accessory isBLELinkConnected], v50 = MEMORY[0x277CBEC28], v51))
                  {
                    [v43 setObject:v50 forKey:v70];
                  }

                  if (!transportCopy)
                  {
                    v52 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v13, "reasons", v50)}];
                    [v43 setObject:v52 forKey:v66];
                  }

                  if (destinationCopy && [HMDBulletinUserAttributionManager currentStateCharacteristicSupportsUserAttribution:characteristic])
                  {
                    bulletinUserAttributionManager = [v18 bulletinUserAttributionManager];
                    v54 = [bulletinUserAttributionManager attributedUserUUIDForCurrentStateCharacteristic:characteristic destination:destinationCopy];

                    if (v54)
                    {
                      v78 = v43;
                      v55 = objc_autoreleasePoolPush();
                      selfCopy2 = self;
                      v57 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
                      {
                        HMFGetLogIdentifier();
                        v58 = contexta = v55;
                        *buf = v64;
                        v98 = v58;
                        v99 = 2112;
                        v100 = v54;
                        v101 = 2112;
                        v102 = characteristic;
                        v103 = 2112;
                        v104 = destinationCopy;
                        _os_log_impl(&dword_229538000, v57, OS_LOG_TYPE_INFO, "%{public}@Including attributedUserUUID=%@ in characteristic=%@ update message to destination=%@", buf, 0x2Au);

                        v55 = contexta;
                      }

                      objc_autoreleasePoolPop(v55);
                      uUIDString2 = [v54 UUIDString];
                      v43 = v78;
                      [v78 setObject:uUIDString2 forKey:v65];
                    }
                  }

                  instanceID3 = [characteristic instanceID];
                  stringValue3 = [instanceID3 stringValue];
                  [v82 setObject:v43 forKey:stringValue3];

                  type = v81;
                  goto LABEL_52;
                }
              }
            }
          }

          v7 = v87;
          v11 = v84;
          v10 = v85;
        }

        ++v12;
      }

      while (v10 != v12);
      v10 = [obj countByEnumeratingWithState:&v93 objects:v107 count:16];
    }

    while (v10);
  }

  v62 = *MEMORY[0x277D85DE8];

  return dictionary;
}

+ (unint64_t)privilegeFromUserInviteInformation:(id)information
{
  informationCopy = information;
  if ([informationCopy isRestrictedGuest])
  {
    v4 = 5;
  }

  else if ([informationCopy isAdministrator])
  {
    v4 = 4;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

+ (id)filterUsersSupportingPresence:(id)presence
{
  v18 = *MEMORY[0x277D85DE8];
  presenceCopy = presence;
  v4 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(presenceCopy, "count")}];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v5 = presenceCopy;
  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v13 + 1) + 8 * i);
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          [v4 addObject:{v10, v13}];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return v4;
}

+ (id)shortDescription
{
  v2 = objc_opt_class();

  return NSStringFromClass(v2);
}

+ (id)zoneIDFromHomeUUID:(id)d
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = MEMORY[0x277CCAD78];
  v10 = *MEMORY[0x277CD23C8];
  v4 = MEMORY[0x277CBEA60];
  dCopy = d;
  v6 = [v4 arrayWithObjects:&v10 count:1];
  v7 = [v3 hm_deriveUUIDFromBaseUUID:dCopy identifierSalt:0 withSalts:{v6, v10, v11}];

  v8 = *MEMORY[0x277D85DE8];

  return v7;
}

+ (BOOL)isObjectContainedInHome:(id)home
{
  v16 = *MEMORY[0x277D85DE8];
  homeCopy = home;
  +[HMDHome _initialize];
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  v4 = allowedClasses;
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = *v12;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v11 + 1) + 8 * i);
        if (objc_opt_isKindOfClass())
        {
          LOBYTE(v5) = 1;
          goto LABEL_11;
        }
      }

      v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v5)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v9 = *MEMORY[0x277D85DE8];
  return v5;
}

+ (id)getBuiltinActionSets
{
  if (getBuiltinActionSets_onceToken != -1)
  {
    dispatch_once(&getBuiltinActionSets_onceToken, &__block_literal_global_664);
  }

  v3 = getBuiltinActionSets_builtinActionSets;

  return v3;
}

void __31__HMDHome_getBuiltinActionSets__block_invoke()
{
  v9[4] = *MEMORY[0x277D85DE8];
  v0 = *MEMORY[0x277CCF148];
  v1 = *MEMORY[0x277CCF198];
  v8[0] = *MEMORY[0x277CCF1B0];
  v8[1] = v1;
  v2 = *MEMORY[0x277CCF140];
  v9[0] = v0;
  v9[1] = v2;
  v3 = *MEMORY[0x277CCF188];
  v8[2] = *MEMORY[0x277CCF180];
  v8[3] = v3;
  v4 = *MEMORY[0x277CCF138];
  v9[2] = *MEMORY[0x277CCF130];
  v9[3] = v4;
  v5 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:v8 count:4];
  v6 = getBuiltinActionSets_builtinActionSets;
  getBuiltinActionSets_builtinActionSets = v5;

  v7 = *MEMORY[0x277D85DE8];
}

+ (void)_initialize
{
  if (_initialize_onceToken != -1)
  {
    dispatch_once(&_initialize_onceToken, &__block_literal_global_15087);
  }
}

void __22__HMDHome__initialize__block_invoke()
{
  v16 = *MEMORY[0x277D85DE8];
  v0 = MEMORY[0x277CBEB98];
  v5 = objc_opt_class();
  v6 = objc_opt_class();
  v7 = objc_opt_class();
  v8 = objc_opt_class();
  v9 = objc_opt_class();
  v10 = objc_opt_class();
  v11 = objc_opt_class();
  v12 = objc_opt_class();
  v13 = objc_opt_class();
  v14 = objc_opt_class();
  v15 = objc_opt_class();
  v1 = [MEMORY[0x277CBEA60] arrayWithObjects:&v5 count:11];
  v2 = [v0 setWithArray:{v1, v5, v6, v7, v8, v9, v10, v11, v12, v13, v14}];
  v3 = allowedClasses;
  allowedClasses = v2;

  v4 = *MEMORY[0x277D85DE8];
}

- (void)_notifyThreadLayerOfResidentChange
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  home = [(HMDHome *)self home];
  v5 = home;
  if (home)
  {
    v14 = home;
    isCurrentDeviceAvailableResident = [home isCurrentDeviceAvailableResident];
    v5 = v14;
    if (isCurrentDeviceAvailableResident)
    {
      v7 = +[HMDThreadResidentCommissioner sharedCommissioner];
      primaryResident = [v14 primaryResident];
      isCurrentDevice = [primaryResident isCurrentDevice];
      primaryResident2 = [v14 primaryResident];
      capabilities = [primaryResident2 capabilities];
      [v7 informThreadLayerOfResidentChange:isCurrentDevice primaryResidentIsThreadCapable:{objc_msgSend(capabilities, "supportsThreadBorderRouter")}];

      if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
      {
        threadOperationalDataset = [(HMDHome *)self threadOperationalDataset];

        if (threadOperationalDataset)
        {
          threadOperationalDataset2 = [(HMDHome *)self threadOperationalDataset];
          [(HMDHome *)self saveAndSyncWithThreadOperationalDataset:threadOperationalDataset2 forceUpdate:1];
        }
      }

      v5 = v14;
    }
  }
}

- (void)_updateThreadNetworkWithModel:(id)model message:(id)message
{
  v32 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  setProperties = [modelCopy setProperties];
  v9 = [setProperties containsObject:@"threadNetworkID"];

  if (!v9)
  {
LABEL_13:
    [messageCopy respondWithPayload:0];
    goto LABEL_14;
  }

  unfilteredThreadNetworkID = [(HMDHome *)self unfilteredThreadNetworkID];
  threadNetworkID = [modelCopy threadNetworkID];
  threadNetworkID2 = [(HMDHome *)self threadNetworkID];

  if (!threadNetworkID2)
  {
    transactionResult = [messageCopy transactionResult];
    source = [transactionResult source];

    if (source == 2 && threadNetworkID && [(HMDHome *)self attemptToUpdateThreadNetworkID:threadNetworkID])
    {
      v20 = objc_autoreleasePoolPush();
      selfCopy = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v23;
        v28 = 2112;
        v29 = unfilteredThreadNetworkID;
        v30 = 2112;
        v31 = threadNetworkID;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@threadNetworkID updated from cloud: %@ -> %@", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v20);
      [(HMDHome *)selfCopy startThreadNetwork:0];
    }

    transactionResult2 = [messageCopy transactionResult];
    [transactionResult2 markChanged];

    goto LABEL_13;
  }

  v13 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
  {
    v16 = HMFGetLogIdentifier();
    v26 = 138543874;
    v27 = v16;
    v28 = 2112;
    v29 = unfilteredThreadNetworkID;
    v30 = 2112;
    v31 = threadNetworkID;
    _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Ignoring threadNetworkID update from cloud: %@ -> %@", &v26, 0x20u);
  }

  objc_autoreleasePoolPop(v13);
  transactionResult3 = [messageCopy transactionResult];
  [transactionResult3 markChanged];

  [messageCopy respondWithPayload:0];
LABEL_14:

  v25 = *MEMORY[0x277D85DE8];
}

- (void)saveAndSyncWithThreadOperationalDataset:(id)dataset forceUpdate:(BOOL)update
{
  v37 = *MEMORY[0x277D85DE8];
  datasetCopy = dataset;
  home = [(HMDHome *)self home];
  v8 = home;
  if (datasetCopy)
  {
    residentDeviceManager = [home residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];
    if ([residentDevices count] && !-[HMDHome isCurrentDeviceConfirmedPrimaryResident](self, "isCurrentDeviceConfirmedPrimaryResident"))
    {
      v26 = objc_autoreleasePoolPush();
      selfCopy = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
      {
        v29 = HMFGetLogIdentifier();
        *buf = 138543618;
        v34 = v29;
        v35 = 2112;
        v36 = v8;
        _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@There are residents for home: %@, but we are not the primary. Updated locally but not syncing ThreadOperationalDataset.", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v26);
      [(HMDHome *)selfCopy setThreadOperationalDataset:datasetCopy];
      goto LABEL_19;
    }

    threadOperationalDataset = [(HMDHome *)self threadOperationalDataset];
    v12 = HMFEqualObjects();

    if (v12)
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v15 = HMFGetOSLogHandle();
      v16 = os_log_type_enabled(v15, OS_LOG_TYPE_INFO);
      if (!update)
      {
        if (v16)
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543362;
          v34 = v30;
          _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Thread operational dataset has not changed, ignoring request to save and sync", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v13);
        goto LABEL_19;
      }

      if (v16)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v34 = v17;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Thread operational dataset has not changed, but pushing out update because forceUpdate is true", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
    }

    v18 = [(HMDHome *)self emptyModelObjectWithChangeType:2];
    [v18 setThreadOperationalDataset:datasetCopy];
    [(HMDHome *)self setThreadOperationalDataset:datasetCopy];
    backingStore = [(HMDHome *)self backingStore];
    v20 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v21 = [backingStore transaction:@"Update thread operational dataset" options:v20];

    [v21 add:v18];
    v32[0] = MEMORY[0x277D85DD0];
    v32[1] = 3221225472;
    v32[2] = __92__HMDHome_ThreadResidentCommissioning__saveAndSyncWithThreadOperationalDataset_forceUpdate___block_invoke;
    v32[3] = &unk_27868A250;
    v32[4] = self;
    [v21 run:v32];
    [(HMDHome *)self setThreadOperationalDataset:datasetCopy];

LABEL_19:
    goto LABEL_20;
  }

  v22 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
  {
    v25 = HMFGetLogIdentifier();
    *buf = 138543618;
    v34 = v25;
    v35 = 2112;
    v36 = v8;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@threadOperationalDataset is null for home %@, not saving...", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v22);
LABEL_20:

  v31 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome_ThreadResidentCommissioning__saveAndSyncWithThreadOperationalDataset_forceUpdate___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to sync thread operational dataset, error: %@", &v12, 0x16u);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [*(a1 + 32) threadOperationalDataset];
    v12 = 138543618;
    v13 = v9;
    v14 = 2048;
    v15 = [v10 length];
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Successfully sync'ed thread operational dataset, Length: %lu", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
}

- (void)updateThreadOperationalDatasetWithHomeModel:(id)model message:(id)message
{
  v19 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    threadOperationalDataset = [modelCopy threadOperationalDataset];
    [(HMDHome *)self setThreadOperationalDataset:threadOperationalDataset];

    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      threadOperationalDataset2 = [(HMDHome *)selfCopy threadOperationalDataset];
      v15 = 138543618;
      v16 = v12;
      v17 = 2048;
      v18 = [threadOperationalDataset2 length];
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Updated thread operational dataset, Length: %lu", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)stopThreadAccessoryFirmwareUpdateWithCompletion:(id)completion
{
  completionCopy = completion;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v4 = objc_claimAutoreleasedReturnValue(), v5 = [v4 supportsThreadService], v4, (v5 & 1) != 0))
  {
    v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __88__HMDHome_ThreadResidentCommissioning__stopThreadAccessoryFirmwareUpdateWithCompletion___block_invoke;
    v7[3] = &unk_278688DD0;
    v8 = completionCopy;
    [v6 stopThreadAccessoryFirmwareUpdateWithCompletion:v7];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(completionCopy + 2))(completionCopy, v6);
  }
}

- (void)stopThreadAccessoryPairingWithCompletion:(id)completion
{
  completionCopy = completion;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v4 = objc_claimAutoreleasedReturnValue(), v5 = [v4 supportsThreadService], v4, (v5 & 1) != 0))
  {
    v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __81__HMDHome_ThreadResidentCommissioning__stopThreadAccessoryPairingWithCompletion___block_invoke;
    v7[3] = &unk_278688DD0;
    v8 = completionCopy;
    [v6 stopThreadAccessoryPairingWithCompletion:v7];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(completionCopy + 2))(completionCopy, v6);
  }
}

- (void)onThreadNetworkCallStateChange:(BOOL)change
{
  v11 = *MEMORY[0x277D85DE8];
  if (!change && [(HMDHome *)self threadNetworkShouldRestartOnNetworkChange])
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v7;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Restarting thread network after call end", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [(HMDHome *)selfCopy startThreadNetwork:1];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)onThreadNetworkPeripheralDeviceNodeTypeChange:(id)change
{
  v3 = MEMORY[0x277CCAB98];
  changeCopy = change;
  defaultCenter = [v3 defaultCenter];
  [defaultCenter postNotificationName:@"HMDHomeThreadNetworkPeripheralDeviceNodeTypeChangedNotification" object:changeCopy];
}

- (void)onThreadNetworkWakeOnDeviceConnectionStateChange:(id)change
{
  v3 = MEMORY[0x277CCAB98];
  changeCopy = change;
  defaultCenter = [v3 defaultCenter];
  [defaultCenter postNotificationName:@"HMDHomeThreadNetworkWakeOnConnectionStateChangeNotification" object:changeCopy];
}

- (void)onThreadNetworkNodeTypeStateChange:(int64_t)change
{
  v15 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self threadNetworkNodeType]!= change)
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2048;
      changeCopy = change;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread network node type changed to %ld", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy setThreadNetworkNodeType:change];
    defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
    [defaultCenter postNotificationName:@"HMDHomeThreadNetworkNodeTypeChangeNotification" object:selfCopy];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)onThreadNetworkConnectionStateChange:(int64_t)change
{
  v15 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self threadNetworkConnectionState]!= change)
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2048;
      changeCopy = change;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread network connection state changed to %ld", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy setThreadNetworkConnectionState:change];
    defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
    [defaultCenter postNotificationName:@"HMDHomeThreadNetworkConnectionStateChangeNotification" object:selfCopy];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)connectToThreadAccessoryWithExtendedMACAddress:(id)address completion:(id)completion
{
  addressCopy = address;
  completionCopy = completion;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v7 = objc_claimAutoreleasedReturnValue(), v8 = [v7 supportsThreadService], v7, (v8 & 1) != 0))
  {
    v9 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __98__HMDHome_ThreadResidentCommissioning__connectToThreadAccessoryWithExtendedMACAddress_completion___block_invoke;
    v10[3] = &unk_278688DD0;
    v11 = completionCopy;
    [v9 connectToThreadAccessoryWithExtendedMACAddress:addressCopy completion:v10];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(completionCopy + 2))(completionCopy, v9);
  }
}

- (void)_unjoinThreadNetworkWithCompletion:(id)completion
{
  v19 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    v9 = HMFGetLogIdentifier();
    threadNetworkID = [(HMDHome *)selfCopy threadNetworkID];
    *buf = 138543618;
    v16 = v9;
    v17 = 2112;
    v18 = threadNetworkID;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Request to unjoin previous thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  [(HMDHome *)selfCopy setThreadNetworkID:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __75__HMDHome_ThreadResidentCommissioning___unjoinThreadNetworkWithCompletion___block_invoke;
  v13[3] = &unk_278689A68;
  v13[4] = selfCopy;
  v14 = completionCopy;
  v11 = completionCopy;
  [(HMDHome *)selfCopy _stopThreadNetworkWithCompletion:v13];

  v12 = *MEMORY[0x277D85DE8];
}

void __75__HMDHome_ThreadResidentCommissioning___unjoinThreadNetworkWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v8;
      v18 = 2112;
      v19 = v3;
      v9 = "%{public}@Failed to leave previous thread network: %@";
      v10 = v7;
      v11 = OS_LOG_TYPE_ERROR;
      v12 = 22;
LABEL_6:
      _os_log_impl(&dword_229538000, v10, v11, v9, &v16, v12);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    v9 = "%{public}@Successfully left previous thread network";
    v10 = v7;
    v11 = OS_LOG_TYPE_DEFAULT;
    v12 = 12;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v4);
  (*(*(a1 + 40) + 16))(*(a1 + 40), v3, v13, v14);

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_stopThreadNetworkWithCompletion:(id)completion
{
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)self setThreadNetworkShouldRestartOnNetworkChange:0];
  [(HMDHome *)self _incrementCurrentSequenceNumber];
  [(HMDHome *)self _unregisterForThreadNetworkEvents];
  v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __73__HMDHome_ThreadResidentCommissioning___stopThreadNetworkWithCompletion___block_invoke;
  v8[3] = &unk_278688DD0;
  v9 = completionCopy;
  v7 = completionCopy;
  [v6 stopThreadNetworkWithCompletion:v8];
}

- (void)stopThreadNetworkWithCompletion:(BOOL)completion completion:(id)a4
{
  v5 = a4;
  workQueue = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke;
  v8[3] = &unk_27868A7A0;
  v8[4] = self;
  v9 = v5;
  v7 = v5;
  dispatch_async(workQueue, v8);
}

void __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 32) threadNetworkID];
    *buf = 138543618;
    v12 = v5;
    v13 = 2112;
    v14 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Stop thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = *(a1 + 32);
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke_61;
  v9[3] = &unk_278689A68;
  v9[4] = v7;
  v10 = *(a1 + 40);
  [v7 _stopThreadNetworkWithCompletion:v9];

  v8 = *MEMORY[0x277D85DE8];
}

void __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke_61(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = v3;
    v9 = "%{public}@Failed to stop thread network: %@";
    v10 = v7;
    v11 = OS_LOG_TYPE_ERROR;
    v12 = 22;
  }

  else
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    v9 = "%{public}@Successfully stopped thread network";
    v10 = v7;
    v11 = OS_LOG_TYPE_DEFAULT;
    v12 = 12;
  }

  _os_log_impl(&dword_229538000, v10, v11, v9, &v16, v12);

LABEL_7:
  objc_autoreleasePoolPop(v4);
  v13 = _Block_copy(*(a1 + 40));
  v14 = v13;
  if (v13)
  {
    (*(v13 + 2))(v13);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkWithCompletion:(id)completion
{
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)self _startThreadNetworkOnControllerWithCompletion:completionCopy];
}

- (void)_startThreadNetworkOnResidentWithCompletion:(id)completion
{
  v14 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v8;
    v12 = 2112;
    v13 = selfCopy;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread start starting for home %@ using operational dataset", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  [(HMDHome *)selfCopy setStartThreadNetworkInProgress:1];
  [(HMDHome *)selfCopy _fetchThreadCredentialsAndStartThreadNetworkWithCompletion:completionCopy];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkOnControllerWithCompletion:(id)completion
{
  v15 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled())
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2112;
      v14 = selfCopy;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread start starting for home %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy setStartThreadNetworkInProgress:1];
    [(HMDHome *)selfCopy setThreadNetworkShouldRestartOnNetworkChange:1];
    [(HMDHome *)selfCopy _fetchThreadCredentialsAndStartThreadNetworkWithCompletion:completionCopy];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    completionCopy[2](completionCopy, v9);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_fetchThreadCredentialsAndStartThreadNetworkWithCompletion:(id)completion
{
  completionCopy = completion;
  v20[0] = 0;
  v20[1] = v20;
  v20[2] = 0x2020000000;
  v21 = 0;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke;
  aBlock[3] = &unk_27867B828;
  objc_copyWeak(&v18, &location);
  v17 = v20;
  v5 = completionCopy;
  v16 = v5;
  v6 = _Block_copy(aBlock);
  if (![(HMDHome *)self _overrideStartThreadTimeout])
  {
    v7 = dispatch_time(0, 20000000000);
    workQueue = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_2;
    block[3] = &unk_278688B80;
    v14 = v6;
    dispatch_after(v7, workQueue, block);
  }

  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_3;
  v10[3] = &unk_278686D60;
  objc_copyWeak(&v12, &location);
  v9 = v6;
  v11 = v9;
  [(HMDHome *)self _retrievePreferredNetworkWithCompletion:v10];

  objc_destroyWeak(&v12);
  objc_destroyWeak(&v18);
  objc_destroyWeak(&location);
  _Block_object_dispose(v20, 8);
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v42 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (v3)
  {
    if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
    {
      v5 = objc_autoreleasePoolPush();
      v6 = WeakRetained;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543874;
        v37 = v8;
        v38 = 2112;
        v39 = v6;
        v40 = 2112;
        v41 = v3;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Error starting thread for home %@, resetting state: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v5);
      if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
      {
        v9 = objc_autoreleasePoolPush();
        v10 = v6;
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          v12 = HMFGetLogIdentifier();
          *buf = 138543874;
          v37 = v12;
          v38 = 2112;
          v39 = v10;
          v40 = 2112;
          v41 = v3;
          _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Thread start completed for home %@, error = %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v9);
        [v10 setStartThreadNetworkInProgress:0];
        *(*(*(a1 + 40) + 8) + 24) = 1;
        v13 = [v10 workQueue];
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_59;
        block[3] = &unk_27868A7A0;
        v31 = *(a1 + 32);
        v30 = v3;
        dispatch_async(v13, block);

        v14 = v31;
LABEL_18:
      }
    }
  }

  else
  {
    if (!*(*(*(a1 + 40) + 8) + 24))
    {
      goto LABEL_13;
    }

    v15 = objc_autoreleasePoolPush();
    v16 = WeakRetained;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v18;
      v38 = 2112;
      v39 = v16;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Starting thread took longer than expected for home %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
    {
LABEL_13:
      v19 = [WeakRetained threadOperationalDataset];

      if (v19)
      {
        v20 = [WeakRetained threadOperationalDataset];
        v34[0] = MEMORY[0x277D85DD0];
        v34[1] = 3221225472;
        v34[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_56;
        v34[3] = &unk_27867FAA0;
        v34[4] = WeakRetained;
        v28 = *(a1 + 32);
        v21 = v28;
        v35 = v28;
        [WeakRetained _startThreadNetworkOnCommissionerWithOperationalDataset:v20 completion:v34];

        v14 = v35;
      }

      else
      {
        v22 = objc_autoreleasePoolPush();
        v23 = WeakRetained;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          *buf = 138543618;
          v37 = v25;
          v38 = 2112;
          v39 = v23;
          _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Thread operational dataset not available. Cancelling thread start for home %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v22);
        [v23 setStartThreadNetworkInProgress:0];
        *(*(*(a1 + 40) + 8) + 24) = 1;
        v26 = [v23 workQueue];
        v32[0] = MEMORY[0x277D85DD0];
        v32[1] = 3221225472;
        v32[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_58;
        v32[3] = &unk_278688B80;
        v33 = *(a1 + 32);
        dispatch_async(v26, v32);

        v14 = v33;
      }

      goto LABEL_18;
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_2(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:8];
  (*(v1 + 16))(v1, v2);
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_3(uint64_t a1, void *a2)
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = WeakRetained;
  if (v3 || !WeakRetained)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = v5;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v9;
      v30 = 2112;
      v31 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve preferred thread network: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v10 = [v7 threadOperationalDataset];

    if (!v10)
    {
      v24 = *(a1 + 32);
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      (*(v24 + 16))(v24, v25);

      goto LABEL_12;
    }

    v11 = objc_autoreleasePoolPush();
    v12 = v7;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v12 threadOperationalDataset];
      v16 = [v12 threadNetworkID];
      v17 = [v12 home];
      *buf = 138544130;
      v29 = v14;
      v30 = 2112;
      v31 = v15;
      v32 = 2112;
      v33 = v16;
      v34 = 2112;
      v35 = v17;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Using cached threadOperationalDataset %@ and uuid %@ from home %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v11);
  }

  v18 = objc_autoreleasePoolPush();
  v19 = v5;
  v20 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
  {
    v21 = HMFGetLogIdentifier();
    *buf = 138543618;
    v29 = v21;
    v30 = 2112;
    v31 = v19;
    _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Successfully fetched preferred network, scheduling startThread for home %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v18);
  v22 = [v19 workQueue];
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_60;
  v26[3] = &unk_27868A7A0;
  v26[4] = v19;
  v27 = *(a1 + 32);
  dispatch_async(v22, v26);

LABEL_12:
  v23 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_60(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) startThreadNetworkInProgress])
  {
    v2 = *(*(a1 + 40) + 16);
    v3 = *MEMORY[0x277D85DE8];

    v2();
  }

  else
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 32);
      v12 = 138543618;
      v13 = v7;
      v14 = 2112;
      v15 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Thread network stop was requested by the time preferred network was fetched to start Thread for home %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    (*(v9 + 16))(v9, v10);

    v11 = *MEMORY[0x277D85DE8];
  }
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_56(uint64_t a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543618;
      v21 = v7;
      v22 = 2112;
      v23 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Unable to start thread with operational dataset: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 32);
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    *buf = 138543874;
    v21 = v11;
    v22 = 2112;
    v23 = v12;
    v24 = 2112;
    v25 = v3;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Thread start completed for home %@, error = %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  *(*(*(a1 + 48) + 8) + 24) = 1;
  v13 = [*(a1 + 32) workQueue];
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_57;
  v17[3] = &unk_27868A7A0;
  v14 = *(a1 + 40);
  v18 = v3;
  v19 = v14;
  v15 = v3;
  dispatch_async(v13, v17);

  v16 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_58(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
  (*(v1 + 16))(v1, v2);
}

- (void)_retrievePreferredNetworkOnControllerWithCompletion:(id)completion
{
  v32 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v27 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve request for Thread Network Credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = +[HMDThreadNetworkMetadataStore defaultStore];
  if (v9)
  {
    if ([(HMDHome *)selfCopy isOwnerUser])
    {
      objc_initWeak(buf, selfCopy);
      threadOperationalDataset = [(HMDHome *)selfCopy threadOperationalDataset];
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __92__HMDHome_ThreadResidentCommissioning___retrievePreferredNetworkOnControllerWithCompletion___block_invoke;
      v23[3] = &unk_27867B760;
      objc_copyWeak(&v25, buf);
      v24 = completionCopy;
      [v9 retrievePreferredNetwork:threadOperationalDataset completion:v23];

      objc_destroyWeak(&v25);
      objc_destroyWeak(buf);
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = selfCopy;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        threadOperationalDataset2 = [(HMDHome *)v17 threadOperationalDataset];
        home = [(HMDHome *)v17 home];
        *buf = 138543874;
        v27 = v19;
        v28 = 2112;
        v29 = threadOperationalDataset2;
        v30 = 2112;
        v31 = home;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Shared user -  always use cached threadOperationalDataset %@ for home %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v16);
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = selfCopy;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v27 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:58];
    (*(completionCopy + 2))(completionCopy, v15);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome_ThreadResidentCommissioning___retrievePreferredNetworkOnControllerWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5)
{
  v40 = *MEMORY[0x277D85DE8];
  v9 = a2;
  v10 = a3;
  v11 = a4;
  v12 = a5;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v14 = objc_autoreleasePoolPush();
  v15 = WeakRetained;
  if (!v12 && v9 && WeakRetained)
  {
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138544130;
      v33 = v17;
      v34 = 2112;
      v35 = v9;
      v36 = 2112;
      v37 = v10;
      v38 = 2112;
      v39 = v11;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Successfully retrieved preferred thread credentials %@ with UUID %@ and operationalDataset %@ from network metadata store", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v14);
    if (v11)
    {
      v18 = [v11 copy];
      [v15 saveAndSyncWithThreadOperationalDataset:v18];

      v19 = objc_autoreleasePoolPush();
      v20 = v15;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v22 = v30 = v9;
        [v20 threadOperationalDataset];
        v23 = v29 = v10;
        [v20 home];
        v24 = v31 = v19;
        *buf = 138543874;
        v33 = v22;
        v34 = 2112;
        v35 = v23;
        v36 = 2112;
        v37 = v24;
        _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@threadOperationalDataset set to %@ for home %@", buf, 0x20u);

        v19 = v31;
        v10 = v29;

        v9 = v30;
      }

      objc_autoreleasePoolPop(v19);
    }

    if (v10)
    {
      v25 = [v10 copy];
      [v15 setThreadNetworkID:v25];
    }
  }

  else
  {
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v27;
      v34 = 2112;
      v35 = v12;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
  }

  (*(*(a1 + 32) + 16))();

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkOnCommissionerWithOperationalDataset:(id)dataset completion:(id)completion
{
  datasetCopy = dataset;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke;
  aBlock[3] = &unk_278682000;
  aBlock[4] = self;
  v9 = datasetCopy;
  v19 = v9;
  v10 = completionCopy;
  v20 = v10;
  v11 = _Block_copy(aBlock);
  homeManager = [(HMDHome *)self homeManager];
  chipDataSource = [homeManager chipDataSource];

  if (chipDataSource)
  {
    home = [(HMDHome *)self home];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_53;
    v16[3] = &unk_278671380;
    v17 = v11;
    [chipDataSource hasValidGeoOrPreferredNetworkForHome:home completion:v16];

    v15 = v17;
  }

  else
  {
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(v11 + 2))(v11, 0, v15);
  }
}

void __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [*(a1 + 32) threadNetworkID];
    v11 = *(a1 + 40);
    v12 = HMFBooleanToString();
    *buf = 138544386;
    v22 = v9;
    v23 = 2112;
    v24 = v10;
    v25 = 2112;
    v26 = v11;
    v27 = 2112;
    v28 = v12;
    v29 = 2112;
    v30 = v5;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Start thread network with uuid: %@, credentials: %@, geoAvailable: %@, error %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v6);
  v13 = +[HMDThreadResidentCommissioner sharedCommissioner];
  [v13 setGeoAvailable:a2];
  v14 = *(a1 + 40);
  v15 = [*(a1 + 32) isOwnerUser];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_50;
  v18[3] = &unk_278689358;
  v16 = *(a1 + 40);
  v18[4] = *(a1 + 32);
  v19 = v16;
  v20 = *(a1 + 48);
  [v13 startThreadNetworkWithOperationalDataset:v14 threadNetworkID:@"770E5B2E-0A0D-0A0D-0A0D-EE86505EFF8F" isOwnerUser:v15 completion:v18];

  v17 = *MEMORY[0x277D85DE8];
}

void __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_50(uint64_t a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [*(a1 + 32) threadNetworkID];
      v9 = *(a1 + 40);
      *buf = 138544130;
      v19 = v7;
      v20 = 2112;
      v21 = v8;
      v22 = 2112;
      v23 = v9;
      v24 = 2112;
      v25 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to attach to thread network %@ with operational data set%@: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
  }

  v10 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_51;
  block[3] = &unk_278689F98;
  v11 = *(a1 + 32);
  v15 = v3;
  v16 = v11;
  v17 = *(a1 + 48);
  v12 = v3;
  dispatch_async(v10, block);

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_51(uint64_t a1)
{
  v11 = *MEMORY[0x277D85DE8];
  if (!*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v5;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Attached to thread network using operational dataset", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) setThreadNetworkID:@"770E5B2E-0A0D-0A0D-0A0D-EE86505EFF8F"];
  }

  [*(a1 + 40) _registerForThreadNetworkEvents];
  [*(a1 + 40) setStartThreadNetworkInProgress:0];
  [*(a1 + 40) _scheduleThreadNetworkUpdate];
  v6 = *(a1 + 32);
  result = (*(*(a1 + 48) + 16))();
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_startThreadNetworkOnCommissionerWithCompletion:(id)completion
{
  v28 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v18 = 0;
  v19 = &v18;
  v20 = 0x3032000000;
  v21 = __Block_byref_object_copy__21464;
  v22 = __Block_byref_object_dispose__21465;
  threadNetworkID = [(HMDHome *)self threadNetworkID];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    v9 = HMFGetLogIdentifier();
    v10 = v19[5];
    *buf = 138543618;
    v25 = v9;
    v26 = 2112;
    v27 = v10;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Start thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = +[HMDThreadResidentCommissioner sharedCommissioner];
  v12 = v19[5];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke;
  v15[3] = &unk_278671358;
  v15[4] = selfCopy;
  v13 = completionCopy;
  v16 = v13;
  v17 = &v18;
  [v11 startThreadNetworkWithID:v12 completion:v15];

  _Block_object_dispose(&v18, 8);
  v14 = *MEMORY[0x277D85DE8];
}

void __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v38 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = *(*(*(a1 + 48) + 8) + 40);
    if (v7 && ![v7 isEqualToString:v5])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_12;
      }

      v11 = HMFGetLogIdentifier();
      v24 = *(*(*(a1 + 48) + 8) + 40);
      *buf = 138543874;
      v33 = v11;
      v34 = 2112;
      v35 = v5;
      v36 = 2112;
      v37 = v24;
      v12 = "%{public}@Attached to thread network %@, but expected to attach to %@";
      v13 = v10;
      v14 = OS_LOG_TYPE_ERROR;
      v15 = 32;
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_12;
      }

      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v11;
      v34 = 2112;
      v35 = v5;
      v12 = "%{public}@Attached to thread network %@";
      v13 = v10;
      v14 = OS_LOG_TYPE_DEFAULT;
      v15 = 22;
    }

    _os_log_impl(&dword_229538000, v13, v14, v12, buf, v15);

LABEL_12:
    objc_autoreleasePoolPop(v8);
    if (!*(*(*(a1 + 48) + 8) + 40) || ([v5 isEqualToString:?] & 1) == 0)
    {
      [*(a1 + 32) setThreadNetworkID:v5];
    }

    v23 = [*(a1 + 32) workQueue];
    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_48;
    v27[3] = &unk_27868A7A0;
    v25 = *(a1 + 40);
    v27[4] = *(a1 + 32);
    v22 = &v28;
    v28 = v25;
    dispatch_async(v23, v27);
    goto LABEL_16;
  }

  v16 = objc_autoreleasePoolPush();
  v17 = *(a1 + 32);
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
  {
    v19 = HMFGetLogIdentifier();
    *buf = 138543874;
    v33 = v19;
    v34 = 2112;
    v35 = 0;
    v36 = 2112;
    v37 = v6;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to attach to thread network %@: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v16);
  v20 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_47;
  block[3] = &unk_278689F98;
  v21 = *(a1 + 40);
  block[4] = *(a1 + 32);
  v22 = &v31;
  v31 = v21;
  v30 = v6;
  dispatch_async(v20, block);

  v23 = v30;
LABEL_16:

  v26 = *MEMORY[0x277D85DE8];
}

uint64_t __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_47(uint64_t a1)
{
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  v2 = *(a1 + 40);
  v3 = *(*(a1 + 48) + 16);

  return v3();
}

uint64_t __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_48(uint64_t a1)
{
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  [*(a1 + 32) _scheduleThreadNetworkUpdate];
  v2 = *(*(a1 + 40) + 16);

  return v2();
}

- (void)_retryStartThreadNetwork:(double)network
{
  v26 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = 30.0;
  if (network > 0.0)
  {
    v7 = fmin(network + network, 1800.0);
    if (network < 2.22044605e-16)
    {
      v6 = 30.0;
    }

    else
    {
      v6 = v7;
    }
  }

  threadNetworkSequenceNumber = [(HMDHome *)self threadNetworkSequenceNumber];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke;
  aBlock[3] = &unk_278671330;
  objc_copyWeak(v20, &location);
  v20[1] = *&network;
  v20[2] = threadNetworkSequenceNumber;
  v20[3] = *&v6;
  v9 = _Block_copy(aBlock);
  v10 = v9;
  v11 = network <= 0.0;
  if (network < 2.22044605e-16)
  {
    v11 = 1;
  }

  if (v11)
  {
    (*(v9 + 2))(v9);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v23 = v15;
      v24 = 2048;
      networkCopy = network;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Next resident commissioning attempt will happen in %lu seconds", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v16 = dispatch_time(0, (network * 1000000000.0));
    workQueue2 = [(HMDHome *)selfCopy workQueue];
    dispatch_after(v16, workQueue2, v10);
  }

  objc_destroyWeak(v20);
  objc_destroyWeak(&location);
  v18 = *MEMORY[0x277D85DE8];
}

void __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke(uint64_t a1)
{
  v28 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (!WeakRetained)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@Home has died, resident commissioning canceled", buf, 0xCu);
    }

    v14 = v11;
    goto LABEL_17;
  }

  v3 = *(a1 + 40);
  if (v3 > 0.0 && v3 >= 2.22044605e-16)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning timer expired", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = [WeakRetained threadNetworkSequenceNumber];
  v10 = v9;
  if (v9 != *(a1 + 48))
  {
    v15 = objc_autoreleasePoolPush();
    v16 = WeakRetained;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = *(a1 + 48);
      *buf = 138543874;
      v23 = v18;
      v24 = 2048;
      v25 = v19;
      v26 = 2048;
      v27 = v10;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning sequence number no longer matches: %lu != %lu", buf, 0x20u);
    }

    v14 = v15;
LABEL_17:
    objc_autoreleasePoolPop(v14);
    goto LABEL_18;
  }

  v21[0] = MEMORY[0x277D85DD0];
  v21[1] = 3221225472;
  v21[2] = __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke_45;
  v21[3] = &unk_278671308;
  v21[4] = WeakRetained;
  v21[5] = v9;
  v21[6] = *(a1 + 56);
  [WeakRetained _startThreadNetworkWithCompletion:v21];
LABEL_18:

  v20 = *MEMORY[0x277D85DE8];
}

void __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke_45(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (v3)
  {
    v5 = [v3 domain];
    if ([v5 isEqualToString:*MEMORY[0x277CCFD28]])
    {
      if ([v4 code] == 48)
      {

        goto LABEL_12;
      }

      v13 = [v4 code];

      if (v13 == 23)
      {
        goto LABEL_12;
      }
    }

    else
    {
    }

    v6 = [*(a1 + 32) threadNetworkSequenceNumber];
    if (v6 == *(a1 + 40))
    {
      [*(a1 + 32) _retryStartThreadNetwork:*(a1 + 48)];
    }

    else
    {
      v7 = v6;
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = *(a1 + 40);
        v15 = 138543874;
        v16 = v11;
        v17 = 2048;
        v18 = v12;
        v19 = 2048;
        v20 = v7;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning sequence number no longer matches: %lu != %lu", &v15, 0x20u);
      }

      objc_autoreleasePoolPop(v8);
    }
  }

LABEL_12:

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_incrementCurrentSequenceNumber
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  threadNetworkSequenceNumber = [(HMDHome *)self threadNetworkSequenceNumber];
  [(HMDHome *)self setThreadNetworkSequenceNumber:threadNetworkSequenceNumber + 1];
  if (threadNetworkSequenceNumber == -1)
  {
    v5 = [(HMDHome *)self threadNetworkSequenceNumber]+ 1;

    [(HMDHome *)self setThreadNetworkSequenceNumber:v5];
  }
}

- (void)startThreadNetwork:(BOOL)network
{
  v21 = *MEMORY[0x277D85DE8];
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 supportsThreadService], v5, (v6 & 1) != 0))
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v20 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Starting resident commissioning timer", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    workQueue = [(HMDHome *)selfCopy workQueue];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __59__HMDHome_ThreadResidentCommissioning__startThreadNetwork___block_invoke;
    v17[3] = &unk_278688650;
    v17[4] = selfCopy;
    networkCopy = network;
    dispatch_async(workQueue, v17);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v20 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Thread commissioning is not supported on this platform", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __59__HMDHome_ThreadResidentCommissioning__startThreadNetwork___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) homeManager];
  if ([v2 isStartThreadNetworkInProgress])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v6;
      v7 = "%{public}@Not starting thread network, start already in progress for another network";
LABEL_4:
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, v7, &v11, 0xCu);
    }
  }

  else
  {
    if (*(a1 + 40) & 1) != 0 || ([*(a1 + 32) threadNetworkID], v8 = objc_claimAutoreleasedReturnValue(), v9 = objc_msgSend(v2, "isCurrentResidentDeviceRunningThreadNetwork:", v8), v8, (v9))
    {
      [*(a1 + 32) _incrementCurrentSequenceNumber];
      [*(a1 + 32) _retryStartThreadNetwork:0.0];
      goto LABEL_9;
    }

    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v6;
      v7 = "%{public}@Not starting thread network, not associated with thread network homes";
      goto LABEL_4;
    }
  }

  objc_autoreleasePoolPop(v3);
LABEL_9:

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleUnjoinThreadNetworkMessage:(id)message
{
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = messageCopy;
  v6 = messageCopy;
  dispatch_async(workQueue, v7);
}

void __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke(uint64_t a1)
{
  v2[0] = MEMORY[0x277D85DD0];
  v2[1] = 3221225472;
  v2[2] = __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke_2;
  v2[3] = &unk_27868A250;
  v1 = *(a1 + 32);
  v3 = *(a1 + 40);
  [v1 _unjoinThreadNetworkWithCompletion:v2];
}

- (void)_handleJoinOrFormThreadNetworkMessage:(id)message
{
  v25 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = _os_feature_enabled_impl();
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled())
  {
    v6 = +[HMDDeviceCapabilities deviceCapabilities];
    supportsThreadService = [v6 supportsThreadService];

    if (((supportsThreadService | v5) & 1) == 0)
    {
LABEL_3:
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543362;
        v24 = v11;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Resident commissioning is disabled", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
      v12 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:5];
      [messageCopy respondWithPayload:0 error:v12];
      goto LABEL_13;
    }
  }

  else if ((v5 & 1) == 0)
  {
    goto LABEL_3;
  }

  messagePayload = [messageCopy messagePayload];

  if (messagePayload)
  {
    messagePayload2 = [messageCopy messagePayload];
    v15 = [messagePayload2 objectForKey:*MEMORY[0x277CD0628]];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v16 = v15;
    }

    else
    {
      v16 = 0;
    }

    messagePayload = v16;
  }

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke;
  block[3] = &unk_27868A010;
  v20 = messagePayload;
  selfCopy2 = self;
  v22 = messageCopy;
  v12 = messagePayload;
  dispatch_async(workQueue, block);

LABEL_13:
  v18 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  if (*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 40) threadNetworkID];
      v7 = *(a1 + 32);
      *buf = 138543874;
      v13 = v5;
      v14 = 2112;
      v15 = v6;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Updating thread network %@ -> %@ and starting", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) setThreadNetworkID:*(a1 + 32)];
  }

  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke_43;
  v10[3] = &unk_27868A250;
  v8 = *(a1 + 40);
  v11 = *(a1 + 48);
  [v8 _startThreadNetworkWithCompletion:v10];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_handleThreadNetworkCredentialsRequest:(id)request
{
  v24 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve request for Thread Network Credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  threadNetworkMetadataStore = [(HMDHome *)selfCopy threadNetworkMetadataStore];
  if (threadNetworkMetadataStore)
  {
    objc_initWeak(buf, selfCopy);
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke;
    aBlock[3] = &unk_2786712E0;
    aBlock[4] = selfCopy;
    objc_copyWeak(&v21, buf);
    v20 = requestCopy;
    v10 = _Block_copy(aBlock);
    threadOperationalDataset = [(HMDHome *)selfCopy threadOperationalDataset];
    home = [(HMDHome *)selfCopy home];
    [threadNetworkMetadataStore retrieveMetadata:threadOperationalDataset homeHasResident:objc_msgSend(home completion:{"doesHomeContainResident"), v10}];

    objc_destroyWeak(&v21);
    objc_destroyWeak(buf);
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = selfCopy;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v16;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [requestCopy respondWithError:v17];
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke_2;
  v10[3] = &unk_278687568;
  objc_copyWeak(&v14, a1 + 6);
  v11 = v5;
  v12 = v6;
  v13 = a1[5];
  v8 = v6;
  v9 = v5;
  dispatch_async(v7, v10);

  objc_destroyWeak(&v14);
}

void __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke_2(uint64_t a1)
{
  v36 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained && *(a1 + 32))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = WeakRetained;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 32);
      *buf = 138543618;
      v31 = v6;
      v32 = 2112;
      v33 = v7;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Successfully retrieved thread credentials %@ from network metadata store", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v8 = [*(a1 + 32) operationalDataset];

    if (v8)
    {
      v9 = [*(a1 + 32) operationalDataset];
      v10 = [v9 copy];
      [v4 saveAndSyncWithThreadOperationalDataset:v10];
    }

    v11 = *(a1 + 32);
    v29 = 0;
    v12 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v11 requiringSecureCoding:1 error:&v29];
    v13 = v29;
    if (v12)
    {
      v14 = [MEMORY[0x277CBEB38] dictionary];
      [v14 setObject:v12 forKeyedSubscript:*MEMORY[0x277CD0620]];
      v15 = [*(a1 + 32) masterKey];
      [v14 setObject:v15 forKeyedSubscript:@"HMHomeThreadNetworkCredentialsMasterKeyMessageKey"];

      [*(a1 + 48) respondWithPayload:v14];
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      v24 = v4;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543618;
        v31 = v26;
        v32 = 2112;
        v33 = v13;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Unable to encode credentials: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v23);
      v27 = *(a1 + 48);
      v14 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
      [v27 respondWithError:v14];
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = WeakRetained;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v17 threadNetworkID];
      v21 = *(a1 + 40);
      *buf = 138543874;
      v31 = v19;
      v32 = 2112;
      v33 = v20;
      v34 = 2112;
      v35 = v21;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network '%@': %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    v22 = *(a1 + 48);
    v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v22 respondWithError:v13];
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)handleCurrentWiFiNetworkChangedNotification:(id)notification
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __84__HMDHome_ThreadResidentCommissioning__handleCurrentWiFiNetworkChangedNotification___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __84__HMDHome_ThreadResidentCommissioning__handleCurrentWiFiNetworkChangedNotification___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) threadNetworkShouldRestartOnNetworkChange];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_INFO);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v7;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Restarting Thread network upon WiFi network changed notification", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 32) startThreadNetwork:1];
  }

  else
  {
    if (v6)
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Ignoring WiFi network changed notification when Thread is not up", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_registerThreadResidentCommissioningMessageHandlers
{
  v11 = *MEMORY[0x277D85DE8];
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    v3 = objc_autoreleasePoolPush();
    selfCopy = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v6;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Registering for HMFWiFiManagerCurrentNetworkDidChangeNotification", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
    [defaultCenter addObserver:selfCopy selector:sel_handleCurrentWiFiNetworkChangedNotification_ name:*MEMORY[0x277D0F768] object:0];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceThreadPreferredPrimaryResident
{
  v2 = +[HMDDeviceCapabilities deviceCapabilities];
  supportsThreadBorderRouter = [v2 supportsThreadBorderRouter];

  return supportsThreadBorderRouter;
}

- (void)setThreadNetworkID:(id)d
{
  v26 = *MEMORY[0x277D85DE8];
  dCopy = d;
  threadNetworkID = [(HMDHome *)self threadNetworkID];
  if (threadNetworkID && (v7 = threadNetworkID, v8 = [dCopy isEqualToString:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"], v7, (v8 & 1) == 0))
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      unfilteredThreadNetworkID = [(HMDHome *)selfCopy unfilteredThreadNetworkID];
      v20 = 138543874;
      v21 = v17;
      v22 = 2112;
      v23 = dCopy;
      v24 = 2112;
      v25 = unfilteredThreadNetworkID;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Unable to set threadNetworkID to %@. (current value=%@)", &v20, 0x20u);
    }

    objc_autoreleasePoolPop(v14);
  }

  else if ([(HMDHome *)self attemptToUpdateThreadNetworkID:dCopy])
  {
    v9 = [HMDHomeThreadNetworkModel defaultModelForHome:self];
    [v9 setThreadNetworkID:dCopy];
    backingStore = [(HMDHome *)self backingStore];
    v11 = NSStringFromSelector(a2);
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [backingStore transaction:v11 options:v12];

    [v13 add:v9 withMessage:0];
    [v13 run];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (NSString)threadNetworkID
{
  unfilteredThreadNetworkID = [(HMDHome *)self unfilteredThreadNetworkID];
  if ([unfilteredThreadNetworkID isEqualToString:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"])
  {
    v3 = 0;
  }

  else
  {
    v3 = unfilteredThreadNetworkID;
  }

  return v3;
}

- (void)_unregisterForThreadNetworkEvents
{
  objc_initWeak(&location, self);
  workQueue = [(HMDHome *)self workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __73__HMDHome_ThreadResidentCommissioning___unregisterForThreadNetworkEvents__block_invoke;
  v4[3] = &unk_278686B80;
  objc_copyWeak(&v5, &location);
  dispatch_async(workQueue, v4);

  objc_destroyWeak(&v5);
  objc_destroyWeak(&location);
}

void __73__HMDHome_ThreadResidentCommissioning___unregisterForThreadNetworkEvents__block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained && ([WeakRetained threadNetworkPeriodicStatusReporter], v3 = objc_claimAutoreleasedReturnValue(), v3, v3))
  {
    v4 = [v2 threadNetworkPeriodicStatusReporter];
    [v4 unregisterForThreadNetworkEvents];

    [v2 setThreadNetworkPeriodicStatusReporter:0];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = v2;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@_unregisterForThreadNetworkEvents already unregistered", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_registerForThreadNetworkEvents
{
  objc_initWeak(&location, self);
  workQueue = [(HMDHome *)self workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __71__HMDHome_ThreadResidentCommissioning___registerForThreadNetworkEvents__block_invoke;
  v4[3] = &unk_278686B80;
  objc_copyWeak(&v5, &location);
  dispatch_async(workQueue, v4);

  objc_destroyWeak(&v5);
  objc_destroyWeak(&location);
}

void __71__HMDHome_ThreadResidentCommissioning___registerForThreadNetworkEvents__block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained)
  {
    v3 = [WeakRetained threadNetworkPeriodicStatusReporter];

    if (!v3)
    {
      v4 = [[HMDThreadNetworkStatusReporter alloc] initWithHome:v2];
      [v2 setThreadNetworkPeriodicStatusReporter:v4];
    }

    v5 = [v2 threadNetworkPeriodicStatusReporter];
    [v5 registerForThreadNetworkEvents];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@_registerForThreadNetworkEvents could not get a strong reference to self", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceThreadBorderRouterCapable
{
  v2 = +[HMDDeviceCapabilities deviceCapabilities];
  supportsThreadBorderRouter = [v2 supportsThreadBorderRouter];

  return supportsThreadBorderRouter;
}

- (BOOL)isThreadNetworkUp
{
  [(HMDHome *)self _scheduleThreadNetworkUpdate];

  return [(HMDHome *)self threadNetworkIsUp];
}

- (BOOL)isThreadCapable
{
  threadNetworkID = [(HMDHome *)self threadNetworkID];

  if (threadNetworkID)
  {
    return 1;
  }

  [(HMDHome *)self _scheduleThreadNetworkUpdate];

  return [(HMDHome *)self threadPreferredNetworkExists];
}

- (id)dumpBulletinNotificationRegistrationsState
{
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  accessoryBulletinNotificationManager = [(HMDHome *)self accessoryBulletinNotificationManager];
  serviceRegistrationsForCurrentDevice = [accessoryBulletinNotificationManager serviceRegistrationsForCurrentDevice];

  if (serviceRegistrationsForCurrentDevice)
  {
    v6 = [serviceRegistrationsForCurrentDevice description];
    [dictionary setObject:v6 forKeyedSubscript:@"Service Registrations (Local)"];
  }

  accessoryBulletinNotificationManager2 = [(HMDHome *)self accessoryBulletinNotificationManager];
  accessoryRegistrationsForCurrentDevice = [accessoryBulletinNotificationManager2 accessoryRegistrationsForCurrentDevice];

  if (accessoryRegistrationsForCurrentDevice)
  {
    v9 = [accessoryRegistrationsForCurrentDevice description];
    [dictionary setObject:v9 forKeyedSubscript:@"Accessory Characteristic Registrations (Local)"];
  }

  accessoryBulletinNotificationManager3 = [(HMDHome *)self accessoryBulletinNotificationManager];
  accessoryRegistrations = [accessoryBulletinNotificationManager3 accessoryRegistrations];

  if (accessoryRegistrations)
  {
    v12 = [accessoryRegistrations description];
    [dictionary setObject:v12 forKeyedSubscript:@"Accessory Characteristic Registrations"];
  }

  cameraBulletinNotificationManager = [(HMDHome *)self cameraBulletinNotificationManager];
  cameraSignificantEventRegistrationsForCurrentDevice = [cameraBulletinNotificationManager cameraSignificantEventRegistrationsForCurrentDevice];

  if (cameraSignificantEventRegistrationsForCurrentDevice)
  {
    v15 = [cameraSignificantEventRegistrationsForCurrentDevice description];
    [dictionary setObject:v15 forKeyedSubscript:@"Camera Significant Event Registrations (Local)"];
  }

  cameraBulletinNotificationManager2 = [(HMDHome *)self cameraBulletinNotificationManager];
  cameraSignificantEventRegistrations = [cameraBulletinNotificationManager2 cameraSignificantEventRegistrations];

  if (cameraSignificantEventRegistrations)
  {
    v18 = [cameraSignificantEventRegistrations description];
    [dictionary setObject:v18 forKeyedSubscript:@"Camera Significant Event Registrations"];
  }

  cameraBulletinNotificationManager3 = [(HMDHome *)self cameraBulletinNotificationManager];
  cameraReachabilityRegistrationsForCurrentDevice = [cameraBulletinNotificationManager3 cameraReachabilityRegistrationsForCurrentDevice];

  if (cameraReachabilityRegistrationsForCurrentDevice)
  {
    v21 = [cameraReachabilityRegistrationsForCurrentDevice description];
    [dictionary setObject:v21 forKeyedSubscript:@"Camera Reachability Registrations (Local)"];
  }

  v38 = accessoryRegistrationsForCurrentDevice;
  cameraBulletinNotificationManager4 = [(HMDHome *)self cameraBulletinNotificationManager];
  cameraReachabilityRegistrations = [cameraBulletinNotificationManager4 cameraReachabilityRegistrations];

  if (cameraReachabilityRegistrations)
  {
    v24 = [cameraReachabilityRegistrations description];
    [dictionary setObject:v24 forKeyedSubscript:@"Camera Reachability Registrations"];
  }

  v25 = serviceRegistrationsForCurrentDevice;
  cameraBulletinNotificationManager5 = [(HMDHome *)self cameraBulletinNotificationManager];
  cameraAccessModeRegistrationsForCurrentDevice = [cameraBulletinNotificationManager5 cameraAccessModeRegistrationsForCurrentDevice];

  if (cameraAccessModeRegistrationsForCurrentDevice)
  {
    v28 = [cameraAccessModeRegistrationsForCurrentDevice description];
    [dictionary setObject:v28 forKeyedSubscript:@"Camera Access Mode Registrations (Local)"];
  }

  cameraBulletinNotificationManager6 = [(HMDHome *)self cameraBulletinNotificationManager];
  cameraAccessModeRegistrations = [cameraBulletinNotificationManager6 cameraAccessModeRegistrations];

  if (cameraAccessModeRegistrations)
  {
    v31 = [cameraAccessModeRegistrations description];
    [dictionary setObject:v31 forKeyedSubscript:@"Camera Access Mode Registrations"];
  }

  audioAnalysisBulletinNotificationManager = [(HMDHome *)self audioAnalysisBulletinNotificationManager];
  registrations = [audioAnalysisBulletinNotificationManager registrations];

  if (registrations)
  {
    v34 = [registrations description];
    [dictionary setObject:v34 forKeyedSubscript:@"Audio Analysis Registrations"];
  }

  v35 = [dictionary copy];

  return v35;
}

- (BOOL)insertOrUpdateCameraAccessModeBulletinRegistration:(id)registration source:(id)source managedBulletinRegistration:(id)bulletinRegistration accessory:(id)accessory user:(id)user context:(id)context
{
  v40 = *MEMORY[0x277D85DE8];
  registrationCopy = registration;
  sourceCopy = source;
  bulletinRegistrationCopy = bulletinRegistration;
  accessoryCopy = accessory;
  userCopy = user;
  contextCopy = context;
  if (bulletinRegistrationCopy || (v33 = 0, [MEMORY[0x277CCAD78] UUID], v20 = objc_claimAutoreleasedReturnValue(), objc_msgSend(userCopy, "materializeOrCreateBulletinRegistrationsRelationOfTypeCameraAccessModeBulletinRegistrationWithModelID:createdNew:", v20, &v33), bulletinRegistrationCopy = objc_claimAutoreleasedReturnValue(), v20, (v33 & 1) != 0))
  {
    deviceAddress = [sourceCopy deviceAddress];
    idsIdentifier = [deviceAddress idsIdentifier];
    [bulletinRegistrationCopy setDeviceIdsIdentifier:idsIdentifier];

    deviceAddress2 = [sourceCopy deviceAddress];
    idsDestination = [deviceAddress2 idsDestination];
    [bulletinRegistrationCopy setDeviceIdsDestination:idsDestination];

    [bulletinRegistrationCopy setAccessory:accessoryCopy];
    conditions = [registrationCopy conditions];
    v26 = [(HMDHome *)self addBulletinConditions:conditions on:bulletinRegistrationCopy context:contextCopy];
  }

  else
  {
    v29 = objc_autoreleasePoolPush();
    selfCopy = self;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543874;
      v35 = v32;
      v36 = 2112;
      v37 = userCopy;
      v38 = 2112;
      v39 = registrationCopy;
      _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize camera reachability bulletin registration on user: %@, registration: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v29);
    v26 = 0;
  }

  v27 = *MEMORY[0x277D85DE8];
  return v26;
}

- (BOOL)insertOrUpdateAudioAnalysisEventBulletinRegistrations:(id)registrations source:(id)source managedBulletinRegistration:(id)registration accessory:(id)accessory user:(id)user context:(id)context
{
  v41 = *MEMORY[0x277D85DE8];
  registrationsCopy = registrations;
  sourceCopy = source;
  registrationCopy = registration;
  accessoryCopy = accessory;
  userCopy = user;
  contextCopy = context;
  if (registrationCopy || (v34 = 0, [MEMORY[0x277CCAD78] UUID], v20 = objc_claimAutoreleasedReturnValue(), objc_msgSend(userCopy, "materializeOrCreateBulletinRegistrationsRelationOfTypeAnalysisEventBulletinRegistrationWithModelID:createdNew:", v20, &v34), registrationCopy = objc_claimAutoreleasedReturnValue(), v20, (v34 & 1) != 0))
  {
    deviceAddress = [sourceCopy deviceAddress];
    idsIdentifier = [deviceAddress idsIdentifier];
    [registrationCopy setDeviceIdsIdentifier:idsIdentifier];

    deviceAddress2 = [sourceCopy deviceAddress];
    idsDestination = [deviceAddress2 idsDestination];
    [registrationCopy setDeviceIdsDestination:idsDestination];

    [registrationCopy setAccessory:accessoryCopy];
    v25 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(registrationsCopy, "audioAnalysisClassifierOptions")}];
    [registrationCopy setClassifierOptions:v25];

    conditions = [registrationsCopy conditions];
    v27 = [(HMDHome *)self addBulletinConditions:conditions on:registrationCopy context:contextCopy];
  }

  else
  {
    v30 = objc_autoreleasePoolPush();
    selfCopy = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
    {
      v33 = HMFGetLogIdentifier();
      *buf = 138543874;
      v36 = v33;
      v37 = 2112;
      v38 = userCopy;
      v39 = 2112;
      v40 = registrationsCopy;
      _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize audio analysis reachability bulletin registration on user: %@, registration: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v30);
    v27 = 0;
  }

  v28 = *MEMORY[0x277D85DE8];
  return v27;
}

- (BOOL)insertOrUpdateCameraReachabilityBulletinRegistration:(id)registration source:(id)source managedBulletinRegistration:(id)bulletinRegistration accessory:(id)accessory user:(id)user context:(id)context
{
  v40 = *MEMORY[0x277D85DE8];
  registrationCopy = registration;
  sourceCopy = source;
  bulletinRegistrationCopy = bulletinRegistration;
  accessoryCopy = accessory;
  userCopy = user;
  contextCopy = context;
  if (bulletinRegistrationCopy || (v33 = 0, [MEMORY[0x277CCAD78] UUID], v20 = objc_claimAutoreleasedReturnValue(), objc_msgSend(userCopy, "materializeOrCreateBulletinRegistrationsRelationOfTypeCameraReachabilityBulletinRegistrationWithModelID:createdNew:", v20, &v33), bulletinRegistrationCopy = objc_claimAutoreleasedReturnValue(), v20, (v33 & 1) != 0))
  {
    deviceAddress = [sourceCopy deviceAddress];
    idsIdentifier = [deviceAddress idsIdentifier];
    [bulletinRegistrationCopy setDeviceIdsIdentifier:idsIdentifier];

    deviceAddress2 = [sourceCopy deviceAddress];
    idsDestination = [deviceAddress2 idsDestination];
    [bulletinRegistrationCopy setDeviceIdsDestination:idsDestination];

    [bulletinRegistrationCopy setAccessory:accessoryCopy];
    conditions = [registrationCopy conditions];
    v26 = [(HMDHome *)self addBulletinConditions:conditions on:bulletinRegistrationCopy context:contextCopy];
  }

  else
  {
    v29 = objc_autoreleasePoolPush();
    selfCopy = self;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543874;
      v35 = v32;
      v36 = 2112;
      v37 = userCopy;
      v38 = 2112;
      v39 = registrationCopy;
      _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize camera reachability bulletin registration on user: %@, registration: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v29);
    v26 = 0;
  }

  v27 = *MEMORY[0x277D85DE8];
  return v26;
}

- (BOOL)insertOrUpdateCameraSignificantEventBulletinRegistration:(id)registration source:(id)source managedBulletinRegistration:(id)bulletinRegistration accessory:(id)accessory user:(id)user context:(id)context
{
  v43 = *MEMORY[0x277D85DE8];
  registrationCopy = registration;
  sourceCopy = source;
  bulletinRegistrationCopy = bulletinRegistration;
  accessoryCopy = accessory;
  userCopy = user;
  contextCopy = context;
  if (bulletinRegistrationCopy || (v36 = 0, [MEMORY[0x277CCAD78] UUID], v20 = objc_claimAutoreleasedReturnValue(), objc_msgSend(userCopy, "materializeOrCreateBulletinRegistrationsRelationOfTypeCameraSignificantEventBulletinRegistrationWithModelID:createdNew:", v20, &v36), bulletinRegistrationCopy = objc_claimAutoreleasedReturnValue(), v20, (v36 & 1) != 0))
  {
    deviceAddress = [sourceCopy deviceAddress];
    idsIdentifier = [deviceAddress idsIdentifier];
    [bulletinRegistrationCopy setDeviceIdsIdentifier:idsIdentifier];

    deviceAddress2 = [sourceCopy deviceAddress];
    idsDestination = [deviceAddress2 idsDestination];
    [bulletinRegistrationCopy setDeviceIdsDestination:idsDestination];

    [bulletinRegistrationCopy setAccessory:accessoryCopy];
    v25 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(registrationCopy, "notificationModes")}];
    [bulletinRegistrationCopy setNotificationModes:v25];

    v26 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(registrationCopy, "significantEventTypes")}];
    [bulletinRegistrationCopy setSignificantEventTypes:v26];

    v27 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(registrationCopy, "personFamiliarityOptions")}];
    [bulletinRegistrationCopy setPersonFamiliarityOptions:v27];

    conditions = [registrationCopy conditions];
    v29 = [(HMDHome *)self addBulletinConditions:conditions on:bulletinRegistrationCopy context:contextCopy];
  }

  else
  {
    v32 = objc_autoreleasePoolPush();
    selfCopy = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      *buf = 138543874;
      v38 = v35;
      v39 = 2112;
      v40 = userCopy;
      v41 = 2112;
      v42 = registrationCopy;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize camera significant event bulletin registration on user: %@, registration: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v32);
    v29 = 0;
  }

  v30 = *MEMORY[0x277D85DE8];
  return v29;
}

- (BOOL)addPresenceBulletinCondition:(id)condition on:(id)on context:(id)context
{
  v31 = *MEMORY[0x277D85DE8];
  conditionCopy = condition;
  onCopy = on;
  contextCopy = context;
  v28 = 0;
  uUID = [MEMORY[0x277CCAD78] UUID];
  v12 = [onCopy materializeOrCreateConditionsRelationOfTypePresenceBulletinConditionWithModelID:uUID createdNew:&v28];

  if (v28)
  {
    v13 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(conditionCopy, "presenceEventType")}];
    [v12 setPresenceEventType:v13];

    v14 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(conditionCopy, "presenceEventUserType")}];
    [v12 setPresenceEventUserType:v14];

    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x2020000000;
    v30 = 1;
    userUUIDs = [conditionCopy userUUIDs];
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __74__HMDHome_BulletinNotifications__addPresenceBulletinCondition_on_context___block_invoke;
    v23[3] = &unk_278671E70;
    v24 = contextCopy;
    selfCopy = self;
    v27 = buf;
    v26 = v12;
    [userUUIDs hmf_enumerateWithAutoreleasePoolUsingBlock:v23];

    v16 = *(*&buf[8] + 24);
    _Block_object_dispose(buf, 8);
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v20;
      *&buf[12] = 2112;
      *&buf[14] = conditionCopy;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Unable to create the presence condition from %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
    v16 = 0;
  }

  v21 = *MEMORY[0x277D85DE8];
  return v16 & 1;
}

void __74__HMDHome_BulletinNotifications__addPresenceBulletinCondition_on_context___block_invoke(uint64_t a1, void *a2, _BYTE *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = [*(a1 + 32) managedObjectContext];
  v7 = [_MKFHome findHomeMemberWithUUID:v5 context:v6];

  if (v7)
  {
    v8 = [v7 isRestrictedGuest];
    v9 = *(a1 + 48);
    if (v8)
    {
      v10 = [v7 castIfGuest];
      [v9 addGuestsObject:v10];
    }

    else
    {
      v10 = [v7 castIfUser];
      [v9 addUsersObject:v10];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v14;
      v18 = 2112;
      v19 = v5;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the user: %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    *a3 = 1;
    *(*(*(a1 + 56) + 8) + 24) = 0;
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (BOOL)addSunriseSunSetTimePeriodElement:(id)element toCondition:(id)condition isStartElement:(BOOL)startElement
{
  startElementCopy = startElement;
  v30 = *MEMORY[0x277D85DE8];
  elementCopy = element;
  conditionCopy = condition;
  v23 = 0;
  uUID = [MEMORY[0x277CCAD78] UUID];
  if (startElementCopy)
  {
    [conditionCopy materializeOrCreateStartElementRelationOfTypeSunriseSunsetTimeSpecificationWithModelID:uUID createdNew:&v23];
  }

  else
  {
    [conditionCopy materializeOrCreateEndElementRelationOfTypeSunriseSunsetTimeSpecificationWithModelID:uUID createdNew:&v23];
  }
  v11 = ;

  if ((v23 & 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = HMFBooleanToString();
      *buf = 138543874;
      v25 = v15;
      v26 = 2112;
      v27 = v16;
      v28 = 2112;
      v29 = elementCopy;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Unable to create sunrise sunset time period element: (start = %@) (element = %@)", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
  }

  significantEvent = [elementCopy significantEvent];
  [v11 setSignificantEvent:significantEvent];

  v18 = MEMORY[0x277CCABB0];
  offset = [elementCopy offset];
  v20 = [v18 numberWithInteger:{HMDTimeOffsetFromDateComponents(offset, 0)}];
  [v11 setOffsetSeconds:v20];

  v21 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)addTimeOfDayTimePeriodElement:(id)element toCondition:(id)condition isStartElement:(BOOL)startElement
{
  startElementCopy = startElement;
  v29 = *MEMORY[0x277D85DE8];
  elementCopy = element;
  conditionCopy = condition;
  v22 = 0;
  uUID = [MEMORY[0x277CCAD78] UUID];
  if (startElementCopy)
  {
    [conditionCopy materializeOrCreateStartElementRelationOfTypeTimeOfDayTimeSpecificationWithModelID:uUID createdNew:&v22];
  }

  else
  {
    [conditionCopy materializeOrCreateEndElementRelationOfTypeTimeOfDayTimeSpecificationWithModelID:uUID createdNew:&v22];
  }
  v11 = ;

  v12 = v22;
  if (v22)
  {
    v13 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(elementCopy, "hour")}];
    [v11 setHour:v13];

    v14 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(elementCopy, "minute")}];
    [v11 setMinute:v14];
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v19 = HMFBooleanToString();
      *buf = 138543874;
      v24 = v18;
      v25 = 2112;
      v26 = v19;
      v27 = 2112;
      v28 = elementCopy;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Unable to create time of day time period element: (start = %@) (element = %@)", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v15);
  }

  v20 = *MEMORY[0x277D85DE8];
  return v12;
}

- (BOOL)addTimePeriodBulletinCondition:(id)condition on:(id)on
{
  v30 = *MEMORY[0x277D85DE8];
  conditionCopy = condition;
  onCopy = on;
  v25 = 0;
  uUID = [MEMORY[0x277CCAD78] UUID];
  v9 = [onCopy materializeOrCreateConditionsRelationOfTypeTimePeriodBulletinConditionWithModelID:uUID createdNew:&v25];

  if ((v25 & 1) == 0)
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v18;
      v28 = 2112;
      v29 = conditionCopy;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Unable to create the time period condition from %@", buf, 0x16u);
LABEL_12:

      goto LABEL_13;
    }

    goto LABEL_13;
  }

  startElement = [conditionCopy startElement];
  v11 = [(HMDHome *)self addElement:startElement toCondition:v9 isStartElement:1];

  if (!v11)
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      startElement2 = [conditionCopy startElement];
      *buf = 138543618;
      v27 = v18;
      v28 = 2112;
      v29 = startElement2;
      v21 = "%{public}@Unable to add start element to the condition: %@";
LABEL_11:
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, v21, buf, 0x16u);

      goto LABEL_12;
    }

LABEL_13:

    objc_autoreleasePoolPop(v15);
    v14 = 0;
    goto LABEL_14;
  }

  endElement = [conditionCopy endElement];
  v13 = [(HMDHome *)self addElement:endElement toCondition:v9 isStartElement:0];

  if (!v13)
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      startElement2 = [conditionCopy startElement];
      *buf = 138543618;
      v27 = v18;
      v28 = 2112;
      v29 = startElement2;
      v21 = "%{public}@Unable to add end element to the condition: %@";
      goto LABEL_11;
    }

    goto LABEL_13;
  }

  v14 = 1;
LABEL_14:

  v23 = *MEMORY[0x277D85DE8];
  return v14;
}

- (BOOL)addBulletinConditions:(id)conditions on:(id)on context:(id)context
{
  conditionsCopy = conditions;
  onCopy = on;
  contextCopy = context;
  managedObjectContext = [contextCopy managedObjectContext];
  [managedObjectContext hmd_assertIsExecuting];

  conditions = [onCopy conditions];
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __67__HMDHome_BulletinNotifications__addBulletinConditions_on_context___block_invoke;
  v25[3] = &unk_278671E20;
  v13 = contextCopy;
  v26 = v13;
  [conditions hmf_enumerateWithAutoreleasePoolUsingBlock:v25];

  v21 = 0;
  v22 = &v21;
  v23 = 0x2020000000;
  v24 = 1;
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __67__HMDHome_BulletinNotifications__addBulletinConditions_on_context___block_invoke_2;
  v17[3] = &unk_278671E48;
  v20 = &v21;
  v17[4] = self;
  v14 = onCopy;
  v18 = v14;
  v15 = v13;
  v19 = v15;
  [conditionsCopy hmf_enumerateWithAutoreleasePoolUsingBlock:v17];
  LOBYTE(v13) = *(v22 + 24);

  _Block_object_dispose(&v21, 8);
  return v13;
}

void __67__HMDHome_BulletinNotifications__addBulletinConditions_on_context___block_invoke_2(uint64_t a1, void *a2, _BYTE *a3)
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = v6;
    }

    else
    {
      v7 = 0;
    }

    v8 = v7;

    v9 = [*(a1 + 32) addPresenceBulletinCondition:v8 on:*(a1 + 40) context:*(a1 + 48)];
LABEL_11:
    *(*(*(a1 + 56) + 8) + 24) = v9;

    goto LABEL_15;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = v5;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v11 = v10;
    }

    else
    {
      v11 = 0;
    }

    v8 = v11;

    v9 = [*(a1 + 32) addTimePeriodBulletinCondition:v8 on:*(a1 + 40)];
    goto LABEL_11;
  }

  v12 = objc_autoreleasePoolPush();
  v13 = *(a1 + 32);
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
  {
    v15 = HMFGetLogIdentifier();
    v17 = 138543618;
    v18 = v15;
    v19 = 2112;
    v20 = v5;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Unknown bulletin condition found on the bulletin registration : %@", &v17, 0x16u);
  }

  objc_autoreleasePoolPop(v12);
  *(*(*(a1 + 56) + 8) + 24) = 0;
LABEL_15:
  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0)
  {
    *a3 = 1;
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)insertOrUpdateMatterBulletinRegistration:(id)registration source:(id)source managedBulletinRegistration:(id)bulletinRegistration accessory:(id)accessory homeMember:(id)member context:(id)context
{
  v49 = *MEMORY[0x277D85DE8];
  registrationCopy = registration;
  sourceCopy = source;
  bulletinRegistrationCopy = bulletinRegistration;
  accessoryCopy = accessory;
  memberCopy = member;
  contextCopy = context;
  managedObjectContext = [contextCopy managedObjectContext];
  [managedObjectContext hmd_assertIsExecuting];

  v21 = +[HMDCoreData featuresDataSource];
  isRVCEnabled = [v21 isRVCEnabled];

  if (!isRVCEnabled)
  {
LABEL_8:
    v31 = 0;
    goto LABEL_9;
  }

  if (!bulletinRegistrationCopy)
  {
    v42 = 0;
    uUID = [MEMORY[0x277CCAD78] UUID];
    bulletinRegistrationCopy = [memberCopy materializeOrCreateBulletinRegistrationsRelationOfTypeMatterBulletinRegistrationWithModelID:uUID createdNew:&v42];

    if ((v42 & 1) == 0)
    {
      v32 = objc_autoreleasePoolPush();
      selfCopy = self;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543874;
        v44 = v35;
        v45 = 2112;
        v46 = memberCopy;
        v47 = 2112;
        v48 = registrationCopy;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize Matter bulletin registration on home member: %@, registration: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v32);
      goto LABEL_8;
    }
  }

  deviceAddress = [sourceCopy deviceAddress];
  idsIdentifier = [deviceAddress idsIdentifier];
  [bulletinRegistrationCopy setDeviceIdsIdentifier:idsIdentifier];

  deviceAddress2 = [sourceCopy deviceAddress];
  idsDestination = [deviceAddress2 idsDestination];
  [bulletinRegistrationCopy setDeviceIdsDestination:idsDestination];

  matterPaths = [registrationCopy matterPaths];
  v38[0] = MEMORY[0x277D85DD0];
  v38[1] = 3221225472;
  v38[2] = __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke;
  v38[3] = &unk_278671DF8;
  v38[4] = self;
  v29 = registrationCopy;
  v39 = v29;
  bulletinRegistrationCopy = bulletinRegistrationCopy;
  v40 = bulletinRegistrationCopy;
  v41 = memberCopy;
  [matterPaths na_each:v38];
  conditions = [v29 conditions];
  v31 = [(HMDHome *)self addBulletinConditions:conditions on:bulletinRegistrationCopy context:contextCopy];

LABEL_9:
  v36 = *MEMORY[0x277D85DE8];
  return v31;
}

void __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke(uint64_t a1, void *a2)
{
  v71 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v50 = [v3 uuid];
  v4 = [v3 accessory];
  v5 = [v4 uuid];

  if (v5)
  {
    v6 = [HMCContext findHAPAccessoryWithModelID:v5];
    v7 = v6;
    if (!v6)
    {
      v35 = objc_autoreleasePoolPush();
      v36 = *(a1 + 32);
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
      {
        v38 = HMFGetLogIdentifier();
        *buf = 138543618;
        v58 = v38;
        v59 = 2112;
        v60 = v5;
        _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@No MKFHAPAccessory found with uuid=%@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v35);
      goto LABEL_20;
    }

    v8 = [v6 matterPaths];
    v55[0] = MEMORY[0x277D85DD0];
    v55[1] = 3221225472;
    v55[2] = __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke_1347;
    v55[3] = &unk_278671DA8;
    v9 = v3;
    v56 = v9;
    v10 = [v8 na_firstObjectPassingTest:v55];

    if (!v10)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = *(a1 + 32);
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        *buf = 138543618;
        v58 = v14;
        v59 = 2112;
        v60 = v50;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Could not locate the MKFMatterPath with UUID: %@, creating one", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
      v54 = 0;
      v10 = [v7 materializeOrCreateMatterPathsRelationWithModelID:v50 createdNew:&v54];
      if ((v54 & 1) == 0)
      {
        v40 = objc_autoreleasePoolPush();
        v41 = *(a1 + 32);
        v42 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
        {
          v43 = HMFGetLogIdentifier();
          v44 = *(a1 + 40);
          *buf = 138543874;
          v58 = v43;
          v59 = 2112;
          v60 = v7;
          v61 = 2112;
          v62 = v44;
          _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize Matter Path on accessory: %@ for registration: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v40);
        goto LABEL_13;
      }

      v15 = [v9 endpointID];
      [v10 setEndpointID:v15];

      v16 = [v9 clusterID];
      [v10 setClusterID:v16];

      v17 = [v9 attributeID];
      [v10 setAttributeID:v17];

      v18 = [v9 eventID];
      [v10 setEventID:v18];

      [v7 addMatterPathsObject:v10];
    }

    v19 = [*(a1 + 48) matterPaths];
    v51[0] = MEMORY[0x277D85DD0];
    v51[1] = 3221225472;
    v51[2] = __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke_1349;
    v51[3] = &unk_278671DD0;
    v20 = v9;
    v52 = v20;
    v53 = v5;
    v21 = [v19 na_any:v51];

    if ((v21 & 1) == 0)
    {
      [*(a1 + 48) addMatterPathsObject:v10];
      [v10 addMatterBulletinRegistrationsObject:*(a1 + 48)];
      v22 = objc_autoreleasePoolPush();
      v23 = *(a1 + 32);
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v48 = HMFGetLogIdentifier();
        v46 = [v20 accessory];
        [v46 uuid];
        v25 = v45 = v23;
        [v20 endpointID];
        v26 = log = v24;
        v27 = [v20 clusterID];
        [v20 attributeID];
        v28 = v47 = v22;
        v29 = [v20 eventID];
        v30 = [*(a1 + 56) uniqueIDForAccessories];
        *buf = 138544898;
        v58 = v48;
        v59 = 2112;
        v60 = v25;
        v61 = 2112;
        v62 = v26;
        v63 = 2112;
        v64 = v27;
        v65 = 2112;
        v66 = v28;
        v67 = 2112;
        v68 = v29;
        v69 = 2112;
        v70 = v30;
        _os_log_impl(&dword_229538000, log, OS_LOG_TYPE_INFO, "%{public}@Inserted Matter bulletin registration with accessoryModelID=%@ endpointID=%@ clusterID=%@ attributeID=%@ eventID=%@ for home member uniqueID=%@", buf, 0x48u);

        v22 = v47;
        v24 = log;

        v23 = v45;
      }

      objc_autoreleasePoolPop(v22);
    }

LABEL_13:
LABEL_20:

    goto LABEL_21;
  }

  v31 = objc_autoreleasePoolPush();
  v32 = *(a1 + 32);
  v33 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
  {
    v34 = HMFGetLogIdentifier();
    *buf = 138543618;
    v58 = v34;
    v59 = 2112;
    v60 = v3;
    _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Matter path is missing accessory: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v31);
LABEL_21:

  v39 = *MEMORY[0x277D85DE8];
}

uint64_t __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke_1347(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 endpointID];
  v5 = [*(a1 + 32) endpointID];
  v6 = HMFEqualObjects();

  if (!v6)
  {
    goto LABEL_5;
  }

  v7 = [v3 clusterID];
  v8 = [*(a1 + 32) clusterID];
  v9 = HMFEqualObjects();

  if (!v9)
  {
    goto LABEL_5;
  }

  v10 = [v3 attributeID];
  v11 = [*(a1 + 32) attributeID];
  v12 = HMFEqualObjects();

  if (v12)
  {
    v13 = [v3 eventID];
    v14 = [*(a1 + 32) eventID];
    v15 = HMFEqualObjects();
  }

  else
  {
LABEL_5:
    v15 = 0;
  }

  return v15;
}

uint64_t __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke_1349(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 endpointID];
  v5 = [*(a1 + 32) endpointID];
  v6 = HMFEqualObjects();

  if (!v6)
  {
    goto LABEL_6;
  }

  v7 = [v3 accessory];
  v8 = [v7 modelID];
  v9 = *(a1 + 40);
  v10 = HMFEqualObjects();

  if (!v10)
  {
    goto LABEL_6;
  }

  v11 = [v3 clusterID];
  v12 = [*(a1 + 32) clusterID];
  v13 = HMFEqualObjects();

  if (!v13)
  {
    goto LABEL_6;
  }

  v14 = [v3 attributeID];
  v15 = [*(a1 + 32) attributeID];
  v16 = HMFEqualObjects();

  if (v16)
  {
    v17 = [v3 eventID];
    v18 = [*(a1 + 32) eventID];
    v19 = HMFEqualObjects();
  }

  else
  {
LABEL_6:
    v19 = 0;
  }

  return v19;
}

- (BOOL)insertOrUpdateCharacteristicBulletinRegistration:(id)registration source:(id)source managedBulletinRegistration:(id)bulletinRegistration accessory:(id)accessory homeMember:(id)member context:(id)context
{
  v52 = *MEMORY[0x277D85DE8];
  registrationCopy = registration;
  sourceCopy = source;
  bulletinRegistrationCopy = bulletinRegistration;
  accessoryCopy = accessory;
  memberCopy = member;
  contextCopy = context;
  managedObjectContext = [contextCopy managedObjectContext];
  [managedObjectContext hmd_assertIsExecuting];

  if (bulletinRegistrationCopy || (v45 = 0, [MEMORY[0x277CCAD78] UUID], v21 = objc_claimAutoreleasedReturnValue(), objc_msgSend(memberCopy, "materializeOrCreateBulletinRegistrationsRelationOfTypeCharacteristicBulletinRegistrationWithModelID:createdNew:", v21, &v45), bulletinRegistrationCopy = objc_claimAutoreleasedReturnValue(), v21, (v45 & 1) != 0))
  {
    deviceAddress = [sourceCopy deviceAddress];
    idsIdentifier = [deviceAddress idsIdentifier];
    [bulletinRegistrationCopy setDeviceIdsIdentifier:idsIdentifier];

    deviceAddress2 = [sourceCopy deviceAddress];
    idsDestination = [deviceAddress2 idsDestination];
    [bulletinRegistrationCopy setDeviceIdsDestination:idsDestination];

    characteristicInstanceID = [registrationCopy characteristicInstanceID];
    managedObjectContext2 = [contextCopy managedObjectContext];
    v28 = [accessoryCopy characteristicFromInstanceID:characteristicInstanceID context:managedObjectContext2];

    if (v28)
    {
      [bulletinRegistrationCopy setCharacteristic:v28];
      [registrationCopy conditions];
      v30 = v29 = memberCopy;
      v31 = [(HMDHome *)self addBulletinConditions:v30 on:bulletinRegistrationCopy context:contextCopy];

      memberCopy = v29;
    }

    else
    {
      v32 = objc_autoreleasePoolPush();
      selfCopy = self;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v35 = v43 = v32;
        [registrationCopy characteristicInstanceID];
        v36 = v44 = memberCopy;
        *buf = 138543618;
        v47 = v35;
        v48 = 2112;
        v49 = v36;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Could not locate the characteristic with instance ID: %@", buf, 0x16u);

        memberCopy = v44;
        v32 = v43;
      }

      objc_autoreleasePoolPop(v32);
      v31 = 0;
    }
  }

  else
  {
    v39 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v41 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
    {
      v42 = HMFGetLogIdentifier();
      *buf = 138543874;
      v47 = v42;
      v48 = 2112;
      v49 = memberCopy;
      v50 = 2112;
      v51 = registrationCopy;
      _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize characteristic bulletin registration on home member: %@, registration: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v39);
    v31 = 0;
  }

  v37 = *MEMORY[0x277D85DE8];
  return v31;
}

- (id)findBulletinRegistration:(id)registration source:(id)source homeMember:(id)member context:(id)context
{
  v155 = *MEMORY[0x277D85DE8];
  registrationCopy = registration;
  sourceCopy = source;
  memberCopy = member;
  contextCopy = context;
  managedObjectContext = [contextCopy managedObjectContext];
  [managedObjectContext hmd_assertIsExecuting];

  dictionary = [MEMORY[0x277CBEB38] dictionary];
  objc_opt_class();
  v143 = sourceCopy;
  v144 = contextCopy;
  if (objc_opt_isKindOfClass())
  {
    selfCopy = self;
    v16 = dictionary;
    v139 = registrationCopy;
    v17 = registrationCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    accessoryUUID = [v19 accessoryUUID];
    serviceInstanceID = [v19 serviceInstanceID];
    characteristicInstanceID = [v19 characteristicInstanceID];
    deviceAddress = [sourceCopy deviceAddress];
    [deviceAddress idsIdentifier];
    v25 = v24 = memberCopy;
    managedObjectContext2 = [contextCopy managedObjectContext];
    v137 = [v24 characteristicBulletinRegistrationForAccessory:accessoryUUID serviceInstanceID:serviceInstanceID characteristicInstanceID:characteristicInstanceID deviceIdsIdentifier:v25 context:managedObjectContext2];

    v27 = v24;
    home = [v24 home];
    accessoryUUID2 = [v19 accessoryUUID];
    v30 = [home findAccessoriesRelationOfTypeHAPAccessoryWithModelID:accessoryUUID2];

    if (v30)
    {
      dictionary = v16;
      [v16 setObject:v30 forKeyedSubscript:@"HMD.BU.TUP.acc"];

      registrationCopy = v139;
      memberCopy = v27;
      sourceCopy = v143;
      v31 = v137;
LABEL_53:
      [dictionary setObject:v31 forKeyedSubscript:@"HMD.BU.TUP.bulletin"];
      v66 = dictionary;
      goto LABEL_87;
    }

    v62 = objc_autoreleasePoolPush();
    v63 = selfCopy;
    v64 = HMFGetOSLogHandle();
    dictionary = v16;
    if (os_log_type_enabled(v64, OS_LOG_TYPE_ERROR))
    {
      v65 = HMFGetLogIdentifier();
      *buf = 138543618;
      v146 = v65;
      v147 = 2112;
      v148 = v17;
      _os_log_impl(&dword_229538000, v64, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the accessory : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v62);
    v66 = MEMORY[0x277CBEC10];
    registrationCopy = v139;
    memberCopy = v27;
    sourceCopy = v143;
    v31 = v137;
    goto LABEL_87;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      selfCopy2 = self;
      v33 = dictionary;
      v49 = registrationCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v50 = v49;
      }

      else
      {
        v50 = 0;
      }

      v36 = v50;

      v51 = memberCopy;
      if ([v51 conformsToProtocol:&unk_283EF6078])
      {
        v52 = v51;
      }

      else
      {
        v52 = 0;
      }

      v53 = v52;

      if (!v53)
      {
        v73 = objc_autoreleasePoolPush();
        v74 = selfCopy2;
        v75 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
        {
          v76 = HMFGetLogIdentifier();
          *buf = 138543618;
          v146 = v76;
          v147 = 2112;
          v148 = v51;
          v77 = "%{public}@Camera access bulletin notification registrations are not supported for guests : %@";
          goto LABEL_79;
        }

LABEL_80:

        objc_autoreleasePoolPop(v73);
LABEL_86:

        v31 = 0;
        v66 = MEMORY[0x277CBEC10];
        dictionary = v33;
        sourceCopy = v143;
        goto LABEL_87;
      }

      home2 = [v53 home];
      [v36 accessoryUUID];
      v55 = v141 = v36;
      v56 = [home2 findAccessoriesRelationOfTypeHAPAccessoryWithModelID:v55];

      if (v56)
      {
        dictionary = v33;
        [v33 setObject:v56 forKeyedSubscript:@"HMD.BU.TUP.acc"];
        sourceCopy = v143;
        deviceAddress2 = [v143 deviceAddress];
        idsIdentifier = [deviceAddress2 idsIdentifier];
        [contextCopy managedObjectContext];
        v60 = v59 = memberCopy;
        v61 = [v56 cameraAccessModeBulletinRegistrationWithDeviceIdsIdentifier:idsIdentifier user:v53 context:v60];
LABEL_52:
        v31 = v61;

        memberCopy = v59;
        goto LABEL_53;
      }

      v36 = v141;
      v114 = objc_autoreleasePoolPush();
      v115 = selfCopy2;
      v116 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v116, OS_LOG_TYPE_ERROR))
      {
LABEL_69:
        HMFGetLogIdentifier();
        v118 = v117 = v114;
        *buf = 138543618;
        v146 = v118;
        v147 = 2112;
        v148 = v49;
        v119 = "%{public}@Unable to find the accessory : %@";
LABEL_84:
        _os_log_impl(&dword_229538000, v116, OS_LOG_TYPE_ERROR, v119, buf, 0x16u);

        v114 = v117;
      }
    }

    else
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        selfCopy3 = self;
        v33 = dictionary;
        v49 = registrationCopy;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v68 = v49;
        }

        else
        {
          v68 = 0;
        }

        v36 = v68;

        v69 = memberCopy;
        if ([v69 conformsToProtocol:&unk_283EF6078])
        {
          v70 = v69;
        }

        else
        {
          v70 = 0;
        }

        v53 = v70;

        if (!v53)
        {
          v73 = objc_autoreleasePoolPush();
          v74 = selfCopy3;
          v75 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
          {
            v76 = HMFGetLogIdentifier();
            *buf = 138543618;
            v146 = v76;
            v147 = 2112;
            v148 = v69;
            v77 = "%{public}@Camera reachability bulletin notification registrations are not supported for guests : %@";
            goto LABEL_79;
          }

          goto LABEL_80;
        }

        home3 = [v53 home];
        [v36 accessoryUUID];
        v72 = v141 = v36;
        v56 = [home3 findAccessoriesRelationOfTypeHAPAccessoryWithModelID:v72];

        if (v56)
        {
          dictionary = v33;
          [v33 setObject:v56 forKeyedSubscript:@"HMD.BU.TUP.acc"];
          sourceCopy = v143;
          deviceAddress2 = [v143 deviceAddress];
          idsIdentifier = [deviceAddress2 idsIdentifier];
          [contextCopy managedObjectContext];
          v60 = v59 = memberCopy;
          v61 = [v56 cameraReachabilityBulletinRegistrationWithDeviceIdsIdentifier:idsIdentifier user:v53 context:v60];
          goto LABEL_52;
        }

        v36 = v141;
        v114 = objc_autoreleasePoolPush();
        v115 = selfCopy3;
        v116 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v116, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_69;
        }
      }

      else
      {
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          v90 = memberCopy;
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) == 0)
          {
            v120 = dictionary;
            v121 = objc_autoreleasePoolPush();
            selfCopy4 = self;
            v123 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v123, OS_LOG_TYPE_INFO))
            {
              v124 = HMFGetLogIdentifier();
              *buf = 138543618;
              v146 = v124;
              v147 = 2112;
              v148 = registrationCopy;
              _os_log_impl(&dword_229538000, v123, OS_LOG_TYPE_INFO, "%{public}@(b) Unknown bulletin registration type found. Ignoring it : %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v121);
            dictionary = v120;
            v31 = 0;
            goto LABEL_53;
          }

          v91 = +[HMDCoreData featuresDataSource];
          isRVCEnabled = [v91 isRVCEnabled];

          if (!isRVCEnabled)
          {
            v31 = 0;
            goto LABEL_53;
          }

          v142 = dictionary;
          v93 = registrationCopy;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v94 = v93;
          }

          else
          {
            v94 = 0;
          }

          v95 = v94;
          v132 = v93;

          v138 = v95;
          matterPaths = [v95 matterPaths];
          firstObject = [matterPaths firstObject];

          endpointID = [firstObject endpointID];
          v136 = firstObject;
          accessory = [firstObject accessory];
          uuid = [accessory uuid];

          v101 = objc_autoreleasePoolPush();
          selfCopy5 = self;
          v103 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v103, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v104 = v133 = v101;
            uniqueIDForAccessories = [memberCopy uniqueIDForAccessories];
            deviceAddress3 = [v143 deviceAddress];
            idsIdentifier2 = [deviceAddress3 idsIdentifier];
            *buf = 138544386;
            v146 = v104;
            v147 = 2112;
            v148 = uniqueIDForAccessories;
            v149 = 2112;
            v150 = endpointID;
            v151 = 2112;
            v152 = uuid;
            v153 = 2112;
            v154 = idsIdentifier2;
            _os_log_impl(&dword_229538000, v103, OS_LOG_TYPE_INFO, "%{public}@Finding HMDMatterBulletinNotificationRegistration for HomeMemberUniqueIDForAccessories=%@ endpointID=%@ accessoryUUID=%@ deviceIdsIdentifier=%@", buf, 0x34u);

            v101 = v133;
          }

          objc_autoreleasePoolPop(v101);
          deviceAddress4 = [v143 deviceAddress];
          idsIdentifier3 = [deviceAddress4 idsIdentifier];
          managedObjectContext3 = [v144 managedObjectContext];
          v134 = endpointID;
          v31 = [v90 matterBulletinRegistrationForEndpointID:endpointID accessoryUUID:uuid deviceIdsIdentifier:idsIdentifier3 context:managedObjectContext3];

          memberCopy = v90;
          home4 = [v90 home];
          v112 = [home4 findAccessoriesRelationOfTypeHAPAccessoryWithModelID:uuid];

          v113 = uuid;
          if (v112)
          {
            dictionary = v142;
            [v142 setObject:v112 forKeyedSubscript:@"HMD.BU.TUP.acc"];
            sourceCopy = v143;
          }

          else
          {
            v127 = v31;
            v128 = objc_autoreleasePoolPush();
            v129 = selfCopy5;
            v130 = HMFGetOSLogHandle();
            dictionary = v142;
            if (os_log_type_enabled(v130, OS_LOG_TYPE_ERROR))
            {
              v131 = HMFGetLogIdentifier();
              *buf = 138543618;
              v146 = v131;
              v147 = 2112;
              v148 = v132;
              _os_log_impl(&dword_229538000, v130, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the accessory : %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v128);
            sourceCopy = v143;
            v31 = v127;
          }

          if (v112)
          {
            goto LABEL_53;
          }

          v66 = MEMORY[0x277CBEC10];
          goto LABEL_87;
        }

        selfCopy6 = self;
        v33 = dictionary;
        v79 = registrationCopy;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v80 = v79;
        }

        else
        {
          v80 = 0;
        }

        v36 = v80;

        v81 = memberCopy;
        if ([v81 conformsToProtocol:&unk_283EF6078])
        {
          v82 = v81;
        }

        else
        {
          v82 = 0;
        }

        v53 = v82;

        if (!v53)
        {
          v73 = objc_autoreleasePoolPush();
          v74 = selfCopy6;
          v75 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
          {
            v76 = HMFGetLogIdentifier();
            *buf = 138543618;
            v146 = v76;
            v147 = 2112;
            v148 = v81;
            v77 = "%{public}@Audio analysis event bulletin notification registrations are not supported for guests : %@";
            goto LABEL_79;
          }

          goto LABEL_80;
        }

        home5 = [v53 home];
        [v36 accessoryUUID];
        v84 = v141 = v36;
        v56 = [home5 findAccessoriesRelationOfTypeAppleMediaAccessoryWithModelID:v84];

        if (v56)
        {
          dictionary = v33;
          [v33 setObject:v56 forKeyedSubscript:@"HMD.BU.TUP.acc"];
          sourceCopy = v143;
          deviceAddress2 = [v143 deviceAddress];
          idsIdentifier = [deviceAddress2 idsIdentifier];
          [contextCopy managedObjectContext];
          v60 = v59 = memberCopy;
          v61 = [v56 analysisBulletinRegistrationWithDeviceIdsIdentifier:idsIdentifier user:v53 context:v60];
          goto LABEL_52;
        }

        v36 = v141;
        v114 = objc_autoreleasePoolPush();
        v115 = selfCopy6;
        v116 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v116, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v118 = v117 = v114;
          *buf = 138543618;
          v146 = v118;
          v147 = 2112;
          v148 = v79;
          v119 = "%{public}@Unable to find the accessory for audio analysis registration registration :%@";
          goto LABEL_84;
        }
      }
    }

    objc_autoreleasePoolPop(v114);
    goto LABEL_86;
  }

  selfCopy7 = self;
  v33 = dictionary;
  v34 = registrationCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v35 = v34;
  }

  else
  {
    v35 = 0;
  }

  v36 = v35;

  v37 = memberCopy;
  if ([v37 conformsToProtocol:&unk_283EF6078])
  {
    v38 = v37;
  }

  else
  {
    v38 = 0;
  }

  v39 = v38;

  if (!v39)
  {
    v73 = objc_autoreleasePoolPush();
    v74 = selfCopy7;
    v75 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
    {
      v76 = HMFGetLogIdentifier();
      *buf = 138543618;
      v146 = v76;
      v147 = 2112;
      v148 = v37;
      v77 = "%{public}@Camera significant event bulletin notification registrations are not supported for guests : %@";
LABEL_79:
      _os_log_impl(&dword_229538000, v75, OS_LOG_TYPE_ERROR, v77, buf, 0x16u);

      goto LABEL_80;
    }

    goto LABEL_80;
  }

  v140 = registrationCopy;
  home6 = [v39 home];
  [v36 cameraIdentifier];
  v42 = v41 = v36;
  v43 = [home6 findAccessoriesRelationOfTypeHAPAccessoryWithModelID:v42];

  if (v43)
  {
    dictionary = v33;
    [v33 setObject:v43 forKeyedSubscript:@"HMD.BU.TUP.acc"];
    sourceCopy = v143;
    deviceAddress5 = [v143 deviceAddress];
    idsIdentifier4 = [deviceAddress5 idsIdentifier];
    [contextCopy managedObjectContext];
    v47 = v46 = memberCopy;
    v31 = [v43 cameraSignificantEventBulletinRegistrationWithDeviceIdsIdentifier:idsIdentifier4 user:v39 context:v47];

    memberCopy = v46;
    registrationCopy = v140;
    goto LABEL_53;
  }

  v85 = v41;
  v86 = objc_autoreleasePoolPush();
  v87 = selfCopy7;
  v88 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v88, OS_LOG_TYPE_ERROR))
  {
    v89 = HMFGetLogIdentifier();
    *buf = 138543618;
    v146 = v89;
    v147 = 2112;
    v148 = v34;
    _os_log_impl(&dword_229538000, v88, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the accessory : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v86);
  v31 = 0;
  v66 = MEMORY[0x277CBEC10];
  dictionary = v33;
  registrationCopy = v140;
  sourceCopy = v143;
LABEL_87:

  v125 = *MEMORY[0x277D85DE8];

  return v66;
}

- (void)maybeRemoveStaleRegistrationsFromPreviousUserForSource:(id)source homeMember:(id)member context:(id)context
{
  v43[2] = *MEMORY[0x277D85DE8];
  sourceCopy = source;
  memberCopy = member;
  contextCopy = context;
  managedObjectContext = [contextCopy managedObjectContext];
  [managedObjectContext hmd_assertIsExecuting];

  deviceAddress = [sourceCopy deviceAddress];
  idsIdentifier = [deviceAddress idsIdentifier];

  v14 = +[_MKFBulletinRegistration fetchRequest];
  memberCopy = [MEMORY[0x277CCAC30] predicateWithFormat:@"(%K == %@) && (%K != %@)", @"deviceIdsIdentifier", idsIdentifier, @"user", memberCopy];
  [v14 setPredicate:memberCopy];
  memberCopy2 = [MEMORY[0x277CCAC30] predicateWithFormat:@"(%K == %@) && (%K != %@)", @"deviceIdsIdentifier", idsIdentifier, @"guest", memberCopy];
  v17 = MEMORY[0x277CCA920];
  v43[0] = memberCopy;
  v43[1] = memberCopy2;
  v18 = [MEMORY[0x277CBEA60] arrayWithObjects:v43 count:2];
  v19 = [v17 orPredicateWithSubpredicates:v18];
  [v14 setPredicate:v19];

  managedObjectContext2 = [contextCopy managedObjectContext];
  v36 = 0;
  v21 = [managedObjectContext2 executeFetchRequest:v14 error:&v36];
  v33 = v36;

  if (v21)
  {
    if ([v21 count])
    {
      context = objc_autoreleasePoolPush();
      selfCopy = self;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v24 = v29 = sourceCopy;
        *buf = 138543874;
        v38 = v24;
        v39 = 2112;
        v40 = v21;
        v41 = 2112;
        v42 = idsIdentifier;
        _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Deleting stale registrations: %@ for idsIdentifier: %@", buf, 0x20u);

        sourceCopy = v29;
      }

      objc_autoreleasePoolPop(context);
      v34[0] = MEMORY[0x277D85DD0];
      v34[1] = 3221225472;
      v34[2] = __108__HMDHome_BulletinNotifications__maybeRemoveStaleRegistrationsFromPreviousUserForSource_homeMember_context___block_invoke;
      v34[3] = &unk_27867ED28;
      v35 = contextCopy;
      [v21 na_each:v34];
    }
  }

  else
  {
    contexta = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v27 = v30 = sourceCopy;
      *buf = 138543618;
      v38 = v27;
      v39 = 2112;
      v40 = idsIdentifier;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch bulletin registrations for idsIdentifier: %@", buf, 0x16u);

      sourceCopy = v30;
    }

    objc_autoreleasePoolPop(contexta);
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)disableBulletinRegistrations:(id)registrations source:(id)source homeMember:(id)member context:(id)context
{
  sourceCopy = source;
  memberCopy = member;
  contextCopy = context;
  registrationsCopy = registrations;
  managedObjectContext = [contextCopy managedObjectContext];
  [managedObjectContext hmd_assertIsExecuting];

  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __89__HMDHome_BulletinNotifications__disableBulletinRegistrations_source_homeMember_context___block_invoke;
  v18[3] = &unk_278671D80;
  v18[4] = self;
  v19 = sourceCopy;
  v20 = memberCopy;
  v21 = contextCopy;
  v15 = contextCopy;
  v16 = memberCopy;
  v17 = sourceCopy;
  [registrationsCopy hmf_enumerateWithAutoreleasePoolUsingBlock:v18];
}

void __89__HMDHome_BulletinNotifications__disableBulletinRegistrations_source_homeMember_context___block_invoke(uint64_t a1, uint64_t a2)
{
  v4 = [*(a1 + 32) findBulletinRegistration:a2 source:*(a1 + 40) homeMember:*(a1 + 48) context:*(a1 + 56)];
  v3 = [v4 objectForKeyedSubscript:@"HMD.BU.TUP.bulletin"];
  if (v3)
  {
    [*(a1 + 56) deleteObject:v3];
  }
}

- (BOOL)enableBulletinRegistrations:(id)registrations source:(id)source homeMember:(id)member context:(id)context
{
  registrationsCopy = registrations;
  sourceCopy = source;
  memberCopy = member;
  contextCopy = context;
  managedObjectContext = [contextCopy managedObjectContext];
  [managedObjectContext hmd_assertIsExecuting];

  v24 = 0;
  v25 = &v24;
  v26 = 0x2020000000;
  v27 = 1;
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __88__HMDHome_BulletinNotifications__enableBulletinRegistrations_source_homeMember_context___block_invoke;
  v19[3] = &unk_278671D58;
  v19[4] = self;
  v15 = sourceCopy;
  v20 = v15;
  v16 = memberCopy;
  v21 = v16;
  v17 = contextCopy;
  v22 = v17;
  v23 = &v24;
  [registrationsCopy hmf_enumerateWithAutoreleasePoolUsingBlock:v19];
  LOBYTE(sourceCopy) = *(v25 + 24);

  _Block_object_dispose(&v24, 8);
  return sourceCopy;
}

void __88__HMDHome_BulletinNotifications__enableBulletinRegistrations_source_homeMember_context___block_invoke(uint64_t a1, void *a2, _BYTE *a3)
{
  v158 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = [*(a1 + 32) findBulletinRegistration:v5 source:*(a1 + 40) homeMember:*(a1 + 48) context:*(a1 + 56)];
  v7 = [v6 objectForKeyedSubscript:@"HMD.BU.TUP.bulletin"];
  v8 = [v6 objectForKeyedSubscript:@"HMD.BU.TUP.acc"];
  if (v8)
  {
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      v36 = 1;
      goto LABEL_23;
    }

    v146 = a3;
    v152 = v8;
    v9 = v8;
    v10 = [v9 conformsToProtocol:&unk_283F1F3B0];
    v11 = v10;
    if (v10)
    {
      v12 = v9;
    }

    else
    {
      v12 = 0;
    }

    v13 = v12;

    v14 = v5;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;

    v17 = [v7 castIfAnalysisEventBulletinRegistration];
    if (v11)
    {
      v143 = v7;
      v18 = v14;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v19 = v18;
      }

      else
      {
        v19 = 0;
      }

      v20 = v19;

      if (v17)
      {
        v21 = [HMDBulletinNotificationRegistrationUtilities audioAnalysisNotificationRegistrationFromRemoteRegistration:v17];
        v22 = [v21 registration];
        if ([v22 isEqual:v20])
        {
          [v21 source];
          v140 = v17;
          v23 = v5;
          v24 = v6;
          v25 = v20;
          v27 = v26 = v16;
          v28 = [v27 isEqual:*(a1 + 40)];

          v16 = v26;
          v20 = v25;
          v6 = v24;
          v5 = v23;
          v17 = v140;

          if (v28)
          {
            v29 = objc_autoreleasePoolPush();
            v139 = *(a1 + 32);
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
            {
              HMFGetLogIdentifier();
              v31 = v138 = v29;
              *buf = 138543618;
              v155 = v31;
              v156 = 2112;
              v157 = v20;
              _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Audio Analysis bulletin registration: %@ matches existing registration, skipping", buf, 0x16u);

              v29 = v138;
            }

            objc_autoreleasePoolPop(v29);
            goto LABEL_62;
          }
        }

        else
        {
        }
      }

      v76 = *(a1 + 48);
      if ([v76 conformsToProtocol:&unk_283EF6078])
      {
        v77 = v76;
      }

      else
      {
        v77 = 0;
      }

      v21 = v77;

      if (v21)
      {
        v78 = [*(a1 + 32) insertOrUpdateAudioAnalysisEventBulletinRegistrations:v20 source:*(a1 + 40) managedBulletinRegistration:v17 accessory:v9 user:v21 context:*(a1 + 56)];
        v36 = v78;
        v79 = v78 ^ 1;
        goto LABEL_63;
      }

      v80 = objc_autoreleasePoolPush();
      v81 = *(a1 + 32);
      v82 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v82, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v83 = v142 = v80;
        v84 = *(a1 + 48);
        *buf = 138543618;
        v155 = v83;
        v156 = 2112;
        v157 = v84;
        _os_log_impl(&dword_229538000, v82, OS_LOG_TYPE_ERROR, "%{public}@Audio analysis bulletin notification registrations are not supported for guests : %@", buf, 0x16u);

        v80 = v142;
      }

      objc_autoreleasePoolPop(v80);
      v21 = 0;
LABEL_62:
      v79 = 0;
      v36 = 1;
LABEL_63:

      v7 = v143;
      a3 = v146;
      v8 = v152;
      if (!v79)
      {
        goto LABEL_144;
      }

LABEL_23:
      v37 = v8;
      v38 = [v37 conformsToProtocol:&unk_283F59838];
      v39 = v38;
      if (v38)
      {
        v40 = v37;
      }

      else
      {
        v40 = 0;
      }

      v41 = v40;

      if ((v39 & 1) == 0)
      {
        *a3 = 1;
        *(*(*(a1 + 64) + 8) + 24) = 0;
        v54 = objc_autoreleasePoolPush();
        v55 = *(a1 + 32);
        v56 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v56, OS_LOG_TYPE_ERROR))
        {
          v57 = HMFGetLogIdentifier();
          *buf = 138543618;
          v155 = v57;
          v156 = 2112;
          v157 = v5;
          _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_ERROR, "%{public}@Did not find the accessory on which this bulletin needs to be applied upon. %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v54);
        goto LABEL_143;
      }

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v147 = a3;
        v42 = v5;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v43 = v42;
        }

        else
        {
          v43 = 0;
        }

        v44 = v43;

        v45 = [v7 castIfCharacteristicBulletinRegistration];
        if (v45)
        {
          v141 = v41;
          v144 = v7;
          v153 = v8;
          v46 = [HMDBulletinNotificationRegistrationUtilities accessoryRegistrationFromMKFRegistration:v45];
          v47 = [v46 registration];
          if ([v47 isEqual:v44])
          {
            v48 = [v46 source];
            v49 = [v48 isEqual:*(a1 + 40)];

            if (v49)
            {
              v50 = objc_autoreleasePoolPush();
              v51 = *(a1 + 32);
              v52 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
              {
                v53 = HMFGetLogIdentifier();
                *buf = 138543618;
                v155 = v53;
                v156 = 2112;
                v157 = v44;
                _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_INFO, "%{public}@Characteristic bulletin registration: %@ matches existing registration, skipping", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v50);
              goto LABEL_89;
            }
          }

          else
          {
          }

          v41 = v141;
          v7 = v144;
          v8 = v153;
        }

        v90 = [*(a1 + 32) insertOrUpdateCharacteristicBulletinRegistration:v44 source:*(a1 + 40) managedBulletinRegistration:v45 accessory:v37 homeMember:*(a1 + 48) context:{*(a1 + 56), v138}];

        a3 = v147;
        if (v90)
        {
          goto LABEL_143;
        }

LABEL_142:
        *a3 = 1;
        *(*(*(a1 + 64) + 8) + 24) = 0;
        goto LABEL_143;
      }

      objc_opt_class();
      v153 = v8;
      if (objc_opt_isKindOfClass())
      {
        v63 = v5;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v64 = v63;
        }

        else
        {
          v64 = 0;
        }

        v65 = v64;

        v144 = v7;
        v66 = [v7 castIfCameraSignificantEventBulletinRegistration];
        if (v66)
        {
          v148 = a3;
          v141 = v41;
          v67 = [HMDBulletinNotificationRegistrationUtilities cameraSignificantEventRegistrationFromMKFRegistration:v66];
          v68 = [v67 registration];
          if ([v68 isEqual:v65])
          {
            v69 = [v67 source];
            v70 = [v69 isEqual:*(a1 + 40)];

            if (v70)
            {
              v71 = objc_autoreleasePoolPush();
              v72 = *(a1 + 32);
              v73 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v73, OS_LOG_TYPE_INFO))
              {
                v74 = HMFGetLogIdentifier();
                *buf = 138543618;
                v155 = v74;
                v156 = 2112;
                v157 = v65;
                v75 = "%{public}@Camera Significant Event bulletin registration: %@ matches existing registration, skipping";
LABEL_87:
                _os_log_impl(&dword_229538000, v73, OS_LOG_TYPE_INFO, v75, buf, 0x16u);

                goto LABEL_88;
              }

              goto LABEL_88;
            }
          }

          else
          {
          }

          v41 = v141;
          a3 = v148;
        }

        v96 = *(a1 + 48);
        if ([v96 conformsToProtocol:&unk_283EF6078])
        {
          v97 = v96;
        }

        else
        {
          v97 = 0;
        }

        v98 = v97;

        if (v98)
        {
          v99 = [*(a1 + 32) insertOrUpdateCameraSignificantEventBulletinRegistration:v65 source:*(a1 + 40) managedBulletinRegistration:v66 accessory:v37 user:v98 context:*(a1 + 56)];
          goto LABEL_130;
        }

        v100 = objc_autoreleasePoolPush();
        v101 = *(a1 + 32);
        v102 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v102, OS_LOG_TYPE_ERROR))
        {
          v103 = HMFGetLogIdentifier();
          v104 = *(a1 + 48);
          *buf = 138543618;
          v155 = v103;
          v156 = 2112;
          v157 = v104;
          v105 = "%{public}@Camera significant event bulletin notification registrations are not supported for guests : %@";
LABEL_134:
          _os_log_impl(&dword_229538000, v102, OS_LOG_TYPE_ERROR, v105, buf, 0x16u);

          goto LABEL_135;
        }

        goto LABEL_135;
      }

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v85 = v5;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v86 = v85;
        }

        else
        {
          v86 = 0;
        }

        v65 = v86;

        v144 = v7;
        v66 = [v7 castIfCameraAccessModeBulletinRegistration];
        if (v66)
        {
          v149 = a3;
          v141 = v41;
          v67 = [HMDBulletinNotificationRegistrationUtilities cameraAccessModeRegistrationFromMKFRegistration:v66];
          v87 = [v67 registration];
          if ([v87 isEqual:v65])
          {
            v88 = [v67 source];
            v89 = [v88 isEqual:*(a1 + 40)];

            if (v89)
            {
              v71 = objc_autoreleasePoolPush();
              v72 = *(a1 + 32);
              v73 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v73, OS_LOG_TYPE_INFO))
              {
                v74 = HMFGetLogIdentifier();
                *buf = 138543618;
                v155 = v74;
                v156 = 2112;
                v157 = v65;
                v75 = "%{public}@Camera Access Mode bulletin registration: %@ matches existing registration, skipping";
                goto LABEL_87;
              }

LABEL_88:

              objc_autoreleasePoolPop(v71);
LABEL_89:
              v7 = v144;
LABEL_90:
              v8 = v153;
              v41 = v141;
LABEL_143:

              goto LABEL_144;
            }
          }

          else
          {
          }

          v41 = v141;
          a3 = v149;
        }

        v120 = *(a1 + 48);
        if ([v120 conformsToProtocol:&unk_283EF6078])
        {
          v121 = v120;
        }

        else
        {
          v121 = 0;
        }

        v98 = v121;

        if (!v98)
        {
          v100 = objc_autoreleasePoolPush();
          v101 = *(a1 + 32);
          v102 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v102, OS_LOG_TYPE_ERROR))
          {
            v103 = HMFGetLogIdentifier();
            v122 = *(a1 + 48);
            *buf = 138543618;
            v155 = v103;
            v156 = 2112;
            v157 = v122;
            v105 = "%{public}@Camera access mode bulletin notification registrations are not supported for guests : %@";
            goto LABEL_134;
          }

LABEL_135:

          objc_autoreleasePoolPop(v100);
          v7 = v144;
          v8 = v153;
          goto LABEL_143;
        }

        v99 = [*(a1 + 32) insertOrUpdateCameraAccessModeBulletinRegistration:v65 source:*(a1 + 40) managedBulletinRegistration:v66 accessory:v37 user:v98 context:*(a1 + 56)];
      }

      else
      {
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          v151 = a3;
          v141 = v41;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v106 = +[HMDCoreData featuresDataSource];
            v107 = [v106 isRVCEnabled];

            if (v107)
            {
              v108 = v5;
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v109 = v108;
              }

              else
              {
                v109 = 0;
              }

              v145 = v109;

              v110 = [v7 castIfMatterBulletinRegistration];
              if (v110)
              {
                v111 = [HMDBulletinNotificationRegistrationUtilities matterRegistrationFromMKFRegistration:v110 home:*(a1 + 32)];
                v112 = [v111 registration];
                if ([v112 isEqual:v145])
                {
                  v113 = [v111 source];
                  v114 = [v113 isEqual:*(a1 + 40)];

                  if (v114)
                  {
                    v115 = v7;
                    v116 = objc_autoreleasePoolPush();
                    v117 = *(a1 + 32);
                    v118 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v118, OS_LOG_TYPE_INFO))
                    {
                      v119 = HMFGetLogIdentifier();
                      *buf = 138543618;
                      v155 = v119;
                      v156 = 2112;
                      v157 = v145;
                      _os_log_impl(&dword_229538000, v118, OS_LOG_TYPE_INFO, "%{public}@Matter bulletin registration: %@ matches existing registration, skipping", buf, 0x16u);
                    }

                    objc_autoreleasePoolPop(v116);
                    v7 = v115;
                    goto LABEL_90;
                  }
                }

                else
                {
                }
              }

              v132 = v7;
              v133 = objc_autoreleasePoolPush();
              v134 = *(a1 + 32);
              v135 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v135, OS_LOG_TYPE_INFO))
              {
                v136 = HMFGetLogIdentifier();
                *buf = 138543362;
                v155 = v136;
                _os_log_impl(&dword_229538000, v135, OS_LOG_TYPE_INFO, "%{public}@Inserting Matter bulletin registration", buf, 0xCu);
              }

              objc_autoreleasePoolPop(v133);
              v36 = [*(a1 + 32) insertOrUpdateMatterBulletinRegistration:v145 source:*(a1 + 40) managedBulletinRegistration:v110 accessory:v37 homeMember:*(a1 + 48) context:*(a1 + 56)];

              v7 = v132;
              v8 = v153;
            }
          }

          else
          {
            v123 = v8;
            v124 = objc_autoreleasePoolPush();
            v125 = *(a1 + 32);
            v126 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v126, OS_LOG_TYPE_ERROR))
            {
              v127 = HMFGetLogIdentifier();
              *buf = 138543618;
              v155 = v127;
              v156 = 2112;
              v157 = v5;
              _os_log_impl(&dword_229538000, v126, OS_LOG_TYPE_ERROR, "%{public}@(a) Unknown bulletin registration type found. Ignoring it : %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v124);
            v8 = v123;
          }

          v41 = v141;
          a3 = v151;
          if (v36)
          {
            goto LABEL_143;
          }

          goto LABEL_142;
        }

        v91 = v5;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v92 = v91;
        }

        else
        {
          v92 = 0;
        }

        v65 = v92;

        v144 = v7;
        v66 = [v7 castIfCameraReachabilityBulletinRegistration];
        if (v66)
        {
          v150 = a3;
          v141 = v41;
          v67 = [HMDBulletinNotificationRegistrationUtilities cameraReachabilityRegistrationFromMKFRegistration:v66];
          v93 = [v67 registration];
          if ([v93 isEqual:v65])
          {
            v94 = [v67 source];
            v95 = [v94 isEqual:*(a1 + 40)];

            if (v95)
            {
              v71 = objc_autoreleasePoolPush();
              v72 = *(a1 + 32);
              v73 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v73, OS_LOG_TYPE_INFO))
              {
                v74 = HMFGetLogIdentifier();
                *buf = 138543618;
                v155 = v74;
                v156 = 2112;
                v157 = v65;
                v75 = "%{public}@Camera Reachability bulletin registration: %@ matches existing registration, skipping";
                goto LABEL_87;
              }

              goto LABEL_88;
            }
          }

          else
          {
          }

          v41 = v141;
          a3 = v150;
        }

        v128 = *(a1 + 48);
        if ([v128 conformsToProtocol:&unk_283EF6078])
        {
          v129 = v128;
        }

        else
        {
          v129 = 0;
        }

        v98 = v129;

        if (!v98)
        {
          v100 = objc_autoreleasePoolPush();
          v101 = *(a1 + 32);
          v102 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v102, OS_LOG_TYPE_ERROR))
          {
            v103 = HMFGetLogIdentifier();
            v131 = *(a1 + 48);
            *buf = 138543618;
            v155 = v103;
            v156 = 2112;
            v157 = v131;
            v105 = "%{public}@Camera reachability bulletin notification registrations are not supported for guests : %@";
            goto LABEL_134;
          }

          goto LABEL_135;
        }

        v99 = [*(a1 + 32) insertOrUpdateCameraReachabilityBulletinRegistration:v65 source:*(a1 + 40) managedBulletinRegistration:v66 accessory:v37 user:v98 context:*(a1 + 56)];
      }

LABEL_130:
      v130 = v99;

      v7 = v144;
      v8 = v153;
      if (v130)
      {
        goto LABEL_143;
      }

      goto LABEL_142;
    }

    v58 = objc_autoreleasePoolPush();
    v59 = *(a1 + 32);
    v60 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v60, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v62 = v61 = v7;
      *buf = 138543618;
      v155 = v62;
      v156 = 2112;
      v157 = v16;
      _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the accessory : %@", buf, 0x16u);

      v7 = v61;
    }

    objc_autoreleasePoolPop(v58);
    *v146 = 1;
    *(*(*(a1 + 64) + 8) + 24) = 0;

    v8 = v152;
  }

  else
  {
    *a3 = 1;
    *(*(*(a1 + 64) + 8) + 24) = 0;
    v32 = objc_autoreleasePoolPush();
    v33 = *(a1 + 32);
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      *buf = 138543618;
      v155 = v35;
      v156 = 2112;
      v157 = v5;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Did not find the accessory on which this bulletin needs to be applied upon. %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v32);
  }

LABEL_144:

  v137 = *MEMORY[0x277D85DE8];
}

- (void)updateEnabledBulletinRegistrations:(id)registrations disabledBulletinRegistrations:(id)bulletinRegistrations source:(id)source context:(id)context completionHandler:(id)handler
{
  v45 = *MEMORY[0x277D85DE8];
  registrationsCopy = registrations;
  bulletinRegistrationsCopy = bulletinRegistrations;
  sourceCopy = source;
  contextCopy = context;
  handlerCopy = handler;
  v17 = objc_autoreleasePoolPush();
  selfCopy = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 138544130;
    v38 = v20;
    v39 = 2112;
    v40 = sourceCopy;
    v41 = 2112;
    v42 = registrationsCopy;
    v43 = 2112;
    v44 = bulletinRegistrationsCopy;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Updating bulletin registrations for source: %@ enabled: %@ disabled: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v17);
  userUUID = [sourceCopy userUUID];
  v29[0] = MEMORY[0x277D85DD0];
  v29[1] = 3221225472;
  v29[2] = __132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke;
  v29[3] = &unk_2786873D8;
  v30 = userUUID;
  v31 = contextCopy;
  v35 = registrationsCopy;
  v36 = handlerCopy;
  v32 = selfCopy;
  v33 = sourceCopy;
  v34 = bulletinRegistrationsCopy;
  v22 = registrationsCopy;
  v23 = bulletinRegistrationsCopy;
  v24 = sourceCopy;
  v25 = handlerCopy;
  v26 = contextCopy;
  v27 = userUUID;
  [v26 unsafeSynchronousBlock:v29];

  v28 = *MEMORY[0x277D85DE8];
}

void __132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke(uint64_t a1)
{
  v51 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) managedObjectContext];
  v4 = [_MKFHome findHomeMemberWithUUID:v2 context:v3];

  if (!v4)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = *(a1 + 48);
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      v24 = *(a1 + 32);
      *buf = 138543618;
      v46 = v23;
      v47 = 2112;
      v48 = v24;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the home member with UUID: %@", buf, 0x16u);
LABEL_13:
    }

LABEL_14:

    objc_autoreleasePoolPop(v20);
    v27 = *(a1 + 80);
    v28 = MEMORY[0x277CCA9B8];
    v29 = 2;
    goto LABEL_15;
  }

  v5 = [v4 home];
  v6 = [v5 modelID];
  v7 = [*(a1 + 48) uuid];
  v8 = [v6 isEqual:v7];

  if ((v8 & 1) == 0)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = *(a1 + 48);
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      v25 = *(a1 + 32);
      v26 = [*(a1 + 48) uuid];
      *buf = 138543874;
      v46 = v23;
      v47 = 2112;
      v48 = v25;
      v49 = 2112;
      v50 = v26;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Home member with UUID: %@ is not part of current home: %@", buf, 0x20u);

      goto LABEL_13;
    }

    goto LABEL_14;
  }

  [*(a1 + 48) maybeRemoveStaleRegistrationsFromPreviousUserForSource:*(a1 + 56) homeMember:v4 context:*(a1 + 40)];
  [*(a1 + 48) disableBulletinRegistrations:*(a1 + 64) source:*(a1 + 56) homeMember:v4 context:*(a1 + 40)];
  if ([*(a1 + 48) enableBulletinRegistrations:*(a1 + 72) source:*(a1 + 56) homeMember:v4 context:*(a1 + 40)])
  {
    v9 = *(a1 + 40);
    v44 = 0;
    v10 = [v9 save:&v44];
    v11 = v44;
    v12 = v11;
    if (!v10 || v11)
    {
      v35 = objc_autoreleasePoolPush();
      v36 = *(a1 + 48);
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
      {
        v38 = HMFGetLogIdentifier();
        *buf = 138543618;
        v46 = v38;
        v47 = 2112;
        v48 = v12;
        _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@Unable to save the bulletin registration changes requested, error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v35);
      v39 = *(a1 + 80);
      if (v39)
      {
        (*(v39 + 16))(v39, v12);
      }
    }

    else
    {
      v42[0] = MEMORY[0x277D85DD0];
      v42[1] = 3221225472;
      v42[2] = __132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke_108;
      v42[3] = &unk_278671D30;
      v13 = *(a1 + 64);
      v43 = *(a1 + 56);
      v14 = [v13 na_map:v42];
      v15 = *(a1 + 72);
      v40[0] = MEMORY[0x277D85DD0];
      v40[1] = 3221225472;
      v40[2] = __132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke_2;
      v40[3] = &unk_278671D30;
      v41 = *(a1 + 56);
      v16 = [v15 na_map:v40];
      v17 = [*(a1 + 48) accessoryBulletinNotificationManager];
      [v17 handleDisabledRegistrations:v14];

      v18 = [*(a1 + 48) accessoryBulletinNotificationManager];
      [v18 handleEnabledRegistrations:v16];

      v19 = *(a1 + 80);
      if (v19)
      {
        (*(v19 + 16))(v19, 0);
      }

      v12 = 0;
    }

    goto LABEL_17;
  }

  v31 = objc_autoreleasePoolPush();
  v32 = *(a1 + 48);
  v33 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
  {
    v34 = HMFGetLogIdentifier();
    *buf = 138543362;
    v46 = v34;
    _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Unable to insert or update bulletin registrations", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v31);
  [*(a1 + 40) reset];
  v27 = *(a1 + 80);
  v28 = MEMORY[0x277CCA9B8];
  v29 = 43;
LABEL_15:
  v12 = [v28 hmErrorWithCode:v29];
  if (v27)
  {
    (*(v27 + 16))(v27, v12);
  }

LABEL_17:

  v30 = *MEMORY[0x277D85DE8];
}

HMDAccessoryBulletinNotificationRegistrationRemote *__132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke_108(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  if (v5)
  {
    v6 = [[HMDAccessoryBulletinNotificationRegistrationRemote alloc] initWithAccessoryBulletinNotificationRegistration:v5 source:*(a1 + 32)];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

HMDAccessoryBulletinNotificationRegistrationRemote *__132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  if (v5)
  {
    v6 = [[HMDAccessoryBulletinNotificationRegistrationRemote alloc] initWithAccessoryBulletinNotificationRegistration:v5 source:*(a1 + 32)];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)_performUpdateBulletinRegistrations:(id)registrations
{
  v28 = *MEMORY[0x277D85DE8];
  registrationsCopy = registrations;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    messagePayload = [registrationsCopy messagePayload];
    *buf = 138543618;
    v25 = v8;
    v26 = 2112;
    v27 = messagePayload;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received message to update bulletin notifications : [%@]", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = objc_autoreleasePoolPush();
  messagePayload2 = [registrationsCopy messagePayload];
  v12 = [(HMDHome *)selfCopy registrationSourceFromPayload:messagePayload2];
  if (v12)
  {
    hmfUnspecifiedError = [(HMDHome *)selfCopy registrationsFromPayload:messagePayload2 enabled:1];
    v14 = [(HMDHome *)selfCopy registrationsFromPayload:messagePayload2 enabled:0];
    backingStore = [(HMDHome *)selfCopy backingStore];
    context = [backingStore context];

    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __70__HMDHome_BulletinNotifications___performUpdateBulletinRegistrations___block_invoke;
    v22[3] = &unk_27868A250;
    v23 = registrationsCopy;
    [(HMDHome *)selfCopy updateEnabledBulletinRegistrations:hmfUnspecifiedError disabledBulletinRegistrations:v14 source:v12 context:context completionHandler:v22];
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = selfCopy;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543618;
      v25 = v20;
      v26 = 2112;
      v27 = messagePayload2;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Unable to decode registration source from payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
    hmfUnspecifiedError = [MEMORY[0x277CCA9B8] hmfUnspecifiedError];
    [registrationsCopy respondWithError:hmfUnspecifiedError];
  }

  objc_autoreleasePoolPop(v10);
  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __70__HMDHome_BulletinNotifications___performUpdateBulletinRegistrations___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithSuccess];
  }
}

- (void)handleUpdateBulletinRegistrations:(id)registrations
{
  registrationsCopy = registrations;
  v5 = [registrationsCopy dictionaryForKey:@"$HMDRS$"];
  if (v5)
  {
    residentSyncManager = [(HMDHome *)self residentSyncManager];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __68__HMDHome_BulletinNotifications__handleUpdateBulletinRegistrations___block_invoke;
    v7[3] = &unk_27868A398;
    v7[4] = self;
    [residentSyncManager interceptRemoteResidentRequest:registrationsCopy proceed:v7];
  }

  else
  {
    [(HMDHome *)self _performUpdateBulletinRegistrations:registrationsCopy];
  }
}

- (void)registerForBulletinNotificationRegistrationHandlersUsingPolicies:(id)policies
{
  policiesCopy = policies;
  if (isTVOSDevice())
  {
    msgDispatcher = [(HMDHome *)self msgDispatcher];
    [msgDispatcher registerForMessage:@"HMD.UP.BU.RoR" receiver:self policies:policiesCopy selector:sel_handleUpdateBulletinRegistrations_];
  }
}

- (id)registrationSourceFromPayload:(id)payload
{
  v3 = [payload objectForKeyedSubscript:@"HMD.S.BU"];
  if (v3)
  {
    v4 = [[HMDBulletinNotificationRegistrationSource alloc] initWithDictionary:v3];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)registrationsFromPayload:(id)payload enabled:(BOOL)enabled
{
  if (enabled)
  {
    v6 = @"HMD.EN.BU";
  }

  else
  {
    v6 = @"HMD.DIS.BU";
  }

  v7 = [payload objectForKeyedSubscript:v6];
  v8 = [MEMORY[0x277CBEB58] set];
  v12 = MEMORY[0x277D85DD0];
  v13 = 3221225472;
  v14 = __67__HMDHome_BulletinNotifications__registrationsFromPayload_enabled___block_invoke;
  v15 = &unk_278689E38;
  selfCopy = self;
  v17 = v8;
  v9 = v8;
  [v7 hmf_enumerateWithAutoreleasePoolUsingBlock:&v12];
  v10 = [v9 copy];

  return v10;
}

void __67__HMDHome_BulletinNotifications__registrationsFromPayload_enabled___block_invoke(uint64_t a1, void *a2)
{
  v30 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_opt_class();
  v5 = [objc_opt_class() type];
  LODWORD(v4) = [v4 doesTypeMatch:v3 against:v5];

  if (v4)
  {
    v6 = HMDAccessoryBulletinNotificationRegistration;
LABEL_11:
    v15 = [[v6 alloc] initWithDictionary:v3];
LABEL_12:
    v16 = v15;
    if (v15)
    {
      [*(a1 + 40) addObject:v15];
    }

    goto LABEL_14;
  }

  v7 = objc_opt_class();
  v8 = [objc_opt_class() type];
  LODWORD(v7) = [v7 doesTypeMatch:v3 against:v8];

  if (v7)
  {
    v6 = HMDCameraSignificantEventBulletinNotificationRegistration;
    goto LABEL_11;
  }

  v9 = objc_opt_class();
  v10 = [objc_opt_class() type];
  LODWORD(v9) = [v9 doesTypeMatch:v3 against:v10];

  if (v9)
  {
    v6 = HMDCameraAccessModeBulletinNotificationRegistration;
    goto LABEL_11;
  }

  v11 = objc_opt_class();
  v12 = [objc_opt_class() type];
  LODWORD(v11) = [v11 doesTypeMatch:v3 against:v12];

  if (v11)
  {
    v6 = HMDCameraReachabilityBulletinNotificationRegistration;
    goto LABEL_11;
  }

  v13 = objc_opt_class();
  v14 = [objc_opt_class() type];
  LODWORD(v13) = [v13 doesTypeMatch:v3 against:v14];

  if (v13)
  {
    v6 = HMDAudioAnalysisEventBulletinNotificationRegistration;
    goto LABEL_11;
  }

  v18 = objc_opt_class();
  v19 = [objc_opt_class() type];
  LODWORD(v18) = [v18 doesTypeMatch:v3 against:v19];

  if (v18)
  {
    v20 = +[HMDCoreData featuresDataSource];
    v21 = [v20 isRVCEnabled];

    if (!v21)
    {
      goto LABEL_14;
    }

    v15 = [[HMDMatterBulletinNotificationRegistration alloc] initWithDictionary:v3 withHome:*(a1 + 32)];
    goto LABEL_12;
  }

  v22 = objc_autoreleasePoolPush();
  v23 = *(a1 + 32);
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
  {
    v25 = HMFGetLogIdentifier();
    v26 = 138543618;
    v27 = v25;
    v28 = 2112;
    v29 = v3;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Unknown bulletin registration type found. Ignoring it : %@", &v26, 0x16u);
  }

  objc_autoreleasePoolPop(v22);
LABEL_14:

  v17 = *MEMORY[0x277D85DE8];
}

- (id)payloadFromRegistrations:(id)registrations
{
  v4 = MEMORY[0x277CBEB18];
  registrationsCopy = registrations;
  v6 = [v4 arrayWithCapacity:{objc_msgSend(registrationsCopy, "count")}];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __59__HMDHome_BulletinNotifications__payloadFromRegistrations___block_invoke;
  v11[3] = &unk_278671D08;
  v11[4] = self;
  v7 = v6;
  v12 = v7;
  [registrationsCopy hmf_enumerateWithAutoreleasePoolUsingBlock:v11];

  v8 = v12;
  v9 = v7;

  return v7;
}

void __59__HMDHome_BulletinNotifications__payloadFromRegistrations___block_invoke(uint64_t a1, void *a2, _BYTE *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = [v5 serializedRegistrationForRemoteMessage];
  if (v6)
  {
    [*(a1 + 40) addObject:v6];
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v10;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Unable to serialize bulletin registration. %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    *a3 = 1;
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (id)payloadFromEnableRegistrations:(id)registrations disableRegistration:(id)registration source:(id)source
{
  v21[3] = *MEMORY[0x277D85DE8];
  registrationsCopy = registrations;
  registrationCopy = registration;
  sourceCopy = source;
  v11 = [(HMDHome *)self payloadFromRegistrations:registrationsCopy];
  v12 = [v11 count];
  if (v12 != [registrationsCopy count])
  {
    _HMFPreconditionFailure();
    goto LABEL_8;
  }

  v13 = [(HMDHome *)self payloadFromRegistrations:registrationCopy];
  v14 = [v13 count];
  if (v14 != [registrationCopy count])
  {
LABEL_8:
    _HMFPreconditionFailure();
LABEL_9:
    _HMFPreconditionFailure();
  }

  serializedRegistrationForRemoteMessage = [sourceCopy serializedRegistrationForRemoteMessage];
  if (!serializedRegistrationForRemoteMessage)
  {
    goto LABEL_9;
  }

  v16 = serializedRegistrationForRemoteMessage;
  v20[0] = @"HMD.S.BU";
  v20[1] = @"HMD.EN.BU";
  v21[0] = serializedRegistrationForRemoteMessage;
  v21[1] = v11;
  v20[2] = @"HMD.DIS.BU";
  v21[2] = v13;
  v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v21 forKeys:v20 count:3];

  v18 = *MEMORY[0x277D85DE8];

  return v17;
}

- (void)updateBulletinRegistrationOnPrimaryResidentWithSource:(id)source enableRegistrations:(id)registrations disableRegistration:(id)registration completionHandler:(id)handler
{
  v48 = *MEMORY[0x277D85DE8];
  sourceCopy = source;
  registrationsCopy = registrations;
  registrationCopy = registration;
  handlerCopy = handler;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];

  v16 = objc_autoreleasePoolPush();
  if (primaryResidentDevice)
  {
    if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
    {
      backingStore = [(HMDHome *)self backingStore];
      context = [backingStore context];

      [(HMDHome *)self updateEnabledBulletinRegistrations:registrationsCopy disabledBulletinRegistrations:registrationCopy source:sourceCopy context:context completionHandler:handlerCopy];
    }

    else
    {
      v39 = sourceCopy;
      v23 = [(HMDHome *)self payloadFromEnableRegistrations:registrationsCopy disableRegistration:registrationCopy source:sourceCopy];
      v24 = [HMDRemoteDeviceMessageDestination alloc];
      messageTargetUUID = [(HMDHome *)self messageTargetUUID];
      device = [primaryResidentDevice device];
      v27 = [(HMDRemoteDeviceMessageDestination *)v24 initWithTarget:messageTargetUUID device:device];

      v37 = v27;
      v38 = v23;
      v28 = [[HMDRemoteMessage alloc] initWithName:@"HMD.UP.BU.RoR" destination:v27 payload:v23 type:0 timeout:1 secure:0.0];
      v40[0] = MEMORY[0x277D85DD0];
      v40[1] = 3221225472;
      v40[2] = __146__HMDHome_BulletinNotifications__updateBulletinRegistrationOnPrimaryResidentWithSource_enableRegistrations_disableRegistration_completionHandler___block_invoke;
      v40[3] = &unk_278685AF8;
      v40[4] = self;
      v41 = handlerCopy;
      [(HMDRemoteMessage *)v28 setResponseHandler:v40];
      v29 = objc_autoreleasePoolPush();
      selfCopy = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v32 = v36 = v16;
        shortDescription = [(HMFObject *)v28 shortDescription];
        *buf = 138543874;
        v43 = v32;
        v44 = 2112;
        v45 = shortDescription;
        v46 = 2112;
        v47 = primaryResidentDevice;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_INFO, "%{public}@Sending bulletin notification registration message %@ to primary resident: %@", buf, 0x20u);

        v16 = v36;
      }

      objc_autoreleasePoolPop(v29);
      residentSyncManager = [(HMDHome *)selfCopy residentSyncManager];
      [residentSyncManager performResidentRequest:v28 options:0];

      sourceCopy = v39;
    }

    objc_autoreleasePoolPop(v16);
  }

  else
  {
    selfCopy2 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543362;
      v43 = v21;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident to send bulletin registration request", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    if (handlerCopy)
    {
      (*(handlerCopy + 2))(handlerCopy, v22);
    }
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __146__HMDHome_BulletinNotifications__updateBulletinRegistrationOnPrimaryResidentWithSource_enableRegistrations_disableRegistration_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v13 = 138543618;
    v14 = v10;
    v15 = 2112;
    v16 = v5;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Sending remote bulletin notification finished with error: %@", &v13, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 40);
  if (v11)
  {
    (*(v11 + 16))(v11, v5);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeCameraNotificationSettingsMigrationFileFromDisk
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = objc_alloc(MEMORY[0x277CBEBC0]);
  getCameraNotificationSettingsSerializedFileName = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v5 = [v3 initFileURLWithPath:getCameraNotificationSettingsSerializedFileName];

  defaultManager = [MEMORY[0x277CCAA00] defaultManager];
  v13 = 0;
  [defaultManager removeItemAtURL:v5 error:&v13];
  v7 = v13;

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while removing camera notification settings migration file from disk : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeBulletinBoardNotificationsMigrationFileFromDisk
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = objc_alloc(MEMORY[0x277CBEBC0]);
  getBulletinBoardNotificationSerializedFileName = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v5 = [v3 initFileURLWithPath:getBulletinBoardNotificationSerializedFileName];

  defaultManager = [MEMORY[0x277CCAA00] defaultManager];
  v13 = 0;
  [defaultManager removeItemAtURL:v5 error:&v13];
  v7 = v13;

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while removing bulletin board notification migration file from disk : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (id)loadMigrationCameraNotificationSettingsFromDisk
{
  v24 = *MEMORY[0x277D85DE8];
  getCameraNotificationSettingsSerializedFileName = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v17 = 0;
  v4 = [MEMORY[0x277CBEA90] dataWithContentsOfFile:getCameraNotificationSettingsSerializedFileName options:2 error:&v17];
  v5 = v17;
  v6 = v5;
  if (v4)
  {
    v7 = v5 == 0;
  }

  else
  {
    v7 = 0;
  }

  if (v7)
  {
    v12 = [HMDHome decodedMigrationCameraNotificationSettings:v4];
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Camera notification settings for migration: [%@]", buf, 0x16u);
    }
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = getCameraNotificationSettingsSerializedFileName;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to read data from file : %@ / %@", buf, 0x20u);
    }

    v12 = 0;
  }

  objc_autoreleasePoolPop(v8);
  v15 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)loadMigrationBulletinBoardNotificationsFromDisk
{
  v24 = *MEMORY[0x277D85DE8];
  getBulletinBoardNotificationSerializedFileName = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v17 = 0;
  v4 = [MEMORY[0x277CBEA90] dataWithContentsOfFile:getBulletinBoardNotificationSerializedFileName options:2 error:&v17];
  v5 = v17;
  v6 = v5;
  if (v4)
  {
    v7 = v5 == 0;
  }

  else
  {
    v7 = 0;
  }

  if (v7)
  {
    v12 = [HMDHome decodedMigrationBulletinBoardNotifications:v4];
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Bulletin board notifications for migration: [%@]", buf, 0x16u);
    }
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = getBulletinBoardNotificationSerializedFileName;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to read data from file : %@ / %@", buf, 0x20u);
    }

    v12 = 0;
  }

  objc_autoreleasePoolPop(v8);
  v15 = *MEMORY[0x277D85DE8];

  return v12;
}

- (void)storeMigrationCameraNotificationSettingsToDisk
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = [HMDHome migrationCameraNotificationSettingsForHome:self];
  v5 = [v4 count];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v9)
    {
      v10 = HMFGetLogIdentifier();
      name = [(HMDHome *)selfCopy name];
      v26 = 138543874;
      v27 = v10;
      v28 = 2112;
      v29 = name;
      v30 = 2112;
      v31 = v4;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Archiving camera notification settings for migration for home: %@, [%@]", &v26, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [HMDHome encodedMigrationCameraNotificationSettings:v4];
    if (v12)
    {
      getCameraNotificationSettingsSerializedFileName = [(HMDHome *)selfCopy getCameraNotificationSettingsSerializedFileName];
      v14 = [HMDPersistentStore writeData:v12 toStorePath:getCameraNotificationSettingsSerializedFileName dataLabel:@"CameraNotificationSettings"];
      v15 = objc_autoreleasePoolPush();
      v16 = selfCopy;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v18;
        v28 = 2112;
        v29 = v14;
        v30 = 2112;
        v31 = getCameraNotificationSettingsSerializedFileName;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Stored camera notification settings ([%@] bytes) to [%@]", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
    }

    else
    {
      v21 = objc_autoreleasePoolPush();
      v22 = selfCopy;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v24;
        _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to store camera notification settings during migration, archived data is nil", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
    }
  }

  else
  {
    if (v9)
    {
      v19 = HMFGetLogIdentifier();
      name2 = [(HMDHome *)selfCopy name];
      v26 = 138543618;
      v27 = v19;
      v28 = 2112;
      v29 = name2;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@No camera notification settings to migrate for home: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  objc_autoreleasePoolPop(v3);
  v25 = *MEMORY[0x277D85DE8];
}

- (void)storeMigrationBulletinBoardNotificationsToDisk
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = [HMDHome migrationBulletinBoardNotificationsForHome:self];
  v5 = [v4 count];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v9)
    {
      v10 = HMFGetLogIdentifier();
      name = [(HMDHome *)selfCopy name];
      v26 = 138543874;
      v27 = v10;
      v28 = 2112;
      v29 = name;
      v30 = 2112;
      v31 = v4;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Archiving bulletin board notifications for migration for home: %@, [%@]", &v26, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [HMDHome encodedMigrationBulletinBoardNotifications:v4];
    if (v12)
    {
      getBulletinBoardNotificationSerializedFileName = [(HMDHome *)selfCopy getBulletinBoardNotificationSerializedFileName];
      v14 = [HMDPersistentStore writeData:v12 toStorePath:getBulletinBoardNotificationSerializedFileName dataLabel:@"BulletinBoardNotifications"];
      v15 = objc_autoreleasePoolPush();
      v16 = selfCopy;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v18;
        v28 = 2112;
        v29 = v14;
        v30 = 2112;
        v31 = getBulletinBoardNotificationSerializedFileName;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Stored bulletin board notifications ([%@] bytes) to [%@]", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
    }

    else
    {
      v21 = objc_autoreleasePoolPush();
      v22 = selfCopy;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v24;
        _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to store bulletin board notifications during migration, archived data is nil", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
    }
  }

  else
  {
    if (v9)
    {
      v19 = HMFGetLogIdentifier();
      name2 = [(HMDHome *)selfCopy name];
      v26 = 138543618;
      v27 = v19;
      v28 = 2112;
      v29 = name2;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@No bulletin board notifications to migrate for home: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  objc_autoreleasePoolPop(v3);
  v25 = *MEMORY[0x277D85DE8];
}

- (id)getCameraNotificationSettingsSerializedFileName
{
  v3 = MEMORY[0x277CCACA8];
  v4 = hh1ToHH2PerDeviceMigrationDirectoryPath;
  uuid = [(HMDHome *)self uuid];
  v6 = [v3 stringWithFormat:@"%@/HMDHome-Camera-Notification-Settings-%@.plist", v4, uuid];

  return v6;
}

- (id)getBulletinBoardNotificationSerializedFileName
{
  v3 = MEMORY[0x277CCACA8];
  v4 = hh1ToHH2PerDeviceMigrationDirectoryPath;
  uuid = [(HMDHome *)self uuid];
  v6 = [v3 stringWithFormat:@"%@/HMDHome-Bulletin-Board-Notifications-%@.plist", v4, uuid];

  return v6;
}

- (BOOL)cameraNotificationSettingsMigrationFileExistsOnDisk
{
  defaultManager = [MEMORY[0x277CCAA00] defaultManager];
  getCameraNotificationSettingsSerializedFileName = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v5 = [defaultManager fileExistsAtPath:getCameraNotificationSettingsSerializedFileName];

  return v5;
}

- (BOOL)bulletinBoardNotificationsMigrationFileExistsOnDisk
{
  defaultManager = [MEMORY[0x277CCAA00] defaultManager];
  getBulletinBoardNotificationSerializedFileName = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v5 = [defaultManager fileExistsAtPath:getBulletinBoardNotificationSerializedFileName];

  return v5;
}

+ (id)decodedMigrationCameraNotificationSettings:(id)settings
{
  v31[10] = *MEMORY[0x277D85DE8];
  settingsCopy = settings;
  v5 = MEMORY[0x277CBEB98];
  v31[0] = objc_opt_class();
  v31[1] = objc_opt_class();
  v31[2] = objc_opt_class();
  v31[3] = objc_opt_class();
  v31[4] = objc_opt_class();
  v31[5] = objc_opt_class();
  v31[6] = objc_opt_class();
  v31[7] = objc_opt_class();
  v31[8] = objc_opt_class();
  v31[9] = objc_opt_class();
  v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v31 count:10];
  v7 = [v5 setWithArray:v6];

  v26 = 0;
  v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClasses:v7 fromData:settingsCopy error:&v26];
  v9 = v26;
  v10 = v9;
  if (!v8 || v9)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v19;
      v29 = 2112;
      v30 = v10;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to unarchive camera notification settings: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v15 = 0;
  }

  else
  {
    v11 = v8;
    objc_opt_class();
    v12 = objc_opt_isKindOfClass() & 1;
    if (v12)
    {
      v13 = v11;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    if (v12)
    {
      v15 = v11;
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v23;
        v29 = 2112;
        v30 = v11;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unarchived data is the wrong type : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      v15 = 0;
    }
  }

  v24 = *MEMORY[0x277D85DE8];

  return v15;
}

+ (id)decodedMigrationBulletinBoardNotifications:(id)notifications
{
  v31[9] = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  v5 = MEMORY[0x277CBEB98];
  v31[0] = objc_opt_class();
  v31[1] = objc_opt_class();
  v31[2] = objc_opt_class();
  v31[3] = objc_opt_class();
  v31[4] = objc_opt_class();
  v31[5] = objc_opt_class();
  v31[6] = objc_opt_class();
  v31[7] = objc_opt_class();
  v31[8] = objc_opt_class();
  v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v31 count:9];
  v7 = [v5 setWithArray:v6];

  v26 = 0;
  v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClasses:v7 fromData:notificationsCopy error:&v26];
  v9 = v26;
  v10 = v9;
  if (!v8 || v9)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v19;
      v29 = 2112;
      v30 = v10;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to unarchive bulletin board notifications: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v15 = 0;
  }

  else
  {
    v11 = v8;
    objc_opt_class();
    v12 = objc_opt_isKindOfClass() & 1;
    if (v12)
    {
      v13 = v11;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    if (v12)
    {
      v15 = v11;
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v23;
        v29 = 2112;
        v30 = v11;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unarchived data is the wrong type : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      v15 = 0;
    }
  }

  v24 = *MEMORY[0x277D85DE8];

  return v15;
}

+ (id)encodedMigrationCameraNotificationSettings:(id)settings
{
  v3 = MEMORY[0x277CCAAB0];
  settingsCopy = settings;
  v5 = [[v3 alloc] initRequiringSecureCoding:1];
  [v5 encodeObject:settingsCopy forKey:*MEMORY[0x277CCA308]];

  [v5 finishEncoding];
  encodedData = [v5 encodedData];

  return encodedData;
}

+ (id)encodedMigrationBulletinBoardNotifications:(id)notifications
{
  v3 = MEMORY[0x277CCAAB0];
  notificationsCopy = notifications;
  v5 = [[v3 alloc] initRequiringSecureCoding:1];
  [v5 encodeObject:notificationsCopy forKey:*MEMORY[0x277CCA308]];

  [v5 finishEncoding];
  encodedData = [v5 encodedData];

  return encodedData;
}

+ (id)migrationCameraNotificationSettingsForHome:(id)home
{
  v4 = MEMORY[0x277CBEB18];
  homeCopy = home;
  array = [v4 array];
  cameraAccessories = [homeCopy cameraAccessories];

  v11 = MEMORY[0x277D85DD0];
  v12 = 3221225472;
  v13 = __77__HMDHome_BulletinNotifications__migrationCameraNotificationSettingsForHome___block_invoke;
  v14 = &unk_278671CE0;
  v15 = array;
  selfCopy = self;
  v8 = array;
  [cameraAccessories na_each:&v11];

  v9 = [v8 copy];

  return v9;
}

void __77__HMDHome_BulletinNotifications__migrationCameraNotificationSettingsForHome___block_invoke(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 cameraProfileNotificationSettings];
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 40);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v3 uuid];
      *buf = 138543874;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v4;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Adding camera notification settings entry for migration: accessoryUUID: %@ cameraProfileNotificationSettings: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = *(a1 + 32);
    v12 = [v3 uuid];
    v16[1] = @"HMD.CNS";
    v17[0] = v12;
    v17[1] = v4;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:v16 count:2];
    [v11 addObject:v13];
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Camera accessory: %@ missing camera profile notification settings during migration", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v15 = *MEMORY[0x277D85DE8];
}

+ (id)migrationBulletinBoardNotificationsForHome:(id)home
{
  v4 = MEMORY[0x277CBEB18];
  homeCopy = home;
  array = [v4 array];
  hapAccessories = [homeCopy hapAccessories];

  v11 = MEMORY[0x277D85DD0];
  v12 = 3221225472;
  v13 = __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke;
  v14 = &unk_278671CE0;
  v15 = array;
  selfCopy = self;
  v8 = array;
  [hapAccessories na_each:&v11];

  v9 = [v8 copy];

  return v9;
}

void __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 services];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke_2;
  v8[3] = &unk_278671CB8;
  v9 = v3;
  v7 = *(a1 + 32);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  [v4 na_each:v8];
}

void __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke_2(uint64_t a1, void *a2)
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 bulletinBoardNotification];
  if (v4)
  {
    v5 = [MEMORY[0x277CBEB68] null];
    v6 = [v4 condition];

    if (v6)
    {
      v7 = [objc_alloc(MEMORY[0x277CCAAB0]) initRequiringSecureCoding:1];
      v8 = [v4 condition];
      [v7 encodeObject:v8 forKey:*MEMORY[0x277CCA308]];

      [v7 finishEncoding];
      v9 = [v7 encodedData];

      v5 = v9;
    }

    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 48);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) uuid];
      v15 = [v3 instanceID];
      [v4 isEnabled];
      HMFBooleanToString();
      v16 = v23 = v10;
      *buf = 138544386;
      v27 = v13;
      v28 = 2112;
      v29 = v14;
      v30 = 2112;
      v31 = v15;
      v32 = 2112;
      v33 = v5;
      v34 = 2112;
      v35 = v16;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Adding bulletin board notification entry for migration: accessoryUUID: %@ serviceInstanceID: %@ predicate: %@ enabled: %@", buf, 0x34u);

      v10 = v23;
    }

    objc_autoreleasePoolPop(v10);
    v24[0] = @"HMD.BBN.A";
    v17 = *(a1 + 40);
    v18 = [*(a1 + 32) uuid];
    v25[0] = v18;
    v24[1] = @"HMD.BBN.S";
    v19 = [v3 instanceID];
    v25[1] = v19;
    v25[2] = v5;
    v24[2] = @"HMD.BBN.P";
    v24[3] = @"HMD.BBN.E";
    v20 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v4, "isEnabled")}];
    v25[3] = v20;
    v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v25 forKeys:v24 count:4];
    [v17 addObject:v21];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (id)actionWithDictionaryRepresentation:(id)representation
{
  v25 = *MEMORY[0x277D85DE8];
  representationCopy = representation;
  v5 = representationCopy;
  if (!representationCopy)
  {
    v11 = 0;
    goto LABEL_14;
  }

  v6 = [representationCopy hmf_numberForKey:*MEMORY[0x277CD2058]];
  v7 = v6;
  if (!v6)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v15;
      v16 = "%{public}@Unable to determine the action type";
      v17 = v14;
      v18 = 12;
      goto LABEL_11;
    }

LABEL_12:

    objc_autoreleasePoolPop(v12);
    v11 = 0;
    goto LABEL_13;
  }

  integerValue = [v6 integerValue];
  if (integerValue > 5 || (v9 = *off_278672330[integerValue], objc_opt_class(), (v10 = objc_claimAutoreleasedReturnValue()) == 0))
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v15;
      v23 = 2112;
      v24 = v7;
      v16 = "%{public}@Unknown action type: %@";
      v17 = v14;
      v18 = 22;
LABEL_11:
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, v16, &v21, v18);

      goto LABEL_12;
    }

    goto LABEL_12;
  }

  v11 = [v10 actionWithDictionaryRepresentation:v5 home:self];
LABEL_13:

LABEL_14:
  v19 = *MEMORY[0x277D85DE8];

  return v11;
}

- (void)_auditChangedCharacteristics:(id)characteristics
{
  v40 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  v4 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(characteristicsCopy, "count")}];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v5 = characteristicsCopy;
  v6 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v35;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v34 + 1) + 8 * i);
        notificationRegistrations = [v10 notificationRegistrations];
        v12 = [notificationRegistrations count];

        if (!v12)
        {
          accessory = [v10 accessory];
          uuid = [accessory uuid];
          [v4 addObject:uuid];

          if (([accessory isPrimary] & 1) == 0)
          {
            bridge = [accessory bridge];
            identifiersForBridgedAccessories = [bridge identifiersForBridgedAccessories];
            [v4 unionSet:identifiersForBridgedAccessories];
          }
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
    }

    while (v7);
  }

  if ([v4 count] == 1)
  {
    firstObject = [v5 firstObject];
    accessory2 = [firstObject accessory];
    [(HMDHome *)self _auditAndDeregisterCharacteristicsForHAPAccessory:accessory2];
  }

  else
  {
    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    firstObject = [(HMDHome *)self accessories];
    v19 = [firstObject countByEnumeratingWithState:&v30 objects:v38 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v31;
      do
      {
        for (j = 0; j != v20; ++j)
        {
          if (*v31 != v21)
          {
            objc_enumerationMutation(firstObject);
          }

          v23 = *(*(&v30 + 1) + 8 * j);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          if (v25)
          {
            uuid2 = [v25 uuid];
            v27 = [v4 containsObject:uuid2];

            if (v27)
            {
              [(HMDHome *)self _auditAndDeregisterCharacteristicsForHAPAccessory:v25];
            }
          }
        }

        v20 = [firstObject countByEnumeratingWithState:&v30 objects:v38 count:16];
      }

      while (v20);
    }
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_auditAndDeregisterCharacteristicsForHAPAccessory:(id)accessory
{
  selfCopy = self;
  v46 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  array = [MEMORY[0x277CBEB18] array];
  string = [MEMORY[0x277CCAB68] string];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v25 = accessoryCopy;
  obj = [accessoryCopy services];
  v28 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
  if (v28)
  {
    v27 = *v35;
    do
    {
      v6 = 0;
      do
      {
        if (*v35 != v27)
        {
          objc_enumerationMutation(obj);
        }

        v29 = v6;
        v7 = *(*(&v34 + 1) + 8 * v6);
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v33 = 0u;
        characteristics = [v7 characteristics];
        v9 = [characteristics countByEnumeratingWithState:&v30 objects:v44 count:16];
        if (v9)
        {
          v10 = v9;
          v11 = *v31;
          do
          {
            for (i = 0; i != v10; ++i)
            {
              if (*v31 != v11)
              {
                objc_enumerationMutation(characteristics);
              }

              v13 = *(*(&v30 + 1) + 8 * i);
              notificationRegistrations = [v13 notificationRegistrations];
              v15 = [notificationRegistrations count];

              if (!v15)
              {
                [array addObject:v13];
                shortDescription = [v13 shortDescription];
                [string appendString:shortDescription];

                [string appendString:@"\n"];
              }
            }

            v10 = [characteristics countByEnumeratingWithState:&v30 objects:v44 count:16];
          }

          while (v10);
        }

        v6 = v29 + 1;
      }

      while (v29 + 1 != v28);
      v28 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
    }

    while (v28);
  }

  v17 = objc_autoreleasePoolPush();
  v18 = selfCopy;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    uuid = [v25 uuid];

    if (uuid)
    {
      uuid2 = [v25 uuid];
      [uuid2 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v38 = *buf;
    *buf = 138544130;
    *&buf[4] = v20;
    *&buf[12] = 1040;
    *&buf[14] = 16;
    v40 = 2096;
    v41 = &v38;
    v42 = 2112;
    v43 = string;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Audit de-registering notifications accessory %{uuid_t}.16P characteristics %@", buf, 0x26u);
  }

  objc_autoreleasePoolPop(v17);
  [v25 enableNotification:0 forCharacteristics:array message:0 clientIdentifier:0];

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_registerForMatterRequests
{
  v9[2] = *MEMORY[0x277D85DE8];
  v3 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:0 remoteAccessRequired:0];
  msgDispatcher = [(HMDHome *)self msgDispatcher];
  v5 = *MEMORY[0x277D26748];
  v6 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v9[0] = v6;
  v9[1] = v3;
  v7 = [MEMORY[0x277CBEA60] arrayWithObjects:v9 count:2];
  [msgDispatcher registerForMessage:v5 receiver:self policies:v7 selector:sel__handleIncomingMTRPluginMatterRequest_];

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_handleIncomingMTRPluginMatterRequest:(id)request
{
  v18 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  if (requestCopy)
  {
    mEMORY[0x277D26768] = [MEMORY[0x277D26768] sharedInstance];
    [mEMORY[0x277D26768] handleIncomingMessage:requestCopy];

    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      v10 = HMFBooleanToString();
      v14 = 138543618;
      v15 = v9;
      v16 = 2112;
      v17 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEBUG, "%{public}@[[MTRPluginServer sharedInstance] handleIncomingMessage:]: %@", &v14, 0x16u);
    }
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v14 = 138543362;
      v15 = v12;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Empty message for _handleIncomingMTRPluginMatterRequest", &v14, 0xCu);
    }
  }

  objc_autoreleasePoolPop(v6);
  v13 = *MEMORY[0x277D85DE8];
}

- (BOOL)shouldSendMatterCommandsToResident
{
  v29 = *MEMORY[0x277D85DE8];
  primaryResident = [(HMDHome *)self primaryResident];
  v4 = primaryResident;
  if (!primaryResident)
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v25 = 138543362;
      v26 = v9;
      v10 = "%{public}@shouldSendMatterCommandsToResident: No. Reason: No primary resident";
LABEL_9:
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, v10, &v25, 0xCu);
    }

LABEL_10:

    objc_autoreleasePoolPop(v6);
    v11 = 0;
    goto LABEL_21;
  }

  if (([primaryResident isReachable] & 1) == 0)
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v25 = 138543362;
      v26 = v9;
      v10 = "%{public}@shouldSendMatterCommandsToResident: No. Reason: Primary resident is not reachable";
      goto LABEL_9;
    }

    goto LABEL_10;
  }

  if ([(HMDHome *)self _isResidentNativeMatterCapable:v4])
  {
    v5 = @" {primarySupportsNativeMtr:Yes}";
  }

  else
  {
    featuresDataSource = [(HMDHome *)self featuresDataSource];
    isRVCEnabled = [featuresDataSource isRVCEnabled];

    if (isRVCEnabled)
    {
      if ([(HMDHome *)self _homeHasNativeMatterAccessories])
      {
        v14 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          v17 = HMFGetLogIdentifier();
          v25 = 138543362;
          v26 = v17;
          _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Primary is not native matter capable and home has have native matter accessories", &v25, 0xCu);
        }

        objc_autoreleasePoolPop(v14);
        v5 = @" {primarySupportsNativeMtr:No, currentDeviceSupportsNativeMatter:Yes, homeHasNativeMatterAccessories:Yes, IgnoreFailure:Yes}";
      }

      else
      {
        v5 = @" {primarySupportsNativeMtr:No, currentDeviceSupportsNativeMatter:Yes, homeHasNativeMatterAccessories:No}";
      }
    }

    else
    {
      v5 = @" {primarySupportsNativeMtr:No, currentDeviceSupportsNativeMatter:No}";
    }
  }

  v18 = [&stru_283CF9D50 stringByAppendingString:v5];
  v19 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v21 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
  {
    v22 = HMFGetLogIdentifier();
    v25 = 138543618;
    v26 = v22;
    v27 = 2112;
    v28 = v18;
    _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@shouldSendMatterCommandsToResident: Yes. Reason: Local link not required%@", &v25, 0x16u);
  }

  objc_autoreleasePoolPop(v19);
  v11 = 1;
LABEL_21:

  v23 = *MEMORY[0x277D85DE8];
  return v11;
}

- (BOOL)_isResidentNativeMatterCapable:(id)capable
{
  capabilities = [capable capabilities];
  supportsNativeMatterPlugin = [capabilities supportsNativeMatterPlugin];

  return supportsNativeMatterPlugin;
}

- (BOOL)_isResidentThreadCapable:(id)capable
{
  capabilities = [capable capabilities];
  supportsThreadBorderRouter = [capabilities supportsThreadBorderRouter];

  return supportsThreadBorderRouter;
}

- (BOOL)_homeHasMatterThreadAccessories
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  matterAccessories = [(HMDHome *)self matterAccessories];
  v4 = [matterAccessories countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v12;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(matterAccessories);
        }

        if ([(HMDHome *)self _matterAccessoryRequiresThread:*(*(&v11 + 1) + 8 * i)])
        {
          v8 = 1;
          goto LABEL_11;
        }
      }

      v5 = [matterAccessories countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v5)
      {
        continue;
      }

      break;
    }
  }

  v8 = 0;
LABEL_11:

  v9 = *MEMORY[0x277D85DE8];
  return v8;
}

- (BOOL)_matterAccessoryRequiresThread:(id)thread
{
  threadCopy = thread;
  supportedLinkLayerTypes = [threadCopy supportedLinkLayerTypes];

  if (supportedLinkLayerTypes)
  {
    supportedLinkLayerTypes2 = [threadCopy supportedLinkLayerTypes];
    unsignedIntValue = [supportedLinkLayerTypes2 unsignedIntValue];

    supportedLinkLayerTypes3 = [threadCopy supportedLinkLayerTypes];
    unsignedIntValue2 = [supportedLinkLayerTypes3 unsignedIntValue];

    if (unsignedIntValue2)
    {
      v9 = (unsignedIntValue >> 4) & 1;
    }

    else
    {
      LOBYTE(v9) = 1;
    }
  }

  else
  {
    LOBYTE(v9) = 1;
  }

  return v9;
}

- (BOOL)_homeHasNativeMatterAccessories
{
  v25 = *MEMORY[0x277D85DE8];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  matterAccessories = [(HMDHome *)self matterAccessories];
  v4 = [matterAccessories countByEnumeratingWithState:&v16 objects:v24 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v17;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v17 != v6)
        {
          objc_enumerationMutation(matterAccessories);
        }

        v8 = *(*(&v16 + 1) + 8 * i);
        if ([(HMDHome *)self _accessoryRequiresNativeMatter:v8])
        {
          v10 = objc_autoreleasePoolPush();
          selfCopy = self;
          v12 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
          {
            v13 = HMFGetLogIdentifier();
            *buf = 138543618;
            v21 = v13;
            v22 = 2112;
            v23 = v8;
            _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@Home has native matter accessory: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v10);
          v9 = 1;
          goto LABEL_13;
        }
      }

      v5 = [matterAccessories countByEnumeratingWithState:&v16 objects:v24 count:16];
      if (v5)
      {
        continue;
      }

      break;
    }
  }

  v9 = 0;
LABEL_13:

  v14 = *MEMORY[0x277D85DE8];
  return v9;
}

- (BOOL)_accessoryRequiresNativeMatter:(id)matter
{
  matterAdapter = [matter matterAdapter];
  useMatterPlugin = [matterAdapter useMatterPlugin];

  return useMatterPlugin;
}

- (BOOL)sendMatterMessagePayloadToPrimaryResident:(id)resident timeout:(double)timeout responseHandler:(id)handler
{
  v36 = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  handlerCopy = handler;
  shouldSendMatterCommandsToResident = [(HMDHome *)self shouldSendMatterCommandsToResident];
  if (shouldSendMatterCommandsToResident)
  {
    v11 = [HMDRemoteHomeMessageDestination alloc];
    uuid = [(HMDHome *)self uuid];
    uuid2 = [(HMDHome *)self uuid];
    v14 = [(HMDRemoteHomeMessageDestination *)v11 initWithTarget:uuid homeUUID:uuid2];

    v15 = objc_alloc(MEMORY[0x277D0F848]);
    v16 = [v15 initWithName:*MEMORY[0x277D26748] destination:v14 payload:residentCopy];
    [v16 setRemote:1];
    [v16 setSecureRemote:1];
    if (timeout != 0.0)
    {
      [v16 setTimeout:timeout];
    }

    [v16 setResponseHandler:handlerCopy];
    v17 = objc_autoreleasePoolPush();
    selfCopy = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
    {
      v20 = HMFGetLogIdentifier();
      v28 = 138544130;
      v29 = v20;
      v30 = 2112;
      v31 = v16;
      v32 = 2112;
      v33 = v14;
      v34 = 2048;
      timeoutCopy = timeout;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Sending MatterRequest message: %@  to resident: %@  timeout: %f", &v28, 0x2Au);
    }

    objc_autoreleasePoolPop(v17);
    msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
    [msgDispatcher sendMessage:v16];
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      v28 = 138543362;
      v29 = v25;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Couldn't find compatible resident to send Matter request", &v28, 0xCu);
    }

    objc_autoreleasePoolPop(v22);
  }

  v26 = *MEMORY[0x277D85DE8];
  return shouldSendMatterCommandsToResident;
}

- (BOOL)sendMatterHMFMessageRequest:(id)request
{
  v19 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    destination = [requestCopy destination];
    v13 = 138543874;
    v14 = v8;
    v15 = 2112;
    v16 = requestCopy;
    v17 = 2112;
    v18 = destination;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Sending MatterRequest message: %@ to destination: %@", &v13, 0x20u);
  }

  objc_autoreleasePoolPop(v5);
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  [msgDispatcher sendMessage:requestCopy];

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

+ (id)matterDeviceControllerWithUUID:(id)d
{
  v23 = *MEMORY[0x277D85DE8];
  dCopy = d;
  v5 = [objc_alloc(MEMORY[0x277CD5558]) initWithXPConnectionBlock:&__block_literal_global_61284 uniqueIdentifier:dCopy];
  v16 = 0;
  v6 = [objc_alloc(MEMORY[0x277CD5318]) initWithParameters:v5 error:&v16];
  v7 = v16;
  v8 = v7;
  if (v6)
  {
    v9 = v7 == 0;
  }

  else
  {
    v9 = 0;
  }

  if (!v9)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543874;
      v18 = v13;
      v19 = 2112;
      v20 = dCopy;
      v21 = 2112;
      v22 = v8;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to create a matter controller with UUID: %@. Error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
  }

  v14 = *MEMORY[0x277D85DE8];

  return v6;
}

id __60__HMDHome_MatterExtensions__matterDeviceControllerWithUUID___block_invoke()
{
  v0 = objc_alloc(MEMORY[0x277CCAE80]);
  v1 = [v0 initWithMachServiceName:*MEMORY[0x277CD15D8] options:0];

  return v1;
}

- (id)userForActivityStatus:(id)status
{
  v23 = *MEMORY[0x277D85DE8];
  statusCopy = status;
  user = [statusCopy user];
  if ([user conformsToProtocol:&unk_283EF3CF0])
  {
    v6 = user;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    guest = user;

LABEL_10:
    modelID = [guest modelID];
    v12 = [(HMDHome *)self userWithUUID:modelID];

    goto LABEL_11;
  }

  guest = [statusCopy guest];
  if ([guest conformsToProtocol:&unk_283EF3CF0])
  {
    v9 = guest;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  if (v10)
  {
    goto LABEL_10;
  }

  v15 = objc_autoreleasePoolPush();
  selfCopy = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
  {
    v18 = HMFGetLogIdentifier();
    v19 = 138543618;
    v20 = v18;
    v21 = 2112;
    v22 = statusCopy;
    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Back reference to MKFUser or MKFGuest is unexpectedly nil for %@", &v19, 0x16u);
  }

  objc_autoreleasePoolPop(v15);
  v12 = 0;
LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)isAccessoryCertifiedForNaturalLighting:(id)lighting
{
  v77 = *MEMORY[0x277D85DE8];
  lightingCopy = lighting;
  if (CFPreferencesGetAppBooleanValue(@"MatterAdaptiveLighting", @"/Library/Managed Preferences/mobile/com.apple.homed.plist", 0))
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      uuid = [lightingCopy uuid];
      *buf = 138543618;
      v58 = v8;
      v59 = 2112;
      v60 = uuid;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Natural lighting is allowed because of profile present for accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = [MEMORY[0x277D0F7C0] futureWithValue:MEMORY[0x277CBEC38]];
  }

  else
  {
    v56 = 0;
    v10 = [MEMORY[0x277D0F7C0] futureWithPromise:&v56];
    bridge = [lightingCopy bridge];

    if (bridge)
    {
      v12 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
      {
        v49 = HMFGetLogIdentifier();
        uuid2 = [lightingCopy uuid];
        matterVendorID = [lightingCopy matterVendorID];
        matterProductID = [lightingCopy matterProductID];
        firmwareVersion = [lightingCopy firmwareVersion];
        [firmwareVersion rawVersionString];
        v44 = v40 = selfCopy2;
        bridge2 = [lightingCopy bridge];
        [bridge2 uuid];
        v43 = log = v14;
        bridge3 = [lightingCopy bridge];
        matterVendorID2 = [bridge3 matterVendorID];
        bridge4 = [lightingCopy bridge];
        matterProductID2 = [bridge4 matterProductID];
        bridge5 = [lightingCopy bridge];
        firmwareVersion2 = [bridge5 firmwareVersion];
        [lightingCopy bridge];
        v18 = v42 = v12;
        firmwareVersion3 = [v18 firmwareVersion];
        rawVersionString = [firmwareVersion3 rawVersionString];
        *buf = 138545666;
        v58 = v49;
        v59 = 2112;
        v60 = uuid2;
        v61 = 2112;
        v62 = matterVendorID;
        v63 = 2112;
        v64 = matterProductID;
        v65 = 2112;
        v66 = v44;
        v67 = 2112;
        v68 = v43;
        v69 = 2112;
        v70 = matterVendorID2;
        v71 = 2112;
        v72 = matterProductID2;
        v73 = 2112;
        v74 = firmwareVersion2;
        v75 = 2112;
        v76 = rawVersionString;
        _os_log_impl(&dword_229538000, log, OS_LOG_TYPE_DEBUG, "%{public}@Bridged accessory UUID: %@ identifiers: [%@ : %@ : %@] Bridge UUID: %@ identifiers: [%@ : %@ : %@: %@]", buf, 0x66u);

        v12 = v42;
        v14 = log;

        selfCopy2 = v40;
      }

      objc_autoreleasePoolPop(v12);
      bridge6 = [lightingCopy bridge];

      lightingCopy = bridge6;
    }

    v22 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      matterVendorID3 = [lightingCopy matterVendorID];
      matterProductID3 = [lightingCopy matterProductID];
      firmwareVersion4 = [lightingCopy firmwareVersion];
      [firmwareVersion4 rawVersionString];
      v50 = v22;
      v30 = v29 = v10;
      v31 = HMFBooleanToString();
      *buf = 138544386;
      v58 = v25;
      v59 = 2112;
      v60 = matterVendorID3;
      v61 = 2112;
      v62 = matterProductID3;
      v63 = 2112;
      v64 = v30;
      v65 = 2112;
      v66 = v31;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Checking if natural lighting is allowed based on allow list for accessory: [%@ : %@ : %@] isBridged: %@", buf, 0x34u);

      v10 = v29;
      v22 = v50;
    }

    objc_autoreleasePoolPop(v22);
    v32 = [HMDMatterCapabilitiesFactory makeInstanceForAssetFilename:1];
    v53[0] = MEMORY[0x277D85DD0];
    v53[1] = 3221225472;
    v53[2] = __57__HMDHome_Light__isAccessoryCertifiedForNaturalLighting___block_invoke;
    v53[3] = &unk_2786755C8;
    lightingCopy = lightingCopy;
    v54 = lightingCopy;
    v55 = v56;
    v51[0] = MEMORY[0x277D85DD0];
    v51[1] = 3221225472;
    v51[2] = __57__HMDHome_Light__isAccessoryCertifiedForNaturalLighting___block_invoke_2;
    v51[3] = &unk_2786882F0;
    v51[4] = selfCopy3;
    v52 = v55;
    v33 = [v32 then:v53 orRecover:v51];
  }

  v34 = *MEMORY[0x277D85DE8];

  return v10;
}

uint64_t __57__HMDHome_Light__isAccessoryCertifiedForNaturalLighting___block_invoke(uint64_t a1, void *a2)
{
  v3 = *(a1 + 32);
  v4 = a2;
  v5 = [v3 matterVendorID];
  v6 = [v5 intValue];
  v7 = [*(a1 + 32) matterProductID];
  v8 = [v7 intValue];
  v9 = [*(a1 + 32) firmwareVersion];
  v10 = [v9 rawVersionString];
  v11 = [v4 isCapabilityAllowed:1 vendorID:v6 productID:v8 firmwareVersion:{objc_msgSend(v10, "intValue")}];

  v12 = *(a1 + 40);
  v13 = [MEMORY[0x277CCABB0] numberWithBool:v11];
  [v12 fulfillWithValue:v13];

  return 1;
}

uint64_t __57__HMDHome_Light__isAccessoryCertifiedForNaturalLighting___block_invoke_2(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v7;
    v12 = 2112;
    v13 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Natural lighting is not allowed because allow list check failed with error: %@", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 40) fulfillWithValue:MEMORY[0x277CBEC28]];

  v8 = *MEMORY[0x277D85DE8];
  return 1;
}

- (id)executeMatterNaturalLightingActions:(id)actions
{
  v61 = *MEMORY[0x277D85DE8];
  actionsCopy = actions;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v36 = [MEMORY[0x277CBEB58] set];
  v35 = [MEMORY[0x277CBEB58] set];
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  v55 = 0u;
  obj = actionsCopy;
  v4 = [obj countByEnumeratingWithState:&v52 objects:v60 count:16];
  if (v4)
  {
    v6 = v4;
    v7 = *v53;
    *&v5 = 138543618;
    v34 = v5;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v53 != v7)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v52 + 1) + 8 * i);
        lightProfile = [v9 lightProfile];
        uuid = [v9 uuid];
        uUIDString = [uuid UUIDString];

        if ([lightProfile isNaturalLightingSupported])
        {
          if ([v9 isNaturalLightingEnabled])
          {
            v13 = v36;
          }

          else
          {
            v13 = v35;
          }

          [v13 addObject:lightProfile];
        }

        else
        {
          v14 = objc_autoreleasePoolPush();
          lightLogCategory = [(HMDHome *)self lightLogCategory];
          v16 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            v17 = HMFGetLogIdentifier();
            *buf = v34;
            v57 = v17;
            v58 = 2112;
            v59 = v9;
            _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Skipping executing natural lighting action for matter, light profile doesn't support matter NL: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v14);
          v18 = MEMORY[0x277CBEAC0];
          v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          v20 = [v18 hmd_dictionaryWithActionExecutionError:v19];
          [dictionary setObject:v20 forKeyedSubscript:uUIDString];
        }
      }

      v6 = [obj countByEnumeratingWithState:&v52 objects:v60 count:16];
    }

    while (v6);
  }

  if ([v36 hmf_isEmpty] && objc_msgSend(v35, "hmf_isEmpty"))
  {
    v21 = [MEMORY[0x277D0F7C0] futureWithValue:MEMORY[0x277CBEC10]];
    v22 = dictionary;
  }

  else
  {
    v23 = objc_alloc(MEMORY[0x277D0F7A8]);
    workQueue = [(HMDHome *)self workQueue];
    v25 = [v23 initWithQueue:workQueue];

    array = [MEMORY[0x277CBEB18] array];
    v22 = dictionary;
    if (([v36 hmf_isEmpty] & 1) == 0)
    {
      v27 = [(HMDHome *)self handleSetNaturalLightingEnabled:1 forMatterLightProfiles:v36];
      [array addObject:v27];
      v48[0] = MEMORY[0x277D85DD0];
      v48[1] = 3221225472;
      v48[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke;
      v48[3] = &unk_2786755A0;
      v48[4] = self;
      v49 = v36;
      v50 = obj;
      v51 = dictionary;
      v47[0] = MEMORY[0x277D85DD0];
      v47[1] = 3221225472;
      v47[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_45;
      v47[3] = &unk_278689CD8;
      v47[4] = self;
      v28 = [v27 inContext:v25 then:v48 orRecover:v47];
    }

    if (([v35 hmf_isEmpty] & 1) == 0)
    {
      v29 = [(HMDHome *)self handleSetNaturalLightingEnabled:0 forMatterLightProfiles:v35];
      [array addObject:v29];
      v43[0] = MEMORY[0x277D85DD0];
      v43[1] = 3221225472;
      v43[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_47;
      v43[3] = &unk_2786755A0;
      v43[4] = self;
      v44 = v35;
      v45 = obj;
      v46 = dictionary;
      v42[0] = MEMORY[0x277D85DD0];
      v42[1] = 3221225472;
      v42[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_49;
      v42[3] = &unk_278689CD8;
      v42[4] = self;
      v30 = [v29 inContext:v25 then:v43 orRecover:v42];
    }

    v31 = [MEMORY[0x277D0F7C0] allSettled:array];
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_50;
    v40[3] = &unk_2786868A0;
    v41 = dictionary;
    v21 = [v31 inContext:v25 then:v40];
  }

  v32 = *MEMORY[0x277D85DE8];

  return v21;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke(uint64_t a1, void *a2)
{
  v45 = *MEMORY[0x277D85DE8];
  v34 = a2;
  v3 = objc_autoreleasePoolPush();
  v4 = [*(a1 + 32) lightLogCategory];
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543618;
    v42 = v6;
    v43 = 2112;
    v44 = v34;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEBUG, "%{public}@_executeNaturalLightingActionsForMatter returned result: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  v38 = 0u;
  v39 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = *(a1 + 40);
  v7 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
  if (v7)
  {
    v9 = v7;
    v33 = *v37;
    *&v8 = 138543618;
    v31 = v8;
    do
    {
      v10 = 0;
      do
      {
        if (*v37 != v33)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v36 + 1) + 8 * v10);
        v12 = *(a1 + 48);
        v35[0] = MEMORY[0x277D85DD0];
        v35[1] = 3221225472;
        v35[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_42;
        v35[3] = &unk_278675578;
        v35[4] = v11;
        v13 = [v12 na_firstObjectPassingTest:{v35, v31}];
        v14 = [v34 objectForKey:v11];
        v15 = [v14 BOOLValue];
        v16 = objc_autoreleasePoolPush();
        v17 = [*(a1 + 32) lightLogCategory];
        v18 = HMFGetOSLogHandle();
        v19 = v18;
        if (v15)
        {
          if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
          {
            v20 = HMFGetLogIdentifier();
            *buf = v31;
            v42 = v20;
            v43 = 2112;
            v44 = v11;
            _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Successfully set natural lighting for matter light profile %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v16);
          v21 = [MEMORY[0x277CBEAC0] hmd_dictionaryWithActionExecutionError:0];
          v22 = *(a1 + 56);
          v23 = [v13 uuid];
          v24 = [v23 UUIDString];
          [v22 setObject:v21 forKeyedSubscript:v24];
        }

        else
        {
          if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
          {
            v25 = HMFGetLogIdentifier();
            *buf = v31;
            v42 = v25;
            v43 = 2112;
            v44 = v11;
            _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Failed to set natural lighting for matter light profile %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v16);
          v26 = MEMORY[0x277CBEAC0];
          v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          v23 = [v26 hmd_dictionaryWithActionExecutionError:v21];
          v27 = *(a1 + 56);
          v24 = [v13 uuid];
          v28 = [v24 UUIDString];
          [v27 setObject:v23 forKeyedSubscript:v28];
        }

        ++v10;
      }

      while (v9 != v10);
      v9 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
    }

    while (v9);
  }

  v29 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_45(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v7;
    v12 = 2112;
    v13 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to set natural lighting for all matter light profiles with error: %@", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_47(uint64_t a1, void *a2)
{
  v45 = *MEMORY[0x277D85DE8];
  v34 = a2;
  v3 = objc_autoreleasePoolPush();
  v4 = [*(a1 + 32) lightLogCategory];
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543618;
    v42 = v6;
    v43 = 2112;
    v44 = v34;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEBUG, "%{public}@_executeNaturalLightingActionsForMatter returned result: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  v38 = 0u;
  v39 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = *(a1 + 40);
  v7 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
  if (v7)
  {
    v9 = v7;
    v33 = *v37;
    *&v8 = 138543618;
    v31 = v8;
    do
    {
      v10 = 0;
      do
      {
        if (*v37 != v33)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v36 + 1) + 8 * v10);
        v12 = *(a1 + 48);
        v35[0] = MEMORY[0x277D85DD0];
        v35[1] = 3221225472;
        v35[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_48;
        v35[3] = &unk_278675578;
        v35[4] = v11;
        v13 = [v12 na_firstObjectPassingTest:{v35, v31}];
        v14 = [v34 objectForKey:v11];
        v15 = [v14 BOOLValue];
        v16 = objc_autoreleasePoolPush();
        v17 = [*(a1 + 32) lightLogCategory];
        v18 = HMFGetOSLogHandle();
        v19 = v18;
        if (v15)
        {
          if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
          {
            v20 = HMFGetLogIdentifier();
            *buf = v31;
            v42 = v20;
            v43 = 2112;
            v44 = v11;
            _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Successfully set natural lighting for matter light profile %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v16);
          v21 = [MEMORY[0x277CBEAC0] hmd_dictionaryWithActionExecutionError:0];
          v22 = *(a1 + 56);
          v23 = [v13 uuid];
          v24 = [v23 UUIDString];
          [v22 setObject:v21 forKeyedSubscript:v24];
        }

        else
        {
          if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
          {
            v25 = HMFGetLogIdentifier();
            *buf = v31;
            v42 = v25;
            v43 = 2112;
            v44 = v11;
            _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Failed to set natural lighting for matter light profile %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v16);
          v26 = MEMORY[0x277CBEAC0];
          v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          v23 = [v26 hmd_dictionaryWithActionExecutionError:v21];
          v27 = *(a1 + 56);
          v24 = [v13 uuid];
          v28 = [v24 UUIDString];
          [v27 setObject:v23 forKeyedSubscript:v28];
        }

        ++v10;
      }

      while (v9 != v10);
      v9 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
    }

    while (v9);
  }

  v29 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_49(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) lightLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v7;
    v12 = 2112;
    v13 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to set natural lighting for all matter light profiles with error: %@", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_48(uint64_t a1, void *a2)
{
  v3 = [a2 lightProfileUUID];
  v4 = [*(a1 + 32) uniqueIdentifier];
  v5 = [v3 hmf_isEqualToUUID:v4];

  return v5;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_42(uint64_t a1, void *a2)
{
  v3 = [a2 lightProfileUUID];
  v4 = [*(a1 + 32) uniqueIdentifier];
  v5 = [v3 hmf_isEqualToUUID:v4];

  return v5;
}

uint64_t __68__HMDHome_Light___handleSetNaturalLightingEnabled_forLightProfiles___block_invoke(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __68__HMDHome_Light___handleSetNaturalLightingEnabled_forLightProfiles___block_invoke_2;
  v11[3] = &unk_278675550;
  v12 = *(a1 + 32);
  [v3 hmf_enumerateWithAutoreleasePoolUsingBlock:v11];
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 40) lightLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 32);
    *buf = 138543618;
    v14 = v7;
    v15 = 2112;
    v16 = v8;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_DEBUG, "%{public}@_handleSetNaturalLightingEnabledresponses: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 32) copy];

  v9 = *MEMORY[0x277D85DE8];
  return 1;
}

void __68__HMDHome_Light___handleSetNaturalLightingEnabled_forLightProfiles___block_invoke_2(uint64_t a1, void *a2)
{
  v5 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v5;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  if (v4)
  {
    [*(a1 + 32) addEntriesFromDictionary:v4];
  }
}

- (void)handleSetNaturalLightingEnabledForLightProfilesMessage:(id)message
{
  v33 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v6 = [messageCopy BOOLForKey:@"HMDLightProfileEnableNaturalLightingCodingKey"];
    v7 = [messageCopy arrayForKey:*MEMORY[0x277CD0430]];
    v8 = v7;
    if (v7 && ![v7 hmf_isEmpty])
    {
      v23 = v6;
      v14 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v8, "count")}];
      v26 = 0u;
      v27 = 0u;
      v28 = 0u;
      v29 = 0u;
      v8 = v8;
      v15 = [v8 countByEnumeratingWithState:&v26 objects:v30 count:16];
      if (v15)
      {
        v16 = v15;
        v17 = *v27;
        do
        {
          v18 = 0;
          do
          {
            if (*v27 != v17)
            {
              objc_enumerationMutation(v8);
            }

            v19 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:*(*(&v26 + 1) + 8 * v18)];
            v20 = [(HMDHome *)self lightProfileWithUUID:v19];

            if (v20)
            {
              [v14 addObject:v20];
            }

            ++v18;
          }

          while (v16 != v18);
          v16 = [v8 countByEnumeratingWithState:&v26 objects:v30 count:16];
        }

        while (v16);
      }

      if ([v14 hmf_isEmpty])
      {
        v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [messageCopy respondWithError:v21];
      }

      else
      {
        v21 = [(HMDHome *)self _handleSetNaturalLightingEnabled:v23 forLightProfiles:v14];
        v24[0] = MEMORY[0x277D85DD0];
        v24[1] = 3221225472;
        v24[2] = __73__HMDHome_Light__handleSetNaturalLightingEnabledForLightProfilesMessage___block_invoke;
        v24[3] = &unk_27867DBA0;
        v24[4] = self;
        v25 = messageCopy;
        [v21 getResultWithCompletion:v24];
      }
    }

    else
    {
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [messageCopy respondWithError:v9];
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    lightLogCategory = [(HMDHome *)self lightLogCategory];
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v32 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Not handling remote message to set natural lighting enabled for light profiles on non-primary resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [messageCopy respondWithError:v8];
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome_Light__handleSetNaturalLightingEnabledForLightProfilesMessage___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = [*(a1 + 32) lightLogCategory];
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v17 = v10;
    v18 = 2112;
    v19 = v6;
    v20 = 2112;
    v21 = v5;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Responding to message with error: %@ responses: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 40);
  v14 = @"HMDHomeSetNaturalLightingEnabledByLightProfileUUIDsCodingKey";
  v15 = v5;
  v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v15 forKeys:&v14 count:1];
  [v11 respondWithPayload:v12];

  v13 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome_Light__handleSetNaturalLightingEnabled_forMatterLightProfiles___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v36 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v31 = v10;
    v32 = 2112;
    v33 = v6;
    v34 = 2112;
    v35 = v5;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Completed setting natural lighitng with error: %@ responses: %@", buf, 0x20u);
  }

  v21 = v6;

  objc_autoreleasePoolPop(v7);
  v22 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v23 = v5;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  v11 = [v5 allKeys];
  v12 = [v11 countByEnumeratingWithState:&v25 objects:v29 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v26;
    do
    {
      v15 = 0;
      do
      {
        if (*v26 != v14)
        {
          objc_enumerationMutation(v11);
        }

        v16 = *(*(&v25 + 1) + 8 * v15);
        v17 = *(a1 + 40);
        v24[0] = MEMORY[0x277D85DD0];
        v24[1] = 3221225472;
        v24[2] = __73__HMDHome_Light__handleSetNaturalLightingEnabled_forMatterLightProfiles___block_invoke_29;
        v24[3] = &unk_2786782C8;
        v24[4] = v16;
        v18 = [v17 na_firstObjectPassingTest:{v24, v21}];
        if (v18)
        {
          v19 = [v23 objectForKeyedSubscript:v16];
          [v22 setObject:v19 forKey:v18];
        }

        ++v15;
      }

      while (v13 != v15);
      v13 = [v11 countByEnumeratingWithState:&v25 objects:v29 count:16];
    }

    while (v13);
  }

  [*(a1 + 48) fulfillWithValue:v22];
  v20 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome_Light__handleSetNaturalLightingEnabled_forMatterLightProfiles___block_invoke_3(uint64_t a1, void *a2, void *a3)
{
  v40 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (!WeakRetained)
  {
    v23 = *(a1 + 32);
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    v24 = v23;
    v25 = v8;
LABEL_15:
    [v24 rejectWithError:v25];
    goto LABEL_16;
  }

  v8 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  if (!v6)
  {
    v24 = *(a1 + 32);
    v25 = v5;
    goto LABEL_15;
  }

  v30 = v5;
  v9 = objc_autoreleasePoolPush();
  v28 = WeakRetained;
  v10 = [WeakRetained lightLogCategory];
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    *buf = 138543618;
    v37 = v12;
    v38 = 2112;
    v39 = v6;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@setNaturalLightingEnabledForLightProfiles responsePayload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v29 = v6;
  v13 = [v6 hmf_dictionaryForKey:@"HMDHomeSetNaturalLightingEnabledByLightProfileUUIDsCodingKey"];
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v27 = a1;
  v14 = *(a1 + 40);
  v15 = [v14 countByEnumeratingWithState:&v31 objects:v35 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v32;
    do
    {
      for (i = 0; i != v16; ++i)
      {
        if (*v32 != v17)
        {
          objc_enumerationMutation(v14);
        }

        v19 = *(*(&v31 + 1) + 8 * i);
        v20 = [v19 uniqueIdentifier];
        v21 = [v20 UUIDString];
        v22 = [v13 hmf_numberForKey:v21];

        [v8 setObject:v22 forKey:v19];
      }

      v16 = [v14 countByEnumeratingWithState:&v31 objects:v35 count:16];
    }

    while (v16);
  }

  [*(v27 + 32) fulfillWithValue:v8];
  v6 = v29;
  v5 = v30;
  WeakRetained = v28;
LABEL_16:

  v26 = *MEMORY[0x277D85DE8];
}

id __73__HMDHome_Light__handleSetNaturalLightingEnabled_forMatterLightProfiles___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = [a2 uniqueIdentifier];
  v3 = [v2 UUIDString];

  return v3;
}

uint64_t __73__HMDHome_Light__handleSetNaturalLightingEnabled_forMatterLightProfiles___block_invoke_29(uint64_t a1, void *a2)
{
  v3 = [a2 uniqueIdentifier];
  v4 = [v3 UUIDString];
  v5 = [v4 isEqual:*(a1 + 32)];

  return v5;
}

- (void)updateLightProfilesSettings:(id)settings
{
  v38 = *MEMORY[0x277D85DE8];
  settingsCopy = settings;
  v5 = [MEMORY[0x277CBEB58] set];
  v6 = [MEMORY[0x277CBEB58] set];
  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  v7 = settingsCopy;
  v8 = [v7 countByEnumeratingWithState:&v29 objects:v37 count:16];
  if (v8)
  {
    v9 = *v30;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v30 != v9)
        {
          objc_enumerationMutation(v7);
        }

        v11 = *(*(&v29 + 1) + 8 * i);
        readCharacteristicRequests = [v11 readCharacteristicRequests];
        if ([readCharacteristicRequests count])
        {
          allObjects = [readCharacteristicRequests allObjects];
          [v5 addObjectsFromArray:allObjects];

          [v6 addObject:v11];
        }
      }

      v8 = [v7 countByEnumeratingWithState:&v29 objects:v37 count:16];
    }

    while (v8);
  }

  v14 = [v5 count] == 0;
  v15 = objc_autoreleasePoolPush();
  if (v14)
  {
    lightLogCategory = [(HMDHome *)self lightLogCategory];
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v34 = v24;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_DEBUG, "%{public}@No characteristic read requests for light profiles", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  else
  {
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [v5 count];
      *buf = 138543618;
      v34 = v18;
      v35 = 2048;
      v36 = v19;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@update light profiles settings, read characteristic count %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    objc_initWeak(buf, selfCopy);
    allObjects2 = [v5 allObjects];
    v21 = [(HMDHome *)selfCopy description];
    v26[0] = MEMORY[0x277D85DD0];
    v26[1] = 3221225472;
    v26[2] = __46__HMDHome_Light__updateLightProfilesSettings___block_invoke;
    v26[3] = &unk_278687F40;
    objc_copyWeak(&v28, buf);
    v27 = v6;
    [(HMDHome *)selfCopy readCharacteristicValues:allObjects2 source:1140 sourceForLogging:v21 qualityOfService:-1 withCompletionHandler:v26];

    objc_destroyWeak(&v28);
    objc_destroyWeak(buf);
  }

  v25 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome_Light__updateLightProfilesSettings___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v36 = *MEMORY[0x277D85DE8];
  v20 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v7 = v5;
    if ([v5 count])
    {
      v27 = 0u;
      v28 = 0u;
      v25 = 0u;
      v26 = 0u;
      obj = *(a1 + 32);
      v8 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
      if (v8)
      {
        v9 = v8;
        v10 = *v26;
        do
        {
          for (i = 0; i != v9; ++i)
          {
            if (*v26 != v10)
            {
              objc_enumerationMutation(obj);
            }

            v12 = *(*(&v25 + 1) + 8 * i);
            v13 = [v12 workQueue];
            block[0] = MEMORY[0x277D85DD0];
            block[1] = 3221225472;
            block[2] = __46__HMDHome_Light__updateLightProfilesSettings___block_invoke_24;
            block[3] = &unk_2786891E0;
            block[4] = v12;
            v5 = v7;
            v22 = v7;
            v23 = WeakRetained;
            v24 = v20;
            dispatch_async(v13, block);
          }

          v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
        }

        while (v9);
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      v15 = [WeakRetained lightLogCategory];
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543874;
        v31 = v17;
        v32 = 2112;
        v33 = v7;
        v34 = 2112;
        v35 = v20;
        _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Received empty response payload for light profile charactersitic read requests %@:%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v14);
      v5 = v7;
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome_Light__updateLightProfilesSettings___block_invoke_24(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v18 = 0;
  v4 = [v2 updateSettingsWithReadCharacteristicResponsePayload:v3 error:&v18];
  v5 = v18;
  v6 = objc_autoreleasePoolPush();
  v7 = [*(a1 + 48) lightLogCategory];
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v4)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 32);
      *buf = 138543874;
      v20 = v10;
      v21 = 2112;
      v22 = v11;
      v23 = 2112;
      v24 = v4;
      v12 = "%{public}@Successfully updated light profile settings %@:%@";
      v13 = v9;
      v14 = OS_LOG_TYPE_INFO;
LABEL_6:
      _os_log_impl(&dword_229538000, v13, v14, v12, buf, 0x20u);
    }
  }

  else if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v15 = *(a1 + 32);
    v16 = *(a1 + 56);
    *buf = 138543874;
    v20 = v10;
    v21 = 2112;
    v22 = v15;
    v23 = 2112;
    v24 = v16;
    v12 = "%{public}@Failed to update light profile settings %@:%@";
    v13 = v9;
    v14 = OS_LOG_TYPE_ERROR;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v6);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  v24 = *MEMORY[0x277D85DE8];
  v5 = [MEMORY[0x277CBEB58] set];
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  accessories = [(HMDHome *)self accessories];
  v7 = [accessories countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v20;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v20 != v9)
        {
          objc_enumerationMutation(accessories);
        }

        v11 = *(*(&v19 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = v11;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if (v13)
        {
          lightProfiles = [v13 lightProfiles];
          v15 = lightProfiles;
          if (enabledCopy)
          {
            v16 = [lightProfiles na_filter:&__block_literal_global_69872];

            v15 = v16;
          }

          allObjects = [v15 allObjects];
          [v5 addObjectsFromArray:allObjects];
        }
      }

      v8 = [accessories countByEnumeratingWithState:&v19 objects:v23 count:16];
    }

    while (v8);
  }

  [(HMDHome *)self updateLightProfilesSettings:v5];
  v18 = *MEMORY[0x277D85DE8];
}

BOOL __82__HMDHome_Light__updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 notificationEnabledCharacteristics];
  v3 = [v2 count] != 0;

  return v3;
}

- (void)respondMessage:(id)message withSettingResults:(id)results
{
  v27 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  resultsCopy = results;
  v18 = 0;
  v8 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:resultsCopy requiringSecureCoding:1 error:&v18];
  v9 = v18;
  v10 = objc_autoreleasePoolPush();
  lightLogCategory = [(HMDHome *)self lightLogCategory];
  v12 = HMFGetOSLogHandle();
  v13 = v12;
  if (v8)
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v22 = v14;
      v23 = 2112;
      v24 = resultsCopy;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Responding with light profile settings: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v19 = *MEMORY[0x277CD0438];
    v20 = v8;
    v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v20 forKeys:&v19 count:1];
    [messageCopy respondWithPayload:v15];
  }

  else
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543874;
      v22 = v16;
      v23 = 2112;
      v24 = resultsCopy;
      v25 = 2112;
      v26 = v9;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to encode profile setting results: %@ with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
    [messageCopy respondWithError:v15];
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)handleFetchLightProfileSettingsMessage:(id)message withLightProfileUUIDs:(id)ds
{
  v55 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  dsCopy = ds;
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  lightLogCategory = [(HMDHome *)self lightLogCategory];
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543618;
    v52 = v10;
    v53 = 2112;
    v54 = dsCopy;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Handling fetch light profiles settings for profiles: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v40 = [MEMORY[0x277CBEB58] set];
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v48 = 0u;
  obj = dsCopy;
  v12 = [obj countByEnumeratingWithState:&v45 objects:v50 count:16];
  selfCopy2 = self;
  if (v12)
  {
    v14 = v12;
    v15 = *v46;
    do
    {
      v16 = 0;
      v38 = v14;
      do
      {
        if (*v46 != v15)
        {
          objc_enumerationMutation(obj);
        }

        v17 = *(*(&v45 + 1) + 8 * v16);
        v18 = [(HMDHome *)selfCopy2 lightProfileWithUUID:v17];
        if (v18)
        {
          [v40 addObject:v18];
        }

        else
        {
          v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          v20 = [objc_alloc(MEMORY[0x277CD1A80]) initWithError:v19];
          v21 = dictionary;
          [dictionary setObject:v20 forKeyedSubscript:v17];

          v22 = objc_autoreleasePoolPush();
          lightLogCategory2 = [(HMDHome *)selfCopy2 lightLogCategory];
          v24 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
          {
            v25 = HMFGetLogIdentifier();
            *buf = 138543618;
            v52 = v25;
            v53 = 2112;
            v54 = v17;
            _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Could not find light profile with uuid: %@", buf, 0x16u);

            selfCopy2 = selfCopy;
          }

          objc_autoreleasePoolPop(v22);
          dictionary = v21;
          v14 = v38;
        }

        ++v16;
      }

      while (v14 != v16);
      v14 = [obj countByEnumeratingWithState:&v45 objects:v50 count:16];
    }

    while (v14);
  }

  v43 = 0u;
  v44 = 0u;
  v41 = 0u;
  v42 = 0u;
  v26 = v40;
  v27 = [v26 countByEnumeratingWithState:&v41 objects:v49 count:16];
  if (v27)
  {
    v28 = v27;
    v29 = *v42;
    do
    {
      for (i = 0; i != v28; ++i)
      {
        if (*v42 != v29)
        {
          objc_enumerationMutation(v26);
        }

        v31 = *(*(&v41 + 1) + 8 * i);
        settings = [v31 settings];
        v33 = [objc_alloc(MEMORY[0x277CD1A80]) initWithSettings:settings];
        uniqueIdentifier = [v31 uniqueIdentifier];
        [dictionary setObject:v33 forKeyedSubscript:uniqueIdentifier];
      }

      v28 = [v26 countByEnumeratingWithState:&v41 objects:v49 count:16];
    }

    while (v28);
  }

  [(HMDHome *)selfCopy respondMessage:messageCopy withSettingResults:dictionary];
  v35 = *MEMORY[0x277D85DE8];
}

- (void)handleFetchLightProfileSettingsMessage:(id)message
{
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = [messageCopy setForKey:*MEMORY[0x277CD0430]];
  [(HMDHome *)self handleFetchLightProfileSettingsMessage:messageCopy withLightProfileUUIDs:v6];
}

- (id)lightProfileWithUUID:(id)d
{
  dCopy = d;
  accessories = [(HMDHome *)self accessories];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __39__HMDHome_Light__lightProfileWithUUID___block_invoke;
  v10[3] = &unk_2786754E0;
  v11 = dCopy;
  v6 = dCopy;
  v7 = [accessories na_map:v10];

  firstObject = [v7 firstObject];

  return firstObject;
}

id __39__HMDHome_Light__lightProfileWithUUID___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = v5;
  if (v5)
  {
    v7 = [v5 lightProfiles];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __39__HMDHome_Light__lightProfileWithUUID___block_invoke_2;
    v10[3] = &unk_2786782C8;
    v11 = *(a1 + 32);
    v8 = [v7 na_firstObjectPassingTest:v10];
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

uint64_t __39__HMDHome_Light__lightProfileWithUUID___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 uniqueIdentifier];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (id)createPrimaryResidentMessageRouterWithHomeUUID:(id)d messageDispatcher:(id)dispatcher metricsDispatcher:(id)metricsDispatcher
{
  metricsDispatcherCopy = metricsDispatcher;
  dispatcherCopy = dispatcher;
  dCopy = d;
  v10 = [[HMDPrimaryResidentMessageRouter alloc] initWithHomeUUID:dCopy messageDispatcher:dispatcherCopy metricsDispatcher:metricsDispatcherCopy];

  return v10;
}

- (void)configurePrimaryResidentMessageRouterWithFactory:(id)factory metricsDispatcherFactory:(id)dispatcherFactory
{
  v21 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  dispatcherFactoryCopy = dispatcherFactory;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring primary resident message router", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  msgDispatcher2 = [(HMDHome *)selfCopy msgDispatcher];

  if (!msgDispatcher2)
  {
    _HMFPreconditionFailure();
  }

  v14 = +[HMDMetricsManager sharedLogEventSubmitter];
  v15 = [dispatcherFactoryCopy createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:v14];
  uuid = [(HMDHome *)selfCopy uuid];
  v17 = [factoryCopy createPrimaryResidentMessageRouterWithHomeUUID:uuid messageDispatcher:msgDispatcher metricsDispatcher:v15];

  [v17 setDataSource:selfCopy];
  [(HMDHome *)selfCopy setPrimaryResidentMessageRouter:v17];

  v18 = *MEMORY[0x277D85DE8];
}

- (id)createAccessorySettingsLocalMessageHandlerWithHomeUUID:(id)d languageValuesDataProvider:(id)provider
{
  providerCopy = provider;
  dCopy = d;
  v7 = [[HMDAccessorySettingsLocalMessageHandler alloc] initWithHomeUUID:dCopy languageValuesDataProvider:providerCopy];

  return v7;
}

- (id)languageValueList
{
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __83__HMDHome_UnifiedLanguageValueListSettingDataProviderDataSource__languageValueList__block_invoke;
  v6[3] = &unk_278677020;
  v6[4] = self;
  v4 = [appleMediaAccessories na_flatMap:v6];

  return v4;
}

id __83__HMDHome_UnifiedLanguageValueListSettingDataProviderDataSource__languageValueList__block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = [v2 fetchedAccessorySettingsSubscriber];
  v5 = [v3 uuid];

  v6 = [v4 cachedSettingForAccessory:v5 keyPath:@"root.siri.availableLanguages"];

  v7 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  v10 = [v9 languageValues];

  return v10;
}

- (id)dataProvidersForUnifiedLanguageValueListSettingDataProvider:(id)provider
{
  v6[1] = *MEMORY[0x277D85DE8];
  v6[0] = self;
  v3 = [MEMORY[0x277CBEA60] arrayWithObjects:v6 count:1];
  v4 = *MEMORY[0x277D85DE8];

  return v3;
}

- (id)handleRemoveUserUniqueIdentifier:(id)identifier fromAccessory:(id)accessory
{
  v39 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  accessoryCopy = accessory;
  v8 = objc_autoreleasePoolPush();
  walletLogCategory = [(HMDHome *)self walletLogCategory];
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    uuid = [accessoryCopy uuid];
    *buf = 138543874;
    v34 = v11;
    v35 = 2112;
    v36 = identifierCopy;
    v37 = 2112;
    v38 = uuid;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@handleRemoveUserUniqueIdentifier: %@, fromAccessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  v13 = objc_alloc(MEMORY[0x277D0F7A8]);
  workQueue = [(HMDHome *)self workQueue];
  v15 = [v13 initWithQueue:workQueue];

  untrackedPlaceholderFlow = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
  v17 = [accessoryCopy waitForDoorLockClusterObjectWithFlow:untrackedPlaceholderFlow];
  v31[0] = MEMORY[0x277D85DD0];
  v31[1] = 3221225472;
  v31[2] = __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke;
  v31[3] = &unk_278683930;
  v18 = identifierCopy;
  v32 = v18;
  v19 = [v17 inContext:v15 then:v31];
  v28[0] = MEMORY[0x277D85DD0];
  v28[1] = 3221225472;
  v28[2] = __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke_2;
  v28[3] = &unk_27867C6C8;
  v28[4] = self;
  v29 = v18;
  v30 = accessoryCopy;
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke_142;
  v25[3] = &unk_278685D80;
  v25[4] = self;
  v26 = v29;
  v27 = v30;
  v20 = v29;
  v21 = v30;
  v22 = [v19 inContext:v15 then:v28 orRecover:v25];

  v23 = *MEMORY[0x277D85DE8];

  return v22;
}

uint64_t __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 removeUserWithUniqueID:*(a1 + 32)];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke_2(v7);
  }
}

uint64_t __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke_2(uint64_t a1, void *a2)
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v9 = [*(a1 + 48) uuid];
    v12 = 138543874;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2112;
    v17 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully removed user with userUniqueID: %@, fromAccessory: %@", &v12, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke_142(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v9 = [*(a1 + 48) uuid];
    v15 = 138543874;
    v16 = v7;
    v17 = 2112;
    v18 = v8;
    v19 = 2112;
    v20 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to remove user with userUniqueID: %@, fromAccessory: %@", &v15, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = v3;
  v11 = v10;
  if (v10)
  {
    v12 = v10;
  }

  else
  {
    [MEMORY[0x277CCA9B8] hmfUnspecifiedError];
    objc_claimAutoreleasedReturnValue();
  }

  v13 = *MEMORY[0x277D85DE8];
  return 2;
}

- (id)auditOrAddRestrictedGuestUserUniqueIdentifier:(id)identifier onAccessory:(id)accessory user:(id)user requireFullScheduleAudit:(BOOL)audit flow:(id)flow
{
  v51 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  accessoryCopy = accessory;
  userCopy = user;
  flowCopy = flow;
  v16 = objc_autoreleasePoolPush();
  selfCopy = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    [flowCopy UUID];
    v35 = flowCopy;
    v20 = userCopy;
    v22 = v21 = audit;
    uuid = [accessoryCopy uuid];
    *buf = 138544130;
    v44 = v19;
    v45 = 2112;
    v46 = v22;
    v47 = 2112;
    v48 = identifierCopy;
    v49 = 2112;
    v50 = uuid;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] auditOrAddRestrictedGuestUserUniqueIdentifier: %@ onAccessory: %@", buf, 0x2Au);

    audit = v21;
    userCopy = v20;
    flowCopy = v35;
  }

  objc_autoreleasePoolPop(v16);
  weekDayScheduleCapacity = [accessoryCopy weekDayScheduleCapacity];
  if ([weekDayScheduleCapacity BOOLValue])
  {
    yearDayScheduleCapacity = [accessoryCopy yearDayScheduleCapacity];
    bOOLValue = [yearDayScheduleCapacity BOOLValue];
  }

  else
  {
    bOOLValue = 0;
  }

  restrictedGuestAccessSettings = [userCopy restrictedGuestAccessSettings];
  schedule = [restrictedGuestAccessSettings schedule];
  v29 = [accessoryCopy supportsConfiguredSchedule:schedule];

  if (v29)
  {
    v30 = [accessoryCopy waitForDoorLockClusterObjectWithFlow:flowCopy];
    v36[0] = MEMORY[0x277D85DD0];
    v36[1] = 3221225472;
    v36[2] = __129__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuestUserUniqueIdentifier_onAccessory_user_requireFullScheduleAudit_flow___block_invoke;
    v36[3] = &unk_278677548;
    v41 = bOOLValue;
    v36[4] = selfCopy;
    v37 = flowCopy;
    v38 = accessoryCopy;
    v39 = identifierCopy;
    v40 = userCopy;
    auditCopy = audit;
    v31 = [v30 then:v36];
  }

  else
  {
    v32 = MEMORY[0x277D0F7C0];
    v30 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:5];
    v31 = [v32 futureWithError:v30];
  }

  v33 = *MEMORY[0x277D85DE8];

  return v31;
}

uint64_t __129__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuestUserUniqueIdentifier_onAccessory_user_requireFullScheduleAudit_flow___block_invoke(uint64_t a1, void *a2)
{
  v35 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (*(a1 + 72) == 1)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 40) UUID];
      v10 = [*(a1 + 48) uuid];
      v11 = *(a1 + 56);
      *buf = 138544130;
      v28 = v8;
      v29 = 2112;
      v30 = v9;
      v31 = 2112;
      v32 = v10;
      v33 = 2112;
      v34 = v11;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Accessory[%@] supports schedules, auditing schedules for userUniqueID[%@]", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v5);
    v12 = *(a1 + 56);
    v13 = [*(a1 + 64) restrictedGuestAccessSettings];
    v14 = [v13 matterWeekDaySchedules];
    v15 = [*(a1 + 64) restrictedGuestAccessSettings];
    v16 = [*(a1 + 32) timeZone];
    v17 = [v15 matterYearDaySchedulesWithTimeZone:v16];
    v18 = [v4 findOrAddUserWithUniqueID:v12 withWeekDaySchedules:v14 andYearDaySchedules:v17 requireFullScheduleAudit:*(a1 + 73) flow:*(a1 + 40)];
  }

  else
  {
    v18 = [v3 findOrAddUserWithUniqueID:*(a1 + 56) flow:*(a1 + 40)];
  }

  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __129__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuestUserUniqueIdentifier_onAccessory_user_requireFullScheduleAudit_flow___block_invoke_141;
  v24[3] = &unk_278677520;
  v19 = *(a1 + 40);
  v24[4] = *(a1 + 32);
  v25 = v19;
  v26 = *(a1 + 56);
  v20 = [v18 then:v24];
  if (!v20)
  {
    _HMFPreconditionFailure();
  }

  v21 = v20;

  v22 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __129__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuestUserUniqueIdentifier_onAccessory_user_requireFullScheduleAudit_flow___block_invoke_141(uint64_t a1, void *a2)
{
  v29 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 existingUser];

  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 32);
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v4)
  {
    if (v8)
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 40) UUID];
      v11 = [v3 existingUser];
      v12 = [v11 userIndex];
      v13 = *(a1 + 48);
      v21 = 138544130;
      v22 = v9;
      v23 = 2112;
      v24 = v10;
      v25 = 2112;
      v26 = v12;
      v27 = 2112;
      v28 = v13;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Found userIndex: %@ for userUniqueID: %@", &v21, 0x2Au);
    }

    objc_autoreleasePoolPop(v5);
    v14 = [v3 existingUser];
    [v14 userIndex];
    objc_claimAutoreleasedReturnValue();
  }

  else
  {
    if (v8)
    {
      v15 = HMFGetLogIdentifier();
      v16 = [*(a1 + 40) UUID];
      v17 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v3, "newUserSlot")}];
      v18 = *(a1 + 48);
      v21 = 138544130;
      v22 = v15;
      v23 = 2112;
      v24 = v16;
      v25 = 2112;
      v26 = v17;
      v27 = 2112;
      v28 = v18;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Created new user with userIndex: %@ for userUniqueID: %@", &v21, 0x2Au);
    }

    objc_autoreleasePoolPop(v5);
    [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v3, "newUserSlot")}];
    objc_claimAutoreleasedReturnValue();
  }

  v19 = *MEMORY[0x277D85DE8];
  return 1;
}

- (id)handleFindOrAddUserUniqueIdentifier:(id)identifier onAccessory:(id)accessory flow:(id)flow
{
  v40 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  accessoryCopy = accessory;
  flowCopy = flow;
  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    uUID = [flowCopy UUID];
    uuid = [accessoryCopy uuid];
    *buf = 138544130;
    v33 = v14;
    v34 = 2112;
    v35 = uUID;
    v36 = 2112;
    v37 = identifierCopy;
    v38 = 2112;
    v39 = uuid;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] handleFindOrAddUserUniqueIdentifier: %@ onAccessory: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v11);
  v17 = [accessoryCopy waitForDoorLockClusterObjectWithFlow:flowCopy];
  v29[0] = MEMORY[0x277D85DD0];
  v29[1] = 3221225472;
  v29[2] = __89__HMDHome_AccessoryUserIdentifier__handleFindOrAddUserUniqueIdentifier_onAccessory_flow___block_invoke;
  v29[3] = &unk_27868A6D8;
  v18 = identifierCopy;
  v30 = v18;
  v19 = flowCopy;
  v31 = v19;
  v20 = [v17 then:v29];
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __89__HMDHome_AccessoryUserIdentifier__handleFindOrAddUserUniqueIdentifier_onAccessory_flow___block_invoke_2;
  v26[3] = &unk_278677520;
  v26[4] = selfCopy;
  v27 = v19;
  v28 = v18;
  v21 = v18;
  v22 = v19;
  v23 = [v20 then:v26];

  v24 = *MEMORY[0x277D85DE8];

  return v23;
}

uint64_t __89__HMDHome_AccessoryUserIdentifier__handleFindOrAddUserUniqueIdentifier_onAccessory_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 findOrAddUserWithUniqueID:*(a1 + 32) flow:*(a1 + 40)];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return __89__HMDHome_AccessoryUserIdentifier__handleFindOrAddUserUniqueIdentifier_onAccessory_flow___block_invoke_2(v7);
  }
}

uint64_t __89__HMDHome_AccessoryUserIdentifier__handleFindOrAddUserUniqueIdentifier_onAccessory_flow___block_invoke_2(uint64_t a1, void *a2)
{
  v29 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 existingUser];

  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 32);
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v4)
  {
    if (v8)
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 40) UUID];
      v11 = [v3 existingUser];
      v12 = [v11 userIndex];
      v13 = *(a1 + 48);
      v21 = 138544130;
      v22 = v9;
      v23 = 2112;
      v24 = v10;
      v25 = 2112;
      v26 = v12;
      v27 = 2112;
      v28 = v13;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Found userIndex: %@ for userUniqueID: %@", &v21, 0x2Au);
    }

    objc_autoreleasePoolPop(v5);
    v14 = [v3 existingUser];
    [v14 userIndex];
    objc_claimAutoreleasedReturnValue();
  }

  else
  {
    if (v8)
    {
      v15 = HMFGetLogIdentifier();
      v16 = [*(a1 + 40) UUID];
      v17 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v3, "newUserSlot")}];
      v18 = *(a1 + 48);
      v21 = 138544130;
      v22 = v15;
      v23 = 2112;
      v24 = v16;
      v25 = 2112;
      v26 = v17;
      v27 = 2112;
      v28 = v18;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Found userIndex: %@ for userUniqueID: %@", &v21, 0x2Au);
    }

    objc_autoreleasePoolPop(v5);
    [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v3, "newUserSlot")}];
    objc_claimAutoreleasedReturnValue();
  }

  v19 = *MEMORY[0x277D85DE8];
  return 1;
}

- (id)findUserSlotForUserUniqueIdentifier:(id)identifier onAccessory:(id)accessory
{
  identifierCopy = identifier;
  v6 = MEMORY[0x277D0F7B8];
  accessoryCopy = accessory;
  untrackedPlaceholderFlow = [v6 untrackedPlaceholderFlow];
  v9 = [accessoryCopy waitForDoorLockClusterObjectWithFlow:untrackedPlaceholderFlow];

  naFuture = [v9 naFuture];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __84__HMDHome_AccessoryUserIdentifier__findUserSlotForUserUniqueIdentifier_onAccessory___block_invoke;
  v14[3] = &unk_278688428;
  v15 = identifierCopy;
  v11 = identifierCopy;
  v12 = [naFuture flatMap:v14];

  return v12;
}

id __84__HMDHome_AccessoryUserIdentifier__findUserSlotForUserUniqueIdentifier_onAccessory___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = MEMORY[0x277D0F7B8];
  v4 = a2;
  v5 = [v3 untrackedPlaceholderFlow];
  v6 = [v4 findUserOrAvailableSlotWithUserUniqueID:v2 flow:v5];

  v7 = [v6 naFuture];
  v8 = [v7 flatMap:&__block_literal_global_138];

  return v8;
}

id __84__HMDHome_AccessoryUserIdentifier__findUserSlotForUserUniqueIdentifier_onAccessory___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 user];

  v4 = MEMORY[0x277D2C900];
  if (v3)
  {
    v5 = [v2 user];
    v6 = [v5 userIndex];
    v7 = [v4 futureWithResult:v6];
  }

  else
  {
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v7 = [v4 futureWithError:v5];
  }

  return v7;
}

- (id)createUserUniqueIDForAccessories
{
  uniqueIDsOfAllUsers = [(HMDHome *)self uniqueIDsOfAllUsers];
  v3 = [objc_opt_class() createUserUniqueIDForAccessoriesWithoutDuplicatingExistingIDs:uniqueIDsOfAllUsers];

  return v3;
}

- (id)saveUserUniqueID:(id)d ForGuestAccessCode:(id)code
{
  dCopy = d;
  codeCopy = code;
  v26 = 0;
  v8 = [MEMORY[0x277D0F7C0] futureWithPromise:&v26];
  backingStore = [(HMDHome *)self backingStore];
  context = [backingStore context];

  v11 = [HMDHomeAccessCodeModel alloc];
  uuid = [(HMDHome *)self uuid];
  v13 = [(HMDHomeAccessCodeModel *)v11 initWithHomeUUID:uuid value:codeCopy label:&stru_283CF9D50];

  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __72__HMDHome_AccessoryUserIdentifier__saveUserUniqueID_ForGuestAccessCode___block_invoke;
  v19[3] = &unk_278683598;
  v20 = v13;
  selfCopy = self;
  v22 = codeCopy;
  v23 = v26;
  v24 = dCopy;
  v25 = context;
  v14 = context;
  v15 = dCopy;
  v16 = codeCopy;
  v17 = v13;
  [v14 performBlock:v19];

  return v8;
}

void __72__HMDHome_AccessoryUserIdentifier__saveUserUniqueID_ForGuestAccessCode___block_invoke(uint64_t a1)
{
  v37 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findGuestAccessCodeWithModelID:v2];

  if (!v3)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = [*(a1 + 40) walletLogCategory];
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      v24 = *(a1 + 48);
      *buf = 138543618;
      v32 = v23;
      v33 = 2112;
      v34 = v24;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@MKFGuestAccessCode model not found, failed to save unique ID for accessCode: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v25 = *(a1 + 56);
    v12 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
    v26 = v25;
    goto LABEL_14;
  }

  [v3 setUserUniqueIDForAccessories:*(a1 + 64)];
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 40) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 72) managedObjectContext];
    [v8 hasChanges];
    v9 = HMFBooleanToString();
    *buf = 138543618;
    v32 = v7;
    v33 = 2112;
    v34 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@moc has changes %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = *(a1 + 72);
  v30 = 0;
  v11 = [v10 save:&v30];
  v12 = v30;
  v13 = objc_autoreleasePoolPush();
  v14 = [*(a1 + 40) walletLogCategory];
  v15 = HMFGetOSLogHandle();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_INFO);
  if ((v11 & 1) == 0)
  {
    if (v16)
    {
      v27 = HMFGetLogIdentifier();
      v28 = *(a1 + 48);
      *buf = 138543874;
      v32 = v27;
      v33 = 2112;
      v34 = v28;
      v35 = 2112;
      v36 = v12;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Failed to save userUniqueID for guest access code: %@ with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v26 = *(a1 + 56);
LABEL_14:
    [v26 rejectWithError:v12];
    goto LABEL_15;
  }

  if (v16)
  {
    v17 = HMFGetLogIdentifier();
    v18 = *(a1 + 48);
    v19 = *(a1 + 64);
    *buf = 138543874;
    v32 = v17;
    v33 = 2112;
    v34 = v18;
    v35 = 2112;
    v36 = v19;
    _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Successfully saved userUniqueID for guest access code: %@ userUniqueID: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v13);
  [*(a1 + 56) fulfillWithNoValue];
LABEL_15:

  v29 = *MEMORY[0x277D85DE8];
}

- (void)getOrCreateUniqueIDForAccessoriesForUser:(id)user flow:(id)flow completionHandler:(id)handler
{
  handlerCopy = handler;
  v9 = [(HMDHome *)self getOrCreateUniqueIDForAccessoriesForUser:user flow:flow];
  [v9 getResultWithCompletion:handlerCopy];
}

- (id)getOrCreateUniqueIDForAccessoriesForUser:(id)user flow:(id)flow
{
  userCopy = user;
  flowCopy = flow;
  v21 = 0;
  v8 = [MEMORY[0x277D0F7C0] futureWithPromise:&v21];
  backingStore = [(HMDHome *)self backingStore];
  context = [backingStore context];

  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __82__HMDHome_AccessoryUserIdentifier__getOrCreateUniqueIDForAccessoriesForUser_flow___block_invoke;
  v15[3] = &unk_278689550;
  v16 = userCopy;
  v17 = context;
  selfCopy = self;
  v19 = flowCopy;
  v20 = v21;
  v11 = flowCopy;
  v12 = context;
  v13 = userCopy;
  [v12 performBlock:v15];

  return v8;
}

void __82__HMDHome_AccessoryUserIdentifier__getOrCreateUniqueIDForAccessoriesForUser_flow___block_invoke(id *a1)
{
  v53 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] uuid];
  v3 = [a1[5] managedObjectContext];
  v4 = [_MKFHome findHomeMemberWithUUID:v2 context:v3];

  if (!v4)
  {
    v24 = objc_autoreleasePoolPush();
    v25 = a1[6];
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [a1[7] UUID];
      v29 = [a1[4] uuid];
      *buf = 138543874;
      v46 = v27;
      v47 = 2112;
      v48 = v28;
      v49 = 2112;
      v50 = v29;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find home member with UUID: %@", buf, 0x20u);
    }

    v30 = v24;
    goto LABEL_20;
  }

  v5 = [v4 uniqueIDForAccessories];
  v6 = v5;
  if (!v5 || ([v5 isEqualToNumber:&unk_283E728D8] & 1) != 0)
  {
    v7 = [a1[6] createUserUniqueIDForAccessories];

    v8 = objc_autoreleasePoolPush();
    v9 = a1[6];
    v10 = HMFGetOSLogHandle();
    v11 = v10;
    if (v7)
    {
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        v13 = [a1[7] UUID];
        v14 = [a1[4] uuid];
        *buf = 138544130;
        v46 = v12;
        v47 = 2112;
        v48 = v13;
        v49 = 2112;
        v50 = v7;
        v51 = 2112;
        v52 = v14;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Created uniqueIDForAccessories:%@ for user:%@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v8);
      [v4 setUniqueIDForAccessories:v7];
      v15 = a1[5];
      v44 = 0;
      [v15 save:&v44];
      v16 = v44;
      v17 = objc_autoreleasePoolPush();
      v18 = a1[6];
      v19 = HMFGetOSLogHandle();
      v20 = v19;
      if (v16)
      {
        if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
        {
          v21 = HMFGetLogIdentifier();
          v22 = [a1[7] UUID];
          v23 = [a1[4] uuid];
          *buf = 138544130;
          v46 = v21;
          v47 = 2112;
          v48 = v22;
          v49 = 2112;
          v50 = v23;
          v51 = 2112;
          v52 = v16;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to save userUniqueID for user: %@ with error: %@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v17);
        [a1[8] rejectWithError:v16];
      }

      else
      {
        if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
        {
          v40 = HMFGetLogIdentifier();
          v41 = [a1[7] UUID];
          v42 = [a1[4] uuid];
          *buf = 138544130;
          v46 = v40;
          v47 = 2112;
          v48 = v41;
          v49 = 2112;
          v50 = v42;
          v51 = 2112;
          v52 = v7;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Successfully saved userUniqueID for user: %@ userUniqueID: %@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v17);
        [a1[8] fulfillWithValue:v7];
      }

      v6 = v7;
      goto LABEL_25;
    }

    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v36 = HMFGetLogIdentifier();
      v37 = [a1[7] UUID];
      v38 = [a1[4] uuid];
      *buf = 138543874;
      v46 = v36;
      v47 = 2112;
      v48 = v37;
      v49 = 2112;
      v50 = v38;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to create uniqueID for user: %@", buf, 0x20u);
    }

    v30 = v8;
LABEL_20:
    objc_autoreleasePoolPop(v30);
    v39 = a1[8];
    v6 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
    [v39 rejectWithError:v6];
    goto LABEL_25;
  }

  v31 = objc_autoreleasePoolPush();
  v32 = a1[6];
  v33 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
  {
    v34 = HMFGetLogIdentifier();
    v35 = [a1[7] UUID];
    *buf = 138543874;
    v46 = v34;
    v47 = 2112;
    v48 = v35;
    v49 = 2112;
    v50 = v6;
    _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Found existing userUniqueID: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v31);
  [a1[8] fulfillWithValue:v6];
LABEL_25:

  v43 = *MEMORY[0x277D85DE8];
}

- (id)uniqueIDsOfAllUsers
{
  array = [MEMORY[0x277CBEB18] array];
  backingStore = [(HMDHome *)self backingStore];
  context = [backingStore context];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke;
  v10[3] = &unk_27868A750;
  v10[4] = self;
  v6 = array;
  v11 = v6;
  [context unsafeSynchronousBlock:v10];

  v7 = v11;
  v8 = v6;

  return v6;
}

void __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke(uint64_t a1)
{
  v22 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  if (v3)
  {
    v4 = [v3 homeMembers];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke_127;
    v16[3] = &unk_278677490;
    v5 = *(a1 + 40);
    v16[4] = *(a1 + 32);
    v17 = v5;
    [v4 hmf_enumerateWithAutoreleasePoolUsingBlock:v16];

    v6 = [v3 guestAccessCodes];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke_129;
    v14[3] = &unk_2786774B8;
    v7 = *(a1 + 40);
    v14[4] = *(a1 + 32);
    v15 = v7;
    [v6 hmf_enumerateWithAutoreleasePoolUsingBlock:v14];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = [*(a1 + 32) walletLogCategory];
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [*(a1 + 32) uuid];
      *buf = 138543618;
      v19 = v11;
      v20 = 2112;
      v21 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the mkfHome with UUID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke_127(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [v3 modelID];
    v9 = [v3 uniqueIDForAccessories];
    v14 = 138543874;
    v15 = v7;
    v16 = 2112;
    v17 = v8;
    v18 = 2112;
    v19 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@HomeMember: %@, uniqueID: %@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = [v3 uniqueIDForAccessories];

  if (v10)
  {
    v11 = *(a1 + 40);
    v12 = [v3 uniqueIDForAccessories];
    [v11 addObject:v12];
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke_129(uint64_t a1, void *a2)
{
  v23 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [v3 label];
    v9 = [v3 accessCode];
    v10 = [v3 userUniqueIDForAccessories];
    v15 = 138544130;
    v16 = v7;
    v17 = 2112;
    v18 = v8;
    v19 = 2112;
    v20 = v9;
    v21 = 2112;
    v22 = v10;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Guest: %@: %@, uniqueID: %@", &v15, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v11 = [v3 userUniqueIDForAccessories];

  if (v11)
  {
    v12 = *(a1 + 40);
    v13 = [v3 userUniqueIDForAccessories];
    [v12 addObject:v13];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)removeGuestAccessCode:(id)code fromAccessory:(id)accessory
{
  v21 = *MEMORY[0x277D85DE8];
  codeCopy = code;
  accessoryCopy = accessory;
  if ([accessoryCopy supportsCHIP])
  {
    v8 = objc_autoreleasePoolPush();
    walletLogCategory = [(HMDHome *)self walletLogCategory];
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      uuid = [accessoryCopy uuid];
      v17 = 138543618;
      v18 = v11;
      v19 = 2112;
      v20 = uuid;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Not a matter accessory, cannot remove user from accessory: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    futureWithNoValue = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  else
  {
    v14 = [(HMDHome *)self userUniqueIDForGuestAccessCode:codeCopy];
    if (v14)
    {
      [(HMDHome *)self handleRemoveUserUniqueIdentifier:v14 fromAccessory:accessoryCopy];
    }

    else
    {
      [MEMORY[0x277D0F7C0] futureWithNoValue];
    }
    futureWithNoValue = ;
  }

  v15 = *MEMORY[0x277D85DE8];

  return futureWithNoValue;
}

- (id)userUniqueIDForGuestAccessCode:(id)code
{
  codeCopy = code;
  v13 = 0;
  v14 = &v13;
  v15 = 0x3032000000;
  v16 = __Block_byref_object_copy__93296;
  v17 = __Block_byref_object_dispose__93297;
  v18 = 0;
  backingStore = [(HMDHome *)self backingStore];
  context = [backingStore context];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __67__HMDHome_AccessoryUserIdentifier__userUniqueIDForGuestAccessCode___block_invoke;
  v10[3] = &unk_27868A4D8;
  v10[4] = self;
  v7 = codeCopy;
  v11 = v7;
  v12 = &v13;
  [context unsafeSynchronousBlock:v10];

  v8 = v14[5];
  _Block_object_dispose(&v13, 8);

  return v8;
}

void __67__HMDHome_AccessoryUserIdentifier__userUniqueIDForGuestAccessCode___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = [HMDHomeAccessCodeModel alloc];
  v3 = [*(a1 + 32) uuid];
  v4 = [(HMDHomeAccessCodeModel *)v2 initWithHomeUUID:v3 value:*(a1 + 40) label:&stru_283CF9D50];

  v5 = [(HMDBackingStoreModelObject *)v4 uuid];
  v6 = [HMCContext findGuestAccessCodeWithModelID:v5];

  if (v6)
  {
    v7 = [v6 userUniqueIDForAccessories];
    v8 = *(*(a1 + 48) + 8);
    v9 = *(v8 + 40);
    *(v8 + 40) = v7;
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = [*(a1 + 32) walletLogCategory];
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 40);
      v16 = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@MKFGuestAccessCode model not found, returning nil unique ID for accessCode: %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (id)findOrAddUserUniqueIDForGuestAccessCode:(id)code onAccessory:(id)accessory
{
  v46 = *MEMORY[0x277D85DE8];
  codeCopy = code;
  accessoryCopy = accessory;
  v8 = objc_autoreleasePoolPush();
  walletLogCategory = [(HMDHome *)self walletLogCategory];
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    uuid = [accessoryCopy uuid];
    *buf = 138543874;
    v41 = v11;
    v42 = 2112;
    v43 = codeCopy;
    v44 = 2112;
    v45 = uuid;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@findOrAddUserUniqueIDForGuestAccessCode: %@ onAccessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  if (([accessoryCopy supportsCHIP] & 1) == 0)
  {
    v17 = objc_autoreleasePoolPush();
    walletLogCategory2 = [(HMDHome *)self walletLogCategory];
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      uuid2 = [accessoryCopy uuid];
      *buf = 138543618;
      v41 = v20;
      v42 = 2112;
      v43 = uuid2;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Not a matter accessory, cannot find or add homeAccessCode on accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
    v22 = MEMORY[0x277D0F7C0];
    v23 = MEMORY[0x277CCA9B8];
    v24 = 5;
    goto LABEL_9;
  }

  v13 = [(HMDHome *)self userUniqueIDForGuestAccessCode:codeCopy];
  if (!v13)
  {
    createUserUniqueIDForAccessories = [(HMDHome *)self createUserUniqueIDForAccessories];
    v26 = objc_autoreleasePoolPush();
    walletLogCategory3 = [(HMDHome *)self walletLogCategory];
    v28 = HMFGetOSLogHandle();
    v29 = v28;
    if (createUserUniqueIDForAccessories)
    {
      if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543874;
        v41 = v30;
        v42 = 2112;
        v43 = createUserUniqueIDForAccessories;
        v44 = 2112;
        v45 = codeCopy;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Created uniqueIDForAccessories:%@ for guest access code: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v26);
      v31 = objc_alloc(MEMORY[0x277D0F7A8]);
      workQueue = [(HMDHome *)self workQueue];
      untrackedPlaceholderFlow = [v31 initWithQueue:workQueue];

      v33 = [(HMDHome *)self saveUserUniqueID:createUserUniqueIDForAccessories ForGuestAccessCode:codeCopy];
      v37[0] = MEMORY[0x277D85DD0];
      v37[1] = 3221225472;
      v37[2] = __88__HMDHome_AccessoryUserIdentifier__findOrAddUserUniqueIDForGuestAccessCode_onAccessory___block_invoke;
      v37[3] = &unk_278685D58;
      v37[4] = self;
      v38 = createUserUniqueIDForAccessories;
      v39 = accessoryCopy;
      v14 = createUserUniqueIDForAccessories;
      v16 = [v33 inContext:untrackedPlaceholderFlow then:v37 orRecover:&__block_literal_global_123];

      goto LABEL_14;
    }

    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      v36 = HMFGetLogIdentifier();
      *buf = 138543618;
      v41 = v36;
      v42 = 2112;
      v43 = codeCopy;
      _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Failed to create uniqueID for guest access code: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v26);
    v22 = MEMORY[0x277D0F7C0];
    v23 = MEMORY[0x277CCA9B8];
    v24 = 15;
LABEL_9:
    v14 = [v23 hmfErrorWithCode:v24];
    v16 = [v22 futureWithError:v14];
    goto LABEL_15;
  }

  v14 = v13;
  untrackedPlaceholderFlow = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
  v16 = [(HMDHome *)self handleFindOrAddUserUniqueIdentifier:v14 onAccessory:accessoryCopy flow:untrackedPlaceholderFlow];
LABEL_14:

LABEL_15:
  v34 = *MEMORY[0x277D85DE8];

  return v16;
}

uint64_t __88__HMDHome_AccessoryUserIdentifier__findOrAddUserUniqueIDForGuestAccessCode_onAccessory___block_invoke(void *a1, void *a2)
{
  v3 = a2;
  v4 = a1[4];
  v5 = a1[5];
  v6 = a1[6];
  v7 = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
  v8 = [v4 handleFindOrAddUserUniqueIdentifier:v5 onAccessory:v6 flow:v7];
  if (v8)
  {
    v9 = v8;

    return 3;
  }

  else
  {
    v11 = _HMFPreconditionFailure();
    return __88__HMDHome_AccessoryUserIdentifier__findOrAddUserUniqueIDForGuestAccessCode_onAccessory___block_invoke_2(v11);
  }
}

uint64_t __88__HMDHome_AccessoryUserIdentifier__findOrAddUserUniqueIDForGuestAccessCode_onAccessory___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [MEMORY[0x277D0F7C0] futureWithError:v2];
  if (v3)
  {
    v4 = v3;

    return 3;
  }

  else
  {
    v6 = _HMFPreconditionFailure();
    return [(HMDHome *)v6 removeUser:v7 fromAccessory:v8, v9];
  }
}

- (id)removeUser:(id)user fromAccessory:(id)accessory
{
  v34 = *MEMORY[0x277D85DE8];
  userCopy = user;
  accessoryCopy = accessory;
  v8 = objc_autoreleasePoolPush();
  walletLogCategory = [(HMDHome *)self walletLogCategory];
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    uuid = [userCopy uuid];
    uuid2 = [accessoryCopy uuid];
    v28 = 138543874;
    v29 = v11;
    v30 = 2112;
    v31 = uuid;
    v32 = 2112;
    v33 = uuid2;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Removing user from matter accessory. user: %@, accessory: %@", &v28, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  if ([accessoryCopy supportsCHIP])
  {
    uniqueIDForAccessories = [userCopy uniqueIDForAccessories];
    if (uniqueIDForAccessories)
    {
      futureWithNoValue = [(HMDHome *)self handleRemoveUserUniqueIdentifier:uniqueIDForAccessories fromAccessory:accessoryCopy];
    }

    else
    {
      v22 = objc_autoreleasePoolPush();
      walletLogCategory2 = [(HMDHome *)self walletLogCategory];
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v25 = HMFGetLogIdentifier();
        v28 = 138543362;
        v29 = v25;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@User does not have uniqueIDForAccessories, so nothing to do", &v28, 0xCu);
      }

      objc_autoreleasePoolPop(v22);
      futureWithNoValue = [MEMORY[0x277D0F7C0] futureWithNoValue];
    }

    futureWithNoValue2 = futureWithNoValue;
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    walletLogCategory3 = [(HMDHome *)self walletLogCategory];
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      uuid3 = [accessoryCopy uuid];
      v28 = 138543618;
      v29 = v19;
      v30 = 2112;
      v31 = uuid3;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Not a matter accessory, cannot remove user from accessory: %@", &v28, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    futureWithNoValue2 = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v26 = *MEMORY[0x277D85DE8];

  return futureWithNoValue2;
}

- (id)removeUserFromMatterAccessories:(id)accessories
{
  accessoriesCopy = accessories;
  v5 = MEMORY[0x277D0F7C0];
  matterAccessories = [(HMDHome *)self matterAccessories];
  v11 = MEMORY[0x277D85DD0];
  v12 = 3221225472;
  v13 = __68__HMDHome_AccessoryUserIdentifier__removeUserFromMatterAccessories___block_invoke;
  v14 = &unk_278677468;
  selfCopy = self;
  v16 = accessoriesCopy;
  v7 = accessoriesCopy;
  v8 = [matterAccessories na_map:&v11];
  v9 = [v5 allSettled:{v8, v11, v12, v13, v14, selfCopy}];

  return v9;
}

id __68__HMDHome_AccessoryUserIdentifier__removeUserFromMatterAccessories___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  if (v5)
  {
    v6 = [*(a1 + 32) removeUser:*(a1 + 40) fromAccessory:v5];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (id)removeUsersFromAccessory:(id)accessory
{
  v27 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  if ([accessoryCopy supportsCHIP])
  {
    v5 = objc_alloc(MEMORY[0x277D0F7A8]);
    workQueue = [(HMDHome *)self workQueue];
    v7 = [v5 initWithQueue:workQueue];

    untrackedPlaceholderFlow = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
    v9 = [accessoryCopy waitForDoorLockClusterObjectWithFlow:untrackedPlaceholderFlow];
    v10 = [v9 inContext:v7 then:&__block_literal_global_116];
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __61__HMDHome_AccessoryUserIdentifier__removeUsersFromAccessory___block_invoke_2;
    v21[3] = &unk_2786882A0;
    v21[4] = self;
    v22 = accessoryCopy;
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __61__HMDHome_AccessoryUserIdentifier__removeUsersFromAccessory___block_invoke_118;
    v19[3] = &unk_2786882F0;
    v19[4] = self;
    v20 = v22;
    futureWithNoValue = [v10 inContext:v7 then:v21 orRecover:v19];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    walletLogCategory = [(HMDHome *)self walletLogCategory];
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      uuid = [accessoryCopy uuid];
      *buf = 138543618;
      v24 = v15;
      v25 = 2112;
      v26 = uuid;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Not a matter accessory, cannot remove user from accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    futureWithNoValue = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v17 = *MEMORY[0x277D85DE8];

  return futureWithNoValue;
}

uint64_t __61__HMDHome_AccessoryUserIdentifier__removeUsersFromAccessory___block_invoke_2(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) uuid];
    v11 = 138543618;
    v12 = v7;
    v13 = 2112;
    v14 = v8;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully removed all users from Accessory: %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __61__HMDHome_AccessoryUserIdentifier__removeUsersFromAccessory___block_invoke_118(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) uuid];
    v14 = 138543874;
    v15 = v7;
    v16 = 2112;
    v17 = v8;
    v18 = 2112;
    v19 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove all users from Accessory: %@ with error: %@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = v3;
  v10 = v9;
  if (v9)
  {
    v11 = v9;
  }

  else
  {
    [MEMORY[0x277CCA9B8] hmfUnspecifiedError];
    objc_claimAutoreleasedReturnValue();
  }

  v12 = *MEMORY[0x277D85DE8];
  return 2;
}

uint64_t __61__HMDHome_AccessoryUserIdentifier__removeUsersFromAccessory___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 removeAllUsers];
  v4 = [v3 timeout:15.0];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return [(HMDHome *)v7 auditOrAddRestrictedGuest:v8 onAccessory:v9 flow:v10, v11];
  }
}

- (id)auditOrAddRestrictedGuest:(id)guest onAccessory:(id)accessory flow:(id)flow
{
  v40 = *MEMORY[0x277D85DE8];
  guestCopy = guest;
  accessoryCopy = accessory;
  flowCopy = flow;
  if ([accessoryCopy supportsCHIP])
  {
    if ([guestCopy isRestrictedGuest])
    {
      v11 = objc_alloc(MEMORY[0x277D0F7A8]);
      workQueue = [(HMDHome *)self workQueue];
      v13 = [v11 initWithQueue:workQueue];

      v14 = [(HMDHome *)self getOrCreateUniqueIDForAccessoriesForUser:guestCopy flow:flowCopy];
      v28[0] = MEMORY[0x277D85DD0];
      v28[1] = 3221225472;
      v28[2] = __79__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuest_onAccessory_flow___block_invoke;
      v28[3] = &unk_27867C338;
      v28[4] = self;
      v29 = accessoryCopy;
      v30 = guestCopy;
      v31 = flowCopy;
      v15 = [v14 inContext:v13 then:v28 orRecover:&__block_literal_global_112_93314];

      goto LABEL_10;
    }

    v16 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      uUID = [flowCopy UUID];
      uuid = [guestCopy uuid];
      *buf = 138543874;
      v33 = v19;
      v34 = 2112;
      v35 = uUID;
      v36 = 2112;
      v37 = uuid;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Not a restricted guest %@", buf, 0x20u);

      goto LABEL_8;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      uUID2 = [flowCopy UUID];
      uuid2 = [accessoryCopy uuid];
      [accessoryCopy supportsCHIP];
      v22 = HMFBooleanToString();
      *buf = 138544130;
      v33 = v19;
      v34 = 2112;
      v35 = uUID2;
      v36 = 2112;
      v37 = uuid2;
      v38 = 2112;
      v39 = v22;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Not a matter accessory, cannot find or add user on accessory: %@, supportsCHIP: %@", buf, 0x2Au);

LABEL_8:
    }
  }

  objc_autoreleasePoolPop(v16);
  v25 = MEMORY[0x277D0F7C0];
  v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:5];
  v15 = [v25 futureWithError:v13];
LABEL_10:

  v26 = *MEMORY[0x277D85DE8];

  return v15;
}

uint64_t __79__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuest_onAccessory_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) auditOrAddRestrictedGuestUserUniqueIdentifier:v3 onAccessory:*(a1 + 40) user:*(a1 + 48) requireFullScheduleAudit:1 flow:*(a1 + 56)];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return __79__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuest_onAccessory_flow___block_invoke_2(v7);
  }
}

uint64_t __79__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuest_onAccessory_flow___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [MEMORY[0x277D0F7C0] futureWithError:v2];
  if (v3)
  {
    v4 = v3;

    return 3;
  }

  else
  {
    v6 = _HMFPreconditionFailure();
    return [(HMDHome *)v6 findOrAddUser:v7 onAccessory:v8 didRedispatch:v9 flow:v10, v11];
  }
}

- (id)findOrAddUser:(id)user onAccessory:(id)accessory didRedispatch:(BOOL)redispatch flow:(id)flow
{
  v52 = *MEMORY[0x277D85DE8];
  userCopy = user;
  accessoryCopy = accessory;
  flowCopy = flow;
  v12 = objc_autoreleasePoolPush();
  selfCopy = self;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    uUID = [flowCopy UUID];
    [userCopy uuid];
    v36 = flowCopy;
    v18 = v17 = userCopy;
    uuid = [accessoryCopy uuid];
    v20 = HMFBooleanToString();
    *buf = 138544386;
    v43 = v15;
    v44 = 2112;
    v45 = uUID;
    v46 = 2112;
    v47 = v18;
    v48 = 2112;
    v49 = uuid;
    v50 = 2112;
    v51 = v20;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] findOrAddUser: %@ onAccessory: %@, didRedispatch: %@", buf, 0x34u);

    userCopy = v17;
    flowCopy = v36;
  }

  objc_autoreleasePoolPop(v12);
  if ([accessoryCopy supportsCHIP])
  {
    v21 = objc_alloc(MEMORY[0x277D0F7A8]);
    workQueue = [(HMDHome *)selfCopy workQueue];
    v23 = [v21 initWithQueue:workQueue];

    v24 = [(HMDHome *)selfCopy getOrCreateUniqueIDForAccessoriesForUser:userCopy flow:flowCopy];
    v37[0] = MEMORY[0x277D85DD0];
    v37[1] = 3221225472;
    v37[2] = __81__HMDHome_AccessoryUserIdentifier__findOrAddUser_onAccessory_didRedispatch_flow___block_invoke;
    v37[3] = &unk_27867C338;
    v38 = userCopy;
    v39 = selfCopy;
    v40 = accessoryCopy;
    v41 = flowCopy;
    v25 = [v24 inContext:v23 then:v37 orRecover:&__block_literal_global_110_93318];
  }

  else
  {
    v26 = objc_autoreleasePoolPush();
    v27 = selfCopy;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      v29 = HMFGetLogIdentifier();
      uUID2 = [flowCopy UUID];
      uuid2 = [accessoryCopy uuid];
      [accessoryCopy supportsCHIP];
      v32 = HMFBooleanToString();
      *buf = 138544130;
      v43 = v29;
      v44 = 2112;
      v45 = uUID2;
      v46 = 2112;
      v47 = uuid2;
      v48 = 2112;
      v49 = v32;
      _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Not a matter accessory, cannot find or add user on accessory: %@, supportsCHIP: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v26);
    v33 = MEMORY[0x277D0F7C0];
    v23 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:5];
    v25 = [v33 futureWithError:v23];
  }

  v34 = *MEMORY[0x277D85DE8];

  return v25;
}

uint64_t __81__HMDHome_AccessoryUserIdentifier__findOrAddUser_onAccessory_didRedispatch_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) isRestrictedGuest];
  v5 = *(a1 + 40);
  v6 = *(a1 + 48);
  if (v4)
  {
    [v5 auditOrAddRestrictedGuestUserUniqueIdentifier:v3 onAccessory:v6 user:*(a1 + 32) requireFullScheduleAudit:0 flow:*(a1 + 56)];
  }

  else
  {
    [v5 handleFindOrAddUserUniqueIdentifier:v3 onAccessory:v6 flow:*(a1 + 56)];
  }
  v7 = ;
  if (v7)
  {
    v8 = v7;

    return 3;
  }

  else
  {
    v10 = _HMFPreconditionFailure();
    return __81__HMDHome_AccessoryUserIdentifier__findOrAddUser_onAccessory_didRedispatch_flow___block_invoke_2(v10);
  }
}

uint64_t __81__HMDHome_AccessoryUserIdentifier__findOrAddUser_onAccessory_didRedispatch_flow___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [MEMORY[0x277D0F7C0] futureWithError:v2];
  if (v3)
  {
    v4 = v3;

    return 3;
  }

  else
  {
    v6 = _HMFPreconditionFailure();
    return [(HMDHome *)v6 findOrAddUser:v7 onAccessory:v8 flow:v9, v10];
  }
}

- (id)findOrAddUserIndexForUserUUID:(id)d guestName:(id)name accessory:(id)accessory flow:(id)flow
{
  v58 = *MEMORY[0x277D85DE8];
  dCopy = d;
  nameCopy = name;
  accessoryCopy = accessory;
  flowCopy = flow;
  v14 = objc_autoreleasePoolPush();
  selfCopy = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    v17 = HMFGetLogIdentifier();
    uUID = [flowCopy UUID];
    uuid = [accessoryCopy uuid];
    *buf = 138544386;
    v49 = v17;
    v50 = 2112;
    v51 = uUID;
    v52 = 2112;
    v53 = dCopy;
    v54 = 2112;
    v55 = nameCopy;
    v56 = 2112;
    v57 = uuid;
    _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] findOrAddUserIndexForUserUUID: %@ guestName: %@, accessory: %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v14);
  if (dCopy | nameCopy)
  {
    if (dCopy)
    {
      v20 = [(HMDHome *)selfCopy userWithUUID:dCopy];
      if (!v20)
      {
        v33 = objc_autoreleasePoolPush();
        v34 = selfCopy;
        v35 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
        {
          v36 = HMFGetLogIdentifier();
          *buf = 138543618;
          v49 = v36;
          v50 = 2112;
          v51 = dCopy;
          _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Failed to findOrAddUserIndexForUserUUID because could not find user in home with UUID: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v33);
        v37 = MEMORY[0x277D2C900];
        naFuture2 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
        v23 = [v37 futureWithError:naFuture2];
        goto LABEL_15;
      }

      naFuture2 = [(HMDHome *)selfCopy findOrAddUser:v20 onAccessory:accessoryCopy flow:flowCopy];
      naFuture = [naFuture2 naFuture];
      v44[0] = MEMORY[0x277D85DD0];
      v44[1] = 3221225472;
      v44[2] = __91__HMDHome_AccessoryUserIdentifier__findOrAddUserIndexForUserUUID_guestName_accessory_flow___block_invoke;
      v44[3] = &unk_278683340;
      v44[4] = selfCopy;
      v45 = flowCopy;
      v46 = v20;
      v47 = accessoryCopy;
      v23 = [naFuture addFailureBlock:v44];

      v24 = v45;
    }

    else
    {
      labelsByAccessCode = [(HMDHome *)selfCopy labelsByAccessCode];
      v32 = [labelsByAccessCode firstKeyWithValue:nameCopy];

      v20 = [(HMDHome *)selfCopy findOrAddUserUniqueIDForGuestAccessCode:v32 onAccessory:accessoryCopy];
      naFuture2 = [v20 naFuture];
      v40[0] = MEMORY[0x277D85DD0];
      v40[1] = 3221225472;
      v40[2] = __91__HMDHome_AccessoryUserIdentifier__findOrAddUserIndexForUserUUID_guestName_accessory_flow___block_invoke_104;
      v40[3] = &unk_278683340;
      v40[4] = selfCopy;
      v41 = flowCopy;
      v42 = v32;
      v43 = accessoryCopy;
      naFuture = v32;
      v23 = [naFuture2 addFailureBlock:v40];

      v24 = v41;
    }

LABEL_15:
    goto LABEL_16;
  }

  v25 = objc_autoreleasePoolPush();
  v26 = selfCopy;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
  {
    v28 = HMFGetLogIdentifier();
    uUID2 = [flowCopy UUID];
    *buf = 138543618;
    v49 = v28;
    v50 = 2112;
    v51 = uUID2;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Both userUUID and guestName are nil, this is a bug", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v25);
  v30 = MEMORY[0x277D2C900];
  v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
  v23 = [v30 futureWithError:v20];
LABEL_16:

  v38 = *MEMORY[0x277D85DE8];

  return v23;
}

void __91__HMDHome_AccessoryUserIdentifier__findOrAddUserIndexForUserUUID_guestName_accessory_flow___block_invoke(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v9 = *(a1 + 48);
    v10 = *(a1 + 56);
    v12 = 138544130;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find or add userIndex for user: %@, on accessory: %@", &v12, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
}

void __91__HMDHome_AccessoryUserIdentifier__findOrAddUserIndexForUserUUID_guestName_accessory_flow___block_invoke_104(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v9 = *(a1 + 48);
    v10 = *(a1 + 56);
    v12 = 138544130;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find or add userIndex for guest access code: %@, on accessory: %@", &v12, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
}

- (id)findUserIndexForUserUUID:(id)d guestName:(id)name accessory:(id)accessory
{
  v37 = *MEMORY[0x277D85DE8];
  dCopy = d;
  nameCopy = name;
  accessoryCopy = accessory;
  v11 = objc_autoreleasePoolPush();
  walletLogCategory = [(HMDHome *)self walletLogCategory];
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    uuid = [accessoryCopy uuid];
    v29 = 138544130;
    v30 = v14;
    v31 = 2112;
    v32 = dCopy;
    v33 = 2112;
    v34 = nameCopy;
    v35 = 2112;
    v36 = uuid;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@findUserIndexForUserUUID: %@ guestName: %@, accessory: %@", &v29, 0x2Au);
  }

  objc_autoreleasePoolPop(v11);
  if (nameCopy)
  {
    labelsByAccessCode = [(HMDHome *)self labelsByAccessCode];
    v17 = [labelsByAccessCode firstKeyWithValue:nameCopy];

    [(HMDHome *)self userUniqueIDForGuestAccessCode:v17];
  }

  else
  {
    v17 = [(HMDHome *)self userWithUUID:dCopy];
    [v17 uniqueIDForAccessories];
  }
  v18 = ;

  if (v18)
  {
    v19 = [(HMDHome *)self findUserSlotForUserUniqueIdentifier:v18 onAccessory:accessoryCopy];
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    walletLogCategory2 = [(HMDHome *)self walletLogCategory];
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      uuid2 = [accessoryCopy uuid];
      v29 = 138544130;
      v30 = v23;
      v31 = 2112;
      v32 = dCopy;
      v33 = 2112;
      v34 = nameCopy;
      v35 = 2112;
      v36 = uuid2;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Failed to find userUniqueID for user: %@, guest: %@, accessory: %@", &v29, 0x2Au);
    }

    objc_autoreleasePoolPop(v20);
    v25 = MEMORY[0x277D2C900];
    v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v19 = [v25 futureWithError:v26];
  }

  v27 = *MEMORY[0x277D85DE8];

  return v19;
}

- (id)accessCodeForMatterUserWithUserUniqueID:(id)d
{
  v28 = *MEMORY[0x277D85DE8];
  dCopy = d;
  v5 = objc_autoreleasePoolPush();
  walletLogCategory = [(HMDHome *)self walletLogCategory];
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    uniqueIDsOfAllUsers = [(HMDHome *)self uniqueIDsOfAllUsers];
    *buf = 138543618;
    v25 = v8;
    v26 = 2112;
    v27 = uniqueIDsOfAllUsers;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@uniqueIDsOfAllUsers: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  accessCode = &stru_283CF9D50;
  if (dCopy)
  {
    users = [(HMDHome *)self users];
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __76__HMDHome_AccessoryUserIdentifier__accessCodeForMatterUserWithUserUniqueID___block_invoke;
    v22[3] = &unk_278688680;
    v12 = dCopy;
    v23 = v12;
    v13 = [users na_firstObjectPassingTest:v22];

    if (v13)
    {
      accessCode = [v13 accessCode];
    }

    else
    {
      labelsByAccessCode = [(HMDHome *)self labelsByAccessCode];
      v19[0] = MEMORY[0x277D85DD0];
      v19[1] = 3221225472;
      v19[2] = __76__HMDHome_AccessoryUserIdentifier__accessCodeForMatterUserWithUserUniqueID___block_invoke_2;
      v19[3] = &unk_278677420;
      v20 = v12;
      selfCopy = self;
      v15 = [labelsByAccessCode na_firstKeyPassingTest:v19];

      if (v15)
      {
        v16 = v15;
      }

      else
      {
        v16 = &stru_283CF9D50;
      }

      accessCode = v16;
    }
  }

  v17 = *MEMORY[0x277D85DE8];

  return accessCode;
}

uint64_t __76__HMDHome_AccessoryUserIdentifier__accessCodeForMatterUserWithUserUniqueID___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uniqueIDForAccessories];
  v4 = [v3 isEqualToNumber:*(a1 + 32)];

  return v4;
}

uint64_t __76__HMDHome_AccessoryUserIdentifier__accessCodeForMatterUserWithUserUniqueID___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) userUniqueIDForGuestAccessCode:a2];
  v4 = HMFEqualObjects();

  return v4;
}

+ (id)createUserUniqueIDForAccessoriesWithoutDuplicatingExistingIDs:(id)ds
{
  dsCopy = ds;
  v4 = 0;
  do
  {
    v5 = arc4random_uniform(0xFFFFFFFF);
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __98__HMDHome_AccessoryUserIdentifier__createUserUniqueIDForAccessoriesWithoutDuplicatingExistingIDs___block_invoke;
    v10[3] = &__block_descriptor_36_e18_B16__0__NSNumber_8l;
    v11 = v5;
    v6 = (v5 == 0) | [dsCopy na_any:v10];
    if ((v6 & 1) == 0)
    {
      break;
    }
  }

  while (v4++ < 9);
  if (v6)
  {
    v8 = 0;
  }

  else
  {
    v8 = [MEMORY[0x277CCABB0] numberWithUnsignedLong:v5];
  }

  return v8;
}

- (HMDAccessoryCount)accessoryCount
{
  v2 = [[HMDAccessoryCount alloc] initWithHome:self];

  return v2;
}

- (id)createSiriEndpointProfileMessageHandlerWithHomeUUID:(id)d
{
  dCopy = d;
  v4 = [[HMDSiriEndpointProfileMessageHandler alloc] initWithHomeUUID:dCopy];

  return v4;
}

- (id)createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:(id)submitter
{
  submitterCopy = submitter;
  v4 = [[HMDPrimaryResidentMessageRouterMetricsDispatcher alloc] initWithLogEventSubmitter:submitterCopy];

  return v4;
}

- (void)_reconfigureAccessoriesOnRouterRemovalWithCompletion:(id)completion
{
  v46 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  accessories = [(HMDHome *)self accessories];
  v7 = [accessories hmf_objectsPassingTest:&__block_literal_global_2];

  if ([v7 count])
  {
    activeNetworkRouterAccessory = [(HMDHome *)self activeNetworkRouterAccessory];
    networkRouterController = [activeNetworkRouterAccessory networkRouterController];
    wiFiSSID = [networkRouterController wiFiSSID];

    v11 = [HMDWiFiManagementController sharedPSKForNetworkWithSSID:wiFiSSID];
    v12 = v11;
    v32 = wiFiSSID;
    if (wiFiSSID && v11)
    {
      block = completionCopy;
      v31 = v11;
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543874;
        v41 = v16;
        v42 = 2048;
        v43 = [v7 count];
        v44 = 2112;
        v45 = v32;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Reconfiguring %ld accessories on '%@' due to router removal", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
      v17 = dispatch_group_create();
      v35 = 0u;
      v36 = 0u;
      v37 = 0u;
      v38 = 0u;
      v18 = v7;
      v19 = [v18 countByEnumeratingWithState:&v35 objects:v39 count:16];
      if (v19)
      {
        v20 = v19;
        v21 = *v36;
        do
        {
          for (i = 0; i != v20; ++i)
          {
            if (*v36 != v21)
            {
              objc_enumerationMutation(v18);
            }

            v23 = *(*(&v35 + 1) + 8 * i);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v24 = v23;
            }

            else
            {
              v24 = 0;
            }

            v25 = v24;

            wiFiManagementController = [v25 wiFiManagementController];

            if (wiFiManagementController)
            {
              dispatch_group_enter(v17);
              v27 = objc_alloc_init(HMDWiFiReconfigurationLogEvent);
              [(HMDWiFiReconfigurationLogEvent *)v27 setCredentialType:2];
              v33[0] = MEMORY[0x277D85DD0];
              v33[1] = 3221225472;
              v33[2] = __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke_5;
              v33[3] = &unk_27868A1D8;
              v33[4] = v23;
              v34 = v17;
              [wiFiManagementController reconfigureWithSSID:v32 PSK:v31 logEvent:v27 completion:v33];
            }
          }

          v20 = [v18 countByEnumeratingWithState:&v35 objects:v39 count:16];
        }

        while (v20);
      }

      workQueue2 = [(HMDHome *)selfCopy workQueue];
      completionCopy = block;
      dispatch_group_notify(v17, workQueue2, block);

      v12 = v31;
    }

    else
    {
      completionCopy[2](completionCopy);
    }
  }

  else
  {
    completionCopy[2](completionCopy);
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke_5(uint64_t a1, uint64_t a2)
{
  [*(a1 + 32) saveWiFiUniquePreSharedKey:0 credentialType:2 * (a2 == 0)];
  v3 = *(a1 + 40);

  dispatch_group_leave(v3);
}

uint64_t __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 wiFiCredentialType] == 3)
  {
    v3 = isReconfigurationPossible(v2);
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (NSArray)accessoriesRequiringManualReconfigurationOnRouterRemoval
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories hmf_objectsPassingTest:&__block_literal_global_115476];

  return v3;
}

uint64_t __83__HMDHome_WiFiManagement__accessoriesRequiringManualReconfigurationOnRouterRemoval__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 wiFiCredentialType] == 3)
  {
    v3 = isReconfigurationPossible(v2) ^ 1;
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)playbackArchiveWithSessionIdentifier:(id)identifier
{
  v39 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  actionSets = [(HMDHome *)self actionSets];
  triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
  v7 = [actionSets arrayByAddingObjectsFromArray:triggerOwnedActionSets];

  v35 = 0u;
  v36 = 0u;
  v33 = 0u;
  v34 = 0u;
  v8 = v7;
  v26 = [v8 countByEnumeratingWithState:&v33 objects:v38 count:16];
  if (v26)
  {
    v9 = *v34;
    v28 = v8;
    v25 = *v34;
    do
    {
      v10 = 0;
      do
      {
        if (*v34 != v9)
        {
          objc_enumerationMutation(v8);
        }

        v27 = v10;
        v11 = *(*(&v33 + 1) + 8 * v10);
        v29 = 0u;
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        actions = [v11 actions];
        v13 = [actions countByEnumeratingWithState:&v29 objects:v37 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v30;
          while (2)
          {
            for (i = 0; i != v14; ++i)
            {
              if (*v30 != v15)
              {
                objc_enumerationMutation(actions);
              }

              v17 = *(*(&v29 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v18 = v17;
              }

              else
              {
                v18 = 0;
              }

              v19 = v18;

              playbackArchive = [v19 playbackArchive];
              playbackSessionIdentifier = [playbackArchive playbackSessionIdentifier];
              v22 = [playbackSessionIdentifier isEqualToString:identifierCopy];

              if (v22)
              {

                v8 = v28;
                goto LABEL_22;
              }
            }

            v14 = [actions countByEnumeratingWithState:&v29 objects:v37 count:16];
            if (v14)
            {
              continue;
            }

            break;
          }
        }

        v10 = v27 + 1;
        v8 = v28;
        v9 = v25;
      }

      while (v27 + 1 != v26);
      playbackArchive = 0;
      v26 = [v28 countByEnumeratingWithState:&v33 objects:v38 count:16];
    }

    while (v26);
  }

  else
  {
    playbackArchive = 0;
  }

LABEL_22:

  v23 = *MEMORY[0x277D85DE8];

  return playbackArchive;
}

- (id)createAccessorySettingsMessengerWithMessageTargetUUID:(id)d messageDispatcher:(id)dispatcher messageRouter:(id)router messageHandler:(id)handler logEventSubmitter:(id)submitter
{
  v34 = *MEMORY[0x277D85DE8];
  dCopy = d;
  dispatcherCopy = dispatcher;
  routerCopy = router;
  handlerCopy = handler;
  submitterCopy = submitter;
  v17 = objc_autoreleasePoolPush();
  selfCopy = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v24 = 138544386;
    v25 = v20;
    v26 = 2112;
    v27 = dCopy;
    v28 = 2112;
    v29 = dispatcherCopy;
    v30 = 2112;
    v31 = routerCopy;
    v32 = 2112;
    v33 = handlerCopy;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Creating accessory settings messenger with message target UUID: %@ message dispatcher: %@ message router: %@ message handler: %@", &v24, 0x34u);
  }

  objc_autoreleasePoolPop(v17);
  v21 = [[HMDAccessorySettingsMessenger alloc] initWithMessageTargetUUID:dCopy messageDispatcher:dispatcherCopy messageRouter:routerCopy messageHandler:handlerCopy logEventSubmitter:submitterCopy];

  v22 = *MEMORY[0x277D85DE8];

  return v21;
}

- (void)configureAccessorySettingsMessengerWithMessengerFactory:(id)factory messageHandlerFactory:(id)handlerFactory
{
  v26 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  handlerFactoryCopy = handlerFactory;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v24 = 138543362;
    v25 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring accessory settings messenger", &v24, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  accessoryMessageRouterViaPrimary = [(HMDHome *)selfCopy accessoryMessageRouterViaPrimary];
  unifiedLanguageValueListSettingDataProvider = [(HMDHome *)selfCopy unifiedLanguageValueListSettingDataProvider];
  if (!msgDispatcher)
  {
    _HMFPreconditionFailure();
    goto LABEL_8;
  }

  if (!accessoryMessageRouterViaPrimary)
  {
LABEL_8:
    _HMFPreconditionFailure();
LABEL_9:
    _HMFPreconditionFailure();
  }

  v15 = unifiedLanguageValueListSettingDataProvider;
  if (!unifiedLanguageValueListSettingDataProvider)
  {
    goto LABEL_9;
  }

  uuid = [(HMDHome *)selfCopy uuid];
  v17 = [handlerFactoryCopy createAccessorySettingsLocalMessageHandlerWithHomeUUID:uuid languageValuesDataProvider:v15];

  [v17 setDataSource:selfCopy];
  homeManager = [(HMDHome *)selfCopy homeManager];
  compositeSettingsControllerManager = [homeManager compositeSettingsControllerManager];
  [v17 setDelegate:compositeSettingsControllerManager];

  accessorySettingsMessengerMessageTargetUUID = [(HMDHome *)selfCopy accessorySettingsMessengerMessageTargetUUID];
  logEventSubmitter = [(HMDHome *)selfCopy logEventSubmitter];
  v22 = [factoryCopy createAccessorySettingsMessengerWithMessageTargetUUID:accessorySettingsMessengerMessageTargetUUID messageDispatcher:msgDispatcher messageRouter:accessoryMessageRouterViaPrimary messageHandler:v17 logEventSubmitter:logEventSubmitter];

  [v22 registerForMessagesWithHome:selfCopy];
  [(HMDHome *)selfCopy setAccessorySettingsMessenger:v22];

  v23 = *MEMORY[0x277D85DE8];
}

- (id)accessorySettingsMessengerMessageTargetUUID
{
  v2 = MEMORY[0x277CD17B0];
  uuid = [(HMDHome *)self uuid];
  v4 = [v2 messageTargetUUIDWithHomeUUID:uuid];

  return v4;
}

- (BOOL)_deviceEligibleForDarkPoll
{
  v15 = *MEMORY[0x277D85DE8];
  featuresDataSource = [(HMDHome *)self featuresDataSource];
  isWakeOnLanV2Enabled = [featuresDataSource isWakeOnLanV2Enabled];

  if (!isWakeOnLanV2Enabled)
  {
    goto LABEL_11;
  }

  if (![(HMDHome *)self isCurrentDevicePrimaryResident])
  {
    if (![(HMDHome *)self hasAnyResident]&& [(HMDHome *)self homeLocation]== 1)
    {
      v5 = objc_autoreleasePoolPush();
      selfCopy = self;
      v7 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
      {
        goto LABEL_6;
      }

      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      v9 = "%{public}@[LPM] Device at home, and no residents in home";
      goto LABEL_5;
    }

LABEL_11:
    result = 0;
    goto LABEL_12;
  }

  v5 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    v13 = 138543362;
    v14 = v8;
    v9 = "%{public}@[LPM] Device is primary resident";
LABEL_5:
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, v9, &v13, 0xCu);
  }

LABEL_6:

  objc_autoreleasePoolPop(v5);
  result = 1;
LABEL_12:
  v12 = *MEMORY[0x277D85DE8];
  return result;
}

- (id)hubAccessories
{
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v3 = [appleMediaAccessories na_filter:&__block_literal_global_156625];

  return v3;
}

- (id)createAppleMediaAccessoriesStateMessengerWithIdentifier:(id)identifier messageDispatcher:(id)dispatcher
{
  dispatcherCopy = dispatcher;
  identifierCopy = identifier;
  v7 = [[HMDAppleMediaAccessoriesStateMessenger alloc] initWithIdentifier:identifierCopy messageDispatcher:dispatcherCopy];

  return v7;
}

- (BOOL)isCarPlayAccessAllowedForActionSet:(id)set withMessage:(id)message fromSource:(unint64_t)source
{
  v21 = *MEMORY[0x277D85DE8];
  setCopy = set;
  messageCopy = message;
  if (([(HMDHome *)self isMessageEntitledForCarPlayAccess:messageCopy source:source]& 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *v18 = 138543874;
      *&v18[4] = v15;
      *&v18[12] = 2112;
      *&v18[14] = setCopy;
      *&v18[22] = 2048;
      sourceCopy = source;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@CarPlay access is not allowed for action set: %@ because message from source: %lu does not have sufficient entitlements", v18, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
    goto LABEL_9;
  }

  if (self)
  {
    if ([(HMDHome *)self homeLocation]== 1 || [(HMDHome *)self homeLocation]== 3)
    {
      actions = [setCopy actions];
      v11 = [actions na_filter:&__block_literal_global_160225];

      *v18 = MEMORY[0x277D85DD0];
      *&v18[8] = 3221225472;
      *&v18[16] = __55__HMDHome_CarPlay__isActionSetAllowedForCarPlayAccess___block_invoke_2;
      sourceCopy = &unk_27867C048;
      selfCopy2 = self;
      LOBYTE(self) = [v11 na_all:v18];

      goto LABEL_10;
    }

LABEL_9:
    LOBYTE(self) = 0;
  }

LABEL_10:

  v16 = *MEMORY[0x277D85DE8];
  return self;
}

- (uint64_t)isMessageEntitledForCarPlayAccess:(uint64_t)access source:
{
  v5 = a2;
  v6 = v5;
  if (!self)
  {
    goto LABEL_5;
  }

  if (access != 1)
  {
    if ([v5 isEntitledForSecureAccess])
    {
      access = [v6 isEntitledForSPIAccess];
      goto LABEL_6;
    }

LABEL_5:
    access = 0;
  }

LABEL_6:

  return access;
}

uint64_t __55__HMDHome_CarPlay__isActionSetAllowedForCarPlayAccess___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = v3;
  if (v2 && ![v3 type])
  {
    v6 = v4;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = v6;
    }

    else
    {
      v7 = 0;
    }

    v8 = v7;

    if (v8)
    {
      v9 = [v8 characteristic];
      v5 = [HMDHome isCharacteristicAllowedForCarPlayAccess:v9];
    }

    else
    {
      v5 = 0;
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (uint64_t)isCharacteristicAllowedForCarPlayAccess:(void *)access
{
  service = [access service];
  serviceType = [service serviceType];

  if ([serviceType isEqualToString:*MEMORY[0x277CD0E58]])
  {
    v3 = 1;
  }

  else
  {
    v3 = [serviceType isEqualToString:*MEMORY[0x277CD0EB0]];
  }

  return v3;
}

- (BOOL)isCarPlayAccessAllowedForCharacteristic:(id)characteristic withMessage:(id)message fromSource:(unint64_t)source
{
  v23 = *MEMORY[0x277D85DE8];
  characteristicCopy = characteristic;
  messageCopy = message;
  if (([(HMDHome *)self isMessageEntitledForCarPlayAccess:messageCopy source:source]& 1) == 0)
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v17 = 138543874;
      v18 = v14;
      v19 = 2112;
      v20 = characteristicCopy;
      v21 = 2048;
      sourceCopy = source;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@CarPlay access is not allowed for characteristic: %@ because message from source: %lu does not have sufficient entitlements", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    goto LABEL_9;
  }

  if (!self || [(HMDHome *)self homeLocation]!= 1 && [(HMDHome *)self homeLocation]!= 3)
  {
LABEL_9:
    v10 = 0;
    goto LABEL_10;
  }

  v10 = [HMDHome isCharacteristicAllowedForCarPlayAccess:characteristicCopy];
LABEL_10:

  v15 = *MEMORY[0x277D85DE8];
  return v10;
}

- (BOOL)synchronouslyFetchIsConnectedToCarPlayNetwork
{
  carPlayDataSource = [(HMDHome *)self carPlayDataSource];
  synchronouslyFetchIsConnectedToCarPlayNetwork = [carPlayDataSource synchronouslyFetchIsConnectedToCarPlayNetwork];

  return synchronouslyFetchIsConnectedToCarPlayNetwork;
}

- (BOOL)synchronouslyFetchIsCarPlayConnectedStatus
{
  carPlayDataSource = [(HMDHome *)self carPlayDataSource];
  synchronouslyFetchIsCarPlayConnectedStatus = [carPlayDataSource synchronouslyFetchIsCarPlayConnectedStatus];

  return synchronouslyFetchIsCarPlayConnectedStatus;
}

- (void)_didOnboardHindsightChanged
{
  v11 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self didOnboardEventLog])
  {
    v3 = objc_autoreleasePoolPush();
    selfCopy = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v6;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Clearing notification observer because we onboarded", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    notificationCenter = [(HMDHome *)selfCopy notificationCenter];
    [notificationCenter removeObserver:selfCopy name:@"HMDHomeManagerDidUpdateApplicationData" object:0];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_fixupHindsightOnboarding
{
  v16 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self didOnboardEventLog])
  {
    v3 = objc_autoreleasePoolPush();
    selfCopy = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG))
    {
      v6 = HMFGetLogIdentifier();
      v14 = 138543362;
      v15 = v6;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEBUG, "%{public}@[Hindsight] Skipping hindsight fixup, we're already onboarded", &v14, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  else
  {
    homeManager = [(HMDHome *)self homeManager];
    if (homeManager)
    {
      notificationCenter = [(HMDHome *)self notificationCenter];
      [notificationCenter addObserver:self selector:sel__homeManagerAppDataChanged_ name:@"HMDHomeManagerDidUpdateApplicationData" object:0];

      [(HMDHome *)self _checkHomeManagerAppData:homeManager];
    }

    else
    {
      v9 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        v14 = 138543362;
        v15 = v12;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] No home manager?", &v14, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_checkHomeManagerAppData:(void *)data
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (data)
  {
    appData = [v3 appData];
    v6 = objc_opt_class();
    v7 = [appData applicationDataForIdentifier:@"com.apple.homekit-entitledclient.identifer"];
    v8 = [v6 didHomeAppOnboardHindsightWithAppData:v7];

    v9 = objc_autoreleasePoolPush();
    dataCopy = data;
    v11 = HMFGetOSLogHandle();
    v12 = v11;
    if (v8)
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        v13 = HMFGetLogIdentifier();
        v16 = 138543362;
        v17 = v13;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@[Hindsight] Home app showed Hindsight onboarded, updating didOnboard", &v16, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
      [dataCopy _setDidOnboardEventLog:1 message:0];
    }

    else
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
      {
        v14 = HMFGetLogIdentifier();
        v16 = 138543362;
        v17 = v14;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@[Hindsight] We haven't yet onboarded", &v16, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_homeManagerAppDataChanged:(id)changed
{
  changedCopy = changed;
  object = [changedCopy object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = object;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    workQueue = [(HMDHome *)self workQueue];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __49__HMDHome_Hindsight___homeManagerAppDataChanged___block_invoke;
    v10[3] = &unk_27868A750;
    v10[4] = self;
    v10[5] = v7;
    dispatch_async(workQueue, v10);
  }

  else
  {
    v9 = _HMFPreconditionFailure();
    __49__HMDHome_Hindsight___homeManagerAppDataChanged___block_invoke(v9);
  }
}

void __49__HMDHome_Hindsight___homeManagerAppDataChanged___block_invoke(uint64_t a1)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v7 = 138543362;
    v8 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@[Hindsight]Checking if new HomeManager appData onboarded Hindsight", &v7, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  [(HMDHome *)*(a1 + 32) _checkHomeManagerAppData:?];
  v6 = *MEMORY[0x277D85DE8];
}

- (void)_handleEventLogClearMessage:(id)message
{
  v20 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v19 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@[Hindsight] Clearing activity history", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v12 = MEMORY[0x277D85DD0];
  v13 = 3221225472;
  v14 = __50__HMDHome_Hindsight___handleEventLogClearMessage___block_invoke;
  v15 = &unk_27868A1D8;
  v16 = selfCopy;
  v17 = messageCopy;
  v9 = messageCopy;
  v10 = _Block_copy(&v12);
  [(HMDHome *)selfCopy _clearEventsWithCompletion:v10, v12, v13, v14, v15, v16];

  v11 = *MEMORY[0x277D85DE8];
}

void __50__HMDHome_Hindsight___handleEventLogClearMessage___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v15 = 138543874;
      v16 = v8;
      v17 = 2114;
      v18 = @"Failed to clear activity history";
      v19 = 2114;
      v20 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] %{public}@: %{public}@", &v15, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = MEMORY[0x277CCA9B8];
    v11 = [v3 localizedFailureReason];
    v12 = [v10 hmErrorWithCode:-1 description:@"Failed to clear activity history" reason:v11 suggestion:0 underlyingError:v3];
    [v9 respondWithError:v12];
  }

  else
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v13;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@[Hindsight] Activity history cleared", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 32) _broadcastClearActivityHistoryToOwnerDevices];
    [*(a1 + 32) _synchronizeHindsightCloudShareManager];
    [*(a1 + 40) respondWithSuccess];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleEventLogSetDurationMessage:(id)message
{
  v54 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  messagePayload = [messageCopy messagePayload];
  v6 = *MEMORY[0x277CCFF00];
  v7 = [messagePayload objectForKeyedSubscript:*MEMORY[0x277CCFF00]];

  if (v7)
  {
    v8 = v7;
    objc_opt_class();
    v9 = objc_opt_isKindOfClass() & 1;
    if (v9)
    {
      v10 = v8;
    }

    else
    {
      v10 = 0;
    }

    v11 = v10;

    if (v9)
    {
      unsignedIntegerValue = [v8 unsignedIntegerValue];
      if (unsignedIntegerValue == [(HMDHome *)self eventLogDuration])
      {
        v13 = objc_autoreleasePoolPush();
        selfCopy = self;
        v15 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
        {
          v16 = HMFGetLogIdentifier();
          *buf = 138543618;
          v47 = v16;
          v48 = 2048;
          v49 = unsignedIntegerValue;
          _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Activity history duration is already %lu", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v13);
        [messageCopy respondWithSuccess];
      }

      else
      {
        v28 = [HMDHomeModel alloc];
        uuid = [(HMDHome *)self uuid];
        homeManager = [(HMDHome *)self homeManager];
        uuid2 = [homeManager uuid];
        v32 = [(HMDBackingStoreModelObject *)v28 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

        v33 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:unsignedIntegerValue];
        [(HMDHomeModel *)v32 setEventLogDuration:v33];

        v34 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v36 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_DEFAULT))
        {
          v37 = HMFGetLogIdentifier();
          *buf = 138543618;
          v47 = v37;
          v48 = 2048;
          v49 = unsignedIntegerValue;
          _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_DEFAULT, "%{public}@[Hindsight] Setting activity history duration to %lu", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v34);
        backingStore = [(HMDHome *)selfCopy2 backingStore];
        name = [messageCopy name];
        v40 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v41 = [backingStore transaction:name options:v40];

        [v41 add:v32];
        v43[0] = MEMORY[0x277D85DD0];
        v43[1] = 3221225472;
        v43[2] = __56__HMDHome_Hindsight___handleEventLogSetDurationMessage___block_invoke;
        v43[3] = &unk_278682338;
        v45 = unsignedIntegerValue;
        v43[4] = selfCopy2;
        v44 = messageCopy;
        [v41 run:v43];
      }
    }

    else
    {
      v22 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        v25 = HMFGetLogIdentifier();
        name2 = [messageCopy name];
        *buf = 138544130;
        v47 = v25;
        v48 = 2114;
        v49 = name2;
        v50 = 2114;
        v51 = v6;
        v52 = 2112;
        v53 = v8;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is invalid: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v22);
      v27 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [messageCopy respondWithError:v27];
    }
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      name3 = [messageCopy name];
      *buf = 138543874;
      v47 = v20;
      v48 = 2114;
      v49 = name3;
      v50 = 2114;
      v51 = v6;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is a required parameter", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v17);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [messageCopy respondWithError:v11];
  }

  v42 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_Hindsight___handleEventLogSetDurationMessage___block_invoke(uint64_t a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = [MEMORY[0x277CCACA8] stringWithFormat:@"Failed to set activity history to %lu", *(a1 + 48)];
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543874;
      v20 = v8;
      v21 = 2114;
      v22 = v4;
      v23 = 2114;
      v24 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] %{public}@: %{public}@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v9 = *(a1 + 40);
    v10 = MEMORY[0x277CCA9B8];
    v11 = [v3 localizedFailureReason];
    v12 = [v10 hmErrorWithCode:-1 description:v4 reason:v11 suggestion:0 underlyingError:v3];
    [v9 respondWithError:v12];
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = *(a1 + 32);
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = *(a1 + 48);
      *buf = 138543618;
      v20 = v16;
      v21 = 2048;
      v22 = v17;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Finished running transaction to set activity history duration to %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    [*(a1 + 40) respondWithSuccess];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleEventLogSetEnabledMessage:(id)message
{
  v66 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  isEventLogHomeSettingEnabled = [(HMDHome *)self isEventLogHomeSettingEnabled];
  didOnboardEventLog = [(HMDHome *)self didOnboardEventLog];
  messagePayload = [messageCopy messagePayload];
  v8 = *MEMORY[0x277CCFF08];
  v9 = [messagePayload objectForKeyedSubscript:*MEMORY[0x277CCFF08]];

  if (v9)
  {
    v10 = v9;
    objc_opt_class();
    v11 = objc_opt_isKindOfClass() & 1;
    if (v11)
    {
      v12 = v10;
    }

    else
    {
      v12 = 0;
    }

    v13 = v12;

    if (v11)
    {
      bOOLValue = [v10 BOOLValue];
      v15 = bOOLValue;
      if (isEventLogHomeSettingEnabled == bOOLValue && ((bOOLValue ^ 1 | didOnboardEventLog) & 1) != 0)
      {
        v16 = objc_autoreleasePoolPush();
        selfCopy = self;
        v18 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
        {
          v19 = HMFGetLogIdentifier();
          v20 = HMFEnabledStatusToString();
          *buf = 138543618;
          v59 = v19;
          v60 = 2114;
          v61 = v20;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Activity history is already %{public}@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v16);
        [messageCopy respondWithSuccess];
      }

      else
      {
        v54 = bOOLValue ^ 1 | didOnboardEventLog;
        v32 = isEventLogHomeSettingEnabled ^ bOOLValue;
        v33 = [HMDHomeModel alloc];
        uuid = [(HMDHome *)self uuid];
        homeManager = [(HMDHome *)self homeManager];
        uuid2 = [homeManager uuid];
        v37 = [(HMDBackingStoreModelObject *)v33 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

        if (v32)
        {
          v38 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v40 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v40, OS_LOG_TYPE_DEFAULT))
          {
            v41 = HMFGetLogIdentifier();
            HMFEnabledStatusToString();
            v42 = v53 = v38;
            *buf = 138543618;
            v59 = v41;
            v60 = 2114;
            v61 = v42;
            _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_DEFAULT, "%{public}@[Hindsight] Setting activity history enabled to %{public}@", buf, 0x16u);

            v38 = v53;
          }

          objc_autoreleasePoolPop(v38);
          v43 = [MEMORY[0x277CCABB0] numberWithBool:v15];
          [(HMDHomeModel *)v37 setEventLogHomeSettingEnabled:v43];
        }

        if ((v54 & 1) == 0)
        {
          v44 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v46 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
          {
            v47 = HMFGetLogIdentifier();
            *buf = 138543362;
            v59 = v47;
            _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Finished running transaction to set activity history did onboard to YES", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v44);
          [(HMDHomeModel *)v37 setDidOnboardEventLog:MEMORY[0x277CBEC38]];
        }

        backingStore = [(HMDHome *)self backingStore];
        name = [messageCopy name];
        v50 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v51 = [backingStore transaction:name options:v50];

        [v51 add:v37];
        v55[0] = MEMORY[0x277D85DD0];
        v55[1] = 3221225472;
        v55[2] = __55__HMDHome_Hindsight___handleEventLogSetEnabledMessage___block_invoke;
        v55[3] = &unk_27867C610;
        v57 = v15;
        v55[4] = self;
        v56 = messageCopy;
        [v51 run:v55];
      }
    }

    else
    {
      v26 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        v29 = HMFGetLogIdentifier();
        name2 = [messageCopy name];
        *buf = 138544130;
        v59 = v29;
        v60 = 2114;
        v61 = name2;
        v62 = 2114;
        v63 = v8;
        v64 = 2112;
        v65 = v10;
        _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is invalid: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v26);
      v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [messageCopy respondWithError:v31];
    }
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy5 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      name3 = [messageCopy name];
      *buf = 138543874;
      v59 = v24;
      v60 = 2114;
      v61 = name3;
      v62 = 2114;
      v63 = v8;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is a required parameter", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v21);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [messageCopy respondWithError:v13];
  }

  v52 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome_Hindsight___handleEventLogSetEnabledMessage___block_invoke(uint64_t a1, void *a2)
{
  v29 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = MEMORY[0x277CCACA8];
    v5 = *(a1 + 48);
    v6 = HMFEnabledStatusToString();
    v7 = [v4 stringWithFormat:@"Failed to run transaction to set activity history to %@", v6];

    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v24 = v11;
      v25 = 2114;
      v26 = v7;
      v27 = 2114;
      v28 = v3;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] %{public}@: %{public}@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    v12 = *(a1 + 40);
    v13 = MEMORY[0x277CCA9B8];
    v14 = [v3 localizedFailureReason];
    v15 = [v13 hmErrorWithCode:-1 description:v7 reason:v14 suggestion:0 underlyingError:v3];
    [v12 respondWithError:v15];
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = *(a1 + 32);
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = *(a1 + 48);
      v21 = HMFEnabledStatusToString();
      *buf = 138543618;
      v24 = v19;
      v25 = 2114;
      v26 = v21;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Finished running transaction to set activity history to %{public}@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    [*(a1 + 40) respondWithSuccess];
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __53__HMDHome_Hindsight___setDidOnboardEventLog_message___block_invoke(uint64_t a1, void *a2)
{
  v34 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 48);
      v9 = HMFBooleanToString();
      *buf = 138544130;
      v27 = v7;
      v28 = 2114;
      v29 = @"Failed to set activity history did onboard";
      v30 = 2114;
      v31 = v9;
      v32 = 2114;
      v33 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] %{public}@ to %{public}@: %{public}@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
    v10 = *(a1 + 40);
    v11 = MEMORY[0x277CCA9B8];
    v12 = [v3 localizedFailureReason];
    v13 = [v11 hmErrorWithCode:-1 description:@"Failed to set activity history did onboard" reason:v12 suggestion:0 underlyingError:v3];
    [v10 respondWithError:v13];
  }

  else
  {
    v14 = [*(a1 + 32) isEventLogEnabled];
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 32);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = *(a1 + 48);
      v20 = HMFBooleanToString();
      v21 = HMFBooleanToString();
      *buf = 138543874;
      v27 = v18;
      v28 = 2114;
      v29 = v20;
      v30 = 2114;
      v31 = v21;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Finished running transaction to set activity history did onboard to %{public}@, isEventLogEnabled is now %{public}@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v15);
    v22 = *(a1 + 40);
    v12 = [MEMORY[0x277CCABB0] numberWithBool:{v14, *MEMORY[0x277CCFF08]}];
    v25 = v12;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v25 forKeys:&v24 count:1];
    [v22 respondWithPayload:v13];
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_handleEventLogSetDidOnboard:(id)onboard
{
  v38 = *MEMORY[0x277D85DE8];
  onboardCopy = onboard;
  messagePayload = [onboardCopy messagePayload];
  v6 = *MEMORY[0x277CCFF10];
  v7 = [messagePayload objectForKeyedSubscript:*MEMORY[0x277CCFF10]];

  if (v7)
  {
    v8 = v7;
    objc_opt_class();
    v9 = objc_opt_isKindOfClass() & 1;
    if (v9)
    {
      v10 = v8;
    }

    else
    {
      v10 = 0;
    }

    v11 = v10;

    if (v9)
    {
      bOOLValue = [v8 BOOLValue];
      if (bOOLValue & 1) != 0 || (isInternalBuild())
      {
        if (bOOLValue == [(HMDHome *)self didOnboardEventLog])
        {
          v24 = objc_autoreleasePoolPush();
          selfCopy = self;
          v26 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
          {
            v27 = HMFGetLogIdentifier();
            v28 = HMFBooleanToString();
            v30 = 138543618;
            v31 = v27;
            v32 = 2114;
            v33 = v28;
            _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Activity history onboarding is already %{public}@", &v30, 0x16u);
          }

          objc_autoreleasePoolPop(v24);
          [onboardCopy respondWithSuccess];
        }

        else
        {
          [(HMDHome *)self _setDidOnboardEventLog:bOOLValue message:onboardCopy];
        }

        goto LABEL_19;
      }

      v18 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_14;
      }
    }

    else
    {
      v18 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
LABEL_14:
        v21 = HMFGetLogIdentifier();
        name = [onboardCopy name];
        v30 = 138544130;
        v31 = v21;
        v32 = 2114;
        v33 = name;
        v34 = 2114;
        v35 = v6;
        v36 = 2112;
        v37 = v8;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is invalid: %@", &v30, 0x2Au);
      }
    }

    objc_autoreleasePoolPop(v18);
    v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [onboardCopy respondWithError:v23];

    goto LABEL_19;
  }

  v13 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
  {
    v16 = HMFGetLogIdentifier();
    name2 = [onboardCopy name];
    v30 = 138543874;
    v31 = v16;
    v32 = 2114;
    v33 = name2;
    v34 = 2114;
    v35 = v6;
    _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is a required parameter", &v30, 0x20u);
  }

  objc_autoreleasePoolPop(v13);
  v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
  [onboardCopy respondWithError:v11];
LABEL_19:

  v29 = *MEMORY[0x277D85DE8];
}

- (BOOL)isEventLogEnabled
{
  isEventLogHomeSettingEnabled = [(HMDHome *)self isEventLogHomeSettingEnabled];
  if (isEventLogHomeSettingEnabled)
  {

    LOBYTE(isEventLogHomeSettingEnabled) = [(HMDHome *)self didOnboardEventLog];
  }

  return isEventLogHomeSettingEnabled;
}

+ (BOOL)didHomeAppOnboardHindsightWithAppData:(id)data
{
  v30 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  v5 = [dataCopy objectForKeyedSubscript:@"lastOnboardingNewFeaturesVersionSeen"];
  v6 = v5;
  if (v5)
  {
    v7 = v5;
    objc_opt_class();
    v8 = objc_opt_isKindOfClass() & 1;
    if (v8)
    {
      v9 = v7;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    v14 = v13;
    if (v8)
    {
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
      {
        v15 = HMFGetLogIdentifier();
        v24 = 138543874;
        v25 = v15;
        v26 = 2112;
        v27 = @"lastOnboardingNewFeaturesVersionSeen";
        v28 = 2112;
        v29 = v7;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEBUG, "%{public}@[Hindsight] Home manager has application data '%@' = %@", &v24, 0x20u);
      }

      objc_autoreleasePoolPop(v11);
      v16 = [v7 integerValue] > 3;
    }

    else
    {
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        v24 = 138543874;
        v25 = v21;
        v26 = 2112;
        v27 = @"lastOnboardingNewFeaturesVersionSeen";
        v28 = 2112;
        v29 = dataCopy;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] Application data dictionary has invalid value for '%@': %@", &v24, 0x20u);
      }

      objc_autoreleasePoolPop(v11);
      v16 = 0;
    }
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
    {
      v20 = HMFGetLogIdentifier();
      v24 = 138543874;
      v25 = v20;
      v26 = 2112;
      v27 = @"lastOnboardingNewFeaturesVersionSeen";
      v28 = 2112;
      v29 = dataCopy;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEBUG, "%{public}@[Hindsight] Application data dictionary has no value for '%@': %@", &v24, 0x20u);
    }

    objc_autoreleasePoolPop(v17);
    v16 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];
  return v16;
}

- (NSDictionary)assistantObject
{
  v21 = *MEMORY[0x277D85DE8];
  name = [(HMDHome *)self name];

  if (name)
  {
    v16[0] = *MEMORY[0x277D48158];
    v4 = [(HMDHome *)self name:@"objectType"];
    v16[1] = v4;
    v15[2] = @"objectIdentifier";
    urlString = [(HMDHome *)self urlString];
    v16[2] = urlString;
    v15[3] = @"objectHomeIdentifier";
    urlString2 = [(HMDHome *)self urlString];
    v15[4] = @"objectReference";
    v16[3] = urlString2;
    v16[4] = self;
    v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v16 forKeys:v15 count:5];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      uuid = [(HMDHome *)self uuid];
      uUIDString = [uuid UUIDString];
      *buf = 138543618;
      v18 = v10;
      v19 = 2112;
      v20 = uUIDString;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Skipping because home.name is nil for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v7 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];

  return v7;
}

- (NSString)urlString
{
  v2 = *MEMORY[0x277CCF290];
  uuid = [(HMDHome *)self uuid];
  v4 = hm_assistantIdentifier();

  return v4;
}

- (id)multiUserSettings
{
  v47 = *MEMORY[0x277D85DE8];
  v42 = 0;
  v43 = &v42;
  v44 = 0x2020000000;
  v45 = 0;
  v38 = 0;
  v39 = &v38;
  v40 = 0x2020000000;
  v41 = 0;
  users = [(HMDHome *)self users];
  v3 = [users count];
  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = users;
  v4 = [obj countByEnumeratingWithState:&v34 objects:v46 count:16];
  v27 = v3;
  v5 = 0;
  v6 = 0;
  if (v4)
  {
    v28 = 0;
    v29 = 0;
    v7 = 0;
    v30 = 0;
    v32 = 0;
    v8 = *v35;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v10 = *(*(&v34 + 1) + 8 * i);
        if (([v10 isOwner] & 1) == 0)
        {
          sharedSettingValuesByKeyPath = [v10 sharedSettingValuesByKeyPath];
          v12 = [sharedSettingValuesByKeyPath mutableCopy];

          if ([v12 count])
          {
            v33[0] = MEMORY[0x277D85DD0];
            v33[1] = 3221225472;
            v33[2] = __54__HMDHome_MultiUserSettingsMetrics__multiUserSettings__block_invoke;
            v33[3] = &unk_27867D2E0;
            v33[4] = &v42;
            v33[5] = &v38;
            [v12 enumerateKeysAndObjectsUsingBlock:v33];
            ++v32;
          }

          else
          {
            cloudShareTrustManager = [v10 cloudShareTrustManager];
            isTrustConfigured = [cloudShareTrustManager isTrustConfigured];

            sharedUserSettingsLogEventBackingStoreControllerRunState = [v10 sharedUserSettingsLogEventBackingStoreControllerRunState];
            v16 = v28;
            v29 += isTrustConfigured ^ 1u;
            if (sharedUserSettingsLogEventBackingStoreControllerRunState == 5)
            {
              v17 = v6 + 1;
            }

            else
            {
              v17 = v6;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState == 4)
            {
              v18 = v5 + 1;
            }

            else
            {
              v18 = v5;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState == 4)
            {
              v17 = v6;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState == 3)
            {
              v18 = v5;
              v17 = v6;
              v19 = v28 + 1;
            }

            else
            {
              v19 = v28;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState == 2)
            {
              v20 = v7 + 1;
            }

            else
            {
              v20 = v7;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState < 2)
            {
              v20 = v7;
            }

            v21 = v30;
            if (sharedUserSettingsLogEventBackingStoreControllerRunState >= 2)
            {
              v22 = v30;
            }

            else
            {
              v22 = v30 + 1;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState > 2)
            {
              v5 = v18;
              v6 = v17;
              v16 = v19;
            }

            v28 = v16;
            if (sharedUserSettingsLogEventBackingStoreControllerRunState <= 2)
            {
              v7 = v20;
              v21 = v22;
            }

            v30 = v21;
          }
        }
      }

      v4 = [obj countByEnumeratingWithState:&v34 objects:v46 count:16];
    }

    while (v4);
  }

  else
  {
    v28 = 0;
    v29 = 0;
    v7 = 0;
    v30 = 0;
    v32 = 0;
  }

  v23 = objc_alloc(MEMORY[0x277CD1C20]);
  v24 = [v23 initWithNumSharedUsers:(v27 - 1) & ~((v27 - 1) >> 63) numUsersWithSettings:v32 numUsersWithIdentifyVoiceOff:v43[3] numUsersWithPlayBackInfluencesForYouOff:v39[3] numUsersCloudShareTrustNotConfigured:v29 numUsersSharedBackingStoreNotStarted:v30 numUsersSharedBackingStoreRunning:v7 numUsersSharedBackingStoreNotRunningDueToError:v28 numUsersSharedBackingStoreNotRunningDueToStopped:v5 numUsersSharedBackingStoreSharedZoneWaitingForShareInvitation:v6];

  _Block_object_dispose(&v38, 8);
  _Block_object_dispose(&v42, 8);
  v25 = *MEMORY[0x277D85DE8];

  return v24;
}

void __54__HMDHome_MultiUserSettingsMetrics__multiUserSettings__block_invoke(uint64_t a1, void *a2, void *a3)
{
  v14 = a2;
  v5 = a3;
  if ([v14 isEqualToString:@"shared.root.siri.identifyVoice"])
  {
    v6 = v5;
    objc_opt_class();
    v7 = (objc_opt_isKindOfClass() & 1) != 0 ? v6 : 0;
    v8 = v7;

    v9 = [v8 intValue];
    if (!v9)
    {
      ++*(*(*(a1 + 32) + 8) + 24);
    }
  }

  if ([v14 isEqualToString:@"shared.root.music.playbackInfluencesForYou"])
  {
    v10 = v5;
    objc_opt_class();
    v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
    v12 = v11;

    v13 = [v12 intValue];
    if (!v13)
    {
      ++*(*(*(a1 + 40) + 8) + 24);
    }
  }
}

+ (HMDHome)homeWithHomeManager:(id)manager backingStore:(id)store model:(id)model error:(id *)error
{
  v83 = *MEMORY[0x277D85DE8];
  managerCopy = manager;
  storeCopy = store;
  modelCopy = model;
  v76 = 0;
  if (error)
  {
    errorCopy = error;
  }

  else
  {
    errorCopy = &v76;
  }

  v14 = objc_alloc(MEMORY[0x277CCAD78]);
  ownerUUID = [modelCopy ownerUUID];
  v16 = v14;
  v17 = storeCopy;
  v18 = [v16 initWithUUIDString:ownerUUID];

  v19 = [v17 cdlsFetchObjectWithUUID:v18 ofModelType:objc_opt_class() error:errorCopy];
  v20 = v19;
  if (v19)
  {
    accountHandle = [v19 accountHandle];
    if (accountHandle)
    {
LABEL_6:

LABEL_16:
      v36 = [[HMDUser alloc] initWithModelObject:v20];
      if (v36)
      {
        v71 = v18;
        v37 = MEMORY[0x277CD1F00];
        presenceComputeStatus = [modelCopy presenceComputeStatus];
        v66 = [v37 authWithNumber:presenceComputeStatus];

        v65 = [HMDHome alloc];
        name = [modelCopy name];
        [modelCopy uuid];
        v41 = v40 = managerCopy;
        v42 = objc_alloc(MEMORY[0x277CCAD78]);
        [modelCopy defaultRoomUUID];
        v67 = v17;
        v43 = v68 = modelCopy;
        v44 = v20;
        v45 = [v42 initWithUUIDString:v43];
        v46 = objc_alloc_init(HMDHomeDefaultDataSource);
        v29 = [(HMDHome *)v65 initWithName:name uuid:v41 defaultRoomUUID:v45 owner:v36 homeManager:v40 presenceAuth:v66 dataSource:v46];

        v20 = v44;
        v17 = v67;
        modelCopy = v68;

        managerCopy = v40;
        owned = [v68 owned];
        -[HMDHome setOwnerUser:](v29, "setOwnerUser:", [owned BOOLValue]);

        residentSelectionVersion = [v68 residentSelectionVersion];
        [(HMDHome *)v29 setResidentSelectionVersion:residentSelectionVersion];

        [(HMDHome *)v29 setBackingStore:v67];
        [v67 setDelegate:v29];
        v49 = [[HMDHomeObjectLookup alloc] initWithHome:v29];
        [v67 setLookup:v49];

        v18 = v71;
        [v67 setHome:v29];
      }

      else
      {
        v50 = objc_autoreleasePoolPush();
        selfCopy = self;
        v52 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v54 = v53 = v18;
          *buf = 138543362;
          v78 = v54;
          _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@Unable to create owner from model.", buf, 0xCu);

          v18 = v53;
        }

        objc_autoreleasePoolPop(v50);
        v29 = 0;
      }

      goto LABEL_22;
    }

    if (![managerCopy isCloudKitRequiredForHH2])
    {
      goto LABEL_16;
    }

    v70 = v20;
    v30 = v18;
    v31 = +[HMDAppleAccountManager sharedManager];
    accountHandle = [v31 account];

    if (accountHandle)
    {
      handles = [accountHandle handles];
      firstObject = [handles firstObject];

      if (firstObject)
      {
        context = [v17 context];
        v72[0] = MEMORY[0x277D85DD0];
        v72[1] = 3221225472;
        v72[2] = __67__HMDHome_DataModel__homeWithHomeManager_backingStore_model_error___block_invoke;
        v72[3] = &unk_27868A010;
        v73 = v30;
        v74 = firstObject;
        v75 = v17;
        v35 = firstObject;
        [context performBlock:v72];

        v18 = v30;
        v20 = v70;
        [v70 setAccountHandle:v35];

        goto LABEL_6;
      }

      if (!*errorCopy)
      {
        *errorCopy = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
      }

      v61 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v63 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v63, OS_LOG_TYPE_ERROR))
      {
        v64 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v64;
        _os_log_impl(&dword_229538000, v63, OS_LOG_TYPE_ERROR, "%{public}@Unable to load home (user has no account handle and we do not appear to be logged in (no handles).", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v61);
      v29 = 0;
      v18 = v30;
    }

    else
    {
      v18 = v30;
      if (!*errorCopy)
      {
        *errorCopy = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
      }

      v57 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v59 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v59, OS_LOG_TYPE_ERROR))
      {
        v60 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v60;
        _os_log_impl(&dword_229538000, v59, OS_LOG_TYPE_ERROR, "%{public}@Unable to load home (user has no account handle and we do not appear to be logged in (no account).", buf, 0xCu);

        v18 = v30;
      }

      objc_autoreleasePoolPop(v57);
      v29 = 0;
    }

    v20 = v70;
    goto LABEL_22;
  }

  if (!*errorCopy)
  {
    *errorCopy = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
  }

  v22 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
  {
    HMFGetLogIdentifier();
    v25 = v69 = managerCopy;
    [v17 uuid];
    v27 = v26 = v18;
    v28 = *errorCopy;
    *buf = 138543874;
    v78 = v25;
    v79 = 2112;
    v80 = v27;
    v81 = 2112;
    v82 = v28;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Unable to fetch owner model from backing store %@: %@", buf, 0x20u);

    v18 = v26;
    v20 = 0;

    managerCopy = v69;
  }

  objc_autoreleasePoolPop(v22);
  v29 = 0;
LABEL_22:

  v55 = *MEMORY[0x277D85DE8];

  return v29;
}

void __67__HMDHome_DataModel__homeWithHomeManager_backingStore_model_error___block_invoke(uint64_t a1)
{
  v2 = [HMCContext findUserWithModelID:*(a1 + 32)];
  if (v2)
  {
    v4 = v2;
    [v2 setAccountHandle:*(a1 + 40)];
    v3 = [*(a1 + 48) context];
    [v3 save];

    v2 = v4;
  }
}

+ (id)createNewHomeModelsWithModelID:(id)d parentModelID:(id)iD name:(id)name acwgGroupResolvingKey:(id)key acwgIssuerPublicKeyExternalRepresentation:(id)representation userUniqueIDForAccessories:(id)accessories hasOnboardedActivityHistory:(BOOL)history ownedBy:(id)self0
{
  dCopy = d;
  iDCopy = iD;
  nameCopy = name;
  keyCopy = key;
  representationCopy = representation;
  accessoriesCopy = accessories;
  byCopy = by;
  if (!dCopy)
  {
    _HMFPreconditionFailure();
    goto LABEL_7;
  }

  if (!iDCopy)
  {
LABEL_7:
    _HMFPreconditionFailure();
    goto LABEL_8;
  }

  if (!nameCopy)
  {
LABEL_8:
    _HMFPreconditionFailure();
    goto LABEL_9;
  }

  v22 = byCopy;
  if (byCopy)
  {
    array = [MEMORY[0x277CBEB18] array];
    v24 = [(HMDBackingStoreModelObject *)[HMDHomeModel alloc] initWithUUID:dCopy parentUUID:iDCopy];
    [(HMDHomeModel *)v24 setName:nameCopy];
    [v22 pairingUsername];
    v51 = nameCopy;
    v26 = v25 = keyCopy;
    [(HMDHomeModel *)v24 setOwnerName:v26];

    uuid = [v22 uuid];
    [uuid UUIDString];
    v28 = v50 = iDCopy;
    [(HMDHomeModel *)v24 setOwnerUUID:v28];

    userID = [v22 userID];
    [(HMDHomeModel *)v24 setOwnerUserID:userID];

    publicKey = [v22 publicKey];
    [(HMDHomeModel *)v24 setOwnerPublicKey:publicKey];

    uUID = [MEMORY[0x277CCAD78] UUID];
    uUIDString = [uUID UUIDString];
    [(HMDHomeModel *)v24 setDefaultRoomUUID:uUIDString];

    [(HMDHomeModel *)v24 setMatCredGRK:v25];
    [(HMDHomeModel *)v24 setOwned:MEMORY[0x277CBEC38]];
    v33 = [MEMORY[0x277CCABB0] numberWithBool:history];
    [(HMDHomeModel *)v24 setDidOnboardEventLog:v33];

    [array addObject:v24];
    v34 = [v22 backingStoreObjects:4];
    v55[0] = MEMORY[0x277D85DD0];
    v55[1] = 3221225472;
    v55[2] = __199__HMDHome_DataModel__createNewHomeModelsWithModelID_parentModelID_name_acwgGroupResolvingKey_acwgIssuerPublicKeyExternalRepresentation_userUniqueIDForAccessories_hasOnboardedActivityHistory_ownedBy___block_invoke;
    v55[3] = &unk_27867D500;
    v35 = dCopy;
    v56 = v35;
    v57 = representationCopy;
    v58 = accessoriesCopy;
    v36 = array;
    v59 = v36;
    v37 = accessoriesCopy;
    v38 = representationCopy;
    [v34 hmf_enumerateWithAutoreleasePoolUsingBlock:v55];

    v39 = +[HMDHome getBuiltinActionSets];
    v52[0] = MEMORY[0x277D85DD0];
    v52[1] = 3221225472;
    v52[2] = __199__HMDHome_DataModel__createNewHomeModelsWithModelID_parentModelID_name_acwgGroupResolvingKey_acwgIssuerPublicKeyExternalRepresentation_userUniqueIDForAccessories_hasOnboardedActivityHistory_ownedBy___block_invoke_2;
    v52[3] = &unk_278681FB0;
    v53 = v35;
    v40 = v36;
    v54 = v40;
    v41 = v35;
    [v39 enumerateKeysAndObjectsUsingBlock:v52];

    v42 = [HMDHomeMediaSettingsModel defaultModelForHomeUUID:v41];
    [v40 addObject:v42];

    v43 = [HMDHomePersonManagerSettingsModel defaultModelForHomeUUID:v41];
    [v40 addObject:v43];

    v44 = [HMDHomeThreadNetworkModel defaultModelForHomeUUID:v41];
    [v40 addObject:v44];

    v45 = v54;
    v46 = v40;

    return v40;
  }

LABEL_9:
  v48 = _HMFPreconditionFailure();
  __199__HMDHome_DataModel__createNewHomeModelsWithModelID_parentModelID_name_acwgGroupResolvingKey_acwgIssuerPublicKeyExternalRepresentation_userUniqueIDForAccessories_hasOnboardedActivityHistory_ownedBy___block_invoke(v48, v49);
  return result;
}

void __199__HMDHome_DataModel__createNewHomeModelsWithModelID_parentModelID_name_acwgGroupResolvingKey_acwgIssuerPublicKeyExternalRepresentation_userUniqueIDForAccessories_hasOnboardedActivityHistory_ownedBy___block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v6;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = v4;
  if (v4)
  {
    [v4 setParentUUID:*(a1 + 32)];
    [v5 setMatCredIPKExternalRepresentation:*(a1 + 40)];
    [v5 setUniqueIDForAccessories:*(a1 + 48)];
  }

  [*(a1 + 56) addObject:v6];
}

void __199__HMDHome_DataModel__createNewHomeModelsWithModelID_parentModelID_name_acwgGroupResolvingKey_acwgIssuerPublicKeyExternalRepresentation_userUniqueIDForAccessories_hasOnboardedActivityHistory_ownedBy___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = MEMORY[0x277CCAD78];
  v6 = *(a1 + 32);
  v15 = a2;
  v7 = MEMORY[0x277CBEA60];
  v8 = a3;
  v9 = a2;
  v10 = [v7 arrayWithObjects:&v15 count:1];
  v11 = [v5 hm_deriveUUIDFromBaseUUID:v6 identifierSalt:0 withSalts:{v10, v15, v16}];

  v12 = [(HMDBackingStoreModelObject *)[HMDActionSetModel alloc] initWithUUID:v11 parentUUID:*(a1 + 32)];
  v13 = HMDLocalizedStringForKey(v8);

  [(HMDActionSetModel *)v12 setName:v13];
  [(HMDActionSetModel *)v12 setType:v9];
  [*(a1 + 40) addObject:v12];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_evaluateNetworkProtectionSupport
{
  selfCopy = self;
  v86 = *MEMORY[0x277D85DE8];
  v66 = 0u;
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];

  v5 = [residentDevices countByEnumeratingWithState:&v66 objects:v85 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v67;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v67 != v7)
        {
          objc_enumerationMutation(residentDevices);
        }

        v9 = *(*(&v66 + 1) + 8 * i);
        device = [v9 device];
        if ([v9 isEnabled])
        {
          capabilities = [v9 capabilities];
          supportsRouterManagement = [capabilities supportsRouterManagement];

          if (supportsRouterManagement)
          {
            minimumNetworkRouterSupportHomeKitVersion = [(HMDHome *)selfCopy minimumNetworkRouterSupportHomeKitVersion];
            if (!minimumNetworkRouterSupportHomeKitVersion)
            {
              goto LABEL_13;
            }

            v14 = minimumNetworkRouterSupportHomeKitVersion;
            version = [device version];
            [(HMDHome *)selfCopy minimumNetworkRouterSupportHomeKitVersion];
            v16 = v7;
            v17 = residentDevices;
            v19 = v18 = selfCopy;
            v64 = [version isAtLeastVersion:v19];

            selfCopy = v18;
            residentDevices = v17;
            v7 = v16;

            if (v64)
            {
LABEL_13:
              v21 = objc_autoreleasePoolPush();
              v22 = selfCopy;
              v23 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
              {
                HMFGetLogIdentifier();
                v25 = v24 = selfCopy;
                *buf = 138543618;
                v76 = v25;
                v77 = 2112;
                v78 = v9;
                _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Found resident with router management support: %@", buf, 0x16u);

                selfCopy = v24;
              }

              objc_autoreleasePoolPop(v21);
              v20 = 1;
              goto LABEL_16;
            }
          }
        }
      }

      v6 = [residentDevices countByEnumeratingWithState:&v66 objects:v85 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v20 = 0;
LABEL_16:

  activeNetworkRouterAccessory = [(HMDHome *)selfCopy activeNetworkRouterAccessory];

  _isNetworkRouterSupportEnabledForCurrentDevice = [(HMDHome *)selfCopy _isNetworkRouterSupportEnabledForCurrentDevice];
  v28 = objc_autoreleasePoolPush();
  v29 = selfCopy;
  v30 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
  {
    v31 = _isNetworkRouterSupportEnabledForCurrentDevice;
    v32 = HMFGetLogIdentifier();
    name = [(HMDHome *)v29 name];
    v34 = HMFBooleanToString();
    v35 = HMFBooleanToString();
    HMFBooleanToString();
    v36 = v65 = v28;
    *buf = 138544386;
    v76 = v32;
    v77 = 2112;
    v78 = name;
    v79 = 2112;
    v80 = v34;
    v81 = 2112;
    v82 = v35;
    v83 = 2112;
    v84 = v36;
    _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Evaluating network protection support for home %@, Router Managing Device: %@, Active Network Router Accessory: %@, Router support enabled: %@", buf, 0x34u);

    v28 = v65;
    _isNetworkRouterSupportEnabledForCurrentDevice = v31;
  }

  objc_autoreleasePoolPop(v28);
  minHomeKitVersionForAccessoryNetworkProtectionChange = [(HMDHome *)v29 minHomeKitVersionForAccessoryNetworkProtectionChange];
  if (minHomeKitVersionForAccessoryNetworkProtectionChange)
  {
    v38 = minHomeKitVersionForAccessoryNetworkProtectionChange;
    minHomeKitVersionForAccessoryNetworkProtectionChange2 = [(HMDHome *)v29 minHomeKitVersionForAccessoryNetworkProtectionChange];
    v40 = +[HMDHomeKitVersion currentVersion];
    v41 = [minHomeKitVersionForAccessoryNetworkProtectionChange2 isGreaterThanVersion:v40];

    v42 = v41 ^ 1;
  }

  else
  {
    v42 = 1;
  }

  isAdminUser = [(HMDHome *)v29 isAdminUser];
  v44 = 4;
  if (isAdminUser)
  {
    v44 = 0;
  }

  if (!activeNetworkRouterAccessory)
  {
    v44 |= 8uLL;
  }

  v45 = v44 | v20 ^ 1u;
  if (!_isNetworkRouterSupportEnabledForCurrentDevice)
  {
    v45 |= 2uLL;
  }

  if (v42)
  {
    v46 = v45;
  }

  else
  {
    v46 = v45 | 0x10;
  }

  if ([(HMDHome *)v29 networkRouterSupportDisableReason]!= v46)
  {
    [(HMDHome *)v29 setNetworkRouterSupportDisableReason:v46];
    [(HMDHome *)v29 setNetworkRouterSupport:[(HMDHome *)v29 deriveNetworkRouterSupport:v46]];
    v47 = ([(HMDHome *)v29 networkRouterSupport]>> 2) & 1;
    v48 = MEMORY[0x277D0F848];
    v49 = *MEMORY[0x277CD0470];
    messageDestination = [(HMDHome *)v29 messageDestination];
    v72 = *MEMORY[0x277CD0468];
    v51 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v46];
    v74[0] = v51;
    v73 = *MEMORY[0x277CCFE18];
    v52 = v73;
    v53 = [MEMORY[0x277CCABB0] numberWithBool:v47];
    v74[1] = v53;
    v54 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v74 forKeys:&v72 count:2];
    v55 = [v48 messageWithName:v49 destination:messageDestination payload:v54];

    [v55 setRequiresSPIEntitlement];
    msgDispatcher = [(HMDHome *)v29 msgDispatcher];
    [msgDispatcher sendMessage:v55 completionHandler:0];

    v57 = MEMORY[0x277D0F848];
    messageDestination2 = [(HMDHome *)v29 messageDestination];
    v70 = v52;
    v59 = [MEMORY[0x277CCABB0] numberWithBool:v47];
    v71 = v59;
    v60 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v71 forKeys:&v70 count:1];
    v61 = [v57 messageWithName:v49 destination:messageDestination2 payload:v60];

    [v61 setRequiresNoSPIEntitlement];
    msgDispatcher2 = [(HMDHome *)v29 msgDispatcher];
    [msgDispatcher2 sendMessage:v61 completionHandler:0];
  }

  v63 = *MEMORY[0x277D85DE8];
}

- (void)_requestRemoveClientConfigurationWithIdentifier:(id)identifier
{
  location[3] = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];
  device = [primaryResidentDevice device];

  if (device)
  {
    v8 = [HMDRemoteDeviceMessageDestination alloc];
    uuid = [(HMDHome *)self uuid];
    v10 = [(HMDRemoteDeviceMessageDestination *)v8 initWithTarget:uuid device:device];

    v11 = objc_alloc(MEMORY[0x277D0F848]);
    v26 = @"HMDH.NetworkClientIdentifierMessageKey";
    v27 = identifierCopy;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
    v13 = [v11 initWithName:@"HMDHomeRemoveClientConfigurationRequestKey" destination:v10 payload:v12];

    [v13 setSecureRemote:1];
    objc_initWeak(location, self);
    v20 = MEMORY[0x277D85DD0];
    v21 = 3221225472;
    v22 = __82__HMDHome_NetworkRouterInternal___requestRemoveClientConfigurationWithIdentifier___block_invoke;
    v23 = &unk_278687F40;
    objc_copyWeak(&v25, location);
    v24 = identifierCopy;
    [v13 setResponseHandler:&v20];
    v14 = [(HMDHome *)self msgDispatcher:v20];
    [v14 sendMessage:v13 completionHandler:0];

    objc_destroyWeak(&v25);
    objc_destroyWeak(location);
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request to remove client configuration", location, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  v19 = *MEMORY[0x277D85DE8];
}

void __82__HMDHome_NetworkRouterInternal___requestRemoveClientConfigurationWithIdentifier___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = v10;
    if (v5)
    {
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        v20 = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = v5;
        v14 = "%{public}@Request to remove client configuration %@ failed with error: %@";
        v15 = v11;
        v16 = OS_LOG_TYPE_ERROR;
        v17 = 32;
LABEL_7:
        _os_log_impl(&dword_229538000, v15, v16, v14, &v20, v17);
      }
    }

    else if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v18 = *(a1 + 32);
      v20 = 138543618;
      v21 = v12;
      v22 = 2112;
      v23 = v18;
      v14 = "%{public}@Request remove client configuration %@ successful";
      v15 = v11;
      v16 = OS_LOG_TYPE_INFO;
      v17 = 22;
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)_removeClientConfigurationWithIdentifier:(id)identifier completion:(id)completion
{
  v28 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  completionCopy = completion;
  activeNetworkRouterAccessory = [(HMDHome *)self activeNetworkRouterAccessory];
  networkRouterController = [activeNetworkRouterAccessory networkRouterController];

  if (networkRouterController)
  {
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __86__HMDHome_NetworkRouterInternal___removeClientConfigurationWithIdentifier_completion___block_invoke;
    v19[3] = &unk_278689358;
    v19[4] = self;
    v20 = identifierCopy;
    v21 = completionCopy;
    [networkRouterController removeClientConfigurationWithClientIdentifier:v20 completion:v19];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      activeNetworkRouterAccessory2 = [(HMDHome *)selfCopy activeNetworkRouterAccessory];
      uuid = [activeNetworkRouterAccessory2 uuid];
      uUIDString = [uuid UUIDString];
      *buf = 138543874;
      v23 = v13;
      v24 = 2112;
      v25 = identifierCopy;
      v26 = 2112;
      v27 = uUIDString;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove client configuration %@ due to no router controller found on the active network router %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    if (completionCopy)
    {
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (*(completionCopy + 2))(completionCopy, v17);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __86__HMDHome_NetworkRouterInternal___removeClientConfigurationWithIdentifier_completion___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 40);
      v16 = 138543874;
      v17 = v8;
      v18 = 2112;
      v19 = v9;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove client configuration %@ due to error %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = *(v10 + 16);
LABEL_10:
      v11();
    }
  }

  else
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = *(a1 + 40);
      v16 = 138543618;
      v17 = v12;
      v18 = 2112;
      v19 = v13;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Removed client configuration %@ successfully", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v14 = *(a1 + 48);
    if (v14)
    {
      v11 = *(v14 + 16);
      goto LABEL_10;
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_removeClientConfigurationWithIdentifier:(id)identifier
{
  identifierCopy = identifier;
  if ([(HMDHome *)self isOwnerUser])
  {
    [(HMDHome *)self _removeClientConfigurationWithIdentifier:identifierCopy completion:0];
  }

  else
  {
    [(HMDHome *)self _requestRemoveClientConfigurationWithIdentifier:identifierCopy];
  }
}

- (void)_requestUniquePSKClientConfigurationWithCompletion:(id)completion
{
  location[3] = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];
  device = [primaryResidentDevice device];

  if (device)
  {
    v8 = [HMDRemoteDeviceMessageDestination alloc];
    uuid = [(HMDHome *)self uuid];
    v10 = [(HMDRemoteDeviceMessageDestination *)v8 initWithTarget:uuid device:device];

    v11 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeCreateUniquePSKClientConfigurationRequestKey" destination:v10 payload:0];
    [v11 setSecureRemote:1];
    objc_initWeak(location, self);
    v18 = MEMORY[0x277D85DD0];
    v19 = 3221225472;
    v20 = __85__HMDHome_NetworkRouterInternal___requestUniquePSKClientConfigurationWithCompletion___block_invoke;
    v21 = &unk_278689728;
    objc_copyWeak(&v23, location);
    v22 = completionCopy;
    [v11 setResponseHandler:&v18];
    v12 = [(HMDHome *)self msgDispatcher:v18];
    [v12 sendMessage:v11 completionHandler:0];

    objc_destroyWeak(&v23);
    objc_destroyWeak(location);
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v16;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request unique PSK from", location, 0xCu);
    }

    objc_autoreleasePoolPop(v13);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    (*(completionCopy + 2))(completionCopy, 0, v10);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __85__HMDHome_NetworkRouterInternal___requestUniquePSKClientConfigurationWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v45 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v38 = v11;
        v39 = 2112;
        v40 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for unique PSK failed with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:@"HMDH.UniquePSKMessageKey"];
      v13 = [v6 hmf_numberForKey:@"HMDH.NetworkClientIdentifierMessageKey"];
      v14 = objc_alloc(MEMORY[0x277CCAD78]);
      v15 = [v6 hmf_stringForKey:@"HMDH.NetworkRouterUUIDMessageKey"];
      v16 = [v14 initWithUUIDString:v15];

      v17 = objc_autoreleasePoolPush();
      v18 = WeakRetained;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        HMFGetLogIdentifier();
        v33 = v17;
        v21 = v20 = v13;
        HMFBooleanToString();
        v22 = v34 = v12;
        [v16 UUIDString];
        v23 = v35 = v16;
        *buf = 138544130;
        v38 = v21;
        v39 = 2112;
        v40 = v22;
        v41 = 2112;
        v42 = v20;
        v43 = 2112;
        v44 = v23;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Request for unique PSK results successful. PSK: %@, Client Identifier: %@, Network Router UUID: %@", buf, 0x2Au);

        v16 = v35;
        v12 = v34;

        v13 = v20;
        v17 = v33;
      }

      objc_autoreleasePoolPop(v17);
      if (v12 && v13 && v16)
      {
        v24 = [[HMDAccessoryNetworkCredential alloc] initWithNetworkRouterUUID:v16 clientIdentifier:v13 wiFiPSK:v12];
        v25 = *(*(a1 + 32) + 16);
      }

      else
      {
        v26 = objc_autoreleasePoolPush();
        v27 = v18;
        v28 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v36 = v16;
          v30 = v29 = v13;
          *buf = 138543362;
          v38 = v30;
          _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_ERROR, "%{public}@Missing info in response", buf, 0xCu);

          v13 = v29;
          v16 = v36;
        }

        objc_autoreleasePoolPop(v26);
        v31 = *(a1 + 32);
        v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        v25 = *(v31 + 16);
      }

      v25();
    }
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)_createUniquePSKClientConfigurationWithRequestMessage:(id)message pairingEvent:(id)event completion:(id)completion
{
  messageCopy = message;
  eventCopy = event;
  completionCopy = completion;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __112__HMDHome_NetworkRouterInternal___createUniquePSKClientConfigurationWithRequestMessage_pairingEvent_completion___block_invoke;
  aBlock[3] = &unk_27867E540;
  objc_copyWeak(&v19, &location);
  v11 = eventCopy;
  v16 = v11;
  v12 = messageCopy;
  v17 = v12;
  v13 = completionCopy;
  v18 = v13;
  v14 = _Block_copy(aBlock);
  [(HMDHome *)self _requestUniquePSKClientConfigurationWithCompletion:v14];

  objc_destroyWeak(&v19);
  objc_destroyWeak(&location);
}

void __112__HMDHome_NetworkRouterInternal___createUniquePSKClientConfigurationWithRequestMessage_pairingEvent_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v11 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v7 = *(a1 + 48);
    if (v5)
    {
      v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:98 description:0 reason:0 suggestion:0 underlyingError:v5];
      (*(v7 + 16))(v7, v11, v8);
    }

    else
    {
      (*(v7 + 16))(v7, v11, 0);
    }
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];

    if (*(a1 + 32))
    {
      v10 = +[HMDMetricsManager sharedLogEventSubmitter];
      [v10 submitLogEvent:*(a1 + 32) error:v9];
    }

    [*(a1 + 40) respondWithError:v9];
  }
}

- (void)_evaluateNetworkProtectionAndRouterManagement
{
  v23 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self _evaluateNetworkProtectionSupport];
  activeNetworkRouterAccessory = [(HMDHome *)self activeNetworkRouterAccessory];
  networkRouterController = [activeNetworkRouterAccessory networkRouterController];

  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (networkRouterController)
  {
    if (v8)
    {
      v9 = HMFGetLogIdentifier();
      uuid = [activeNetworkRouterAccessory uuid];
      uUIDString = [uuid UUIDString];
      name = [activeNetworkRouterAccessory name];
      v17 = 138543874;
      v18 = v9;
      v19 = 2112;
      v20 = uUIDString;
      v21 = 2112;
      v22 = name;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Found active network router accessory %@/%@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy _configureNetworkRouterClientManager:activeNetworkRouterAccessory];
  }

  else
  {
    if (v8)
    {
      v13 = HMFGetLogIdentifier();
      activeNetworkRouterUUID = [(HMDHome *)selfCopy activeNetworkRouterUUID];
      name2 = [activeNetworkRouterAccessory name];
      v17 = 138543874;
      v18 = v13;
      v19 = 2112;
      v20 = activeNetworkRouterUUID;
      v21 = 2112;
      v22 = name2;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@No active network router accessory with router info %@/%@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy _unconfigureNetworkRouterClientManager];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleNetworkProtectionModeChangeForTransaction:(id)transaction
{
  transactionCopy = transaction;
  userInfo = [transactionCopy userInfo];
  [userInfo setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"NetworkProtectionModeChanged"];

  [(HMDHome *)self _scheduleApplyNetworkRouterSettingsAction:transactionCopy];
}

- (void)_evaluateNetworkRouterManagementForTransaction:(id)transaction
{
  transactionCopy = transaction;
  userInfo = [transactionCopy userInfo];
  [userInfo setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"EvaluateRouterManagement"];

  [(HMDHome *)self _scheduleApplyNetworkRouterSettingsAction:transactionCopy];
}

- (void)_scheduleApplyNetworkRouterSettingsAction:(id)action
{
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke;
  v3[3] = &unk_27867E518;
  v3[4] = self;
  [action addPostApplyActionIfNotPresent:@"HMDNetworkRouterApplySettingsAction" usingBlock:v3];
}

void __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke_2;
  v7[3] = &unk_27868A750;
  v5 = *(a1 + 32);
  v8 = v3;
  v9 = v5;
  v6 = v3;
  dispatch_async(v4, v7);
}

void __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"EvaluateRouterManagement"];

  if (v3)
  {
    [*(a1 + 40) _evaluateNetworkProtectionAndRouterManagement];
  }

  v4 = [*(a1 + 32) userInfo];
  v5 = [v4 objectForKeyedSubscript:@"NetworkProtectionModeChanged"];

  if (v5)
  {
    v6 = [MEMORY[0x277CCAB98] defaultCenter];
    [v6 postNotificationName:@"HMDHomeNetworkProtectionUpdatedNotificationKey" object:*(a1 + 40)];
  }
}

- (void)handleAccessoryDidRemoveNetworkRouterControllerNotification:(id)notification
{
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __94__HMDHome_NetworkRouterInternal__handleAccessoryDidRemoveNetworkRouterControllerNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = notificationCopy;
  selfCopy = self;
  v6 = notificationCopy;
  dispatch_async(workQueue, v7);
}

void __94__HMDHome_NetworkRouterInternal__handleAccessoryDidRemoveNetworkRouterControllerNotification___block_invoke(uint64_t a1)
{
  v17 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"HMDNetworkRouterAccessoryNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (!v5)
  {
    _HMFPreconditionFailure();
  }

  v6 = [*(a1 + 40) activeNetworkRouterAccessory];
  v7 = [v6 isEqual:v5];
  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 40);
  v10 = HMFGetOSLogHandle();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
  if (v7)
  {
    if (v11)
    {
      v12 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed network router profile for active network router accessory", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    [*(a1 + 40) _addTransactionForActiveNetworkRouterAccessory:0 isReplacement:0];
  }

  else
  {
    if (v11)
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v13;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed network router profile for non-active network router accessory", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)handleAccessoryDidAddNetworkRouterControllerNotification:(id)notification
{
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __91__HMDHome_NetworkRouterInternal__handleAccessoryDidAddNetworkRouterControllerNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = notificationCopy;
  selfCopy = self;
  v6 = notificationCopy;
  dispatch_async(workQueue, v7);
}

void __91__HMDHome_NetworkRouterInternal__handleAccessoryDidAddNetworkRouterControllerNotification___block_invoke(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"HMDNetworkRouterAccessoryNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (!v5)
  {
    _HMFPreconditionFailure();
  }

  v6 = [v5 uuid];
  v7 = [*(a1 + 40) activeNetworkRouterUUID];
  v8 = [v6 isEqual:v7];

  v9 = objc_autoreleasePoolPush();
  v10 = *(a1 + 40);
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v8)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      v14 = [v5 uuid];
      v19 = 138543618;
      v20 = v13;
      v21 = 2112;
      v22 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Added network router controller is for active network router accessory %@", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    [*(a1 + 40) _evaluateNetworkProtectionAndRouterManagement];
  }

  else
  {
    if (v12)
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v5 uuid];
      v17 = [*(a1 + 40) activeNetworkRouterUUID];
      v19 = 138543874;
      v20 = v15;
      v21 = 2112;
      v22 = v16;
      v23 = 2112;
      v24 = v17;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Ignoring added network router controller for accessory %@ since it is not for the active network router accessory %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_unconfigureNetworkRouterClientManager
{
  v12 = *MEMORY[0x277D85DE8];
  routerClientManager = [(HMDHome *)self routerClientManager];
  if (routerClientManager)
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v7;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Shutting down firewall rule manager and network router client manager", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [routerClientManager stop];
    [(HMDHome *)selfCopy setRouterClientManager:0];
    v8 = +[HMDNetworkRouterFirewallRuleManager sharedInstance];
    [v8 shutdownForClient:routerClientManager];
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_configureNetworkRouterClientManager:(id)manager
{
  v32 = *MEMORY[0x277D85DE8];
  managerCopy = manager;
  if ([(HMDHome *)self supportsRouterManagement])
  {
    routerClientManager = [(HMDHome *)self routerClientManager];

    if (routerClientManager)
    {
      routerClientManager2 = [(HMDHome *)self routerClientManager];
      [routerClientManager2 replaceActiveNetworkRouterAccessory:managerCopy];
    }

    else
    {
      v7 = objc_autoreleasePoolPush();
      selfCopy = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        name = [managerCopy name];
        uuid = [managerCopy uuid];
        uUIDString = [uuid UUIDString];
        *buf = 138543874;
        v27 = v10;
        v28 = 2112;
        v29 = name;
        v30 = 2112;
        v31 = uUIDString;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Creating network router client manager with accessory %@/%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v7);
      v14 = +[HMDNetworkRouterFirewallRuleManager sharedInstance];
      v15 = [HMDNetworkRouterClientManager alloc];
      workQueue = [(HMDHome *)selfCopy workQueue];
      defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
      v18 = [(HMDNetworkRouterClientManager *)v15 initWithNetworkRouterAccessory:managerCopy workQueue:workQueue firewallRuleManager:v14 notificationCenter:defaultCenter];
      [(HMDHome *)selfCopy setRouterClientManager:v18];

      routerClientManager3 = [(HMDHome *)selfCopy routerClientManager];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke;
      v25[3] = &unk_27868A250;
      v25[4] = selfCopy;
      [v14 startupForClient:routerClientManager3 completion:v25];

      residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
      routerClientManager4 = [(HMDHome *)selfCopy routerClientManager];
      [residentDeviceManager addDataSource:routerClientManager4];

      residentDeviceManager2 = [(HMDHome *)selfCopy residentDeviceManager];
      v24[0] = MEMORY[0x277D85DD0];
      v24[1] = 3221225472;
      v24[2] = __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke_84;
      v24[3] = &unk_27868A250;
      v24[4] = selfCopy;
      [residentDeviceManager2 confirmWithCompletionHandler:v24];
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543618;
      v11 = v7;
      v12 = 2112;
      v13 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Firewall rule manager failed to start with error %@", &v10, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  else
  {
    v8 = [*(a1 + 32) routerClientManager];
    [v8 evaluateManagement];
  }

  v9 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke_84(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543618;
    v10 = v7;
    v11 = 2112;
    v12 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Confirming primary resident with active network router in the home completed with %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveClientConfiguration:(id)configuration
{
  v16 = *MEMORY[0x277D85DE8];
  configurationCopy = configuration;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v15 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Received request to remove a client configuration", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [configurationCopy numberForKey:@"HMDH.NetworkClientIdentifierMessageKey"];
  if (v9)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __67__HMDHome_NetworkRouterInternal___handleRemoveClientConfiguration___block_invoke;
    v12[3] = &unk_27868A250;
    v13 = configurationCopy;
    [(HMDHome *)selfCopy _removeClientConfigurationWithIdentifier:v9 completion:v12];
    v10 = v13;
  }

  else
  {
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [configurationCopy respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

uint64_t __67__HMDHome_NetworkRouterInternal___handleRemoveClientConfiguration___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithPayload:0];
  }
}

- (void)_handleCreateUniquePSKClientConfiguration:(id)configuration
{
  v41 = *MEMORY[0x277D85DE8];
  configurationCopy = configuration;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    *&buf[4] = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Received request to create a unique PSK client configuration", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  activeNetworkRouterAccessory = [(HMDHome *)selfCopy activeNetworkRouterAccessory];
  v28 = MEMORY[0x277D85DD0];
  v29 = 3221225472;
  v30 = __76__HMDHome_NetworkRouterInternal___handleCreateUniquePSKClientConfiguration___block_invoke;
  v31 = &unk_27867E4F0;
  v32 = selfCopy;
  v33 = configurationCopy;
  v10 = configurationCopy;
  v11 = activeNetworkRouterAccessory;
  v12 = &v28;
  v13 = generateWiFiUniquePreSharedKey();
  v14 = [v13 dataUsingEncoding:{1, v28, v29}];

  networkRouterController = [v11 networkRouterController];
  v16 = networkRouterController;
  if (v14 && networkRouterController)
  {
    v17 = [HMDNetworkRouterClientConfiguration configurationForOpenProtectionWithClientIdentifier:0];
    v18 = objc_alloc_init(HMDNetworkRouterCredential);
    [v17 setCredential:v18];

    credential = [v17 credential];
    [credential setPsk:v14];

    *buf = MEMORY[0x277D85DD0];
    *&buf[8] = 3221225472;
    *&buf[16] = __HMDCreateUniquePSKClientConfiguration_block_invoke;
    v35 = &unk_2786862E8;
    v40 = v12;
    v20 = v16;
    v36 = v20;
    v37 = v17;
    v38 = v11;
    v39 = v14;
    v21 = v17;
    [v20 writeManagedNetworkEnable:1 completion:buf];
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      v25 = v24;
      v26 = @"no router controller found";
      if (v16)
      {
        v26 = @"PSK generation";
      }

      *buf = 138543618;
      *&buf[4] = v24;
      *&buf[12] = 2112;
      *&buf[14] = v26;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Failed to create unique PSK client configuration due to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
    v30(v12, 0, v21);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __76__HMDHome_NetworkRouterInternal___handleCreateUniquePSKClientConfiguration___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v6)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v26 = v11;
      v27 = 2112;
      v28 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to create a unique PSK client configuration with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    [*(a1 + 40) respondWithError:v6];
  }

  else
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v5 clientIdentifier];
      v14 = [v5 networkRouterUUID];
      v15 = [v14 UUIDString];
      *buf = 138543874;
      v26 = v12;
      v27 = 2112;
      v28 = v13;
      v29 = 2112;
      v30 = v15;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Created unique PSK client configuration with client identifier %@ on network router %@ for remote request", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
    v16 = *(a1 + 40);
    v17 = [v5 clientIdentifier];
    v24[0] = v17;
    v23[1] = @"HMDH.UniquePSKMessageKey";
    v18 = [v5 wiFiPSK];
    v24[1] = v18;
    v23[2] = @"HMDH.NetworkRouterUUIDMessageKey";
    v19 = [v5 networkRouterUUID];
    v20 = [v19 UUIDString];
    v24[2] = v20;
    v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v24 forKeys:v23 count:3];
    [v16 respondWithPayload:v21];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)change
{
  changeCopy = change;
  v4 = [changeCopy stringForKey:@"kHomedVersionKey"];
  if (v4)
  {
    v5 = [[HMDHomeKitVersion alloc] initWithString:v4];
    if (v5)
    {
      [(HMDHome *)self _addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:v5 message:changeCopy];
    }

    else
    {
      v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [changeCopy respondWithError:v6];
    }
  }

  else
  {
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [changeCopy respondWithError:v5];
  }
}

- (void)_handleSetMinimumNetworkRouterHomeKitVersion:(id)version
{
  v23 = *MEMORY[0x277D85DE8];
  versionCopy = version;
  v5 = [versionCopy stringForKey:@"kHomedVersionKey"];
  v6 = [[HMDHomeKitVersion alloc] initWithString:v5];
  if (v6)
  {
    v7 = +[HMDHomeKitVersion currentVersion];
    if ([v7 isGreaterThanVersion:v6])
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        versionString = [(HMDHomeKitVersion *)v6 versionString];
        [v7 versionString];
        v13 = v16 = v8;
        *buf = 138543874;
        v18 = v11;
        v19 = 2112;
        v20 = versionString;
        v21 = 2112;
        v22 = v13;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Attempting to set the network router support HomeKit version to %@ - lower than version of HomeKit on this device - %@", buf, 0x20u);

        v8 = v16;
      }

      objc_autoreleasePoolPop(v8);
    }

    [(HMDHome *)self _addTransactionForMinimumNetworkRouterHomeKitVersion:v6 message:versionCopy];
  }

  else
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [versionCopy respondWithError:v14];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateNetworkProtection:(id)protection
{
  v22 = *MEMORY[0x277D85DE8];
  protectionCopy = protection;
  v5 = [protectionCopy numberForKey:*MEMORY[0x277CD23D8]];
  if (!v5)
  {
    v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
LABEL_9:
    [protectionCopy respondWithError:v7];
    goto LABEL_10;
  }

  v15 = 0;
  v6 = [(HMDHome *)self checkForNetworkRouterSupport:1 error:&v15];
  v7 = v15;
  if (!v6)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v12 = HMDNetworkRouterSupportAsString([(HMDHome *)selfCopy networkRouterSupport]);
      *buf = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = v12;
      v20 = 2112;
      v21 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot update home network protection mode - networkRouterSupport %@ error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    goto LABEL_9;
  }

  if ([v5 integerValue] > 1)
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [protectionCopy respondWithError:v14];
  }

  else
  {
    [(HMDHome *)self _addTransactionWithProtectionMode:v5 message:protectionCopy];
  }

LABEL_10:

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:(id)change message:(id)message
{
  messageCopy = message;
  changeCopy = change;
  v8 = [HMDHomeNetworkRouterSettingsModel alloc];
  uuid = [(HMDHome *)self uuid];
  v10 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:uuid];
  uuid2 = [(HMDHome *)self uuid];
  v16 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v10 parentUUID:uuid2];

  versionString = [changeCopy versionString];

  [(HMDHomeNetworkRouterSettingsModel *)v16 setMinHomeKitVersionForAccessoryNetworkProtectionChange:versionString];
  backingStore = [(HMDHome *)self backingStore];
  v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v15 = [backingStore transaction:@"Update Minimum HomeKit Version For Accessory Network Protection Change" options:v14];

  [v15 add:v16 withMessage:messageCopy];
  [v15 run];
}

- (void)_addTransactionForMinimumNetworkRouterHomeKitVersion:(id)version message:(id)message
{
  messageCopy = message;
  versionCopy = version;
  v8 = [HMDHomeNetworkRouterSettingsModel alloc];
  uuid = [(HMDHome *)self uuid];
  v10 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:uuid];
  uuid2 = [(HMDHome *)self uuid];
  v16 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v10 parentUUID:uuid2];

  versionString = [versionCopy versionString];

  [(HMDHomeNetworkRouterSettingsModel *)v16 setMinimumNetworkRouterSupportHomeKitVersion:versionString];
  backingStore = [(HMDHome *)self backingStore];
  v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v15 = [backingStore transaction:@"Update Minimum Network Router Support HomeKit Version" options:v14];

  [v15 add:v16 withMessage:messageCopy];
  [v15 run];
}

- (void)_clearAccessoryNetworkProtectionStateWithTransaction:(id)transaction
{
  v20 = *MEMORY[0x277D85DE8];
  transactionCopy = transaction;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  accessories = [(HMDHome *)self accessories];
  v6 = [accessories countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v16;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v16 != v8)
        {
          objc_enumerationMutation(accessories);
        }

        v10 = *(*(&v15 + 1) + 8 * i);
        networkRouterUUID = [v10 networkRouterUUID];
        if (networkRouterUUID)
        {
        }

        else
        {
          networkClientIdentifier = [v10 networkClientIdentifier];

          if (!networkClientIdentifier)
          {
            continue;
          }
        }

        v13 = [v10 transactionWithObjectChangeType:2];
        [v13 setNetworkRouterUUID:0];
        [v13 setNetworkClientIdentifier:0];
        [v13 setNetworkClientProfileFingerprint:0];
        [v13 setAppliedFirewallWANRules:0];
        [v13 setNetworkClientLAN:&unk_283E73AC0];
        [v13 setCurrentNetworkProtectionMode:&unk_283E73AD8];
        [transactionCopy add:v13];
      }

      v7 = [accessories countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v7);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_updateActiveNetworkRouterAccessory:(id)accessory isReplacement:(BOOL)replacement withTransaction:(id)transaction
{
  replacementCopy = replacement;
  transactionCopy = transaction;
  accessoryCopy = accessory;
  v9 = [HMDHomeNetworkRouterSettingsModel alloc];
  uuid = [(HMDHome *)self uuid];
  v11 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:uuid];
  uuid2 = [(HMDHome *)self uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:v11 parentUUID:uuid2];

  uuid3 = [accessoryCopy uuid];

  uUIDString = [uuid3 UUIDString];

  [(HMDHomeNetworkRouterSettingsModel *)v13 setActiveNetworkRouterAccessoryUUID:uUIDString];
  if (replacementCopy)
  {
    v16 = 0;
  }

  else
  {
    v16 = uUIDString;
  }

  [(HMDHomeNetworkRouterSettingsModel *)v13 setActiveNetworkRouterInitialSetupNeededUUID:v16];
  [transactionCopy add:v13];
  if (!replacementCopy)
  {
    v17 = [HMDHomeModel alloc];
    uuid4 = [(HMDHome *)self uuid];
    homeManager = [(HMDHome *)self homeManager];
    uuid5 = [homeManager uuid];
    v21 = [(HMDBackingStoreModelObject *)v17 initWithObjectChangeType:2 uuid:uuid4 parentUUID:uuid5];

    [(HMDHomeModel *)v21 setNetworkProtectionMode:&unk_283E73AA8];
    [transactionCopy add:v21];
  }
}

- (void)_addTransactionWithProtectionMode:(id)mode message:(id)message
{
  messageCopy = message;
  modeCopy = mode;
  v8 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)self uuid];
  homeManager = [(HMDHome *)self homeManager];
  uuid2 = [homeManager uuid];
  v12 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  [(HMDHomeModel *)v12 setNetworkProtectionMode:modeCopy];
  backingStore = [(HMDHome *)self backingStore];
  name = [messageCopy name];
  v15 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v16 = [backingStore transaction:name options:v15];

  [v16 add:v12 withMessage:messageCopy];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __76__HMDHome_NetworkRouterInternal___addTransactionWithProtectionMode_message___block_invoke;
  v18[3] = &unk_27868A1D8;
  v19 = messageCopy;
  selfCopy = self;
  v17 = messageCopy;
  [v16 run:v18];
}

void __76__HMDHome_NetworkRouterInternal___addTransactionWithProtectionMode_message___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v8 = *MEMORY[0x277CD23D8];
    v5 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(*(a1 + 40), "protectionMode")}];
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [v2 respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (unint64_t)deriveNetworkRouterSupport:(unint64_t)support
{
  supportCopy = support;
  v4 = 4;
  if ((support & 8) == 0)
  {
    v4 = 15;
  }

  if (support)
  {
    v5 = v4 & 8;
    if ([(HMDHome *)self isOwnerUser])
    {
      v4 = v5;
    }

    else
    {
      v4 = 0;
    }
  }

  if ((supportCopy & 2) != 0)
  {
    v4 = 0;
  }

  if ((supportCopy & 4) != 0)
  {
    v4 &= 9u;
  }

  if ((supportCopy & 0x10) != 0)
  {
    return v4 & 0xFFFFFFFFFFFFFFFDLL;
  }

  else
  {
    return v4;
  }
}

- (BOOL)checkForNetworkRouterSupport:(unint64_t)support error:(id *)error
{
  supportCopy = support;
  networkRouterSupportDisableReason = [(HMDHome *)self networkRouterSupportDisableReason];
  if ((supportCopy & 4) != 0)
  {
    if ((networkRouterSupportDisableReason & 4) != 0)
    {
      goto LABEL_16;
    }

    if ((networkRouterSupportDisableReason & 2) != 0)
    {
      goto LABEL_22;
    }

    if (networkRouterSupportDisableReason)
    {
      goto LABEL_14;
    }
  }

  if ((supportCopy & 3) == 0)
  {
    goto LABEL_7;
  }

  if ((networkRouterSupportDisableReason & 4) == 0)
  {
    if ((networkRouterSupportDisableReason & 8) != 0 || (networkRouterSupportDisableReason & 2) != 0)
    {
      goto LABEL_22;
    }

    if (networkRouterSupportDisableReason)
    {
      goto LABEL_14;
    }

LABEL_7:
    if ((supportCopy & 2) == 0 || (networkRouterSupportDisableReason & 0x10) == 0)
    {
      if ((supportCopy & 8) == 0)
      {
        return 1;
      }

      if ((networkRouterSupportDisableReason & 8) == 0 && (networkRouterSupportDisableReason & 2) == 0)
      {
        if ((networkRouterSupportDisableReason & 1) == 0)
        {
          return 1;
        }

LABEL_14:
        if (error)
        {
          v8 = 92;
LABEL_24:
          v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:v8];
          v10 = v9;
          result = 0;
          *error = v9;
          return result;
        }

        return 0;
      }
    }

LABEL_22:
    if (error)
    {
      v8 = 48;
      goto LABEL_24;
    }

    return 0;
  }

LABEL_16:
  if (error)
  {
    v8 = 17;
    goto LABEL_24;
  }

  return 0;
}

- (HMDHAPAccessory)activeNetworkRouterAccessory
{
  activeNetworkRouterUUID = [(HMDHome *)self activeNetworkRouterUUID];
  v4 = [(HMDHome *)self accessoryWithUUID:activeNetworkRouterUUID];

  v5 = v4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  return v6;
}

- (NSArray)wiFiRouterAccessories
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] arrayWithCapacity:1];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  accessories = [(HMDHome *)self accessories];
  v5 = [accessories countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(accessories);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        networkRouterController = [v11 networkRouterController];

        if (networkRouterController)
        {
          [v3 addObject:v11];
        }
      }

      v6 = [accessories countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (BOOL)supportsRouterManagement
{
  if (![(HMDHome *)self _isNetworkRouterSupportEnabledForCurrentDevice]|| ![(HMDHome *)self isOwnerUser])
  {
    return 0;
  }

  _currentDeviceCapabilities = [(HMDHome *)self _currentDeviceCapabilities];
  supportsRouterManagement = [_currentDeviceCapabilities supportsRouterManagement];

  return supportsRouterManagement;
}

- (BOOL)_isNetworkRouterSupportEnabledForCurrentDevice
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = +[HMDHomeKitVersion currentVersion];
  minimumNetworkRouterSupportHomeKitVersion = [(HMDHome *)self minimumNetworkRouterSupportHomeKitVersion];
  if (minimumNetworkRouterSupportHomeKitVersion)
  {
    v5 = minimumNetworkRouterSupportHomeKitVersion;
    minimumNetworkRouterSupportHomeKitVersion2 = [(HMDHome *)self minimumNetworkRouterSupportHomeKitVersion];
    v7 = [minimumNetworkRouterSupportHomeKitVersion2 isGreaterThanVersion:v3];

    if (v7)
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        minimumNetworkRouterSupportHomeKitVersion3 = [(HMDHome *)selfCopy2 minimumNetworkRouterSupportHomeKitVersion];
        versionString = [minimumNetworkRouterSupportHomeKitVersion3 versionString];
        versionString2 = [v3 versionString];
        v30 = 138543874;
        v31 = v11;
        v32 = 2112;
        v33 = versionString;
        v34 = 2112;
        v35 = versionString2;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Network router support requires minimum HomeKit version of %@ - current %@; disabling", &v30, 0x20u);

LABEL_9:
        goto LABEL_10;
      }

      goto LABEL_10;
    }
  }

  activeNetworkRouterAccessory = [(HMDHome *)self activeNetworkRouterAccessory];
  primaryProfileVersion = [activeNetworkRouterAccessory primaryProfileVersion];
  if (primaryProfileVersion)
  {
    v17 = primaryProfileVersion;
    activeNetworkRouterAccessory2 = [(HMDHome *)self activeNetworkRouterAccessory];
    primaryProfileVersion2 = [activeNetworkRouterAccessory2 primaryProfileVersion];
    majorVersion = [primaryProfileVersion2 majorVersion];

    if (majorVersion >= 2)
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v21 = MEMORY[0x277CCABB0];
        activeNetworkRouterAccessory3 = [(HMDHome *)selfCopy2 activeNetworkRouterAccessory];
        primaryProfileVersion3 = [activeNetworkRouterAccessory3 primaryProfileVersion];
        v24 = [v21 numberWithUnsignedInteger:{objc_msgSend(primaryProfileVersion3, "majorVersion")}];
        v30 = 138543874;
        v31 = v11;
        v32 = 2112;
        v33 = v24;
        v34 = 2112;
        v35 = &unk_283E73A90;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Network router major version %@ not supported on this device - only supports up to major version %@; disabling", &v30, 0x20u);

        goto LABEL_9;
      }

LABEL_10:

      objc_autoreleasePoolPop(v8);
      v25 = 0;
      goto LABEL_17;
    }
  }

  else
  {
  }

  mEMORY[0x277D0F8D0] = [MEMORY[0x277D0F8D0] sharedPreferences];
  v27 = [mEMORY[0x277D0F8D0] preferenceForKey:@"enableNetworkRouterSupport"];

  v25 = !v27 || [v27 BOOLValue];
LABEL_17:

  v28 = *MEMORY[0x277D85DE8];
  return v25;
}

- (void)updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange
{
  actionSets = [(HMDHome *)self actionSets];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __103__HMDHome_HMDActionSetState__updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange__block_invoke;
  v6[3] = &unk_27867F788;
  v6[4] = self;
  v4 = [actionSets na_map:v6];

  if ([v4 count])
  {
    actionSetStateObserver = [(HMDHome *)self actionSetStateObserver];
    [actionSetStateObserver stateRegistrationsDidChangeForActionSetUUIDs:v4];
  }
}

id __103__HMDHome_HMDActionSetState__updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) actionSetStateSubscriptionManager];
  v5 = [v3 uuid];
  v6 = [v4 isMonitoringActionSet:v5];

  if (v6)
  {
    v7 = [v3 uuid];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (void)stateObserverStoppedMonitoringCharacteristics:(id)characteristics
{
  v39 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v5 = characteristicsCopy;
  v6 = [v5 countByEnumeratingWithState:&v33 objects:v38 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v34;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v34 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v33 + 1) + 8 * i);
        accessory = [v10 accessory];
        v12 = accessory;
        if (accessory)
        {
          uuid = [accessory uuid];
          v14 = [dictionary objectForKeyedSubscript:uuid];

          if (!v14)
          {
            v15 = [MEMORY[0x277CBEB58] set];
            uuid2 = [v12 uuid];
            [dictionary setObject:v15 forKeyedSubscript:uuid2];
          }

          uuid3 = [v12 uuid];
          v18 = [dictionary objectForKeyedSubscript:uuid3];
          [v18 addObject:v10];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v33 objects:v38 count:16];
    }

    while (v7);
  }

  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  v19 = dictionary;
  v20 = [v19 countByEnumeratingWithState:&v29 objects:v37 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v30;
    do
    {
      for (j = 0; j != v21; ++j)
      {
        if (*v30 != v22)
        {
          objc_enumerationMutation(v19);
        }

        v24 = [v19 objectForKeyedSubscript:{*(*(&v29 + 1) + 8 * j), v29}];
        anyObject = [v24 anyObject];
        accessory2 = [anyObject accessory];

        if (accessory2)
        {
          allObjects = [v24 allObjects];
          [accessory2 setNotificationsEnabled:0 forCharacteristics:allObjects clientIdentifier:@"com.apple.HomeKitDaemon.ActionSetStateObserver"];
        }
      }

      v21 = [v19 countByEnumeratingWithState:&v29 objects:v37 count:16];
    }

    while (v21);
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)stateObserverStartedMonitoringCharacteristics:(id)characteristics completionHandler:(id)handler
{
  selfCopy = self;
  v61 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  handlerCopy = handler;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  array = [MEMORY[0x277CBEB18] array];
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  obj = characteristicsCopy;
  v8 = [obj countByEnumeratingWithState:&v51 objects:v60 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v52;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v52 != v10)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v51 + 1) + 8 * i);
        accessory = [v12 accessory];
        v14 = accessory;
        if (accessory)
        {
          uuid = [accessory uuid];
          v16 = [dictionary objectForKeyedSubscript:uuid];

          if (!v16)
          {
            v17 = [MEMORY[0x277CBEB58] set];
            uuid2 = [v14 uuid];
            [dictionary setObject:v17 forKeyedSubscript:uuid2];
          }

          uuid3 = [v14 uuid];
          v20 = [dictionary objectForKeyedSubscript:uuid3];
          [v20 addObject:v12];

          v21 = [HMDCharacteristicRequest requestWithCharacteristic:v12];
          [array addObject:v21];
        }
      }

      v9 = [obj countByEnumeratingWithState:&v51 objects:v60 count:16];
    }

    while (v9);
  }

  v49 = 0u;
  v50 = 0u;
  v47 = 0u;
  v48 = 0u;
  v22 = dictionary;
  v23 = [v22 countByEnumeratingWithState:&v47 objects:v59 count:16];
  if (v23)
  {
    v24 = v23;
    v25 = *v48;
    do
    {
      for (j = 0; j != v24; ++j)
      {
        if (*v48 != v25)
        {
          objc_enumerationMutation(v22);
        }

        v27 = [v22 objectForKeyedSubscript:{*(*(&v47 + 1) + 8 * j), selfCopy}];
        anyObject = [v27 anyObject];
        accessory2 = [anyObject accessory];

        if (accessory2)
        {
          allObjects = [v27 allObjects];
          [accessory2 setNotificationsEnabled:1 forCharacteristics:allObjects clientIdentifier:@"com.apple.HomeKitDaemon.ActionSetStateObserver"];
        }
      }

      v24 = [v22 countByEnumeratingWithState:&v47 objects:v59 count:16];
    }

    while (v24);
  }

  v31 = objc_autoreleasePoolPush();
  v32 = selfCopy;
  v33 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
  {
    v34 = HMFGetLogIdentifier();
    v35 = [array count];
    *buf = 138543618;
    v56 = v34;
    v57 = 2048;
    v58 = v35;
    _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Issuing %ld read requests for ActionSetStateObserver", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v31);
  v36 = [array copy];
  v43[0] = MEMORY[0x277D85DD0];
  v43[1] = 3221225472;
  v43[2] = __94__HMDHome_HMDActionSetState__stateObserverStartedMonitoringCharacteristics_completionHandler___block_invoke;
  v43[3] = &unk_2786862C0;
  v44 = array;
  v45 = v32;
  v46 = handlerCopy;
  v37 = handlerCopy;
  v38 = array;
  [(HMDHome *)v32 readCharacteristicValues:v36 source:1060 qualityOfService:-1 withCompletionHandler:v43];

  v39 = *MEMORY[0x277D85DE8];
}

void __94__HMDHome_HMDActionSetState__stateObserverStartedMonitoringCharacteristics_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v41 = *MEMORY[0x277D85DE8];
  v24 = a2;
  v28 = a3;
  v26 = [MEMORY[0x277CBEB18] array];
  v27 = a1;
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  obj = *(a1 + 32);
  v5 = [obj countByEnumeratingWithState:&v30 objects:v40 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v31;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v31 != v7)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v30 + 1) + 8 * i);
        v10 = [v9 characteristic];
        v29 = 0;
        v11 = [v28 hmd_valueOfCharacteristic:v10 error:&v29];
        v12 = v29;

        v13 = objc_autoreleasePoolPush();
        v14 = *(v27 + 40);
        v15 = HMFGetOSLogHandle();
        v16 = v15;
        if (v11)
        {
          if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
          {
            v17 = HMFGetLogIdentifier();
            *buf = 138543874;
            v35 = v17;
            v36 = 2112;
            v37 = v9;
            v38 = 2112;
            v39 = v11;
            _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Characteristic read request succeeded when ActionSetStateObserver enabled notifications %@:%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v13);
          v18 = [HMDCharacteristicResponse responseWithRequest:v9 error:0];
          [v18 setValue:v11];
        }

        else
        {
          if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
          {
            v19 = HMFGetLogIdentifier();
            *buf = 138543874;
            v35 = v19;
            v36 = 2112;
            v37 = v9;
            v38 = 2112;
            v39 = v12;
            _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Characteristic read request when ActionSetStateObserver enabled notification failed %@:%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v13);
          if (v24)
          {
            v18 = [HMDCharacteristicResponse responseWithRequest:v9 error:?];
          }

          else
          {
            v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:74];
            v18 = [HMDCharacteristicResponse responseWithRequest:v9 error:v20];
          }
        }

        [v26 addObject:v18];
      }

      v6 = [obj countByEnumeratingWithState:&v30 objects:v40 count:16];
    }

    while (v6);
  }

  v21 = *(v27 + 48);
  v22 = [v26 copy];
  (*(v21 + 16))(v21, v22);

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_notifyChangedActionSetResponses:(id)responses notificationUpdateIdentifier:(id)identifier toUserDeviceAddress:(id)address
{
  v32 = *MEMORY[0x277D85DE8];
  responsesCopy = responses;
  identifierCopy = identifier;
  addressCopy = address;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if (addressCopy)
  {
    notificationHandlerMap = [(HMDHome *)self notificationHandlerMap];
    v13 = [notificationHandlerMap objectForKey:addressCopy];

    if (!v13)
    {
      homeManager = [(HMDHome *)self homeManager];
      v27 = 0u;
      v28 = 0u;
      v29 = 0u;
      v30 = 0u;
      watchManager = [homeManager watchManager];
      connectedWatches = [watchManager connectedWatches];

      v17 = [connectedWatches countByEnumeratingWithState:&v27 objects:v31 count:16];
      if (v17)
      {
        v26 = homeManager;
        v18 = *v28;
        while (2)
        {
          for (i = 0; i != v17; ++i)
          {
            if (*v28 != v18)
            {
              objc_enumerationMutation(connectedWatches);
            }

            remoteDestinationString = [*(*(&v27 + 1) + 8 * i) remoteDestinationString];
            v21 = [remoteDestinationString isEqual:addressCopy];

            if (v21)
            {
              v17 = 1;
              goto LABEL_13;
            }
          }

          v17 = [connectedWatches countByEnumeratingWithState:&v27 objects:v31 count:16];
          if (v17)
          {
            continue;
          }

          break;
        }

LABEL_13:
        homeManager = v26;
      }

      v22 = [HMDDeviceNotificationHandler alloc];
      msgDispatcher = [(HMDHome *)self msgDispatcher];
      v13 = [(HMDDeviceNotificationHandler *)v22 initWithDestination:addressCopy watchDevice:v17 withRequestIdentifier:0 messageDispatcher:msgDispatcher home:self];

      notificationHandlerMap2 = [(HMDHome *)self notificationHandlerMap];
      [notificationHandlerMap2 setObject:v13 forKey:addressCopy];
    }

    [(HMDDeviceNotificationHandler *)v13 sendNotificationForActionSetResponses:responsesCopy notificationUpdateIdentifier:identifierCopy];
  }

  v25 = *MEMORY[0x277D85DE8];
}

- (void)_notifyRemoteUsersOfChangedActionSetResponses:(id)responses
{
  v48 = *MEMORY[0x277D85DE8];
  responsesCopy = responses;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  v33 = selfCopy;
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v42 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Notifying users registered with resident of changes in action sets", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  notificationRegistry = [(HMDHome *)selfCopy notificationRegistry];
  v11 = [notificationRegistry destinationsRegisteredForNotificationsForActionSetResponses:responsesCopy];

  v12 = [MEMORY[0x277CBEB58] set];
  uUID = [MEMORY[0x277CCAD78] UUID];
  uUIDString = [uUID UUIDString];

  v39 = 0u;
  v40 = 0u;
  v37 = 0u;
  v38 = 0u;
  v14 = v11;
  v15 = selfCopy;
  obj = v14;
  v16 = [v14 countByEnumeratingWithState:&v37 objects:v47 count:16];
  if (v16)
  {
    v18 = v16;
    v19 = *v38;
    *&v17 = 138543874;
    v30 = v17;
    v31 = responsesCopy;
    v32 = v12;
    v35 = *v38;
    do
    {
      for (i = 0; i != v18; ++i)
      {
        if (*v38 != v19)
        {
          objc_enumerationMutation(obj);
        }

        v21 = *(*(&v37 + 1) + 8 * i);
        v22 = [HMDDevice deviceWithDestination:v21, v30];
        if (v22)
        {
          [v12 addObject:v22];
          if ([(HMDHome *)v15 _shouldSendToDestination:v21 device:v22 remoteSourceDevice:0])
          {
            notificationRegistry2 = [(HMDHome *)v15 notificationRegistry];
            v24 = [notificationRegistry2 filterActionSetResponses:responsesCopy deviceIdsDestination:v21];

            if ([v24 count])
            {
              v25 = objc_autoreleasePoolPush();
              v26 = v15;
              v27 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
              {
                v28 = HMFGetLogIdentifier();
                *buf = v30;
                v42 = v28;
                v43 = 2112;
                v44 = v21;
                v45 = 2112;
                v46 = uUIDString;
                _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Fanning out to device %@ with the action sets that changed with notificationUpdateIdentifier: %@", buf, 0x20u);

                responsesCopy = v31;
              }

              objc_autoreleasePoolPop(v25);
              [(HMDHome *)v26 _notifyChangedActionSetResponses:v24 notificationUpdateIdentifier:uUIDString toUserDeviceAddress:v21];
              v12 = v32;
              v15 = v33;
            }

            v19 = v35;
          }
        }
      }

      v18 = [obj countByEnumeratingWithState:&v37 objects:v47 count:16];
    }

    while (v18);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)notifyRemoteUsersOfChangedActionSetResponses:(id)responses
{
  responsesCopy = responses;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __75__HMDHome_HMDActionSetState__notifyRemoteUsersOfChangedActionSetResponses___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = responsesCopy;
  v6 = responsesCopy;
  dispatch_async(workQueue, v7);
}

- (void)_remotelySetNotificationsEnabled:(BOOL)enabled forActionSetUUIDs:(id)ds
{
  v42 = *MEMORY[0x277D85DE8];
  dsCopy = ds;
  selfCopy = self;
  primaryResident = [(HMDHome *)self primaryResident];
  capabilities = [primaryResident capabilities];
  supportsResidentActionSetStateEvaluation = [capabilities supportsResidentActionSetStateEvaluation];

  if (supportsResidentActionSetStateEvaluation)
  {
    workQueue = [(HMDHome *)selfCopy workQueue];
    dispatch_assert_queue_V2(workQueue);

    if (enabled)
    {
      actionSetsEnableNotificationPayload = [(HMDHome *)selfCopy actionSetsEnableNotificationPayload];
      [(HMDHome *)selfCopy actionSetsDisableNotificationPayload];
    }

    else
    {
      actionSetsEnableNotificationPayload = [(HMDHome *)selfCopy actionSetsDisableNotificationPayload];
      [(HMDHome *)selfCopy actionSetsEnableNotificationPayload];
    }
    v12 = ;
    v33 = 0u;
    v34 = 0u;
    v31 = 0u;
    v32 = 0u;
    v27 = dsCopy;
    v13 = dsCopy;
    v14 = [v13 countByEnumeratingWithState:&v31 objects:v41 count:16];
    if (v14)
    {
      v15 = v14;
      v16 = *v32;
      v28 = actionSetsEnableNotificationPayload;
      v29 = v12;
      do
      {
        for (i = 0; i != v15; ++i)
        {
          if (*v32 != v16)
          {
            objc_enumerationMutation(v13);
          }

          uUIDString = [*(*(&v31 + 1) + 8 * i) UUIDString];
          if (([actionSetsEnableNotificationPayload containsObject:uUIDString] & 1) == 0)
          {
            [actionSetsEnableNotificationPayload addObject:uUIDString];
          }

          if ([v12 containsObject:uUIDString])
          {
            [v12 removeObject:uUIDString];
            v19 = objc_autoreleasePoolPush();
            v20 = selfCopy;
            v21 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
            {
              v22 = HMFGetLogIdentifier();
              HMFBooleanToString();
              v23 = v16;
              v25 = v24 = v13;
              *buf = 138543874;
              v36 = v22;
              v37 = 2112;
              v38 = v25;
              v39 = 2112;
              v40 = uUIDString;
              _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Function call to set notification to %@, removing the entry %@ from the other action set payload", buf, 0x20u);

              v13 = v24;
              v16 = v23;

              actionSetsEnableNotificationPayload = v28;
              v12 = v29;
            }

            objc_autoreleasePoolPop(v19);
          }
        }

        v15 = [v13 countByEnumeratingWithState:&v31 objects:v41 count:16];
      }

      while (v15);
    }

    if ([actionSetsEnableNotificationPayload count] || objc_msgSend(v12, "count"))
    {
      [(HMDHome *)selfCopy _createModifyNotificationsCoalesceTimerIfNeeded];
    }

    dsCopy = v27;
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)remotelySetNotificationsEnabled:(BOOL)enabled forActionSetUUIDs:(id)ds
{
  dsCopy = ds;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __80__HMDHome_HMDActionSetState__remotelySetNotificationsEnabled_forActionSetUUIDs___block_invoke;
  block[3] = &unk_278688BD0;
  enabledCopy = enabled;
  block[4] = self;
  v10 = dsCopy;
  v8 = dsCopy;
  dispatch_sync(workQueue, block);
}

- (id)createMultiuserSettingsMessenger:(id)messenger messageDispatcher:(id)dispatcher
{
  v22 = *MEMORY[0x277D85DE8];
  messengerCopy = messenger;
  dispatcherCopy = dispatcher;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    uuid = [messengerCopy uuid];
    v16 = 138543874;
    v17 = v11;
    v18 = 2112;
    v19 = uuid;
    v20 = 2112;
    v21 = dispatcherCopy;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Creating Multiuser settings messenger with current home UUID: %@ message dispatcher: %@", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  v13 = [[HMDMultiuserSettingsMessenger alloc] initWithHome:messengerCopy messageDispatcher:dispatcherCopy];

  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (void)configureMultiuserSettingsMessengerWithMessengerFactory:(id)factory
{
  v18 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    home = [(HMDHome *)selfCopy home];
    v14 = 138543618;
    v15 = v8;
    v16 = 2112;
    v17 = home;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Configuring Multiuser settings messenger %@", &v14, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  home2 = [(HMDHome *)selfCopy home];
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  v12 = [factoryCopy createMultiuserSettingsMessenger:home2 messageDispatcher:msgDispatcher];

  [v12 registerForMessages];
  [(HMDHome *)selfCopy setMultiuserSettingsMessenger:v12];

  v13 = *MEMORY[0x277D85DE8];
}

- (BOOL)_processTestModeSkipHH2MigrationOverride:(id)override error:(id *)error
{
  v17 = *MEMORY[0x277D85DE8];
  overrideCopy = override;
  v6 = [overrideCopy hmf_BOOLForKey:@"kConfigTestingSkipMigrationCheckOverrideKey"];
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v13 = 138543618;
    v14 = v10;
    v15 = 1024;
    v16 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Setting for HH2 skip migration check override to %{BOOL}d", &v13, 0x12u);
  }

  objc_autoreleasePoolPop(v7);
  [(HMDHome *)selfCopy setOverrideSentinelZoneForConvergencePeriod:v6];

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)isThisHomeMigratedToHH2
{
  v44 = *MEMORY[0x277D85DE8];
  homeManager = [(HMDHome *)self homeManager];
  v4 = homeManager;
  if (homeManager)
  {
    hh2FrameworkSwitch = [homeManager hh2FrameworkSwitch];

    if (hh2FrameworkSwitch)
    {
      owner = [(HMDHome *)self owner];
      isCurrentUser = [owner isCurrentUser];

      hh2FrameworkSwitch2 = [v4 hh2FrameworkSwitch];
      checkExistenceOfHH2SentinelZone = [hh2FrameworkSwitch2 checkExistenceOfHH2SentinelZone];

      v10 = objc_autoreleasePoolPush();
      selfCopy = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
      {
        v13 = HMFGetLogIdentifier();
        v14 = HMFBooleanToString();
        HMFBooleanToString();
        v15 = v33 = isCurrentUser;
        [(HMDHome *)selfCopy isUpdatedToHH2];
        v16 = HMFBooleanToString();
        v17 = HMFBooleanToString();
        *buf = 138544386;
        v35 = v13;
        v36 = 2112;
        v37 = v14;
        v38 = 2112;
        v39 = v15;
        v40 = 2112;
        v41 = v16;
        v42 = 2112;
        v43 = v17;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@[HH2 Sentinel zone exist : %@], [isOwner: %@], [Is Shared Home Updated to HH2: %@], [Running in HH2 daemon: %@]", buf, 0x34u);

        isCurrentUser = v33;
      }

      objc_autoreleasePoolPop(v10);
      if ((checkExistenceOfHH2SentinelZone & 1) == 0)
      {
        isCloudKitRequiredForHH2 = [v4 isCloudKitRequiredForHH2];
        v19 = objc_autoreleasePoolPush();
        v20 = selfCopy;
        v21 = HMFGetOSLogHandle();
        v22 = os_log_type_enabled(v21, OS_LOG_TYPE_INFO);
        if (isCloudKitRequiredForHH2)
        {
          if (v22)
          {
            v23 = HMFGetLogIdentifier();
            [(HMDHome *)v20 overrideSentinelZoneForConvergencePeriod];
            v24 = HMFBooleanToString();
            *buf = 138543618;
            v35 = v23;
            v36 = 2112;
            v37 = v24;
            _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@This is an invalid configuration but allowed during development & convergence period. If that is the case please ignore this message. [Override = %@]", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v19);
          overrideSentinelZoneForConvergencePeriod = [(HMDHome *)v20 overrideSentinelZoneForConvergencePeriod];
          if (!(isCurrentUser & 1 | ((overrideSentinelZoneForConvergencePeriod & 1) == 0)))
          {
            overrideSentinelZoneForConvergencePeriod = [(HMDHome *)v20 isUpdatedToHH2];
          }

          goto LABEL_18;
        }

        if (v22)
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543362;
          v35 = v30;
          _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@CloudKit is not required in this configuration, pretending that the sentinel zone exists", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v19);
      }

      overrideSentinelZoneForConvergencePeriod = 1;
      goto LABEL_18;
    }
  }

  v26 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v28 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT))
  {
    v29 = HMFGetLogIdentifier();
    *buf = 138543362;
    v35 = v29;
    _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to find a valid instance of homeManager or this OS is not capable of running ROAR. Marking this home as not migrated to ROAR", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v26);
  overrideSentinelZoneForConvergencePeriod = 0;
LABEL_18:

  v31 = *MEMORY[0x277D85DE8];
  return overrideSentinelZoneForConvergencePeriod;
}

- (unint64_t)accessNotAllowedReasonCode
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
  {
    v6 = HMFGetLogIdentifier();
    v9 = 138543618;
    v10 = v6;
    v11 = 2048;
    v12 = 1;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Home access is not allowed with reason code : %lu", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  v7 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)_isAccessToHomeAllowed
{
  isThisHomeMigratedToHH2 = [(HMDHome *)self isThisHomeMigratedToHH2];
  if (!isThisHomeMigratedToHH2)
  {
    homeManager = [(HMDHome *)self homeManager];
    [homeManager isHH1EOLEnabled];
  }

  return isThisHomeMigratedToHH2;
}

- (void)storeMigrationCharacteristicsAuthorizationData
{
  v45 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  currentUser = [(HMDHome *)self currentUser];
  isOwner = [currentUser isOwner];

  if (isOwner)
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      name = [(HMDHome *)selfCopy name];
      *buf = 138543618;
      v40 = v9;
      v41 = 2112;
      v42 = name;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Skipping characteristic authorization archiving for home: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  else
  {
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    hapAccessories = [(HMDHome *)self hapAccessories];
    v37[0] = MEMORY[0x277D85DD0];
    v37[1] = 3221225472;
    v37[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke;
    v37[3] = &unk_278682958;
    v13 = dictionary;
    v38 = v13;
    [hapAccessories na_each:v37];

    v14 = [v13 count];
    v15 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v17 = HMFGetOSLogHandle();
    v18 = v17;
    if (v14)
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        name2 = [(HMDHome *)selfCopy2 name];
        *buf = 138543874;
        v40 = v19;
        v41 = 2112;
        v42 = name2;
        v43 = 2112;
        v44 = v13;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Archiving characteristic authorization data for migration for home: %@, [%@]", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
      v21 = [objc_alloc(MEMORY[0x277CCAAB0]) initRequiringSecureCoding:1];
      [v21 encodeObject:v13 forKey:*MEMORY[0x277CCA308]];
      [v21 finishEncoding];
      encodedData = [v21 encodedData];
      if (encodedData)
      {
        uuid = [(HMDHome *)selfCopy2 uuid];
        v24 = getAccessoryAuthorizationsSettingsSerializedFilePath(uuid);

        v25 = [HMDPersistentStore writeData:encodedData toStorePath:v24 dataLabel:@"CharacteristicAuthorizationData"];
        v26 = objc_autoreleasePoolPush();
        v27 = selfCopy2;
        v28 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_DEBUG))
        {
          v29 = HMFGetLogIdentifier();
          *buf = 138543874;
          v40 = v29;
          v41 = 2112;
          v42 = v25;
          v43 = 2112;
          v44 = v24;
          _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_DEBUG, "%{public}@Stored characteristic authorization data ([%@] bytes) to [%@]", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v26);
      }

      else
      {
        v32 = objc_autoreleasePoolPush();
        v33 = selfCopy2;
        v34 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
        {
          v35 = HMFGetLogIdentifier();
          *buf = 138543362;
          v40 = v35;
          _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Unable to store characteristic authorization data during migration, archived data is nil", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v32);
      }
    }

    else
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
      {
        v30 = HMFGetLogIdentifier();
        name3 = [(HMDHome *)selfCopy2 name];
        *buf = 138543618;
        v40 = v30;
        v41 = 2112;
        v42 = name3;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEBUG, "%{public}@No characteristic authorization data to migrate for home: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
    }
  }

  objc_autoreleasePoolPop(v3);
  v36 = *MEMORY[0x277D85DE8];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 services];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_2;
  v6[3] = &unk_278682930;
  v7 = *(a1 + 32);
  v8 = v3;
  v5 = v3;
  [v4 na_each:v6];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 characteristics];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_3;
  v4[3] = &unk_278682908;
  v5 = *(a1 + 32);
  v6 = *(a1 + 40);
  [v3 na_each:v4];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_3(uint64_t a1, void *a2)
{
  v15 = a2;
  v3 = [v15 getCharacteristicDictionary];
  v4 = [v3 objectForKeyedSubscript:*MEMORY[0x277CD2100]];

  if (v4)
  {
    v5 = *(a1 + 32);
    v6 = [*(a1 + 40) uuid];
    v7 = [v5 objectForKeyedSubscript:v6];

    if (!v7)
    {
      v8 = [MEMORY[0x277CBEB38] dictionary];
      v9 = *(a1 + 32);
      v10 = [*(a1 + 40) uuid];
      [v9 setObject:v8 forKeyedSubscript:v10];
    }

    v11 = *(a1 + 32);
    v12 = [*(a1 + 40) uuid];
    v13 = [v11 objectForKeyedSubscript:v12];
    v14 = [v15 instanceID];
    [v13 setObject:v4 forKeyedSubscript:v14];
  }
}

+ (id)loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID:(id)d
{
  v40 = *MEMORY[0x277D85DE8];
  dCopy = d;
  if (loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID__onceToken != -1)
  {
    dispatch_once(&loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID__onceToken, &__block_literal_global_221326);
  }

  v5 = getAccessoryAuthorizationsSettingsSerializedFilePath(dCopy);
  defaultManager = [MEMORY[0x277CCAA00] defaultManager];
  v7 = [defaultManager fileExistsAtPath:v5];

  if (v7)
  {
    v33 = 0;
    v8 = [MEMORY[0x277CBEA90] dataWithContentsOfFile:v5 options:2 error:&v33];
    v9 = v33;
    v10 = v9;
    if (!v8 || v9)
    {
      v24 = objc_autoreleasePoolPush();
      selfCopy = self;
      v26 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        v27 = HMFGetLogIdentifier();
        *buf = 138543874;
        v35 = v27;
        v36 = 2112;
        v37 = v5;
        v38 = 2112;
        v39 = v10;
        _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Unable to read data from file : %@ / %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v24);
      v15 = 0;
    }

    else
    {
      v32 = 0;
      v11 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClasses:loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID__allowedClasses fromData:v8 error:&v32];
      v12 = v32;
      v10 = v12;
      if (!v11 || v12)
      {
        v16 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v18 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
        {
          v29 = HMFGetLogIdentifier();
          *buf = 138543618;
          v35 = v29;
          v36 = 2112;
          v37 = v10;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to unarchive characteristic authorization data: %@", buf, 0x16u);
        }

        v15 = 0;
      }

      else
      {
        v13 = v11;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        v16 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v18 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
        {
          v19 = HMFGetLogIdentifier();
          *buf = 138543874;
          v35 = v19;
          v36 = 2112;
          v37 = dCopy;
          v38 = 2112;
          v39 = v15;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEBUG, "%{public}@Found characteristic authorization data for migration of home: %@: [%@]", buf, 0x20u);
        }
      }

      objc_autoreleasePoolPop(v16);
    }
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEBUG))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543618;
      v35 = v23;
      v36 = 2112;
      v37 = v5;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEBUG, "%{public}@No characteristic authorization file found at %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v15 = 0;
  }

  v30 = *MEMORY[0x277D85DE8];

  return v15;
}

void __110__HMDHome_CharacteristicAuthorizationData__loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID___block_invoke()
{
  v5[6] = *MEMORY[0x277D85DE8];
  v0 = MEMORY[0x277CBEB98];
  v5[0] = objc_opt_class();
  v5[1] = objc_opt_class();
  v5[2] = objc_opt_class();
  v5[3] = objc_opt_class();
  v5[4] = objc_opt_class();
  v5[5] = objc_opt_class();
  v1 = [MEMORY[0x277CBEA60] arrayWithObjects:v5 count:6];
  v2 = [v0 setWithArray:v1];
  v3 = loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID__allowedClasses;
  loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID__allowedClasses = v2;

  v4 = *MEMORY[0x277D85DE8];
}

+ (void)removeCharacteristicAuthorizationDataMigrationFileFromDiskWithhHomeUUID:(id)d
{
  v20 = *MEMORY[0x277D85DE8];
  dCopy = d;
  v5 = objc_alloc(MEMORY[0x277CBEBC0]);
  v6 = getAccessoryAuthorizationsSettingsSerializedFilePath(dCopy);
  v7 = [v5 initFileURLWithPath:v6];

  defaultManager = [MEMORY[0x277CCAA00] defaultManager];
  v15 = 0;
  [defaultManager removeItemAtURL:v7 error:&v15];
  v9 = v15;

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = v9;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while removing accessory authorization migration file from disk : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_unitTest_setRetrievalCompletionsTimeout:(double)timeout
{
  os_unfair_recursive_lock_lock_with_options();
  retrievalAccessoryCompletionTuples = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  v6 = [retrievalAccessoryCompletionTuples copy];

  os_unfair_recursive_lock_unlock();
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke;
  v7[3] = &unk_278681DA0;
  v7[4] = self;
  *&v7[5] = timeout;
  [v6 na_each:v7];
}

void __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke_2;
  v6[3] = &unk_27868A0D0;
  v7 = v3;
  v8 = *(a1 + 40);
  v5 = v3;
  dispatch_async(v4, v6);
}

uint64_t __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) stop];
  [*(a1 + 32) setRetrievalTimeout:*(a1 + 40)];
  v2 = *(a1 + 32);

  return [v2 start];
}

- (void)_notifyRetrievalError:(id)error accessoryServer:(id)server linkType:(int64_t)type accessoryOperationBlock:(id)block
{
  errorCopy = error;
  serverCopy = server;
  blockCopy = block;
  hapAccessories = [(HMDHome *)self hapAccessories];
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke;
  v17[3] = &unk_278681D78;
  v18 = serverCopy;
  selfCopy = self;
  v21 = blockCopy;
  typeCopy = type;
  v20 = errorCopy;
  v14 = errorCopy;
  v15 = blockCopy;
  v16 = serverCopy;
  [hapAccessories na_each:v17];
}

void __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 matchesHAPAccessoryWithServerIdentifier:*(a1 + 32) linkType:0])
  {
    v4 = _Block_copy(*(a1 + 56));
    v5 = v4;
    if (v4)
    {
      (*(v4 + 2))(v4, v3);
    }

    v6 = [*(a1 + 40) workQueue];
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke_2;
    v9[3] = &unk_278685330;
    v9[4] = *(a1 + 40);
    v7 = v3;
    v8 = *(a1 + 64);
    v10 = v7;
    v12 = v8;
    v11 = *(a1 + 48);
    dispatch_async(v6, v9);
  }
}

- (void)_retrieveHAPAccessoryForHMDHAPAccessory:(id)accessory linkType:(int64_t)type forceRetrieve:(BOOL)retrieve completion:(id)completion
{
  retrieveCopy = retrieve;
  v73 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  bridge = [accessoryCopy bridge];
  v14 = bridge;
  if (bridge)
  {
    v15 = bridge;
  }

  else
  {
    v15 = accessoryCopy;
  }

  v16 = v15;

  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  isBrowsingAllowed = [accessoryBrowser isBrowsingAllowed];

  if (isBrowsingAllowed)
  {
    accessories = [(HMDHome *)self accessories];
    v20 = [accessories containsObject:accessoryCopy];

    if (v20)
    {
      v21 = [v16 matchingHAPAccessoryServerIdentifierWithLinkType:type];
      v62 = 0;
      v22 = [(HMDHome *)self _enqueueRetrievalTupleForAccessory:v16 linkType:type inProgress:&v62 completion:completionCopy];
      v23 = v22;
      if (v62 == 1 && !retrieveCopy)
      {
        goto LABEL_24;
      }

      v58 = v22;
      v37 = objc_autoreleasePoolPush();
      selfCopy = self;
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
      {
        v56 = HMFGetLogIdentifier();
        shortDescription = [v16 shortDescription];
        if (type > 2)
        {
          v40 = @"Undefined";
        }

        else
        {
          v40 = off_2786768F0[type];
        }

        v51 = v40;
        v41 = HMFBooleanToString();
        *buf = 138544130;
        v64 = v56;
        v65 = 2112;
        v66 = shortDescription;
        v67 = 2112;
        v68 = v51;
        v69 = 2112;
        v70 = v41;
        _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Retrieving accessory %@/%@. Force: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v37);
      v23 = v58;
      [v58 start];
      accessoryBrowser2 = [(HMDHome *)selfCopy accessoryBrowser];
      v59[0] = MEMORY[0x277D85DD0];
      v59[1] = 3221225472;
      v59[2] = __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke;
      v59[3] = &unk_278682338;
      v59[4] = selfCopy;
      v60 = v16;
      typeCopy = type;
      [accessoryBrowser2 discoverAccessoryServer:v21 linkType:type errorHandler:v59];

      if (v62)
      {
LABEL_24:
        v43 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
        {
          v55 = HMFGetLogIdentifier();
          shortDescription2 = [v16 shortDescription];
          v57 = v43;
          if (type > 2)
          {
            v46 = @"Undefined";
          }

          else
          {
            v46 = off_2786768F0[type];
          }

          v47 = v46;
          v48 = MEMORY[0x277CCABB0];
          log = [v23 completions];
          v49 = [v48 numberWithUnsignedInteger:{-[NSObject count](log, "count")}];
          *buf = 138544386;
          v64 = v55;
          v65 = 2112;
          v66 = shortDescription2;
          v67 = 2112;
          v68 = v21;
          v69 = 2112;
          v70 = v47;
          v71 = 2112;
          v72 = v49;
          _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_DEBUG, "%{public}@Retrieval already in progress for accessory (%@) with server %@/%@ and %@ completions.", buf, 0x34u);

          v43 = v57;
        }

        objc_autoreleasePoolPop(v43);
      }

      goto LABEL_31;
    }

    v31 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
    {
      v34 = HMFGetLogIdentifier();
      shortDescription3 = [accessoryCopy shortDescription];
      *buf = 138543618;
      v64 = v34;
      v65 = 2112;
      v66 = shortDescription3;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Cannot retrieve HAP accessory: %@. Requested accessory not part of this home", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v31);
    v21 = _Block_copy(completionCopy);
    if (v21)
    {
      v29 = MEMORY[0x277CCA9B8];
      v30 = 3;
      goto LABEL_17;
    }
  }

  else
  {
    v24 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      shortDescription4 = [v16 shortDescription];
      *buf = 138543618;
      v64 = v27;
      v65 = 2112;
      v66 = shortDescription4;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Ignoring request to retrieve HAP accessory: %@. Browsing not allowed (companion is connected or no app)", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    v21 = _Block_copy(completionCopy);
    if (v21)
    {
      v29 = MEMORY[0x277CCA9B8];
      v30 = 48;
LABEL_17:
      v36 = [v29 hmErrorWithCode:v30];
      (v21->data)(v21, v36);
    }
  }

LABEL_31:

  v50 = *MEMORY[0x277D85DE8];
}

void __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (v3)
  {
    v4 = [*(a1 + 32) workQueue];
    v8[0] = MEMORY[0x277D85DD0];
    v8[1] = 3221225472;
    v8[2] = __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke_2;
    v8[3] = &unk_278685330;
    v5 = *(a1 + 40);
    v8[4] = *(a1 + 32);
    v6 = v5;
    v7 = *(a1 + 48);
    v9 = v6;
    v11 = v7;
    v10 = v3;
    dispatch_async(v4, v8);
  }
}

- (void)_dequeueRetrievalForAccessory:(id)accessory linkType:(int64_t)type error:(id)error
{
  v43 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  errorCopy = error;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  bridge = [accessoryCopy bridge];
  v12 = bridge;
  if (bridge)
  {
    v13 = bridge;
  }

  else
  {
    v13 = accessoryCopy;
  }

  v14 = v13;

  v15 = [(HMDHome *)self _retrieveTupleForPrimaryAccessory:v14 linkType:type];
  if (v15)
  {
    [(HMDHome *)self _removeRetrievalCompletionTuple:v15];
    [v15 stop];
    if (errorCopy)
    {
      v16 = objc_autoreleasePoolPush();
      selfCopy = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        shortDescription = [v14 shortDescription];
        v29 = v16;
        if (type > 2)
        {
          v19 = @"Undefined";
        }

        else
        {
          v19 = off_2786768F0[type];
        }

        v20 = v19;
        v21 = [MEMORY[0x277CCA9B8] hmStringFromErrorCode:{objc_msgSend(errorCopy, "code")}];
        v22 = MEMORY[0x277CCABB0];
        completions = [v15 completions];
        v23 = [v22 numberWithUnsignedInteger:{objc_msgSend(completions, "count")}];
        *buf = 138544386;
        v34 = v30;
        v35 = 2112;
        v36 = shortDescription;
        v37 = 2112;
        v38 = v20;
        v39 = 2112;
        v40 = v21;
        v41 = 2112;
        v42 = v23;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Calling accessory retrieval for %@/%@ with error: %@ and %@ completions.", buf, 0x34u);

        v16 = v29;
      }

      objc_autoreleasePoolPop(v16);
    }

    completions2 = [v15 completions];
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __76__HMDHome_AccessoryRetrieval___dequeueRetrievalForAccessory_linkType_error___block_invoke;
    v31[3] = &unk_278687BD0;
    v32 = errorCopy;
    [completions2 na_each:v31];

    completions3 = [v15 completions];
    [completions3 removeAllObjects];
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (id)_enqueueRetrievalTupleForAccessory:(id)accessory linkType:(int64_t)type inProgress:(BOOL *)progress completion:(id)completion
{
  v39 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  completionCopy = completion;
  bridge = [accessoryCopy bridge];
  v13 = bridge;
  if (bridge)
  {
    v14 = bridge;
  }

  else
  {
    v14 = accessoryCopy;
  }

  v15 = v14;

  v16 = objc_autoreleasePoolPush();
  selfCopy = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
  {
    v28 = v16;
    v19 = HMFGetLogIdentifier();
    if (completionCopy)
    {
      v20 = @" with completion";
    }

    else
    {
      v20 = &stru_283CF9D50;
    }

    shortDescription = [v15 shortDescription];
    progressCopy = progress;
    if (type > 2)
    {
      v22 = @"Undefined";
    }

    else
    {
      v22 = off_2786768F0[type];
    }

    v23 = v22;
    *buf = 138544130;
    v32 = v19;
    v33 = 2112;
    v34 = v20;
    v35 = 2112;
    v36 = shortDescription;
    v37 = 2112;
    v38 = v23;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEBUG, "%{public}@Enqueueing retrieval tuple%@ for %@/%@.", buf, 0x2Au);

    v16 = v29;
    progress = progressCopy;
  }

  objc_autoreleasePoolPop(v16);
  v24 = [(HMDHome *)selfCopy _retrieveTupleForPrimaryAccessory:v15 linkType:type];
  if (v24)
  {
    v25 = v24;
    if (progress)
    {
      *progress = 1;
    }

    if (completionCopy)
    {
      goto LABEL_16;
    }
  }

  else
  {
    v25 = [[HMDAccessoryRetrievalCompletionTuple alloc] initWithHome:selfCopy accessory:v15 linkType:type];
    [(HMDHome *)selfCopy _addRetrievalCompletionTuple:v25];
    if (completionCopy)
    {
LABEL_16:
      [(HMDAccessoryRetrievalCompletionTuple *)v25 addCompletion:completionCopy];
    }
  }

  v26 = *MEMORY[0x277D85DE8];

  return v25;
}

- (BOOL)_isRetrievalInProgressForPrimaryAccessory:(id)accessory linkType:(int64_t)type
{
  v4 = [(HMDHome *)self _retrieveTupleForPrimaryAccessory:accessory linkType:type];
  v5 = v4 != 0;

  return v5;
}

- (void)_removeRetrievalCompletionTuple:(id)tuple
{
  tupleCopy = tuple;
  os_unfair_recursive_lock_lock_with_options();
  retrievalAccessoryCompletionTuples = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  [retrievalAccessoryCompletionTuples removeObject:tupleCopy];

  os_unfair_recursive_lock_unlock();
}

- (void)_addRetrievalCompletionTuple:(id)tuple
{
  tupleCopy = tuple;
  os_unfair_recursive_lock_lock_with_options();
  retrievalAccessoryCompletionTuples = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  [retrievalAccessoryCompletionTuples addObject:tupleCopy];

  os_unfair_recursive_lock_unlock();
}

- (id)_retrieveTupleForPrimaryAccessory:(id)accessory linkType:(int64_t)type
{
  accessoryCopy = accessory;
  bridge = [accessoryCopy bridge];
  v8 = bridge;
  if (bridge)
  {
    v9 = bridge;
  }

  else
  {
    v9 = accessoryCopy;
  }

  v10 = v9;

  os_unfair_recursive_lock_lock_with_options();
  retrievalAccessoryCompletionTuples = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __74__HMDHome_AccessoryRetrieval___retrieveTupleForPrimaryAccessory_linkType___block_invoke;
  v15[3] = &unk_278681D50;
  v12 = v10;
  v16 = v12;
  typeCopy = type;
  v13 = [retrievalAccessoryCompletionTuples na_firstObjectPassingTest:v15];

  os_unfair_recursive_lock_unlock();

  return v13;
}

BOOL __74__HMDHome_AccessoryRetrieval___retrieveTupleForPrimaryAccessory_linkType___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 accessory];
  v5 = [v4 uuid];
  v6 = [*(a1 + 32) uuid];
  if ([v5 isEqual:v6])
  {
    v7 = [v3 linkType] == *(a1 + 40);
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)createSiriEndpointProfilesMessengerWithMessageTargetUUID:(id)d messageDispatcher:(id)dispatcher messageRouter:(id)router messageHandler:(id)handler
{
  handlerCopy = handler;
  routerCopy = router;
  dispatcherCopy = dispatcher;
  dCopy = d;
  v13 = [[HMDSiriEndpointProfilesMessenger alloc] initWithMessageTargetUUID:dCopy messageDispatcher:dispatcherCopy messageRouter:routerCopy messageHandler:handlerCopy];

  return v13;
}

- (void)configureSiriEndpointProfilesMessengerWithMessengerFactory:(id)factory messageHandlerFactory:(id)handlerFactory
{
  v25 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  handlerFactoryCopy = handlerFactory;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v23 = 138543362;
    v24 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring siri endpoint profiles messenger", &v23, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  primaryResidentMessageRouter = [(HMDHome *)selfCopy primaryResidentMessageRouter];
  if (!msgDispatcher)
  {
    _HMFPreconditionFailure();
LABEL_7:
    _HMFPreconditionFailure();
  }

  v14 = primaryResidentMessageRouter;
  if (!primaryResidentMessageRouter)
  {
    goto LABEL_7;
  }

  v15 = MEMORY[0x277CD1E30];
  uuid = [(HMDHome *)selfCopy uuid];
  v17 = [v15 messageTargetUUIDWithHomeUUID:uuid];

  uuid2 = [(HMDHome *)selfCopy uuid];
  v19 = [handlerFactoryCopy createSiriEndpointProfileMessageHandlerWithHomeUUID:uuid2];

  homeManager = [(HMDHome *)selfCopy homeManager];
  [v19 setDataSource:homeManager];

  v21 = [factoryCopy createSiriEndpointProfilesMessengerWithMessageTargetUUID:v17 messageDispatcher:msgDispatcher messageRouter:v14 messageHandler:v19];
  [v21 registerForMessagesWithHome:selfCopy];
  [(HMDHome *)selfCopy setSiriEndpointProfilesMessenger:v21];

  v22 = *MEMORY[0x277D85DE8];
}

- (unint64_t)accessorySettingsLocalMessageHandler:(id)handler callerPrivilegeWithMessage:(id)message
{
  v21 = *MEMORY[0x277D85DE8];
  handlerCopy = handler;
  messageCopy = message;
  v8 = [messageCopy userForHome:self];
  v9 = v8;
  if (v8)
  {
    privilege = [v8 privilege];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = messageCopy;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to get accessory settings local message handler caller privilege from message: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    privilege = 2;
  }

  v15 = *MEMORY[0x277D85DE8];
  return privilege;
}

- (id)createUnifiedLanguageValueListSettingDataProvider
{
  v2 = objc_alloc_init(HMDUnifiedLanguageValueListSettingDataProvider);

  return v2;
}

- (void)configureUnifiedLanguageValueListSettingDataProviderWithFactory:(id)factory
{
  v13 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v11 = 138543362;
    v12 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Configuring unified language value list setting data provider", &v11, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  createUnifiedLanguageValueListSettingDataProvider = [factoryCopy createUnifiedLanguageValueListSettingDataProvider];
  [createUnifiedLanguageValueListSettingDataProvider setDataSource:selfCopy];
  [(HMDHome *)selfCopy setUnifiedLanguageValueListSettingDataProvider:createUnifiedLanguageValueListSettingDataProvider];

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_performMediaGroupReadinessCheckAndSubmitMetricEventWithMessage:(id)message
{
  v91[1] = *MEMORY[0x277D85DE8];
  messageCopy = message;
  messagePayload = [messageCopy messagePayload];
  v6 = [messagePayload objectForKeyedSubscript:*MEMORY[0x277CD0498]];

  messagePayload2 = [messageCopy messagePayload];
  v8 = [messagePayload2 objectForKeyedSubscript:*MEMORY[0x277CCF0B0]];

  messagePayload3 = [messageCopy messagePayload];
  v10 = [messagePayload3 objectForKeyedSubscript:*MEMORY[0x277CD0490]];

  [v6 doubleValue];
  v12 = v11;
  v13 = objc_autoreleasePoolPush();
  selfCopy = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
  {
    v16 = HMFGetLogIdentifier();
    *buf = 138543618;
    v83 = v16;
    v84 = 2112;
    v85 = v10;
    _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Perform media group readiness check for setup session: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v13);
  featuresDataSource = [(HMDHome *)selfCopy featuresDataSource];
  isStereoOdeonTTSUBypassingPrimaryEnabled = [featuresDataSource isStereoOdeonTTSUBypassingPrimaryEnabled];

  if (isStereoOdeonTTSUBypassingPrimaryEnabled)
  {
    v19 = fabs(v12) >= 2.22044605e-16 && v12 > 0.0;
    v20 = [(HMDHome *)selfCopy accessoryWithUUID:v8];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v21 = v20;
    }

    else
    {
      v21 = 0;
    }

    v22 = v21;

    homeManager = [(HMDHome *)selfCopy homeManager];
    v24 = homeManager;
    if (!v19 || v22 == 0 || homeManager == 0)
    {
      v27 = objc_autoreleasePoolPush();
      v28 = selfCopy;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v69 = v6;
        v30 = v10;
        v31 = v8;
        v33 = v32 = v24;
        v34 = [MEMORY[0x277CCABB0] numberWithBool:v19];
        *buf = 138544130;
        v83 = v33;
        v84 = 2112;
        v85 = v34;
        v86 = 2112;
        v87 = v22;
        v88 = 2112;
        v89 = v32;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Invalid parameters: timeout %@ accessory: %@ homeManager: %@", buf, 0x2Au);

        v24 = v32;
        v8 = v31;
        v10 = v30;
        v6 = v69;
      }

      objc_autoreleasePoolPop(v27);
      v80 = *MEMORY[0x277CD0488];
      v81 = MEMORY[0x277CBEC28];
      v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v81 forKeys:&v80 count:1];
      v36 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:9014];
      v37 = messageCopy;
      v38 = v35;
      v39 = v36;
    }

    else
    {
      deviceForDirectMessaging = [v22 deviceForDirectMessaging];
      if (!deviceForDirectMessaging)
      {
        v60 = objc_autoreleasePoolPush();
        v61 = selfCopy;
        v62 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v63 = v6;
          v64 = v10;
          v65 = v8;
          v67 = v66 = v24;
          *buf = 138543362;
          v83 = v67;
          _os_log_impl(&dword_229538000, v62, OS_LOG_TYPE_INFO, "%{public}@Respond with YES as the peer device is just being setup and not ready to be messaged.", buf, 0xCu);

          v24 = v66;
          v8 = v65;
          v10 = v64;
          v6 = v63;
        }

        objc_autoreleasePoolPop(v60);
        v78 = *MEMORY[0x277CD0488];
        v79 = MEMORY[0x277CBEC38];
        v36 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v79 forKeys:&v78 count:1];
        [messageCopy respondWithPayload:v36 error:0];
        v35 = 0;
        goto LABEL_37;
      }

      v35 = deviceForDirectMessaging;
      if (([v22 supportsStereoOdeonTTSUBypassingPrimary] & 1) != 0 || !objc_msgSend(v22, "isHomePod"))
      {
        v70 = v24;
        v52 = objc_autoreleasePoolPush();
        v53 = selfCopy;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_DEFAULT))
        {
          v55 = HMFGetLogIdentifier();
          *buf = 138543618;
          v83 = v55;
          v84 = 2112;
          v85 = v22;
          _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_DEFAULT, "%{public}@Performing media group preflight check fetch for accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v52);
        HMFUptime();
        v57 = v56;
        category = [v22 category];
        categoryType = [category categoryType];

        v71[0] = MEMORY[0x277D85DD0];
        v71[1] = 3221225472;
        v71[2] = __101__HMDHome_MediaGroupReadinessCheck___performMediaGroupReadinessCheckAndSubmitMetricEventWithMessage___block_invoke;
        v71[3] = &unk_27868A2A0;
        v75 = v57;
        v71[4] = v53;
        v72 = messageCopy;
        v73 = v10;
        v74 = categoryType;
        v36 = categoryType;
        v24 = v70;
        [v70 fetchSetupDiagnosticStateWithOptions:1 accessoryUUID:v8 remoteMessageTimeout:9 remoteMessageRestriction:v71 completion:v12];

        goto LABEL_37;
      }

      v45 = objc_autoreleasePoolPush();
      v46 = selfCopy;
      v47 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v69 = v6;
        v48 = v10;
        v49 = v8;
        v51 = v50 = v24;
        *buf = 138543362;
        v83 = v51;
        _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Respond with YES as the peer device does not support the new feature.", buf, 0xCu);

        v24 = v50;
        v8 = v49;
        v10 = v48;
        v6 = v69;
      }

      objc_autoreleasePoolPop(v45);
      v76 = *MEMORY[0x277CD0488];
      v77 = MEMORY[0x277CBEC38];
      v36 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v77 forKeys:&v76 count:1];
      v37 = messageCopy;
      v38 = v36;
      v39 = 0;
    }

    [v37 respondWithPayload:v38 error:{v39, v69}];
LABEL_37:

    goto LABEL_38;
  }

  v40 = objc_autoreleasePoolPush();
  v41 = selfCopy;
  v42 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v42, OS_LOG_TYPE_INFO))
  {
    v43 = HMFGetLogIdentifier();
    *buf = 138543362;
    v83 = v43;
    _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_INFO, "%{public}@Respond with YES since the feature is not enabled.", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v40);
  v90 = *MEMORY[0x277CD0488];
  v91[0] = MEMORY[0x277CBEC38];
  v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v91 forKeys:&v90 count:1];
  [messageCopy respondWithPayload:v22 error:0];
LABEL_38:

  v68 = *MEMORY[0x277D85DE8];
}

void __101__HMDHome_MediaGroupReadinessCheck___performMediaGroupReadinessCheckAndSubmitMetricEventWithMessage___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v92[1] = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  HMFUptime();
  v8 = v7 - *(a1 + 64);
  v9 = objc_autoreleasePoolPush();
  v10 = *(a1 + 32);
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [MEMORY[0x277CCABB0] numberWithDouble:v8];
    *buf = 138543874;
    v78 = v12;
    v79 = 2112;
    v80 = v13;
    v81 = 2112;
    v82 = v6;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Performing media group preflight check fetch completed with duration %@ error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = objc_autoreleasePoolPush();
  v15 = *(a1 + 32);
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    v17 = HMFGetLogIdentifier();
    *buf = 138543618;
    v78 = v17;
    v79 = 2112;
    v80 = v5;
    _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Fetched diagnostic info: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v14);
  v18 = [v5 appleMediaAccessoryDiagnosticInfo];
  v19 = [v18 cloudInfo];
  v20 = [v18 idsInfo];
  v74 = [v18 currentAccessoryInfo];
  v21 = [v18 eventRouterServerInfo];
  if (v19)
  {
    v22 = [v19 firstCloudImportComplete];
    v23 = [v19 cloudState] == 1;
    if (v20)
    {
      goto LABEL_7;
    }

LABEL_10:
    v72 = 0;
    if (v19)
    {
      goto LABEL_8;
    }

    goto LABEL_11;
  }

  v22 = 0;
  v23 = 0;
  if (!v20)
  {
    goto LABEL_10;
  }

LABEL_7:
  v72 = [v20 idsState] == 1;
  if (v19)
  {
LABEL_8:
    v71 = [v19 octagonState] == 1;
    goto LABEL_12;
  }

LABEL_11:
  v71 = 0;
LABEL_12:
  v67 = v18;
  v24 = [v18 mediaRouteIdString];

  v73 = v6;
  v68 = v5;
  v69 = v23;
  v70 = v22;
  if (v6)
  {
    v25 = v21;
    v26 = objc_autoreleasePoolPush();
    v27 = *(a1 + 32);
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      v29 = HMFGetLogIdentifier();
      *buf = 138543618;
      v78 = v29;
      v79 = 2112;
      v80 = v6;
      _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_ERROR, "%{public}@Responding with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v26);
    v30 = *(a1 + 40);
    v91 = *MEMORY[0x277CD0488];
    v92[0] = MEMORY[0x277CBEC28];
    v31 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v92 forKeys:&v91 count:1];
    [v30 respondWithPayload:v31 error:v6];
    v21 = v25;
  }

  else
  {
    if (v24)
    {
      v32 = v22 & v23 & (v72 && v71);
    }

    else
    {
      v32 = 0;
    }

    v33 = objc_autoreleasePoolPush();
    v34 = *(a1 + 32);
    v35 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT))
    {
      HMFGetLogIdentifier();
      v58 = v24;
      v64 = v59 = v34;
      v36 = v32;
      v63 = HMFBooleanToString();
      v37 = HMFBooleanToString();
      HMFBooleanToString();
      v38 = log = v35;
      v39 = HMFBooleanToString();
      HMFBooleanToString();
      v40 = v60 = v33;
      HMFBooleanToString();
      v61 = v36;
      v42 = v41 = v21;
      *buf = 138544898;
      v78 = v64;
      v79 = 2112;
      v80 = v63;
      v81 = 2112;
      v82 = v37;
      v83 = 2112;
      v84 = v38;
      v85 = 2112;
      v86 = v39;
      v43 = v39;
      v87 = 2112;
      v88 = v40;
      v89 = 2112;
      v90 = v42;
      _os_log_impl(&dword_229538000, log, OS_LOG_TYPE_DEFAULT, "%{public}@Fetched the state of the peer: isReady: %@, firstImport: %@, isCloudSignedIn: %@, isIdsReady: %@, isManateeReady: %@, hasMediaRouteIdentifier: %@", buf, 0x48u);

      v21 = v41;
      v32 = v61;

      v33 = v60;
      v24 = v58;

      v35 = log;
      v34 = v59;
    }

    objc_autoreleasePoolPop(v33);
    v44 = *(a1 + 40);
    v75 = *MEMORY[0x277CD0488];
    v31 = [MEMORY[0x277CCABB0] numberWithBool:v32];
    v76 = v31;
    v45 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v76 forKeys:&v75 count:1];
    [v44 respondWithPayload:v45 error:0];
  }

  v46 = [v74 publicPairingIdentity];

  v66 = v19;
  v65 = v21;
  if (v21)
  {
    v47 = [v21 connectionState] == 1;
  }

  else
  {
    v47 = 0;
  }

  v48 = v24 != 0;
  v49 = *(a1 + 32);
  v50 = [*(a1 + 48) UUIDString];
  v51 = *(a1 + 56);
  v52 = [*(a1 + 32) isOwnerUser];
  v53 = [*(a1 + 32) uuid];
  BYTE3(v57) = v52;
  BYTE2(v57) = v72;
  BYTE1(v57) = v71;
  LOBYTE(v57) = v69;
  v54 = [v49 preflightCheckLogEventWithSessionIdentifier:v50 accessoryCategory:v51 fetchDuration:v70 firstImportCompleted:v48 hasMediaRouteIdentifier:v46 != 0 hasPairingIdentity:v47 hasConnectedEventRouterClient:v8 isCloudSignedIn:v57 hasManatee:v53 isIdsReady:? isOwnerUser:? homeUUID:?];

  v55 = [*(a1 + 32) logEventSubmitter];
  [v55 submitLogEvent:v54 error:v73];

  v56 = *MEMORY[0x277D85DE8];
}

- (void)_registerPerformMediaGroupReadinessCheckMessage
{
  v8[1] = *MEMORY[0x277D85DE8];
  msgDispatcher = [(HMDHome *)self msgDispatcher];
  v4 = *MEMORY[0x277CD0480];
  v5 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v8[0] = v5;
  v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v8 count:1];
  [msgDispatcher registerForMessage:v4 receiver:self policies:v6 selector:sel__handlePerformMediaGroupReadinessCheck_];

  v7 = *MEMORY[0x277D85DE8];
}

- (BOOL)validateActionsDoNotConflict:(id)conflict
{
  v81 = *MEMORY[0x277D85DE8];
  conflictCopy = conflict;
  if (![conflictCopy count])
  {
    v38 = 1;
    goto LABEL_55;
  }

  selfCopy = self;
  v57 = conflictCopy;
  v60 = [MEMORY[0x277CBEB58] set];
  v5 = [MEMORY[0x277CBEB58] set];
  v56 = [MEMORY[0x277CBEB58] set];
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v75 = 0u;
  v76 = 0u;
  v73 = 0u;
  v74 = 0u;
  obj = conflictCopy;
  v6 = [obj countByEnumeratingWithState:&v73 objects:v80 count:16];
  if (!v6)
  {
    v38 = 1;
    goto LABEL_54;
  }

  v59 = *v74;
  v53 = v62;
  while (2)
  {
    for (i = 0; i != v6; ++i)
    {
      if (*v74 != v59)
      {
        objc_enumerationMutation(obj);
      }

      v8 = *(*(&v73 + 1) + 8 * i);
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v9 = v8;
      }

      else
      {
        v9 = 0;
      }

      v10 = v9;

      if (!v10)
      {
        v12 = v8;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v13 = v12;
        }

        else
        {
          v13 = 0;
        }

        characteristic = v13;

        if (characteristic)
        {
          v71 = 0u;
          v72 = 0u;
          v69 = 0u;
          v70 = 0u;
          mediaProfiles = [characteristic mediaProfiles];
          v15 = [mediaProfiles countByEnumeratingWithState:&v69 objects:v79 count:16];
          if (v15)
          {
            v16 = *v70;
            while (2)
            {
              for (j = 0; j != v15; ++j)
              {
                if (*v70 != v16)
                {
                  objc_enumerationMutation(mediaProfiles);
                }

                v18 = *(*(&v69 + 1) + 8 * j);
                if ([v5 containsObject:{v18, v53}])
                {
                  v39 = objc_autoreleasePoolPush();
                  v40 = selfCopy;
                  v41 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
                  {
                    v42 = HMFGetLogIdentifier();
                    *buf = 138543618;
                    *&buf[4] = v42;
                    *&buf[12] = 2112;
                    *&buf[14] = v12;
                    _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", buf, 0x16u);
                  }

                  objc_autoreleasePoolPop(v39);
                  v36 = characteristic;
                  v37 = mediaProfiles;
                  goto LABEL_51;
                }

                [v5 addObject:v18];
              }

              v15 = [mediaProfiles countByEnumeratingWithState:&v69 objects:v79 count:16];
              if (v15)
              {
                continue;
              }

              break;
            }
          }
        }

        else
        {
          v19 = v12;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v20 = v19;
          }

          else
          {
            v20 = 0;
          }

          v21 = v20;

          if (v21)
          {
            accessory = [v21 accessory];
            if ([v56 containsObject:accessory])
            {
              v49 = objc_autoreleasePoolPush();
              v50 = selfCopy;
              v51 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v51, OS_LOG_TYPE_ERROR))
              {
                v52 = HMFGetLogIdentifier();
                *buf = 138543618;
                *&buf[4] = v52;
                *&buf[12] = 2112;
                *&buf[14] = v19;
                _os_log_impl(&dword_229538000, v51, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v49);
              characteristic = 0;
              v10 = 0;
              goto LABEL_52;
            }

            [v56 addObject:accessory];

            characteristic = 0;
            goto LABEL_43;
          }

          v23 = +[HMDCoreData featuresDataSource];
          isRVCEnabled = [v23 isRVCEnabled];

          if (isRVCEnabled && ((v25 = v19, objc_opt_class(), (objc_opt_isKindOfClass() & 1) == 0) ? (v26 = 0) : (v26 = v25), v27 = v26, v25, v27))
          {
            accessory2 = [v27 accessory];
            uuid = [accessory2 uuid];
            v30 = [dictionary objectForKeyedSubscript:uuid];

            if (!v30)
            {
              v30 = [MEMORY[0x277CBEB58] set];
              uuid2 = [accessory2 uuid];
              [dictionary setObject:v30 forKeyedSubscript:uuid2];
            }

            *buf = 0;
            *&buf[8] = buf;
            *&buf[16] = 0x2020000000;
            v78 = 0;
            commands = [v27 commands];
            v61[0] = MEMORY[0x277D85DD0];
            v61[1] = 3221225472;
            v62[0] = __59__HMDHome_HMActionExecution__validateActionsDoNotConflict___block_invoke;
            v62[1] = &unk_27868A500;
            v33 = v30;
            v63 = v33;
            v64 = selfCopy;
            v65 = v25;
            v68 = buf;
            v66 = dictionary;
            v34 = accessory2;
            v67 = v34;
            [commands hmf_enumerateWithAutoreleasePoolUsingBlock:v61];

            v35 = *(*&buf[8] + 24);
            _Block_object_dispose(buf, 8);

            mediaProfiles = 0;
            v36 = 0;
            v37 = 0;
            if (v35)
            {
LABEL_51:

              v10 = 0;
              characteristic = v36;
LABEL_52:

              v38 = 0;
              goto LABEL_54;
            }
          }

          else
          {
            mediaProfiles = 0;
          }
        }

LABEL_43:
        v10 = 0;
        goto LABEL_44;
      }

      characteristic = [v10 characteristic];
      if ([v60 containsObject:characteristic])
      {
        v45 = objc_autoreleasePoolPush();
        v46 = selfCopy;
        v47 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
        {
          v48 = HMFGetLogIdentifier();
          *buf = 138543618;
          *&buf[4] = v48;
          *&buf[12] = 2112;
          *&buf[14] = v8;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v45);
        goto LABEL_52;
      }

      [v60 addObject:characteristic];
LABEL_44:
    }

    v6 = [obj countByEnumeratingWithState:&v73 objects:v80 count:16];
    v38 = 1;
    if (v6)
    {
      continue;
    }

    break;
  }

LABEL_54:

  conflictCopy = v57;
LABEL_55:

  v43 = *MEMORY[0x277D85DE8];
  return v38;
}

void __59__HMDHome_HMActionExecution__validateActionsDoNotConflict___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v23 = *MEMORY[0x277D85DE8];
  v6 = a2;
  v7 = *(a1 + 32);
  v8 = [v6 matterPath];
  LODWORD(v7) = [v7 containsObject:v8];

  if (v7)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 40);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v13 = *(a1 + 48);
      v19 = 138543618;
      v20 = v12;
      v21 = 2112;
      v22 = v13;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    *(*(*(a1 + 72) + 8) + 24) = 1;
    *a4 = 1;
  }

  v14 = *(a1 + 56);
  v15 = [*(a1 + 64) uuid];
  v16 = [v14 objectForKeyedSubscript:v15];
  v17 = [v6 matterPath];
  [v16 addObject:v17];

  v18 = *MEMORY[0x277D85DE8];
}

- (void)executeActionsFromMessage:(id)message
{
  v179 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v102 = [messageCopy arrayForKey:*MEMORY[0x277CCFF38]];
  if ([v102 count])
  {
    if ([v102 hmf_objectsAreKindOfClass:objc_opt_class()])
    {
      date = [MEMORY[0x277CBEAA8] date];
      source = [messageCopy source];
      transport = [messageCopy transport];
      v104 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v102, "count")}];
      v158 = 0u;
      v159 = 0u;
      v156 = 0u;
      v157 = 0u;
      v4 = v102;
      v5 = [v4 countByEnumeratingWithState:&v156 objects:v178 count:16];
      if (!v5)
      {
        goto LABEL_17;
      }

      v6 = *v157;
      while (2)
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v157 != v6)
          {
            objc_enumerationMutation(v4);
          }

          v8 = *(*(&v156 + 1) + 8 * i);
          v9 = [(HMDHome *)self actionWithDictionaryRepresentation:v8];
          if (!v9)
          {
            v78 = objc_autoreleasePoolPush();
            selfCopy = self;
            v80 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v80, OS_LOG_TYPE_ERROR))
            {
              v81 = HMFGetLogIdentifier();
              *buf = 138543618;
              v166 = v81;
              v167 = 2112;
              *v168 = v8;
              _os_log_impl(&dword_229538000, v80, OS_LOG_TYPE_ERROR, "%{public}@Failed to deserialize action: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v78);
            v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
            [messageCopy respondWithError:v10];
LABEL_94:

            goto LABEL_106;
          }

          v10 = v9;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();
          if (isKindOfClass)
          {
            v12 = v10;
          }

          else
          {
            v12 = 0;
          }

          v13 = v12;

          if (isKindOfClass)
          {
            proxyConnection = [messageCopy proxyConnection];
            if (proxyConnection)
            {
              isEntitledForShortcutsAutomationAccess = [messageCopy isEntitledForShortcutsAutomationAccess];

              if ((isEntitledForShortcutsAutomationAccess & 1) == 0)
              {
                v84 = objc_autoreleasePoolPush();
                selfCopy2 = self;
                v86 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v86, OS_LOG_TYPE_ERROR))
                {
                  v87 = HMFGetLogIdentifier();
                  *buf = 138543362;
                  v166 = v87;
                  _os_log_impl(&dword_229538000, v86, OS_LOG_TYPE_ERROR, "%{public}@Missing ShortcutsAutomationAccess Entitlement for Execute", buf, 0xCu);
                }

                objc_autoreleasePoolPop(v84);
                v88 = [MEMORY[0x277CCA9B8] hmErrorWithCode:80 description:@"Missing Entitlement" reason:0 suggestion:0];
                [messageCopy respondWithError:v88];

                goto LABEL_94;
              }
            }
          }

          [v104 addObject:v10];
        }

        v5 = [v4 countByEnumeratingWithState:&v156 objects:v178 count:16];
        if (v5)
        {
          continue;
        }

        break;
      }

LABEL_17:

      v16 = [(HMDHome *)self validateActionsDoNotConflict:v104];
      v17 = objc_autoreleasePoolPush();
      val = self;
      v18 = HMFGetOSLogHandle();
      v19 = v18;
      if (v16)
      {
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          v20 = HMFGetLogIdentifier();
          *buf = 138543618;
          v166 = v20;
          v167 = 2112;
          *v168 = v104;
          _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEFAULT, "%{public}@Executing actions: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v17);
        v150 = 0;
        v151 = &v150;
        v152 = 0x3032000000;
        v153 = __Block_byref_object_copy__285295;
        v154 = __Block_byref_object_dispose__285296;
        v155 = 0;
        workQueue = [(HMDHome *)val workQueue];
        v21 = dispatch_group_create();
        v115 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v104, "count")}];
        strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
        strongToStrongObjectsMapTable2 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
        array = [MEMORY[0x277CBEB18] array];
        v148 = 0u;
        v149 = 0u;
        v146 = 0u;
        v147 = 0u;
        obj = v104;
        v22 = [obj countByEnumeratingWithState:&v146 objects:v177 count:16];
        group = v21;
        if (!v22)
        {
LABEL_75:

          v64 = group;
          if ([v115 count])
          {
            objc_initWeak(&location, val);
            dispatch_group_enter(group);
            uUID = [MEMORY[0x277CCAD78] UUID];
            v66 = objc_autoreleasePoolPush();
            v67 = val;
            v68 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v68, OS_LOG_TYPE_INFO))
            {
              v69 = HMFGetLogIdentifier();
              v163 = 0uLL;
              if (uUID)
              {
                [uUID getUUIDBytes:&v163];
              }

              else
              {
                v163 = *MEMORY[0x277D0F960];
              }

              v161 = v163;
              v163 = 0uLL;
              identifier = [messageCopy identifier];

              if (identifier)
              {
                identifier2 = [messageCopy identifier];
                [identifier2 getUUIDBytes:&v163];
              }

              else
              {
                v163 = *MEMORY[0x277D0F960];
              }

              v160 = v163;
              v91 = [v115 count];
              *buf = 138544898;
              v166 = v69;
              v167 = 1042;
              *v168 = 16;
              *&v168[4] = 2098;
              *&v168[6] = &v161;
              v169 = 1042;
              v170 = 16;
              v171 = 2098;
              v172 = &v160;
              v173 = 2114;
              v174 = v67;
              v175 = 2048;
              v176 = v91;
              _os_log_impl(&dword_229538000, v68, OS_LOG_TYPE_INFO, "%{public}@Executing write requests with identifier: %{public,uuid_t}.16P for request identifier %{public,uuid_t}.16P from home: %{public}@ count: %lu for characteristic write actions", buf, 0x40u);
            }

            objc_autoreleasePoolPop(v66);
            qualityOfService = [messageCopy qualityOfService];
            v126[0] = MEMORY[0x277D85DD0];
            v126[1] = 3221225472;
            v126[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_29;
            v126[3] = &unk_27868A488;
            v127 = workQueue;
            objc_copyWeak(&v133, &location);
            v128 = v115;
            v129 = strongToStrongObjectsMapTable2;
            v130 = strongToStrongObjectsMapTable;
            v132 = &v150;
            v131 = group;
            [(HMDHome *)v67 writeCharacteristicValues:v128 source:source biomeSource:0 identifier:uUID transport:transport qualityOfService:qualityOfService withCompletionHandler:v126];

            objc_destroyWeak(&v133);
            objc_destroyWeak(&location);
            v64 = group;
          }

          if (([array hmf_isEmpty] & 1) == 0)
          {
            v93 = objc_autoreleasePoolPush();
            v94 = val;
            v95 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v95, OS_LOG_TYPE_DEBUG))
            {
              v96 = HMFGetLogIdentifier();
              *buf = 138543618;
              v166 = v96;
              v167 = 2112;
              *v168 = array;
              _os_log_impl(&dword_229538000, v95, OS_LOG_TYPE_DEBUG, "%{public}@Executing matter natural lighting actions: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v93);
            dispatch_group_enter(group);
            v97 = [(HMDHome *)v94 executeMatterNaturalLightingActions:array];
            v123[0] = MEMORY[0x277D85DD0];
            v123[1] = 3221225472;
            v123[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_31;
            v123[3] = &unk_27868A4B0;
            v123[4] = v94;
            v125 = &v150;
            v124 = group;
            [v97 getResultWithCompletion:v123];

            v64 = group;
          }

          workQueue2 = [(HMDHome *)val workQueue];
          block[0] = MEMORY[0x277D85DD0];
          block[1] = 3221225472;
          block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_33;
          block[3] = &unk_27868A4D8;
          v120 = messageCopy;
          v122 = &v150;
          v121 = obj;
          dispatch_group_notify(v64, workQueue2, block);

          _Block_object_dispose(&v150, 8);
          goto LABEL_106;
        }

        v116 = *v147;
        while (2)
        {
          v117 = v22;
          v23 = 0;
LABEL_23:
          if (*v147 != v116)
          {
            objc_enumerationMutation(obj);
          }

          v24 = *(*(&v146 + 1) + 8 * v23);
          [v24 configureWithHome:val];
          v25 = v24;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v26 = v25;
          }

          else
          {
            v26 = 0;
          }

          v27 = v26;

          if (v27)
          {
            characteristic = [v27 characteristic];
            targetValue = [v27 targetValue];
            authorizationData = [characteristic authorizationData];
            v31 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:characteristic value:targetValue authorizationData:authorizationData type:1];

            if (v31)
            {
              [v115 addObject:v31];
              [strongToStrongObjectsMapTable setObject:v27 forKey:v31];
              goto LABEL_73;
            }
          }

          v32 = v25;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v33 = v32;
          }

          else
          {
            v33 = 0;
          }

          characteristic = v33;

          lightProfile = [characteristic lightProfile];
          v31 = lightProfile;
          if (lightProfile)
          {
            if ([lightProfile supportsCHIP] && objc_msgSend(v31, "isNaturalLightingSupported"))
            {
              [array addObject:characteristic];
              goto LABEL_73;
            }

            residualAction = [characteristic writeRequestForTransitionStartWithLightProfile:v31 startDate:date type:1];
            if (residualAction)
            {
              [strongToStrongObjectsMapTable2 setObject:characteristic forKey:residualAction];
              [v115 addObject:residualAction];
            }

            else
            {
              v41 = objc_autoreleasePoolPush();
              v42 = val;
              v43 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v43, OS_LOG_TYPE_ERROR))
              {
                v44 = HMFGetLogIdentifier();
                *buf = 138543618;
                v166 = v44;
                v167 = 2112;
                *v168 = characteristic;
                _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_ERROR, "%{public}@Failed to create characteristic write request for natural lighting action: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v41);
              residualAction = 0;
            }

LABEL_72:

LABEL_73:
            if (v117 == ++v23)
            {
              v22 = [obj countByEnumeratingWithState:&v146 objects:v177 count:16];
              if (!v22)
              {
                goto LABEL_75;
              }

              continue;
            }

            goto LABEL_23;
          }

          break;
        }

        if (characteristic)
        {
          v36 = objc_autoreleasePoolPush();
          v37 = val;
          v38 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
          {
            v39 = HMFGetLogIdentifier();
            *buf = 138543618;
            v166 = v39;
            v167 = 2112;
            *v168 = characteristic;
            _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_ERROR, "%{public}@Skipping executing natural lighting action, missing light profile: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v36);
          v40 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          residualAction = v151[5];
          v151[5] = v40;
          goto LABEL_72;
        }

        v45 = v32;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v46 = v45;
        }

        else
        {
          v46 = 0;
        }

        v47 = v46;
        v108 = v45;

        if (v47)
        {
          convertedCharacteristicWriteRequests = [v47 convertedCharacteristicWriteRequests];
          v49 = convertedCharacteristicWriteRequests;
          if (convertedCharacteristicWriteRequests)
          {
            residualAction = [convertedCharacteristicWriteRequests residualAction];

            characteristicWriteRequests = [v49 characteristicWriteRequests];
            if (!residualAction)
            {
LABEL_58:

              goto LABEL_59;
            }
          }

          else
          {
            characteristicWriteRequests = 0;
            residualAction = v45;
          }

          [residualAction setEncodePlaybackArchiveForExecution:1];
          goto LABEL_58;
        }

        characteristicWriteRequests = 0;
        residualAction = 0;
LABEL_59:
        objc_initWeak(&location, val);
        if ([characteristicWriteRequests count])
        {
          dispatch_group_enter(group);
          uUID2 = [MEMORY[0x277CCAD78] UUID];
          v50 = objc_autoreleasePoolPush();
          v51 = val;
          v52 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
          {
            v53 = HMFGetLogIdentifier();
            v163 = 0uLL;
            if (uUID2)
            {
              [uUID2 getUUIDBytes:&v163];
            }

            else
            {
              v163 = *MEMORY[0x277D0F960];
            }

            v164 = v163;
            v163 = 0uLL;
            identifier3 = [messageCopy identifier];

            if (identifier3)
            {
              identifier4 = [messageCopy identifier];
              [identifier4 getUUIDBytes:&v163];
            }

            else
            {
              v163 = *MEMORY[0x277D0F960];
            }

            v162 = v163;
            v56 = [characteristicWriteRequests count];
            *buf = 138544898;
            v166 = v53;
            v167 = 1042;
            *v168 = 16;
            *&v168[4] = 2098;
            *&v168[6] = &v164;
            v169 = 1042;
            v170 = 16;
            v171 = 2098;
            v172 = &v162;
            v173 = 2114;
            v174 = val;
            v175 = 2048;
            v176 = v56;
            _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_INFO, "%{public}@Executing write requests with identifier: %{public,uuid_t}.16P for request identifier %{public,uuid_t}.16P from home: %{public}@ count: %lu for media actions", buf, 0x40u);
          }

          objc_autoreleasePoolPop(v50);
          source2 = [messageCopy source];
          qualityOfService2 = [messageCopy qualityOfService];
          v139[0] = MEMORY[0x277D85DD0];
          v139[1] = 3221225472;
          v139[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke;
          v139[3] = &unk_27868A3E8;
          v140 = workQueue;
          objc_copyWeak(&v144, &location);
          v59 = characteristicWriteRequests;
          v141 = v59;
          v143 = &v150;
          v142 = group;
          [(HMDHome *)v51 writeCharacteristicValues:v59 source:source2 biomeSource:0 identifier:uUID2 transport:transport qualityOfService:qualityOfService2 withCompletionHandler:v139];

          objc_destroyWeak(&v144);
        }

        clientName = [messageCopy clientName];
        v61 = clientName;
        v62 = @"Unknown";
        if (clientName)
        {
          v62 = clientName;
        }

        v63 = v62;

        dispatch_group_enter(group);
        v134[0] = MEMORY[0x277D85DD0];
        v134[1] = 3221225472;
        v134[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_26;
        v134[3] = &unk_27868A438;
        v135 = workQueue;
        objc_copyWeak(&v138, &location);
        v137 = &v150;
        v136 = group;
        [v108 executeWithSource:source clientName:v63 completionHandler:v134];

        objc_destroyWeak(&v138);
        objc_destroyWeak(&location);

        goto LABEL_72;
      }

      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v82 = HMFGetLogIdentifier();
        *buf = 138543362;
        v166 = v82;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Failed to validate actions", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      v83 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [messageCopy respondWithError:v83];

LABEL_106:
    }

    else
    {
      v74 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v76 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v76, OS_LOG_TYPE_ERROR))
      {
        v77 = HMFGetLogIdentifier();
        *buf = 138543618;
        v166 = v77;
        v167 = 2112;
        *v168 = messageCopy;
        _os_log_impl(&dword_229538000, v76, OS_LOG_TYPE_ERROR, "%{public}@Invalid actions payload: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v74);
      date = [MEMORY[0x277CCA9B8] hmErrorWithCode:22];
      [messageCopy respondWithError:date];
    }
  }

  else
  {
    v70 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v72 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v72, OS_LOG_TYPE_ERROR))
    {
      v73 = HMFGetLogIdentifier();
      *buf = 138543618;
      v166 = v73;
      v167 = 2112;
      *v168 = messageCopy;
      _os_log_impl(&dword_229538000, v72, OS_LOG_TYPE_ERROR, "%{public}@No Actions in message:(%@)", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v70);
    date = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [messageCopy respondWithError:date];
  }

  v99 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2;
  block[3] = &unk_27868A3C0;
  objc_copyWeak(&v17, (a1 + 64));
  v13 = v5;
  v14 = *(a1 + 40);
  v15 = v6;
  v11 = *(a1 + 48);
  v8 = v11;
  v16 = v11;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);

  objc_destroyWeak(&v17);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_26(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_27;
  block[3] = &unk_27868A410;
  objc_copyWeak(&v11, (a1 + 56));
  v9 = v3;
  v7 = *(a1 + 40);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  dispatch_async(v4, block);

  objc_destroyWeak(&v11);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_29(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_30;
  block[3] = &unk_27868A460;
  objc_copyWeak(&v19, (a1 + 80));
  v13 = v5;
  v14 = *(a1 + 40);
  v15 = *(a1 + 48);
  v16 = v6;
  v17 = *(a1 + 56);
  v11 = *(a1 + 64);
  v8 = v11;
  v18 = v11;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);

  objc_destroyWeak(&v19);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_31(uint64_t a1, void *a2, void *a3)
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    v15 = 138543874;
    v16 = v10;
    v17 = 2112;
    v18 = v5;
    v19 = 2112;
    v20 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Finished execution of all matter natural lighting actions with response: %@ error: %@", &v15, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  if (v6)
  {
    v11 = *(*(a1 + 48) + 8);
    v13 = *(v11 + 40);
    v12 = (v11 + 40);
    if (!v13)
    {
      objc_storeStrong(v12, a3);
    }
  }

  dispatch_group_leave(*(a1 + 40));

  v14 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_33(uint64_t a1)
{
  v2 = [*(a1 + 32) responseHandler];

  if (v2)
  {
    v3 = [*(a1 + 32) responseHandler];
    (*(v3 + 2))(v3, *(*(*(a1 + 48) + 8) + 40), 0);
  }
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_30(uint64_t a1)
{
  v56 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 88));
  v3 = *(a1 + 32);
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v48 = 0u;
  obj = *(a1 + 40);
  v42 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
  if (v42)
  {
    v41 = *v46;
    v38 = WeakRetained;
    do
    {
      for (i = 0; i != v42; ++i)
      {
        if (*v46 != v41)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v45 + 1) + 8 * i);
        v6 = [*(a1 + 48) objectForKey:v5];
        v7 = v6;
        if (v6)
        {
          v8 = *(a1 + 56);
          v9 = [v6 isNaturalLightingEnabled];
          v44 = 0;
          v10 = [v8 hmd_isValidResponseForWriteRequest:v5 naturalLightingEnabled:v9 error:&v44];
          v11 = v44;
          v12 = objc_autoreleasePoolPush();
          v13 = WeakRetained;
          v14 = HMFGetOSLogHandle();
          v15 = v14;
          if (v10)
          {
            if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
            {
              v16 = HMFGetLogIdentifier();
              *buf = 138543618;
              v50 = v16;
              v51 = 2112;
              v52 = v7;
              v17 = v15;
              v18 = OS_LOG_TYPE_INFO;
              v19 = "%{public}@Successfully executed natural lighting action: %@";
              v20 = 22;
              goto LABEL_15;
            }
          }

          else if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
          {
            v16 = HMFGetLogIdentifier();
            *buf = 138543874;
            v50 = v16;
            v51 = 2112;
            v52 = v7;
            v53 = 2112;
            v54 = v11;
            v17 = v15;
            v18 = OS_LOG_TYPE_ERROR;
            v19 = "%{public}@Failed to execute natural lighting action %@:%@";
            v20 = 32;
LABEL_15:
            _os_log_impl(&dword_229538000, v17, v18, v19, buf, v20);
          }

          objc_autoreleasePoolPop(v12);
          if (v3)
          {
            goto LABEL_24;
          }

          goto LABEL_22;
        }

        v40 = v3;
        v21 = [*(a1 + 64) objectForKey:v5];
        v22 = *(a1 + 56);
        v23 = [v5 characteristic];
        v43 = 0;
        v24 = [v22 hmd_valueOfCharacteristic:v23 error:&v43];
        v11 = v43;

        v25 = objc_autoreleasePoolPush();
        v26 = WeakRetained;
        v27 = HMFGetOSLogHandle();
        v28 = v27;
        if (v24)
        {
          if (!os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
          {
            goto LABEL_21;
          }

          v29 = HMFGetLogIdentifier();
          *buf = 138543618;
          v50 = v29;
          v51 = 2112;
          v52 = v21;
          v30 = v28;
          v31 = OS_LOG_TYPE_INFO;
          v32 = "%{public}@Successfully executed characteristic write action: %@";
          v33 = 22;
        }

        else
        {
          if (!os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_21;
          }

          v29 = HMFGetLogIdentifier();
          *buf = 138543874;
          v50 = v29;
          v51 = 2112;
          v52 = v21;
          v53 = 2112;
          v54 = v11;
          v30 = v28;
          v31 = OS_LOG_TYPE_ERROR;
          v32 = "%{public}@Failed to execute characteristic write action %@:%@";
          v33 = 32;
        }

        _os_log_impl(&dword_229538000, v30, v31, v32, buf, v33);

        WeakRetained = v38;
LABEL_21:

        objc_autoreleasePoolPop(v25);
        v3 = v40;
        if (v40)
        {
          goto LABEL_24;
        }

LABEL_22:
        if (v11)
        {
          v3 = v11;
        }

LABEL_24:
      }

      v42 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
    }

    while (v42);
  }

  if (v3)
  {
    v34 = *(*(a1 + 80) + 8);
    v36 = *(v34 + 40);
    v35 = (v34 + 40);
    if (!v36)
    {
      objc_storeStrong(v35, v3);
    }
  }

  dispatch_group_leave(*(a1 + 72));

  v37 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_27(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (*(a1 + 32))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = WeakRetained;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 32);
      v12 = 138543618;
      v13 = v6;
      v14 = 2112;
      v15 = v7;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute action with error: %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v8 = *(*(a1 + 48) + 8);
    v10 = *(v8 + 40);
    v9 = (v8 + 40);
    if (!v10)
    {
      objc_storeStrong(v9, *(a1 + 32));
    }
  }

  dispatch_group_leave(*(a1 + 40));

  v11 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2(id *a1)
{
  v73 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 9);
  v3 = a1[4];
  v34 = a1;
  if (v3)
  {
    v4 = v3;
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v61 = v8;
      v62 = 2112;
      v63 = v4;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute write requests for converted media action with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  else
  {
    v31 = [a1[5] count];
    v56 = 0u;
    v57 = 0u;
    v58 = 0u;
    v59 = 0u;
    v12 = a1[6];
    v35 = [v12 countByEnumeratingWithState:&v56 objects:v72 count:16];
    if (!v35)
    {

      v4 = 0;
      v11 = 0;
      goto LABEL_37;
    }

    v13 = 0;
    v4 = 0;
    obj = v12;
    v33 = *v57;
    v45 = *MEMORY[0x277CD2128];
    do
    {
      v14 = 0;
      do
      {
        if (*v57 != v33)
        {
          v15 = v14;
          objc_enumerationMutation(obj);
          v14 = v15;
        }

        v36 = v14;
        v41 = *(*(&v56 + 1) + 8 * v14);
        v16 = [v34[6] hmf_dictionaryForKey:v31];
        v52 = 0u;
        v53 = 0u;
        v54 = 0u;
        v55 = 0u;
        v39 = v16;
        v38 = [v39 countByEnumeratingWithState:&v52 objects:v71 count:16];
        if (v38)
        {
          v37 = *v53;
          do
          {
            v17 = 0;
            do
            {
              if (*v53 != v37)
              {
                objc_enumerationMutation(v39);
              }

              v40 = v17;
              v42 = *(*(&v52 + 1) + 8 * v17);
              v18 = [v39 hmf_dictionaryForKey:?];
              v48 = 0u;
              v49 = 0u;
              v50 = 0u;
              v51 = 0u;
              v19 = v18;
              v47 = [v19 countByEnumeratingWithState:&v48 objects:v70 count:16];
              if (v47)
              {
                v46 = *v49;
                v44 = v19;
                do
                {
                  for (i = 0; i != v47; ++i)
                  {
                    if (*v49 != v46)
                    {
                      objc_enumerationMutation(v19);
                    }

                    v21 = *(*(&v48 + 1) + 8 * i);
                    v22 = [v19 hmf_dictionaryForKey:v21];
                    v23 = [v22 hmf_dataForKey:v45];
                    if (v23)
                    {
                      v24 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v23 error:0];

                      v25 = objc_autoreleasePoolPush();
                      v26 = WeakRetained;
                      v27 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
                      {
                        HMFGetLogIdentifier();
                        v43 = v13;
                        v29 = v28 = WeakRetained;
                        *buf = 138544386;
                        v61 = v29;
                        v62 = 2112;
                        v63 = v41;
                        v64 = 2112;
                        v65 = v42;
                        v66 = 2112;
                        v67 = v21;
                        v68 = 2112;
                        v69 = v24;
                        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute write requests for %@/%@/%@ with error: %@", buf, 0x34u);

                        WeakRetained = v28;
                        v13 = v43;
                      }

                      ++v13;

                      objc_autoreleasePoolPop(v25);
                      v4 = v24;
                      v19 = v44;
                    }
                  }

                  v47 = [v19 countByEnumeratingWithState:&v48 objects:v70 count:16];
                }

                while (v47);
              }

              v17 = v40 + 1;
            }

            while (v40 + 1 != v38);
            v38 = [v39 countByEnumeratingWithState:&v52 objects:v71 count:16];
          }

          while (v38);
        }

        v14 = v36 + 1;
      }

      while (v36 + 1 != v35);
      v35 = [obj countByEnumeratingWithState:&v56 objects:v72 count:16];
    }

    while (v35);

    v11 = 0;
    if (!v31 || v31 != v13)
    {
      goto LABEL_37;
    }

    if (!v4)
    {
      goto LABEL_38;
    }
  }

  v9 = v34;
  v10 = *(v34[8] + 1);
  if (!*(v10 + 40))
  {
    v11 = v4;
    v4 = *(v10 + 40);
    *(v10 + 40) = v11;
LABEL_37:

    v4 = v11;
LABEL_38:
    v9 = v34;
  }

  dispatch_group_leave(v9[7]);

  v30 = *MEMORY[0x277D85DE8];
}

@end