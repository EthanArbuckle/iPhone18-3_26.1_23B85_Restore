@interface HMDHome
+ (BOOL)didHomeAppOnboardHindsightWithAppData:(id)a3;
+ (BOOL)isObjectContainedInHome:(id)a3;
+ (BOOL)updateCHIPPropertiesOnHomeModel:(id)a3 forAddedHAPAccessoryServer:(id)a4;
+ (HMDHome)homeWithHomeManager:(id)a3 backingStore:(id)a4 model:(id)a5 error:(id *)a6;
+ (id)createNewHomeModelsWithModelID:(id)a3 parentModelID:(id)a4 name:(id)a5 acwgGroupResolvingKey:(id)a6 acwgIssuerPublicKeyExternalRepresentation:(id)a7 userUniqueIDForAccessories:(id)a8 hasOnboardedActivityHistory:(BOOL)a9 ownedBy:(id)a10;
+ (id)createUserUniqueIDForAccessoriesWithoutDuplicatingExistingIDs:(id)a3;
+ (id)decodedMigrationBulletinBoardNotifications:(id)a3;
+ (id)decodedMigrationCameraNotificationSettings:(id)a3;
+ (id)encodedMigrationBulletinBoardNotifications:(id)a3;
+ (id)encodedMigrationCameraNotificationSettings:(id)a3;
+ (id)filterUsersSupportingPresence:(id)a3;
+ (id)getBuiltinActionSets;
+ (id)loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID:(id)a3;
+ (id)logCategory;
+ (id)matterDeviceControllerWithUUID:(id)a3;
+ (id)migrationBulletinBoardNotificationsForHome:(id)a3;
+ (id)migrationCameraNotificationSettingsForHome:(id)a3;
+ (id)nfcIssuerKeyIdentifierWithPairingIdentity:(id)a3;
+ (id)notificationPayloadForChangedCharacteristics:(id)a3 destination:(id)a4 destinationIsXPCTransport:(BOOL)a5;
+ (id)shortDescription;
+ (id)supportedAccessoryClasses;
+ (id)updatedHomeModelCHIPPropertiesForAddedHAPAccessoryServer:(id)a3;
+ (id)zoneIDFromHomeUUID:(id)a3;
+ (uint64_t)sanitizedOriginalSourceForMessage:(uint64_t)a1;
+ (unint64_t)privilegeFromUserInviteInformation:(id)a3;
+ (void)_initialize;
+ (void)appendCharacteristicsToAccessoryList:(id)a3 responseTuples:(id)a4 forMultipleCharacteristicsRemoteRead:(id)a5;
+ (void)appendCharacteristicsToAccessoryList:(id)a3 responseTuples:(id)a4 forMultipleCharacteristicsRemoteWrite:(id)a5 message:(id)a6;
+ (void)dumpAccessories:(id)a3 usingTag:(id)a4 flow:(id)a5;
+ (void)removeCharacteristicAuthorizationDataMigrationFileFromDiskWithhHomeUUID:(id)a3;
+ (void)updateCHIPPropertiesOnAccessoryModel:(id)a3 forAddedHAPAccessoryServer:(id)a4;
+ (void)updateCHIPPropertiesOnMKFAccessoryModel:(id)a3 forAddedHAPAccessoryServer:(id)a4;
- (BOOL)__shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:(id)a3 error:(id *)a4;
- (BOOL)_accessoryRequiresNativeMatter:(id)a3;
- (BOOL)_addAccessory:(id)a3;
- (BOOL)_deviceEligibleForDarkPoll;
- (BOOL)_doesInvitedUserHasTheSamePairingIdentityAsOwner:(id)a3;
- (BOOL)_doesUsersHaveCATID;
- (BOOL)_ensureDevicesSymptomDiscoveryMessageCanBeHandled:(id)a3;
- (BOOL)_hasPairedReachableBTLEAccessories;
- (BOOL)_homeHasMatterThreadAccessories;
- (BOOL)_homeHasNativeMatterAccessories;
- (BOOL)_isAccessToHomeAllowed;
- (BOOL)_isEventTriggerOnLocalDeviceForAccessory:(id)a3;
- (BOOL)_isEventTriggerOnRemoteGatewayForAccessory:(id)a3;
- (BOOL)_isNetworkRouterSupportEnabledForCurrentDevice;
- (BOOL)_isReadRequestAllowForCharacteristics:(id)a3 message:(id)a4 error:(id *)a5;
- (BOOL)_isRegisteredForNotificationsForClients:(id)a3;
- (BOOL)_isRegisteredForNotificationsWithRemoteGateway:(id)a3;
- (BOOL)_isResidentNativeMatterCapable:(id)a3;
- (BOOL)_isResidentThreadCapable:(id)a3;
- (BOOL)_isRetrievalInProgressForPrimaryAccessory:(id)a3 linkType:(int64_t)a4;
- (BOOL)_isSecureClassTriggeredByCharacteristics:(id)a3;
- (BOOL)_isSharedHomeVersionTrustZoneCapable;
- (BOOL)_isUserValid:(id)a3 error:(id *)a4;
- (BOOL)_justSentInvitation:(id)a3;
- (BOOL)_matterAccessoryRequiresThread:(id)a3;
- (BOOL)_populateTriggerModel:(id)a3 fromBuilderMessage:(id)a4 transaction:(id)a5 responsePayload:(id)a6;
- (BOOL)_processTestModeHomeAccessControlOverride:(id)a3 error:(id *)a4;
- (BOOL)_processTestModeHomeLocationStatusOverride:(id)a3 error:(id *)a4;
- (BOOL)_processTestModeSkipHH2MigrationOverride:(id)a3 error:(id *)a4;
- (BOOL)_processTestModeUpdateHomeLocation:(id)a3 error:(id *)a4;
- (BOOL)_removeAccessory:(id)a3;
- (BOOL)_residentDeviceAvailable;
- (BOOL)_shouldAllowAddingAccessoryOfCategory:(id)a3 requestMessage:(id)a4 error:(id *)a5;
- (BOOL)_shouldAllowAddingAccessoryWithDescription:(id)a3 requestMessage:(id)a4 error:(id *)a5;
- (BOOL)_shouldAvoidTombstoningAccessoryServer:(id)a3 accessory:(id)a4;
- (BOOL)_shouldFallbackLocallyForRemoteMatterRequest:(id)a3;
- (BOOL)_shouldRateLimitChangeNotificationsForCharacteristic:(id)a3;
- (BOOL)_shouldRegisterForNotificationsWithDevice:(id)a3;
- (BOOL)_shouldResendOutgoingInvitation:(id)a3;
- (BOOL)_shouldSendToDestination:(id)a3 device:(id)a4 remoteSourceDevice:(id)a5;
- (BOOL)_shouldUseAttributeReportForBulletin:(id)a3;
- (BOOL)_shouldUseDeprecatedAddAccessoryMessage:(id)a3 minimumVersion:(id)a4 primaryResident:(id)a5 shouldRelayMessages:(BOOL)a6;
- (BOOL)_shouldWaitForAccessoriesToBeReachable;
- (BOOL)_validateAddingNewTriggerWithName:(id)a3 message:(id)a4;
- (BOOL)_validateSettingsUpdate:(id)a3 type:(int64_t *)a4 keyPath:(id *)a5 value:(id *)a6 error:(id *)a7;
- (BOOL)_verifyUserManagementPermissionForAccessory:(id)a3 error:(id *)a4;
- (BOOL)addBulletinConditions:(id)a3 on:(id)a4 context:(id)a5;
- (BOOL)addPresenceBulletinCondition:(id)a3 on:(id)a4 context:(id)a5;
- (BOOL)addSunriseSunSetTimePeriodElement:(id)a3 toCondition:(id)a4 isStartElement:(BOOL)a5;
- (BOOL)addTimeOfDayTimePeriodElement:(id)a3 toCondition:(id)a4 isStartElement:(BOOL)a5;
- (BOOL)addTimePeriodBulletinCondition:(id)a3 on:(id)a4;
- (BOOL)applyDeviceLockStatus:(id)a3;
- (BOOL)areAllThreadResidentNodesUnreachable;
- (BOOL)areCharacteristicRequests:(id)a3 allowedForUser:(id)a4;
- (BOOL)attemptToUpdateThreadNetworkID:(id)a3;
- (BOOL)auditStorageWithFabricData:(id)a3;
- (BOOL)bulletinBoardNotificationsMigrationFileExistsOnDisk;
- (BOOL)cameraNotificationSettingsMigrationFileExistsOnDisk;
- (BOOL)canTopicBeForwardedToPrimaryFromResident:(id)a3;
- (BOOL)checkForNetworkRouterSupport:(unint64_t)a3 error:(id *)a4;
- (BOOL)configureWithHomeManager:(id)a3 accessoriesPresent:(id)a4 uncommittedTransactions:(id)a5 source:(unint64_t)a6;
- (BOOL)containsRemovedUser:(id)a3;
- (BOOL)currentDeviceSupportsSidekickSettings;
- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithNoPasscodeForSiriSecureAccessoryAccessController:(id)a3;
- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithWatchAuthForSiriSecureAccessoryAccessController:(id)a3;
- (BOOL)currentRemoteReachabilityRegistration;
- (BOOL)defaultRoomContainsAccessoryWithUUID:(id)a3;
- (BOOL)doesHomeContainResident;
- (BOOL)doesThisHomeHaveCameras;
- (BOOL)enableBulletinRegistrations:(id)a3 source:(id)a4 homeMember:(id)a5 context:(id)a6;
- (BOOL)enabledResidentsSupportsHomeHub;
- (BOOL)evaluatePredicate:(id)a3;
- (BOOL)getUpdateTransactionForAccessory:(id)a3 hapAccessory:(id)a4 accessoryTransaction:(id)a5 addSvcTransactions:(id *)a6 updateSvcTransactions:(id *)a7 removeSvcTransactions:(id *)a8;
- (BOOL)hasActiveWACPairing;
- (BOOL)hasAnyAccessoryWithAliroNFCSupport;
- (BOOL)hasAnyAccessoryWithAliroUWBSupport;
- (BOOL)hasAnyAccessoryWithUnifiedAccessWalletKeySupport;
- (BOOL)hasAnyAccessoryWithWalletKeyAndAccessCodeSupport;
- (BOOL)hasAnyAccessoryWithWalletKeySupport;
- (BOOL)hasAnyReachableAccessories;
- (BOOL)hasAnyResident;
- (BOOL)hasCharacteristicNotificationRegistrations;
- (BOOL)hasDemoAccessories;
- (BOOL)hasDemoPrimaryResident;
- (BOOL)hasNeverAddedAnyHAPAccessory;
- (BOOL)hasPostedWalletKeyOnboardingBulletinForAnyAccessory;
- (BOOL)hasResidentDevicesForPrimaryResidentChangeMonitor:(id)a3;
- (BOOL)hasSharedUser;
- (BOOL)hasSiriEndpointAccessory;
- (BOOL)hasThreadCapableResident;
- (BOOL)insertOrUpdateAudioAnalysisEventBulletinRegistrations:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 user:(id)a7 context:(id)a8;
- (BOOL)insertOrUpdateCameraAccessModeBulletinRegistration:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 user:(id)a7 context:(id)a8;
- (BOOL)insertOrUpdateCameraReachabilityBulletinRegistration:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 user:(id)a7 context:(id)a8;
- (BOOL)insertOrUpdateCameraSignificantEventBulletinRegistration:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 user:(id)a7 context:(id)a8;
- (BOOL)insertOrUpdateCharacteristicBulletinRegistration:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 homeMember:(id)a7 context:(id)a8;
- (BOOL)insertOrUpdateMatterBulletinRegistration:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 homeMember:(id)a7 context:(id)a8;
- (BOOL)isAccessAllowedForCharacteristicsWithMessage:(id)a3;
- (BOOL)isActiveNetworkRouterInitialSetupNeeded;
- (BOOL)isAdminUser;
- (BOOL)isAllowedToEnableAdaptiveTemperatureAutomations;
- (BOOL)isAnyBTLEAccessoryReachable;
- (BOOL)isAppleMediaAccessory:(id)a3;
- (BOOL)isAutomaticSoftwareUpdateEnabled;
- (BOOL)isAutomaticThirdPartyAccessorySoftwareUpdateEnabled;
- (BOOL)isCarPlayAccessAllowedForActionSet:(id)a3 withMessage:(id)a4 fromSource:(unint64_t)a5;
- (BOOL)isCarPlayAccessAllowedForCharacteristic:(id)a3 withMessage:(id)a4 fromSource:(unint64_t)a5;
- (BOOL)isClientIdentifierSubscribedToAppleMediaAccessoryState:(id)a3;
- (BOOL)isCompanionReachable;
- (BOOL)isCurrentDeviceAvailableResident;
- (BOOL)isCurrentDeviceConfirmedPrimaryResident;
- (BOOL)isCurrentDevicePairedWithWatchForSiriSecureAccessoryAccessController:(id)a3;
- (BOOL)isCurrentDevicePrimaryResident;
- (BOOL)isCurrentDevicePrimaryResidentForRemoteEventRouterClientController:(id)a3;
- (BOOL)isCurrentDeviceResidentCapableForRemoteEventRouterClientController:(id)a3;
- (BOOL)isCurrentDeviceThreadBorderRouterCapable;
- (BOOL)isCurrentDeviceThreadPreferredPrimaryResident;
- (BOOL)isCurrentUserRestrictedForRemoteEventRouterClientController:(id)a3;
- (BOOL)isDeviceIdentifierPrimaryResident:(id)a3;
- (BOOL)isDevicePrimaryResident:(id)a3;
- (BOOL)isEventLogEnabled;
- (BOOL)isLocalPresenceSupported;
- (BOOL)isMediaPeerToPeerEnabled;
- (BOOL)isMediaSystem:(id)a3;
- (BOOL)isOwnerUser;
- (BOOL)isPrimaryResidentNodeReachable;
- (BOOL)isRemoteAccessDeviceReachable;
- (BOOL)isResidentReachable:(id)a3;
- (BOOL)isResidentSupported;
- (BOOL)isSharedAdmin;
- (BOOL)isSidekickAccessory:(id)a3;
- (BOOL)isSiriPhraseOptionsHeySiriEnabled;
- (BOOL)isSiriPhraseOptionsJustSiriEnabled;
- (BOOL)isSmokeAlarmEnabled;
- (BOOL)isThisHomeMigratedToHH2;
- (BOOL)isThreadCapable;
- (BOOL)isThreadNetworkUp;
- (BOOL)ownerTrustZoneCapable;
- (BOOL)receivedRemoteMessageOverTransportType:(int)a3 remoteMessageSenderContext:(id)a4;
- (BOOL)remoteAccessIsEnabled;
- (BOOL)remoteEventAllowedForTopic:(id)a3 deviceType:(unint64_t)a4 userType:(unint64_t)a5;
- (BOOL)requiresRemoteFabricDataUpdateThroughPairingCompletionMessage;
- (BOOL)requiresUnlockToAccessCharacteristics:(id)a3 withMessage:(id)a4;
- (BOOL)residentSyncDidSync;
- (BOOL)router:(id)a3 shouldHandleMessage:(id)a4 usingRouter:(id)a5;
- (BOOL)sendMatterHMFMessageRequest:(id)a3;
- (BOOL)sendMatterMessagePayloadToPrimaryResident:(id)a3 timeout:(double)a4 responseHandler:(id)a5;
- (BOOL)setUpAccessoryServerBrowserWithOperationalFabricData:(id)a3 ownerDataSnapshot:(id)a4 error:(id *)a5;
- (BOOL)setUpOperationalFabricDataWithError:(id *)a3;
- (BOOL)shouldAccessoryRemovalFallbackToLocalRemovalOnError:(id)a3 accessory:(id)a4;
- (BOOL)shouldAllowTopic:(id)a3 forDeviceWithMessageIdentifier:(id)a4;
- (BOOL)shouldEncodeLegacyLocationServiceSettingForSettingsParentUUID:(id)a3;
- (BOOL)shouldPostBulletin;
- (BOOL)shouldRelayNotificationToRegisteredDevicesForSource:(id)a3;
- (BOOL)shouldRestrictAllMessagingToLocalTransportsForUser:(id)a3;
- (BOOL)shouldSendMatterCommandsToResident;
- (BOOL)shouldWeSendAutomationsToClients;
- (BOOL)storeIntoLegacyStorageWithFabricData:(id)a3;
- (BOOL)storeNewFabricData:(id)a3;
- (BOOL)storeSharedHomeFabricData:(id)a3;
- (BOOL)supportsDeviceWithCapabilities:(id)a3;
- (BOOL)supportsResidentSelection;
- (BOOL)supportsRouterManagement;
- (BOOL)supportsSiriEndpointOnBoarding;
- (BOOL)synchronouslyFetchIsCarPlayConnectedStatus;
- (BOOL)synchronouslyFetchIsConnectedToCarPlayNetwork;
- (BOOL)updateCHIPPropertiesOnHomeModel:(id)a3 usingUpdatedHomeInfo:(id)a4;
- (BOOL)updateFabricUsingHomeModel:(id)a3;
- (BOOL)updateMatterFabricIDIfNeeded;
- (BOOL)validateActionsDoNotConflict:(id)a3;
- (BOOL)watchSkipVersionCheck;
- (HMDAccessory)currentAccessory;
- (HMDAccessoryCount)accessoryCount;
- (HMDActionSet)_createActionSetWithUUID:(void *)a3 name:(void *)a4 type:(void *)a5 fromDictionary:(void *)a6 transaction:(void *)a7 response:(void *)a8 error:;
- (HMDActionSetStateObserver)actionSetStateObserver;
- (HMDActionSetStateSubscriptionManager)actionSetStateSubscriptionManager;
- (HMDBackingStore)backingStore;
- (HMDDevice)companionDevice;
- (HMDDevice)currentDevice;
- (HMDFeaturesDataSource)featuresDataSource;
- (HMDHAPAccessory)activeNetworkRouterAccessory;
- (HMDHome)initWithCoder:(id)a3;
- (HMDHome)initWithName:(id)a3 uuid:(id)a4 defaultRoomUUID:(id)a5 owner:(id)a6 homeManager:(id)a7 presenceAuth:(id)a8 dataSource:(id)a9;
- (HMDHome)initWithName:(id)a3 uuid:(id)a4 defaultRoomUUID:(id)a5 owner:(id)a6 homeManager:(id)a7 presenceAuth:(id)a8 dataSource:(id)a9 logEventSubmitter:(id)a10 carPlayDataSource:(id)a11 administratorHandlerFactory:(id)a12 localCapabilitiesDataSource:(id)a13 notificationCenter:(id)a14 keychainStore:(id)a15;
- (HMDHomeKitVersion)minHomeKitVersionForAccessoryNetworkProtectionChange;
- (HMDHomeKitVersion)minimumNetworkRouterSupportHomeKitVersion;
- (HMDHomeManager)homeManager;
- (HMDHomeNFCReaderKey)nfcReaderKey;
- (HMDHomePersonManager)personManager;
- (HMDHomePresenceCheck)homePresence;
- (HMDNaturalLightingContext)naturalLightingContext;
- (HMDNetworkRouterClientManager)routerClientManager;
- (HMDResidentDevice)userSelectedPreferredResident;
- (HMDSiriSecureAccessoryAccessController)siriSecureAccessoryAccessController;
- (HMDUser)currentUser;
- (HMDUserActivityStateDetectorManager)userActivityStateDetectorManager;
- (HMDUserPresenceFeeder)presenceFeeder;
- (HMEEventForwarder)eventForwarder;
- (HMFMessageDestination)messageDestination;
- (HMFWiFiManager)wifiManager;
- (HMHomeNetworkInfo)primaryResidentNetworkInfo;
- (HMHomePersonManagerSettings)personManagerSettings;
- (HMMDailyScheduler)dailyScheduler;
- (MTRDeviceController)matterDeviceController;
- (NSArray)accessories;
- (NSArray)accessoriesRequiringManualReconfigurationOnRouterRemoval;
- (NSArray)accessoriesWithAliroProvisioning;
- (NSArray)accessoriesWithWalletKeySupport;
- (NSArray)actionSets;
- (NSArray)appleMediaAccessories;
- (NSArray)autoSelectedPreferredResidents;
- (NSArray)cameraAccessories;
- (NSArray)enabledResidents;
- (NSArray)hapAccessories;
- (NSArray)hapAccessoriesForLegacyDataBlobEncoding;
- (NSArray)lpRooms;
- (NSArray)matterAccessories;
- (NSArray)mediaSessionStates;
- (NSArray)mediaSessions;
- (NSArray)mediaSystems;
- (NSArray)nativeMatterAccessories;
- (NSArray)outgoingInvitations;
- (NSArray)removedUsers;
- (NSArray)residentCapableDevices;
- (NSArray)residentEnabledDevices;
- (NSArray)rooms;
- (NSArray)serviceGroups;
- (NSArray)triggerOwnedActionSets;
- (NSArray)triggers;
- (NSArray)usersPendingUserManagementOperations;
- (NSArray)usersSupportingPresence;
- (NSArray)wiFiRouterAccessories;
- (NSArray)zones;
- (NSData)threadOperationalDataset;
- (NSDictionary)assistantObject;
- (NSHashTable)removeAccessoryInProgressForHMDAccessories;
- (NSMapTable)addPendingAccessories;
- (NSMutableDictionary)addPendingAccessorySetupCodeHandlers;
- (NSNumber)availableBSPsCount;
- (NSNumber)availableBorderRouters;
- (NSNumber)matterFabricID;
- (NSNumber)overriddenHomeAccessControl;
- (NSNumber)residentSelectionVersion;
- (NSSet)notificationDeregistrations;
- (NSSet)notificationRegistrations;
- (NSString)contextID;
- (NSString)name;
- (NSString)threadNetworkID;
- (NSString)unfilteredThreadNetworkID;
- (NSString)urlString;
- (NSUUID)activeNetworkRouterUUID;
- (NSUUID)contextSPIUniqueIdentifier;
- (NSUUID)primaryNetworkRouterManagingDeviceUUID;
- (id)__modelObjectsForRemovingOutgoingInvitationForUser:(id)a3;
- (id)__readWriteResponseHandler:(id)a3 unhandledRequests:(id)a4;
- (id)_addAccessoriesUsingPrimaryAccessoryModel:(void *)a3 updatedHomeInfo:(void *)a4 message:;
- (id)_addMediaSessionForCurrentAccessory:(id)a3;
- (id)_addOwnerToNewlyPairedAccessoryServer:(id)a3;
- (id)_appDataContainerForMessage:(id)a3;
- (id)_changedHMDCharacteristicsForHAPCharacteristics:(id)a3 stateNumber:(id)a4 broadcast:(BOOL)a5 accessoryServer:(id)a6;
- (id)_characteristicNotificationPayloadsOnDirectTransports:(BOOL)a3;
- (id)_characteristicUpdatesByDestinationForNotificationRegistryDestinations:(id)a3 bulletinDestinations:(id)a4 broadcast:(BOOL)a5;
- (id)_characteristicUpdatesForChangedCharacteristics:(id)a3 bulletinCharacteristics:(id)a4 broadcast:(BOOL)a5;
- (id)_checkResidentCapabilitiesForCredentialSharing:(id)a3;
- (id)_configureMatterV1Accessory:(id)a3 accessoryModel:(id)a4;
- (id)_configureTTUAndUWBOnAccessory:(id)a3 accessoryModel:(id)a4;
- (id)_configureWithFeatureSpecificDataAccessory:(id)a3 accessoryModel:(id)a4;
- (id)_createBuiltinActionSets;
- (id)_createEventsPayload:(uint64_t)a1;
- (id)_createMediaSessionWithEndpoint:(id)a3;
- (id)_createMessageForReadWriteRequest:(id)a3 source:(unint64_t)a4 withCompletionHandler:(id)a5;
- (id)_disablePayloadFromRemotelyUpdatedCharacteristicNotifications:(id)a3;
- (id)_enqueueRetrievalTupleForAccessory:(id)a3 linkType:(int64_t)a4 inProgress:(BOOL *)a5 completion:(id)a6;
- (id)_getReachabilityTupleForAccessoryUUID:(id)a3;
- (id)_handleRenameHomeModel:(id)a3 message:(id)a4;
- (id)_hasConfirmedPrimaryResidentDevice;
- (id)_hmdCharacteristicsForUpdatedHAPCharacteristics:(id)a3 accessoryServer:(id)a4;
- (id)_initWithCoder:(id)a3;
- (id)_outgoingInvitationForUserWithHandle:(id)a3;
- (id)_primaryAccessoryForServer:(id)a3;
- (id)_productDataFromHAPAccessory:(id)a3;
- (id)_pushTokenToDestinationMappingForDestinations:(id)a3;
- (id)_readDataNeededImmediatelyAfterPairing:(id)a3 intoModel:(id)a4;
- (id)_readRequestTuplesFromMessage:(id)a3 outUnhandledRequests:(id *)a4;
- (id)_removeAccessoriesCommon:(id)a3;
- (id)_removeUserFromNewlyPairedAccessoryServer:(id)a3 user:(id)a4;
- (id)_residentDeviceForResidentUser:(id)a3;
- (id)_residentUserForResidentDevice:(id)a3;
- (id)_residentUsers;
- (id)_retrieveTupleForPrimaryAccessory:(id)a3 linkType:(int64_t)a4;
- (id)_setupCodeProviderForMessage:(id)a3;
- (id)_setupDescriptionFromData:(id)a3 error:(id *)a4;
- (id)_splitCharacteristicChanges:(id)a3 changedAccessories:(id)a4;
- (id)_unexpectedCharacteristicsFromCharacteristicNotifications:(id)a3;
- (id)_updateAndGetOwnedTriggers;
- (id)_userForDevice:(id)a3;
- (id)accessCodeForMatterUserWithUserUniqueID:(id)a3;
- (id)accessoriesWithUUIDs:(id)a3;
- (id)accessoryAdministerPrivilegeCATID:(BOOL)a3;
- (id)accessoryOperatePrivilegeCATID:(BOOL)a3;
- (id)accessorySettingsMessengerMessageTargetUUID;
- (id)accessoryWithDeviceIdentifier:(id)a3;
- (id)accessoryWithEndpointIdentifier:(id)a3;
- (id)accessoryWithIdentifier:(id)a3;
- (id)accessoryWithSPIClientIdentifier:(id)a3;
- (id)accessoryWithUUID:(id)a3;
- (id)actionSetWithName:(id)a3;
- (id)actionSetWithUUID:(id)a3;
- (id)actionWithDictionaryRepresentation:(id)a3;
- (id)addActionSetName:(id)a3;
- (id)addName:(id)a3;
- (id)addUserAccessCodeForUser:(id)a3 fromOutgoingInvitation:(id)a4;
- (id)allNewlyConfiguredAccessories;
- (id)appleMediaAccessoryUUIDsForMediaStateSubscriber:(id)a3;
- (id)audioDestinationControllerDataForDestination:(id)a3;
- (id)auditOrAddRestrictedGuest:(id)a3 onAccessory:(id)a4 flow:(id)a5;
- (id)auditOrAddRestrictedGuestUserUniqueIdentifier:(id)a3 onAccessory:(id)a4 user:(id)a5 requireFullScheduleAudit:(BOOL)a6 flow:(id)a7;
- (id)backingStoreObjects:(int64_t)a3 hh2Migration:(BOOL)a4;
- (id)builtInActionSetInfo;
- (id)createAccessorySettingsLocalMessageHandlerWithHomeUUID:(id)a3 languageValuesDataProvider:(id)a4;
- (id)createAccessorySettingsMessengerWithMessageTargetUUID:(id)a3 messageDispatcher:(id)a4 messageRouter:(id)a5 messageHandler:(id)a6 logEventSubmitter:(id)a7;
- (id)createActionSetWithName:(id)a3 uuid:(id)a4 type:(id)a5;
- (id)createAppleMediaAccessoriesStateMessengerWithIdentifier:(id)a3 messageDispatcher:(id)a4;
- (id)createMultiuserSettingsMessenger:(id)a3 messageDispatcher:(id)a4;
- (id)createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:(id)a3 operationalKeyPair:(id)a4 error:(id *)a5;
- (id)createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:(id)a3;
- (id)createPrimaryResidentMessageRouterWithHomeUUID:(id)a3 messageDispatcher:(id)a4 metricsDispatcher:(id)a5;
- (id)createSiriEndpointProfileMessageHandlerWithHomeUUID:(id)a3;
- (id)createSiriEndpointProfilesMessengerWithMessageTargetUUID:(id)a3 messageDispatcher:(id)a4 messageRouter:(id)a5 messageHandler:(id)a6;
- (id)createUnifiedLanguageValueListSettingDataProvider;
- (id)createUserUniqueIDForAccessories;
- (id)currentAccessoryHomeUUID;
- (id)currentAccessorySetupMetricDispatcher;
- (id)currentAccessoryUUIDsForMediaStateSubscriber:(id)a3;
- (id)currentDeviceControllerNodeID;
- (id)dataProvidersForUnifiedLanguageValueListSettingDataProvider:(id)a3;
- (id)deletedBackingStoreObject;
- (id)descriptionWithPointer:(BOOL)a3;
- (id)destinationControllerDataForAppleMediaAccessory:(id)a3;
- (id)destinationControllerWithCommittedDestinationIdentifier:(id)a3;
- (id)destinationControllerWithDestinationIdentifier:(id)a3;
- (id)destinationControllerWithIdentifier:(id)a3;
- (id)destinationControllers;
- (id)destinationForAppleMediaAccessory:(id)a3;
- (id)destinationForEnabledResidents;
- (id)destinationForMediaSystem:(id)a3;
- (id)destinationManagerPassingTest:(id)a3;
- (id)destinationManagerWithDestinationIdentifier:(id)a3;
- (id)destinationManagerWithParentIdentifier:(id)a3;
- (id)destinationManagersWithDestinationIdentifiers:(id)a3 supportedOptions:(unint64_t)a4;
- (id)deviceForAccessoryUUID:(id)a3 forRemoteEventRouterClientController:(id)a4;
- (id)deviceForAppleMediaAccessoryMessageRouter:(id)a3 message:(id)a4;
- (id)deviceForPrimaryResidentForRemoteEventRouterClientController:(id)a3;
- (id)dumpActionSetDescriptionWithPrivacyLevel:(unint64_t)a3;
- (id)dumpBulletinNotificationRegistrationsState;
- (id)dumpCharacteristicNotificationRegistry;
- (id)dumpMediaSessionDescriptionWithPrivacyLevel:(unint64_t)a3;
- (id)dumpStateWithPrivacyLevel:(unint64_t)a3;
- (id)emptyModelObjectWithChangeType:(unint64_t)a3;
- (id)eventRouterDumpStateInfo;
- (id)eventRouterServerDiagnosticInfo;
- (id)eventSourceForMediaGroupsAggregator:(id)a3;
- (id)eventStoreReadHandle;
- (id)eventStoreReadHandleForRemoteEventRouterClientController:(id)a3;
- (id)eventStoreWriteHandleForRemoteEventRouterClientController:(id)a3;
- (id)executeMatterNaturalLightingActions:(id)a3;
- (id)expandedTopicsWithTopics:(id)a3;
- (id)fabricDataInLegacyStorage;
- (id)fetchOperationalFabricDataWithError:(id *)a3;
- (id)filterBuiltinActionSets:(id)a3;
- (id)findAdditionalUUIDsForUser:(id)a3;
- (id)findBulletinRegistration:(id)a3 source:(id)a4 homeMember:(id)a5 context:(id)a6;
- (id)findOrAddUser:(id)a3 onAccessory:(id)a4 didRedispatch:(BOOL)a5 flow:(id)a6;
- (id)findOrAddUserIndexForUserUUID:(id)a3 guestName:(id)a4 accessory:(id)a5 flow:(id)a6;
- (id)findOrAddUserUniqueIDForGuestAccessCode:(id)a3 onAccessory:(id)a4;
- (id)findUserIndexForUserUUID:(id)a3 guestName:(id)a4 accessory:(id)a5;
- (id)findUserSlotForUserUniqueIdentifier:(id)a3 onAccessory:(id)a4;
- (id)getBulletinBoardNotificationSerializedFileName;
- (id)getCameraNotificationSettingsSerializedFileName;
- (id)getOrCreateUniqueIDForAccessoriesForUser:(id)a3 flow:(id)a4;
- (id)getServiceTransaction:(id)a3 parentUUID:(id)a4 changeType:(unint64_t)a5;
- (id)getTransactionFromHAPAccessory:(id)a3 hmdAccessory:(id)a4 uuid:(id)a5 hostAccessoryUUID:(id)a6 objectChangeType:(unint64_t)a7;
- (id)handleFindOrAddUserUniqueIdentifier:(id)a3 onAccessory:(id)a4 flow:(id)a5;
- (id)handleRemoveUserUniqueIdentifier:(id)a3 fromAccessory:(id)a4;
- (id)hapAccessoriesForServer:(id)a3;
- (id)hapAccessoriesForServer:(id)a3 linkType:(int64_t)a4;
- (id)hapAccessoryServerIdentifiers;
- (id)hapAccessoryUniqueIdentifiers;
- (id)hapAccessoryWithIdentifier:(id)a3;
- (id)hapAccessoryWithIdentifier:(id)a3 instanceID:(id)a4;
- (id)hmdHAPAccessoryWithHAPAccessory:(id)a3;
- (id)homeBulletinContext;
- (id)homeConfigurationModelObjectWithChangeType:(unint64_t)a3;
- (id)homeConfigurationUUID;
- (id)homeLocationWithPrivacyLevel:(unint64_t)a3;
- (id)hubAccessories;
- (id)iCloudIdentifier;
- (id)invitationWithIDSInvitationIdentifier:(id)a3;
- (id)invitationWithInvitationIdentifier:(id)a3;
- (id)isAccessoryCertifiedForNaturalLighting:(id)a3;
- (id)languageValueList;
- (id)lightProfileWithUUID:(id)a3;
- (id)loadMigrationBulletinBoardNotificationsFromDisk;
- (id)loadMigrationCameraNotificationSettingsFromDisk;
- (id)localAndRemoteSubscriptionProvider;
- (id)matterAccessoriesWithNewFirmwareInstalledInHome;
- (id)matterAccessoryWithIdentifier:(id)a3;
- (id)matterAccessoryWithNodeID:(id)a3;
- (id)matterPathWithUUID:(id)a3;
- (id)mediaDestinationManagersWithHomeTheaterSupportedOptions;
- (id)mediaDestinationManagersWithSupportedOptions:(unint64_t)a3;
- (id)mediaDestinationsInRoom:(id)a3;
- (id)mediaGroupsAggregateDataTopicName;
- (id)mediaPassword;
- (id)mediaProfileForAppleMediaAccessoryUUID:(id)a3 mediaStateSubscriber:(id)a4;
- (id)mediaProfileWithUUID:(id)a3;
- (id)mediaSessionStateWithIdentifier:(id)a3;
- (id)mediaSessionWithIdentifier:(id)a3;
- (id)mediaSessionWithUUID:(id)a3;
- (id)mediaSystemController:(id)a3 accessoryForUUID:(id)a4;
- (id)mediaSystemForAppleMediaAccessory:(id)a3;
- (id)mediaSystemWithUUID:(id)a3;
- (id)mediaSystemsWithUUIDs:(id)a3;
- (id)messageTargetForDeviceIdentifier:(id)a3;
- (id)modelObjectWithChangeType:(unint64_t)a3 version:(int64_t)a4;
- (id)multiUserSettings;
- (id)namesOfServicesWithNewFirmwareAvailableInHome;
- (id)newFabricData;
- (id)notificationRegistrationsForAppleMediaAccessories;
- (id)operationalKeyPairForPairing;
- (id)outgoingInvitationToResendForUser:(id)a3;
- (id)outgoingInvitationWithUUID:(id)a3;
- (id)owner;
- (id)participantDataTopicForAccessory:(id)a3 mediaGroupsAggregator:(id)a4;
- (id)payloadFromEnableRegistrations:(id)a3 disableRegistration:(id)a4 source:(id)a5;
- (id)payloadFromRegistrations:(id)a3;
- (id)pendingUsers;
- (id)performReadRequests:(id)a3 loggingObject:(id)a4 flow:(id)a5;
- (id)performReadRequests:(id)a3 withRetries:(int64_t)a4 timeInterval:(double)a5 loggingObject:(id)a6 flow:(id)a7;
- (id)performWriteRequests:(id)a3 loggingObject:(id)a4 flow:(id)a5;
- (id)performWriteRequests:(id)a3 withRetries:(int64_t)a4 timeInterval:(double)a5 loggingObject:(id)a6 flow:(id)a7;
- (id)playbackArchiveWithSessionIdentifier:(id)a3;
- (id)preflightCheckLogEventWithSessionIdentifier:(id)a3 accessoryCategory:(id)a4 fetchDuration:(double)a5 firstImportCompleted:(BOOL)a6 hasMediaRouteIdentifier:(BOOL)a7 hasPairingIdentity:(BOOL)a8 hasConnectedEventRouterClient:(BOOL)a9 isCloudSignedIn:(BOOL)a10 hasManatee:(BOOL)a11 isIdsReady:(BOOL)a12 isOwnerUser:(BOOL)a13 homeUUID:(id)a14;
- (id)primaryResident;
- (id)primaryResidentDeviceIdentifierForRemoteEventRouterClientController:(id)a3;
- (id)privateDataSourceForNode:(id)a3;
- (id)receiverForParticipantAccessoryUUID:(id)a3 mediaGroupsLocalDataStorage:(id)a4;
- (id)registrationSourceFromPayload:(id)a3;
- (id)registrationsFromPayload:(id)a3 enabled:(BOOL)a4;
- (id)removeGuestAccessCode:(id)a3 fromAccessory:(id)a4;
- (id)removeName:(id)a3;
- (id)removeUser:(id)a3 fromAccessory:(id)a4;
- (id)removeUserFromMatterAccessories:(id)a3;
- (id)removeUsersFromAccessory:(id)a3;
- (id)replaceActionSetName:(id)a3 withNewName:(id)a4;
- (id)replaceName:(id)a3 withNewName:(id)a4;
- (id)resolveReceiverForMessageTargetUUID:(id)a3;
- (id)restrictedGuests;
- (id)retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:(id)a3;
- (id)retrieveNewlyAddedAccessoriesForPairedAccessoryServerInfo:(id)a3;
- (id)roomForAccessoryUUID:(id)a3;
- (id)roomForAllDestinationParentIdentifiers:(id)a3;
- (id)roomUUIDsSupportingLocalPresence;
- (id)roomWithName:(id)a3;
- (id)roomWithUUID:(id)a3;
- (id)roomWithUniqueIdentifier:(id)a3 forClientIdentifierSalt:(id)a4;
- (id)rootDestinationManagerWithDescendantDestinationIdentifier:(id)a3;
- (id)routerForParticipantAccessoryUUID:(id)a3 mediaGroupsLocalDataStorage:(id)a4;
- (id)routerServerUserAccessControlProviderForIdentifier:(id)a3;
- (id)routerServerUserAccessControlProviderIdentifierForMessage:(id)a3;
- (id)sameRoomAccessoryUUIDsForDestinationControllerData:(id)a3 mediaGroupsAggregator:(id)a4;
- (id)saveUserUniqueID:(id)a3 ForGuestAccessCode:(id)a4;
- (id)serviceGroupWithName:(id)a3;
- (id)serviceGroupWithUUID:(id)a3;
- (id)sharedHomeModel;
- (id)sharedUsers;
- (id)shortDescription;
- (id)storedFabricDataWithDataPresentInV2FabricDataStore:(BOOL *)a3 error:(id *)a4;
- (id)storedOperationalKeyPair;
- (id)storedSharedHomeFabricData;
- (id)targetAccessoriesWithDestinationIdentifiers:(id)a3;
- (id)triggerOwnedActionSetWithUUID:(id)a3;
- (id)triggerWithName:(id)a3;
- (id)triggerWithUUID:(id)a3;
- (id)uniqueIDsOfAllUsers;
- (id)updateHomeWithModel:(id)a3 message:(id)a4;
- (id)updatePersonManagerSettings:(id)a3;
- (id)userForActivityStatus:(id)a3;
- (id)userFromOutgoingInvitationModel:(id)a3;
- (id)userIncludingPendingUserWithUUID:(id)a3;
- (id)userUniqueIDForGuestAccessCode:(id)a3;
- (id)userWithMergeID:(id)a3;
- (id)userWithPairingIdentity:(id)a3;
- (id)userWithPairingIdentityIdentifier:(id)a3;
- (id)userWithUUID:(id)a3;
- (id)usersIncludingPendingUsers:(BOOL)a3;
- (id)validateName:(id)a3;
- (id)writeRequestTuplesFromMessage:(id)a3 outUnhandledRequests:(id *)a4;
- (id)zoneWithName:(id)a3;
- (id)zoneWithUUID:(id)a3;
- (int64_t)atHomeLevel;
- (int64_t)destinationTypeForDestinationWithIdentifier:(id)a3;
- (int64_t)homeLocation;
- (int64_t)minimumMediaUserPrivilege;
- (int64_t)protectionMode;
- (int64_t)reachableAccessoriesCount;
- (int64_t)reachableAccessoriesCountExcludingMatter;
- (int64_t)reachableAppleMediaAccessoriesCount;
- (uint64_t)isCharacteristicAllowedForCarPlayAccess:(void *)a1;
- (uint64_t)isMessageEntitledForCarPlayAccess:(uint64_t)a3 source:;
- (unint64_t)accessNotAllowedReasonCode;
- (unint64_t)accessoryCountForRoom:(id)a3;
- (unint64_t)accessorySettingsLocalMessageHandler:(id)a3 callerPrivilegeWithMessage:(id)a4;
- (unint64_t)assistantAccessCapableAccessoryCount;
- (unint64_t)deriveNetworkRouterSupport:(unint64_t)a3;
- (unint64_t)networkRouterSupport;
- (unint64_t)networkRouterSupportDisableReason;
- (unint64_t)numMatterV2Keys;
- (unint64_t)pendingUserPrivilegeFromOutgoingInvitationUUID:(id)a3;
- (unint64_t)threadNetworkSequenceNumber;
- (void)__addMediaSession:(id)a3;
- (void)__encodeAccessoriesWithCoder:(id)a3 options:(unint64_t)a4;
- (void)__handleAcceptedOutgoingInvitationResponse:(id)a3 destinationAddress:(id)a4 publicKey:(id)a5 username:(id)a6 reverseShare:(id)a7 reverseShareToken:(id)a8 issuerPublicKeyER:(id)a9 presenceAuthStatus:(id)a10 completionHandler:(id)a11;
- (void)__handleAddHAPAccessoryModel:(id)a3 message:(id)a4;
- (void)__handleAddMediaAccessoryModel:(id)a3 message:(id)a4;
- (void)__handleCompletedOutgoingInvitation:(id)a3;
- (void)__handleProcessStateChange:(id)a3;
- (void)__handleUpdateRestrictedGuestSettings:(id)a3;
- (void)__removeAccessory:(char)a3 isBeingReplaced:(int)a4 isForceUpdate:(void *)a5 message:;
- (void)__requestAccessoryBrowsing;
- (void)__sendOutgoingInvitation:(void *)a3 shareURL:(void *)a4 shareToken:(uint64_t)a5 suppressHomeInviteNotification:(void *)a6 logEventBuilder:;
- (void)__updateServiceTransaction:(id)a3 accessoryTransaction:(id)a4 service:(id)a5 accessory:(id)a6 hapService:(id)a7;
- (void)_accessoryPairingDidComplete:(id)a3 configuration:(id)a4 pairingEvent:(id)a5 accessoryServer:(id)a6 certificationStatus:(int64_t)a7 requestMessage:(id)a8;
- (void)_addAccessories:(id)a3;
- (void)_addAllUsersToAccessory:(id)a3;
- (void)_addAndMaybeAssociateMediaAccessory:(void *)a3 message:;
- (void)_addMediaAccessory:(id)a3 message:(id)a4;
- (void)_addNewTrigger:(id)a3 message:(id)a4 payloadAnnex:(id)a5 triggerModel:(id)a6;
- (void)_addOutgoingInvitations:(id)a3 message:(id)a4 transactionCompleted:(id)a5;
- (void)_addResidentWithUsername:(id)a3 publicKey:(id)a4 destination:(id)a5;
- (void)_addResponseTuplesFromDictionary:(id)a3 accessoryRequestMapTable:(id)a4 responseTuples:(id)a5 completedGroup:(id)a6 logEvents:(id)a7;
- (void)_addRetrievalCompletionTuple:(id)a3;
- (void)_addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3 message:(id)a4;
- (void)_addTransactionForMinimumNetworkRouterHomeKitVersion:(id)a3 message:(id)a4;
- (void)_addTransactionWithProtectionMode:(id)a3 message:(id)a4;
- (void)_addUserToContainer:(id)a3;
- (void)_addUserToIdentityRegistry:(id)a3;
- (void)_addUsersWithInviteInformations:(id)a3 message:(id)a4;
- (void)_applyDeviceLockCheck:(uint64_t)a3 forSource:(void *)a4 message:(void *)a5 completion:;
- (void)_applyNotificationDeregistrations;
- (void)_areWriteRequestsAllowed:(id)a3 message:(id)a4 completion:(id)a5;
- (void)_auditAccessForUsers;
- (void)_auditActionSetsAndTriggersForAccessory:(id)a3;
- (void)_auditAndDeregisterCharacteristicsForHAPAccessory:(id)a3;
- (void)_auditChangedCharacteristics:(id)a3;
- (void)_broadcastClearActivityHistoryToOwnerDevices;
- (void)_cancelPairingWithAccessoryDescription:(id)a3 context:(id)a4;
- (void)_cancelPairingWithAccessoryUUID:(id)a3 context:(id)a4 completionHandler:(id)a5;
- (void)_checkHomeManagerAppData:(void *)a1;
- (void)_cleanAddAccessoryOperations;
- (void)_cleanRemovedUsers:(id)a3;
- (void)_clearAccessoryNetworkProtectionStateWithTransaction:(id)a3;
- (void)_clearCHIPStorageWithCompletion:(id)a3;
- (void)_clearEventsWithCompletion:(id)a3;
- (void)_configureBulletinNotification;
- (void)_configureConfiguredResident:(id)a3 desiredConfigState:(unint64_t)a4 message:(id)a5;
- (void)_configureNetworkRouterClientManager:(id)a3;
- (void)_configureUnconfiguredResident:(id)a3 desiredConfigState:(unint64_t)a4;
- (void)_configureUserActivityStateDetectorManager;
- (void)_continueLegacyAddAccessoryWithUUID:(id)a3 unassociatedAccessory:(id)a4 setupCode:(id)a5 appID:(id)a6 message:(id)a7;
- (void)_continuePairingAfterUserConsentWithAccessoryDescription:(id)a3 progressHandlerDelegate:(id)a4 message:(id)a5;
- (void)_continuePairingAfterUserConsentWithAccessoryUUID:(id)a3 orUnassociatedAccessory:(id)a4 message:(id)a5;
- (void)_createModifyNotificationsCoalesceTimerIfNeeded;
- (void)_createUniquePSKClientConfigurationWithRequestMessage:(id)a3 pairingEvent:(id)a4 completion:(id)a5;
- (void)_dequeueRetrievalForAccessory:(id)a3 linkType:(int64_t)a4 error:(id)a5;
- (void)_deregisterDeviceForReachabilityNotification:(id)a3;
- (void)_deregisterPairedAccessory:(id)a3;
- (void)_didOnboardHindsightChanged;
- (void)_disableDirectCharacteristicNotificationsForClient:(id)a3;
- (void)_disableNotificationsForClient:(id)a3;
- (void)_disableNotificationsForDevices:(id)a3;
- (void)_dispatchCHIPReport:(id)a3 destination:(id)a4;
- (void)_enableMultiUserWithMessage:(void *)a1;
- (void)_enableNotificationsForDevices:(id)a3;
- (void)_encodeActionSets:(id)a3 coder:(id)a4;
- (void)_encodeObjectsWithAccessoriesWithCoder:(id)a3;
- (void)_encodeWithCoder:(id)a3;
- (void)_evaluateNetworkProtectionAndRouterManagement;
- (void)_evaluateNetworkProtectionSupport;
- (void)_evaluateNetworkRouterManagementForTransaction:(id)a3;
- (void)_evaluateOwnerTrustZoneCapabilityAndNotify;
- (void)_evaluateShouldRelaunchAndSetRelaunch;
- (void)_fetchMetadataFromPrimaryResidentWithCompletion:(id)a3;
- (void)_fetchMetadataOnCurrentDeviceWithCompletion:(id)a3;
- (void)_fetchThreadCredentialsAndStartThreadNetworkWithCompletion:(id)a3;
- (void)_fixupHindsightOnboarding;
- (void)_fixupUsersWithoutMergeID;
- (void)_getRunTimeStateUpdateWithOptions:(unint64_t)a3 includeMediaAccessorySessionState:(BOOL)a4 includeResidentDeviceState:(BOOL)a5 completion:(id)a6;
- (void)_grantAccessAndSendOutgoingInvitation:(id)a3 suppressHomeInviteNotification:(BOOL)a4;
- (void)_handleAccessoryReachabilityChange:(id)a3;
- (void)_handleAccessoryReachabilityUpdatesTimerFired;
- (void)_handleAddAccessory:(id)a3;
- (void)_handleAddAccessoryModel:(id)a3 message:(id)a4;
- (void)_handleAddAccessoryWithDescription:(id)a3;
- (void)_handleAddAccessoryWithDescription:(void *)a3 progressHandlerDelegate:(void *)a4 message:;
- (void)_handleAddActionSet:(id)a3;
- (void)_handleAddActionSetFromBuilder:(id)a3;
- (void)_handleAddActionSetModel:(id)a3 message:(id)a4;
- (void)_handleAddEventTrigger:(id)a3;
- (void)_handleAddEventTriggerModel:(id)a3 message:(id)a4;
- (void)_handleAddHomeOwnedActionSet:(id)a3;
- (void)_handleAddOutgoingHomeInvitationModel:(id)a3 message:(id)a4;
- (void)_handleAddRoom:(id)a3;
- (void)_handleAddRoomModel:(id)a3 message:(id)a4;
- (void)_handleAddServiceGroup:(id)a3;
- (void)_handleAddServiceGroupModel:(id)a3 message:(id)a4;
- (void)_handleAddTimerTrigger:(id)a3;
- (void)_handleAddTimerTriggerModel:(id)a3 message:(id)a4;
- (void)_handleAddTriggerOwnedActionSet:(id)a3;
- (void)_handleAddUserModel:(id)a3 message:(id)a4;
- (void)_handleAddZone:(id)a3;
- (void)_handleAddZoneModel:(id)a3 message:(id)a4;
- (void)_handleAllowUserManagementMessage:(id)a3;
- (void)_handleAssistantAccessControlUpdate:(id)a3;
- (void)_handleAudioAnalysisClassifierOptionsChange:(id)a3 message:(id)a4;
- (void)_handleAudioAnalysisClassifierOptionsUpdateRequest:(id)a3;
- (void)_handleAudioAnalysisOnboardingStatusChange:(id)a3 message:(id)a4;
- (void)_handleAudioAnalysisOnboardingUpdateRequest:(id)a3;
- (void)_handleCHIPSendRemoteRequestMessage:(id)a3;
- (void)_handleCancelPairingAccessory:(id)a3;
- (void)_handleCharacteristicEnableNotification:(id)a3;
- (void)_handleCharacteristicRead:(id)a3;
- (void)_handleCharacteristicWrite:(id)a3;
- (void)_handleCharacteristicsChangedNotification:(id)a3;
- (void)_handleClearActivityHistoryBroadcastMessage:(id)a3;
- (void)_handleCoalescedModifyNotifications;
- (void)_handleConfirmResidentRequest:(id)a3;
- (void)_handleCreateUniquePSKClientConfiguration:(id)a3;
- (void)_handleDidOnboardLocationServicesChange:(id)a3 message:(id)a4;
- (void)_handleDidReceiveIDSMessageWithNoListenerFromAddress:(id)a3;
- (void)_handleDisableNotificationsTimerFired;
- (void)_handleEnableMultiUserRequest:(id)a3;
- (void)_handleEnableNotifications:(id)a3;
- (void)_handleEventLogClearMessage:(id)a3;
- (void)_handleEventLogSetDidOnboard:(id)a3;
- (void)_handleEventLogSetDurationMessage:(id)a3;
- (void)_handleEventLogSetEnabledMessage:(id)a3;
- (void)_handleExecuteActionSet:(id)a3;
- (void)_handleExecuteConfirmationOfTrigger:(id)a3;
- (void)_handleFetchOrCreateReaderKey:(id)a3;
- (void)_handleFetchTriggerNameRequest:(id)a3;
- (void)_handleFetchUniqueIdentifierForBundleIdentifier:(id)a3;
- (void)_handleHAPAccessoryCharacteristicsUpdatedForAccessory:(id)a3;
- (void)_handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:(id)a3 message:(id)a4;
- (void)_handleHomeDataRequest:(id)a3;
- (void)_handleHomeLocationChange:(int64_t)a3 previousLocation:(int64_t)a4;
- (void)_handleHomeLocationUpdateFromSharedAdmin:(id)a3;
- (void)_handleHomeUpdateDidOnboardLocationServicesRequest:(id)a3;
- (void)_handleHomeUpdateLocationServicesEnabledRequest:(id)a3;
- (void)_handleIncomingMTRPluginMatterRequest:(id)a3;
- (void)_handleJoinOrFormThreadNetworkMessage:(id)a3;
- (void)_handleLegacyAddAccessory:(id)a3;
- (void)_handleLocationServicesEnabledChange:(id)a3 message:(id)a4;
- (void)_handleMatterLockChangedCharacteristics:(id)a3 message:(id)a4 remoteRequest:(BOOL)a5;
- (void)_handleMediaContentProfileAccessControlUpdate:(id)a3;
- (void)_handleMediaPropertiesRead:(id)a3;
- (void)_handleMediaPropertiesWrite:(id)a3;
- (void)_handleModifyCharacteristicNotifications:(id)a3;
- (void)_handleMultiUserEnabledChange:(id)a3 message:(id)a4;
- (void)_handleMultipleCharacteristicRead:(id)a3;
- (void)_handleMultipleCharacteristicWrite:(id)a3;
- (void)_handleNetworkProtectionModeChangeForTransaction:(id)a3;
- (void)_handleOutgoingInvitations:(id)a3;
- (void)_handleOwnerSettingsUpdate:(id)a3;
- (void)_handlePrimaryResidentDidBecomeCurrentDevice;
- (void)_handlePrimaryResidentDidBecomeOtherDevice;
- (void)_handleQueryResidentReachabilityForAccessories:(id)a3;
- (void)_handleReadMediaProperties:(id)a3 source:(unint64_t)a4 message:(id)a5 completionHandler:(id)a6;
- (void)_handleReceivedNonCloudSourcedSharedHomeModel;
- (void)_handleRemoteAddHAPAccessories:(id)a3;
- (void)_handleRemoteAddMediaAccessory:(id)a3;
- (void)_handleRemoteAddMediaAccessoryRequest:(id)a3;
- (void)_handleRemoteGatewayNotificationRegistration:(id)a3 enable:(BOOL)a4;
- (void)_handleRemoteReachabilityNotificationTimerFired;
- (void)_handleRemoteUserClientCloudShareRepairRequest:(id)a3;
- (void)_handleRemoteUserClientCloudShareRequest:(id)a3;
- (void)_handleRemoveAccessoryAfterUserConsent:(id)a3 message:(id)a4;
- (void)_handleRemoveAccessoryMessage:(id)a3;
- (void)_handleRemoveAccessoryModel:(id)a3 message:(id)a4;
- (void)_handleRemoveActionSet:(id)a3;
- (void)_handleRemoveActionSetModel:(id)a3 message:(id)a4;
- (void)_handleRemoveAppDataModel:(id)a3 message:(id)a4;
- (void)_handleRemoveClientConfiguration:(id)a3;
- (void)_handleRemoveOutgoingHomeInvitationModel:(id)a3 message:(id)a4;
- (void)_handleRemoveRoom:(id)a3;
- (void)_handleRemoveRoomModel:(id)a3 message:(id)a4;
- (void)_handleRemoveServiceGroup:(id)a3;
- (void)_handleRemoveServiceGroupModel:(id)a3 message:(id)a4;
- (void)_handleRemoveTrigger:(id)a3;
- (void)_handleRemoveTriggerModel:(id)a3 message:(id)a4;
- (void)_handleRemoveUser:(id)a3;
- (void)_handleRemoveUserModel:(id)a3 message:(id)a4;
- (void)_handleRemoveZone:(id)a3;
- (void)_handleRemoveZoneModel:(id)a3 message:(id)a4;
- (void)_handleRename:(id)a3;
- (void)_handleRequestHomeDataSync:(id)a3;
- (void)_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)a3;
- (void)_handleResetMatterStorageRequest:(id)a3;
- (void)_handleResidentChange;
- (void)_handleResolveThreadNetworkRequest:(id)a3;
- (void)_handleResponseForElectMessageToResident:(id)a3 error:(id)a4;
- (void)_handleRetrieveAsyncResults:(id)a3;
- (void)_handleRetrieveHomeLocationForFeedback:(id)a3;
- (void)_handleRollACWGIssuerKey:(id)a3;
- (void)_handleRollReaderKey:(id)a3;
- (void)_handleSendingNotificationsForRequest:(id)a3 requestIdentifier:(id)a4 supportsMultiPartResponse:(BOOL)a5 characteristicUpdates:(id)a6 completion:(id)a7;
- (void)_handleSetAppData:(id)a3;
- (void)_handleSetDismissedUWBOnboarding:(id)a3;
- (void)_handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest:(id)a3;
- (void)_handleSetHasOnboardedForAccessCodeChange:(id)a3 message:(id)a4;
- (void)_handleSetHasOnboardedForAccessCodeMessage:(id)a3;
- (void)_handleSetHasOnboardedForWalletKeyChange:(id)a3 message:(id)a4;
- (void)_handleSetHomeManagerAppData:(id)a3;
- (void)_handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3;
- (void)_handleSetMinimumNetworkRouterHomeKitVersion:(id)a3;
- (void)_handleSetResidentElectionVersion:(id)a3;
- (void)_handleSharedUserSettingsUpdate:(id)a3;
- (void)_handleSiriPhraseOptionsStatusChange:(id)a3 message:(id)a4;
- (void)_handleSiriPhraseOptionsUpdateRequest:(id)a3;
- (void)_handleSoundCheckChange:(id)a3 message:(id)a4;
- (void)_handleSoundCheckUpdateRequest:(id)a3;
- (void)_handleStartDiscoveringSymptomsForNearbyDevicesMessage:(id)a3;
- (void)_handleStopDiscoveringSymptomsForNearbyDevicesMessage:(id)a3;
- (void)_handleTestUpgradeToROAR:(id)a3;
- (void)_handleThreadNetworkCredentialsRequest:(id)a3;
- (void)_handleUnjoinThreadNetworkMessage:(id)a3;
- (void)_handleUpdateAppDataModel:(id)a3 message:(id)a4;
- (void)_handleUpdateAudioAnalysisAccess:(id)a3;
- (void)_handleUpdateAutomaticSoftwareUpdate:(id)a3;
- (void)_handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate:(id)a3;
- (void)_handleUpdateMediaPassword:(id)a3;
- (void)_handleUpdateMediaPeerToPeerEnabled:(id)a3;
- (void)_handleUpdateMinimumMediaUserPrivilege:(id)a3;
- (void)_handleUpdateNetworkProtection:(id)a3;
- (void)_handleUpdateNetworkProtectionWithHomeModel:(id)a3 message:(id)a4;
- (void)_handleUpdateOutgoingInvitationState:(id)a3;
- (void)_handleUpdatePresenceConsent:(id)a3;
- (void)_handleUpdateRequestForHomeInvitation:(id)a3 controllerPublicKey:(id)a4 controllerUsername:(id)a5 invitationState:(int64_t)a6 presenceAuthStatus:(id)a7 preferredUserID:(id)a8 fromHandle:(id)a9 fromAddress:(id)a10 fromMergeID:(id)a11 reverseShareURL:(id)a12 reverseShareToken:(id)a13 issuerPublicKeyER:(id)a14 message:(id)a15 messageResponseHandler:(id)a16;
- (void)_handleUpdateRestrictedGuestSettings:(id)a3;
- (void)_handleUpdateUserAccess:(id)a3;
- (void)_handleUpdateUserAnnounceAccess:(id)a3;
- (void)_handleUpdateUserCamerasAccessLevel:(id)a3;
- (void)_handleUserConsentForAccessoryReplacement:(id)a3 consent:(BOOL)a4 message:(id)a5;
- (void)_handleUserConsentResponseForAccessory:(id)a3;
- (void)_handleUserInvitations:(id)a3;
- (void)_handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:(id)a3;
- (void)_handleWriteMediaProperties:(id)a3 source:(unint64_t)a4 requestMessage:(id)a5 completionHandler:(id)a6;
- (void)_homeManagerAppDataChanged:(id)a3;
- (void)_incrementCurrentSequenceNumber;
- (void)_loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance:(id)a3;
- (void)_locallyAddMediaAccessory:(void *)a3 message:;
- (void)_maybeCheckACWGLocksForMFiCertificationWithContentVersion:(void *)a1;
- (void)_maybeFixHindsightOnboardingOnCurrentDevice;
- (void)_notificationPayloadsForRemoteGateway:(void *)a3 accessories:(void *)a4 enableCharacteristicNotificationPayload:(void *)a5 characteristicNotificationThresholdsPayload:(void *)a6 disableCharacteristicNotificationPayload:(void *)a7 enableMediaNotificationPayload:(void *)a8 disableMediaNotificationPayload:;
- (void)_notifyChangedActionSetResponses:(id)a3 notificationUpdateIdentifier:(id)a4 toUserDeviceAddress:(id)a5;
- (void)_notifyChangedProperties:(id)a3 withRequestIdentifier:(id)a4 notificationUpdateIdentifier:(id)a5 toUserDeviceAddress:(id)a6;
- (void)_notifyClientOfNewlyAddedAccessories:(id)a3 requestMessage:(id)a4;
- (void)_notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)a3 shouldRefreshBadge:(BOOL)a4 withCompletion:(id)a5;
- (void)_notifyClientsOfUpdatedResidentUser:(id)a3;
- (void)_notifyRemoteUsersOfChangedActionSetResponses:(id)a3;
- (void)_notifyRemoteUsersOfChangedCharacteristics:(id)a3 message:(id)a4 broadcast:(BOOL)a5;
- (void)_notifyRemoteUsersOfChangedProperties:(id)a3 requestMessageInformation:(id)a4;
- (void)_notifyRetrievalError:(id)a3 accessoryServer:(id)a4 linkType:(int64_t)a5 accessoryOperationBlock:(id)a6;
- (void)_notifyThreadLayerOfResidentChange;
- (void)_notifyUpdatedCharacteristic:(id)a3 withRequestIdentifier:(id)a4 notificationUpdateIdentifier:(id)a5 toUserDeviceAddress:(id)a6 completion:(id)a7;
- (void)_pairAccessoryWithAccessoryDescription:(id)a3 configuration:(id)a4 pairingEvent:(id)a5 progressHandler:(id)a6 requestMessage:(id)a7;
- (void)_pairAccessoryWithAccessoryDescription:(id)a3 unpairedAccessory:(id)a4 configuration:(id)a5 pairingEvent:(id)a6 requestMessage:(id)a7;
- (void)_performAllowedWriteCharacteristicValues:(uint64_t)a3 source:(void *)a4 identifier:(uint64_t)a5 qualityOfService:(void *)a6 withCompletionHandler:(void *)a7 activity:;
- (void)_performMediaGroupReadinessCheckAndSubmitMetricEventWithMessage:(id)a3;
- (void)_performOperation:(id)a3 completion:(id)a4;
- (void)_performRemoteAddHAPAccessories:(id)a3;
- (void)_performUpdateBulletinRegistrations:(id)a3;
- (void)_postInternalNotificationForChangedCharacteristics:(id)a3 previouslyNilChangedCharacteristics:(id)a4 modifiedCharacteristics:(id)a5 changedByThisDevice:(BOOL)a6 residentShouldNotifyPeers:(BOOL)a7 message:(id)a8 broadcast:(BOOL)a9;
- (void)_processAccessoriesToAddForUnpairedAccessory:(id)a3 certificationStatus:(int64_t)a4 accessoryServer:(id)a5 networkCredential:(id)a6 pairingEvent:(id)a7 message:(id)a8 completionHandler:(id)a9;
- (void)_processLegacyPairingRequestForMessage:(id)a3 cancelPairing:(BOOL)a4 context:(id)a5;
- (void)_processNewlyPairedAccessoryServerInfo:(id)a3 message:(id)a4 completionHandler:(id)a5;
- (void)_processOutgoingInvitationsRequest:(id)a3;
- (void)_processPairingRequestForMessage:(id)a3 cancelPairing:(BOOL)a4 context:(id)a5;
- (void)_processProductDataForNewlyAddedAccessory:(id)a3 transaction:(id)a4;
- (void)_processUnacceptReverseShareAccessForUsers;
- (void)_processUnsentOutgoingInvitations;
- (void)_processUpdatedAccessoryServer:(id)a3 reAddServices:(BOOL)a4;
- (void)_processUpdatedProductDataForAccessory:(id)a3 hapAccessory:(id)a4 transaction:(id)a5;
- (void)_purgeResidentUsers;
- (void)_reachabilityChangedForAccessory:(id)a3 reachable:(BOOL)a4;
- (void)_readCharacteristicValues:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 withCompletionHandler:(id)a6;
- (void)_readLocalHomeKeyMiscInfo;
- (void)_readProfileState:(void *)a3 viaDevice:;
- (void)_reconfigureAccessoriesOnRouterRemovalWithCompletion:(id)a3;
- (void)_reevaluateAccessoryInfoWithBadgeRefresh:(BOOL)a3;
- (void)_refreshCharacteristicValuesOnHomeNotificationEnable;
- (void)_refreshUserDisplayNames;
- (void)_registerDeviceForReachabilityNotification:(id)a3 accessoryList:(id)a4;
- (void)_registerForAccessoryReachabilityNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5;
- (void)_registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5;
- (void)_registerForMatterRequests;
- (void)_registerForMessages;
- (void)_registerForNotifications;
- (void)_registerForReachabilityChangeNotificationsEnabled:(BOOL)a3 completionHandler:(id)a4;
- (void)_registerForThreadNetworkEvents;
- (void)_registerPairedAccessory:(id)a3 transports:(unint64_t)a4 setupHash:(id)a5;
- (void)_registerPerformMediaGroupReadinessCheckMessage;
- (void)_registerThreadResidentCommissioningMessageHandlers;
- (void)_relayAddTriggerToResident:(id)a3;
- (void)_remoteAccessEnabled:(BOOL)a3;
- (void)_remoteAccessHealthMonitorTimerDidFire;
- (void)_remotelyAddMediaAccessory:(void *)a3 usingRemoteMessageName:(void *)a4 message:(void *)a5 fallbackBlock:;
- (void)_remotelySetNotificationsEnabled:(BOOL)a3 forActionSetUUIDs:(id)a4;
- (void)_remotelySetNotificationsEnabled:(BOOL)a3 forCharacteristics:(id)a4 characteristicChangeThresholds:(id)a5;
- (void)_remotelySetNotificationsEnabled:(BOOL)a3 forMatterAttributes:(id)a4;
- (void)_removeAccessories:(id)a3 message:(id)a4;
- (void)_removeAccessoriesForPrimaryAccessory:(id)a3 error:(id)a4 completionHandler:(id)a5;
- (void)_removeAccessoriesFromContainers:(id)a3;
- (void)_removeAccessory:(id)a3 completionHandler:(id)a4;
- (void)_removeAccessoryWithUUID:(id)a3 message:(id)a4;
- (void)_removeAllHomeContentsAndAccessoryPairings:(BOOL)a3 queue:(id)a4 completionHandler:(id)a5;
- (void)_removeClientConfigurationWithIdentifier:(id)a3;
- (void)_removeClientConfigurationWithIdentifier:(id)a3 completion:(id)a4;
- (void)_removeCloudData;
- (void)_removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:(id)a3;
- (void)_removeCorruptAccessories;
- (void)_removeFailedAddWithAccessoryServerInfo:(id)a3;
- (void)_removeMediaSessionWithIdentifier:(id)a3;
- (void)_removeOutgoingInvitationForUser:(id)a3;
- (void)_removePendingAccessoryAdd:(id)a3;
- (void)_removeRetrievalCompletionTuple:(id)a3;
- (void)_removeService:(id)a3;
- (void)_removeTrigger:(id)a3 message:(id)a4;
- (void)_removeUser:(id)a3;
- (void)_removeUser:(id)a3 message:(id)a4;
- (void)_removeUserFromContainer:(id)a3;
- (void)_removeWithMergeSecondaryAccessory:(id)a3 removedFromBridgeAccessory:(id)a4 completionHandler:(id)a5;
- (void)_requestRemoveClientConfigurationWithIdentifier:(id)a3;
- (void)_requestUniquePSKClientConfigurationWithCompletion:(id)a3;
- (void)_resubscribeForNotificationsOnResident:(id)a3;
- (void)_retrieveHAPAccessoryForHMDHAPAccessory:(id)a3 linkType:(int64_t)a4 forceRetrieve:(BOOL)a5 completion:(id)a6;
- (void)_retrievePreferredNetworkOnControllerWithCompletion:(id)a3;
- (void)_retryStartThreadNetwork:(double)a3;
- (void)_saveAndSyncMatterFabricIDWithCompletion:(id)a3;
- (void)_saveOutgoingInvitationsWithRestrictedGuestSettings:(id)a3 inTransaction:(id)a4 message:(id)a5 transactionCompleted:(id)a6;
- (void)_saveRestrictedGuestSettingsFromOutgoingInvitation:(id)a3 managedObjectContext:(id)a4 error:(id *)a5;
- (void)_scheduleApplyNetworkRouterSettingsAction:(id)a3;
- (void)_sendClientCharacteristicsChangedNotificationWithIdentifier:(id)a3 requestMessage:(id)a4 multiPartResponse:(BOOL)a5 moreInMultiPartResponse:(BOOL)a6 characteristicChanges:(id)a7 completionHandler:(id)a8;
- (void)_sendCoalescedRemoteNotificationsForRequestMessage:(id)a3 accessories:(id)a4;
- (void)_sendInvitation:(id)a3 message:(id)a4 shareURL:(id)a5 shareToken:(id)a6 suppressHomeInviteNotification:(BOOL)a7 logEventBuilder:(id)a8;
- (void)_sendInvitationCancelationRequestToInvitee:(id)a3;
- (void)_sendRemoteMessageUsingNodeId:(unint64_t)a3 payload:(id)a4 completion:(id)a5;
- (void)_sendRemoveCompletionStatusForHMDAccessories:(id)a3 withCompletion:(id)a4 error:(id)a5;
- (void)_sendResidentInviteWithDestination:(id)a3;
- (void)_setAccessories:(id)a3;
- (void)_setupActiveNetworkRouterAccessory:(id)a3 existingRouterAccessories:(id)a4;
- (void)_startHomeNotificationDeregistrationTimer;
- (void)_startThreadNetworkOnCommissionerWithCompletion:(id)a3;
- (void)_startThreadNetworkOnCommissionerWithOperationalDataset:(id)a3 completion:(id)a4;
- (void)_startThreadNetworkOnControllerWithCompletion:(id)a3;
- (void)_startThreadNetworkOnResidentWithCompletion:(id)a3;
- (void)_startThreadNetworkWithCompletion:(id)a3;
- (void)_stopThreadNetworkWithCompletion:(id)a3;
- (void)_subscribeForHomeNotificationsFromRemoteGateway:(BOOL)a3 accessories:(id)a4;
- (void)_subscribeForHomeNotificationsOnDirectTransports:(void *)a1;
- (void)_subscribeForNotificationFromRemoteGateway:(void *)a1;
- (void)_synchronizeHindsightCloudShareManager;
- (void)_unconfigureNetworkRouterClientManager;
- (void)_unconfigurePairedAccessoriesForServer:(id)a3 updateReachability:(BOOL)a4;
- (void)_unitTest_setRetrievalCompletionsTimeout:(double)a3;
- (void)_unjoinThreadNetworkWithCompletion:(id)a3;
- (void)_unregisterForThreadNetworkEvents;
- (void)_updateActiveNetworkRouterAccessory:(id)a3 isReplacement:(BOOL)a4 withTransaction:(id)a5;
- (void)_updateConfigurationStateForResidentDevice:(id)a3 desiredConfigState:(unint64_t)a4 message:(id)a5;
- (void)_updateConfigurationVersion;
- (void)_updateExpectConfigurationVersion;
- (void)_updateHomeLocation;
- (void)_updateOwnerSettingDependents:(id)a3 keyPath:(id)a4 value:(id)a5;
- (void)_updateReachabilityChangeToRegisteredDevices:(id)a3;
- (void)_updateRestrictedGuestHomeAccessSettingsFromOutgoingInvitation:(id)a3 forUserModel:(id)a4;
- (void)_updateThreadNetworkWithModel:(id)a3 message:(id)a4;
- (void)_updateWoWState:(id)a3;
- (void)_wol_processChangedCharacteristicResponses:(id)a3;
- (void)_writeAccessoryCapabilities:(id)a3 accessoryUUID:(id)a4 homeUUID:(id)a5;
- (void)_writeCharacteristicValues:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 biomeSource:(unint64_t)a6 withCompletionHandler:(id)a7;
- (void)_writeCharacteristicValues:(void *)a3 source:(void *)a4 message:(void *)a5 identifier:(void *)a6 qualityOfService:(void *)a7 withCompletionHandler:(void *)a8 activity:;
- (void)_writeLogData:(id)a3 logName:(id)a4 completion:(id)a5;
- (void)_writeResidentCapabilities:(id)a3 accessoryUUID:(id)a4 homeUUID:(id)a5;
- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didDiscoverAccessories:(id)a5 transaction:(id)a6 error:(id)a7;
- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didStopPairingWithError:(id)a5;
- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateCategory:(id)a5;
- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateHasPairings:(BOOL)a5;
- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateValuesForCharacteristics:(id)a5 stateNumber:(id)a6 broadcast:(BOOL)a7;
- (void)accessoryBrowser:(id)a3 didAddAccessoryAdvertisement:(id)a4;
- (void)accessoryBrowser:(id)a3 didFindAccessoryServer:(id)a4 stateChanged:(BOOL)a5 stateNumber:(id)a6 completion:(id)a7;
- (void)accessoryBrowser:(id)a3 didFindAccessoryServerNeedingReprovisioning:(id)a4 error:(id)a5;
- (void)accessoryBrowser:(id)a3 didFinishPairingForAccessoryServer:(id)a4;
- (void)accessoryBrowser:(id)a3 didFinishWACForAccessoryWithIdentifier:(id)a4 error:(id)a5;
- (void)accessoryBrowser:(id)a3 didRemoveAccessoryAdvertisement:(id)a4;
- (void)accessoryBrowser:(id)a3 didRemoveAccessoryServer:(id)a4 error:(id)a5;
- (void)accessoryBrowser:(id)a3 didTombstoneAccessoryServer:(id)a4;
- (void)accessoryBrowser:(id)a3 didUpdateEndpoint:(id)a4;
- (void)accessoryBrowser:(id)a3 discoveryFailedWithError:(id)a4 accessoryServer:(id)a5 linkType:(int64_t)a6;
- (void)actionSetResponsePayloadForActionSetsPayload:(id)a3 completion:(id)a4;
- (void)addAccessory:(id)a3;
- (void)addCompanionAsResidentUser:(id)a3;
- (void)addMediaSession:(id)a3;
- (void)addMediaSessionState:(id)a3;
- (void)addNewlyConfiguredAccessories:(id)a3 addSessionIdentifier:(id)a4;
- (void)addNotificationDeregistrationForClientIdentifier:(id)a3;
- (void)addNotificationRegistrationForClientIdentifier:(id)a3 includesAppleMediaAccessories:(BOOL)a4;
- (void)addOutgoingInvitation:(id)a3;
- (void)addResidentCapableDevice:(id)a3;
- (void)addSharedUserEventBuilder:(id)a3;
- (void)addSharedUserResponseEventBuilder:(id)a3;
- (void)addToCurrentTriggers:(id)a3;
- (void)addUnconfiguredResidentDevice:(id)a3;
- (void)addUser:(id)a3;
- (void)aggregator:(id)a3 accessoryCapabilitiesWithUUID:(id)a4 completion:(id)a5;
- (void)aggregator:(id)a3 changedAccessoryCapabilities:(id)a4 rawCapabilities:(id)a5 accessoryUUID:(id)a6 homeUUID:(id)a7;
- (void)aggregator:(id)a3 changedResidentCapabilities:(id)a4 rawCapabilities:(id)a5 accessoryUUID:(id)a6 homeUUID:(id)a7;
- (void)aggregator:(id)a3 didReceiveDeviceIRKWithUUID:(id)a4 deviceIRK:(id)a5;
- (void)aggregator:(id)a3 didReceivePublicPairingKeyWithUUID:(id)a4 pairingIdentity:(id)a5;
- (void)aggregator:(id)a3 didReceiveSoftwareVersionWithUUID:(id)a4 softwareVersion:(id)a5;
- (void)aggregator:(id)a3 residentCapabilitiesWithUUID:(id)a4 completion:(id)a5;
- (void)aggregatorDidBecomePrimary:(id)a3;
- (void)auditAccessForUsers;
- (void)auditDestinationsForNotifications:(id)a3;
- (void)btleAccessoryReachabilityProbeTimer:(BOOL)a3;
- (void)canReachPrimaryResidentChanged;
- (void)checkForCATIDUpdate:(id)a3;
- (void)clearAccessoryServerBrowserOperationalFabricData;
- (void)clientController:(id)a3 didReceiveFetchedCachedEvents:(id)a4 source:(id)a5;
- (void)clientController:(id)a3 primaryClientConnectMessageFailWithError:(id)a4;
- (void)completePotentialFabricDataCreation;
- (void)computeBridgedAccessoriesForAllBridges;
- (void)configureAccessorySettingsMessengerWithMessengerFactory:(id)a3 messageHandlerFactory:(id)a4;
- (void)configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:(id)a3 accessories:(id)a4 uncommittedTransactions:(id)a5;
- (void)configureBulletinNotification;
- (void)configureMediaDestinationControllersForAccessories:(id)a3;
- (void)configureMediaGroupObjects;
- (void)configureMediaGroupsAggregateConsumer;
- (void)configureMediaGroupsAggregator;
- (void)configureMediaGroupsUnconfiguredParticipantOnboardingManager;
- (void)configureMediaSystems;
- (void)configureMultiuserSettingsMessengerWithMessengerFactory:(id)a3;
- (void)configureNaturalLightingForDemoMode;
- (void)configureNaturalLightingWithDemoModeEnabled:(BOOL)a3;
- (void)configurePrimaryResidentMessageRouterWithFactory:(id)a3 metricsDispatcherFactory:(id)a4;
- (void)configureRemoteEventRouterClientControllerForAccessories:(id)a3;
- (void)configureSiriEndpointProfilesMessengerWithMessengerFactory:(id)a3 messageHandlerFactory:(id)a4;
- (void)configureUnifiedLanguageValueListSettingDataProviderWithFactory:(id)a3;
- (void)configureUserActivityStateDetectorManager;
- (void)connectToThreadAccessoryWithExtendedMACAddress:(id)a3 completion:(id)a4;
- (void)createAndConfigureBulletinManagers;
- (void)createRemoteEventRouterServerIfNeeded;
- (void)dealloc;
- (void)deregisterForMessagesInDemoModeV2;
- (void)didReceiveAccessorySetting:(id)a3 accessoryUUID:(id)a4;
- (void)didUpdateAggregateDataForMediaGroupsAggregateConsumer:(id)a3;
- (void)disableBulletinRegistrations:(id)a3 source:(id)a4 homeMember:(id)a5 context:(id)a6;
- (void)disableNotificationsForDevices:(id)a3;
- (void)discoverPrimaryResidentForEventRouterClientController:(id)a3;
- (void)dispatchRequestToEvaluateCondition:(id)a3 forCharacteristics:(id)a4 completion:(id)a5;
- (void)doFullImportWithCompletion:(id)a3;
- (void)downloadLogWithController:(id)a3 nodeId:(id)a4 type:(int64_t)a5 timeout:(double)a6 completion:(id)a7;
- (void)enableMultiUser;
- (void)enableNotificationsForDevices:(id)a3;
- (void)enableUserListeningHistoryForAccessoryUUID:(id)a3 userUUID:(id)a4;
- (void)encodeMediaSystemsWithCoder:(id)a3 modifiedOptions:(unint64_t)a4;
- (void)encodeWithCoder:(id)a3;
- (void)endReportingSessionForMessage:(id)a3;
- (void)evaluateBulletinNotificationsSupported;
- (void)evaluateNotificationConditionForCharacteristics:(id)a3 homePresence:(id)a4 completion:(id)a5;
- (void)evaluateResidentUpdate;
- (void)evaluateShouldRelaunchAndSetRelaunch;
- (void)exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:(id)a3 commissioneeNodeID:(id)a4 fabricID:(id)a5 publicKey:(id)a6 sender:(id)a7 completion:(id)a8;
- (void)executeActionSet:(id)a3;
- (void)executeActionsFromMessage:(id)a3;
- (void)fetchFabricDataForPairingWithCompletion:(id)a3;
- (void)fetchOperationalCertificatesForNewFabricWithFabricID:(id)a3 publicKey:(id)a4 fetchFromResident:(BOOL)a5 completion:(id)a6;
- (void)filterServiceTransactions:(id)a3 removedServiceUUIDs:(id)a4;
- (void)finishPairingForServer:(id)a3;
- (void)fixupHomeAfterDecoding;
- (void)getOrCreateUniqueIDForAccessoriesForUser:(id)a3 flow:(id)a4 completionHandler:(id)a5;
- (void)getReachableIPAccessories:(unint64_t *)a3 btleAccessories:(unint64_t *)a4 mediaAccessories:(unint64_t *)a5;
- (void)getRunTimeStateUpdateWithOptions:(unint64_t)a3 includeMediaAccessorySessionState:(BOOL)a4 includeResidentDeviceState:(BOOL)a5 completion:(id)a6;
- (void)handleAcceptRequestForIDSInvitationWithIdentifier:(id)a3 payload:(id)a4 fromAddress:(id)a5 fromMergeID:(id)a6;
- (void)handleAccessoryDidAddNetworkRouterControllerNotification:(id)a3;
- (void)handleAccessoryDidRemoveNetworkRouterControllerNotification:(id)a3;
- (void)handleAccessoryReachabilityChangeNotification:(id)a3;
- (void)handleAccountHandlesUpdated:(id)a3;
- (void)handleActiveAccountChanged:(id)a3;
- (void)handleCATUpdate;
- (void)handleCHIPSendRemoteRequestMessage:(id)a3;
- (void)handleCHIPSendReportMessage:(id)a3;
- (void)handleClearMatterControllerPrivateStorageRequest:(id)a3;
- (void)handleClientProcessDisconnectedNotification:(id)a3;
- (void)handleCommissioningCertificateRequest:(id)a3;
- (void)handleCommissioningCertificateRequestWithCommissionerNodeID:(id)a3 commissioneeNodeID:(id)a4 fabricID:(id)a5 publicKey:(id)a6 sender:(id)a7 completion:(id)a8;
- (void)handleCurrentAccountMergeIdentifierUpdated:(id)a3;
- (void)handleCurrentUserPrivilegeChanged:(id)a3;
- (void)handleCurrentWiFiNetworkChangedNotification:(id)a3;
- (void)handleDeclineRequestForIDSInvitationWithIdentifier:(id)a3 fromAddress:(id)a4;
- (void)handleDidReceiveIDSMessageWithNoListener:(id)a3;
- (void)handleEvaluatePredicateMessage:(id)a3;
- (void)handleFetchLightProfileSettingsMessage:(id)a3;
- (void)handleFetchLightProfileSettingsMessage:(id)a3 withLightProfileUUIDs:(id)a4;
- (void)handleFetchPresenceMapMessage:(id)a3;
- (void)handleFindResidentsNotification:(id)a3;
- (void)handleFirstProcessDidBecomeActiveNotification:(id)a3;
- (void)handleGetPowerAssertionsWithMessage:(id)a3;
- (void)handleGetPrimaryResidentNetworkInfoWithMessage:(id)a3;
- (void)handleHAPAccessoryCharacteristicsAddedNotification:(id)a3;
- (void)handleHAPAccessoryServicesAddedNotification:(id)a3;
- (void)handleHomeBecameQualifiedForAdaptiveTemperatureAutomations;
- (void)handleHomeDataLoaded:(id)a3;
- (void)handleHomePresenceUpdate:(id)a3;
- (void)handleHomeWasRemoved;
- (void)handleLastProcessDidBecomeInactiveNotification:(id)a3;
- (void)handleMatterPairingCompletionNotification:(id)a3;
- (void)handleMobileAssetsUpdatedNotification:(id)a3;
- (void)handleNetworkInfoFetchWithMessage:(id)a3;
- (void)handlePrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification:(id)a3;
- (void)handlePrimaryResidentChangeNotification:(id)a3;
- (void)handlePrimaryResidentDidBecomeCurrentDeviceSwiftExtensions;
- (void)handlePrimaryResidentDidBecomeOtherDeviceSwiftExtensions;
- (void)handlePrimaryResidentIsCurrentDeviceChangeNotification:(id)a3;
- (void)handleRemoteUpdateCHIPKeyValueStoreMessage:(id)a3;
- (void)handleRemoveAccessory:(id)a3 completion:(id)a4;
- (void)handleRemoveAccessoryMessage:(id)a3;
- (void)handleRemovedMediaSessions:(id)a3;
- (void)handleReportingSessionResponseMessage:(id)a3;
- (void)handleResetMatterStorageRequest:(id)a3;
- (void)handleRoomsSupportingLocalPresenceMessage:(id)a3;
- (void)handleSetNaturalLightingEnabledForLightProfilesMessage:(id)a3;
- (void)handleSetPreferredPrimaryMessage:(id)a3;
- (void)handleSignificantTimeChange;
- (void)handleSiriEndPointAddedNotification:(id)a3;
- (void)handleSwitchFromResidentSelectionToREV2:(id)a3;
- (void)handleUpdateBulletinRegistrations:(id)a3;
- (void)handleUpdatedCHIPPropertiesOnHomeModel:(id)a3 actions:(id)a4;
- (void)handleUpdatedCharacteristics:(id)a3 accessoryServer:(id)a4;
- (void)handleUserActivityStateDetectorManagerChangeNotification:(id)a3;
- (void)handleUserFabricKeyUpdate:(id)a3;
- (void)handleWiFiInfoFetchWithMessage:(id)a3;
- (void)handleXPCConnectionInvalidated:(id)a3;
- (void)incrementOperatePrivilegeCATVersion:(id)a3;
- (void)invokeCommandWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 commandId:(id)a6 fields:(id)a7 timedInvokeTimeout:(id)a8 source:(unint64_t)a9 completion:(id)a10;
- (void)isEnergyCurrentlyExpensiveWithCompletion:(id)a3;
- (void)matterAccessoryBecameReachable;
- (void)maybeRemoveStaleRegistrationsFromPreviousUserForSource:(id)a3 homeMember:(id)a4 context:(id)a5;
- (void)mediaSystemController:(id)a3 didRemoveMediaSystem:(id)a4;
- (void)mediaSystemController:(id)a3 removeAccessories:(id)a4 fromAssistantAccessControl:(id)a5;
- (void)mergeMediaDestinationControllerDataWithConsumer:(id)a3;
- (void)mergeMediaDestinationsWithConsumer:(id)a3;
- (void)mergeMediaGroupsAggregateDataWithConsumer:(id)a3;
- (void)migrateAfterResidentChange;
- (void)modifyCharacteristicNotifications:(id)a3 characteristicChangeThresholds:(id)a4 mediaNotifications:(id)a5 actionSetNotificationPayload:(id)a6 enableNotification:(BOOL)a7 withDevice:(id)a8;
- (void)newMatterAccessoryFrom:(id)a3 message:(id)a4;
- (void)notifyClientOfVendorInfoUpdatedForManufacturers:(id)a3 withCompletion:(id)a4;
- (void)notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)a3;
- (void)notifyClientsOfReachabilityUpdateForAccessory:(id)a3;
- (void)notifyNewRemotePeersFound:(BOOL)a3 remoteUsersRemoved:(id)a4 forceRemoteNotificationRegistration:(BOOL)a5;
- (void)notifyOfAddedAccessory:(id)a3;
- (void)notifyOfChangedCharacteristic:(id)a3 changedByThisDevice:(BOOL)a4 residentShouldNotifyPeers:(BOOL)a5 message:(id)a6;
- (void)notifyOfNewlyAddedAccessoryByThisOwnerDevice:(id)a3;
- (void)notifyOfRemovedAccessory:(id)a3 source:(unint64_t)a4;
- (void)notifyRemoteUsersOfChangedActionSetResponses:(id)a3;
- (void)notifyRemoteUsersOfChangedCharacteristics:(id)a3 message:(id)a4 broadcast:(BOOL)a5;
- (void)notifyRemoteUsersOfChangedProperties:(id)a3 requestMessageInformation:(id)a4;
- (void)onThreadNetworkCallStateChange:(BOOL)a3;
- (void)onThreadNetworkConnectionStateChange:(int64_t)a3;
- (void)onThreadNetworkNodeTypeStateChange:(int64_t)a3;
- (void)onThreadNetworkPeripheralDeviceNodeTypeChange:(id)a3;
- (void)onThreadNetworkWakeOnDeviceConnectionStateChange:(id)a3;
- (void)performLocalAddAccessoryWithDescription:(id)a3 progressHandlerDelegate:(id)a4 completion:(id)a5;
- (void)prepareNewCloudKitZone;
- (void)prepareOperationalFabricData;
- (void)primaryResidentClientHasConnectivityDidChangeForRemoteEventRouterClientController:(id)a3;
- (void)queryPrimaryResidentReachabilityForAccessories:(id)a3 completion:(id)a4;
- (void)reEvaluateHomeHubState;
- (void)reEvaluateTriggers;
- (void)reachabilityChangedForAccessory:(id)a3 reachable:(BOOL)a4;
- (void)readAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 params:(id)a7 completion:(id)a8;
- (void)readCharacteristicValues:(id)a3 identifier:(id)a4 source:(unint64_t)a5 qualityOfService:(int64_t)a6 withCompletionHandler:(id)a7;
- (void)readCharacteristicValues:(id)a3 source:(unint64_t)a4 sourceForLogging:(id)a5 qualityOfService:(int64_t)a6 withCompletionHandler:(id)a7;
- (void)readProfileState:(id)a3 viaDevice:(id)a4;
- (void)redispatchMediaReadRequests:(id)a3 viaDevice:(id)a4 completion:(id)a5;
- (void)redispatchMediaWriteRequests:(id)a3 viaDevice:(id)a4 completion:(id)a5;
- (void)redispatchToResidentMessage:(id)a3 target:(id)a4 responseQueue:(id)a5 viaDevice:(id)a6;
- (void)reevaluateAccessoryInfo;
- (void)refreshUserDisplayNames;
- (void)regionStateUpdated;
- (void)registerForAccessoryReachabilityNotifications:(BOOL)a3 registrationIdentifier:(id)a4;
- (void)registerForBulletinNotificationRegistrationHandlersUsingPolicies:(id)a3;
- (void)registerForDeviceWithCapabilities;
- (void)registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4;
- (void)registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5;
- (void)registerForNetworkInfoMessages;
- (void)registerForPowerAssertionMessages;
- (void)remoteAccessEnabled:(BOOL)a3;
- (void)remoteAccessHealthMonitorTimerDidFire;
- (void)remotelySetNotificationsEnabled:(BOOL)a3 forActionSetUUIDs:(id)a4;
- (void)remotelySetNotificationsEnabled:(BOOL)a3 forCharacteristics:(id)a4 characteristicChangeThresholds:(id)a5;
- (void)remotelySetNotificationsEnabled:(BOOL)a3 forMatterAttributes:(id)a4;
- (void)remotelyUpdateHomeModelWithCHIPKeyValueStore:(id)a3 removedKeys:(id)a4 completion:(id)a5;
- (void)removeAccessory:(id)a3;
- (void)removeAccessory:(id)a3 completionHandler:(id)a4;
- (void)removeAllHomeContentsAndAccessoryPairings:(BOOL)a3 queue:(id)a4 completionHandler:(id)a5;
- (void)removeAllUsersAndCloudDataFromAccessory:(id)a3 completionHandler:(id)a4;
- (void)removeBulletinBoardNotificationsMigrationFileFromDisk;
- (void)removeCameraNotificationSettingsMigrationFileFromDisk;
- (void)removeFromCurrentTriggers:(id)a3;
- (void)removeMediaSession:(id)a3;
- (void)removeMediaSessionState:(id)a3;
- (void)removeNotificationDeregistrationForClientIdentifier:(id)a3;
- (void)removeOutgoingInvitation:(id)a3;
- (void)removeRemovedUser:(id)a3;
- (void)removeResidentCapableDevice:(id)a3;
- (void)removeService:(id)a3;
- (void)removeSharedHomeFabricData;
- (void)removeSharedUserEventBuilder:(id)a3;
- (void)removeSharedUserResponseEventBuilder:(id)a3;
- (void)removeThreadNetworkPreferredNetworkWithCompletion:(id)a3;
- (void)removeTrigger:(id)a3;
- (void)removeTriggerNoNotification:(id)a3;
- (void)removeUnconfiguredResidentDeviceWithUserID:(id)a3;
- (void)removeUser:(id)a3;
- (void)removeUserWithUserID:(id)a3;
- (void)removeWithMergeSecondaryAccessory:(id)a3 removedFromBridgeAccessory:(id)a4 completionHandler:(id)a5;
- (void)resendOutgoingInvitationToUser:(id)a3;
- (void)resetAccessoryHashedRouteIdentifiers;
- (void)resetConfiguration;
- (void)resetHomeKeyMiscInfo;
- (void)residentDeviceManager:(id)a3 didUpdatePrimaryResident:(id)a4 previousPrimaryResident:(id)a5;
- (void)residentDeviceManager:(id)a3 didUpdateResidentAvailable:(BOOL)a4;
- (void)residentDeviceManagerDidUpdateResidents:(id)a3;
- (void)respondMessage:(id)a3 withSettingResults:(id)a4;
- (void)resubscribeForNotificationsOnResident:(id)a3;
- (void)retrieveHAPAccessoryForHMDAccessory:(id)a3 linkType:(int64_t)a4 forceRetrieve:(BOOL)a5 queue:(id)a6 completion:(id)a7;
- (void)retrieveOperationalCertificatesForFabricID:(id)a3 commissioneeNodeID:(id)a4 publicKey:(id)a5 completion:(id)a6;
- (void)retrieveOperationalCertificatesForFabricID:(id)a3 commissionerNodeID:(id)a4 commissioneeNodeID:(id)a5 publicKey:(id)a6 completion:(id)a7;
- (void)retrieveStateForTrackedAccessory:(id)a3 stateNumber:(id *)a4 isReachable:(BOOL *)a5 linkQuality:(unint64_t *)a6 lastSeen:(id *)a7;
- (void)retrieveThreadNetworkMetadataWithCompletion:(id)a3;
- (void)retrieveThreadNetworkMetadataWithNoFallbackWithCompletion:(id)a3;
- (void)runPotentialFabricDataCreationBlock:(id)a3;
- (void)saveAndSyncWithThreadOperationalDataset:(id)a3 forceUpdate:(BOOL)a4;
- (void)saveAttributedUserUUID:(id)a3 forTargetStateCharacteristic:(id)a4;
- (void)saveClientWalletKeyUUIDToLocalStore:(id)a3;
- (void)saveToCurrentAccountWithReason:(id)a3;
- (void)scheduleRemoval;
- (void)sendFirmwareUpdateUINotification:(id)a3;
- (void)setAccessories:(id)a3;
- (void)setActiveNetworkRouterInitialSetupNeeded:(BOOL)a3;
- (void)setActiveNetworkRouterUUID:(id)a3;
- (void)setAllowedToEnableAdaptiveTemperatureAutomations:(BOOL)a3;
- (void)setAnyBTLEAccessoryReachable:(BOOL)a3;
- (void)setAtHomeLevel:(int64_t)a3;
- (void)setAutomaticSoftwareUpdateEnabled:(BOOL)a3;
- (void)setAvailableBSPsCount:(id)a3;
- (void)setAvailableBorderRouters:(id)a3;
- (void)setBackingStore:(id)a3;
- (void)setCHIPReportHandlerWithSubscriber:(id)a3 handler:(id)a4;
- (void)setCurrentUser:(id)a3;
- (void)setHomeLocation:(int64_t)a3;
- (void)setHomeUpdatedToROARAndInformClients;
- (void)setMediaPassword:(id)a3;
- (void)setMediaPeerToPeerEnabled:(BOOL)a3;
- (void)setMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3;
- (void)setMinimumMediaUserPrivilege:(int64_t)a3;
- (void)setMinimumNetworkRouterSupportHomeKitVersion:(id)a3;
- (void)setName:(id)a3;
- (void)setNaturalLightingContext:(id)a3;
- (void)setNetworkRouterSupport:(unint64_t)a3;
- (void)setNetworkRouterSupportDisableReason:(unint64_t)a3;
- (void)setNfcReaderKey:(id)a3;
- (void)setOutgoingInvitations:(id)a3;
- (void)setOverriddenHomeAccessControl:(id)a3;
- (void)setOwner:(id)a3;
- (void)setOwnerTrustZoneCapable:(BOOL)a3;
- (void)setOwnerUser:(BOOL)a3;
- (void)setPersonManagerSettings:(id)a3;
- (void)setPrimaryNetworkRouterManagingDeviceUUID:(id)a3;
- (void)setPrimaryResidentNetworkInfo:(id)a3;
- (void)setProtectionMode:(int64_t)a3;
- (void)setRemoteAccessEnabled:(BOOL)a3;
- (void)setResidentSelectionVersion:(id)a3;
- (void)setRouterClientManager:(id)a3;
- (void)setThreadNetworkID:(id)a3;
- (void)setThreadNetworkSequenceNumber:(unint64_t)a3;
- (void)setThreadOperationalDataset:(id)a3;
- (void)setUpFabricForPairingWithCompletion:(id)a3;
- (void)setUpSharedUserFabricDataWithForceFetch:(BOOL)a3 completion:(id)a4;
- (void)setUserActivityStateDetectorManager:(id)a3;
- (void)setWatchSkipVersionCheck:(BOOL)a3;
- (void)startReportingSessionForMessage:(id)a3;
- (void)startThreadNetwork:(BOOL)a3;
- (void)stateObserverStartedMonitoringCharacteristics:(id)a3 completionHandler:(id)a4;
- (void)stateObserverStoppedMonitoringCharacteristics:(id)a3;
- (void)stopThreadAccessoryFirmwareUpdateWithCompletion:(id)a3;
- (void)stopThreadAccessoryPairingWithCompletion:(id)a3;
- (void)stopThreadNetworkWithCompletion:(BOOL)a3 completion:(id)a4;
- (void)storeMigrationBulletinBoardNotificationsToDisk;
- (void)storeMigrationCameraNotificationSettingsToDisk;
- (void)storeMigrationCharacteristicsAuthorizationData;
- (void)submitLogEventForCommandResponse:(id)a3 nodeID:(unint64_t)a4 endpointID:(id)a5 clusterID:(id)a6 commandID:(id)a7 source:(unint64_t)a8 error:(id)a9;
- (void)submitLogEventForWriteAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 value:(id)a7 timedWriteTimeout:(id)a8 error:(id)a9;
- (void)submitRvcUsageLogEventForNodeID:(unint64_t)a3 endpointID:(id)a4 source:(unint64_t)a5 error:(id)a6;
- (void)subscribeForNotificationsFromRemoteGateway;
- (void)subscribeToAccessoryLanguageSettingsIfNeeded;
- (void)suspendedStateChangedForAccessory:(id)a3 suspendedState:(unint64_t)a4;
- (void)test_addActionSets:(id)a3;
- (void)test_addRooms:(id)a3;
- (void)test_addServiceGroups:(id)a3;
- (void)test_addTriggerOwnedActionSets:(id)a3;
- (void)test_addZones:(id)a3;
- (void)timerDidFire:(id)a3;
- (void)transactionObjectRemoved:(id)a3 message:(id)a4;
- (void)transactionObjectUpdated:(id)a3 newValues:(id)a4 message:(id)a5;
- (void)unconfigure;
- (void)unsetFabricForPairing;
- (void)updateAccessoryBrowsing;
- (void)updateAppData:(id)a3 identifierKey:(id)a4 lookup:(id)a5;
- (void)updateBulletinRegistrationOnPrimaryResidentWithSource:(id)a3 enableRegistrations:(id)a4 disableRegistration:(id)a5 completionHandler:(id)a6;
- (void)updateCATIDsForUsersIfNeeded:(BOOL)a3 completion:(id)a4;
- (void)updateEnabledBulletinRegistrations:(id)a3 disabledBulletinRegistrations:(id)a4 source:(id)a5 context:(id)a6 completionHandler:(id)a7;
- (void)updateHasOnboardedForWalletKey:(BOOL)a3 message:(id)a4;
- (void)updateHomeConfigurationWithModel:(id)a3 message:(id)a4;
- (void)updateHomeFirstHAPAccessoryAddedDateToNow;
- (void)updateHomeLocation;
- (void)updateHomeLocationForPairing;
- (void)updateLightProfilesSettings:(id)a3;
- (void)updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled:(BOOL)a3;
- (void)updateLocalUWBOnboardingDismissed:(BOOL)a3;
- (void)updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange;
- (void)updateMediaStateWithResponses:(void *)a3 requestMessageInformation:;
- (void)updateNetworkConnectivity:(BOOL)a3 companionReachable:(BOOL)a4;
- (void)updateNetworkRouterManagingDeviceSettingsWithModel:(id)a3 message:(id)a4;
- (void)updateNetworkRouterSettingsWithModel:(id)a3 message:(id)a4;
- (void)updateROARStatus:(id)a3 message:(id)a4;
- (void)updateThreadOperationalDatasetWithHomeModel:(id)a3 message:(id)a4;
- (void)updateUserCATWithOperatePrivilege:(id)a3 administerPrivilege:(id)a4 completion:(id)a5;
- (void)userAssistantAccessControlDidUpdate:(id)a3 accessories:(id)a4;
- (void)verifyAdaptiveTemperatureAutomationsEnabledHomeShouldSendInvitations:(NSArray *)a3 withQueryController:(HMDIDSIDQueryController *)a4 completion:(id)a5;
- (void)writeAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 value:(id)a7 timedWriteTimeout:(id)a8 completion:(id)a9;
- (void)writeCharacteristicValues:(id)a3 message:(id)a4 withCompletionHandler:(id)a5;
- (void)writeCharacteristicValues:(id)a3 source:(unint64_t)a4 biomeSource:(unint64_t)a5 identifier:(id)a6 transport:(id)a7 qualityOfService:(int64_t)a8 withCompletionHandler:(id)a9;
- (void)writeCharacteristicValues:(id)a3 source:(unint64_t)a4 message:(id)a5 identifier:(id)a6 qualityOfService:(int64_t)a7 withCompletionHandler:(id)a8;
@end

@implementation HMDHome

- (HMDHomeManager)homeManager
{
  WeakRetained = objc_loadWeakRetained(&self->_homeManager);

  return WeakRetained;
}

- (id)primaryResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 primaryResidentDevice];

  return v3;
}

- (void)canReachPrimaryResidentChanged
{
  v1 = a1;
  sub_2297A6684();
}

- (void)_clearEventsWithCompletion:(id)a3
{
  v5 = sub_22A4DB7DC();
  v6 = *(v5 - 8);
  v7 = *(v6 + 64);
  v8 = MEMORY[0x28223BE20](v5);
  v9 = &v27 - ((v7 + 15) & 0xFFFFFFFFFFFFFFF0);
  MEMORY[0x28223BE20](v8);
  v11 = &v27 - v10;
  v12 = __swift_instantiateConcreteTypeFromMangledNameV2(&unk_27D87D8F0, &qword_22A578D70);
  v13 = *(*(v12 - 8) + 64);
  MEMORY[0x28223BE20](v12 - 8);
  v15 = &v27 - v14;
  v16 = _Block_copy(a3);
  v17 = swift_allocObject();
  *(v17 + 16) = v16;
  v18 = sub_22A4DD9DC();
  (*(*(v18 - 8) + 56))(v15, 1, 1, v18);
  v28 = self;
  v19 = [(HMDHome *)v28 spiClientIdentifier];
  sub_22A4DB79C();

  v20 = *(v6 + 32);
  v21 = v5;
  v20(v9, v11, v5);
  v22 = (*(v6 + 80) + 32) & ~*(v6 + 80);
  v23 = v22 + v7;
  v24 = (v22 + v7) & 0xFFFFFFFFFFFFFFF8;
  v25 = swift_allocObject();
  *(v25 + 16) = 0;
  *(v25 + 24) = 0;
  v20((v25 + v22), v9, v21);
  *(v25 + v23) = 1;
  v26 = v25 + v24;
  *(v26 + 8) = sub_2295B994C;
  *(v26 + 16) = v17;

  sub_22957F3C0(0, 0, v15, &unk_22A578F40, v25);
}

- (void)_handleClearActivityHistoryBroadcastMessage:(id)a3
{
  v4 = a3;
  v5 = self;
  sub_2295B3164(v4);
}

- (void)_synchronizeHindsightCloudShareManager
{
  v2 = self;
  sub_2295B3974();
}

- (void)_broadcastClearActivityHistoryToOwnerDevices
{
  v2 = self;
  sub_2295B3A98();
}

- (void)_maybeFixHindsightOnboardingOnCurrentDevice
{
  v2 = self;
  sub_2295B44E4();
}

- (void)prepareNewCloudKitZone
{
  ObjectType = swift_getObjectType();
  v4 = sub_22A4DB7DC();
  v5 = *(v4 - 8);
  v6 = *(v5 + 64);
  v7 = MEMORY[0x28223BE20](v4);
  v8 = &v22 - ((v6 + 15) & 0xFFFFFFFFFFFFFFF0);
  MEMORY[0x28223BE20](v7);
  v10 = &v22 - v9;
  v11 = __swift_instantiateConcreteTypeFromMangledNameV2(&unk_27D87D8F0, &qword_22A578D70);
  v12 = *(*(v11 - 8) + 64);
  MEMORY[0x28223BE20](v11 - 8);
  v14 = &v22 - v13;
  v15 = sub_22A4DD9DC();
  (*(*(v15 - 8) + 56))(v14, 1, 1, v15);
  v16 = self;
  v17 = [(HMDHome *)v16 spiClientIdentifier];
  sub_22A4DB79C();

  v18 = *(v5 + 32);
  v18(v8, v10, v4);
  v19 = (*(v5 + 80) + 32) & ~*(v5 + 80);
  v20 = (v6 + v19 + 7) & 0xFFFFFFFFFFFFFFF8;
  v21 = swift_allocObject();
  *(v21 + 16) = 0;
  *(v21 + 24) = 0;
  v18((v21 + v19), v8, v4);
  *(v21 + v20) = ObjectType;
  sub_22957F3C0(0, 0, v14, &unk_22A578ED8, v21);
}

- (void)registerForPowerAssertionMessages
{
  v2 = self;
  sub_22960A164();
}

- (void)handleGetPowerAssertionsWithMessage:(id)a3
{
  v4 = a3;
  v5 = self;
  sub_22960A4AC(v4);
}

- (NSArray)lpRooms
{
  v2 = self;
  v3 = [(HMDHome *)v2 rooms];
  sub_229562F68(0, &unk_2814017A0, off_278666308);
  v4 = sub_22A4DD83C();

  sub_229869E18(v4);

  __swift_instantiateConcreteTypeFromMangledNameV2(&unk_27D881F00, &unk_22A57CB50);
  v5 = sub_22A4DD81C();

  return v5;
}

- (void)isEnergyCurrentlyExpensiveWithCompletion:(id)a3
{
  v5 = __swift_instantiateConcreteTypeFromMangledNameV2(&unk_27D87D8F0, &qword_22A578D70);
  v6 = *(*(v5 - 8) + 64);
  MEMORY[0x28223BE20](v5 - 8);
  v8 = &v15 - v7;
  v9 = _Block_copy(a3);
  v10 = swift_allocObject();
  *(v10 + 16) = v9;
  *(v10 + 24) = self;
  v11 = sub_22A4DD9DC();
  (*(*(v11 - 8) + 56))(v8, 1, 1, v11);
  v12 = swift_allocObject();
  v12[2] = 0;
  v12[3] = 0;
  v12[4] = &unk_22A57DE20;
  v12[5] = v10;
  v13 = swift_allocObject();
  v13[2] = 0;
  v13[3] = 0;
  v13[4] = &unk_22A57B590;
  v13[5] = v12;
  v14 = self;
  sub_229859F70(0, 0, v8, &unk_22A581CC0, v13);
}

- (void)handleRoomsSupportingLocalPresenceMessage:(id)a3
{
  v4 = a3;
  v5 = self;
  sub_2296F4FE4(v4);
}

- (id)roomUUIDsSupportingLocalPresence
{
  v2 = self;
  sub_2296F5280();

  sub_22A4DB7DC();
  sub_2295E9190(&qword_281403880, MEMORY[0x277CC95F0]);
  v3 = sub_22A4DDB5C();

  return v3;
}

- (void)registerForNetworkInfoMessages
{
  v2 = self;
  sub_2297271A4();
}

- (void)handleGetPrimaryResidentNetworkInfoWithMessage:(id)a3
{
  v4 = a3;
  v5 = self;
  sub_2297275D8(v4);
}

- (void)handleWiFiInfoFetchWithMessage:(id)a3
{
  v4 = a3;
  v5 = self;
  sub_229727DF0(v4);
}

- (void)handleNetworkInfoFetchWithMessage:(id)a3
{
  v4 = a3;
  v5 = self;
  sub_22972B618(v4);
}

- (void)handleHomeBecameQualifiedForAdaptiveTemperatureAutomations
{
  v2 = self;
  sub_229738B40();
}

- (void)verifyAdaptiveTemperatureAutomationsEnabledHomeShouldSendInvitations:(NSArray *)a3 withQueryController:(HMDIDSIDQueryController *)a4 completion:(id)a5
{
  v9 = __swift_instantiateConcreteTypeFromMangledNameV2(&unk_27D87D8F0, &qword_22A578D70);
  v10 = *(*(v9 - 8) + 64);
  MEMORY[0x28223BE20](v9 - 8);
  v12 = &v20 - v11;
  v13 = _Block_copy(a5);
  v14 = swift_allocObject();
  v14[2] = a3;
  v14[3] = a4;
  v14[4] = v13;
  v14[5] = self;
  v15 = sub_22A4DD9DC();
  (*(*(v15 - 8) + 56))(v12, 1, 1, v15);
  v16 = swift_allocObject();
  v16[2] = 0;
  v16[3] = 0;
  v16[4] = &unk_22A581988;
  v16[5] = v14;
  v17 = swift_allocObject();
  v17[2] = 0;
  v17[3] = 0;
  v17[4] = &unk_22A57B590;
  v17[5] = v16;
  v18 = a3;
  swift_unknownObjectRetain();
  v19 = self;
  sub_229859F70(0, 0, v12, &unk_22A581CC0, v17);
}

- (void)handleHomePresenceUpdate:(id)a3
{
  v4 = sub_22A4DB21C();
  v5 = *(v4 - 8);
  v6 = *(v5 + 64);
  MEMORY[0x28223BE20](v4);
  v8 = &v11 - ((v7 + 15) & 0xFFFFFFFFFFFFFFF0);
  sub_22A4DB1DC();
  v9 = self;
  v10 = sub_22A4DB1CC();
  [(HMDHome *)v9 handleNotificationsForIsAllowedToEnableAdaptiveTemperatureAutomations:v10];

  sub_2297424C4(v8);
  (*(v5 + 8))(v8, v4);
}

- (void)handlePrimaryResidentDidBecomeCurrentDeviceSwiftExtensions
{
  v2 = self;
  sub_2297A588C();
}

- (void)handlePrimaryResidentDidBecomeOtherDeviceSwiftExtensions
{
  v2 = self;
  sub_2297A63FC();
}

- (HMDActionSetStateSubscriptionManager)actionSetStateSubscriptionManager
{
  v2 = self;
  result = [(HMDHome *)v2 swiftExtensions];
  if (!result)
  {
    __break(1u);
    goto LABEL_7;
  }

  v4 = result;

  swift_getObjectType();
  result = swift_conformsToProtocol2();
  if (!result)
  {
LABEL_7:
    __break(1u);
    return result;
  }

  v5 = *(v4 + OBJC_IVAR____TtCE13HomeKitDaemonCSo7HMDHomeP33_0B6F54D380C02F3DBB7BB084234D6AED22DefaultSwiftExtensions_actionSetStateSubscriptionManager);
  swift_unknownObjectRelease();

  return v5;
}

- (HMDActionSetStateObserver)actionSetStateObserver
{
  v2 = self;
  result = [(HMDHome *)v2 swiftExtensions];
  if (!result)
  {
    __break(1u);
    goto LABEL_7;
  }

  v4 = result;

  swift_getObjectType();
  result = swift_conformsToProtocol2();
  if (!result)
  {
LABEL_7:
    __break(1u);
    return result;
  }

  v5 = *(v4 + OBJC_IVAR____TtCE13HomeKitDaemonCSo7HMDHomeP33_0B6F54D380C02F3DBB7BB084234D6AED22DefaultSwiftExtensions_actionSetStateObserver);

  swift_unknownObjectRelease();

  return v5;
}

- (void)newMatterAccessoryFrom:(id)a3 message:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = self;
  sub_2297A7548(v6, a4);
}

- (void)handleFetchPresenceMapMessage:(id)a3
{
  v4 = a3;
  v5 = self;
  sub_2297A8AF4(v4);
}

- (HMDHomePresenceCheck)homePresence
{
  v2 = self;
  v3 = sub_2297A9A28();

  return v3;
}

- (void)submitLogEventForWriteAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 value:(id)a7 timedWriteTimeout:(id)a8 error:(id)a9
{
  v14 = a4;
  v15 = a5;
  v16 = a6;
  swift_unknownObjectRetain();
  v17 = self;
  v18 = a8;
  v19 = a9;
  sub_22A4DE01C();
  swift_unknownObjectRelease();
  sub_2297A9CF8(a3, v14, v15, v16, v20, a8, a9);

  __swift_destroy_boxed_opaque_existential_0(v20);
}

- (void)submitLogEventForCommandResponse:(id)a3 nodeID:(unint64_t)a4 endpointID:(id)a5 clusterID:(id)a6 commandID:(id)a7 source:(unint64_t)a8 error:(id)a9
{
  if (a3)
  {
    sub_22A4DD49C();
  }

  v15 = a5;
  v16 = a6;
  v17 = a7;
  v19 = a9;
  v18 = self;
  sub_2297AD3C4(a4, v15, v16, v17, a8, a9);
}

- (id)resolveReceiverForMessageTargetUUID:(id)a3
{
  v4 = sub_22A4DB7DC();
  v5 = *(v4 - 8);
  v6 = *(v5 + 64);
  MEMORY[0x28223BE20](v4);
  v8 = (&v12 - ((v7 + 15) & 0xFFFFFFFFFFFFFFF0));
  sub_22A4DB79C();
  v9 = self;
  v10 = sub_2297B0F74(v8);

  (*(v5 + 8))(v8, v4);

  return v10;
}

- (id)preflightCheckLogEventWithSessionIdentifier:(id)a3 accessoryCategory:(id)a4 fetchDuration:(double)a5 firstImportCompleted:(BOOL)a6 hasMediaRouteIdentifier:(BOOL)a7 hasPairingIdentity:(BOOL)a8 hasConnectedEventRouterClient:(BOOL)a9 isCloudSignedIn:(BOOL)a10 hasManatee:(BOOL)a11 isIdsReady:(BOOL)a12 isOwnerUser:(BOOL)a13 homeUUID:(id)a14
{
  v35 = a8;
  v36 = a9;
  v33 = a6;
  v34 = a7;
  v31 = a11;
  v32 = a12;
  HIDWORD(v30) = a10;
  v18 = sub_22A4DB7DC();
  v19 = *(v18 - 8);
  v20 = *(v19 + 64);
  MEMORY[0x28223BE20](v18);
  v22 = &v30 - ((v21 + 15) & 0xFFFFFFFFFFFFFFF0);
  if (a3)
  {
    a3 = sub_22A4DD5EC();
    v24 = v23;
    if (a4)
    {
LABEL_3:
      v25 = sub_22A4DD5EC();
      a4 = v26;
      goto LABEL_6;
    }
  }

  else
  {
    v24 = 0;
    if (a4)
    {
      goto LABEL_3;
    }
  }

  v25 = 0;
LABEL_6:
  sub_22A4DB79C();
  v27 = self;
  v28 = sub_2297ED524(a3, v24, v25, a4, v33, v34, v35, v36, a5, BYTE4(v30), v31, v32, a13, v22);

  (*(v19 + 8))(v22, v18);

  return v28;
}

- (BOOL)hasDemoAccessories
{
  v2 = self;
  v3 = sub_229814508();

  return v3;
}

- (BOOL)hasDemoPrimaryResident
{
  v2 = self;
  v3 = [(HMDResidentDeviceManager *)[(HMDHome *)v2 residentDeviceManager] primaryResidentDevice];
  swift_unknownObjectRelease();
  if (v3)
  {
    v4 = [v3 isDemoDevice];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)deregisterForMessagesInDemoModeV2
{
  v2 = self;
  sub_2298146C4();
}

- (id)homeBulletinContext
{
  v10[2] = *MEMORY[0x277D85DE8];
  v9[0] = @"home";
  v3 = [(HMDHome *)self contextID];
  v10[0] = v3;
  v9[1] = *MEMORY[0x277CCF328];
  v4 = [(HMDHome *)self contextSPIUniqueIdentifier];
  v5 = [v4 UUIDString];
  v10[1] = v5;
  v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v10 forKeys:v9 count:2];

  v7 = *MEMORY[0x277D85DE8];

  return v6;
}

- (NSUUID)contextSPIUniqueIdentifier
{
  v3 = +[HMDProcessInfo privateClientIdentifierSalt];
  v4 = MEMORY[0x277CCAD78];
  v5 = [(HMDHome *)self uuid];
  v6 = [v4 hm_deriveUUIDFromBaseUUID:v5 identifierSalt:v3];

  return v6;
}

- (NSString)contextID
{
  v2 = [(HMDHome *)self uuid];
  v3 = [v2 UUIDString];

  return v3;
}

- (void)updateHasOnboardedForWalletKey:(BOOL)a3 message:(id)a4
{
  v4 = a3;
  v32 = *MEMORY[0x277D85DE8];
  v6 = a4;
  if ([(HMDHome *)self hasOnboardedForWalletKey]!= v4)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      [(HMDHome *)v8 hasOnboardedForWalletKey];
      v11 = HMFBooleanToString();
      v12 = HMFBooleanToString();
      v24 = 138544130;
      v25 = v10;
      v26 = 2112;
      v27 = v11;
      v28 = 2112;
      v29 = v12;
      v30 = 2112;
      v31 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Updating has onboarded for wallet key from %@ to %@ with message: %@", &v24, 0x2Au);
    }

    objc_autoreleasePoolPop(v7);
    v13 = [HMDHomeModel alloc];
    v14 = [(HMDHome *)v8 uuid];
    v15 = [(HMDHome *)v8 homeManager];
    v16 = [v15 uuid];
    v17 = [(HMDBackingStoreModelObject *)v13 initWithObjectChangeType:2 uuid:v14 parentUUID:v16];

    if (v4)
    {
      v18 = MEMORY[0x277CBEC38];
    }

    else
    {
      v18 = MEMORY[0x277CBEC28];
    }

    [(HMDHomeModel *)v17 setHasOnboardedForWalletKey:v18];
    v19 = [(HMDHome *)v8 backingStore];
    v20 = [v6 name];
    v21 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v22 = [v19 transaction:v20 options:v21];

    [v22 add:v17 withMessage:v6];
    [v22 run];
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (BOOL)hasPostedWalletKeyOnboardingBulletinForAnyAccessory
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_any:&__block_literal_global_986];

  return v3;
}

uint64_t __70__HMDHome_Wallet__hasPostedWalletKeyOnboardingBulletinForAnyAccessory__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 hasPostedBulletinForWalletKeyOnboarding];

  return v5;
}

- (NSArray)accessoriesWithAliroProvisioning
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_984];

  return v3;
}

id __51__HMDHome_Wallet__accessoriesWithAliroProvisioning__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = 0;
  if ([v4 supportsACWGProvisioning])
  {
    v5 = v4;
  }

  return v5;
}

- (NSArray)accessoriesWithWalletKeySupport
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_982];

  return v3;
}

id __50__HMDHome_Wallet__accessoriesWithWalletKeySupport__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = 0;
  if ([v4 supportsWalletKey])
  {
    v5 = v4;
  }

  return v5;
}

- (BOOL)hasAnyAccessoryWithWalletKeyAndAccessCodeSupport
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_any:&__block_literal_global_978];

  return v3;
}

uint64_t __67__HMDHome_Wallet__hasAnyAccessoryWithWalletKeyAndAccessCodeSupport__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 supportsAccessCode];
  v6 = [v4 supportsWalletKey];

  return v6 & v5;
}

- (BOOL)hasAnyAccessoryWithAliroUWBSupport
{
  v7 = 0;
  v8 = &v7;
  v9 = 0x2020000000;
  v10 = 0;
  v3 = [(HMDHome *)self backingStore];
  v4 = [v3 context];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_Wallet__hasAnyAccessoryWithAliroUWBSupport__block_invoke;
  v6[3] = &unk_27868A688;
  v6[4] = self;
  v6[5] = &v7;
  [v4 unsafeSynchronousBlock:v6];

  LOBYTE(v3) = *(v8 + 24);
  _Block_object_dispose(&v7, 8);
  return v3;
}

void __53__HMDHome_Wallet__hasAnyAccessoryWithAliroUWBSupport__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  v4 = [v3 accessories];
  v5 = [v4 na_map:&__block_literal_global_975];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_Wallet__hasAnyAccessoryWithAliroUWBSupport__block_invoke_3;
  v6[3] = &unk_27866DFA0;
  v6[4] = *(a1 + 32);
  *(*(*(a1 + 40) + 8) + 24) = [v5 na_any:v6];
}

uint64_t __53__HMDHome_Wallet__hasAnyAccessoryWithAliroUWBSupport__block_invoke_3(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) currentUser];
  v5 = [v4 restrictedGuestAccessSettings];
  v6 = [v5 schedule];

  v7 = [*(a1 + 32) currentUser];
  if ([(HMDAliroVersion *)v7 isRestrictedGuest])
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (v8)
  {

    goto LABEL_7;
  }

  v14 = [v6 weekDayRules];
  v15 = [v14 count];
  v16 = [v3 weekDayScheduleCapacity];
  if (v15 > [v16 integerValue])
  {

    v17 = 0;
LABEL_15:

    goto LABEL_16;
  }

  v18 = [v6 yearDayRules];
  v19 = [v18 count];
  v20 = [v3 yearDayScheduleCapacity];
  v21 = [v20 integerValue];

  if (v19 <= v21)
  {
LABEL_7:
    v9 = [HMDAliroVersion alloc];
    v10 = [v3 expeditedTransactionSupportedVersions];
    v11 = [v3 bleUWBSupportedVersions];
    v12 = [v3 bleAdvertisingVersion];
    v13 = [HMDAliroVersionUtilities dataFromNumber:v12 error:0];
    if (v13)
    {
      v7 = [(HMDAliroVersion *)v9 initWithExpeditedTransactionSupportedVersions:v10 bleUWBSupportedVersions:v11 bleAdvertisingVersions:v13];
    }

    else
    {
      v22 = [MEMORY[0x277CBEA90] data];
      v7 = [(HMDAliroVersion *)v9 initWithExpeditedTransactionSupportedVersions:v10 bleUWBSupportedVersions:v11 bleAdvertisingVersions:v22];
    }

    v23 = [HMDAliroVersionUtilities isCurrentDeviceCompatibleWithAliroVersion:v7 includeUWBCompatibility:1];
    v14 = [v3 supportsMatCredACB];
    v17 = [v14 BOOLValue] & v23;
    goto LABEL_15;
  }

  v17 = 0;
LABEL_16:

  return v17;
}

void *__53__HMDHome_Wallet__hasAnyAccessoryWithAliroUWBSupport__block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 conformsToProtocol:&unk_283F59838])
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (BOOL)hasAnyAccessoryWithAliroNFCSupport
{
  v7 = 0;
  v8 = &v7;
  v9 = 0x2020000000;
  v10 = 0;
  v3 = [(HMDHome *)self backingStore];
  v4 = [v3 context];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_Wallet__hasAnyAccessoryWithAliroNFCSupport__block_invoke;
  v6[3] = &unk_27868A688;
  v6[4] = self;
  v6[5] = &v7;
  [v4 unsafeSynchronousBlock:v6];

  LOBYTE(v3) = *(v8 + 24);
  _Block_object_dispose(&v7, 8);
  return v3;
}

void __53__HMDHome_Wallet__hasAnyAccessoryWithAliroNFCSupport__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  v4 = [v3 accessories];
  v5 = [v4 na_map:&__block_literal_global_970];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_Wallet__hasAnyAccessoryWithAliroNFCSupport__block_invoke_3;
  v6[3] = &unk_27866DFA0;
  v6[4] = *(a1 + 32);
  *(*(*(a1 + 40) + 8) + 24) = [v5 na_any:v6];
}

uint64_t __53__HMDHome_Wallet__hasAnyAccessoryWithAliroNFCSupport__block_invoke_3(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) currentUser];
  v5 = [v4 restrictedGuestAccessSettings];
  v6 = [v5 schedule];

  v7 = [*(a1 + 32) currentUser];
  if ([(HMDAliroVersion *)v7 isRestrictedGuest])
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (v8)
  {

    goto LABEL_7;
  }

  v14 = [v6 weekDayRules];
  v15 = [v14 count];
  v16 = [v3 weekDayScheduleCapacity];
  if (v15 > [v16 integerValue])
  {

    v17 = 0;
LABEL_15:

    goto LABEL_16;
  }

  v18 = [v6 yearDayRules];
  v19 = [v18 count];
  v20 = [v3 yearDayScheduleCapacity];
  v21 = [v20 integerValue];

  if (v19 <= v21)
  {
LABEL_7:
    v9 = [HMDAliroVersion alloc];
    v10 = [v3 expeditedTransactionSupportedVersions];
    v11 = [v3 bleUWBSupportedVersions];
    v12 = [v3 bleAdvertisingVersion];
    v13 = [HMDAliroVersionUtilities dataFromNumber:v12 error:0];
    if (v13)
    {
      v7 = [(HMDAliroVersion *)v9 initWithExpeditedTransactionSupportedVersions:v10 bleUWBSupportedVersions:v11 bleAdvertisingVersions:v13];
    }

    else
    {
      v22 = [MEMORY[0x277CBEA90] data];
      v7 = [(HMDAliroVersion *)v9 initWithExpeditedTransactionSupportedVersions:v10 bleUWBSupportedVersions:v11 bleAdvertisingVersions:v22];
    }

    v23 = [v3 supportsMatCredACB];
    v24 = +[HMDAliroVersionUtilities isCurrentDeviceCompatibleWithAliroVersion:includeUWBCompatibility:](HMDAliroVersionUtilities, "isCurrentDeviceCompatibleWithAliroVersion:includeUWBCompatibility:", v7, [v23 BOOLValue]);

    v14 = [v3 supportsMatCredACP];
    v17 = [v14 BOOLValue] & v24;
    goto LABEL_15;
  }

  v17 = 0;
LABEL_16:

  return v17;
}

void *__53__HMDHome_Wallet__hasAnyAccessoryWithAliroNFCSupport__block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 conformsToProtocol:&unk_283F59838])
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (BOOL)hasAnyAccessoryWithUnifiedAccessWalletKeySupport
{
  v7 = 0;
  v8 = &v7;
  v9 = 0x2020000000;
  v10 = 0;
  v3 = [(HMDHome *)self backingStore];
  v4 = [v3 context];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke;
  v6[3] = &unk_27868A688;
  v6[4] = self;
  v6[5] = &v7;
  [v4 unsafeSynchronousBlock:v6];

  LOBYTE(v3) = *(v8 + 24);
  _Block_object_dispose(&v7, 8);
  return v3;
}

void __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  v4 = [v3 accessories];
  v5 = [v4 na_map:&__block_literal_global_2090];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke_3;
  v6[3] = &unk_27866DFA0;
  v6[4] = *(a1 + 32);
  *(*(*(a1 + 40) + 8) + 24) = [v5 na_any:v6];
}

uint64_t __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke_3(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) currentUser];
  v5 = [v4 restrictedGuestAccessSettings];
  v6 = [v5 schedule];

  v7 = [*(a1 + 32) currentUser];
  if ([v7 isRestrictedGuest])
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (v8)
  {
  }

  else
  {
    v13 = [v6 weekDayRules];
    v14 = [v13 count];
    v15 = [v3 weekDayScheduleCapacity];
    if (v14 > [v15 integerValue])
    {

      v12 = 0;
LABEL_14:

      goto LABEL_15;
    }

    v17 = [v6 yearDayRules];
    v18 = [v17 count];
    v19 = [v3 yearDayScheduleCapacity];
    v20 = [v19 integerValue];

    if (v18 > v20)
    {
      v12 = 0;
      goto LABEL_15;
    }
  }

  v9 = [v3 services];
  if (([v9 na_any:&__block_literal_global_963] & 1) == 0)
  {

    goto LABEL_13;
  }

  v10 = [v3 services];
  v11 = [v10 na_any:&__block_literal_global_966];

  if ((v11 & 1) == 0)
  {
LABEL_13:
    v7 = [v3 supportsMatterWalletKey];
    v12 = [v7 BOOLValue];
    goto LABEL_14;
  }

  v12 = 1;
LABEL_15:

  return v12;
}

uint64_t __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke_5(uint64_t a1, void *a2)
{
  v2 = [a2 serviceType];
  v3 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:@"00000266-0000-1000-8000-0026BB765291"];
  v4 = [v2 hmf_isEqualToUUID:v3];

  return v4;
}

uint64_t __67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke_4(uint64_t a1, void *a2)
{
  v2 = [a2 serviceType];
  v3 = objc_alloc(MEMORY[0x277CCAD78]);
  v4 = [v3 initWithUUIDString:*MEMORY[0x277CD0EB0]];
  v5 = [v2 hmf_isEqualToUUID:v4];

  return v5;
}

void *__67__HMDHome_Wallet__hasAnyAccessoryWithUnifiedAccessWalletKeySupport__block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 conformsToProtocol:&unk_283F59838])
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (BOOL)hasAnyAccessoryWithWalletKeySupport
{
  if ([(HMDHome *)self hasAnyAccessoryWithUnifiedAccessWalletKeySupport])
  {
    return 1;
  }

  return [(HMDHome *)self hasAnyAccessoryWithAliroNFCSupport];
}

+ (id)nfcIssuerKeyIdentifierWithPairingIdentity:(id)a3
{
  v3 = [a3 publicKey];
  v4 = [v3 data];
  v5 = [HMDHomeNFCReaderKey identifierForKey:v4];

  return v5;
}

- (id)createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:(id)a3 operationalKeyPair:(id)a4 error:(id *)a5
{
  v40 = *MEMORY[0x277D85DE8];
  v7 = a3;
  v8 = a4;
  v9 = [(HMDHome *)self currentDeviceControllerNodeID];
  v10 = [(HMDHome *)self accessoryAdministerPrivilegeCATID:0];
  if (v10)
  {
    v11 = [MEMORY[0x277CBEB98] setWithObject:v10];
    if (!v9)
    {
      goto LABEL_6;
    }

LABEL_5:
    if (![v9 isEqual:&unk_283E71918])
    {
      goto LABEL_7;
    }

    goto LABEL_6;
  }

  v11 = 0;
  if (v9)
  {
    goto LABEL_5;
  }

LABEL_6:
  v12 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:{objc_msgSend(MEMORY[0x277D17B90], "randomNodeID")}];

  v13 = [(HMDHome *)self privateDataSourceForNode:v12];
  v9 = v12;
LABEL_7:
  v14 = objc_autoreleasePoolPush();
  v15 = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    HMFGetLogIdentifier();
    v17 = v28 = v8;
    v18 = [v7 rootCert];
    v19 = [v7 fabricID];
    *buf = 138544386;
    v31 = v17;
    v32 = 2112;
    v33 = v9;
    v34 = 2112;
    v35 = v11;
    v36 = 2112;
    v37 = v18;
    v38 = 2112;
    v39 = v19;
    _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Creating operational certificate for controller node ID %@ CAT %@ root cert %@, fabric ID %@", buf, 0x34u);

    v8 = v28;
  }

  objc_autoreleasePoolPop(v14);
  v20 = MEMORY[0x277CD5230];
  v21 = [v7 rootKeyPair];
  v22 = [v7 rootCert];
  v23 = [v8 publicKey];
  v24 = [v7 fabricID];
  v25 = [v20 createOperationalCertificate:v21 signingCertificate:v22 operationalPublicKey:v23 fabricID:v24 nodeID:v9 caseAuthenticatedTags:v11 error:a5];

  v26 = *MEMORY[0x277D85DE8];

  return v25;
}

- (id)fetchOperationalFabricDataWithError:(id *)a3
{
  v47 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [(HMDHome *)self storedFabricDataWithError:a3];
    if (*a3)
    {
      v6 = objc_autoreleasePoolPush();
      v7 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = HMFGetLogIdentifier();
        v10 = *a3;
        v43 = 138543618;
        v44 = v9;
        v45 = 2112;
        v46 = v10;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data from local storage: %@", &v43, 0x16u);
      }

      objc_autoreleasePoolPop(v6);
      v11 = 0;
      goto LABEL_39;
    }

    if ([(HMDHome *)self isCurrentDevicePrimaryResident])
    {
      v16 = [v5 residentOperationalCert];
      v17 = [v5 residentOperationalKeyPair];
      goto LABEL_20;
    }

    if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
    {
      v17 = [(HMDHome *)self storedOperationalKeyPair];
      if (v17)
      {
        v16 = [(HMDHome *)self createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:v5 operationalKeyPair:v17 error:a3];
        if (*a3)
        {
          v18 = objc_autoreleasePoolPush();
          v19 = self;
          v20 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
          {
            v21 = HMFGetLogIdentifier();
            v22 = *a3;
            v43 = 138543618;
            v44 = v21;
            v45 = 2112;
            v46 = v22;
            _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data due to cert generation failure: %@", &v43, 0x16u);
          }

          objc_autoreleasePoolPop(v18);
          v11 = 0;
          goto LABEL_38;
        }

LABEL_20:
        v23 = [v5 rootCert];

        if (v23)
        {
          if (v16)
          {
            goto LABEL_22;
          }
        }

        else
        {
          v24 = objc_autoreleasePoolPush();
          v25 = self;
          v26 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
          {
            v27 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v27;
            _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while root cert is missing from storage", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          if (v16)
          {
LABEL_22:
            if (v17)
            {
LABEL_33:
              v36 = [v5 rootCert];

              if (v17 && v16 && v36)
              {
                v37 = objc_alloc(MEMORY[0x277D17B58]);
                v38 = [v5 rootCert];
                v39 = [v5 ipk];
                v40 = [v5 residentNodeID];
                v11 = [v37 initWithRootCert:v38 ipk:v39 residentNodeID:v40 operationalCert:v16 operationalKeyPair:v17];
              }

              else
              {
                [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
                *a3 = v11 = 0;
              }

LABEL_38:

LABEL_39:
              goto LABEL_40;
            }

LABEL_30:
            v32 = objc_autoreleasePoolPush();
            v33 = self;
            v34 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
            {
              v35 = HMFGetLogIdentifier();
              v43 = 138543362;
              v44 = v35;
              _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while operational key pair is missing", &v43, 0xCu);
            }

            objc_autoreleasePoolPop(v32);
            goto LABEL_33;
          }
        }

        v28 = objc_autoreleasePoolPush();
        v29 = self;
        v30 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
        {
          v31 = HMFGetLogIdentifier();
          v43 = 138543362;
          v44 = v31;
          _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while operational cert is missing from storage", &v43, 0xCu);
        }

        objc_autoreleasePoolPop(v28);
        if (v17)
        {
          goto LABEL_33;
        }

        goto LABEL_30;
      }
    }

    else
    {
      v17 = 0;
    }

    v16 = 0;
    goto LABEL_20;
  }

  v11 = [(HMDHome *)self storedSharedHomeFabricData];
  if (!v11)
  {
    *a3 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v43 = 138543362;
      v44 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@No stored operational fabric data", &v43, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v11 = 0;
  }

LABEL_40:
  v41 = *MEMORY[0x277D85DE8];

  return v11;
}

void __102__HMDHome_CHIP__fetchOrCreateFabricDataForPairingWithOperationalKeyPair_fetchFromResident_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, void *a6)
{
  v65 = *MEMORY[0x277D85DE8];
  v11 = a2;
  v55 = a3;
  v12 = a4;
  v13 = a5;
  v14 = a6;
  if (!v14)
  {
    v19 = *(a1 + 32);
    v56 = 0;
    v20 = [v19 storedFabricDataWithError:&v56];
    v54 = v56;
    if (v54)
    {
      v21 = objc_autoreleasePoolPush();
      v22 = *(a1 + 32);
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v25 = v24 = v11;
        *buf = 138543618;
        v58 = v25;
        v59 = 2112;
        v60 = v54;
        _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@No stored fabric data for pairing: %@", buf, 0x16u);

        v11 = v24;
      }

      objc_autoreleasePoolPop(v21);
    }

    v53 = v11;
    v26 = [objc_alloc(MEMORY[0x277D17B58]) initWithRootCert:v11 ipk:v13 residentNodeID:v12 operationalCert:v55 operationalKeyPair:*(a1 + 40)];
    v27 = [v26 fabricID];

    if (!v27)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = *(a1 + 32);
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v36 = v51 = v33;
        *buf = 138543362;
        v58 = v36;
        _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Fabric data for pairing fetched from a resident is corrupt", buf, 0xCu);

        v33 = v51;
      }

      objc_autoreleasePoolPop(v33);
      v37 = *(a1 + 48);
      v38 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
      (*(v37 + 16))(v37, 0, 0, v38);

      goto LABEL_22;
    }

    v28 = [v20 rootKeyPair];
    if (v28)
    {
      v29 = v28;
      v30 = [v20 rootCert];
      if (v30)
      {
        v31 = v30;
        v32 = [v20 fabricID];

        if (v32)
        {
LABEL_21:
          (*(*(a1 + 48) + 16))();
LABEL_22:
          v11 = v53;

          goto LABEL_23;
        }
      }

      else
      {
      }
    }

    v39 = objc_autoreleasePoolPush();
    v40 = *(a1 + 32);
    v41 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v42 = v50 = v26;
      v48 = [v20 rootKeyPair];
      HMFBooleanToString();
      v43 = v49 = v40;
      v47 = [v20 rootCert];
      v44 = HMFBooleanToString();
      [v20 fabricID];
      v45 = v52 = v39;
      *buf = 138544130;
      v58 = v42;
      v59 = 2112;
      v60 = v43;
      v61 = 2112;
      v62 = v44;
      v63 = 2112;
      v64 = v45;
      _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Stored fabric data insufficient for pairing: rootKeyPair %@, rootCert %@, fabricID %@", buf, 0x2Au);

      v39 = v52;
      v40 = v49;

      v26 = v50;
    }

    objc_autoreleasePoolPop(v39);
    v20 = 0;
    goto LABEL_21;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = *(a1 + 32);
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
  {
    v18 = HMFGetLogIdentifier();
    *buf = 138543618;
    v58 = v18;
    v59 = 2112;
    v60 = v14;
    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch fabric data for pairing from resident: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v15);
  (*(*(a1 + 48) + 16))();
LABEL_23:

  v46 = *MEMORY[0x277D85DE8];
}

- (void)fetchFabricDataForPairingWithCompletion:(id)a3
{
  v81 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (![(HMDHome *)self hasAnyResident])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      v14 = [(HMDHome *)self fabric];

      if (v14)
      {
        v15 = [(HMDHome *)self operationalKeyPairForPairing];
        v65[0] = MEMORY[0x277D85DD0];
        v65[1] = 3221225472;
        v65[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_413;
        v65[3] = &unk_27866EF88;
        v65[4] = self;
        v66 = v4;
        [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:v15 fetchFromResident:0 completion:v65];

        v13 = v66;
        goto LABEL_10;
      }
    }

    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v74 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot fetch fabric data for pairing without a resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    (*(v4 + 2))(v4, 0, 0, v20);
    goto LABEL_18;
  }

  v5 = [(HMDHome *)self primaryResident];
  if (v5)
  {
    v6 = v5;
    v7 = [(HMDHome *)self primaryResident];
    v8 = [v7 capabilities];

    if (v8)
    {
      if ([(HMDHome *)self isOwnerUser])
      {
        v9 = [(HMDHome *)self primaryResident];
        v10 = [v9 capabilities];
        v11 = [v10 supportsMatterOwnerCertFetch];

        if (v11)
        {
          v12 = [(HMDHome *)self operationalKeyPairForPairing];
          v69[0] = MEMORY[0x277D85DD0];
          v69[1] = 3221225472;
          v69[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_2;
          v69[3] = &unk_27866F1A0;
          v70 = v4;
          [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:v12 fetchFromResident:1 completion:v69];

          v13 = v70;
LABEL_10:

          goto LABEL_19;
        }

        v68 = 0;
        v29 = [(HMDHome *)self storedFabricDataWithError:&v68];
        v30 = v68;
        if (v30)
        {
          v31 = objc_autoreleasePoolPush();
          v32 = self;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v74 = v34;
            v75 = 2112;
            v76 = v30;
            _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Could to retrieve stored fabric data for pairing: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          (*(v4 + 2))(v4, 0, 0, v30);
LABEL_35:

          goto LABEL_19;
        }

        v35 = [v29 residentOperationalKeyPair];
        if (!v35)
        {
          goto LABEL_32;
        }

        v36 = v35;
        v37 = [v29 rootKeyPair];
        if (v37)
        {
          v38 = v37;
          v39 = [v29 rootCert];
          if (v39)
          {
            v40 = v39;
            v41 = [v29 fabricID];

            if (v41)
            {
              v42 = [v29 residentOperationalKeyPair];
              v67 = 0;
              v43 = [(HMDHome *)self createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:v29 operationalKeyPair:v42 error:&v67];
              v44 = v67;
              if (v43)
              {
                v45 = objc_alloc(MEMORY[0x277D17B58]);
                v46 = [v29 rootCert];
                v47 = [v29 ipk];
                v48 = [v29 residentNodeID];
                v49 = [v45 initWithRootCert:v46 ipk:v47 residentNodeID:v48 operationalCert:v43 operationalKeyPair:v42];

                (*(v4 + 2))(v4, v49, 0, 0);
              }

              else
              {
                v58 = objc_autoreleasePoolPush();
                v59 = self;
                v60 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v60, OS_LOG_TYPE_ERROR))
                {
                  v61 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v74 = v61;
                  v75 = 2112;
                  v76 = v44;
                  _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_ERROR, "%{public}@Could not generate operational certificate for pairing: %@", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v58);
                (*(v4 + 2))(v4, 0, 0, v44);
              }

              goto LABEL_19;
            }

LABEL_32:
            v50 = objc_autoreleasePoolPush();
            v51 = self;
            v52 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
            {
              v53 = HMFGetLogIdentifier();
              v63 = [v29 rootKeyPair];
              v54 = HMFBooleanToString();
              v62 = [v29 rootCert];
              HMFBooleanToString();
              v55 = v64 = v50;
              v56 = [v29 fabricID];
              *buf = 138544130;
              v74 = v53;
              v75 = 2112;
              v76 = v54;
              v77 = 2112;
              v78 = v55;
              v79 = 2112;
              v80 = v56;
              _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@Stored fabric data insufficient for pairing: rootKeyPair %@, rootCert %@, fabricID %@", buf, 0x2Au);

              v50 = v64;
            }

            objc_autoreleasePoolPop(v50);
            v57 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
            (*(v4 + 2))(v4, 0, 0, v57);

            goto LABEL_35;
          }
        }

        goto LABEL_32;
      }

      v20 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
      v71[0] = MEMORY[0x277D85DD0];
      v71[1] = 3221225472;
      v71[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke;
      v71[3] = &unk_27866EF88;
      v71[4] = self;
      v72 = v4;
      [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:v20 fetchFromResident:1 completion:v71];

LABEL_18:
      goto LABEL_19;
    }
  }

  v21 = objc_autoreleasePoolPush();
  v22 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    *buf = 138543362;
    v74 = v24;
    _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Cannot fetch fabric data for pairing when a primary resident is unreachable", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  v25 = MEMORY[0x277CCA9B8];
  v26 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
  v27 = [v25 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v26];
  (*(v4 + 2))(v4, 0, 0, v27);

LABEL_19:
  v28 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke(uint64_t a1, void *a2, uint64_t a3, void *a4)
{
  v7 = a2;
  v6 = a4;
  if (v7)
  {
    [*(a1 + 32) storeSharedHomeFabricData:v7];
  }

  (*(*(a1 + 40) + 16))();
}

void __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_413(uint64_t a1, void *a2, void *a3, void *a4)
{
  v24 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  if (v8 | v9)
  {
    v10 = v9;
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Cannot use fetched operational fabric data without stored fabric data for owner local pairing", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];

    v7 = 0;
  }

  v15 = MEMORY[0x277CD5230];
  v16 = [v8 residentOperationalKeyPair];
  v17 = [v7 operationalCert];
  LODWORD(v15) = [v15 keypair:v16 matchesCertificate:v17];

  if (v15)
  {
    v18 = *(a1 + 32);
    v19 = [v7 operationalNodeID];
    v20 = [v18 privateDataSourceForNode:v19];
  }

  (*(*(a1 + 40) + 16))();

  v21 = *MEMORY[0x277D85DE8];
}

- (void)clearAccessoryServerBrowserOperationalFabricData
{
  v6 = [(HMDHome *)self homeManager];
  v3 = [v6 accessoryBrowser];
  v4 = [v3 chipAccessoryServerBrowser];
  v5 = [(HMDHome *)self targetFabricUUID];
  [v4 clearOperationalFabricDataForTargetFabricUUID:v5];
}

- (BOOL)setUpAccessoryServerBrowserWithOperationalFabricData:(id)a3 ownerDataSnapshot:(id)a4 error:(id *)a5
{
  v54 = *MEMORY[0x277D85DE8];
  v7 = a3;
  v8 = a4;
  v9 = objc_alloc(MEMORY[0x277D17B50]);
  if (v8)
  {
    v10 = [v8 rootKeyPair];
    v11 = [v7 rootCert];
    v12 = [v7 fabricID];
    v13 = [v9 initWithRootKeyPair:v10 rootCertificate:v11 fabricID:v12];
  }

  else
  {
    v10 = [v7 fabricID];
    v13 = [v9 initWithRemoteDelegate:self fabricID:v10];
  }

  v14 = [(HMDHome *)self targetFabricUUID];
  v15 = [(HMDHome *)self homeManager];
  v16 = [v15 chipDataSource];
  v17 = [v16 allTargetFabricUUIDs];

  v18 = [v7 operationalNodeID];
  v19 = [(HMDHome *)self privateDataSourceForNode:v18];

  v20 = [(HMDHome *)self isFeatureMatterLocalFabricConfigEnabled];
  if (v19)
  {
    LODWORD(v21) = 0;
  }

  else
  {
    LODWORD(v21) = v20;
  }

  if (v21 == 1)
  {
    v40 = v17;
    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v25 = v21 = v13;
      *buf = 138543362;
      v47 = v25;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Cannot set up operational fabric data without private data source", buf, 0xCu);

      v13 = v21;
      LOBYTE(v21) = 1;
    }

    objc_autoreleasePoolPop(v22);
    *a5 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
    v17 = v40;
  }

  else
  {
    v26 = [v8 rootKeyPair];

    if (v26)
    {
      v27 = [v8 rootKeyPair];
      v45 = SecKeyCopyExternalRepresentation([v27 publicKey], 0);
    }

    else
    {
      v45 = 0;
    }

    v42 = v13;
    v43 = v14;
    if ([(HMDHome *)self isCurrentDevicePrimaryResident])
    {
      v28 = [(HMDHome *)self matterAccessories];
      v29 = [v28 na_map:&__block_literal_global_410];
      v39 = [v29 na_filter:&__block_literal_global_412];
    }

    else
    {
      v39 = 0;
    }

    v41 = v21;
    v30 = objc_autoreleasePoolPush();
    v31 = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      v33 = HMFGetLogIdentifier();
      v34 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[__CFData hash](v45, "hash")}];
      *buf = 138544130;
      v47 = v33;
      v48 = 2112;
      v49 = v7;
      v50 = 2112;
      v51 = v43;
      v52 = 2112;
      v53 = v34;
      _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Setting operational fabric data %@ for target fabric UUID %@, signing key: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v30);
    v35 = [v15 accessoryBrowser];
    v21 = [v35 chipAccessoryServerBrowser];
    v36 = [(HMDHome *)v31 uuid];
    v13 = v42;
    [v21 setOperationalFabricData:v7 operationalCertIssuer:v42 storageDataSource:v19 allTargetFabricUUIDs:v17 entityIdentifier:v36 accessoryServerNodeIDs:v39 forTargetFabricUUID:v43];

    v14 = v43;
    LOBYTE(v21) = v41;
  }

  v37 = *MEMORY[0x277D85DE8];
  return v21 ^ 1;
}

- (id)storedSharedHomeFabricData
{
  v3 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  v4 = [(HMDHome *)self uuid];
  v5 = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v3 initWithHomeUUID:v4 iCloudIdentifier:v5];

  v7 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v6 fabricData];

  return v7;
}

- (void)removeSharedHomeFabricData
{
  v3 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  v4 = [(HMDHome *)self uuid];
  v5 = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v3 initWithHomeUUID:v4 iCloudIdentifier:v5];

  [(HMDCHIPSharedHomeKeychainFabricDataStore *)v6 removeFabricData];
}

- (BOOL)storeSharedHomeFabricData:(id)a3
{
  v4 = a3;
  v5 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  v6 = [(HMDHome *)self uuid];
  v7 = [(HMDHome *)self iCloudIdentifier];
  v8 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v5 initWithHomeUUID:v6 iCloudIdentifier:v7];

  LOBYTE(v7) = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v8 storeFabricData:v4];
  return v7;
}

- (BOOL)auditStorageWithFabricData:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 fabricID];
  if (v5)
  {
    v6 = v5;
    v7 = [v4 fabricID];
    v8 = [v7 isEqual:&unk_283E71918];

    if (!v8)
    {
      v15 = [(HMDHome *)self fabricDataInLegacyStorage];
      v16 = [v15 rootCert];
      if (!v16)
      {
        goto LABEL_15;
      }

      v17 = v16;
      v18 = [v15 residentOperationalCert];
      if (v18)
      {
        v19 = v18;
        v20 = MEMORY[0x277CD5230];
        v21 = [v15 rootCert];
        v22 = [v4 rootCert];
        if ([v20 isCertificate:v21 equalTo:v22])
        {
          v23 = MEMORY[0x277CD5230];
          v24 = [v15 residentOperationalCert];
          v25 = [v4 residentOperationalCert];
          if ([v23 isCertificate:v24 equalTo:v25])
          {
            [v15 ipk];
            v26 = v34 = v24;
            v27 = [v4 ipk];
            v35 = [v26 isEqual:v27];

            if (v35)
            {
              v14 = 1;
LABEL_18:

              goto LABEL_19;
            }

LABEL_15:
            v28 = objc_autoreleasePoolPush();
            v29 = self;
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
            {
              v31 = HMFGetLogIdentifier();
              *buf = 138543362;
              v37 = v31;
              _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Updating fabric data in legacy storage", buf, 0xCu);
            }

            objc_autoreleasePoolPop(v28);
            v14 = [(HMDHome *)v29 storeIntoLegacyStorageWithFabricData:v4];
            goto LABEL_18;
          }
        }
      }

      goto LABEL_15;
    }
  }

  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [v4 fabricID];
    *buf = 138543618;
    v37 = v12;
    v38 = 2112;
    v39 = v13;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot audit storage with invalid fabricID: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = 0;
LABEL_19:

  v32 = *MEMORY[0x277D85DE8];
  return v14;
}

- (BOOL)storeIntoLegacyStorageWithFabricData:(id)a3
{
  v4 = a3;
  v5 = [HMDCHIPHomeDataSource alloc];
  v6 = [v4 fabricID];
  v7 = [(HMDCHIPHomeDataSource *)v5 initWithFabricID:v6 home:self];

  v8 = objc_alloc_init(MEMORY[0x277D17B00]);
  v9 = objc_alloc_init(MEMORY[0x277D17B40]);
  v10 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:v4 chipStorageDelegate:v7 keychainDelegate:v8 v2FabricDataStoreDelegate:v9];

  LOBYTE(v4) = [v10 commit];
  return v4;
}

- (id)fabricDataInLegacyStorage
{
  v3 = [HMDCHIPHomeDataSource alloc];
  v4 = [(HMDHome *)self matterFabricID];
  v5 = [(HMDCHIPHomeDataSource *)v3 initWithFabricID:v4 home:self];

  v6 = objc_alloc_init(MEMORY[0x277D17B00]);
  v7 = objc_alloc_init(MEMORY[0x277D17B30]);
  v8 = [objc_alloc(MEMORY[0x277D17B28]) initWithCHIPStorageDelegate:v5 keychainDelegate:v6 v2FabricDataStoreDelegate:v7];
  v11 = 0;
  v9 = [v8 locallyStoredFabricDataWithDataPresentInV2FabricDataStore:0 error:&v11];

  return v9;
}

- (BOOL)storeNewFabricData:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 fabricID];
  if (v5 && (v6 = v5, [v4 fabricID], v7 = objc_claimAutoreleasedReturnValue(), v8 = objc_msgSend(v7, "isEqual:", &unk_283E71918), v7, v6, !v8))
  {
    v15 = [HMDCHIPHomeDataSource alloc];
    v16 = [v4 fabricID];
    v17 = [(HMDCHIPHomeDataSource *)v15 initWithFabricID:v16 home:self];

    v18 = objc_alloc_init(MEMORY[0x277D17B00]);
    v19 = [HMDCHIPHomeKeychainFabricData alloc];
    v20 = [(HMDHome *)self uuid];
    v21 = [(HMDHome *)self iCloudIdentifier];
    v22 = [(HMDCHIPHomeKeychainFabricData *)v19 initWithHomeUUID:v20 iCloudIdentifier:v21];

    v23 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:v4 chipStorageDelegate:v17 keychainDelegate:v18 v2FabricDataStoreDelegate:v22];
    v14 = [v23 commit];
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v4 fabricID];
      v26 = 138543618;
      v27 = v12;
      v28 = 2112;
      v29 = v13;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot store new fabric data with invalid fabricID: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = 0;
  }

  v24 = *MEMORY[0x277D85DE8];
  return v14;
}

- (id)newFabricData
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self matterFabricID];
  if (v3)
  {
    v4 = v3;
  }

  else
  {
    v4 = &unk_283E71918;
  }

  v5 = [[HMDCHIPHomeDataSource alloc] initWithFabricID:v4 home:self];
  v6 = objc_alloc_init(MEMORY[0x277D17B00]);
  v7 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:v5 keychainDelegate:v6];
  v8 = [v7 newFabricData];
  if (!v8)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v13;
      v14 = "%{public}@Failed to create new fabric data";
LABEL_11:
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, v14, &v17, 0xCu);
    }

LABEL_12:

    objc_autoreleasePoolPop(v10);
    v9 = 0;
    goto LABEL_13;
  }

  if (![(HMDHome *)self storeNewFabricData:v8])
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v13;
      v14 = "%{public}@Failed to store newly created fabric data";
      goto LABEL_11;
    }

    goto LABEL_12;
  }

  v9 = v8;
LABEL_13:

  v15 = *MEMORY[0x277D85DE8];
  return v9;
}

- (id)storedFabricDataWithDataPresentInV2FabricDataStore:(BOOL *)a3 error:(id *)a4
{
  v7 = [(HMDHome *)self matterFabricID];
  if (v7)
  {
    v8 = v7;
  }

  else
  {
    v8 = &unk_283E71918;
  }

  v9 = [[HMDCHIPHomeDataSource alloc] initWithFabricID:v8 home:self];
  v10 = objc_alloc_init(MEMORY[0x277D17B00]);
  v11 = [HMDCHIPHomeKeychainFabricData alloc];
  v12 = [(HMDHome *)self uuid];
  v13 = [(HMDHome *)self iCloudIdentifier];
  v14 = [(HMDCHIPHomeKeychainFabricData *)v11 initWithHomeUUID:v12 iCloudIdentifier:v13];

  v15 = [objc_alloc(MEMORY[0x277D17B28]) initWithCHIPStorageDelegate:v9 keychainDelegate:v10 v2FabricDataStoreDelegate:v14];
  v16 = [v15 locallyStoredFabricDataWithDataPresentInV2FabricDataStore:a3 error:a4];

  return v16;
}

- (id)iCloudIdentifier
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 appleAccountManager];

  if (![v3 isLoggedInToPrimaryAccount] || (objc_msgSend(v3, "accountContext"), v4 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v4, "identifier"), v5 = objc_claimAutoreleasedReturnValue(), v4, !v5))
  {
    v5 = @"NOT-LOGGED-IN";
    v6 = @"NOT-LOGGED-IN";
  }

  return v5;
}

- (id)storedOperationalKeyPair
{
  v21 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isOwnerUser])
  {
    v16 = 0;
    v3 = [(HMDHome *)self storedFabricDataWithError:&v16];
    v4 = v16;
    if (!v3)
    {
      v5 = objc_autoreleasePoolPush();
      v6 = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v8;
        v19 = 2112;
        v20 = v4;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Failed to fetch sstored operational key pair, which may happen when owner never created the key: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v5);
    }

    v9 = [v3 residentOperationalKeyPair];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Unexpected call to storedOperationalKeyPair for shared user", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    v9 = 0;
  }

  v14 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)operationalKeyPairForPairing
{
  v2 = [(HMDHome *)self storedOperationalKeyPair];
  if (!v2)
  {
    v2 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
  }

  return v2;
}

- (id)matterPathWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self matterAccessories];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __36__HMDHome_CHIP__matterPathWithUUID___block_invoke;
  v10[3] = &unk_27866F158;
  v11 = v4;
  v6 = v4;
  v7 = [v5 na_map:v10];
  v8 = [v7 firstObject];

  return v8;
}

id __36__HMDHome_CHIP__matterPathWithUUID___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 matterAdapter];
  v4 = [v3 matterPathWithUUID:*(a1 + 32)];

  return v4;
}

- (BOOL)isPrimaryResidentNodeReachable
{
  v2 = [(HMDHome *)self primaryResident];
  v3 = [v2 isReachable];

  return v3;
}

- (id)currentDeviceControllerNodeID
{
  v2 = [(HMDHome *)self controllerPrivateStorage];
  v3 = [v2 cachedLocalControllerNodeID];

  return v3;
}

- (id)privateDataSourceForNode:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self controllerPrivateStorage];
  v6 = [v5 privateDataSourceForControllerNodeID:v4];

  return v6;
}

- (BOOL)areAllThreadResidentNodesUnreachable
{
  v2 = [(HMDHome *)self enabledResidents];
  v3 = [v2 na_allObjectsPassTest:&__block_literal_global_402_8947];

  return v3;
}

uint64_t __53__HMDHome_CHIP__areAllThreadResidentNodesUnreachable__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 capabilities];
  if ([v3 supportsThreadBorderRouter])
  {
    v4 = [v2 isReachable] ^ 1;
  }

  else
  {
    v4 = 1;
  }

  return v4;
}

- (void)updateUserCATWithOperatePrivilege:(id)a3 administerPrivilege:(id)a4 completion:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __82__HMDHome_CHIP__updateUserCATWithOperatePrivilege_administerPrivilege_completion___block_invoke;
  v15[3] = &unk_278689AB8;
  v15[4] = self;
  v16 = v8;
  v17 = v9;
  v18 = v10;
  v12 = v10;
  v13 = v9;
  v14 = v8;
  dispatch_async(v11, v15);
}

void __82__HMDHome_CHIP__updateUserCATWithOperatePrivilege_administerPrivilege_completion___block_invoke(uint64_t a1)
{
  v1 = a1;
  v48 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) backingStore];
  v3 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v33 = [v2 transaction:@"UpdatingUserCATIDs" options:v3];

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v4 = [*(v1 + 32) users];
  v5 = [v4 countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v5)
  {

    goto LABEL_23;
  }

  v7 = v5;
  v8 = 0;
  v9 = *v36;
  v34 = (v1 + 48);
  v32 = v1;
  v10 = (v1 + 40);
  *&v6 = 138544130;
  v29 = v6;
  v31 = v4;
  do
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(v4);
      }

      v12 = *(*(&v35 + 1) + 8 * i);
      v13 = [v12 privilege];
      if (v13 != 4)
      {
        if (v13 == 3)
        {
          if (!*v34)
          {
            continue;
          }

          v17 = [v12 matterCASEAuthenticatedTagID];
          v18 = [v17 isEqual:*v34];

          v16 = v34;
          if (v18)
          {
            continue;
          }

          goto LABEL_14;
        }

        if (v13)
        {
          continue;
        }
      }

      if (!*v10)
      {
        continue;
      }

      v14 = [v12 matterCASEAuthenticatedTagID];
      v15 = [v14 isEqual:*v10];

      v16 = v10;
      if (v15)
      {
        continue;
      }

LABEL_14:
      v19 = *v16;
      if (v19)
      {
        v20 = v19;
        v21 = [v12 newModelWithChangeType:2];
        [v21 setMatterCASEAuthenticatedTagID:v20];
        [v33 add:v21];
        v22 = objc_autoreleasePoolPush();
        v23 = *(v32 + 32);
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v25 = v30 = v22;
          v26 = [v20 integerValue];
          *buf = v29;
          v40 = v25;
          v41 = 2112;
          v42 = v12;
          v43 = 2048;
          v44 = v26;
          v45 = 2112;
          v46 = v20;
          _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Updated CATID transaction for user %@ to 0x%lX (%@)", buf, 0x2Au);

          v22 = v30;
        }

        objc_autoreleasePoolPop(v22);
        v8 = 1;
        v4 = v31;
      }
    }

    v7 = [v4 countByEnumeratingWithState:&v35 objects:v47 count:16];
  }

  while (v7);

  v1 = v32;
  if (v8)
  {
    [v33 run:*(v32 + 56)];
    goto LABEL_25;
  }

LABEL_23:
  v27 = *(v1 + 56);
  if (v27)
  {
    (*(v27 + 16))(v27, 0);
  }

LABEL_25:

  v28 = *MEMORY[0x277D85DE8];
}

- (void)incrementOperatePrivilegeCATVersion:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self accessoryOperatePrivilegeCATID:1];
  v13 = 0;
  [MEMORY[0x277D17B90] parseCaseAuthenticatedTag:v5 identifier:&v13 + 2 version:&v13];
  v6 = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:HIWORD(v13) version:(v13 + 1)];
  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [v6 integerValue];
    *buf = 138543874;
    v15 = v10;
    v16 = 2048;
    v17 = v11;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Bumping tag version for operate as 0x%lX (%@)", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v4[2](v4, v6);

  v12 = *MEMORY[0x277D85DE8];
}

- (id)accessoryAdministerPrivilegeCATID:(BOOL)a3
{
  v3 = a3;
  v48 = *MEMORY[0x277D85DE8];
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  v5 = [(HMDHome *)self users];
  v6 = [v5 countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v6)
  {
LABEL_21:

LABEL_22:
    v8 = [(HMDHome *)self currentAdministerCATID];

    if (v8)
    {
      v8 = [(HMDHome *)self currentAdministerCATID];
    }

    if (!v8 && v3)
    {
      v8 = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:objc_msgSend(MEMORY[0x277D17B90] version:{"randomCASEAuthenticatedTagIdentifier"), 1}];
      v27 = objc_autoreleasePoolPush();
      v28 = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        v31 = [v8 integerValue];
        *buf = 138543874;
        v40 = v30;
        v41 = 2048;
        v42 = v31;
        v43 = 2112;
        v44 = v8;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Generated new CAT for accessory administer 0x%lX (%@)", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v27);
    }

    goto LABEL_29;
  }

  v7 = v6;
  v34 = v3;
  v8 = 0;
  v9 = *v36;
  while (2)
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(v5);
      }

      v11 = *(*(&v35 + 1) + 8 * i);
      if ([v11 privilege] == 3)
      {
        if (v8 || ([v11 matterCASEAuthenticatedTagID], v18 = objc_claimAutoreleasedReturnValue(), v18, !v18))
        {
          v12 = [v11 matterCASEAuthenticatedTagID];
          v13 = [v12 isEqual:v8];

          if ((v13 & 1) == 0)
          {
            v14 = [v11 matterCASEAuthenticatedTagID];
            if (v14)
            {
              v15 = v14;
              v16 = [v11 matterCASEAuthenticatedTagID];
              v17 = [v16 isEqual:v8];

              if ((v17 & 1) == 0)
              {
                v19 = objc_autoreleasePoolPush();
                v20 = self;
                v21 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
                {
                  v23 = HMFGetLogIdentifier();
                  v24 = [v8 integerValue];
                  v25 = [v11 matterCASEAuthenticatedTagID];
                  v26 = [v25 integerValue];
                  *buf = 138544130;
                  v40 = v23;
                  v41 = 2048;
                  v42 = v24;
                  v43 = 2048;
                  v44 = v26;
                  v45 = 2112;
                  v46 = v11;
                  _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@CATID mismatch between users - current 0x%lX userCAT 0x%lX user %@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v19);
                v3 = v34;
                goto LABEL_21;
              }
            }
          }
        }

        else
        {
          v8 = [v11 matterCASEAuthenticatedTagID];
        }
      }
    }

    v7 = [v5 countByEnumeratingWithState:&v35 objects:v47 count:16];
    if (v7)
    {
      continue;
    }

    break;
  }

  v3 = v34;
  if (!v8)
  {
    goto LABEL_22;
  }

LABEL_29:
  [(HMDHome *)self setCurrentAdministerCATID:v8];
  v32 = *MEMORY[0x277D85DE8];

  return v8;
}

- (id)accessoryOperatePrivilegeCATID:(BOOL)a3
{
  v3 = a3;
  v48 = *MEMORY[0x277D85DE8];
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  v5 = [(HMDHome *)self users];
  v6 = [v5 countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v6)
  {
LABEL_21:

LABEL_22:
    v8 = [(HMDHome *)self currentOperateCATID];

    if (v8)
    {
      v8 = [(HMDHome *)self currentOperateCATID];
    }

    if (!v8 && v3)
    {
      v8 = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:objc_msgSend(MEMORY[0x277D17B90] version:{"randomCASEAuthenticatedTagIdentifier"), 1}];
      v27 = objc_autoreleasePoolPush();
      v28 = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        v31 = [v8 integerValue];
        *buf = 138543874;
        v40 = v30;
        v41 = 2048;
        v42 = v31;
        v43 = 2112;
        v44 = v8;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Generated new CAT for accessory operate 0x%lX (%@)", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v27);
    }

    goto LABEL_29;
  }

  v7 = v6;
  v34 = v3;
  v8 = 0;
  v9 = *v36;
  while (2)
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(v5);
      }

      v11 = *(*(&v35 + 1) + 8 * i);
      if (([v11 privilege] | 4) == 4)
      {
        if (v8 || ([v11 matterCASEAuthenticatedTagID], v18 = objc_claimAutoreleasedReturnValue(), v18, !v18))
        {
          v12 = [v11 matterCASEAuthenticatedTagID];
          v13 = [v12 isEqual:v8];

          if ((v13 & 1) == 0)
          {
            v14 = [v11 matterCASEAuthenticatedTagID];
            if (v14)
            {
              v15 = v14;
              v16 = [v11 matterCASEAuthenticatedTagID];
              v17 = [v16 isEqual:v8];

              if ((v17 & 1) == 0)
              {
                v19 = objc_autoreleasePoolPush();
                v20 = self;
                v21 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
                {
                  v23 = HMFGetLogIdentifier();
                  v24 = [v8 integerValue];
                  v25 = [v11 matterCASEAuthenticatedTagID];
                  v26 = [v25 integerValue];
                  *buf = 138544130;
                  v40 = v23;
                  v41 = 2048;
                  v42 = v24;
                  v43 = 2048;
                  v44 = v26;
                  v45 = 2112;
                  v46 = v11;
                  _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@CATID mismatch between users - current 0x%lX userCAT 0x%lX user %@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v19);
                v3 = v34;
                goto LABEL_21;
              }
            }
          }
        }

        else
        {
          v8 = [v11 matterCASEAuthenticatedTagID];
        }
      }
    }

    v7 = [v5 countByEnumeratingWithState:&v35 objects:v47 count:16];
    if (v7)
    {
      continue;
    }

    break;
  }

  v3 = v34;
  if (!v8)
  {
    goto LABEL_22;
  }

LABEL_29:
  [(HMDHome *)self setCurrentOperateCATID:v8];
  v32 = *MEMORY[0x277D85DE8];

  return v8;
}

- (BOOL)hasSharedUser
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [(HMDHome *)self users];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * i);
        if ([v7 privilege] == 4 || !objc_msgSend(v7, "privilege"))
        {
          v8 = 1;
          goto LABEL_13;
        }
      }

      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
      v8 = 0;
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  else
  {
    v8 = 0;
  }

LABEL_13:

  v9 = *MEMORY[0x277D85DE8];
  return v8;
}

- (void)updateCATIDsForUsersIfNeeded:(BOOL)a3 completion:(id)a4
{
  v4 = a3;
  v37 = *MEMORY[0x277D85DE8];
  v6 = a4;
  if ([(HMDHome *)self _doesUsersHaveCATID]|| ![(HMDHome *)self isOwnerUser])
  {
    goto LABEL_16;
  }

  v7 = [(HMDHome *)self matterAccessories];
  v8 = [v7 count];

  if (!v8 && !v4)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v28 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEBUG, "%{public}@Not Updating CAT as its not pairing and there are no matter accessories yet", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    goto LABEL_16;
  }

  v13 = [(HMDHome *)self residentDeviceManager];
  if ([v13 hasAnyResident])
  {
    v14 = [(HMDHome *)self residentDeviceManager];
    v15 = [v14 isCurrentDeviceConfirmedPrimaryResident];

    if (v15)
    {
      goto LABEL_19;
    }
  }

  else
  {
  }

  v16 = [(HMDHome *)self residentDeviceManager];
  if ([v16 hasAnyResident])
  {

    goto LABEL_16;
  }

  v17 = isThisDeviceDesignatedFMFDevice();

  if ((v17 & 1) == 0 && !v4)
  {
LABEL_16:
    if (v6)
    {
      v6[2](v6, 0);
    }

    goto LABEL_18;
  }

LABEL_19:
  v19 = [(HMDHome *)self accessoryAdministerPrivilegeCATID:1];
  if ([(HMDHome *)self hasSharedUser])
  {
    v20 = [(HMDHome *)self accessoryOperatePrivilegeCATID:1];
  }

  else
  {
    v20 = 0;
  }

  v21 = objc_autoreleasePoolPush();
  v22 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
  {
    v24 = HMFGetLogIdentifier();
    *buf = 138544386;
    v28 = v24;
    v29 = 2048;
    v30 = [v20 integerValue];
    v31 = 2112;
    v32 = v20;
    v33 = 2048;
    v34 = [v19 integerValue];
    v35 = 2112;
    v36 = v19;
    _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_DEBUG, "%{public}@Updating CAT for new user Operate 0x%lX %@, Administer 0x%lX (%@)", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v21);
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __57__HMDHome_CHIP__updateCATIDsForUsersIfNeeded_completion___block_invoke;
  v25[3] = &unk_278689A68;
  v25[4] = v22;
  v26 = v6;
  [(HMDHome *)v22 updateUserCATWithOperatePrivilege:v20 administerPrivilege:v19 completion:v25];

LABEL_18:
  v18 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome_CHIP__updateCATIDsForUsersIfNeeded_completion___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v7;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed transaction to update user CAT: %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v8 = *(a1 + 40);
    if (v8)
    {
      v9 = *(v8 + 16);
LABEL_8:
      v9();
    }
  }

  else
  {
    v10 = *(a1 + 40);
    if (v10)
    {
      v9 = *(v10 + 16);
      goto LABEL_8;
    }
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)_doesUsersHaveCATID
{
  v20 = *MEMORY[0x277D85DE8];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v2 = [(HMDHome *)self users];
  v3 = [v2 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v16;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v16 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v15 + 1) + 8 * i);
        if ([v7 isAllowedToHaveCATId])
        {
          v8 = [v7 matterCASEAuthenticatedTagID];
          if (!v8 || (v9 = v8, [v7 matterCASEAuthenticatedTagID], v10 = objc_claimAutoreleasedReturnValue(), v11 = objc_msgSend(v10, "intValue"), v10, v9, !v11))
          {
            v12 = 0;
            goto LABEL_13;
          }
        }
      }

      v4 = [v2 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  v12 = 1;
LABEL_13:

  v13 = *MEMORY[0x277D85DE8];
  return v12;
}

- (void)_clearCHIPStorageWithCompletion:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self chipStorage];
  v6 = [v5 keyValueStore];
  v7 = [v6 count];

  if (v7)
  {
    v8 = [HMDCHIPHomeDataSource alloc];
    v9 = [(HMDHome *)self matterFabricID];
    v10 = [(HMDCHIPHomeDataSource *)v8 initWithFabricID:v9 home:self];

    v11[0] = MEMORY[0x277D85DD0];
    v11[1] = 3221225472;
    v11[2] = __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke;
    v11[3] = &unk_278689A68;
    v11[4] = self;
    v12 = v4;
    [(HMDCHIPHomeDataSource *)v10 updateKeyValueStore:MEMORY[0x277CBEC10] completion:v11];
  }

  else
  {
    (*(v4 + 2))(v4, 0);
  }
}

void __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke_2;
  v7[3] = &unk_27868A7A0;
  v5 = *(a1 + 40);
  v8 = v3;
  v9 = v5;
  v6 = v3;
  dispatch_async(v4, v7);
}

- (void)_handleResetMatterStorageRequest:(id)a3
{
  v81 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CD0538]];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v78 = v9;
    v79 = 2112;
    v80 = v5;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Handling request to reset Matter storage with corruption option: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  if ([(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0530]])
  {
    v10 = [HMDCHIPHomeDataSource alloc];
    v11 = [(HMDHome *)v7 matterFabricID];
    v12 = [(HMDCHIPHomeDataSource *)v10 initWithFabricID:v11 home:v7];

    v13 = objc_alloc_init(MEMORY[0x277D17AF8]);
    v14 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:v12 keychainDelegate:v13];
    v15 = [v14 newFabricData];
    if (v15)
    {
      v16 = objc_alloc_init(MEMORY[0x277D17B40]);
      v17 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:v15 chipStorageDelegate:v12 keychainDelegate:v13 v2FabricDataStoreDelegate:v16];
      v72 = v5;
      if ([v17 commit])
      {
        if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
        {
          v18 = [(HMDHome *)v7 fabric];
          [v18 invalidateCachedData];
        }

        v19 = objc_autoreleasePoolPush();
        v20 = v7;
        v21 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v22 = v69 = v4;
          *buf = 138543362;
          v78 = v22;
          _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Stored bad fabric data into CHIP storage", buf, 0xCu);

          v4 = v69;
        }

        objc_autoreleasePoolPop(v19);
        v76 = 0;
        [(HMDHome *)v20 setUpOperationalFabricDataWithError:&v76];
        v23 = v76;
        [v4 respondWithSuccess];
      }

      else
      {
        v47 = objc_autoreleasePoolPush();
        v48 = v7;
        v49 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v49, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v50 = v71 = v4;
          *buf = 138543362;
          v78 = v50;
          _os_log_impl(&dword_229538000, v49, OS_LOG_TYPE_ERROR, "%{public}@Failed to store bad fabric data", buf, 0xCu);

          v4 = v71;
        }

        objc_autoreleasePoolPop(v47);
        v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [v4 respondWithError:v23];
      }

      v5 = v72;
    }

    else
    {
      v43 = objc_autoreleasePoolPush();
      v44 = v7;
      v45 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
      {
        v46 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v46;
        _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate bad fabric data", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v43);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [v4 respondWithError:v16];
    }
  }

  else
  {
    if ([(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0528]])
    {
      v12 = [v4 numberForKey:*MEMORY[0x277CD0540]];
      if (v12)
      {
        v73 = v5;
        v13 = objc_alloc_init(MEMORY[0x277D17B08]);
        v24 = objc_alloc_init(MEMORY[0x277D17AF8]);
        v25 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:v13 keychainDelegate:v24];
        v26 = [v25 newFabricData];
        if (v26)
        {
          v70 = v24;
          v27 = v4;
          v28 = [HMDCHIPHomeKeychainFabricData alloc];
          v29 = [(HMDHome *)v7 uuid];
          v30 = [(HMDHome *)v7 iCloudIdentifier];
          v31 = [(HMDCHIPHomeKeychainFabricData *)v28 initWithHomeUUID:v29 iCloudIdentifier:v30];

          LOBYTE(v28) = [(HMDCHIPHomeKeychainFabricData *)v31 storeFabricData:v26 dataVersion:v12];
          context = objc_autoreleasePoolPush();
          v32 = v7;
          v33 = HMFGetOSLogHandle();
          v34 = v33;
          if (v28)
          {
            v4 = v27;
            if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
            {
              v35 = HMFGetLogIdentifier();
              *buf = 138543618;
              v78 = v35;
              v79 = 2112;
              v80 = v12;
              _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Stored additional V2 fabric data item to keychain with data version: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(context);
            [v27 respondWithSuccess];
          }

          else
          {
            v4 = v27;
            if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
            {
              v64 = HMFGetLogIdentifier();
              *buf = 138543362;
              v78 = v64;
              _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Failed to store additional fabric data", buf, 0xCu);
            }

            objc_autoreleasePoolPop(context);
            v65 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
            [v27 respondWithError:v65];
          }

          v24 = v70;
        }

        else
        {
          v60 = objc_autoreleasePoolPush();
          v61 = v7;
          v62 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v62, OS_LOG_TYPE_ERROR))
          {
            v63 = HMFGetLogIdentifier();
            *buf = 138543362;
            v78 = v63;
            _os_log_impl(&dword_229538000, v62, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate additional fabric data", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v60);
          v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          [v4 respondWithError:v31];
        }

        v5 = v73;
      }

      else
      {
        v52 = objc_autoreleasePoolPush();
        v53 = v7;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_ERROR))
        {
          v55 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v55;
          _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_ERROR, "%{public}@Data version is missing for additional V2 key request", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v52);
        v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        [v4 respondWithError:v13];
      }

      goto LABEL_34;
    }

    if (![(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0520]])
    {
      v74[0] = MEMORY[0x277D85DD0];
      v74[1] = 3221225472;
      v74[2] = __50__HMDHome_CHIP___handleResetMatterStorageRequest___block_invoke;
      v74[3] = &unk_27868A1D8;
      v74[4] = v7;
      v75 = v4;
      [(HMDHome *)v7 _clearCHIPStorageWithCompletion:v74];

      goto LABEL_35;
    }

    v12 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
    v36 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
    v13 = v36;
    if (v12 && v36)
    {
      v14 = objc_alloc_init(MEMORY[0x277D17B00]);
      v37 = [v14 forceUpdateNocSigner:v12 ownerSharedOperationalKeyPair:v13];
      v38 = objc_autoreleasePoolPush();
      v39 = v7;
      v40 = HMFGetOSLogHandle();
      v41 = v40;
      if (v37)
      {
        if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v42;
          _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Stored new V0 keys to keychain", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v38);
        [v4 respondWithSuccess];
      }

      else
      {
        if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
        {
          v66 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v66;
          _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_ERROR, "%{public}@Failed to write new V0 keys", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v38);
        v67 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [v4 respondWithError:v67];
      }
    }

    else
    {
      v56 = objc_autoreleasePoolPush();
      v57 = v7;
      v58 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v59 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v59;
        _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_ERROR, "%{public}@Failed to create new V0 keys", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v56);
      v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [v4 respondWithError:v14];
    }
  }

LABEL_34:
LABEL_35:

  v51 = *MEMORY[0x277D85DE8];
}

void __50__HMDHome_CHIP___handleResetMatterStorageRequest___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543618;
      v18 = v7;
      v19 = 2112;
      v20 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to clear CHIP storage: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 40) respondWithError:v3];
  }

  else
  {
    if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
    {
      v8 = [*(a1 + 32) fabric];
      [v8 invalidateCachedData];
    }

    v9 = *(a1 + 32);
    v16 = 0;
    [v9 setUpOperationalFabricDataWithError:&v16];
    v10 = v16;
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Cleared and left CHIP storage as empty", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    [*(a1 + 40) respondWithSuccess];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)handleMatterPairingCompletionNotification:(id)a3
{
  v37 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 numberForKey:@"HMDHomePairingCompletionNodeIDMessageKey"];
  v6 = [v4 numberForKey:@"HMDHomePairingCompletionFabricIDMessageKey"];
  v7 = [v4 numberForKey:@"HMDHomePairingCompletionVendorIDMessageKey"];
  v8 = [v4 numberForKey:@"HMDHomePairingCompletionProductIDMessageKey"];
  v9 = [v4 numberForKey:@"HMDHomePairingCompletionConfigNumberMessageKey"];
  v10 = [v4 numberForKey:@"HMDHomePairingCompletionCategoryMessageKey"];
  v11 = [v4 dataForKey:@"HMDHomePairingCompletionTopologyMessageKey"];
  v12 = v11;
  if (v5 && v6)
  {
    v29 = [(HMDHome *)self homeManager];
    v27 = [v29 accessoryBrowserInternal];
    [v27 chipAccessoryServerBrowser];
    v13 = v5;
    v14 = v6;
    v15 = v10;
    v16 = v9;
    v17 = v8;
    v19 = v18 = v7;
    v20 = [(HMDHome *)self targetFabricUUID];
    [v19 handlePairingCompletionForAccessoryWithNodeID:v13 targetFabricUUID:v20 fabricID:v14 vendorID:v18 productID:v17 configNumber:v16 category:v15 topology:v12];

    v7 = v18;
    v8 = v17;
    v9 = v16;
    v10 = v15;
    v6 = v14;
    v5 = v13;

    [v4 respondWithSuccess];
  }

  else
  {
    v30 = v11;
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v24 = v28 = v21;
      *buf = 138543874;
      v32 = v24;
      v33 = 2112;
      v34 = v5;
      v35 = 2112;
      v36 = v6;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Resident cannot establish connection with accessory with accessory node ID = %@, fabric ID = %@", buf, 0x20u);

      v21 = v28;
    }

    objc_autoreleasePoolPop(v21);
    v25 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
    [v4 respondWithError:v25];

    v12 = v30;
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)completePotentialFabricDataCreation
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v4 = [v3 count];

  if (v4)
  {
    v5 = [(HMDHome *)self potentialFabricDataCreationBlocks];
    [v5 removeObjectAtIndex:0];
  }

  v6 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v7 = [v6 count];

  if (v7)
  {
    v8 = [(HMDHome *)self potentialFabricDataCreationBlocks];
    v9 = [v8 objectAtIndexedSubscript:0];

    os_unfair_recursive_lock_unlock();
    if (v9)
    {
      v9[2]();
    }
  }

  else
  {

    os_unfair_recursive_lock_unlock();
  }
}

- (void)runPotentialFabricDataCreationBlock:(id)a3
{
  aBlock = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v5 = [v4 count];

  v6 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v7 = _Block_copy(aBlock);
  [v6 addObject:v7];

  os_unfair_recursive_lock_unlock();
  if (!v5)
  {
    aBlock[2]();
  }
}

- (void)exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:(id)a3 commissioneeNodeID:(id)a4 fabricID:(id)a5 publicKey:(id)a6 sender:(id)a7 completion:(id)a8
{
  v71 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  if (![(HMDHome *)self isOwnerUser])
  {
    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_17;
    }

    v27 = HMFGetLogIdentifier();
    *buf = 138543362;
    v66 = v27;
    v29 = "%{public}@Non-owner user cannot handle request to generate certificates";
    v30 = v26;
    v31 = 12;
LABEL_15:
    _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, v29, buf, v31);
LABEL_16:

    goto LABEL_17;
  }

  if (!v17)
  {
    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_17;
    }

    v27 = HMFGetLogIdentifier();
    *buf = 138543618;
    v66 = v27;
    v67 = 2112;
    v68 = 0;
    v29 = "%{public}@Cannot handle remote request to retrieve certificates with public Key: %@";
    v30 = v26;
    v31 = 22;
    goto LABEL_15;
  }

  if (!isFeatureMatterLocalFabricConfigEnabled())
  {
    if (([v16 isEqual:&unk_283E71918] & 1) == 0)
    {
      if (v16)
      {
        v20 = [(HMDHome *)self chipStorage];
        v44 = [v20 fabricID];
        if (!v44)
        {
          goto LABEL_21;
        }

        v22 = v44;
        v55 = [(HMDHome *)self chipStorage];
        v23 = [v55 fabricID];
        if ([v23 isEqual:&unk_283E71918])
        {
LABEL_36:

          goto LABEL_21;
        }

        v51 = [(HMDHome *)self chipStorage];
        v49 = [v51 fabricID];
        v54 = [v16 isEqual:v49];

        if ((v54 & 1) == 0)
        {
          v24 = objc_autoreleasePoolPush();
          v25 = self;
          v26 = HMFGetOSLogHandle();
          if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_17;
          }

          v27 = HMFGetLogIdentifier();
          v53 = [(HMDHome *)v25 chipStorage];
          v56 = v24;
          v28 = [v53 fabricID];
          *buf = 138543874;
          v66 = v27;
          v67 = 2112;
          v68 = v16;
          v69 = 2112;
          v70 = v28;
          goto LABEL_46;
        }
      }

LABEL_22:
      if ([v14 isEqualToNumber:&unk_283E71918])
      {

        v14 = 0;
      }

      if (v15 && !v16)
      {
        v34 = objc_autoreleasePoolPush();
        v35 = self;
        v36 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
LABEL_29:

          objc_autoreleasePoolPop(v34);
          v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          (*(v19 + 2))(v19, 0, 0, 0, 0, v16);
          goto LABEL_18;
        }

        v37 = HMFGetLogIdentifier();
        *buf = 138543874;
        v66 = v37;
        v67 = 2112;
        v68 = v15;
        v69 = 2112;
        v70 = 0;
        v38 = "%{public}@Cannot handle remote request to retrieve certificates with device Node ID %@ and fabricID %@";
        v39 = v36;
        v40 = 32;
LABEL_28:
        _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_ERROR, v38, buf, v40);

        goto LABEL_29;
      }

      if (isFeatureMatterLocalFabricConfigEnabled())
      {
        v41 = [(HMDHome *)self fabric];
        v42 = [v41 fabricID];

        v43 = [v18 isOwner];
        if (v42)
        {
          goto LABEL_42;
        }
      }

      else
      {
        v45 = [(HMDHome *)self chipStorage];
        v42 = [v45 fabricID];

        v43 = 0;
        if (v42)
        {
          goto LABEL_42;
        }
      }

      if (![(HMDHome *)self isCurrentDevicePrimaryResident]&& [(HMDHome *)self doesHomeContainResident])
      {
        v34 = objc_autoreleasePoolPush();
        v35 = self;
        v36 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_29;
        }

        v37 = HMFGetLogIdentifier();
        *buf = 138543362;
        v66 = v37;
        v38 = "%{public}@Failing commissioning cert because operational cert creation is not allowed in this device while there is a resident in Home";
        v39 = v36;
        v40 = 12;
        goto LABEL_28;
      }

LABEL_42:
      v46 = [(HMDHome *)self homeManager];
      v57[0] = MEMORY[0x277D85DD0];
      v57[1] = 3221225472;
      v57[2] = __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke;
      v57[3] = &unk_27866F130;
      v57[4] = self;
      v58 = v42;
      v63 = v19;
      v59 = v46;
      v14 = v14;
      v60 = v14;
      v61 = v15;
      v64 = v43;
      v62 = v17;
      v47 = v46;
      v16 = v42;
      [(HMDHome *)self updateCATIDsForUsersIfNeeded:1 completion:v57];

      goto LABEL_18;
    }

LABEL_20:
    v20 = v16;
    v16 = 0;
LABEL_21:

    goto LABEL_22;
  }

  if ([v16 isEqualToNumber:&unk_283E71918])
  {
    goto LABEL_20;
  }

  if (!v16)
  {
    goto LABEL_22;
  }

  v20 = [(HMDHome *)self fabric];
  v21 = [v20 fabricID];
  if (!v21)
  {
    goto LABEL_21;
  }

  v22 = v21;
  v55 = [(HMDHome *)self fabric];
  v23 = [v55 fabricID];
  if ([v23 isEqual:&unk_283E71918])
  {
    goto LABEL_36;
  }

  v50 = [(HMDHome *)self fabric];
  v48 = [v50 fabricID];
  v52 = [v16 isEqual:v48];

  if (v52)
  {
    goto LABEL_22;
  }

  v24 = objc_autoreleasePoolPush();
  v25 = self;
  v26 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
  {
    v27 = HMFGetLogIdentifier();
    v53 = [(HMDHome *)v25 fabric];
    v56 = v24;
    v28 = [v53 fabricID];
    *buf = 138543874;
    v66 = v27;
    v67 = 2112;
    v68 = v16;
    v69 = 2112;
    v70 = v28;
LABEL_46:
    _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle remote request to retrieve certificates for unknown fabricID %@. Current home fabric ID %@", buf, 0x20u);

    v24 = v56;
    goto LABEL_16;
  }

LABEL_17:

  objc_autoreleasePoolPop(v24);
  v32 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
  (*(v19 + 2))(v19, 0, 0, 0, 0, v32);

LABEL_18:
  v33 = *MEMORY[0x277D85DE8];
}

void __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke(uint64_t a1, void *a2)
{
  v48 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v43 = 0;
  v4 = *(a1 + 32);
  v42 = 0;
  v5 = [v4 storedFabricDataWithDataPresentInV2FabricDataStore:&v43 error:&v42];
  v6 = v42;
  v7 = v6;
  if (!v5)
  {
    v8 = [v6 underlyingErrors];
    if ([v8 na_any:&__block_literal_global_388_8951])
    {
    }

    else
    {
      v30 = [v7 domain];
      if ([v30 isEqual:*MEMORY[0x277D0F1A0]])
      {
        v31 = [v7 code];

        if (v31 == 2)
        {
          goto LABEL_4;
        }
      }

      else
      {
      }

      v34 = *(a1 + 40);
      if (!v34 || ([v34 isEqual:&unk_283E71918] & 1) != 0 || (objc_msgSend(v7, "underlyingErrors"), v35 = objc_claimAutoreleasedReturnValue(), v36 = objc_msgSend(v35, "na_any:", &__block_literal_global_390), v35, (v36 & 1) == 0))
      {
        v37 = objc_autoreleasePoolPush();
        v38 = *(a1 + 32);
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_DEFAULT))
        {
          v40 = HMFGetLogIdentifier();
          *buf = 138543618;
          v45 = v40;
          v46 = 2112;
          v47 = v7;
          _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot handle commissioning cert request due to fabric data fetch error: %@", buf, 0x16u);
        }

        v33 = v37;
        goto LABEL_28;
      }
    }

LABEL_4:
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Creating new fabric data", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v5 = [*(a1 + 32) newFabricData];
    v13 = objc_autoreleasePoolPush();
    v14 = *(a1 + 32);
    v15 = HMFGetOSLogHandle();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);
    if (v5)
    {
      if (v16)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v17;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@New fabric data created and stored", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
      v43 = 1;
      v18 = [v5 fabricID];
      v19 = [*(a1 + 32) fabric];
      [v19 setFabricID:v18];

      v20 = [v5 fabricID];
      v21 = [*(a1 + 32) chipStorage];
      [v21 setFabricID:v20];

      goto LABEL_10;
    }

    if (v16)
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v32;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to create new fabric data when handling commissioning cert request", buf, 0xCu);
    }

    v33 = v13;
LABEL_28:
    objc_autoreleasePoolPop(v33);
    (*(*(a1 + 80) + 16))();
    goto LABEL_29;
  }

LABEL_10:
  if ((v43 & 1) == 0)
  {
    v22 = objc_autoreleasePoolPush();
    v23 = *(a1 + 32);
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v25;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Migrating fabric data to V2 fabric data store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v22);
    [*(a1 + 32) storeNewFabricData:v5];
  }

  v26 = [*(a1 + 32) accessoryAdministerPrivilegeCATID:0];
  v27 = [*(a1 + 32) accessoryOperatePrivilegeCATID:0];
  v28 = [*(a1 + 48) accessoryBrowser];
  v29 = [v28 chipAccessoryServerBrowser];
  [v29 fetchCertificatesForMatterNodeWithCommissionerNodeID:*(a1 + 56) commissioneeNodeID:*(a1 + 64) forOwner:*(a1 + 88) publicKey:*(a1 + 72) fabricData:v5 adminCAT:v26 opCAT:v27 completionHandler:*(a1 + 80)];

LABEL_29:
  v41 = *MEMORY[0x277D85DE8];
}

BOOL __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_3(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 domain];
  if ([v3 isEqual:*MEMORY[0x277D17A00]])
  {
    v4 = [v2 code] == 1;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

BOOL __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 domain];
  if ([v3 isEqual:*MEMORY[0x277D17A00]])
  {
    v4 = [v2 code] == 2;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)handleCommissioningCertificateRequestWithCommissionerNodeID:(id)a3 commissioneeNodeID:(id)a4 fabricID:(id)a5 publicKey:(id)a6 sender:(id)a7 completion:(id)a8
{
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  objc_initWeak(&location, self);
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke;
  v26[3] = &unk_27866F0E8;
  objc_copyWeak(&v33, &location);
  v20 = v14;
  v27 = v20;
  v21 = v15;
  v28 = v21;
  v22 = v16;
  v29 = v22;
  v23 = v17;
  v30 = v23;
  v24 = v18;
  v31 = v24;
  v25 = v19;
  v32 = v25;
  [(HMDHome *)self runPotentialFabricDataCreationBlock:v26];

  objc_destroyWeak(&v33);
  objc_destroyWeak(&location);
}

void __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v3 = *(a1 + 32);
  v4 = *(a1 + 40);
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v7 = *(a1 + 64);
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2;
  v8[3] = &unk_27866F0C0;
  objc_copyWeak(&v10, (a1 + 80));
  v9 = *(a1 + 72);
  [WeakRetained exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:v3 commissioneeNodeID:v4 fabricID:v5 publicKey:v6 sender:v7 completion:v8];

  objc_destroyWeak(&v10);
}

void __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2(uint64_t a1, void *a2, void *a3, void *a4, void *a5, void *a6)
{
  v11 = a6;
  v12 = a5;
  v13 = a4;
  v14 = a3;
  v15 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  (*(*(a1 + 32) + 16))();

  [WeakRetained completePotentialFabricDataCreation];
}

- (void)handleCommissioningCertificateRequest:(id)a3
{
  v4 = a3;
  v5 = [v4 numberForKey:@"HMDHomeCommissioningDeviceNodeIDMessageKey"];
  v6 = [v4 numberForKey:@"HMDHomeCommissioningFabricIDMessageKey"];
  v7 = [v4 dataForKey:@"HMDHomeCommissioningPublicKeyMessageKey"];
  v8 = [v4 userForHome:self];
  if (!isFeatureMatterLocalFabricConfigEnabled())
  {
    goto LABEL_4;
  }

  v9 = [v4 numberForKey:@"HMDHomeCommissioningCommissionerNodeIDMessageKey"];
  if ([v9 isEqualToNumber:&unk_283E71918])
  {

LABEL_4:
    v9 = 0;
  }

  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __55__HMDHome_CHIP__handleCommissioningCertificateRequest___block_invoke;
  v11[3] = &unk_27866F098;
  v12 = v4;
  v10 = v4;
  [(HMDHome *)self handleCommissioningCertificateRequestWithCommissionerNodeID:v9 commissioneeNodeID:v5 fabricID:v6 publicKey:v7 sender:v8 completion:v11];
}

void __55__HMDHome_CHIP__handleCommissioningCertificateRequest___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, uint64_t a6)
{
  v15 = a2;
  v11 = a3;
  v12 = a4;
  v13 = a5;
  if (a6)
  {
    [*(a1 + 32) respondWithError:a6];
  }

  else
  {
    v14 = [MEMORY[0x277CBEB38] dictionary];
    [v14 setObject:v15 forKeyedSubscript:@"HMDHomeCommissioningRootCertMessageKey"];
    [v14 setObject:v11 forKeyedSubscript:@"HMDHomeCommissioningOperationalCertMessageKey"];
    [v14 setObject:v12 forKeyedSubscript:@"HMDHomeCommissioningOwnerNodeIDMessageKey"];
    [v14 setObject:v13 forKeyedSubscript:@"HMDHomeCommissioningIPKMessageKey"];
    [*(a1 + 32) respondWithPayload:v14];
  }
}

- (void)_dispatchCHIPReport:(id)a3 destination:(id)a4
{
  v35 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [HMDDeviceHandle deviceHandleForDestination:v7];
  v9 = +[HMDAccountRegistry sharedRegistry];
  v10 = [v9 deviceForHandle:v8];

  v11 = [v10 account];

  if (v11)
  {
    if (![v10 isCurrentDevice])
    {
      objc_initWeak(buf, self);
      v20 = [(HMDHome *)self homeManager];
      v21 = [v6 copy];
      v22 = [(HMDHome *)self uuid];
      v23 = [(HMDHome *)self workQueue];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __49__HMDHome_CHIP___dispatchCHIPReport_destination___block_invoke;
      v25[3] = &unk_278689460;
      objc_copyWeak(&v28, buf);
      v26 = v6;
      v27 = v7;
      [v20 sendSecureMessage:v21 target:v22 userID:v27 destination:v27 responseQueue:v23 responseHandler:v25];

      objc_destroyWeak(&v28);
      objc_destroyWeak(buf);
      goto LABEL_10;
    }

    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v30 = v15;
      v31 = 2112;
      v32 = v7;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Skipping device %@ - ourselves", buf, 0x16u);
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [v10 shortDescription];
      *buf = 138543874;
      v30 = v18;
      v31 = 2112;
      v32 = v19;
      v33 = 2112;
      v34 = v7;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Device %@ for CHIP report destination %@ has no user attached to it. Destination removed.", buf, 0x20u);
    }
  }

  objc_autoreleasePoolPop(v12);
  v16 = [(HMDHome *)v13 notificationRegistry];
  v17 = [v16 chipRemoteSubscribers];
  [v17 removeObject:v7];

LABEL_10:
  v24 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome_CHIP___dispatchCHIPReport_destination___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v23 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
    if (v5)
    {
      if (v11)
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 40);
        v17 = 138543874;
        v18 = v12;
        v19 = 2112;
        v20 = v13;
        v21 = 2112;
        v22 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Failed to send CHIP report to user %@ due to error %@", &v17, 0x20u);
LABEL_7:
      }
    }

    else if (v11)
    {
      v12 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) messagePayload];
      v15 = *(a1 + 40);
      v17 = 138543874;
      v18 = v12;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = v15;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Sent CHIP report: %@ to user %@", &v17, 0x20u);

      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleCHIPSendRemoteRequestMessage:(id)a3
{
  v52 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v40 = [v4 numberForKey:@"HMDHomeCHIPNodeIDMessageKey"];
  if (v40)
  {
    v38 = v4;
    v43 = 0u;
    v44 = 0u;
    v41 = 0u;
    v42 = 0u;
    v5 = [(HMDHome *)self matterAccessories];
    v6 = [v5 countByEnumeratingWithState:&v41 objects:v51 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v42;
      while (2)
      {
        v9 = 0;
        v39 = v7;
        do
        {
          if (*v42 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = *(*(&v41 + 1) + 8 * v9);
          v11 = objc_autoreleasePoolPush();
          v12 = self;
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
          {
            HMFGetLogIdentifier();
            v14 = v8;
            v15 = self;
            v17 = v16 = v5;
            v18 = [v10 matterNodeID];
            *buf = 138543874;
            v46 = v17;
            v47 = 2112;
            v48 = v18;
            v49 = 2112;
            v50 = v40;
            _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Remote request dispatch compares %@ with %@", buf, 0x20u);

            v5 = v16;
            self = v15;
            v8 = v14;
            v7 = v39;
          }

          objc_autoreleasePoolPop(v11);
          v19 = [v10 matterNodeID];
          if ([v19 isEqual:&unk_283E71918])
          {
          }

          else
          {
            v20 = [v10 matterNodeID];
            v21 = [v20 isEqualToNumber:v40];

            if (v21)
            {
              v32 = objc_autoreleasePoolPush();
              v33 = v12;
              v34 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v34, OS_LOG_TYPE_DEBUG))
              {
                v35 = HMFGetLogIdentifier();
                v36 = [v10 identifier];
                *buf = 138543618;
                v46 = v35;
                v47 = 2112;
                v48 = v36;
                _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_DEBUG, "%{public}@Dispatching remote request to accessory %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v32);
              v4 = v38;
              [v10 handleCHIPSendRemoteRequestMessage:v38];
              goto LABEL_24;
            }
          }

          ++v9;
        }

        while (v7 != v9);
        v7 = [v5 countByEnumeratingWithState:&v41 objects:v51 count:16];
        if (v7)
        {
          continue;
        }

        break;
      }
    }

    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    v4 = v38;
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543618;
      v46 = v25;
      v47 = 2112;
      v48 = v38;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory for CHIP remote request: %@", buf, 0x16u);
    }

    v26 = v22;
  }

  else
  {
    v27 = objc_autoreleasePoolPush();
    v28 = self;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      v30 = HMFGetLogIdentifier();
      v31 = [v4 messagePayload];
      *buf = 138543618;
      v46 = v30;
      v47 = 2112;
      v48 = v31;
      _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Cannot find node ID in CHIP remote request message payload: %@", buf, 0x16u);
    }

    v26 = v27;
  }

  objc_autoreleasePoolPop(v26);
  v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
  [v4 respondWithError:v5];
LABEL_24:

  v37 = *MEMORY[0x277D85DE8];
}

- (void)_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)a3
{
  v31 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v5)
  {
    v6 = [(HMDHome *)self matterAccessories];
    v25[0] = MEMORY[0x277D85DD0];
    v25[1] = 3221225472;
    v25[2] = __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke;
    v25[3] = &unk_278681CA8;
    v7 = v5;
    v26 = v7;
    v8 = [v6 na_firstObjectPassingTest:v25];

    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    v12 = v11;
    if (v8)
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v13;
        v29 = 2112;
        v30 = v8;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Resetting and removing all CHIP pairings from accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke_383;
      v23[3] = &unk_27868A1D8;
      v23[4] = v10;
      v24 = v4;
      [v8 removeAllCHIPPairingsWithCompletion:v23];
    }

    else
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v20;
        v29 = 2112;
        v30 = v7;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory with UUID %@ for reset and remove all CHIP pairings message", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v21];
    }

    v19 = v26;
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v4 messagePayload];
      *buf = 138543618;
      v28 = v17;
      v29 = 2112;
      v30 = v18;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory UUID in reset and remove all CHIP pairings message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v19];
  }

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

void __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke_383(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Ignoring remove all CHIP pairings error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  [*(a1 + 32) handleRemoveAccessoryMessage:*(a1 + 40)];

  v8 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldFallbackLocallyForRemoteMatterRequest:(id)a3
{
  v3 = a3;
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    v4 = [v3 code];
    v5 = 1;
    if (v4 > 8 || ((1 << v4) & 0x11C) == 0)
    {
      v5 = v4 == 3201;
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (void)_sendRemoteMessageUsingNodeId:(unint64_t)a3 payload:(id)a4 completion:(id)a5
{
  v32[2] = *MEMORY[0x277D85DE8];
  v8 = a4;
  v9 = a5;
  v10 = objc_alloc(MEMORY[0x277D0F820]);
  v11 = [(HMDHome *)self uuid];
  v12 = [v10 initWithTarget:v11];

  v31[0] = @"HMDHomeCHIPNodeIDMessageKey";
  v13 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:a3];
  v31[1] = @"HMDHomeCHIPRequestMessageKey";
  v32[0] = v13;
  v32[1] = v8;
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v32 forKeys:v31 count:2];

  v15 = [MEMORY[0x277D0F848] messageWithName:@"HMDHomeCHIPSendRemoteRequestMessage" destination:v12 payload:v14];
  v16 = [v8 CHIPRemoteMessageTimeout];

  if (v16)
  {
    v17 = [v8 CHIPRemoteMessageTimeout];
    [v17 doubleValue];
    [v15 setTimeout:?];
  }

  v22 = MEMORY[0x277D85DD0];
  v23 = 3221225472;
  v24 = __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke;
  v25 = &unk_27866F070;
  v29 = v9;
  v30 = a3;
  v26 = self;
  v27 = v12;
  v28 = v14;
  v18 = v14;
  v19 = v12;
  v20 = v9;
  [v15 setResponseHandler:&v22];
  [(HMDHome *)self handleCHIPSendRemoteRequestMessage:v15, v22, v23, v24, v25, v26];

  v21 = *MEMORY[0x277D85DE8];
}

void __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    if ([*(a1 + 32) _shouldFallbackLocallyForRemoteMatterRequest:v5])
    {
      v7 = [MEMORY[0x277D0F848] messageWithName:@"HMDHomeCHIPSendRemoteRequestMessage" destination:*(a1 + 40) payload:*(a1 + 48)];
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke_382;
      v23[3] = &unk_27866F048;
      v9 = *(a1 + 56);
      v8 = *(a1 + 64);
      v23[4] = *(a1 + 32);
      v25 = v8;
      v24 = v9;
      [v7 setResponseHandler:v23];
      [*(a1 + 32) _handleCHIPSendRemoteRequestMessage:v7];
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = *(a1 + 32);
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v19 = HMFGetLogIdentifier();
        v20 = *(a1 + 64);
        *buf = 138543874;
        v27 = v19;
        v28 = 2048;
        v29 = v20;
        v30 = 2112;
        v31 = v5;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute CHIP remote operation for nodeID=%llu: error=%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v16);
      v21 = *(a1 + 56);
      v7 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
      (*(v21 + 16))(v21, v7, v5);
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 32);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 64);
      *buf = 138543618;
      v27 = v13;
      v28 = 2048;
      v29 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Successfully executed CHIP remote operation for nodeID=%llu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v15 = *(a1 + 56);
    v7 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
    (*(v15 + 16))(v15, v7, 0);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke_382(uint64_t a1, void *a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v5)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = *(a1 + 48);
      v21 = 138543874;
      v22 = v11;
      v23 = 2048;
      v24 = v12;
      v25 = 2112;
      v26 = v5;
      v13 = "%{public}@Failed to execute CHIP local fallback operation for nodeID=%llu: error=%@";
      v14 = v10;
      v15 = OS_LOG_TYPE_ERROR;
      v16 = 32;
LABEL_6:
      _os_log_impl(&dword_229538000, v14, v15, v13, &v21, v16);
    }
  }

  else if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v17 = *(a1 + 48);
    v21 = 138543618;
    v22 = v11;
    v23 = 2048;
    v24 = v17;
    v13 = "%{public}@Successfully executed CHIP local fallback operation for nodeID=%llu";
    v14 = v10;
    v15 = OS_LOG_TYPE_INFO;
    v16 = 22;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v7);
  v18 = *(a1 + 40);
  v19 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
  (*(v18 + 16))(v18, v19, v5);

  v20 = *MEMORY[0x277D85DE8];
}

- (unint64_t)numMatterV2Keys
{
  v3 = [HMDCHIPHomeKeychainFabricData alloc];
  v4 = [(HMDHome *)self uuid];
  v5 = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPHomeKeychainFabricData *)v3 initWithHomeUUID:v4 iCloudIdentifier:v5];

  v7 = [(HMDCHIPHomeKeychainFabricData *)v6 fabricDataItems];
  v8 = [v7 count];

  return v8;
}

- (void)retrieveOperationalCertificatesForFabricID:(id)a3 commissioneeNodeID:(id)a4 publicKey:(id)a5 completion:(id)a6
{
  v10 = a6;
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __100__HMDHome_CHIP__retrieveOperationalCertificatesForFabricID_commissioneeNodeID_publicKey_completion___block_invoke;
  v12[3] = &unk_27866F020;
  v13 = v10;
  v11 = v10;
  [(HMDHome *)self retrieveOperationalCertificatesForFabricID:a3 commissionerNodeID:0 commissioneeNodeID:a4 publicKey:a5 completion:v12];
}

- (BOOL)requiresRemoteFabricDataUpdateThroughPairingCompletionMessage
{
  v2 = [(HMDHome *)self primaryResident];
  v3 = [v2 capabilities];
  v4 = [v3 supportsMatterSharedAdminPairing];

  return v4;
}

- (void)fetchOperationalCertificatesForNewFabricWithFabricID:(id)a3 publicKey:(id)a4 fetchFromResident:(BOOL)a5 completion:(id)a6
{
  v7 = a5;
  v27 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a6;
  if (v7 || [(HMDHome *)self isOwnerUser])
  {
    if (isFeatureMatterLocalFabricConfigEnabled())
    {
      v13 = [(HMDHome *)self controllerPrivateStorage];
      v14 = [v13 cachedLocalControllerNodeID];

      if (!v7)
      {
LABEL_5:
        v15 = [(HMDHome *)self currentUser];
        [(HMDHome *)self handleCommissioningCertificateRequestWithCommissionerNodeID:v14 commissioneeNodeID:0 fabricID:v10 publicKey:v11 sender:v15 completion:v12];

LABEL_8:
        goto LABEL_12;
      }
    }

    else
    {
      v14 = 0;
      if (!v7)
      {
        goto LABEL_5;
      }
    }

    [(HMDHome *)self retrieveOperationalCertificatesForFabricID:v10 commissionerNodeID:v14 commissioneeNodeID:0 publicKey:v11 completion:v12];
    goto LABEL_8;
  }

  v16 = objc_autoreleasePoolPush();
  v17 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
  {
    v19 = HMFGetLogIdentifier();
    v20 = [(HMDHome *)v17 currentUser];
    v23 = 138543618;
    v24 = v19;
    v25 = 2112;
    v26 = v20;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Current user %@ is not the owner. Therefore it must request NOC from the primary resident", &v23, 0x16u);
  }

  objc_autoreleasePoolPop(v16);
  v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:10];
  (*(v12 + 2))(v12, 0, 0, 0, 0, v21);

LABEL_12:
  v22 = *MEMORY[0x277D85DE8];
}

- (void)handleClearMatterControllerPrivateStorageRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __66__HMDHome_CHIP__handleClearMatterControllerPrivateStorageRequest___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __66__HMDHome_CHIP__handleClearMatterControllerPrivateStorageRequest___block_invoke(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  if (![*(a1 + 32) isFeatureMatterLocalFabricConfigEnabled])
  {
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Matter controller private storage is not available to clear", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v13 = *(a1 + 40);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 48;
    goto LABEL_12;
  }

  v2 = [*(a1 + 32) controllerPrivateStorage];
  v3 = [v2 removeAllSDKKeyValuePairs];

  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (!v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v16;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to clear Matter controller private storage", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v13 = *(a1 + 40);
    v14 = MEMORY[0x277CCA9B8];
    v15 = -1;
LABEL_12:
    v17 = [v14 hmErrorWithCode:v15];
    [v13 respondWithError:v17];

    goto LABEL_13;
  }

  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Cleared Matter controller private storage", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 40) respondWithSuccess];
LABEL_13:
  v18 = *MEMORY[0x277D85DE8];
}

- (void)handleResetMatterStorageRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) primaryResidentMessageRouter];
  v3 = v2;
  if (v2)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke_380;
    v12[3] = &unk_27868A398;
    v4 = *(a1 + 40);
    v12[4] = *(a1 + 32);
    [v2 routeMessage:v4 localHandler:v12];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to handle request to reset Matter storage", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v9 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleCHIPSendReportMessage:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke(uint64_t a1)
{
  v57 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) isCurrentDevicePrimaryResident])
  {
    v2 = [*(a1 + 32) notificationRegistry];
    v3 = [v2 chipRemoteSubscribers];
    v4 = [v3 copy];

    v47 = 0u;
    v48 = 0u;
    v45 = 0u;
    v46 = 0u;
    v5 = v4;
    v6 = [v5 countByEnumeratingWithState:&v45 objects:v56 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v46;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v46 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = *(*(&v45 + 1) + 8 * i);
          v11 = objc_autoreleasePoolPush();
          v12 = *(a1 + 32);
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
          {
            v14 = HMFGetLogIdentifier();
            *buf = 138543618;
            v51 = v14;
            v52 = 2112;
            v53 = v10;
            _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Dispatch CHIP report to %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v11);
          [*(a1 + 32) _dispatchCHIPReport:*(a1 + 40) destination:v10];
        }

        v7 = [v5 countByEnumeratingWithState:&v45 objects:v56 count:16];
      }

      while (v7);
    }
  }

  v15 = [*(a1 + 40) numberForKey:@"HMDHomeCHIPNodeIDMessageKey"];
  v36 = [v15 unsignedIntegerValue];

  v16 = [*(a1 + 40) arrayForKey:@"HMDHomeCHIPReportMessageKey"];
  v37 = [v16 na_filter:&__block_literal_global_378];

  if (([*(a1 + 32) isCurrentDevicePrimaryResident] & 1) == 0)
  {
    v17 = [*(a1 + 32) matterAccessories];
    v44[0] = MEMORY[0x277D85DD0];
    v44[1] = 3221225472;
    v44[2] = __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_2;
    v44[3] = &__block_descriptor_40_e50_B16__0__HMDAccessory_HMDMatterAccessoryProtocol__8l;
    v44[4] = v36;
    v18 = [v17 na_firstObjectPassingTest:v44];

    if (v18)
    {
      v42[0] = MEMORY[0x277D85DD0];
      v42[1] = 3221225472;
      v42[2] = __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_3;
      v42[3] = &unk_278682C28;
      v42[4] = *(a1 + 32);
      v43 = v18;
      [v37 na_each:v42];
    }

    else
    {
      v19 = objc_autoreleasePoolPush();
      v20 = *(a1 + 32);
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138543874;
        v51 = v22;
        v52 = 2048;
        v53 = v36;
        v54 = 2112;
        v55 = v37;
        _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@Failed to find matching accessory for attribute update notification. nodeID=%lu report=%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v19);
    }
  }

  v40 = 0u;
  v41 = 0u;
  v38 = 0u;
  v39 = 0u;
  v23 = [*(a1 + 32) chipLocalSubscribers];
  v24 = [v23 countByEnumeratingWithState:&v38 objects:v49 count:16];
  if (v24)
  {
    v25 = v24;
    v26 = *v39;
    do
    {
      for (j = 0; j != v25; ++j)
      {
        if (*v39 != v26)
        {
          objc_enumerationMutation(v23);
        }

        v28 = *(*(&v38 + 1) + 8 * j);
        v29 = objc_autoreleasePoolPush();
        v30 = *(a1 + 32);
        v31 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_DEBUG))
        {
          v32 = HMFGetLogIdentifier();
          *buf = 138543618;
          v51 = v32;
          v52 = 2112;
          v53 = v28;
          _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_DEBUG, "%{public}@Calling CHIP report handler for subscriber %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v29);
        v33 = [*(a1 + 32) chipLocalSubscribers];
        v34 = [v33 objectForKeyedSubscript:v28];
        (v34)[2](v34, v36, v37);
      }

      v25 = [v23 countByEnumeratingWithState:&v38 objects:v49 count:16];
    }

    while (v25);
  }

  [*(a1 + 40) respondWithSuccess];
  v35 = *MEMORY[0x277D85DE8];
}

uint64_t __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 matterNodeID];
  v4 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 32)];
  v5 = [v3 isEqualToNumber:v4];

  return v5;
}

void __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_3(uint64_t a1, void *a2)
{
  v38 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [MEMORY[0x277CBEB38] dictionary];
  v5 = [v3 hmf_arrayForKey:*MEMORY[0x277CD50B8]];
  v6 = v5;
  if (v5 && [v5 count] == 3)
  {
    v7 = [v6 objectAtIndexedSubscript:0];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = v7;
    }

    else
    {
      v8 = 0;
    }

    v9 = v8;

    v10 = [v6 objectAtIndexedSubscript:1];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v11 = v10;
    }

    else
    {
      v11 = 0;
    }

    v12 = v11;

    v13 = [v6 objectAtIndexedSubscript:2];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v9)
    {
      v16 = v12 == 0;
    }

    else
    {
      v16 = 1;
    }

    if (v16 || v15 == 0)
    {
      v18 = objc_autoreleasePoolPush();
      v19 = *(a1 + 32);
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        v34 = 138543618;
        v35 = v21;
        v36 = 2112;
        v37 = v3;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to process attribute update: missing endpointID, clusterID, or attributeID. report=%@", &v34, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
    }

    else
    {
      [v4 setObject:v9 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationEndpointIDKey"];
      [v4 setObject:v12 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationClusterIDKey"];
      [v4 setObject:v15 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationAttributeIDKey"];
      v26 = *MEMORY[0x277CD50D8];
      v27 = [v3 hmf_dictionaryForKey:*MEMORY[0x277CD50D8]];
      v28 = [v27 valueForKey:*MEMORY[0x277CD51A0]];
      [v4 setObject:v28 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationDecodedValueKey"];

      v29 = [v3 hmf_dictionaryForKey:v26];
      [v4 setObject:v29 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationDataKey"];

      v30 = [v3 hmf_dictionaryForKey:*MEMORY[0x277CD5170]];
      [v4 setObject:v30 forKeyedSubscript:@"HMDMatterAttributeChangedNotificationPreviousDataKey"];

      v31 = *(a1 + 40);
      v32 = [v4 copy];
      logAndPostNotification(@"HMDMatterAttributeChangedNotification", v31, v32);
    }
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = *(a1 + 32);
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      v34 = 138543618;
      v35 = v25;
      v36 = 2112;
      v37 = v3;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Failed to process attribute update: AttributePath array is invalid. report=%@", &v34, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v33 = *MEMORY[0x277D85DE8];
}

uint64_t __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_375(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & (v2 != 0);
}

- (void)handleCHIPSendRemoteRequestMessage:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled() && ([*(a1 + 32) isPrimaryResidentNodeReachable] & 1) == 0)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Primary resident unreachable, handling CHIP remote request locally", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    [*(a1 + 32) _handleCHIPSendRemoteRequestMessage:*(a1 + 40)];
  }

  else
  {
    v2 = [*(a1 + 32) primaryResidentMessageRouter];
    v3 = v2;
    if (v2)
    {
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke_373;
      v16[3] = &unk_27868A398;
      v4 = *(a1 + 40);
      v16[4] = *(a1 + 32);
      [v2 routeMessage:v4 localHandler:v16];
    }

    else
    {
      v5 = objc_autoreleasePoolPush();
      v6 = *(a1 + 32);
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543362;
        v18 = v8;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to handle CHIP remote request", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
      v9 = *(a1 + 40);
      v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v9 respondWithError:v10];
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)handleRemoteUpdateCHIPKeyValueStoreMessage:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self matterFabricID];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [v4 shortDescription];
      *buf = 138543618;
      v29 = v10;
      v30 = 2112;
      v31 = v11;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Handling remote update CHIP key-value store message: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [[HMDCHIPHomeDataSource alloc] initWithFabricID:v5 home:v7];
    v13 = [v4 dictionaryForKey:@"HMDHomeRemoteUpdateCHIPKeyValueStoreMessageKey"];
    if (v13)
    {
      v14 = [v4 arrayForKey:@"HMDHomeRemoteUpdateCHIPRemovedKeysMessageKey"];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __60__HMDHome_CHIP__handleRemoteUpdateCHIPKeyValueStoreMessage___block_invoke;
      v25[3] = &unk_27866EFD8;
      v26 = v13;
      v27 = v14;
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __60__HMDHome_CHIP__handleRemoteUpdateCHIPKeyValueStoreMessage___block_invoke_2;
      v23[3] = &unk_27868A250;
      v24 = v4;
      v15 = v14;
      [(HMDCHIPHomeDataSource *)v12 updateKeyValueStoreWithBlock:v25 completion:v23];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = v7;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        v21 = [v4 messagePayload];
        *buf = 138543618;
        v29 = v20;
        v30 = 2112;
        v31 = v21;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Did not find key-value store in message payload: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v17);
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      [v4 respondWithError:v15];
    }
  }

  else
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v16;
      v30 = 2112;
      v31 = 0;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle remote update CHIP key-value store message with fabricID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
    [v4 respondWithError:v12];
  }

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __60__HMDHome_CHIP__handleRemoteUpdateCHIPKeyValueStoreMessage___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v7 = *(a1 + 32);
  v8 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v18;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v18 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v17 + 1) + 8 * i);
        if (([v12 isEqual:{@"HMD.MTRPlugin.PairedNodeIDs", v17}] & 1) == 0)
        {
          v13 = [v5 objectForKeyedSubscript:v12];

          if (v13)
          {
            continue;
          }
        }

        v14 = [*(a1 + 32) objectForKeyedSubscript:v12];
        [v5 setObject:v14 forKeyedSubscript:v12];
      }

      v9 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
    }

    while (v9);
  }

  if (*(a1 + 40))
  {
    [v5 removeObjectsForKeys:?];
    [v6 addObjectsFromArray:*(a1 + 40)];
  }

  v15 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)hasThreadCapableResident
{
  v2 = [(HMDHome *)self enabledResidents];
  v3 = [v2 na_any:&__block_literal_global_367];

  return v3;
}

uint64_t __41__HMDHome_CHIP__hasThreadCapableResident__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 capabilities];
  v3 = [v2 supportsThreadBorderRouter];

  return v3;
}

- (void)setUpSharedUserFabricDataWithForceFetch:(BOOL)a3 completion:(id)a4
{
  v44 = *MEMORY[0x277D85DE8];
  v6 = a4;
  if ([(HMDHome *)self isOwnerUser])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Owner doesn't set up shared user fabric data", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    if (v6)
    {
      v6[2](v6, 0);
    }

    goto LABEL_31;
  }

  v11 = [(HMDHome *)self currentUser];

  if (v11)
  {
    v12 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
    v13 = [(HMDHome *)self fabric];
    v14 = [v13 fabricID];

    if (v12)
    {
      error = 0;
      v15 = SecKeyCopyExternalRepresentation([v12 publicKey], &error);
      if (!v15)
      {
        v17 = error;
        v18 = objc_autoreleasePoolPush();
        v19 = self;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
        {
          v21 = HMFGetLogIdentifier();
          *buf = 138543618;
          v41 = v21;
          v42 = 2112;
          v43 = v17;
          v22 = "%{public}@Cannot fetch shared user NOC while failing to convert operational public key with error: %@";
          v23 = v20;
          v24 = OS_LOG_TYPE_ERROR;
          goto LABEL_24;
        }

LABEL_25:

        objc_autoreleasePoolPop(v18);
        if (v6)
        {
          (v6)[2](v6, v17);
        }

        goto LABEL_28;
      }

      if (!a3)
      {
        v16 = [(HMDHome *)self storedSharedHomeFabricData];

        if (v16)
        {
          v34 = 0;
          [(HMDHome *)self setUpOperationalFabricDataWithError:&v34];
          v17 = v34;
          v18 = objc_autoreleasePoolPush();
          v19 = self;
          v20 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
          {
            v21 = HMFGetLogIdentifier();
            *buf = 138543618;
            v41 = v21;
            v42 = 2112;
            v43 = v17;
            v22 = "%{public}@Set up shared user fabric data using stored data with error: %@";
            v23 = v20;
            v24 = OS_LOG_TYPE_INFO;
LABEL_24:
            _os_log_impl(&dword_229538000, v23, v24, v22, buf, 0x16u);

            goto LABEL_25;
          }

          goto LABEL_25;
        }
      }

      v35[0] = MEMORY[0x277D85DD0];
      v35[1] = 3221225472;
      v35[2] = __68__HMDHome_CHIP__setUpSharedUserFabricDataWithForceFetch_completion___block_invoke;
      v35[3] = &unk_27866EFB0;
      v35[4] = self;
      v38 = v6;
      v36 = v14;
      v37 = v12;
      [(HMDHome *)self fetchOperationalCertificatesForNewFabricWithFabricID:v36 publicKey:v15 fetchFromResident:1 completion:v35];
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      v30 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543362;
        v41 = v32;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Cannot fetch shared user NOC without operational keypair", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v29);
      if (!v6)
      {
        goto LABEL_29;
      }

      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
      (v6)[2](v6, v15);
    }

LABEL_28:

LABEL_29:
    goto LABEL_30;
  }

  v25 = objc_autoreleasePoolPush();
  v26 = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
  {
    v28 = HMFGetLogIdentifier();
    *buf = 138543362;
    v41 = v28;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Shared user is not yet user of the home. Will wait for user addition before setting up fabric data", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v25);
  if (v6)
  {
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
    (v6)[2](v6, v12);
LABEL_30:
  }

LABEL_31:

  v33 = *MEMORY[0x277D85DE8];
}

void __68__HMDHome_CHIP__setUpSharedUserFabricDataWithForceFetch_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, void *a6)
{
  v76 = *MEMORY[0x277D85DE8];
  v11 = a2;
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  if (v15)
  {
    v16 = v15;
    v17 = objc_autoreleasePoolPush();
    v18 = *(a1 + 32);
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543618;
      v67 = v20;
      v68 = 2112;
      v69 = v16;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Failed to fetch shared user NOC from resident with error %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
    v21 = *(a1 + 56);
    if (v21)
    {
      (*(v21 + 16))(v21, v16);
    }
  }

  else if (v11 && v12 && v13 && v14)
  {
    v64 = *(a1 + 40);
    v22 = *(a1 + 40);
    if (!v22 || [v22 isEqualToNumber:&unk_283E71918])
    {
      v62 = [MEMORY[0x277CD5230] convertX509Certificate:v11];
      v23 = [objc_alloc(MEMORY[0x277CD5228]) initWithTLVBytes:v62];
      v24 = objc_autoreleasePoolPush();
      v25 = *(a1 + 32);
      v26 = HMFGetOSLogHandle();
      v27 = v26;
      if (v23)
      {
        if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          v60 = [v23 subject];
          v61 = v24;
          v29 = [v60 fabricID];
          *buf = 138543618;
          v67 = v28;
          v68 = 2112;
          v69 = v29;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Updating fabric ID to %@ for Shared Home", buf, 0x16u);

          v24 = v61;
        }

        objc_autoreleasePoolPop(v24);
        v30 = [v23 subject];
        v31 = [v30 fabricID];

        v32 = [*(a1 + 32) fabric];
        [v32 setFabricID:v31];

        v64 = v31;
      }

      else
      {
        if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
        {
          v39 = HMFGetLogIdentifier();
          *buf = 138543362;
          v67 = v39;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Couldn't extract certificate info", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v24);
      }
    }

    v40 = objc_autoreleasePoolPush();
    v41 = *(a1 + 32);
    v42 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v42, OS_LOG_TYPE_INFO))
    {
      v43 = HMFGetLogIdentifier();
      *buf = 138544386;
      v67 = v43;
      v68 = 2112;
      v69 = v64;
      v70 = 2112;
      v71 = v11;
      v72 = 2112;
      v73 = v12;
      v74 = 2112;
      v75 = v13;
      _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_INFO, "%{public}@Successfully created operational certificates from resident for fabric ID %@. Root Certificate %@, Operational certificate %@, Owner NodeID %@", buf, 0x34u);
    }

    objc_autoreleasePoolPop(v40);
    v44 = [objc_alloc(MEMORY[0x277D17B58]) initWithRootCert:v11 ipk:v14 residentNodeID:v13 operationalCert:v12 operationalKeyPair:*(a1 + 48)];
    v45 = objc_autoreleasePoolPush();
    v46 = *(a1 + 32);
    v47 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
    {
      v48 = HMFGetLogIdentifier();
      *buf = 138543618;
      v67 = v48;
      v68 = 2112;
      v69 = v44;
      _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Caching operational fabric data %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v45);
    [*(a1 + 32) storeSharedHomeFabricData:v44];
    v49 = *(a1 + 32);
    v65 = 0;
    [v49 setUpOperationalFabricDataWithError:&v65];
    v16 = v65;
    v50 = objc_autoreleasePoolPush();
    v51 = *(a1 + 32);
    v52 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v63 = v11;
      v53 = v13;
      v54 = v12;
      v55 = v14;
      v57 = v56 = v44;
      *buf = 138543618;
      v67 = v57;
      v68 = 2112;
      v69 = v16;
      _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_INFO, "%{public}@Set up new shared user fabric data with error: %@", buf, 0x16u);

      v44 = v56;
      v14 = v55;
      v12 = v54;
      v13 = v53;
      v11 = v63;
    }

    objc_autoreleasePoolPop(v50);
    v58 = *(a1 + 56);
    if (v58)
    {
      (*(v58 + 16))(v58, v16);
    }
  }

  else
  {
    v33 = objc_autoreleasePoolPush();
    v34 = *(a1 + 32);
    v35 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
    {
      v36 = HMFGetLogIdentifier();
      *buf = 138543362;
      v67 = v36;
      _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Shared user NOC info missing from resident response", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v33);
    v37 = *(a1 + 56);
    if (v37)
    {
      v38 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
      (*(v37 + 16))(v37, v38);
    }

    v16 = 0;
  }

  v59 = *MEMORY[0x277D85DE8];
}

- (void)prepareOperationalFabricData
{
  v17 = *MEMORY[0x277D85DE8];
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    v12 = 0;
    v3 = [(HMDHome *)self setUpOperationalFabricDataWithError:&v12];
    v4 = v12;
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
    if (v3)
    {
      if (v8)
      {
        v9 = HMFGetLogIdentifier();
        v10 = [(HMDHome *)v6 fabric];
        *buf = 138543618;
        v14 = v9;
        v15 = 2112;
        v16 = v10;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Successfully set up operational fabric data for fabric %@", buf, 0x16u);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Delay setting up operational fabric data, matter data source not yet configured", buf, 0xCu);
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v5);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)setUpOperationalFabricDataWithError:(id *)a3
{
  v44 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self fabricSetUpForPairing])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Operational fabric data set up is deferred till pairing is complete", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [MEMORY[0x277CCA9B8] hmfErrorWithCode:9];
    *a3 = v9 = 0;
  }

  else
  {
    v10 = [(HMDHome *)self fetchOperationalFabricDataWithError:a3];
    if (*a3)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v15 = *a3;
        *buf = 138543618;
        v41 = v14;
        v42 = 2112;
        v43 = v15;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to set up operational fabric data due to failure to fetch data with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
      if ([(HMDHome *)v12 retainFabricDataWhenLocallyUnavailable])
      {
        v16 = objc_autoreleasePoolPush();
        v17 = v12;
        v18 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
        {
          v19 = HMFGetLogIdentifier();
          *buf = 138543362;
          v41 = v19;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Will keep using fabric data set up by pairing while fabric data isn't locally available", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v16);
      }

      else
      {
        [(HMDHome *)v12 clearAccessoryServerBrowserOperationalFabricData];
      }

      v20 = [*a3 copy];
      [(HMDHome *)v12 setOperationalFabricError:v20];
      v9 = 0;
    }

    else
    {
      [(HMDHome *)self setRetainFabricDataWhenLocallyUnavailable:0];
      if ([(HMDHome *)self isOwnerUser]&& ![(HMDHome *)self hasAnyResident])
      {
        v39 = 0;
        v20 = [(HMDHome *)self storedFabricDataWithError:&v39];
        v33 = v39;
        if (v33)
        {
          v34 = v33;
          v35 = objc_autoreleasePoolPush();
          v36 = self;
          v37 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
          {
            v38 = HMFGetLogIdentifier();
            *buf = 138543618;
            v41 = v38;
            v42 = 2112;
            v43 = v20;
            _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_INFO, "%{public}@Ignoring error %@ while fetching owner stored fabric data to set up operational fabric data", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v35);
        }
      }

      else
      {
        v20 = 0;
      }

      v21 = [(HMDHome *)self matterFabricID];
      if (!v21)
      {
        goto LABEL_17;
      }

      v22 = v21;
      v23 = [(HMDHome *)self matterFabricID];
      v24 = [v10 fabricID];
      v25 = [v23 isEqual:v24];

      if ((v25 & 1) == 0)
      {
LABEL_17:
        v26 = [v10 fabricID];
        v27 = [(HMDHome *)self fabric];
        [v27 setFabricID:v26];

        v28 = [v10 fabricID];
        v29 = [(HMDHome *)self chipStorage];
        [v29 setFabricID:v28];
      }

      v9 = [(HMDHome *)self setUpAccessoryServerBrowserWithOperationalFabricData:v10 ownerDataSnapshot:v20 error:a3];
      if (*a3)
      {
        v30 = [*a3 copy];
        [(HMDHome *)self setOperationalFabricError:v30];
      }

      else
      {
        [(HMDHome *)self setOperationalFabricError:0];
      }
    }
  }

  v31 = *MEMORY[0x277D85DE8];
  return v9;
}

- (void)unsetFabricForPairing
{
  v11 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setRetainFabricDataWhenLocallyUnavailable:[(HMDHome *)self fabricSetUpForPairing]];
  [(HMDHome *)self setFabricSetUpForPairing:0];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v10 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Attempting to set operational fabric data after pairing completion", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v8 = 0;
  [(HMDHome *)v4 setUpOperationalFabricDataWithError:&v8];
  v7 = *MEMORY[0x277D85DE8];
}

- (void)setUpFabricForPairingWithCompletion:(id)a3
{
  v4 = a3;
  [(HMDHome *)self setFabricSetUpForPairing:1];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_CHIP__setUpFabricForPairingWithCompletion___block_invoke;
  v6[3] = &unk_27866EF88;
  v6[4] = self;
  v7 = v4;
  v5 = v4;
  [(HMDHome *)self fetchFabricDataForPairingWithCompletion:v6];
}

void __53__HMDHome_CHIP__setUpFabricForPairingWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v31 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = *(a1 + 32);
  if (v9)
  {
    [v10 setFabricSetUpForPairing:0];
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v14;
      v29 = 2112;
      v30 = v9;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch fabric data to set up fabric for pairing: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
  }

  else
  {
    v15 = [v10 matterFabricID];
    if (!v15)
    {
      goto LABEL_7;
    }

    v16 = v15;
    v17 = [*(a1 + 32) matterFabricID];
    v18 = [v7 fabricID];
    v19 = [v17 isEqual:v18];

    if ((v19 & 1) == 0)
    {
LABEL_7:
      v20 = [v7 fabricID];
      v21 = [*(a1 + 32) fabric];
      [v21 setFabricID:v20];

      v22 = [v7 fabricID];
      v23 = [*(a1 + 32) chipStorage];
      [v23 setFabricID:v22];
    }

    v24 = *(a1 + 32);
    v26 = 0;
    [v24 setUpAccessoryServerBrowserWithOperationalFabricData:v7 ownerDataSnapshot:v8 error:&v26];
    v9 = v26;
    if (v9)
    {
      [*(a1 + 32) setFabricSetUpForPairing:0];
    }
  }

  (*(*(a1 + 40) + 16))();

  v25 = *MEMORY[0x277D85DE8];
}

- (void)handleUserFabricKeyUpdate:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v16 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling user fabric key update", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [(HMDHome *)v6 homeManager];
  v10 = [v9 hasLoadedData];

  if ([(HMDHome *)v6 isCurrentDevicePrimaryResident])
  {
    goto LABEL_7;
  }

  v11 = [(HMDHome *)v6 featuresDataSource];
  if (([v11 isRVCEnabled] & v10) == 1)
  {

LABEL_7:
    v14 = 0;
    [(HMDHome *)v6 setUpOperationalFabricDataWithError:&v14];

    goto LABEL_8;
  }

  v12 = isFeatureMatteriPhoneOnlyPairingControlEnabled() & v10;

  if (v12 == 1)
  {
    goto LABEL_7;
  }

LABEL_8:

  v13 = *MEMORY[0x277D85DE8];
}

- (void)handleCATUpdate
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v16 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Handling CAT update", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v7 = [(HMDHome *)v4 homeManager];
  if ([(HMDHome *)v4 isOwnerUser])
  {
    if ([(HMDHome *)v4 isCurrentDevicePrimaryResident])
    {
      v8 = [v7 accessoryBrowser];
      v9 = [v8 chipAccessoryServerBrowser];
      v10 = [(HMDHome *)v4 fabric];
      [v9 updateAccessoryACLForFabric:v10];
    }

    else
    {
      v14 = 0;
      [(HMDHome *)v4 setUpOperationalFabricDataWithError:&v14];
    }
  }

  else
  {
    objc_initWeak(buf, v4);
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __32__HMDHome_CHIP__handleCATUpdate__block_invoke;
    v12[3] = &unk_278688A18;
    objc_copyWeak(&v13, buf);
    [(HMDHome *)v4 setUpSharedUserFabricDataWithForceFetch:1 completion:v12];
    objc_destroyWeak(&v13);
    objc_destroyWeak(buf);
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __32__HMDHome_CHIP__handleCATUpdate__block_invoke(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v8;
    v12 = 2112;
    v13 = v3;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Completed CAT update handling with error: %@", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = *MEMORY[0x277D85DE8];
}

- (void)setCHIPReportHandlerWithSubscriber:(id)a3 handler:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __60__HMDHome_CHIP__setCHIPReportHandlerWithSubscriber_handler___block_invoke;
  block[3] = &unk_278689F98;
  v12 = v6;
  v13 = v7;
  block[4] = self;
  v9 = v6;
  v10 = v7;
  dispatch_async(v8, block);
}

void __60__HMDHome_CHIP__setCHIPReportHandlerWithSubscriber_handler___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 48);
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 40);
      v16 = 138543618;
      v17 = v7;
      v18 = 2112;
      v19 = v8;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEBUG, "%{public}@Register CHIP report handler for subscriber %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v9 = [*(a1 + 32) chipLocalSubscribers];

    if (!v9)
    {
      v10 = objc_alloc_init(MEMORY[0x277CBEB38]);
      [*(a1 + 32) setChipLocalSubscribers:v10];
    }

    v11 = _Block_copy(*(a1 + 48));
    v12 = [*(a1 + 32) chipLocalSubscribers];
    [v12 setObject:v11 forKeyedSubscript:*(a1 + 40)];
  }

  else
  {
    if (v6)
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 40);
      v16 = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = v14;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEBUG, "%{public}@Deregister CHIP report handler for subscriber %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v11 = [*(a1 + 32) chipLocalSubscribers];
    [v11 setObject:0 forKeyedSubscript:*(a1 + 40)];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)finishPairingForServer:(id)a3
{
  v6 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v6;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  [v5 finishPairing];

  if (![(HMDHome *)self hasAnyResident])
  {
    [(HMDHome *)self updateHomeLocationForPairing];
  }
}

- (void)_saveAndSyncMatterFabricIDWithCompletion:(id)a3
{
  v4 = a3;
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [(HMDHome *)self emptyModelObjectWithChangeType:2];
    v6 = [(HMDHome *)self fabric];
    v7 = [v6 fabricID];
    [v5 setMatterFabricID:v7];

    v8 = [(HMDHome *)self backingStore];
    v9 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v10 = [v8 transaction:@"Update Matter Fabric ID" options:v9];

    [v10 add:v5];
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __58__HMDHome_CHIP___saveAndSyncMatterFabricIDWithCompletion___block_invoke;
    v12[3] = &unk_278689A68;
    v12[4] = self;
    v13 = v4;
    [v10 run:v12];
  }

  else
  {
    v11 = _Block_copy(v4);
    v5 = v11;
    if (v11)
    {
      (*(v11 + 2))(v11, 0);
    }
  }
}

void __58__HMDHome_CHIP___saveAndSyncMatterFabricIDWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v9 = [*(a1 + 32) fabric];
    v10 = [v9 fabricID];
    v17 = 138543618;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v11 = "%{public}@Failed to sync Matter Fabric ID to %@";
    v12 = v7;
    v13 = OS_LOG_TYPE_ERROR;
  }

  else
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v9 = [*(a1 + 32) fabric];
    v10 = [v9 fabricID];
    v17 = 138543618;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v11 = "%{public}@Successfully sync'ed Matter Fabric ID to %@";
    v12 = v7;
    v13 = OS_LOG_TYPE_INFO;
  }

  _os_log_impl(&dword_229538000, v12, v13, v11, &v17, 0x16u);

LABEL_7:
  objc_autoreleasePoolPop(v4);
  v14 = _Block_copy(*(a1 + 40));
  v15 = v14;
  if (v14)
  {
    (*(v14 + 2))(v14, v3);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)updateFabricUsingHomeModel:(id)a3
{
  v54 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 setProperties];
  if (![v5 containsObject:@"matterFabricID"])
  {
    goto LABEL_11;
  }

  v6 = [(HMDHome *)self fabric];
  v7 = [v6 fabricID];
  v8 = [v4 matterFabricID];
  v9 = HMFEqualObjects();

  if (v9 || ([v4 matterFabricID], (v10 = objc_claimAutoreleasedReturnValue()) == 0))
  {
LABEL_11:

    goto LABEL_12;
  }

  v11 = v10;
  v12 = [v10 isEqualToNumber:&unk_283E71918];

  if (v12)
  {
LABEL_12:
    v25 = 0;
    goto LABEL_13;
  }

  v13 = [(HMDHome *)self fabric];
  v14 = [v13 fabricID];

  v15 = objc_autoreleasePoolPush();
  v16 = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    v19 = [(HMDHome *)v16 fabric];
    v20 = [v19 fabricID];
    v21 = [v4 matterFabricID];
    v48 = 138543874;
    v49 = v18;
    v50 = 2112;
    v51 = v20;
    v52 = 2112;
    v53 = v21;
    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Updating fabric ID from %@ to %@", &v48, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  v22 = [v4 matterFabricID];
  v23 = [(HMDHome *)v16 fabric];
  [v23 setFabricID:v22];

  if (v14 && ([v14 isEqualToNumber:&unk_283E71918] & 1) == 0)
  {
    v24 = [(HMDHome *)v16 fabric];
    [v24 invalidateCachedData];
  }

  v25 = 1;
LABEL_13:
  v26 = [(HMDHome *)self chipStorage];
  v27 = [v26 fabricID];
  v28 = v27;
  if (v27 && ([v27 isEqualToNumber:&unk_283E71918] & 1) == 0)
  {
    v30 = [(HMDHome *)self fabric];
    v31 = [v30 fabricID];
    v32 = [(HMDHome *)self chipStorage];
    v33 = [v32 fabricID];
    v34 = HMFEqualObjects();

    if (v34)
    {
      if (!v25)
      {
        goto LABEL_16;
      }
    }

    else
    {
      v35 = objc_autoreleasePoolPush();
      v36 = self;
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
      {
        v38 = HMFGetLogIdentifier();
        v39 = [(HMDHome *)v36 fabric];
        v40 = [v39 fabricID];
        v41 = [(HMDHome *)v36 chipStorage];
        v42 = [v41 fabricID];
        v48 = 138543874;
        v49 = v38;
        v50 = 2112;
        v51 = v40;
        v52 = 2112;
        v53 = v42;
        _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_INFO, "%{public}@Updating fabric ID from CHIPStorage from %@ to %@", &v48, 0x20u);
      }

      objc_autoreleasePoolPop(v35);
      v43 = [(HMDHome *)v36 chipStorage];
      v44 = [v43 fabricID];
      v45 = [(HMDHome *)v36 fabric];
      [v45 setFabricID:v44];
    }

LABEL_23:
    [(HMDHome *)self _saveAndSyncMatterFabricIDWithCompletion:0];
    v29 = 1;
    goto LABEL_24;
  }

  if (v25)
  {
    goto LABEL_23;
  }

LABEL_16:
  v29 = 0;
LABEL_24:

  v46 = *MEMORY[0x277D85DE8];
  return v29;
}

- (BOOL)updateMatterFabricIDIfNeeded
{
  v3 = [(HMDHome *)self chipStorage];
  v4 = [v3 fabricID];
  if (v4)
  {
    v5 = v4;
    v6 = [v4 isEqualToNumber:&unk_283E71918];

    if ((v6 & 1) == 0)
    {
      v7 = [(HMDHome *)self chipStorage];
      v8 = [v7 fabricID];
      v9 = [(HMDHome *)self fabric];
      [v9 setFabricID:v8];

      [(HMDHome *)self _saveAndSyncMatterFabricIDWithCompletion:0];
      return 1;
    }
  }

  else
  {
  }

  return 0;
}

- (void)handleUpdatedCHIPPropertiesOnHomeModel:(id)a3 actions:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self chipStorage];
  v9 = [v8 updateUsingHomeModel:v6];

  if (isFeatureMatterLocalFabricConfigEnabled() && [(HMDHome *)self updateFabricUsingHomeModel:v6])
  {
    [v7 markChanged];
  }

  if (v9)
  {
    v10 = [(HMDHome *)self workQueue];
    v12 = MEMORY[0x277D85DD0];
    v13 = 3221225472;
    v14 = __64__HMDHome_CHIP__handleUpdatedCHIPPropertiesOnHomeModel_actions___block_invoke;
    v15 = &unk_27868A750;
    v16 = self;
    v11 = v7;
    v17 = v11;
    dispatch_async(v10, &v12);

    [v11 markChanged];
  }
}

void __64__HMDHome_CHIP__handleUpdatedCHIPPropertiesOnHomeModel_actions___block_invoke(uint64_t a1)
{
  v22 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) homeManager];
  if (([v2 hasLoadedData] & 1) == 0)
  {

    goto LABEL_10;
  }

  if (([*(a1 + 32) isCurrentDevicePrimaryResident] & 1) == 0)
  {
    v3 = [*(a1 + 32) featuresDataSource];
    if ([v3 isRVCEnabled])
    {

      goto LABEL_5;
    }

    v14 = isFeatureMatteriPhoneOnlyPairingControlEnabled();

    if (v14)
    {
      goto LABEL_6;
    }

LABEL_10:
    v5 = 0;
    goto LABEL_11;
  }

LABEL_5:

LABEL_6:
  v4 = *(a1 + 32);
  v15 = 0;
  [v4 setUpOperationalFabricDataWithError:&v15];
  v5 = v15;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v19 = v9;
    v20 = 2112;
    v21 = v5;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Set up operational fabric data per CHIP properties change on home model with error: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
LABEL_11:
  v10 = [*(a1 + 40) source] < 2;
  v16 = @"HMDHomeCHIPStorageIsLocalChangeNotificationKey";
  v11 = [MEMORY[0x277CCABB0] numberWithBool:v10];
  v17 = v11;
  v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v17 forKeys:&v16 count:1];

  logAndPostNotification(@"HMDHomeCHIPStorageUpdatedNotification", *(a1 + 32), v12);
  v13 = *MEMORY[0x277D85DE8];
}

- (void)_writeLogData:(id)a3 logName:(id)a4 completion:(id)a5
{
  v44 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = v10;
  if (v8 && v9)
  {
    v12 = [(HMDHome *)self homeManager];
    v13 = [v12 chipDataSource];
    v14 = [v13 fileManager];

    v15 = MEMORY[0x277CBEBC0];
    v16 = HMDCreateHomeKitDaemonCacheDirectory();
    v17 = [v15 fileURLWithPath:v16];

    v18 = [v17 URLByAppendingPathComponent:@"MatterDiagnostics"];

    v37 = 0;
    LOBYTE(v16) = [v14 createDirectoryAtURL:v18 withIntermediateDirectories:1 attributes:0 error:&v37];
    v19 = v37;
    if (v16)
    {
      v20 = [v18 URLByAppendingPathComponent:v9];
      v36 = v19;
      v21 = [v14 writeData:v8 toURL:v20 options:0 error:&v36];
      v22 = v36;

      if ((v21 & 1) == 0)
      {
        v23 = objc_autoreleasePoolPush();
        v24 = self;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v26 = v35 = v23;
          *buf = 138543874;
          v39 = v26;
          v40 = 2112;
          v41 = v20;
          v42 = 2112;
          v43 = v22;
          _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Failed to write log file to path: %@ error: %@", buf, 0x20u);

          v23 = v35;
        }

        objc_autoreleasePoolPop(v23);
        v20 = 0;
      }

      v27 = _Block_copy(v11);
      if (v27)
      {
        v28 = [v20 path];
        v27[2](v27, v28, v22);
      }
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      v30 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543874;
        v39 = v32;
        v40 = 2112;
        v41 = v18;
        v42 = 2112;
        v43 = v19;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Failed to create directory at path: %@ error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
      v33 = _Block_copy(v11);
      v20 = v33;
      if (v33)
      {
        (*(v33 + 2))(v33, 0, v19);
      }

      v22 = v19;
    }

    goto LABEL_19;
  }

  v14 = _Block_copy(v10);
  if (v14)
  {
    v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (v14)[2](v14, 0, v18);
LABEL_19:
  }

  v34 = *MEMORY[0x277D85DE8];
}

- (void)downloadLogWithController:(id)a3 nodeId:(id)a4 type:(int64_t)a5 timeout:(double)a6 completion:(id)a7
{
  v11 = a4;
  v12 = a7;
  v13 = [MEMORY[0x277CBEB38] dictionary];
  [v13 setCHIPRemoteCommand:*MEMORY[0x277D17C70]];
  v14 = [MEMORY[0x277CCABB0] numberWithInteger:a5];
  [v13 setCHIPDownloadLogType:v14];

  v15 = [MEMORY[0x277CCABB0] numberWithDouble:a6];
  [v13 setCHIPDownloadTimeout:v15];

  if (a6)
  {
    v16 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:(a6 + 10.0)];
    [v13 setCHIPRemoteMessageTimeout:v16];
  }

  v17 = [v11 unsignedLongValue];
  v18 = [v13 copy];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __74__HMDHome_CHIP__downloadLogWithController_nodeId_type_timeout_completion___block_invoke;
  v20[3] = &unk_27867D090;
  v20[4] = self;
  v21 = v12;
  v19 = v12;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:v17 payload:v18 completion:v20];
}

void __74__HMDHome_CHIP__downloadLogWithController_nodeId_type_timeout_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v16 = 138543874;
    v17 = v10;
    v18 = 2112;
    v19 = v5;
    v20 = 2112;
    v21 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Download log response: %@, error: %@", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = [v5 hmf_dataForKey:*MEMORY[0x277D17C98]];
  v12 = [v5 hmf_stringForKey:*MEMORY[0x277D17CA0]];
  if (v6)
  {
    v13 = _Block_copy(*(a1 + 40));
    v14 = v13;
    if (v13)
    {
      (*(v13 + 2))(v13, 0, v6);
    }
  }

  else
  {
    [*(a1 + 32) _writeLogData:v11 logName:v12 completion:*(a1 + 40)];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)submitRvcUsageLogEventForNodeID:(unint64_t)a3 endpointID:(id)a4 source:(unint64_t)a5 error:(id)a6
{
  v10 = a4;
  v11 = a6;
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke;
  v14[3] = &unk_27866EF60;
  v14[4] = self;
  v15 = v10;
  v17 = a3;
  v18 = a5;
  v16 = v11;
  v12 = v11;
  v13 = v10;
  [(HMDHome *)self readAttributeWithNodeId:a3 endpointId:v13 clusterId:&unk_283E718A0 attributeId:&unk_283E718B8 params:0 completion:v14];
}

void __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v42 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543618;
      v39 = v10;
      v40 = 2112;
      v41 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned error for current clean mode read, cannot submit clean modes in RVCUsageLogEvent. readCurrentCleanModeError=%@", buf, 0x16u);
    }

    v11 = v7;
LABEL_12:
    objc_autoreleasePoolPop(v11);
    v20 = 0;
    goto LABEL_13;
  }

  v12 = v5;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v13 = v12;
  }

  else
  {
    v13 = 0;
  }

  v14 = v13;

  v15 = [v14 hmf_isEmpty];
  if (v15)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = *(a1 + 32);
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v39 = v19;
      v40 = 2112;
      v41 = v12;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned incorrect data for readCurrentCleanModeValues, cannot submit clean modes in RVCUsageLogEvent. readCurrentCleanModeValues=%@", buf, 0x16u);
    }

    v11 = v16;
    goto LABEL_12;
  }

  v28 = [v12 objectAtIndexedSubscript:0];
  v29 = [v28 objectForKeyedSubscript:*MEMORY[0x277CD50D8]];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v30 = v29;
  }

  else
  {
    v30 = 0;
  }

  v31 = v30;

  v20 = [v31 hmf_numberForKey:*MEMORY[0x277CD51A0]];

LABEL_13:
  v21 = *(a1 + 56);
  v23 = *(a1 + 32);
  v22 = *(a1 + 40);
  v32[0] = MEMORY[0x277D85DD0];
  v32[1] = 3221225472;
  v32[2] = __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_331;
  v32[3] = &unk_27866EF38;
  v32[4] = v23;
  v33 = v20;
  v36 = v21;
  v24 = v22;
  v25 = *(a1 + 64);
  v34 = v24;
  v37 = v25;
  v35 = *(a1 + 48);
  v26 = v20;
  [v23 readAttributeWithNodeId:v21 endpointId:v24 clusterId:&unk_283E718A0 attributeId:&unk_283E718D0 params:0 completion:v32];

  v27 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_331(uint64_t a1, void *a2, void *a3)
{
  v61 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = &unk_22A586000;
  if (v6)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v11;
      v59 = 2112;
      v60 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned error for supported clean modes, cannot submit clean modes in RVCUsageLogEvent. readSupportedCleanModesError=%@", buf, 0x16u);
    }

LABEL_12:
    objc_autoreleasePoolPop(v8);
    v18 = 0;
    goto LABEL_13;
  }

  v12 = v5;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v13 = v12;
  }

  else
  {
    v13 = 0;
  }

  v14 = v13;

  v15 = [v14 hmf_isEmpty];
  if (v15)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v17;
      v59 = 2112;
      v60 = v12;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned incorrect data for readSupportedCleanModesValues, cannot submit clean modes in RVCUsageLogEvent. readSupportedCleanModesValues=%@", buf, 0x16u);
    }

    goto LABEL_12;
  }

  v24 = [v12 objectAtIndexedSubscript:0];
  v25 = *MEMORY[0x277CD50D8];
  v26 = [v24 objectForKeyedSubscript:*MEMORY[0x277CD50D8]];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v27 = v26;
  }

  else
  {
    v27 = 0;
  }

  v28 = v27;

  v29 = *MEMORY[0x277CD51A0];
  v50 = v28;
  v30 = [v28 hmf_arrayForKey:*MEMORY[0x277CD51A0]];
  v55[0] = MEMORY[0x277D85DD0];
  v55[1] = 3221225472;
  v55[2] = __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_332;
  v55[3] = &unk_278686BA8;
  v56 = *(a1 + 40);
  v31 = [v30 na_firstObjectPassingTest:v55];
  v32 = [v31 objectForKeyedSubscript:v25];
  v33 = [v32 objectForKeyedSubscript:v29];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v34 = v33;
  }

  else
  {
    v34 = 0;
  }

  v35 = v34;

  v36 = [v35 count];
  if (v36 < 3)
  {
    v46 = objc_autoreleasePoolPush();
    v47 = *(a1 + 32);
    v48 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
    {
      v49 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v49;
      v59 = 2112;
      v60 = v12;
      _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned incorrect data for readSupportedCleanModesValues, cannot submit clean modes in RVCUsageLogEvent. readSupportedCleanModesValues=%@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v46);
    v18 = 0;
  }

  else
  {
    v37 = [v31 objectForKeyedSubscript:v25];
    v38 = [v37 objectForKeyedSubscript:v29];
    v39 = [v38 objectAtIndexedSubscript:2];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v40 = v39;
    }

    else
    {
      v40 = 0;
    }

    v41 = v40;

    v42 = [v41 objectForKeyedSubscript:v25];

    v43 = [v42 objectForKeyedSubscript:v29];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v44 = v43;
    }

    else
    {
      v44 = 0;
    }

    v45 = v44;

    v18 = [v45 na_map:&__block_literal_global_9038];
  }

  v7 = &unk_22A586000;
LABEL_13:
  v19 = *(a1 + 32);
  v51[0] = MEMORY[0x277D85DD0];
  v51[1] = v7[441];
  v51[2] = __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_339;
  v51[3] = &unk_27866EF10;
  v20 = *(a1 + 64);
  v54 = *(a1 + 72);
  v51[4] = v19;
  v52 = v18;
  v21 = *(a1 + 48);
  v53 = *(a1 + 56);
  v22 = v18;
  [v19 readAttributeWithNodeId:v20 endpointId:v21 clusterId:&unk_283E718E8 attributeId:&unk_283E71900 params:0 completion:v51];

  v23 = *MEMORY[0x277D85DE8];
}

uint64_t __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_332(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *MEMORY[0x277CD50D8];
  v5 = [v3 objectForKeyedSubscript:*MEMORY[0x277CD50D8]];
  v6 = *MEMORY[0x277CD51A0];
  v7 = [v5 objectForKeyedSubscript:*MEMORY[0x277CD51A0]];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  v10 = [v9 count];
  if (v10 >= 2)
  {
    v12 = [v3 objectForKeyedSubscript:v4];
    v13 = [v12 objectForKeyedSubscript:v6];
    v14 = [v13 objectAtIndexedSubscript:1];
    v15 = [v14 objectForKeyedSubscript:v4];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v16 = v15;
    }

    else
    {
      v16 = 0;
    }

    v17 = v16;

    v18 = [v17 hmf_numberForKey:v6];

    v11 = [v18 isEqual:*(a1 + 32)];
  }

  else
  {
    v11 = 0;
  }

  return v11;
}

void __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_339(uint64_t a1, void *a2, void *a3)
{
  v39 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      v35 = 138543618;
      v36 = v10;
      v37 = 2112;
      v38 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned error for selected areas, cannot submit roomCount in RVCUsageLogEvent. readSelectedAreasError=%@", &v35, 0x16u);
    }

    v11 = v7;
LABEL_12:
    objc_autoreleasePoolPop(v11);
    v20 = 0;
    goto LABEL_13;
  }

  v12 = v5;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v13 = v12;
  }

  else
  {
    v13 = 0;
  }

  v14 = v13;

  v15 = [v14 hmf_isEmpty];
  if (v15)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = *(a1 + 32);
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v35 = 138543618;
      v36 = v19;
      v37 = 2112;
      v38 = v12;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Accessory returned incorrect data for readSelectedAreasValues, cannot submit roomCount in RVCUsageLogEvent. readSelectedAreasValues=%@", &v35, 0x16u);
    }

    v11 = v16;
    goto LABEL_12;
  }

  v30 = [v12 objectAtIndexedSubscript:0];
  v31 = [v30 objectForKeyedSubscript:*MEMORY[0x277CD50D8]];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v32 = v31;
  }

  else
  {
    v32 = 0;
  }

  v33 = v32;

  v34 = [v33 hmf_arrayForKey:*MEMORY[0x277CD51A0]];

  v20 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v34, "count")}];

LABEL_13:
  v21 = *(a1 + 56);
  v22 = [v20 isEqual:&unk_283E71918];
  if ([v20 isEqual:&unk_283E71918])
  {
    v23 = 0;
  }

  else
  {
    v23 = v20;
  }

  v24 = MEMORY[0x277CCABB0];
  v25 = [*(a1 + 32) rooms];
  v26 = [v24 numberWithUnsignedInteger:{objc_msgSend(v25, "count")}];
  v27 = [HMDRVCUsageLogEvent eventWithSource:v21 wholeHouse:v22 roomCount:v23 roomsInHome:v26 cleanModes:*(a1 + 40)];

  v28 = [*(a1 + 32) logEventSubmitter];
  [v28 submitLogEvent:v27 error:*(a1 + 48)];

  v29 = *MEMORY[0x277D85DE8];
}

id __73__HMDHome_CHIP__submitRvcUsageLogEventForNodeID_endpointID_source_error___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = *MEMORY[0x277CD50D8];
  v4 = [v2 objectForKeyedSubscript:*MEMORY[0x277CD50D8]];
  v5 = *MEMORY[0x277CD51A0];
  v6 = [v4 objectForKeyedSubscript:*MEMORY[0x277CD51A0]];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  v9 = [v8 count];
  v10 = 0;
  if (v9 >= 2)
  {
    v11 = [v2 objectForKeyedSubscript:v3];
    v12 = [v11 objectForKeyedSubscript:v5];
    v13 = [v12 objectAtIndexedSubscript:1];
    v14 = [v13 objectForKeyedSubscript:v3];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;

    v10 = [v16 hmf_numberForKey:v5];
  }

  return v10;
}

- (void)invokeCommandWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 commandId:(id)a6 fields:(id)a7 timedInvokeTimeout:(id)a8 source:(unint64_t)a9 completion:(id)a10
{
  v44 = *MEMORY[0x277D85DE8];
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v33 = a8;
  v19 = a10;
  v20 = [(HMDHome *)self featuresDataSource];
  v21 = [v20 isRVCEnabled];

  if (v21)
  {
    v22 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:a3];
    v23 = [(HMDHome *)self matterAccessoryWithNodeID:v22];
    v24 = [v23 matterAdapter];

    if ([v24 useMatterPlugin])
    {
      v25 = objc_autoreleasePoolPush();
      v26 = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_DEBUG))
      {
        v28 = HMFGetLogIdentifier();
        *buf = 138543362;
        v43 = v28;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEBUG, "%{public}@HMDHome+CHIP Matter API is not supported for accessories that use MatterPlugin", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
      v29 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      v19[2](v19, 0, v29);

      v30 = v18;
      v31 = v33;
      goto LABEL_12;
    }
  }

  v24 = objc_alloc_init(MEMORY[0x277CBEB38]);
  [v24 setCHIPRemoteCommand:*MEMORY[0x277D17C68]];
  [v24 setCHIPEndpointId:v15 clusterId:v16 commandId:v17];
  v30 = v18;
  if (v18)
  {
    [v24 setCHIPCommandFields:v18];
  }

  v31 = v33;
  if (v33)
  {
    [v24 setCHIPTimedInvokeTimeout:v33];
  }

  v35[0] = MEMORY[0x277D85DD0];
  v35[1] = 3221225472;
  v35[2] = __116__HMDHome_CHIP__invokeCommandWithNodeId_endpointId_clusterId_commandId_fields_timedInvokeTimeout_source_completion___block_invoke;
  v35[3] = &unk_27866EEC8;
  v35[4] = self;
  v39 = v19;
  v40 = a3;
  v36 = v15;
  v37 = v16;
  v38 = v17;
  v41 = a9;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:a3 payload:v24 completion:v35];

LABEL_12:
  v32 = *MEMORY[0x277D85DE8];
}

void __116__HMDHome_CHIP__invokeCommandWithNodeId_endpointId_clusterId_commandId_fields_timedInvokeTimeout_source_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Invoke command response: %@, error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 64);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  [*(a1 + 32) submitLogEventForCommandResponse:v5 nodeID:*(a1 + 72) endpointID:*(a1 + 40) clusterID:*(a1 + 48) commandID:*(a1 + 56) source:*(a1 + 80) error:v6];
  v13 = *MEMORY[0x277D85DE8];
}

- (void)writeAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 value:(id)a7 timedWriteTimeout:(id)a8 completion:(id)a9
{
  v43 = *MEMORY[0x277D85DE8];
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  v20 = a9;
  v21 = [(HMDHome *)self featuresDataSource];
  v22 = [v21 isRVCEnabled];

  if (v22)
  {
    v32 = v20;
    v23 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:a3];
    v24 = [(HMDHome *)self matterAccessoryWithNodeID:v23];
    v25 = [v24 matterAdapter];

    if ([v25 useMatterPlugin])
    {
      v26 = objc_autoreleasePoolPush();
      v27 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_DEBUG))
      {
        v29 = HMFGetLogIdentifier();
        *buf = 138543362;
        v42 = v29;
        _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_DEBUG, "%{public}@HMDHome+CHIP Matter API is not supported for accessories that use MatterPlugin", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v26);
      v30 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      v32[2](v32, 0, v30);

      v20 = v32;
      goto LABEL_10;
    }

    v20 = v32;
  }

  v25 = objc_alloc_init(MEMORY[0x277CBEB38]);
  [v25 setCHIPRemoteCommand:*MEMORY[0x277D17C90]];
  [v25 setCHIPEndpointId:v15 clusterId:v16 attributeId:v17];
  [v25 setCHIPData:v18];
  if (v19)
  {
    [v25 setCHIPTimedWriteTimeout:v19];
  }

  v33[0] = MEMORY[0x277D85DD0];
  v33[1] = 3221225472;
  v33[2] = __110__HMDHome_CHIP__writeAttributeWithNodeId_endpointId_clusterId_attributeId_value_timedWriteTimeout_completion___block_invoke;
  v33[3] = &unk_27866EEA0;
  v33[4] = self;
  v39 = v20;
  v40 = a3;
  v34 = v15;
  v35 = v16;
  v36 = v17;
  v37 = v18;
  v38 = v19;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:a3 payload:v25 completion:v33];

LABEL_10:
  v31 = *MEMORY[0x277D85DE8];
}

void __110__HMDHome_CHIP__writeAttributeWithNodeId_endpointId_clusterId_attributeId_value_timedWriteTimeout_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Write attribute response: %@, error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 80);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  [*(a1 + 32) submitLogEventForWriteAttributeWithNodeId:*(a1 + 88) endpointId:*(a1 + 40) clusterId:*(a1 + 48) attributeId:*(a1 + 56) value:*(a1 + 64) timedWriteTimeout:*(a1 + 72) error:v6];
  v13 = *MEMORY[0x277D85DE8];
}

- (void)readAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 params:(id)a7 completion:(id)a8
{
  v34 = *MEMORY[0x277D85DE8];
  v14 = a4;
  v15 = a5;
  v16 = a6;
  v17 = a7;
  v18 = a8;
  v19 = [(HMDHome *)self featuresDataSource];
  v20 = [v19 isRVCEnabled];

  if (!v20)
  {
    goto LABEL_7;
  }

  v21 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:a3];
  v22 = [(HMDHome *)self matterAccessoryWithNodeID:v21];
  v23 = [v22 matterAdapter];

  if (![v23 useMatterPlugin])
  {

LABEL_7:
    v23 = objc_alloc_init(MEMORY[0x277CBEB38]);
    [v23 setCHIPRemoteCommand:*MEMORY[0x277D17C80]];
    [v23 setCHIPEndpointId:v14 clusterId:v15 attributeId:v16];
    [v23 setCHIPEncodedParams:v17];
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __92__HMDHome_CHIP__readAttributeWithNodeId_endpointId_clusterId_attributeId_params_completion___block_invoke;
    v30[3] = &unk_27867D090;
    v30[4] = self;
    v31 = v18;
    [(HMDHome *)self _sendRemoteMessageUsingNodeId:a3 payload:v23 completion:v30];

    goto LABEL_8;
  }

  v24 = objc_autoreleasePoolPush();
  v25 = self;
  v26 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
  {
    v27 = HMFGetLogIdentifier();
    *buf = 138543362;
    v33 = v27;
    _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_DEBUG, "%{public}@HMDHome+CHIP Matter API is not supported for accessories that use MatterPlugin", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v24);
  v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
  (*(v18 + 2))(v18, 0, v28);

LABEL_8:
  v29 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome_CHIP__readAttributeWithNodeId_endpointId_clusterId_attributeId_params_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    v14 = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Read attribute response: %@, error: %@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 40);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  v13 = *MEMORY[0x277D85DE8];
}

- (id)matterAccessoryWithNodeID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self matterAccessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __43__HMDHome_CHIP__matterAccessoryWithNodeID___block_invoke;
  v9[3] = &unk_278681CA8;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __43__HMDHome_CHIP__matterAccessoryWithNodeID___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 matterNodeID];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (void)remotelyUpdateHomeModelWithCHIPKeyValueStore:(id)a3 removedKeys:(id)a4 completion:(id)a5
{
  v56[1] = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self home];
  if (v11)
  {
    v12 = MEMORY[0x277CBEB38];
    v55 = @"HMDHomeRemoteUpdateCHIPKeyValueStoreMessageKey";
    v56[0] = v8;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v56 forKeys:&v55 count:1];
    v14 = [v12 dictionaryWithDictionary:v13];

    v46 = v9;
    [v14 setObject:v9 forKeyedSubscript:@"HMDHomeRemoteUpdateCHIPRemovedKeysMessageKey"];
    v15 = objc_alloc(MEMORY[0x277D0F848]);
    v16 = objc_alloc(MEMORY[0x277D0F820]);
    v17 = [v11 messageTargetUUID];
    v18 = [v16 initWithTarget:v17];
    v19 = [v15 initWithName:@"HMDHomeRemoteUpdateCHIPKeyValueStoreMessage" destination:v18 payload:v14];

    v20 = [v19 identifier];
    v48[0] = MEMORY[0x277D85DD0];
    v48[1] = 3221225472;
    v48[2] = __85__HMDHome_CHIP__remotelyUpdateHomeModelWithCHIPKeyValueStore_removedKeys_completion___block_invoke;
    v48[3] = &unk_2786862C0;
    v48[4] = self;
    v44 = v20;
    v45 = v10;
    v49 = v44;
    v21 = v10;
    v50 = v21;
    [v19 setResponseHandler:v48];
    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      [v19 shortDescription];
      v27 = v26 = v8;
      *buf = 138543618;
      v52 = v25;
      v53 = 2112;
      v54 = v27;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Remotely updating home model with CHIP key value store using message: %@", buf, 0x16u);

      v8 = v26;
    }

    objc_autoreleasePoolPop(v22);
    v28 = [(HMDHome *)v23 administratorHandler];
    v47 = 0;
    v29 = [v28 operationForMessage:v19 error:&v47];
    v30 = v47;

    if (v29)
    {
      v31 = [(HMDHome *)v23 administratorHandler];
      [v31 addOperation:v29];
      v9 = v46;
    }

    else
    {
      v36 = objc_autoreleasePoolPush();
      v37 = v23;
      v38 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v43 = v36;
        v40 = v39 = v8;
        *buf = 138543618;
        v52 = v40;
        v53 = 2112;
        v54 = v30;
        _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_ERROR, "%{public}@Failed to create home administration configuration operation for remotely updating home model with key value store: %@", buf, 0x16u);

        v8 = v39;
        v36 = v43;
      }

      objc_autoreleasePoolPop(v36);
      v41 = _Block_copy(v21);
      v31 = v41;
      v9 = v46;
      if (v41)
      {
        (*(v41 + 2))(v41, v30);
      }
    }

    v10 = v45;

    goto LABEL_15;
  }

  v32 = objc_autoreleasePoolPush();
  v33 = self;
  v34 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
  {
    v35 = HMFGetLogIdentifier();
    *buf = 138543362;
    v52 = v35;
    _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Home reference is nil", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v32);
  v14 = _Block_copy(v10);
  if (v14)
  {
    v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (v14)[2](v14, v19);
LABEL_15:
  }

  v42 = *MEMORY[0x277D85DE8];
}

void __85__HMDHome_CHIP__remotelyUpdateHomeModelWithCHIPKeyValueStore_removedKeys_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v5)
  {
    if (!os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 40);
    v21 = 138543874;
    v22 = v11;
    v23 = 2112;
    v24 = v12;
    v25 = 2112;
    v26 = v5;
    v13 = "%{public}@Failed to remotely update CHIP key value store for message %@: %@";
    v14 = v10;
    v15 = OS_LOG_TYPE_ERROR;
    v16 = 32;
  }

  else
  {
    if (!os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      goto LABEL_7;
    }

    v11 = HMFGetLogIdentifier();
    v17 = *(a1 + 40);
    v21 = 138543618;
    v22 = v11;
    v23 = 2112;
    v24 = v17;
    v13 = "%{public}@Successfully remotely updated CHIP key value store for message %@";
    v14 = v10;
    v15 = OS_LOG_TYPE_INFO;
    v16 = 22;
  }

  _os_log_impl(&dword_229538000, v14, v15, v13, &v21, v16);

LABEL_7:
  objc_autoreleasePoolPop(v7);
  v18 = _Block_copy(*(a1 + 48));
  v19 = v18;
  if (v18)
  {
    (*(v18 + 2))(v18, v5);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (BOOL)updateCHIPPropertiesOnHomeModel:(id)a3 usingUpdatedHomeInfo:(id)a4
{
  v6 = a3;
  v7 = [a4 objectForKeyedSubscript:@"HMDHomeModelUpdatedCHIPPropertiesMessageKeyFabricID"];
  if (v7 && (-[HMDHome chipStorage](self, "chipStorage"), v8 = objc_claimAutoreleasedReturnValue(), [v8 fabricID], v9 = objc_claimAutoreleasedReturnValue(), v10 = HMFEqualObjects(), v9, v8, (v10 & 1) == 0))
  {
    [v6 setChipFabricID:v7];
    [v6 setChipFabricIndex:v7];
    v11 = 1;
  }

  else
  {
    v11 = 0;
  }

  return v11;
}

+ (void)updateCHIPPropertiesOnAccessoryModel:(id)a3 forAddedHAPAccessoryServer:(id)a4
{
  v10 = a3;
  v5 = a4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;
  v8 = v7;
  if (v7)
  {
    v9 = [v7 nodeID];
    [v10 setChipNodeID:v9];
  }
}

+ (BOOL)updateCHIPPropertiesOnHomeModel:(id)a3 forAddedHAPAccessoryServer:(id)a4
{
  v5 = a3;
  v6 = a4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;
  v9 = [v8 fabricID];

  if (v9)
  {
    v10 = [v8 fabricID];
    [v5 setChipFabricID:v10];

    v11 = [v8 fabricID];
    [v5 setChipFabricIndex:v11];
  }

  return v9 != 0;
}

+ (void)updateCHIPPropertiesOnMKFAccessoryModel:(id)a3 forAddedHAPAccessoryServer:(id)a4
{
  v18 = a3;
  v5 = a4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;
  v8 = v7;
  if (v7)
  {
    v9 = [v7 nodeID];
    [v18 setMatterNodeID:v9];

    v10 = [v8 vendorID];

    if (v10)
    {
      v11 = [v8 vendorID];
      [v18 setMatterVendorID:v11];
    }

    v12 = [v8 productID];

    if (v12)
    {
      v13 = [v8 productID];
      [v18 setMatterProductID:v13];
    }

    v14 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v8, "isWEDDevice")}];
    [v18 setMatterWEDSupport:v14];

    v15 = [v8 eMACAddress];
    [v18 setMatterExtendedMACAddress:v15];

    v16 = [v8 softwareVersionNumber];
    [v18 setMatterSoftwareVersionNumber:v16];

    v17 = [v8 supportedLinkLayerTypes];
    [v18 setSupportedLinkLayerTypes:v17];
  }
}

+ (id)updatedHomeModelCHIPPropertiesForAddedHAPAccessoryServer:(id)a3
{
  v12[2] = *MEMORY[0x277D85DE8];
  v3 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 fabricID];

  if (v6)
  {
    v11[0] = @"HMDHomeModelUpdatedCHIPPropertiesMessageKeyFabricID";
    v7 = [v5 fabricID];
    v11[1] = @"HMDHomeModelUpdatedCHIPPropertiesMessageKeyFabricIndex";
    v12[0] = v7;
    v8 = [v5 fabricID];
    v12[1] = v8;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:v11 count:2];
  }

  v9 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)setAllowedToEnableAdaptiveTemperatureAutomations:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_allowedToEnableAdaptiveTemperatureAutomations = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isAllowedToEnableAdaptiveTemperatureAutomations
{
  os_unfair_recursive_lock_lock_with_options();
  allowedToEnableAdaptiveTemperatureAutomations = self->_allowedToEnableAdaptiveTemperatureAutomations;
  os_unfair_recursive_lock_unlock();
  return allowedToEnableAdaptiveTemperatureAutomations;
}

- (void)setUserActivityStateDetectorManager:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  userActivityStateDetectorManager = self->_userActivityStateDetectorManager;
  self->_userActivityStateDetectorManager = v4;

  os_unfair_recursive_lock_unlock();
}

- (HMDUserActivityStateDetectorManager)userActivityStateDetectorManager
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_userActivityStateDetectorManager;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (MTRDeviceController)matterDeviceController
{
  os_unfair_recursive_lock_lock_with_options();
  if (!self->_matterDeviceController)
  {
    v3 = [(HMDHome *)self featuresDataSource];
    v4 = [v3 isRVCEnabled];

    if (v4)
    {
      v5 = objc_opt_class();
      v6 = [(HMDHome *)self uuid];
      v7 = [v5 matterDeviceControllerWithUUID:v6];
      matterDeviceController = self->_matterDeviceController;
      self->_matterDeviceController = v7;
    }
  }

  v9 = self->_matterDeviceController;
  os_unfair_recursive_lock_unlock();

  return v9;
}

- (void)removeSharedUserResponseEventBuilder:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v5 = v4;
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableSet *)self->_sharedUserResponseEventBuilders removeObject:v5];
    os_unfair_recursive_lock_unlock();
    v4 = v5;
  }
}

- (void)addSharedUserResponseEventBuilder:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v8 = v4;
    os_unfair_recursive_lock_lock_with_options();
    sharedUserResponseEventBuilders = self->_sharedUserResponseEventBuilders;
    if (!sharedUserResponseEventBuilders)
    {
      v6 = [MEMORY[0x277CBEB58] set];
      v7 = self->_sharedUserResponseEventBuilders;
      self->_sharedUserResponseEventBuilders = v6;

      sharedUserResponseEventBuilders = self->_sharedUserResponseEventBuilders;
    }

    [(NSMutableSet *)sharedUserResponseEventBuilders addObject:v8];
    os_unfair_recursive_lock_unlock();
    v4 = v8;
  }
}

- (void)removeSharedUserEventBuilder:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v5 = v4;
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableSet *)self->_sharedUserInviteEventBuilders removeObject:v5];
    os_unfair_recursive_lock_unlock();
    v4 = v5;
  }
}

- (void)addSharedUserEventBuilder:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v8 = v4;
    os_unfair_recursive_lock_lock_with_options();
    sharedUserInviteEventBuilders = self->_sharedUserInviteEventBuilders;
    if (!sharedUserInviteEventBuilders)
    {
      v6 = [MEMORY[0x277CBEB58] set];
      v7 = self->_sharedUserInviteEventBuilders;
      self->_sharedUserInviteEventBuilders = v6;

      sharedUserInviteEventBuilders = self->_sharedUserInviteEventBuilders;
    }

    [(NSMutableSet *)sharedUserInviteEventBuilders addObject:v8];
    os_unfair_recursive_lock_unlock();
    v4 = v8;
  }
}

- (BOOL)shouldPostBulletin
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self currentUser];
  v4 = [v3 isAccessCurrentlyAllowedBySchedule];
  if ([v3 isRestrictedGuest] && ((-[HMDHome homeLocation](self, "homeLocation") == 1) & v4) == 0)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      [(HMDHome *)v7 homeLocation];
      v10 = HMStringFromHomeLocation();
      v11 = HMFBooleanToString();
      v14 = 138543874;
      v15 = v9;
      v16 = 2112;
      v17 = v10;
      v18 = 2112;
      v19 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Will not post the bulletin as RG is either away from the home or not within schedule. HomeLocation: %@, allowedBySchedule: %@", &v14, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    v5 = 0;
  }

  else
  {
    v5 = 1;
  }

  v12 = *MEMORY[0x277D85DE8];
  return v5;
}

- (void)_handleFetchTriggerNameRequest:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:@"triggerUUID"];
  if (v5)
  {
    v6 = [(HMDHome *)self triggers];
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __42__HMDHome__handleFetchTriggerNameRequest___block_invoke;
    v21[3] = &unk_27867AED8;
    v22 = v5;
    v7 = [v6 na_firstObjectPassingTest:v21];

    v8 = [v7 configuredName];
    if (v8 || ([v7 name], (v8 = objc_claimAutoreleasedReturnValue()) != 0))
    {
      v9 = v8;
      v23 = *MEMORY[0x277CD2758];
      v24 = v8;
      v10 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v24 forKeys:&v23 count:1];
      [v4 respondWithPayload:v10];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = self;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        *buf = 138543362;
        v26 = v20;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@trigger name is nil.", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v4 respondWithError:v9];
    }

    v11 = v22;
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@message does not contain the trigger SPI identifier", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v11];
  }

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __42__HMDHome__handleFetchTriggerNameRequest___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 spiClientIdentifier];
  v4 = *(a1 + 32);
  v5 = HMFEqualObjects();

  return v5;
}

- (NSArray)autoSelectedPreferredResidents
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 autoSelectedPreferredResidents];

  return v3;
}

- (HMDResidentDevice)userSelectedPreferredResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 userSelectedPreferredResident];

  return v3;
}

- (BOOL)supportsResidentSelection
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 homeSupportsResidentSelection];

  return v3;
}

- (BOOL)receivedRemoteMessageOverTransportType:(int)a3 remoteMessageSenderContext:(id)a4
{
  v5 = a4;
  v6 = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident];
  if (v6)
  {
    v7 = [v5 pairingIdentityIdentifier];
    v8 = [(HMDHome *)self userWithPairingIdentityIdentifier:v7];

    if (v8 && ([v8 isRemoteAccessAllowed] & 1) == 0)
    {
      v9 = [(HMDHome *)self presenceMonitor];
      v10 = [MEMORY[0x277CBEAA8] now];
      v11 = [v8 uuid];
      [v9 updateLastLocalActivityTimestamp:v10 forUserUUID:v11];
    }
  }

  return v6;
}

- (BOOL)areCharacteristicRequests:(id)a3 allowedForUser:(id)a4
{
  v5 = a3;
  v6 = a4;
  if ([v6 isRestrictedGuest])
  {
    v7 = [v6 restrictedGuestAccessSettings];
    v8 = [v7 uuidsOfAllowedAccessories];

    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __52__HMDHome_areCharacteristicRequests_allowedForUser___block_invoke;
    v12[3] = &unk_278689280;
    v9 = v8;
    v13 = v9;
    if ([v5 na_all:v12])
    {
      v10 = [v6 isAccessCurrentlyAllowedBySchedule];
    }

    else
    {
      v10 = 0;
    }
  }

  else
  {
    v10 = 1;
  }

  return v10;
}

uint64_t __52__HMDHome_areCharacteristicRequests_allowedForUser___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 accessory];
  v4 = [v3 uuid];
  v5 = [v2 containsObject:v4];

  return v5;
}

- (void)_loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance:(id)a3
{
  v48 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self userWithUUID:v4];
  if ([v5 isRestrictedGuest])
  {
    v6 = [v5 restrictedGuestAccessSettings];
    v7 = [v6 uuidsOfAllowedAccessories];

    if (v7)
    {
      if (([v7 hmf_isEmpty] & 1) == 0)
      {
        v8 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
        v9 = objc_autoreleasePoolPush();
        v10 = self;
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          v12 = HMFGetLogIdentifier();
          v13 = [v8 UUID];
          v14 = [v5 uuid];
          *buf = 138544130;
          v41 = v12;
          v42 = 2112;
          v43 = v13;
          v44 = 2112;
          v45 = v14;
          v46 = 2112;
          v47 = v7;
          _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Restricted Guest}] Kicking off operations for restricted guest: %@ on invitation acceptance with allowed accessories: %@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v9);
        v15 = objc_alloc(MEMORY[0x277D0F7A8]);
        v16 = [(HMDHome *)v10 workQueue];
        v17 = [v15 initWithQueue:v16];

        v18 = MEMORY[0x277D0F7C0];
        v36[0] = MEMORY[0x277D85DD0];
        v36[1] = 3221225472;
        v36[2] = __73__HMDHome__loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance___block_invoke;
        v36[3] = &unk_278686828;
        v19 = v5;
        v37 = v19;
        v38 = v7;
        v20 = v8;
        v39 = v20;
        v21 = [v18 inContext:v17 perform:v36];
        v33[0] = MEMORY[0x277D85DD0];
        v33[1] = 3221225472;
        v33[2] = __73__HMDHome__loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance___block_invoke_2;
        v33[3] = &unk_27867CF60;
        v33[4] = v10;
        v34 = v20;
        v35 = v19;
        v22 = v20;
        v23 = [v21 then:v33];
      }
    }

    else
    {
      v28 = objc_autoreleasePoolPush();
      v29 = self;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
      {
        v31 = HMFGetLogIdentifier();
        *buf = 138543618;
        v41 = v31;
        v42 = 2112;
        v43 = v4;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, "%{public}@Allowed Accessories not set for guest: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v28);
    }
  }

  else
  {
    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      *buf = 138543618;
      v41 = v27;
      v42 = 2112;
      v43 = v4;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@User %@ is not a restricted guest, not configuring credentials on locks here", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
  }

  v32 = *MEMORY[0x277D85DE8];
}

uint64_t __73__HMDHome__loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance___block_invoke(void *a1)
{
  v1 = [HMDBackgroundOperationManagerHelper auditAllowedAccessToRestrictedGuest:a1[4] forAccessories:a1[5] shouldRemoveScheduledOperations:0 parentFlow:a1[6]];
  if (v1)
  {
    v2 = v1;

    return 3;
  }

  else
  {
    v4 = _HMFPreconditionFailure();
    return __73__HMDHome__loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance___block_invoke_2(v4);
  }
}

uint64_t __73__HMDHome__loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance___block_invoke_2(id *a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 count];
  v5 = objc_autoreleasePoolPush();
  v6 = a1[4];
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [a1[5] UUID];
      v11 = [a1[6] uuid];
      v18 = 138544130;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v11;
      v24 = 2112;
      v25 = v3;
      v12 = "%{public}@[Flow: %@] Some error occurred when adding pairings, pin codes & Home keys for the restricted guest %@ with error dictionary: %@";
      v13 = v8;
      v14 = OS_LOG_TYPE_ERROR;
      v15 = 42;
LABEL_6:
      _os_log_impl(&dword_229538000, v13, v14, v12, &v18, v15);
    }
  }

  else if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [a1[5] UUID];
    v11 = [a1[6] uuid];
    v18 = 138543874;
    v19 = v9;
    v20 = 2112;
    v21 = v10;
    v22 = 2112;
    v23 = v11;
    v12 = "%{public}@[Flow: %@] Successfully added pairings, pin codes & Home keys for the restricted guest %@";
    v13 = v8;
    v14 = OS_LOG_TYPE_INFO;
    v15 = 32;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v5);
  v16 = *MEMORY[0x277D85DE8];
  return 1;
}

- (void)_saveRestrictedGuestSettingsFromOutgoingInvitation:(id)a3 managedObjectContext:(id)a4 error:(id *)a5
{
  v45 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = [v8 user];
  v11 = [v10 isRestrictedGuest];

  if (v11)
  {
    v12 = [v9 deletedObjects];
    v13 = [v12 na_firstObjectPassingTest:&__block_literal_global_2635];

    if (v13)
    {
      v14 = [v8 user];
      v15 = [v14 uuid];
      v16 = [HMCContext findGuestWithModelID:v15];

      if (v16)
      {
        *v43 = 0;
        *&v43[8] = v43;
        *&v43[16] = 0x2020000000;
        v44 = 1;
        v17 = [v9 deletedObjects];
        v35[0] = MEMORY[0x277D85DD0];
        v35[1] = 3221225472;
        v35[2] = __89__HMDHome__saveRestrictedGuestSettingsFromOutgoingInvitation_managedObjectContext_error___block_invoke_2741;
        v35[3] = &unk_278678F88;
        v36 = v16;
        v37 = self;
        v38 = v43;
        [v17 hmf_enumerateWithAutoreleasePoolUsingBlock:v35];

        if (a5)
        {
          *a5 = 0;
          if ((*(*&v43[8] + 24) & 1) == 0)
          {
            *a5 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2905];
          }
        }

        v18 = objc_autoreleasePoolPush();
        v19 = self;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
        {
          v21 = HMFGetLogIdentifier();
          v22 = *a5;
          *buf = 138543618;
          v40 = v21;
          v41 = 2112;
          v42 = v22;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Finishing outgoing invitation acceptance with error: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
        _Block_object_dispose(v43, 8);
      }

      else
      {
        context = objc_autoreleasePoolPush();
        v28 = self;
        v29 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
        {
          v30 = HMFGetLogIdentifier();
          v31 = [v8 user];
          v32 = [v31 uuid];
          *v43 = 138543618;
          *&v43[4] = v30;
          *&v43[12] = 2112;
          *&v43[14] = v32;
          _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the newly created guest model after accepting the invitation in database: %@", v43, 0x16u);
        }

        objc_autoreleasePoolPop(context);
        if (a5)
        {
          *a5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        }
      }
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      v24 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        v26 = HMFGetLogIdentifier();
        v27 = [v8 uuid];
        *v43 = 138543618;
        *&v43[4] = v26;
        *&v43[12] = 2112;
        *&v43[14] = v27;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the outgoing invitation with UUID in database: %@", v43, 0x16u);
      }

      objc_autoreleasePoolPop(v23);
      if (a5)
      {
        *a5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      }
    }
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __89__HMDHome__saveRestrictedGuestSettingsFromOutgoingInvitation_managedObjectContext_error___block_invoke_2741(uint64_t a1, void *a2, _BYTE *a3)
{
  v45 = *MEMORY[0x277D85DE8];
  v5 = a2;
  if ([v5 conformsToProtocol:&unk_283FBE1E0])
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v40 = 0;
    v8 = *(a1 + 32);
    v9 = [MEMORY[0x277CCAD78] UUID];
    v10 = [v8 materializeOrCreateWeekDayScheduleRulesRelationWithModelID:v9 createdNew:&v40];

    if (v40)
    {
      v11 = [v7 startTime];
      [v10 setStartTime:v11];

      v12 = [v7 endTime];
      [v10 setEndTime:v12];

      v13 = [v7 daysOfTheWeek];
      [v10 setDaysOfTheWeek:v13];

      v14 = objc_autoreleasePoolPush();
      v15 = *(a1 + 40);
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        v17 = HMFGetLogIdentifier();
        v18 = [v10 debugDescription];
        *buf = 138543618;
        v42 = v17;
        v43 = 2112;
        v44 = v18;
        _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Created new week day rule: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      v32 = *(a1 + 40);
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
      {
        v34 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v34;
        v43 = 2112;
        v44 = v7;
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Unable to create week day schedule from : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v31);
      *a3 = 1;
      *(*(*(a1 + 48) + 8) + 24) = 0;
    }
  }

  else
  {
    v19 = v5;
    if ([v19 conformsToProtocol:&unk_283F73708])
    {
      v20 = v19;
    }

    else
    {
      v20 = 0;
    }

    v10 = v20;

    if (v10)
    {
      v40 = 0;
      v21 = *(a1 + 32);
      v22 = [MEMORY[0x277CCAD78] UUID];
      v23 = [v21 materializeOrCreateYearDayScheduleRulesRelationWithModelID:v22 createdNew:&v40];

      if (v40)
      {
        v24 = [v10 startDate];
        [v23 setStartDate:v24];

        v25 = [v10 endDate];
        [v23 setEndDate:v25];

        v26 = objc_autoreleasePoolPush();
        v27 = *(a1 + 40);
        v28 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
        {
          v29 = HMFGetLogIdentifier();
          v30 = [v23 debugDescription];
          *buf = 138543618;
          v42 = v29;
          v43 = 2112;
          v44 = v30;
          _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@Created new year day rule: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v26);
      }

      else
      {
        v35 = objc_autoreleasePoolPush();
        v36 = *(a1 + 40);
        v37 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
        {
          v38 = HMFGetLogIdentifier();
          *buf = 138543618;
          v42 = v38;
          v43 = 2112;
          v44 = v10;
          _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@Unable to create year day schedule from : %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v35);
        *a3 = 1;
        *(*(*(a1 + 48) + 8) + 24) = 0;
      }
    }
  }

  v39 = *MEMORY[0x277D85DE8];
}

uint64_t __89__HMDHome__saveRestrictedGuestSettingsFromOutgoingInvitation_managedObjectContext_error___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 conformsToProtocol:&unk_283F5D530];
  if (v2)
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)_saveOutgoingInvitationsWithRestrictedGuestSettings:(id)a3 inTransaction:(id)a4 message:(id)a5 transactionCompleted:(id)a6
{
  v10 = a3;
  v11 = a5;
  v12 = a6;
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __106__HMDHome__saveOutgoingInvitationsWithRestrictedGuestSettings_inTransaction_message_transactionCompleted___block_invoke;
  v19[3] = &unk_278670420;
  v19[4] = self;
  v20 = v10;
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __106__HMDHome__saveOutgoingInvitationsWithRestrictedGuestSettings_inTransaction_message_transactionCompleted___block_invoke_2632;
  v16[3] = &unk_278689358;
  v17 = v11;
  v18 = v12;
  v16[4] = self;
  v13 = v11;
  v14 = v12;
  v15 = v10;
  [a4 runWithCoreDataBlock:v19 withCompletionBlock:v16];
}

void __106__HMDHome__saveOutgoingInvitationsWithRestrictedGuestSettings_inTransaction_message_transactionCompleted___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v48 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = objc_autoreleasePoolPush();
  v37 = a1;
  v10 = *(a1 + 32);
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    *buf = 138543618;
    v45 = v12;
    v46 = 2112;
    v47 = v8;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Going to save RG settings with previous error: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  if (!v8)
  {
    v34 = 0;
    v35 = v7;
    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    obj = *(a1 + 40);
    v13 = [obj countByEnumeratingWithState:&v39 objects:v43 count:16];
    if (v13)
    {
      v14 = v13;
      v15 = *v40;
      p_info = HMDAggregationAnalysisLogEvent.info;
      while (2)
      {
        v17 = 0;
        v36 = v14;
        do
        {
          if (*v40 != v15)
          {
            objc_enumerationMutation(obj);
          }

          v18 = *(*(&v39 + 1) + 8 * v17);
          v19 = [v18 identifier];
          v20 = [p_info + 101 findOutgoingInvitationWithModelID:v19];

          if (v20)
          {
            v21 = [v18 user];
            v22 = [v21 restrictedGuestAccessSettings];
            v23 = [v22 schedule];
            v24 = [v20 populateWorkingStoreFromRestrictedGuestSchedule:v23];

            if ((v24 & 1) == 0)
            {
              if (a4)
              {
                *a4 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2905];
              }

              goto LABEL_22;
            }
          }

          else
          {
            v25 = v15;
            v26 = p_info;
            v27 = a4;
            v28 = objc_autoreleasePoolPush();
            v29 = *(v37 + 32);
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
            {
              v31 = HMFGetLogIdentifier();
              v32 = [v18 uuid];
              *buf = 138543618;
              v45 = v31;
              v46 = 2112;
              v47 = v32;
              _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the outgoing invitation with UUID in database: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v28);
            a4 = v27;
            p_info = v26;
            v15 = v25;
            v14 = v36;
            if (a4)
            {
              *a4 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
            }
          }

          ++v17;
        }

        while (v14 != v17);
        v14 = [obj countByEnumeratingWithState:&v39 objects:v43 count:16];
        if (v14)
        {
          continue;
        }

        break;
      }
    }

LABEL_22:

    v8 = v34;
    v7 = v35;
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __106__HMDHome__saveOutgoingInvitationsWithRestrictedGuestSettings_inTransaction_message_transactionCompleted___block_invoke_2632(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v11 = 138543618;
    v12 = v7;
    v13 = 2112;
    v14 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@RG settings transaction finished with error: %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = _Block_copy(*(a1 + 48));
  v9 = v8;
  if (v8)
  {
    (*(v8 + 2))(v8);
  }

  [*(a1 + 40) respondWithPayload:0 error:v3];
  v10 = *MEMORY[0x277D85DE8];
}

- (void)__handleUpdateRestrictedGuestSettings:(id)a3
{
  v66 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 flow];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [v5 UUID];
    *buf = 138543874;
    v61 = v9;
    v62 = 2112;
    v63 = v10;
    v64 = 2112;
    v65 = v4;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Handling update restricted guest settings message: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = [v4 stringForKey:@"kUserIDKey"];
  v12 = [(HMDHome *)v7 users];
  v13 = [v12 hmf_firstObjectWithValue:v11 forKeyPath:@"userID"];

  if (v13)
  {
    if ([v13 isRestrictedGuest])
    {
      v14 = *MEMORY[0x277CD0D10];
      v59 = objc_opt_class();
      v15 = [MEMORY[0x277CBEA60] arrayWithObjects:&v59 count:1];
      v16 = [v4 unarchivedObjectForKey:v14 ofClasses:v15];

      if (!v16)
      {
        v37 = objc_autoreleasePoolPush();
        v38 = v7;
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_ERROR))
        {
          v40 = HMFGetLogIdentifier();
          v41 = [v5 UUID];
          *buf = 138543618;
          v61 = v40;
          v62 = 2112;
          v63 = v41;
          _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to decode restricted guest settings", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v37);
        v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        [v4 respondWithError:v17];
        goto LABEL_27;
      }

      v17 = [[HMDRestrictedGuestHomeAccessSettings alloc] initWithRestrictedGuestHomeAccessSettings:v16];
      if (v17)
      {
        v18 = [v13 restrictedGuestAccessSettings];
        v19 = HMFEqualObjects();

        if (!v19)
        {
          v48 = [(HMDHome *)v7 backingStore];
          v49 = [v48 context];
          v53[0] = MEMORY[0x277D85DD0];
          v53[1] = 3221225472;
          v53[2] = __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke;
          v53[3] = &unk_278689550;
          v54 = v13;
          v55 = v7;
          v56 = v5;
          v57 = v4;
          v58 = v17;
          [v49 performBlock:v53];

          v47 = v54;
          goto LABEL_26;
        }

        v20 = objc_autoreleasePoolPush();
        v21 = v7;
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
        {
          v23 = HMFGetLogIdentifier();
          [v5 UUID];
          v24 = v51 = v20;
          *buf = 138543618;
          v61 = v23;
          v62 = 2112;
          v63 = v24;
          _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Current restricted guest settings are the same as the new settings. Nothing to done here", buf, 0x16u);

          v20 = v51;
        }

        objc_autoreleasePoolPop(v20);
        v25 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2904];
      }

      else
      {
        v42 = objc_autoreleasePoolPush();
        v43 = v7;
        v44 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
        {
          v45 = HMFGetLogIdentifier();
          [v5 UUID];
          v46 = v52 = v42;
          *buf = 138543618;
          v61 = v45;
          v62 = 2112;
          v63 = v46;
          _os_log_impl(&dword_229538000, v44, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to initialize restricted guest settings", buf, 0x16u);

          v42 = v52;
        }

        objc_autoreleasePoolPop(v42);
        v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      }

      v47 = v25;
      [v4 respondWithError:v25];
LABEL_26:

LABEL_27:
      goto LABEL_28;
    }

    v32 = objc_autoreleasePoolPush();
    v33 = v7;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      v36 = [v5 UUID];
      *buf = 138543874;
      v61 = v35;
      v62 = 2112;
      v63 = v36;
      v64 = 2112;
      v65 = v13;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Cannot update restricted guest settings for user with UUID %@ as the user is not RG", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v32);
    v31 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2901];
  }

  else
  {
    v26 = objc_autoreleasePoolPush();
    v27 = v7;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      v29 = HMFGetLogIdentifier();
      v30 = [v5 UUID];
      *buf = 138543874;
      v61 = v29;
      v62 = 2112;
      v63 = v30;
      v64 = 2112;
      v65 = v11;
      _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find user with userID %@ in the home", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v26);
    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
  }

  v16 = v31;
  [v4 respondWithError:v31];
LABEL_28:

  v50 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke(id *a1)
{
  v109 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] uuid];
  v3 = [HMCContext findGuestWithModelID:v2];

  if (v3)
  {
    v4 = MEMORY[0x277CBEB98];
    v5 = [v3 allowedAccessories];
    v6 = [v4 setWithArray:v5];

    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v106 = __Block_byref_object_copy__14759;
    v107 = __Block_byref_object_dispose__14760;
    v7 = MEMORY[0x277CBEB58];
    v8 = [a1[8] uuidsOfAllowedAccessories];
    v108 = [v7 setWithCapacity:{objc_msgSend(v8, "count")}];

    v90 = 0;
    v91 = &v90;
    v92 = 0x3032000000;
    v93 = __Block_byref_object_copy__14759;
    v94 = __Block_byref_object_dispose__14760;
    v95 = 0;
    v9 = [a1[8] uuidsOfAllowedAccessories];
    v85[0] = MEMORY[0x277D85DD0];
    v85[1] = 3221225472;
    v85[2] = __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke_2617;
    v85[3] = &unk_2786709C0;
    v10 = a1[6];
    v85[4] = a1[5];
    v86 = v10;
    v88 = &v90;
    v89 = buf;
    v11 = v3;
    v87 = v11;
    [v9 hmf_enumerateWithAutoreleasePoolUsingBlock:v85];

    if (v91[5])
    {
      [a1[7] respondWithError:?];
    }

    else
    {
      v19 = [a1[8] uuidsOfAllowedAccessories];
      v20 = [v19 count] == 0;

      if (v20)
      {
        [v11 dematerializeAllowedAccessoriesRelationship];
      }

      v21 = [a1[8] schedule];
      v22 = [v11 populateWorkingStoreFromRestrictedGuestSchedule:v21];

      if (v22)
      {
        v23 = [v6 mutableCopy];
        [v23 minusSet:*(*&buf[8] + 40)];
        v78 = [*(*&buf[8] + 40) mutableCopy];
        [v78 minusSet:v6];
        v24 = a1[5];
        [objc_opt_class() dumpAccessories:v23 usingTag:@"removed from allowed accessories" flow:a1[6]];
        v25 = a1[5];
        [objc_opt_class() dumpAccessories:v78 usingTag:@"newly added to allowed accessories" flow:a1[6]];
        v83[0] = MEMORY[0x277D85DD0];
        v83[1] = 3221225472;
        v83[2] = __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke_2625;
        v83[3] = &unk_2786709E8;
        v84 = v11;
        [v23 na_each:v83];
        v75 = listOfUUIDsFromManagedObjectSet(v23);
        v74 = listOfUUIDsFromManagedObjectSet(v78);
        v26 = [a1[4] restrictedGuestAccessSettings];
        v27 = [v26 schedule];
        v28 = [a1[8] schedule];
        v76 = HMFEqualObjects();

        if ((v76 & 1) == 0)
        {
          v29 = objc_autoreleasePoolPush();
          v30 = a1[5];
          v31 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
          {
            v69 = v29;
            v72 = HMFGetLogIdentifier();
            v70 = [a1[6] UUID];
            v32 = [a1[4] restrictedGuestAccessSettings];
            v33 = [v32 schedule];
            v34 = [a1[8] schedule];
            *v97 = 138544130;
            v98 = v72;
            v99 = 2112;
            v100 = v70;
            v101 = 2112;
            v102 = v33;
            v103 = 2112;
            v104 = v34;
            _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Changing schedule from: %@, to: %@", v97, 0x2Au);

            v29 = v69;
          }

          objc_autoreleasePoolPop(v29);
        }

        v35 = +[HMCContext currentContext];
        v82 = 0;
        v36 = [v35 save:&v82];
        v73 = v82;

        v37 = objc_autoreleasePoolPush();
        v38 = a1[5];
        if (v36)
        {
          v39 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
          {
            v40 = HMFGetLogIdentifier();
            v41 = [a1[6] UUID];
            v42 = a1[8];
            *v97 = 138543874;
            v98 = v40;
            v99 = 2112;
            v100 = v41;
            v101 = 2112;
            v102 = v42;
            _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Successfully saved the restricted guest settings to working store : %@", v97, 0x20u);
          }

          objc_autoreleasePoolPop(v37);
          [a1[4] setRestrictedGuestAccessSettings:a1[8]];
          [a1[4] scheduleRestrictedGuestAccessTimersWithReason:@"Admin updated RG Settings"];
          v43 = [HMDBackgroundOperationManagerHelper auditProhibitedAccessToRestrictedGuest:a1[4] forAccessories:v75 shouldRemoveScheduledOperations:1 parentFlow:a1[6]];
          if (v76)
          {
            v44 = v74;
          }

          else
          {
            v44 = [a1[8] uuidsOfAllowedAccessories];
          }

          v77 = v44;
          v56 = [HMDBackgroundOperationManagerHelper auditAllowedAccessToRestrictedGuest:a1[4] forAccessories:v44 shouldRemoveScheduledOperations:1 parentFlow:a1[6]];
          v57 = objc_alloc(MEMORY[0x277D0F7A8]);
          v58 = [a1[5] workQueue];
          v59 = [v57 initWithQueue:v58];

          v60 = MEMORY[0x277D0F7C0];
          v96[0] = v43;
          v96[1] = v56;
          v61 = [MEMORY[0x277CBEA60] arrayWithObjects:v96 count:2];
          v62 = [v60 allSettled:v61];

          v79[0] = MEMORY[0x277D85DD0];
          v79[1] = 3221225472;
          v79[2] = __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke_2630;
          v79[3] = &unk_278679B58;
          v71 = *(a1 + 5);
          v63 = *(&v71 + 1);
          v64 = a1[4];
          v65 = a1[7];
          *&v66 = v64;
          *(&v66 + 1) = v65;
          v80 = v71;
          v81 = v66;
          v67 = [v62 inContext:v59 then:v79];
        }

        else
        {
          v52 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
          {
            v53 = HMFGetLogIdentifier();
            v54 = [a1[6] UUID];
            *v97 = 138543874;
            v98 = v53;
            v99 = 2112;
            v100 = v54;
            v101 = 2112;
            v102 = v73;
            _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Unable to save the restricted guest settings to working store : %@", v97, 0x20u);
          }

          objc_autoreleasePoolPop(v37);
          v55 = a1[7];
          v43 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2711];
          [v55 respondWithError:v43];
        }
      }

      else
      {
        v45 = objc_autoreleasePoolPush();
        v46 = a1[5];
        v47 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
        {
          v48 = HMFGetLogIdentifier();
          v49 = [a1[6] UUID];
          v50 = [a1[8] schedule];
          *v97 = 138543874;
          v98 = v48;
          v99 = 2112;
          v100 = v49;
          v101 = 2112;
          v102 = v50;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Unable to save the restricted guest schedule to working store : %@", v97, 0x20u);
        }

        objc_autoreleasePoolPop(v45);
        v51 = a1[7];
        v23 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2711];
        [v51 respondWithError:v23];
      }
    }

    _Block_object_dispose(&v90, 8);
    _Block_object_dispose(buf, 8);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = a1[5];
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [a1[6] UUID];
      v17 = [a1[4] uuid];
      *buf = 138543874;
      *&buf[4] = v15;
      *&buf[12] = 2112;
      *&buf[14] = v16;
      *&buf[22] = 2112;
      v106 = v17;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Unable to fetch the guest with id [%@] from working store", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
    v18 = a1[7];
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v18 respondWithError:v6];
  }

  v68 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke_2617(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v23 = *MEMORY[0x277D85DE8];
  v6 = a2;
  v7 = [HMCContext findAccessoryWithModelID:v6];
  if (v7)
  {
    [*(*(*(a1 + 64) + 8) + 40) addObject:v7];
    [*(a1 + 48) addAllowedAccessoriesObject:v7];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [*(a1 + 40) UUID];
      v17 = 138543874;
      v18 = v11;
      v19 = 2112;
      v20 = v12;
      v21 = 2112;
      v22 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Unable to fetch the accessory with id [%@] from working store", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v14 = *(*(a1 + 56) + 8);
    v15 = *(v14 + 40);
    *(v14 + 40) = v13;

    *a4 = 1;
  }

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __49__HMDHome___handleUpdateRestrictedGuestSettings___block_invoke_2630(id *a1, void *a2)
{
  v34 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 objectAtIndexedSubscript:0];
  v5 = [v4 count];

  v6 = objc_autoreleasePoolPush();
  v7 = a1[4];
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (!os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v10 = HMFGetLogIdentifier();
    v11 = [a1[5] UUID];
    v12 = [a1[6] uuid];
    v13 = [v3 objectAtIndexedSubscript:0];
    v26 = 138544130;
    v27 = v10;
    v28 = 2112;
    v29 = v11;
    v30 = 2112;
    v31 = v12;
    v32 = 2112;
    v33 = v13;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Some error occurred when removing pairings, pin codes & Home keys for the restricted guest %@ with error dictionary: %@", &v26, 0x2Au);
  }

  else
  {
    if (!os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      goto LABEL_7;
    }

    v10 = HMFGetLogIdentifier();
    v11 = [a1[5] UUID];
    v26 = 138543618;
    v27 = v10;
    v28 = 2112;
    v29 = v11;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Successfully finished removing pairings, pin codes & Home keys for the restricted guest", &v26, 0x16u);
  }

LABEL_7:
  objc_autoreleasePoolPop(v6);
  v14 = [v3 objectAtIndexedSubscript:1];
  v15 = [v14 count];

  v16 = objc_autoreleasePoolPush();
  v17 = a1[4];
  v18 = HMFGetOSLogHandle();
  v19 = v18;
  if (v15)
  {
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      v21 = [a1[5] UUID];
      v22 = [a1[6] uuid];
      v23 = [v3 objectAtIndexedSubscript:1];
      v26 = 138544130;
      v27 = v20;
      v28 = 2112;
      v29 = v21;
      v30 = 2112;
      v31 = v22;
      v32 = 2112;
      v33 = v23;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Some error occurred when adding pairings, pin codes & Home keys for the restricted guest %@ with error dictionary: %@", &v26, 0x2Au);

LABEL_12:
    }
  }

  else if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v21 = [a1[5] UUID];
    v26 = 138543618;
    v27 = v20;
    v28 = 2112;
    v29 = v21;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Successfully finished adding pairings, pin codes & Home keys for the restricted guest", &v26, 0x16u);
    goto LABEL_12;
  }

  objc_autoreleasePoolPop(v16);
  [a1[7] respondWithSuccess];

  v24 = *MEMORY[0x277D85DE8];
  return 1;
}

- (void)_handleUpdateRestrictedGuestSettings:(id)a3
{
  v13 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self hasAnyResident]&& isTVOSDevice())
  {
    [(HMDHome *)self __handleUpdateRestrictedGuestSettings:v4];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Not handling this message as this home does not have any resident and this is controller.", &v11, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    [v4 respondWithError:v9];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_updateRestrictedGuestHomeAccessSettingsFromOutgoingInvitation:(id)a3 forUserModel:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 uuidsOfAllowedAccessories];
  [v7 setAllowedAccessoryUUIDs:v8];

  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [v7 allowedAccessoryUUIDs];
    v15 = 138543618;
    v16 = v12;
    v17 = 2112;
    v18 = v13;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Allowed accessories for RG users: %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)shouldWeSendAutomationsToClients
{
  v2 = [(HMDHome *)self currentUser];
  v3 = [v2 isRestrictedGuest];

  return v3 ^ 1;
}

- (BOOL)defaultRoomContainsAccessoryWithUUID:(id)a3
{
  v4 = [(HMDHome *)self accessoryWithUUID:a3];
  v5 = [(HMDHome *)self roomForEntireHome];
  v6 = [v4 room];
  v7 = [v5 isEqual:v6];

  return v7;
}

- (BOOL)hasActiveWACPairing
{
  v2 = [(HMDHome *)self accessoryBrowser];
  v3 = [v2 hasActiveWACPairing];

  return v3;
}

- (id)destinationForAppleMediaAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaGroupsAggregateConsumer];
  v6 = [v4 uuid];

  v7 = [v5 destinationWithParentIdentifier:v6];

  return v7;
}

- (id)destinationControllerDataForAppleMediaAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaGroupsAggregateConsumer];
  v6 = [v4 uuid];

  v7 = [v5 destinationControllerDataWithParentIdentifier:v6];

  return v7;
}

- (id)mediaGroupsAggregateDataTopicName
{
  v2 = MEMORY[0x277CD1A78];
  v3 = *MEMORY[0x277CCFF30];
  v4 = [(HMDHome *)self uuid];
  v5 = [v2 topicFromSuffixID:v3 homeUUID:v4];

  return v5;
}

- (void)_handleRetrieveHomeLocationForFeedback:(id)a3
{
  v24 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self homeLocationHandler];

  if (v5)
  {
    v6 = [MEMORY[0x277CBEB38] dictionary];
    v7 = [(HMDHome *)self homeLocationHandler];
    v8 = [v7 locationUpdateTimestamp];

    if (v8)
    {
      v9 = [(HMDHome *)self homeLocationHandler];
      v10 = [v9 locationUpdateTimestamp];
      [v6 setObject:v10 forKeyedSubscript:*MEMORY[0x277CD0048]];
    }

    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v20 = 138543618;
      v21 = v14;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Retrieve home location for feedback : %@", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    [v4 respondWithPayload:v6];
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v20 = 138543362;
      v21 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Home Location Handler does not exist.", &v20, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v6];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (BOOL)_processTestModeHomeAccessControlOverride:(id)a3 error:(id *)a4
{
  v26 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [v6 hmf_BOOLForKey:@"kConfigTestingResetOverrideKey"];
  v8 = [v6 hmf_numberForKey:@"kConfigTestingHomeAccessControlKey"];
  if (v8)
  {
    v9 = 1;
  }

  else
  {
    v9 = v7;
  }

  if (v9)
  {
    os_unfair_recursive_lock_lock_with_options();
    if (v7)
    {

      v8 = 0;
    }

    overriddenHomeAccessControl = self->_overriddenHomeAccessControl;
    v11 = HMFEqualObjects();
    objc_storeStrong(&self->_overriddenHomeAccessControl, v8);
    os_unfair_recursive_lock_unlock();
    if (v11)
    {
      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v22 = 138543618;
        v23 = v15;
        v24 = 2112;
        v25 = v6;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Home Access Control overridden to %@", &v22, 0x16u);
      }

      objc_autoreleasePoolPop(v12);
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home access control override: missing data in payload", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    if (a4)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      *a4 = v8 = 0;
    }

    else
    {
      v8 = 0;
    }
  }

  v20 = *MEMORY[0x277D85DE8];
  return v9;
}

- (BOOL)_processTestModeUpdateHomeLocation:(id)a3 error:(id *)a4
{
  v44 = *MEMORY[0x277D85DE8];
  v6 = a3;
  if (isInternalBuild())
  {
    v7 = [v6 dataForKey:@"kHomeLocationDataKey"];
    if (v7)
    {
      v37 = 0;
      v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v7 error:&v37];
      v9 = v37;
      v10 = v9;
      v11 = v8 != 0;
      if (v8)
      {
        v36 = v9;
        v12 = [v6 hmf_numberForKey:@"homeLocationSource"];
        v13 = [v12 intValue];

        v14 = objc_autoreleasePoolPush();
        v15 = self;
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
        {
          v17 = HMFGetLogIdentifier();
          v18 = HMDHomeLocationSourceToString(v13);
          *buf = 138543874;
          v39 = v17;
          v40 = 2112;
          v41 = v8;
          v42 = 2112;
          v43 = v18;
          _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Received new home location override from shared admin: %@, source : %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v14);
        v19 = [(HMDHome *)v15 homeLocationHandler];
        v20 = [MEMORY[0x277CBEAA8] date];
        [v19 runTransactionWithLocation:v8 updatedTime:v20 source:v13];

        v10 = v36;
      }

      else
      {
        v29 = objc_autoreleasePoolPush();
        v30 = self;
        v31 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
        {
          v32 = HMFGetLogIdentifier();
          *buf = 138543874;
          v39 = v32;
          v40 = 2112;
          v41 = v7;
          v42 = 2112;
          v43 = v10;
          _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: failed to unarchive location from data %@: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v29);
        if (a4)
        {
          v33 = v10;
          *a4 = v10;
        }
      }
    }

    else
    {
      v25 = objc_autoreleasePoolPush();
      v26 = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        *buf = 138543362;
        v39 = v28;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: no home location data found in payload", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
      if (a4)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        *a4 = v11 = 0;
      }

      else
      {
        v11 = 0;
      }
    }
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v39 = v24;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: not running on an internal build", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
    if (a4)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      *a4 = v11 = 0;
    }

    else
    {
      v11 = 0;
    }
  }

  v34 = *MEMORY[0x277D85DE8];
  return v11;
}

- (BOOL)_processTestModeHomeLocationStatusOverride:(id)a3 error:(id *)a4
{
  v23 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [v6 hmf_BOOLForKey:@"kConfigTestingResetOverrideKey"];
  v8 = [v6 hmf_numberForKey:@"kConfigTestingHomeLocationStatusKey"];
  v9 = v8;
  if (v8)
  {
    v10 = 1;
  }

  else
  {
    v10 = v7;
  }

  if (v10)
  {
    v11 = [v8 unsignedIntegerValue];
    v12 = [(HMDHome *)self homeLocation];
    os_unfair_recursive_lock_lock_with_options();
    if (v7)
    {
      if (!self->_overrideHomeLocation)
      {
        self->_overriddenHomeLocation = v11;
        os_unfair_recursive_lock_unlock();
        goto LABEL_16;
      }

      v13 = 0;
    }

    else
    {
      v13 = 1;
    }

    self->_overrideHomeLocation = v13;
    self->_overriddenHomeLocation = v11;
    os_unfair_recursive_lock_unlock();
    v18 = [(HMDHome *)self homeLocation];
    if (v18 != v12)
    {
      [(HMDHome *)self _handleHomeLocationChange:v18 previousLocation:v12];
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v17;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location status override: missing data in payload", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
    if (a4)
    {
      *a4 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    }
  }

LABEL_16:

  v19 = *MEMORY[0x277D85DE8];
  return v10;
}

- (void)aggregator:(id)a3 didReceiveSoftwareVersionWithUUID:(id)a4 softwareVersion:(id)a5
{
  v35 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = [v10 buildVersion];
    *buf = 138544130;
    v28 = v14;
    v29 = 2112;
    v30 = v10;
    v31 = 2112;
    v32 = v15;
    v33 = 2112;
    v34 = v9;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received accessory software version: %@ (%@) accessory: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v11);
  v16 = [(HMDHome *)v12 backingStore];
  v17 = [v16 context];

  if (v17)
  {
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __72__HMDHome_aggregator_didReceiveSoftwareVersionWithUUID_softwareVersion___block_invoke;
    v23[3] = &unk_2786891E0;
    v23[4] = v12;
    v24 = v10;
    v25 = v9;
    v26 = v17;
    [v26 performBlock:v23];
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    v19 = v12;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v21;
      v29 = 2112;
      v30 = 0;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to handle received software version due to missing backing store context: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __72__HMDHome_aggregator_didReceiveSoftwareVersionWithUUID_softwareVersion___block_invoke(uint64_t a1)
{
  v35 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v7 = *(a1 + 48);
    *buf = 138543874;
    v30 = v5;
    v31 = 2112;
    v32 = v6;
    v33 = 2112;
    v34 = v7;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saving accessory software version: %@ accessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v2);
  v8 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 48)];
  v9 = v8;
  if (!v8)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = *(a1 + 32);
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v20 = *(a1 + 48);
      *buf = 138543618;
      v30 = v15;
      v31 = 2112;
      v32 = v20;
      v17 = "%{public}@Aggregator: Failed to save accessory software version due to missing mkfAppleMediaAccessory with uuid: %@";
      v18 = v14;
      v19 = OS_LOG_TYPE_ERROR;
      goto LABEL_9;
    }

LABEL_10:

    objc_autoreleasePoolPop(v12);
    goto LABEL_16;
  }

  v10 = *(a1 + 40);
  v11 = [v8 softwareVersion];
  LODWORD(v10) = [v10 isEqual:v11];

  if (v10)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = *(a1 + 32);
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v16 = *(a1 + 48);
      *buf = 138543618;
      v30 = v15;
      v31 = 2112;
      v32 = v16;
      v17 = "%{public}@Aggregator: Skipping already saved accessory software version for accessory: %@";
      v18 = v14;
      v19 = OS_LOG_TYPE_INFO;
LABEL_9:
      _os_log_impl(&dword_229538000, v18, v19, v17, buf, 0x16u);

      goto LABEL_10;
    }

    goto LABEL_10;
  }

  [v9 setSoftwareVersion:*(a1 + 40)];
  v21 = *(a1 + 56);
  v28 = 0;
  [v21 save:&v28];
  v22 = v28;
  if (v22)
  {
    v23 = objc_autoreleasePoolPush();
    v24 = *(a1 + 32);
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v30 = v26;
      v31 = 2112;
      v32 = v22;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save accessory software version with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
  }

LABEL_16:
  v27 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)a3 didReceiveDeviceIRKWithUUID:(id)a4 deviceIRK:(id)a5
{
  v32 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    *buf = 138543874;
    v27 = v14;
    v28 = 2112;
    v29 = v10;
    v30 = 2112;
    v31 = v9;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received accessory deviceIRK: %@ accessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v11);
  v15 = [(HMDHome *)v12 backingStore];
  v16 = [v15 context];

  if (v16)
  {
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __60__HMDHome_aggregator_didReceiveDeviceIRKWithUUID_deviceIRK___block_invoke;
    v22[3] = &unk_2786891E0;
    v22[4] = v12;
    v23 = v10;
    v24 = v9;
    v25 = v16;
    [v25 performBlock:v22];
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = v12;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v20;
      v28 = 2112;
      v29 = 0;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Missing backing store context: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
  }

  v21 = *MEMORY[0x277D85DE8];
}

void __60__HMDHome_aggregator_didReceiveDeviceIRKWithUUID_deviceIRK___block_invoke(uint64_t a1)
{
  v44 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v7 = *(a1 + 48);
    *buf = 138543874;
    v39 = v5;
    v40 = 2112;
    v41 = v6;
    v42 = 2112;
    v43 = v7;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saving accessory deviceIRK: %@ accessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v2);
  v8 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 48)];
  v9 = v8;
  if (v8)
  {
    v10 = [v8 resident];
    if (!v10)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = *(a1 + 32);
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v15 = *(a1 + 48);
        *buf = 138543618;
        v39 = v14;
        v40 = 2112;
        v41 = v15;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save deviceIRK due to missing mkfResident for accessory with uuid: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
    }

    v16 = *(a1 + 40);
    v17 = [v9 deviceIRKData];
    if ([v16 isEqual:v17])
    {
      v18 = *(a1 + 40);
      v19 = [v10 deviceIRKData];
      LODWORD(v18) = [v18 isEqual:v19];

      if (v18)
      {
        v20 = objc_autoreleasePoolPush();
        v21 = *(a1 + 32);
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          v23 = HMFGetLogIdentifier();
          v24 = *(a1 + 48);
          *buf = 138543618;
          v39 = v23;
          v40 = 2112;
          v41 = v24;
          _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Skipping matching deviceIRK for accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v20);
LABEL_22:

        goto LABEL_23;
      }
    }

    else
    {
    }

    [v9 setDeviceIRKData:*(a1 + 40)];
    [v10 setDeviceIRKData:*(a1 + 40)];
    v30 = *(a1 + 56);
    v37 = 0;
    [v30 save:&v37];
    v31 = v37;
    if (v31)
    {
      v32 = objc_autoreleasePoolPush();
      v33 = *(a1 + 32);
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543618;
        v39 = v35;
        v40 = 2112;
        v41 = v31;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save accessory pairing identity with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v32);
    }

    goto LABEL_22;
  }

  v25 = objc_autoreleasePoolPush();
  v26 = *(a1 + 32);
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
  {
    v28 = HMFGetLogIdentifier();
    v29 = *(a1 + 48);
    *buf = 138543618;
    v39 = v28;
    v40 = 2112;
    v41 = v29;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: did not find mkfAppleMediaAccessory with uuid: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v25);
LABEL_23:

  v36 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)a3 didReceivePublicPairingKeyWithUUID:(id)a4 pairingIdentity:(id)a5
{
  v32 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    *buf = 138543874;
    v27 = v14;
    v28 = 2112;
    v29 = v10;
    v30 = 2112;
    v31 = v9;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received accessory public pairing identity: %@ accessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v11);
  v15 = [(HMDHome *)v12 backingStore];
  v16 = [v15 context];

  if (v16)
  {
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __73__HMDHome_aggregator_didReceivePublicPairingKeyWithUUID_pairingIdentity___block_invoke;
    v22[3] = &unk_2786891E0;
    v22[4] = v12;
    v23 = v10;
    v24 = v9;
    v25 = v16;
    [v25 performBlock:v22];
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = v12;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v20;
      v28 = 2112;
      v29 = 0;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to handle received accessory public pairing identity due to missing backing store context: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
  }

  v21 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome_aggregator_didReceivePublicPairingKeyWithUUID_pairingIdentity___block_invoke(uint64_t a1)
{
  v48 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v7 = *(a1 + 48);
    *buf = 138543874;
    v43 = v5;
    v44 = 2112;
    v45 = v6;
    v46 = 2112;
    v47 = v7;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saving accessory public pairing identity: %@ accessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v2);
  v8 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 48)];
  v9 = v8;
  if (v8)
  {
    v10 = [v8 resident];
    if (!v10)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = *(a1 + 32);
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v15 = *(a1 + 48);
        *buf = 138543618;
        v43 = v14;
        v44 = 2112;
        v45 = v15;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save accessory public pairing identity due to missing mkfResident for accessory with uuid: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
    }

    v16 = *(a1 + 40);
    v17 = [v9 pairingIdentity];
    if ([v16 isEqual:v17])
    {
      v18 = *(a1 + 40);
      v19 = [v10 pairingIdentity];
      LODWORD(v18) = [v18 isEqual:v19];

      if (v18)
      {
        v20 = objc_autoreleasePoolPush();
        v21 = *(a1 + 32);
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          v23 = HMFGetLogIdentifier();
          v24 = *(a1 + 48);
          *buf = 138543618;
          v43 = v23;
          v44 = 2112;
          v45 = v24;
          _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Skipping already saved accessory public pairing identity for accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v20);
        goto LABEL_25;
      }
    }

    else
    {
    }

    [v9 setPairingIdentity:*(a1 + 40)];
    [v10 setPairingIdentity:*(a1 + 40)];
    v30 = *(a1 + 56);
    v41 = 0;
    v31 = [v30 save:&v41];
    v32 = v41;
    v33 = v32;
    if (v31)
    {
      v34 = objc_autoreleasePoolPush();
      v35 = *(a1 + 32);
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
      {
        v37 = HMFGetLogIdentifier();
        v38 = *(a1 + 48);
        *buf = 138543618;
        v43 = v37;
        v44 = 2112;
        v45 = v38;
        _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Saved pairing identity for accessory: %@", buf, 0x16u);
      }
    }

    else
    {
      if (!v32)
      {
LABEL_24:

LABEL_25:
        goto LABEL_26;
      }

      v34 = objc_autoreleasePoolPush();
      v35 = *(a1 + 32);
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
      {
        v39 = HMFGetLogIdentifier();
        *buf = 138543618;
        v43 = v39;
        v44 = 2112;
        v45 = v33;
        _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save pairing identity error: %@", buf, 0x16u);
      }
    }

    objc_autoreleasePoolPop(v34);
    goto LABEL_24;
  }

  v25 = objc_autoreleasePoolPush();
  v26 = *(a1 + 32);
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
  {
    v28 = HMFGetLogIdentifier();
    v29 = *(a1 + 48);
    *buf = 138543618;
    v43 = v28;
    v44 = 2112;
    v45 = v29;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Failed to save accessory public pairing identity due to missing mkfAppleMediaAccessory with uuid: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v25);
LABEL_26:

  v40 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)a3 residentCapabilitiesWithUUID:(id)a4 completion:(id)a5
{
  v32 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self accessoryWithUUID:v9];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v12 = v11;
  }

  else
  {
    v12 = 0;
  }

  v13 = v12;

  if (v13)
  {
    v14 = [(HMDHome *)self backingStore];
    v15 = [v14 context];

    if (v15)
    {
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __62__HMDHome_aggregator_residentCapabilitiesWithUUID_completion___block_invoke;
      v25[3] = &unk_27868A7A0;
      v26 = v9;
      v27 = v10;
      [v15 performBlock:v25];
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      v21 = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543362;
        v29 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Did not find backingstore context", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      (*(v10 + 2))(v10, 0);
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v19;
      v30 = 2112;
      v31 = v9;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Did not find accessory for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    (*(v10 + 2))(v10, 0);
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __62__HMDHome_aggregator_residentCapabilitiesWithUUID_completion___block_invoke(uint64_t a1)
{
  v5 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 32)];
  v2 = *(a1 + 40);
  v3 = [v5 resident];
  v4 = [v3 residentCapabilities];
  (*(v2 + 16))(v2, v4);
}

- (void)aggregator:(id)a3 accessoryCapabilitiesWithUUID:(id)a4 completion:(id)a5
{
  v32 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self accessoryWithUUID:v9];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v12 = v11;
  }

  else
  {
    v12 = 0;
  }

  v13 = v12;

  if (v13)
  {
    v14 = [(HMDHome *)self backingStore];
    v15 = [v14 context];

    if (v15)
    {
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __63__HMDHome_aggregator_accessoryCapabilitiesWithUUID_completion___block_invoke;
      v25[3] = &unk_27868A7A0;
      v26 = v9;
      v27 = v10;
      [v15 performBlock:v25];
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      v21 = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543362;
        v29 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Did not find backingstore context", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      (*(v10 + 2))(v10, 0);
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v19;
      v30 = 2112;
      v31 = v9;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Aggregator: Did not find accessory for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    (*(v10 + 2))(v10, 0);
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __63__HMDHome_aggregator_accessoryCapabilitiesWithUUID_completion___block_invoke(uint64_t a1)
{
  v4 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 32)];
  v2 = *(a1 + 40);
  v3 = [v4 accessoryCapabilities];
  (*(v2 + 16))(v2, v3);
}

- (void)aggregatorDidBecomePrimary:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 _accessoryOfCurrentDevice];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  v9 = [(HMDHome *)self appleMediaAccessories];
  if (v8)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v23 = v13;
      v24 = 2112;
      v25 = v8;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Became primary with current accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [(HMDHome *)v11 backingStore];
    v15 = [v14 context];

    v18[0] = MEMORY[0x277D85DD0];
    v18[1] = 3221225472;
    v18[2] = __38__HMDHome_aggregatorDidBecomePrimary___block_invoke;
    v18[3] = &unk_27868A010;
    v19 = v9;
    v20 = v11;
    v21 = v15;
    v16 = v15;
    [v16 performBlock:v18];
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome_aggregatorDidBecomePrimary___block_invoke(uint64_t a1)
{
  v1 = a1;
  v45 = *MEMORY[0x277D85DE8];
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v2 = *(a1 + 32);
  v34 = [v2 countByEnumeratingWithState:&v36 objects:v44 count:16];
  if (v34)
  {
    v3 = 0;
    v33 = *v37;
    v35 = v1;
    obj = v2;
    do
    {
      for (i = 0; i != v34; ++i)
      {
        if (*v37 != v33)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v36 + 1) + 8 * i);
        v6 = [v5 uuid];
        v7 = [HMCContext findAppleMediaAccessoryWithModelID:v6];

        v8 = [*(v1 + 40) capabilitiesAggregator];
        v9 = [v5 uuid];
        v10 = [v7 accessoryCapabilities];
        v11 = [v8 accessoryCapabilitiesForAccessory:v9 ifDifferentFrom:v10];

        if (v11)
        {
          [v7 setAccessoryCapabilities:v11];
          v12 = objc_autoreleasePoolPush();
          v13 = *(v1 + 40);
          v14 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
          {
            v15 = HMFGetLogIdentifier();
            v16 = [v5 uuid];
            *buf = 138543618;
            v41 = v15;
            v42 = 2112;
            v43 = v16;
            _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Accessory capabilities differ for %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v12);
          v3 = 1;
          v1 = v35;
        }

        v17 = [v7 resident];
        v18 = [*(v1 + 40) capabilitiesAggregator];
        v19 = [v5 uuid];
        v20 = [v17 residentCapabilities];
        v21 = [v18 residentCapabilitiesForAccessory:v19 ifDifferentFrom:v20];

        if (v17 && v21)
        {
          [v17 setResidentCapabilities:v21];
          v22 = objc_autoreleasePoolPush();
          v23 = *(v35 + 40);
          v24 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
          {
            v25 = HMFGetLogIdentifier();
            v26 = [v5 uuid];
            *buf = 138543618;
            v41 = v25;
            v42 = 2112;
            v43 = v26;
            _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Resident capabilities differ for %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v22);
          v3 = 1;
        }

        v1 = v35;
      }

      v34 = [obj countByEnumeratingWithState:&v36 objects:v44 count:16];
    }

    while (v34);

    if ((v3 & 1) != 0 && [*(v35 + 48) save])
    {
      v27 = objc_autoreleasePoolPush();
      v28 = *(v35 + 40);
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543362;
        v41 = v30;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saved capabilities as they are different", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v27);
    }
  }

  else
  {
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)a3 changedResidentCapabilities:(id)a4 rawCapabilities:(id)a5 accessoryUUID:(id)a6 homeUUID:(id)a7
{
  v26 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v17 = objc_autoreleasePoolPush();
  v18 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v22 = 138543618;
    v23 = v20;
    v24 = 2112;
    v25 = v15;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received resident capabilities for accessory: %@", &v22, 0x16u);
  }

  objc_autoreleasePoolPop(v17);
  [(HMDHome *)v18 _writeResidentCapabilities:v14 accessoryUUID:v15 homeUUID:v16];

  v21 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)a3 changedAccessoryCapabilities:(id)a4 rawCapabilities:(id)a5 accessoryUUID:(id)a6 homeUUID:(id)a7
{
  v26 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v17 = objc_autoreleasePoolPush();
  v18 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v22 = 138543618;
    v23 = v20;
    v24 = 2112;
    v25 = v15;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received accessory capabilities for accessory: %@", &v22, 0x16u);
  }

  objc_autoreleasePoolPop(v17);
  [(HMDHome *)v18 _writeAccessoryCapabilities:v14 accessoryUUID:v15 homeUUID:v16];

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_writeResidentCapabilities:(id)a3 accessoryUUID:(id)a4 homeUUID:(id)a5
{
  v7 = a3;
  v8 = a4;
  v9 = [(HMDHome *)self accessoryWithUUID:v8];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if ((isKindOfClass & 1) != 0 && v9)
  {
    v11 = [(HMDHome *)self backingStore];
    v12 = [v11 context];

    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __61__HMDHome__writeResidentCapabilities_accessoryUUID_homeUUID___block_invoke;
    v14[3] = &unk_2786891E0;
    v15 = v8;
    v16 = v7;
    v17 = v12;
    v18 = self;
    v13 = v12;
    [v13 performBlock:v14];
  }
}

void __61__HMDHome__writeResidentCapabilities_accessoryUUID_homeUUID___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 32)];
  v3 = *(a1 + 40);
  v4 = [v2 resident];
  [v4 setResidentCapabilities:v3];

  if ([*(a1 + 48) save])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 56);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 32);
      v11 = 138543618;
      v12 = v8;
      v13 = 2112;
      v14 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saved resident capabilities for %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_writeAccessoryCapabilities:(id)a3 accessoryUUID:(id)a4 homeUUID:(id)a5
{
  v7 = a3;
  v8 = a4;
  v9 = [(HMDHome *)self accessoryWithUUID:v8];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if ((isKindOfClass & 1) != 0 && v9)
  {
    v11 = [(HMDHome *)self backingStore];
    v12 = [v11 context];

    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __62__HMDHome__writeAccessoryCapabilities_accessoryUUID_homeUUID___block_invoke;
    v14[3] = &unk_2786891E0;
    v15 = v8;
    v16 = v7;
    v17 = v12;
    v18 = self;
    v13 = v12;
    [v13 performBlock:v14];
  }
}

void __62__HMDHome__writeAccessoryCapabilities_accessoryUUID_homeUUID___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = [HMCContext findAppleMediaAccessoryWithModelID:*(a1 + 32)];
  [v2 setAccessoryCapabilities:*(a1 + 40)];
  if ([*(a1 + 48) save])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 56);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 32);
      v9 = 138543618;
      v10 = v6;
      v11 = 2112;
      v12 = v7;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Aggregator: Saved accessory capabilities for %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (id)localAndRemoteSubscriptionProvider
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 localAndRemoteSubscriptionProvider];

  return v3;
}

- (id)eventStoreReadHandle
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 eventStoreReadHandle];

  return v3;
}

- (HMEEventForwarder)eventForwarder
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 eventForwarder];

  return v3;
}

- (void)didReceiveAccessorySetting:(id)a3 accessoryUUID:(id)a4
{
  v35 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  if (v10 && ([v10 keyPath], v11 = objc_claimAutoreleasedReturnValue(), v12 = objc_msgSend(v11, "isEqualToString:", @"root.siri.availableLanguages"), v11, (v12 & 1) != 0))
  {
    v13 = [(HMDHome *)self accessoryWithUUID:v7];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v15)
    {
      v16 = [(HMDHome *)self notificationCenter];
      v27 = @"HMDHomeNotificationKey";
      v28 = self;
      v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v28 forKeys:&v27 count:1];
      [v16 postNotificationName:@"HMDAppleMediaAccessoryLanguagesChangedNotification" object:self userInfo:v17];
    }

    else
    {
      v22 = objc_autoreleasePoolPush();
      v23 = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543874;
        v30 = v25;
        v31 = 2112;
        v32 = v8;
        v33 = 2112;
        v34 = v7;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Received accessory setting %@ that is not for an accessory %@ in this home", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v22);
    }
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543618;
      v30 = v21;
      v31 = 2112;
      v32 = v8;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Unexpectedly received accessory setting %@ that is not for available languages", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (id)deviceForAppleMediaAccessoryMessageRouter:(id)a3 message:(id)a4
{
  v5 = [a4 messagePayload];
  v6 = [v5 hmf_UUIDForKey:*MEMORY[0x277CCF0B8]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  v10 = [v9 device];

  return v10;
}

- (BOOL)isCurrentDevicePairedWithWatchForSiriSecureAccessoryAccessController:(id)a3
{
  v3 = [(HMDHome *)self homeManager];
  v4 = [v3 isPairedWithWatch];

  return v4;
}

- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithWatchAuthForSiriSecureAccessoryAccessController:(id)a3
{
  v3 = [(HMDHome *)self localCapabilitiesDataSource];
  v4 = [v3 supportsSiriUnsecuringActionsWithWatchAuth];

  return v4;
}

- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithNoPasscodeForSiriSecureAccessoryAccessController:(id)a3
{
  v3 = [(HMDHome *)self localCapabilitiesDataSource];
  v4 = [v3 supportsSiriUnsecuringActionsWithNoPasscode];

  return v4;
}

- (HMDSiriSecureAccessoryAccessController)siriSecureAccessoryAccessController
{
  v3 = [(HMDHome *)self dataSource];
  v4 = [v3 makeSiriSecureAccessoryAccessControllerWithDataSource:self];

  return v4;
}

- (BOOL)isMediaSystem:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __25__HMDHome_isMediaSystem___block_invoke;
  v9[3] = &unk_278675410;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7 != 0;
}

uint64_t __25__HMDHome_isMediaSystem___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (BOOL)isSidekickAccessory:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithUUID:a3];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = v5;
  if (v5)
  {
    v7 = [v5 siriEndpointProfile];
    v8 = v7 != 0;
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (BOOL)isAppleMediaAccessory:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithUUID:a3];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & (v3 != 0);
}

- (BOOL)router:(id)a3 shouldHandleMessage:(id)a4 usingRouter:(id)a5
{
  v35 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self accessoryMessageRouterViaPrimary];

  if (v11 != v8)
  {
    v12 = 0;
    goto LABEL_18;
  }

  v13 = [v9 messagePayload];
  v14 = [v13 hmf_UUIDForKey:*MEMORY[0x277CCF0B8]];

  v15 = [(HMDHome *)self accessoryWithUUID:v14];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v16 = v15;
  }

  else
  {
    v16 = 0;
  }

  v17 = v16;

  v18 = [(HMDHome *)self currentAccessory];
  v19 = [v18 uuid];
  v20 = [v17 uuid];
  v21 = [v19 hmf_isEqualToUUID:v20];

  if (v17)
  {
    v22 = [(HMDHome *)self appleDeviceRouter];
    v23 = v22;
    if (v22 == v10)
    {
      v24 = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident]| v21;

      if (v24)
      {
        v25 = objc_autoreleasePoolPush();
        v26 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_DEBUG))
        {
          v28 = HMFGetLogIdentifier();
          v33 = 138543362;
          v34 = v28;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEBUG, "%{public}@accepting accessory router", &v33, 0xCu);
        }

        objc_autoreleasePoolPop(v25);
        v29 = 1;
        goto LABEL_14;
      }
    }

    else
    {
    }
  }

  v29 = 0;
LABEL_14:
  v30 = [(HMDHome *)self primaryResidentMessageRouter];

  if (v30 == v10)
  {
    v12 = 1;
  }

  else
  {
    v12 = v29;
  }

LABEL_18:
  v31 = *MEMORY[0x277D85DE8];
  return v12;
}

- (BOOL)remoteEventAllowedForTopic:(id)a3 deviceType:(unint64_t)a4 userType:(unint64_t)a5
{
  v8 = a3;
  v9 = [(HMDHome *)self homeRemoteEventAccessController];
  LOBYTE(a5) = [v9 remoteEventAllowedForTopic:v8 deviceType:a4 userType:a5];

  return a5;
}

- (id)currentAccessoryHomeUUID
{
  v3 = [(HMDHome *)self currentAccessory];

  if (v3)
  {
    v4 = [(HMDHome *)self uuid];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)currentAccessorySetupMetricDispatcher
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 currentAccessorySetupMetricDispatcher];

  return v3;
}

- (id)expandedTopicsWithTopics:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [HMDHomeEventsGenerated expandedTopicsWithTopics:v4 homeManager:v5];

  return v6;
}

- (BOOL)canTopicBeForwardedToPrimaryFromResident:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    if (self)
    {
      v8 = MEMORY[0x277CD16F0];
      v9 = v7;
      v10 = [(HMDHome *)self uuid];
      v11 = [v9 uuid];

      self = [v8 topicPrefixWithHomeUUID:v10 accessoryUUID:v11];
    }

    v12 = [v4 hasPrefix:self];
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

- (id)messageTargetForDeviceIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self residentDeviceManager];
  v6 = [v5 residentDevices];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __44__HMDHome_messageTargetForDeviceIdentifier___block_invoke;
  v11[3] = &unk_2786850E0;
  v12 = v4;
  v7 = v4;
  v8 = [v6 na_firstObjectPassingTest:v11];
  v9 = [v8 device];

  return v9;
}

uint64_t __44__HMDHome_messageTargetForDeviceIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 device];
  v4 = [v3 identifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (BOOL)isDeviceIdentifierPrimaryResident:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self primaryResident];
  v6 = [v5 device];
  v7 = [v6 identifier];
  v8 = [v7 hmf_isEqualToUUID:v4];

  return v8;
}

- (BOOL)isDevicePrimaryResident:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self primaryResident];
  v6 = [v5 device];
  v7 = [v6 isEqual:v4];

  return v7;
}

- (BOOL)shouldAllowTopic:(id)a3 forDeviceWithMessageIdentifier:(id)a4
{
  v14[1] = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [(HMDHome *)self accessoryWithDeviceIdentifier:a4];
  if (v7)
  {
    v14[0] = v6;
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v14 count:1];
    v9 = [v7 uuid];
    v10 = [HMDAccessoryEventsGenerated topicsRemovingAccessoryTopics:v8 accessoryUUID:v9];
    v11 = [v10 count] != 0;
  }

  else
  {
    v11 = 1;
  }

  v12 = *MEMORY[0x277D85DE8];
  return v11;
}

- (id)routerServerUserAccessControlProviderForIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self users];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __62__HMDHome_routerServerUserAccessControlProviderForIdentifier___block_invoke;
  v9[3] = &unk_278688680;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __62__HMDHome_routerServerUserAccessControlProviderForIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (id)routerServerUserAccessControlProviderIdentifierForMessage:(id)a3
{
  v3 = [a3 matchingRemoteIdentityUserForHome:self];
  v4 = [v3 uuid];

  return v4;
}

- (void)primaryResidentClientHasConnectivityDidChangeForRemoteEventRouterClientController:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self remoteEventRouterClientController];

  if (v5 == v4)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v4 primaryResidentClientHasConnectivity];
      v11 = @"down";
      if (v10)
      {
        v11 = @"up";
      }

      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Connectivity to primary resident is %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    [(HMDHome *)v7 canReachPrimaryResidentChanged];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)clientController:(id)a3 primaryClientConnectMessageFailWithError:(id)a4
{
  v5 = a4;
  v6 = [(HMDHome *)self homeManager];
  v7 = [v6 accessorySetupMetricDispatchersForHome:self];
  v14 = MEMORY[0x277D85DD0];
  v15 = 3221225472;
  v16 = __69__HMDHome_clientController_primaryClientConnectMessageFailWithError___block_invoke;
  v17 = &unk_278670998;
  v18 = self;
  v8 = v5;
  v19 = v8;
  [v7 na_each:&v14];
  v9 = [(HMDHome *)self currentDevice:v14];
  if (v9)
  {
    v10 = v9;
    v11 = [(HMDHome *)self _hasConfirmedPrimaryResidentDevice];

    if (v11)
    {
      v12 = [v6 currentAccessorySetupMetricDispatcher];
      [v12 markEventRouterPrimaryClientConnectMessageFailedWithError:v8];

      v13 = [v6 currentAccessorySetupMetricDispatcher];
      [v13 markCurrentDeviceConfirmedPrimaryResidentStatusDidChange:{-[HMDHome isCurrentDeviceConfirmedPrimaryResident](self, "isCurrentDeviceConfirmedPrimaryResident")}];
    }
  }
}

void __69__HMDHome_clientController_primaryClientConnectMessageFailWithError___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [v3 trackingInfo];
    v9 = [v8 accessoryUUID];
    v12 = 138543618;
    v13 = v7;
    v14 = 2112;
    v15 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Marking primary client connect message failed for accessory: %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = [*(a1 + 32) _hasConfirmedPrimaryResidentDevice];

  if (v10)
  {
    [v3 markEventRouterPrimaryClientConnectMessageFailedWithError:*(a1 + 40)];
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome_clientController_connectionStatusDidChange___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [v3 trackingInfo];
    v9 = [v8 accessoryUUID];
    v12 = 138543618;
    v13 = v7;
    v14 = 2112;
    v15 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Marking primary client connection status changed for accessory: %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = [*(a1 + 32) _hasConfirmedPrimaryResidentDevice];

  if (v10)
  {
    [v3 markEventRouterPrimaryClientConnectStatusChanged:*(a1 + 40)];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentUserRestrictedForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self currentUser];
  v4 = [v3 isRestrictedGuest];

  return v4;
}

- (void)discoverPrimaryResidentForEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self residentDeviceManager];
  [v3 discoverPrimaryResidentForRequester:0];
}

- (BOOL)isCurrentDevicePrimaryResidentForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 isCurrentDevicePrimaryResident];

  return v4;
}

- (BOOL)isCurrentDeviceResidentCapableForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self localCapabilitiesDataSource];
  v4 = [v3 isResidentCapable];

  return v4;
}

- (id)deviceForPrimaryResidentForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 primaryResidentDevice];
  v5 = [v4 device];

  if ([v5 isCurrentDevice])
  {
    v6 = 0;
  }

  else
  {
    v6 = v5;
  }

  return v6;
}

- (id)deviceForAccessoryUUID:(id)a3 forRemoteEventRouterClientController:(id)a4
{
  v4 = [(HMDHome *)self accessoryWithUUID:a3, a4];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  if (v6)
  {
    v7 = [v6 deviceForDirectMessaging];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)eventStoreWriteHandleForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self homeManager];
  v4 = [v3 eventStoreWriteHandle];

  return v4;
}

- (id)eventStoreReadHandleForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self homeManager];
  v4 = [v3 eventStoreReadHandle];

  return v4;
}

- (id)primaryResidentDeviceIdentifierForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 primaryResidentDevice];
  v5 = [v4 device];
  v6 = [v5 identifier];

  return v6;
}

- (void)clientController:(id)a3 didReceiveFetchedCachedEvents:(id)a4 source:(id)a5
{
  v7 = a5;
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __65__HMDHome_clientController_didReceiveFetchedCachedEvents_source___block_invoke;
  v9[3] = &unk_278670948;
  v9[4] = self;
  v10 = v7;
  v8 = v7;
  [a4 hmf_enumerateKeysAndObjectsWithAutoreleasePoolUsingBlock:v9];
}

void __65__HMDHome_clientController_didReceiveFetchedCachedEvents_source___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = *(a1 + 32);
  v6 = a3;
  v7 = a2;
  v9 = [v5 homeManager];
  v8 = [v9 memoryEventConsumer];
  [v8 didReceiveCachedEvent:v6 topic:v7 source:*(a1 + 40)];
}

- (id)eventRouterDumpStateInfo
{
  v20[1] = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self uuid];
  v4 = [v3 UUIDString];

  v19 = v4;
  v17[0] = @"RemoteClientController";
  v5 = [(HMDHome *)self remoteEventRouterClientController];
  v6 = [v5 dumpStateDescription];
  v7 = v6;
  if (v6)
  {
    v8 = v6;
  }

  else
  {
    v8 = &stru_283CF9D50;
  }

  v17[1] = @"RemoteServer";
  v18[0] = v8;
  v9 = [(HMDHome *)self remoteEventRouterServer];
  v10 = [v9 dumpStateDescription];
  v11 = v10;
  if (v10)
  {
    v12 = v10;
  }

  else
  {
    v12 = &stru_283CF9D50;
  }

  v18[1] = v12;
  v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v18 forKeys:v17 count:2];
  v20[0] = v13;
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v20 forKeys:&v19 count:1];

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

- (void)_handleRetrieveAsyncResults:(id)a3
{
  v60 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 shortDescription];
    *buf = 138543618;
    v54 = v8;
    v55 = 2112;
    v56 = v9;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling retrieve async results message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [v4 dataForKey:*MEMORY[0x277CD0510]];
  if (v10)
  {
    v11 = [(HMDHome *)v6 reportingSessionManager];
    v12 = [v11 consumeResponseMessagePayloadsForSessionWithReportContextRequestInfo:v10];

    if ([v12 count])
    {
      v45 = v10;
      v51 = 0u;
      v52 = 0u;
      v49 = 0u;
      v50 = 0u;
      v13 = v12;
      v48 = [v13 countByEnumeratingWithState:&v49 objects:v59 count:16];
      if (v48)
      {
        v47 = *v50;
        obj = v13;
        do
        {
          for (i = 0; i != v48; ++i)
          {
            if (*v50 != v47)
            {
              objc_enumerationMutation(obj);
            }

            v15 = *(*(&v49 + 1) + 8 * i);
            v16 = objc_autoreleasePoolPush();
            v17 = [v15 mutableCopy];
            [v17 setObject:MEMORY[0x277CBEC28] forKeyedSubscript:@"kMultiPartResponseKey"];
            v18 = objc_autoreleasePoolPush();
            v19 = v6;
            v20 = v6;
            v21 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
            {
              v22 = HMFGetLogIdentifier();
              *buf = 138543874;
              v54 = v22;
              v55 = 2112;
              v56 = v15;
              v57 = 2112;
              v58 = v17;
              _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Overriding payload in last cached message from %@ to %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v18);
            if ([v4 qualityOfService] < 17)
            {
              v23 = 17;
            }

            else
            {
              v23 = [v4 qualityOfService];
            }

            v24 = objc_alloc(MEMORY[0x277D0F820]);
            v25 = [(HMDHome *)v20 uuid];
            v26 = [v24 initWithTarget:v25];

            v27 = objc_alloc(MEMORY[0x277D0F848]);
            v28 = [v17 copy];
            v29 = [v27 initWithName:@"kMultipleCharacteristicValuesUpdatedNotificationKey" qualityOfService:v23 destination:v26 payload:v28];

            v30 = [v4 transport];
            [v29 setTransport:v30];
            v31 = [v4 identifier];
            [v29 setIdentifier:v31];

            v32 = [(HMDHome *)v20 msgDispatcher];
            [v32 sendMessage:v29];

            objc_autoreleasePoolPop(v16);
            v6 = v19;
          }

          v13 = obj;
          v48 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
        }

        while (v48);
      }

      [v4 respondWithSuccess];
      v10 = v45;
    }

    else
    {
      v38 = v12;
      v39 = objc_autoreleasePoolPush();
      v40 = v6;
      v41 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT))
      {
        v42 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v42;
        _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_DEFAULT, "%{public}@Did not find any response message payloads to retrieve", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v39);
      v43 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v43];

      v13 = v38;
    }
  }

  else
  {
    v33 = objc_autoreleasePoolPush();
    v34 = v6;
    v35 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
    {
      v36 = HMFGetLogIdentifier();
      v37 = [v4 messagePayload];
      *buf = 138543618;
      v54 = v36;
      v55 = 2112;
      v56 = v37;
      _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Could not find request info in message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v33);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v13];
  }

  v44 = *MEMORY[0x277D85DE8];
}

- (void)endReportingSessionForMessage:(id)a3
{
  v10 = a3;
  v4 = reportContextFromMessage(v10);
  if (v4)
  {
    v5 = v10;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (!v7)
    {
      v8 = [(HMDHome *)self reportingSessionManager];
      v9 = [v5 identifier];
      [v8 endSessionWithUUID:v9];
    }
  }
}

- (void)handleReportingSessionResponseMessage:(id)a3
{
  v4 = a3;
  v7 = [(HMDHome *)self reportingSessionManager];
  v5 = [v4 messagePayload];
  v6 = [v4 identifier];

  [v7 addResponseMessagePayload:v5 toSessionWithUUID:v6];
}

- (void)startReportingSessionForMessage:(id)a3
{
  v10 = a3;
  v4 = reportContextFromMessage(v10);
  if (v4)
  {
    v5 = [v10 transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      v8 = [(HMDHome *)self reportingSessionManager];
      v9 = [v10 identifier];
      [v8 startSessionWithUUID:v9 reportContext:v4 xpcClientConnection:v7];
    }
  }
}

- (BOOL)hasCharacteristicNotificationRegistrations
{
  v2 = [(HMDHome *)self notificationRegistrations];
  v3 = [v2 count] != 0;

  return v3;
}

- (void)_applyNotificationDeregistrations
{
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationRegistrations minusSet:self->_notificationDeregistrations];
  [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories minusSet:self->_notificationDeregistrations];
  [(NSMutableSet *)self->_notificationDeregistrations removeAllObjects];

  os_unfair_recursive_lock_unlock();
}

- (void)removeNotificationDeregistrationForClientIdentifier:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationDeregistrations removeObject:v4];
  os_unfair_recursive_lock_unlock();
}

- (void)addNotificationDeregistrationForClientIdentifier:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationDeregistrations addObject:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSSet)notificationDeregistrations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationDeregistrations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (BOOL)isClientIdentifierSubscribedToAppleMediaAccessoryState:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories containsObject:v4];
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (void)addNotificationRegistrationForClientIdentifier:(id)a3 includesAppleMediaAccessories:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationRegistrations addObject:v6];
  if (v4)
  {
    [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories addObject:v6];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)notificationRegistrationsForAppleMediaAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSSet)notificationRegistrations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationRegistrations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)handleSwitchFromResidentSelectionToREV2:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v18 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received request to switch from Resident Selection to REV2", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [(HMDHome *)v6 backingStore];
  v10 = [v9 context];

  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __51__HMDHome_handleSwitchFromResidentSelectionToREV2___block_invoke;
  v14[3] = &unk_27868A010;
  v14[4] = v6;
  v15 = v10;
  v16 = v4;
  v11 = v4;
  v12 = v10;
  [v12 performBlock:v14];

  v13 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome_handleSwitchFromResidentSelectionToREV2___block_invoke(uint64_t a1)
{
  v27 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  v4 = [MEMORY[0x277CCABB0] numberWithLong:2];
  [v3 setResidentSelectionVersion:v4];

  v5 = [v3 residentSelections];
  v23[0] = MEMORY[0x277D85DD0];
  v23[1] = 3221225472;
  v23[2] = __51__HMDHome_handleSwitchFromResidentSelectionToREV2___block_invoke_2;
  v23[3] = &unk_278670920;
  v6 = *(a1 + 40);
  v23[4] = *(a1 + 32);
  v24 = v6;
  [v5 hmf_enumerateWithAutoreleasePoolUsingBlock:v23];

  v7 = *(a1 + 40);
  v22 = 0;
  v8 = [v7 save:&v22];
  v9 = v22;
  v10 = v9;
  if (v8)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Finished removing Resident Selection models.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    [*(a1 + 48) respondWithSuccess];
  }

  else if (v9)
  {
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 32);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove Resident Selection models.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
    v19 = *(a1 + 48);
    v20 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
    [v19 respondWithError:v20];
  }

  v21 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome_handleSwitchFromResidentSelectionToREV2___block_invoke_2(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v12 = 138543618;
    v13 = v7;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Deleting: %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = v3;
  if ([v8 conformsToProtocol:&unk_283E89AA8])
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  [*(a1 + 40) deleteObject:v10];
  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleSetPreferredPrimaryMessage:(id)a3
{
  v34 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 messagePayload];
    *buf = 138543618;
    v31 = v8;
    v32 = 2112;
    v33 = v9;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@SetPreferredPrimary - Received set preferred primary message with payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [v4 messagePayload];
  v11 = [v10 hmf_stringForKey:*MEMORY[0x277CD05B0]];

  v12 = [v4 messagePayload];
  v13 = [v12 hmf_BOOLForKey:*MEMORY[0x277CD05A8]];

  v14 = [v4 messagePayload];
  v15 = [v14 hmf_BOOLForKey:*MEMORY[0x277CD05B8]];

  v16 = [(HMDHome *)v6 destinationForEnabledResidents];
  if (!v16)
  {
    v23 = objc_autoreleasePoolPush();
    v24 = v6;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543362;
      v31 = v26;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_DEFAULT, "%{public}@SetPreferredPrimary - Not propagating message, no known enabled residents in home", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v23);
    if (v11)
    {
      goto LABEL_5;
    }

LABEL_10:
    clearPrimaryPreference(0);
    goto LABEL_11;
  }

  v29[0] = v11;
  v17 = [MEMORY[0x277CCABB0] numberWithBool:{v13, @"preferred.primary.identifier", @"preferred.primary.one.time"}];
  v29[1] = v17;
  v28[2] = @"preferred.primary.trigger.election";
  v18 = [MEMORY[0x277CCABB0] numberWithBool:v15];
  v29[2] = v18;
  v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:3];

  v20 = [[HMDRemoteMessage alloc] initWithName:@"mesh.setPreferredPrimary.debug" qualityOfService:9 destination:v16 payload:v19 type:3 timeout:1 secure:0.0];
  v21 = [(HMDHome *)v6 msgDispatcher];
  [v21 sendMessage:v20];

  if (!v11)
  {
    goto LABEL_10;
  }

LABEL_5:
  setPrimaryPreference(v11, v13);
  if (v15)
  {
    v22 = [(HMDHome *)v6 residentDeviceManager];
    [v22 electResidentDevice:7];
  }

LABEL_11:
  [v4 respondWithSuccess];

  v27 = *MEMORY[0x277D85DE8];
}

- (id)destinationForEnabledResidents
{
  v3 = [(HMDHome *)self enabledResidents];
  v4 = [v3 na_map:&__block_literal_global_2392];

  if ([v4 count])
  {
    v5 = [HMDMultipleRemoteDeviceDestination alloc];
    v6 = [(HMDHome *)self uuid];
    v7 = [(HMDMultipleRemoteDeviceDestination *)v5 initWithTarget:v6 devices:v4];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

id __41__HMDHome_destinationForEnabledResidents__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 device];
  v4 = [v3 isCurrentDevice];

  if (v4)
  {
    v5 = 0;
  }

  else
  {
    v5 = [v2 device];
  }

  return v5;
}

- (void)_handleRollACWGIssuerKey:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [v5 UUID];
    *buf = 138543618;
    v24 = v9;
    v25 = 2112;
    v26 = v10;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Homeutil command received to ACWG issuer key in this home", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = +[HMDACWGKeyManager shared];
  v12 = [(HMDHome *)v7 uuid];
  v13 = [(HMDHome *)v7 currentUser];
  v14 = [v13 uuid];
  v15 = [(HMDHome *)v7 backingStore];
  v16 = [v15 context];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __36__HMDHome__handleRollACWGIssuerKey___block_invoke;
  v20[3] = &unk_2786708F8;
  v20[4] = v7;
  v21 = v5;
  v22 = v4;
  v17 = v4;
  v18 = v5;
  [v11 getOrCreateIssuerKeyAndSaveIfNeededWithHome:v12 user:v14 context:v16 shouldRoll:1 completionHandler:v20];

  v19 = *MEMORY[0x277D85DE8];
}

void __36__HMDHome__handleRollACWGIssuerKey___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [*(a1 + 40) UUID];
    v14 = 138544130;
    v15 = v10;
    v16 = 2112;
    v17 = v11;
    v18 = 2112;
    v19 = v5;
    v20 = 2112;
    v21 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Issuer key %@ created with error %@", &v14, 0x2Au);
  }

  objc_autoreleasePoolPop(v7);
  v12 = *(a1 + 48);
  if (v6)
  {
    [v12 respondWithError:v6];
  }

  else
  {
    [v12 respondWithSuccess];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleRollReaderKey:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [v5 UUID];
    *buf = 138543618;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Homeutil command received to roll reader key in this home", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = [(HMDHome *)v7 nfcReaderKeyManager];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __32__HMDHome__handleRollReaderKey___block_invoke;
  v14[3] = &unk_27868A250;
  v15 = v4;
  v12 = v4;
  [v11 rollReaderKeyWithFlow:v5 withCompletion:v14];

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __32__HMDHome__handleRollReaderKey___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithSuccess];
  }
}

- (void)_handleFetchOrCreateReaderKey:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [v5 UUID];
    *buf = 138543618;
    v27 = v9;
    v28 = 2112;
    v29 = v10;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Homeutil command received to FetchOrCreateReaderKey", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = [(HMDHome *)v7 nfcReaderKeyManager];
  v12 = [v11 fetchOrCreateReaderKeyForPairingWithFlow:v5];
  v23[0] = MEMORY[0x277D85DD0];
  v23[1] = 3221225472;
  v23[2] = __41__HMDHome__handleFetchOrCreateReaderKey___block_invoke;
  v23[3] = &unk_2786708D0;
  v23[4] = v7;
  v13 = v5;
  v24 = v13;
  v14 = v4;
  v25 = v14;
  v15 = [v12 addSuccessBlock:v23];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __41__HMDHome__handleFetchOrCreateReaderKey___block_invoke_2389;
  v20[3] = &unk_278688D58;
  v20[4] = v7;
  v21 = v13;
  v22 = v14;
  v16 = v14;
  v17 = v13;
  v18 = [v15 addFailureBlock:v20];

  v19 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleFetchOrCreateReaderKey___block_invoke(id *a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = a1[4];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [a1[5] UUID];
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Fetched reader key: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  [a1[6] respondWithSuccess];

  v9 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleFetchOrCreateReaderKey___block_invoke_2389(id *a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = a1[4];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [a1[5] UUID];
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to fetch reader key with error: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  [a1[6] respondWithError:v3];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_handleTestUpgradeToROAR:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 numberForKey:*MEMORY[0x277CD0608]];
  v6 = v5;
  if (v5)
  {
    if ([v5 BOOLValue])
    {
      v7 = [HMDHomeUpgradedToROAR defaultModelForHome:self];
    }

    else
    {
      [(HMDHome *)self setIsUpdatedToHH2:0];
      v13 = [HMDHomeUpgradedToROAR alloc];
      v14 = [HMDHomeUpgradedToROAR modelIDForHome:self];
      v15 = [(HMDHome *)self uuid];
      v7 = [(HMDBackingStoreModelObject *)v13 initWithObjectChangeType:3 uuid:v14 parentUUID:v15];

      [(HMDHome *)self saveWithReason:@"Downgrading To HH1" postSyncNotification:0 objectChange:1];
    }

    v16 = [(HMDHome *)self backingStore];
    v17 = [v4 name];
    v18 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v19 = [v16 transaction:v17 options:v18];

    [v19 add:v7 withMessage:v4];
    [v19 run];
    [v4 respondWithSuccess];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v11;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Update flag is needed.", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
    [v4 respondWithError:v12];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (HMDHomeNFCReaderKey)nfcReaderKey
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_nfcReaderKey;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNfcReaderKey:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  nfcReaderKey = self->_nfcReaderKey;
  self->_nfcReaderKey = v4;

  os_unfair_recursive_lock_unlock();
}

- (void)configureNaturalLightingForDemoMode
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Setting up natural lighting for demo mode", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  [(HMDHome *)v4 configureNaturalLightingWithDemoModeEnabled:1];
  v7 = *MEMORY[0x277D85DE8];
}

- (HMDNaturalLightingContext)naturalLightingContext
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_naturalLightingContext;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNaturalLightingContext:(id)a3
{
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if ([(HMDNaturalLightingContext *)self->_naturalLightingContext isEqual:v6])
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    v4 = [v6 copy];
    naturalLightingContext = self->_naturalLightingContext;
    self->_naturalLightingContext = v4;

    os_unfair_recursive_lock_unlock();
    logAndPostNotification(@"HMDHomeNaturalLightingContextUpdatedNotification", self, 0);
  }
}

- (NSArray)mediaSystems
{
  v2 = [(HMDHome *)self mediaSystemController];
  v3 = [v2 mediaSystems];

  return v3;
}

- (BOOL)isResidentReachable:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (-[HMDHome isCurrentDevicePrimaryResident](self, "isCurrentDevicePrimaryResident") || (-[HMDHome primaryResident](self, "primaryResident"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 isEqual:v4], v5, v6))
  {
    v7 = [v4 isReachable];
  }

  else
  {
    v25 = 0u;
    v26 = 0u;
    v23 = 0u;
    v24 = 0u;
    v10 = [(HMDHome *)self appleMediaAccessories];
    v11 = [v10 countByEnumeratingWithState:&v23 objects:v31 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v24;
      while (2)
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v24 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v23 + 1) + 8 * i);
          v16 = [v15 device];
          v17 = [v4 device];
          v18 = [v16 isEqual:v17];

          if (v18)
          {
            if ([v15 isReachable])
            {
              v7 = 1;
            }

            else
            {
              v7 = [v15 isDeviceReachable];
            }

            goto LABEL_4;
          }
        }

        v12 = [v10 countByEnumeratingWithState:&v23 objects:v31 count:16];
        if (v12)
        {
          continue;
        }

        break;
      }
    }

    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v22;
      v29 = 2112;
      v30 = v4;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_DEBUG, "%{public}@Could not find matching accessory for resident %@ so assuming unreachable", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    v7 = 0;
  }

LABEL_4:

  v8 = *MEMORY[0x277D85DE8];
  return v7;
}

- (BOOL)isCompanionReachable
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 companionReachable];

  return v3;
}

- (HMDDevice)companionDevice
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 companionDevice];

  return v3;
}

- (void)_wol_processChangedCharacteristicResponses:(id)a3
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v4 = [v3 countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v20;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v20 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v8 = *(*(&v19 + 1) + 8 * i);
        v9 = [v8 request];
        v10 = [v9 characteristic];

        v11 = [v10 accessory];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = v11;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if ([v13 canWakeUpViaWoL])
        {
          v14 = [v8 request];
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();

          v16 = (v14 == 0) | ~isKindOfClass;
          v17 = [v8 error];
          [v13 _wol_processReadWriteResponseForCharacteristic:v10 isRead:v16 & 1 response:v8 error:v17];
        }
      }

      v5 = [v3 countByEnumeratingWithState:&v19 objects:v23 count:16];
    }

    while (v5);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (BOOL)attemptToUpdateThreadNetworkID:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v5 = a3;
  os_unfair_recursive_lock_lock_with_options();
  unfilteredThreadNetworkID = self->_unfilteredThreadNetworkID;
  v7 = HMFEqualObjects();
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  if (v7)
  {
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v11 = HMFGetLogIdentifier();
      v17 = 138543618;
      v18 = v11;
      v19 = 2112;
      v20 = v5;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_DEBUG, "%{public}@unfilteredThreadNetworkID did not change (%@)", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  else
  {
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = self->_unfilteredThreadNetworkID;
      v17 = 138543874;
      v18 = v13;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = v5;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@unfilteredThreadNetworkID changed: %@ -> %@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    objc_storeStrong(&self->_unfilteredThreadNetworkID, a3);
  }

  os_unfair_recursive_lock_unlock();

  v15 = *MEMORY[0x277D85DE8];
  return v7 ^ 1;
}

- (NSString)unfilteredThreadNetworkID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_unfilteredThreadNetworkID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setThreadNetworkSequenceNumber:(unint64_t)a3
{
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  self->_threadNetworkSequenceNumber = a3;
}

- (unint64_t)threadNetworkSequenceNumber
{
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  return self->_threadNetworkSequenceNumber;
}

- (void)_handleSetHomeManagerAppData:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  [v5 setAppDataWithMessage:v4];
}

- (void)_handleRemoteUserClientCloudShareRepairRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  [v5 handleRemoteUserClientCloudShareRepairRequest:v4];
}

- (void)_handleRemoteUserClientCloudShareRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  [v5 handleRemoteUserClientCloudShareRequest:v4];
}

- (void)handleXPCConnectionInvalidated:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_handleXPCConnectionInvalidated___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __42__HMDHome_handleXPCConnectionInvalidated___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"connection"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (v5)
  {
    [*(a1 + 40) _removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:v5];
    v6 = [*(a1 + 40) deviceHomeKitSetupSession];
    v7 = [v6 clientConnection];
    v8 = HMFEqualObjects();

    if (v8)
    {
      v9 = objc_autoreleasePoolPush();
      v10 = *(a1 + 40);
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        v13 = [v5 shortDescription];
        v20 = 138543618;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Client connection %@ is invalidated, removing device HomeKit setup session", &v20, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      [*(a1 + 40) setDeviceHomeKitSetupSession:0];
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    v15 = *(a1 + 40);
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = *(a1 + 32);
      v20 = 138543618;
      v21 = v17;
      v22 = 2112;
      v23 = v18;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Received connection invalidated notification, but no connection object was found: %@", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (id)updatePersonManagerSettings:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self personDataManager];
  v6 = [v5 updateSettingsModelWithSettings:v4];

  return v6;
}

- (HMDHomePersonManager)personManager
{
  v2 = [(HMDHome *)self personDataManager];
  v3 = [v2 personManager];

  return v3;
}

- (void)setPersonManagerSettings:(id)a3
{
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if (([(HMHomePersonManagerSettings *)self->_personManagerSettings isEqual:v6]& 1) != 0)
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    v4 = [v6 copy];
    personManagerSettings = self->_personManagerSettings;
    self->_personManagerSettings = v4;

    os_unfair_recursive_lock_unlock();
    logAndPostNotification(@"HMDHomePersonManagerSettingsDidChangeNotification", self, 0);
  }
}

- (HMHomePersonManagerSettings)personManagerSettings
{
  os_unfair_recursive_lock_lock_with_options();
  personManagerSettings = self->_personManagerSettings;
  if (personManagerSettings)
  {
    v4 = personManagerSettings;
  }

  else
  {
    v4 = objc_alloc_init(MEMORY[0x277CD1AB0]);
  }

  v5 = v4;
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (void)_removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:(id)a3
{
  v7 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices containsObject:v7])
  {
    [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices removeObject:v7];
    v4 = [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices count];
    os_unfair_recursive_lock_unlock();
    if (!v4)
    {
      v5 = +[HMDMainDriver driver];
      v6 = [v5 symptomManager];
      [v6 stopDiscoveringSymptomsRequiringNearbyInfo];
    }
  }

  else
  {
    os_unfair_recursive_lock_unlock();
  }
}

- (void)_handleStopDiscoveringSymptomsForNearbyDevicesMessage:(id)a3
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self _ensureDevicesSymptomDiscoveryMessageCanBeHandled:v4])
  {
    v5 = [v4 transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      [(HMDHome *)self _removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:v7];
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        v13 = 138543362;
        v14 = v11;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Asked to stop discovering symptoms, but no connection proxy was available", &v13, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
    }

    [v4 respondWithPayload:0];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_handleStartDiscoveringSymptomsForNearbyDevicesMessage:(id)a3
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self _ensureDevicesSymptomDiscoveryMessageCanBeHandled:v4])
  {
    v5 = [v4 transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      os_unfair_recursive_lock_lock_with_options();
      if ([(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices containsObject:v7])
      {
        os_unfair_recursive_lock_unlock();
      }

      else
      {
        [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices addObject:v7];
        v12 = [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices count];
        os_unfair_recursive_lock_unlock();
        if (v12 == 1)
        {
          v13 = +[HMDMainDriver driver];
          v14 = [v13 symptomManager];
          [v14 startDiscoveringSymptomsRequiringNearbyInfo];
        }
      }
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        v16 = 138543362;
        v17 = v11;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Asked to start discovering symptoms, but no connection proxy was available", &v16, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
    }

    [v4 respondWithPayload:0];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (BOOL)_ensureDevicesSymptomDiscoveryMessageCanBeHandled:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSPIAccess])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      LOBYTE(v5) = 1;
      goto LABEL_13;
    }

    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      v18 = 138543362;
      v19 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Only owners may start discovering symptoms for nearby devices", &v18, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v5 = [v4 responseHandler];

    if (v5)
    {
      v10 = 17;
      goto LABEL_12;
    }
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      v18 = 138543362;
      v19 = v9;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Only entitled clients may stop discovering symptoms for nearby devices", &v18, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
    v5 = [v4 responseHandler];

    if (v5)
    {
      v10 = 10;
LABEL_12:
      v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:v10];
      v15 = [v4 responseHandler];
      (v15)[2](v15, v5, 0);

      LOBYTE(v5) = 0;
    }
  }

LABEL_13:

  v16 = *MEMORY[0x277D85DE8];
  return v5;
}

- (void)mediaSystemController:(id)a3 didRemoveMediaSystem:(id)a4
{
  v5 = a4;
  v7 = [(HMDHome *)self homeManager];
  v6 = [v7 lastEventStoreController];
  [v6 didRemoveMediaSystem:v5];
}

- (void)mediaSystemController:(id)a3 removeAccessories:(id)a4 fromAssistantAccessControl:(id)a5
{
  v11 = a4;
  v7 = a5;
  v8 = [(HMDHome *)self currentUser];
  v9 = [v8 isEqual:v7];

  if (v9)
  {
    v10 = [(HMDHome *)self currentUser];
    [v10 removeAccessoriesFromAssistantAccessControlList:v11];
  }
}

- (id)mediaSystemController:(id)a3 accessoryForUUID:(id)a4
{
  v5 = a4;
  v6 = [(HMDHome *)self accessories];
  v7 = [v6 hmf_firstObjectWithUUID:v5];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  return v8;
}

- (id)destinationForMediaSystem:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaGroupsAggregateConsumer];
  v6 = [v4 uuid];

  v7 = [v5 destinationWithParentIdentifier:v6];

  return v7;
}

- (void)userAssistantAccessControlDidUpdate:(id)a3 accessories:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self currentUser];
  v9 = [v8 isEqual:v6];

  if (v9)
  {
    v10 = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __59__HMDHome_userAssistantAccessControlDidUpdate_accessories___block_invoke;
    block[3] = &unk_27868A010;
    block[4] = self;
    v12 = v6;
    v13 = v7;
    dispatch_async(v10, block);
  }
}

void __59__HMDHome_userAssistantAccessControlDidUpdate_accessories___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) mediaSystemController];
  [v2 _userAssistantAccessControlDidUpdate:*(a1 + 40) accessories:*(a1 + 48)];
}

- (NSArray)cameraAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_2383];

  return v3;
}

id __28__HMDHome_cameraAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 cameraProfiles];
  v6 = [v5 count];

  if (v6)
  {
    v7 = v4;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (NSArray)hapAccessoriesForLegacyDataBlobEncoding
{
  v2 = [(HMDHome *)self hapAccessories];
  v3 = [v2 na_filter:&__block_literal_global_2381];

  return v3;
}

- (NSArray)nativeMatterAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_2379];

  return v3;
}

id __34__HMDHome_nativeMatterAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 conformsToProtocol:&unk_283F010C8])
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = 0;
  if ([v4 supportsCHIP])
  {
    v6 = v4;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = v6;
    }

    else
    {
      v7 = 0;
    }

    v5 = v7;
  }

  return v5;
}

- (id)matterAccessoryWithIdentifier:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithIdentifier:a3];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (NSArray)matterAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_2224];

  return v3;
}

id __28__HMDHome_matterAccessories__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 conformsToProtocol:&unk_283F010C8])
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 supportsCHIP];
  if ((v6 & 1) != 0 || ([v5 matterNodeID], v2 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v2, "unsignedIntValue")))
  {
    v7 = v5;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = v7;
    }

    else
    {
      v8 = 0;
    }

    v9 = v8;

    if (v6)
    {
      goto LABEL_13;
    }
  }

  else
  {
    v9 = 0;
  }

LABEL_13:

  return v9;
}

- (NSArray)hapAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_2221];

  return v3;
}

void *__25__HMDHome_hapAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)_handleMediaPropertiesWrite:(id)a3
{
  v4 = a3;
  v5 = [v4 source];
  v6 = [v4 dictionaryForKey:@"kMediaPropertiesListKey"];
  objc_initWeak(&location, self);
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __39__HMDHome__handleMediaPropertiesWrite___block_invoke;
  v8[3] = &unk_27867A4A0;
  objc_copyWeak(&v10, &location);
  v7 = v4;
  v9 = v7;
  [(HMDHome *)self _handleWriteMediaProperties:v6 source:v5 requestMessage:v7 completionHandler:v8];

  objc_destroyWeak(&v10);
  objc_destroyWeak(&location);
}

void __39__HMDHome__handleMediaPropertiesWrite___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Responding to media write with %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [*(a1 + 32) responseHandler];
    (v9)[2](v9, 0, v3);
  }

  else
  {
    v9 = [*(a1 + 32) responseHandler];
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    (v9)[2](v9, v10, 0);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleWriteMediaProperties:(id)a3 source:(unint64_t)a4 requestMessage:(id)a5 completionHandler:(id)a6
{
  v63 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v33 = a5;
  v34 = a6;
  v41 = v8;
  v40 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v8, "count")}];
  group = dispatch_group_create();
  objc_initWeak(&location, self);
  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  v9 = [v8 allKeys];
  v10 = [v9 countByEnumeratingWithState:&v51 objects:v62 count:16];
  if (v10)
  {
    v39 = *v52;
    obj = v9;
    do
    {
      v42 = v10;
      for (i = 0; i != v42; ++i)
      {
        if (*v52 != v39)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v51 + 1) + 8 * i);
        v13 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:{v12, v33}];
        v14 = [(HMDHome *)self mediaProfileWithUUID:v13];
        v15 = [v41 hmf_dictionaryForKey:v12];
        v16 = [HMDMediaPropertyWriteRequest deserializeWriteRequests:v15 mediaProfile:v14];
        if ([v16 count])
        {
          v17 = [v14 mediaSession];
          if (v17)
          {
            dispatch_group_enter(group);
            v47[0] = MEMORY[0x277D85DD0];
            v47[1] = 3221225472;
            v47[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke;
            v47[3] = &unk_278684610;
            objc_copyWeak(&v50, &location);
            v48 = v40;
            v49 = group;
            [v17 writeProperties:v16 completion:v47];

            objc_destroyWeak(&v50);
          }

          else
          {
            v20 = objc_autoreleasePoolPush();
            v21 = self;
            v22 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
            {
              log = v22;
              v36 = v20;
              v23 = HMFGetLogIdentifier();
              v24 = [v14 accessory];
              v25 = [v24 name];
              *buf = 138543874;
              v57 = v23;
              v58 = 2112;
              v59 = v25;
              v60 = 2112;
              v61 = v12;
              _os_log_impl(&dword_229538000, log, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ not reachable for writing", buf, 0x20u);

              v20 = v36;
              v22 = log;
            }

            objc_autoreleasePoolPop(v20);
            v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
            v27 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v16 error:v26];
            v28 = [HMDMediaPropertyResponse serializeResponses:v27];
            [v40 addEntriesFromDictionary:v28];

            v17 = 0;
          }
        }

        else
        {
          v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v18 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v16 error:v17];
          v19 = [HMDMediaPropertyResponse serializeResponses:v18];
          [v40 addEntriesFromDictionary:v19];
        }
      }

      v9 = obj;
      v10 = [obj countByEnumeratingWithState:&v51 objects:v62 count:16];
    }

    while (v10);
  }

  v29 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_3;
  block[3] = &unk_27868A7A0;
  v45 = v40;
  v46 = v34;
  v30 = v40;
  v31 = v34;
  dispatch_group_notify(group, v29, block);

  objc_destroyWeak(&location);
  v32 = *MEMORY[0x277D85DE8];
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke(id *a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_2;
    block[3] = &unk_27868A010;
    v8 = a1[4];
    v9 = v3;
    v10 = a1[5];
    dispatch_async(v6, block);
  }
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_3(uint64_t a1)
{
  v1 = *(a1 + 40);
  if (v1)
  {
    v2 = [*(a1 + 32) copy];
    (*(v1 + 16))(v1, v2);
  }
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_2(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

- (void)redispatchMediaWriteRequests:(id)a3 viaDevice:(id)a4 completion:(id)a5
{
  v29[1] = *MEMORY[0x277D85DE8];
  v8 = a3;
  v21 = a4;
  v9 = a5;
  v10 = [HMDMediaPropertyWriteRequest serializeWriteRequests:v8];
  if ([v10 count])
  {
    v11 = [(HMDHome *)self uuid];
    v12 = [v11 UUIDString];

    v13 = *MEMORY[0x277CD0640];
    v27[0] = @"kMediaPropertiesListKey";
    v27[1] = v13;
    v28[0] = v10;
    v28[1] = v12;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];
    v15 = MEMORY[0x277D0F848];
    v16 = [(HMDHome *)self messageDestination];
    v17 = [v15 messageWithName:@"kMediaPropertiesWriteRequestKey" qualityOfService:25 destination:v16 payload:v14];

    objc_initWeak(&location, self);
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __61__HMDHome_redispatchMediaWriteRequests_viaDevice_completion___block_invoke;
    v22[3] = &unk_278685EC0;
    objc_copyWeak(&v25, &location);
    v24 = v9;
    v23 = v8;
    [v17 setResponseHandler:v22];
    v18 = [(HMDHome *)self uuid];
    v19 = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v17 target:v18 responseQueue:v19 viaDevice:v21];

    objc_destroyWeak(&v25);
    objc_destroyWeak(&location);
LABEL_5:

    goto LABEL_6;
  }

  if (v9)
  {
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v14 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v8 error:v12];
    v29[0] = v14;
    v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v29 count:1];
    (*(v9 + 2))(v9, v17);
    goto LABEL_5;
  }

LABEL_6:

  v20 = *MEMORY[0x277D85DE8];
}

void __61__HMDHome_redispatchMediaWriteRequests_viaDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v13[1] = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = *(a1 + 40);
    if (v5)
    {
      if (v8)
      {
        v9 = [HMDMediaPropertyResponse propertyResponsesFromRequests:*(a1 + 32) error:v5];
        v10 = *(a1 + 40);
        v13[0] = v9;
        v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
        (*(v10 + 16))(v10, v11);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v6 requests:*(a1 + 32) home:WeakRetained];
      (*(*(a1 + 40) + 16))();
      goto LABEL_7;
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_handleMediaPropertiesRead:(id)a3
{
  location[3] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dictionaryForKey:@"kMediaPropertiesListKey"];
  if ([v5 count])
  {
    v6 = [v4 source];
    objc_initWeak(location, self);
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __38__HMDHome__handleMediaPropertiesRead___block_invoke;
    v13[3] = &unk_27867A4A0;
    objc_copyWeak(&v15, location);
    v14 = v4;
    [(HMDHome *)self _handleReadMediaProperties:v5 source:v6 message:v14 completionHandler:v13];

    objc_destroyWeak(&v15);
    objc_destroyWeak(location);
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@None of the properties in media properties read are valid", location, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v11];
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__handleMediaPropertiesRead___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Responding to media read with %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 32) respondWithPayload:v3];
  }

  else
  {
    v9 = *(a1 + 32);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v9 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleReadMediaProperties:(id)a3 source:(unint64_t)a4 message:(id)a5 completionHandler:(id)a6
{
  v123 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v69 = a5;
  v70 = a6;
  group = dispatch_group_create();
  v76 = v8;
  v73 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v8, "count")}];
  objc_initWeak(&location, self);
  v107 = 0u;
  v108 = 0u;
  v105 = 0u;
  v106 = 0u;
  obj = [v8 allKeys];
  v79 = [obj countByEnumeratingWithState:&v105 objects:v114 count:16];
  if (v79)
  {
    v78 = *v106;
    v93 = *MEMORY[0x277CD0910];
    v92 = *MEMORY[0x277CD0938];
    v91 = *MEMORY[0x277CD0990];
    v90 = *MEMORY[0x277CD0960];
    v87 = *MEMORY[0x277CD09B0];
    v84 = *MEMORY[0x277CD0920];
    v80 = *MEMORY[0x277CD09A0];
    do
    {
      v88 = 0;
      do
      {
        if (*v106 != v78)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v105 + 1) + 8 * v88);
        v86 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v9];
        v89 = [(HMDHome *)self mediaProfileWithUUID:?];
        if (v89)
        {
          v82 = [v76 hmf_arrayForKey:v9];
          v10 = [HMDMediaPropertyRequest deserializeReadRequests:"deserializeReadRequests:mediaProfile:" mediaProfile:?];
          if (![v10 count])
          {
            goto LABEL_53;
          }

          v83 = [v89 mediaSession];
          v11 = [v89 accessory];
          v81 = v10;
          v77 = v11;
          if (v11)
          {
            v12 = [v11 identifier];
            v13 = [(HMDHome *)self mediaSessionStateWithIdentifier:v12];

            if (!v83 && v13)
            {
              if ([(HMDHome *)self isCurrentDevicePrimaryResident])
              {
                v14 = objc_autoreleasePoolPush();
                v72 = self;
                v15 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
                {
                  v16 = HMFGetLogIdentifier();
                  v17 = [v89 accessory];
                  v18 = [v17 name];
                  *buf = 138543874;
                  v116 = v16;
                  v117 = 2112;
                  v118 = v18;
                  v119 = 2112;
                  v120 = v9;
                  _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ has no session, returning local state", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v14);
                v13 = v13;
                v19 = v81;
                v71 = v19;
                if (self)
                {
                  v20 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v19, "count")}];
                  v21 = [MEMORY[0x277CBEAA8] now];
                  v112 = 0u;
                  v113 = 0u;
                  v110 = 0u;
                  v111 = 0u;
                  v22 = v71;
                  v23 = [v22 countByEnumeratingWithState:&v110 objects:buf count:16];
                  if (!v23)
                  {
                    goto LABEL_42;
                  }

                  v24 = *v111;
                  while (1)
                  {
                    for (i = 0; i != v23; ++i)
                    {
                      if (*v111 != v24)
                      {
                        objc_enumerationMutation(v22);
                      }

                      v26 = *(*(&v110 + 1) + 8 * i);
                      v27 = [v26 property];
                      v28 = [v27 isEqualToString:v93];

                      if (v28)
                      {
                        v29 = [v13 sessionIdentifier];
                        v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                        goto LABEL_38;
                      }

                      v31 = [v26 property];
                      v32 = [v31 isEqualToString:v92];

                      if (v32)
                      {
                        v29 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "playbackState")}];
                        v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                        goto LABEL_38;
                      }

                      v33 = [v26 property];
                      v34 = [v33 isEqualToString:v91];

                      if (v34)
                      {
                        v29 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "shuffleState")}];
                        v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                        goto LABEL_38;
                      }

                      v35 = [v26 property];
                      v36 = [v35 isEqualToString:v90];

                      if (v36)
                      {
                        v29 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "repeatState")}];
                        v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                        goto LABEL_38;
                      }

                      v37 = [v26 property];
                      if ([v37 isEqualToString:v87])
                      {
                        v38 = [v13 volume];
                        v39 = v38 == 0;

                        if (!v39)
                        {
                          v29 = [v13 volume];
                          v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                          goto LABEL_38;
                        }
                      }

                      else
                      {
                      }

                      v40 = [v26 property];
                      if ([v40 isEqualToString:v84])
                      {
                        v41 = [v13 mediaUniqueIdentifier];
                        v42 = v41 == 0;

                        if (!v42)
                        {
                          v29 = [v13 mediaUniqueIdentifier];
                          v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                          goto LABEL_38;
                        }
                      }

                      else
                      {
                      }

                      v43 = [v26 property];
                      v44 = [v43 isEqualToString:v80];

                      if (!v44)
                      {
                        continue;
                      }

                      v29 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v13, "sleepWakeState")}];
                      v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
LABEL_38:
                      v45 = v30;

                      if (v45)
                      {
                        [v20 addObject:v45];
                      }
                    }

                    v23 = [v22 countByEnumeratingWithState:&v110 objects:buf count:16];
                    if (!v23)
                    {
LABEL_42:

                      v46 = [v20 copy];
                      goto LABEL_43;
                    }
                  }
                }

                v46 = 0;
LABEL_43:

                dispatch_group_enter(group);
                v47 = [(HMDHome *)v72 workQueue];
                block[0] = MEMORY[0x277D85DD0];
                block[1] = 3221225472;
                block[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke;
                block[3] = &unk_27868A010;
                v102 = v73;
                v103 = v46;
                v104 = group;
                v48 = v46;
                dispatch_async(v47, block);

LABEL_52:
                v10 = v81;
LABEL_53:

                goto LABEL_54;
              }

LABEL_49:
              v55 = objc_autoreleasePoolPush();
              v56 = self;
              v57 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
              {
                v58 = HMFGetLogIdentifier();
                v59 = [v89 accessory];
                v60 = [v59 name];
                *buf = 138543874;
                v116 = v58;
                v117 = 2112;
                v118 = v60;
                v119 = 2112;
                v120 = v9;
                _os_log_impl(&dword_229538000, v57, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ not reachable for reading", buf, 0x20u);
              }

              objc_autoreleasePoolPop(v55);
              v61 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
              v62 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v81 error:v61];
              v63 = [HMDMediaPropertyResponse serializeResponses:v62];
              [v73 addEntriesFromDictionary:v63];

              goto LABEL_52;
            }
          }

          else
          {
            v13 = 0;
          }

          if (v83)
          {
            dispatch_group_enter(group);
            v49 = objc_autoreleasePoolPush();
            v50 = self;
            v51 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
            {
              v52 = HMFGetLogIdentifier();
              v53 = [v89 accessory];
              v54 = [v53 name];
              *buf = 138544130;
              v116 = v52;
              v117 = 2112;
              v118 = v54;
              v119 = 2112;
              v120 = v9;
              v121 = 2112;
              v122 = v83;
              _os_log_impl(&dword_229538000, v51, OS_LOG_TYPE_INFO, "%{public}@Reading state for accessory with media profile %@/%@ from media session: %@", buf, 0x2Au);
            }

            objc_autoreleasePoolPop(v49);
            v97[0] = MEMORY[0x277D85DD0];
            v97[1] = 3221225472;
            v97[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2218;
            v97[3] = &unk_278684610;
            objc_copyWeak(&v100, &location);
            v98 = group;
            v99 = v73;
            [v83 readProperties:v81 completion:v97];

            objc_destroyWeak(&v100);
            goto LABEL_52;
          }

          goto LABEL_49;
        }

LABEL_54:

        ++v88;
      }

      while (v88 != v79);
      v64 = [obj countByEnumeratingWithState:&v105 objects:v114 count:16];
      v79 = v64;
    }

    while (v64);
  }

  v65 = [(HMDHome *)self workQueue];
  v94[0] = MEMORY[0x277D85DD0];
  v94[1] = 3221225472;
  v94[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_3;
  v94[3] = &unk_27868A7A0;
  v95 = v73;
  v96 = v70;
  v66 = v73;
  v67 = v70;
  dispatch_group_notify(group, v65, v94);

  objc_destroyWeak(&location);
  v68 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2218(id *a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2;
    block[3] = &unk_27868A010;
    v8 = a1[5];
    v9 = v3;
    v10 = a1[4];
    dispatch_async(v6, block);
  }

  else
  {
    dispatch_group_leave(a1[4]);
  }
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_3(uint64_t a1)
{
  v1 = *(a1 + 40);
  if (v1)
  {
    v2 = [*(a1 + 32) copy];
    (*(v1 + 16))(v1, v2);
  }
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

- (void)redispatchMediaReadRequests:(id)a3 viaDevice:(id)a4 completion:(id)a5
{
  v29[1] = *MEMORY[0x277D85DE8];
  v8 = a3;
  v21 = a4;
  v9 = a5;
  v10 = [HMDMediaPropertyRequest serializeReadRequests:v8];
  if ([v10 count])
  {
    v11 = [(HMDHome *)self uuid];
    v12 = [v11 UUIDString];

    v13 = *MEMORY[0x277CD0640];
    v27[0] = @"kMediaPropertiesListKey";
    v27[1] = v13;
    v28[0] = v10;
    v28[1] = v12;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];
    v15 = MEMORY[0x277D0F848];
    v16 = [(HMDHome *)self messageDestination];
    v17 = [v15 messageWithName:@"kMediaPropertiesReadRequestKey" qualityOfService:33 destination:v16 payload:v14];

    objc_initWeak(&location, self);
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __60__HMDHome_redispatchMediaReadRequests_viaDevice_completion___block_invoke;
    v22[3] = &unk_278685EC0;
    objc_copyWeak(&v25, &location);
    v24 = v9;
    v23 = v8;
    [v17 setResponseHandler:v22];
    v18 = [(HMDHome *)self uuid];
    v19 = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v17 target:v18 responseQueue:v19 viaDevice:v21];

    objc_destroyWeak(&v25);
    objc_destroyWeak(&location);
LABEL_5:

    goto LABEL_6;
  }

  if (v9)
  {
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v14 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v8 error:v12];
    v29[0] = v14;
    v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v29 count:1];
    (*(v9 + 2))(v9, v17);
    goto LABEL_5;
  }

LABEL_6:

  v20 = *MEMORY[0x277D85DE8];
}

void __60__HMDHome_redispatchMediaReadRequests_viaDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v13[1] = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = *(a1 + 40);
    if (v5)
    {
      if (v8)
      {
        v9 = [HMDMediaPropertyResponse propertyResponsesFromRequests:*(a1 + 32) error:v5];
        v10 = *(a1 + 40);
        v13[0] = v9;
        v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
        (*(v10 + 16))(v10, v11);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v6 requests:*(a1 + 32) home:WeakRetained];
      (*(*(a1 + 40) + 16))();
      goto LABEL_7;
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeMediaSessionState:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_mediaSessionStates containsObject:v4])
  {
    [(NSMutableArray *)self->_mediaSessionStates removeObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addMediaSessionState:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_mediaSessionStates containsObject:v4]& 1) == 0)
  {
    [(NSMutableArray *)self->_mediaSessionStates addObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)mediaSessionStateWithIdentifier:(id)a3
{
  v4 = a3;
  if ([v4 hasPrefix:@"direct://"])
  {
    v5 = v4;
    v6 = [v5 substringFromIndex:8];
  }

  else
  {
    v5 = [MEMORY[0x277CCACA8] stringWithFormat:@"direct://%@", v4];
    v6 = v4;
  }

  v7 = v6;
  v8 = [(HMDHome *)self mediaSessionStates];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __43__HMDHome_mediaSessionStateWithIdentifier___block_invoke;
  v13[3] = &unk_278670868;
  v14 = v5;
  v15 = v7;
  v9 = v7;
  v10 = v5;
  v11 = [v8 na_firstObjectPassingTest:v13];

  return v11;
}

uint64_t __43__HMDHome_mediaSessionStateWithIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 sessionIdentifier];
  if ([v4 isEqualToString:*(a1 + 32)])
  {
    v5 = 1;
  }

  else
  {
    v6 = [v3 sessionIdentifier];
    v5 = [v6 isEqualToString:*(a1 + 40)];
  }

  return v5;
}

- (NSArray)mediaSessionStates
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_mediaSessionStates copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)removeMediaSession:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_mediaSessions containsObject:v4])
  {
    [(NSMutableArray *)self->_mediaSessions removeObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addMediaSession:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_mediaSessions containsObject:v4]& 1) == 0)
  {
    [(NSMutableArray *)self->_mediaSessions addObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)mediaSessionWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSessions];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)mediaSessionWithIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSessions];
  v6 = [v5 hmf_firstObjectWithValue:v4 forKeyPath:@"sessionIdentifier"];

  return v6;
}

- (NSArray)mediaSessions
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_mediaSessions copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (id)homeConfigurationModelObjectWithChangeType:(unint64_t)a3
{
  v5 = [HMDHomeConfigurationModel alloc];
  v6 = [(HMDHome *)self homeConfigurationUUID];
  v7 = [(HMDHome *)self uuid];
  v8 = [(HMDBackingStoreModelObject *)v5 initWithObjectChangeType:a3 uuid:v6 parentUUID:v7];

  v9 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome configurationVersion](self, "configurationVersion")}];
  [(HMDHomeConfigurationModel *)v8 setConfigurationVersion:v9];

  return v8;
}

- (id)homeConfigurationUUID
{
  v8[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277CCAD78];
  v3 = [(HMDHome *)self uuid];
  v8[0] = @"6741775F-2ED4-4DF8-B582-1F64BB3D1C75";
  v4 = [MEMORY[0x277CBEA60] arrayWithObjects:v8 count:1];
  v5 = [v2 hm_deriveUUIDFromBaseUUID:v3 identifierSalt:0 withSalts:v4];

  v6 = *MEMORY[0x277D85DE8];

  return v5;
}

- (id)emptyModelObjectWithChangeType:(unint64_t)a3
{
  v5 = [HMDHomeModel alloc];
  v6 = [(HMDHome *)self uuid];
  v7 = objc_alloc(MEMORY[0x277CCAD78]);
  v8 = [v7 initWithUUIDString:*MEMORY[0x277CD23C8]];
  v9 = [(HMDBackingStoreModelObject *)v5 initWithObjectChangeType:a3 uuid:v6 parentUUID:v8];

  return v9;
}

- (id)modelObjectWithChangeType:(unint64_t)a3 version:(int64_t)a4
{
  v6 = [(HMDHome *)self emptyModelObjectWithChangeType:a3];
  v7 = [(HMDHome *)self name];
  [v6 setName:v7];

  v8 = [(HMDHome *)self ownerName];
  if (v8)
  {
    v9 = v8;
    v10 = [(HMDHome *)self owner];
    v11 = [v10 publicKey];

    if (v11)
    {
      v12 = [(HMDHome *)self ownerName];
      [v6 setOwnerName:v12];

      v13 = [(HMDHome *)self owner];
      v14 = [v13 uuid];
      v15 = [v14 UUIDString];
      [v6 setOwnerUUID:v15];

      v16 = [(HMDHome *)self owner];
      v17 = [v16 userID];
      [v6 setOwnerUserID:v17];

      v18 = [(HMDHome *)self owner];
      v19 = [v18 publicKey];
      [v6 setOwnerPublicKey:v19];
    }
  }

  v20 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isOwnerUser](self, "isOwnerUser")}];
  [v6 setOwned:v20];

  v21 = [(HMDHome *)self nfcReaderKey];
  [v6 setNfcReaderKey:v21];

  v22 = [(HMDHome *)self creationDate];

  if (v22)
  {
    v23 = [(HMDHome *)self creationDate];
    [v6 setCreationDate:v23];
  }

  v24 = [(HMDHome *)self firstHAPAccessoryAddedDate];

  if (v24)
  {
    v25 = [(HMDHome *)self firstHAPAccessoryAddedDate];
    [v6 setFirstHAPAccessoryAddedDate:v25];
  }

  v26 = [(HMDHome *)self roomForEntireHome];
  v27 = [v26 uuid];
  v28 = [v27 UUIDString];
  [v6 setDefaultRoomUUID:v28];

  v29 = [(HMDHome *)self homeLocationHandler];
  v30 = [v29 locationData];
  v31 = encodeRootObject();
  [v6 setHomeLocationData:v31];

  if (a4 >= 4)
  {
    v32 = [(HMDHome *)self presenceAuthStatus];

    if (v32)
    {
      v33 = [(HMDHome *)self presenceAuthStatus];
      v34 = [v33 number];
      [v6 setPresenceAuthorizationStatus:v34];
    }

    v35 = [(HMDHome *)self presenceComputeStatus];

    if (v35)
    {
      v36 = [(HMDHome *)self presenceComputeStatus];
      v37 = [v36 number];
      [v6 setPresenceComputeStatus:v37];
    }

    v38 = [(HMDHome *)self sharedHomeSourceVersion];

    if (v38)
    {
      v39 = [(HMDHome *)self sharedHomeSourceVersion];
      [v6 setSharedHomeSourceVersion:v39];
    }

    v40 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome protectionMode](self, "protectionMode")}];
    [v6 setNetworkProtectionMode:v40];
  }

  if ([(HMDHome *)self isMultiUserEnabled])
  {
    v41 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isMultiUserEnabled](self, "isMultiUserEnabled")}];
    [v6 setMultiUserEnabled:v41];
  }

  v42 = [v6 hasAnyUserAcknowledgedCameraRecordingOnboarding];

  if (v42)
  {
    v43 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasAnyUserAcknowledgedCameraRecordingOnboarding](self, "hasAnyUserAcknowledgedCameraRecordingOnboarding")}];
    [v6 setHasAnyUserAcknowledgedCameraRecordingOnboarding:v43];
  }

  if ([(HMDHome *)self hasOnboardedForAccessCode])
  {
    v44 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasOnboardedForAccessCode](self, "hasOnboardedForAccessCode")}];
    [v6 setHasOnboardedForAccessCode:v44];
  }

  if ([(HMDHome *)self shouldEncodeHasOnboardedForWalletKey])
  {
    v45 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasOnboardedForWalletKey](self, "hasOnboardedForWalletKey")}];
    [v6 setHasOnboardedForWalletKey:v45];
  }

  v46 = [(HMDHome *)self naturalLightingContext];
  if (v46)
  {
    [v6 setNaturalLightingContext:v46];
  }

  v47 = [(HMDHome *)self chipStorage];
  [v47 updateHomeModel:v6];

  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    v48 = [(HMDHome *)self fabric];
    v49 = [v48 fabricID];
    [v6 setMatterFabricID:v49];
  }

  v50 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome soundCheckEnabled](self, "soundCheckEnabled")}];
  [v6 setSoundCheckEnabled:v50];

  v51 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome audioAnalysisClassifierOptions](self, "audioAnalysisClassifierOptions")}];
  [v6 setAnalysisOptions:v51];

  v52 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome didOnboardAudioAnalysis](self, "didOnboardAudioAnalysis")}];
  [v6 setDidOnboardAnalysis:v52];

  v53 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome siriPhraseOptions](self, "siriPhraseOptions")}];
  [v6 setSiriPhraseOptions:v53];

  v54 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome locationServicesEnabled](self, "locationServicesEnabled")}];
  [v6 setLocationServicesEnabled:v54];

  v55 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome didOnboardLocationServices](self, "didOnboardLocationServices")}];
  [v6 setDidOnboardLocationServices:v55];

  return v6;
}

- (id)backingStoreObjects:(int64_t)a3 hh2Migration:(BOOL)a4
{
  v172 = a4;
  v238 = *MEMORY[0x277D85DE8];
  v6 = [MEMORY[0x277CBEB18] array];
  v7 = [(HMDHome *)self modelObjectWithChangeType:1 version:a3];
  [v6 addObject:v7];

  v220 = 0u;
  v221 = 0u;
  v218 = 0u;
  v219 = 0u;
  v176 = self;
  v8 = [(HMDHome *)self accessories];
  v9 = [v8 countByEnumeratingWithState:&v218 objects:v237 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v219;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v219 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v218 + 1) + 8 * i);
        if (a3 <= 3)
        {
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) == 0)
          {
            continue;
          }
        }

        v14 = [v13 backingStoreObjects:a3];
        [v6 addObjectsFromArray:v14];
      }

      v10 = [v8 countByEnumeratingWithState:&v218 objects:v237 count:16];
    }

    while (v10);
  }

  v216 = 0u;
  v217 = 0u;
  v214 = 0u;
  v215 = 0u;
  v15 = [(HMDHome *)v176 actionSets];
  v16 = [v15 countByEnumeratingWithState:&v214 objects:v236 count:16];
  if (v16)
  {
    v17 = v16;
    v18 = *v215;
    do
    {
      for (j = 0; j != v17; ++j)
      {
        if (*v215 != v18)
        {
          objc_enumerationMutation(v15);
        }

        v20 = *(*(&v214 + 1) + 8 * j);
        if (a3 <= 1)
        {
          v21 = MEMORY[0x277CD1800];
          v22 = [*(*(&v214 + 1) + 8 * j) type];
          LOBYTE(v21) = [v21 isBuiltinActionSetType:v22];

          if (v21)
          {
            continue;
          }
        }

        v23 = [v20 backingStoreObjects:a3];
        [v6 addObjectsFromArray:v23];
      }

      v17 = [v15 countByEnumeratingWithState:&v214 objects:v236 count:16];
    }

    while (v17);
  }

  if (a3 >= 3)
  {
    isWatch();
    v210 = 0u;
    v211 = 0u;
    v212 = 0u;
    v213 = 0u;
    v24 = [(HMDHome *)v176 triggerOwnedActionSets];
    v25 = [v24 countByEnumeratingWithState:&v210 objects:v235 count:16];
    if (v25)
    {
      v26 = v25;
      v27 = *v211;
      do
      {
        for (k = 0; k != v26; ++k)
        {
          if (*v211 != v27)
          {
            objc_enumerationMutation(v24);
          }

          v29 = [*(*(&v210 + 1) + 8 * k) backingStoreObjects:a3];
          [v6 addObjectsFromArray:v29];
        }

        v26 = [v24 countByEnumeratingWithState:&v210 objects:v235 count:16];
      }

      while (v26);
    }

    v208 = 0u;
    v209 = 0u;
    v206 = 0u;
    v207 = 0u;
    v30 = [(HMDHome *)v176 triggers];
    v31 = [v30 countByEnumeratingWithState:&v206 objects:v234 count:16];
    if (v31)
    {
      v32 = v31;
      v33 = *v207;
      do
      {
        for (m = 0; m != v32; ++m)
        {
          if (*v207 != v33)
          {
            objc_enumerationMutation(v30);
          }

          v35 = *(*(&v206 + 1) + 8 * m);
          v36 = [v35 requiresDataVersion4];
          if (a3 > 3 || (v36 & 1) == 0)
          {
            v37 = [v35 backingStoreObjects:a3];
            [v6 addObjectsFromArray:v37];
          }
        }

        v32 = [v30 countByEnumeratingWithState:&v206 objects:v234 count:16];
      }

      while (v32);
    }
  }

  v204 = 0u;
  v205 = 0u;
  v202 = 0u;
  v203 = 0u;
  v38 = [(HMDHome *)v176 rooms];
  v39 = [v38 countByEnumeratingWithState:&v202 objects:v233 count:16];
  v40 = v172;
  if (v39)
  {
    v41 = v39;
    v42 = *v203;
    do
    {
      for (n = 0; n != v41; ++n)
      {
        if (*v203 != v42)
        {
          objc_enumerationMutation(v38);
        }

        v44 = [*(*(&v202 + 1) + 8 * n) backingStoreObjects:a3];
        [v6 addObjectsFromArray:v44];
      }

      v41 = [v38 countByEnumeratingWithState:&v202 objects:v233 count:16];
    }

    while (v41);
  }

  v200 = 0u;
  v201 = 0u;
  v198 = 0u;
  v199 = 0u;
  v45 = [(HMDHome *)v176 zones];
  v46 = [v45 countByEnumeratingWithState:&v198 objects:v232 count:16];
  if (v46)
  {
    v47 = v46;
    v48 = *v199;
    do
    {
      for (ii = 0; ii != v47; ++ii)
      {
        if (*v199 != v48)
        {
          objc_enumerationMutation(v45);
        }

        v50 = [*(*(&v198 + 1) + 8 * ii) backingStoreObjects:a3];
        [v6 addObjectsFromArray:v50];
      }

      v47 = [v45 countByEnumeratingWithState:&v198 objects:v232 count:16];
    }

    while (v47);
  }

  v196 = 0u;
  v197 = 0u;
  v194 = 0u;
  v195 = 0u;
  v51 = [(HMDHome *)v176 serviceGroups];
  v52 = [v51 countByEnumeratingWithState:&v194 objects:v231 count:16];
  if (v52)
  {
    v53 = v52;
    v54 = *v195;
    do
    {
      for (jj = 0; jj != v53; ++jj)
      {
        if (*v195 != v54)
        {
          objc_enumerationMutation(v51);
        }

        v56 = [*(*(&v194 + 1) + 8 * jj) backingStoreObjects:a3];
        [v6 addObjectsFromArray:v56];
      }

      v53 = [v51 countByEnumeratingWithState:&v194 objects:v231 count:16];
    }

    while (v53);
  }

  v192 = 0u;
  v193 = 0u;
  v190 = 0u;
  v191 = 0u;
  v57 = [(HMDHome *)v176 users];
  v58 = [v57 countByEnumeratingWithState:&v190 objects:v230 count:16];
  if (v58)
  {
    v59 = v58;
    v60 = *v191;
    obj = v57;
    do
    {
      for (kk = 0; kk != v59; ++kk)
      {
        if (*v191 != v60)
        {
          objc_enumerationMutation(v57);
        }

        v62 = *(*(&v190 + 1) + 8 * kk);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();
        v64 = isKindOfClass;
        if (a3 > 1 || (isKindOfClass & 1) == 0)
        {
          isWatch();
          if (a3 > 3 || ([(HMDOutgoingHomeInvitation *)v62 requiresMakoSupport]& 1) == 0)
          {
            if (!v40 || ([(HMDOutgoingHomeInvitation *)v62 isOwner]& 1) != 0)
            {
              v65 = [(HMDOutgoingHomeInvitation *)v62 backingStoreObjects:a3];
              [v6 addObjectsFromArray:v65];

              continue;
            }

            if (v64)
            {
              v66 = objc_autoreleasePoolPush();
              v67 = v176;
              v68 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v68, OS_LOG_TYPE_INFO))
              {
                v69 = HMFGetLogIdentifier();
                *buf = 138543618;
                v227 = v69;
                v228 = 2112;
                v229 = v62;
                v70 = v68;
                v71 = "%{public}@Skipping resident user [%@] for HH2 migration as it is deprecated in HH2";
                goto LABEL_83;
              }

              goto LABEL_84;
            }

            v72 = [(HMDOutgoingHomeInvitation *)v62 userID];

            if (v72)
            {
              if ([(HMDHome *)v176 nonIPadResidentDeviceCountForHH2Migration])
              {
                v169 = [HMDOutgoingHomeInvitation alloc];
                v73 = MEMORY[0x277CCAD78];
                v170 = [(HMDOutgoingHomeInvitation *)v62 uuid];
                v225 = @"50690AC3-FD93-4D1F-A677-9369289BB998";
                v74 = [MEMORY[0x277CBEA60] arrayWithObjects:&v225 count:1];
                v75 = [v73 hm_deriveUUIDFromBaseUUID:v170 withSalts:v74];
                v76 = [(HMDOutgoingHomeInvitation *)v169 initWithUUID:v75 invitee:v62 invitationState:2 forHome:v176 expiryDate:0 messageIdentifier:0];

                v77 = v76;
                v78 = [(HMDOutgoingHomeInvitation *)v76 modelObjectWithChangeType:1 version:a3];
                [v6 addObject:v78];

                v79 = objc_autoreleasePoolPush();
                v80 = v77;
                v81 = v176;
                v82 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
                {
                  HMFGetLogIdentifier();
                  v83 = v171 = v79;
                  *buf = 138543618;
                  v227 = v83;
                  v228 = 2112;
                  v229 = v80;
                  _os_log_impl(&dword_229538000, v82, OS_LOG_TYPE_INFO, "%{public}@Generated re-invite for shared user: %@", buf, 0x16u);

                  v79 = v171;
                }

                objc_autoreleasePoolPop(v79);
                [(HMDOutgoingHomeInvitation *)v62 setPrivilege:2];
                v84 = [(HMDOutgoingHomeInvitation *)v62 backingStoreObjects:a3];
                [v6 addObjectsFromArray:v84];
              }

              else
              {
                v85 = objc_autoreleasePoolPush();
                v86 = v176;
                v87 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v87, OS_LOG_TYPE_INFO))
                {
                  v88 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v227 = v88;
                  v228 = 2112;
                  v229 = v62;
                  _os_log_impl(&dword_229538000, v87, OS_LOG_TYPE_INFO, "%{public}@Dropping shared user as there will be no valid resident after migration: %@", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v85);
              }

              v40 = v172;
            }

            else
            {
              v66 = objc_autoreleasePoolPush();
              v67 = v176;
              v68 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v68, OS_LOG_TYPE_INFO))
              {
                v69 = HMFGetLogIdentifier();
                *buf = 138543618;
                v227 = v69;
                v228 = 2112;
                v229 = v62;
                v70 = v68;
                v71 = "%{public}@Skipping bad user [%@] for HH2 migration, no account handle";
LABEL_83:
                _os_log_impl(&dword_229538000, v70, OS_LOG_TYPE_INFO, v71, buf, 0x16u);

                v40 = v172;
              }

LABEL_84:

              objc_autoreleasePoolPop(v66);
            }

            v57 = obj;
            continue;
          }
        }
      }

      v59 = [v57 countByEnumeratingWithState:&v190 objects:v230 count:16];
    }

    while (v59);
  }

  if (a3 >= 2)
  {
    v188 = 0u;
    v189 = 0u;
    v186 = 0u;
    v187 = 0u;
    obja = [(HMDHome *)v176 outgoingInvitations];
    v89 = [obja countByEnumeratingWithState:&v186 objects:v224 count:16];
    if (v89)
    {
      v90 = v89;
      v91 = *v187;
      do
      {
        for (mm = 0; mm != v90; ++mm)
        {
          if (*v187 != v91)
          {
            objc_enumerationMutation(obja);
          }

          v93 = *(*(&v186 + 1) + 8 * mm);
          if (a3 <= 3)
          {
            v94 = [*(*(&v186 + 1) + 8 * mm) user];
            v95 = [v94 requiresMakoSupport];

            if (v95)
            {
              continue;
            }
          }

          if (v40)
          {
            if (![(HMDHome *)v176 nonIPadResidentDeviceCountForHH2Migration])
            {
              v98 = objc_autoreleasePoolPush();
              v99 = v176;
              v100 = HMFGetOSLogHandle();
              if (!os_log_type_enabled(v100, OS_LOG_TYPE_INFO))
              {
                goto LABEL_117;
              }

              v101 = HMFGetLogIdentifier();
              *buf = 138543618;
              v227 = v101;
              v228 = 2112;
              v229 = v93;
              v102 = v100;
              v103 = "%{public}@Dropping outgoing invite as there will be no valid resident after migration: %@";
LABEL_116:
              _os_log_impl(&dword_229538000, v102, OS_LOG_TYPE_INFO, v103, buf, 0x16u);

              goto LABEL_117;
            }

            if ([(HMDHomeInvitation *)v93 invitationState]!= 2)
            {
              v98 = objc_autoreleasePoolPush();
              v99 = v176;
              v100 = HMFGetOSLogHandle();
              if (!os_log_type_enabled(v100, OS_LOG_TYPE_INFO))
              {
                goto LABEL_117;
              }

              v101 = HMFGetLogIdentifier();
              *buf = 138543618;
              v227 = v101;
              v228 = 2112;
              v229 = v93;
              v102 = v100;
              v103 = "%{public}@Dropping outgoing invite as it is in a terminal state: %@";
              goto LABEL_116;
            }

            v96 = [(HMDHome *)v176 users];
            v185[0] = MEMORY[0x277D85DD0];
            v185[1] = 3221225472;
            v185[2] = __44__HMDHome_backingStoreObjects_hh2Migration___block_invoke;
            v185[3] = &unk_278688680;
            v185[4] = v93;
            v97 = [v96 na_any:v185];

            if (v97)
            {
              v98 = objc_autoreleasePoolPush();
              v99 = v176;
              v100 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v100, OS_LOG_TYPE_INFO))
              {
                v101 = HMFGetLogIdentifier();
                *buf = 138543618;
                v227 = v101;
                v228 = 2112;
                v229 = v93;
                v102 = v100;
                v103 = "%{public}@Dropping outgoing invite as there is already a matching user in the home: %@";
                goto LABEL_116;
              }

LABEL_117:

              objc_autoreleasePoolPop(v98);
              v40 = v172;
              continue;
            }
          }

          v104 = [(HMDOutgoingHomeInvitation *)v93 modelObjectWithChangeType:1 version:a3];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v105 = v104;
          }

          else
          {
            v105 = 0;
          }

          v106 = v105;

          if (v106)
          {
            [v6 addObject:v106];
          }
        }

        v90 = [obja countByEnumeratingWithState:&v186 objects:v224 count:16];
      }

      while (v90);
    }

    if (a3 >= 3)
    {
      v183 = 0u;
      v184 = 0u;
      v181 = 0u;
      v182 = 0u;
      v107 = [(HMDHome *)v176 residentDeviceManager];
      v108 = [v107 residentDevices];

      v109 = [v108 countByEnumeratingWithState:&v181 objects:v223 count:16];
      if (v109)
      {
        v110 = v109;
        v111 = *v182;
        do
        {
          for (nn = 0; nn != v110; ++nn)
          {
            if (*v182 != v111)
            {
              objc_enumerationMutation(v108);
            }

            v113 = [*(*(&v181 + 1) + 8 * nn) modelObjectWithChangeType:1 version:a3];
            [v6 addObject:v113];
          }

          v110 = [v108 countByEnumeratingWithState:&v181 objects:v223 count:16];
        }

        while (v110);
      }

      v114 = [(HMDHome *)v176 appData];

      if (v114)
      {
        v115 = [(HMDHome *)v176 appData];
        v116 = [v115 modelObjectWithChangeType:1];
        [v6 addObject:v116];
      }

      if (a3 >= 4)
      {
        v117 = [HMDHomeSettingsModel alloc];
        v118 = [(HMDHome *)v176 uuid];
        v119 = [HMDHomeSettingsModel modelIDForHomeUUID:v118];
        v120 = [(HMDHome *)v176 uuid];
        v121 = [(HMDBackingStoreModelObject *)v117 initWithObjectChangeType:1 uuid:v119 parentUUID:v120];

        v122 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isAutomaticSoftwareUpdateEnabled](v176, "isAutomaticSoftwareUpdateEnabled")}];
        [(HMDHomeSettingsModel *)v121 setAutomaticSoftwareUpdateEnabled:v122];

        v123 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isAutomaticThirdPartyAccessorySoftwareUpdateEnabled](v176, "isAutomaticThirdPartyAccessorySoftwareUpdateEnabled")}];
        [(HMDHomeSettingsModel *)v121 setAutomaticThirdPartyAccessorySoftwareUpdateEnabled:v123];

        [v6 addObject:v121];
        v124 = [HMDHomeMediaSettingsModel alloc];
        v125 = [(HMDHome *)v176 uuid];
        v126 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:v125];
        v127 = [(HMDHome *)v176 uuid];
        v128 = [(HMDBackingStoreModelObject *)v124 initWithObjectChangeType:1 uuid:v126 parentUUID:v127];

        v129 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome minimumMediaUserPrivilege](v176, "minimumMediaUserPrivilege")}];
        [(HMDHomeMediaSettingsModel *)v128 setMinimumMediaUserPrivilege:v129];

        v130 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isMediaPeerToPeerEnabled](v176, "isMediaPeerToPeerEnabled")}];
        [(HMDHomeMediaSettingsModel *)v128 setMediaPeerToPeerEnabled:v130];

        v131 = [(HMDHome *)v176 mediaPassword];
        [(HMDHomeMediaSettingsModel *)v128 setMediaPassword:v131];

        [v6 addObject:v128];
        v132 = [(HMDHome *)v176 mediaSystemController];
        v133 = [v132 backingStoreObjectsForVersion:a3];

        if ([v133 count])
        {
          [v6 addObjectsFromArray:v133];
        }

        objb = v133;
        v134 = [(HMDHome *)v176 uuid];
        v135 = [HMDHomeNetworkRouterManagingDeviceSettingsModel defaultModelForHomeUUID:v134];

        v136 = [(HMDHome *)v176 primaryNetworkRouterManagingDeviceUUID];
        v137 = [v136 UUIDString];
        [v135 setPrimaryNetworkRouterManagingDeviceUUID:v137];

        [v6 addObject:v135];
        v138 = [(HMDHome *)v176 uuid];
        v139 = [HMDHomeNetworkRouterSettingsModel defaultModelForHomeUUID:v138];

        v140 = [(HMDHome *)v176 activeNetworkRouterUUID];
        v141 = [v140 UUIDString];
        [v139 setActiveNetworkRouterAccessoryUUID:v141];

        v142 = +[HMDHomeKitVersion version6];
        v143 = [(HMDHome *)v176 minimumNetworkRouterSupportHomeKitVersion];
        if (!v143 || (v144 = v143, -[HMDHome minimumNetworkRouterSupportHomeKitVersion](v176, "minimumNetworkRouterSupportHomeKitVersion"), v145 = objc_claimAutoreleasedReturnValue(), v146 = [v145 compare:v142], v145, v144, v146 == -1))
        {
          v147 = [v142 versionString];
          [v139 setMinimumNetworkRouterSupportHomeKitVersion:v147];
        }

        v148 = [(HMDHome *)v176 minHomeKitVersionForAccessoryNetworkProtectionChange];
        v149 = [v148 versionString];
        [v139 setMinHomeKitVersionForAccessoryNetworkProtectionChange:v149];

        [v6 addObject:v139];
        v179 = 0u;
        v180 = 0u;
        v177 = 0u;
        v178 = 0u;
        v150 = [(HMDHome *)v176 networkProtectionGroupRegistry];
        v151 = [v150 persistedGroups];

        v152 = [v151 countByEnumeratingWithState:&v177 objects:v222 count:16];
        if (v152)
        {
          v153 = v152;
          v154 = *v178;
          do
          {
            for (i1 = 0; i1 != v153; ++i1)
            {
              if (*v178 != v154)
              {
                objc_enumerationMutation(v151);
              }

              v156 = [*(*(&v177 + 1) + 8 * i1) modelForVersion:a3];
              [v6 addObject:v156];
            }

            v153 = [v151 countByEnumeratingWithState:&v177 objects:v222 count:16];
          }

          while (v153);
        }

        v157 = [HMDHomeThreadNetworkModel defaultModelForHome:v176];
        v158 = [(HMDHome *)v176 unfilteredThreadNetworkID];
        [v157 setThreadNetworkID:v158];

        [v6 addObject:v157];
        v159 = [(HMDHome *)v176 uuid];
        v160 = [HMDHomePersonManagerSettingsModel defaultModelForHomeUUID:v159];

        v161 = [(HMDHome *)v176 personManagerZoneUUID];
        [v160 setZoneUUID:v161];

        [v6 addObject:v160];
        v162 = [(HMDHome *)v176 labelsByAccessCode];
        v163 = [HMDAccessCodeDataManager createHomeAccessCodeModelsFromLabelsByAccessCode:v162 forHome:v176];

        [v6 addObjectsFromArray:v163];
        v164 = [(HMDHome *)v176 removedUserInfoByAccessCode];
        v165 = [HMDAccessCodeDataManager createRemovedUserInfoModelsFromRemovedUserInfoByAccessCode:v164 forHome:v176];

        [v6 addObjectsFromArray:v165];
      }
    }
  }

  v166 = v6;

  v167 = *MEMORY[0x277D85DE8];
  return v6;
}

uint64_t __44__HMDHome_backingStoreObjects_hh2Migration___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = [v2 user];
  v5 = [v4 isEqual:v3];

  return v5;
}

- (id)sharedHomeModel
{
  v3 = [HMDSharedHomeModel alloc];
  v4 = [(HMDHome *)self uuid];
  v5 = objc_alloc(MEMORY[0x277CCAD78]);
  v6 = [v5 initWithUUIDString:*MEMORY[0x277CD23C8]];
  v7 = [(HMDBackingStoreModelObject *)v3 initWithObjectChangeType:1 uuid:v4 parentUUID:v6];

  v8 = [(HMDHome *)self homeManager];
  v9 = [v8 generateDataForSharedHomeModel:self];
  [(HMDSharedHomeModel *)v7 setHomeData:v9];

  v10 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome configurationVersion](self, "configurationVersion")}];
  [(HMDSharedHomeModel *)v7 setConfigurationVersion:v10];

  return v7;
}

- (id)deletedBackingStoreObject
{
  v3 = [(HMDHome *)self homeManager];
  v4 = [(HMDHome *)self isOwnerUser];
  v5 = off_2786661D8;
  if (!v4)
  {
    v5 = off_278666320;
  }

  v6 = objc_alloc(*v5);
  v7 = [(HMDHome *)self uuid];
  v8 = [v3 uuid];
  v9 = [v6 initWithObjectChangeType:3 uuid:v7 parentUUID:v8];

  return v9;
}

- (void)transactionObjectRemoved:(id)a3 message:(id)a4
{
  v56 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v6;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;
  if (!v9)
  {
    v11 = v6;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v12 = v11;
    }

    else
    {
      v12 = 0;
    }

    v10 = v12;

    if (!v10)
    {
      v21 = v11;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v22 = v21;
      }

      else
      {
        v22 = 0;
      }

      v14 = v22;

      if (!v14)
      {
        v37 = [(HMDHome *)self homeObjectChangeHandler];
        [v37 handleObjectRemove:v21 message:v7];

        v14 = 0;
LABEL_38:

        goto LABEL_39;
      }

      v23 = [v7 messagePayload];
      v24 = [v23 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

      if (v24)
      {
        v25 = objc_autoreleasePoolPush();
        v26 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          [v24 UUID];
          v29 = v49 = v25;
          *buf = 138543618;
          v53 = v28;
          v54 = 2112;
          v55 = v29;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Handling removed removed-user access code model", buf, 0x16u);

          v25 = v49;
        }
      }

      else
      {
        v24 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
        v25 = objc_autoreleasePoolPush();
        v38 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v39 = v50 = v25;
          v40 = [v24 UUID];
          *buf = 138543618;
          v53 = v39;
          v54 = 2112;
          v55 = v40;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling removed removed-user access code model", buf, 0x16u);

          v25 = v50;
        }
      }

      objc_autoreleasePoolPop(v25);
      v41 = [(HMDHome *)self accessCodeManager];
      v42 = [v41 dataManager];

      if (v42)
      {
        [v42 handleRemovedHMDRemovedUserAccessCodeModel:v14 message:v7 flow:v24];
      }

      else
      {
        v43 = objc_autoreleasePoolPush();
        v44 = self;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v46 = v51 = v43;
          *buf = 138543362;
          v53 = v46;
          _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDRemovedUserAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);

          v43 = v51;
        }

        objc_autoreleasePoolPop(v43);
        v47 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [v7 respondWithError:v47];
      }

LABEL_37:
      goto LABEL_38;
    }

    v13 = [v7 messagePayload];
    v14 = [v13 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

    if (v14)
    {
      v15 = objc_autoreleasePoolPush();
      v16 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_23;
      }

      v18 = HMFGetLogIdentifier();
      v19 = [v14 UUID];
      *buf = 138543618;
      v53 = v18;
      v54 = 2112;
      v55 = v19;
      v20 = "%{public}@[Flow: %@] Handling removed home access code model";
    }

    else
    {
      v14 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
      v15 = objc_autoreleasePoolPush();
      v30 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_23;
      }

      v18 = HMFGetLogIdentifier();
      v19 = [v14 UUID];
      *buf = 138543618;
      v53 = v18;
      v54 = 2112;
      v55 = v19;
      v20 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling removed home access code model";
    }

    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, v20, buf, 0x16u);

LABEL_23:
    objc_autoreleasePoolPop(v15);
    v31 = [(HMDHome *)self accessCodeManager];
    v24 = [v31 dataManager];

    if (v24)
    {
      [v24 handleRemovedHomeAccessCodeModel:v10 message:v7 flow:v14];
    }

    else
    {
      v32 = objc_autoreleasePoolPush();
      v33 = self;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543362;
        v53 = v35;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDHomeAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v32);
      v36 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [v7 respondWithError:v36];
    }

    goto LABEL_37;
  }

  v10 = [(HMDHome *)self residentDeviceManager];
  [v10 transactionObjectRemoved:v6 message:v7];
LABEL_39:

  v48 = *MEMORY[0x277D85DE8];
}

- (void)transactionObjectUpdated:(id)a3 newValues:(id)a4 message:(id)a5
{
  v102 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v9;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;
  if (!v12)
  {
    v14 = v9;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;

    if (v16)
    {
      [(HMDHome *)self updateHomeConfigurationWithModel:v16 message:v10];
LABEL_102:

      goto LABEL_103;
    }

    v17 = v14;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    if (v19)
    {
      v20 = [(HMDHome *)self residentDeviceManager];
      [v20 transactionObjectUpdated:v8 newValues:v17 message:v10];

LABEL_101:
      goto LABEL_102;
    }

    v21 = v17;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v22 = v21;
    }

    else
    {
      v22 = 0;
    }

    v23 = v22;

    if (v23)
    {
      v24 = [(HMDHome *)self homeManager];
      [v24 transactionObjectUpdated:v8 newValues:v21 message:v10];

LABEL_100:
      goto LABEL_101;
    }

    v25 = v21;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v26 = v25;
    }

    else
    {
      v26 = 0;
    }

    v27 = v26;

    if (v27)
    {
      __transactionHomeSettingsUpdated(self, v27, v10);
      v23 = 0;
LABEL_99:

      goto LABEL_100;
    }

    v28 = v25;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v29 = v28;
    }

    else
    {
      v29 = 0;
    }

    v30 = v29;

    if (v30)
    {
      __transactionHomeMediaSettingsUpdated(self, v30, v10);
      v31 = v30;
      v23 = 0;
LABEL_98:

      goto LABEL_99;
    }

    v32 = v28;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v33 = v32;
    }

    else
    {
      v33 = 0;
    }

    v34 = v33;

    if (v34)
    {
      [(HMDHome *)self updateNetworkRouterSettingsWithModel:v34 message:v10];
      v35 = v34;
      v23 = 0;
LABEL_97:

      v31 = 0;
      goto LABEL_98;
    }

    v36 = v32;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v37 = v36;
    }

    else
    {
      v37 = 0;
    }

    v38 = v37;

    if (v38)
    {
      [(HMDHome *)self updateNetworkRouterManagingDeviceSettingsWithModel:v38 message:v10];
      v39 = v38;
      v23 = 0;
LABEL_96:

      v35 = 0;
      goto LABEL_97;
    }

    v40 = v36;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v41 = v40;
    }

    else
    {
      v41 = 0;
    }

    v42 = v41;

    if (v42)
    {
      [(HMDHome *)self _updateThreadNetworkWithModel:v42 message:v10];
      v43 = v42;
      v23 = 0;
LABEL_95:

      v39 = 0;
      goto LABEL_96;
    }

    v44 = v40;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v45 = v44;
    }

    else
    {
      v45 = 0;
    }

    v46 = v45;

    if (v46)
    {
      v47 = v8;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v48 = v47;
      }

      else
      {
        v48 = 0;
      }

      v95 = v48;

      v49 = [(HMDHome *)self personDataManager];
      [v49 handleUpdatedSettingsModel:v46 previousSettingsModel:v95 message:v10];

      goto LABEL_94;
    }

    v50 = v44;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v51 = v50;
    }

    else
    {
      v51 = 0;
    }

    v52 = v51;

    v94 = v52;
    if (v52)
    {
      v53 = [v10 messagePayload];
      v54 = [v53 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

      v96 = v54;
      if (v54)
      {
        context = objc_autoreleasePoolPush();
        v55 = self;
        log = HMFGetOSLogHandle();
        if (os_log_type_enabled(log, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          v57 = [v54 UUID];
          *buf = 138543618;
          v99 = v56;
          v100 = 2112;
          v101 = v57;
          v58 = "%{public}@[Flow: %@] Handling updated home access code model";
LABEL_70:
          _os_log_impl(&dword_229538000, log, OS_LOG_TYPE_INFO, v58, buf, 0x16u);
        }
      }

      else
      {
        v96 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
        context = objc_autoreleasePoolPush();
        v68 = self;
        log = HMFGetOSLogHandle();
        if (os_log_type_enabled(log, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          v57 = [v96 UUID];
          *buf = 138543618;
          v99 = v56;
          v100 = 2112;
          v101 = v57;
          v58 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling updated home access code model";
          goto LABEL_70;
        }
      }

      objc_autoreleasePoolPop(context);
      v69 = [(HMDHome *)self accessCodeManager];
      v70 = [v69 dataManager];

      if (v70)
      {
        [v70 handleUpdatedHomeAccessCodeModel:v94 message:v10 flow:v96];
      }

      else
      {
        logb = objc_autoreleasePoolPush();
        v71 = self;
        v72 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v72, OS_LOG_TYPE_ERROR))
        {
          contextc = HMFGetLogIdentifier();
          *buf = 138543362;
          v99 = contextc;
          _os_log_impl(&dword_229538000, v72, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDHomeAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
        }

        objc_autoreleasePoolPop(logb);
        v73 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [v10 respondWithError:v73];
      }

      goto LABEL_93;
    }

    v59 = v50;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v60 = v59;
    }

    else
    {
      v60 = 0;
    }

    v61 = v60;

    v96 = v61;
    if (!v61)
    {
      v74 = v59;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v75 = v74;
      }

      else
      {
        v75 = 0;
      }

      v76 = v75;
      v97 = v74;

      if (v76)
      {
        [(HMDHome *)self updateROARStatus:v76 message:v10];
        [v10 respondWithSuccess];
      }

      else
      {
        v83 = [(HMDHome *)self homeObjectChangeHandler];
        [v83 handleObjectUpdate:v8 newValues:v97 message:v10];
      }

      v96 = 0;
LABEL_93:

      v46 = 0;
LABEL_94:

      v23 = 0;
      v43 = 0;
      goto LABEL_95;
    }

    v62 = [v10 messagePayload];
    v63 = [v62 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

    loga = v63;
    if (v63)
    {
      v85 = objc_autoreleasePoolPush();
      v64 = self;
      contexta = HMFGetOSLogHandle();
      if (os_log_type_enabled(contexta, OS_LOG_TYPE_INFO))
      {
        v65 = HMFGetLogIdentifier();
        v66 = [v63 UUID];
        *buf = 138543618;
        v99 = v65;
        v100 = 2112;
        v101 = v66;
        v67 = "%{public}@[Flow: %@] Handling updated removed-user access code model";
LABEL_84:
        _os_log_impl(&dword_229538000, contexta, OS_LOG_TYPE_INFO, v67, buf, 0x16u);
      }
    }

    else
    {
      loga = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
      v85 = objc_autoreleasePoolPush();
      v77 = self;
      contexta = HMFGetOSLogHandle();
      if (os_log_type_enabled(contexta, OS_LOG_TYPE_INFO))
      {
        v65 = HMFGetLogIdentifier();
        v66 = [loga UUID];
        *buf = 138543618;
        v99 = v65;
        v100 = 2112;
        v101 = v66;
        v67 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling updated removed-user access code model";
        goto LABEL_84;
      }
    }

    objc_autoreleasePoolPop(v85);
    v78 = [(HMDHome *)self accessCodeManager];
    v79 = [v78 dataManager];

    if (v79)
    {
      [v79 handleUpdatedHMDRemovedUserAccessCodeModel:v96 message:v10 flow:loga];
    }

    else
    {
      contextb = objc_autoreleasePoolPush();
      v80 = self;
      v81 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v81, OS_LOG_TYPE_ERROR))
      {
        v86 = HMFGetLogIdentifier();
        *buf = 138543362;
        v99 = v86;
        _os_log_impl(&dword_229538000, v81, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDRemovedUserAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
      }

      objc_autoreleasePoolPop(contextb);
      v82 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [v10 respondWithError:v82];
    }

    goto LABEL_93;
  }

  v13 = [(HMDHome *)self updateHomeWithModel:v12 message:v10];
LABEL_103:

  v84 = *MEMORY[0x277D85DE8];
}

- (void)updateNetworkRouterManagingDeviceSettingsWithModel:(id)a3 message:(id)a4
{
  v15 = a3;
  v6 = a4;
  v7 = [v15 setProperties];
  if ([v7 containsObject:@"primaryNetworkRouterManagingDeviceUUID"])
  {
    v8 = [(HMDHome *)self primaryNetworkRouterManagingDeviceUUID];
    v9 = [v8 UUIDString];
    v10 = [v15 primaryNetworkRouterManagingDeviceUUID];
    v11 = HMFEqualObjects();

    if (v11)
    {
      goto LABEL_5;
    }

    v12 = objc_alloc(MEMORY[0x277CCAD78]);
    v13 = [v15 primaryNetworkRouterManagingDeviceUUID];
    v7 = [v12 initWithUUIDString:v13];

    [(HMDHome *)self setPrimaryNetworkRouterManagingDeviceUUID:v7];
    v14 = [v6 transactionResult];
    [(HMDHome *)self _evaluateNetworkRouterManagementForTransaction:v14];
    [v14 markChanged];
  }

LABEL_5:
  [v6 respondWithPayload:0];
}

- (void)setHomeUpdatedToROARAndInformClients
{
  v14 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isUpdatedToHH2])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v6;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@isUpdatedToHH2 is already set on this home. Not doing anything.", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  else if (![(HMDHome *)self isUpdatedToHH2])
  {
    [(HMDHome *)self setIsUpdatedToHH2:1];
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Marked home upgraded to HH2 & informing clients about the status", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    [(HMDHome *)v8 saveWithReason:@"Upgraded To HH2" postSyncNotification:0 objectChange:1];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)updateROARStatus:(id)a3 message:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543618;
    v17 = v11;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Found ROAR Model : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [v7 transactionResult];
  v13 = [(HMDHome *)v9 workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __36__HMDHome_updateROARStatus_message___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = v9;
  dispatch_async(v13, block);

  [v12 markSaveToAssistant];
  [v12 markChanged];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)updateNetworkRouterSettingsWithModel:(id)a3 message:(id)a4
{
  v59 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 transactionResult];
  v9 = [v6 setProperties];
  v10 = [v9 containsObject:@"activeNetworkRouterAccessoryUUID"];

  if (v10)
  {
    v11 = objc_alloc(MEMORY[0x277CCAD78]);
    v12 = [v6 activeNetworkRouterAccessoryUUID];
    v13 = [v11 initWithUUIDString:v12];

    v14 = [(HMDHome *)self activeNetworkRouterUUID];
    v15 = HMFEqualObjects();

    if ((v15 & 1) == 0)
    {
      [(HMDHome *)self setActiveNetworkRouterUUID:v13];
      if (v13)
      {
        v16 = [v6 activeNetworkRouterAccessoryUUID];
        v17 = [v6 activeNetworkRouterInitialSetupNeededUUID];
        -[HMDHome setActiveNetworkRouterInitialSetupNeeded:](self, "setActiveNetworkRouterInitialSetupNeeded:", [v16 isEqual:v17]);
      }

      else
      {
        [(HMDHome *)self setActiveNetworkRouterInitialSetupNeeded:0];
      }
    }

    v18 = v15 ^ 1;
  }

  else
  {
    v18 = 0;
  }

  v19 = [v6 setProperties];
  v20 = [v19 containsObject:@"minimumNetworkRouterSupportHomeKitVersion"];

  if (v20)
  {
    v21 = [v6 minimumNetworkRouterSupportHomeKitVersion];

    if (v21)
    {
      v22 = [HMDHomeKitVersion alloc];
      v23 = [v6 minimumNetworkRouterSupportHomeKitVersion];
      v21 = [(HMDHomeKitVersion *)v22 initWithString:v23];
    }

    v24 = +[HMDHomeKitVersion version6];
    if (-[HMDHome isOwnerUser](self, "isOwnerUser") && [v8 source] != 1 && -[HMDHomeKitVersion isGreaterThanVersion:](v21, "isGreaterThanVersion:", v24))
    {
      v25 = objc_autoreleasePoolPush();
      v26 = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v45 = v25;
        v29 = v28 = v24;
        *buf = 138543874;
        v54 = v29;
        v55 = 2112;
        v56 = v21;
        v57 = 2112;
        v58 = v28;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Overriding minimum router support HomeKit version to enable network router support from %@ in cloud to our version %@", buf, 0x20u);

        v24 = v28;
        v25 = v45;
      }

      objc_autoreleasePoolPop(v25);
      v30 = [(HMDHome *)v26 workQueue];
      block = MEMORY[0x277D85DD0];
      v47 = 3221225472;
      v48 = __56__HMDHome_updateNetworkRouterSettingsWithModel_message___block_invoke;
      v49 = &unk_27868A010;
      v50 = v26;
      v51 = v21;
      v52 = v7;
      dispatch_async(v30, &block);
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      v32 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        [(HMDHome *)v32 minimumNetworkRouterSupportHomeKitVersion];
        v45 = v8;
        v36 = v35 = v24;
        *buf = 138543874;
        v54 = v34;
        v55 = 2112;
        v56 = v36;
        v57 = 2112;
        v58 = v21;
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Updating minimum router support HomeKit version to enable network router support from %@ to cloud version %@", buf, 0x20u);

        v24 = v35;
        v8 = v45;
      }

      objc_autoreleasePoolPop(v31);
      [(HMDHome *)v32 setMinimumNetworkRouterSupportHomeKitVersion:v21];
      v18 = 1;
    }
  }

  v37 = [v6 setProperties];
  v38 = [v37 containsObject:@"minHomeKitVersionForAccessoryNetworkProtectionChange"];

  if (v38)
  {
    v39 = [v6 minHomeKitVersionForAccessoryNetworkProtectionChange];

    if (v39)
    {
      v40 = [HMDHomeKitVersion alloc];
      v41 = [v6 minHomeKitVersionForAccessoryNetworkProtectionChange];
      v39 = [(HMDHomeKitVersion *)v40 initWithString:v41];
    }

    v42 = [(HMDHome *)self minHomeKitVersionForAccessoryNetworkProtectionChange];
    v43 = HMFEqualObjects();

    if (v43)
    {

      if ((v18 & 1) == 0)
      {
        goto LABEL_31;
      }
    }

    else
    {
      [(HMDHome *)self setMinHomeKitVersionForAccessoryNetworkProtectionChange:v39];
    }
  }

  else if (!v18)
  {
    goto LABEL_31;
  }

  [(HMDHome *)self _evaluateNetworkRouterManagementForTransaction:v8];
  [v8 markChanged];
LABEL_31:
  [v7 respondWithPayload:0];

  v44 = *MEMORY[0x277D85DE8];
}

- (void)updateHomeConfigurationWithModel:(id)a3 message:(id)a4
{
  v31 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 transactionResult];
  v9 = [v6 setProperties];
  v10 = [v9 containsObject:@"configurationVersion"];

  if (v10)
  {
    v11 = [v6 configurationVersion];
    v12 = [v11 integerValue];

    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = HMFGetLogIdentifier();
      v23 = 138544130;
      v24 = v16;
      v25 = 2048;
      v26 = v12;
      v27 = 2048;
      v28 = [(HMDHome *)v14 lastSyncedConfigurationVersion];
      v29 = 2048;
      v30 = [(HMDHome *)v14 configurationVersion];
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Received incoming configuration version %lu, last synced was %lu, and current is %lu", &v23, 0x2Au);
    }

    objc_autoreleasePoolPop(v13);
    if ([(HMDHome *)v14 isOwnerUser])
    {
      if (v12 >= [(HMDHome *)v14 configurationVersion])
      {
        v21 = [(HMDHome *)v14 configurationVersion];
        if (v21 <= [(HMDHome *)v14 lastSyncedConfigurationVersion])
        {
          [(HMDHome *)v14 setConfigurationVersion:v12];
        }

        else
        {
          [(HMDHome *)v14 setConfigurationVersion:v12 + 1];
          [(HMDHome *)v14 __saveConfigurationVersionTransaction];
        }

        [(HMDHome *)v14 setLastSyncedConfigurationVersion:v12];
      }

      else
      {
        [(HMDHome *)v14 __saveConfigurationVersionTransaction];
      }
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = v14;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        v20 = HMFGetLogIdentifier();
        v23 = 138543362;
        v24 = v20;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Shared user will use incoming configuration version", &v23, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      [(HMDHome *)v18 setConfigurationVersion:v12];
      [(HMDHome *)v18 setLastSyncedConfigurationVersion:v12];
      [(HMDHome *)v18 setExpectedConfigurationVersion:0];
    }
  }

  [v7 respondWithPayload:0];
  [v8 markChanged];

  v22 = *MEMORY[0x277D85DE8];
}

- (id)updateHomeWithModel:(id)a3 message:(id)a4
{
  v319 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)v7 transactionResult];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    *buf = 138543874;
    v315 = v12;
    v316 = 2112;
    *v317 = v6;
    *&v317[8] = 2112;
    v318 = v7;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Updating home with model: %@ / %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v9);
  v13 = [v6 residentSyncClientDidSync];
  -[HMDHome setResidentSyncClientDidSync:](v10, "setResidentSyncClientDidSync:", [v13 BOOLValue]);

  if ([(HMDHome *)v10 residentSyncDidSync])
  {
    v14 = objc_autoreleasePoolPush();
    v15 = v10;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v315 = v17;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Fulfilling resident sync complete promise", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
    v18 = [(HMDHome *)v15 residentSyncClientDidSyncPromise];
    [v18 fulfillWithNoValue];
  }

  v19 = [v6 setProperties];
  v20 = [v19 containsObject:@"owned"];

  v302 = v8;
  if (v20)
  {
    v21 = [v6 owned];
    -[HMDHome setOwnerUser:](v10, "setOwnerUser:", [v21 BOOLValue]);

    v22 = objc_autoreleasePoolPush();
    v23 = v10;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      [(HMDHome *)v23 isOwnerUser];
      v26 = HMFBooleanToString();
      *buf = 138543618;
      v315 = v25;
      v316 = 2112;
      *v317 = v26;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Is this device owner of this home : [%@]", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v27 = [v6 nfcReaderKey];
  v28 = [v6 setProperties];
  v298 = v27;
  if ([v28 containsObject:@"hh2EncodedNfcReaderKey"])
  {
    v29 = [(HMDHome *)v10 nfcReaderKey];
    v30 = HMFEqualObjects();

    if (v30)
    {
      goto LABEL_17;
    }

    v31 = objc_autoreleasePoolPush();
    v32 = v10;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      v35 = [(HMDHome *)v32 nfcReaderKey];
      *buf = 138543874;
      v315 = v34;
      v316 = 2112;
      *v317 = v35;
      *&v317[8] = 2112;
      v318 = v298;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@HH2: Updating nfc reader key from %@ -> %@", buf, 0x20u);

      v27 = v298;
    }

    objc_autoreleasePoolPop(v31);
    v28 = [MEMORY[0x277CBEB38] dictionary];
    v36 = [(HMDHome *)v32 nfcReaderKey];
    [v28 setObject:v36 forKeyedSubscript:@"HMDHomeDidUpdateNFCReaderKeyNotificationKeyPreviousNFCReaderKey"];

    [(HMDHome *)v32 setNfcReaderKey:v27];
    logAndPostNotification(@"HMDHomeDidUpdateNFCReaderKeyNotification", v32, v28);
    [v8 markChanged];
  }

LABEL_17:
  v37 = [v6 setProperties];
  if (([v37 containsObject:@"primaryIPv4NetworkSignature"] & 1) == 0)
  {
    v38 = [v6 setProperties];
    if (([v38 containsObject:@"primaryIPv6NetworkSignature"] & 1) == 0)
    {
      v39 = [v6 setProperties];
      if (([v39 containsObject:@"primaryWiFiSSID"] & 1) == 0)
      {
        v80 = [v6 setProperties];
        v81 = [v80 containsObject:@"primaryWiFiRequiresPassword"];

        if ((v81 & 1) == 0)
        {
          goto LABEL_28;
        }

        goto LABEL_23;
      }
    }
  }

LABEL_23:
  v40 = objc_alloc(MEMORY[0x277CD1AC8]);
  v41 = [v6 primaryWiFiSSID];
  v42 = [v6 primaryWiFiRequiresPassword];
  v43 = [v40 initWithSSID:v41 requiresPassword:{objc_msgSend(v42, "BOOLValue")}];

  v44 = objc_alloc(MEMORY[0x277CD1AA0]);
  v45 = [v6 primaryIPv4NetworkSignature];
  v46 = [v6 primaryIPv6NetworkSignature];
  v47 = [v44 initWithIpv4Addresses:0 ipv6Addresses:0 ipv4NetworkSignature:0 ipv6NetworkSignature:0 binaryIPv4NetworkSignature:v45 binaryIPv6NetworkSignature:v46 routerIPV4:0 routerIPV6:0 wiFiInfo:v43];

  v48 = [(HMDHome *)v10 primaryResidentNetworkInfo];
  LOBYTE(v45) = [v48 isEqual:v47];

  if ((v45 & 1) == 0)
  {
    v49 = objc_autoreleasePoolPush();
    v50 = v10;
    v51 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
    {
      v52 = HMFGetLogIdentifier();
      *buf = 138543618;
      v315 = v52;
      v316 = 2112;
      *v317 = v47;
      _os_log_impl(&dword_229538000, v51, OS_LOG_TYPE_INFO, "%{public}@Updating primary resident network info %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v49);
    [(HMDHome *)v50 setPrimaryResidentNetworkInfo:v47];
    [v8 markChanged];
  }

LABEL_28:
  v53 = [v6 residentSelectionVersion];
  v54 = [v6 setProperties];
  v55 = [v54 containsObject:@"residentSelectionVersion"];

  v56 = v302;
  if (v55)
  {
    v57 = [(HMDHome *)v10 residentSelectionVersion];

    if (v57 != v53)
    {
      v58 = objc_autoreleasePoolPush();
      v59 = v10;
      v60 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v60, OS_LOG_TYPE_INFO))
      {
        v61 = HMFGetLogIdentifier();
        v62 = [(HMDHome *)v59 residentSelectionVersion];
        *buf = 138543874;
        v315 = v61;
        v316 = 2114;
        *v317 = v62;
        *&v317[8] = 2114;
        v318 = v53;
        _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_INFO, "%{public}@Updating resident selection version from %{public}@ to %{public}@", buf, 0x20u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v58);
      [(HMDHome *)v59 setResidentSelectionVersion:v53];
      [v56 markChanged];
    }
  }

  v299 = [(HMDHome *)v10 currentUser];
  v63 = [v6 setProperties];
  v64 = [v63 containsObject:@"presenceAuthorizationStatus"];

  v296 = v53;
  if (v64)
  {
    v65 = MEMORY[0x277CD1F00];
    v66 = [v6 presenceAuthorizationStatus];
    v67 = [v65 authWithNumber:v66];

    if (isPresenceAuthorizationValid())
    {
      v68 = [(HMDHome *)v10 presenceAuthStatus];
      v69 = HMFEqualObjects();

      if (v69)
      {
        v70 = objc_autoreleasePoolPush();
        v71 = v10;
        v72 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v72, OS_LOG_TYPE_INFO))
        {
          v73 = HMFGetLogIdentifier();
          v74 = [(HMDHome *)v71 presenceAuthStatus];
          *buf = 138543618;
          v315 = v73;
          v316 = 2112;
          *v317 = v74;
          _os_log_impl(&dword_229538000, v72, OS_LOG_TYPE_INFO, "%{public}@Presence auth is not changing from %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v70);
      }

      else
      {
        [(HMDHome *)v10 setPresenceAuthStatus:v67];
        [v299 setPresenceAuthStatus:v67];
        [v302 markChanged];
      }

      v295 = v69 ^ 1;
      v56 = v302;
      if (![(HMDHome *)v10 isOwnerUser])
      {
        [v302 markSaveToSharedUserAccount];
      }
    }

    else
    {
      v75 = objc_autoreleasePoolPush();
      v76 = v10;
      v77 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v77, OS_LOG_TYPE_INFO))
      {
        v78 = HMFGetLogIdentifier();
        v79 = [v6 presenceAuthorizationStatus];
        *buf = 138543618;
        v315 = v78;
        v316 = 2112;
        *v317 = v79;
        _os_log_impl(&dword_229538000, v77, OS_LOG_TYPE_INFO, "%{public}@Ignoring the value for presence auth in home model: %@", buf, 0x16u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v75);
      v295 = 0;
    }
  }

  else
  {
    v295 = 0;
  }

  v82 = [v6 setProperties];
  v83 = [v82 containsObject:@"presenceComputeStatus"];

  if (v83)
  {
    v84 = MEMORY[0x277CD1F08];
    v85 = [v6 presenceComputeStatus];
    v86 = [v84 computeWithNumber:v85];

    if (v86)
    {
      v87 = [(HMDHome *)v10 presenceComputeStatus];
      v88 = HMFEqualObjects();

      if ((v88 & 1) == 0)
      {
        [(HMDHome *)v10 setPresenceComputeStatus:v86];
        if (![(HMDHome *)v10 isOwnerUser])
        {
          [v56 markSaveToSharedUserAccount];
        }

        [v56 markChanged];
      }
    }
  }

  v89 = [v6 setProperties];
  v90 = [v89 containsObject:@"homeLocationData"];

  v300 = v7;
  if (v90)
  {
    v91 = [(HMDHome *)v10 homeLocationHandler];
    v92 = [v91 _handleHomeLocationData:v6 message:v7];

    if (v92)
    {
      v93 = v92;
    }

    else
    {
      v94 = [MEMORY[0x277CBEB58] set];
      v308 = 0u;
      v309 = 0u;
      v310 = 0u;
      v311 = 0u;
      v95 = [(HMDHome *)v10 dataSource];
      v96 = [v95 xpcMessageTransport];
      v97 = [v96 connections];

      v98 = [v97 countByEnumeratingWithState:&v308 objects:v313 count:16];
      if (v98)
      {
        v99 = v98;
        v100 = *v309;
        do
        {
          for (i = 0; i != v99; ++i)
          {
            if (*v309 != v100)
            {
              objc_enumerationMutation(v97);
            }

            v102 = [*(*(&v308 + 1) + 8 * i) processInfo];
            v103 = [v102 locationAuthorization];

            if (v103)
            {
              [v94 addObject:v103];
            }
          }

          v99 = [v97 countByEnumeratingWithState:&v308 objects:v313 count:16];
        }

        while (v99);
      }

      v306 = 0u;
      v307 = 0u;
      v304 = 0u;
      v305 = 0u;
      v104 = v94;
      v105 = [v104 countByEnumeratingWithState:&v304 objects:v312 count:16];
      if (v105)
      {
        v106 = v105;
        v107 = *v305;
        do
        {
          for (j = 0; j != v106; ++j)
          {
            if (*v305 != v107)
            {
              objc_enumerationMutation(v104);
            }

            v109 = *(*(&v304 + 1) + 8 * j);
            if ([v109 isAuthorized])
            {
              [v109 mark];
            }
          }

          v106 = [v104 countByEnumeratingWithState:&v304 objects:v312 count:16];
        }

        while (v106);
      }

      v93 = 0;
      v7 = v300;
    }

    v56 = v302;
  }

  else
  {
    v93 = 0;
  }

  v110 = [v6 naturalLightingContext];
  v111 = [v6 setProperties];
  v301 = v110;
  if ([v111 containsObject:@"encodedNaturalLightingContext"])
  {
    v112 = [(HMDHome *)v10 naturalLightingContext];
    v113 = [v112 isEqual:v110];

    if ((v113 & 1) == 0)
    {
      v114 = objc_autoreleasePoolPush();
      v115 = v10;
      v116 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v116, OS_LOG_TYPE_INFO))
      {
        v117 = HMFGetLogIdentifier();
        v118 = [(HMDHome *)v115 naturalLightingContext];
        *buf = 138543874;
        v315 = v117;
        v316 = 2112;
        *v317 = v118;
        *&v317[8] = 2112;
        v318 = v301;
        _os_log_impl(&dword_229538000, v116, OS_LOG_TYPE_INFO, "%{public}@Updating natural lighting context from %@ -> %@", buf, 0x20u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v114);
      [(HMDHome *)v115 setNaturalLightingContext:v301];
      [v56 markChanged];
    }
  }

  else
  {
  }

  v119 = [v6 setProperties];
  if (![v119 containsObject:@"name"])
  {
    goto LABEL_91;
  }

  v120 = [v6 name];
  v121 = [(HMDHome *)v10 name];
  v122 = [v120 isEqualToString:v121];

  if ((v122 & 1) == 0)
  {
    v123 = [(HMDHome *)v10 _handleRenameHomeModel:v6 message:v7];
    v119 = v123;
    if (v123)
    {
      v124 = v123;

      v93 = v124;
    }

    [v56 markSaveToAssistant];
    [v56 markChanged];
LABEL_91:
  }

  v125 = [v6 creationDate];
  if (v125)
  {
    v126 = v125;
    v127 = [v6 creationDate];
    v128 = [(HMDHome *)v10 creationDate];
    v129 = [v127 isEqualToDate:v128];

    if ((v129 & 1) == 0)
    {
      v130 = [v6 creationDate];
      [(HMDHome *)v10 setCreationDate:v130];

      [v56 markChanged];
    }
  }

  v131 = [v6 firstHAPAccessoryAddedDate];
  if (v131)
  {
    v132 = v131;
    v133 = [v6 firstHAPAccessoryAddedDate];
    v134 = [(HMDHome *)v10 firstHAPAccessoryAddedDate];
    v135 = [v133 isEqualToDate:v134];

    if ((v135 & 1) == 0)
    {
      v136 = [v6 firstHAPAccessoryAddedDate];
      [(HMDHome *)v10 setFirstHAPAccessoryAddedDate:v136];

      [v56 markChanged];
    }
  }

  v137 = [v6 setProperties];
  if ([v137 containsObject:@"multiUserEnabled"])
  {
    v138 = [v6 multiUserEnabled];
    v139 = [v138 BOOLValue];
    v140 = [(HMDHome *)v10 isMultiUserEnabled];

    if (v139 != v140)
    {
      v141 = objc_autoreleasePoolPush();
      v142 = v10;
      v143 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v143, OS_LOG_TYPE_INFO))
      {
        v144 = HMFGetLogIdentifier();
        v145 = [v6 multiUserEnabled];
        v146 = @"YES";
        *buf = 138543874;
        v315 = v144;
        v316 = 2112;
        if (!v145)
        {
          v146 = @"NO";
        }

        *v317 = v146;
        *&v317[8] = 2112;
        v318 = v142;
        _os_log_impl(&dword_229538000, v143, OS_LOG_TYPE_INFO, "%{public}@Merging multi-user enabled value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v141);
      [(HMDHome *)v142 _handleMultiUserEnabledChange:v6 message:v7];
      [v56 markChanged];
    }
  }

  else
  {
  }

  if ([v6 propertyWasSet:@"soundCheckEnabled"])
  {
    v147 = [v6 soundCheckEnabled];
    v148 = [v147 BOOLValue];
    v149 = [(HMDHome *)v10 soundCheckEnabled];

    if (v148 != v149)
    {
      [(HMDHome *)v10 _handleSoundCheckChange:v6 message:v7];
      [v56 markChanged];
    }
  }

  if ([v6 propertyWasSet:@"analysisOptions"])
  {
    v150 = [v6 analysisOptions];
    v151 = [v150 unsignedIntegerValue];
    v152 = [(HMDHome *)v10 audioAnalysisClassifierOptions];

    if (v151 != v152)
    {
      [(HMDHome *)v10 _handleAudioAnalysisClassifierOptionsChange:v6 message:v7];
      [v56 markChanged];
    }
  }

  if ([v6 propertyWasSet:@"didOnboardAnalysis"])
  {
    v153 = [v6 didOnboardAnalysis];
    v154 = [v153 BOOLValue];
    v155 = [(HMDHome *)v10 didOnboardAudioAnalysis];

    if (v154 != v155)
    {
      [(HMDHome *)v10 _handleAudioAnalysisOnboardingStatusChange:v6 message:v7];
      [v56 markChanged];
    }
  }

  if ([v6 propertyWasSet:@"siriPhraseOptions"])
  {
    v156 = [v6 siriPhraseOptions];
    v157 = [v156 unsignedIntegerValue];
    v158 = [(HMDHome *)v10 siriPhraseOptions];

    if (v157 != v158)
    {
      [(HMDHome *)v10 _handleSiriPhraseOptionsStatusChange:v6 message:v7];
      [v56 markChanged];
    }
  }

  if ([v6 propertyWasSet:@"locationServicesEnabled"])
  {
    v159 = [v6 locationServicesEnabled];
    v160 = [v159 BOOLValue];
    v161 = [(HMDHome *)v10 locationServicesEnabled];

    if (v160 != v161)
    {
      [(HMDHome *)v10 _handleLocationServicesEnabledChange:v6 message:v7];
      [v56 markChanged];
    }
  }

  if ([v6 propertyWasSet:@"didOnboardLocationServices"])
  {
    v162 = [v6 didOnboardLocationServices];
    v163 = [v162 BOOLValue];
    v164 = [(HMDHome *)v10 didOnboardLocationServices];

    if (v163 != v164)
    {
      [(HMDHome *)v10 _handleDidOnboardLocationServicesChange:v6 message:v7];
      [v56 markChanged];
    }
  }

  v165 = [v6 setProperties];
  if ([v165 containsObject:@"hasAnyUserAcknowledgedCameraRecordingOnboarding"])
  {
    v166 = [v6 hasAnyUserAcknowledgedCameraRecordingOnboarding];
    v167 = [v166 BOOLValue];
    v168 = [(HMDHome *)v10 hasAnyUserAcknowledgedCameraRecordingOnboarding];

    if (v167 != v168)
    {
      v169 = objc_autoreleasePoolPush();
      v170 = v10;
      v171 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v171, OS_LOG_TYPE_INFO))
      {
        v172 = HMFGetLogIdentifier();
        v173 = [v6 hasAnyUserAcknowledgedCameraRecordingOnboarding];
        v174 = @"YES";
        *buf = 138543874;
        v315 = v172;
        v316 = 2112;
        if (!v173)
        {
          v174 = @"NO";
        }

        *v317 = v174;
        *&v317[8] = 2112;
        v318 = v170;
        _os_log_impl(&dword_229538000, v171, OS_LOG_TYPE_INFO, "%{public}@Merging home's has any user acknowledged camera recording onboarding value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v169);
      [(HMDHome *)v170 _handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:v6 message:v7];
      [v56 markChanged];
    }
  }

  else
  {
  }

  v175 = [v6 setProperties];
  if ([v175 containsObject:@"hasOnboardedForAccessCode"])
  {
    v176 = [v6 hasOnboardedForAccessCode];
    v177 = [v176 BOOLValue];
    v178 = [(HMDHome *)v10 hasOnboardedForAccessCode];

    if (v177 != v178)
    {
      v179 = objc_autoreleasePoolPush();
      v180 = v10;
      v181 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v181, OS_LOG_TYPE_INFO))
      {
        v182 = HMFGetLogIdentifier();
        v183 = [v6 hasOnboardedForAccessCode];
        [v183 BOOLValue];
        v184 = HMFBooleanToString();
        *buf = 138543874;
        v315 = v182;
        v316 = 2112;
        *v317 = v184;
        *&v317[8] = 2112;
        v318 = v180;
        _os_log_impl(&dword_229538000, v181, OS_LOG_TYPE_INFO, "%{public}@Merging home's has onboarded for access code value %@ into home: %@", buf, 0x20u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v179);
      [(HMDHome *)v180 _handleSetHasOnboardedForAccessCodeChange:v6 message:v7];
      [v56 markChanged];
    }
  }

  else
  {
  }

  v185 = [v6 setProperties];
  if ([v185 containsObject:@"hasOnboardedForWalletKey"])
  {
    v186 = [v6 hasOnboardedForWalletKey];
    v187 = [v186 BOOLValue];
    v188 = [(HMDHome *)v10 hasOnboardedForWalletKey];

    if (v187 != v188)
    {
      v189 = objc_autoreleasePoolPush();
      v190 = v10;
      v191 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v191, OS_LOG_TYPE_INFO))
      {
        v192 = HMFGetLogIdentifier();
        v193 = [v6 hasOnboardedForWalletKey];
        [v193 BOOLValue];
        v194 = HMFBooleanToString();
        *buf = 138543874;
        v315 = v192;
        v316 = 2112;
        *v317 = v194;
        *&v317[8] = 2112;
        v318 = v190;
        _os_log_impl(&dword_229538000, v191, OS_LOG_TYPE_INFO, "%{public}@Merging home's has onboarded for wallet key value %@ into home: %@", buf, 0x20u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v189);
      [(HMDHome *)v190 _handleSetHasOnboardedForWalletKeyChange:v6 message:v7];
      [v56 markChanged];
    }
  }

  else
  {
  }

  v195 = [v6 setProperties];
  v196 = [v195 containsObject:@"networkProtectionMode"];

  if (v196)
  {
    [(HMDHome *)v10 _handleUpdateNetworkProtectionWithHomeModel:v6 message:v7];
  }

  if (![(HMDHome *)v10 isOwnerUser])
  {
    v217 = [v56 source] != 2 && objc_msgSend(v56, "source") != 3;
    v279 = [v6 setProperties];
    v280 = [v279 containsObject:@"sharedHomeSourceVersion"];

    if (v280)
    {
      if (v217)
      {
        [(HMDHome *)v10 _handleReceivedNonCloudSourcedSharedHomeModel];
        v281 = objc_autoreleasePoolPush();
        v282 = v10;
        v283 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v283, OS_LOG_TYPE_INFO))
        {
          v284 = HMFGetLogIdentifier();
          v285 = [(HMDHome *)v282 sharedHomeSourceVersion];
          v286 = [v6 sharedHomeSourceVersion];
          *buf = 138543874;
          v315 = v284;
          v316 = 2112;
          *v317 = v285;
          *&v317[8] = 2112;
          v318 = v286;
          _os_log_impl(&dword_229538000, v283, OS_LOG_TYPE_INFO, "%{public}@Updating shared home source version from %@ to %@", buf, 0x20u);

          v56 = v302;
        }

        objc_autoreleasePoolPop(v281);
        v287 = [(HMDHome *)v282 sharedHomeSourceVersion];
        v288 = [v6 sharedHomeSourceVersion];
        v289 = HMFEqualObjects();

        if ((v289 & 1) == 0)
        {
          v290 = [v6 sharedHomeSourceVersion];
          [(HMDHome *)v282 setSharedHomeSourceVersion:v290];

          [v56 markChanged];
        }
      }
    }
  }

  v197 = v300;
  if ([v6 propertyWasSet:@"threadOperationalDataset"])
  {
    v198 = [v6 threadOperationalDataset];

    if (v198)
    {
      [(HMDHome *)v10 updateThreadOperationalDatasetWithHomeModel:v6 message:v300];
    }
  }

  if ([v6 propertyWasSet:@"matCredGRK"])
  {
    v199 = [(HMDHome *)v10 acwgGroupResolvingKey];
    v200 = [v6 matCredGRK];
    v201 = HMFEqualObjects();

    if ((v201 & 1) == 0)
    {
      v202 = objc_autoreleasePoolPush();
      v203 = v10;
      v204 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v204, OS_LOG_TYPE_INFO))
      {
        v205 = HMFGetLogIdentifier();
        v206 = [v6 matCredGRK];
        *buf = 138543618;
        v315 = v205;
        v316 = 2112;
        *v317 = v206;
        _os_log_impl(&dword_229538000, v204, OS_LOG_TYPE_INFO, "%{public}@Updating acwgGroupResolvingKey to: %@", buf, 0x16u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v202);
      v207 = [v6 matCredGRK];
      [(HMDHome *)v203 setAcwgGroupResolvingKey:v207];

      [v56 markChanged];
    }
  }

  [(HMDHome *)v10 handleUpdatedCHIPPropertiesOnHomeModel:v6 actions:v56];
  v297 = v93;
  if (![v6 propertyWasSet:@"didOnboardEventLog"])
  {
    goto LABEL_164;
  }

  v208 = [v6 didOnboardEventLog];
  v209 = [v208 BOOLValue];

  if (v209 == [(HMDHome *)v10 didOnboardEventLog])
  {
    if ((v209 & 1) == 0)
    {
      [(HMDHome *)v10 _maybeFixHindsightOnboardingOnCurrentDevice];
    }

LABEL_164:
    v216 = 0;
    goto LABEL_165;
  }

  [(HMDHome *)v10 setDidOnboardEventLog:v209];
  v210 = objc_autoreleasePoolPush();
  v211 = v10;
  v212 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v212, OS_LOG_TYPE_DEFAULT))
  {
    v213 = HMFGetLogIdentifier();
    objc_opt_class();
    objc_opt_self();
    v214 = @"[Hindsight]";
    v215 = HMFBooleanToString();
    *buf = 138543874;
    v315 = v213;
    v316 = 2114;
    *v317 = @"[Hindsight]";
    *&v317[8] = 2114;
    v318 = v215;
    _os_log_impl(&dword_229538000, v212, OS_LOG_TYPE_DEFAULT, "%{public}@%{public}@ Activity history did onboard is now %{public}@", buf, 0x20u);

    v197 = v300;
    v56 = v302;
  }

  objc_autoreleasePoolPop(v210);
  [v56 markChanged];
  [(HMDHome *)v211 _didOnboardHindsightChanged];
  v216 = 1;
LABEL_165:
  if ([v6 propertyWasSet:@"eventLogHomeSettingEnabled"])
  {
    v218 = [v6 eventLogHomeSettingEnabled];
    v219 = [v218 BOOLValue];

    if (v219 != [(HMDHome *)v10 isEventLogHomeSettingEnabled])
    {
      [(HMDHome *)v10 setEventLogHomeSettingEnabled:v219];
      v220 = objc_autoreleasePoolPush();
      v221 = v10;
      v222 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v222, OS_LOG_TYPE_DEFAULT))
      {
        v223 = HMFGetLogIdentifier();
        objc_opt_class();
        objc_opt_self();
        v224 = @"[Hindsight]";
        v225 = HMFEnabledStatusToString();
        *buf = 138543874;
        v315 = v223;
        v316 = 2114;
        *v317 = @"[Hindsight]";
        *&v317[8] = 2114;
        v318 = v225;
        _os_log_impl(&dword_229538000, v222, OS_LOG_TYPE_DEFAULT, "%{public}@%{public}@ Activity history is now %{public}@", buf, 0x20u);

        v197 = v300;
        v56 = v302;
      }

      objc_autoreleasePoolPop(v220);
      [v56 markChanged];
      v216 = 1;
    }
  }

  if ([v6 propertyWasSet:@"eventLogDuration"])
  {
    v226 = [v6 eventLogDuration];
    v227 = [v226 unsignedIntegerValue];

    if ([(HMDHome *)v10 eventLogDuration]!= v227)
    {
      [(HMDHome *)v10 setEventLogDuration:v227];
      v228 = objc_autoreleasePoolPush();
      v229 = v10;
      v230 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v230, OS_LOG_TYPE_DEFAULT))
      {
        v231 = HMFGetLogIdentifier();
        objc_opt_class();
        objc_opt_self();
        v232 = @"[Hindsight]";
        *buf = 138543874;
        v315 = v231;
        v316 = 2114;
        *v317 = @"[Hindsight]";
        *&v317[8] = 2048;
        v318 = v227;
        _os_log_impl(&dword_229538000, v230, OS_LOG_TYPE_DEFAULT, "%{public}@%{public}@ Activity history duration is now %lu days", buf, 0x20u);

        v197 = v300;
      }

      objc_autoreleasePoolPop(v228);
      [v56 markChanged];
    }
  }

  if (v216)
  {
    [(HMDHome *)v10 _synchronizeHindsightCloudShareManager];
  }

  v233 = v297;
  if ([v6 propertyWasSet:@"timeZone"])
  {
    v234 = [v6 timeZone];
    v235 = [(HMDHome *)v10 timeZone];
    v236 = HMFEqualObjects();

    if ((v236 & 1) == 0)
    {
      v237 = objc_autoreleasePoolPush();
      v238 = v10;
      v239 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v239, OS_LOG_TYPE_INFO))
      {
        v240 = HMFGetLogIdentifier();
        v241 = [(HMDHome *)v238 timeZone];
        v242 = [v6 timeZone];
        *buf = 138543874;
        v315 = v240;
        v316 = 2112;
        *v317 = v241;
        *&v317[8] = 2112;
        v318 = v242;
        _os_log_impl(&dword_229538000, v239, OS_LOG_TYPE_INFO, "%{public}@Home timeZone was updated to: %@ from : %@", buf, 0x20u);

        v56 = v302;
      }

      objc_autoreleasePoolPop(v237);
      v243 = [v6 timeZone];
      [(HMDHome *)v238 setTimeZone:v243];

      v244 = [(HMDHome *)v238 timeZone];

      if (!v244)
      {
        v245 = [MEMORY[0x277CBEBB0] localTimeZone];
        [(HMDHome *)v238 setTimeZone:v245];
      }

      [v56 markChanged];
    }
  }

  if ([v6 propertyWasSet:@"numberOfCameras"])
  {
    v246 = [v6 numberOfCameras];
    v247 = [(HMDHome *)v10 numberOfCameras];
    v248 = HMFEqualObjects();

    if ((v248 & 1) == 0)
    {
      v249 = objc_autoreleasePoolPush();
      v250 = v10;
      v251 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v251, OS_LOG_TYPE_INFO))
      {
        v252 = HMFGetLogIdentifier();
        v253 = [(HMDHome *)v250 numberOfCameras];
        v254 = [v253 unsignedIntValue];
        v255 = [v6 numberOfCameras];
        v256 = [v255 unsignedIntValue];
        *buf = 138543874;
        v315 = v252;
        v316 = 1024;
        *v317 = v254;
        v56 = v302;
        *&v317[4] = 1024;
        *&v317[6] = v256;
        _os_log_impl(&dword_229538000, v251, OS_LOG_TYPE_INFO, "%{public}@Home numberOfCameras changed from %u to %u", buf, 0x18u);

        v233 = v297;
      }

      objc_autoreleasePoolPop(v249);
      v257 = [v6 numberOfCameras];
      [(HMDHome *)v250 setNumberOfCameras:v257];

      [v56 markChanged];
    }
  }

  v258 = [v6 setProperties];
  v259 = [v258 containsObject:@"isAllowedToEnableAdaptiveTemperatureAutomations"];

  if (v259)
  {
    v260 = [v6 isAllowedToEnableAdaptiveTemperatureAutomations];
    v261 = [v260 BOOLValue];
    v262 = [(HMDHome *)v10 isAllowedToEnableAdaptiveTemperatureAutomations];

    if (v261 != v262)
    {
      v263 = objc_autoreleasePoolPush();
      v264 = v10;
      v265 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v265, OS_LOG_TYPE_INFO))
      {
        v266 = HMFGetLogIdentifier();
        v267 = [(HMDHome *)v264 isAllowedToEnableAdaptiveTemperatureAutomations];
        v268 = [v6 isAllowedToEnableAdaptiveTemperatureAutomations];
        v269 = [v268 BOOLValue];
        *buf = 138543874;
        v315 = v266;
        v316 = 1024;
        *v317 = v267;
        *&v317[4] = 1024;
        *&v317[6] = v269;
        _os_log_impl(&dword_229538000, v265, OS_LOG_TYPE_INFO, "%{public}@allowedToEnableAdaptiveTemperatureAutomations changed from %{BOOL}d to %{BOOL}d", buf, 0x18u);

        v233 = v297;
      }

      objc_autoreleasePoolPop(v263);
      v270 = [v6 isAllowedToEnableAdaptiveTemperatureAutomations];
      -[HMDHome setAllowedToEnableAdaptiveTemperatureAutomations:](v264, "setAllowedToEnableAdaptiveTemperatureAutomations:", [v270 BOOLValue]);

      [v56 markChanged];
      if ([(HMDHome *)v264 isAllowedToEnableAdaptiveTemperatureAutomations])
      {
        v271 = [(HMDHome *)v264 workQueue];
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __39__HMDHome_updateHomeWithModel_message___block_invoke;
        block[3] = &unk_27868A728;
        block[4] = v264;
        dispatch_async(v271, block);
      }
    }
  }

  v272 = [(HMDHome *)v197 responseHandler];

  if (v272)
  {
    v273 = [(HMDHome *)v197 responseHandler];
    (v273)[2](v273, v233, 0);
  }

  v274 = v301;
  if (v295)
  {
    v275 = [(HMDHome *)v197 name];
    v276 = HMFEqualObjects();

    v277 = [(HMDHome *)v10 presenceFeeder];
    v278 = v277;
    if (v276)
    {
      [v277 presenceAuthChanged];
    }

    else
    {
      v291 = [(HMDHome *)v10 presenceAuthStatus];
      [v278 presenceAuthStatusChangedForUser:v299 presenceAuthStatus:v291];
    }

    v274 = v301;
  }

  v292 = v233;

  v293 = *MEMORY[0x277D85DE8];
  return v233;
}

- (void)_handleUpdateNetworkProtectionWithHomeModel:(id)a3 message:(id)a4
{
  v9 = a4;
  v6 = [a3 networkProtectionMode];
  v7 = [v6 unsignedIntegerValue];

  if ([(HMDHome *)self protectionMode]!= v7)
  {
    [(HMDHome *)self setProtectionMode:v7];
    v8 = [v9 transactionResult];
    [(HMDHome *)self _handleNetworkProtectionModeChangeForTransaction:v8];
    [v8 markChanged];
  }
}

- (NSNumber)availableBorderRouters
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_availableBorderRouters;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setAvailableBorderRouters:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  availableBorderRouters = self->_availableBorderRouters;
  self->_availableBorderRouters = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSNumber)availableBSPsCount
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_availableBSPsCount;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setAvailableBSPsCount:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  availableBSPsCount = self->_availableBSPsCount;
  self->_availableBSPsCount = v4;

  os_unfair_recursive_lock_unlock();
}

- (id)dumpMediaSessionDescriptionWithPrivacyLevel:(unint64_t)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = MEMORY[0x277CBEB18];
  v6 = [(HMDHome *)self mediaSessionStates];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(v6, "count")}];

  v18 = 0u;
  v19 = 0u;
  v16 = 0u;
  v17 = 0u;
  v8 = [(HMDHome *)self mediaSessionStates];
  v9 = [v8 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v17;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v17 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = [*(*(&v16 + 1) + 8 * i) dumpStateWithPrivacyLevel:a3];
        [v7 addObject:v13];
      }

      v10 = [v8 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v10);
  }

  v14 = *MEMORY[0x277D85DE8];

  return v7;
}

- (id)dumpCharacteristicNotificationRegistry
{
  v3 = MEMORY[0x277CCAB68];
  v4 = [(HMDHome *)self name];
  v5 = [(HMDHome *)self uuid];
  v6 = [v5 UUIDString];
  v7 = [v3 stringWithFormat:@"Home %@/%@:", v4, v6];

  v8 = [(HMDHome *)self notificationRegistry];
  v9 = [v8 shortDescription];
  [v7 appendString:v9];

  return v7;
}

- (id)dumpActionSetDescriptionWithPrivacyLevel:(unint64_t)a3
{
  v33 = *MEMORY[0x277D85DE8];
  v5 = MEMORY[0x277CBEB18];
  v6 = [(HMDHome *)self mediaSessionStates];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(v6, "count")}];

  v8 = [(HMDHome *)self actionSets];
  v27 = 0u;
  v28 = 0u;
  v29 = 0u;
  v30 = 0u;
  v9 = [v8 countByEnumeratingWithState:&v27 objects:v32 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v28;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v28 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = [*(*(&v27 + 1) + 8 * i) dumpStateWithPrivacyLevel:a3];
        [v7 addObject:v13];
      }

      v10 = [v8 countByEnumeratingWithState:&v27 objects:v32 count:16];
    }

    while (v10);
  }

  v14 = [(HMDHome *)self triggerOwnedActionSets];
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v15 = [v14 countByEnumeratingWithState:&v23 objects:v31 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v24;
    do
    {
      for (j = 0; j != v16; ++j)
      {
        if (*v24 != v17)
        {
          objc_enumerationMutation(v14);
        }

        v19 = [*(*(&v23 + 1) + 8 * j) dumpStateWithPrivacyLevel:a3];
        [v7 addObject:v19];
      }

      v16 = [v14 countByEnumeratingWithState:&v23 objects:v31 count:16];
    }

    while (v16);
  }

  v20 = [v7 copy];

  v21 = *MEMORY[0x277D85DE8];

  return v20;
}

- (void)doFullImportWithCompletion:(id)a3
{
  v4 = a3;
  v6 = +[HMDCoreDataCloudTransform sharedInstance];
  v5 = [(HMDHome *)self uuid];
  [v6 runCompleteMergeTransformForHomeWithModelID:v5 completion:v4];
}

- (void)_handleResponseForElectMessageToResident:(id)a3 error:(id)a4
{
  v44 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v8);

  if ([(HMDHome *)self remoteAccessIsEnabled])
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
LABEL_5:

      objc_autoreleasePoolPop(v9);
      goto LABEL_19;
    }

    v12 = HMFGetLogIdentifier();
    v13 = [v6 userID];
    v38 = 138543618;
    v39 = v12;
    v40 = 2112;
    v41 = v13;
    v14 = "%{public}@Received response for ping message to resident %@. Remote access is already setup, dropping response";
LABEL_4:
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, v14, &v38, 0x16u);

    goto LABEL_5;
  }

  if (v7)
  {
    v15 = [v7 domain];
    if ([v15 isEqualToString:*MEMORY[0x277D18538]])
    {
      if ([v7 code] == 16)
      {

LABEL_21:
        v9 = objc_autoreleasePoolPush();
        v10 = self;
        v11 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          goto LABEL_5;
        }

        v12 = HMFGetLogIdentifier();
        v13 = [v6 userID];
        v38 = 138543618;
        v39 = v12;
        v40 = 2112;
        v41 = v13;
        v14 = "%{public}@Failed to ping resident %@, will try again at next heartbeat";
        goto LABEL_4;
      }

      v37 = [v7 code];

      if (v37 == 23)
      {
        goto LABEL_21;
      }
    }

    else
    {
    }

    v29 = objc_autoreleasePoolPush();
    v30 = self;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
    {
      v32 = HMFGetLogIdentifier();
      v33 = [v6 userID];
      v38 = 138543874;
      v39 = v32;
      v40 = 2112;
      v41 = v33;
      v42 = 2112;
      v43 = v7;
      _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_INFO, "%{public}@Failed to ping resident %@, but error %@ is not specific IDS error, will not re-try at next heartbeat", &v38, 0x20u);
    }

    objc_autoreleasePoolPop(v29);
    v34 = [(HMDHome *)v30 heartbeatPingMessagesQueuedWithServer];
    v35 = [v6 userID];
    [v34 addObject:v35];
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v6 userID];
      v38 = 138543618;
      v39 = v19;
      v40 = 2112;
      v41 = v20;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Successfully sent ping message to resident %@, remembering queued message", &v38, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v21 = [(HMDHome *)v17 heartbeatPingMessagesQueuedWithServer];
    v22 = [v6 userID];
    [v21 addObject:v22];

    v23 = objc_autoreleasePoolPush();
    v24 = v17;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      v38 = 138543362;
      v39 = v26;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled, requesting electing a remote peer", &v38, 0xCu);
    }

    objc_autoreleasePoolPop(v23);
    v27 = [(HMDHome *)v24 homeManager];
    v28 = [(HMDHome *)v24 uuid];
    [v27 electRemoteAccessPeerForHome:v28];
  }

LABEL_19:

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_remoteAccessHealthMonitorTimerDidFire
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  if (![(HMDHome *)self remoteAccessIsEnabled])
  {
    v4 = [(HMDHome *)self _residentUsers];
    objc_initWeak(&location, self);
    v31 = 0u;
    v32 = 0u;
    v29 = 0u;
    v30 = 0u;
    obj = v4;
    v5 = [obj countByEnumeratingWithState:&v29 objects:v38 count:16];
    if (v5)
    {
      v26 = *v30;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v30 != v26)
          {
            objc_enumerationMutation(obj);
          }

          v7 = *(*(&v29 + 1) + 8 * i);
          v8 = [(HMDHome *)self heartbeatPingMessagesQueuedWithServer];
          v9 = [v7 userID];
          v10 = [v8 containsObject:v9];

          v11 = objc_autoreleasePoolPush();
          v12 = self;
          if (v10)
          {
            v13 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
            {
              v14 = HMFGetLogIdentifier();
              v15 = [v7 userID];
              *buf = 138543618;
              v35 = v14;
              v36 = 2112;
              v37 = v15;
              _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Remote access health monitor fired, but we already have a ping queued with server to %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v11);
          }

          else
          {
            v16 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
            {
              v17 = HMFGetLogIdentifier();
              v18 = [v7 userID];
              *buf = 138543618;
              v35 = v17;
              v36 = 2112;
              v37 = v18;
              _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Remote access health monitor fired, sending ping elect message to %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v11);
            aBlock[0] = MEMORY[0x277D85DD0];
            aBlock[1] = 3221225472;
            aBlock[2] = __49__HMDHome__remoteAccessHealthMonitorTimerDidFire__block_invoke;
            aBlock[3] = &unk_278670840;
            objc_copyWeak(&v28, &location);
            aBlock[4] = v7;
            v19 = _Block_copy(aBlock);
            v20 = [(HMDHome *)v12 homeManager];
            v21 = [v7 userID];
            v22 = [v7 userID];
            v23 = [(HMDHome *)v12 workQueue];
            [v20 electDeviceForUser:v21 destination:v22 deviceCapabilities:0 responseTimeout:v23 queue:v19 completionHandler:600.0];

            objc_destroyWeak(&v28);
          }
        }

        v5 = [obj countByEnumeratingWithState:&v29 objects:v38 count:16];
      }

      while (v5);
    }

    objc_destroyWeak(&location);
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome__remoteAccessHealthMonitorTimerDidFire__block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v6)
    {
      v4 = [v6 userInfo];
      v5 = [v4 objectForKeyedSubscript:*MEMORY[0x277CCA7E8]];

      [WeakRetained _handleResponseForElectMessageToResident:*(a1 + 32) error:v5];
    }

    else
    {
      [WeakRetained _handleResponseForElectMessageToResident:*(a1 + 32) error:0];
    }
  }
}

- (void)remoteAccessHealthMonitorTimerDidFire
{
  if (isiOSDevice())
  {
    v3 = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __48__HMDHome_remoteAccessHealthMonitorTimerDidFire__block_invoke;
    block[3] = &unk_27868A728;
    block[4] = self;
    dispatch_async(v3, block);
  }
}

- (void)_handleDidReceiveIDSMessageWithNoListenerFromAddress:(id)a3
{
  v36 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = shouldLogPrivateInformation();
  v6 = @"...";
  if (v5)
  {
    v6 = v4;
  }

  v7 = v6;
  if ([(HMDHome *)self remoteAccessIsEnabled])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v11;
      v34 = 2112;
      v35 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Received IDS message from %@ but home has remote access enabled, ignoring notification", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  else
  {
    v29 = 0u;
    v30 = 0u;
    v27 = 0u;
    v28 = 0u;
    v12 = [(HMDHome *)self _residentUsers];
    v13 = [v12 countByEnumeratingWithState:&v27 objects:v31 count:16];
    if (v13)
    {
      v14 = v13;
      v15 = *v28;
      while (2)
      {
        for (i = 0; i != v14; ++i)
        {
          if (*v28 != v15)
          {
            objc_enumerationMutation(v12);
          }

          v17 = *(*(&v27 + 1) + 8 * i);
          if ([v17 configurationState] == 2)
          {
            v18 = [v17 userID];
            v19 = [v18 isEqualToString:v4];

            if (v19)
            {
              v20 = objc_autoreleasePoolPush();
              v21 = self;
              v22 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
              {
                v23 = HMFGetLogIdentifier();
                *buf = 138543618;
                v33 = v23;
                v34 = 2112;
                v35 = v7;
                _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled but we received a message from resident at %@, requesting electing a remote peer", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v20);
              v24 = [(HMDHome *)v21 homeManager];
              v25 = [(HMDHome *)v21 uuid];
              [v24 electRemoteAccessPeerForHome:v25];

              goto LABEL_20;
            }
          }
        }

        v14 = [v12 countByEnumeratingWithState:&v27 objects:v31 count:16];
        if (v14)
        {
          continue;
        }

        break;
      }
    }

LABEL_20:
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)handleDidReceiveIDSMessageWithNoListener:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __52__HMDHome_handleDidReceiveIDSMessageWithNoListener___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __52__HMDHome_handleDidReceiveIDSMessageWithNoListener___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) userInfo];

  if (v2)
  {
    v3 = [*(a1 + 32) userInfo];
    v5 = [v3 hmf_stringForKey:@"kIDSMessageSourceIDKey"];

    v4 = v5;
    if (v5)
    {
      [*(a1 + 40) _handleDidReceiveIDSMessageWithNoListenerFromAddress:v5];
      v4 = v5;
    }
  }
}

- (void)handleActiveAccountChanged:(id)a3
{
  v4 = [a3 userInfo];
  v5 = [v4 objectForKeyedSubscript:@"HMDAccountNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  v8 = [(HMDHome *)self workQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __38__HMDHome_handleActiveAccountChanged___block_invoke;
  v10[3] = &unk_27868A750;
  v10[4] = self;
  v11 = v7;
  v9 = v7;
  dispatch_async(v8, v10);
}

- (void)handleCurrentAccountMergeIdentifierUpdated:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __54__HMDHome_handleCurrentAccountMergeIdentifierUpdated___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __54__HMDHome_handleCurrentAccountMergeIdentifierUpdated___block_invoke(uint64_t a1)
{
  v34 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  if ([*(a1 + 40) isOwnerUser])
  {
    v5 = +[HMDAppleAccountManager sharedManager];
    v6 = [v5 account];
    v7 = [v4 isEqualToAccount:v6];

    if (v7)
    {
      v8 = [*(a1 + 40) currentUser];
      if (v8)
      {
        v9 = [v4 senderCorrelationIdentifier];
        if (!v9)
        {
          goto LABEL_16;
        }

        v10 = v9;
        v11 = [v4 senderCorrelationIdentifier];
        v12 = [v8 mergeIdentifier];
        v13 = HMFEqualObjects();

        if (v13)
        {
          goto LABEL_16;
        }

        if (![*(a1 + 40) hasAnyResident] || (objc_msgSend(*(a1 + 40), "isCurrentDevicePrimaryResident") & 1) != 0)
        {
          v14 = [*(a1 + 40) backingStore];
          v15 = [v14 context];

          v27[0] = MEMORY[0x277D85DD0];
          v27[1] = 3221225472;
          v27[2] = __54__HMDHome_handleCurrentAccountMergeIdentifierUpdated___block_invoke_2067;
          v27[3] = &unk_2786891E0;
          v28 = v8;
          v29 = v15;
          v16 = v4;
          v17 = *(a1 + 40);
          v30 = v16;
          v31 = v17;
          v18 = v15;
          [v18 unsafeSynchronousBlock:v27];

LABEL_16:
          goto LABEL_17;
        }

        v19 = objc_autoreleasePoolPush();
        v20 = *(a1 + 40);
        v21 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          v22 = HMFGetLogIdentifier();
          *buf = 138543362;
          v33 = v22;
          v23 = "%{public}@Skip updating owner user with mergeID since this device is not the primary resident";
          v24 = v21;
          v25 = OS_LOG_TYPE_INFO;
          goto LABEL_14;
        }
      }

      else
      {
        v19 = objc_autoreleasePoolPush();
        v20 = *(a1 + 40);
        v21 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
        {
          v22 = HMFGetLogIdentifier();
          *buf = 138543362;
          v33 = v22;
          v23 = "%{public}@Home does not currently have a user account. Not attempting to update mergeID.";
          v24 = v21;
          v25 = OS_LOG_TYPE_ERROR;
LABEL_14:
          _os_log_impl(&dword_229538000, v24, v25, v23, buf, 0xCu);
        }
      }

      objc_autoreleasePoolPop(v19);
      goto LABEL_16;
    }
  }

LABEL_17:

  v26 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome_handleCurrentAccountMergeIdentifierUpdated___block_invoke_2067(id *a1)
{
  v18 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] uuid];
  v3 = [a1[5] managedObjectContext];
  v4 = [_MKFHome findHomeMemberWithUUID:v2 context:v3];

  v5 = [a1[6] senderCorrelationIdentifier];
  [v4 setIdsMergeIdentifier:v5];

  v6 = a1[5];
  v13 = 0;
  LOBYTE(v3) = [v6 save:&v13];
  v7 = v13;
  if ((v3 & 1) == 0)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = a1[7];
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to update mergeID for owner: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleAccountHandlesUpdated:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __39__HMDHome_handleAccountHandlesUpdated___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __39__HMDHome_handleAccountHandlesUpdated___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v7 = v3;

  v4 = +[HMDAppleAccountManager sharedManager];
  v5 = [v4 account];
  v6 = [v7 isEqualToAccount:v5];

  if (v6)
  {
    __updateAccountHandleForCurrentUser(*(a1 + 40), v7);
  }
}

- (void)removeUnconfiguredResidentDeviceWithUserID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __54__HMDHome_removeUnconfiguredResidentDeviceWithUserID___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __54__HMDHome_removeUnconfiguredResidentDeviceWithUserID___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) unconfiguredResidentDevices];
  v4 = [v2 hmf_firstObjectWithValue:*(a1 + 40) forKeyPath:@"userID"];

  if (v4)
  {
    [v4 setConfigurationState:2];
    v3 = [*(a1 + 32) unconfiguredResidentDevices];
    [v3 removeObject:v4];
  }
}

- (void)addUnconfiguredResidentDevice:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome_addUnconfiguredResidentDevice___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __41__HMDHome_addUnconfiguredResidentDevice___block_invoke(uint64_t a1)
{
  v42 = *MEMORY[0x277D85DE8];
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v2 = [*(a1 + 32) unconfiguredResidentDevices];
  v3 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v32 objects:v41 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v33;
LABEL_3:
    v6 = 0;
    while (1)
    {
      if (*v33 != v5)
      {
        objc_enumerationMutation(v2);
      }

      v7 = [*(*(&v32 + 1) + 8 * v6) device];
      v8 = [v7 isEqual:*(a1 + 40)];

      if (v8)
      {
        break;
      }

      if (v4 == ++v6)
      {
        v4 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v32 objects:v41 count:16];
        if (v4)
        {
          goto LABEL_3;
        }

        goto LABEL_9;
      }
    }

    v21 = objc_autoreleasePoolPush();
    v22 = *(a1 + 32);
    v23 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      goto LABEL_25;
    }

    v24 = HMFGetLogIdentifier();
    v25 = [*(a1 + 40) shortDescription];
    *buf = 138543618;
    v38 = v24;
    v39 = 2112;
    v40 = v25;
    v26 = "%{public}@Not adding resident device, %@, to unconfigured list since it already exists";
  }

  else
  {
LABEL_9:

    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    v2 = [*(a1 + 32) _residentUsers];
    v9 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v28 objects:v36 count:16];
    if (!v9)
    {
LABEL_17:

      v15 = objc_autoreleasePoolPush();
      v16 = *(a1 + 32);
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v19 = [*(a1 + 40) shortDescription];
        *buf = 138543618;
        v38 = v18;
        v39 = 2112;
        v40 = v19;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Adding resident device, %@, to unconfigured list and posting notification", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
      v2 = [[HMDResidentUser alloc] initWithDevice:*(a1 + 40) home:*(a1 + 32) pairingIdentity:0 configurationState:1];
      v20 = [*(a1 + 32) unconfiguredResidentDevices];
      [v20 addObject:v2];

      [(HMDUser *)v2 setHome:*(a1 + 32)];
      [*(a1 + 32) _configureUnconfiguredResident:v2 desiredConfigState:2];
      goto LABEL_26;
    }

    v10 = v9;
    v11 = *v29;
LABEL_11:
    v12 = 0;
    while (1)
    {
      if (*v29 != v11)
      {
        objc_enumerationMutation(v2);
      }

      v13 = [*(*(&v28 + 1) + 8 * v12) device];
      v14 = [v13 isEqual:*(a1 + 40)];

      if (v14)
      {
        break;
      }

      if (v10 == ++v12)
      {
        v10 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v28 objects:v36 count:16];
        if (v10)
        {
          goto LABEL_11;
        }

        goto LABEL_17;
      }
    }

    v21 = objc_autoreleasePoolPush();
    v22 = *(a1 + 32);
    v23 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      goto LABEL_25;
    }

    v24 = HMFGetLogIdentifier();
    v25 = [*(a1 + 40) shortDescription];
    *buf = 138543618;
    v38 = v24;
    v39 = 2112;
    v40 = v25;
    v26 = "%{public}@Not adding resident device, %@, to unconfigured list since it already exists in users";
  }

  _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, v26, buf, 0x16u);

LABEL_25:
  objc_autoreleasePoolPop(v21);
LABEL_26:

  v27 = *MEMORY[0x277D85DE8];
}

- (void)timerDidFire:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [(HMDHome *)self modifyNotificationsCoalesceTimer];

  if (v6 == v4)
  {
    [(HMDHome *)self _handleCoalescedModifyNotifications];
  }

  else
  {
    v7 = [(HMDHome *)self disableNotificationTimer];

    if (v7 == v4)
    {
      [(HMDHome *)self _handleDisableNotificationsTimerFired];
    }

    else
    {
      v8 = [(HMDHome *)self reachabilityNotificationTimer];

      if (v8 == v4)
      {
        [(HMDHome *)self _handleRemoteReachabilityNotificationTimerFired];
      }

      else
      {
        v9 = [(HMDHome *)self pendingResponsesTimer];

        if (v9 == v4)
        {
          [(HMDHome *)self _handlePendingResponsesTimerFired:0];
        }

        else if (self->_homeLocationTimer == v4)
        {
          v10 = objc_autoreleasePoolPush();
          v11 = self;
          v12 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
          {
            v13 = HMFGetLogIdentifier();
            v15 = 138543362;
            v16 = v13;
            _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Evaluating home location", &v15, 0xCu);
          }

          objc_autoreleasePoolPop(v10);
          [(HMDHome *)v11 updateHomeLocation];
        }

        else if (self->_accessoryReachabilityUpdatesTimer == v4)
        {
          [(HMDHome *)self _handleAccessoryReachabilityUpdatesTimerFired];
        }
      }
    }
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleAccessoryReachabilityUpdatesTimerFired
{
  v102 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_reachabilityUpdatedAccessories allObjects];
  [(NSMutableSet *)self->_reachabilityUpdatedAccessories removeAllObjects];
  os_unfair_recursive_lock_unlock();
  v4 = self;
  v69 = v3;
  v59 = [v69 count];
  v5 = objc_autoreleasePoolPush();
  v72 = v4;
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (v59)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v99 = v8;
      v100 = 2048;
      v101 = v59;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Sending accessory reachability updates - number of entries %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v71 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
    v61 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
    v70 = [MEMORY[0x277CBEB18] arrayWithCapacity:v59];
    v87 = 0u;
    v88 = 0u;
    v85 = 0u;
    v86 = 0u;
    obj = [(HMDHome *)v72 accessories];
    v9 = [obj countByEnumeratingWithState:&v85 objects:buf count:16];
    if (v9)
    {
      v66 = *v86;
      v62 = *MEMORY[0x277CCEC80];
      v60 = *MEMORY[0x277CCF048];
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v86 != v66)
          {
            objc_enumerationMutation(obj);
          }

          v11 = *(*(&v85 + 1) + 8 * i);
          v12 = [v11 uuid];
          v13 = [v12 UUIDString];

          if ([v69 containsObject:v13])
          {
            v14 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v11, "isReachableForXPCClients")}];
            v15 = [v11 messageSendPolicy];
            v16 = [v71 hmf_mutableDictionaryForKey:v15];
            if (!v16)
            {
              v16 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
              [v71 setObject:v16 forKey:v15];
            }

            v17 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:3];
            [v17 setObject:v14 forKeyedSubscript:@"kAccessoryIsReachableKey"];
            v18 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v11, "reachableTransports")}];
            [v17 setObject:v18 forKeyedSubscript:v62];

            v19 = v11;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v20 = v19;
            }

            else
            {
              v20 = 0;
            }

            v21 = v20;

            if (v21)
            {
              v22 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v21, "suspendedState")}];
              [v17 setObject:v22 forKeyedSubscript:v60];
            }

            v23 = [v17 copy];
            [v16 setObject:v23 forKeyedSubscript:v13];

            if (([v15 entitlements] & 4) == 0)
            {
              v24 = [v61 hmf_mutableDictionaryForKey:v15];
              if (!v24)
              {
                v24 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
                [v61 setObject:v24 forKey:v15];
              }

              v96 = @"kAccessoryIsReachableKey";
              v97 = v14;
              v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v97 forKeys:&v96 count:1];
              [v24 setObject:v25 forKeyedSubscript:v13];
            }
          }
        }

        v9 = [obj countByEnumeratingWithState:&v85 objects:buf count:16];
      }

      while (v9);
    }

    v83 = 0u;
    v84 = 0u;
    v81 = 0u;
    v82 = 0u;
    obja = [v71 allKeys];
    v26 = [obja countByEnumeratingWithState:&v81 objects:v95 count:16];
    if (v26)
    {
      v27 = *v82;
      v28 = *MEMORY[0x277CCE9C0];
      v67 = *MEMORY[0x277CCE7A8];
      do
      {
        for (j = 0; j != v26; ++j)
        {
          if (*v82 != v27)
          {
            objc_enumerationMutation(obja);
          }

          v30 = *(*(&v81 + 1) + 8 * j);
          v31 = [v71 hmf_mutableDictionaryForKey:{v30, v59}];
          if ([v31 count])
          {
            v32 = MEMORY[0x277D0F848];
            v33 = [(HMDHome *)v72 messageDestination];
            v93 = v67;
            v34 = [v31 copy];
            v94 = v34;
            v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v94 forKeys:&v93 count:1];
            v36 = [v32 messageWithName:v28 destination:v33 payload:v35];

            if (([v30 entitlements] & 4) != 0)
            {
              v37 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v30 entitlements], objc_msgSend(v30, "options"), 1);
            }

            else
            {
              v37 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v30 entitlements] | 4, objc_msgSend(v30, "options"), 1);
            }

            v38 = v37;
            [v36 setSendPolicy:v37];

            [v70 addObject:v36];
          }
        }

        v26 = [obja countByEnumeratingWithState:&v81 objects:v95 count:16];
      }

      while (v26);
    }

    v79 = 0u;
    v80 = 0u;
    v77 = 0u;
    v78 = 0u;
    objb = [v61 allKeys];
    v39 = [objb countByEnumeratingWithState:&v77 objects:v92 count:16];
    if (v39)
    {
      v40 = *v78;
      v41 = *MEMORY[0x277CCE9C0];
      v68 = *MEMORY[0x277CCE7A8];
      do
      {
        for (k = 0; k != v39; ++k)
        {
          if (*v78 != v40)
          {
            objc_enumerationMutation(objb);
          }

          v43 = *(*(&v77 + 1) + 8 * k);
          v44 = [v71 hmf_mutableDictionaryForKey:{v43, v59}];
          if ([v44 count])
          {
            v45 = MEMORY[0x277D0F848];
            v46 = [(HMDHome *)v72 messageDestination];
            v90 = v68;
            v47 = [v44 copy];
            v91 = v47;
            v48 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v91 forKeys:&v90 count:1];
            v49 = [v45 messageWithName:v41 destination:v46 payload:v48];

            [v49 setRequiresNoSPIEntitlement:1];
            v50 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v43 entitlements], objc_msgSend(v43, "options"), 1);
            [v49 setSendPolicy:v50];
            [v70 addObject:v49];
          }
        }

        v39 = [objb countByEnumeratingWithState:&v77 objects:v92 count:16];
      }

      while (v39);
    }

    v51 = [v70 copy];
  }

  else
  {
    if (v7)
    {
      v52 = HMFGetLogIdentifier();
      *buf = 138543362;
      v99 = v52;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Reachability update timer fired but no entries", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v51 = MEMORY[0x277CBEBF8];
  }

  v73 = 0u;
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  v53 = [v51 countByEnumeratingWithState:&v73 objects:v89 count:16];
  if (v53)
  {
    v54 = *v74;
    do
    {
      for (m = 0; m != v53; ++m)
      {
        if (*v74 != v54)
        {
          objc_enumerationMutation(v51);
        }

        v56 = *(*(&v73 + 1) + 8 * m);
        v57 = [(HMDHome *)v72 msgDispatcher];
        [v57 sendMessage:v56];
      }

      v53 = [v51 countByEnumeratingWithState:&v73 objects:v89 count:16];
    }

    while (v53);
  }

  v58 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientsOfReachabilityUpdateForAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __57__HMDHome_notifyClientsOfReachabilityUpdateForAccessory___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __57__HMDHome_notifyClientsOfReachabilityUpdateForAccessory___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [v2 UUIDString];

  if (v3)
  {
    v4 = *(a1 + 40);
    os_unfair_recursive_lock_lock_with_options();
    if ([*(*(a1 + 40) + 184) containsObject:v3])
    {
      v5 = 0;
    }

    else
    {
      [*(*(a1 + 40) + 184) addObject:v3];
      v5 = [*(*(a1 + 40) + 184) count] == 1;
    }

    os_unfair_recursive_lock_unlock();
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [*(a1 + 32) shortDescription];
      v16 = HMFBooleanToString();
      v18 = 138543874;
      v19 = v14;
      v20 = 2112;
      v21 = v15;
      v22 = 2112;
      v23 = v16;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Queuing up reachability update for accessory %@. Started timer: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    if (v5)
    {
      [*(*(a1 + 40) + 176) resume];
    }
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 32);
      v18 = 138543618;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Attempt to queue reachability update for accessory with no UUID - %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleDisableNotificationsTimerFired
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = [(HMDHome *)self notificationRegistrations];
  v5 = [v4 copy];

  v6 = [(HMDHome *)self notificationDeregistrations];
  v7 = [v6 copy];

  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = [v5 shortDescription];
    v13 = [v7 shortDescription];
    v33 = 138543874;
    v34 = v11;
    v35 = 2112;
    v36 = v12;
    v37 = 2112;
    v38 = v13;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Notification disable timer fired - registrations %@  deregistrations %@", &v33, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [(HMDHome *)v9 setDisableNotificationTimer:0];
  v14 = [(HMDHome *)v9 notificationRegistrationsForAppleMediaAccessories];
  v15 = [v14 count];

  [(HMDHome *)v9 _applyNotificationDeregistrations];
  v16 = [(HMDHome *)v9 notificationRegistrations];
  v17 = [v16 count];

  v18 = [(HMDHome *)v9 notificationRegistrationsForAppleMediaAccessories];
  v19 = [v18 count];

  if (!v19 && v15)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = v9;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      v33 = 138543362;
      v34 = v23;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Modifying Apple Media notification registrations with devices due to HomeKit client no longer active", &v33, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v24 = [(HMDHome *)v21 mediaStateSubscriber];
    [v24 unsubscribeForAppleMediaStateWithSubscriptionToken:@"HMDHomeClientMediaStateRegistrationToken"];
  }

  if (!v17)
  {
    v25 = objc_autoreleasePoolPush();
    v26 = v9;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
    {
      v28 = HMFGetLogIdentifier();
      v33 = 138543362;
      v34 = v28;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to HomeKit client no longer active", &v33, 0xCu);
    }

    objc_autoreleasePoolPop(v25);
    [(HMDHome *)v26 _subscribeForHomeNotificationsFromRemoteGateway:0];
    [(HMDHome *)v26 _subscribeForHomeNotificationsOnDirectTransports:?];
    v29 = [MEMORY[0x277CBEAA8] date];
    [(HMDHome *)v26 setNotificationsUpdatedTime:v29];

    v30 = [(HMDHome *)v26 homeManager];
    v31 = [v30 chipDataSource];
    [v31 updateNotificationsEnabled:0 forHome:v26 keepAliveOnly:0];

    logAndPostNotification(@"HMDHomeDidDisableCharacteristicNotifyEventNotification", v26, 0);
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)_subscribeForHomeNotificationsOnDirectTransports:(void *)a1
{
  v62 = *MEMORY[0x277D85DE8];
  if (a1)
  {
    v2 = a2;
    v4 = [a1 _characteristicNotificationPayloadsOnDirectTransports:a2];
    v5 = [v4 objectAtIndex:0];
    v6 = [v4 objectAtIndex:1];
    if ([v5 count] || objc_msgSend(v6, "count"))
    {
      if ([v5 count])
      {
        v7 = objc_autoreleasePoolPush();
        v8 = a1;
        v9 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
        {
          v10 = HMFGetLogIdentifier();
          v11 = [v5 shortDescription];
          *buf = 138543618;
          v59 = v10;
          v60 = 2112;
          v61 = v11;
          _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Deregistering notifications %@ with direct transports", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v7);
      }

      v47 = v2;
      v46 = v6;
      v54 = 0u;
      v55 = 0u;
      v52 = 0u;
      v53 = 0u;
      v45 = v5;
      v12 = v5;
      v13 = [v12 countByEnumeratingWithState:&v52 objects:v57 count:16];
      if (v13)
      {
        v14 = v13;
        v15 = *v53;
        do
        {
          for (i = 0; i != v14; ++i)
          {
            if (*v53 != v15)
            {
              objc_enumerationMutation(v12);
            }

            v17 = *(*(&v52 + 1) + 8 * i);
            v18 = [v12 objectForKey:{v17, v45}];
            v19 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v17];
            v20 = [a1 accessoryWithUUID:v19];

            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v21 = v20;
            }

            else
            {
              v21 = 0;
            }

            v22 = v21;

            [v22 enableNotification:0 forCharacteristics:v18 message:0 clientIdentifier:@"com.apple.HomeKitDaemon.homeNotifications"];
          }

          v14 = [v12 countByEnumeratingWithState:&v52 objects:v57 count:16];
        }

        while (v14);
      }

      if ([v46 count])
      {
        v23 = objc_autoreleasePoolPush();
        v24 = a1;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
        {
          v26 = HMFGetLogIdentifier();
          v27 = [v46 shortDescription];
          *buf = 138543618;
          v59 = v26;
          v60 = 2112;
          v61 = v27;
          _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_DEBUG, "%{public}@Registering notifications %@ with direct transports", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
      }

      v50 = 0u;
      v51 = 0u;
      v48 = 0u;
      v49 = 0u;
      v28 = v46;
      v29 = [v28 countByEnumeratingWithState:&v48 objects:v56 count:16];
      v5 = v45;
      if (v29)
      {
        v30 = v29;
        v31 = *v49;
        do
        {
          for (j = 0; j != v30; ++j)
          {
            if (*v49 != v31)
            {
              objc_enumerationMutation(v28);
            }

            v33 = *(*(&v48 + 1) + 8 * j);
            v34 = [v28 objectForKey:{v33, v45}];
            v35 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v33];
            v36 = [a1 accessoryWithUUID:v35];

            v37 = v36;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v38 = v37;
            }

            else
            {
              v38 = 0;
            }

            v39 = v38;

            if (v39)
            {
              if (v47)
              {
                [v39 enableNotification:1 forCharacteristics:v34 message:0 clientIdentifier:@"com.apple.HomeKitDaemon.homeNotifications"];
              }

              else
              {
                [v39 updateNotificationEnabled:0 forCharacteristics:v34 onBehalfOf:@"com.apple.HomeKitDaemon.homeNotifications"];
              }

              [v39 checkHAPSessionRestore];
            }
          }

          v30 = [v28 countByEnumeratingWithState:&v48 objects:v56 count:16];
        }

        while (v30);
      }

      v6 = v46;
    }

    else
    {
      v41 = objc_autoreleasePoolPush();
      v42 = a1;
      v43 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
      {
        v44 = HMFGetLogIdentifier();
        *buf = 138543362;
        v59 = v44;
        _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@Not registering notifications on direct transports since we have no modifications", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v41);
    }
  }

  v40 = *MEMORY[0x277D85DE8];
}

- (void)_handleCoalescedModifyNotifications
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  [(HMDHome *)self setModifyNotificationsCoalesceTimer:0];
  v4 = objc_autoreleasePoolPush();
  v5 = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    *buf = 138543362;
    v19 = v7;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to notification coalesce timer firing", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __46__HMDHome__handleCoalescedModifyNotifications__block_invoke;
  aBlock[3] = &unk_278670818;
  aBlock[4] = v5;
  v8 = _Block_copy(aBlock);
  v9 = [(HMDHome *)v5 enableNotificationPayload];
  v10 = [(HMDHome *)v5 pendingCharacteristicThresholdPayload];
  v11 = [(HMDHome *)v5 actionSetsEnableNotificationPayload];
  v12 = [(HMDHome *)v5 matterAttributesEnableNotificationPayload];
  v8[2](v8, v9, v10, v11, v12, 1);

  v13 = [(HMDHome *)v5 disableNotificationPayload];
  v14 = [MEMORY[0x277CBEB38] dictionary];
  v15 = [(HMDHome *)v5 actionSetsDisableNotificationPayload];
  v8[2](v8, v13, v14, v15, 0, 0);

  v16 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleCoalescedModifyNotifications__block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, unsigned int a6)
{
  v11 = a2;
  v12 = a3;
  v13 = a4;
  v14 = a5;
  if ([v11 count] || objc_msgSend(v13, "count") || objc_msgSend(v14, "count"))
  {
    v24 = a6;
    v15 = [v11 na_dictionaryByMappingValues:&__block_literal_global_2063];
    v23 = [v15 copy];

    v16 = [v13 copy];
    v17 = [v14 copy];
    v25 = v12;
    v18 = [v12 copy];
    v19 = objc_autoreleasePoolPush();
    v20 = [*(a1 + 32) notificationRegistrations];
    v21 = [v20 count];

    if (v21)
    {
      v26[0] = MEMORY[0x277D85DD0];
      v26[1] = 3221225472;
      v26[2] = __46__HMDHome__handleCoalescedModifyNotifications__block_invoke_3;
      v26[3] = &unk_2786707F0;
      v26[4] = *(a1 + 32);
      v22 = [v18 na_filter:v26];

      v18 = v22;
    }

    objc_autoreleasePoolPop(v19);
    [*(a1 + 32) _modifyCharacteristicNotificationsOnResident:v23 characteristicChangeThresholds:v18 mediaNotifications:MEMORY[0x277CBEC10] actionSetNotificationPayload:v16 matterAttributeNotifications:v17 enableNotification:v24];
    [v11 removeAllObjects];
    v12 = v25;
    [v25 removeAllObjects];
    [v13 removeAllObjects];
    [v14 removeAllObjects];
  }
}

BOOL __46__HMDHome__handleCoalescedModifyNotifications__block_invoke_3(uint64_t a1, void *a2, void *a3)
{
  v40 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v5];
  if (v7)
  {
    v8 = [*(a1 + 32) accessoryWithUUID:v7];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    if (v10)
    {
      v27 = v7;
      v28 = v5;
      v37 = 0u;
      v38 = 0u;
      v35 = 0u;
      v36 = 0u;
      v11 = [v6 allKeys];
      v34 = [v11 countByEnumeratingWithState:&v35 objects:v39 count:16];
      if (v34)
      {
        v12 = *v36;
        v30 = v10;
        v31 = v6;
        v29 = *v36;
        do
        {
          for (i = 0; i != v34; ++i)
          {
            if (*v36 != v12)
            {
              objc_enumerationMutation(v11);
            }

            v14 = *(*(&v35 + 1) + 8 * i);
            v15 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v14, "integerValue")}];
            if (v15)
            {
              v16 = [v10 hmdCharacteristicForInstanceId:v15];
              v17 = v16;
              if (v16)
              {
                v18 = [v16 service];
                if (!v18)
                {
                  goto LABEL_15;
                }

                v33 = [*(a1 + 32) dataSource];
                v19 = [v33 hapMetadata];
                v20 = [v17 type];
                [v18 type];
                v21 = v11;
                v23 = v22 = a1;
                v32 = [v19 shouldEnableHomeNotificationForCharacteristicType:v20 serviceType:v23];

                a1 = v22;
                v11 = v21;

                v10 = v30;
                v12 = v29;

                v6 = v31;
                if (v32)
                {
LABEL_15:
                  [v6 setObject:0 forKeyedSubscript:v14];
                }
              }

              else
              {
                [v6 setObject:0 forKeyedSubscript:v14];
              }
            }

            else
            {
              [v6 setObject:0 forKeyedSubscript:v14];
            }
          }

          v34 = [v11 countByEnumeratingWithState:&v35 objects:v39 count:16];
        }

        while (v34);
      }

      v24 = [v6 count] != 0;
      v7 = v27;
      v5 = v28;
    }

    else
    {
      v24 = 0;
    }
  }

  else
  {
    v24 = 0;
  }

  v25 = *MEMORY[0x277D85DE8];
  return v24;
}

id __46__HMDHome__handleCoalescedModifyNotifications__block_invoke_2(uint64_t a1, uint64_t a2, void *a3)
{
  v3 = [a3 copy];

  return v3;
}

- (void)residentDeviceManagerDidUpdateResidents:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __51__HMDHome_residentDeviceManagerDidUpdateResidents___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v4, block);
}

- (void)residentDeviceManager:(id)a3 didUpdatePrimaryResident:(id)a4 previousPrimaryResident:(id)a5
{
  v7 = a4;
  v8 = a5;
  v9 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __82__HMDHome_residentDeviceManager_didUpdatePrimaryResident_previousPrimaryResident___block_invoke;
  block[3] = &unk_27868A010;
  block[4] = self;
  v13 = v7;
  v14 = v8;
  v10 = v8;
  v11 = v7;
  dispatch_async(v9, block);
}

void __82__HMDHome_residentDeviceManager_didUpdatePrimaryResident_previousPrimaryResident___block_invoke(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  if (([*(a1 + 32) isOwnerUser] & 1) == 0)
  {
    v2 = [*(a1 + 32) residentSyncManager];
    [v2 performSync];
  }

  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v7 = *(a1 + 40);
    v8 = *(a1 + 48);
    v13 = 138543874;
    v14 = v6;
    v15 = 2112;
    v16 = v7;
    v17 = 2112;
    v18 = v8;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Scheduling re-subscription for new primary resident: %@, old primary: %@", &v13, 0x20u);
  }

  objc_autoreleasePoolPop(v3);
  v9 = *(a1 + 32);
  v10 = [*(a1 + 48) device];
  [v9 resubscribeForNotificationsOnResident:v10];

  [*(a1 + 32) migrateAfterResidentChange];
  [*(a1 + 32) reEvaluateHomeHubState];
  v11 = [*(a1 + 32) stagedRemoteReachabilityRegistration];
  [v11 resetAndStagePriorValue];

  v12 = *MEMORY[0x277D85DE8];
}

- (void)residentDeviceManager:(id)a3 didUpdateResidentAvailable:(BOOL)a4
{
  v6 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __60__HMDHome_residentDeviceManager_didUpdateResidentAvailable___block_invoke;
  v7[3] = &unk_278688650;
  v7[4] = self;
  v8 = a4;
  dispatch_async(v6, v7);
}

uint64_t __60__HMDHome_residentDeviceManager_didUpdateResidentAvailable___block_invoke(uint64_t a1)
{
  v31 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 32) shortDescription];
    v7 = v6;
    v8 = *(a1 + 40);
    *buf = 138543874;
    v26 = v5;
    if (v8)
    {
      v9 = @"available";
    }

    else
    {
      v9 = @"unavailable";
    }

    v27 = 2112;
    v28 = v6;
    v29 = 2112;
    v30 = v9;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@[%@] Resident devices are %@ for this home", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v2);
  if ((*(a1 + 40) & 1) == 0)
  {
    [*(a1 + 32) migrateAfterResidentChange];
    if ((*(a1 + 40) & 1) == 0)
    {
      v22 = 0u;
      v23 = 0u;
      v20 = 0u;
      v21 = 0u;
      v10 = [*(a1 + 32) _residentUsers];
      v11 = [v10 countByEnumeratingWithState:&v20 objects:v24 count:16];
      if (v11)
      {
        v12 = v11;
        v13 = *v21;
        do
        {
          v14 = 0;
          do
          {
            if (*v21 != v13)
            {
              objc_enumerationMutation(v10);
            }

            [*(a1 + 32) _notifyClientsOfUpdatedResidentUser:*(*(&v20 + 1) + 8 * v14++)];
          }

          while (v12 != v14);
          v12 = [v10 countByEnumeratingWithState:&v20 objects:v24 count:16];
        }

        while (v12);
      }

      v15 = [*(a1 + 32) homeManager];
      v16 = [*(a1 + 32) uuid];
      [v15 electRemoteAccessPeerForHome:v16];

      if (([*(a1 + 32) isOwnerUser] & 1) == 0)
      {
        v17 = [*(a1 + 32) residentDeviceManager];
        [v17 discoverPrimaryResidentForRequester:0];
      }
    }
  }

  result = [*(a1 + 32) reEvaluateHomeHubState];
  v19 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)retrieveOperationalCertificatesForFabricID:(id)a3 commissionerNodeID:(id)a4 commissioneeNodeID:(id)a5 publicKey:(id)a6 completion:(id)a7
{
  v48 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v37 = a4;
  v38 = a5;
  v39 = a6;
  v13 = a7;
  v14 = [(HMDHome *)self primaryResident];
  v15 = v14;
  if (v14 && ([v14 device], (v16 = objc_claimAutoreleasedReturnValue()) != 0) && (-[HMDHome primaryResident](self, "primaryResident"), v17 = objc_claimAutoreleasedReturnValue(), v18 = objc_msgSend(v17, "isReachable"), v17, v16, (v18 & 1) != 0))
  {
    v19 = [HMDRemoteDeviceMessageDestination alloc];
    v20 = [(HMDHome *)self uuid];
    v21 = [v15 device];
    v22 = [(HMDRemoteDeviceMessageDestination *)v19 initWithTarget:v20 device:v21];

    v23 = [MEMORY[0x277CBEB38] dictionary];
    [v23 setObject:v38 forKeyedSubscript:@"HMDHomeCommissioningDeviceNodeIDMessageKey"];
    [v23 setObject:v12 forKeyedSubscript:@"HMDHomeCommissioningFabricIDMessageKey"];
    [v23 setObject:v12 forKeyedSubscript:@"HMDHomeCommissioningFabricIndexMessageKey"];
    [v23 setObject:v39 forKeyedSubscript:@"HMDHomeCommissioningPublicKeyMessageKey"];
    if (isFeatureMatterLocalFabricConfigEnabled())
    {
      [v23 setObject:v37 forKeyedSubscript:@"HMDHomeCommissioningCommissionerNodeIDMessageKey"];
    }

    v24 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeRequestCommissioningCertificatesMessage" destination:v22 payload:v23];
    [v24 setRemote:1];
    [v24 setSecureRemote:1];
    objc_initWeak(&location, self);
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __113__HMDHome_retrieveOperationalCertificatesForFabricID_commissionerNodeID_commissioneeNodeID_publicKey_completion___block_invoke;
    v40[3] = &unk_278689728;
    objc_copyWeak(&v42, &location);
    v41 = v13;
    [v24 setResponseHandler:v40];
    context = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [v24 shortDescription];
      *buf = 138543618;
      v45 = v27;
      v46 = 2112;
      v47 = v28;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Sending message %@ to fetch Matter operational certificates from the primary resident", buf, 0x16u);
    }

    objc_autoreleasePoolPop(context);
    v29 = [(HMDHome *)v25 msgDispatcher];
    [v29 sendMessage:v24];

    objc_destroyWeak(&v42);
    objc_destroyWeak(&location);
  }

  else
  {
    v30 = objc_autoreleasePoolPush();
    v31 = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
    {
      v33 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v33;
      _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not available or it is unreachable", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v30);
    v34 = MEMORY[0x277CCA9B8];
    v22 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
    v23 = [v34 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v22];
    (*(v13 + 2))(v13, 0, 0, 0, 0, v23);
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __113__HMDHome_retrieveOperationalCertificatesForFabricID_commissionerNodeID_commissioneeNodeID_publicKey_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v11;
        v29 = 2112;
        v30 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for operational certificates failed with %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:@"HMDHomeCommissioningRootCertMessageKey"];
      v13 = [v6 hmf_dataForKey:@"HMDHomeCommissioningOperationalCertMessageKey"];
      v14 = [v6 hmf_numberForKey:@"HMDHomeCommissioningOwnerNodeIDMessageKey"];
      v15 = [v6 hmf_dataForKey:@"HMDHomeCommissioningIPKMessageKey"];
      context = objc_autoreleasePoolPush();
      v16 = WeakRetained;
      v17 = HMFGetOSLogHandle();
      v18 = v17;
      if (v12 && v13)
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v19 = v24 = v15;
          *buf = 138544130;
          v28 = v19;
          v29 = 2112;
          v30 = v12;
          v31 = 2112;
          v32 = v13;
          v33 = 2112;
          v34 = v14;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Request for operational certificates successful. rootCertificate %@, operationalCert %@, ownerNodeID %@", buf, 0x2Au);

          v15 = v24;
        }

        objc_autoreleasePoolPop(context);
        (*(*(a1 + 32) + 16))();
      }

      else
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v20 = v25 = v15;
          *buf = 138544130;
          v28 = v20;
          v29 = 2112;
          v30 = v12;
          v31 = 2112;
          v32 = v13;
          v33 = 2112;
          v34 = v14;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Primary resident returned unexpected values for rootCertificate %@, operationalCert %@, ownerNodeID %@", buf, 0x2Au);

          v15 = v25;
        }

        objc_autoreleasePoolPop(context);
        v21 = *(a1 + 32);
        v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        (*(v21 + 16))(v21, 0, 0, 0, 0, v22);
      }
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_fetchMetadataFromPrimaryResidentWithCompletion:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self primaryResident];
  v6 = [(HMDHome *)self _checkResidentCapabilitiesForCredentialSharing:v5];
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v25 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Couldn't find compatible resident to fetch Thread network credentials", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v4[2](v4, 0, v6);
  }

  else
  {
    v11 = [HMDRemoteDeviceMessageDestination alloc];
    v12 = [(HMDHome *)self uuid];
    v13 = [v5 device];
    v14 = [(HMDRemoteDeviceMessageDestination *)v11 initWithTarget:v12 device:v13];

    v15 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeThreadNetworkCredentialsRequestKey" destination:v14 payload:0];
    [v15 setRemote:1];
    [v15 setSecureRemote:1];
    objc_initWeak(buf, self);
    v18 = MEMORY[0x277D85DD0];
    v19 = 3221225472;
    v20 = __59__HMDHome__fetchMetadataFromPrimaryResidentWithCompletion___block_invoke;
    v21 = &unk_278689728;
    objc_copyWeak(&v23, buf);
    v22 = v4;
    [v15 setResponseHandler:&v18];
    v16 = [(HMDHome *)self msgDispatcher:v18];
    [v16 sendMessage:v15 completionHandler:0];

    objc_destroyWeak(&v23);
    objc_destroyWeak(buf);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __59__HMDHome__fetchMetadataFromPrimaryResidentWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v47 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v11;
        v43 = 2112;
        v44 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for Thread Network credentials failed with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:*MEMORY[0x277CD0620]];
      v40 = 0;
      v13 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v12 error:&v40];
      v38 = v40;
      v14 = [v6 hmf_dataForKey:@"HMHomeThreadNetworkCredentialsMasterKeyMessageKey"];
      v15 = objc_autoreleasePoolPush();
      v16 = WeakRetained;
      v17 = HMFGetOSLogHandle();
      v18 = v17;
      v39 = v14;
      if (v13)
      {
        v19 = v14 == 0;
      }

      else
      {
        v19 = 1;
      }

      if (v19)
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v21 = v20 = v12;
          v22 = [v39 length];
          *buf = 138543874;
          v42 = v21;
          v43 = 2112;
          v44 = v13;
          v45 = 2048;
          v46 = v22;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Missing metadata (%@)/masterKeyData (length %zu) in response", buf, 0x20u);

          v12 = v20;
        }

        objc_autoreleasePoolPop(v15);
        v23 = *(a1 + 32);
        v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        (*(v23 + 16))(v23, 0, v24);
        v14 = v39;
      }

      else
      {
        v36 = v6;
        v37 = v12;
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          v26 = HMFGetLogIdentifier();
          *buf = 138543362;
          v42 = v26;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Request for Thread Network Metadata successful", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v15);
        v35 = objc_alloc(MEMORY[0x277CD1EA8]);
        v33 = [v13 name];
        v34 = [v13 channel];
        v32 = [v13 PANID];
        v27 = [v13 extendedPANID];
        v28 = [v13 passPhrase];
        v29 = [v13 PSKc];
        v30 = [v13 operationalDataset];
        v24 = [v35 initWithName:v33 channel:v34 PANID:v32 extendedPANID:v27 masterKey:v14 passPhrase:v28 PSKc:v29 operationalDataset:v30];

        (*(*(a1 + 32) + 16))();
        v6 = v36;
        v12 = v37;
      }
    }
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (id)_checkResidentCapabilitiesForCredentialSharing:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = v4;
  if (v4 && ([v4 device], v6 = objc_claimAutoreleasedReturnValue(), v6, v6))
  {
    v7 = [v5 capabilities];
    v8 = [v7 supportsThreadNetworkCredentialSharing];

    if (v8)
    {
      v9 = 0;
      goto LABEL_12;
    }

    v10 = objc_autoreleasePoolPush();
    v15 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v16;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Primary resident doesn't support Thread Network Credential sharing", &v19, 0xCu);
    }

    v14 = 92;
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request thread credentials from", &v19, 0xCu);
    }

    v14 = 91;
  }

  objc_autoreleasePoolPop(v10);
  v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:v14];
LABEL_12:

  v17 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)removeThreadNetworkPreferredNetworkWithCompletion:(id)a3
{
  v3 = a3;
  v4 = +[HMDThreadNetworkMetadataStore defaultStore];
  [v4 removePreferredNetworkWithCompletion:v3];
}

- (void)retrieveThreadNetworkMetadataWithNoFallbackWithCompletion:(id)a3
{
  v31 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (![(HMDHome *)self isSharedAdmin]&& ![(HMDHome *)self isOwnerUser])
  {
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543362;
      v30 = v20;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Unexpected user. Returning without retrieving thread network credentials", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:47];
    v4[2](v4, 0, v6);
    goto LABEL_23;
  }

  if (![(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v5 = [(HMDHome *)self residentDeviceManager];
    v6 = [v5 residentDevices];

    if ([v6 count])
    {
      v7 = [(HMDHome *)self primaryResident];
      v8 = [v7 isReachable];

      if (v8)
      {
        v27[0] = MEMORY[0x277D85DD0];
        v27[1] = 3221225472;
        v27[2] = __69__HMDHome_retrieveThreadNetworkMetadataWithNoFallbackWithCompletion___block_invoke;
        v27[3] = &unk_2786815F0;
        v27[4] = self;
        v28 = v4;
        [(HMDHome *)self _fetchMetadataFromPrimaryResidentWithCompletion:v27];

LABEL_23:
        goto LABEL_24;
      }
    }

    if ([(HMDHome *)self isSharedAdmin])
    {
      v9 = objc_autoreleasePoolPush();
      v10 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 138543362;
        v30 = v12;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@No resident available. Returning without retrieving thread network credentials", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
      v13 = [v6 count];
      v14 = MEMORY[0x277CCA9B8];
      if (!v13)
      {
        v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
        v4[2](v4, 0, v15);
        goto LABEL_22;
      }

      v15 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
      v16 = [v14 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v15];
      v4[2](v4, 0, v16);
    }

    else
    {
      if (![v6 count])
      {
        [(HMDHome *)self _fetchMetadataOnCurrentDeviceWithCompletion:v4];
        goto LABEL_23;
      }

      v21 = objc_autoreleasePoolPush();
      v22 = self;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        *buf = 138543362;
        v30 = v24;
        _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not reachable. Returning without retrieving thread network credentials", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
      v25 = MEMORY[0x277CCA9B8];
      v15 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
      v16 = [v25 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v15];
      v4[2](v4, 0, v16);
    }

LABEL_22:
    goto LABEL_23;
  }

  [(HMDHome *)self _fetchMetadataOnCurrentDeviceWithCompletion:v4];
LABEL_24:

  v26 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome_retrieveThreadNetworkMetadataWithNoFallbackWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (!v5 || v6)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v13 = 138543618;
      v14 = v11;
      v15 = 2112;
      v16 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to get thread network credentials from resident. Not falling back. Error: %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  (*(*(a1 + 40) + 16))();

  v12 = *MEMORY[0x277D85DE8];
}

- (void)retrieveThreadNetworkMetadataWithCompletion:(id)a3
{
  v14 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (![(HMDHome *)self isSharedAdmin])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      v10 = +[HMDThreadNetworkMetadataStore defaultStore];
      [v10 retrieveMetadataWithCompletion:v4];
LABEL_12:

      goto LABEL_13;
    }

    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v8;
      v9 = "%{public}@Unexpected user. Returning without retrieving thread network credentials";
      goto LABEL_10;
    }

LABEL_11:

    objc_autoreleasePoolPop(v5);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:47];
    v4[2](v4, 0, v10);
    goto LABEL_12;
  }

  if ([(HMDHome *)self isCurrentDevicePrimaryResident])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v8;
      v9 = "%{public}@Running as a shared admin on primary resident; This is unexpected. Returning without retrieving thread network credentials";
LABEL_10:
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, v9, &v12, 0xCu);

      goto LABEL_11;
    }

    goto LABEL_11;
  }

  [(HMDHome *)self _fetchMetadataFromPrimaryResidentWithCompletion:v4];
LABEL_13:

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_fetchMetadataOnCurrentDeviceWithCompletion:(id)a3
{
  v4 = a3;
  v6 = +[HMDThreadNetworkMetadataStore defaultStore];
  v5 = [(HMDHome *)self threadOperationalDataset];
  [v6 retrieveMetadata:v5 homeHasResident:-[HMDHome doesHomeContainResident](self completion:{"doesHomeContainResident"), v4}];
}

- (void)_unconfigurePairedAccessoriesForServer:(id)a3 updateReachability:(BOOL)a4
{
  v4 = a4;
  v24 = *MEMORY[0x277D85DE8];
  v6 = a3;
  if ([v6 isPaired])
  {
    if (v4)
    {
      v7 = objc_autoreleasePoolPush();
      v8 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543618;
        v21 = v10;
        v22 = 2112;
        v23 = v6;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Setting reachability to false for all paired accessories associated with %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
    }

    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    v12 = [v6 identifier];
    v13 = [v6 linkType];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __69__HMDHome__unconfigurePairedAccessoriesForServer_updateReachability___block_invoke;
    v16[3] = &unk_2786707A8;
    v17 = v12;
    v18 = v13;
    v19 = v4;
    v14 = v12;
    [(HMDHome *)self _notifyRetrievalError:v11 accessoryServer:v14 linkType:v13 accessoryOperationBlock:v16];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_processUpdatedAccessoryServer:(id)a3 reAddServices:(BOOL)a4
{
  v312 = *MEMORY[0x277D85DE8];
  v197 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v301 = v8;
    v302 = 2112;
    v303 = v197;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Updating existing HMDAccessory objects from HAPAccessory objects for server: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v225 = [(HMDHome *)v6 _primaryAccessoryForServer:v197];
  v9 = [v197 identifier];
  v194 = [(HMDHome *)v6 matterAccessoryWithIdentifier:v9];

  v10 = [v194 matterAdapter];
  v11 = [v10 updateNativeMatterSupportForAccessoryServer:v197];

  if ((v11 & 1) == 0)
  {
    if ([v194 isNativeMatter])
    {
      v12 = v194;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v13 = v12;
      }

      else
      {
        v13 = 0;
      }

      v201 = v13;

      [v201 processUpdatedAccessoryServer:v197];
LABEL_147:

      goto LABEL_148;
    }

    v201 = [MEMORY[0x277CBEB18] array];
    v200 = [MEMORY[0x277CBEB18] array];
    v193 = [v225 configNumber];
    v14 = MEMORY[0x277CBEB18];
    v15 = [v197 accessories];
    v205 = [v14 arrayWithArray:v15];

    v16 = MEMORY[0x277CBEB18];
    v17 = [(HMDHome *)v6 hapAccessoriesForServer:v197];
    v218 = [v16 arrayWithArray:v17];

    v18 = objc_autoreleasePoolPush();
    v235 = v6;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      v21 = [v218 count];
      v22 = [v197 identifier];
      v23 = [v197 accessories];
      v24 = [v23 count];
      *buf = 138544130;
      v301 = v20;
      v302 = 2050;
      v303 = v21;
      v304 = 2114;
      v305 = v22;
      v306 = 2050;
      v307 = v24;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Found %{public}tu existing HMDAccessory objects associated with the server: '%{public}@' and discovered %{public}tu HAPAccessory objects", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v18);
    v202 = [MEMORY[0x277CBEB18] array];
    v203 = [MEMORY[0x277CBEB18] array];
    v196 = [MEMORY[0x277CBEB18] array];
    v232 = [MEMORY[0x277CBEB18] array];
    v229 = [MEMORY[0x277CBEB18] array];
    context = [MEMORY[0x277CBEB18] array];
    v281 = 0u;
    v282 = 0u;
    v279 = 0u;
    v280 = 0u;
    obj = [v197 accessories];
    v222 = [obj countByEnumeratingWithState:&v279 objects:v298 count:16];
    if (v222)
    {
      v219 = *v280;
      do
      {
        for (i = 0; i != v222; ++i)
        {
          if (*v280 != v219)
          {
            objc_enumerationMutation(obj);
          }

          v26 = *(*(&v279 + 1) + 8 * i);
          v275 = 0u;
          v276 = 0u;
          v277 = 0u;
          v278 = 0u;
          v27 = v218;
          v28 = [v27 countByEnumeratingWithState:&v275 objects:v297 count:16];
          if (!v28)
          {
            goto LABEL_27;
          }

          v29 = *v276;
          while (2)
          {
            for (j = 0; j != v28; ++j)
            {
              if (*v276 != v29)
              {
                objc_enumerationMutation(v27);
              }

              v31 = *(*(&v275 + 1) + 8 * j);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v32 = v31;
              }

              else
              {
                v32 = 0;
              }

              v33 = v32;

              if ([v33 matchesHAPAccessory:v26])
              {

                if (!v33)
                {
                  goto LABEL_62;
                }

                if (([v33 isPrimary] & 1) == 0 && (objc_msgSend(v33, "isPaired") & 1) == 0)
                {
                  v65 = objc_autoreleasePoolPush();
                  v66 = v235;
                  v67 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v67, OS_LOG_TYPE_INFO))
                  {
                    v68 = HMFGetLogIdentifier();
                    v69 = [v33 shortDescription];
                    *buf = 138543618;
                    v301 = v68;
                    v302 = 2114;
                    v303 = v69;
                    _os_log_impl(&dword_229538000, v67, OS_LOG_TYPE_INFO, "%{public}@Skipping configuring unpaired secondary accessory with identifier: %{public}@", buf, 0x16u);
                  }

                  objc_autoreleasePoolPop(v65);
                  goto LABEL_61;
                }

                [v201 addObject:v26];
                [v200 addObject:v33];
                v34 = [v33 uuid];
                v35 = [v33 hostAccessory];
                v36 = [v35 uuid];
                v37 = [(HMDHome *)v235 getTransactionFromHAPAccessory:v26 hmdAccessory:v33 uuid:v34 hostAccessoryUUID:v36 objectChangeType:2];

                v38 = v26;
                v39 = v33;
                v40 = v37;
                v41 = [v39 initialManufacturer];
                if (v41)
                {
LABEL_34:
                }

                else
                {
                  v42 = [v38 manufacturer];
                  v43 = v42 == 0;

                  if (!v43)
                  {
                    v41 = [v38 manufacturer];
                    [v40 setInitialManufacturer:v41];
                    goto LABEL_34;
                  }
                }

                v44 = [v39 initialModel];
                if (v44)
                {
LABEL_38:
                }

                else
                {
                  v45 = [v38 model];
                  v46 = v45 == 0;

                  if (!v46)
                  {
                    v44 = [v38 model];
                    [v40 setInitialModel:v44];
                    goto LABEL_38;
                  }
                }

                v47 = [v39 initialCategoryIdentifier];
                if (v47)
                {
LABEL_42:
                }

                else
                {
                  v48 = [v38 category];
                  v49 = v48 == 0;

                  if (!v49)
                  {
                    v47 = [v38 category];
                    [v40 setInitialCategoryIdentifier:v47];
                    goto LABEL_42;
                  }
                }

                v50 = [v39 initialServiceTypeUUIDs];
                v51 = v50 == 0;

                if (v51)
                {
                  v52 = serviceTypeUUIDsForAccessory(v38);
                  if (v52)
                  {
                    [v40 setInitialServiceTypeUUIDs:v52];
                  }
                }

                v274 = v232;
                v273 = v229;
                v272 = context;
                [(HMDHome *)v235 getUpdateTransactionForAccessory:v39 hapAccessory:v38 accessoryTransaction:v40 addSvcTransactions:&v274 updateSvcTransactions:&v273 removeSvcTransactions:&v272];
                val = v274;

                v233 = v273;
                v230 = v272;

                if ([v38 isPrimary])
                {
                  v53 = [v197 setupHash];
                  if (v53)
                  {
                    contexta = objc_autoreleasePoolPush();
                    v54 = v235;
                    v55 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v55, OS_LOG_TYPE_INFO))
                    {
                      v56 = HMFGetLogIdentifier();
                      v57 = [v39 shortDescription];
                      *buf = 138543874;
                      v301 = v56;
                      v302 = 2112;
                      v303 = v53;
                      v304 = 2112;
                      v305 = v57;
                      _os_log_impl(&dword_229538000, v55, OS_LOG_TYPE_INFO, "%{public}@Saving setup hash '%@ for accessory %@", buf, 0x20u);
                    }

                    objc_autoreleasePoolPop(contexta);
                    [v40 setAccessorySetupHash:v53];
                  }

                  [(HMDHome *)v235 _processUpdatedProductDataForAccessory:v39 hapAccessory:v38 transaction:v40];
                }

                v58 = [v39 modelObjectWithChangeType:1];
                v271 = 0;
                [v58 diff:v40 differingFields:&v271];
                v59 = v271;

                if ([(__CFString *)v59 count])
                {
                  v60 = objc_autoreleasePoolPush();
                  v61 = v235;
                  v62 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
                  {
                    v63 = HMFGetLogIdentifier();
                    v64 = [v225 shortDescription];
                    *buf = 138544130;
                    v301 = v63;
                    v302 = 2114;
                    v303 = v64;
                    v304 = 2114;
                    v305 = v40;
                    v306 = 2114;
                    v307 = v59;
                    _os_log_impl(&dword_229538000, v62, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Received accessory update %{public}@ due to diff %{public}@", buf, 0x2Au);
                  }

                  objc_autoreleasePoolPop(v60);
                  [v203 addObject:v40];
                }

                context = v230;
                v229 = v233;
                v232 = val;
                goto LABEL_61;
              }
            }

            v28 = [v27 countByEnumeratingWithState:&v275 objects:v297 count:16];
            if (v28)
            {
              continue;
            }

            break;
          }

LABEL_27:
          v31 = v27;
LABEL_61:

LABEL_62:
          ;
        }

        v222 = [obj countByEnumeratingWithState:&v279 objects:v298 count:16];
      }

      while (v222);
    }

    v70 = objc_autoreleasePoolPush();
    vala = v235;
    v71 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v71, OS_LOG_TYPE_INFO))
    {
      v72 = HMFGetLogIdentifier();
      *buf = 138543618;
      v301 = v72;
      v302 = 2112;
      v303 = v197;
      _os_log_impl(&dword_229538000, v71, OS_LOG_TYPE_INFO, "%{public}@Finished updating paired accessories for server: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v70);
    [v205 removeObjectsInArray:v201];
    [v218 removeObjectsInArray:v200];
    v212 = [(HMDHome *)vala accessories];
    v269 = 0u;
    v270 = 0u;
    v267 = 0u;
    v268 = 0u;
    v204 = v205;
    obja = [v204 countByEnumeratingWithState:&v267 objects:v296 count:16];
    if (obja)
    {
      v210 = *v268;
      do
      {
        v73 = 0;
        do
        {
          if (*v268 != v210)
          {
            v74 = v73;
            objc_enumerationMutation(v204);
            v73 = v74;
          }

          v220 = v73;
          v75 = *(*(&v267 + 1) + 8 * v73);
          v263 = 0u;
          v264 = 0u;
          v265 = 0u;
          v266 = 0u;
          v76 = v212;
          v77 = [v76 countByEnumeratingWithState:&v263 objects:v295 count:16];
          if (v77)
          {
            v78 = *v264;
LABEL_73:
            v79 = 0;
            while (1)
            {
              if (*v264 != v78)
              {
                objc_enumerationMutation(v76);
              }

              v80 = *(*(&v263 + 1) + 8 * v79);
              objc_opt_class();
              v81 = (objc_opt_isKindOfClass() & 1) != 0 ? v80 : 0;
              v82 = v81;

              v83 = [v75 identifier];
              v84 = [v75 instanceID];
              v85 = [v82 matchesHAPAccessoryWithServerIdentifier:v83 instanceID:v84];

              if (v85)
              {
                break;
              }

              if (v77 == ++v79)
              {
                v77 = [v76 countByEnumeratingWithState:&v263 objects:v295 count:16];
                if (v77)
                {
                  goto LABEL_73;
                }

                goto LABEL_82;
              }
            }

            v236 = objc_autoreleasePoolPush();
            v223 = vala;
            v86 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v86, OS_LOG_TYPE_INFO))
            {
              v206 = HMFGetLogIdentifier();
              v208 = [v75 server];
              v87 = [v208 identifier];
              v88 = [v75 instanceID];
              v89 = [v75 linkType];
              v90 = @"Undefined";
              if (v89 <= 2)
              {
                v90 = off_2786768F0[v89];
              }

              v91 = v90;
              v92 = [v82 name];
              v93 = [v82 uniqueIdentifier];
              *buf = 138544642;
              v301 = v206;
              v302 = 2114;
              v303 = v87;
              v304 = 2114;
              v305 = v88;
              v306 = 2112;
              v307 = v91;
              v308 = 2112;
              v309 = v92;
              v310 = 2112;
              v311 = v93;
              _os_log_impl(&dword_229538000, v86, OS_LOG_TYPE_INFO, "%{public}@HAPAccessory %{public}@/%{public}@/%@ matches existing HMDAccessory %@(%@)", buf, 0x3Eu);
            }

            objc_autoreleasePoolPop(v236);
            if (v82)
            {
              [v218 removeObject:v82];
              v94 = [v82 uuid];
              v95 = [v82 hostAccessory];
              v96 = [v95 uuid];
              v237 = [(HMDHome *)v223 getTransactionFromHAPAccessory:v75 hmdAccessory:v82 uuid:v94 hostAccessoryUUID:v96 objectChangeType:2];

              v262 = v232;
              v261 = v229;
              v260 = context;
              [(HMDHome *)v223 getUpdateTransactionForAccessory:v82 hapAccessory:v75 accessoryTransaction:v237 addSvcTransactions:&v262 updateSvcTransactions:&v261 removeSvcTransactions:&v260];
              v97 = v262;

              v98 = v261;
              v99 = v260;

              v100 = [v82 modelObjectWithChangeType:1];
              v259 = 0;
              [v100 diff:v237 differingFields:&v259];
              v101 = v259;

              if ([(__CFString *)v101 count])
              {
                v102 = objc_autoreleasePoolPush();
                v103 = v223;
                v104 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v104, OS_LOG_TYPE_INFO))
                {
                  v105 = HMFGetLogIdentifier();
                  v106 = [v225 uuid];
                  *buf = 138544130;
                  v301 = v105;
                  v302 = 2114;
                  v303 = v106;
                  v304 = 2114;
                  v305 = v237;
                  v306 = 2114;
                  v307 = v101;
                  _os_log_impl(&dword_229538000, v104, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Received accessory update %{public}@ due to diff %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v102);
                [v203 addObject:v237];
              }

              goto LABEL_102;
            }
          }

          else
          {
LABEL_82:
          }

          if (v225)
          {
            v107 = [v75 instanceID];
            v108 = [v107 stringValue];
            v294 = v108;
            v80 = [MEMORY[0x277CBEA60] arrayWithObjects:&v294 count:1];

            v109 = MEMORY[0x277CCAD78];
            v110 = [v225 uuid];
            v237 = [v109 hm_deriveUUIDFromBaseUUID:v110 withSalts:v80];

            if (!v237)
            {
              v111 = objc_autoreleasePoolPush();
              v112 = vala;
              v113 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v113, OS_LOG_TYPE_ERROR))
              {
                v114 = HMFGetLogIdentifier();
                v115 = [v225 shortDescription];
                *buf = 138543618;
                v301 = v114;
                v302 = 2112;
                v303 = v115;
                _os_log_impl(&dword_229538000, v113, OS_LOG_TYPE_ERROR, "%{public}@Error during _processUpdatedAccessoryServer: Primary Accessory for Server has nil UUID: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v111);
              v116 = +[HMDTTRManager sharedManager];
              [v116 requestRadarWithDisplayReason:@"accessory has null identifier" radarTitle:@"PrimaryAccessoryForServer results in nil uuid during processUpdatedAccessoryServer"];
            }

            v117 = objc_autoreleasePoolPush();
            v118 = vala;
            v119 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v119, OS_LOG_TYPE_INFO))
            {
              v120 = HMFGetLogIdentifier();
              v121 = [v225 shortDescription];
              v122 = [v75 instanceID];
              v123 = [v237 UUIDString];
              *buf = 138544130;
              v301 = v120;
              v302 = 2114;
              v303 = v121;
              v304 = 2114;
              v305 = v122;
              v306 = 2114;
              v307 = v123;
              _os_log_impl(&dword_229538000, v119, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Adding a new bridged accessory instanceID %{public}@ and uuid %{public}@", buf, 0x2Au);
            }

            objc_autoreleasePoolPop(v117);
            v124 = [v225 uuid];
            v101 = [(HMDHome *)v118 getTransactionFromHAPAccessory:v75 hmdAccessory:0 uuid:v237 hostAccessoryUUID:v124 objectChangeType:1];

            v125 = [(__CFString *)v101 roomUUID];
            LODWORD(v124) = v125 == 0;

            if (v124)
            {
              v126 = [v225 room];
              v127 = [v126 uuid];
              v128 = [v127 UUIDString];
              [(__CFString *)v101 setRoomUUID:v128];
            }

            v258 = v232;
            v257 = v229;
            v256 = context;
            [(HMDHome *)v118 getUpdateTransactionForAccessory:0 hapAccessory:v75 accessoryTransaction:v101 addSvcTransactions:&v258 updateSvcTransactions:&v257 removeSvcTransactions:&v256];
            v97 = v258;

            v98 = v257;
            v99 = v256;

            v129 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v225, "certificationStatus")}];
            [(__CFString *)v101 setCertificationStatus:v129];

            v130 = [(HMDHome *)v118 uuidToHAPAccessoryConfigTable];
            [v130 setObject:v75 forKey:v237];

            [v202 addObject:v101];
LABEL_102:

            context = v99;
            v229 = v98;
            v232 = v97;
          }

          v73 = v220 + 1;
        }

        while ((v220 + 1) != obja);
        obja = [v204 countByEnumeratingWithState:&v267 objects:v296 count:16];
      }

      while (obja);
    }

    if ([v218 count])
    {
      v254 = 0u;
      v255 = 0u;
      v252 = 0u;
      v253 = 0u;
      v131 = v218;
      v132 = [v131 countByEnumeratingWithState:&v252 objects:v293 count:16];
      if (v132)
      {
        v133 = *v253;
        do
        {
          for (k = 0; k != v132; ++k)
          {
            if (*v253 != v133)
            {
              objc_enumerationMutation(v131);
            }

            v135 = *(*(&v252 + 1) + 8 * k);
            if (([v135 isPrimary] & 1) == 0)
            {
              v136 = [v135 transactionWithObjectChangeType:3];
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v137 = v136;
              }

              else
              {
                v137 = 0;
              }

              v138 = v137;

              v139 = objc_autoreleasePoolPush();
              v140 = vala;
              v141 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v141, OS_LOG_TYPE_INFO))
              {
                v142 = HMFGetLogIdentifier();
                v143 = [v225 shortDescription];
                *buf = 138543874;
                v301 = v142;
                v302 = 2114;
                v303 = v143;
                v304 = 2114;
                v305 = v138;
                _os_log_impl(&dword_229538000, v141, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Removing a secondary accessory %{public}@", buf, 0x20u);
              }

              objc_autoreleasePoolPop(v139);
              if (v138)
              {
                [v196 addObject:v138];
              }
            }
          }

          v132 = [v131 countByEnumeratingWithState:&v252 objects:v293 count:16];
        }

        while (v132);
      }
    }

    v144 = dispatch_group_create();
    v221 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v224 = v197;
    v145 = v225;
    v234 = v232;
    v231 = v229;
    v238 = context;
    contextb = v145;
    v146 = [v145 configNumber];
    if ([v224 configNumber] == v146)
    {
      if ([v238 count] || objc_msgSend(v234, "count"))
      {

LABEL_127:
        v147 = objc_autoreleasePoolPush();
        v148 = vala;
        v149 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v149, OS_LOG_TYPE_ERROR))
        {
          v150 = HMFGetLogIdentifier();
          v151 = [contextb shortDescription];
          v152 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v193];
          *buf = 138543874;
          v301 = v150;
          v302 = 2112;
          v303 = v151;
          v304 = 2112;
          v305 = v152;
          _os_log_impl(&dword_229538000, v149, OS_LOG_TYPE_ERROR, "%{public}@Only storing the update locally since the accessory %@ didn't update its config number: %@ after updating its services/characteristics.", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v147);
        v153 = @"Add Accessory Locally";
        v154 = +[HMDBackingStoreTransactionOptions defaultLocalOptions];

        v155 = @"Add Accessory Locally";
        v221 = v154;
        goto LABEL_132;
      }

      v289 = 0u;
      v290 = 0u;
      v287 = 0u;
      v288 = 0u;
      v207 = v231;
      v199 = [v207 countByEnumeratingWithState:&v287 objects:buf count:16];
      if (v199)
      {
        v175 = *v288;
        objb = *MEMORY[0x277CD2138];
        v211 = *MEMORY[0x277CD21A8];
        v195 = *v288;
        while (2)
        {
          v176 = 0;
          do
          {
            if (*v288 != v175)
            {
              v177 = v176;
              objc_enumerationMutation(v207);
              v176 = v177;
            }

            v198 = v176;
            v178 = *(*(&v287 + 1) + 8 * v176);
            v179 = [v178 instanceID];
            v180 = [contextb findService:v179];

            v181 = [v180 serviceType];
            v182 = [v178 serviceType];
            v183 = [v181 isEqualToString:v182];

            if (!v183)
            {
LABEL_167:

              goto LABEL_127;
            }

            v285 = 0u;
            v286 = 0u;
            v283 = 0u;
            v284 = 0u;
            v209 = [v178 characteristics];
            v184 = [v209 countByEnumeratingWithState:&v283 objects:v299 count:16];
            if (v184)
            {
              v185 = *v284;
              while (2)
              {
                for (m = 0; m != v184; ++m)
                {
                  if (*v284 != v185)
                  {
                    objc_enumerationMutation(v209);
                  }

                  v187 = *(*(&v283 + 1) + 8 * m);
                  v188 = [v187 objectForKeyedSubscript:objb];
                  v189 = [v187 objectForKeyedSubscript:v211];
                  v190 = [v180 findCharacteristic:v188];
                  v191 = [v190 characteristicType];
                  v192 = [v191 isEqualToString:v189];

                  if (!v192)
                  {

                    goto LABEL_167;
                  }
                }

                v184 = [v209 countByEnumeratingWithState:&v283 objects:v299 count:16];
                if (v184)
                {
                  continue;
                }

                break;
              }
            }

            v176 = v198 + 1;
            v175 = v195;
          }

          while (v198 + 1 != v199);
          v199 = [v207 countByEnumeratingWithState:&v287 objects:buf count:16];
          v175 = v195;
          if (v199)
          {
            continue;
          }

          break;
        }
      }
    }

    else
    {
    }

    v155 = @"Add Accessory";
LABEL_132:
    v156 = [(HMDHome *)vala backingStore];
    v157 = [v156 transaction:v155 options:v221];

    v158 = [v203 arrayByAddingObjectsFromArray:v202];
    v159 = [v158 arrayByAddingObjectsFromArray:v196];

    v250 = 0u;
    v251 = 0u;
    v248 = 0u;
    v249 = 0u;
    v160 = v159;
    v161 = [v160 countByEnumeratingWithState:&v248 objects:v292 count:16];
    if (v161)
    {
      v162 = *v249;
      do
      {
        for (n = 0; n != v161; ++n)
        {
          if (*v249 != v162)
          {
            objc_enumerationMutation(v160);
          }

          v164 = *(*(&v248 + 1) + 8 * n);
          [v164 setConfigurationTracker:v144];
          [v157 add:v164 withMessage:0];
        }

        v161 = [v160 countByEnumeratingWithState:&v248 objects:v292 count:16];
      }

      while (v161);
    }

    v165 = [v231 arrayByAddingObjectsFromArray:v234];
    v166 = [v165 arrayByAddingObjectsFromArray:v238];

    v246 = 0u;
    v247 = 0u;
    v244 = 0u;
    v245 = 0u;
    v167 = v166;
    v168 = [v167 countByEnumeratingWithState:&v244 objects:v291 count:16];
    if (v168)
    {
      v169 = *v245;
      do
      {
        for (ii = 0; ii != v168; ++ii)
        {
          if (*v245 != v169)
          {
            objc_enumerationMutation(v167);
          }

          v171 = *(*(&v244 + 1) + 8 * ii);
          [v171 setConfigurationTracker:v144];
          [v157 add:v171 withMessage:0];
        }

        v168 = [v167 countByEnumeratingWithState:&v244 objects:v291 count:16];
      }

      while (v168);
    }

    objc_initWeak(buf, vala);
    v239[0] = MEMORY[0x277D85DD0];
    v239[1] = 3221225472;
    v239[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke;
    v239[3] = &unk_278681F48;
    objc_copyWeak(&v243, buf);
    v240 = v224;
    v172 = v144;
    v241 = v172;
    v173 = v202;
    v242 = v173;
    [v157 run:v239];

    objc_destroyWeak(&v243);
    objc_destroyWeak(buf);

    goto LABEL_147;
  }

LABEL_148:

  v174 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke(uint64_t a1)
{
  v54 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v29 = a1;
    v3 = [*(a1 + 32) accessories];
    v31 = WeakRetained;
    v30 = [WeakRetained accessories];
    v4 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v47 = 0u;
    v48 = 0u;
    v49 = 0u;
    v50 = 0u;
    obj = v3;
    v32 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
    if (v32)
    {
      v28 = *v48;
      do
      {
        v5 = 0;
        do
        {
          if (*v48 != v28)
          {
            objc_enumerationMutation(obj);
          }

          v6 = *(*(&v47 + 1) + 8 * v5);
          v43 = 0u;
          v44 = 0u;
          v45 = 0u;
          v46 = 0u;
          v7 = v30;
          v8 = [v7 countByEnumeratingWithState:&v43 objects:v52 count:16];
          if (v8)
          {
            v9 = v8;
            v10 = *v44;
            do
            {
              v11 = 0;
              do
              {
                if (*v44 != v10)
                {
                  objc_enumerationMutation(v7);
                }

                v12 = *(*(&v43 + 1) + 8 * v11);
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v13 = v12;
                }

                else
                {
                  v13 = 0;
                }

                v14 = v13;

                if (v14 && [v14 matchesHAPAccessory:v6])
                {
                  [v4 setObject:v6 forKey:v14];
                }

                ++v11;
              }

              while (v9 != v11);
              v9 = [v7 countByEnumeratingWithState:&v43 objects:v52 count:16];
            }

            while (v9);
          }

          ++v5;
        }

        while (v5 != v32);
        v32 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
      }

      while (v32);
    }

    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v15 = v4;
    v16 = [v15 countByEnumeratingWithState:&v39 objects:v51 count:16];
    if (v16)
    {
      v17 = v16;
      v33 = *v40;
      do
      {
        v18 = 0;
        do
        {
          if (*v40 != v33)
          {
            objc_enumerationMutation(v15);
          }

          v19 = *(*(&v39 + 1) + 8 * v18);
          dispatch_group_enter(*(v29 + 40));
          v20 = [v15 objectForKey:v19];
          v21 = [v31 notificationRegistrations];
          v22 = [v21 count] != 0;
          v23 = [v31 workQueue];
          v37[0] = MEMORY[0x277D85DD0];
          v37[1] = 3221225472;
          v37[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_2;
          v37[3] = &unk_27868A010;
          v37[4] = v19;
          v37[5] = v31;
          v38 = *(v29 + 40);
          [v19 configureWithAccessory:v20 homeNotificationsEnabled:v22 queue:v23 completion:v37];

          ++v18;
        }

        while (v17 != v18);
        v17 = [v15 countByEnumeratingWithState:&v39 objects:v51 count:16];
      }

      while (v17);
    }

    v24 = *(v29 + 40);
    WeakRetained = v31;
    v25 = [v31 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_3;
    block[3] = &unk_27868A010;
    block[4] = v31;
    v35 = *(v29 + 32);
    v36 = *(v29 + 48);
    dispatch_group_notify(v24, v25, block);
  }

  v26 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_2(uint64_t a1)
{
  logAndPostNotification(@"HMDAccessoryConnectedNotification", *(a1 + 32), 0);
  [*(a1 + 32) updateLightProfilesSettings];
  v2 = [*(a1 + 40) homeManager];
  v3 = [v2 hasLoadedData];

  if (v3)
  {
    [*(a1 + 40) _auditActionSetsAndTriggersForAccessory:*(a1 + 32)];
  }

  v4 = *(a1 + 48);

  dispatch_group_leave(v4);
}

uint64_t __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_3(uint64_t a1)
{
  v1 = a1;
  v46 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) identifier];
  v4 = [v1[5] linkType];
  v38[0] = MEMORY[0x277D85DD0];
  v38[1] = 3221225472;
  v38[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_4;
  v38[3] = &unk_278682958;
  v38[4] = v1[4];
  [v2 _notifyRetrievalError:0 accessoryServer:v3 linkType:v4 accessoryOperationBlock:v38];

  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = v1[6];
  v5 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
  if (v5)
  {
    v7 = v5;
    v8 = *v35;
    v9 = v32;
    *&v6 = 138543874;
    v27 = v6;
    v28 = *v35;
    do
    {
      v10 = 0;
      do
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v11 = v1[4];
        v12 = [*(*(&v34 + 1) + 8 * v10) uuid];
        v13 = [v11 accessoryWithUUID:v12];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if (v15)
        {
          v16 = objc_autoreleasePoolPush();
          v17 = v1[4];
          v18 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
          {
            v19 = HMFGetLogIdentifier();
            v20 = [v15 shortDescription];
            [v15 supportsTargetController];
            HMFBooleanToString();
            v30 = v16;
            v21 = v7;
            v22 = v1;
            v24 = v23 = v9;
            *buf = v27;
            v40 = v19;
            v41 = 2112;
            v42 = v20;
            v43 = 2112;
            v44 = v24;
            _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Bridged accessory %@ (supportsTargetController %@) being added to home", buf, 0x20u);

            v8 = v28;
            v9 = v23;
            v1 = v22;
            v7 = v21;
            v16 = v30;
          }

          objc_autoreleasePoolPop(v16);
          v31[0] = MEMORY[0x277D85DD0];
          v31[1] = 3221225472;
          v32[0] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_2053;
          v32[1] = &unk_27868A250;
          v33 = v15;
          [v33 readInitialRequiredCharacteristicsForAccessory:v31];
        }

        ++v10;
      }

      while (v7 != v10);
      v7 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
    }

    while (v7);
  }

  result = [v1[4] _evaluateShouldRelaunchAndSetRelaunch];
  v26 = *MEMORY[0x277D85DE8];
  return result;
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_4(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 isPrimary])
  {
    v4 = MEMORY[0x277D85DD0];
    v5 = 3221225472;
    v6 = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_5;
    v7 = &unk_27868A1D8;
    v8 = *(a1 + 32);
    v9 = v3;
    [v9 maybeCommissionToThreadNetworkWithCompletion:&v4];
  }

  [v3 handleUpdatedServicesForThreadManagementWithCompletion:{0, v4, v5, v6, v7, v8}];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_5(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) shortDescription];
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Commissioning finished for %@ with error: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
}

- (void)_processUpdatedProductDataForAccessory:(id)a3 hapAccessory:(id)a4 transaction:(id)a5
{
  v54 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v8 productData];
  v12 = [(HMDHome *)self _productDataFromHAPAccessory:v9];
  v13 = v12;
  if (v11)
  {
    if (v12)
    {
      if (([v12 isEqualToString:v11] & 1) == 0)
      {
        v14 = +[HMDVendorDataManager sharedVendorDataManager];
        v15 = [v14 vendorModelEntryForProductData:v11];

        if (v15)
        {
          v16 = [v15 productDataAlternates];
          v17 = [v16 containsObject:v13];

          v18 = objc_autoreleasePoolPush();
          v19 = self;
          v20 = HMFGetOSLogHandle();
          v21 = v20;
          if (v17)
          {
            if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
            {
              HMFGetLogIdentifier();
              v22 = v41 = v18;
              v23 = [v8 shortDescription];
              *buf = 138544130;
              v45 = v22;
              v46 = 2112;
              v47 = v23;
              v48 = 2112;
              v49 = v11;
              v50 = 2112;
              v51 = v13;
              _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ has changed its product data to a value that is allowed, binding: %@ -> %@", buf, 0x2Au);

              v18 = v41;
            }

            objc_autoreleasePoolPop(v18);
            [v10 setProductDataV2:v13];
            goto LABEL_22;
          }

          if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
          {
            v34 = HMFGetLogIdentifier();
            [v8 shortDescription];
            v38 = v43 = v18;
            *buf = 138544130;
            v45 = v34;
            v46 = 2112;
            v47 = v38;
            v48 = 2112;
            v49 = v11;
            v50 = 2112;
            v51 = v13;
            _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has changed its productData to a value that is not allowed, keeping previous product data: %@ -> %@", buf, 0x2Au);

            v18 = v43;
            goto LABEL_20;
          }
        }

        else
        {
          v18 = objc_autoreleasePoolPush();
          v19 = self;
          v21 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            v35 = [v8 shortDescription];
            [v8 manufacturer];
            v36 = v40 = v19;
            [v8 model];
            v37 = v42 = v18;
            *buf = 138544386;
            v45 = v34;
            v46 = 2112;
            v47 = v35;
            v48 = 2112;
            v49 = v36;
            v50 = 2112;
            v51 = v37;
            v52 = 2112;
            v53 = v11;
            _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ could not be found in the VIDB, keeping previous product data (manufacturer: '%@', model: '%@', productData: '%@')", buf, 0x34u);

            v18 = v42;
            v19 = v40;

            v15 = 0;
LABEL_20:
          }
        }

        objc_autoreleasePoolPop(v18);
LABEL_22:
      }
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      v30 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        v33 = [v8 shortDescription];
        *buf = 138543874;
        v45 = v32;
        v46 = 2112;
        v47 = v33;
        v48 = 2112;
        v49 = v11;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ is no longer advertising product data, keeping previous product data %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
    }
  }

  else if (v12)
  {
    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [v8 shortDescription];
      *buf = 138543874;
      v45 = v27;
      v46 = 2112;
      v47 = v28;
      v48 = 2112;
      v49 = v13;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ is now bound to product data %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v24);
    [v10 setProductDataV2:v13];
    [v10 setProductData:v13];
  }

  v39 = *MEMORY[0x277D85DE8];
}

- (void)_processProductDataForNewlyAddedAccessory:(id)a3 transaction:(id)a4
{
  v21 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self _productDataFromHAPAccessory:v6];
  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v6 shortDescription];
      v15 = 138543874;
      v16 = v12;
      v17 = 2112;
      v18 = v13;
      v19 = 2112;
      v20 = v8;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ is now bound to productData %@", &v15, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [v7 setProductDataV2:v8];
    [v7 setProductData:v8];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)_productDataFromHAPAccessory:(id)a3
{
  v61 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 server];
  v6 = [v5 productData];

  if (v6)
  {
    v7 = [v5 productData];
    v8 = [HMDAccessory validateProductData:v7];

    if (v8)
    {
      v9 = [v4 productData];
      if (v9)
      {
        v10 = v9;
        v11 = [v5 productData];
        v12 = [v4 productData];
        v13 = [v11 isEqualToString:v12];

        if ((v13 & 1) == 0)
        {
          v14 = objc_autoreleasePoolPush();
          v15 = self;
          v16 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            v17 = HMFGetLogIdentifier();
            v18 = [v4 shortDescription];
            v19 = [v5 productData];
            v20 = [v4 productData];
            v53 = 138544130;
            v54 = v17;
            v55 = 2112;
            v56 = v18;
            v57 = 2112;
            v58 = v19;
            v59 = 2112;
            v60 = v20;
            _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ is using productData from pair setup that differs from productData published on AIS: %@ != %@", &v53, 0x2Au);
          }

          objc_autoreleasePoolPop(v14);
        }
      }

      v21 = v5;
      goto LABEL_15;
    }

    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      v26 = [v4 shortDescription];
      v27 = [v5 productData];
      v53 = 138543874;
      v54 = v25;
      v55 = 2112;
      v56 = v26;
      v57 = 2112;
      v58 = v27;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has invalid productData from pair setup: %@", &v53, 0x20u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v28 = [v4 productData];

  if (v28)
  {
    v29 = [v4 productData];
    v30 = [HMDAccessory validateProductData:v29];

    if (v30)
    {
      v21 = v4;
LABEL_15:
      v31 = [v21 productData];
      goto LABEL_29;
    }

    v32 = objc_autoreleasePoolPush();
    v33 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      v36 = [v4 shortDescription];
      v37 = [v4 productData];
      v53 = 138543874;
      v54 = v35;
      v55 = 2112;
      v56 = v36;
      v57 = 2112;
      v58 = v37;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has invalid productData published on AIS: %@", &v53, 0x20u);
    }

    objc_autoreleasePoolPop(v32);
  }

  v38 = +[HMDVendorDataManager sharedVendorDataManager];
  v39 = [v4 manufacturer];
  v40 = [v4 model];
  v41 = [v38 vendorModelEntryForManufacturer:v39 model:v40];

  if (!v41)
  {
    v43 = objc_autoreleasePoolPush();
    v44 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      v47 = [v4 shortDescription];
      v48 = [v4 manufacturer];
      v49 = [v4 model];
      v53 = 138544130;
      v54 = v46;
      v55 = 2112;
      v56 = v47;
      v57 = 2112;
      v58 = v48;
      v59 = 2112;
      v60 = v49;
      v50 = "%{public}@Accessory %@ could not be found in the VIDB (manufacturer: '%@', model: '%@')";
LABEL_26:
      _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_ERROR, v50, &v53, 0x2Au);
    }

LABEL_27:

    objc_autoreleasePoolPop(v43);
    v31 = 0;
    goto LABEL_28;
  }

  v42 = [v41 productData];

  if (!v42)
  {
    v43 = objc_autoreleasePoolPush();
    v44 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      v47 = [v4 shortDescription];
      v48 = [v4 manufacturer];
      v49 = [v4 model];
      v53 = 138544130;
      v54 = v46;
      v55 = 2112;
      v56 = v47;
      v57 = 2112;
      v58 = v48;
      v59 = 2112;
      v60 = v49;
      v50 = "%{public}@Accessory %@ does not have productData in the VIDB (manufacturer: '%@', model: '%@')";
      goto LABEL_26;
    }

    goto LABEL_27;
  }

  v31 = [v41 productData];
LABEL_28:

LABEL_29:
  v51 = *MEMORY[0x277D85DE8];

  return v31;
}

- (void)filterServiceTransactions:(id)a3 removedServiceUUIDs:(id)a4
{
  v41 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (v6 && [v6 count] && objc_msgSend(v7, "count"))
  {
    v8 = [MEMORY[0x277CCAB58] indexSet];
    v30 = 0u;
    v31 = 0u;
    v32 = 0u;
    v33 = 0u;
    v26 = v6;
    v9 = v6;
    v10 = [v9 countByEnumeratingWithState:&v30 objects:v40 count:16];
    if (v10)
    {
      v11 = v10;
      v12 = *v31;
      v27 = *v31;
      v28 = v9;
      do
      {
        v13 = 0;
        v29 = v11;
        do
        {
          if (*v31 != v12)
          {
            objc_enumerationMutation(v9);
          }

          v14 = *(*(&v30 + 1) + 8 * v13);
          v15 = [v14 uuid];
          v16 = [v7 containsObject:v15];

          if (v16)
          {
            [v8 addIndex:{objc_msgSend(v9, "indexOfObject:", v14)}];
            v17 = objc_autoreleasePoolPush();
            v18 = self;
            v19 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
            {
              v20 = HMFGetLogIdentifier();
              [v14 uuid];
              v21 = v8;
              v22 = self;
              v24 = v23 = v7;
              *buf = 138543874;
              v35 = v20;
              v36 = 2114;
              v37 = v24;
              v38 = 2114;
              v39 = v14;
              _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@[Pair-Verify %{public}@] Removing duplicate service transaction %{public}@", buf, 0x20u);

              v7 = v23;
              self = v22;
              v8 = v21;
              v9 = v28;

              v12 = v27;
            }

            objc_autoreleasePoolPop(v17);
            v11 = v29;
          }

          ++v13;
        }

        while (v11 != v13);
        v11 = [v9 countByEnumeratingWithState:&v30 objects:v40 count:16];
      }

      while (v11);
    }

    [v9 removeObjectsAtIndexes:v8];
    v6 = v26;
  }

  v25 = *MEMORY[0x277D85DE8];
}

- (BOOL)getUpdateTransactionForAccessory:(id)a3 hapAccessory:(id)a4 accessoryTransaction:(id)a5 addSvcTransactions:(id *)a6 updateSvcTransactions:(id *)a7 removeSvcTransactions:(id *)a8
{
  v170 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = [v10 services];
  v14 = [v13 mutableCopy];

  v155 = 0u;
  v156 = 0u;
  v153 = 0u;
  v154 = 0u;
  v116 = v11;
  v15 = [v11 services];
  v16 = [v15 countByEnumeratingWithState:&v153 objects:v169 count:16];
  v126 = v10;
  v122 = v12;
  if (!v16)
  {
    goto LABEL_65;
  }

  v17 = v16;
  v18 = *v154;
  v134 = 138544130;
  v121 = v15;
  v123 = *v154;
  while (2)
  {
    v19 = 0;
    v124 = v17;
    do
    {
      v127 = v14;
      if (*v154 != v18)
      {
        objc_enumerationMutation(v15);
      }

      v125 = v19;
      v20 = *(*(&v153 + 1) + 8 * v19);
      v21 = [(HMDHome *)self dataSource];
      v22 = [v21 hapMetadata];
      v23 = [v20 type];
      v24 = [v22 shouldFilterServiceOfType:v23];

      if (v24)
      {
        v14 = v127;
        goto LABEL_63;
      }

      v151 = 0u;
      v152 = 0u;
      v149 = 0u;
      v150 = 0u;
      v25 = [v10 services];
      v26 = [v25 countByEnumeratingWithState:&v149 objects:v168 count:16];
      if (v26)
      {
        v27 = v26;
        v28 = *v150;
        while (2)
        {
          for (i = 0; i != v27; ++i)
          {
            if (*v150 != v28)
            {
              objc_enumerationMutation(v25);
            }

            v30 = *(*(&v149 + 1) + 8 * i);
            v31 = [v30 instanceID];
            v32 = [v20 instanceID];
            v33 = [v31 isEqual:v32];

            if (v33)
            {
              v34 = v30;
              goto LABEL_18;
            }
          }

          v27 = [v25 countByEnumeratingWithState:&v149 objects:v168 count:16];
          if (v27)
          {
            continue;
          }

          break;
        }

        v34 = 0;
LABEL_18:
        v15 = v121;
        v12 = v122;
      }

      else
      {
        v34 = 0;
      }

      v35 = [v12 uuid];
      if (v34)
      {
        v36 = 2;
      }

      else
      {
        v36 = 1;
      }

      v37 = [(HMDHome *)self getServiceTransaction:v20 parentUUID:v35 changeType:v36];

      v38 = [(HMDServiceTransaction *)v34 type];
      if (v38)
      {
        v39 = v38;
        v40 = [(HMDServiceTransaction *)v34 type];
        v41 = [(HMDServiceTransaction *)v37 serviceType];
        v42 = [v40 isEqualToString:v41];

        if ((v42 & 1) == 0)
        {

          v111 = 0;
          v94 = v127;
          goto LABEL_82;
        }
      }

      [(HMDHome *)self __updateServiceTransaction:v37 accessoryTransaction:v12 service:v34 accessory:v10 hapService:v20];
      v43 = [(HMDServiceTransaction *)v34 accessory];
      v44 = [v43 shortDescription];
      v45 = v44;
      v46 = v37;
      if (v44)
      {
        v135 = v44;
      }

      else
      {
        v47 = [(HMDBackingStoreModelObject *)v37 parentUUID];
        v135 = [v47 UUIDString];
      }

      if (!v34)
      {
        goto LABEL_59;
      }

      v48 = [(HMDBackingStoreModelObject *)v34 uuid];
      v49 = [(HMDBackingStoreModelObject *)v37 uuid];
      v50 = [v48 isEqual:v49];

      if ((v50 & 1) == 0)
      {
        v84 = objc_autoreleasePoolPush();
        v85 = self;
        v86 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v86, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v88 = v87 = v37;
          v89 = [(HMDBackingStoreModelObject *)v37 uuid];
          *buf = 138544130;
          v161 = v88;
          v162 = 2114;
          v163 = v89;
          v164 = 2114;
          v165 = v34;
          v166 = 2114;
          v167 = v87;
          _os_log_impl(&dword_229538000, v86, OS_LOG_TYPE_ERROR, "%{public}@[Pair-Verify %{public}@] matched service %{public}@ doesn't match the service transaction: %{public}@. Removing it to re-add.", buf, 0x2Au);

          v46 = v87;
        }

        objc_autoreleasePoolPop(v84);
LABEL_59:
        v90 = objc_autoreleasePoolPush();
        v91 = self;
        v92 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v92, OS_LOG_TYPE_INFO))
        {
          v93 = HMFGetLogIdentifier();
          *buf = 138543874;
          v161 = v93;
          v162 = 2114;
          v163 = v135;
          v164 = 2114;
          v165 = v46;
          _os_log_impl(&dword_229538000, v92, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Adding service %{public}@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v90);
        [*a6 addObject:v46];
        v14 = v127;
        goto LABEL_62;
      }

      v51 = [(HMDServiceTransaction *)v34 modelObjectWithChangeType:1];
      v148 = 0;
      v131 = v51;
      [v51 diff:v37 differingFields:&v148];
      v52 = v148;
      v119 = v52;
      v132 = v37;
      if (a7)
      {
        v53 = v52;
        if ([(HMDServiceTransaction *)v52 count])
        {
          v117 = v34;
          v54 = objc_autoreleasePoolPush();
          v55 = self;
          v56 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
          {
            v57 = HMFGetLogIdentifier();
            *buf = 138544130;
            v161 = v57;
            v162 = 2112;
            v163 = v135;
            v164 = 2114;
            v165 = v46;
            v166 = 2114;
            v167 = v53;
            _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %@] Received service update %{public}@ due to diff %{public}@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v54);
          v146 = 0u;
          v147 = 0u;
          v144 = 0u;
          v145 = 0u;
          obj = v53;
          v58 = [(HMDServiceTransaction *)obj countByEnumeratingWithState:&v144 objects:v159 count:16];
          if (v58)
          {
            v59 = v58;
            v60 = *v145;
            do
            {
              for (j = 0; j != v59; ++j)
              {
                if (*v145 != v60)
                {
                  objc_enumerationMutation(obj);
                }

                v62 = *(*(&v144 + 1) + 8 * j);
                v63 = objc_autoreleasePoolPush();
                v64 = v55;
                v65 = v55;
                v66 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
                {
                  v67 = HMFGetLogIdentifier();
                  v68 = [v131 valueForKeyPath:v62];
                  *buf = 138544130;
                  v161 = v67;
                  v162 = 2114;
                  v163 = v135;
                  v164 = 2114;
                  v165 = v62;
                  v166 = 2114;
                  v167 = v68;
                  _os_log_impl(&dword_229538000, v66, OS_LOG_TYPE_INFO, "%{public}@[%{public}@] LOCAL %{public}@: %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v63);
                v69 = objc_autoreleasePoolPush();
                v70 = v65;
                v71 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v71, OS_LOG_TYPE_INFO))
                {
                  v72 = HMFGetLogIdentifier();
                  v73 = [(HMDServiceTransaction *)v132 valueForKeyPath:v62];
                  *buf = 138544130;
                  v161 = v72;
                  v162 = 2114;
                  v163 = v135;
                  v164 = 2114;
                  v165 = v62;
                  v166 = 2114;
                  v167 = v73;
                  _os_log_impl(&dword_229538000, v71, OS_LOG_TYPE_INFO, "%{public}@[%{public}@] UPDATE %{public}@: %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v69);
                v55 = v64;
              }

              v59 = [(HMDServiceTransaction *)obj countByEnumeratingWithState:&v144 objects:v159 count:16];
            }

            while (v59);
          }

          [*a7 addObject:v132];
          v34 = v117;
        }
      }

      v74 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v127, "count")}];
      v140 = 0u;
      v141 = 0u;
      v142 = 0u;
      v143 = 0u;
      v75 = v127;
      v76 = [v75 countByEnumeratingWithState:&v140 objects:v158 count:16];
      if (v76)
      {
        v77 = v76;
        v78 = *v141;
        do
        {
          for (k = 0; k != v77; ++k)
          {
            if (*v141 != v78)
            {
              objc_enumerationMutation(v75);
            }

            v80 = *(*(&v140 + 1) + 8 * k);
            v81 = [v80 uuid];
            v82 = [(HMDBackingStoreModelObject *)v34 uuid];
            v83 = [v81 isEqual:v82];

            if ((v83 & 1) == 0)
            {
              [v74 addObject:v80];
            }
          }

          v77 = [v75 countByEnumeratingWithState:&v140 objects:v158 count:16];
        }

        while (v77);
      }

      v135 = v132;
      v46 = v34;
      v14 = v74;
      v10 = v126;
      v15 = v121;
      v12 = v122;
LABEL_62:
      v18 = v123;
      v17 = v124;

LABEL_63:
      v19 = v125 + 1;
    }

    while (v125 + 1 != v17);
    v17 = [v15 countByEnumeratingWithState:&v153 objects:v169 count:16];
    if (v17)
    {
      continue;
    }

    break;
  }

LABEL_65:

  v138 = 0u;
  v139 = 0u;
  v136 = 0u;
  v137 = 0u;
  v94 = v14;
  v95 = [v94 countByEnumeratingWithState:&v136 objects:v157 count:16];
  if (v95)
  {
    v96 = v95;
    v128 = v94;
    v97 = *v137;
    do
    {
      for (m = 0; m != v96; ++m)
      {
        if (*v137 != v97)
        {
          objc_enumerationMutation(v128);
        }

        v99 = *(*(&v136 + 1) + 8 * m);
        v100 = [HMDServiceTransaction alloc];
        v101 = [v99 uuid];
        v102 = [v10 uuid];
        v103 = [(HMDBackingStoreModelObject *)v100 initWithObjectChangeType:3 uuid:v101 parentUUID:v102];

        v104 = objc_autoreleasePoolPush();
        v105 = self;
        v106 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v106, OS_LOG_TYPE_INFO))
        {
          v107 = HMFGetLogIdentifier();
          v108 = [v99 accessory];
          v109 = [v108 shortDescription];
          v110 = v109;
          if (!v109)
          {
            v134 = [(HMDBackingStoreModelObject *)v103 parentUUID];
            v110 = v134;
          }

          *buf = 138543874;
          v161 = v107;
          v162 = 2114;
          v163 = v110;
          v164 = 2114;
          v165 = v103;
          _os_log_impl(&dword_229538000, v106, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Removing service %{public}@", buf, 0x20u);
          if (!v109)
          {
          }

          v10 = v126;
        }

        objc_autoreleasePoolPop(v104);
        [*a8 addObject:v103];
      }

      v96 = [v128 countByEnumeratingWithState:&v136 objects:v157 count:16];
    }

    while (v96);
    v94 = v128;

    v12 = v122;
    goto LABEL_81;
  }

  if (a8)
  {
LABEL_81:
    v112 = MEMORY[0x277CBEB98];
    v113 = [*a8 na_map:&__block_literal_global_2041];
    v15 = [v112 setWithArray:v113];

    [(HMDHome *)self filterServiceTransactions:*a6 removedServiceUUIDs:v15];
    [(HMDHome *)self filterServiceTransactions:*a7 removedServiceUUIDs:v15];
    v111 = 1;
LABEL_82:
  }

  else
  {
    v111 = 1;
  }

  v114 = *MEMORY[0x277D85DE8];
  return v111;
}

- (void)__updateServiceTransaction:(id)a3 accessoryTransaction:(id)a4 service:(id)a5 accessory:(id)a6 hapService:(id)a7
{
  v99 = *MEMORY[0x277D85DE8];
  v71 = a3;
  v70 = a4;
  v12 = a5;
  v74 = a6;
  v13 = a7;
  v14 = MEMORY[0x277CBEB18];
  v69 = v13;
  v15 = [v13 characteristics];
  v16 = [v14 arrayWithArray:v15];

  if ([v16 count])
  {
    v17 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v16, "count")}];
    v91 = 0u;
    v92 = 0u;
    v93 = 0u;
    v94 = 0u;
    v67 = v16;
    obj = v16;
    v18 = [obj countByEnumeratingWithState:&v91 objects:v98 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = 0x277CBE000uLL;
      v77 = *MEMORY[0x277CD2138];
      v76 = *MEMORY[0x277CD21A8];
      v82 = *MEMORY[0x277CD2190];
      v83 = *v92;
      v75 = *MEMORY[0x277CD2148];
      v68 = v12;
      v78 = v17;
      v79 = self;
      do
      {
        v21 = 0;
        v80 = v19;
        do
        {
          if (*v92 != v83)
          {
            objc_enumerationMutation(obj);
          }

          v84 = v21;
          v22 = *(*(&v91 + 1) + 8 * v21);
          v23 = [(HMDHome *)self dataSource];
          v24 = [v23 hapMetadata];
          v25 = [v22 type];
          v26 = [v24 shouldFilterCharacteristicOfType:v25];

          if ((v26 & 1) == 0)
          {
            v27 = [v22 metadata];
            v28 = [*(v20 + 2872) dictionaryWithCapacity:8];
            v29 = [v27 format];
            [v28 setObject:v29 forKeyedSubscript:@"metadataFormat"];

            v30 = [v27 units];
            [v28 setObject:v30 forKeyedSubscript:@"metadataUnits"];

            v31 = [v27 manufacturerDescription];
            [v28 setObject:v31 forKeyedSubscript:@"metadataUserDescription"];

            v32 = [v27 constraints];

            if (v32)
            {
              v33 = [v27 constraints];
              v34 = [v33 minimumValue];
              [v28 setObject:v34 forKeyedSubscript:@"metadataMinimumValue"];

              v35 = [v27 constraints];
              v36 = [v35 maximumValue];
              [v28 setObject:v36 forKeyedSubscript:@"metadataMaximumValue"];

              v37 = [v27 constraints];
              v38 = [v37 stepValue];
              [v28 setObject:v38 forKeyedSubscript:@"metadataStepValue"];

              v39 = [v27 constraints];
              v40 = [v39 maxLength];
              [v28 setObject:v40 forKeyedSubscript:@"metadataMaxLength"];

              v41 = [v27 constraints];
              v42 = [v41 validValues];
              [v28 setObject:v42 forKeyedSubscript:@"metadataValidValues"];
            }

            v43 = *(v20 + 2872);
            v96[0] = v77;
            v44 = [v22 instanceID];
            v97[0] = v44;
            v96[1] = v76;
            v45 = [v22 type];
            v97[1] = v45;
            v96[2] = v82;
            v46 = [MEMORY[0x277CCABB0] numberWithUnsignedShort:{objc_msgSend(v22, "properties")}];
            v96[3] = v75;
            v97[2] = v46;
            v97[3] = v28;
            v47 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v97 forKeys:v96 count:4];
            v48 = [v43 dictionaryWithDictionary:v47];

            if (v12)
            {
              v89 = 0u;
              v90 = 0u;
              v87 = 0u;
              v88 = 0u;
              v49 = [v12 characteristics];
              v50 = [v49 countByEnumeratingWithState:&v87 objects:v95 count:16];
              if (v50)
              {
                v72 = v48;
                v73 = v27;
                v51 = *v88;
LABEL_13:
                v52 = 0;
                while (1)
                {
                  if (*v88 != v51)
                  {
                    objc_enumerationMutation(v49);
                  }

                  v53 = *(*(&v87 + 1) + 8 * v52);
                  v54 = [v53 instanceID];
                  v55 = [v22 instanceID];
                  v56 = [v54 isEqual:v55];

                  if (v56)
                  {
                    break;
                  }

                  if (v50 == ++v52)
                  {
                    v50 = [v49 countByEnumeratingWithState:&v87 objects:v95 count:16];
                    if (v50)
                    {
                      goto LABEL_13;
                    }

                    v12 = v68;
                    v48 = v72;
                    v27 = v73;
                    goto LABEL_23;
                  }
                }

                v50 = v53;

                if (!v50)
                {
                  v12 = v68;
                  v48 = v72;
                  v27 = v73;
                  goto LABEL_25;
                }

                v57 = [v74 findServiceWithServiceType:@"00000701-0000-1000-8000-0026BB765291"];

                v12 = v68;
                v48 = v72;
                v27 = v73;
                if (!v57)
                {
                  goto LABEL_25;
                }

                v58 = [v22 properties];
                v59 = [v50 properties];
                v49 = [MEMORY[0x277CCABB0] numberWithUnsignedShort:v59 & 0x80 | v58];
                [v72 setObject:v49 forKeyedSubscript:v82];
              }

LABEL_23:

LABEL_25:
            }

            v17 = v78;
            [v78 addObject:v48];
            v60 = [v22 value];

            if (v60)
            {
              aBlock[0] = MEMORY[0x277D85DD0];
              aBlock[1] = 3221225472;
              aBlock[2] = __88__HMDHome___updateServiceTransaction_accessoryTransaction_service_accessory_hapService___block_invoke;
              aBlock[3] = &unk_278678710;
              v86 = v71;
              v61 = _Block_copy(aBlock);
              v62 = [v22 type];
              v63 = [v22 value];
              v64 = [v69 type];
              [HMDService processUpdateForCharacteristicType:v62 value:v63 serviceType:v64 service:v12 serviceTransactionGetter:v61 accessory:v74 accessoryTransaction:v70 accessoryTransactionChanged:0];
            }

            self = v79;
            v19 = v80;
            v20 = 0x277CBE000;
          }

          v21 = v84 + 1;
        }

        while (v84 + 1 != v19);
        v19 = [obj countByEnumeratingWithState:&v91 objects:v98 count:16];
      }

      while (v19);
    }

    v16 = v67;
  }

  else
  {
    v17 = 0;
  }

  v65 = +[HMDCharacteristic sortComparatorForCharacteristicDictionary];
  [v17 sortUsingComparator:v65];

  [v71 setCharacteristics:v17];
  v66 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didFinishPairingForAccessoryServer:(id)a4
{
  v53 = *MEMORY[0x277D85DE8];
  v43 = a3;
  v6 = a4;
  v7 = [(HMDHome *)self primaryResident];
  v8 = v7;
  if (v7 && ([v7 device], v9 = objc_claimAutoreleasedReturnValue(), v9, v9))
  {
    v10 = objc_alloc(MEMORY[0x277D0F820]);
    v11 = [(HMDHome *)self uuid];
    v42 = [v10 initWithTarget:v11];

    v12 = v6;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v13 = v12;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    v15 = [MEMORY[0x277CBEB38] dictionary];
    v16 = [v14 nodeID];
    [v15 setObject:v16 forKeyedSubscript:@"HMDHomePairingCompletionNodeIDMessageKey"];

    v17 = [v14 fabricID];
    [v15 setObject:v17 forKeyedSubscript:@"HMDHomePairingCompletionFabricIDMessageKey"];

    v18 = [v14 fabricID];
    [v15 setObject:v18 forKeyedSubscript:@"HMDHomePairingCompletionFabricIndexMessageKey"];

    v19 = [v14 vendorID];
    [v15 setObject:v19 forKeyedSubscript:@"HMDHomePairingCompletionVendorIDMessageKey"];

    v20 = [v14 productID];
    [v15 setObject:v20 forKeyedSubscript:@"HMDHomePairingCompletionProductIDMessageKey"];

    v21 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v14, "configNumber")}];
    [v15 setObject:v21 forKeyedSubscript:@"HMDHomePairingCompletionConfigNumberMessageKey"];

    v22 = [v14 category];
    [v15 setObject:v22 forKeyedSubscript:@"HMDHomePairingCompletionCategoryMessageKey"];

    v23 = [v14 topology];
    [v15 setObject:v23 forKeyedSubscript:@"HMDHomePairingCompletionTopologyMessageKey"];

    v24 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeNotificationPairingCompletionMessage" destination:v42 payload:v15];
    objc_initWeak(&location, self);
    v45[0] = MEMORY[0x277D85DD0];
    v45[1] = 3221225472;
    v45[2] = __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke;
    v45[3] = &unk_278687F40;
    objc_copyWeak(&v47, &location);
    v46 = v12;
    [v24 setResponseHandler:v45];
    v25 = objc_autoreleasePoolPush();
    v26 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
    {
      v28 = HMFGetLogIdentifier();
      v29 = [v24 shortDescription];
      *buf = 138543618;
      v50 = v28;
      v51 = 2112;
      v52 = v29;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Sending message %@ to notify pairing completion", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v25);
    v30 = [(HMDHome *)v26 primaryResidentMessageRouter];
    v31 = v30;
    if (v30)
    {
      v44[0] = MEMORY[0x277D85DD0];
      v44[1] = 3221225472;
      v44[2] = __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke_2037;
      v44[3] = &unk_27868A398;
      v44[4] = v26;
      [v30 routeMessage:v24 localHandler:v44];
    }

    else
    {
      v36 = objc_autoreleasePoolPush();
      v37 = v26;
      v38 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        v39 = HMFGetLogIdentifier();
        *buf = 138543362;
        v50 = v39;
        _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to send HMDHomeNotificationPairingCompletionMessage", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v36);
      v40 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v24 respondWithError:v40];
    }

    objc_destroyWeak(&v47);
    objc_destroyWeak(&location);
  }

  else
  {
    v32 = objc_autoreleasePoolPush();
    v33 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      *buf = 138543362;
      v50 = v35;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not available", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v32);
  }

  v41 = *MEMORY[0x277D85DE8];
}

void __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = v10;
    if (v5)
    {
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        v20 = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = v5;
        v14 = "%{public}@Failed to notify pairing completion for accessory server %@ to the primary resident with error %@";
        v15 = v11;
        v16 = OS_LOG_TYPE_ERROR;
        v17 = 32;
LABEL_7:
        _os_log_impl(&dword_229538000, v15, v16, v14, &v20, v17);
      }
    }

    else if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v18 = *(a1 + 32);
      v20 = 138543618;
      v21 = v12;
      v22 = 2112;
      v23 = v18;
      v14 = "%{public}@Successfully notified the primary resident of pairing completion for accessory server %@";
      v15 = v11;
      v16 = OS_LOG_TYPE_INFO;
      v17 = 22;
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v19 = *MEMORY[0x277D85DE8];
}

uint64_t __89__HMDHome_accessoryBrowser_didUpdateReachability_forBTLEAccessoriesWithServerIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 identifier];
  v4 = [v3 isEqualToString:*(a1 + 32)];

  return v4;
}

id __89__HMDHome_accessoryBrowser_didUpdateReachability_forBTLEAccessoriesWithServerIdentifier___block_invoke_2033(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 hasBTLELink])
  {
    v3 = [v2 identifier];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateCategory:(id)a5
{
  v25 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v9 identifier];
  v12 = [(HMDHome *)self hapAccessoryWithIdentifier:v11];

  if (v12)
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v12 shortDescription];
      v19 = 138543874;
      v20 = v16;
      v21 = 2112;
      v22 = v17;
      v23 = 2112;
      v24 = v10;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Paired Accessory: %@, Updated Category to %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    [v12 updateCategory:v10];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateHasPairings:(BOOL)a5
{
  v5 = a5;
  v25 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = [v9 identifier];
  v11 = [(HMDHome *)self hapAccessoryWithIdentifier:v10];

  if (v11)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v9 identifier];
      v19 = 138543874;
      v20 = v15;
      v21 = 2112;
      v22 = v16;
      v23 = 1024;
      v24 = v5;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Updating accessory server %@ with new value of hasPairings: %d", &v19, 0x1Cu);
    }

    objc_autoreleasePoolPop(v12);
    if ([v9 isPaired] == v5)
    {
      v17 = [(HMDHome *)v13 accessoryBrowser];
      [v17 resurrectAccessoryServer:v9];
    }

    else
    {
      [(HMDHome *)v13 _unconfigurePairedAccessoriesForServer:v9 updateReachability:1];
      v17 = [(HMDHome *)v13 accessoryBrowser];
      [v17 tombstoneAccessoryServer:v9];
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isSecureClassTriggeredByCharacteristics:(id)a3
{
  v70 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = MEMORY[0x277CBEB18];
  v6 = [(HMDHome *)self triggers];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(v6, "count")}];

  v58 = 0u;
  v59 = 0u;
  v56 = 0u;
  v57 = 0u;
  v38 = self;
  obj = [(HMDHome *)self triggers];
  v41 = [obj countByEnumeratingWithState:&v56 objects:v69 count:16];
  if (v41)
  {
    v40 = *v57;
    do
    {
      for (i = 0; i != v41; ++i)
      {
        if (*v57 != v40)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v56 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v54 = 0u;
        v55 = 0u;
        v52 = 0u;
        v53 = 0u;
        v42 = v11;
        v12 = [v11 characteristicBaseEvents];
        v13 = [v12 countByEnumeratingWithState:&v52 objects:v68 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v53;
          do
          {
            for (j = 0; j != v14; ++j)
            {
              if (*v53 != v15)
              {
                objc_enumerationMutation(v12);
              }

              v17 = [*(*(&v52 + 1) + 8 * j) characteristic];
              v18 = [v4 containsObject:v17];

              if (v18)
              {
                [v7 addObject:v9];
              }
            }

            v14 = [v12 countByEnumeratingWithState:&v52 objects:v68 count:16];
          }

          while (v14);
        }
      }

      v41 = [obj countByEnumeratingWithState:&v56 objects:v69 count:16];
    }

    while (v41);
  }

  v50 = 0u;
  v51 = 0u;
  v48 = 0u;
  v49 = 0u;
  v19 = v7;
  v20 = [v19 countByEnumeratingWithState:&v48 objects:v67 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v49;
    v43 = *v49;
    do
    {
      for (k = 0; k != v21; ++k)
      {
        if (*v49 != v22)
        {
          objc_enumerationMutation(v19);
        }

        v24 = *(*(&v48 + 1) + 8 * k);
        v44 = 0u;
        v45 = 0u;
        v46 = 0u;
        v47 = 0u;
        v25 = [v24 actionSets];
        v26 = [v25 countByEnumeratingWithState:&v44 objects:v66 count:16];
        if (v26)
        {
          v27 = v26;
          v28 = *v45;
          while (2)
          {
            for (m = 0; m != v27; ++m)
            {
              if (*v45 != v28)
              {
                objc_enumerationMutation(v25);
              }

              v30 = *(*(&v44 + 1) + 8 * m);
              if ([v30 containsSecureCharacteristic])
              {
                v32 = objc_autoreleasePoolPush();
                v33 = v38;
                v34 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v34, OS_LOG_TYPE_DEBUG))
                {
                  v35 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v61 = v35;
                  v62 = 2112;
                  v63 = v24;
                  v64 = 2112;
                  v65 = v30;
                  _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_DEBUG, "%{public}@Trigger %@ has action set %@ with security class", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v32);
                v31 = 1;
                goto LABEL_40;
              }
            }

            v27 = [v25 countByEnumeratingWithState:&v44 objects:v66 count:16];
            if (v27)
            {
              continue;
            }

            break;
          }
        }

        v22 = v43;
      }

      v21 = [v19 countByEnumeratingWithState:&v48 objects:v67 count:16];
      v31 = 0;
    }

    while (v21);
  }

  else
  {
    v31 = 0;
  }

LABEL_40:

  v36 = *MEMORY[0x277D85DE8];
  return v31;
}

- (void)handleUpdatedCharacteristics:(id)a3 accessoryServer:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_handleUpdatedCharacteristics_accessoryServer___block_invoke;
  block[3] = &unk_27868A010;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(v8, block);
}

- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateValuesForCharacteristics:(id)a5 stateNumber:(id)a6 broadcast:(BOOL)a7
{
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v14 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __100__HMDHome_accessoryBrowser_accessoryServer_didUpdateValuesForCharacteristics_stateNumber_broadcast___block_invoke;
  block[3] = &unk_2786899C8;
  block[4] = self;
  v19 = v12;
  v20 = v11;
  v21 = v13;
  v22 = a7;
  v15 = v13;
  v16 = v11;
  v17 = v12;
  dispatch_async(v14, block);
}

- (id)_changedHMDCharacteristicsForHAPCharacteristics:(id)a3 stateNumber:(id)a4 broadcast:(BOOL)a5 accessoryServer:(id)a6
{
  v7 = a5;
  v182 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v143 = a4;
  v137 = a6;
  v148 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v159 = 0u;
  v160 = 0u;
  v161 = 0u;
  v162 = 0u;
  obj = v10;
  v140 = self;
  v149 = [obj countByEnumeratingWithState:&v159 objects:v181 count:16];
  if (v149)
  {
    context = *v160;
    v141 = v7;
    do
    {
      for (i = 0; i != v149; ++i)
      {
        if (*v160 != context)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v159 + 1) + 8 * i);
        v13 = [v12 service];
        v14 = [v13 accessory];
        v15 = [(HMDHome *)self dataSource];
        v16 = [v15 hapMetadata];
        if (v7)
        {
          v17 = [v12 type];
          v18 = [v16 shouldFilterCharacteristicOfType:v17];

          if (v18)
          {
            goto LABEL_16;
          }

          v19 = [v137 primaryAccessory];

          v14 = v19;
        }

        else
        {
          v20 = [v13 type];
          v21 = [v16 shouldFilterServiceOfType:v20];

          if (v21)
          {
            goto LABEL_16;
          }
        }

        v22 = [(HMDHome *)self hmdHAPAccessoryWithHAPAccessory:v14];
        v23 = [v12 instanceID];
        v24 = [v22 hmdCharacteristicForInstanceId:v23];

        if (v24)
        {
          [v148 setObject:v24 forKey:v12];
        }

        else
        {
          v25 = objc_autoreleasePoolPush();
          v26 = self;
          v27 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
          {
            HMFGetLogIdentifier();
            v28 = v132 = v26;
            [v137 identifier];
            v29 = loga = v27;
            v30 = [v13 instanceID];
            [v12 instanceID];
            v31 = v135 = v25;
            v32 = [v12 type];
            *buf = 138544386;
            v165 = v28;
            v166 = 2112;
            v167 = v29;
            v168 = 2112;
            v169 = v30;
            v170 = 2112;
            v171 = v31;
            v172 = 2112;
            v173 = v32;
            _os_log_impl(&dword_229538000, loga, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot map HAPCharacteristic %@/%@/%@/%@ to a HMDCharacteristic", buf, 0x34u);

            v25 = v135;
            v27 = loga;

            v26 = v132;
          }

          objc_autoreleasePoolPop(v25);
          self = v140;
        }

        v7 = v141;
LABEL_16:
      }

      v149 = [obj countByEnumeratingWithState:&v159 objects:v181 count:16];
    }

    while (v149);
  }

  v136 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(obj, "count")}];
  v127 = [MEMORY[0x277CBEB58] set];
  v155 = 0u;
  v156 = 0u;
  v157 = 0u;
  v158 = 0u;
  v33 = [v148 keyEnumerator];
  v34 = [v33 allObjects];

  v133 = v34;
  v142 = [v34 countByEnumeratingWithState:&v155 objects:v180 count:16];
  v36 = 0;
  if (!v142)
  {
    v37 = v143;
    goto LABEL_71;
  }

  log = *v156;
  *&v35 = 138543618;
  v126 = v35;
  v37 = v143;
  do
  {
    v38 = 0;
    do
    {
      if (*v156 != log)
      {
        objc_enumerationMutation(v133);
      }

      v39 = *(*(&v155 + 1) + 8 * v38);
      v40 = [v148 objectForKey:{v39, v126}];
      v41 = [v40 stateNumber];
      v42 = HMFEqualObjects();

      if (v42)
      {
        v150 = v38;
        v43 = [v39 value];
        v44 = [v40 lastKnownValue];
        v45 = [HMDCharacteristic value:v43 differentThan:v44];

        if (v37 && v45)
        {
          contexta = objc_autoreleasePoolPush();
          v46 = self;
          v47 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
          {
            v129 = HMFGetLogIdentifier();
            v48 = [v40 type];
            v49 = [v40 instanceID];
            v50 = [v40 lastKnownValue];
            v51 = [v40 stateNumber];
            v52 = [v39 value];
            v53 = [v137 identifier];
            *buf = 138545154;
            v165 = v129;
            v166 = 2112;
            v167 = v48;
            v168 = 2112;
            v169 = v49;
            v54 = v49;
            v170 = 2112;
            v171 = v50;
            v172 = 2112;
            v173 = v51;
            v174 = 2112;
            v175 = v52;
            v176 = 2112;
            v177 = v143;
            v178 = 2112;
            v179 = v53;
            _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value at same state number from %@/%@ to %@/%@ for accessory: %@", buf, 0x52u);

            self = v140;
          }

          goto LABEL_32;
        }

        if ([v40 shouldUpdateValueFromHAPCharacteristic:v39] && (objc_msgSend(v39, "value"), v76 = objc_claimAutoreleasedReturnValue(), v76, v76))
        {
          v77 = objc_autoreleasePoolPush();
          v78 = self;
          v79 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v79, OS_LOG_TYPE_DEFAULT))
          {
            v80 = HMFGetLogIdentifier();
            v81 = [v40 type];
            [v40 instanceID];
            v82 = v130 = v78;
            [v40 lastKnownValue];
            v83 = contextb = v77;
            v84 = [v39 value];
            v85 = [v137 identifier];
            *buf = 138544898;
            v165 = v80;
            v166 = 2112;
            v167 = v81;
            v168 = 2112;
            v169 = v82;
            v170 = 2112;
            v171 = v83;
            v172 = 2112;
            v173 = v84;
            v174 = 2112;
            v175 = v143;
            v176 = 2112;
            v177 = v85;
            _os_log_impl(&dword_229538000, v79, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value from %@ to %@ at same state number %@ for accessory: %@", buf, 0x48u);

            v77 = contextb;
            v78 = v130;
          }

          objc_autoreleasePoolPop(v77);
          [v136 addObject:v40];
          v86 = [v40 accessory];
          if (([v86 supportsWoL] & 1) == 0 && !objc_msgSend(v86, "custom1WoBLE"))
          {
            goto LABEL_48;
          }

          v87 = objc_autoreleasePoolPush();
          v88 = v78;
          v89 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v89, OS_LOG_TYPE_INFO))
          {
            v90 = HMFGetLogIdentifier();
            v91 = [v137 identifier];
            *buf = 138544130;
            v165 = v90;
            v166 = 2112;
            v167 = v39;
            v168 = 2112;
            v169 = v40;
            v170 = 2112;
            v171 = v91;
            _os_log_impl(&dword_229538000, v89, OS_LOG_TYPE_INFO, "%{public}@Checking if we should update value hapCharacteristic %@ to hmdCharacteristic %@ for accessory: %@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v87);
          if (v45 || ([v40 lastKnownValueUpdateTime], v92 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v39, "valueUpdatedTime"), v93 = objc_claimAutoreleasedReturnValue(), v94 = objc_msgSend(v92, "compare:", v93), v93, v92, v94))
          {
LABEL_48:

            self = v140;
            goto LABEL_33;
          }

          v113 = objc_autoreleasePoolPush();
          v114 = v88;
          v115 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v115, OS_LOG_TYPE_INFO))
          {
            v116 = HMFGetLogIdentifier();
            v117 = [v137 identifier];
            *buf = v126;
            v165 = v116;
            v166 = 2112;
            v167 = v117;
            _os_log_impl(&dword_229538000, v115, OS_LOG_TYPE_INFO, "%{public}@Not updating value because update times and values are the same for accessory: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v113);
          v37 = v143;
          [v40 setStateNumber:v143];
          v36 = 1;
        }

        else
        {
          v95 = objc_autoreleasePoolPush();
          v96 = self;
          v97 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v97, OS_LOG_TYPE_DEBUG))
          {
            v128 = HMFGetLogIdentifier();
            v98 = [v40 type];
            v99 = [v40 instanceID];
            [v40 stateNumber];
            v100 = v131 = v36;
            [v40 lastKnownValue];
            v101 = contextc = v95;
            v102 = [v39 value];
            v103 = [v137 identifier];
            *buf = 138544898;
            v165 = v128;
            v166 = 2112;
            v167 = v98;
            v104 = v98;
            v168 = 2112;
            v169 = v99;
            v170 = 2112;
            v171 = v100;
            v172 = 2112;
            v173 = v101;
            v174 = 2112;
            v175 = v102;
            v176 = 2112;
            v177 = v103;
            _os_log_impl(&dword_229538000, v97, OS_LOG_TYPE_DEBUG, "%{public}@Ignoring the update for characteristic: '%@'/%@/%@ from %@ to %@ for accessory: %@", buf, 0x48u);

            v95 = contextc;
            v36 = v131;

            v37 = v143;
          }

          objc_autoreleasePoolPop(v95);
        }

        self = v140;
LABEL_53:
        v38 = v150;
        if (!v37)
        {
          goto LABEL_59;
        }

LABEL_54:
        if ((v36 & 1) != 0 && ([v40 shouldIgnoreCacheValueForRead] & 1) == 0)
        {
          v105 = [v40 accessory];
          if (v105)
          {
            [v127 addObject:v105];
          }
        }

        goto LABEL_59;
      }

      v55 = [v39 value];
      if (!v55 || (v56 = v55, v57 = [v40 shouldUpdateValueFromHAPCharacteristic:v39], v56, (v57 & 1) != 0))
      {
        contexta = objc_autoreleasePoolPush();
        v58 = self;
        v47 = HMFGetOSLogHandle();
        v150 = v38;
        if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
        {
          v59 = HMFGetLogIdentifier();
          v60 = [v40 type];
          v61 = [v40 instanceID];
          v62 = [v40 lastKnownValue];
          v63 = [v40 stateNumber];
          v64 = [v39 value];
          v65 = [v137 identifier];
          *buf = 138545154;
          v165 = v59;
          v166 = 2112;
          v167 = v60;
          v168 = 2112;
          v169 = v61;
          v170 = 2112;
          v171 = v62;
          v172 = 2112;
          v173 = v63;
          v174 = 2112;
          v175 = v64;
          v176 = 2112;
          v177 = v143;
          v178 = 2112;
          v179 = v65;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value / state number from %@/%@ to %@/%@ for accessory: %@", buf, 0x52u);

          self = v140;
        }

LABEL_32:

        objc_autoreleasePoolPop(contexta);
        [v136 addObject:v40];
LABEL_33:
        v37 = v143;
        [v40 setStateNumber:v143];
        v66 = [v39 notificationContext];

        if (v66)
        {
          v67 = objc_autoreleasePoolPush();
          v68 = self;
          v69 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
          {
            v70 = HMFGetLogIdentifier();
            v71 = [v39 value];
            v72 = [v39 notificationContext];
            *buf = 138543874;
            v165 = v70;
            v166 = 2112;
            v167 = v71;
            v168 = 2112;
            v169 = v72;
            _os_log_impl(&dword_229538000, v69, OS_LOG_TYPE_INFO, "%{public}@Updating HMD characteristic with value: %@ and notification context: %@", buf, 0x20u);

            self = v140;
          }

          objc_autoreleasePoolPop(v67);
        }

        v73 = [v39 value];
        v74 = [v39 valueUpdatedTime];
        v75 = [v39 notificationContext];
        [v40 updateValue:v73 updatedTime:v74 stateNumber:v143 notificationContext:v75];

        v36 = 1;
        goto LABEL_53;
      }

      v106 = objc_autoreleasePoolPush();
      v107 = self;
      v108 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v108, OS_LOG_TYPE_INFO))
      {
        v109 = HMFGetLogIdentifier();
        v110 = [v39 value];
        v111 = [v40 shortDescription];
        v112 = [v137 identifier];
        *buf = 138544130;
        v165 = v109;
        v166 = 2112;
        v167 = v110;
        v168 = 2112;
        v169 = v111;
        v170 = 2112;
        v171 = v112;
        _os_log_impl(&dword_229538000, v108, OS_LOG_TYPE_INFO, "%{public}@Ignoring same value %@ updates from local for characteristic: '%@' for accessory: %@", buf, 0x2Au);

        v37 = v143;
        self = v140;
      }

      objc_autoreleasePoolPop(v106);
      [v40 setStateNumber:v37];
      v36 = 1;
      if (v37)
      {
        goto LABEL_54;
      }

LABEL_59:

      ++v38;
    }

    while (v142 != v38);
    v118 = [v133 countByEnumeratingWithState:&v155 objects:v180 count:16];
    v142 = v118;
  }

  while (v118);
LABEL_71:

  v153 = 0u;
  v154 = 0u;
  v151 = 0u;
  v152 = 0u;
  v119 = v127;
  v120 = [v119 countByEnumeratingWithState:&v151 objects:v163 count:16];
  if (v120)
  {
    v121 = v120;
    v122 = *v152;
    do
    {
      for (j = 0; j != v121; ++j)
      {
        if (*v152 != v122)
        {
          objc_enumerationMutation(v119);
        }

        [*(*(&v151 + 1) + 8 * j) notifyingCharacteristicStateNumberUpdated:v37];
      }

      v121 = [v119 countByEnumeratingWithState:&v151 objects:v163 count:16];
    }

    while (v121);
  }

  if (v37 != 0 && (v36 & 1) != 0)
  {
    [(HMDHome *)self saveToCurrentAccountWithReason:*MEMORY[0x277CD21D0]];
  }

  v124 = *MEMORY[0x277D85DE8];

  return v136;
}

- (id)_hmdCharacteristicsForUpdatedHAPCharacteristics:(id)a3 accessoryServer:(id)a4
{
  v39 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v25 = a4;
  v28 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
  v24 = [(HMDHome *)self accessories];
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  obj = v6;
  v26 = [obj countByEnumeratingWithState:&v33 objects:v38 count:16];
  if (v26)
  {
    v23 = *v34;
    do
    {
      v7 = 0;
      do
      {
        if (*v34 != v23)
        {
          objc_enumerationMutation(obj);
        }

        v27 = v7;
        v8 = *(*(&v33 + 1) + 8 * v7);
        v9 = [v25 primaryAccessory];
        v29 = 0u;
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v10 = v24;
        v11 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
        if (v11)
        {
          v12 = v11;
          v13 = *v30;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v30 != v13)
              {
                objc_enumerationMutation(v10);
              }

              v15 = *(*(&v29 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v16 = v15;
              }

              else
              {
                v16 = 0;
              }

              v17 = v16;

              if ([v17 matchesHAPAccessory:v9])
              {
                v18 = [v8 instanceID];
                v19 = [v17 hmdCharacteristicForInstanceId:v18];

                if ([v19 shouldUpdateValueFromHAPCharacteristic:v8])
                {
                  [v28 addObject:v19];
                }
              }
            }

            v12 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
          }

          while (v12);
        }

        v7 = v27 + 1;
      }

      while (v27 + 1 != v26);
      v26 = [obj countByEnumeratingWithState:&v33 objects:v38 count:16];
    }

    while (v26);
  }

  v20 = *MEMORY[0x277D85DE8];

  return v28;
}

- (void)accessoryBrowser:(id)a3 didUpdateEndpoint:(id)a4
{
  v87 = *MEMORY[0x277D85DE8];
  v54 = a3;
  v6 = a4;
  v7 = MEMORY[0x277CBEB18];
  v58 = self;
  v8 = [(HMDHome *)self accessories];
  v9 = [v7 arrayWithCapacity:{objc_msgSend(v8, "count")}];

  v55 = v6;
  [v6 advertisements];
  v70 = 0u;
  v71 = 0u;
  v72 = 0u;
  obj = v73 = 0u;
  v59 = [obj countByEnumeratingWithState:&v70 objects:v86 count:16];
  if (v59)
  {
    v57 = *v71;
    do
    {
      v10 = 0;
      do
      {
        if (*v71 != v57)
        {
          objc_enumerationMutation(obj);
        }

        v60 = v10;
        v11 = [*(*(&v70 + 1) + 8 * v10) identifier];
        v66 = 0u;
        v67 = 0u;
        v68 = 0u;
        v69 = 0u;
        v12 = [(HMDHome *)v58 accessories];
        v13 = [v12 countByEnumeratingWithState:&v66 objects:v85 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v67;
          do
          {
            for (i = 0; i != v14; ++i)
            {
              if (*v67 != v15)
              {
                objc_enumerationMutation(v12);
              }

              v17 = *(*(&v66 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v18 = v17;
              }

              else
              {
                v18 = 0;
              }

              v19 = v18;

              v20 = [v19 identifier];
              v21 = [v20 isEqual:v11];

              if (v21)
              {
                [v9 addObject:v19];
              }
            }

            v14 = [v12 countByEnumeratingWithState:&v66 objects:v85 count:16];
          }

          while (v14);
        }

        v10 = v60 + 1;
      }

      while (v60 + 1 != v59);
      v59 = [obj countByEnumeratingWithState:&v70 objects:v86 count:16];
    }

    while (v59);
  }

  v22 = objc_autoreleasePoolPush();
  v23 = v58;
  v24 = HMFGetOSLogHandle();
  v25 = v55;
  if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
  {
    v26 = HMFGetLogIdentifier();
    v27 = [v55 sessionIdentifier];
    *buf = 138544130;
    v76 = v26;
    v77 = 2112;
    v78 = v27;
    v79 = 2112;
    v80 = obj;
    v81 = 2112;
    v82 = v9;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Endpoint %@ with advertisements %@ matches accessories %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v22);
  if ([v9 count])
  {
    v28 = [v55 sessionIdentifier];
    if (!v28)
    {
      v39 = objc_autoreleasePoolPush();
      v40 = v23;
      v41 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
      {
        v42 = HMFGetLogIdentifier();
        *buf = 138543618;
        v76 = v42;
        v77 = 2112;
        v78 = 0;
        _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Nil session identifier - dropping update for endpoint %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v39);
      goto LABEL_46;
    }

    v29 = [(HMDHome *)v23 mediaSessionWithIdentifier:v28];
    v61 = v28;
    if (v29)
    {
      v30 = v29;
      v31 = objc_autoreleasePoolPush();
      v32 = v23;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        v35 = [v30 uuid];
        v36 = [v35 UUIDString];
        v37 = [v9 count];
        *buf = 138544386;
        v76 = v34;
        v77 = 2112;
        v78 = v36;
        v79 = 2112;
        v80 = v28;
        v81 = 2112;
        v82 = obj;
        v83 = 2048;
        v84 = v37;
        v38 = "%{public}@Updated the endpoint for mediaSession %@ with sessionIdentifier %@ (%@ advertisements for %tu accessories) ";
LABEL_32:
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, v38, buf, 0x34u);
      }
    }

    else
    {
      v30 = [(HMDHome *)v23 _createMediaSessionWithEndpoint:v55];
      v31 = objc_autoreleasePoolPush();
      v43 = v23;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        v35 = [v30 uuid];
        v36 = [v35 UUIDString];
        v44 = [v9 count];
        *buf = 138544386;
        v76 = v34;
        v77 = 2112;
        v78 = v36;
        v79 = 2112;
        v80 = v28;
        v81 = 2112;
        v82 = obj;
        v83 = 2048;
        v84 = v44;
        v38 = "%{public}@Creating mediaSession %@ for sessionIdentifier %@ (%@ advertisements for %tu accessories) ";
        goto LABEL_32;
      }
    }

    objc_autoreleasePoolPop(v31);
    v64 = 0u;
    v65 = 0u;
    v62 = 0u;
    v63 = 0u;
    v45 = v9;
    v46 = [v45 countByEnumeratingWithState:&v62 objects:v74 count:16];
    if (v46)
    {
      v47 = v46;
      v48 = *v63;
      do
      {
        for (j = 0; j != v47; ++j)
        {
          if (*v63 != v48)
          {
            objc_enumerationMutation(v45);
          }

          v50 = *(*(&v62 + 1) + 8 * j);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v51 = v50;
          }

          else
          {
            v51 = 0;
          }

          v52 = v51;

          if (!v52)
          {
            [v50 setReachable:1];
          }

          [v50 updateMediaSession:v30];
        }

        v47 = [v45 countByEnumeratingWithState:&v62 objects:v74 count:16];
      }

      while (v47);
    }

    v25 = v55;
    v28 = v61;
LABEL_46:
  }

  v53 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didDiscoverAccessories:(id)a5 transaction:(id)a6 error:(id)a7
{
  v59 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v17 = [v13 identifier];
  v18 = [(HMDHome *)self hapAccessoryWithIdentifier:v17];

  v19 = [v13 identifier];
  v20 = [(HMDHome *)self matterAccessoryWithIdentifier:v19];

  v21 = [(HMDHome *)self featuresDataSource];
  if ([v21 isRVCEnabled])
  {
    v22 = [v20 convertingMatterAccessory];

    if (v22)
    {
      v23 = objc_autoreleasePoolPush();
      v24 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v46 = v14;
        v26 = v15;
        v28 = v27 = v12;
        *buf = 138543618;
        v54 = v28;
        v55 = 2112;
        v56 = v18;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Ignoring the Matter accessory while it's being converted to Hybrid/Native matter: %@", buf, 0x16u);

        v12 = v27;
        v15 = v26;
        v14 = v46;
      }

      objc_autoreleasePoolPop(v23);
      goto LABEL_25;
    }
  }

  else
  {
  }

  v29 = [v20 isNativeMatter];
  if (!v16 && v29)
  {
    [(HMDHome *)self _configurePairedAccessoriesForServer:v13 reAddServices:0];
  }

  if (v18)
  {
    v30 = objc_autoreleasePoolPush();
    v31 = self;
    v32 = HMFGetOSLogHandle();
    v33 = v32;
    if (v16)
    {
      v47 = v12;
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        v34 = HMFGetLogIdentifier();
        *buf = 138543874;
        v54 = v34;
        v55 = 2112;
        v56 = v13;
        v57 = 2114;
        v58 = v16;
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Failed HAP service discovery on accessory server %@ with error: %{public}@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v30);
      v35 = [v13 identifier];
      v36 = [v13 linkType];
      v49[0] = MEMORY[0x277D85DD0];
      v49[1] = 3221225472;
      v49[2] = __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke;
      v49[3] = &unk_278670760;
      v37 = v35;
      v51 = v31;
      v52 = v36;
      v50 = v37;
      [(HMDHome *)v31 _notifyRetrievalError:v16 accessoryServer:v37 linkType:v36 accessoryOperationBlock:v49];
      v38 = [v16 domain];
      if ([v38 isEqualToString:*MEMORY[0x277CCFD28]])
      {
        v39 = [v16 code];

        if (v39 == 66)
        {
          [v18 didEncounterError:v16];
          v12 = v47;
LABEL_24:

          goto LABEL_25;
        }
      }

      else
      {
      }

      v43 = v13;
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();

      v12 = v47;
      if (v43 && (isKindOfClass & 1) != 0)
      {
        [v18 _forceEnableReachabilityPingForPrimaryResident:v43];
      }

      goto LABEL_24;
    }

    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v48 = v14;
      v40 = v15;
      v42 = v41 = v12;
      *buf = 138543618;
      v54 = v42;
      v55 = 2112;
      v56 = v13;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Completed HAP service discovery on accessory server %@", buf, 0x16u);

      v12 = v41;
      v15 = v40;
      v14 = v48;
    }

    objc_autoreleasePoolPop(v30);
    [v18 setLastPairingFailureTime:0.0];
    [v18 setConsecutivePairingFailures:0];
    -[HMDHome _configurePairedAccessoriesForServer:reAddServices:](v31, "_configurePairedAccessoriesForServer:reAddServices:", v13, [v14 count] == 0);
  }

LABEL_25:

  v45 = *MEMORY[0x277D85DE8];
}

void __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke(uint64_t a1, void *a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v3 = a2;
  [v3 setReachability:0 serverIdentifier:*(a1 + 32) linkType:*(a1 + 48)];
  if ([v3 hasBTLELink] && *(a1 + 48) == 2)
  {
    v4 = [*(a1 + 40) accessoryBrowser];
    v9[0] = *(a1 + 32);
    v5 = [MEMORY[0x277CBEA60] arrayWithObjects:v9 count:1];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke_2;
    v7[3] = &unk_278670738;
    v8 = v3;
    [v4 probeReachabilityForBTLEAccessoryServersWithIdentifiers:v5 forceScan:1 withCompletion:v7];
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didStopPairingWithError:(id)a5
{
  v44 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v9 identifier];
  v12 = [(HMDHome *)self hapAccessoryWithIdentifier:v11];

  if (v12)
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v9 shortDescription];
      *buf = 138543874;
      v39 = v16;
      v40 = 2112;
      v41 = v17;
      v42 = 2112;
      v43 = v10;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ stopped pairing with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v18 = objc_autoreleasePoolPush();
    v19 = v14;
    v20 = HMFGetOSLogHandle();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_INFO);
    if (v10)
    {
      if (v21)
      {
        v22 = HMFGetLogIdentifier();
        v23 = [v9 shortDescription];
        *buf = 138543874;
        v39 = v22;
        v40 = 2112;
        v41 = v23;
        v42 = 2112;
        v43 = v10;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ failed to pair with error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v18);
      v24 = [v10 userInfo];
      v25 = [v24 objectForKeyedSubscript:*MEMORY[0x277CCA7E8]];

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v26 = v25;
      }

      else
      {
        v26 = 0;
      }

      v27 = v26;

      v28 = [v27 domain];
      v29 = *MEMORY[0x277CCA590];
      v30 = HMFEqualObjects();

      if (!v30 || [v27 code] != -6754)
      {
        [v12 setLastPairingFailureTime:CFAbsoluteTimeGetCurrent()];
        [v12 setConsecutivePairingFailures:{objc_msgSend(v12, "consecutivePairingFailures") + 1}];
      }

      v31 = [v9 identifier];
      v32 = [v9 linkType];
      v36[0] = MEMORY[0x277D85DD0];
      v36[1] = 3221225472;
      v36[2] = __68__HMDHome_accessoryBrowser_accessoryServer_didStopPairingWithError___block_invoke;
      v36[3] = &unk_27866FC38;
      v37 = v10;
      [(HMDHome *)v19 _notifyRetrievalError:v37 accessoryServer:v31 linkType:v32 accessoryOperationBlock:v36];
    }

    else
    {
      if (v21)
      {
        v33 = HMFGetLogIdentifier();
        v34 = [v9 shortDescription];
        *buf = 138543618;
        v39 = v33;
        v40 = 2112;
        v41 = v34;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ pairing completed successfully", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
      v27 = [(HMDHome *)v19 accessoryBrowser];
      [v27 discoverAccessories:v9];
    }
  }

  v35 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 discoveryFailedWithError:(id)a4 accessoryServer:(id)a5 linkType:(int64_t)a6
{
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self hapAccessoryWithIdentifier:v10];
  if (v11)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __78__HMDHome_accessoryBrowser_discoveryFailedWithError_accessoryServer_linkType___block_invoke;
    v12[3] = &unk_278670710;
    v14 = a6;
    v13 = v10;
    [(HMDHome *)self _notifyRetrievalError:v9 accessoryServer:v13 linkType:a6 accessoryOperationBlock:v12];
  }
}

void __78__HMDHome_accessoryBrowser_discoveryFailedWithError_accessoryServer_linkType___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (*(a1 + 40) != 2)
  {
    v6 = v3;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v4 = v6;
    }

    else
    {
      v4 = 0;
    }

    v5 = v4;
    [v5 setReachability:0 serverIdentifier:*(a1 + 32) linkType:*(a1 + 40)];

    v3 = v6;
  }
}

- (void)accessoryBrowser:(id)a3 didFinishWACForAccessoryWithIdentifier:(id)a4 error:(id)a5
{
  v10 = a4;
  v7 = a5;
  v8 = [(HMDHome *)self accessoryWithIdentifier:v10];
  if (v8)
  {
    v9 = [(HMDHome *)self homeReprovisionHandler];
    [v9 handleReprovionedAccessory:v8 identifier:v10 error:v7];
  }
}

- (void)accessoryBrowser:(id)a3 didFindAccessoryServerNeedingReprovisioning:(id)a4 error:(id)a5
{
  v24 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if ([v9 isPaired])
  {
    v11 = [v9 identifier];
    v12 = [(HMDHome *)self hapAccessoryWithIdentifier:v11];

    if (v12)
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        v17 = [v12 shortDescription];
        v20 = 138543618;
        v21 = v16;
        v22 = 2112;
        v23 = v17;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ needs reprovisioning is found", &v20, 0x16u);
      }

      objc_autoreleasePoolPop(v13);
      v18 = [(HMDHome *)v14 homeReprovisionHandler];
      [v18 handleFoundAccessoryNeedingReprovisioning:v12 error:v10];
    }
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didTombstoneAccessoryServer:(id)a4
{
  v22 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 identifier];
  v9 = [(HMDHome *)self hapAccessoryWithIdentifier:v8];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [v9 shortDescription];
      v16 = 138543874;
      v17 = v13;
      v18 = 2112;
      v19 = v7;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@AccessoryServer %@ tombstoned - unconfiguring all paired accessories for %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    [(HMDHome *)v11 _unconfigurePairedAccessoriesForServer:v7 updateReachability:1];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didRemoveAccessoryServer:(id)a4 error:(id)a5
{
  v35 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v9 identifier];
  v12 = [(HMDHome *)self accessoryWithIdentifier:v11];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v13 = v12;
  }

  else
  {
    v13 = 0;
  }

  v14 = v13;

  v15 = [v9 identifier];
  [v14 didRemoveAccessoryServer:v15];

  v16 = [v9 identifier];
  v17 = [(HMDHome *)self hapAccessoryWithIdentifier:v16];

  if (v17)
  {
    if ([v9 linkType] == 1)
    {
      [v17 _wol_processDidRemoveHPAccessoryServer:v9];
    }

    v18 = [v9 linkType];
    if (v10)
    {
      v19 = 0;
    }

    else
    {
      v19 = v18 == 2;
    }

    v20 = !v19;
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      v25 = @"not updating";
      v29 = 138543874;
      v30 = v24;
      v31 = 2112;
      if (v20)
      {
        v25 = @"updating";
      }

      v32 = v9;
      v33 = 2112;
      v34 = v25;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@AccessoryServer %@ removed - %@ reachability", &v29, 0x20u);
    }

    objc_autoreleasePoolPop(v21);
    [(HMDHome *)v22 _unconfigurePairedAccessoriesForServer:v9 updateReachability:v20];
    v26 = objc_alloc_init(HMDHAPMetricsLogEvent);
    [(HMDHAPMetricsLogEvent *)v26 updateWithHAPAccessoryServer:v9];
    v27 = [(HMDHome *)v22 logEventSubmitter];
    [v27 submitLogEvent:v26];
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didFindAccessoryServer:(id)a4 stateChanged:(BOOL)a5 stateNumber:(id)a6 completion:(id)a7
{
  v132 = a5;
  v148 = *MEMORY[0x277D85DE8];
  v11 = a3;
  v12 = a4;
  v13 = a6;
  v14 = a7;
  v15 = objc_autoreleasePoolPush();
  v16 = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    v19 = [v12 shortDescription];
    v20 = HMFBooleanToString();
    *buf = 138544130;
    v137 = v18;
    v138 = 2112;
    v139 = v19;
    v140 = 2112;
    v141 = v13;
    v142 = 2112;
    v143 = v20;
    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Found paired accessory server %@. State: %@/%@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v15);
  v21 = [v12 identifier];
  v22 = [(HMDHome *)v16 hapAccessoryWithIdentifier:v21];

  v23 = [(HMDHome *)v16 _shouldAvoidTombstoningAccessoryServer:v12 accessory:v22];
  v24 = [v12 identifier];
  v25 = [(HMDHome *)v16 accessoryWithIdentifier:v24];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v26 = v25;
  }

  else
  {
    v26 = 0;
  }

  v27 = v26;

  v28 = v27 != 0;
  if (v27)
  {
    [v27 didFindAccessoryServer:v12];
  }

  if (!v22)
  {
    goto LABEL_61;
  }

  v125 = v27 != 0;
  v129 = v27;
  v130 = v14;
  v131 = v13;
  v128 = v11;
  v29 = [(HMDHome *)v16 residentDeviceManager];
  v30 = [v29 isCurrentDeviceAvailableResident];

  v31 = objc_autoreleasePoolPush();
  v32 = v16;
  v33 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
  {
    v34 = HMFGetLogIdentifier();
    v35 = [v22 shortDescription];
    v36 = HMFBooleanToString();
    *buf = 138543874;
    v137 = v34;
    v138 = 2112;
    v139 = v35;
    v140 = 2112;
    v141 = v36;
    _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Performing accessory/service discovery on paired accessory %@. isResidentDevice: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v31);
  if ((![v22 canWakeUpViaWoL] || objc_msgSend(v22, "shouldDiscoverSuspendCapableAccessoryServer:", v12)) && !objc_msgSend(v12, "wakeNumber"))
  {
    context = v30;
    v50 = v12;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v51 = v50;
    }

    else
    {
      v51 = 0;
    }

    v123 = v51;

    v121 = v50;
    if ([v50 isReachable] && (objc_msgSend(v123, "isCached") & 1) == 0)
    {
      v52 = [MEMORY[0x277CBEB18] arrayWithObject:v22];
      v53 = [v22 identifiersForBridgedAccessories];
      v54 = [v53 allObjects];
      v55 = [(HMDHome *)v32 accessoriesWithUUIDs:v54];
      [v52 addObjectsFromArray:v55];

      v50 = v121;
      v134[0] = MEMORY[0x277D85DD0];
      v134[1] = 3221225472;
      v134[2] = __87__HMDHome_accessoryBrowser_didFindAccessoryServer_stateChanged_stateNumber_completion___block_invoke;
      v134[3] = &unk_27866FC38;
      v135 = v121;
      [v52 na_each:v134];
    }

    v56 = objc_autoreleasePoolPush();
    v57 = v32;
    v58 = HMFGetOSLogHandle();
    v124 = v57;
    if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
    {
      v59 = HMFGetLogIdentifier();
      v60 = [v22 shortDescription];
      [(HMDHome *)v57 isCurrentDevicePrimaryResident];
      v61 = HMFBooleanToString();
      [(HMDHome *)v57 isCurrentDeviceAvailableResident];
      HMFBooleanToString();
      v63 = v62 = v23;
      *buf = 138544130;
      v137 = v59;
      v138 = 2112;
      v139 = v60;
      v140 = 2114;
      v141 = v61;
      v142 = 2114;
      v143 = v63;
      _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_INFO, "%{public}@Evaluating disconnect on idle status for %@ using - isCurrentDevicePrimaryResident = %{public}@, isCurrentDeviceAvailableResident = %{public}@", buf, 0x2Au);

      v23 = v62;
      v50 = v121;
    }

    objc_autoreleasePoolPop(v56);
    v64 = shouldDisconnectOnIdleForAccessory(v22);
    if (v64 != [v22 shouldDisconnectOnIdle])
    {
      [v22 setShouldDisconnectOnIdle:v64];
    }

    [v50 setShouldDisconnectOnIdle:v64];
    v65 = [v50 identifier];
    v66 = [v22 supportedTransports];
    v67 = [v50 setupHash];
    [(HMDHome *)v57 _registerPairedAccessory:v65 transports:v66 setupHash:v67];

    DiscoveryBackoffPeriod = 0.0;
    v11 = v128;
    v27 = v129;
    if (context)
    {
LABEL_28:
      v14 = v130;
      v13 = v131;
LABEL_48:
      v28 = v125;
LABEL_49:
      if (!v27 && DiscoveryBackoffPeriod == 0.0)
      {
        v86 = [v22 shouldAutoDiscoverAccessoryServer];
        v126 = [v22 enhancedAuthMethod];
        v87 = -[HMDHome _isRetrievalInProgressForPrimaryAccessory:linkType:](v124, "_isRetrievalInProgressForPrimaryAccessory:linkType:", v22, [v121 linkType]);
        contexta = objc_autoreleasePoolPush();
        v88 = v124;
        v89 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v89, OS_LOG_TYPE_INFO))
        {
          v117 = HMFGetLogIdentifier();
          v116 = [v121 identifier];
          v90 = [v121 linkType];
          v115 = v88;
          if (v90 > 2)
          {
            v91 = @"Undefined";
          }

          else
          {
            v91 = off_2786768F0[v90];
          }

          v92 = v91;
          v93 = HMFBooleanToString();
          HMFBooleanToString();
          v94 = v122 = v86;
          v95 = HMFBooleanToString();
          *buf = 138544642;
          v137 = v117;
          v138 = 2112;
          v139 = v116;
          v140 = 2112;
          v141 = v92;
          v142 = 2112;
          v143 = v93;
          v144 = 2112;
          v145 = *&v94;
          v146 = 2112;
          v147 = v95;
          _os_log_impl(&dword_229538000, v89, OS_LOG_TYPE_INFO, "%{public}@Evaluating need to discover accessories from found accessory server %@/%@, autoDiscoveryEnabled =  %@, hasExplicitRetrieveRequest = %@ discoverForEAuth = %@", buf, 0x3Eu);

          v86 = v122;
          v11 = v128;
          v27 = v129;
          v88 = v115;
        }

        objc_autoreleasePoolPop(contexta);
        v28 = v86 | v87 | (v126 == 0);
        v14 = v130;
        v13 = v131;
      }

      if (DiscoveryBackoffPeriod > 0.0)
      {
        v127 = v28;
        v96 = objc_autoreleasePoolPush();
        v97 = v124;
        v98 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v98, OS_LOG_TYPE_INFO))
        {
          v99 = HMFGetLogIdentifier();
          v100 = [v22 shortDescription];
          HMFBooleanToString();
          v102 = v101 = v23;
          *buf = 138544386;
          v137 = v99;
          v138 = 2112;
          v139 = v100;
          v140 = 2112;
          v141 = v131;
          v142 = 2112;
          v143 = v102;
          v144 = 2048;
          v145 = DiscoveryBackoffPeriod;
          _os_log_impl(&dword_229538000, v98, OS_LOG_TYPE_INFO, "%{public}@Backing off discovery for accessory %@ with s# %@, state changed: %@ for %.2f sec", buf, 0x34u);

          v23 = v101;
        }

        objc_autoreleasePoolPop(v96);
        v13 = v131;
        [v22 backOffAccessoryForStateNumber:v131 backoffPeriod:DiscoveryBackoffPeriod];
        v27 = v129;
        v14 = v130;
        v28 = v127;
      }

LABEL_61:
      v14[2](v14, v23, v28 & 1);
      goto LABEL_62;
    }

    Current = CFAbsoluteTimeGetCurrent();
    [v22 lastPairingFailureTime];
    v71 = Current - v70;
    v72 = [v22 consecutivePairingFailures];
    if (v71 < getDiscoveryBackoffPeriod() || v72 >= 6)
    {
      if (v72 <= 5)
      {
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
      }

      else
      {
        DiscoveryBackoffPeriod = 1800.0;
      }

      v14 = v130;
      v13 = v131;
      [v22 setResetOnBackoffExpiry:v72 > 5];
      v78 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
      v79 = [v121 identifier];
      [(HMDHome *)v124 _notifyRetrievalError:v78 accessoryServer:v79 linkType:0 accessoryOperationBlock:0];

      goto LABEL_48;
    }

    v28 = v125;
    if (!v123)
    {
      v14 = v130;
      v13 = v131;
      goto LABEL_49;
    }

    v14 = v130;
    v13 = v131;
    if (!v132)
    {
      goto LABEL_49;
    }

    if ([v22 isRemotelyReachable])
    {
      v73 = objc_autoreleasePoolPush();
      v74 = v124;
      v75 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v75, OS_LOG_TYPE_INFO))
      {
        v76 = HMFGetLogIdentifier();
        v77 = [v22 shortDescription];
        *buf = 138543618;
        v137 = v76;
        v138 = 2112;
        v139 = v77;
        _os_log_impl(&dword_229538000, v75, OS_LOG_TYPE_INFO, "%{public}@Skipping discovery since accessory: %@ is remotely reachable.", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v73);
      goto LABEL_47;
    }

    if ([(HMDHome *)v124 _isRegisteredForNotificationsWithRemoteGateway:v22])
    {
      v80 = objc_autoreleasePoolPush();
      v81 = v124;
      v82 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
      {
LABEL_46:

        objc_autoreleasePoolPop(v80);
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
LABEL_47:
        v14 = v130;
        v13 = v131;
        v27 = v129;
        goto LABEL_48;
      }

      v83 = HMFGetLogIdentifier();
      v84 = [v22 shortDescription];
      *buf = 138543618;
      v137 = v83;
      v138 = 2112;
      v139 = v84;
      v85 = "%{public}@Backing off since notifications for %@ are registered with remote gateway";
    }

    else
    {
      if (![(HMDHome *)v124 _isEventTriggerOnRemoteGatewayForAccessory:v22]|| [(HMDHome *)v124 _isRegisteredForNotificationsForClients:v22]|| [(HMDHome *)v124 _isEventTriggerOnLocalDeviceForAccessory:v22])
      {
        v104 = [(HMDHome *)v124 _isEventTriggerOnRemoteGatewayForAccessory:v22];
        contextb = objc_autoreleasePoolPush();
        v105 = v124;
        v106 = HMFGetOSLogHandle();
        v107 = os_log_type_enabled(v106, OS_LOG_TYPE_INFO);
        if (!v104)
        {
          if (v107)
          {
            v110 = HMFGetLogIdentifier();
            v111 = [v22 shortDescription];
            v112 = [v123 stateNumber];
            [v123 stateChanged];
            HMFBooleanToString();
            v114 = v113 = v23;
            *buf = 138544130;
            v137 = v110;
            v138 = 2112;
            v139 = v111;
            v140 = 2112;
            v141 = v112;
            v142 = 2112;
            v143 = v114;
            _os_log_impl(&dword_229538000, v106, OS_LOG_TYPE_INFO, "%{public}@Discovering BLE Accessory: %@, State Number: %@, State Changed: %@", buf, 0x2Au);

            v23 = v113;
            v27 = v129;
          }

          objc_autoreleasePoolPop(contextb);
          v28 = 1;
          v14 = v130;
          v13 = v131;
          goto LABEL_61;
        }

        if (v107)
        {
          v108 = HMFGetLogIdentifier();
          v109 = [v22 shortDescription];
          *buf = 138543618;
          v137 = v108;
          v138 = 2112;
          v139 = v109;
          _os_log_impl(&dword_229538000, v106, OS_LOG_TYPE_INFO, "%{public}@Backing off since triggers are on resident and have clients interested for accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(contextb);
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
        goto LABEL_28;
      }

      v80 = objc_autoreleasePoolPush();
      v81 = v124;
      v82 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
      {
        goto LABEL_46;
      }

      v83 = HMFGetLogIdentifier();
      v84 = [v22 shortDescription];
      *buf = 138543618;
      v137 = v83;
      v138 = 2112;
      v139 = v84;
      v85 = "%{public}@Not discovering accessory (%@) as trigger is active on resident and no clients and no local triggers locally";
    }

    _os_log_impl(&dword_229538000, v82, OS_LOG_TYPE_INFO, v85, buf, 0x16u);

    goto LABEL_46;
  }

  v37 = objc_autoreleasePoolPush();
  v38 = v32;
  v39 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
  {
    v40 = HMFGetLogIdentifier();
    v41 = [v12 shortDescription];
    [v22 lpmProfile];
    v42 = v133 = v37;
    v43 = [v22 connectivityInfo];
    [v43 woWLANInfo];
    v44 = v12;
    v45 = v22;
    v47 = v46 = v23;
    *buf = 138544130;
    v137 = v40;
    v138 = 2112;
    v139 = v41;
    v140 = 2112;
    v141 = v42;
    v142 = 2112;
    v143 = v47;
    _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Not discovering the suspended accessory server: %@ with LPM Profile: %@ and WoWInfo: %@.", buf, 0x2Au);

    v23 = v46;
    v22 = v45;
    v12 = v44;

    v37 = v133;
  }

  objc_autoreleasePoolPop(v37);
  v48 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
  v49 = [v12 identifier];
  -[HMDHome _notifyRetrievalError:accessoryServer:linkType:accessoryOperationBlock:](v38, "_notifyRetrievalError:accessoryServer:linkType:accessoryOperationBlock:", v48, v49, [v12 linkType], 0);

  v14 = v130;
  v130[2](v130, v23, 0);

  v11 = v128;
  v27 = v129;
  v13 = v131;
LABEL_62:

  v103 = *MEMORY[0x277D85DE8];
}

void __87__HMDHome_accessoryBrowser_didFindAccessoryServer_stateChanged_stateNumber_completion___block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v6;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [*(a1 + 32) identifier];
  [v4 setReachability:1 serverIdentifier:v5 linkType:{objc_msgSend(*(a1 + 32), "linkType")}];
}

- (void)handleRemovedMediaSessions:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __38__HMDHome_handleRemovedMediaSessions___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __38__HMDHome_handleRemovedMediaSessions___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_arrayForKey:@"kRemovedMediaSessionIdentifiersKey"];

  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  v4 = v3;
  v5 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v11;
    do
    {
      v8 = 0;
      do
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(v4);
        }

        [*(a1 + 40) _removeMediaSessionWithIdentifier:{*(*(&v10 + 1) + 8 * v8++), v10}];
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didRemoveAccessoryAdvertisement:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 identifier];
  v9 = [(HMDHome *)self accessoryWithIdentifier:v8];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = v7;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Handling removed advertisement: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    [v9 removeAdvertisement:v7];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didAddAccessoryAdvertisement:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 identifier];
  v9 = [(HMDHome *)self accessoryWithIdentifier:v8];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = v7;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Handling added advertisement: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    [v9 addAdvertisement:v7];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceAvailableResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 isCurrentDeviceAvailableResident];

  return v3;
}

- (BOOL)_shouldAvoidTombstoningAccessoryServer:(id)a3 accessory:(id)a4
{
  v66 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = v7;
  v9 = 0;
  if (v6 && v7)
  {
    v10 = [(HMDHome *)self removeAccessoryInProgressForHMDAccessories];
    v11 = [v10 containsObject:v8];

    if (v11)
    {
      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v16 = [v6 name];
        v17 = [v6 identifier];
        *buf = 138543874;
        v57 = v15;
        v58 = 2112;
        v59 = v16;
        v60 = 2112;
        v61 = v17;
        v18 = "%{public}@Accessory %@/%@ being removed from home - not tombstoning";
LABEL_9:
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, v18, buf, 0x20u);

        goto LABEL_10;
      }

      goto LABEL_10;
    }

    v19 = [(HMDHome *)self addPendingAccessorySetupCodeHandlers];
    v20 = [v8 uuid];
    v21 = [v19 objectForKey:v20];

    if (v21)
    {
      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v16 = [v6 name];
        v17 = [v6 identifier];
        *buf = 138543874;
        v57 = v15;
        v58 = 2112;
        v59 = v16;
        v60 = 2112;
        v61 = v17;
        v18 = "%{public}@Accessory %@/%@ being added to home - not tombstoning";
        goto LABEL_9;
      }

LABEL_10:

      objc_autoreleasePoolPop(v12);
LABEL_11:
      v9 = 1;
      goto LABEL_12;
    }

    v24 = [(HMDHome *)self addPendingAccessories];
    v25 = [v24 hm_allKeys];
    v54[0] = MEMORY[0x277D85DD0];
    v54[1] = 3221225472;
    v54[2] = __60__HMDHome__shouldAvoidTombstoningAccessoryServer_accessory___block_invoke;
    v54[3] = &unk_27866FE40;
    v26 = v8;
    v55 = v26;
    v27 = [v25 na_any:v54];

    if (v27)
    {
      v28 = objc_autoreleasePoolPush();
      v29 = self;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
      {
        v31 = HMFGetLogIdentifier();
        v32 = [v6 name];
        v33 = [v6 identifier];
        *buf = 138543874;
        v57 = v31;
        v58 = 2112;
        v59 = v32;
        v60 = 2112;
        v61 = v33;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ being added to home (via setupDescription) - not tombstoning", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v28);
      goto LABEL_11;
    }

    v34 = [(HMDHome *)self currentAccessory];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v35 = v34;
    }

    else
    {
      v35 = 0;
    }

    v36 = v35;

    v37 = [v36 sensorManager];
    if (v37)
    {
      v38 = v37;
      v39 = [v26 identifier];
      v40 = [v36 sensorManager];
      v41 = [v40 derivedHAPAccessoryIdentifier];
      if ([v39 isEqualToString:v41])
      {

LABEL_24:
        v45 = objc_autoreleasePoolPush();
        v46 = self;
        v47 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
        {
          v48 = HMFGetLogIdentifier();
          v49 = [v6 name];
          v50 = [v6 identifier];
          *buf = 138544386;
          v57 = v48;
          v58 = 2112;
          v59 = v49;
          v60 = 2112;
          v61 = v50;
          v62 = 2112;
          v63 = v26;
          v64 = 2112;
          v65 = v36;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ (%@) is a derived homepod sensor for %@ - not tombstoning", buf, 0x34u);
        }

        objc_autoreleasePoolPop(v45);
        v9 = 1;
        goto LABEL_28;
      }

      v42 = [v26 uuid];
      [v36 sensorManager];
      v43 = v51 = v39;
      [v43 derivedSensorUUID];
      v44 = v53 = v36;
      v52 = [v42 hmf_isEqualToUUID:v44];

      v36 = v53;
      if (v52)
      {
        goto LABEL_24;
      }
    }

    v9 = -[HMDHome _isRetrievalInProgressForPrimaryAccessory:linkType:](self, "_isRetrievalInProgressForPrimaryAccessory:linkType:", v26, [v6 linkType]);
LABEL_28:
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
  return v9;
}

uint64_t __60__HMDHome__shouldAvoidTombstoningAccessoryServer_accessory___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 accessoryUUID];
  v4 = [*(a1 + 32) uuid];
  v5 = [v3 isEqual:v4];

  return v5;
}

- (BOOL)_isEventTriggerOnLocalDeviceForAccessory:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [(HMDHome *)self triggers];
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 isEventTriggerOnLocalDeviceForAccessory:v4];
        if (v12)
        {
          LOBYTE(v6) = 1;
          goto LABEL_14;
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_14:

  v13 = *MEMORY[0x277D85DE8];
  return v6;
}

- (BOOL)_isEventTriggerOnRemoteGatewayForAccessory:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [(HMDHome *)self triggers];
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 isEventTriggerOnRemoteGatewayForAccessory:v4];
        if (v12)
        {
          LOBYTE(v6) = 1;
          goto LABEL_14;
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_14:

  v13 = *MEMORY[0x277D85DE8];
  return v6;
}

- (BOOL)_isRegisteredForNotificationsForClients:(id)a3
{
  v3 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 isClientRegisteredForNotifications];

  return v6;
}

- (BOOL)_isRegisteredForNotificationsWithRemoteGateway:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  v29 = 0u;
  v6 = [v5 services];
  v7 = [v6 copy];

  v8 = [v7 countByEnumeratingWithState:&v26 objects:v31 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v27;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v27 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v26 + 1) + 8 * i);
        v22 = 0u;
        v23 = 0u;
        v24 = 0u;
        v25 = 0u;
        v13 = [v12 characteristics];
        v14 = [v13 copy];

        v15 = [v14 countByEnumeratingWithState:&v22 objects:v30 count:16];
        if (v15)
        {
          v16 = v15;
          v17 = *v23;
          while (2)
          {
            for (j = 0; j != v16; ++j)
            {
              if (*v23 != v17)
              {
                objc_enumerationMutation(v14);
              }

              if ([*(*(&v22 + 1) + 8 * j) notificationRegisteredWithRemoteGateway])
              {

                v19 = 1;
                goto LABEL_22;
              }
            }

            v16 = [v14 countByEnumeratingWithState:&v22 objects:v30 count:16];
            if (v16)
            {
              continue;
            }

            break;
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v26 objects:v31 count:16];
      v19 = 0;
    }

    while (v9);
  }

  else
  {
    v19 = 0;
  }

LABEL_22:

  v20 = *MEMORY[0x277D85DE8];
  return v19;
}

- (void)retrieveHAPAccessoryForHMDAccessory:(id)a3 linkType:(int64_t)a4 forceRetrieve:(BOOL)a5 queue:(id)a6 completion:(id)a7
{
  v12 = a3;
  v13 = a6;
  v14 = a7;
  v15 = [(HMDHome *)self workQueue];
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke;
  v19[3] = &unk_278675DA0;
  v19[4] = self;
  v20 = v12;
  v22 = v14;
  v23 = a4;
  v24 = a5;
  v21 = v13;
  v16 = v13;
  v17 = v14;
  v18 = v12;
  dispatch_async(v15, v19);
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v3 = *(a1 + 72);
  v4 = *(a1 + 64);
  if (*(a1 + 56))
  {
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_2;
    v7[3] = &unk_278689A68;
    v8 = *(a1 + 48);
    v9 = *(a1 + 56);
    [v1 _retrieveHAPAccessoryForHMDHAPAccessory:v2 linkType:v4 forceRetrieve:v3 completion:v7];
  }

  else
  {
    v6 = *(a1 + 32);

    [v6 _retrieveHAPAccessoryForHMDHAPAccessory:v2 linkType:v4 forceRetrieve:v3 completion:0];
  }
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  if (v4)
  {
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_3;
    v7[3] = &unk_27868A7A0;
    v9 = *(a1 + 40);
    v8 = v3;
    dispatch_async(v4, v7);
  }

  else
  {
    v5 = _Block_copy(*(a1 + 40));
    v6 = v5;
    if (v5)
    {
      (*(v5 + 2))(v5, v3);
    }
  }
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_3(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  if (v2)
  {
    v3 = v2;
    (*(v2 + 2))(v2, *(a1 + 32));
    v2 = v3;
  }
}

- (HMFMessageDestination)messageDestination
{
  v3 = objc_alloc(MEMORY[0x277D0F820]);
  v4 = [(HMDHome *)self messageTargetUUID];
  v5 = [v3 initWithTarget:v4];

  return v5;
}

- (void)_removeCorruptAccessories
{
  v2 = self;
  v43 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self accessories];
  v26 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v3, "count")}];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v4 = v3;
  v29 = [v4 countByEnumeratingWithState:&v30 objects:v42 count:16];
  if (v29)
  {
    v6 = *v31;
    *&v5 = 138544130;
    v23 = v5;
    v24 = v4;
    v25 = v2;
    do
    {
      v7 = 0;
      do
      {
        if (*v31 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v30 + 1) + 8 * v7);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        v11 = [v8 identifier];
        if (v11)
        {
          v12 = v11;
          if (!v10)
          {

LABEL_16:
            [v26 addObject:{v8, v23}];
            goto LABEL_17;
          }

          v13 = [v10 uniqueIdentifier];

          if (v13)
          {
            goto LABEL_16;
          }
        }

        v14 = objc_autoreleasePoolPush();
        v15 = v2;
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
        {
          v27 = HMFGetLogIdentifier();
          v17 = [v8 uuid];
          v18 = [v17 UUIDString];
          v19 = [v8 identifier];
          [v10 uniqueIdentifier];
          v28 = v14;
          v21 = v20 = v6;
          *buf = v23;
          v35 = v27;
          v36 = 2112;
          v37 = v18;
          v38 = 2112;
          v39 = v19;
          v40 = 2112;
          v41 = v21;
          _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_DEBUG, "%{public}@Incomplete accessory: %@ (%@ / %@)", buf, 0x2Au);

          v6 = v20;
          v14 = v28;

          v4 = v24;
          v2 = v25;
        }

        objc_autoreleasePoolPop(v14);
LABEL_17:

        ++v7;
      }

      while (v29 != v7);
      v29 = [v4 countByEnumeratingWithState:&v30 objects:v42 count:16];
    }

    while (v29);
  }

  [(HMDHome *)v2 setAccessories:v26];
  v22 = *MEMORY[0x277D85DE8];
}

- (void)_encodeActionSets:(id)a3 coder:(id)a4
{
  v12 = a3;
  v6 = a4;
  if ([(HMDHome *)self shouldWeSendAutomationsToClients])
  {
    v7 = [MEMORY[0x277CBEB18] arrayWithArray:v12];
    v8 = [MEMORY[0x277CCAC30] predicateWithFormat:@"type == %@", *MEMORY[0x277CCF1A8]];
    v9 = [v7 filteredArrayUsingPredicate:v8];
    if ([v9 count])
    {
      v10 = [v9 copy];
      [v6 encodeObject:v10 forKey:@"actionSets"];
    }

    if (([v6 hmd_isForRemoteGatewayCoder] & 1) == 0)
    {
      v11 = [v7 arrayByExcludingObjectsInArray:v9];
      [v6 encodeObject:v11 forKey:@"builtinActionSets"];
    }
  }
}

- (void)encodeMediaSystemsWithCoder:(id)a3 modifiedOptions:(unint64_t)a4
{
  v4 = a4;
  v6 = a3;
  if ((v4 & 0xC0) != 0)
  {
    v11 = v6;
    v7 = [v6 hmd_isForXPCTransport];
    v8 = [(HMDHome *)self mediaSystemController];
    v9 = v8;
    if (v7)
    {
      v10 = [v8 filteredMediaSystems];
      [v11 encodeObject:v10 forKey:*MEMORY[0x277CD2480]];
    }

    else
    {
      [v11 encodeObject:v8 forKey:*MEMORY[0x277CD2448]];
    }

    v6 = v11;
  }
}

- (void)_encodeObjectsWithAccessoriesWithCoder:(id)a3
{
  v87 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 hmd_isForXPCTransport];
  v6 = [v4 hmd_isForLocalStore];
  v7 = [v4 hmd_isForRemoteTransport];
  v8 = [v4 hmd_isForRemoteTransportOnSameAccount];
  v9 = [v4 hmd_isForRemoteGatewayCoder];
  v10 = [v4 hmd_isForXPCTransportEntitledForSPIAccess];
  v11 = [v4 hmd_homeManagerOptions];
  v12 = v11;
  if (v11)
  {
    v13 = v11 | 0x9FD0;
    if (!v10)
    {
      v13 = v11;
    }

    if (v8)
    {
      v14 = v11;
    }

    else
    {
      v14 = -1;
    }

    if (!v7)
    {
      v14 = v11;
    }

    if (v5)
    {
      v15 = v13;
    }

    else
    {
      v15 = v14;
    }

    [(HMDHome *)self __encodeAccessoriesWithCoder:v4 options:v15];
    [(HMDHome *)self encodeMediaSystemsWithCoder:v4 modifiedOptions:v15];
    if (([v4 hmd_isForRemoteGatewayCoder] & 1) == 0)
    {
      v16 = [(HMDHome *)self serviceGroups];
      [v4 encodeObject:v16 forKey:*MEMORY[0x277CD25E8]];
    }

    v17 = [(HMDHome *)self actionSets];
    [(HMDHome *)self _encodeActionSets:v17 coder:v4];

    if ((((v5 | v6) & 1) != 0 || ((v7 ^ 1 | v8) & 1) == 0 || ((v8 ^ 1 | v9) & 1) == 0) && [(HMDHome *)self shouldWeSendAutomationsToClients])
    {
      v18 = [(HMDHome *)self triggerOwnedActionSets];
      [v4 encodeObject:v18 forKey:@"HM.triggerOwnedActionSets"];
    }

    isWatch();
    if (v5 && v10 & 1 | !isAppleTV())
    {
      v69 = v10;
      v19 = MEMORY[0x277CBEB18];
      v20 = [(HMDHome *)self triggers];
      v21 = [v19 arrayWithCapacity:{objc_msgSend(v20, "count")}];

      v80 = 0u;
      v81 = 0u;
      v78 = 0u;
      v79 = 0u;
      v67 = self;
      v22 = [(HMDHome *)self triggers];
      v23 = [v22 countByEnumeratingWithState:&v78 objects:v86 count:16];
      if (v23)
      {
        v24 = v23;
        v25 = *v79;
        p_superclass = HMDIDSActivityRegistrationModel.superclass;
        p_cache = &OBJC_METACLASS___HMDAccessoryFirmwareUpdateManagerWingman.cache;
        v68 = *v79;
        do
        {
          for (i = 0; i != v24; ++i)
          {
            if (*v79 != v25)
            {
              objc_enumerationMutation(v22);
            }

            v29 = *(*(&v78 + 1) + 8 * i);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v30 = v29;
            }

            else
            {
              v30 = 0;
            }

            v31 = v30;

            if (v31)
            {
              [v21 addObject:v29];
            }

            else
            {
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v32 = p_superclass;
                v33 = v22;
                v34 = v4;
                v35 = p_cache;
                v36 = v29;
                v37 = [v36 significantEvent];

                if ((v37 == 0) | v69 & 1)
                {
                  [v21 addObject:v36];
                }

                p_cache = v35;
                v4 = v34;
                v22 = v33;
                p_superclass = v32;
                v25 = v68;
              }
            }
          }

          v24 = [v22 countByEnumeratingWithState:&v78 objects:v86 count:16];
        }

        while (v24);
      }

      if ([(HMDHome *)v67 shouldWeSendAutomationsToClients])
      {
        v38 = [v21 copy];
        [v4 encodeObject:v38 forKey:@"triggers"];
      }
    }

    else if (([v4 hmd_isForLocalStore] & 1) != 0 || objc_msgSend(v4, "hmd_isForRemoteTransport") && (objc_msgSend(v4, "hmd_isForRemoteTransportOnSameAccount") & 1) == 0 && (objc_msgSend(v4, "hmd_isForRemoteUserAdministrator") & 1) != 0 || objc_msgSend(v4, "hmd_isForRemoteTransportOnSameAccount") && (objc_msgSend(v4, "hmd_isForRemoteGatewayCoder") & 1) == 0)
    {
      v39 = [MEMORY[0x277CBEB18] array];
      v40 = [MEMORY[0x277CBEB18] array];
      v41 = [MEMORY[0x277CBEB18] array];
      v74 = 0u;
      v75 = 0u;
      v76 = 0u;
      v77 = 0u;
      v42 = [(HMDHome *)self triggers];
      v43 = [v42 countByEnumeratingWithState:&v74 objects:v85 count:16];
      if (v43)
      {
        v44 = v43;
        v45 = *v75;
        do
        {
          for (j = 0; j != v44; ++j)
          {
            if (*v75 != v45)
            {
              objc_enumerationMutation(v42);
            }

            [v39 addObject:*(*(&v74 + 1) + 8 * j)];
          }

          v44 = [v42 countByEnumeratingWithState:&v74 objects:v85 count:16];
        }

        while (v44);
      }

      v47 = [v40 copy];
      [v4 encodeObject:v47 forKey:@"HM.triggers"];

      v48 = [v41 copy];
      [v4 encodeObject:v48 forKey:@"HM.sharedActivationTriggers"];

      if ([v4 hmd_isForLocalStore])
      {
        v49 = [v39 copy];
        [v4 encodeObject:v49 forKey:@"triggers"];

        v50 = [(HMDHome *)self _updateAndGetOwnedTriggers];
        [v4 encodeObject:v50 forKey:@"HM.deviceOwnedTriggers"];
      }
    }

    else if ([v4 hmd_isForNonAdminSharedUser])
    {
      v52 = objc_autoreleasePoolPush();
      v53 = self;
      v54 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v54, OS_LOG_TYPE_INFO))
      {
        v55 = HMFGetLogIdentifier();
        *buf = 138543362;
        v84 = v55;
        _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_INFO, "%{public}@Syncing triggers to remote transport", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v52);
      v56 = [MEMORY[0x277CBEB18] array];
      v70 = 0u;
      v71 = 0u;
      v72 = 0u;
      v73 = 0u;
      v57 = [(HMDHome *)v53 triggers];
      v58 = [v57 countByEnumeratingWithState:&v70 objects:v82 count:16];
      if (v58)
      {
        v59 = v58;
        v60 = *v71;
        do
        {
          for (k = 0; k != v59; ++k)
          {
            if (*v71 != v60)
            {
              objc_enumerationMutation(v57);
            }

            v62 = *(*(&v70 + 1) + 8 * k);
            v63 = [v4 hmd_supportedFeatures];
            v64 = [v4 hmd_user];
            v65 = [v62 compatible:v63 user:v64];

            if (v65)
            {
              [v56 addObject:v62];
            }
          }

          v59 = [v57 countByEnumeratingWithState:&v70 objects:v82 count:16];
        }

        while (v59);
      }

      v66 = [v56 copy];
      [v4 encodeObject:v66 forKey:@"HM.triggers"];
    }
  }

  else
  {
    [(HMDHome *)self __encodeAccessoriesWithCoder:v4 options:v11];
    [(HMDHome *)self encodeMediaSystemsWithCoder:v4 modifiedOptions:v12];
  }

  v51 = *MEMORY[0x277D85DE8];
}

- (void)__encodeAccessoriesWithCoder:(id)a3 options:(unint64_t)a4
{
  v4 = a4;
  v91 = *MEMORY[0x277D85DE8];
  v64 = a3;
  v5 = [(HMDHome *)self accessories];
  v6 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v5, "count")}];
  v7 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v5, "count")}];
  v76 = 0u;
  v77 = 0u;
  v78 = 0u;
  v79 = 0u;
  v8 = v5;
  v9 = [v8 countByEnumeratingWithState:&v76 objects:v90 count:16];
  v65 = v6;
  v66 = v7;
  v67 = v8;
  if (v9)
  {
    v10 = v9;
    v11 = *v77;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v77 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v76 + 1) + 8 * i);
        v14 = [v13 isCurrentAccessory];
        if ((v4 & 0x10) != 0 && v14)
        {
          [v7 addObject:v13];
          continue;
        }

        v15 = v13;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v16 = v15;
        }

        else
        {
          v16 = 0;
        }

        v17 = v16;

        if (v17)
        {
          if ((v4 & 0x100) != 0)
          {
            [v6 addObject:v17];
          }

          goto LABEL_51;
        }

        v18 = v15;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (v20)
        {
          if ((v4 & 0x40) != 0 || (v4 & 0x800) != 0 && ([v20 device], v21 = objc_claimAutoreleasedReturnValue(), v21, v21))
          {
            [v7 addObject:v20];
          }

          goto LABEL_50;
        }

        v22 = v18;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v23 = v22;
        }

        else
        {
          v23 = 0;
        }

        v24 = v23;

        if (!v24)
        {
LABEL_41:
          v31 = v22;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v32 = v31;
          }

          else
          {
            v32 = 0;
          }

          v33 = v32;

          if (v33)
          {
            [v66 addObject:v33];
          }

          goto LABEL_49;
        }

        v25 = [v24 hostAccessory];
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & 1) == 0 || !v25)
        {
          if ([v24 hasTelevisionService])
          {
            if ((v4 & 0x400) == 0)
            {
              goto LABEL_49;
            }

LABEL_47:
            v30 = v66;
          }

          else
          {
            v27 = [v24 networkRouterController];

            if (v27)
            {
              if ((v4 & 0x1000) == 0)
              {
                goto LABEL_49;
              }

              goto LABEL_47;
            }

            if ((v4 & 0x200) != 0)
            {
              goto LABEL_47;
            }

            v28 = [v24 hasSmartSpeakerService];
            if ((v4 & 0x100) == 0 || !v28)
            {
              v29 = [v24 siriEndpointProfile];

              if ((v4 & 0x8000) == 0 || !v29)
              {
                goto LABEL_41;
              }
            }

            v30 = v66;
          }

          [v30 addObject:v22];
        }

LABEL_49:

        v6 = v65;
        v7 = v66;
LABEL_50:

        v8 = v67;
LABEL_51:
      }

      v10 = [v8 countByEnumeratingWithState:&v76 objects:v90 count:16];
    }

    while (v10);
  }

  v34 = objc_autoreleasePoolPush();
  v35 = self;
  v36 = HMFGetOSLogHandle();
  v37 = v64;
  if (os_log_type_enabled(v36, OS_LOG_TYPE_DEBUG))
  {
    v38 = HMFGetLogIdentifier();
    v39 = [v64 hmd_clientIdentifier];
    v40 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v66, "count")}];
    v41 = [v66 shortDescription];
    *buf = 138544130;
    v83 = v38;
    v84 = 2112;
    v85 = v39;
    v86 = 2112;
    v87 = v40;
    v88 = 2112;
    v89 = v41;
    _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_DEBUG, "%{public}@encoded Accessories [%@]: %@, %@", buf, 0x2Au);

    v6 = v65;
    v7 = v66;

    v8 = v67;
  }

  objc_autoreleasePoolPop(v34);
  v42 = [v7 copy];
  [v64 encodeObject:v42 forKey:@"accessories"];

  v43 = [v6 copy];
  [v64 encodeObject:v43 forKey:@"accessories.airplay"];

  if ((v4 & 5) == 0)
  {
    v44 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v8, "count")}];
    v72 = 0u;
    v73 = 0u;
    v74 = 0u;
    v75 = 0u;
    v45 = v7;
    v46 = [v45 countByEnumeratingWithState:&v72 objects:v81 count:16];
    if (v46)
    {
      v47 = v46;
      v48 = *v73;
      do
      {
        for (j = 0; j != v47; ++j)
        {
          if (*v73 != v48)
          {
            objc_enumerationMutation(v45);
          }

          v50 = *(*(&v72 + 1) + 8 * j);
          v51 = [v50 room];

          if (v51)
          {
            v52 = [v50 room];
            [v44 addObject:v52];
          }
        }

        v47 = [v45 countByEnumeratingWithState:&v72 objects:v81 count:16];
      }

      while (v47);
    }

    v70 = 0u;
    v71 = 0u;
    v68 = 0u;
    v69 = 0u;
    v53 = v6;
    v54 = [v53 countByEnumeratingWithState:&v68 objects:v80 count:16];
    if (v54)
    {
      v55 = v54;
      v56 = *v69;
      do
      {
        for (k = 0; k != v55; ++k)
        {
          if (*v69 != v56)
          {
            objc_enumerationMutation(v53);
          }

          v58 = *(*(&v68 + 1) + 8 * k);
          v59 = [v58 room];

          if (v59)
          {
            v60 = [v58 room];
            [v44 addObject:v60];
          }
        }

        v55 = [v53 countByEnumeratingWithState:&v68 objects:v80 count:16];
      }

      while (v55);
    }

    v61 = [v44 allObjects];
    v37 = v64;
    [v64 encodeObject:v61 forKey:@"rooms"];

    v7 = v66;
  }

  v62 = *MEMORY[0x277D85DE8];
}

- (void)_encodeWithCoder:(id)a3
{
  v306 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 hmd_isForXPCTransport];
  v6 = [v4 hmd_isForLocalStore];
  v241 = [v4 hmd_isForXPCTransportEntitledForSPIAccess];
  v240 = [v4 hmd_isForRemoteTransportOnSameAccount];
  v242 = [v4 hmd_homeManagerOptions];
  v243 = v6;
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
    {
      v10 = HMFGetLogIdentifier();
      [(HMDHome *)v8 isOwnerUser];
      v11 = HMFBooleanToString();
      *buf = 138543618;
      v291 = v10;
      v292 = 2112;
      v293 = v11;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Encoding isOwnerUser : %@ for HH2 migration", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    [v4 encodeBool:-[HMDHome isOwnerUser](v8 forKey:{"isOwnerUser"), @"HM.Owner.HH2.MI"}];
  }

  v12 = [(HMDHome *)self uuid];
  v13 = [v12 UUIDString];
  [v4 encodeObject:v13 forKey:@"homeUUID"];

  v14 = [(HMDHome *)self ownerName];
  [v4 encodeObject:v14 forKey:@"homeAdmin"];

  v15 = [(HMDHome *)self owner];
  v16 = [v15 uuid];
  v17 = [v16 UUIDString];
  [v4 encodeObject:v17 forKey:@"kHomeOwnerUUID"];

  v18 = [(HMDHome *)self creationDate];
  [v4 encodeObject:v18 forKey:@"creationDate"];

  v19 = [(HMDHome *)self firstHAPAccessoryAddedDate];
  [v4 encodeObject:v19 forKey:@"firstHAPAccessoryAddedDate"];

  v20 = [(HMDHome *)self configurationVersion];
  v21 = [MEMORY[0x277CCABB0] numberWithInteger:v20];
  [v4 encodeObject:v21 forKey:@"homeConfigVersion"];

  v22 = [(HMDHome *)self name];
  [v4 encodeObject:v22 forKey:@"homeName"];

  v23 = [(HMDHome *)self homeHubState];
  [v4 encodeInteger:v23 forKey:*MEMORY[0x277CCFFE8]];
  v24 = [(HMDHome *)self isMultiUserEnabled];
  [v4 encodeBool:v24 forKey:*MEMORY[0x277CD0450]];
  if (isFeatureHomeTheaterQFAEnabledForTests)
  {
    v25 = [isFeatureHomeTheaterQFAEnabledForTests BOOLValue];
  }

  else
  {
    v25 = 1;
  }

  [v4 encodeBool:v25 forKey:*MEMORY[0x277CD0618]];
  v26 = [(HMDHome *)self soundCheckEnabled];
  [v4 encodeBool:v26 forKey:*MEMORY[0x277CD05F0]];
  v27 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome audioAnalysisClassifierOptions](self, "audioAnalysisClassifierOptions")}];
  [v4 encodeObject:v27 forKey:*MEMORY[0x277CCFE50]];

  v28 = [(HMDHome *)self didOnboardAudioAnalysis];
  [v4 encodeBool:v28 forKey:*MEMORY[0x277CCFE70]];
  v29 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome siriPhraseOptions](self, "siriPhraseOptions")}];
  [v4 encodeObject:v29 forKey:*MEMORY[0x277CD05E0]];

  v30 = [(HMDHome *)self locationServicesEnabled];
  [v4 encodeBool:v30 forKey:*MEMORY[0x277CD0050]];
  v31 = [(HMDHome *)self didOnboardLocationServices];
  [v4 encodeBool:v31 forKey:*MEMORY[0x277CCFEB0]];
  v32 = [(HMDHome *)self hasAnyUserAcknowledgedCameraRecordingOnboarding];
  [v4 encodeBool:v32 forKey:*MEMORY[0x277CCFFD0]];
  v33 = [(HMDHome *)self hasOnboardedForAccessCode];
  [v4 encodeBool:v33 forKey:*MEMORY[0x277CCFFD8]];
  v34 = [(HMDHome *)self hasOnboardedForWalletKey];
  [v4 encodeBool:v34 forKey:*MEMORY[0x277CCFFE0]];
  v35 = [(HMDHome *)self dismissedWalletKeyUWBUnlockOnboarding];
  [v4 encodeBool:v35 forKey:*MEMORY[0x277CCFEC8]];
  if (v5)
  {
    v36 = [(HMDHome *)self isAllowedToEnableAdaptiveTemperatureAutomations];
    [v4 encodeBool:v36 forKey:*MEMORY[0x277CCFE38]];
  }

  v37 = [v4 hmd_supportedFeatures];
  v38 = [v37 containsObject:&unk_283E71B28];

  v39 = objc_autoreleasePoolPush();
  v40 = self;
  v41 = HMFGetOSLogHandle();
  v42 = os_log_type_enabled(v41, OS_LOG_TYPE_INFO);
  if (v38)
  {
    if (v42)
    {
      v43 = HMFGetLogIdentifier();
      *buf = 138543362;
      v291 = v43;
      _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Forcing isUpdatedToHH2 to YES", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v39);
    v44 = 1;
  }

  else
  {
    if (v42)
    {
      v45 = HMFGetLogIdentifier();
      [(HMDHome *)v40 isUpdatedToHH2];
      v46 = HMFBooleanToString();
      *buf = 138543618;
      v291 = v45;
      v292 = 2112;
      v293 = v46;
      _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@isUpdatedToHH2 is set to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v39);
    v44 = [(HMDHome *)v40 isUpdatedToHH2];
  }

  [v4 encodeBool:v44 forKey:*MEMORY[0x277CD0698]];
  v47 = v242;
  if ([v4 hmd_isForXPCTransportEntitledForSPIAccess])
  {
    v48 = [(HMDHome *)v40 bulletinNotificationsSupported];
    [v4 encodeBool:v48 forKey:*MEMORY[0x277CCFE90]];
  }

  if (([v4 hmd_isForRemoteGatewayCoder] & 1) == 0)
  {
    if ((v5 & v241) != 1)
    {
      v55 = [(HMDHome *)v40 homeLocationHandler];
      v56 = &kHomeLocationHandlerCodingKey;
      goto LABEL_27;
    }

    if ([v4 hmd_isForXPCTransportAuthorizedForLocationAccess])
    {
      v49 = [(HMDHome *)v40 homeLocationHandler];
      v50 = [v49 location];
      [v4 encodeObject:v50 forKey:@"homeLocation"];

      if ([v4 hmd_isForXPCTransportEntitledForHomeLocationAccess])
      {
        v51 = [(HMDHome *)v40 homeLocation];
        [v4 encodeInteger:v51 forKey:*MEMORY[0x277CD0060]];
      }
    }

    v52 = [(HMDHome *)v40 primaryResident];
    v53 = [v52 capabilities];
    v54 = [v53 supportsSiriEndpointSetup];

    v47 = v242;
    if (v54)
    {
      v55 = [objc_alloc(MEMORY[0x277D0F940]) initWithMajorVersion:7 minorVersion:2 updateVersion:2];
      v56 = MEMORY[0x277CD05D8];
LABEL_27:
      [v4 encodeObject:v55 forKey:*v56];
    }
  }

  if (v243)
  {
    v57 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome lastSyncedConfigurationVersion](v40, "lastSyncedConfigurationVersion")}];
    [v4 encodeObject:v57 forKey:@"lastSyncedHomeConfigVersion"];

    v58 = [(HMDHome *)v40 reachabilityNotificationManager];
    v59 = [v58 reachabilityContext];
    [v4 encodeObject:v59 forKey:@"HMHH.residentReachabilityContext"];

    v47 = v242;
  }

  v244 = v40;
  if ((v47 & 9) != 0)
  {
    v238 = v5;
    v60 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v285 = 0u;
    v286 = 0u;
    v287 = 0u;
    v288 = 0u;
    v61 = [(HMDHome *)v40 _residentUsers];
    v62 = [v61 countByEnumeratingWithState:&v285 objects:v305 count:16];
    if (v62)
    {
      v63 = v62;
      v64 = *v286;
      do
      {
        for (i = 0; i != v63; ++i)
        {
          if (*v286 != v64)
          {
            objc_enumerationMutation(v61);
          }

          v66 = *(*(&v285 + 1) + 8 * i);
          v67 = [v66 userID];
          v68 = [HMDDevice deviceWithDestination:v67];

          if (v68)
          {
            [v60 setObject:v66 forKey:v68];
          }
        }

        v63 = [v61 countByEnumeratingWithState:&v285 objects:v305 count:16];
      }

      while (v63);
    }

    v69 = [v60 objectEnumerator];
    v239 = [v69 allObjects];

    v246 = v60;
    if (v5 && v241 & 1 | !isAppleTV())
    {
      v249 = [MEMORY[0x277CBEB18] array];
      v40 = v244;
      if (v241)
      {
        v251 = v4;
        v70 = [(HMDHome *)v244 owner];
        v71 = [(HMDHome *)v244 isOwnerUser];
        v281 = 0u;
        v282 = 0u;
        v283 = 0u;
        v284 = 0u;
        v72 = [(HMDHome *)v244 users];
        v73 = [v72 countByEnumeratingWithState:&v281 objects:v304 count:16];
        if (v73)
        {
          v74 = v73;
          v75 = *v282;
          do
          {
            for (j = 0; j != v74; ++j)
            {
              if (*v282 != v75)
              {
                objc_enumerationMutation(v72);
              }

              v77 = *(*(&v281 + 1) + 8 * j);
              if (!v71 || ([*(*(&v281 + 1) + 8 * j) isEqual:v70] & 1) == 0)
              {
                v78 = [v77 userID];
                if (!v78)
                {
                  continue;
                }

                v79 = v78;
                v80 = [v77 isRemoteGateway];

                if (v80)
                {
                  continue;
                }
              }

              [v249 addObject:v77];
            }

            v74 = [v72 countByEnumeratingWithState:&v281 objects:v304 count:16];
          }

          while (v74);
        }

        v40 = v244;
        v4 = v251;
        v5 = v238;
        v60 = v246;
        if ([(HMDHome *)v244 isAdminUser])
        {
          v81 = MEMORY[0x277CBEB18];
          v82 = [(HMDHome *)v244 outgoingInvitations];
          v83 = [v81 arrayWithCapacity:{objc_msgSend(v82, "count")}];

          v279 = 0u;
          v280 = 0u;
          v277 = 0u;
          v278 = 0u;
          v84 = [(HMDHome *)v244 outgoingInvitations];
          v85 = [v84 countByEnumeratingWithState:&v277 objects:v303 count:16];
          if (v85)
          {
            v86 = v85;
            v87 = *v278;
            do
            {
              for (k = 0; k != v86; ++k)
              {
                if (*v278 != v87)
                {
                  objc_enumerationMutation(v84);
                }

                v89 = *(*(&v277 + 1) + 8 * k);
                v90 = [v89 user];
                v91 = [v90 isRemoteGateway];

                if ((v91 & 1) == 0)
                {
                  [v83 addObject:v89];
                }
              }

              v86 = [v84 countByEnumeratingWithState:&v277 objects:v303 count:16];
            }

            while (v86);
          }

          v92 = [v83 copy];
          [v251 encodeObject:v92 forKey:@"HM.invitations"];

          v5 = v238;
          v40 = v244;
        }
      }

      else
      {
        [(HMDHome *)v244 isAdminUser];
      }

      v95 = v249;
      v159 = [v249 copy];
      [v4 encodeObject:v159 forKey:@"users"];

      [v4 encodeBool:-[HMDHome isAdminUser](v40 forKey:{"isAdminUser"), @"isAdminUser"}];
      [v4 encodeBool:-[HMDHome isOwnerUser](v40 forKey:{"isOwnerUser"), @"HM.isOwnerUser"}];
      v160 = [(HMDHome *)v40 isAccessToHomeAllowed];
      [v4 encodeBool:v160 forKey:*MEMORY[0x277CD0018]];
      v47 = v242;
      if ((v160 & 1) == 0)
      {
        v161 = [(HMDHome *)v40 accessNotAllowedReasonCode];
        [v4 encodeInteger:v161 forKey:*MEMORY[0x277CCFD90]];
      }

      v162 = [(HMDHome *)v40 overriddenHomeAccessControl];

      if (!v162)
      {
        goto LABEL_136;
      }

      v108 = [(HMDHome *)v40 overriddenHomeAccessControl];
      v163 = [v108 unsignedIntegerValue];
      [v4 encodeInteger:v163 forKey:*MEMORY[0x277CCFD88]];
    }

    else
    {
      v40 = v244;
      if ((v243 | v240))
      {
        v93 = MEMORY[0x277CBEB18];
        v94 = [(HMDHome *)v244 users];
        v95 = [v93 arrayWithArray:v94];

        if ([v4 hmd_isForRemoteTransportOnSameAccount])
        {
          v96 = [v4 hmd_supportedFeatures];
          v97 = [v96 containsObject:&unk_283E71B40];

          if ((v97 & 1) == 0)
          {
            v275 = 0u;
            v276 = 0u;
            v273 = 0u;
            v274 = 0u;
            v98 = [(HMDHome *)v244 users];
            v99 = [v98 copy];

            v100 = [v99 countByEnumeratingWithState:&v273 objects:v302 count:16];
            if (v100)
            {
              v101 = v100;
              v102 = *v274;
              do
              {
                for (m = 0; m != v101; ++m)
                {
                  if (*v274 != v102)
                  {
                    objc_enumerationMutation(v99);
                  }

                  v104 = *(*(&v273 + 1) + 8 * m);
                  if ([v104 requiresMakoSupport])
                  {
                    [v95 removeObject:v104];
                  }
                }

                v101 = [v99 countByEnumeratingWithState:&v273 objects:v302 count:16];
              }

              while (v101);
            }
          }
        }

        v105 = [v239 mutableCopy];
        [v95 removeObjectsInArray:v239];
        if (([v4 hmd_isForRemoteGatewayCoder] & 1) == 0)
        {
          v106 = [(HMDHome *)v244 usersPendingUserManagementOperations];
          [v95 removeObjectsInArray:v106];

          v107 = [(HMDHome *)v244 usersPendingUserManagementOperations];
          [v105 removeObjectsInArray:v107];
        }

        v271 = 0u;
        v272 = 0u;
        v269 = 0u;
        v270 = 0u;
        v108 = v105;
        v109 = [v108 countByEnumeratingWithState:&v269 objects:v301 count:16];
        if (v109)
        {
          v110 = v109;
          v111 = *v270;
          do
          {
            for (n = 0; n != v110; ++n)
            {
              if (*v270 != v111)
              {
                objc_enumerationMutation(v108);
              }

              v113 = [*(*(&v269 + 1) + 8 * n) legacyUser];
              [v95 addObject:v113];
            }

            v110 = [v108 countByEnumeratingWithState:&v269 objects:v301 count:16];
          }

          while (v110);
        }

        v114 = [v95 copy];
        [v4 encodeObject:v114 forKey:@"users"];

        v115 = [v108 copy];
        [v4 encodeObject:v115 forKey:@"residentDevices"];
      }

      else
      {
        v47 = v242;
        if (![v4 hmd_isForRemoteTransport])
        {
LABEL_137:

          goto LABEL_138;
        }

        v95 = [MEMORY[0x277CBEB18] array];
        v116 = [(HMDHome *)v244 owner];

        if (v116)
        {
          v117 = [(HMDHome *)v244 owner];
          [v95 addObject:v117];

          v118 = [v4 hmd_user];

          if (v118)
          {
            v119 = [v4 hmd_user];
            [v95 addObject:v119];
          }
        }

        v267 = 0u;
        v268 = 0u;
        v265 = 0u;
        v266 = 0u;
        v120 = v239;
        v121 = [v120 countByEnumeratingWithState:&v265 objects:v300 count:16];
        if (v121)
        {
          v122 = v121;
          v123 = *v266;
          do
          {
            for (ii = 0; ii != v122; ++ii)
            {
              if (*v266 != v123)
              {
                objc_enumerationMutation(v120);
              }

              v125 = [*(*(&v265 + 1) + 8 * ii) legacyUser];
              [v95 addObject:v125];
            }

            v122 = [v120 countByEnumeratingWithState:&v265 objects:v300 count:16];
          }

          while (v122);
        }

        v126 = [v95 copy];
        [v4 encodeObject:v126 forKey:@"users"];

        [v4 encodeObject:v120 forKey:@"residentDevices"];
        v250 = v95;
        if ([v4 hmd_isForRemoteUserAdministrator])
        {
          v127 = MEMORY[0x277CBEB18];
          v128 = [(HMDHome *)v244 users];
          v129 = [v127 arrayWithCapacity:{objc_msgSend(v128, "count")}];

          v263 = 0u;
          v264 = 0u;
          v261 = 0u;
          v262 = 0u;
          v130 = [(HMDHome *)v244 users];
          v131 = [v130 countByEnumeratingWithState:&v261 objects:v299 count:16];
          if (v131)
          {
            v132 = v131;
            v133 = *v262;
            do
            {
              for (jj = 0; jj != v132; ++jj)
              {
                if (*v262 != v133)
                {
                  objc_enumerationMutation(v130);
                }

                v135 = *(*(&v261 + 1) + 8 * jj);
                if (([v135 isRemoteGateway] & 1) == 0 && (objc_msgSend(v135, "privilege") == 4 || !objc_msgSend(v135, "privilege")))
                {
                  if (![v135 requiresMakoSupport] || (objc_msgSend(v4, "hmd_supportedFeatures"), v136 = objc_claimAutoreleasedReturnValue(), v137 = objc_msgSend(v136, "containsObject:", &unk_283E71B40), v136, v137))
                  {
                    [v129 addObject:v135];
                  }
                }
              }

              v132 = [v130 countByEnumeratingWithState:&v261 objects:v299 count:16];
            }

            while (v132);
          }

          v138 = [v129 copy];
          [v4 encodeObject:v138 forKey:@"HM.sharedUsers"];

          v5 = v238;
          v60 = v246;
          v95 = v250;
        }

        v139 = objc_autoreleasePoolPush();
        v40 = v244;
        v140 = v244;
        v141 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v141, OS_LOG_TYPE_INFO))
        {
          v142 = HMFGetLogIdentifier();
          v143 = [(HMDHome *)v140 users];
          v144 = [v4 hmd_user];
          *buf = 138543874;
          v291 = v142;
          v292 = 2112;
          v293 = v143;
          v294 = 2112;
          v295 = v144;
          _os_log_impl(&dword_229538000, v141, OS_LOG_TYPE_INFO, "%{public}@encode users: %@, coder username: %@", buf, 0x20u);

          v40 = v244;
        }

        objc_autoreleasePoolPop(v139);
        v259 = 0u;
        v260 = 0u;
        v257 = 0u;
        v258 = 0u;
        v108 = [(HMDHome *)v140 users];
        v252 = [v108 countByEnumeratingWithState:&v257 objects:v298 count:16];
        if (v252)
        {
          v145 = *v258;
          v247 = *v258;
          v248 = v108;
          v245 = v140;
          do
          {
            for (kk = 0; kk != v252; ++kk)
            {
              if (*v258 != v145)
              {
                objc_enumerationMutation(v108);
              }

              v147 = *(*(&v257 + 1) + 8 * kk);
              v148 = [v4 hmd_user];
              v149 = [v147 isEqual:v148];

              if (v149)
              {
                v150 = objc_autoreleasePoolPush();
                v151 = v140;
                v152 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v152, OS_LOG_TYPE_INFO))
                {
                  v153 = HMFGetLogIdentifier();
                  v154 = [(HMDHome *)v151 users];
                  v155 = [v4 hmd_user];
                  [v147 presenceAuthStatus];
                  v157 = v156 = v4;
                  *buf = 138544130;
                  v291 = v153;
                  v292 = 2112;
                  v293 = v154;
                  v294 = 2112;
                  v295 = v155;
                  v296 = 2112;
                  v297 = v157;
                  _os_log_impl(&dword_229538000, v152, OS_LOG_TYPE_INFO, "%{public}@encode users: %@, coder username: %@, %@", buf, 0x2Au);

                  v4 = v156;
                  v60 = v246;

                  v95 = v250;
                  v140 = v245;
                }

                objc_autoreleasePoolPop(v150);
                v158 = [v147 presenceAuthStatus];
                [v158 addToCoder:v4];

                v145 = v247;
                v108 = v248;
              }
            }

            v252 = [v108 countByEnumeratingWithState:&v257 objects:v298 count:16];
          }

          while (v252);
          v5 = v238;
          v40 = v244;
        }
      }

      v47 = v242;
    }

LABEL_136:
    goto LABEL_137;
  }

LABEL_138:
  if ((v47 & 0x9FD1) != 0)
  {
    [(HMDHome *)v40 _encodeObjectsWithAccessoriesWithCoder:v4];
  }

  v164 = [(HMDHome *)v40 roomForEntireHome];
  [v4 encodeObject:v164 forKey:@"roomForEntireHome"];

  if ((v47 & 5) != 0 && ([v4 hmd_isForRemoteGatewayCoder] & 1) == 0)
  {
    v165 = [(HMDHome *)v40 rooms];
    [v4 encodeObject:v165 forKey:@"rooms"];

    v166 = [(HMDHome *)v40 zones];
    [v4 encodeObject:v166 forKey:@"zones"];
  }

  if ((v47 & 0x801) != 0)
  {
    if (v5)
    {
      if (!v241)
      {
        goto LABEL_149;
      }

      v167 = [(HMDHome *)v40 residentDeviceManager];
      v168 = [v167 residentDevices];

      v169 = @"residentDevices";
    }

    else
    {
      v170 = [(HMDHome *)v40 enabledResidents];
      v171 = [v170 na_filter:&__block_literal_global_2015];

      [v4 encodeInteger:objc_msgSend(v171 forKey:{"count"), @"HMD.nonIPadResidentDeviceCount"}];
      v168 = [(HMDHome *)v40 primaryNetworkRouterManagingDeviceUUID];
      v169 = @"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey";
    }

    [v4 encodeObject:v168 forKey:v169];

    v47 = v242;
  }

LABEL_149:
  if ((v47 & 0x85D1) != 0 && (![v4 hmd_isForXPCTransport] || objc_msgSend(v4, "hmd_isForXPCTransportEntitledForSPIAccess")))
  {
    v172 = [(HMDHome *)v40 minimumMediaUserPrivilege];
    [v4 encodeInteger:v172 forKey:*MEMORY[0x277CD03F8]];
    v173 = [(HMDHome *)v40 isMediaPeerToPeerEnabled];
    [v4 encodeBool:v173 forKey:*MEMORY[0x277CD0410]];
    if (([v4 hmd_isForNonAdminSharedUser] & 1) == 0)
    {
      v174 = [(HMDHome *)v40 mediaPassword];
      [v4 encodeObject:v174 forKey:*MEMORY[0x277CD0400]];
    }
  }

  if ((v47 & 0x11) != 0 && (![v4 hmd_isForXPCTransport] || objc_msgSend(v4, "hmd_isForXPCTransportEntitledForSPIAccess")))
  {
    v175 = [(HMDHome *)v40 isAutomaticSoftwareUpdateEnabled];
    [v4 encodeBool:v175 forKey:*MEMORY[0x277CCFE80]];
    v176 = [(HMDHome *)v40 isAutomaticThirdPartyAccessorySoftwareUpdateEnabled];
    [v4 encodeBool:v176 forKey:*MEMORY[0x277CCFE88]];
  }

  v177 = [(HMDHome *)v40 matterFabricID];
  [v4 encodeObject:v177 forKey:@"HM.matterFabricID"];

  if (v47)
  {
    if (v243)
    {
      v178 = [(HMDHome *)v40 featuresDataSource];
      v179 = [v178 isHomeActivityStateReplacesPresenceMonitorFeatureEnabled];

      if ((v179 & 1) == 0)
      {
        v180 = [(HMDHome *)v40 presenceMonitor];
        [v4 encodeObject:v180 forKey:@"kHMDHomePresenceMonitorCodingKey"];
      }

      v181 = [(HMDHome *)v40 unfilteredThreadNetworkID];
      [v4 encodeObject:v181 forKey:@"HMHM.threadNetworkID"];
    }

    if ([v4 hmd_isForRemoteGatewayCoder])
    {
      if (!v5)
      {
        goto LABEL_171;
      }
    }

    else
    {
      if ((v5 & 1) == 0)
      {
        v185 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome allowsRemoteAccess](v40, "allowsRemoteAccess")}];
        [v4 encodeObject:v185 forKey:@"HM.allowsRemoteAccess"];

        v186 = [(HMDHome *)v40 networkProtectionGroupRegistry];
        v187 = [v186 persistedGroups];
        [v4 encodeObject:v187 forKey:*MEMORY[0x277CCFDB0]];

LABEL_171:
        v184 = [(HMDHome *)v40 appData];
        [v4 encodeObject:v184 forKey:@"HM.appDataRepository"];
LABEL_172:

        if (v243)
        {
          v188 = [(HMDHome *)v40 removedUsers];
          [v4 encodeObject:v188 forKey:@"HM.removedUsersCodingKey"];
        }

        else if (!v240)
        {
LABEL_176:
          if ((v243 | v240))
          {
            isWatch();
            if (([v4 hmd_isForRemoteGatewayCoder] & 1) == 0)
            {
              v191 = MEMORY[0x277CBEB18];
              v192 = [(HMDHome *)v244 outgoingInvitations];
              v193 = [v191 arrayWithArray:v192];

              if ([v4 hmd_isForRemoteTransportOnSameAccount])
              {
                v194 = [v4 hmd_supportedFeatures];
                v195 = [v194 containsObject:&unk_283E71B40];

                if ((v195 & 1) == 0)
                {
                  v196 = v5;
                  v255 = 0u;
                  v256 = 0u;
                  v253 = 0u;
                  v254 = 0u;
                  v197 = [(HMDHome *)v244 outgoingInvitations];
                  v198 = [v197 countByEnumeratingWithState:&v253 objects:v289 count:16];
                  if (v198)
                  {
                    v199 = v198;
                    v200 = *v254;
                    do
                    {
                      for (mm = 0; mm != v199; ++mm)
                      {
                        if (*v254 != v200)
                        {
                          objc_enumerationMutation(v197);
                        }

                        v202 = *(*(&v253 + 1) + 8 * mm);
                        v203 = [v202 user];
                        if ([v203 requiresMakoSupport])
                        {
                          [v193 removeObject:v202];
                        }
                      }

                      v199 = [v197 countByEnumeratingWithState:&v253 objects:v289 count:16];
                    }

                    while (v199);
                  }

                  v5 = v196;
                }
              }

              v204 = [v193 copy];
              [v4 encodeObject:v204 forKey:@"HM.invitations"];
            }
          }

          if (![v4 hmd_isForXPCTransport] || objc_msgSend(v4, "hmd_isForXPCTransportEntitledForSPIAccess"))
          {
            v205 = [(HMDHome *)v244 protectionMode];
            [v4 encodeInteger:v205 forKey:*MEMORY[0x277CD0458]];
          }

          if ([v4 hmd_isForXPCTransport])
          {
            if ([v4 hmd_isForXPCTransportEntitledForSPIAccess])
            {
              v206 = [(HMDHome *)v244 networkRouterSupportDisableReason];
              [v4 encodeInteger:v206 forKey:*MEMORY[0x277CD0460]];
            }

            v207 = [(HMDHome *)v244 networkRouterSupport];
            [v4 encodeBool:(v207 >> 2) & 1 forKey:*MEMORY[0x277CCFE10]];
          }

          v208 = [(HMDHome *)v244 threadNetworkID];
          if (v208 && [v4 hmd_isForXPCTransport])
          {
            v209 = [v4 hmd_isForXPCTransportEntitledForSPIAccess];

            if (!v209)
            {
              goto LABEL_203;
            }

            v208 = [(HMDHome *)v244 threadNetworkID];
            [v4 encodeObject:v208 forKey:*MEMORY[0x277CD0628]];
          }

LABEL_203:
          if (([v4 hmd_isForXPCTransport] & 1) == 0)
          {
            v210 = [(HMDHome *)v244 activeNetworkRouterUUID];
            v211 = [v210 UUIDString];
            [v4 encodeObject:v211 forKey:@"HMHM.activeNetworkRouter"];

            v212 = [(HMDHome *)v244 minimumNetworkRouterSupportHomeKitVersion];
            v213 = [v212 versionString];
            [v4 encodeObject:v213 forKey:@"HMHM.minimumNetworkRouterSupportHomeKitVersion"];

            v214 = [(HMDHome *)v244 minHomeKitVersionForAccessoryNetworkProtectionChange];
            v215 = [v214 versionString];
            [v4 encodeObject:v215 forKey:@"HMHM.minHomeKitVersionForAccessoryNetworkProtectionChangeCodingKey"];
          }

          if (v5)
          {
            if (![v4 hmd_isForXPCTransportEntitledForSPIAccess])
            {
LABEL_213:
              if ([v4 hmd_isForXPCTransportEntitledForSPIAccess])
              {
                v224 = [(HMDHome *)v244 primaryResidentNetworkInfo];
                [v4 encodeObject:v224 forKey:*MEMORY[0x277CD04F0]];
              }

              if ((v243 | v240))
              {
                v225 = [(HMDHome *)v244 chipStorage];
                [v4 encodeObject:v225 forKey:@"HMHM.chipStorage"];
              }

              if (!-[HMDHome isOwnerUser](v244, "isOwnerUser") && (([v4 hmd_isForLocalStore] & 1) != 0 || objc_msgSend(v4, "hmd_isForRemoteTransportOnSameAccount")))
              {
                v226 = [(HMDHome *)v244 sharedHomeSourceVersion];
                [v4 encodeObject:v226 forKey:@"kHomeKitVersionStringKey"];
              }

              if ((v5 & v241) == 1)
              {
                v227 = [(HMDHome *)v244 primaryResident];
                v228 = [v227 capabilities];
                v229 = [v228 supportsResidentActionSetStateEvaluation];
                [v4 encodeBool:v229 forKey:*MEMORY[0x277CD05F8]];

                v230 = [(HMDHome *)v244 isEventLogEnabled];
                [v4 encodeBool:v230 forKey:*MEMORY[0x277CCFF08]];
                v231 = [(HMDHome *)v244 didOnboardEventLog];
                [v4 encodeBool:v231 forKey:*MEMORY[0x277CCFF10]];
                v232 = [(HMDHome *)v244 eventLogDuration];
                [v4 encodeInteger:v232 forKey:*MEMORY[0x277CCFF00]];
                v233 = [(HMDHome *)v244 timeZone];
                [v4 encodeObject:v233 forKey:*MEMORY[0x277CD0630]];

                v234 = [(HMDHome *)v244 numberOfCameras];
                [v4 encodeObject:v234 forKey:*MEMORY[0x277CD0478]];

                [v4 encodeBool:-[HMDHome supportsResidentSelection](v244 forKey:{"supportsResidentSelection"), @"HMHomeResidentSelectionSupported"}];
                v235 = [(HMDHome *)v244 userSelectedPreferredResident];
                [v4 encodeObject:v235 forKey:@"HMHomeUserSelectedPreferredResident"];

                v236 = [(HMDHome *)v244 autoSelectedPreferredResidents];
                [v4 encodeObject:v236 forKey:@"HMHomeAutoSelectedPreferredResidents"];
              }

              goto LABEL_223;
            }

            v216 = [(HMDHome *)v244 personManagerSettings];
            [v4 encodeObject:v216 forKey:*MEMORY[0x277CD04A0]];

            v217 = [(HMDHome *)v244 personManagerZoneUUID];
            v218 = *MEMORY[0x277CD04B8];
          }

          else
          {
            v219 = [(HMDHome *)v244 personManagerSettings];
            [v4 encodeObject:v219 forKey:*MEMORY[0x277CD04A0]];

            v220 = [(HMDHome *)v244 personManagerZoneUUID];
            [v4 encodeObject:v220 forKey:*MEMORY[0x277CD04B8]];

            v221 = [(HMDHome *)v244 naturalLightingContext];
            [v4 encodeObject:v221 forKey:@"HM.nlcck"];

            if (([v4 hmd_isForLocalStore] & 1) != 0 || objc_msgSend(v4, "hmd_isForRemoteUserAdministrator"))
            {
              v222 = [(HMDHome *)v244 labelsByAccessCode];
              [v4 encodeObject:v222 forKey:@"HMDHomeLabelsByAccessCodeCodingKey"];

              v223 = [(HMDHome *)v244 removedUserInfoByAccessCode];
              [v4 encodeObject:v223 forKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"];
            }

            v217 = [(HMDHome *)v244 nfcReaderKey];
            v218 = @"HMDHomeNFCReaderKeyCodingKey";
          }

          [v4 encodeObject:v217 forKey:v218];

          goto LABEL_213;
        }

        v189 = [(HMDHome *)v40 presenceAuthStatus];
        [v189 addToCoder:v4];

        v190 = [(HMDHome *)v40 presenceComputeStatus];
        [v190 addToCoder:v4];

        goto LABEL_176;
      }

      if (v241)
      {
        v182 = [(HMDHome *)v40 networkProtectionGroupRegistry];
        v183 = [v182 activeGroups];
        [v4 encodeObject:v183 forKey:*MEMORY[0x277CCFDB0]];
      }
    }

    v184 = [(HMDHome *)v40 appData];
    [v184 encodeForXPCTransportWithCoder:v4 key:@"HM.appData"];
    goto LABEL_172;
  }

LABEL_223:

  v237 = *MEMORY[0x277D85DE8];
}

BOOL __28__HMDHome__encodeWithCoder___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 device];
  v3 = [v2 productInfo];
  v4 = [v3 productClass] != 3;

  return v4;
}

- (void)encodeWithCoder:(id)a3
{
  v5 = a3;
  v4 = objc_autoreleasePoolPush();
  [(HMDHome *)self _encodeWithCoder:v5];
  objc_autoreleasePoolPop(v4);
}

- (id)_initWithCoder:(id)a3
{
  v401 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"homeName"];
  v6 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"homeUUID"];
  v7 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v6];
  v8 = objc_alloc_init(HMDHomeDefaultDataSource);
  v342 = v5;
  v343 = v7;
  v9 = [(HMDHome *)self initWithName:v5 uuid:v7 defaultRoomUUID:0 owner:0 homeManager:0 presenceAuth:0 dataSource:v8];

  if (!v9)
  {
    v27 = v6;
    v28 = v5;
    goto LABEL_219;
  }

  v340 = v6;
  v10 = [HMDHome zoneIDFromHomeUUID:v9->_uuid];
  zoneID = v9->_zoneID;
  v9->_zoneID = v10;

  v353 = v9;
  v12 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"creationDate"];
  creationDate = v9->_creationDate;
  v9->_creationDate = v12;

  v14 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"firstHAPAccessoryAddedDate"];
  firstHAPAccessoryAddedDate = v9->_firstHAPAccessoryAddedDate;
  v9->_firstHAPAccessoryAddedDate = v14;

  v16 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"homeAdmin"];
  ownerName = v9->_ownerName;
  v9->_ownerName = v16;

  v344 = v4;
  if ([v4 hmd_isHH2MigrationInProgress])
  {
    v9->_ownerUser = [v4 decodeBoolForKey:@"HM.Owner.HH2.MI"];
    v18 = objc_autoreleasePoolPush();
    v19 = v9;
    v20 = v18;
    v21 = v19;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      v23 = HMFGetLogIdentifier();
      ownerUser = v353->_ownerUser;
      v25 = HMFBooleanToString();
      [(HMDHome *)v21 isOwnerUser];
      v26 = HMFBooleanToString();
      *buf = 138543874;
      v396 = v23;
      v397 = 2112;
      v398 = v25;
      v399 = 2112;
      v400 = v26;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@HH2 Migration : isOwnerUser : %@ / %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v20);
    v9 = v353;
  }

  if (v9->_ownerUser)
  {
    v29 = [(HMDHome *)v9 localCapabilitiesDataSource];
    v30 = [v29 isResidentCapable];

    v9 = v353;
    if (v30)
    {
      v31 = [(HMDHome *)v353 featuresDataSource];
      v32 = [v31 isHomeActivityStateReplacesPresenceMonitorFeatureEnabled];

      if ((v32 & 1) == 0)
      {
        v33 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"kHMDHomePresenceMonitorCodingKey"];
        v34 = v33;
        if (!v33)
        {
          v32 = [(HMDHome *)v353 dataSource];
          v34 = [v32 makeHomePresenceMonitor];
        }

        objc_storeStrong(&v353->_presenceMonitor, v34);
        if (!v33)
        {
        }
      }

      v35 = objc_alloc_init(HMDHomePeriodicReader);
      v9 = v353;
      periodicReader = v353->_periodicReader;
      v353->_periodicReader = v35;
    }
  }

  v37 = [[HMDHomeAdministratorHandler alloc] initWithHome:v9];
  administratorHandler = v9->_administratorHandler;
  v9->_administratorHandler = v37;

  if (v9->_ownerUser)
  {
    sharedHomeUpdateHandler = v9->_sharedHomeUpdateHandler;
    v9->_sharedHomeUpdateHandler = 0;
  }

  else
  {
    isWatch();
    v40 = objc_alloc_init(HMDSharedHomeUpdateHandler);
    v41 = v9->_sharedHomeUpdateHandler;
    v9->_sharedHomeUpdateHandler = v40;

    [(HMDSharedHomeUpdateHandler *)v9->_sharedHomeUpdateHandler configureWithHome:v9];
  }

  v42 = v344;
  v43 = [v344 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD2448]];
  mediaSystemController = v43;
  if (!v43)
  {
    mediaSystemController = v353->_mediaSystemController;
  }

  objc_storeStrong(&v353->_mediaSystemController, mediaSystemController);

  rooms = v353->_rooms;
  v46 = MEMORY[0x277CBEB98];
  v394[0] = objc_opt_class();
  v394[1] = objc_opt_class();
  v47 = [MEMORY[0x277CBEA60] arrayWithObjects:v394 count:2];
  v48 = [v46 setWithArray:v47];
  v49 = [v344 decodeObjectOfClasses:v48 forKey:@"rooms"];
  [(NSMutableArray *)rooms setArray:v49];

  zones = v353->_zones;
  v51 = MEMORY[0x277CBEB98];
  v393[0] = objc_opt_class();
  v393[1] = objc_opt_class();
  v52 = [MEMORY[0x277CBEA60] arrayWithObjects:v393 count:2];
  v53 = [v51 setWithArray:v52];
  v54 = [v344 decodeObjectOfClasses:v53 forKey:@"zones"];
  [(NSMutableArray *)zones setArray:v54];

  if ([v344 containsValueForKey:@"accessories"])
  {
    v55 = +[HMDHome supportedAccessoryClasses];
    v56 = [v344 decodeObjectOfClasses:v55 forKey:@"accessories"];
    [(HMDHome *)v353 _addAccessories:v56];

    v42 = v344;
  }

  if ([v42 containsValueForKey:@"accessories.airplay"])
  {
    v57 = +[HMDHome supportedAccessoryClasses];
    v58 = [v42 decodeObjectOfClasses:v57 forKey:@"accessories.airplay"];
    [(HMDHome *)v353 _addAccessories:v58];

    v42 = v344;
  }

  if ([v42 containsValueForKey:@"accessories.homepod"])
  {
    v59 = +[HMDHome supportedAccessoryClasses];
    v60 = [v42 decodeObjectOfClasses:v59 forKey:@"accessories.homepod"];
    [(HMDHome *)v353 _addAccessories:v60];

    v42 = v344;
  }

  if ([v42 containsValueForKey:@"accessories.homepod_6_1"])
  {
    v61 = +[HMDHome supportedAccessoryClasses];
    v62 = [v42 decodeObjectOfClasses:v61 forKey:@"accessories.homepod_6_1"];
    [(HMDHome *)v353 _addAccessories:v62];

    v42 = v344;
  }

  if ([v42 containsValueForKey:@"HM.AppleMediaAccessorySensor"])
  {
    v63 = +[HMDHome supportedAccessoryClasses];
    v64 = [v42 decodeObjectOfClasses:v63 forKey:@"HM.AppleMediaAccessorySensor"];
    [(HMDHome *)v353 _addAccessories:v64];

    v42 = v344;
  }

  v65 = *MEMORY[0x277CD0450];
  if ([v42 containsValueForKey:*MEMORY[0x277CD0450]])
  {
    -[HMDHome setMultiUserEnabled:](v353, "setMultiUserEnabled:", [v42 decodeBoolForKey:v65]);
  }

  v353->_soundCheckEnabled = [v42 decodeBoolForKey:*MEMORY[0x277CD05F0]];
  v66 = [v42 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CCFE50]];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v67 = v66;
  }

  else
  {
    v67 = 0;
  }

  v68 = v67;

  v353->_audioAnalysisClassifierOptions = [v68 unsignedIntegerValue];
  v353->_didOnboardAudioAnalysis = [v344 decodeBoolForKey:*MEMORY[0x277CCFE70]];
  v69 = [v344 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD05E0]];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v70 = v69;
  }

  else
  {
    v70 = 0;
  }

  v71 = v70;

  v353->_siriPhraseOptions = [v71 unsignedIntegerValue];
  v353->_locationServicesEnabled = [v344 decodeBoolForKey:*MEMORY[0x277CD0050]];
  v353->_didOnboardLocationServices = [v344 decodeBoolForKey:*MEMORY[0x277CCFEB0]];
  v72 = *MEMORY[0x277CCFFD0];
  if ([v344 containsValueForKey:*MEMORY[0x277CCFFD0]])
  {
    -[HMDHome setHasAnyUserAcknowledgedCameraRecordingOnboarding:](v353, "setHasAnyUserAcknowledgedCameraRecordingOnboarding:", [v344 decodeBoolForKey:v72]);
  }

  v73 = *MEMORY[0x277CCFFD8];
  if ([v344 containsValueForKey:*MEMORY[0x277CCFFD8]])
  {
    v353->_hasOnboardedForAccessCode = [v344 decodeBoolForKey:v73];
  }

  v74 = *MEMORY[0x277CCFFE0];
  if ([v344 containsValueForKey:*MEMORY[0x277CCFFE0]])
  {
    v353->_hasOnboardedForWalletKey = [v344 decodeBoolForKey:v74];
  }

  else
  {
    v353->_shouldEncodeHasOnboardedForWalletKey = 0;
  }

  serviceGroups = v353->_serviceGroups;
  v76 = MEMORY[0x277CBEB98];
  v392[0] = objc_opt_class();
  v392[1] = objc_opt_class();
  v77 = [MEMORY[0x277CBEA60] arrayWithObjects:v392 count:2];
  v78 = [v76 setWithArray:v77];
  v79 = [v344 decodeObjectOfClasses:v78 forKey:*MEMORY[0x277CD25E8]];
  [(NSMutableArray *)serviceGroups setArray:v79];

  v80 = MEMORY[0x277CBEB98];
  v391[0] = objc_opt_class();
  v391[1] = objc_opt_class();
  v81 = [MEMORY[0x277CBEA60] arrayWithObjects:v391 count:2];
  v82 = [v80 setWithArray:v81];

  actionSets = v353->_actionSets;
  v84 = [v344 decodeObjectOfClasses:v82 forKey:@"actionSets"];
  [(NSMutableArray *)actionSets setArray:v84];

  triggerOwnedActionSets = v353->_triggerOwnedActionSets;
  v86 = [v344 decodeObjectOfClasses:v82 forKey:@"HM.triggerOwnedActionSets"];
  [(NSMutableArray *)triggerOwnedActionSets setArray:v86];

  v87 = [MEMORY[0x277CBEB18] array];
  v339 = v82;
  v88 = [v344 decodeObjectOfClasses:v82 forKey:@"builtinActionSets"];
  [v87 setArray:v88];

  v338 = v87;
  if ([v87 count])
  {
    [(NSMutableArray *)v353->_actionSets addObjectsFromArray:v87];
  }

  else if ([(HMDHome *)v353 isOwnerUser])
  {
    v89 = objc_autoreleasePoolPush();
    v90 = v353;
    v91 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v91, OS_LOG_TYPE_INFO))
    {
      v92 = HMFGetLogIdentifier();
      v93 = [(NSMutableArray *)v353->_actionSets count];
      *buf = 138543618;
      v396 = v92;
      v397 = 2048;
      v398 = v93;
      _os_log_impl(&dword_229538000, v91, OS_LOG_TYPE_INFO, "%{public}@init: %ld user-defined actionSets; no builtin actionSets - creating....", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v89);
    v94 = v353->_actionSets;
    v95 = [(HMDHome *)v90 _createBuiltinActionSets];
    [(NSMutableArray *)v94 addObjectsFromArray:v95];
  }

  removedUsers = v353->_removedUsers;
  v97 = MEMORY[0x277CBEB98];
  v390[0] = objc_opt_class();
  v390[1] = objc_opt_class();
  v98 = [MEMORY[0x277CBEA60] arrayWithObjects:v390 count:2];
  v99 = [v97 setWithArray:v98];
  v100 = v344;
  v101 = [v344 decodeObjectOfClasses:v99 forKey:@"HM.removedUsersCodingKey"];
  [(NSMutableArray *)removedUsers setArray:v101];

  v352 = [MEMORY[0x277CBEB58] set];
  v102 = [MEMORY[0x277CBEB58] set];
  if ([v344 containsValueForKey:@"residentDevices"])
  {
    v103 = MEMORY[0x277CBEB98];
    v389[0] = objc_opt_class();
    v389[1] = objc_opt_class();
    v104 = [MEMORY[0x277CBEA60] arrayWithObjects:v389 count:2];
    v105 = [v103 setWithArray:v104];
    v106 = [v344 decodeObjectOfClasses:v105 forKey:@"residentDevices"];
    [v352 addObjectsFromArray:v106];

    v100 = v344;
  }

  if ([v100 containsValueForKey:@"HM.sharedUsers"])
  {
    v107 = MEMORY[0x277CBEB98];
    v388[0] = objc_opt_class();
    v388[1] = objc_opt_class();
    v108 = [MEMORY[0x277CBEA60] arrayWithObjects:v388 count:2];
    v109 = [v107 setWithArray:v108];
    v110 = [v100 decodeObjectOfClasses:v109 forKey:@"HM.sharedUsers"];
    [v102 addObjectsFromArray:v110];
  }

  v111 = MEMORY[0x277CBEB98];
  v387[0] = objc_opt_class();
  v387[1] = objc_opt_class();
  v112 = [MEMORY[0x277CBEA60] arrayWithObjects:v387 count:2];
  v113 = [v111 setWithArray:v112];
  v114 = [v100 decodeObjectOfClasses:v113 forKey:@"users"];
  [v102 addObjectsFromArray:v114];

  v372 = 0u;
  v373 = 0u;
  v370 = 0u;
  v371 = 0u;
  obj = v102;
  v115 = [obj countByEnumeratingWithState:&v370 objects:v386 count:16];
  if (v115)
  {
    v116 = v115;
    v350 = *v371;
    do
    {
      for (i = 0; i != v116; ++i)
      {
        if (*v371 != v350)
        {
          objc_enumerationMutation(obj);
        }

        v118 = *(*(&v370 + 1) + 8 * i);
        v366 = 0u;
        v367 = 0u;
        v368 = 0u;
        v369 = 0u;
        v119 = v352;
        v120 = [v119 countByEnumeratingWithState:&v366 objects:v385 count:16];
        if (v120)
        {
          v121 = v120;
          v122 = *v367;
          while (2)
          {
            for (j = 0; j != v121; ++j)
            {
              if (*v367 != v122)
              {
                objc_enumerationMutation(v119);
              }

              v124 = [*(*(&v366 + 1) + 8 * j) userID];
              v125 = [v118 userID];
              v126 = [v124 isEqualToString:v125];

              if (v126)
              {

                goto LABEL_71;
              }
            }

            v121 = [v119 countByEnumeratingWithState:&v366 objects:v385 count:16];
            if (v121)
            {
              continue;
            }

            break;
          }
        }

        [(NSMutableArray *)v353->_users addObject:v118];
LABEL_71:
        ;
      }

      v116 = [obj countByEnumeratingWithState:&v370 objects:v386 count:16];
    }

    while (v116);
  }

  users = v353->_users;
  v128 = [v352 allObjects];
  [(NSMutableArray *)users addObjectsFromArray:v128];

  v129 = objc_autoreleasePoolPush();
  v130 = v353;
  v131 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v131, OS_LOG_TYPE_DEBUG))
  {
    v132 = HMFGetLogIdentifier();
    v133 = v353->_users;
    *buf = 138543618;
    v396 = v132;
    v397 = 2112;
    v398 = v133;
    _os_log_impl(&dword_229538000, v131, OS_LOG_TYPE_DEBUG, "%{public}@Received users in the home data: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v129);
  v134 = v344;
  v135 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"roomForEntireHome"];
  v136 = HMDDefaultRoomName();
  v341 = v136;
  if (v135)
  {
    [(HMDRoom *)v135 setName:v136];
  }

  else
  {
    v137 = objc_autoreleasePoolPush();
    v138 = v130;
    v139 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v139, OS_LOG_TYPE_INFO))
    {
      v140 = HMFGetLogIdentifier();
      *buf = 138543362;
      v396 = v140;
      _os_log_impl(&dword_229538000, v139, OS_LOG_TYPE_INFO, "%{public}@Missing roomForEntireHome - creating one", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v137);
    v135 = [[HMDRoom alloc] initWithName:v341 uuid:0 home:v138];
    v134 = v344;
  }

  v337 = v135;
  objc_storeStrong(v130 + 166, v135);
  isWatch();
  v141 = [v134 decodeObjectOfClass:objc_opt_class() forKey:@"homeLocationHandler"];
  if (v141)
  {
    objc_storeStrong(v130 + 76, v141);
  }

  v142 = [v134 decodeObjectOfClass:objc_opt_class() forKey:@"homeConfigVersion"];
  v130[167] = [v142 integerValue];

  if ([v134 containsValueForKey:@"lastSyncedHomeConfigVersion"])
  {
    v143 = [v134 decodeObjectOfClass:objc_opt_class() forKey:@"lastSyncedHomeConfigVersion"];
    v130[168] = [v143 integerValue];
  }

  isWatch();
  v144 = objc_alloc_init(HMDNotificationRegistry);
  v145 = v130[173];
  v130[173] = v144;

  [v130[173] configureWithHome:v130];
  if (isiOSDevice() || isTVOSDevice())
  {
    v146 = [v134 decodeObjectOfClass:objc_opt_class() forKey:@"HM.allowsRemoteAccess"];
    v147 = v146;
    if (v146)
    {
      *(v130 + 321) = [v146 BOOLValue];
    }
  }

  isWatch();
  v148 = v130[7];
  v149 = MEMORY[0x277CBEB98];
  v384[0] = objc_opt_class();
  v384[1] = objc_opt_class();
  v150 = [MEMORY[0x277CBEA60] arrayWithObjects:v384 count:2];
  v151 = [v149 setWithArray:v150];
  v152 = [v134 decodeObjectOfClasses:v151 forKey:@"HM.invitations"];
  [v148 setArray:v152];

  v364 = 0u;
  v365 = 0u;
  v362 = 0u;
  v363 = 0u;
  v153 = v130;
  v154 = [v130[7] copy];
  v155 = [v154 countByEnumeratingWithState:&v362 objects:v383 count:16];
  if (v155)
  {
    v156 = v155;
    v157 = *v363;
    do
    {
      for (k = 0; k != v156; ++k)
      {
        if (*v363 != v157)
        {
          objc_enumerationMutation(v154);
        }

        v159 = *(*(&v362 + 1) + 8 * k);
        v160 = [v159 user];
        v161 = v160;
        if (v160)
        {
          v162 = v353->_users;
          v163 = [v160 userID];
          v164 = [(NSMutableArray *)v162 hmf_firstObjectWithValue:v163 forKeyPath:@"userID"];

          if (v164 && [v159 isComplete])
          {
            [v153[7] removeObject:v159];
          }

          else if ([v159 isAccepted])
          {
            [(NSMutableArray *)v353->_users addObject:v161];
            [v153[4] addObject:v161];
            [v161 setHome:v153];
          }
        }
      }

      v156 = [v154 countByEnumeratingWithState:&v362 objects:v383 count:16];
    }

    while (v156);
  }

  v165 = [v344 hmd_isHH2MigrationInProgress];
  v166 = objc_autoreleasePoolPush();
  v167 = v153;
  v168 = HMFGetOSLogHandle();
  v169 = os_log_type_enabled(v168, OS_LOG_TYPE_INFO);
  if (v165)
  {
    p_cache = (&OBJC_METACLASS___HMDAccessoryFirmwareUpdateManagerWingman + 16);
    if (v169)
    {
      v171 = HMFGetLogIdentifier();
      *buf = 138543362;
      v396 = v171;
      _os_log_impl(&dword_229538000, v168, OS_LOG_TYPE_INFO, "%{public}@HH2 Migration is in progress. Not decoding HMDResidentDeviceManagerLegacy as it does not exist in HH2", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v166);
  }

  else
  {
    p_cache = &OBJC_METACLASS___HMDAccessoryFirmwareUpdateManagerWingman.cache;
    if (v169)
    {
      v172 = HMFGetLogIdentifier();
      *buf = 138543362;
      v396 = v172;
      _os_log_impl(&dword_229538000, v168, OS_LOG_TYPE_INFO, "%{public}@Allocating a new resident device manager", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v166);
    v173 = [HMDResidentDeviceManagerFactory createManagerForHomeUUID:v343];
    v174 = v167[180];
    v167[180] = v173;
  }

  v175 = v344;
  v167[193] = [v344 decodeIntegerForKey:@"HMD.nonIPadResidentDeviceCount"];
  if ([v167 isOwnerUser])
  {
    if ([v344 hmd_isHH2MigrationInProgress])
    {
      v176 = [p_cache + 308 currentUserWithPrivilege:3 forHome:v167 forceHH1Key:1];
    }

    else
    {
      v192 = objc_autoreleasePoolPush();
      v193 = v167;
      v194 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v194, OS_LOG_TYPE_INFO))
      {
        v195 = HMFGetLogIdentifier();
        *buf = 138543362;
        v396 = v195;
        _os_log_impl(&dword_229538000, v194, OS_LOG_TYPE_INFO, "%{public}@Not creating a new owner user in HH2", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v192);
      v176 = 0;
      v175 = v344;
    }

    v196 = v353;
    v197 = [v175 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeOwnerUUID"];
    if (v197)
    {
      v198 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v197];
      [v176 setUUID:v198];

      v196 = v353;
    }

    v336 = v197;
    v199 = [MEMORY[0x277CBEB18] array];
    v358 = 0u;
    v359 = 0u;
    v360 = 0u;
    v361 = 0u;
    v200 = v196->_users;
    v201 = [(NSMutableArray *)v200 countByEnumeratingWithState:&v358 objects:v382 count:16];
    v345 = v199;
    v346 = v176;
    if (v201)
    {
      v202 = v201;
      v347 = 0;
      v203 = *v359;
      do
      {
        for (m = 0; m != v202; ++m)
        {
          if (*v359 != v203)
          {
            objc_enumerationMutation(v200);
          }

          v205 = *(*(&v358 + 1) + 8 * m);
          if ([v205 privilege] == 3 && (objc_msgSend(v205, "isRemoteGateway") & 1) == 0)
          {
            if (v347)
            {
              goto LABEL_138;
            }

            v206 = [v205 pairingUsername];
            v207 = [v176 pairingUsername];
            v208 = [v206 isEqual:v207];

            v176 = v346;
            v199 = v345;
            if (!v208)
            {
LABEL_138:
              [v199 addObject:v205];
            }

            else
            {
              v347 = v205;
            }
          }
        }

        v202 = [(NSMutableArray *)v200 countByEnumeratingWithState:&v358 objects:v382 count:16];
      }

      while (v202);
    }

    else
    {
      v347 = 0;
    }

    [(NSMutableArray *)v353->_users removeObjectsInArray:v199];
    if (v347)
    {
      [v167 setOwner:?];
    }

    else
    {
      [v167 setOwner:v176];
      [(NSMutableArray *)v353->_users addObject:v176];
      [v176 setHome:v167];
      if ([v344 hmd_isHH2MigrationInProgress])
      {
        v209 = [v176 pairingUsername];
        v210 = v353->_ownerName;
        v353->_ownerName = v209;
      }
    }

    v211 = [v167 owner];
    [v167 setCurrentUser:v211];

    v212 = [MEMORY[0x277CBEB18] array];
    v354 = 0u;
    v355 = 0u;
    v356 = 0u;
    v357 = 0u;
    v213 = v353->_users;
    v214 = [(NSMutableArray *)v213 countByEnumeratingWithState:&v354 objects:v381 count:16];
    if (v214)
    {
      v215 = v214;
      v216 = *v355;
      v348 = v167;
      do
      {
        for (n = 0; n != v215; ++n)
        {
          if (*v355 != v216)
          {
            objc_enumerationMutation(v213);
          }

          v218 = *(*(&v354 + 1) + 8 * n);
          v219 = [v218 pairingUsername];
          v220 = [v167 owner];
          v221 = [v220 pairingUsername];
          if ([v219 isEqual:v221])
          {
            if (![v218 privilege])
            {

              goto LABEL_163;
            }

            v222 = [v218 privilege];

            v223 = v222 == 4;
            v167 = v348;
            if (v223)
            {
              goto LABEL_163;
            }
          }

          else
          {
          }

          if ([v218 isValid])
          {
            continue;
          }

          v224 = objc_autoreleasePoolPush();
          v225 = v167;
          v226 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v226, OS_LOG_TYPE_DEFAULT))
          {
            v227 = HMFGetLogIdentifier();
            *buf = 138543618;
            v396 = v227;
            v397 = 2112;
            v398 = v218;
            _os_log_impl(&dword_229538000, v226, OS_LOG_TYPE_DEFAULT, "%{public}@Removing invalid user %@", buf, 0x16u);

            v167 = v348;
          }

          objc_autoreleasePoolPop(v224);
LABEL_163:
          [v212 addObject:v218];
        }

        v215 = [(NSMutableArray *)v213 countByEnumeratingWithState:&v354 objects:v381 count:16];
      }

      while (v215);
    }

    [(NSMutableArray *)v353->_users removeObjectsInArray:v212];
    v175 = v344;
    v189 = v346;
    v190 = v336;
  }

  else
  {
    v177 = [v167 currentUser];

    if (v177)
    {
      goto LABEL_168;
    }

    v178 = objc_autoreleasePoolPush();
    v179 = v167;
    v180 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v180, OS_LOG_TYPE_DEBUG))
    {
      v181 = HMFGetLogIdentifier();
      [v344 hmd_isHH2MigrationInProgress];
      v182 = HMFBooleanToString();
      v183 = v353->_users;
      *buf = 138543874;
      v396 = v181;
      v397 = 2112;
      v398 = v182;
      v399 = 2112;
      v400 = v183;
      _os_log_impl(&dword_229538000, v180, OS_LOG_TYPE_DEBUG, "%{public}@No current user found for this home: isHH2MigrationInProgress = %@, users = %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v178);
    v175 = v344;
    if ([v344 hmd_isHH2MigrationInProgress])
    {
      goto LABEL_168;
    }

    v184 = objc_autoreleasePoolPush();
    v185 = v179;
    v186 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v186, OS_LOG_TYPE_DEFAULT))
    {
      v187 = HMFGetLogIdentifier();
      *buf = 138543362;
      v396 = v187;
      _os_log_impl(&dword_229538000, v186, OS_LOG_TYPE_DEFAULT, "%{public}@Current user not found, creating", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v184);
    v188 = [v185 dataSource];
    v189 = [v188 makeCurrentUserWithUserPrivilege:0 home:v185];

    if (!v189)
    {
      v332 = objc_autoreleasePoolPush();
      v333 = v185;
      v334 = HMFGetOSLogHandle();
      v27 = v340;
      if (os_log_type_enabled(v334, OS_LOG_TYPE_ERROR))
      {
        v335 = HMFGetLogIdentifier();
        *buf = 138543362;
        v396 = v335;
        _os_log_impl(&dword_229538000, v334, OS_LOG_TYPE_ERROR, "%{public}@Current user cannot be found or created, failing to deserialize home", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v332);
      v327 = 0;
      goto LABEL_217;
    }

    v175 = v344;
    v190 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeOwnerUUID"];
    if (v190)
    {
      v191 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v190];
      [v189 setUUID:v191];

      v175 = v344;
    }

    [v185 setCurrentUser:v189];
    [(NSMutableArray *)v353->_users addObject:v189];
    [v189 setHome:v185];
  }

LABEL_168:
  v228 = [MEMORY[0x277CD1F00] authWithCoder:v175];
  v229 = v167[77];
  v167[77] = v228;

  v230 = v167[77];
  [v167 currentUser];
  v232 = v231 = v175;
  [v232 setPresenceAuthStatus:v230];

  v233 = [MEMORY[0x277CD1F08] computeWithCoder:v231];
  v234 = v167[78];
  v167[78] = v233;

  v235 = objc_autoreleasePoolPush();
  v236 = v167;
  v237 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v237, OS_LOG_TYPE_INFO))
  {
    v238 = HMFGetLogIdentifier();
    v239 = [v236 currentUser];
    *buf = 138543618;
    v396 = v238;
    v397 = 2112;
    v398 = v239;
    _os_log_impl(&dword_229538000, v237, OS_LOG_TYPE_INFO, "%{public}@Current user is %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v235);
  v240 = [MEMORY[0x277CBEB18] array];
  v241 = v344;
  if ([v344 containsValueForKey:@"triggers"])
  {
    v242 = MEMORY[0x277CBEB98];
    v380[0] = objc_opt_class();
    v380[1] = objc_opt_class();
    v380[2] = objc_opt_class();
    v380[3] = objc_opt_class();
    v243 = [MEMORY[0x277CBEA60] arrayWithObjects:v380 count:4];
    v244 = [v242 setWithArray:v243];
    v245 = [v344 decodeObjectOfClasses:v244 forKey:@"triggers"];
    [v240 addObjectsFromArray:v245];

    v241 = v344;
  }

  if ([v241 containsValueForKey:@"HM.triggers"])
  {
    v246 = MEMORY[0x277CBEB98];
    v379[0] = objc_opt_class();
    v379[1] = objc_opt_class();
    v379[2] = objc_opt_class();
    v379[3] = objc_opt_class();
    v247 = [MEMORY[0x277CBEA60] arrayWithObjects:v379 count:4];
    v248 = [v246 setWithArray:v247];
    v249 = [v344 decodeObjectOfClasses:v248 forKey:@"HM.triggers"];
    [v240 addObjectsFromArray:v249];

    v241 = v344;
  }

  if ([v241 containsValueForKey:@"HM.sharedActivationTriggers"])
  {
    v250 = MEMORY[0x277CBEB98];
    v378[0] = objc_opt_class();
    v378[1] = objc_opt_class();
    v378[2] = objc_opt_class();
    v378[3] = objc_opt_class();
    v251 = [MEMORY[0x277CBEA60] arrayWithObjects:v378 count:4];
    v252 = [v250 setWithArray:v251];
    v253 = [v241 decodeObjectOfClasses:v252 forKey:@"HM.sharedActivationTriggers"];
    [v240 addObjectsFromArray:v253];
  }

  [v236[57] setArray:v240];
  v254 = v236[12];
  v255 = MEMORY[0x277CBEB98];
  v377[0] = objc_opt_class();
  v377[1] = objc_opt_class();
  v256 = [MEMORY[0x277CBEA60] arrayWithObjects:v377 count:2];
  v257 = [v255 setWithArray:v256];
  v258 = [v241 decodeObjectOfClasses:v257 forKey:@"HM.deviceOwnedTriggers"];
  [v254 setArray:v258];

  v259 = [v241 decodeObjectOfClass:objc_opt_class() forKey:@"HM.appDataRepository"];
  v260 = v236[151];
  v236[151] = v259;

  [v236[151] updateParentUUIDIfNil:v353->_uuid];
  v261 = *MEMORY[0x277CCFE80];
  v262 = v241;
  if ([v241 containsValueForKey:*MEMORY[0x277CCFE80]])
  {
    *(v236 + 128) = [v241 decodeBoolForKey:v261];
  }

  v263 = *MEMORY[0x277CCFE88];
  if ([v241 containsValueForKey:*MEMORY[0x277CCFE88]])
  {
    *(v236 + 129) = [v241 decodeBoolForKey:v263];
  }

  v264 = *MEMORY[0x277CD03F8];
  if ([v241 containsValueForKey:*MEMORY[0x277CD03F8]])
  {
    v236[17] = [v241 decodeIntegerForKey:v264];
  }

  v265 = *MEMORY[0x277CD0410];
  if ([v241 containsValueForKey:*MEMORY[0x277CD0410]])
  {
    *(v236 + 144) = [v241 decodeBoolForKey:v265];
  }

  v266 = *MEMORY[0x277CD0400];
  if ([v241 containsValueForKey:*MEMORY[0x277CD0400]])
  {
    v267 = [v241 decodeObjectOfClass:objc_opt_class() forKey:v266];
    v268 = v236[19];
    v236[19] = v267;
  }

  v269 = [v241 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeKitVersionStringKey"];
  v270 = v236[187];
  v236[187] = v269;

  v271 = v236[187];
  if (v271)
  {
    v272 = +[HMDHomeKitVersion version6];
    v273 = [v271 isAtLeastVersion:v272];

    v262 = v344;
    if (v273)
    {
      *(v236 + 299) = 1;
    }
  }

  v274 = *MEMORY[0x277CD0458];
  if ([v262 containsValueForKey:*MEMORY[0x277CD0458]])
  {
    v275 = [v262 decodeIntegerForKey:v274];
  }

  else
  {
    v275 = 0;
  }

  v236[44] = v275;
  v276 = [v262 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.minimumNetworkRouterSupportHomeKitVersion"];
  if (v276)
  {
    v277 = [[HMDHomeKitVersion alloc] initWithString:v276];
    v278 = v236[52];
    v236[52] = v277;
  }

  v279 = [v262 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.minHomeKitVersionForAccessoryNetworkProtectionChangeCodingKey"];

  if (v279)
  {
    v280 = [[HMDHomeKitVersion alloc] initWithString:v279];
    v281 = v236[53];
    v236[53] = v280;
  }

  v351 = v279;
  v27 = [v262 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.activeNetworkRouter"];

  if (v27)
  {
    v282 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v27];
    v283 = v236[47];
    v236[47] = v282;
  }

  if ([v262 containsValueForKey:@"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey"])
  {
    v284 = [v262 decodeObjectOfClass:objc_opt_class() forKey:@"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey"];
    v285 = v236[50];
    v236[50] = v284;
  }

  v286 = MEMORY[0x277CBEB98];
  v376[0] = objc_opt_class();
  v376[1] = objc_opt_class();
  [MEMORY[0x277CBEA60] arrayWithObjects:v376 count:2];
  v288 = v287 = v262;
  v289 = [v286 setWithArray:v288];
  v290 = [v287 decodeObjectOfClasses:v289 forKey:*MEMORY[0x277CCFDB0]];

  v291 = [HMDAccessoryNetworkProtectionGroupRegistry alloc];
  v292 = [v236 notificationCenter];
  v293 = [(HMDAccessoryNetworkProtectionGroupRegistry *)v291 initWithHome:v236 notificationCenter:v292 persistedGroups:v290];
  v294 = v236[46];
  v236[46] = v293;

  v295 = [v287 decodeObjectOfClass:objc_opt_class() forKey:@"HMHH.residentReachabilityContext"];
  v296 = v295;
  if (v295)
  {
    v297 = v295;
  }

  else
  {
    v297 = objc_alloc_init(HMDResidentReachabilityContext);
  }

  v298 = [[HMDResidentReachabilityNotificationManager alloc] initWithResidentReachabilityContext:v297 workQueue:v236[157]];
  v299 = v236[191];
  v236[191] = v298;

  if ([v344 containsValueForKey:@"HMHM.threadNetworkID"])
  {
    v300 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.threadNetworkID"];
    v301 = v236[58];
    v236[58] = v300;
  }

  v302 = [v344 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD04A0]];
  v303 = v236[70];
  v236[70] = v302;

  v304 = [v344 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD04B8]];
  v305 = v236[190];
  v236[190] = v304;

  v306 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"HM.nlcck"];
  v307 = v236[71];
  v236[71] = v306;

  if ([v344 containsValueForKey:@"HMDHomeLabelsByAccessCodeCodingKey"])
  {
    v308 = MEMORY[0x277CBEB98];
    v375[0] = objc_opt_class();
    v375[1] = objc_opt_class();
    v309 = [MEMORY[0x277CBEA60] arrayWithObjects:v375 count:2];
    v310 = [v308 setWithArray:v309];
    [v344 decodeObjectOfClasses:v310 forKey:@"HMDHomeLabelsByAccessCodeCodingKey"];
    v312 = v311 = v240;

    v313 = [v312 mutableCopy];
    v314 = v236[95];
    v236[95] = v313;

    v240 = v311;
  }

  if ([v344 containsValueForKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"])
  {
    v315 = MEMORY[0x277CBEB98];
    v374[0] = objc_opt_class();
    v374[1] = objc_opt_class();
    v374[2] = objc_opt_class();
    v316 = [MEMORY[0x277CBEA60] arrayWithObjects:v374 count:3];
    v317 = [v315 setWithArray:v316];
    [v344 decodeObjectOfClasses:v317 forKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"];
    v319 = v318 = v240;

    v320 = [v319 mutableCopy];
    v321 = v236[97];
    v236[97] = v320;

    v240 = v318;
  }

  if ([v344 containsValueForKey:@"HMDHomeNFCReaderKeyCodingKey"])
  {
    v322 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"HMDHomeNFCReaderKeyCodingKey"];
    v323 = v236[61];
    v236[61] = v322;
  }

  else
  {
    *(v236 + 313) = 0;
  }

  v324 = [v344 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.chipStorage"];
  if (v324)
  {
    objc_storeStrong(v236 + 195, v324);
    if (isFeatureMatterLocalFabricConfigEnabled())
    {
      v325 = [v324 fabricID];

      if (v325)
      {
        v326 = [v324 fabricID];
        [v236[198] setFabricID:v326];
      }
    }
  }

  *(v236 + 324) = [v344 decodeBoolForKey:*MEMORY[0x277CD0698]];

  v327 = 1;
LABEL_217:

  v4 = v344;
  v28 = v342;
  if (!v327)
  {
    v329 = 0;
    v328 = v353;
    goto LABEL_221;
  }

  v9 = v353;
LABEL_219:
  v328 = v9;
  v329 = v9;
LABEL_221:

  v330 = *MEMORY[0x277D85DE8];
  return v329;
}

- (HMDHome)initWithCoder:(id)a3
{
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = [(HMDHome *)self _initWithCoder:v4];
  objc_autoreleasePoolPop(v5);

  return v6;
}

- (void)fixupHomeAfterDecoding
{
  v125 = *MEMORY[0x277D85DE8];
  v92 = +[HMDProcessInfo privateClientIdentifierSalt];
  v95 = [MEMORY[0x277CBEB38] dictionary];
  v89 = self;
  if ([(HMDHome *)self isOwnerUser])
  {
    v110 = 0u;
    v111 = 0u;
    v108 = 0u;
    v109 = 0u;
    v3 = [(HMDHome *)self accessories];
    v4 = [v3 countByEnumeratingWithState:&v108 objects:v124 count:16];
    if (v4)
    {
      v6 = v4;
      v7 = *v109;
      p_superclass = HMDIDSActivityRegistrationModel.superclass;
      *&v5 = 138543874;
      v80 = v5;
      v84 = v3;
      v85 = *v109;
      do
      {
        v9 = 0;
        v86 = v6;
        do
        {
          if (*v109 != v7)
          {
            objc_enumerationMutation(v3);
          }

          v10 = *(*(&v108 + 1) + 8 * v9);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v11 = v10;
          }

          else
          {
            v11 = 0;
          }

          v12 = v11;

          v13 = [v12 bridge];
          v14 = v13;
          if (v12)
          {
            v15 = v13 == 0;
          }

          else
          {
            v15 = 1;
          }

          if (!v15)
          {
            v16 = [v12 uniqueIdentifier];

            if (v16)
            {
              v87 = v14;
              v88 = v9;
              v17 = MEMORY[0x277CCAD78];
              v18 = [v14 uuid];
              v19 = MEMORY[0x277CFE9F8];
              v20 = [v12 uniqueIdentifier];
              v21 = [v19 instanceIDForUniqueIdentifier:v20];
              v22 = [v21 stringValue];
              v123 = v22;
              v23 = [MEMORY[0x277CBEA60] arrayWithObjects:&v123 count:1];
              v24 = [v17 hm_deriveUUIDFromBaseUUID:v18 withSalts:v23];

              v25 = [v12 uuid];
              LOBYTE(v17) = [v24 isEqual:v25];

              if (v17)
              {

                v6 = v86;
                v14 = v87;
                v9 = v88;
                v7 = v85;
              }

              else
              {
                v36 = objc_autoreleasePoolPush();
                v37 = v89;
                v38 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v38, OS_LOG_TYPE_DEFAULT))
                {
                  v39 = HMFGetLogIdentifier();
                  v40 = [v12 uuid];
                  *buf = v80;
                  v118 = v39;
                  v119 = 2112;
                  v120 = v40;
                  v121 = 2112;
                  v122 = v24;
                  _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_DEFAULT, "%{public}@Fixup of accessory uuid from legacy archive %@ -> %@", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v36);
                v41 = [v12 uuid];
                [v12 setUuid:v24];
                v42 = [v12 appData];

                if (v42)
                {
                  v43 = [v12 uuid];
                  v44 = [v12 appData];
                  [v44 setParentUUID:v43];
                }

                v81 = v41;
                v94 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:v41 identifierSalt:v92 withSalts:{0, v80}];
                v82 = v24;
                v93 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:v24 identifierSalt:v92 withSalts:0];
                v104 = 0u;
                v105 = 0u;
                v106 = 0u;
                v107 = 0u;
                v83 = v12;
                obj = [v12 services];
                v45 = [obj countByEnumeratingWithState:&v104 objects:v116 count:16];
                if (v45)
                {
                  v46 = v45;
                  v91 = *v105;
                  do
                  {
                    for (i = 0; i != v46; ++i)
                    {
                      if (*v105 != v91)
                      {
                        objc_enumerationMutation(obj);
                      }

                      v48 = *(*(&v104 + 1) + 8 * i);
                      [v48 _recalculateUUID];
                      v49 = MEMORY[0x277CCAD78];
                      v50 = [v48 instanceID];
                      v51 = [v50 stringValue];
                      v115 = v51;
                      v52 = [MEMORY[0x277CBEA60] arrayWithObjects:&v115 count:1];
                      v53 = [v49 hm_deriveUUIDFromBaseUUID:v94 identifierSalt:v92 withSalts:v52];

                      v54 = MEMORY[0x277CCAD78];
                      v55 = [v48 instanceID];
                      v56 = [v55 stringValue];
                      v114 = v56;
                      v57 = [MEMORY[0x277CBEA60] arrayWithObjects:&v114 count:1];
                      v58 = [v54 hm_deriveUUIDFromBaseUUID:v93 identifierSalt:v92 withSalts:v57];

                      v59 = [v58 UUIDString];
                      v60 = [v53 UUIDString];
                      [v95 setObject:v59 forKey:v60];

                      v61 = [v48 appData];

                      if (v61)
                      {
                        v62 = [v48 uuid];
                        v63 = [v48 appData];
                        [v63 setParentUUID:v62];
                      }
                    }

                    v46 = [obj countByEnumeratingWithState:&v104 objects:v116 count:16];
                  }

                  while (v46);
                }

                v3 = v84;
                v7 = v85;
                p_superclass = (HMDIDSActivityRegistrationModel + 8);
                v6 = v86;
                v14 = v87;
                v9 = v88;
                v12 = v83;
              }
            }

            else
            {
              v26 = v14;
              v27 = objc_autoreleasePoolPush();
              v28 = v89;
              v29 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
              {
                v30 = HMFGetLogIdentifier();
                v31 = [v12 uuid];
                [v31 UUIDString];
                v32 = p_superclass;
                v33 = v12;
                v35 = v34 = v9;
                *buf = 138543618;
                v118 = v30;
                v119 = 2112;
                v120 = v35;
                _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to check validity of uuid %@ (accessory has nil uniqueIdentifier)", buf, 0x16u);

                v9 = v34;
                v12 = v33;
                p_superclass = v32;

                v6 = v86;
                v7 = v85;
              }

              objc_autoreleasePoolPop(v27);
              v14 = v26;
              v3 = v84;
            }
          }

          ++v9;
        }

        while (v9 != v6);
        v6 = [v3 countByEnumeratingWithState:&v108 objects:v124 count:16];
      }

      while (v6);
    }

    v102 = 0u;
    v103 = 0u;
    v100 = 0u;
    v101 = 0u;
    v64 = [(HMDHome *)v89 rooms];
    v65 = [v64 countByEnumeratingWithState:&v100 objects:v113 count:16];
    if (v65)
    {
      v66 = v65;
      v67 = *v101;
      do
      {
        for (j = 0; j != v66; ++j)
        {
          if (*v101 != v67)
          {
            objc_enumerationMutation(v64);
          }

          v69 = *(*(&v100 + 1) + 8 * j);
          v70 = [v69 appData];

          if (v70)
          {
            v71 = [v69 appData];
            [(HMDHome *)v89 updateAppData:v71 identifierKey:@"HFSortedIdentifierStrings_roomServices" lookup:v95];
          }
        }

        v66 = [v64 countByEnumeratingWithState:&v100 objects:v113 count:16];
      }

      while (v66);
    }

    v72 = [(HMDHome *)v89 appData];

    if (v72)
    {
      v73 = [(HMDHome *)v89 appData];
      [(HMDHome *)v89 updateAppData:v73 identifierKey:@"HFSortedIdentifierStrings_homeServices" lookup:v95];
    }

    [(HMDHome *)v89 computeBridgedAccessoriesForAllBridges];
  }

  v98 = 0u;
  v99 = 0u;
  v96 = 0u;
  v97 = 0u;
  v74 = [(HMDHome *)v89 serviceGroups];
  v75 = [v74 countByEnumeratingWithState:&v96 objects:v112 count:16];
  if (v75)
  {
    v76 = v75;
    v77 = *v97;
    do
    {
      for (k = 0; k != v76; ++k)
      {
        if (*v97 != v77)
        {
          objc_enumerationMutation(v74);
        }

        [*(*(&v96 + 1) + 8 * k) fixupServiceGroup];
      }

      v76 = [v74 countByEnumeratingWithState:&v96 objects:v112 count:16];
    }

    while (v76);
  }

  v79 = *MEMORY[0x277D85DE8];
}

- (void)updateAppData:(id)a3 identifierKey:(id)a4 lookup:(id)a5
{
  v53 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v8 dictionary];
  v12 = [v11 hmf_dictionaryForKey:@"com.apple.homekit-entitledclient.identifer"];

  v37 = v9;
  v13 = [v12 objectForKey:v9];
  v14 = v13;
  if (v13 && [v13 count])
  {
    v34 = v12;
    v35 = v8;
    v32 = [v12 mutableCopy];
    v15 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v14, "count")}];
    v40 = 0u;
    v41 = 0u;
    v42 = 0u;
    v43 = 0u;
    v33 = v14;
    obj = v14;
    v39 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
    if (v39)
    {
      v16 = *v41;
      v36 = *v41;
      do
      {
        for (i = 0; i != v39; ++i)
        {
          if (*v41 != v16)
          {
            objc_enumerationMutation(obj);
          }

          v18 = *(*(&v40 + 1) + 8 * i);
          v19 = [v10 objectForKey:v18];
          if (v19)
          {
            v20 = objc_autoreleasePoolPush();
            v21 = self;
            v22 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
            {
              HMFGetLogIdentifier();
              v23 = v15;
              v24 = self;
              v26 = v25 = v10;
              *buf = 138544130;
              v45 = v26;
              v46 = 2112;
              v47 = v37;
              v48 = 2112;
              v49 = v18;
              v50 = 2112;
              v51 = v19;
              _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Fixup of service uuid list %@ from legacy archive %@ -> %@", buf, 0x2Au);

              v10 = v25;
              self = v24;
              v15 = v23;
              v16 = v36;
            }

            objc_autoreleasePoolPop(v20);
            v27 = v15;
            v28 = v19;
          }

          else
          {
            v27 = v15;
            v28 = v18;
          }

          [v27 addObject:v28];
        }

        v39 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
      }

      while (v39);
    }

    v29 = [v15 copy];
    [v32 setObject:v29 forKey:v37];

    v30 = [v32 copy];
    v8 = v35;
    [v35 setApplicationData:v30 forIdentifier:@"com.apple.homekit-entitledclient.identifer"];

    v14 = v33;
    v12 = v34;
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateMediaPassword:(id)a3
{
  v39 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = [v5 objectForKeyedSubscript:*MEMORY[0x277CD0408]];

  if (!v6)
  {
    goto LABEL_5;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v34 = v16;
      v35 = 2112;
      v36 = v6;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Invalid password: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [v4 responseHandler];

    if (!v17)
    {
      goto LABEL_18;
    }

    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:22];
LABEL_16:
    v30 = [v4 responseHandler];
    (v30)[2](v30, v9, 0);

    goto LABEL_17;
  }

  v32 = 0;
  v7 = [MEMORY[0x277CD1A60] isValidMediaPassword:v6 error:&v32];
  v8 = v32;
  v9 = v8;
  if ((v7 & 1) == 0)
  {
    v25 = objc_autoreleasePoolPush();
    v26 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543874;
      v34 = v28;
      v35 = 2112;
      v36 = v6;
      v37 = 2112;
      v38 = v9;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to validate password, %@, with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v25);
    v29 = [v4 responseHandler];

    if (!v29)
    {
      goto LABEL_17;
    }

    goto LABEL_16;
  }

LABEL_5:
  v10 = [(HMDHome *)self mediaPassword];
  v11 = HMFEqualObjects();

  if (!v11)
  {
    v18 = [HMDHomeMediaSettingsModel alloc];
    v19 = [(HMDHome *)self uuid];
    v20 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:v19];
    v21 = [(HMDHome *)self uuid];
    v9 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:2 uuid:v20 parentUUID:v21];

    [(HMDHomeMediaSettingsModel *)v9 setMediaPassword:v6];
    v22 = [(HMDHome *)self backingStore];
    v23 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v24 = [v22 transaction:@"Update Media Password" options:v23];

    [v24 add:v9 withMessage:v4];
    [v24 run];

    goto LABEL_17;
  }

  v12 = [v4 responseHandler];

  if (v12)
  {
    v9 = [v4 responseHandler];
    (*&v9->super.super._bsoDataVersionOverride)(v9, 0, 0);
LABEL_17:
  }

LABEL_18:

  v31 = *MEMORY[0x277D85DE8];
}

- (void)setMediaPassword:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 copy];
  os_unfair_recursive_lock_lock_with_options();
  mediaPassword = self->_mediaPassword;
  if (HMFEqualObjects())
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    objc_storeStrong(&self->_mediaPassword, v5);
    os_unfair_recursive_lock_unlock();
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543618;
      v16 = v10;
      v17 = 2112;
      v18 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Updated media password to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    workQueue = v8->_workQueue;
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __28__HMDHome_setMediaPassword___block_invoke;
    v13[3] = &unk_27868A750;
    v13[4] = v8;
    v14 = v5;
    dispatch_async(workQueue, v13);
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __28__HMDHome_setMediaPassword___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [*(a1 + 32) accessories];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    do
    {
      v6 = 0;
      do
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * v6);
        if ([v7 conformsToProtocol:&unk_283F00888])
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        if (v9 && [v9 supportsMinimumUserPrivilege])
        {
          [v9 handleUpdatedPassword:*(a1 + 40)];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (id)mediaPassword
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_mediaPassword;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleUpdateMediaPeerToPeerEnabled:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v24 = 0;
  v5 = [v4 BOOLForKey:@"kEnabledKey" keyPresent:&v24];
  if (v24)
  {
    v6 = v5;
    if (v5 != [(HMDHome *)self isMediaPeerToPeerEnabled])
    {
      v7 = [HMDHomeMediaSettingsModel alloc];
      v8 = [(HMDHome *)self uuid];
      v9 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:v8];
      v10 = [(HMDHome *)self uuid];
      v11 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:2 uuid:v9 parentUUID:v10];

      v12 = [MEMORY[0x277CCABB0] numberWithBool:v6];
      [(HMDHomeMediaSettingsModel *)v11 setMediaPeerToPeerEnabled:v12];

      v13 = [(HMDHome *)self backingStore];
      v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v15 = [v13 transaction:@"Update Media Peer-to-peer Enabled" options:v14];

      [v15 add:v11 withMessage:v4];
      [v15 run];

LABEL_10:
      goto LABEL_11;
    }

    v22 = [v4 responseHandler];

    if (v22)
    {
      v11 = [v4 responseHandler];
      (*&v11->super.super._bsoDataVersionOverride)(v11, 0, 0);
      goto LABEL_10;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [v4 responseHandler];

    if (v20)
    {
      v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      v21 = [v4 responseHandler];
      (v21)[2](v21, v11, 0);

      goto LABEL_10;
    }
  }

LABEL_11:

  v23 = *MEMORY[0x277D85DE8];
}

- (void)setMediaPeerToPeerEnabled:(BOOL)a3
{
  v3 = a3;
  v26 = *MEMORY[0x277D85DE8];
  v5 = [(HMDHome *)self featuresDataSource];
  v6 = [v5 isMediaPrivilegeEnabled];

  os_unfair_recursive_lock_lock_with_options();
  if (v6)
  {
    if (self->_mediaPeerToPeerEnabled == v3)
    {
      os_unfair_recursive_lock_unlock();
      v7 = objc_autoreleasePoolPush();
      v8 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        v11 = HMFBooleanToString();
        *buf = 138543618;
        v23 = v10;
        v24 = 2112;
        v25 = v11;
      }

      objc_autoreleasePoolPop(v7);
    }

    else
    {
      self->_mediaPeerToPeerEnabled = v3;
      os_unfair_recursive_lock_unlock();
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        v17 = HMFBooleanToString();
        *buf = 138543618;
        v23 = v16;
        v24 = 2112;
        v25 = v17;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Updated media peer to peer enabled to: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v13);
      workQueue = v14->_workQueue;
      v20[0] = MEMORY[0x277D85DD0];
      v20[1] = 3221225472;
      v20[2] = __37__HMDHome_setMediaPeerToPeerEnabled___block_invoke;
      v20[3] = &unk_278688650;
      v20[4] = v14;
      v21 = v3;
      dispatch_async(workQueue, v20);
    }

    v19 = *MEMORY[0x277D85DE8];
  }

  else
  {
    self->_mediaPeerToPeerEnabled = v3;
    v12 = *MEMORY[0x277D85DE8];

    os_unfair_recursive_lock_unlock();
  }
}

void __37__HMDHome_setMediaPeerToPeerEnabled___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [*(a1 + 32) hapAccessories];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    do
    {
      v6 = 0;
      do
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * v6);
        if ([v7 conformsToProtocol:&unk_283F00918])
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        if (v9 && [v9 supportsMinimumUserPrivilege])
        {
          [v9 handleUpdatedMediaPeerToPeerEnabled:*(a1 + 40)];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)isMediaPeerToPeerEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  mediaPeerToPeerEnabled = self->_mediaPeerToPeerEnabled;
  os_unfair_recursive_lock_unlock();
  return mediaPeerToPeerEnabled;
}

- (void)_handleUpdateMinimumMediaUserPrivilege:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 numberForKey:@"kUserPrivilegeLevelKey"];
  v6 = v5;
  if (v5)
  {
    v7 = [v5 integerValue];
    if ([(HMDHome *)self minimumMediaUserPrivilege]!= v7)
    {
      v16 = [HMDHomeMediaSettingsModel alloc];
      v17 = [(HMDHome *)self uuid];
      v18 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:v17];
      v19 = [(HMDHome *)self uuid];
      v20 = [(HMDBackingStoreModelObject *)v16 initWithObjectChangeType:2 uuid:v18 parentUUID:v19];

      v21 = [MEMORY[0x277CCABB0] numberWithInteger:v7];
      [(HMDHomeMediaSettingsModel *)v20 setMinimumMediaUserPrivilege:v21];

      v22 = [(HMDHome *)self backingStore];
      v23 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v24 = [v22 transaction:@"Update Minimum User Privilege" options:v23];

      [v24 add:v20 withMessage:v4];
      [v24 run];

      goto LABEL_11;
    }

    v8 = [v4 responseHandler];

    if (v8)
    {
      v9 = [v4 responseHandler];
      v9[2](v9, 0, 0);
LABEL_9:
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v26 = 138543362;
      v27 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", &v26, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [v4 responseHandler];

    if (v14)
    {
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      v15 = [v4 responseHandler];
      v15[2](v15, v9, 0);

      goto LABEL_9;
    }
  }

LABEL_11:

  v25 = *MEMORY[0x277D85DE8];
}

- (void)setMinimumMediaUserPrivilege:(int64_t)a3
{
  v22 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (self->_minimumMediaUserPrivilege == a3)
  {
    os_unfair_recursive_lock_unlock();
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = HMUserPrivilegeToString();
      *buf = 138543618;
      v19 = v8;
      v20 = 2112;
      v21 = v9;
    }

    objc_autoreleasePoolPop(v5);
  }

  else
  {
    self->_minimumMediaUserPrivilege = a3;
    os_unfair_recursive_lock_unlock();
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMUserPrivilegeToString();
      *buf = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Updated minimum user privilege to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    workQueue = v11->_workQueue;
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __40__HMDHome_setMinimumMediaUserPrivilege___block_invoke;
    v17[3] = &unk_27868A0D0;
    v17[4] = v11;
    v17[5] = a3;
    dispatch_async(workQueue, v17);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome_setMinimumMediaUserPrivilege___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [*(a1 + 32) accessories];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    do
    {
      v6 = 0;
      do
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * v6);
        if ([v7 conformsToProtocol:&unk_283F00888])
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        if (v9 && [v9 supportsMinimumUserPrivilege])
        {
          [v9 handleUpdatedMinimumUserPrivilege:*(a1 + 40)];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (int64_t)minimumMediaUserPrivilege
{
  os_unfair_recursive_lock_lock_with_options();
  minimumMediaUserPrivilege = self->_minimumMediaUserPrivilege;
  os_unfair_recursive_lock_unlock();
  return minimumMediaUserPrivilege;
}

- (void)queryPrimaryResidentReachabilityForAccessories:(id)a3 completion:(id)a4
{
  v49 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident];
  v9 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
  if (v8)
  {
    v32 = v7;
    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v10 = v6;
    v11 = [v10 countByEnumeratingWithState:&v39 objects:v48 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v40;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v40 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v39 + 1) + 8 * i);
          v46 = @"kAccessoryIsReachableKey";
          v16 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v15, "isReachable", v32)}];
          v47 = v16;
          v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v47 forKeys:&v46 count:1];

          [v9 addObject:v17];
        }

        v12 = [v10 countByEnumeratingWithState:&v39 objects:v48 count:16];
      }

      while (v12);
    }

    v7 = v32;
    v32[2](v32, v9);
  }

  else
  {
    v37 = 0u;
    v38 = 0u;
    v35 = 0u;
    v36 = 0u;
    v18 = v6;
    v19 = [v18 countByEnumeratingWithState:&v35 objects:v45 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v36;
      do
      {
        for (j = 0; j != v20; ++j)
        {
          if (*v36 != v21)
          {
            objc_enumerationMutation(v18);
          }

          v23 = [*(*(&v35 + 1) + 8 * j) uuid];
          v24 = [v23 UUIDString];
          [v9 addObject:v24];
        }

        v20 = [v18 countByEnumeratingWithState:&v35 objects:v45 count:16];
      }

      while (v20);
    }

    v43 = @"kAccessoriesUUIDKey";
    v44 = v9;
    v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v44 forKeys:&v43 count:1];
    v26 = MEMORY[0x277D0F818];
    v27 = [MEMORY[0x277CCAD78] UUID];
    v28 = [v26 messageWithName:@"HMDHomeQueryResidentReachabilityForAccessoriesMessageKey" identifier:v27 messagePayload:v25];

    v33[0] = MEMORY[0x277D85DD0];
    v33[1] = 3221225472;
    v33[2] = __69__HMDHome_queryPrimaryResidentReachabilityForAccessories_completion___block_invoke;
    v33[3] = &unk_278685AF8;
    v33[4] = self;
    v34 = v7;
    [v28 setResponseHandler:v33];
    v29 = [(HMDHome *)self uuid];
    v30 = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v28 target:v29 responseQueue:v30];
  }

  v31 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome_queryPrimaryResidentReachabilityForAccessories_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (v5)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v11;
      v18 = 2112;
      v19 = v5;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Query reachability response error: %@", &v16, 0x16u);
    }

    v12 = 0;
LABEL_5:

    objc_autoreleasePoolPop(v8);
    goto LABEL_6;
  }

  v14 = [v6 hmf_arrayForKey:@"kAccessoriesInfoDictionaryKey"];
  v12 = v14;
  if (!v14 || ![v14 count])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v15;
      v18 = 2112;
      v19 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@No reachability setting in query reachability response: %@", &v16, 0x16u);
    }

    goto LABEL_5;
  }

LABEL_6:
  (*(*(a1 + 40) + 16))();

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleQueryResidentReachabilityForAccessories:(id)a3
{
  v39 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = [v5 hmf_arrayForKey:@"kAccessoriesUUIDKey"];
  v7 = v6;
  if (v6)
  {
    v26 = v4;
    v8 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    v25 = v7;
    obj = v7;
    v9 = [obj countByEnumeratingWithState:&v28 objects:v36 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v29;
      v12 = *MEMORY[0x277CCF0B0];
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v29 != v11)
          {
            objc_enumerationMutation(obj);
          }

          v14 = *(*(&v28 + 1) + 8 * i);
          v15 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v14];
          v16 = [(HMDHome *)self accessoryWithUUID:v15];

          if (v16)
          {
            v34[0] = v12;
            v34[1] = @"kAccessoryIsReachableKey";
            v35[0] = v14;
            v17 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v16, "isReachable")}];
            v35[1] = v17;
            v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:2];

            [v8 addObject:v18];
          }
        }

        v10 = [obj countByEnumeratingWithState:&v28 objects:v36 count:16];
      }

      while (v10);
    }

    v32 = @"kAccessoriesInfoDictionaryKey";
    v33 = v8;
    v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v33 forKeys:&v32 count:1];
    v4 = v26;
    [v26 respondWithPayload:v19];

    v7 = v25;
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v38 = v23;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Query reachability request is missing accessory UUID in payload", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v8 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
    [v4 respondWithError:v8];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v24 = 0;
  v5 = [v4 BOOLForKey:@"kEnabledKey" keyPresent:&v24];
  if (v24)
  {
    v6 = v5;
    if (v5 != [(HMDHome *)self isAutomaticThirdPartyAccessorySoftwareUpdateEnabled])
    {
      v7 = [HMDHomeSettingsModel alloc];
      v8 = [(HMDHome *)self uuid];
      v9 = [HMDHomeSettingsModel modelIDForHomeUUID:v8];
      v10 = [(HMDHome *)self uuid];
      v11 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:2 uuid:v9 parentUUID:v10];

      v12 = [MEMORY[0x277CCABB0] numberWithBool:v6];
      [(HMDHomeSettingsModel *)v11 setAutomaticThirdPartyAccessorySoftwareUpdateEnabled:v12];

      v13 = [(HMDHome *)self backingStore];
      v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v15 = [v13 transaction:@"Update Automatic Accessory Firmware Update" options:v14];

      [v15 add:v11 withMessage:v4];
      [v15 run];

LABEL_10:
      goto LABEL_11;
    }

    v22 = [v4 responseHandler];

    if (v22)
    {
      v11 = [v4 responseHandler];
      (*&v11->super.super._bsoDataVersionOverride)(v11, 0, 0);
      goto LABEL_10;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [v4 responseHandler];

    if (v20)
    {
      v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      v21 = [v4 responseHandler];
      (v21)[2](v21, v11, 0);

      goto LABEL_10;
    }
  }

LABEL_11:

  v23 = *MEMORY[0x277D85DE8];
}

- (BOOL)isAutomaticThirdPartyAccessorySoftwareUpdateEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  automaticThirdPartyAccessorySoftwareUpdateEnabled = self->_automaticThirdPartyAccessorySoftwareUpdateEnabled;
  os_unfair_recursive_lock_unlock();
  return automaticThirdPartyAccessorySoftwareUpdateEnabled;
}

- (void)_handleUpdateAutomaticSoftwareUpdate:(id)a3
{
  v44 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v41 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling update automatic software update message", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v39 = 0;
  v9 = [v4 BOOLForKey:@"kEnabledKey" keyPresent:&v39];
  if (v39)
  {
    v10 = v9;
    v11 = [(HMDHome *)v6 isAutomaticSoftwareUpdateEnabled];
    v12 = objc_autoreleasePoolPush();
    v13 = v6;
    v14 = HMFGetOSLogHandle();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_INFO);
    if (v10 != v11)
    {
      if (v15)
      {
        v16 = HMFGetLogIdentifier();
        v17 = HMFBooleanToString();
        *buf = 138543618;
        v41 = v16;
        v42 = 2112;
        v43 = v17;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Updating automatic software update to: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v12);
      v18 = [HMDSoftwareUpdateAutomaticUpdateToggledEvent eventWithAutomaticUpdateEnabled:v10];
      v19 = [(HMDHome *)v13 logEventSubmitter];
      [v19 submitLogEvent:v18];

      v20 = [HMDHomeSettingsModel alloc];
      v21 = [(HMDHome *)v13 uuid];
      v22 = [HMDHomeSettingsModel modelIDForHomeUUID:v21];
      v23 = [(HMDHome *)v13 uuid];
      v24 = [(HMDBackingStoreModelObject *)v20 initWithObjectChangeType:2 uuid:v22 parentUUID:v23];

      v25 = [MEMORY[0x277CCABB0] numberWithBool:v10];
      [(HMDHomeSettingsModel *)v24 setAutomaticSoftwareUpdateEnabled:v25];

      v26 = [(HMDHome *)v13 backingStore];
      v27 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v28 = [v26 transaction:@"Update Automatic Software Update" options:v27];

      [v28 add:v24 withMessage:v4];
      [v28 run];

      goto LABEL_16;
    }

    if (v15)
    {
      v35 = HMFGetLogIdentifier();
      v36 = HMFBooleanToString();
      *buf = 138543618;
      v41 = v35;
      v42 = 2112;
      v43 = v36;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Not changing the setting because it is already set to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v37 = [v4 responseHandler];

    if (v37)
    {
      v18 = [v4 responseHandler];
      v18[2](v18, 0, 0);
      goto LABEL_16;
    }
  }

  else
  {
    v29 = objc_autoreleasePoolPush();
    v30 = v6;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v32;
      _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v29);
    v33 = [v4 responseHandler];

    if (v33)
    {
      v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      v34 = [v4 responseHandler];
      v34[2](v34, v18, 0);

LABEL_16:
    }
  }

  v38 = *MEMORY[0x277D85DE8];
}

- (void)setAutomaticSoftwareUpdateEnabled:(BOOL)a3
{
  v3 = a3;
  v17 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (self->_automaticSoftwareUpdateEnabled == v3)
  {
    v5 = *MEMORY[0x277D85DE8];

    os_unfair_recursive_lock_unlock();
  }

  else
  {
    self->_automaticSoftwareUpdateEnabled = v3;
    os_unfair_recursive_lock_unlock();
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = HMFGetLogIdentifier();
      v10 = v9;
      v11 = @"disabled";
      if (v3)
      {
        v11 = @"enabled";
      }

      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Automatic software updates %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    [(HMDHome *)v7 _reevaluateAccessoryInfoWithBadgeRefresh:1];
    v12 = *MEMORY[0x277D85DE8];
  }
}

- (BOOL)isAutomaticSoftwareUpdateEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  automaticSoftwareUpdateEnabled = self->_automaticSoftwareUpdateEnabled;
  os_unfair_recursive_lock_unlock();
  return automaticSoftwareUpdateEnabled;
}

- (void)_handleHomeLocationUpdateFromSharedAdmin:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dataForKey:@"kHomeLocationDataKey"];
  if (v5)
  {
    v25 = 0;
    v6 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v5 error:&v25];
    v7 = v25;
    if (!v6)
    {
      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543618;
        v27 = v21;
        v28 = 2112;
        v29 = v7;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive location from data: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
      goto LABEL_13;
    }

    v8 = [v4 numberForKey:@"HMD.LOC.SRC"];
    v9 = [v8 intValue];

    v10 = isInternalBuild();
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_INFO);
    if (v10)
    {
      if (v14)
      {
        v15 = HMFGetLogIdentifier();
        v16 = HMDHomeLocationSourceToString(v9);
        *buf = 138543874;
        v27 = v15;
        v28 = 2112;
        v29 = v6;
        v30 = 2112;
        v31 = v16;
        v17 = "%{public}@Received new home location from shared admin: %@, source : %@";
LABEL_11:
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, v17, buf, 0x20u);
      }
    }

    else if (v14)
    {
      v15 = HMFGetLogIdentifier();
      v16 = HMDHomeLocationSourceToString(v9);
      *buf = 138543875;
      v27 = v15;
      v28 = 2117;
      v29 = v6;
      v30 = 2112;
      v31 = v16;
      v17 = "%{public}@Received new home location from shared admin: %{sensitive}@, source : %@";
      goto LABEL_11;
    }

    objc_autoreleasePoolPop(v11);
    v22 = [(HMDHome *)v12 homeLocationHandler];
    v23 = [MEMORY[0x277CBEAA8] date];
    [v22 runTransactionWithLocation:v6 updatedTime:v23 source:v9];

LABEL_13:
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_updateHomeLocation
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self homeLocationHandler];
  if (![v3 regionStateAtHome])
  {

    goto LABEL_8;
  }

  v4 = [(HMDHome *)self homeLocationHandler];
  v5 = [v4 regionStateNearbyHome];

  if (!v5)
  {
LABEL_8:
    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v31 = v23;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@No reachable accessories found and not all regions are determined. Setting Home location to unknown & home level to Not at Home.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v19 = 0;
    v18 = 0;
    goto LABEL_11;
  }

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    HMFGetLogIdentifier();
    v9 = v29 = v6;
    v10 = [(HMDHome *)v7 homeLocationHandler];
    [v10 regionStateAtHome];
    v11 = HMRegionStateString();
    v12 = [(HMDHome *)v7 homeLocationHandler];
    [v12 regionStateNearbyHome];
    v13 = HMRegionStateString();
    v14 = [(HMDHome *)v7 reachableAccessoriesCount];
    v15 = HMFBooleanToString();
    *buf = 138544386;
    v31 = v9;
    v32 = 2112;
    v33 = v11;
    v34 = 2112;
    v35 = v13;
    v36 = 2048;
    v37 = v14;
    v38 = 2112;
    v39 = v15;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@RegionStateAtHome : %@, RegionStateNearbyHome : %@, reachableAccessoriesCount : %lu/%@", buf, 0x34u);

    v6 = v29;
  }

  objc_autoreleasePoolPop(v6);
  v16 = [(HMDHome *)v7 homeLocationHandler];
  v17 = [v16 regionStateAtHome];

  if (v17 == 1)
  {
    v18 = 2;
    v19 = 1;
  }

  else
  {
    v25 = [(HMDHome *)v7 homeLocationHandler];
    v26 = [v25 regionStateNearbyHome];

    if (v26 == 1)
    {
      v18 = 1;
      v19 = 3;
    }

    else
    {
      v27 = [(HMDHome *)v7 homeLocationHandler];
      v28 = [v27 regionStateNearbyHome];

      if (v28 != 2)
      {
        v18 = 0;
        goto LABEL_12;
      }

      v18 = 1;
      v19 = 2;
    }
  }

LABEL_11:
  [(HMDHome *)self setHomeLocation:v19];
LABEL_12:
  [(HMDHome *)self setAtHomeLevel:v18];
  v24 = *MEMORY[0x277D85DE8];
}

- (void)updateHomeLocation
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_updateHomeLocation__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)matterAccessoryBecameReachable
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __41__HMDHome_matterAccessoryBecameReachable__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

void __41__HMDHome_matterAccessoryBecameReachable__block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) homeLocationHandler];
  [v1 matterAccessoryBecameReachable];
}

- (void)updateHomeLocationForPairing
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __39__HMDHome_updateHomeLocationForPairing__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

void __39__HMDHome_updateHomeLocationForPairing__block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) homeLocationHandler];
  [v1 updateHomeLocationForPairing];
}

- (void)setHomeLocation:(int64_t)a3
{
  v23 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  v5 = 0;
  homeLocation = self->_homeLocation;
  if (homeLocation != a3)
  {
    self->_homeLocation = a3;
    v5 = !self->_overrideHomeLocation;
  }

  os_unfair_recursive_lock_unlock();
  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    if (v5)
    {
      v11 = @"Updated";
    }

    else
    {
      v11 = @"Did not update";
    }

    v12 = HMStringFromHomeLocation();
    v13 = HMStringFromHomeLocation();
    v15 = 138544130;
    v16 = v10;
    v17 = 2112;
    v18 = v11;
    v19 = 2112;
    v20 = v12;
    v21 = 2112;
    v22 = v13;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ home location from %@ to %@", &v15, 0x2Au);
  }

  objc_autoreleasePoolPop(v7);
  if (v5)
  {
    [(HMDHome *)v8 _handleHomeLocationChange:a3 previousLocation:homeLocation];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeLocationChange:(int64_t)a3 previousLocation:(int64_t)a4
{
  v41[1] = *MEMORY[0x277D85DE8];
  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [(HMDHome *)v8 name];
    v12 = [(HMDHome *)v8 shortDescription];
    v13 = HMStringFromHomeLocation();
    v14 = HMStringFromHomeLocation();
    *buf = 138544386;
    *&buf[4] = v10;
    v33 = 2112;
    v34 = v11;
    v35 = 2112;
    v36 = v12;
    v37 = 2112;
    v38 = v13;
    v39 = 2112;
    v40 = v14;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Location status for home %@/%@ changing from %@ to %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v7);
  v15 = [(HMDHome *)v8 notificationCenter];
  [v15 postNotificationName:@"HMDHomeLocationChangedNotification" object:v8];

  v16 = [(HMDHome *)v8 homeManager];
  v17 = [(HMDHome *)v8 uuid];
  [v16 updateGenerationCounterWithReason:@"HomeLocationChanged" sourceUUID:v17 shouldNotifyClients:0];

  v18 = MEMORY[0x277D0F818];
  v19 = *MEMORY[0x277CD0058];
  v20 = v8;
  v21 = [(HMDHome *)v20 uuid];
  v41[0] = *MEMORY[0x277CD0068];
  v22 = [MEMORY[0x277CCABB0] numberWithInteger:a3];
  *buf = v22;
  v23 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:buf forKeys:v41 count:1];
  v24 = [v18 homeLocationAuthorizedAndEntitledMessageWithName:v19 target:v21 messagePayload:v23];

  v25 = [(HMDHome *)v20 msgDispatcher];

  [v25 sendMessage:v24 completionHandler:0];
  if (a3 == 1)
  {
    v26 = [(HMDHome *)v20 workQueue];
    v27 = v26;
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke;
    v31[3] = &unk_27868A728;
    v31[4] = v20;
    v28 = v31;
LABEL_10:
    dispatch_async(v26, v28);

    goto LABEL_11;
  }

  if (a3 == 3 && a4 != 2 || a3 == 2 && a4 != 3)
  {
    v26 = [(HMDHome *)v20 workQueue];
    v27 = v26;
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke_1939;
    v30[3] = &unk_27868A728;
    v30[4] = v20;
    v28 = v30;
    goto LABEL_10;
  }

LABEL_11:
  v29 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Did arrive home", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeDidArriveHomeNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke_1939(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Did leave home", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeDidLeaveHomeNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

- (int64_t)homeLocation
{
  os_unfair_recursive_lock_lock_with_options();
  if (self->_overrideHomeLocation)
  {
    v3 = &OBJC_IVAR___HMDHome__overriddenHomeLocation;
  }

  else
  {
    v3 = &OBJC_IVAR___HMDHome__homeLocation;
  }

  v4 = *(&self->super.super.isa + *v3);
  os_unfair_recursive_lock_unlock();
  return v4;
}

- (void)setAtHomeLevel:(int64_t)a3
{
  v26 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  atHomeLevel = self->_atHomeLevel;
  if (atHomeLevel != a3)
  {
    self->_atHomeLevel = a3;
  }

  os_unfair_recursive_lock_unlock();
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = v9;
    v11 = @"Updated";
    if (atHomeLevel == a3)
    {
      v11 = @"Did not update";
    }

    if (atHomeLevel > 3)
    {
      v12 = @"HMDAtHomeLevelNotAtHome";
    }

    else
    {
      v12 = off_278670AF0[atHomeLevel];
    }

    if (a3 > 3)
    {
      v13 = @"HMDAtHomeLevelNotAtHome";
    }

    else
    {
      v13 = off_278670AF0[a3];
    }

    v18 = 138544130;
    v19 = v9;
    v20 = 2112;
    v21 = v11;
    v22 = 2112;
    v23 = v12;
    v24 = 2112;
    v25 = v13;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@%@ atHomeLevel from %@ to %@", &v18, 0x2Au);
  }

  objc_autoreleasePoolPop(v6);
  if (atHomeLevel != a3)
  {
    v14 = [(HMDHome *)v7 residentDeviceManager];
    [v14 atHomeLevelChanged:a3];

    v15 = [(HMDHome *)v7 homeManager];
    v16 = [(HMDHome *)v7 uuid];
    [v15 atHomeLevelChanged:a3 formerLevel:atHomeLevel home:v16];
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (int64_t)atHomeLevel
{
  os_unfair_recursive_lock_lock_with_options();
  atHomeLevel = self->_atHomeLevel;
  os_unfair_recursive_lock_unlock();
  return atHomeLevel;
}

- (BOOL)enabledResidentsSupportsHomeHub
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 availableResidentDevices];
  v4 = [v3 na_any:&__block_literal_global_1929];

  return v4;
}

uint64_t __42__HMDHome_enabledResidentsSupportsHomeHub__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 capabilities];
  v3 = [v2 supportsHomeHub];

  return v3;
}

- (BOOL)currentDeviceSupportsSidekickSettings
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 capabilitiesController];
  v4 = [v3 currentResidentCapabilities];
  v5 = [v4 supportsSiriEndpointSetup];

  return v5;
}

- (BOOL)supportsSiriEndpointOnBoarding
{
  v34 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self primaryResident];
  v4 = [v3 capabilities];
  v5 = [v4 supportsSiriEndpointSetup];

  if (v5)
  {
    v6 = [MEMORY[0x277CBEB18] array];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    v7 = [(HMDHome *)self appleMediaAccessories];
    v8 = [v7 countByEnumeratingWithState:&v28 objects:v33 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v29;
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v29 != v10)
          {
            objc_enumerationMutation(v7);
          }

          v12 = [*(*(&v28 + 1) + 8 * i) device];
          if (v12)
          {
            [v6 addObject:v12];
          }
        }

        v9 = [v7 countByEnumeratingWithState:&v28 objects:v33 count:16];
      }

      while (v9);
    }

    v26 = 0u;
    v27 = 0u;
    v24 = 0u;
    v25 = 0u;
    v13 = [(HMDHome *)self residentDeviceManager];
    v14 = [v13 residentDevices];

    v15 = [v14 countByEnumeratingWithState:&v24 objects:v32 count:16];
    if (v15)
    {
      v16 = *v25;
      do
      {
        for (j = 0; j != v15; ++j)
        {
          if (*v25 != v16)
          {
            objc_enumerationMutation(v14);
          }

          v18 = *(*(&v24 + 1) + 8 * j);
          v19 = [v18 device];
          v20 = [v18 capabilities];
          if ([v20 supportsHomeHub])
          {
            v21 = [v6 containsObject:v19];

            if (v21)
            {

              LOBYTE(v15) = 1;
              goto LABEL_24;
            }
          }

          else
          {
          }
        }

        v15 = [v14 countByEnumeratingWithState:&v24 objects:v32 count:16];
      }

      while (v15);
    }

LABEL_24:
  }

  else
  {
    LOBYTE(v15) = 0;
  }

  v22 = *MEMORY[0x277D85DE8];
  return v15;
}

- (void)handleSiriEndPointAddedNotification:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (!v7)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v12;
      v23 = 2112;
      v24 = v4;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Unable to synchronize settings after receiving endpoint added notification with no HAP accessory. %@", &v21, 0x16u);
      goto LABEL_10;
    }

LABEL_11:

    objc_autoreleasePoolPop(v9);
    goto LABEL_12;
  }

  v8 = [v7 home];

  if (v8 != self)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v7 home];
      v21 = 138543874;
      v22 = v12;
      v23 = 2112;
      v24 = v7;
      v25 = 2112;
      v26 = v13;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@New accessory is added for another home for HAP accessory: %@ home:%@", &v21, 0x20u);

LABEL_10:
      goto LABEL_11;
    }

    goto LABEL_11;
  }

  v15 = [v7 siriEndpointProfile];

  if (v15)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      v19 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v19;
      v23 = 2112;
      v24 = v7;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEFAULT, "%{public}@A siri endpoint accessory is added. Confirm resident device: %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [(HMDHome *)v17 residentDeviceManager];
    [v20 confirmWithCompletionHandler:0];
  }

LABEL_12:

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleEnableNotifications:(id)a3
{
  v51 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v44 = 0;
  v6 = [v4 BOOLForKey:*MEMORY[0x277CD2158] keyPresent:&v44];
  v43 = 0;
  v7 = [v4 BOOLForKey:*MEMORY[0x277CCFED8] keyPresent:&v43];
  if (v44 == 1 && (v43 & 1) != 0)
  {
    v8 = v7;
    v9 = [v4 clientIdentifier];
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    v13 = v12;
    if (v9)
    {
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v15 = HMFBooleanToString();
        *buf = 138543874;
        v46 = v14;
        v47 = 2112;
        v48 = v9;
        v49 = 2112;
        v50 = v15;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Handling Enable Notifications from ClientIdentifier: %@, setting: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v10);
      if (v6)
      {
        [(HMDHome *)v11 removeNotificationDeregistrationForClientIdentifier:v9];
        v16 = [(HMDHome *)v11 notificationRegistrations];
        v17 = [v16 count];

        v18 = [(HMDHome *)v11 notificationRegistrationsForAppleMediaAccessories];
        v19 = ([v18 count] == 0) & v8;

        [(HMDHome *)v11 addNotificationRegistrationForClientIdentifier:v9 includesAppleMediaAccessories:v8];
        if (v19 == 1)
        {
          v20 = objc_autoreleasePoolPush();
          v21 = v11;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
          {
            v23 = HMFGetLogIdentifier();
            *buf = 138543362;
            v46 = v23;
            _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Modifying direct Apple Media notification registrations with resident due to HomeKit client request", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v20);
          v24 = [(HMDHome *)v21 mediaStateSubscriber];
          [v24 subscribeForAppleMediaStateWithSubscriptionToken:@"HMDHomeClientMediaStateRegistrationToken"];
        }

        if (!v17)
        {
          v25 = objc_autoreleasePoolPush();
          v26 = v11;
          v27 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
          {
            v28 = HMFGetLogIdentifier();
            *buf = 138543362;
            v46 = v28;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to HomeKit client request", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v25);
          [(HMDHome *)v26 _subscribeForHomeNotificationsFromRemoteGateway:1];
          [(HMDHome *)v26 _subscribeForHomeNotificationsOnDirectTransports:?];
          v29 = [MEMORY[0x277CBEAA8] date];
          [(HMDHome *)v26 setNotificationsUpdatedTime:v29];
        }

        v30 = [(HMDHome *)v11 homeManager];
        v31 = [v30 chipDataSource];
        [v31 updateNotificationsEnabled:1 forHome:v11 keepAliveOnly:0];

        logAndPostNotification(@"HMDHomeDidEnableCharacteristicNotifyEventNotification", v11, 0);
        [(HMDHome *)v11 _refreshCharacteristicValuesOnHomeNotificationEnable];
      }

      else
      {
        [(HMDHome *)v11 addNotificationDeregistrationForClientIdentifier:v9];
        [(HMDHome *)v11 _startHomeNotificationDeregistrationTimer];
      }

      v42 = [MEMORY[0x277D0F8C0] sharedPowerLogger];
      [v42 reportCharacteristicNotificationRegistrationEvent:v6 clientIdentifier:v9];

      [v4 respondWithSuccess];
    }

    else
    {
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v39 = HMFGetLogIdentifier();
        *buf = 138543362;
        v46 = v39;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Unable to look up the client identifier from request to enable home notifications", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v10);
      v9 = [v4 responseHandler];

      if (v9)
      {
        v40 = [v4 responseHandler];
        v41 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
        (v40)[2](v40, v41, 0);

        v9 = 0;
      }
    }
  }

  else
  {
    v32 = objc_autoreleasePoolPush();
    v33 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      v36 = HMFBooleanToString();
      v37 = HMFBooleanToString();
      *buf = 138543874;
      v46 = v35;
      v47 = 2112;
      v48 = v36;
      v49 = 2112;
      v50 = v37;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key (hasHAPKey: %@, hasAppleMediaKey: %@) to enable home notifications", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v32);
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [v4 respondWithError:v9];
  }

  v38 = *MEMORY[0x277D85DE8];
}

- (void)_refreshCharacteristicValuesOnHomeNotificationEnable
{
  v78 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  v4 = [MEMORY[0x277CBEB58] set];
  v65 = 0u;
  v66 = 0u;
  v67 = 0u;
  v68 = 0u;
  v48 = self;
  obj = [(HMDHome *)self accessories];
  v49 = [obj countByEnumeratingWithState:&v65 objects:v77 count:16];
  if (v49)
  {
    v47 = *v66;
    p_info = &OBJC_METACLASS___HMDHAPAccessoryPrimaryResidentWriteTask.info;
    do
    {
      v6 = 0;
      do
      {
        if (*v66 != v47)
        {
          objc_enumerationMutation(obj);
        }

        v51 = v6;
        v7 = *(*(&v65 + 1) + 8 * v6);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        v64[0] = MEMORY[0x277D85DD0];
        v64[1] = 3221225472;
        v64[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke;
        v64[3] = &unk_278687EB0;
        v64[4] = v48;
        v10 = [v9 characteristicsPassingTest:v64];
        v60 = 0u;
        v61 = 0u;
        v62 = 0u;
        v63 = 0u;
        v11 = [v10 countByEnumeratingWithState:&v60 objects:v76 count:16];
        if (v11)
        {
          v12 = v11;
          v13 = *v61;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v61 != v13)
              {
                objc_enumerationMutation(v10);
              }

              v15 = [p_info + 476 requestWithCharacteristic:*(*(&v60 + 1) + 8 * i)];
              [v3 addObject:v15];
            }

            v12 = [v10 countByEnumeratingWithState:&v60 objects:v76 count:16];
          }

          while (v12);
        }

        v58 = 0u;
        v59 = 0u;
        v56 = 0u;
        v57 = 0u;
        v50 = v9;
        v16 = [v9 lightProfiles];
        v17 = [v16 allObjects];

        v18 = [v17 countByEnumeratingWithState:&v56 objects:v75 count:16];
        if (v18)
        {
          v19 = v18;
          v20 = *v57;
          do
          {
            for (j = 0; j != v19; ++j)
            {
              if (*v57 != v20)
              {
                objc_enumerationMutation(v17);
              }

              v22 = *(*(&v56 + 1) + 8 * j);
              if (![v22 supportsCHIP] || (_os_feature_enabled_impl() & 1) == 0)
              {
                v23 = [v22 readCharacteristicRequests];
                if ([v23 count])
                {
                  [v23 allObjects];
                  v25 = v24 = v4;
                  [v3 addObjectsFromArray:v25];

                  v4 = v24;
                  [v24 addObject:v22];
                }
              }
            }

            v19 = [v17 countByEnumeratingWithState:&v56 objects:v75 count:16];
          }

          while (v19);
        }

        v6 = v51 + 1;
        p_info = (&OBJC_METACLASS___HMDHAPAccessoryPrimaryResidentWriteTask + 32);
      }

      while (v51 + 1 != v49);
      v49 = [obj countByEnumeratingWithState:&v65 objects:v77 count:16];
    }

    while (v49);
  }

  v26 = [v3 hmf_isEmpty];
  v27 = objc_autoreleasePoolPush();
  v28 = v48;
  v29 = HMFGetOSLogHandle();
  v30 = os_log_type_enabled(v29, OS_LOG_TYPE_INFO);
  if (v26)
  {
    if (v30)
    {
      v31 = HMFGetLogIdentifier();
      *buf = 138543362;
      v72 = v31;
      _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Not refreshing characteristics as read requests are empty", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v27);
  }

  else
  {
    if (v30)
    {
      v32 = HMFGetLogIdentifier();
      v33 = [v3 count];
      *buf = 138543618;
      v72 = v32;
      v73 = 2048;
      v74 = v33;
      _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Issuing %ld characteristic read requests when Home app enabled notifications", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v27);
    v34 = MEMORY[0x277D0F818];
    v35 = [MEMORY[0x277D0F820] allMessageDestinations];
    v69 = @"kMultiPartResponseKey";
    v70 = MEMORY[0x277CBEC38];
    v36 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v70 forKeys:&v69 count:1];
    v37 = [v34 messageWithName:@"kMultipleCharacteristicReadRequestKey" destination:v35 payload:v36];

    v38 = objc_autoreleasePoolPush();
    v39 = v28;
    v40 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
    {
      v41 = HMFGetLogIdentifier();
      [v37 identifier];
      v43 = v42 = v4;
      *buf = 138543618;
      v72 = v41;
      v73 = 2114;
      v74 = v43;
      _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: App enabled notifications", buf, 0x16u);

      v4 = v42;
    }

    objc_autoreleasePoolPop(v38);
    v44 = [v3 copy];
    v52[0] = MEMORY[0x277D85DD0];
    v52[1] = 3221225472;
    v52[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1925;
    v52[3] = &unk_278686658;
    v53 = v3;
    v54 = v39;
    v55 = v4;
    [(HMDHome *)v39 _readCharacteristicValues:v44 requestMessage:v37 source:1120 withCompletionHandler:v52];
  }

  v45 = *MEMORY[0x277D85DE8];
}

uint64_t __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 type];
  v5 = [v3 service];

  v6 = [v5 type];

  v7 = [*(a1 + 32) dataSource];
  v8 = [v7 hapMetadata];
  v9 = [v8 shouldRefreshValueForCharacteristicWithType:v4 serviceType:v6];

  return v9;
}

void __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1925(uint64_t a1, void *a2, void *a3)
{
  v59 = *MEMORY[0x277D85DE8];
  v36 = a2;
  v37 = a3;
  v47 = 0u;
  v48 = 0u;
  v49 = 0u;
  v50 = 0u;
  v5 = a1;
  obj = *(a1 + 32);
  v6 = [obj countByEnumeratingWithState:&v47 objects:v58 count:16];
  if (v6)
  {
    v8 = v6;
    v9 = *v48;
    *&v7 = 138543874;
    v33 = v7;
    v34 = *v48;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v48 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v47 + 1) + 8 * i);
        v12 = [v11 characteristic];
        v46 = 0;
        v13 = [v37 hmd_valueOfCharacteristic:v12 error:&v46];
        v14 = v46;

        v15 = objc_autoreleasePoolPush();
        v16 = *(v5 + 40);
        v17 = HMFGetOSLogHandle();
        v18 = v17;
        if (v13)
        {
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
            goto LABEL_12;
          }

          v19 = HMFGetLogIdentifier();
          *buf = v33;
          v53 = v19;
          v54 = 2112;
          v55 = v11;
          v56 = 2112;
          v57 = v13;
          v20 = v18;
          v21 = OS_LOG_TYPE_INFO;
          v22 = "%{public}@Characteristic read request succeeded when Home app enabled notifications %@:%@";
        }

        else
        {
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_12;
          }

          v19 = HMFGetLogIdentifier();
          *buf = v33;
          v53 = v19;
          v54 = 2112;
          v55 = v11;
          v56 = 2112;
          v57 = v14;
          v20 = v18;
          v21 = OS_LOG_TYPE_ERROR;
          v22 = "%{public}@Characteristic read request when Home app enabled notification failed %@:%@";
        }

        _os_log_impl(&dword_229538000, v20, v21, v22, buf, 0x20u);

        v9 = v34;
LABEL_12:

        objc_autoreleasePoolPop(v15);
      }

      v8 = [obj countByEnumeratingWithState:&v47 objects:v58 count:16];
    }

    while (v8);
  }

  v44 = 0u;
  v45 = 0u;
  v42 = 0u;
  v43 = 0u;
  v23 = *(v5 + 48);
  v24 = [v23 countByEnumeratingWithState:&v42 objects:v51 count:16];
  if (v24)
  {
    v25 = v24;
    v26 = *v43;
    do
    {
      for (j = 0; j != v25; ++j)
      {
        if (*v43 != v26)
        {
          objc_enumerationMutation(v23);
        }

        v28 = *(*(&v42 + 1) + 8 * j);
        v29 = [v28 workQueue];
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1926;
        block[3] = &unk_2786891E0;
        block[4] = v28;
        v30 = v37;
        v31 = *(v5 + 40);
        v39 = v30;
        v40 = v31;
        v41 = v36;
        dispatch_async(v29, block);
      }

      v25 = [v23 countByEnumeratingWithState:&v42 objects:v51 count:16];
    }

    while (v25);
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1926(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v18 = 0;
  v4 = [v2 updateSettingsWithReadCharacteristicResponsePayload:v3 error:&v18];
  v5 = v18;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 48);
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v4)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 32);
      *buf = 138543874;
      v20 = v10;
      v21 = 2112;
      v22 = v11;
      v23 = 2112;
      v24 = v4;
      v12 = "%{public}@Successfully updated light profile settings %@:%@";
      v13 = v9;
      v14 = OS_LOG_TYPE_INFO;
LABEL_6:
      _os_log_impl(&dword_229538000, v13, v14, v12, buf, 0x20u);
    }
  }

  else if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v15 = *(a1 + 32);
    v16 = *(a1 + 56);
    *buf = 138543874;
    v20 = v10;
    v21 = 2112;
    v22 = v15;
    v23 = 2112;
    v24 = v16;
    v12 = "%{public}@Failed to update light profile settings %@:%@";
    v13 = v9;
    v14 = OS_LOG_TYPE_ERROR;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v6);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForWalletKeyChange:(id)a3 message:(id)a4
{
  v17 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543362;
    v16 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has onboarded for wallet key value changed, sending notification", &v15, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [v6 hasOnboardedForWalletKey];
  -[HMDHome setHasOnboardedForWalletKey:](v9, "setHasOnboardedForWalletKey:", [v12 BOOLValue]);

  v13 = [(HMDHome *)v9 notificationCenter];
  [v13 postNotificationName:@"HMDHomeHasOnboardedForWalletKeyChangeNotification" object:v9];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForAccessCodeChange:(id)a3 message:(id)a4
{
  v17 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543362;
    v16 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has onboarded for access code value changed, sending notification", &v15, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [v6 hasOnboardedForAccessCode];
  -[HMDHome setHasOnboardedForAccessCode:](v9, "setHasOnboardedForAccessCode:", [v12 BOOLValue]);

  v13 = [(HMDHome *)v9 notificationCenter];
  [v13 postNotificationName:@"HMDHomeHasOnboardedForAccessCodeChangeNotification" object:v9];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:(id)a3 message:(id)a4
{
  v16 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v14 = 138543362;
    v15 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has any user acknowledged camera recording onboarding value changed, sending notification", &v14, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [v6 hasAnyUserAcknowledgedCameraRecordingOnboarding];
  -[HMDHome setHasAnyUserAcknowledgedCameraRecordingOnboarding:](v9, "setHasAnyUserAcknowledgedCameraRecordingOnboarding:", [v12 BOOLValue]);

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleResolveThreadNetworkRequest:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v21 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve thread network credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = +[HMDThreadNetworkMetadataStore defaultStore];
  if (v9)
  {
    v10 = [(HMDHome *)v6 threadOperationalDataset];
    objc_initWeak(buf, v6);
    v11 = [(HMDHome *)v6 doesHomeContainResident];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __46__HMDHome__handleResolveThreadNetworkRequest___block_invoke;
    v17[3] = &unk_278673288;
    objc_copyWeak(&v19, buf);
    v18 = v4;
    [v9 retrieveMetadata:v10 homeHasResident:v11 completion:v17];

    objc_destroyWeak(&v19);
    objc_destroyWeak(buf);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = v6;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v21 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v10 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v4 respondWithError:v10];
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleResolveThreadNetworkRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v34 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = WeakRetained;
  if (v5 && WeakRetained)
  {
    v25 = 0;
    v9 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v5 requiringSecureCoding:1 error:&v25];
    v10 = v25;
    if (v9)
    {
      v11 = *(a1 + 32);
      v26 = *MEMORY[0x277CD0620];
      v27 = v9;
      v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
      [v11 respondWithPayload:v12];
    }

    else
    {
      v19 = objc_autoreleasePoolPush();
      v20 = v8;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138543618;
        v29 = v22;
        v30 = 2112;
        v31 = v10;
        _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@Unable to encode credentials: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v19);
      v23 = *(a1 + 32);
      v12 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
      [v23 respondWithError:v12];
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = v8;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v14 threadNetworkID];
      *buf = 138543874;
      v29 = v16;
      v30 = 2112;
      v31 = v17;
      v32 = 2112;
      v33 = v6;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network '%@': %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v18 = *(a1 + 32);
    v10 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v18 respondWithError:v10];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeUpdateDidOnboardLocationServicesRequest:(id)a3
{
  v35 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v32 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update did onboard locations services request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [v4 messagePayload];
  v11 = *MEMORY[0x277CCFEB0];
  v30 = 0;
  v12 = [v10 hmf_BOOLForKey:v11 error:&v30];
  v13 = v30;

  if (v13)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = v7;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v4 messagePayload];
      *buf = 138543618;
      v32 = v17;
      v33 = 2112;
      v34 = v18;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode did onboard location services from update request payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    [v4 respondWithError:v13];
  }

  else
  {
    v19 = [HMDHomeModel alloc];
    v20 = [(HMDHome *)v7 uuid];
    v21 = [(HMDHome *)v7 homeManager];
    v22 = [v21 uuid];
    v23 = [(HMDBackingStoreModelObject *)v19 initWithObjectChangeType:2 uuid:v20 parentUUID:v22];

    v24 = [MEMORY[0x277CCABB0] numberWithBool:v12];
    [(HMDHomeModel *)v23 setDidOnboardLocationServices:v24];

    v25 = [(HMDHome *)v7 backingStore];
    v26 = [v4 name];
    v27 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v28 = [v25 transaction:v26 options:v27];

    [v28 add:v23 withMessage:v4];
    [v28 run];
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleDidOnboardLocationServicesChange:(id)a3 message:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 didOnboardLocationServices];
  v9 = [v8 BOOLValue];

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    v16 = 138543618;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Updating did onboard location services: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  [(HMDHome *)v11 setDidOnboardLocationServices:v9];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeUpdateLocationServicesEnabledRequest:(id)a3
{
  v25 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v22 = v9;
    v23 = 2112;
    v24 = v4;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update location services enabled request message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [v4 messagePayload];
  v11 = *MEMORY[0x277CD0050];
  v20 = 0;
  v12 = [v10 hmf_BOOLForKey:v11 error:&v20];
  v13 = v20;

  if (v13)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = v7;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v4 messagePayload];
      *buf = 138543618;
      v22 = v17;
      v23 = 2112;
      v24 = v18;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode location services enabled from update request payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    [v4 respondWithError:v13];
  }

  else
  {
    [(HMDHome *)v7 runLocationServicesEnabledUpdateWithValue:v12 message:v4];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)_handleLocationServicesEnabledChange:(id)a3 message:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 locationServicesEnabled];
  v9 = [v8 BOOLValue];

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    v16 = 138543618;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Updating location services enabled: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  [(HMDHome *)v11 setLocationServicesEnabled:v9];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleSoundCheckUpdateRequest:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v27 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update soundCheck request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  v11 = [(HMDHome *)v7 uuid];
  v12 = [(HMDHome *)v7 homeManager];
  v13 = [v12 uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:v11 parentUUID:v13];

  v15 = [v4 messagePayload];
  v16 = *MEMORY[0x277CD05F0];
  v25 = 0;
  v17 = [v15 hmf_BOOLForKey:v16 error:&v25];
  v18 = v25;

  if (v18)
  {
    [v4 respondWithError:v18];
  }

  else
  {
    v19 = [MEMORY[0x277CCABB0] numberWithBool:v17];
    [(HMDHomeModel *)v14 setSoundCheckEnabled:v19];

    v20 = [(HMDHome *)v7 backingStore];
    v21 = [v4 name];
    v22 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v23 = [v20 transaction:v21 options:v22];

    [v23 add:v14 withMessage:v4];
    [v23 run];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleSoundCheckChange:(id)a3 message:(id)a4
{
  v5 = [a3 soundCheckEnabled];
  -[HMDHome setSoundCheckEnabled:](self, "setSoundCheckEnabled:", [v5 BOOLValue]);
}

- (BOOL)_validateSettingsUpdate:(id)a3 type:(int64_t *)a4 keyPath:(id *)a5 value:(id *)a6 error:(id *)a7
{
  v44 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = [v12 uuidForKey:@"kUserUUIDKey"];
  if (!v13)
  {
    if (a7)
    {
      v19 = MEMORY[0x277CCA9B8];
      v20 = 27;
      goto LABEL_10;
    }

LABEL_11:
    v21 = 0;
    goto LABEL_33;
  }

  v14 = [(HMDHome *)self currentUser];
  v15 = [v14 uuid];
  v16 = [v15 hmf_isEqualToUUID:v13];

  if ((v16 & 1) == 0)
  {
    if (a7)
    {
      v19 = MEMORY[0x277CCA9B8];
      v20 = 48;
      goto LABEL_10;
    }

    goto LABEL_11;
  }

  v17 = [v12 numberForKey:*MEMORY[0x277CD0F90]];
  v18 = [v17 integerValue];

  if ((v18 - 3) > 0xFFFFFFFFFFFFFFFDLL)
  {
    v22 = [v12 stringForKey:*MEMORY[0x277CD0F88]];
    if (!v22)
    {
      if (a7)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
        *a7 = v21 = 0;
      }

      else
      {
        v21 = 0;
      }

      goto LABEL_32;
    }

    v23 = [v12 dataForKey:*MEMORY[0x277CCEDA8]];
    if (!v23)
    {
      if (a7)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
        *a7 = v21 = 0;
        v23 = 0;
      }

      else
      {
        v21 = 0;
      }

      goto LABEL_31;
    }

    v37 = v22;
    v38 = v23;
    v39 = 0;
    v24 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v23 error:&v39];
    v35 = v39;
    v36 = v24;
    v21 = v24 != 0;
    if (v24)
    {
      v22 = v37;
      if (a4)
      {
        *a4 = v18;
      }

      v25 = v35;
      if (a5)
      {
        v26 = v37;
        *a5 = v37;
      }

      v27 = v36;
      if (!a6)
      {
        goto LABEL_30;
      }

      v28 = [v36 numberValue];
      a7 = a6;
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      v30 = self;
      v31 = HMFGetOSLogHandle();
      v25 = v35;
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543618;
        v41 = v32;
        v42 = 2112;
        v43 = v35;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setting value from encoded value: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v29);
      v27 = 0;
      v22 = v37;
      if (!a7)
      {
        goto LABEL_30;
      }

      v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    }

    *a7 = v28;
LABEL_30:

    v23 = v38;
LABEL_31:

LABEL_32:
    goto LABEL_33;
  }

  if (!a7)
  {
    goto LABEL_11;
  }

  v19 = MEMORY[0x277CCA9B8];
  v20 = 3;
LABEL_10:
  [v19 hmErrorWithCode:v20];
  *a7 = v21 = 0;
LABEL_33:

  v33 = *MEMORY[0x277D85DE8];
  return v21;
}

- (void)_handleSharedUserSettingsUpdate:(id)a3
{
  v4 = a3;
  v21 = 0;
  v22 = 0;
  v19 = 0;
  v20 = 0;
  v5 = [(HMDHome *)self _validateSettingsUpdate:v4 type:&v22 keyPath:&v21 value:&v20 error:&v19];
  v6 = v21;
  v7 = v20;
  v8 = v19;
  v9 = v8;
  if (v5)
  {
    v10 = [(HMDHome *)self backingStore];
    v11 = [v10 context];
    v12 = [v11 managedObjectContext];

    v13 = [(HMDHome *)self homeManager];
    v14 = [v13 sharedUserPrivateSettingsManager];

    v15 = [MEMORY[0x277CBEB38] dictionary];
    [v15 setObject:v7 forKeyedSubscript:v6];
    if ([v6 isEqualToString:@"root.siri.identifyVoice"] && objc_msgSend(v7, "isEqualToNumber:", &unk_283E71B10))
    {
      [v15 setObject:v7 forKeyedSubscript:@"root.music.allowiTunesAccount"];
    }

    v16 = [(HMDHome *)self uuid];
    v17 = [v14 updateSettingsForHome:v16 ofType:v22 withValues:v15 context:v12];
    [v4 respondWithOutcomeOf:v17];
  }

  else if (v8)
  {
    [v4 respondWithError:v8];
  }

  else
  {
    v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v18];
  }
}

- (void)_updateOwnerSettingDependents:(id)a3 keyPath:(id)a4 value:(id)a5
{
  v65 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if ([v9 isEqualToString:@"root.siri.identifyVoice"])
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v56 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Updating owner setting dependents", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    if ([v10 isEqualToNumber:&unk_283E71A20])
    {
      v15 = +[_MKFUser entity];
      v16 = [v15 hmd_attributeForSettingsPath:@"root.music.playbackInfluencesForYou"];

      v47 = v8;
      v17 = v12;
      if (v16)
      {
        v18 = objc_autoreleasePoolPush();
        v19 = v12;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
        {
          v21 = HMFGetLogIdentifier();
          v22 = [v16 name];
          *buf = 138544386;
          v56 = v21;
          v57 = 2112;
          v58 = @"root.music.playbackInfluencesForYou";
          v59 = 2112;
          v60 = v22;
          v61 = 2112;
          v62 = v10;
          v63 = 2112;
          v64 = @"root.siri.identifyVoice";
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Updating setting '%@' (%@) = %@ due to %@ is off", buf, 0x34u);

          v8 = v47;
        }

        objc_autoreleasePoolPop(v18);
        v23 = [v16 name];
        [v8 setValue:v10 forKey:v23];

        v12 = v17;
      }

      v24 = [v8 accessoriesWithPersonalRequestsEnabled];
      if (v24)
      {
        v44 = v16;
        v45 = v10;
        v46 = v9;
        v52 = 0u;
        v53 = 0u;
        v50 = 0u;
        v51 = 0u;
        obj = v24;
        v25 = [obj countByEnumeratingWithState:&v50 objects:v54 count:16];
        if (v25)
        {
          v26 = v25;
          v27 = *v51;
          do
          {
            for (i = 0; i != v26; ++i)
            {
              if (*v51 != v27)
              {
                objc_enumerationMutation(obj);
              }

              v29 = *(*(&v50 + 1) + 8 * i);
              v30 = [(__CFString *)v29 castIfAppleMediaAccessory];
              v31 = objc_autoreleasePoolPush();
              v32 = v12;
              v33 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
              {
                v34 = HMFGetLogIdentifier();
                *buf = 138543618;
                v56 = v34;
                v57 = 2112;
                v58 = v29;
                _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Removing personal requests enabled accessory %@", buf, 0x16u);

                v8 = v47;
              }

              objc_autoreleasePoolPop(v31);
              [v8 removeAccessoriesWithPersonalRequestsEnabledObject:v29];

              v12 = v17;
            }

            v26 = [obj countByEnumeratingWithState:&v50 objects:v54 count:16];
          }

          while (v26);
        }

        v35 = obj;

        v10 = v45;
        v9 = v46;
        v16 = v44;
      }

      else
      {
        v35 = 0;
      }

      goto LABEL_26;
    }

    if ([v10 isEqualToNumber:&unk_283E71B10])
    {
      v36 = +[_MKFUser entity];
      v37 = [v36 hmd_attributeForSettingsPath:@"root.music.allowiTunesAccount"];

      if (!v37)
      {
        v16 = 0;
        goto LABEL_27;
      }

      v38 = objc_autoreleasePoolPush();
      v39 = v12;
      v40 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v41 = obja = v38;
        v42 = [v37 name];
        *buf = 138544386;
        v56 = v41;
        v57 = 2112;
        v58 = @"root.music.allowiTunesAccount";
        v59 = 2112;
        v60 = v42;
        v61 = 2112;
        v62 = v10;
        v63 = 2112;
        v64 = @"root.siri.identifyVoice";
        _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_INFO, "%{public}@Updating setting '%@' (%@) = %@ due to %@ is on", buf, 0x34u);

        v38 = obja;
      }

      objc_autoreleasePoolPop(v38);
      v16 = v37;
      v35 = [v37 name];
      [v8 setValue:v10 forKey:v35];
LABEL_26:

LABEL_27:
    }
  }

  v43 = *MEMORY[0x277D85DE8];
}

- (void)_handleOwnerSettingsUpdate:(id)a3
{
  v33 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v27 = 0;
  v28 = 0;
  v25 = 0;
  v26 = 0;
  v5 = [(HMDHome *)self _validateSettingsUpdate:v4 type:&v28 keyPath:&v27 value:&v26 error:&v25];
  v6 = v27;
  v7 = v26;
  v8 = v25;
  v9 = v8;
  if (v5)
  {
    v10 = +[_MKFUser entity];
    v11 = [v10 hmd_attributeForSettingsPath:v6];

    if (v11)
    {
      v12 = [(HMDHome *)self backingStore];
      v13 = [v12 context];
      v20[0] = MEMORY[0x277D85DD0];
      v20[1] = 3221225472;
      v20[2] = __38__HMDHome__handleOwnerSettingsUpdate___block_invoke;
      v20[3] = &unk_278689550;
      v20[4] = self;
      v21 = v4;
      v22 = v6;
      v23 = v11;
      v24 = v7;
      [v13 performBlock:v20];
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      v15 = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543618;
        v30 = v17;
        v31 = 2112;
        v32 = v6;
        _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Invalid settings key path: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
      v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v4 respondWithError:v18];
    }

    goto LABEL_10;
  }

  if (!v8)
  {
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v11];
LABEL_10:

    goto LABEL_11;
  }

  [v4 respondWithError:v8];
LABEL_11:

  v19 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__handleOwnerSettingsUpdate___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) currentUser];
  v3 = [v2 uuid];

  v4 = [HMCContext findUserWithModelID:v3];
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 32);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (!v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v22 = 138543618;
      v23 = v17;
      v24 = 2112;
      v25 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to fetch the user with id [%@] from working store", &v22, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v16 = *(a1 + 40);
    v18 = MEMORY[0x277CCA9B8];
    v19 = 2;
    goto LABEL_10;
  }

  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = *(a1 + 48);
    v11 = [*(a1 + 56) name];
    v12 = *(a1 + 64);
    v22 = 138544130;
    v23 = v9;
    v24 = 2112;
    v25 = v10;
    v26 = 2112;
    v27 = v11;
    v28 = 2112;
    v29 = v12;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Updating owner setting '%@' (%@) = %@", &v22, 0x2Au);
  }

  objc_autoreleasePoolPop(v5);
  v13 = *(a1 + 64);
  v14 = [*(a1 + 56) name];
  [v4 setValue:v13 forKey:v14];

  [*(a1 + 32) _updateOwnerSettingDependents:v4 keyPath:*(a1 + 48) value:*(a1 + 64)];
  v15 = +[HMCContext currentContext];
  LOBYTE(v14) = [v15 save];

  v16 = *(a1 + 40);
  if ((v14 & 1) == 0)
  {
    v18 = MEMORY[0x277CCA9B8];
    v19 = -1;
LABEL_10:
    v20 = [v18 hmErrorWithCode:v19];
    [v16 respondWithError:v20];

    goto LABEL_11;
  }

  [v16 respondWithSuccess];
LABEL_11:

  v21 = *MEMORY[0x277D85DE8];
}

- (void)enableUserListeningHistoryForAccessoryUUID:(id)a3 userUUID:(id)a4
{
  v22 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self userWithUUID:v7];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  v12 = v11;
  if (v8)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v13;
      v18 = 2112;
      v19 = v6;
      v20 = 2112;
      v21 = v8;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Enable ULH: accessoryUUID %@ user %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [(HMDHome *)v8 enableUserListeningHistoryForAccessory:v6];
  }

  else
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v14;
      v18 = 2112;
      v19 = v7;
      v20 = 2112;
      v21 = v10;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@No user exist for userUUID %@ in home %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:(id)a3
{
  v4 = a3;
  v5 = __decodeAndVerifyCurrentUser(self, v4);
  [v5 handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:v4];
}

- (void)_handleMediaContentProfileAccessControlUpdate:(id)a3
{
  v4 = a3;
  v5 = __decodeAndVerifyCurrentUser(self, v4);
  [v5 handleMediaContentProfileAccessControlUpdate:v4];
}

- (void)_handleAssistantAccessControlUpdate:(id)a3
{
  v4 = a3;
  v5 = __decodeAndVerifyCurrentUser(self, v4);
  [v5 handleAssistantAccessControlUpdate:v4];
}

- (void)_handleSiriPhraseOptionsUpdateRequest:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v24 = 138543362;
    v25 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update Siri phrase options request", &v24, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  v11 = [(HMDHome *)v7 uuid];
  v12 = [(HMDHome *)v7 homeManager];
  v13 = [v12 uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:v11 parentUUID:v13];

  v15 = [v4 messagePayload];
  v16 = [v15 hmf_numberForKey:*MEMORY[0x277CD05E0]];
  v17 = [v16 unsignedIntegerValue];

  v18 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v17];
  [(HMDHomeModel *)v14 setSiriPhraseOptions:v18];

  v19 = [(HMDHome *)v7 backingStore];
  v20 = [v4 name];
  v21 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v22 = [v19 transaction:v20 options:v21];

  [v22 add:v14 withMessage:v4];
  [v22 run];

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_handleSiriPhraseOptionsStatusChange:(id)a3 message:(id)a4
{
  v5 = [a3 siriPhraseOptions];
  -[HMDHome setSiriPhraseOptions:](self, "setSiriPhraseOptions:", [v5 unsignedIntegerValue]);
}

- (void)_handleAudioAnalysisOnboardingUpdateRequest:(id)a3
{
  v25 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v23 = 138543362;
    v24 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update audio analysis classifier options request", &v23, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  v11 = [(HMDHome *)v7 uuid];
  v12 = [(HMDHome *)v7 homeManager];
  v13 = [v12 uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:v11 parentUUID:v13];

  v15 = [v4 messagePayload];
  v16 = [v15 hmf_BOOLForKey:*MEMORY[0x277CCFE70]];

  v17 = [MEMORY[0x277CCABB0] numberWithBool:v16];
  [(HMDHomeModel *)v14 setDidOnboardAnalysis:v17];

  v18 = [(HMDHome *)v7 backingStore];
  v19 = [v4 name];
  v20 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v21 = [v18 transaction:v19 options:v20];

  [v21 add:v14 withMessage:v4];
  [v21 run];

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_handleAudioAnalysisOnboardingStatusChange:(id)a3 message:(id)a4
{
  v5 = [a3 didOnboardAnalysis];
  -[HMDHome setDidOnboardAudioAnalysis:](self, "setDidOnboardAudioAnalysis:", [v5 BOOLValue]);
}

- (void)_handleAudioAnalysisClassifierOptionsUpdateRequest:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v24 = 138543362;
    v25 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update audio analysis classifier options request", &v24, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  v11 = [(HMDHome *)v7 uuid];
  v12 = [(HMDHome *)v7 homeManager];
  v13 = [v12 uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:v11 parentUUID:v13];

  v15 = [v4 messagePayload];
  v16 = [v15 hmf_numberForKey:*MEMORY[0x277CCFE50]];
  v17 = [v16 unsignedIntegerValue];

  v18 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v17];
  [(HMDHomeModel *)v14 setAnalysisOptions:v18];

  v19 = [(HMDHome *)v7 backingStore];
  v20 = [v4 name];
  v21 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v22 = [v19 transaction:v20 options:v21];

  [v22 add:v14 withMessage:v4];
  [v22 run];

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_handleAudioAnalysisClassifierOptionsChange:(id)a3 message:(id)a4
{
  v5 = [a3 analysisOptions];
  -[HMDHome setAudioAnalysisClassifierOptions:](self, "setAudioAnalysisClassifierOptions:", [v5 unsignedIntegerValue]);

  v6 = [(HMDHome *)self notificationCenter];
  [v6 postNotificationName:@"HMDAudioAnalysisClassifierOptionsUpdatedNotification" object:self];
}

- (void)_handleMultiUserEnabledChange:(id)a3 message:(id)a4
{
  v23 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v21 = 138543362;
    v22 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Multi-user enabled changed, sending notification", &v21, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [v6 multiUserEnabled];
  -[HMDHome setMultiUserEnabled:](v9, "setMultiUserEnabled:", [v12 BOOLValue]);

  v13 = [(HMDHome *)v9 notificationCenter];
  v14 = *MEMORY[0x277CD0448];
  [v13 postNotificationName:*MEMORY[0x277CD0448] object:0];

  v15 = MEMORY[0x277D0F848];
  v16 = [(HMDHome *)v9 messageDestination];
  v17 = [v15 messageWithName:v14 destination:v16 payload:0];

  v18 = [v7 identifier];
  [v17 setIdentifier:v18];

  [v17 setRemote:{objc_msgSend(v7, "isRemote")}];
  v19 = [(HMDHome *)v9 msgDispatcher];
  [v19 sendMessage:v17 completionHandler:0];

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForAccessCodeMessage:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v19 = 138543618;
    v20 = v8;
    v21 = 2112;
    v22 = v4;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling message to set has onboarded for access code: %@", &v19, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDHomeModel alloc];
  v10 = [(HMDHome *)v6 uuid];
  v11 = [(HMDHome *)v6 homeManager];
  v12 = [v11 uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:v10 parentUUID:v12];

  [(HMDHomeModel *)v13 setHasOnboardedForAccessCode:MEMORY[0x277CBEC38]];
  v14 = [(HMDHome *)v6 backingStore];
  v15 = [v4 name];
  v16 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v17 = [v14 transaction:v15 options:v16];

  [v17 add:v13 withMessage:v4];
  [v17 run];

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest:(id)a3
{
  v24 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received set has any user acknowledged camera recording onboarding request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDHomeModel alloc];
  v10 = [(HMDHome *)v6 uuid];
  v11 = [(HMDHome *)v6 homeManager];
  v12 = [v11 uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:v10 parentUUID:v12];

  [(HMDHomeModel *)v13 setHasAnyUserAcknowledgedCameraRecordingOnboarding:MEMORY[0x277CBEC38]];
  v14 = [(HMDHome *)v6 backingStore];
  v15 = [v4 name];
  v16 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v17 = [v14 transaction:v15 options:v16];

  [v17 add:v13 withMessage:v4];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __76__HMDHome__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest___block_invoke;
  v20[3] = &unk_27868A250;
  v21 = v4;
  v18 = v4;
  [v17 run:v20];

  v19 = *MEMORY[0x277D85DE8];
}

uint64_t __76__HMDHome__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithSuccess];
  }
}

- (void)enableMultiUser
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v12 = 138543362;
    v13 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Received local request to enable Multi-User", &v12, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v7 = MEMORY[0x277D0F818];
  v8 = *MEMORY[0x277CCFEE8];
  v9 = [(HMDHome *)v4 messageDestination];
  v10 = [v7 messageWithName:v8 destination:v9 payload:MEMORY[0x277CBEC10]];

  [(HMDHome *)v4 _enableMultiUserWithMessage:v10];
  v11 = *MEMORY[0x277D85DE8];
}

- (void)_enableMultiUserWithMessage:(void *)a1
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (a1)
  {
    if ([a1 isMultiUserEnabled])
    {
      [v3 respondWithSuccess];
    }

    else
    {
      v4 = objc_autoreleasePoolPush();
      v5 = a1;
      v6 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = HMFGetLogIdentifier();
        v18 = 138543362;
        v19 = v7;
        _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Received enable multi-user request", &v18, 0xCu);
      }

      objc_autoreleasePoolPop(v4);
      v8 = [HMDHomeModel alloc];
      v9 = [v5 uuid];
      v10 = [v5 homeManager];
      v11 = [v10 uuid];
      v12 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v9 parentUUID:v11];

      [(HMDHomeModel *)v12 setMultiUserEnabled:MEMORY[0x277CBEC38]];
      v13 = [v5 backingStore];
      v14 = [v3 name];
      v15 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
      v16 = [v13 transaction:v14 options:v15];

      [v16 add:v12 withMessage:v3];
      [v16 run];
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleEnableMultiUserRequest:(id)a3
{
  v41 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isRemote] && (objc_msgSend(v4, "isSecureRemote") & 1) == 0)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v38 = v13;
      v39 = 2112;
      v40 = v4;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    [v4 respondWithError:v14];
  }

  else
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      [(HMDHome *)self _enableMultiUserWithMessage:v4];
      goto LABEL_16;
    }

    v5 = [(HMDHome *)self primaryResident];
    if (!v5)
    {
      v6 = objc_autoreleasePoolPush();
      v15 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v16;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to forward message to home owner no resident found", buf, 0xCu);
      }

      goto LABEL_15;
    }

    if (([v4 isRemote] & 1) != 0 || objc_msgSend(v4, "BOOLForKey:", @"kDoNotForwardMessageKey"))
    {
      v6 = objc_autoreleasePoolPush();
      v7 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v9;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Did not expect remote message.", buf, 0xCu);
      }

LABEL_15:

      objc_autoreleasePoolPop(v6);
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v17];

      goto LABEL_16;
    }

    v19 = [v4 mutableCopy];
    [v19 setRemote:1];
    [v19 setSecureRemote:1];
    v35 = @"kDoNotForwardMessageKey";
    v36 = MEMORY[0x277CBEC38];
    v20 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    [v19 setMessagePayload:v20];

    v21 = [HMDRemoteDeviceMessageDestination alloc];
    v22 = [v4 destination];
    v23 = [v22 target];
    v24 = [v5 device];
    v25 = [(HMDRemoteDeviceMessageDestination *)v21 initWithTarget:v23 device:v24];
    [v19 setDestination:v25];

    objc_initWeak(&location, self);
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __41__HMDHome__handleEnableMultiUserRequest___block_invoke;
    v31[3] = &unk_278687F40;
    objc_copyWeak(&v33, &location);
    v32 = v4;
    [v19 setResponseHandler:v31];
    v26 = objc_autoreleasePoolPush();
    v27 = self;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
    {
      v29 = HMFGetLogIdentifier();
      *buf = 138543362;
      v38 = v29;
      _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@Forwarding enable multi-user request to owner.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v26);
    v30 = [(HMDHome *)v27 msgDispatcher];
    [v30 sendMessage:v19];

    objc_destroyWeak(&v33);
    objc_destroyWeak(&location);
  }

LABEL_16:

  v18 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleEnableMultiUserRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v11;
    v17 = 2112;
    v18 = v5;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Enabled multi-user on the home error: %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [*(a1 + 32) responseHandler];

  if (v12)
  {
    v13 = [*(a1 + 32) responseHandler];
    (v13)[2](v13, v5, v6);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)handleFindResidentsNotification:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 userInfo];
  v6 = [v5 hmf_UUIDForKey:*MEMORY[0x277CD0640]];

  if (v6)
  {
    v7 = [(HMDHome *)self uuid];
    v8 = [v6 isEqual:v7];

    if (v8)
    {
      v9 = objc_autoreleasePoolPush();
      v10 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 138543618;
        v24 = v12;
        v25 = 2112;
        v26 = v6;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Received notification to check if there are any residents for home with UUID: %@.", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      v13 = +[HMDCoreDataCloudTransform sharedInstance];
      v20[0] = MEMORY[0x277D85DD0];
      v20[1] = 3221225472;
      v20[2] = __43__HMDHome_handleFindResidentsNotification___block_invoke;
      v20[3] = &unk_2786706E0;
      v20[4] = v10;
      v21 = v13;
      v22 = v6;
      v14 = v13;
      [v14 countResidentsInHomeWithUUID:v22 completion:v20];
    }
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543362;
      v24 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@homeUUID is nil", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  v19 = *MEMORY[0x277D85DE8];
}

void __43__HMDHome_handleFindResidentsNotification___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = v5;
  if (!a2 || v5)
  {
    if (v5)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = *(a1 + 32);
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v16 = 138543618;
        v17 = v14;
        v18 = 2112;
        v19 = v6;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Counting residents in the cloud store failed with error: %@. Starting a full import", &v16, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
    }

    [*(a1 + 40) runCompleteMergeTransformForHomeWithModelID:*(a1 + 48) completion:0];
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v10;
      v18 = 2048;
      v19 = a2;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Found %lu residents in the cloud store", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_configureConfiguredResident:(id)a3 desiredConfigState:(unint64_t)a4 message:(id)a5
{
  v32 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  if (a4 == 1)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v28 = 138543362;
      v29 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Unconfiguring residents is not supported", &v28, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [v9 responseHandler];

    if (v14)
    {
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48 description:0 reason:0 suggestion:0];
      v16 = [v9 responseHandler];
      (v16)[2](v16, v15, 0);
LABEL_17:
    }
  }

  else
  {
    v17 = [v8 configurationState];
    [(HMDHome *)self _updateConfigurationStateForResidentDevice:v8 desiredConfigState:a4 message:v9];
    if (v17 != a4)
    {
      v15 = [(HMDHome *)self homeManager];
      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      v21 = os_log_type_enabled(v20, OS_LOG_TYPE_INFO);
      if (a4 == 2)
      {
        if (v21)
        {
          v22 = HMFGetLogIdentifier();
          v23 = [v8 displayName];
          v28 = 138543618;
          v29 = v22;
          v30 = 2112;
          v31 = v23;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Enabling resident device %@, checking if we need to go remote", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
      }

      else
      {
        if (v21)
        {
          v24 = HMFGetLogIdentifier();
          v25 = [v8 displayName];
          v28 = 138543618;
          v29 = v24;
          v30 = 2112;
          v31 = v25;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Disabling resident device %@, checking if we need to go remote", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
        v26 = [(HMDHome *)v19 uuid];
        [v15 teardownRemoteAccessForHome:v26];
      }

      if (![(HMDHome *)v19 isResidentSupported])
      {
        [v15 checkForRemotePeers];
      }

      v16 = [v9 name];
      [(HMDHome *)v19 saveWithReason:v16 postSyncNotification:0];
      goto LABEL_17;
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_addResidentWithUsername:(id)a3 publicKey:(id)a4 destination:(id)a5
{
  v38 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v11);

  if (v8 && v9)
  {
    v12 = [(HMDHome *)self unconfiguredResidentDevices];
    v13 = [v12 hmf_firstObjectWithValue:v10 forKeyPath:@"userID"];

    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    v18 = v17;
    if (isKindOfClass)
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        *buf = 138543362;
        v33 = v19;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Found user as unconfigured resident, creating an accepted invitation to track adding the resident", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v15);
      v20 = [[HMDOutgoingHomeInvitation alloc] initWithInvitee:v13 invitationState:5 forHome:v16 expiryDate:0 messageIdentifier:0];
      [(HMDHome *)v16 addOutgoingInvitation:v20];
      objc_initWeak(buf, v16);
      v28[0] = MEMORY[0x277D85DD0];
      v28[1] = 3221225472;
      v28[2] = __58__HMDHome__addResidentWithUsername_publicKey_destination___block_invoke;
      v28[3] = &unk_278685D08;
      objc_copyWeak(&v31, buf);
      v29 = v13;
      v21 = v20;
      v30 = v21;
      [(HMDHome *)v16 __handleAcceptedOutgoingInvitationResponse:v21 destinationAddress:v10 publicKey:v9 username:v8 reverseShare:0 reverseShareToken:0 issuerPublicKeyER:0 presenceAuthStatus:0 completionHandler:v28];

      objc_destroyWeak(&v31);
      objc_destroyWeak(buf);
    }

    else
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543618;
        v33 = v26;
        v34 = 2112;
        v35 = v10;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Attempt to pair an unknown resident user '%@', aborting", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
    }
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543874;
      v33 = v25;
      v34 = 2112;
      v35 = v8;
      v36 = 2112;
      v37 = v9;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Aborting adding resident due to missing userName '%@' and publicKey '%@'", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __58__HMDHome__addResidentWithUsername_publicKey_destination___block_invoke(id *a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (shouldLogPrivateInformation())
  {
    v5 = [a1[4] userID];
  }

  else
  {
    v5 = @"...";
    v6 = @"...";
  }

  v7 = objc_autoreleasePoolPush();
  v8 = WeakRetained;
  v9 = HMFGetOSLogHandle();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);
  if (v3)
  {
    if (v10)
    {
      v11 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = v5;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to add resident user '%@' invitation with error: %@", &v16, 0x20u);
    }
  }

  else if (v10)
  {
    v12 = HMFGetLogIdentifier();
    v13 = [a1[5] identifier];
    v14 = [v13 UUIDString];
    v16 = 138543874;
    v17 = v12;
    v18 = 2112;
    v19 = v5;
    v20 = 2112;
    v21 = v14;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Tracking adding resident user '%@' with accepted and pending invitation '%@'", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v15 = *MEMORY[0x277D85DE8];
}

- (void)_sendResidentInviteWithDestination:(id)a3
{
  v47 = *MEMORY[0x277D85DE8];
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v6)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [v6 device];
      v13 = [v12 remoteDestinationString];
      *buf = 138543618;
      v42 = v11;
      v43 = 2112;
      v44 = v13;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Adding user %@ as remote access point", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    v14 = [(HMDHome *)v8 homeManager];
    v37 = 0;
    v38 = 0;
    v36 = 0;
    v15 = [v14 getOrCreateControllerPublicKey:&v38 controllerUsername:&v37 error:&v36];
    v16 = v38;
    v32 = v37;
    v31 = v36;
    if (v15)
    {
      v39[0] = *MEMORY[0x277CD23D0];
      v17 = [(HMDHome *)v8 name];
      v40[0] = v17;
      v39[1] = *MEMORY[0x277CD0640];
      v18 = [(HMDHome *)v8 uuid];
      v19 = [v18 UUIDString];
      v40[1] = v19;
      v39[2] = @"kControllerPublicKey";
      v20 = v16;
      if (!v16)
      {
        v20 = [MEMORY[0x277CBEB68] null];
      }

      v39[3] = @"kControllerPairingNameKey";
      v40[2] = v20;
      v40[3] = v32;
      v30 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v40 forKeys:v39 count:4];
      if (!v16)
      {
      }

      v21 = [MEMORY[0x277D0F818] internalMessageWithName:@"kAddRemoteAccessRequestKey" destination:v4 messagePayload:v30];
      objc_initWeak(buf, v8);
      v33[0] = MEMORY[0x277D85DD0];
      v33[1] = 3221225472;
      v33[2] = __46__HMDHome__sendResidentInviteWithDestination___block_invoke;
      v33[3] = &unk_278687F40;
      objc_copyWeak(&v35, buf);
      v34 = v6;
      [v21 setResponseHandler:v33];
      v22 = [v14 messageDispatcher];
      [v22 sendMessage:v21 completionHandler:0];

      objc_destroyWeak(&v35);
      objc_destroyWeak(buf);
    }

    else
    {
      v25 = objc_autoreleasePoolPush();
      v26 = v8;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        *buf = 138543362;
        v42 = v28;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Failed getting controller public key to add remote gateway", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
    }
  }

  else
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      v24 = [(HMDHome *)v8 shortDescription];
      *buf = 138543874;
      v42 = v23;
      v43 = 2112;
      v44 = v24;
      v45 = 2112;
      v46 = v4;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@[%@] Invalid resident invite destination: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__sendResidentInviteWithDestination___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = WeakRetained;
  if (v5 || !v6)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = v8;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) device];
      v15 = [v14 remoteDestinationString];
      *buf = 138543874;
      v22 = v13;
      v23 = 2112;
      v24 = v15;
      v25 = 2112;
      v26 = v5;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to receive controller info to auto add user %@ due to error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
  }

  else if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __46__HMDHome__sendResidentInviteWithDestination___block_invoke_1903;
    block[3] = &unk_27868A010;
    v18 = v6;
    v19 = v8;
    v20 = *(a1 + 32);
    dispatch_async(v9, block);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__sendResidentInviteWithDestination___block_invoke_1903(uint64_t a1)
{
  v6 = [*(a1 + 32) hmf_stringForKey:@"kControllerPairingNameKey"];
  v2 = [*(a1 + 32) hmf_dataForKey:@"kControllerPublicKey"];
  v3 = *(a1 + 40);
  v4 = [*(a1 + 48) device];
  v5 = [v4 remoteDestinationString];
  [v3 _addResidentWithUsername:v6 publicKey:v2 destination:v5];
}

- (void)_configureUnconfiguredResident:(id)a3 desiredConfigState:(unint64_t)a4
{
  v77 = *MEMORY[0x277D85DE8];
  v59 = a3;
  v6 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v6);

  v7 = v59;
  v8 = [v59 configurationState];
  if (v8 != a4)
  {
    v58 = v8;
    v66 = 0u;
    v67 = 0u;
    v64 = 0u;
    v65 = 0u;
    v9 = [(HMDHome *)self outgoingInvitations];
    v10 = [v9 countByEnumeratingWithState:&v64 objects:v76 count:16];
    if (v10)
    {
      v11 = *v65;
      while (2)
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v65 != v11)
          {
            objc_enumerationMutation(v9);
          }

          v13 = [*(*(&v64 + 1) + 8 * i) user];
          v14 = [v13 userID];
          v15 = [v59 userID];
          v16 = [v14 isEqualToString:v15];

          if (v16)
          {
            v32 = objc_autoreleasePoolPush();
            v33 = self;
            v34 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
            {
              v35 = HMFGetLogIdentifier();
              v36 = [v59 userID];
              *buf = 138543618;
              v71 = v35;
              v72 = 2112;
              v73 = v36;
              _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Already have a pending invitation for the resident user '%@', not setting up remote access", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v32);
            goto LABEL_34;
          }
        }

        v10 = [v9 countByEnumeratingWithState:&v64 objects:v76 count:16];
        if (v10)
        {
          continue;
        }

        break;
      }
    }

    if (a4 != 2 || v58 != 1)
    {
      v37 = objc_autoreleasePoolPush();
      v38 = self;
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
      {
        v40 = HMFGetLogIdentifier();
        v41 = [v59 displayName];
        *buf = 138543618;
        v71 = v40;
        v72 = 2112;
        v73 = v41;
        _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Cannot configure unconfigured resident %@ to desired state", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v37);
      goto LABEL_34;
    }

    v17 = [v59 userID];
    v18 = [(HMDHome *)self homeManager];
    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      v23 = [v59 displayName];
      *buf = 138543874;
      v71 = v22;
      v72 = 2112;
      v73 = v17;
      v74 = 2112;
      v75 = v23;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Configuring unconfigured resident %@/%@ for remote access", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v19);
    v24 = [(HMDHome *)v20 hapAccessoryUniqueIdentifiers];
    v25 = [v24 allObjects];

    if ([v25 count])
    {
      v26 = [(HMDHome *)v20 pendingResponsesForRemoteAccessSetup];
      v27 = [v26 containsObject:v17];

      if (!v27)
      {
        v44 = [v18 uuid];
        v45 = [HMDMessageDispatcher destinationWithTarget:v44 userID:0 destination:v17 multicast:0];

        if (v45)
        {
          v46 = [(HMDHome *)v20 pendingResponsesForRemoteAccessSetup];
          [v46 addObject:v17];

          v69[0] = v25;
          v47 = *MEMORY[0x277CD0640];
          v68[0] = @"kAccessoryIdentitiesKey";
          v68[1] = v47;
          v48 = [(HMDHome *)v20 uuid];
          v49 = [v48 UUIDString];
          v69[1] = v49;
          v50 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v69 forKeys:v68 count:2];

          v51 = [MEMORY[0x277D0F818] internalMessageWithName:@"kDoYouSeeUnpairedAccessoriesKey" destination:v45 messagePayload:v50];
          objc_initWeak(buf, v20);
          v60[0] = MEMORY[0x277D85DD0];
          v60[1] = 3221225472;
          v60[2] = __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke;
          v60[3] = &unk_278689460;
          objc_copyWeak(&v63, buf);
          v61 = v17;
          v62 = v45;
          [v51 setResponseHandler:v60];
          v52 = [v18 messageDispatcher];
          [v52 sendMessage:v51 completionHandler:0];

          objc_destroyWeak(&v63);
          objc_destroyWeak(buf);
        }

        else
        {
          v53 = objc_autoreleasePoolPush();
          v54 = v20;
          v55 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v55, OS_LOG_TYPE_DEFAULT))
          {
            v56 = HMFGetLogIdentifier();
            *buf = 138543618;
            v71 = v56;
            v72 = 2112;
            v73 = v17;
            _os_log_impl(&dword_229538000, v55, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: could not create message destination for address: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v53);
        }

        goto LABEL_34;
      }

      v28 = objc_autoreleasePoolPush();
      v29 = v20;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v31 = HMFGetLogIdentifier();
        *buf = 138543362;
        v71 = v31;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: there is already a pending request", buf, 0xCu);
      }
    }

    else
    {
      v28 = objc_autoreleasePoolPush();
      v42 = v20;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v43 = HMFGetLogIdentifier();
        *buf = 138543362;
        v71 = v43;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: no accessory identifiers found", buf, 0xCu);
      }
    }

    objc_autoreleasePoolPop(v28);
LABEL_34:
    v7 = v59;
    goto LABEL_35;
  }

  [(HMDHome *)self _updateConfigurationStateForResidentDevice:v59 desiredConfigState:a4 message:0];
LABEL_35:

  v57 = *MEMORY[0x277D85DE8];
}

void __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v8 = WeakRetained;
  if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke_2;
    block[3] = &unk_278689550;
    block[4] = v8;
    v11 = a1[4];
    v12 = v5;
    v13 = v6;
    v14 = a1[5];
    dispatch_async(v9, block);
  }
}

void __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke_2(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) pendingResponsesForRemoteAccessSetup];
  [v2 removeObject:*(a1 + 40)];

  if (*(a1 + 48) || (v9 = *(a1 + 56)) == 0)
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 40);
      v8 = *(a1 + 48);
      v19 = 138543874;
      v20 = v6;
      v21 = 2112;
      v22 = v7;
      v23 = 2112;
      v24 = v8;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Remote peer %@ failed to look for accessories with error:%@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v3);
  }

  else
  {
    v10 = [v9 hmf_BOOLForKey:@"kAtHomeStateKey"];
    v11 = [*(a1 + 56) hmf_stringForKey:@"kDeviceNameKey"];
    v12 = v11;
    if (v10 && v11)
    {
      [*(a1 + 32) _sendResidentInviteWithDestination:*(a1 + 64)];
    }

    else
    {
      v13 = objc_autoreleasePoolPush();
      v14 = *(a1 + 32);
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        v17 = *(a1 + 40);
        v19 = 138543618;
        v20 = v16;
        v21 = 2112;
        v22 = v17;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Remote peer %@ is not at home", &v19, 0x16u);
      }

      objc_autoreleasePoolPop(v13);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_updateConfigurationStateForResidentDevice:(id)a3 desiredConfigState:(unint64_t)a4 message:(id)a5
{
  v22 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [v8 displayName];
    v16 = 138543874;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    v20 = 2048;
    v21 = a4;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Updated configuration state of resident %@ to %ld", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v10);
  if ([v8 configurationState] != a4)
  {
    [v8 setConfigurationState:a4];
    [(HMDHome *)v11 _notifyClientsOfUpdatedResidentUser:v8];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)notifyNewRemotePeersFound:(BOOL)a3 remoteUsersRemoved:(id)a4 forceRemoteNotificationRegistration:(BOOL)a5
{
  v8 = a4;
  v9 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __92__HMDHome_notifyNewRemotePeersFound_remoteUsersRemoved_forceRemoteNotificationRegistration___block_invoke;
  block[3] = &unk_278681260;
  block[4] = self;
  v12 = v8;
  v13 = a3;
  v14 = a5;
  v10 = v8;
  dispatch_async(v9, block);
}

void __92__HMDHome_notifyNewRemotePeersFound_remoteUsersRemoved_forceRemoteNotificationRegistration___block_invoke(uint64_t a1)
{
  v54 = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277CBEB58];
  v3 = [*(a1 + 32) users];
  v40 = [v2 setWithArray:v3];

  v39 = [MEMORY[0x277CBEB58] setWithArray:*(a1 + 40)];
  [v40 intersectSet:v39];
  if ([v40 count])
  {
    v42 = [MEMORY[0x277CBEB18] array];
    v45 = 0u;
    v46 = 0u;
    v43 = 0u;
    v44 = 0u;
    obj = [v40 allObjects];
    v4 = [obj countByEnumeratingWithState:&v43 objects:v53 count:16];
    if (v4)
    {
      v5 = *v44;
      do
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v44 != v5)
          {
            objc_enumerationMutation(obj);
          }

          v7 = *(*(&v43 + 1) + 8 * i);
          if (shouldLogPrivateInformation())
          {
            v8 = [v7 userID];
          }

          else
          {
            v8 = @"...";
            v9 = @"...";
          }

          v10 = objc_autoreleasePoolPush();
          v11 = *(a1 + 32);
          v12 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
          {
            v13 = HMFGetLogIdentifier();
            *buf = 138543618;
            v50 = v13;
            v51 = 2112;
            v52 = v8;
            _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Removing remote user %@ since it has de-registered", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v10);
          v14 = [v7 userID];

          if (v14)
          {
            v15 = [v7 userID];
            [v42 addObject:v15];
          }

          [*(a1 + 32) _removeOutgoingInvitationForUser:v7];
          [*(a1 + 32) _removeUserFromContainer:v7];
        }

        v4 = [obj countByEnumeratingWithState:&v43 objects:v53 count:16];
      }

      while (v4);
    }

    v16 = *(a1 + 32);
    os_unfair_recursive_lock_lock_with_options();
    v17 = *(*(a1 + 32) + 32);
    v18 = [v40 allObjects];
    [v17 removeObjectsInArray:v18];

    os_unfair_recursive_lock_unlock();
    v47[0] = @"kUserIDsKey";
    v19 = [v42 copy];
    v47[1] = *MEMORY[0x277CD0640];
    v48[0] = v19;
    v20 = [*(a1 + 32) uuid];
    v21 = [v20 UUIDString];
    v48[1] = v21;
    v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v48 forKeys:v47 count:2];

    [*(a1 + 32) saveWithReason:@"kRemoteUsersDeregistered" information:v22 postSyncNotification:0];
  }

  v23 = [*(a1 + 32) localCapabilitiesDataSource];
  v24 = [v23 supportsRemoteAccess];

  if (v24)
  {
    v25 = [*(a1 + 32) homeManager];
    if (*(a1 + 48) == 1)
    {
      if ([*(a1 + 32) reachableAccessoriesCount])
      {
        if ([*(a1 + 32) allowsRemoteAccess])
        {
          v26 = [*(a1 + 32) currentUser];
          v27 = [v26 isRemoteAccessAllowed];

          if (v27)
          {
            v28 = objc_autoreleasePoolPush();
            v29 = *(a1 + 32);
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
            {
              v31 = HMFGetLogIdentifier();
              *buf = 138543362;
              v50 = v31;
              _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@We have potential remote gateways that can be auto setup, triggering detection", buf, 0xCu);
            }

            objc_autoreleasePoolPop(v28);
            v32 = [*(a1 + 32) uuid];
            [v25 accessoriesAreLocallyReachableOnTransientDevice:1 forHome:v32];
          }
        }
      }
    }

    if (([*(a1 + 32) remoteAccessIsEnabled] & 1) == 0 && (objc_msgSend(*(a1 + 32), "isResidentSupported") & 1) == 0)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = *(a1 + 32);
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543362;
        v50 = v36;
        _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled, requesting electing a remote peer", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v33);
      v37 = [*(a1 + 32) uuid];
      [v25 electRemoteAccessPeerForHome:v37];
    }

    [(HMDHome *)*(a1 + 32) _subscribeForNotificationFromRemoteGateway:?];
  }

  v38 = *MEMORY[0x277D85DE8];
}

- (void)_subscribeForNotificationFromRemoteGateway:(void *)a1
{
  v24 = *MEMORY[0x277D85DE8];
  if (a1)
  {
    v4 = [a1 workQueue];
    dispatch_assert_queue_V2(v4);

    if ((a2 & 1) != 0 || ![a1 registeredNotificationWithRemoteGateway])
    {
      v9 = [a1 notificationRegistrations];
      v10 = [v9 count];

      v11 = objc_autoreleasePoolPush();
      v12 = a1;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v15 = [v12 notificationRegistrations];
        v16 = [v15 shortDescription];
        v18 = 138543874;
        v19 = v14;
        v20 = 2112;
        v21 = v16;
        v22 = 2048;
        v23 = v10;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with new remote gateway: %@/%lu", &v18, 0x20u);
      }

      objc_autoreleasePoolPop(v11);
      [v12 _subscribeForHomeNotificationsFromRemoteGateway:v10 != 0];
      [v12 setRegisteredNotificationWithRemoteGateway:1];
    }

    else
    {
      v5 = objc_autoreleasePoolPush();
      v6 = a1;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        v18 = 138543362;
        v19 = v8;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Already registered for notification with remote gateway, skipping", &v18, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_remoteAccessEnabled:(BOOL)a3
{
  v5 = [(HMDHome *)self hapAccessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __32__HMDHome__remoteAccessEnabled___block_invoke;
  v9[3] = &__block_descriptor_33_e25_v16__0__HMDHAPAccessory_8l;
  v10 = a3;
  [v5 na_each:v9];

  v6 = [(HMDHome *)self nativeMatterAccessories];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __32__HMDHome__remoteAccessEnabled___block_invoke_2;
  v7[3] = &__block_descriptor_33_e56_v16__0__HMDMatterAccessory_HMDMatterAccessoryProtocol__8l;
  v8 = a3;
  [v6 na_each:v7];
}

- (void)remoteAccessEnabled:(BOOL)a3
{
  v5 = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __31__HMDHome_remoteAccessEnabled___block_invoke;
  v6[3] = &unk_278688650;
  v6[4] = self;
  v7 = a3;
  dispatch_async(v5, v6);
}

uint64_t __31__HMDHome_remoteAccessEnabled___block_invoke(uint64_t a1)
{
  v48 = *MEMORY[0x277D85DE8];
  if (*(a1 + 40) == [*(a1 + 32) remoteAccessIsEnabled])
  {
    goto LABEL_25;
  }

  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v7 = HMFBooleanToString();
    *buf = 138543618;
    v45 = v5;
    v46 = 2112;
    v47 = v7;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Setting remote access enabled to %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  [*(a1 + 32) setRemoteAccessIsEnabled:*(a1 + 40)];
  if (*(a1 + 40) != 1)
  {
    v19 = [*(a1 + 32) WiFiAssertion];

    if (v19)
    {
      v20 = objc_autoreleasePoolPush();
      v21 = *(a1 + 32);
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Releasing WiFi assertion", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      v24 = [*(a1 + 32) wifiManager];
      v25 = [*(a1 + 32) WiFiAssertion];
      [v24 endActiveAssertion:v25];

      v26 = [*(a1 + 32) wifiManager];
      [v26 releaseWoWAssertion];

      [*(a1 + 32) setWiFiAssertion:0];
    }

    goto LABEL_16;
  }

  if (isWatch())
  {
    v8 = [*(a1 + 32) homeManager];
    if ([v8 isActive])
    {
      v9 = [*(a1 + 32) WiFiAssertion];

      if (v9)
      {
        goto LABEL_16;
      }

      v10 = objc_autoreleasePoolPush();
      v11 = *(a1 + 32);
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v13;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Taking WiFi assertion", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v10);
      v14 = [*(a1 + 32) wifiManager];
      v15 = MEMORY[0x277CCACA8];
      v16 = [*(a1 + 32) shortDescription];
      v17 = [v15 stringWithFormat:@"Remote Access for %@", v16];
      v18 = [v14 beginActiveAssertionWithOptions:0 reason:v17];
      [*(a1 + 32) setWiFiAssertion:v18];

      v8 = [*(a1 + 32) wifiManager];
      [v8 takeWoWAssertion];
    }
  }

LABEL_16:
  if (([*(a1 + 32) isResidentSupported] & 1) == 0)
  {
    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v27 = [*(a1 + 32) _residentUsers];
    v28 = [v27 countByEnumeratingWithState:&v39 objects:v43 count:16];
    if (v28)
    {
      v29 = v28;
      v30 = *v40;
      do
      {
        v31 = 0;
        do
        {
          if (*v40 != v30)
          {
            objc_enumerationMutation(v27);
          }

          [*(a1 + 32) _notifyClientsOfUpdatedResidentUser:*(*(&v39 + 1) + 8 * v31++)];
        }

        while (v29 != v31);
        v29 = [v27 countByEnumeratingWithState:&v39 objects:v43 count:16];
      }

      while (v29);
    }
  }

LABEL_25:
  v32 = objc_autoreleasePoolPush();
  v33 = *(a1 + 32);
  v34 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
  {
    v35 = HMFGetLogIdentifier();
    *buf = 138543362;
    v45 = v35;
    _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Clearing history of all heartbeat queued messages to server", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v32);
  v36 = [*(a1 + 32) heartbeatPingMessagesQueuedWithServer];
  [v36 removeAllObjects];

  result = [*(a1 + 32) _remoteAccessEnabled:*(a1 + 40)];
  v38 = *MEMORY[0x277D85DE8];
  return result;
}

- (BOOL)remoteAccessIsEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  remoteAccessIsEnabled = self->_remoteAccessIsEnabled;
  os_unfair_recursive_lock_unlock();
  return remoteAccessIsEnabled;
}

- (void)setRemoteAccessEnabled:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_remoteAccessIsEnabled = a3;

  os_unfair_recursive_lock_unlock();
}

- (void)updateNetworkConnectivity:(BOOL)a3 companionReachable:(BOOL)a4
{
  v7 = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __56__HMDHome_updateNetworkConnectivity_companionReachable___block_invoke;
  v8[3] = &unk_27867E0C8;
  v8[4] = self;
  v9 = a3;
  v10 = a4;
  dispatch_async(v7, v8);
}

uint64_t __56__HMDHome_updateNetworkConnectivity_companionReachable___block_invoke(uint64_t a1)
{
  v11 = *MEMORY[0x277D85DE8];
  if (*(a1 + 40) != [*(a1 + 32) isNetworkAvailable])
  {
    [*(a1 + 32) setIsNetworkAvailable:?];
  }

  v2 = [*(a1 + 32) remoteEventRouterClientController];
  [v2 networkAvailabilityDidChange:*(a1 + 40)];

  isWatch();
  result = [*(a1 + 32) remoteAccessIsEnabled];
  if (result)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v7;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@We have no network connectivity, setting reachability state for all accessories to reflect their state", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    result = [*(a1 + 32) _remoteAccessEnabled:*(a1 + 40)];
  }

  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (BOOL)_residentDeviceAvailable
{
  v14 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isResidentSupported])
  {
    LOBYTE(v3) = 1;
  }

  else
  {
    v11 = 0u;
    v12 = 0u;
    v9 = 0u;
    v10 = 0u;
    v4 = [(HMDHome *)self _residentUsers];
    v3 = [v4 countByEnumeratingWithState:&v9 objects:v13 count:16];
    if (v3)
    {
      v5 = *v10;
      while (2)
      {
        for (i = 0; i != v3; ++i)
        {
          if (*v10 != v5)
          {
            objc_enumerationMutation(v4);
          }

          if ([*(*(&v9 + 1) + 8 * i) configurationState] == 2)
          {
            LOBYTE(v3) = 1;
            goto LABEL_13;
          }
        }

        v3 = [v4 countByEnumeratingWithState:&v9 objects:v13 count:16];
        if (v3)
        {
          continue;
        }

        break;
      }
    }

LABEL_13:
  }

  v7 = *MEMORY[0x277D85DE8];
  return v3;
}

- (id)_residentUsers
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = MEMORY[0x277CBEB18];
  v4 = [(HMDHome *)self users];
  v5 = [v3 arrayWithCapacity:{objc_msgSend(v4, "count")}];

  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v6 = [(HMDHome *)self users];
  v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v15;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v15 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v14 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [v5 addObject:v11];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v8);
  }

  v12 = *MEMORY[0x277D85DE8];

  return v5;
}

- (BOOL)isRemoteAccessDeviceReachable
{
  if (![(HMDHome *)self remoteAccessIsEnabled])
  {
    return 0;
  }

  v3 = [(HMDHome *)self primaryResident];
  v4 = ([v3 isReachable] & 1) != 0 || -[HMDHome isCompanionReachable](self, "isCompanionReachable");

  return v4;
}

- (void)updateAccessoryBrowsing
{
  v3 = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident];
  v4 = [(HMDHome *)self isCurrentDeviceAvailableResident];
  v5 = [(HMDHome *)self accessoryBrowser];
  [v5 updateRemoteAccessoryBrowsing:v4 whbScan:v3];
}

- (void)handlePrimaryResidentChangeNotification:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 name];
    *buf = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = v9;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received resident update notification: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [(HMDHome *)v6 workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __51__HMDHome_handlePrimaryResidentChangeNotification___block_invoke;
  v13[3] = &unk_27868A750;
  v14 = v4;
  v15 = v6;
  v11 = v4;
  dispatch_async(v10, v13);

  v12 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome_handlePrimaryResidentChangeNotification___block_invoke(uint64_t a1)
{
  v33 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_UUIDForKey:@"HMDResidentDeviceHomeUUIDNotificationKey"];

  v4 = [*(a1 + 40) uuid];
  v5 = [v4 hmf_isEqualToUUID:v3];

  if (v5)
  {
    if ([*(a1 + 40) isCurrentDeviceConfirmedPrimaryResident])
    {
      v6 = objc_autoreleasePoolPush();
      v7 = *(a1 + 40);
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = HMFGetLogIdentifier();
        LODWORD(v29) = 138543362;
        *(&v29 + 4) = v9;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Resetting accessory browsers", &v29, 0xCu);
      }

      objc_autoreleasePoolPop(v6);
      v10 = [*(a1 + 40) accessoryBrowser];
      [v10 restartBrowsers];

      [*(a1 + 40) _evaluateShouldRelaunchAndSetRelaunch];
      [*(a1 + 40) _processUnsentOutgoingInvitations];
      [*(a1 + 40) _processUnacceptReverseShareAccessForUsers];
      [*(a1 + 40) _fixupUsersWithoutMergeID];
      [*(a1 + 40) _fixupHindsightOnboarding];
      if ([*(a1 + 40) isOwnerUser])
      {
        v11 = [*(a1 + 40) homeManager];
        v12 = [v11 homeOwnerCloudShareManager];
        [v12 updateSharedOwnerAccountHandleForHome:*(a1 + 40)];
      }

      [*(a1 + 40) updateCATIDForUsersIfNeeded:0];
      [*(a1 + 40) updateMatterFabricIDIfNeeded];
      v13 = [*(a1 + 40) currentUser];
      [v13 scheduleRestrictedGuestAccessTimersWithReason:@"Primary changed on controller"];

      v14 = [*(a1 + 40) notificationRegistry];
      [v14 reprocessEnabledCharacteristicRegistrations];

      v15 = *(a1 + 40);
      if (v15)
      {
        v16 = [*(a1 + 40) homeManager];
        v17 = [v16 mobileAssetManager];
        *&v29 = MEMORY[0x277D85DD0];
        *(&v29 + 1) = 3221225472;
        v30 = __50__HMDHome__maybeCheckACWGLocksForMFiCertification__block_invoke;
        v31 = &unk_27866FDC8;
        v32 = v15;
        [v17 getCurrentContentVersionWithCompletion:&v29];

        v18 = *(a1 + 40);
      }

      else
      {
        v18 = 0;
      }

      v19 = [v18 lastSeenStatusManager];
      [v19 start];

      HMFUptime();
      v21 = *(a1 + 40);
    }

    else
    {
      v22 = [*(a1 + 40) notificationRegistry];
      [v22 disableAllRegistrations];

      v23 = [*(a1 + 40) lastSeenStatusManager];
      [v23 stop];

      v21 = *(a1 + 40);
      v20 = 0.0;
    }

    [v21 setCurrentDeviceBecamePrimaryTime:v20];
    if ([*(a1 + 40) isCurrentDeviceAvailableResident])
    {
      [*(a1 + 40) updateAccessoryBrowsing];
    }

    HMFUptime();
    [*(a1 + 40) setPrimaryResidentChangedTime:?];
    [*(a1 + 40) _notifyThreadLayerOfResidentChange];
    v24 = objc_autoreleasePoolPush();
    v25 = *(a1 + 40);
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      LODWORD(v29) = 138543362;
      *(&v29 + 4) = v27;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - primary resident changed", &v29, 0xCu);
    }

    objc_autoreleasePoolPop(v24);
    [*(a1 + 40) _configureUserActivityStateDetectorManager];
  }

  v28 = *MEMORY[0x277D85DE8];
}

void __50__HMDHome__maybeCheckACWGLocksForMFiCertification__block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v15 = *MEMORY[0x277D85DE8];
  v5 = a3;
  if (a2)
  {
    [(HMDHome *)*(a1 + 32) _maybeCheckACWGLocksForMFiCertificationWithContentVersion:a2];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 32);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v9;
      v13 = 2112;
      v14 = v5;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to get current mobile asset content version: %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_maybeCheckACWGLocksForMFiCertificationWithContentVersion:(void *)a1
{
  if (a1)
  {
    v4 = [a1 backingStore];
    v5 = [v4 context];

    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke;
    v7[3] = &unk_278685DF8;
    v8 = v5;
    v9 = a2;
    v7[4] = a1;
    v6 = v5;
    [v6 performBlock:v7];
  }
}

void __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  if (v3)
  {
    v4 = [v3 currentMobileAssetVersion];
    v5 = [v4 integerValue];

    v6 = [*(a1 + 32) workQueue];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke_1487;
    v14[3] = &unk_27867D900;
    v8 = *(a1 + 40);
    v7 = *(a1 + 48);
    v14[4] = *(a1 + 32);
    v16 = v7;
    v17 = v5;
    v15 = v8;
    dispatch_async(v6, v14);
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v19 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Unable to find MKFHome for current home to look up current mobile asset version", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke_1487(uint64_t a1)
{
  v29 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (v2)
  {
    v3 = *(a1 + 48);
    v4 = *(a1 + 56);
    v5 = [*(a1 + 32) workQueue];
    dispatch_assert_queue_V2(v5);

    if (v4 >= v3)
    {
      v12 = objc_autoreleasePoolPush();
      v13 = v2;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        *buf = 138543874;
        *&buf[4] = v15;
        *&buf[12] = 1024;
        *&buf[14] = v4;
        *&buf[18] = 1024;
        *&buf[20] = v3;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Home mobile asset version %d is newer than or equal to latest installed version %d", buf, 0x18u);
      }

      objc_autoreleasePoolPop(v12);
      v2 = [MEMORY[0x277D0F7C0] futureWithError:0];
    }

    else
    {
      v6 = [v2 accessories];
      v7 = [v6 na_map:&__block_literal_global_1490];

      if ([v7 hmf_isEmpty])
      {
        v8 = objc_autoreleasePoolPush();
        v9 = v2;
        v10 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          v11 = HMFGetLogIdentifier();
          *buf = 138543362;
          *&buf[4] = v11;
          _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@No lock accessories, finished updating mobile asset version", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v8);
        v2 = [MEMORY[0x277D0F7C0] futureWithNoValue];
      }

      else
      {
        v16 = [v2 dataSource];
        v17 = [v16 makeAccessoryMatterCapabilitiesForFilename:0];

        *buf = MEMORY[0x277D85DD0];
        *&buf[8] = 3221225472;
        *&buf[16] = __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1491;
        v26 = &unk_2786755C8;
        v27 = v7;
        v28 = v2;
        v2 = [v17 then:buf];
      }
    }
  }

  v22[0] = MEMORY[0x277D85DD0];
  v22[1] = 3221225472;
  v22[2] = __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke_2;
  v22[3] = &unk_27866FDF0;
  v18 = *(a1 + 40);
  v19 = *(a1 + 48);
  v22[4] = *(a1 + 32);
  v24 = v19;
  v23 = v18;
  v20 = [v2 inContext:v23 then:v22];

  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __69__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion___block_invoke_2(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [*(a1 + 32) uuid];
  v5 = [HMCContext findHomeWithModelID:v4];

  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 48);
      v16 = 138543618;
      v17 = v10;
      v18 = 2048;
      v19 = v11;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Updating home mobile asset version to %ld", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [MEMORY[0x277CCABB0] numberWithInteger:*(a1 + 48)];
    [v5 setCurrentMobileAssetVersion:v12];

    [*(a1 + 40) save];
  }

  else
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v16 = 138543362;
      v17 = v13;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Unable to find MKFHome for current home to update current mobile asset version", &v16, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
  }

  v14 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1491(uint64_t a1, void *a2)
{
  v30 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = *(a1 + 32);
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_2;
  v26[3] = &unk_27866FE18;
  v5 = v3;
  v6 = *(a1 + 40);
  v27 = v5;
  v28 = v6;
  v7 = [v4 na_map:v26];
  if ([v7 hmf_isEmpty])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 40);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543362;
      *&buf[4] = v11;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@No accessories needed updating updating mobile asset version", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    v12 = 1;
  }

  else
  {
    v13 = [*(a1 + 40) backingStore];
    v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v15 = [v13 transaction:@"UpdateACWGCertified" options:v14];

    [v15 addObjects:v7];
    *buf = 0;
    v16 = [MEMORY[0x277D0F7C0] futureWithPromise:buf];
    v17 = [*buf errorOnlyResolverBlock];
    [v15 run:v17];

    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1496;
    v24[3] = &unk_278689CB0;
    v25 = *(a1 + 40);
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1497;
    v23[3] = &unk_278689CD8;
    v23[4] = v25;
    v18 = [v16 then:v24 orRecover:v23];

    v19 = v18;
    if (!v19)
    {
      _HMFPreconditionFailure();
    }

    v20 = v19;
    v12 = 3;
  }

  v21 = *MEMORY[0x277D85DE8];
  return v12;
}

id __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_2(uint64_t a1, void *a2)
{
  v35 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 mfiCertifiedACWG];
  v5 = *(a1 + 32);
  v6 = [v3 matterVendorID];
  v7 = [v6 intValue];
  v8 = [v3 matterProductID];
  v9 = [v5 isCapabilityAllowed:0 vendorID:v7 productID:{objc_msgSend(v8, "intValue")}];

  v10 = 0;
  if (v4 != v9)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v3 shortDescription];
      v16 = [v3 matterVendorID];
      v17 = [v16 intValue];
      [v3 matterProductID];
      v18 = v22 = v11;
      *buf = 138544642;
      v24 = v14;
      v25 = 2114;
      v26 = v15;
      v27 = 1024;
      v28 = v17;
      v29 = 1024;
      v30 = [v18 intValue];
      v31 = 1024;
      v32 = v4;
      v33 = 1024;
      v34 = v9;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@ECB lock %{public}@ with VID %d, PID %d certified changed, old: %{BOOL}d, new: %{BOOL}d", buf, 0x2Eu);

      v11 = v22;
    }

    objc_autoreleasePoolPop(v11);
    v10 = [v3 transactionWithObjectChangeType:2];
    v19 = [MEMORY[0x277CCABB0] numberWithBool:v9];
    [v10 setMfiCertifiedACWG:v19];
  }

  v20 = *MEMORY[0x277D85DE8];

  return v10;
}

uint64_t __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1496(uint64_t a1, void *a2)
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v10 = 138543362;
    v11 = v7;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully updated ACWG status", &v10, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke_1497(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v13 = 138543618;
    v14 = v7;
    v15 = 2112;
    v16 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Unable to update certification status: %@", &v13, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = v3;
  v9 = v8;
  if (v8)
  {
    v10 = v8;
  }

  else
  {
    [MEMORY[0x277CCA9B8] hmfUnspecifiedError];
    objc_claimAutoreleasedReturnValue();
  }

  v11 = *MEMORY[0x277D85DE8];
  return 2;
}

id __88__HMDHome__maybeCheckACWGLocksForMFiCertificationWithContentVersion_homeContentVersion___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = 0;
  if ([v4 supportsACWGProvisioning])
  {
    v5 = v4;
  }

  return v5;
}

- (void)_handleResidentChange
{
  v24 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setMigratingAfterResidentChange:0];
  v20 = 0u;
  v21 = 0u;
  v18 = 0u;
  v19 = 0u;
  v3 = [(HMDHome *)self triggers];
  v4 = [v3 countByEnumeratingWithState:&v18 objects:v23 count:16];
  if (v4)
  {
    v5 = *v19;
    v6 = MEMORY[0x277D85DD0];
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v19 != v5)
        {
          objc_enumerationMutation(v3);
        }

        v8 = *(*(&v18 + 1) + 8 * i);
        objc_initWeak(location, v8);
        v16[0] = v6;
        v16[1] = 3221225472;
        v16[2] = __32__HMDHome__handleResidentChange__block_invoke;
        v16[3] = &unk_278688A18;
        objc_copyWeak(&v17, location);
        [v8 activateAfterResidentChangeWithCompletion:v16];
        objc_destroyWeak(&v17);
        objc_destroyWeak(location);
      }

      v4 = [v3 countByEnumeratingWithState:&v18 objects:v23 count:16];
    }

    while (v4);
  }

  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    LODWORD(location[0]) = 138543362;
    *(location + 4) = v12;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Calling presence feeder to notify the presence status to the new resident", location, 0xCu);
  }

  objc_autoreleasePoolPop(v9);
  v13 = [(HMDHome *)v10 presenceMonitor];
  [v13 residentChanged];

  v14 = [(HMDHome *)v10 periodicReader];
  [v14 residentUpdated];

  [(HMDHome *)v10 _evaluateNetworkProtectionAndRouterManagement];
  v15 = *MEMORY[0x277D85DE8];
}

void __32__HMDHome__handleResidentChange__block_invoke(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543618;
      v11 = v8;
      v12 = 2112;
      v13 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Activating trigger after resident change finished with error (%@)", &v10, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)migrateAfterResidentChange
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v16 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@migrateAfterResidentChange", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  if ([(HMDHome *)v4 isMigratingAfterResidentChange])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = v4;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v16 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Migration after resident change is already running", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
  }

  else
  {
    [(HMDHome *)v4 setMigratingAfterResidentChange:1];
    objc_initWeak(buf, v4);
    v11 = [(HMDHome *)v4 backingStore];
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __37__HMDHome_migrateAfterResidentChange__block_invoke;
    v13[3] = &unk_278688A18;
    objc_copyWeak(&v14, buf);
    [v11 submitBlock:v13];

    objc_destroyWeak(&v14);
    objc_destroyWeak(buf);
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __37__HMDHome_migrateAfterResidentChange__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _handleResidentChange];
}

- (void)removeResidentCapableDevice:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self isOwnerUser])
  {
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v5 = [(HMDHome *)self residentDeviceManager];
    v6 = [v5 residentDevices];

    v7 = [v6 countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (v7)
    {
      v8 = v7;
      v9 = *v22;
      while (2)
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v22 != v9)
          {
            objc_enumerationMutation(v6);
          }

          v11 = *(*(&v21 + 1) + 8 * i);
          v12 = [v11 device];
          v13 = [v12 isEqual:v4];

          if (v13)
          {
            v19 = [(HMDHome *)self residentDeviceManager];
            [v19 removeResidentDevice:v11];

            goto LABEL_16;
          }
        }

        v8 = [v6 countByEnumeratingWithState:&v21 objects:v25 count:16];
        if (v8)
        {
          continue;
        }

        break;
      }
    }

    if ([v4 isCurrentDevice])
    {
      v14 = [(HMDHome *)self notificationRegistry];
      [v14 clearAllRegistrations];
    }
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v18;
      v28 = 2112;
      v29 = v4;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Attempting to remove resident on non-owner home -- device: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
  }

LABEL_16:

  v20 = *MEMORY[0x277D85DE8];
}

- (void)addResidentCapableDevice:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [v4 capabilities];
    v6 = [v5 isResidentCapable];

    if (v6)
    {
      v33 = 0u;
      v34 = 0u;
      v31 = 0u;
      v32 = 0u;
      v7 = [(HMDHome *)self residentDeviceManager];
      v8 = [v7 residentDevices];

      v9 = [v8 countByEnumeratingWithState:&v31 objects:v39 count:16];
      if (v9)
      {
        v10 = v9;
        v11 = *v32;
        while (2)
        {
          for (i = 0; i != v10; ++i)
          {
            if (*v32 != v11)
            {
              objc_enumerationMutation(v8);
            }

            v13 = *(*(&v31 + 1) + 8 * i);
            v14 = [v13 device];
            v15 = [v14 isEqual:v4];

            if (v15)
            {
              v26 = objc_autoreleasePoolPush();
              v27 = self;
              v28 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v28, OS_LOG_TYPE_DEBUG))
              {
                v29 = HMFGetLogIdentifier();
                *buf = 138543618;
                v36 = v29;
                v37 = 2112;
                v38 = v13;
                _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_DEBUG, "%{public}@Resident device already exists, refraining from creating a new transaction: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v26);
              goto LABEL_17;
            }
          }

          v10 = [v8 countByEnumeratingWithState:&v31 objects:v39 count:16];
          if (v10)
          {
            continue;
          }

          break;
        }
      }

      v16 = [(HMDHome *)self uuid];
      v17 = [v4 identifier];
      v8 = [HMDResidentDevice deriveUUIDFromHomeUUID:v16 deviceUUID:v17];

      v18 = [HMDResidentDeviceModel alloc];
      v19 = [(HMDHome *)self uuid];
      v20 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:1 uuid:v8 parentUUID:v19];

      [(HMDResidentDeviceModel *)v20 setEnabled:MEMORY[0x277CBEC38]];
      v21 = [v4 identifier];
      v22 = [v21 UUIDString];
      [(HMDResidentDeviceModel *)v20 setDeviceUUID:v22];

      if ([v4 isCurrentDevice])
      {
        [(HMDResidentDeviceModel *)v20 setDevice:v4];
      }

      v23 = [(HMDHome *)self backingStore];
      v24 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v25 = [v23 transaction:@"addResidentCapableDevice" options:v24];

      [v25 add:v20 withMessage:0];
      [v25 run];

LABEL_17:
    }
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (NSArray)enabledResidents
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v4 = [(HMDHome *)self residentDeviceManager];
  v5 = [v4 residentDevices];

  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v13 + 1) + 8 * i);
        if ([v10 isEnabled])
        {
          [v3 addObject:v10];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return v3;
}

- (NSArray)residentEnabledDevices
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v4 = [(HMDHome *)self residentDeviceManager];
  v5 = [v4 residentDevices];

  v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v15;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v15 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v14 + 1) + 8 * i);
        if ([v10 isEnabled])
        {
          v11 = [v10 device];
          [v3 addObject:v11];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v7);
  }

  v12 = *MEMORY[0x277D85DE8];

  return v3;
}

- (NSArray)residentCapableDevices
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v4 = [(HMDHome *)self residentDeviceManager];
  v5 = [v4 residentDevices];

  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = [*(*(&v13 + 1) + 8 * i) device];
        [v3 addObject:v10];
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return v3;
}

- (void)_handleSetResidentElectionVersion:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = [v5 hmf_numberForKey:*MEMORY[0x277CD0440]];

  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [(HMDHome *)v8 residentSelectionVersion];
      v24 = 138543874;
      v25 = v10;
      v26 = 2114;
      v27 = v11;
      v28 = 2114;
      v29 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Received request to update resident selection version from %{public}@ to %{public}@", &v24, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
    v12 = [HMDHomeModel alloc];
    v13 = [(HMDHome *)v8 uuid];
    v14 = [(HMDHome *)v8 homeManager];
    v15 = [v14 uuid];
    v16 = [(HMDBackingStoreModelObject *)v12 initWithObjectChangeType:2 uuid:v13 parentUUID:v15];

    [(HMDHomeModel *)v16 setResidentSelectionVersion:v6];
    v17 = [v4 untrustedClientIdentifier];
    v18 = [HMDBackingStoreTransactionOptions defaultXPCOptionsWithCDTransactionAuthor:10 clientIdentifier:v17];

    v19 = [(HMDHome *)v8 backingStore];
    v20 = [v4 name];
    v21 = [v19 transaction:v20 options:v18];

    [v21 add:v16 withMessage:v4];
    [v21 run];
  }

  else
  {
    v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v22];
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)setResidentSelectionVersion:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  residentSelectionVersion = self->_residentSelectionVersion;
  self->_residentSelectionVersion = v4;

  os_unfair_recursive_lock_unlock();

  logAndPostNotification(@"HMDHomeResidentSelectionVersionDidChangeNotification", self, 0);
}

- (NSNumber)residentSelectionVersion
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_residentSelectionVersion;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setPrimaryResidentNetworkInfo:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  primaryResidentNetworkInfo = self->_primaryResidentNetworkInfo;
  self->_primaryResidentNetworkInfo = v4;

  os_unfair_recursive_lock_unlock();
}

- (HMHomeNetworkInfo)primaryResidentNetworkInfo
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_primaryResidentNetworkInfo;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (BOOL)hasAnyResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 hasAnyResident];

  return v3;
}

- (BOOL)doesHomeContainResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 residentDevices];
  v4 = [v3 count] != 0;

  return v4;
}

- (NSNumber)matterFabricID
{
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    [(HMDHome *)self fabric];
  }

  else
  {
    [(HMDHome *)self chipStorage];
  }
  v3 = ;
  v4 = [v3 fabricID];

  return v4;
}

- (BOOL)isCurrentDeviceConfirmedPrimaryResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 isCurrentDeviceConfirmedPrimaryResident];

  return v3;
}

- (id)_hasConfirmedPrimaryResidentDevice
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 confirmedPrimaryResidentDevice];

  return v3;
}

- (BOOL)hasResidentDevicesForPrimaryResidentChangeMonitor:(id)a3
{
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 residentDevices];
  v5 = [v4 count] != 0;

  return v5;
}

- (BOOL)residentSyncDidSync
{
  if ([(HMDHome *)self residentSyncClientDidSync])
  {
    return 1;
  }

  return [(HMDHome *)self isCurrentDevicePrimaryResident];
}

- (BOOL)isCurrentDevicePrimaryResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 isCurrentDevicePrimaryResident];

  return v3;
}

- (BOOL)isResidentSupported
{
  isWatch();
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 isResidentAvailable];

  return v4;
}

- (void)_handleHAPAccessoryCharacteristicsUpdatedForAccessory:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [(HMDHome *)self notificationRegistrations];
  v7 = [v6 count];

  if (!v7)
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v24 = v18;
      v25 = 2112;
      v26 = v4;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote notifications for %@ as there are no home notification registered clients", buf, 0x16u);
    }

    v14 = v15;
    goto LABEL_9;
  }

  v8 = [(HMDHome *)self isCurrentDevicePrimaryResident];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  v12 = v11;
  if (v8)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v24 = v13;
      v25 = 2112;
      v26 = v4;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote notifications for %@ as we are the primary resident", buf, 0x16u);
    }

    v14 = v9;
LABEL_9:
    objc_autoreleasePoolPop(v14);
    goto LABEL_13;
  }

  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    *buf = 138543618;
    v24 = v19;
    v25 = 2112;
    v26 = v4;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Updating remote registrations for %@ as we have a client registered for all accessories and the characteristics on the accessory have changed", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v22 = v4;
  v20 = [MEMORY[0x277CBEA60] arrayWithObjects:&v22 count:1];
  [(HMDHome *)v10 _subscribeForHomeNotificationsFromRemoteGateway:1 accessories:v20];

LABEL_13:
  v21 = *MEMORY[0x277D85DE8];
}

- (void)handleHAPAccessoryServicesAddedNotification:(id)a3
{
  v29 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 userInfo];
  v6 = [v5 objectForKeyedSubscript:@"HMDAccessoryKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  if (!v8)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v17;
      v18 = "%{public}@Got kHMDNotificationServicesUpdated notification without accessory";
      v19 = v16;
      v20 = OS_LOG_TYPE_ERROR;
      v21 = 12;
LABEL_11:
      _os_log_impl(&dword_229538000, v19, v20, v18, buf, v21);
    }

LABEL_12:

    objc_autoreleasePoolPop(v14);
    goto LABEL_13;
  }

  v9 = [v8 home];
  v10 = [v9 uuid];
  v11 = [(HMDHome *)self uuid];
  v12 = [v10 hmf_isEqualToUUID:v11];

  if ((v12 & 1) == 0)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543618;
      v26 = v17;
      v27 = 2112;
      v28 = v8;
      v18 = "%{public}@%@ is not in our home, ignoring";
      v19 = v16;
      v20 = OS_LOG_TYPE_DEBUG;
      v21 = 22;
      goto LABEL_11;
    }

    goto LABEL_12;
  }

  v13 = [(HMDHome *)self workQueue];
  v23[0] = MEMORY[0x277D85DD0];
  v23[1] = 3221225472;
  v23[2] = __55__HMDHome_handleHAPAccessoryServicesAddedNotification___block_invoke;
  v23[3] = &unk_27868A750;
  v23[4] = self;
  v24 = v8;
  dispatch_async(v13, v23);

LABEL_13:
  v22 = *MEMORY[0x277D85DE8];
}

- (void)handleHAPAccessoryCharacteristicsAddedNotification:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 userInfo];
  v6 = [v5 objectForKeyedSubscript:@"HMDAccessoryKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  if (v8)
  {
    v9 = [v8 home];
    v10 = [v9 uuid];
    v11 = [(HMDHome *)self uuid];
    v12 = [v10 hmf_isEqualToUUID:v11];

    if (v12)
    {
      v13 = [(HMDHome *)self workQueue];
      v19[0] = MEMORY[0x277D85DD0];
      v19[1] = 3221225472;
      v19[2] = __62__HMDHome_handleHAPAccessoryCharacteristicsAddedNotification___block_invoke;
      v19[3] = &unk_27868A750;
      v19[4] = self;
      v20 = v8;
      dispatch_async(v13, v19);
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v22 = v17;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Got kHMDNotificationServicesUpdated notification without accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleCharacteristicEnableNotification:(id)a3
{
  v95 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v68 = v3;
  if ([v3 isRemote] && (objc_msgSend(v3, "isSecureRemote") & 1) == 0)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v13;
      *&buf[12] = 2112;
      *&buf[14] = v68;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [v68 responseHandler];

    if (v14)
    {
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      v16 = [v68 responseHandler];
      (v16)[2](v16, v15, 0);
    }
  }

  else
  {
    v4 = [v3 messagePayload];
    v66 = [v4 objectForKey:@"kNotificationEnablePayloadKey"];

    if (v66)
    {
      v5 = @"kNotificationEnablePayloadKey";
    }

    else
    {
      v6 = [v68 messagePayload];
      v7 = [v6 objectForKey:@"kNotificationDisablePayloadKey"];

      if (!v7)
      {
        v57 = [v68 responseHandler];
        v58 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        (v57)[2](v57, v58, 0);

        goto LABEL_49;
      }

      v5 = @"kNotificationDisablePayloadKey";
    }

    v67 = [v68 dictionaryForKey:v5];
    v8 = [v68 clientIdentifier];

    if (v8)
    {
      v9 = [v68 clientIdentifier];
      v65 = [@"com.apple.HomeKit.client." stringByAppendingString:v9];
    }

    else
    {
      v65 = @"com.apple.HomeKitDaemon";
      v17 = @"com.apple.HomeKitDaemon";
    }

    v62 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v86 = 0u;
    v87 = 0u;
    v84 = 0u;
    v85 = 0u;
    obj = [v67 allKeys];
    v71 = [obj countByEnumeratingWithState:&v84 objects:v94 count:16];
    if (v71)
    {
      v69 = *v85;
      v19 = @"disable";
      if (v66)
      {
        v19 = @"enable";
      }

      v60 = v19;
      *&v18 = 138544642;
      v59 = v18;
      do
      {
        for (i = 0; i != v71; ++i)
        {
          if (*v85 != v69)
          {
            objc_enumerationMutation(obj);
          }

          v21 = *(*(&v84 + 1) + 8 * i);
          v22 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v21];
          v23 = [(HMDHome *)self accessoryWithUUID:v22];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          if (v25)
          {
            v26 = [v67 hmf_arrayForKey:v21];
            if ([v26 count])
            {
              [v62 setObject:v26 forKey:v25];
            }

            else
            {
              context = objc_autoreleasePoolPush();
              v34 = self;
              v35 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
              {
                v61 = HMFGetLogIdentifier();
                v36 = [(HMDHome *)v34 name];
                v37 = [(HMDHome *)v34 uuid];
                v38 = [v37 UUIDString];
                v39 = [v25 name];
                *buf = v59;
                *&buf[4] = v61;
                *&buf[12] = 2112;
                *&buf[14] = v36;
                *&buf[22] = 2112;
                v90 = v38;
                *v91 = 2112;
                *&v91[2] = v60;
                *&v91[10] = 2112;
                *&v91[12] = v39;
                v92 = 2112;
                v93 = v21;
                _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@%@/%@: Received notification %@ for zero characteristics on accessory %@/%@", buf, 0x3Eu);
              }

              objc_autoreleasePoolPop(context);
            }
          }

          else
          {
            v27 = objc_autoreleasePoolPush();
            v28 = self;
            v29 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
            {
              v30 = HMFGetLogIdentifier();
              v31 = [(HMDHome *)v28 name];
              v32 = [(HMDHome *)v28 uuid];
              v33 = [v32 UUIDString];
              *buf = 138544386;
              *&buf[4] = v30;
              *&buf[12] = 2112;
              *&buf[14] = v31;
              *&buf[22] = 2112;
              v90 = v33;
              *v91 = 2112;
              *&v91[2] = v60;
              *&v91[10] = 2112;
              *&v91[12] = v21;
              _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@%@/%@: Received notification %@ for different accessory: %@", buf, 0x34u);
            }

            objc_autoreleasePoolPop(v27);
          }
        }

        v71 = [obj countByEnumeratingWithState:&v84 objects:v94 count:16];
      }

      while (v71);
    }

    v40 = [v62 count];
    if (v40)
    {
      v41 = dispatch_group_create();
      *buf = 0;
      *&buf[8] = buf;
      *&buf[16] = 0x3032000000;
      v90 = __Block_byref_object_copy__14759;
      *v91 = __Block_byref_object_dispose__14760;
      *&v91[8] = 0;
      v80 = 0u;
      v81 = 0u;
      v82 = 0u;
      v83 = 0u;
      v42 = v62;
      v43 = [v42 countByEnumeratingWithState:&v80 objects:v88 count:16];
      if (v43)
      {
        v44 = 0;
        v45 = *v81;
        v70 = v40 - 1;
        do
        {
          v46 = 0;
          v47 = v70 - v44;
          v72 = v44 + v43;
          do
          {
            if (*v81 != v45)
            {
              objc_enumerationMutation(v42);
            }

            v48 = *(*(&v80 + 1) + 8 * v46);
            dispatch_group_enter(v41);
            v49 = MEMORY[0x277D0F818];
            v77[0] = MEMORY[0x277D85DD0];
            v77[1] = 3221225472;
            v77[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke;
            v77[3] = &unk_278670C30;
            v77[4] = self;
            v79 = buf;
            v78 = v41;
            v50 = [v49 messageWithMessage:v68 messagePayload:0 responseHandler:v77];
            v51 = [v50 mutableCopy];

            if (v47 != v46)
            {
              v52 = [MEMORY[0x277CCAD78] UUID];
              [v51 setIdentifier:v52];
            }

            v53 = [v42 objectForKey:{v48, v59}];
            [v48 enableNotification:v66 != 0 forCharacteristicIDs:v53 message:v51 clientIdentifier:v65];

            ++v46;
          }

          while (v43 != v46);
          v43 = [v42 countByEnumeratingWithState:&v80 objects:v88 count:16];
          v44 = v72;
        }

        while (v43);
      }

      v54 = [(HMDHome *)self workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_3;
      block[3] = &unk_27868A688;
      v75 = v68;
      v76 = buf;
      dispatch_group_notify(v41, v54, block);

      _Block_object_dispose(buf, 8);
    }

    else
    {
      v41 = [v68 responseHandler];
      v55 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (*(v41 + 16))(v41, v55, 0);
    }
  }

LABEL_49:

  v56 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_2;
  block[3] = &unk_27868A4D8;
  v9 = v3;
  v7 = *(a1 + 40);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  dispatch_async(v4, block);
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_3(uint64_t a1)
{
  v2 = [*(a1 + 32) responseHandler];

  if (v2)
  {
    v3 = [*(a1 + 32) responseHandler];
    (*(v3 + 2))(v3, *(*(*(a1 + 40) + 8) + 40), 0);
  }
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_2(uint64_t a1)
{
  v2 = *(*(a1 + 48) + 8);
  v4 = *(v2 + 40);
  v3 = (v2 + 40);
  if (!v4)
  {
    objc_storeStrong(v3, *(a1 + 32));
  }

  v5 = *(a1 + 40);

  dispatch_group_leave(v5);
}

HMDCharacteristicUpdateTuple *__45__HMDHome__handlePendingResponsesTimerFired___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 error];

  if (v3)
  {
    v4 = 0;
  }

  else
  {
    v5 = [HMDCharacteristicUpdateTuple alloc];
    v6 = [v2 request];
    v7 = [v6 characteristic];
    v8 = [v2 value];
    v4 = [(HMDCharacteristicUpdateTuple *)v5 initWithCharacteristic:v7 updatedValue:v8 isBroadcast:0];
  }

  return v4;
}

- (void)_handleSendingNotificationsForRequest:(id)a3 requestIdentifier:(id)a4 supportsMultiPartResponse:(BOOL)a5 characteristicUpdates:(id)a6 completion:(id)a7
{
  v9 = a5;
  v53 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a6;
  v15 = a7;
  v16 = [v12 destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = v16;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  if ([v12 isRemote] && (objc_msgSend(v18, "device"), v19 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v19, "remoteDestinationString"), v20 = objc_claimAutoreleasedReturnValue(), v20, v19, v20))
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      v38 = v24;
      v25 = [v12 shortDescription];
      v26 = "single";
      if (v9)
      {
        v26 = "multi";
      }

      v35 = v26;
      v36 = v25;
      v27 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v14, "count")}];
      v37 = [v18 device];
      [v37 remoteDestinationString];
      *buf = 138544898;
      v40 = v24;
      v41 = 2112;
      v42 = v36;
      v43 = 2080;
      v44 = v35;
      v45 = 2112;
      v46 = v27;
      v47 = 2112;
      v48 = v14;
      v49 = 2112;
      v50 = v13;
      v52 = v51 = 2112;
      v28 = v52;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Response notification for %@ (%s part) [%@] with chars: %@ with id: %@ to device: %@", buf, 0x48u);
    }

    objc_autoreleasePoolPop(v21);
    v29 = [MEMORY[0x277CCAD78] UUID];
    v30 = [v29 UUIDString];
    v31 = [v18 device];
    v32 = [v31 remoteDestinationString];
    [(HMDHome *)v22 _notifyUpdatedCharacteristic:v14 withRequestIdentifier:v13 notificationUpdateIdentifier:v30 toUserDeviceAddress:v32 completion:v15];
  }

  else if (v15)
  {
    v33 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    v15[2](v15, v33);
  }

  v34 = *MEMORY[0x277D85DE8];
}

- (void)_handleMultipleCharacteristicRead:(id)a3
{
  v47 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277D0F770] currentActivity];
  if ([v4 isRemote] && (objc_msgSend(v4, "isSecureRemote") & 1) == 0)
  {
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
    {
      goto LABEL_22;
    }

    v20 = HMFGetLogIdentifier();
    *buf = 138543618;
    v40 = v20;
    v41 = 2112;
    v42 = v4;
    v21 = "%{public}@Message not supported: %@";
    v22 = v19;
    v23 = 22;
    goto LABEL_21;
  }

  if ([v4 isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(v4, "isRemote"))
  {
    v38 = 0;
    v6 = [(HMDHome *)self _readRequestTuplesFromMessage:v4 outUnhandledRequests:&v38];
    v7 = v38;
    if ([v6 count])
    {
      if ([v7 count])
      {
        v8 = objc_autoreleasePoolPush();
        v9 = self;
        v10 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          v11 = HMFGetLogIdentifier();
          v12 = [v4 shortDescription];
          *buf = 138543874;
          v40 = v11;
          v41 = 2112;
          v42 = v12;
          v43 = 2112;
          v44 = v7;
          _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@%@ has characteristic requests that cannot be handled: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v8);
      }

      v13 = [v4 source];
      [v6 count];
      [v4 isRemote];
      v14 = HMDRequestSourceAsString(v13);
      v15 = [v4 userForHome:self];
      if (v15 && ![(HMDHome *)self areCharacteristicRequests:v6 allowedForUser:v15])
      {
        v30 = objc_autoreleasePoolPush();
        v31 = self;
        v32 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
        {
          v33 = HMFGetLogIdentifier();
          v34 = [v15 restrictedGuestAccessSettings];
          [v34 uuidsOfAllowedAccessories];
          v35 = v37 = v30;
          *buf = 138544130;
          v40 = v33;
          v41 = 2112;
          v42 = v4;
          v43 = 2112;
          v44 = v15;
          v45 = 2112;
          v46 = v35;
          _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Rejecting message which is not allowed for user. Message: %@, user: %@, allowedAccessories: %@", buf, 0x2Au);

          v30 = v37;
        }

        objc_autoreleasePoolPop(v30);
        v16 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2906];
        [v4 respondWithError:v16];
      }

      else
      {
        [(HMDHome *)self startReportingSessionForMessage:v4];
        v16 = [(HMDHome *)self __readWriteResponseHandler:v4 unhandledRequests:v7];
        [(HMDHome *)self _readCharacteristicValues:v6 requestMessage:v4 source:v13 withCompletionHandler:v16];
      }
    }

    else
    {
      v24 = objc_autoreleasePoolPush();
      v25 = self;
      v26 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
      {
        v27 = HMFGetLogIdentifier();
        *buf = 138543362;
        v40 = v27;
        _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_DEFAULT, "%{public}@None of the characteristics/properties in multi-read are valid", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v24);
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v15 domain];

      [v15 code];
      v28 = [v4 responseHandler];

      if (!v28)
      {
        goto LABEL_28;
      }

      v16 = [v4 responseHandler];
      (v16)[2](v16, v15, 0);
    }

LABEL_28:
    goto LABEL_29;
  }

  v17 = objc_autoreleasePoolPush();
  v18 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 138543362;
    v40 = v20;
    v21 = "%{public}@Client does not have entitlement to use SPI";
    v22 = v19;
    v23 = 12;
LABEL_21:
    _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEFAULT, v21, buf, v23);
  }

LABEL_22:

  objc_autoreleasePoolPop(v17);
  v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
  [v7 domain];

  [v7 code];
  v29 = [v4 responseHandler];

  if (v29)
  {
    v6 = [v4 responseHandler];
    (v6)[2](v6, v7, 0);
LABEL_29:
  }

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleCharacteristicRead:(id)a3
{
  v65[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = [v5 hmf_UUIDForKey:*MEMORY[0x277CCF0B0]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  if (v9)
  {
    v10 = [v4 messagePayload];
    v11 = [v10 objectForKeyedSubscript:*MEMORY[0x277CD25F8]];

    v12 = [v4 messagePayload];
    v13 = [v12 objectForKeyedSubscript:*MEMORY[0x277CD2140]];

    v14 = [v9 findService:v11];
    v15 = [v14 findCharacteristic:v13];
    v16 = v15;
    if (v15)
    {
      v49 = v11;
      v65[0] = v15;
      v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v65 count:1];
      v50 = 0;
      v18 = [(HMDHome *)self _isReadRequestAllowForCharacteristics:v17 message:v4 error:&v50];
      v19 = v50;

      if (v18)
      {
        v46 = v19;
        v20 = [HMDCharacteristicRequest requestWithCharacteristic:v16];
        v44 = [v4 source];
        v21 = [v4 userForHome:self];
        v47 = v21;
        v48 = v20;
        if (v21 && (v22 = v21, v64 = v20, [MEMORY[0x277CBEA60] arrayWithObjects:&v64 count:1], v23 = objc_claimAutoreleasedReturnValue(), LOBYTE(v22) = -[HMDHome areCharacteristicRequests:allowedForUser:](self, "areCharacteristicRequests:allowedForUser:", v23, v22), v23, v20 = v48, (v22 & 1) == 0))
        {
          v45 = objc_autoreleasePoolPush();
          v34 = self;
          v35 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
          {
            v36 = HMFGetLogIdentifier();
            contexta = [v47 restrictedGuestAccessSettings];
            v37 = [contexta uuidsOfAllowedAccessories];
            *buf = 138544130;
            v53 = v36;
            v54 = 2112;
            v55 = v4;
            v56 = 2112;
            v57 = v47;
            v58 = 2112;
            v59 = v37;
            v38 = v37;
            _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Rejecting message which is not allowed for user. Message: %@, user: %@, allowedAccessories: %@", buf, 0x2Au);

            v20 = v48;
          }

          objc_autoreleasePoolPop(v45);
          v31 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2906];
          [v4 respondWithError:v31];
        }

        else
        {
          context = objc_autoreleasePoolPush();
          v24 = self;
          v25 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
          {
            v40 = HMFGetLogIdentifier();
            v26 = [v4 shortDescription];
            [v6 UUIDString];
            v27 = v41 = v14;
            v28 = [v9 uniqueIdentifier];
            *buf = 138544642;
            v53 = v40;
            v54 = 2112;
            v55 = v26;
            v29 = v26;
            v56 = 2112;
            v57 = v27;
            v58 = 2112;
            v59 = v28;
            v30 = v28;
            v60 = 2112;
            v61 = v49;
            v62 = 2112;
            v63 = v13;
            _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Processing single characteristic read request: %@ (%@/%@/%@/%@) as a special case of multiple characteristic read requests", buf, 0x3Eu);

            v20 = v48;
            v14 = v41;
          }

          objc_autoreleasePoolPop(context);
          v51 = v20;
          v31 = [MEMORY[0x277CBEA60] arrayWithObjects:&v51 count:1];
          v32 = [(HMDHome *)v24 __readWriteResponseHandler:v4 unhandledRequests:0];
          [(HMDHome *)v24 _readCharacteristicValues:v31 requestMessage:v4 source:v44 withCompletionHandler:v32];

          v20 = v48;
        }

        v19 = v46;
      }

      else
      {
        [v4 respondWithError:v19];
      }

      v11 = v49;
    }

    else
    {
      v33 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v33];
    }
  }

  else
  {
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v11];
  }

  v39 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isReadRequestAllowForCharacteristics:(id)a3 message:(id)a4 error:(id *)a5
{
  v8 = a4;
  if ([(HMDHome *)self requiresUnlockToAccessCharacteristics:a3 withMessage:v8]&& ![(HMDHome *)self isAccessAllowedForCharacteristicsWithMessage:v8])
  {
    if (a5)
    {
      HMDSecureAccessErrorCodeForMessage(v8, [v8 source]);
      *a5 = v9 = 0;
    }

    else
    {
      v9 = 0;
    }
  }

  else
  {
    v9 = 1;
  }

  return v9;
}

- (id)_readRequestTuplesFromMessage:(id)a3 outUnhandledRequests:(id *)a4
{
  v33 = a4;
  v66 = *MEMORY[0x277D85DE8];
  v34 = a3;
  v4 = [v34 dictionaryForKey:*MEMORY[0x277CCE7A8]];
  v5 = [MEMORY[0x277CBEB18] array];
  v48 = objc_alloc_init(MEMORY[0x277CBEB38]);
  v59 = 0u;
  v60 = 0u;
  v61 = 0u;
  v62 = 0u;
  obj = v4;
  v37 = [obj countByEnumeratingWithState:&v59 objects:v65 count:16];
  if (v37)
  {
    v35 = *v60;
    v47 = v5;
    do
    {
      v6 = 0;
      do
      {
        if (*v60 != v35)
        {
          objc_enumerationMutation(obj);
        }

        v39 = v6;
        v7 = *(*(&v59 + 1) + 8 * v6);
        v8 = [obj hmf_dictionaryForKey:{v7, v33}];
        v49 = v7;
        v9 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v7];
        v10 = [(HMDHome *)self accessoryWithUUID:v9];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v41 = v11;

        v57 = 0u;
        v58 = 0u;
        v55 = 0u;
        v56 = 0u;
        v12 = v8;
        v5 = v47;
        v43 = [v12 countByEnumeratingWithState:&v55 objects:v64 count:16];
        if (v43)
        {
          v42 = *v56;
          v40 = v12;
          do
          {
            for (i = 0; i != v43; ++i)
            {
              if (*v56 != v42)
              {
                objc_enumerationMutation(v12);
              }

              v14 = *(*(&v55 + 1) + 8 * i);
              v15 = [v12 hmf_arrayForKey:v14];
              v16 = [v15 na_map:&__block_literal_global_1862];

              v17 = HAPInstanceIDFromValue();
              if (v17)
              {
                v46 = i;
                v44 = v17;
                v18 = [v41 findService:v17];
                v51 = 0u;
                v52 = 0u;
                v53 = 0u;
                v54 = 0u;
                v45 = v16;
                v19 = v16;
                v20 = [v19 countByEnumeratingWithState:&v51 objects:v63 count:16];
                if (v20)
                {
                  v21 = v20;
                  v22 = *v52;
                  do
                  {
                    for (j = 0; j != v21; ++j)
                    {
                      if (*v52 != v22)
                      {
                        objc_enumerationMutation(v19);
                      }

                      v24 = *(*(&v51 + 1) + 8 * j);
                      v25 = [v18 findCharacteristic:v24];
                      if (v25)
                      {
                        [v5 addObject:v25];
                      }

                      else
                      {
                        v26 = [v48 hmf_mutableDictionaryForKey:v49];
                        if (!v26)
                        {
                          v26 = objc_alloc_init(MEMORY[0x277CBEB38]);
                          [v48 setObject:v26 forKeyedSubscript:v49];
                        }

                        v27 = [v26 hmf_mutableArrayForKey:v14];
                        if (!v27)
                        {
                          v27 = objc_alloc_init(MEMORY[0x277CBEB18]);
                          [v26 setObject:v27 forKeyedSubscript:v14];
                        }

                        [v27 addObject:v24];

                        v5 = v47;
                      }
                    }

                    v21 = [v19 countByEnumeratingWithState:&v51 objects:v63 count:16];
                  }

                  while (v21);
                }

                v12 = v40;
                v16 = v45;
                i = v46;
                v17 = v44;
              }
            }

            v43 = [v12 countByEnumeratingWithState:&v55 objects:v64 count:16];
          }

          while (v43);
        }

        v6 = v39 + 1;
      }

      while (v39 + 1 != v37);
      v37 = [obj countByEnumeratingWithState:&v59 objects:v65 count:16];
    }

    while (v37);
  }

  if (v33)
  {
    *v33 = [v48 copy];
  }

  v50 = 0;
  v28 = [(HMDHome *)self _isReadRequestAllowForCharacteristics:v5 message:v34 error:&v50, v33];
  v29 = v50;
  if (v28)
  {
    v30 = [v5 na_map:&__block_literal_global_1864];
  }

  else
  {
    [v34 respondWithError:v29];
    v30 = 0;
  }

  v31 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_readCharacteristicValues:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 withCompletionHandler:(id)a6
{
  v33 = *MEMORY[0x277D85DE8];
  v11 = a3;
  v12 = a4;
  v13 = a6;
  v14 = objc_alloc(MEMORY[0x277D0F770]);
  v15 = MEMORY[0x277CCACA8];
  v16 = MEMORY[0x22AAD2510](self, a2);
  v17 = [v15 stringWithFormat:@"%@, %s:%ld", v16, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 27461];
  v28 = [v14 initWithName:v17];

  LOBYTE(v14) = [(HMDHome *)self isCurrentDeviceAvailableResident];
  v18 = objc_autoreleasePoolPush();
  v19 = self;
  if (v14)
  {
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      v22 = [v12 shortDescription];
      *buf = 138543618;
      v30 = v21;
      v31 = 2112;
      v32 = v22;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Running new accessory communication logic for resident. %@", buf, 0x16u);
    }
  }

  else
  {
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      v24 = [v12 shortDescription];
      *buf = 138543618;
      v30 = v23;
      v31 = 2112;
      v32 = v24;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Routing accessory read requests using Resident First logic. %@", buf, 0x16u);
    }
  }

  objc_autoreleasePoolPop(v18);
  v25 = [(HMDHome *)v19 _createMessageForReadWriteRequest:v12 source:a5 withCompletionHandler:v13];
  v26 = [(HMDHome *)v19 accessoryReaderWriter];
  [v26 submitReadRequests:v11 sourceType:a5 requestMessage:v25];

  __HMFActivityScopeLeave();
  v27 = *MEMORY[0x277D85DE8];
}

- (void)readCharacteristicValues:(id)a3 source:(unint64_t)a4 sourceForLogging:(id)a5 qualityOfService:(int64_t)a6 withCompletionHandler:(id)a7
{
  v13 = a3;
  v14 = a5;
  v15 = a7;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x22AAD2510](self, a2);
  v19 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 27070];
  v32 = [v16 initWithName:v19];

  v20 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __99__HMDHome_readCharacteristicValues_source_sourceForLogging_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_278670678;
  v25 = v32;
  v26 = self;
  v27 = v14;
  v28 = v13;
  v30 = a6;
  v31 = a4;
  v29 = v15;
  v21 = v15;
  v22 = v13;
  v23 = v14;
  dispatch_async(v20, block);

  __HMFActivityScopeLeave();
}

void __99__HMDHome_readCharacteristicValues_source_sourceForLogging_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  v21[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277D0F818];
  v3 = *(a1 + 72);
  v4 = [MEMORY[0x277D0F820] allMessageDestinations];
  v20 = @"kMultiPartResponseKey";
  v21[0] = MEMORY[0x277CBEC28];
  v5 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v21 forKeys:&v20 count:1];
  v6 = [v2 messageWithName:@"kMultipleCharacteristicReadRequestKey" qualityOfService:v3 destination:v4 payload:v5];

  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 40);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [v6 identifier];
    v12 = *(a1 + 48);
    v14 = 138543874;
    v15 = v10;
    v16 = 2114;
    v17 = v11;
    v18 = 2114;
    v19 = v12;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: %{public}@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  [*(a1 + 40) _readCharacteristicValues:*(a1 + 56) requestMessage:v6 source:*(a1 + 80) withCompletionHandler:*(a1 + 64)];

  v13 = *MEMORY[0x277D85DE8];
}

- (void)readCharacteristicValues:(id)a3 identifier:(id)a4 source:(unint64_t)a5 qualityOfService:(int64_t)a6 withCompletionHandler:(id)a7
{
  v13 = a3;
  v14 = a4;
  v15 = a7;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x22AAD2510](self, a2);
  v19 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 26602];
  v20 = [v16 initWithName:v19];

  v21 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_278670678;
  v27 = v20;
  v28 = v13;
  v31 = v15;
  v32 = a5;
  v33 = a6;
  v29 = self;
  v30 = v14;
  v22 = v14;
  v23 = v15;
  v24 = v13;
  v25 = v20;
  dispatch_async(v21, block);
}

void __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  location[3] = *MEMORY[0x277D85DE8];
  if ([*(a1 + 40) count])
  {
    objc_initWeak(location, *(a1 + 48));
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke_1858;
    aBlock[3] = &unk_278670650;
    objc_copyWeak(&v18, location);
    v17 = *(a1 + 64);
    v14 = *(a1 + 32);
    v19 = *(a1 + 72);
    v15 = *(a1 + 56);
    v16 = *(a1 + 40);
    v2 = _Block_copy(aBlock);
    if ([*(a1 + 48) _shouldWaitForAccessoriesToBeReachable])
    {
      v3 = *(a1 + 40);
      v4 = [*(a1 + 48) workQueue];
      v5 = [HMDHomeAssistantOperation homeAssistantOperationWithReadRequests:v3 queue:v4];

      [*(a1 + 48) _performOperation:v5 completion:v2];
    }

    else
    {
      v2[2](v2);
    }

    objc_destroyWeak(&v18);
    objc_destroyWeak(location);
    v10 = 0;
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 48);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v9;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Empty characteristics array was given", location, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
    v10 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    v11 = *(a1 + 64);
    if (v11)
    {
      (*(v11 + 16))(v11, v10, 0);
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke_1858(uint64_t a1)
{
  v28[2] = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained)
  {
    [*(a1 + 32) begin];
    v27[0] = @"sourceType";
    v3 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 72)];
    v27[1] = @"kMultiPartResponseKey";
    v28[0] = v3;
    v28[1] = MEMORY[0x277CBEC38];
    v4 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];

    v5 = objc_alloc(MEMORY[0x277D0F848]);
    v6 = *(a1 + 80);
    v7 = [MEMORY[0x277D0F820] allMessageDestinations];
    v8 = [v5 initWithName:@"kMultipleCharacteristicReadRequestKey" qualityOfService:v6 destination:v7 payload:v4];

    [v8 setIdentifier:*(a1 + 40)];
    v9 = objc_autoreleasePoolPush();
    v10 = WeakRetained;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v8 identifier];
      v14 = HMDRequestSourceAsString(*(a1 + 72));
      v21 = 138543874;
      v22 = v12;
      v23 = 2114;
      v24 = v13;
      v25 = 2114;
      v26 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: %{public}@", &v21, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [v10 _readCharacteristicValues:*(a1 + 48) requestMessage:v8 source:*(a1 + 72) withCompletionHandler:*(a1 + 56)];
    [*(a1 + 32) end];
  }

  else
  {
    v15 = *(a1 + 56);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      (*(v15 + 16))(v15, v16, 0);
    }

    v17 = objc_autoreleasePoolPush();
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform read request", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_performOperation:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v8);

  v9 = [(HMDHome *)self assistantOperations];

  if (!v9)
  {
    v10 = [MEMORY[0x277CBEB18] array];
    [(HMDHome *)self setAssistantOperations:v10];
  }

  v11 = [(HMDHome *)self assistantOperations];
  [v11 addObject:v6];

  objc_initWeak(&location, self);
  objc_initWeak(&from, v6);
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __40__HMDHome__performOperation_completion___block_invoke;
  v13[3] = &unk_278670628;
  v12 = v7;
  v14 = v12;
  objc_copyWeak(&v15, &from);
  objc_copyWeak(&v16, &location);
  [v6 startWithCompletion:v13];
  objc_destroyWeak(&v16);
  objc_destroyWeak(&v15);

  objc_destroyWeak(&from);
  objc_destroyWeak(&location);
}

void __40__HMDHome__performOperation_completion___block_invoke(uint64_t a1)
{
  (*(*(a1 + 32) + 16))();
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = WeakRetained;
    v3 = objc_loadWeakRetained((a1 + 48));
    v4 = [v3 assistantOperations];
    [v4 removeObject:v5];

    WeakRetained = v5;
  }
}

- (BOOL)_shouldWaitForAccessoriesToBeReachable
{
  v3 = isWatch();
  isWatch();
  if (v3)
  {
    v4 = [(HMDHome *)self residentDeviceManager];
    v5 = [v4 primaryResidentDevice];
    v6 = [v5 isReachable] ^ 1;
  }

  else
  {
    LOBYTE(v6) = 0;
  }

  return v6;
}

- (id)writeRequestTuplesFromMessage:(id)a3 outUnhandledRequests:(id *)a4
{
  v79 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = [v5 dictionaryForKey:*MEMORY[0x277CCE7A8]];
  v59 = [MEMORY[0x277CBEB18] array];
  v41 = a4;
  if (a4)
  {
    v55 = objc_alloc_init(MEMORY[0x277CBEB38]);
  }

  else
  {
    v55 = 0;
  }

  v7 = [v5 uuidForKey:*MEMORY[0x277CD2050]];
  if (v7)
  {
    v8 = 1;
  }

  else
  {
    v8 = [v5 BOOLForKey:*MEMORY[0x277CD2678]];
  }

  v58 = v8;

  v74 = 0u;
  v75 = 0u;
  v72 = 0u;
  v73 = 0u;
  obj = v6;
  v9 = v55;
  v43 = [obj countByEnumeratingWithState:&v72 objects:v78 count:16];
  if (v43)
  {
    v42 = *v73;
    v54 = *MEMORY[0x277CD2120];
    v62 = v5;
    do
    {
      v10 = 0;
      do
      {
        if (*v73 != v42)
        {
          objc_enumerationMutation(obj);
        }

        v45 = v10;
        v11 = *(*(&v72 + 1) + 8 * v10);
        v12 = [obj hmf_dictionaryForKey:v11];
        v56 = v11;
        v13 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v11];
        v14 = [(HMDHome *)self accessoryWithUUID:v13];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v47 = v15;

        v70 = 0u;
        v71 = 0u;
        v68 = 0u;
        v69 = 0u;
        v16 = v12;
        v9 = v55;
        v49 = [v16 countByEnumeratingWithState:&v68 objects:v77 count:16];
        if (v49)
        {
          v48 = *v69;
          v46 = v16;
          do
          {
            for (i = 0; i != v49; ++i)
            {
              if (*v69 != v48)
              {
                objc_enumerationMutation(v16);
              }

              v18 = *(*(&v68 + 1) + 8 * i);
              v19 = [v16 hmf_dictionaryForKey:v18];
              v57 = v18;
              v20 = HAPInstanceIDFromValue();
              if (v20)
              {
                v52 = i;
                v50 = v20;
                v61 = [v47 findService:v20];
                v64 = 0u;
                v65 = 0u;
                v66 = 0u;
                v67 = 0u;
                v51 = v19;
                v21 = v19;
                v63 = [v21 countByEnumeratingWithState:&v64 objects:v76 count:16];
                if (!v63)
                {
                  goto LABEL_51;
                }

                v22 = *v65;
                v60 = *v65;
                while (1)
                {
                  for (j = 0; j != v63; ++j)
                  {
                    if (*v65 != v22)
                    {
                      objc_enumerationMutation(v21);
                    }

                    v24 = *(*(&v64 + 1) + 8 * j);
                    v25 = HAPInstanceIDFromValue();
                    if (v25)
                    {
                      v26 = [v61 findCharacteristic:v25];
                      if (v26)
                      {
                        if ([v5 isRemote])
                        {
                          v27 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v24, @"kAuthorizationDataKey"];
                          v28 = [v21 hmf_dataForKey:v27];
                          if (!v28)
                          {
                            v29 = [v5 userForHome:self];
                            v30 = [v29 isRestrictedGuest];

                            if (v30)
                            {
                              v28 = [v26 authorizationData];
                            }

                            else
                            {
                              v28 = 0;
                            }

                            v5 = v62;
                          }
                        }

                        else
                        {
                          v28 = [v26 authorizationData];
                        }

                        v32 = [v21 hmf_BOOLForKey:@"HMDCharacteristicWriteRequestIncludeResponseValueKey"];
                        if ([v5 isRemote])
                        {
                          v33 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v24, v54];
                          v31 = [v21 hmf_dataForKey:v33];
                          goto LABEL_46;
                        }

                        v34 = [HMDHome sanitizedOriginalSourceForMessage:v5];
                        v31 = 0;
                        if (v34 != 1 && v34 != 10)
                        {
                          v33 = [(HMDHome *)self currentUser];
                          v35 = [v33 notificationContextHAPIdentifier];
                          v31 = [v26 contextDataForWriteRequestWithIdentifier:v35];

LABEL_46:
                          v5 = v62;
                        }

                        v36 = [v21 objectForKeyedSubscript:v24];
                        v37 = [v5 identifier];
                        v38 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:v26 value:v36 authorizationData:v28 identifier:v37 type:v58 includeResponseValue:v32 contextData:v31];

                        v5 = v62;
                        [v59 addObject:v38];

                        v22 = v60;
                      }

                      else
                      {
                        v28 = [v55 hmf_mutableDictionaryForKey:v56];
                        if (!v28)
                        {
                          v28 = objc_alloc_init(MEMORY[0x277CBEB38]);
                          [v55 setObject:v28 forKeyedSubscript:v56];
                        }

                        v31 = [v28 hmf_mutableArrayForKey:v57];
                        if (!v31)
                        {
                          v31 = objc_alloc_init(MEMORY[0x277CBEB18]);
                          [v28 setObject:v31 forKeyedSubscript:v57];
                        }

                        [v31 addObject:v25];
                      }
                    }
                  }

                  v63 = [v21 countByEnumeratingWithState:&v64 objects:v76 count:16];
                  if (!v63)
                  {
LABEL_51:

                    v9 = v55;
                    v16 = v46;
                    v19 = v51;
                    i = v52;
                    v20 = v50;
                    break;
                  }
                }
              }
            }

            v49 = [v16 countByEnumeratingWithState:&v68 objects:v77 count:16];
          }

          while (v49);
        }

        v10 = v45 + 1;
      }

      while (v45 + 1 != v43);
      v43 = [obj countByEnumeratingWithState:&v72 objects:v78 count:16];
    }

    while (v43);
  }

  if (v41)
  {
    *v41 = [v9 copy];
  }

  v39 = *MEMORY[0x277D85DE8];

  return v59;
}

+ (uint64_t)sanitizedOriginalSourceForMessage:(uint64_t)a1
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = a2;
  v3 = objc_opt_self();
  v4 = [v2 messagePayload];
  v5 = [v4 hmf_numberForKey:@"kMessageOriginalSourceKey"];

  if (!v5)
  {
    v7 = [v2 source];
    goto LABEL_15;
  }

  v6 = [v5 unsignedIntegerValue];
  v7 = v6;
  if (v6 > 1069)
  {
    if (v6 > 1139)
    {
      if ((v6 - 1140) <= 0x3C && ((1 << (v6 - 116)) & 0x1004010040100401) != 0 || v6 == 1210 || v6 == 1220)
      {
        goto LABEL_15;
      }

      goto LABEL_16;
    }

    v8 = v6 - 1070;
  }

  else
  {
    if (v6 < 0xB)
    {
      goto LABEL_15;
    }

    v8 = v6 - 1000;
  }

  if (v8 <= 0x3C && ((1 << v8) & 0x1004010040100401) != 0)
  {
    goto LABEL_15;
  }

LABEL_16:
  v11 = objc_autoreleasePoolPush();
  v12 = v3;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
  {
    v14 = HMFGetLogIdentifier();
    v15 = 138543874;
    v16 = v14;
    v17 = 2114;
    v18 = @"kMessageOriginalSourceKey";
    v19 = 2114;
    v20 = v5;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Unknown value for '%{public}@': %{public}@", &v15, 0x20u);
  }

  objc_autoreleasePoolPop(v11);
  v7 = 0;
LABEL_15:

  v9 = *MEMORY[0x277D85DE8];
  return v7;
}

- (void)_areWriteRequestsAllowed:(id)a3 message:(id)a4 completion:(id)a5
{
  v31 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v9 userForHome:self];
  if (v11 && ![(HMDHome *)self areCharacteristicRequests:v8 allowedForUser:v11])
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [v11 restrictedGuestAccessSettings];
      v20 = [v19 uuidsOfAllowedAccessories];
      v23 = 138544130;
      v24 = v18;
      v25 = 2112;
      v26 = v9;
      v27 = 2112;
      v28 = v11;
      v29 = 2112;
      v30 = v20;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Rejecting message which is not allowed for user. Message: %@, user: %@, allowedAccessories: %@", &v23, 0x2Au);
    }

    objc_autoreleasePoolPop(v15);
    v14 = _Block_copy(v10);
    if (v14)
    {
      v21 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2906];
      v14[2](v14, 0, v21);
    }

    goto LABEL_11;
  }

  v12 = [v9 source];
  if (![(HMDHome *)self applyDeviceLockStatus:v9])
  {
    v13 = _Block_copy(v10);
    v14 = v13;
    if (v13)
    {
      v13[2](v13, 1, 0);
    }

LABEL_11:

    goto LABEL_12;
  }

  [(HMDHome *)self _applyDeviceLockCheck:v8 forSource:v12 message:v9 completion:v10];
LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_applyDeviceLockCheck:(uint64_t)a3 forSource:(void *)a4 message:(void *)a5 completion:
{
  v77 = *MEMORY[0x277D85DE8];
  v51 = a2;
  v53 = a4;
  v50 = a5;
  if (a1)
  {
    v8 = [a1 synchronouslyFetchIsCarPlayConnectedStatus];
    v58 = a1;
    v9 = [a1 dataSource];
    v10 = [v9 deviceLockStateDataSource];
    v11 = [v10 isPasscodeEnabled];

    v66 = 0u;
    v67 = 0u;
    v64 = 0u;
    v65 = 0u;
    obj = v51;
    v57 = [(__CFString *)obj countByEnumeratingWithState:&v64 objects:v76 count:16];
    if (v57)
    {
      v56 = *v65;
      v52 = v11 & v8;
LABEL_4:
      v12 = 0;
      while (1)
      {
        if (*v65 != v56)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v64 + 1) + 8 * v12);
        v14 = [(__CFString *)v13 characteristic];
        v15 = [(__CFString *)v14 service];
        v16 = [v58 dataSource];
        v17 = [v16 hapMetadata];
        v18 = [(__CFString *)v14 type];
        v19 = [v15 type];
        v20 = [v17 requiresDeviceUnlock:v18 forService:v19];

        if (v20)
        {
          v21 = [v58 dataSource];
          v22 = [v21 hapMetadata];
          v23 = [(__CFString *)v14 type];
          v24 = [(__CFString *)v13 value];
          v25 = [v22 allowsSecuringWriteFor:v23 withValue:v24];

          if (((a3 == 1) & v25) == 0)
          {
            v26 = v52 ? [v58 isCarPlayAccessAllowedForCharacteristic:v14 withMessage:v53 fromSource:a3] : 0;
            if ((([v58 isAccessAllowedForCharacteristicsWithMessage:v53] | v26) & 1) == 0)
            {
              break;
            }
          }
        }

        if (v57 == ++v12)
        {
          v57 = [(__CFString *)obj countByEnumeratingWithState:&v64 objects:v76 count:16];
          if (v57)
          {
            goto LABEL_4;
          }

          goto LABEL_23;
        }
      }

      v27 = HMDSecureAccessErrorCodeForMessage(v53, a3);
      v28 = objc_autoreleasePoolPush();
      v29 = v58;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
      {
        v31 = HMFGetLogIdentifier();
        v32 = HMDRequestSourceAsString(a3);
        *buf = 138544130;
        v69 = v31;
        v70 = 2112;
        v71 = v13;
        v72 = 2112;
        v73 = v14;
        v74 = 2112;
        v75 = v32;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Write request (%@) for characteristic: %@ from source: %@ is attempting to perform a securing write", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v28);
      if (a3 != 1)
      {
        goto LABEL_28;
      }

      if (!v27)
      {
        goto LABEL_24;
      }

      v33 = objc_autoreleasePoolPush();
      v34 = v29;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543362;
        v69 = v36;
        _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Checking siri unlock access for siri triggered write request", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v33);
      objc_initWeak(buf, v34);
      v37 = [v34 siriSecureAccessoryAccessController];
      v59[0] = MEMORY[0x277D85DD0];
      v59[1] = 3221225472;
      v59[2] = __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke;
      v59[3] = &unk_278670588;
      objc_copyWeak(&v63, buf);
      v62 = v50;
      v60 = obj;
      v38 = v27;
      v61 = v38;
      [v37 isUnsecuringSiriActionAllowedWithCompletion:v59];

      objc_destroyWeak(&v63);
      objc_destroyWeak(buf);
    }

    else
    {
LABEL_23:

      if (a3 == 1)
      {
LABEL_24:
        v39 = objc_autoreleasePoolPush();
        v40 = v58;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          *buf = 138543874;
          v69 = v42;
          v70 = 2112;
          v71 = obj;
          v72 = 2112;
          v73 = @"Siri";
          _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Access is allowed for write requests (%@) from source: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v39);
        (*(v50 + 2))(v50, 1, 0);
      }

      else
      {
        v27 = 0;
LABEL_28:
        v43 = objc_autoreleasePoolPush();
        v44 = v58;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
        {
          v46 = HMFGetLogIdentifier();
          if (v27)
          {
            v47 = @"denied";
          }

          else
          {
            v47 = @"allowed";
          }

          v48 = HMDRequestSourceAsString(a3);
          *buf = 138544130;
          v69 = v46;
          v70 = 2112;
          v71 = v47;
          v72 = 2112;
          v73 = obj;
          v74 = 2112;
          v75 = v48;
          _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_INFO, "%{public}@Access is %@ for write requests (%@) from source: %@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v43);
        (*(v50 + 2))(v50, v27 == 0, v27);
      }
    }
  }

  v49 = *MEMORY[0x277D85DE8];
}

void __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke(uint64_t a1, int a2)
{
  v25 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = @"denied";
      v10 = *(a1 + 32);
      *buf = 138543874;
      v20 = v8;
      if (a2)
      {
        v9 = @"allowed";
      }

      v21 = 2112;
      v22 = v9;
      v23 = 2112;
      v24 = v10;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Access is %@ for write requests (%@) by siri watch authentication", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = [v6 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke_1845;
    block[3] = &unk_278687F18;
    v17 = *(a1 + 48);
    v18 = a2;
    v16 = *(a1 + 40);
    dispatch_async(v11, block);
  }

  else
  {
    v12 = *(a1 + 48);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    (*(v12 + 16))(v12, 0, v13);
  }

  v14 = *MEMORY[0x277D85DE8];
}

uint64_t __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke_1845(uint64_t a1)
{
  v2 = *(a1 + 40);
  if ((*(a1 + 48) & 1) == 0)
  {
    v3 = *(a1 + 32);
  }

  return (*(v2 + 16))();
}

- (void)_handleMultipleCharacteristicWrite:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v23 = 0;
  v5 = [(HMDHome *)self writeRequestTuplesFromMessage:v4 outUnhandledRequests:&v23];
  v6 = v23;
  if ([v6 count])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [v4 shortDescription];
      *buf = 138543874;
      v25 = v10;
      v26 = 2112;
      v27 = v11;
      v28 = 2112;
      v29 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ has characteristic requests that cannot be handled: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v12 = [v4 source];
  [v5 count];
  [v4 isRemote];
  v13 = HMDRequestSourceAsString(v12);
  objc_initWeak(buf, self);
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __46__HMDHome__handleMultipleCharacteristicWrite___block_invoke;
  v18[3] = &unk_278670600;
  objc_copyWeak(v22, buf);
  v14 = v4;
  v19 = v14;
  v22[1] = v12;
  v15 = v5;
  v20 = v15;
  v16 = v6;
  v21 = v16;
  [(HMDHome *)self _areWriteRequestsAllowed:v15 message:v14 completion:v18];

  objc_destroyWeak(v22);
  objc_destroyWeak(buf);

  v17 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleMultipleCharacteristicWrite___block_invoke(uint64_t a1, char a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v7 = WeakRetained;
  if (a2)
  {
    v8 = *(a1 + 32);
    if (WeakRetained)
    {
      [WeakRetained startReportingSessionForMessage:*(a1 + 32)];
      v9 = objc_autoreleasePoolPush();
      v10 = v7;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 0;
        *&buf[8] = 0;
        v13 = [*(a1 + 32) identifier];

        if (v13)
        {
          v14 = [*(a1 + 32) identifier];
          [v14 getUUIDBytes:buf];
        }

        else
        {
          *buf = *MEMORY[0x277D0F960];
        }

        v21 = *buf;
        v16 = HMDRequestSourceAsString(*(a1 + 64));
        *buf = 138544130;
        *&buf[4] = v12;
        *&buf[12] = 1042;
        *&buf[14] = 16;
        v23 = 2098;
        v24 = &v21;
        v25 = 2114;
        v26 = v16;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Handling multiple characteristics write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
      }

      objc_autoreleasePoolPop(v9);
      v18 = *(a1 + 32);
      v17 = *(a1 + 40);
      v19 = *(a1 + 64);
      v15 = [v10 __readWriteResponseHandler:v18 unhandledRequests:*(a1 + 48)];
      [v10 _writeCharacteristicValues:v17 requestMessage:v18 source:v19 biomeSource:0 withCompletionHandler:v15];
    }

    else
    {
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v8 respondWithError:v15];
    }
  }

  else
  {
    [*(a1 + 32) respondWithError:v5];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleCharacteristicWrite:(id)a3
{
  v39[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = [v5 hmf_UUIDForKey:*MEMORY[0x277CCF0B0]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  if (v9)
  {
    v10 = [v4 messagePayload];
    v11 = [v10 objectForKeyedSubscript:*MEMORY[0x277CD25F8]];
    v29 = HAPInstanceIDFromValue();

    v12 = [v4 messagePayload];
    v13 = [v12 objectForKeyedSubscript:*MEMORY[0x277CD2140]];
    v14 = HAPInstanceIDFromValue();

    v28 = [v9 findService:v29];
    v15 = [v28 findCharacteristic:v14];
    if (!v15)
    {
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v25];

      goto LABEL_13;
    }

    if ([v4 isRemote])
    {
      v27 = [v4 dataForKey:@"kAuthorizationDataKey"];
      if (v27)
      {
LABEL_10:
        v18 = [v4 messagePayload];
        v19 = [v18 objectForKeyedSubscript:*MEMORY[0x277CD21B8]];
        v20 = [v4 identifier];
        v21 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:v15 value:v19 authorizationData:v27 identifier:v20 type:0 includeResponseValue:0];

        objc_initWeak(&location, self);
        v39[0] = v21;
        v22 = [MEMORY[0x277CBEA60] arrayWithObjects:v39 count:1];
        v30[0] = MEMORY[0x277D85DD0];
        v30[1] = 3221225472;
        v30[2] = __38__HMDHome__handleCharacteristicWrite___block_invoke;
        v30[3] = &unk_2786705D8;
        objc_copyWeak(&v37, &location);
        v31 = v4;
        v32 = v6;
        v33 = v9;
        v34 = v29;
        v35 = v14;
        v23 = v21;
        v36 = v23;
        [(HMDHome *)self _areWriteRequestsAllowed:v22 message:v31 completion:v30];

        objc_destroyWeak(&v37);
        objc_destroyWeak(&location);

LABEL_13:
        goto LABEL_14;
      }

      v16 = [v4 userForHome:self];
      v17 = [v16 isRestrictedGuest];

      if (!v17)
      {
        v27 = 0;
        goto LABEL_10;
      }
    }

    v27 = [v15 authorizationData];
    goto LABEL_10;
  }

  v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
  [v4 respondWithError:v24];

LABEL_14:
  v26 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__handleCharacteristicWrite___block_invoke(uint64_t a1, char a2, void *a3)
{
  v38 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v7 = WeakRetained;
  if (a2)
  {
    if (WeakRetained)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = v7;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = [*(a1 + 32) shortDescription];
        v13 = [*(a1 + 40) UUIDString];
        v14 = [*(a1 + 48) uniqueIdentifier];
        v15 = *(a1 + 56);
        v16 = *(a1 + 64);
        *buf = 138544642;
        *&buf[4] = v11;
        *&buf[12] = 2112;
        *&buf[14] = v12;
        *&buf[22] = 2112;
        *&buf[24] = v13;
        *&buf[32] = 2112;
        *&buf[34] = v14;
        v34 = 2112;
        v35 = v15;
        v36 = 2112;
        v37 = v16;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Processing single characteristic write request: %@ (%@/%@/%@/%@) as a special case of multiple characteristic write requests", buf, 0x3Eu);
      }

      objc_autoreleasePoolPop(v8);
      v17 = [*(a1 + 32) source];
      v18 = objc_autoreleasePoolPush();
      v19 = v9;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 0;
        *&buf[8] = 0;
        v22 = [*(a1 + 32) identifier];

        if (v22)
        {
          v23 = [*(a1 + 32) identifier];
          [v23 getUUIDBytes:buf];
        }

        else
        {
          *buf = *MEMORY[0x277D0F960];
        }

        v32 = *buf;
        v26 = HMDRequestSourceAsString(v17);
        *buf = 138544130;
        *&buf[4] = v21;
        *&buf[12] = 1042;
        *&buf[14] = 16;
        *&buf[18] = 2098;
        *&buf[20] = &v32;
        *&buf[28] = 2114;
        *&buf[30] = v26;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Handling single characteristic write request with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
      }

      objc_autoreleasePoolPop(v18);
      v31 = *(a1 + 72);
      v27 = [MEMORY[0x277CBEA60] arrayWithObjects:&v31 count:1];
      v28 = *(a1 + 32);
      v29 = [v19 __readWriteResponseHandler:v28 unhandledRequests:0];
      [v19 _writeCharacteristicValues:v27 requestMessage:v28 source:v17 biomeSource:0 withCompletionHandler:v29];
    }

    else
    {
      v24 = *(a1 + 32);
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v24 respondWithError:v25];
    }
  }

  else
  {
    [*(a1 + 32) respondWithError:v5];
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (id)__readWriteResponseHandler:(id)a3 unhandledRequests:(id)a4
{
  v6 = a3;
  v7 = a4;
  objc_initWeak(&location, self);
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __56__HMDHome___readWriteResponseHandler_unhandledRequests___block_invoke;
  v12[3] = &unk_278689460;
  objc_copyWeak(&v15, &location);
  v13 = v7;
  v14 = v6;
  v8 = v6;
  v9 = v7;
  v10 = _Block_copy(v12);

  objc_destroyWeak(&v15);
  objc_destroyWeak(&location);

  return v10;
}

void __56__HMDHome___readWriteResponseHandler_unhandledRequests___block_invoke(id *a1, void *a2, void *a3)
{
  v24 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if ([a1[4] count])
  {
    v8 = [HMDCharacteristicResponseNotificationContext updateMultipleCharacteristicReadWriteResponsePayload:v6 withUnhandledRequests:a1[4]];

    v6 = v8;
  }

  v9 = +[HMDCharacteristicResponseNotificationContext updateLastSeenStatusDataForResponsePayload:home:isRemote:isNotification:](HMDCharacteristicResponseNotificationContext, "updateLastSeenStatusDataForResponsePayload:home:isRemote:isNotification:", v6, WeakRetained, [a1[5] isRemote], 0);

  v10 = objc_autoreleasePoolPush();
  v11 = WeakRetained;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [a1[5] shortDescription];
    v16 = 138544130;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    v20 = 2112;
    v21 = v9;
    v22 = 2112;
    v23 = v5;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Responding to the client: %@ with payload : %@, error: %@", &v16, 0x2Au);
  }

  objc_autoreleasePoolPop(v10);
  [a1[5] respondWithPayload:v9 error:v5];
  [a1[5] setResponseHandler:0];
  [v11 endReportingSessionForMessage:a1[5]];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_addResponseTuplesFromDictionary:(id)a3 accessoryRequestMapTable:(id)a4 responseTuples:(id)a5 completedGroup:(id)a6 logEvents:(id)a7
{
  v55 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v36 = a4;
  v13 = a5;
  group = a6;
  v34 = a7;
  if (v13)
  {
    _HMFPreconditionFailure();
  }

  v33 = v12;
  [v12 hmf_dictionaryForKey:@"kModifiedCharacteristicsForAccessoryKey"];
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  obj = v53 = 0u;
  v38 = [obj countByEnumeratingWithState:&v50 objects:v54 count:16];
  if (v38)
  {
    v37 = *v51;
    v32 = v41;
    do
    {
      for (i = 0; i != v38; ++i)
      {
        if (*v51 != v37)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v50 + 1) + 8 * i);
        v16 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:{v15, v32}];
        v17 = [(HMDHome *)self accessoryWithUUID:v16];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v18 = v17;
        }

        else
        {
          v18 = 0;
        }

        v19 = v18;

        if (v19)
        {
          v20 = [v19 bridge];
          v21 = v20;
          if (v20)
          {
            v22 = v20;
          }

          else
          {
            v22 = v19;
          }

          v23 = v22;

          v24 = [v23 uuid];
          v25 = [v24 UUIDString];

          v26 = [v36 objectForKey:v23];
          v27 = [obj hmf_dictionaryForKey:v15];
          dispatch_group_enter(group);
          v40[0] = MEMORY[0x277D85DD0];
          v40[1] = 3221225472;
          v41[0] = __109__HMDHome__addResponseTuplesFromDictionary_accessoryRequestMapTable_responseTuples_completedGroup_logEvents___block_invoke;
          v41[1] = &unk_2786705B0;
          v42 = v26;
          v28 = v19;
          v43 = v28;
          v44 = v34;
          v45 = v25;
          v46 = v33;
          v47 = self;
          v48 = 0;
          v49 = group;
          v29 = v25;
          v30 = v26;
          [v28 handleMultipleCharacteristicsUpdated:v27 message:0 completionQueue:0 completionHandler:v40];
        }
      }

      v38 = [obj countByEnumeratingWithState:&v50 objects:v54 count:16];
    }

    while (v38);
  }

  dispatch_group_leave(group);

  v31 = *MEMORY[0x277D85DE8];
}

void __109__HMDHome__addResponseTuplesFromDictionary_accessoryRequestMapTable_responseTuples_completedGroup_logEvents___block_invoke(uint64_t a1, void *a2)
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v4 = *(a1 + 32);
  v5 = [v4 countByEnumeratingWithState:&v34 objects:v38 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v35;
    v30 = v3;
    v31 = *v35;
    v29 = a1;
    do
    {
      v8 = 0;
      v33 = v6;
      do
      {
        if (*v35 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v34 + 1) + 8 * v8);
        v10 = [v9 characteristic];
        v11 = [v10 accessory];
        v12 = *(a1 + 40);

        if (v11 == v12)
        {
          v13 = [v9 characteristic];
          v14 = [v3 objectForKey:v13];

          v15 = [*(a1 + 48) objectForKeyedSubscript:*(a1 + 56)];
          v16 = v15;
          if (v15 && ([v15 isSubmitted] & 1) == 0)
          {
            v17 = [*(a1 + 64) objectForKeyedSubscript:@"kRemoteMessageTransportAttributionKey"];
            [v16 setTransportType:{objc_msgSend(v17, "intValue")}];

            v18 = [*(a1 + 72) logEventSubmitter];
            v19 = [v14 error];
            [v18 submitLogEvent:v16 error:v19];

            v6 = v33;
            v7 = v31;
          }

          if (v14 && *(a1 + 80))
          {
            v20 = [v14 error];
            v21 = [HMDCharacteristicResponse responseWithRequest:v9 error:v20];

            v32 = [v9 characteristic];
            v22 = [v32 value];
            v23 = [v14 valueUpdatedTime];
            v24 = [v14 valueUpdatedStateNumber];
            v25 = [v9 characteristic];
            [v25 notificationContext];
            v27 = v26 = v4;
            [v21 setValue:v22 updatedTime:v23 stateNumber:v24 notificationContext:v27];

            v4 = v26;
            v7 = v31;

            v3 = v30;
            a1 = v29;

            v6 = v33;
            [*(v29 + 80) addObject:v21];
          }
        }

        ++v8;
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v34 objects:v38 count:16];
    }

    while (v6);
  }

  dispatch_group_leave(*(a1 + 88));
  v28 = *MEMORY[0x277D85DE8];
}

- (void)_writeCharacteristicValues:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 biomeSource:(unint64_t)a6 withCompletionHandler:(id)a7
{
  v35 = *MEMORY[0x277D85DE8];
  v13 = a3;
  v14 = a4;
  v15 = a7;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x22AAD2510](self, a2);
  v19 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 26007];
  v30 = [v16 initWithName:v19];

  LOBYTE(v16) = [(HMDHome *)self isCurrentDeviceAvailableResident];
  v20 = objc_autoreleasePoolPush();
  v21 = self;
  if (v16)
  {
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      v24 = [v14 shortDescription];
      *buf = 138543618;
      v32 = v23;
      v33 = 2112;
      v34 = v24;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Running new accessory communication logic for resident. %@", buf, 0x16u);
    }
  }

  else
  {
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      v26 = [v14 shortDescription];
      *buf = 138543618;
      v32 = v25;
      v33 = 2112;
      v34 = v26;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Routing accessory write requests using Resident First logic. %@", buf, 0x16u);
    }
  }

  objc_autoreleasePoolPop(v20);
  v27 = [(HMDHome *)v21 _createMessageForReadWriteRequest:v14 source:a5 withCompletionHandler:v15];
  v28 = [(HMDHome *)v21 accessoryReaderWriter];
  [v28 submitWriteRequests:v13 sourceType:a5 biomeSource:a6 requestMessage:v27];

  __HMFActivityScopeLeave();
  v29 = *MEMORY[0x277D85DE8];
}

- (id)_createMessageForReadWriteRequest:(id)a3 source:(unint64_t)a4 withCompletionHandler:(id)a5
{
  v8 = a3;
  v9 = a5;
  v10 = [v8 internal];
  v11 = [v10 copy];

  v12 = [v11 messagePayload];
  v13 = [v12 hmf_numberForKey:@"kMessageOriginalSourceKey"];

  if (v13)
  {
    v14 = 0;
  }

  else
  {
    v14 = [v12 mutableCopy];
    v15 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:a4];
    [v14 setObject:v15 forKeyedSubscript:@"kMessageOriginalSourceKey"];
  }

  if (a4 == 1 && !isTVOSDevice())
  {
    v16 = [v8 userForHome:self];
    if (v16)
    {
      if (!v14)
      {
        v14 = [v12 mutableCopy];
      }

      v17 = [v16 uuid];
      v18 = [v17 UUIDString];
      [v14 setObject:v18 forKeyedSubscript:@"kMessageUserOverrideKey"];
    }
  }

  if (v14)
  {
    v19 = [v14 copy];
    [v11 setMessagePayload:v19];
  }

  v20 = [objc_alloc(objc_opt_class()) initWithInternalMessage:v11];

  objc_initWeak(&location, v20);
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __74__HMDHome__createMessageForReadWriteRequest_source_withCompletionHandler___block_invoke;
  v24[3] = &unk_278686110;
  objc_copyWeak(&v28, &location);
  v21 = v9;
  v27 = v21;
  v22 = v8;
  v25 = v22;
  v26 = self;
  [v20 setResponseHandler:v24];

  objc_destroyWeak(&v28);
  objc_destroyWeak(&location);

  return v20;
}

void __74__HMDHome__createMessageForReadWriteRequest_source_withCompletionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v8 = _Block_copy(*(a1 + 48));
  v9 = v8;
  if (v8)
  {
    (*(v8 + 2))(v8, v5, v6);
  }

  v10 = [*(a1 + 32) responseHandler];

  if (!v10)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [*(a1 + 32) shortDescription];
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEBUG, "%{public}@The response handler became nil for read/write request message: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    [WeakRetained setResponseHandler:0];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)requiresUnlockToAccessCharacteristics:(id)a3 withMessage:(id)a4
{
  v6 = a3;
  if ([(HMDHome *)self applyDeviceLockStatus:a4])
  {
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __61__HMDHome_requiresUnlockToAccessCharacteristics_withMessage___block_invoke;
    v9[3] = &unk_278687EB0;
    v9[4] = self;
    v7 = [v6 na_any:v9];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

uint64_t __61__HMDHome_requiresUnlockToAccessCharacteristics_withMessage___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = [v2 dataSource];
  v5 = [v4 hapMetadata];
  v6 = [v3 type];
  v7 = [v3 service];

  v8 = [v7 type];
  v9 = [v5 requiresDeviceUnlock:v6 forService:v8];

  return v9;
}

- (BOOL)isAccessAllowedForCharacteristicsWithMessage:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSecureAccess] && (objc_msgSend(v4, "isEntitledForSPIAccess") & 1) != 0)
  {
    v5 = 1;
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v4 shortDescription];
      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Insufficient entitlements, access is not allowed for characteristic with message: %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v5 = 0;
  }

  v11 = *MEMORY[0x277D85DE8];
  return v5;
}

- (void)writeCharacteristicValues:(id)a3 source:(unint64_t)a4 message:(id)a5 identifier:(id)a6 qualityOfService:(int64_t)a7 withCompletionHandler:(id)a8
{
  v15 = a3;
  v16 = a5;
  v17 = a6;
  v18 = a8;
  v19 = objc_alloc(MEMORY[0x277D0F770]);
  v20 = MEMORY[0x277CCACA8];
  v21 = MEMORY[0x22AAD2510](self, a2);
  v22 = [v20 stringWithFormat:@"%@, %s:%ld", v21, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 24831];
  v23 = [v19 initWithName:v22];

  v24 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_278675F08;
  block[4] = self;
  v31 = v15;
  v32 = v23;
  v33 = v16;
  v34 = v17;
  v35 = v18;
  v36 = a4;
  v37 = a7;
  v25 = v17;
  v26 = v16;
  v27 = v23;
  v28 = v18;
  v29 = v15;
  dispatch_async(v24, block);
}

void __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke(id *a1)
{
  if ([a1[4] _shouldWaitForAccessoriesToBeReachable])
  {
    v2 = a1[5];
    v3 = [a1[4] workQueue];
    v4 = [HMDHomeAssistantOperation homeAssistantOperationWithWriteRequests:v2 queue:v3];

    objc_initWeak(&location, a1[4]);
    v5 = a1[4];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke_2;
    v20[3] = &unk_278670538;
    objc_copyWeak(v24, &location);
    v23 = a1[9];
    v6 = a1[6];
    v7 = a1[5];
    v24[1] = a1[10];
    v8 = a1[7];
    v9 = a1[8];
    *&v10 = v8;
    *(&v10 + 1) = v9;
    *&v11 = v6;
    *(&v11 + 1) = v7;
    v21 = v11;
    v22 = v10;
    v24[2] = a1[11];
    [v5 _performOperation:v4 completion:v20];

    objc_destroyWeak(v24);
    objc_destroyWeak(&location);
  }

  else
  {
    [a1[6] begin];
    v12 = a1[4];
    v13 = a1[5];
    v14 = a1[10];
    v15 = a1[11];
    v16 = a1[8];
    v17 = a1[9];
    v19 = a1[6];
    v18 = a1[7];

    [(HMDHome *)v12 _writeCharacteristicValues:v13 source:v14 message:v18 identifier:v16 qualityOfService:v15 withCompletionHandler:v17 activity:v19];
  }
}

void __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke_2(id *a1)
{
  v11 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 9);
  if (WeakRetained)
  {
    [a1[4] begin];
    [(HMDHome *)WeakRetained _writeCharacteristicValues:a1[10] source:a1[6] message:a1[7] identifier:a1[11] qualityOfService:a1[8] withCompletionHandler:a1[4] activity:?];
  }

  else
  {
    v3 = objc_autoreleasePoolPush();
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v5;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform write request", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v6 = _Block_copy(a1[8]);
    if (v6)
    {
      v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      v6[2](v6, v7, 0);
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_writeCharacteristicValues:(void *)a3 source:(void *)a4 message:(void *)a5 identifier:(void *)a6 qualityOfService:(void *)a7 withCompletionHandler:(void *)a8 activity:
{
  v60 = *MEMORY[0x277D85DE8];
  v42 = a2;
  v38 = a4;
  v39 = a5;
  v40 = a7;
  v41 = a8;
  val = a1;
  if (a1)
  {
    v44 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v42, "count")}];
    v55 = 0u;
    v56 = 0u;
    v53 = 0u;
    v54 = 0u;
    obj = v42;
    v13 = [obj countByEnumeratingWithState:&v53 objects:v59 count:16];
    if (v13)
    {
      v14 = *v54;
      do
      {
        for (i = 0; i != v13; ++i)
        {
          if (*v54 != v14)
          {
            objc_enumerationMutation(obj);
          }

          v16 = *(*(&v53 + 1) + 8 * i);
          v17 = [v16 characteristic];
          v18 = [v17 authorizationData];
          v19 = [val home];
          v20 = [v19 currentUser];
          v21 = [v20 notificationContextHAPIdentifier];
          v22 = [v17 contextDataForWriteRequestWithIdentifier:v21];

          v23 = [v16 value];
          v24 = +[HMDCharacteristicWriteRequest writeRequestWithCharacteristic:value:authorizationData:identifier:type:includeResponseValue:contextData:](HMDCharacteristicWriteRequest, "writeRequestWithCharacteristic:value:authorizationData:identifier:type:includeResponseValue:contextData:", v17, v23, v18, 0, [v16 requestType], objc_msgSend(v16, "includeResponseValue"), v22);

          [v44 addObject:v24];
        }

        v13 = [obj countByEnumeratingWithState:&v53 objects:v59 count:16];
      }

      while (v13);
    }

    v25 = [val dataSource];
    v26 = [v25 deviceLockStateDataSource];
    if ([v26 isPasscodeEnabled])
    {
      v27 = [val dataSource];
      v28 = [v27 deviceLockStateDataSource];
      v29 = [v28 isLocked];

      if (!v29)
      {
        v30 = objc_autoreleasePoolPush();
        v31 = val;
        v32 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
        {
          v33 = HMFGetLogIdentifier();
          *buf = 138543362;
          v58 = v33;
          _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Allowing characteristic write because device lock check is not required", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v30);
        [(HMDHome *)v31 _performAllowedWriteCharacteristicValues:v44 source:a3 identifier:v39 qualityOfService:a6 withCompletionHandler:v40 activity:v41];
        goto LABEL_16;
      }
    }

    else
    {
    }

    objc_initWeak(buf, val);
    v46[0] = MEMORY[0x277D85DD0];
    v46[1] = 3221225472;
    v46[2] = __112__HMDHome__writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler_activity___block_invoke;
    v46[3] = &unk_278670560;
    objc_copyWeak(v51, buf);
    v34 = v40;
    v52 = 1;
    v50 = v34;
    v51[1] = a3;
    v47 = v41;
    v48 = v44;
    v49 = v39;
    v51[2] = a6;
    [(HMDHome *)val _applyDeviceLockCheck:v48 forSource:a3 message:v38 completion:v46];

    objc_destroyWeak(v51);
    objc_destroyWeak(buf);
LABEL_16:
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __112__HMDHome__writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler_activity___block_invoke(uint64_t a1, int a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      if (a2)
      {
        v11 = @"Allowing";
      }

      else
      {
        v11 = @"Denying";
      }

      v12 = *(a1 + 88);
      v13 = NSStringFromBOOL();
      v14 = *(a1 + 72);
      v22 = 138544386;
      v23 = v10;
      v24 = 2112;
      v25 = v11;
      v26 = 2112;
      v27 = v13;
      v28 = 2048;
      v29 = v14;
      v30 = 2112;
      v31 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ characteristic write passcode=%@, source=%lu : %@", &v22, 0x34u);
    }

    objc_autoreleasePoolPop(v7);
    if (a2)
    {
      [(HMDHome *)v8 _performAllowedWriteCharacteristicValues:*(a1 + 72) source:*(a1 + 48) identifier:*(a1 + 80) qualityOfService:*(a1 + 56) withCompletionHandler:*(a1 + 32) activity:?];
    }

    else
    {
      v20 = *(a1 + 56);
      if (v20)
      {
        (*(v20 + 16))(v20, v5, 0);
      }

      [*(a1 + 32) end];
    }
  }

  else
  {
    v15 = *(a1 + 56);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
      (*(v15 + 16))(v15, v16, 0);
    }

    v17 = objc_autoreleasePoolPush();
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform write request", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_performAllowedWriteCharacteristicValues:(uint64_t)a3 source:(void *)a4 identifier:(uint64_t)a5 qualityOfService:(void *)a6 withCompletionHandler:(void *)a7 activity:
{
  v38[2] = *MEMORY[0x277D85DE8];
  v30 = a2;
  v13 = a4;
  v14 = a6;
  v15 = a7;
  v37[0] = @"sourceType";
  v16 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:a3];
  v37[1] = @"kMultiPartResponseKey";
  v38[0] = v16;
  v38[1] = MEMORY[0x277CBEC38];
  v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:v37 count:2];

  v18 = objc_alloc(MEMORY[0x277D0F848]);
  v19 = [MEMORY[0x277D0F820] allMessageDestinations];
  v20 = [v18 initWithName:@"kMultipleCharacteristicWriteRequestKey" qualityOfService:a5 destination:v19 payload:v17];

  [v20 setIdentifier:v13];
  v21 = objc_autoreleasePoolPush();
  v22 = a1;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
  {
    v29 = v13;
    v24 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    v25 = [v20 identifier];

    if (v25)
    {
      v26 = [v20 identifier];
      [v26 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v31 = *buf;
    v27 = HMDRequestSourceAsString(a3);
    *buf = 138544130;
    *&buf[4] = v24;
    *&buf[12] = 1042;
    *&buf[14] = 16;
    v33 = 2098;
    v34 = &v31;
    v35 = 2114;
    v36 = v27;
    _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Performing allowed write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);

    v13 = v29;
  }

  objc_autoreleasePoolPop(v21);
  [v22 _writeCharacteristicValues:v30 requestMessage:v20 source:a3 biomeSource:0 withCompletionHandler:v14];
  [v15 end];

  v28 = *MEMORY[0x277D85DE8];
}

- (void)writeCharacteristicValues:(id)a3 message:(id)a4 withCompletionHandler:(id)a5
{
  v8 = a5;
  v9 = a4;
  v10 = a3;
  v11 = [v9 source];
  v12 = [v9 identifier];
  -[HMDHome writeCharacteristicValues:source:message:identifier:qualityOfService:withCompletionHandler:](self, "writeCharacteristicValues:source:message:identifier:qualityOfService:withCompletionHandler:", v10, v11, v9, v12, [v9 qualityOfService], v8);
}

- (void)_handleMatterLockChangedCharacteristics:(id)a3 message:(id)a4 remoteRequest:(BOOL)a5
{
  v30 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = [(HMDHome *)self primaryResident];
  v11 = [v10 isCurrentDevice];

  if (v11)
  {
    v12 = [v9 name];
    if ([v12 isEqualToString:@"kMultipleCharacteristicReadRequestKey"])
    {
    }

    else
    {
      v20 = [v9 name];
      v21 = [v20 isEqualToString:@"kCharacteristicReadRequestKey"];

      if (!v21)
      {
        v23[0] = MEMORY[0x277D85DD0];
        v23[1] = 3221225472;
        v23[2] = __73__HMDHome__handleMatterLockChangedCharacteristics_message_remoteRequest___block_invoke;
        v23[3] = &unk_2786762A0;
        v23[4] = self;
        v24 = v9;
        v25 = a5;
        [v8 na_each:v23];

        goto LABEL_11;
      }
    }

    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v16;
      v28 = 2112;
      v29 = v9;
      v17 = "%{public}@_handleMatterLockChangedCharacteristics: We are seeing characteristics changed, but from a characteristic read request. These values have not just actually changed, so we should not show a bulletin. message=%@";
      v18 = v15;
      v19 = 22;
      goto LABEL_9;
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543362;
      v27 = v16;
      v17 = "%{public}@Not handling Matter lock changed characteristic notification because this device is not the primary resident.";
      v18 = v15;
      v19 = 12;
LABEL_9:
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, v17, buf, v19);
    }
  }

  objc_autoreleasePoolPop(v13);
LABEL_11:

  v22 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome__handleMatterLockChangedCharacteristics_message_remoteRequest___block_invoke(uint64_t a1, void *a2)
{
  v84 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 accessory];
  if ([v4 supportsCHIP])
  {
    v5 = [v4 findServiceWithServiceType:*MEMORY[0x277CD0EB0]];

    if (v5)
    {
      v6 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
      v7 = objc_autoreleasePoolPush();
      v8 = *(a1 + 32);
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        v11 = [v6 UUID];
        v12 = [v4 uuid];
        v13 = v12;
        v14 = *(a1 + 40);
        v15 = *(a1 + 48);
        *buf = 138544642;
        if (v15)
        {
          v16 = @"YES";
        }

        else
        {
          v16 = @"NO";
        }

        v73 = v10;
        v74 = 2112;
        v75 = v11;
        v76 = 2112;
        v77 = v12;
        v78 = 2112;
        v79 = v3;
        v80 = 2112;
        v81 = v14;
        v82 = 2112;
        v83 = v16;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Lock Notifications}] _handleMatterLockChangedCharacteristics: Matter lock characteristic changed, preparing to populate bulletin for accessory=%@ characteristic=%@ message=%@ remoteRequest=%@", buf, 0x3Eu);
      }

      objc_autoreleasePoolPop(v7);
      v17 = [v3 value];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v18 = v17;
      }

      else
      {
        v18 = 0;
      }

      v19 = v18;

      if (v19)
      {
        v20 = [v19 integerValue];
        if (!v20)
        {
          v21 = &unk_283E71AC8;
LABEL_18:
          v67 = v21;
          if (*(a1 + 48) != 1)
          {
            v40 = 0;
LABEL_36:
            v66 = v19;
            v71 = v6;
            v52 = objc_autoreleasePoolPush();
            v53 = *(a1 + 32);
            v54 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v54, OS_LOG_TYPE_INFO))
            {
              v55 = HMFGetLogIdentifier();
              [v71 UUID];
              v56 = v62 = v52;
              v57 = [v40 uuid];
              v58 = [v4 uuid];
              *buf = 138544386;
              v73 = v55;
              v74 = 2112;
              v75 = v56;
              v76 = 2112;
              v77 = v57;
              v78 = 2112;
              v79 = v67;
              v80 = 2112;
              v81 = v58;
              _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Handling changed matter lock characteristic (For notifications- HMDHome path) with userUUID=%@ operationType=%@ accessory=%@", buf, 0x34u);

              v52 = v62;
            }

            objc_autoreleasePoolPop(v52);
            v59 = [*(a1 + 32) lockNotificationManager];
            v60 = [MEMORY[0x277CBEAA8] now];
            [v59 sendLockOperationEventNotification:v40 userUniqueID:0 lockOperationType:v67 lockOperationSource:&unk_283E71AF8 fabricIndex:0 accessory:v4 timestamp:v60 flow:v71];

            v6 = v71;
            v19 = v66;
            goto LABEL_39;
          }

          v31 = [*(a1 + 40) remoteSourceDevice];
          v32 = [v31 productInfo];
          v33 = [v32 productClass];

          if (v33)
          {
            if ((v33 & 0xFFFFFFFFFFFFFFFDLL) == 4)
            {
              v68 = v31;
              v34 = objc_autoreleasePoolPush();
              v35 = *(a1 + 32);
              v36 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
              {
                HMFGetLogIdentifier();
                v37 = v63 = v34;
                v38 = [v6 UUID];
                v39 = HMFProductClassToString();
                *buf = 138543874;
                v73 = v37;
                v74 = 2112;
                v75 = v38;
                v76 = 2112;
                v77 = v39;
                _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Product class for this request is %@, which is either a HomePod or ATV, so we should not try to attribute a user to this request.", buf, 0x20u);

                v34 = v63;
              }

              objc_autoreleasePoolPop(v34);
              v40 = 0;
              v31 = v68;
LABEL_35:

              goto LABEL_36;
            }
          }

          else
          {
            v41 = objc_autoreleasePoolPush();
            v42 = *(a1 + 32);
            v43 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
            {
              HMFGetLogIdentifier();
              v44 = v64 = v41;
              [v6 UUID];
              v45 = v69 = v31;
              *buf = 138543618;
              v73 = v44;
              v74 = 2112;
              v75 = v45;
              _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Cannot determine product class for this request.", buf, 0x16u);

              v31 = v69;
              v41 = v64;
            }

            objc_autoreleasePoolPop(v41);
          }

          v46 = objc_autoreleasePoolPush();
          v47 = *(a1 + 32);
          v48 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v49 = v65 = v46;
            [v6 UUID];
            v50 = v70 = v31;
            v51 = HMFProductClassToString();
            *buf = 138543874;
            v73 = v49;
            v74 = 2112;
            v75 = v50;
            v76 = 2112;
            v77 = v51;
            _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Product class for this request is %@, which is not a HomePod or ATV, so we can try to attribute a user to this request.", buf, 0x20u);

            v31 = v70;
            v46 = v65;
          }

          objc_autoreleasePoolPop(v46);
          v40 = [*(a1 + 40) userForHome:*(a1 + 32)];
          goto LABEL_35;
        }

        if (v20 == 1)
        {
          v21 = &unk_283E71AE0;
          goto LABEL_18;
        }

        v22 = objc_autoreleasePoolPush();
        v23 = *(a1 + 32);
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          v26 = [v6 UUID];
          v27 = [v4 uuid];
          *buf = 138544130;
          v73 = v25;
          v74 = 2112;
          v75 = v26;
          v76 = 2112;
          v77 = v19;
          v78 = 2112;
          v79 = v27;
          v28 = "%{public}@[Flow: %@] Error retrieving characteristic value from characteristic. Value should be either 0 or 1, value=%@. accessoryUUID=%@";
          v29 = v24;
          v30 = 42;
          goto LABEL_27;
        }
      }

      else
      {
        v22 = objc_autoreleasePoolPush();
        v23 = *(a1 + 32);
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          v26 = [v6 UUID];
          v27 = [v4 uuid];
          *buf = 138543874;
          v73 = v25;
          v74 = 2112;
          v75 = v26;
          v76 = 2112;
          v77 = v27;
          v28 = "%{public}@[Flow: %@] Error retrieving characteristic value from characteristic. Value is not an NSNumber. accessoryUUID=%@";
          v29 = v24;
          v30 = 32;
LABEL_27:
          _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, v28, buf, v30);
        }
      }

      objc_autoreleasePoolPop(v22);
LABEL_39:
    }
  }

  v61 = *MEMORY[0x277D85DE8];
}

void __131__HMDHome__notifyChangedCharacteristics_identifier_multiPartResponse_moreMessagesInMultipart_requestMessage_withCompletionHandler___block_invoke(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  if (v2)
  {
    v3 = v2;
    (*(v2 + 2))(v2, 0, *(a1 + 32));
    v2 = v3;
  }
}

- (void)_sendClientCharacteristicsChangedNotificationWithIdentifier:(id)a3 requestMessage:(id)a4 multiPartResponse:(BOOL)a5 moreInMultiPartResponse:(BOOL)a6 characteristicChanges:(id)a7 completionHandler:(id)a8
{
  v54 = a6;
  v10 = a5;
  v84 = *MEMORY[0x277D85DE8];
  v55 = a3;
  v56 = a4;
  v13 = a7;
  v53 = a8;
  v57 = v13;
  v58 = [v13 characteristicUpdatesForAllClients];
  if (v10)
  {
    v14 = [MEMORY[0x277CCABB0] numberWithBool:v54];
    v52 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:v58 moreMessagesInMultipart:v14];
  }

  else
  {
    v52 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:v58 moreMessagesInMultipart:0];
  }

  if ([v57 hasEntitledClientOnlyChanges])
  {
    v15 = [v57 characteristicUpdatesForEntitledClients];
    if (v10)
    {
      v16 = [MEMORY[0x277CCABB0] numberWithBool:v54];
      v17 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:v15 moreMessagesInMultipart:v16];
    }

    else
    {
      v17 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:v15 moreMessagesInMultipart:0];
    }

    v51 = [HMDCharacteristicResponseNotificationContext updateLastSeenStatusDataForResponsePayload:v17 home:self isRemote:0 isNotification:1];
  }

  else
  {
    v51 = 0;
  }

  v18 = [v56 proxyConnection];
  v59 = [MEMORY[0x277CBEB40] orderedSet];
  if (v18)
  {
    [v59 addObject:v18];
  }

  if ([v58 count] || objc_msgSend(v57, "hasEntitledClientOnlyChanges"))
  {
    v19 = [(HMDHome *)self dataSource];
    v20 = [v19 xpcMessageTransport];
    v21 = [v20 connections];
    [v59 addObjectsFromArray:v21];
  }

  if ([v56 qualityOfService] < 17)
  {
    v22 = 17;
  }

  else
  {
    v22 = [v56 qualityOfService];
  }

  v23 = objc_alloc(MEMORY[0x277D0F820]);
  v24 = [(HMDHome *)self uuid];
  v25 = [v23 initWithTarget:v24];

  v50 = v25;
  v26 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"kMultipleCharacteristicValuesUpdatedNotificationKey" qualityOfService:v22 destination:v25 payload:0];
  v27 = v26;
  if (v55)
  {
    [v26 setIdentifier:?];
  }

  v28 = objc_autoreleasePoolPush();
  v29 = self;
  v30 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
  {
    v31 = HMFGetLogIdentifier();
    v32 = [v59 count];
    *buf = 0;
    *&buf[8] = 0;
    v33 = [v27 identifier];

    if (v33)
    {
      v34 = [v27 identifier];
      [v34 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v71 = *buf;
    v35 = [v58 count] != 0;
    v36 = [v57 hasEntitledClientOnlyChanges];
    *buf = 138545154;
    *&buf[4] = v31;
    *&buf[12] = 2048;
    *&buf[14] = v32;
    *&buf[22] = 1040;
    v73 = 16;
    v74 = 2096;
    v75 = &v71;
    v76 = 1024;
    v77 = v35;
    v78 = 1024;
    v79 = v36;
    v80 = 1024;
    v81 = v10;
    v82 = 1024;
    v83 = v54;
    _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Notifying %ld clients of characteristic changes with message identifier: %{uuid_t}.16P, allClients: %{BOOL}d, entitledClients: %{BOOL}d, multiPartResponse: %{BOOL}d, moreMessagesInMultipartResponse: %{BOOL}d", buf, 0x3Eu);
  }

  objc_autoreleasePoolPop(v28);
  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x2020000000;
  LOBYTE(v73) = v53 != 0;
  v37 = dispatch_group_create();
  v38 = [v59 array];
  v62[0] = MEMORY[0x277D85DD0];
  v62[1] = 3221225472;
  v62[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke;
  v62[3] = &unk_278670510;
  v39 = v51;
  v63 = v39;
  v40 = v27;
  v64 = v40;
  v41 = v52;
  v65 = v41;
  v42 = v18;
  v66 = v42;
  v69 = buf;
  v70 = 34305;
  v43 = v37;
  v67 = v43;
  v44 = v53;
  v68 = v44;
  [v38 na_each:v62];

  v45 = [(HMDHome *)v29 reportingSessionManager];
  v46 = [v40 messagePayload];
  v47 = [v40 identifier];
  [v45 addResponseMessagePayload:v46 toSessionWithUUID:v47];

  if (*(*&buf[8] + 24) == 1)
  {
    v48 = [(HMDHome *)v29 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_3;
    block[3] = &unk_278688B80;
    v61 = v44;
    dispatch_group_notify(v43, v48, block);
  }

  _Block_object_dispose(buf, 8);
  v49 = *MEMORY[0x277D85DE8];
}

void __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = v3;
  v5 = (a1 + 32);
  if (*(a1 + 32) && ([v3 isEntitledForSPIAccess] & 1) != 0)
  {
    v6 = 1;
    v7 = 5;
  }

  else
  {
    v6 = 0;
    v5 = (a1 + 48);
    v7 = 1;
  }

  [*(a1 + 40) setMessagePayload:*v5];
  [*(a1 + 40) setRequiresSPIEntitlement:v6];
  if (*(a1 + 56) == v4)
  {
    *(*(*(a1 + 80) + 8) + 24) = 0;
  }

  else
  {
    [*(a1 + 40) setQualityOfService:17];
    v8 = [[HMDHomeManagerXPCMessageSendPolicy alloc] initWithEntitlements:v7 options:*(a1 + 88) active:1];
    [*(a1 + 40) setSendPolicy:v8];
  }

  dispatch_group_enter(*(a1 + 64));
  v9 = [*(a1 + 40) copy];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_2;
  v11[3] = &unk_27868A528;
  v12 = v4;
  v13 = *(a1 + 56);
  v15 = *(a1 + 72);
  v14 = *(a1 + 64);
  v10 = v4;
  [v10 sendMessage:v9 completionHandler:v11];
}

void __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v4 = a2;
  if (*(a1 + 32) == *(a1 + 40))
  {
    v3 = *(a1 + 56);
    if (v3)
    {
      (*(v3 + 16))();
    }
  }

  dispatch_group_leave(*(a1 + 48));
}

- (void)notifyRemoteUsersOfChangedCharacteristics:(id)a3 message:(id)a4 broadcast:(BOOL)a5
{
  v8 = a3;
  v9 = a4;
  v10 = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __71__HMDHome_notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke;
  v13[3] = &unk_278685AA8;
  v13[4] = self;
  v14 = v8;
  v15 = v9;
  v16 = a5;
  v11 = v9;
  v12 = v8;
  dispatch_async(v10, v13);
}

- (void)notifyOfChangedCharacteristic:(id)a3 changedByThisDevice:(BOOL)a4 residentShouldNotifyPeers:(BOOL)a5 message:(id)a6
{
  v10 = a3;
  v11 = a6;
  v12 = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __95__HMDHome_notifyOfChangedCharacteristic_changedByThisDevice_residentShouldNotifyPeers_message___block_invoke;
  v15[3] = &unk_278684B18;
  v15[4] = self;
  v16 = v10;
  v18 = a4;
  v19 = a5;
  v17 = v11;
  v13 = v11;
  v14 = v10;
  dispatch_async(v12, v15);
}

void __95__HMDHome_notifyOfChangedCharacteristic_changedByThisDevice_residentShouldNotifyPeers_message___block_invoke(uint64_t a1)
{
  v6[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v6[0] = *(a1 + 40);
  v3 = [MEMORY[0x277CBEA60] arrayWithObjects:v6 count:1];
  LOBYTE(v5) = 0;
  [v2 _postInternalNotificationForChangedCharacteristics:v3 previouslyNilChangedCharacteristics:MEMORY[0x277CBEBF8] modifiedCharacteristics:0 changedByThisDevice:*(a1 + 56) residentShouldNotifyPeers:*(a1 + 57) message:*(a1 + 48) broadcast:v5];

  v4 = *MEMORY[0x277D85DE8];
}

- (void)_postInternalNotificationForChangedCharacteristics:(id)a3 previouslyNilChangedCharacteristics:(id)a4 modifiedCharacteristics:(id)a5 changedByThisDevice:(BOOL)a6 residentShouldNotifyPeers:(BOOL)a7 message:(id)a8 broadcast:(BOOL)a9
{
  v10 = a7;
  v110 = a6;
  v159 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v109 = a4;
  v117 = a5;
  v121 = a8;
  v15 = objc_autoreleasePoolPush();
  v16 = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    v19 = [v121 shortDescription];
    *buf = 138544642;
    v150 = v18;
    v151 = 1024;
    *v152 = v110;
    *&v152[4] = 1024;
    *&v152[6] = v10;
    v153 = 1024;
    v154 = a9;
    v155 = 2112;
    v156 = v14;
    v157 = 2112;
    v158 = v19;
    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Posting internal notification and notifying remote users with changedByThisDevice: %{BOOL}d residentShouldNotifyPeers: %{BOOL}d broadcast: %{BOOL}d about changed characteristics: %@ message: %@ ", buf, 0x32u);
  }

  objc_autoreleasePoolPop(v15);
  v20 = v121;
  if (![v14 count] && !objc_msgSend(v109, "count"))
  {
    goto LABEL_95;
  }

  v21 = [v121 dictionaryForKey:@"kPresenceDictionaryForNotificationKey"];
  v22 = [v121 dictionaryForKey:@"kPresencePairingIdentifierDictionaryForNotificationKey"];
  v144[0] = MEMORY[0x277D85DD0];
  v144[1] = 3221225472;
  v144[2] = __186__HMDHome__postInternalNotificationForChangedCharacteristics_previouslyNilChangedCharacteristics_modifiedCharacteristics_changedByThisDevice_residentShouldNotifyPeers_message_broadcast___block_invoke;
  v144[3] = &unk_278687EB0;
  v144[4] = v16;
  v23 = [v14 na_filter:v144];
  v24 = [v121 name];
  v25 = [v24 isEqual:@"kCharacterisiticsChangedInternalNotificationKey"];

  v26 = [(HMDHome *)v16 accessoryBulletinNotificationManager];
  v108 = v23;
  v27 = [v26 bulletinCharacteristicsFromChangedCharacteristics:v23 message:v121];

  v119 = v16;
  v115 = v22;
  v116 = v21;
  v114 = v27;
  if (!v27)
  {
    if (v22)
    {
      v28 = [[HMDHomePresenceRemote alloc] initWithPresenceByPairingIdentity:v22];
    }

    else
    {
      if (!v21)
      {
        v29 = 0;
        goto LABEL_12;
      }

      v28 = [[HMDHomePresenceRemote alloc] initWithPresenceByUserId:v21];
    }

    v29 = v28;
LABEL_12:
    v30 = [(HMDHome *)v16 localCapabilitiesDataSource];
    v31 = [v30 supportsBulletinBoard];

    if (v31)
    {
      v140[0] = MEMORY[0x277D85DD0];
      v140[1] = 3221225472;
      v140[2] = __186__HMDHome__postInternalNotificationForChangedCharacteristics_previouslyNilChangedCharacteristics_modifiedCharacteristics_changedByThisDevice_residentShouldNotifyPeers_message_broadcast___block_invoke_2;
      v140[3] = &unk_2786704E8;
      v140[4] = v16;
      v141 = v117;
      v142 = v110;
      v143 = v25;
      [(HMDHome *)v16 evaluateNotificationConditionForCharacteristics:v108 homePresence:v29 completion:v140];
    }

    goto LABEL_15;
  }

  [(HMDHome *)v16 _updateBulletinBoardOfChangedCharacteristics:v27 modifiedCharacteristics:v117 changedByThisDevice:v110 changeNotificationFromPrimary:v25];
LABEL_15:
  v106 = v10;
  v123 = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
  v136 = 0u;
  v137 = 0u;
  v138 = 0u;
  v139 = 0u;
  v107 = v14;
  obj = v14;
  v32 = [obj countByEnumeratingWithState:&v136 objects:v148 count:16];
  if (v32)
  {
    v33 = v32;
    v34 = *v137;
    do
    {
      for (i = 0; i != v33; ++i)
      {
        if (*v137 != v34)
        {
          objc_enumerationMutation(obj);
        }

        v36 = *(*(&v136 + 1) + 8 * i);
        v37 = [v36 accessory];
        if (v37)
        {
          v38 = [v123 objectForKey:v37];
          if (!v38)
          {
            v38 = [MEMORY[0x277CBEB58] set];
            [v123 setObject:v38 forKey:v37];
          }

          [v38 addObject:v36];
          v39 = [[HMDHAPAccessoryNotificationEvent alloc] initWithAccessory:v37 characteristic:v36];
          v40 = [(HMDHome *)v119 logEventSubmitter];
          [v40 submitLogEvent:v39 error:0];
        }
      }

      v33 = [obj countByEnumeratingWithState:&v136 objects:v148 count:16];
    }

    while (v33);
  }

  v122 = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
  v132 = 0u;
  v133 = 0u;
  v134 = 0u;
  v135 = 0u;
  v41 = v109;
  v42 = [v41 countByEnumeratingWithState:&v132 objects:v147 count:16];
  if (v42)
  {
    v43 = v42;
    v44 = *v133;
    do
    {
      for (j = 0; j != v43; ++j)
      {
        if (*v133 != v44)
        {
          objc_enumerationMutation(v41);
        }

        v46 = *(*(&v132 + 1) + 8 * j);
        v47 = [v46 accessory];
        if (v47)
        {
          v48 = [v122 objectForKey:v47];
          if (!v48)
          {
            v48 = [MEMORY[0x277CBEB58] set];
            [v122 setObject:v48 forKey:v47];
          }

          [v48 addObject:v46];
        }
      }

      v43 = [v41 countByEnumeratingWithState:&v132 objects:v147 count:16];
    }

    while (v43);
  }

  v120 = [MEMORY[0x277CBEB38] dictionary];
  v128 = 0u;
  v129 = 0u;
  v130 = 0u;
  v131 = 0u;
  v49 = v114;
  v50 = [v49 countByEnumeratingWithState:&v128 objects:v146 count:16];
  v51 = v119;
  if (v50)
  {
    v52 = v50;
    v53 = *v129;
    do
    {
      for (k = 0; k != v52; ++k)
      {
        if (*v129 != v53)
        {
          objc_enumerationMutation(v49);
        }

        v55 = *(*(&v128 + 1) + 8 * k);
        v56 = [v55 accessory];
        v57 = v56;
        if (v56)
        {
          v58 = [v56 uuid];
          v59 = [v120 objectForKeyedSubscript:v58];
          if (!v59)
          {
            v59 = [MEMORY[0x277CBEB58] set];
            [v120 setObject:v59 forKeyedSubscript:v58];
          }

          [v59 addObject:v55];
        }
      }

      v52 = [v49 countByEnumeratingWithState:&v128 objects:v146 count:16];
    }

    while (v52);
  }

  v105 = v49;

  v60 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v122, "count") + objc_msgSend(v123, "count")}];
  v61 = [v123 hm_allKeys];
  [v60 addObjectsFromArray:v61];

  v62 = [v122 hm_allKeys];
  [v60 addObjectsFromArray:v62];

  v126 = 0u;
  v127 = 0u;
  v124 = 0u;
  v125 = 0u;
  v112 = v60;
  v20 = v121;
  v118 = [v112 countByEnumeratingWithState:&v124 objects:v145 count:16];
  if (v118)
  {
    v63 = MEMORY[0x277CBEBF8];
    v113 = *v125;
    do
    {
      for (m = 0; m != v118; ++m)
      {
        if (*v125 != v113)
        {
          objc_enumerationMutation(v112);
        }

        v65 = *(*(&v124 + 1) + 8 * m);
        v66 = [MEMORY[0x277CBEB38] dictionary];
        v67 = [v123 objectForKey:v65];
        v68 = [v67 allObjects];
        v69 = v68;
        if (v68)
        {
          v70 = v68;
        }

        else
        {
          v70 = v63;
        }

        [v66 setObject:v70 forKeyedSubscript:@"kModifiedCharacteristicsKey"];

        v71 = [v122 objectForKey:v65];
        v72 = [v71 allObjects];
        v73 = v72;
        if (v72)
        {
          v74 = v72;
        }

        else
        {
          v74 = v63;
        }

        [v66 setObject:v74 forKeyedSubscript:@"HMDModifiedPreviouslyNilValuedCharacteristicsKey"];

        if (v114)
        {
          v75 = [v65 uuid];
          v76 = [v120 objectForKeyedSubscript:v75];

          v77 = [v76 allObjects];
          v78 = v77;
          if (v77)
          {
            v79 = v77;
          }

          else
          {
            v79 = v63;
          }

          [v66 setObject:v79 forKeyedSubscript:@"kCharacteristicsToShowBulletinsKey"];
        }

        else
        {
          v80 = objc_autoreleasePoolPush();
          v81 = v51;
          v82 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
          {
            v83 = HMFGetLogIdentifier();
            *buf = 138543362;
            v150 = v83;
            _os_log_impl(&dword_229538000, v82, OS_LOG_TYPE_INFO, "%{public}@Not inserting HMDCharacteristicsToShowBulletinsKey, had to fall back to legacy evaluation", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v80);
        }

        v20 = v121;
        if (v121)
        {
          v84 = [v121 name];
          if ([v84 isEqualToString:@"kCharacterisiticsChangedInternalNotificationKey"])
          {
            goto LABEL_82;
          }

          v85 = [v121 name];
          if ([v85 isEqualToString:@"kMultipleCharacteristicReadRequestKey"])
          {
            v51 = v119;
LABEL_81:

            v20 = v121;
LABEL_82:

            goto LABEL_83;
          }

          v91 = [v121 name];
          v92 = [v91 isEqualToString:@"kCharacteristicReadRequestKey"];

          v20 = v121;
          v51 = v119;
          if ((v92 & 1) == 0)
          {
            v93 = objc_autoreleasePoolPush();
            v94 = v119;
            v95 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v95, OS_LOG_TYPE_DEBUG))
            {
              v96 = HMFGetLogIdentifier();
              *buf = 138543618;
              v150 = v96;
              v151 = 2112;
              *v152 = v121;
              _os_log_impl(&dword_229538000, v95, OS_LOG_TYPE_DEBUG, "%{public}@Adding user context to changed characteristics notification using message: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v93);
            v20 = v121;
            v84 = [v121 userForHome:v94];
            if (v84)
            {
              goto LABEL_80;
            }
          }
        }

        else if (v110)
        {
          v86 = objc_autoreleasePoolPush();
          v87 = v51;
          v88 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v88, OS_LOG_TYPE_DEBUG))
          {
            v89 = HMFGetLogIdentifier();
            v90 = [(HMDHome *)v87 currentUser];
            *buf = 138543618;
            v150 = v89;
            v151 = 2112;
            *v152 = v90;
            _os_log_impl(&dword_229538000, v88, OS_LOG_TYPE_DEBUG, "%{public}@Adding user context to changed characteristics notification using currentUser: %@", buf, 0x16u);

            v51 = v119;
          }

          objc_autoreleasePoolPop(v86);
          v84 = [(HMDHome *)v87 currentUser];
          v20 = 0;
          if (v84)
          {
LABEL_80:
            v85 = [v84 uuid];
            [v66 setObject:v85 forKeyedSubscript:@"kUserUUIDKey"];
            goto LABEL_81;
          }
        }

LABEL_83:
        v97 = [v20 uuidForKey:@"kMessageUserOverrideKey"];
        if (v97)
        {
          [v66 setObject:v97 forKeyedSubscript:@"kMessageUserOverrideKey"];
        }

        if (v20)
        {
          v98 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{+[HMDHome sanitizedOriginalSourceForMessage:](HMDHome, v20)}];
          [v66 setObject:v98 forKeyedSubscript:@"kMessageSourceForNotificationKey"];
        }

        [v66 setObject:v117 forKeyedSubscript:@"kModifiedCharacteristicsMapKey"];
        [v66 setObject:v116 forKeyedSubscript:@"kPresenceDictionaryForNotificationKey"];
        [v66 setObject:v115 forKeyedSubscript:@"kPresencePairingIdentifierDictionaryForNotificationKey"];
        v99 = [v66 copy];
        logAndPostNotification(@"HMDAccessoryCharacteristicsChangedNotification", v65, v99);

        v63 = MEMORY[0x277CBEBF8];
      }

      v118 = [v112 countByEnumeratingWithState:&v124 objects:v145 count:16];
    }

    while (v118);
  }

  v14 = v107;
  if (v106 && [(HMDHome *)v51 shouldRelayNotificationToRegisteredDevicesForSource:v20])
  {
    v100 = objc_autoreleasePoolPush();
    v101 = v51;
    v102 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v102, OS_LOG_TYPE_INFO))
    {
      v103 = HMFGetLogIdentifier();
      *buf = 138543362;
      v150 = v103;
      _os_log_impl(&dword_229538000, v102, OS_LOG_TYPE_INFO, "%{public}@Posting notification to remote users since this is a resident device or is paired with a watch", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v100);
    v20 = v121;
    [(HMDHome *)v101 notifyRemoteUsersOfChangedCharacteristics:obj message:v121 broadcast:a9];
  }

LABEL_95:
  v104 = *MEMORY[0x277D85DE8];
}

- (id)_disablePayloadFromRemotelyUpdatedCharacteristicNotifications:(id)a3
{
  v59 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v33 = [MEMORY[0x277CBEB38] dictionary];
    v52 = 0u;
    v53 = 0u;
    v54 = 0u;
    v55 = 0u;
    obj = [v4 allKeys];
    v5 = [obj countByEnumeratingWithState:&v52 objects:v58 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v53;
      v8 = 0x277CBE000uLL;
      v9 = 0x277CCA000uLL;
      v35 = self;
      v36 = v4;
      v34 = *v53;
      do
      {
        v10 = 0;
        v37 = v6;
        do
        {
          if (*v53 != v7)
          {
            objc_enumerationMutation(obj);
          }

          v40 = v10;
          v11 = *(*(&v52 + 1) + 8 * v10);
          v12 = [*(v8 + 2840) array];
          v43 = [v4 hmf_dictionaryForKey:v11];
          v41 = [objc_alloc(*(v9 + 3448)) initWithUUIDString:v11];
          v13 = [(HMDHome *)self accessoryWithUUID:?];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v14 = v13;
          }

          else
          {
            v14 = 0;
          }

          v15 = v14;

          if (v15 && ([v15 hasBTLELink] & 1) == 0 && objc_msgSend(v15, "hasIPLink"))
          {
            v38 = v15;
            v50 = 0u;
            v51 = 0u;
            v48 = 0u;
            v49 = 0u;
            v42 = [v43 allKeys];
            v16 = [v42 countByEnumeratingWithState:&v48 objects:v57 count:16];
            if (v16)
            {
              v17 = v16;
              v18 = *v49;
              do
              {
                for (i = 0; i != v17; ++i)
                {
                  if (*v49 != v18)
                  {
                    objc_enumerationMutation(v42);
                  }

                  v20 = [v43 hmf_dictionaryForKey:*(*(&v48 + 1) + 8 * i)];
                  v44 = 0u;
                  v45 = 0u;
                  v46 = 0u;
                  v47 = 0u;
                  v21 = [v20 allKeys];
                  v22 = [v21 countByEnumeratingWithState:&v44 objects:v56 count:16];
                  if (v22)
                  {
                    v23 = v22;
                    v24 = *v45;
                    do
                    {
                      for (j = 0; j != v23; ++j)
                      {
                        if (*v45 != v24)
                        {
                          objc_enumerationMutation(v21);
                        }

                        v26 = *(*(&v44 + 1) + 8 * j);
                        v27 = HAPInstanceIDFromValue();
                        if (v27)
                        {
                          [v12 addObject:v27];
                        }
                      }

                      v23 = [v21 countByEnumeratingWithState:&v44 objects:v56 count:16];
                    }

                    while (v23);
                  }
                }

                v17 = [v42 countByEnumeratingWithState:&v48 objects:v57 count:16];
              }

              while (v17);
            }

            self = v35;
            v4 = v36;
            v7 = v34;
            v8 = 0x277CBE000;
            v9 = 0x277CCA000;
            v6 = v37;
            v15 = v38;
            if ([v12 count])
            {
              v28 = [v12 copy];
              v29 = [v41 UUIDString];
              [v33 setObject:v28 forKeyedSubscript:v29];

              v6 = v37;
              v15 = v38;
            }
          }

          v10 = v40 + 1;
        }

        while (v40 + 1 != v6);
        v6 = [obj countByEnumeratingWithState:&v52 objects:v58 count:16];
      }

      while (v6);
    }

    v30 = [v33 copy];
  }

  else
  {
    v30 = MEMORY[0x277CBEC10];
  }

  v31 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_handleCharacteristicsChangedNotification:(id)a3
{
  v164 = *MEMORY[0x277D85DE8];
  v124 = a3;
  v112 = [v124 dictionaryForKey:@"kCharacteristicNotificationsKey"];
  v113 = [v124 stringForKey:@"kRequestIdentifierKey"];
  v128 = [MEMORY[0x277CBEB18] array];
  if (v113)
  {
    v3 = [(HMDHome *)self accessoryReaderWriter];
    [v3 handleRemotelyUpdatedCharacteristicsMessage:v124];

    v109 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v113];
    v4 = [(HMDHome *)self pendingResponses];
    v122 = [v4 objectForKeyedSubscript:v113];

    v5 = [MEMORY[0x277CBEB18] array];
    if (v122)
    {
      v150 = 0u;
      v151 = 0u;
      v148 = 0u;
      v149 = 0u;
      obj = [v112 allKeys];
      v108 = [obj countByEnumeratingWithState:&v148 objects:v163 count:16];
      if (v108)
      {
        v106 = *v149;
        do
        {
          v6 = 0;
          do
          {
            if (*v149 != v106)
            {
              v7 = v6;
              objc_enumerationMutation(obj);
              v6 = v7;
            }

            v107 = v6;
            v8 = *(*(&v148 + 1) + 8 * v6);
            v9 = [v112 objectForKeyedSubscript:v8];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v10 = v9;
            }

            else
            {
              v10 = 0;
            }

            v116 = v10;

            v111 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v8];
            v11 = [(HMDHome *)self accessoryWithUUID:v111];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v12 = v11;
            }

            else
            {
              v12 = 0;
            }

            v13 = v12;

            v146 = 0u;
            v147 = 0u;
            v144 = 0u;
            v145 = 0u;
            v114 = [v116 allKeys];
            v118 = [v114 countByEnumeratingWithState:&v144 objects:v162 count:16];
            if (v118)
            {
              v115 = *v145;
              do
              {
                v14 = 0;
                do
                {
                  if (*v145 != v115)
                  {
                    v15 = v14;
                    objc_enumerationMutation(v114);
                    v14 = v15;
                  }

                  v120 = v14;
                  v16 = [v116 objectForKeyedSubscript:*(*(&v144 + 1) + 8 * v14)];
                  objc_opt_class();
                  if (objc_opt_isKindOfClass())
                  {
                    v17 = v16;
                  }

                  else
                  {
                    v17 = 0;
                  }

                  v125 = v17;

                  v18 = HAPInstanceIDFromValue();
                  v19 = [v122 pendingResponseCount];
                  if (v19 >= [v125 count])
                  {
                    v21 = [v125 count];
                    v20 = [v122 pendingResponseCount] - v21;
                  }

                  else
                  {
                    v20 = 0;
                  }

                  [v122 setPendingResponseCount:v20];
                  v142 = 0u;
                  v143 = 0u;
                  v140 = 0u;
                  v141 = 0u;
                  v22 = [v125 allKeys];
                  v23 = [v22 countByEnumeratingWithState:&v140 objects:v161 count:16];
                  if (v23)
                  {
                    v24 = 0;
                    v25 = *v141;
                    do
                    {
                      v26 = 0;
                      v27 = v24;
                      do
                      {
                        if (*v141 != v25)
                        {
                          objc_enumerationMutation(v22);
                        }

                        v28 = *(*(&v140 + 1) + 8 * v26);
                        v29 = HAPInstanceIDFromValue();
                        v24 = [v13 findCharacteristic:v29 forService:v18];

                        if (v24)
                        {
                          [v5 addObject:v24];
                          if ([v24 isNotificationEnabledForClientIdentifierPrefix:@"com.apple.HomeKitDaemon.Local"])
                          {
                            [v128 addObject:v24];
                          }
                        }

                        ++v26;
                        v27 = v24;
                      }

                      while (v23 != v26);
                      v23 = [v22 countByEnumeratingWithState:&v140 objects:v161 count:16];
                    }

                    while (v23);
                  }

                  v14 = v120 + 1;
                }

                while (v120 + 1 != v118);
                v118 = [v114 countByEnumeratingWithState:&v144 objects:v162 count:16];
              }

              while (v118);
            }

            v6 = v107 + 1;
          }

          while (v107 + 1 != v108);
          v108 = [obj countByEnumeratingWithState:&v148 objects:v163 count:16];
        }

        while (v108);
      }

      v30 = objc_autoreleasePoolPush();
      v31 = self;
      v32 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_DEBUG))
      {
        v33 = HMFGetLogIdentifier();
        *buf = 138543874;
        v156 = v33;
        v157 = 2112;
        v158 = v113;
        v159 = 2112;
        v160 = v112;
        _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_DEBUG, "%{public}@Notifying changes for requestIdentifier %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v30);
      v34 = objc_autoreleasePoolPush();
      v35 = [(HMDHome *)v31 _splitCharacteristicChanges:v5 changedAccessories:v112];
      v36 = [v122 requestMessage];
      [(HMDHome *)v31 _sendClientCharacteristicsChangedNotificationWithIdentifier:v109 requestMessage:v36 multiPartResponse:1 moreInMultiPartResponse:1 characteristicChanges:v35 completionHandler:0];

      objc_autoreleasePoolPop(v34);
    }

    v117 = MEMORY[0x277CBEBF8];
  }

  else
  {
    v138 = 0u;
    v139 = 0u;
    v136 = 0u;
    v137 = 0u;
    v37 = v112;
    v38 = [v37 countByEnumeratingWithState:&v136 objects:v154 count:16];
    if (v38)
    {
      v39 = *v137;
      do
      {
        for (i = 0; i != v38; ++i)
        {
          if (*v137 != v39)
          {
            objc_enumerationMutation(v37);
          }

          v41 = *(*(&v136 + 1) + 8 * i);
          objc_initWeak(buf, self);
          v42 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v41];
          v43 = [(HMDHome *)self accessoryWithUUID:v42];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v44 = v43;
          }

          else
          {
            v44 = 0;
          }

          v45 = v44;

          v46 = [v37 hmf_dictionaryForKey:v41];
          v47 = [(HMDHome *)self workQueue];
          v133[0] = MEMORY[0x277D85DD0];
          v133[1] = 3221225472;
          v133[2] = __53__HMDHome__handleCharacteristicsChangedNotification___block_invoke;
          v133[3] = &unk_278670F98;
          objc_copyWeak(&v135, buf);
          v134 = v124;
          [v45 handleMultipleCharacteristicsUpdated:v46 message:v134 completionQueue:v47 completionHandler:v133];

          objc_destroyWeak(&v135);
          objc_destroyWeak(buf);
        }

        v38 = [v37 countByEnumeratingWithState:&v136 objects:v154 count:16];
      }

      while (v38);
    }

    v117 = [(HMDHome *)self _unexpectedCharacteristicsFromCharacteristicNotifications:v37];
  }

  v126 = [MEMORY[0x277CBEB18] array];
  v121 = [v124 dictionaryForKey:@"HMDDeviceNotificationActionSetsKey"];
  [HMDActionSetResponse responsesFromSerializedResponses:v121];
  v131 = 0u;
  v132 = 0u;
  v129 = 0u;
  v48 = v130 = 0u;
  v49 = [v48 countByEnumeratingWithState:&v129 objects:v153 count:16];
  if (v49)
  {
    v50 = *v130;
    do
    {
      for (j = 0; j != v49; ++j)
      {
        if (*v130 != v50)
        {
          objc_enumerationMutation(v48);
        }

        v52 = *(*(&v129 + 1) + 8 * j);
        v53 = [v52 actionSetUUID];
        v54 = [(HMDHome *)self actionSetWithUUID:v53];

        if (v54)
        {
          v55 = [(HMDHome *)self actionSetStateSubscriptionManager];
          v56 = [v54 uuid];
          v57 = [v55 isMonitoringActionSet:v56];

          if (v57)
          {
            v58 = [(HMDHome *)self actionSetStateSubscriptionManager];
            v59 = [v52 actionSetUUID];
            [v58 actionSetStateDidChange:v59 state:{objc_msgSend(v52, "state")}];
          }

          else
          {
            v67 = [v54 uuid];
            v68 = [v67 UUIDString];
            [v126 addObject:v68];

            v69 = objc_autoreleasePoolPush();
            v70 = self;
            v71 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v71, OS_LOG_TYPE_DEFAULT))
            {
              v72 = HMFGetLogIdentifier();
              v73 = [v52 actionSetUUID];
              *buf = 138543618;
              v156 = v72;
              v157 = 2112;
              v158 = v73;
              _os_log_impl(&dword_229538000, v71, OS_LOG_TYPE_DEFAULT, "%{public}@Got action set response for unregistered action set %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v69);
          }
        }

        else
        {
          v60 = objc_autoreleasePoolPush();
          v61 = self;
          v62 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v62, OS_LOG_TYPE_ERROR))
          {
            v63 = HMFGetLogIdentifier();
            v64 = [v52 actionSetUUID];
            *buf = 138543618;
            v156 = v63;
            v157 = 2112;
            v158 = v64;
            _os_log_impl(&dword_229538000, v62, OS_LOG_TYPE_ERROR, "%{public}@Got action set response for unknown action set %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v60);
          v65 = [0 uuid];
          v66 = [v65 UUIDString];
          [v126 addObject:v66];
        }
      }

      v49 = [v48 countByEnumeratingWithState:&v129 objects:v153 count:16];
    }

    while (v49);
  }

  v74 = [v124 dictionaryForKey:@"kMediaNotificationsKey"];
  v75 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v74 requests:0 home:self];
  v119 = [[HMDMediaSessionRequestMessageInformation alloc] initWithMessage:v124];
  [(HMDHome *)self updateMediaStateWithResponses:v75 requestMessageInformation:v119];
  v76 = [v124 remoteSourceDevice];
  if ([(HMDHome *)self _shouldRegisterForNotificationsWithDevice:v76])
  {
    v123 = [(HMDHome *)self primaryResident];
    v77 = [v123 device];
    if ([v76 isEqual:v77])
    {
      v78 = [v117 count] == 0;

      if (!v78)
      {
        v79 = objc_autoreleasePoolPush();
        v80 = self;
        v81 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v81, OS_LOG_TYPE_INFO))
        {
          v82 = HMFGetLogIdentifier();
          v83 = [v117 count];
          *buf = 138543618;
          v156 = v82;
          v157 = 2048;
          v158 = v83;
          _os_log_impl(&dword_229538000, v81, OS_LOG_TYPE_INFO, "%{public}@Disabling %tu registrations with primary resident due to unexpected characteristic notification received", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v79);
        v84 = [(HMDHome *)v80 logEventSubmitter];
        v85 = [[HMDUnexpectedNotificationLogEvent alloc] initWithCount:1];
        [v84 submitLogEvent:v85];

        [(HMDHome *)v80 _remotelySetNotificationsEnabled:0 forCharacteristics:v117 characteristicChangeThresholds:0];
      }
    }

    else
    {
    }

    if ([v128 count])
    {
      if ([(HMDHome *)self isCurrentDeviceAvailableResident])
      {
        if (![(HMDHome *)self isCurrentDevicePrimaryResident])
        {
          v92 = [v123 device];
          v93 = [v76 isEqual:v92];

          if (v93)
          {
            v94 = objc_autoreleasePoolPush();
            v95 = self;
            v96 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v96, OS_LOG_TYPE_INFO))
            {
              v97 = HMFGetLogIdentifier();
              v98 = [v128 count];
              *buf = 138543874;
              v156 = v97;
              v157 = 2048;
              v158 = v98;
              v159 = 2112;
              v160 = v128;
              _os_log_impl(&dword_229538000, v96, OS_LOG_TYPE_INFO, "%{public}@Disabling %tu notifications on primary resident: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v94);
            [(HMDHome *)v95 _remotelySetNotificationsEnabled:0 forCharacteristics:v128 characteristicChangeThresholds:0];
          }
        }
      }
    }

    v99 = [(HMDHome *)self _disablePayloadFromRemotelyUpdatedCharacteristicNotifications:v112];
    if ([v99 count] || objc_msgSend(v126, "count"))
    {
      v100 = objc_autoreleasePoolPush();
      v101 = self;
      v102 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v102, OS_LOG_TYPE_INFO))
      {
        v103 = HMFGetLogIdentifier();
        v104 = [v76 shortDescription];
        *buf = 138543618;
        v156 = v103;
        v157 = 2112;
        v158 = v104;
        _os_log_impl(&dword_229538000, v102, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations due to unexpected characteristic notification received on primary resident from remote device: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v100);
      [(HMDHome *)v101 _modifyCharacteristicNotifications:v99 characteristicChangeThresholds:MEMORY[0x277CBEC10] mediaNotifications:MEMORY[0x277CBEC10] actionSetNotificationPayload:v126 enableNotification:0 withDevice:v76];
    }
  }

  else
  {
    v86 = objc_autoreleasePoolPush();
    v87 = self;
    v88 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v88, OS_LOG_TYPE_INFO))
    {
      v89 = HMFGetLogIdentifier();
      *buf = 138543618;
      v156 = v89;
      v157 = 2112;
      v158 = v76;
      _os_log_impl(&dword_229538000, v88, OS_LOG_TYPE_INFO, "%{public}@Disabling notification registrations with resident: %@ due to unexpected characteristic notification received", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v86);
    v90 = [(HMDHome *)v87 logEventSubmitter];
    v91 = [[HMDUnexpectedNotificationLogEvent alloc] initWithCount:1];
    [v90 submitLogEvent:v91];

    v152 = v76;
    v123 = [MEMORY[0x277CBEA60] arrayWithObjects:&v152 count:1];
    [(HMDHome *)v87 _disableNotificationsForDevices:v123];
  }

  [v124 respondWithPayload:0];
  v105 = *MEMORY[0x277D85DE8];
}

void __53__HMDHome__handleCharacteristicsChangedNotification___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if ([v5 count])
  {
    v4 = [v5 hm_allKeys];
    [WeakRetained _notifyChangedCharacteristics:v4 message:*(a1 + 32) modifiedCharacteristics:v5 broadcast:0];
  }
}

- (void)updateMediaStateWithResponses:(void *)a3 requestMessageInformation:
{
  v43 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (a1)
  {
    v30 = v6;
    v32 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v37 = 0u;
    v38 = 0u;
    v39 = 0u;
    v40 = 0u;
    v29 = v5;
    obj = v5;
    v8 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v38;
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v38 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v37 + 1) + 8 * i);
          v13 = [v12 firstObject];
          v14 = [v13 request];
          v15 = [v14 mediaProfile];
          v16 = v15;
          if (v15)
          {
            v17 = [v15 mediaSession];
            if (v17)
            {
              v18 = [v32 objectForKey:v17];
              v19 = [v18 mutableCopy];

              if (v19)
              {
                [v19 addObjectsFromArray:v12];
              }

              else
              {
                v19 = [v12 mutableCopy];
              }

              v20 = [v19 copy];
              [v32 setObject:v20 forKey:v17];
            }

            else
            {
              [v16 updateWithResponses:v12 requestMessageInformation:v30];
            }
          }
        }

        v9 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
      }

      while (v9);
    }

    v35 = 0u;
    v36 = 0u;
    v33 = 0u;
    v34 = 0u;
    v21 = [v32 hm_allKeys];
    v22 = [v21 countByEnumeratingWithState:&v33 objects:v41 count:16];
    v7 = v30;
    if (v22)
    {
      v23 = v22;
      v24 = *v34;
      do
      {
        for (j = 0; j != v23; ++j)
        {
          if (*v34 != v24)
          {
            objc_enumerationMutation(v21);
          }

          v26 = *(*(&v33 + 1) + 8 * j);
          v27 = [v32 objectForKey:{v26, v29}];
          [v26 updateWithResponses:v27 requestMessageInformation:v30];
        }

        v23 = [v21 countByEnumeratingWithState:&v33 objects:v41 count:16];
      }

      while (v23);
    }

    v5 = v29;
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_notifyChangedProperties:(id)a3 withRequestIdentifier:(id)a4 notificationUpdateIdentifier:(id)a5 toUserDeviceAddress:(id)a6
{
  v35 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  if (v13)
  {
    v14 = [(HMDHome *)self notificationHandlerMap];
    v15 = [v14 objectForKey:v13];

    if (!v15)
    {
      v16 = [(HMDHome *)self homeManager];
      v30 = 0u;
      v31 = 0u;
      v32 = 0u;
      v33 = 0u;
      v17 = [v16 watchManager];
      v18 = [v17 connectedWatches];

      v19 = [v18 countByEnumeratingWithState:&v30 objects:v34 count:16];
      if (v19)
      {
        v28 = v16;
        v29 = v10;
        v20 = *v31;
        while (2)
        {
          for (i = 0; i != v19; ++i)
          {
            if (*v31 != v20)
            {
              objc_enumerationMutation(v18);
            }

            v22 = [*(*(&v30 + 1) + 8 * i) remoteDestinationString];
            v23 = [v22 isEqual:v13];

            if (v23)
            {
              v19 = 1;
              goto LABEL_13;
            }
          }

          v19 = [v18 countByEnumeratingWithState:&v30 objects:v34 count:16];
          if (v19)
          {
            continue;
          }

          break;
        }

LABEL_13:
        v16 = v28;
        v10 = v29;
      }

      v24 = [HMDDeviceNotificationHandler alloc];
      v25 = [(HMDHome *)self msgDispatcher];
      v15 = [(HMDDeviceNotificationHandler *)v24 initWithDestination:v13 watchDevice:v19 withRequestIdentifier:v11 messageDispatcher:v25 home:self];

      v26 = [(HMDHome *)self notificationHandlerMap];
      [v26 setObject:v15 forKey:v13];
    }

    [(HMDDeviceNotificationHandler *)v15 sendNotificationForMediaProperties:v10 withRequestIdentifier:v11 notificationUpdateIdentifier:v12];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_notifyRemoteUsersOfChangedProperties:(id)a3 requestMessageInformation:(id)a4
{
  v57 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543362;
    v51 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Notifying users registered with resident of changes in properties", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v39 = v7;
  v12 = [v7 remoteSourceDevice];
  v13 = [(HMDHome *)v9 notificationRegistry];
  v14 = [v13 destinationsRegisteredForNotificationsForProperties:v6];

  v15 = [MEMORY[0x277CBEB58] set];
  skippedInterDeviceChangeNotifications = v9->_skippedInterDeviceChangeNotifications;
  v16 = [MEMORY[0x277CCAD78] UUID];
  v43 = [v16 UUIDString];

  v48 = 0u;
  v49 = 0u;
  v46 = 0u;
  v47 = 0u;
  obj = v14;
  v17 = [obj countByEnumeratingWithState:&v46 objects:v56 count:16];
  v42 = v12;
  if (v17)
  {
    v18 = v17;
    v19 = *v47;
    p_superclass = HMDIDSActivityRegistrationModel.superclass;
    v40 = v6;
    v41 = v9;
    v44 = *v47;
    do
    {
      for (i = 0; i != v18; ++i)
      {
        if (*v47 != v19)
        {
          objc_enumerationMutation(obj);
        }

        v22 = *(*(&v46 + 1) + 8 * i);
        v23 = [p_superclass + 324 deviceWithDestination:v22];
        if (v23)
        {
          [v15 addObject:v23];
          if ([(HMDHome *)v9 _shouldSendToDestination:v22 device:v23 remoteSourceDevice:v12])
          {
            v24 = v15;
            v25 = [(HMDHome *)v9 notificationRegistry];
            v26 = [v25 filterProperties:v6 deviceIdsDestination:v22];

            if ([v26 count])
            {
              v27 = objc_autoreleasePoolPush();
              v28 = v9;
              v29 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
              {
                v30 = HMFGetLogIdentifier();
                *buf = 138543874;
                v51 = v30;
                v52 = 2112;
                v53 = v22;
                v54 = 2112;
                v55 = v43;
                _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Fanning out to device %@ with the properties that changed with notificationUpdateIdentifier: %@", buf, 0x20u);

                v6 = v40;
              }

              objc_autoreleasePoolPop(v27);
              [(HMDHome *)v28 _notifyChangedProperties:v26 withRequestIdentifier:0 notificationUpdateIdentifier:v43 toUserDeviceAddress:v22];
              v9 = v41;
              v12 = v42;
            }

            v15 = v24;
            v19 = v44;
            p_superclass = (HMDIDSActivityRegistrationModel + 8);
          }
        }
      }

      v18 = [obj countByEnumeratingWithState:&v46 objects:v56 count:16];
    }

    while (v18);
  }

  if (isInternalBuild() && skippedInterDeviceChangeNotifications != v9->_skippedInterDeviceChangeNotifications)
  {
    v31 = objc_autoreleasePoolPush();
    v32 = v9;
    HMFGetOSLogHandle();
    v34 = v33 = v9;
    if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
    {
      v35 = HMFGetLogIdentifier();
      v36 = v33->_skippedInterDeviceChangeNotifications;
      *buf = 138543618;
      v51 = v35;
      v52 = 2048;
      v53 = v36;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Skipped %lu spurious inter-device media property change notifications", buf, 0x16u);

      v12 = v42;
    }

    objc_autoreleasePoolPop(v31);
  }

  v37 = *MEMORY[0x277D85DE8];
}

- (void)notifyRemoteUsersOfChangedProperties:(id)a3 requestMessageInformation:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __74__HMDHome_notifyRemoteUsersOfChangedProperties_requestMessageInformation___block_invoke;
  block[3] = &unk_27868A010;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(v8, block);
}

- (void)_notifyUpdatedCharacteristic:(id)a3 withRequestIdentifier:(id)a4 notificationUpdateIdentifier:(id)a5 toUserDeviceAddress:(id)a6 completion:(id)a7
{
  v38 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  if (v15)
  {
    v17 = [(HMDHome *)self notificationHandlerMap];
    v18 = [v17 objectForKey:v15];

    if (!v18)
    {
      [(HMDHome *)self homeManager];
      v33 = 0u;
      v34 = 0u;
      v35 = 0u;
      v32 = v36 = 0u;
      v19 = [v32 watchManager];
      v20 = [v19 connectedWatches];

      v21 = [v20 countByEnumeratingWithState:&v33 objects:v37 count:16];
      if (v21)
      {
        v30 = v14;
        v31 = v12;
        v22 = *v34;
        while (2)
        {
          for (i = 0; i != v21; ++i)
          {
            if (*v34 != v22)
            {
              objc_enumerationMutation(v20);
            }

            v24 = [*(*(&v33 + 1) + 8 * i) remoteDestinationString];
            v25 = [v24 isEqual:v15];

            if (v25)
            {
              v21 = 1;
              goto LABEL_13;
            }
          }

          v21 = [v20 countByEnumeratingWithState:&v33 objects:v37 count:16];
          if (v21)
          {
            continue;
          }

          break;
        }

LABEL_13:
        v14 = v30;
        v12 = v31;
      }

      v26 = [HMDDeviceNotificationHandler alloc];
      v27 = [(HMDHome *)self msgDispatcher];
      v18 = [(HMDDeviceNotificationHandler *)v26 initWithDestination:v15 watchDevice:v21 withRequestIdentifier:v13 messageDispatcher:v27 home:self];

      v28 = [(HMDHome *)self notificationHandlerMap];
      [v28 setObject:v18 forKey:v15];
    }

    [(HMDDeviceNotificationHandler *)v18 sendNotificationForCharacteristicUpdates:v12 withRequestIdentifier:v13 notificationUpdateIdentifier:v14 completion:v16];
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_sendCoalescedRemoteNotificationsForRequestMessage:(id)a3 accessories:(id)a4
{
  v15 = a4;
  v6 = a3;
  v7 = [v6 destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  v10 = [v6 isRemote];
  if (v10)
  {
    v11 = [v9 device];
    v12 = [v11 remoteDestinationString];

    if (v12)
    {
      v13 = [(HMDHome *)self notificationHandlerMap];
      v14 = [v13 objectForKey:v12];

      [v14 sendCoalescedRemoteNotificationForAccessories:v15];
    }
  }
}

- (BOOL)_shouldSendToDestination:(id)a3 device:(id)a4 remoteSourceDevice:(id)a5
{
  v41 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [HMDDeviceHandle deviceHandleForDestination:v8];
  v12 = +[HMDAccountRegistry sharedRegistry];
  v13 = [v12 deviceForHandle:v11];

  v14 = [v13 account];

  if (!v14)
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v22 = [v13 shortDescription];
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = v22;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Device %@ has no user attached to it", &v37, 0x16u);

LABEL_28:
      goto LABEL_29;
    }

    goto LABEL_29;
  }

  if (v9 && [v10 isEqual:v9])
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
    {
      v18 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = v8;
      v19 = "%{public}@Skipping device %@ since it is the original sender";
LABEL_9:
      v20 = v17;
      v21 = OS_LOG_TYPE_DEBUG;
LABEL_27:
      _os_log_impl(&dword_229538000, v20, v21, v19, &v37, 0x16u);
      goto LABEL_28;
    }

    goto LABEL_29;
  }

  if ([v13 isCurrentDevice])
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
    {
      v18 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = v8;
      v19 = "%{public}@Skipping device %@ - ourselves";
      goto LABEL_9;
    }

LABEL_29:

    objc_autoreleasePoolPop(v15);
    v34 = 0;
    goto LABEL_30;
  }

  v23 = [(HMDHome *)self localCapabilitiesDataSource];
  if ([v23 isCompanionCapable])
  {
  }

  else
  {
    v24 = [(HMDHome *)self residentDeviceManager];
    v25 = [v24 isCurrentDeviceAvailableResident];

    if ((v25 & 1) == 0)
    {
      ++self->_skippedInterDeviceChangeNotifications;
      v15 = objc_autoreleasePoolPush();
      v16 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_29;
      }

      v18 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = v8;
      v19 = "%{public}@Skipping device %@ since this device is not a companion or enabled resident";
      goto LABEL_26;
    }
  }

  v26 = [(HMDHome *)self localCapabilitiesDataSource];
  v27 = [v26 isCompanionCapable];

  if (v27)
  {
    v28 = [v13 productInfo];
    if (v28 && (v29 = v28, [v13 productInfo], v30 = objc_claimAutoreleasedReturnValue(), v31 = objc_msgSend(v30, "productClass"), v30, v29, v31 != 5))
    {
      ++self->_skippedInterDeviceChangeNotifications;
      v15 = objc_autoreleasePoolPush();
      v16 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_29;
      }

      v18 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = v8;
      v19 = "%{public}@Skipping device %@ since this device is a companion but sending to non-watch";
    }

    else
    {
      v32 = [(HMDHome *)self homeManager];
      v33 = [v32 isPairedWithWatch];

      if (v33)
      {
        goto LABEL_19;
      }

      ++self->_skippedInterDeviceChangeNotifications;
      v15 = objc_autoreleasePoolPush();
      v16 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_29;
      }

      v18 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v18;
      v39 = 2112;
      v40 = v8;
      v19 = "%{public}@Skipping device %@ since this device is a companion but not paired with a watch";
    }

LABEL_26:
    v20 = v17;
    v21 = OS_LOG_TYPE_INFO;
    goto LABEL_27;
  }

LABEL_19:
  v34 = 1;
LABEL_30:

  v35 = *MEMORY[0x277D85DE8];
  return v34;
}

- (id)_userForDevice:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self users];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __26__HMDHome__userForDevice___block_invoke;
  v9[3] = &unk_2786704C0;
  v10 = v4;
  v6 = v4;
  v7 = [v5 hmf_objectPassingTest:v9];

  return v7;
}

uint64_t __26__HMDHome__userForDevice___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 account];
  v4 = [*(a1 + 32) account];
  v5 = [v3 isEqual:v4];

  return v5;
}

- (void)saveAttributedUserUUID:(id)a3 forTargetStateCharacteristic:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [(HMDHome *)self bulletinUserAttributionManager];

  if (!v8)
  {
    v9 = [HMDBulletinUserAttributionManager alloc];
    v10 = +[HMDAccountRegistry sharedRegistry];
    v11 = [(HMDBulletinUserAttributionManager *)v9 initWithAccountRegistry:v10];
    [(HMDHome *)self setBulletinUserAttributionManager:v11];
  }

  v12 = [(HMDHome *)self bulletinUserAttributionManager];
  [v12 saveAttributedUserUUID:v7 forTargetStateCharacteristic:v6];
}

- (BOOL)_shouldUseAttributeReportForBulletin:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ((_os_feature_enabled_impl() & 1) == 0 && !CFPreferencesGetAppBooleanValue(@"MatterTTU", @"/Library/Managed Preferences/mobile/com.apple.homed.plist", 0))
  {
    goto LABEL_9;
  }

  v5 = [v4 accessory];
  if (([v5 supportsCHIP] & 1) == 0)
  {

    goto LABEL_9;
  }

  v6 = [v4 type];
  v7 = [v6 isEqualToString:*MEMORY[0x277CCF838]];

  if (!v7)
  {
LABEL_9:
    v12 = 1;
    goto LABEL_10;
  }

  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543362;
    v16 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Not notifying matter lock characteristic change, this is handled upon receiving event report", &v15, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = 0;
LABEL_10:

  v13 = *MEMORY[0x277D85DE8];
  return v12;
}

- (id)_characteristicUpdatesForChangedCharacteristics:(id)a3 bulletinCharacteristics:(id)a4 broadcast:(BOOL)a5
{
  v8 = a4;
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __93__HMDHome__characteristicUpdatesForChangedCharacteristics_bulletinCharacteristics_broadcast___block_invoke;
  v12[3] = &unk_278670498;
  v13 = v8;
  v14 = self;
  v15 = a5;
  v9 = v8;
  v10 = [a3 na_map:v12];

  return v10;
}

HMDCharacteristicUpdateTuple *__93__HMDHome__characteristicUpdatesForChangedCharacteristics_bulletinCharacteristics_broadcast___block_invoke(uint64_t a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [*(a1 + 32) containsObject:v3];
  v5 = [*(a1 + 40) _shouldUseAttributeReportForBulletin:v3];
  if (v4)
  {
    v6 = v5 == 0;
  }

  else
  {
    v6 = 1;
  }

  if (v6)
  {
LABEL_6:
    v7 = 0;
    goto LABEL_10;
  }

  v8 = [v3 type];
  v9 = [v8 isEqualToString:*MEMORY[0x277CCF910]];

  if ((v9 & 1) == 0)
  {
    v10 = [v3 previousValue];

    if (!v10)
    {
      v16 = objc_autoreleasePoolPush();
      v17 = *(a1 + 40);
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        v20 = [v3 shortDescription];
        v21 = 138543618;
        v22 = v19;
        v23 = 2112;
        v24 = v20;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Initial update for characteristic: %@, receiver should not display bulletin", &v21, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      goto LABEL_6;
    }
  }

  v7 = 1;
LABEL_10:
  v11 = [HMDCharacteristicUpdateTuple alloc];
  v12 = [v3 value];
  v13 = [(HMDCharacteristicUpdateTuple *)v11 initWithCharacteristic:v3 updatedValue:v12 isBroadcast:*(a1 + 48) reasons:v7];

  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)_pushTokenToDestinationMappingForDestinations:(id)a3
{
  v4 = MEMORY[0x277CBEB38];
  v5 = a3;
  v6 = [v4 dictionary];
  v10 = MEMORY[0x277D85DD0];
  v11 = 3221225472;
  v12 = __57__HMDHome__pushTokenToDestinationMappingForDestinations___block_invoke;
  v13 = &unk_27867E4C8;
  v14 = self;
  v15 = v6;
  v7 = v6;
  [v5 hmf_enumerateWithAutoreleasePoolUsingBlock:&v10];

  v8 = [v7 copy];

  return v8;
}

void __57__HMDHome__pushTokenToDestinationMappingForDestinations___block_invoke(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [HMDDeviceHandle deviceHandleForDestination:v3];
  v5 = [v4 pushToken];
  if (v5)
  {
    [*(a1 + 40) setObject:v3 forKeyedSubscript:v5];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 32);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v9;
      v13 = 2112;
      v14 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to parse push token for destination: %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (id)_characteristicUpdatesByDestinationForNotificationRegistryDestinations:(id)a3 bulletinDestinations:(id)a4 broadcast:(BOOL)a5
{
  v8 = a3;
  v9 = a4;
  v10 = [v9 allKeys];
  v11 = [(HMDHome *)self _pushTokenToDestinationMappingForDestinations:v10];

  v12 = [v8 allKeys];
  v13 = [(HMDHome *)self _pushTokenToDestinationMappingForDestinations:v12];

  v14 = [MEMORY[0x277CBEB58] set];
  v15 = [v11 allKeys];
  [v14 addObjectsFromArray:v15];

  v16 = [v13 allKeys];
  [v14 addObjectsFromArray:v16];

  v17 = [MEMORY[0x277CBEB38] dictionary];
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __113__HMDHome__characteristicUpdatesByDestinationForNotificationRegistryDestinations_bulletinDestinations_broadcast___block_invoke;
  v25[3] = &unk_278670470;
  v26 = v11;
  v27 = v9;
  v28 = v13;
  v29 = v8;
  v32 = a5;
  v30 = self;
  v31 = v17;
  v18 = v17;
  v19 = v8;
  v20 = v13;
  v21 = v9;
  v22 = v11;
  [v14 hmf_enumerateWithAutoreleasePoolUsingBlock:v25];
  v23 = [v18 copy];

  return v23;
}

void __113__HMDHome__characteristicUpdatesByDestinationForNotificationRegistryDestinations_bulletinDestinations_broadcast___block_invoke(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [MEMORY[0x277CBEB58] set];
  v5 = [*(a1 + 32) objectForKeyedSubscript:v3];
  v6 = [*(a1 + 40) objectForKeyedSubscript:v5];
  v7 = [v6 allObjects];
  [v4 addObjectsFromArray:v7];

  v8 = [*(a1 + 48) objectForKeyedSubscript:v3];
  v9 = [*(a1 + 56) objectForKeyedSubscript:v8];
  v10 = [v9 allObjects];
  [v4 addObjectsFromArray:v10];

  if ([v4 count])
  {
    v11 = [*(a1 + 64) _characteristicUpdatesForChangedCharacteristics:v4 bulletinCharacteristics:v6 broadcast:*(a1 + 80)];
    if (v8)
    {
      v12 = v8;
    }

    else
    {
      v12 = v5;
    }

    [*(a1 + 72) setObject:v11 forKeyedSubscript:v12];
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = *(a1 + 64);
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v18 = 138543874;
      v19 = v16;
      v20 = 2112;
      v21 = v5;
      v22 = 2112;
      v23 = v8;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@No changed characteristics found for destination: %@ / %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldRateLimitChangeNotificationsForCharacteristic:(id)a3
{
  v3 = a3;
  v4 = [v3 service];
  v5 = [v3 type];
  if (([v5 isEqualToString:*MEMORY[0x277CFE628]] & 1) == 0)
  {

    goto LABEL_5;
  }

  v6 = [v4 type];
  if (![v6 isEqualToString:*MEMORY[0x277CFE900]])
  {
    v8 = [v4 type];
    v9 = [v8 isEqualToString:*MEMORY[0x277CFE860]];

    if (v9)
    {
      goto LABEL_7;
    }

LABEL_5:
    v7 = 0;
    goto LABEL_14;
  }

LABEL_7:
  v10 = [v3 previousValue];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v10;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;

  [v12 doubleValue];
  v27 = v13;

  v14 = [v3 value];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = v14;
  }

  else
  {
    v15 = 0;
  }

  v16 = v15;

  [v16 doubleValue];
  v26 = v17;

  v18.f64[0] = v27;
  v18.f64[1] = v26;
  __asm { FMOV            V1.2D, #0.5 }

  v24 = vmulq_f64(vrndaq_f64(vaddq_f64(v18, v18)), _Q1);
  v7 = fabs(vsubq_f64(v24, vdupq_laneq_s64(v24, 1)).f64[0]) < 2.22044605e-16;
LABEL_14:

  return v7;
}

- (void)_notifyRemoteUsersOfChangedCharacteristics:(id)a3 message:(id)a4 broadcast:(BOOL)a5
{
  v106 = a5;
  v149 = *MEMORY[0x277D85DE8];
  v7 = a3;
  v108 = a4;
  v115 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v7, "count")}];
  v110 = [MEMORY[0x277CBEB58] set];
  v136 = 0u;
  v137 = 0u;
  v138 = 0u;
  v139 = 0u;
  v8 = v7;
  v9 = [v8 countByEnumeratingWithState:&v136 objects:v148 count:16];
  obj = v8;
  if (v9)
  {
    v10 = v9;
    v119 = 0;
    v120 = *v137;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v137 != v120)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v136 + 1) + 8 * i);
        v13 = [v12 accessory];
        v14 = [v12 stateNumber];
        [v13 updateTrackedAccessoryStateNumber:v14];

        v15 = [(HMDHome *)self dataSource];
        v16 = [v15 hapMetadata];
        v17 = [v12 type];
        [v12 service];
        v19 = v18 = self;
        v20 = [v19 type];
        v21 = [v16 shouldFilterChangeNotificationsForCharacteristicType:v17 serviceType:v20];

        if (v21)
        {
          self = v18;
        }

        else
        {
          self = v18;
          if ([(HMDHome *)v18 _shouldRateLimitChangeNotificationsForCharacteristic:v12])
          {
            v22 = objc_autoreleasePoolPush();
            v23 = v18;
            v24 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
            {
              v25 = HMFGetLogIdentifier();
              *buf = 138543618;
              v141 = v25;
              v142 = 2112;
              v143 = v12;
              _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Filtering out characteristic for remote notification due to rate limiting: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v22);
          }

          else
          {
            v26 = [v12 accessory];
            if ([v26 hasBTLELink])
            {
              v27 = [v26 identifier];
              v28 = [v26 matchingTransportInformationWithServerIdentifier:v27 instanceID:0 linkType:1];

              if (([v28 isReachable] & 1) == 0)
              {
                [v110 addObject:v12];
              }
            }

            v119 |= [HMDBulletinUserAttributionManager currentStateCharacteristicSupportsUserAttribution:v12];
            [v115 addObject:v12];
          }
        }
      }

      v8 = obj;
      v10 = [obj countByEnumeratingWithState:&v136 objects:v148 count:16];
    }

    while (v10);
  }

  else
  {
    LOBYTE(v119) = 0;
  }

  v29 = v115;
  if ([v115 count])
  {
    v30 = v108;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v31 = v30;
    }

    else
    {
      v31 = 0;
    }

    v32 = v31;

    v103 = v32;
    v33 = [v32 destination];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v34 = v33;
    }

    else
    {
      v34 = 0;
    }

    v35 = v34;

    v102 = v35;
    v36 = [v35 device];
    v37 = [(HMDHome *)self primaryResident];
    v105 = [v37 device];

    v38 = [MEMORY[0x277CBEB58] set];
    v39 = [(HMDHome *)self notificationRegistry];
    v107 = [v39 characteristicsByDestinationForCharacteristics:v115 applyChangeThresholding:1];

    v40 = [(HMDHome *)self residentDeviceManager];
    LODWORD(v35) = [v40 isCurrentDeviceConfirmedPrimaryResident];

    if (v35)
    {
      v41 = [(HMDHome *)self accessoryBulletinNotificationManager];
      v42 = [v41 characteristicsByDestinationForCharacteristics:v115];
    }

    else
    {
      v42 = MEMORY[0x277CBEC10];
    }

    v104 = v42;
    v47 = [(HMDHome *)self _characteristicUpdatesByDestinationForNotificationRegistryDestinations:v107 bulletinDestinations:v42 broadcast:v106];
    v48 = MEMORY[0x277CBEB58];
    v114 = v47;
    v49 = [v47 allKeys];
    v116 = [v48 setWithArray:v49];

    v50 = [(HMDHome *)self residentDeviceManager];
    LODWORD(v49) = [v50 isCurrentDeviceAvailableResident];

    v121 = self;
    v100 = v49;
    v111 = v36;
    v113 = v38;
    if (v49)
    {
      v134 = 0u;
      v135 = 0u;
      v132 = 0u;
      v133 = 0u;
      v51 = [(HMDHome *)self residentEnabledDevices];
      v52 = [v51 countByEnumeratingWithState:&v132 objects:v147 count:16];
      if (!v52)
      {
        goto LABEL_47;
      }

      v53 = v52;
      v54 = *v133;
      while (1)
      {
        for (j = 0; j != v53; ++j)
        {
          if (*v133 != v54)
          {
            objc_enumerationMutation(v51);
          }

          v56 = *(*(&v132 + 1) + 8 * j);
          v57 = [(HMDHome *)self primaryResident];
          if (([v57 isCurrentDevice] & 1) == 0)
          {
            v58 = [(HMDHome *)self primaryResident];
            v59 = [v58 device];
            v60 = [v59 remoteDestinationString];
            v61 = [v116 containsObject:v60];

            if (v61)
            {
              goto LABEL_45;
            }

            v57 = [v56 remoteDestinationString];
            [v116 addObject:v57];
          }

LABEL_45:
          self = v121;
        }

        v53 = [v51 countByEnumeratingWithState:&v132 objects:v147 count:16];
        if (!v53)
        {
LABEL_47:

          v36 = v111;
          v38 = v113;
          break;
        }
      }
    }

    v62 = [MEMORY[0x277CCAD78] UUID];
    v112 = [v62 UUIDString];

    skippedInterDeviceChangeNotifications = self->_skippedInterDeviceChangeNotifications;
    if (v119)
    {
      v63 = dispatch_group_create();
    }

    else
    {
      v63 = 0;
    }

    v130 = 0u;
    v131 = 0u;
    v128 = 0u;
    v129 = 0u;
    v117 = v116;
    v64 = [v117 countByEnumeratingWithState:&v128 objects:v146 count:16];
    v109 = v63;
    if (v64)
    {
      v65 = v64;
      v66 = *v129;
      p_superclass = HMDIDSActivityRegistrationModel.superclass;
      do
      {
        for (k = 0; k != v65; ++k)
        {
          if (*v129 != v66)
          {
            objc_enumerationMutation(v117);
          }

          v69 = *(*(&v128 + 1) + 8 * k);
          v70 = [p_superclass + 324 deviceWithDestination:v69];
          if (v70)
          {
            [v38 addObject:v70];
            if ([(HMDHome *)self _shouldSendToDestination:v69 device:v70 remoteSourceDevice:v36])
            {
              v71 = [v114 objectForKeyedSubscript:v69];
              v72 = [v71 allObjects];

              if ([v72 count])
              {
                v73 = objc_autoreleasePoolPush();
                v74 = self;
                v75 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v75, OS_LOG_TYPE_INFO))
                {
                  v76 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v141 = v76;
                  v142 = 2112;
                  v143 = v69;
                  v144 = 2112;
                  v145 = v112;
                  _os_log_impl(&dword_229538000, v75, OS_LOG_TYPE_INFO, "%{public}@Fanning out to device %@ with the characteristics that changed for notificationUpdateIdentifier: %@", buf, 0x20u);

                  v63 = v109;
                }

                objc_autoreleasePoolPop(v73);
                if (v119)
                {
                  dispatch_group_enter(v63);
                }

                v125[0] = MEMORY[0x277D85DD0];
                v125[1] = 3221225472;
                v125[2] = __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke;
                v125[3] = &unk_2786765E0;
                v127 = v119 & 1;
                v126 = v63;
                [(HMDHome *)v74 _notifyUpdatedCharacteristic:v72 withRequestIdentifier:0 notificationUpdateIdentifier:v112 toUserDeviceAddress:v69 completion:v125];

                self = v121;
                v36 = v111;
              }

              v38 = v113;
              p_superclass = (HMDIDSActivityRegistrationModel + 8);
            }
          }
        }

        v65 = [v117 countByEnumeratingWithState:&v128 objects:v146 count:16];
      }

      while (v65);
    }

    v29 = v115;
    if (v119)
    {
      v77 = [(HMDHome *)self workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke_2;
      block[3] = &unk_27868A750;
      v123 = v115;
      v124 = self;
      dispatch_group_notify(v63, v77, block);
    }

    v78 = v104;
    v79 = v105;
    if (![v115 count] || !v105 || (objc_msgSend(v105, "isCurrentDevice") & 1) != 0 || (objc_msgSend(v38, "containsObject:", v105) & 1) != 0 || (objc_msgSend(v36, "isEqual:", v105) & 1) != 0)
    {
      goto LABEL_83;
    }

    if (v100)
    {
      v80 = v38;
      v81 = objc_autoreleasePoolPush();
      v82 = self;
      v83 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v83, OS_LOG_TYPE_INFO))
      {
        v84 = HMFGetLogIdentifier();
        v85 = [v105 remoteDestinationString];
        *buf = 138543874;
        v141 = v84;
        v142 = 2112;
        v143 = v85;
        v144 = 2112;
        v145 = v112;
        _os_log_impl(&dword_229538000, v83, OS_LOG_TYPE_INFO, "%{public}@Fanning to primary resident destination %@ with notificationUpdateIdentifier: %@", buf, 0x20u);

        v63 = v109;
      }

      objc_autoreleasePoolPop(v81);
      v79 = v105;
      v86 = [v105 remoteDestinationString];
      [(HMDHome *)v82 _notifyChangedCharacteristics:v115 withRequestIdentifier:0 notificationUpdateIdentifier:v112 toUserDeviceAddress:v86 broadcast:v106];
    }

    else
    {
      if (![v110 count])
      {
        ++self->_skippedInterDeviceChangeNotifications;
LABEL_83:
        if (isInternalBuild() && skippedInterDeviceChangeNotifications != self->_skippedInterDeviceChangeNotifications)
        {
          v93 = v38;
          v94 = objc_autoreleasePoolPush();
          v95 = self;
          v96 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v96, OS_LOG_TYPE_INFO))
          {
            v97 = HMFGetLogIdentifier();
            v98 = self->_skippedInterDeviceChangeNotifications;
            *buf = 138543618;
            v141 = v97;
            v142 = 2048;
            v143 = v98;
            _os_log_impl(&dword_229538000, v96, OS_LOG_TYPE_INFO, "%{public}@Skipped %lu spurious inter-device characteristic change notifications", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v94);
          v78 = v104;
          v79 = v105;
          v38 = v93;
          v63 = v109;
        }

        goto LABEL_89;
      }

      v80 = v38;
      v87 = objc_autoreleasePoolPush();
      v88 = self;
      v89 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v89, OS_LOG_TYPE_INFO))
      {
        v90 = HMFGetLogIdentifier();
        v91 = [v105 remoteDestinationString];
        *buf = 138543874;
        v141 = v90;
        v142 = 2112;
        v143 = v91;
        v144 = 2112;
        v145 = v112;
        _os_log_impl(&dword_229538000, v89, OS_LOG_TYPE_INFO, "%{public}@Fanning the characteristics changed over BTLE to primary resident destination %@ with notificationUpdateIdentifier: %@", buf, 0x20u);

        v63 = v109;
      }

      objc_autoreleasePoolPop(v87);
      v86 = [v110 allObjects];
      v79 = v105;
      v92 = [v105 remoteDestinationString];
      [(HMDHome *)v88 _notifyChangedCharacteristics:v86 withRequestIdentifier:0 notificationUpdateIdentifier:v112 toUserDeviceAddress:v92 broadcast:v106];
    }

    v38 = v80;
    v78 = v104;
    goto LABEL_83;
  }

  if ([v8 count])
  {
    v43 = objc_autoreleasePoolPush();
    v44 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
    {
      v46 = HMFGetLogIdentifier();
      *buf = 138543362;
      v141 = v46;
      _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_DEBUG, "%{public}@No changes to notify remote devices of changed characteristics after filtering", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v43);
  }

LABEL_89:

  v99 = *MEMORY[0x277D85DE8];
}

void __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke(uint64_t a1)
{
  if (*(a1 + 40) == 1)
  {
    dispatch_group_leave(*(a1 + 32));
  }
}

void __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke_2(uint64_t a1)
{
  v41 = *MEMORY[0x277D85DE8];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  obj = *(a1 + 32);
  v1 = [obj countByEnumeratingWithState:&v30 objects:v40 count:16];
  if (v1)
  {
    v3 = v1;
    v4 = *v31;
    *&v2 = 138543874;
    v23 = v2;
    v24 = *v31;
    do
    {
      v5 = 0;
      v26 = v3;
      do
      {
        if (*v31 != v4)
        {
          objc_enumerationMutation(obj);
        }

        v6 = *(*(&v30 + 1) + 8 * v5);
        v7 = [v6 service];
        if ([HMDBulletinUserAttributionManager currentStateCharacteristicSupportsUserAttribution:v6])
        {
          v8 = [objc_opt_class() currentTargetStateCharacteristicTypeMap];
          v9 = [v6 type];
          v10 = [v8 hmf_stringForKey:v9];

          v11 = [v7 characteristics];
          v28[0] = MEMORY[0x277D85DD0];
          v28[1] = 3221225472;
          v28[2] = __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke_3;
          v28[3] = &unk_278687EB0;
          v12 = v10;
          v29 = v12;
          v13 = [v11 na_firstObjectPassingTest:v28];

          v14 = [v13 value];
          v15 = [v6 value];
          v16 = [v14 isEqual:v15];

          if (v16)
          {
            v17 = [*(a1 + 40) bulletinUserAttributionManager];
            [v17 removeAttributedUserUUIDForTargetStateCharacteristic:v13];

            v4 = v24;
          }

          else
          {
            v18 = objc_autoreleasePoolPush();
            v19 = *(a1 + 40);
            v20 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
            {
              v21 = HMFGetLogIdentifier();
              *buf = v23;
              v35 = v21;
              v36 = 2112;
              v37 = v6;
              v38 = 2112;
              v39 = v13;
              _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Not removing attributed user yet for currentStateCharacteristic=%@ because value is not the same as saved targetStateCharacteristic=%@", buf, 0x20u);

              v4 = v24;
            }

            objc_autoreleasePoolPop(v18);
          }

          v3 = v26;
        }

        ++v5;
      }

      while (v3 != v5);
      v3 = [obj countByEnumeratingWithState:&v30 objects:v40 count:16];
    }

    while (v3);
  }

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __72__HMDHome__notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke_3(uint64_t a1, void *a2)
{
  v3 = [a2 type];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (BOOL)_shouldRegisterForNotificationsWithDevice:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self primaryResident];
  isWatch();
  if (v5)
  {
    v6 = [v5 device];
    v7 = [v6 isCurrentDevice];

    if (v7)
    {
      v8 = 1;
    }

    else
    {
      v9 = [v5 device];
      v8 = [v4 isEqual:v9];
    }
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (BOOL)shouldRelayNotificationToRegisteredDevicesForSource:(id)a3
{
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;
  v7 = [v4 destination];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (![v6 isRemote] || (isKindOfClass & 1) == 0 || !v7)
  {
    goto LABEL_15;
  }

  v9 = [v6 name];
  if ([v9 isEqualToString:@"kCharacteristicValueUpdatedNotificationKey"])
  {
LABEL_10:

    goto LABEL_11;
  }

  v10 = [v6 name];
  if ([v10 isEqualToString:@"kMultipleCharacteristicValuesUpdatedNotificationKey"])
  {

    goto LABEL_10;
  }

  v14 = [v6 name];
  v15 = [v14 isEqualToString:@"kCharacterisiticsChangedInternalNotificationKey"];

  if ((v15 & 1) == 0)
  {
LABEL_15:
    isWatch();
    goto LABEL_16;
  }

LABEL_11:
  v11 = [(HMDHome *)self primaryResident];
  if ([v11 isCurrentDevice])
  {

LABEL_16:
    v13 = 1;
    goto LABEL_17;
  }

  v12 = [(HMDHome *)self homeManager];
  v13 = [v12 isPairedWithWatch];

LABEL_17:
  return v13;
}

- (id)_splitCharacteristicChanges:(id)a3 changedAccessories:(id)a4
{
  v79 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v57 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v7, "count")}];
  v59 = v7;
  v58 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v7, "count")}];
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  v77 = 0u;
  obj = v6;
  v8 = [obj countByEnumeratingWithState:&v74 objects:v78 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v75;
    v61 = self;
    v62 = *v75;
    do
    {
      v11 = 0;
      v63 = v9;
      do
      {
        if (*v75 != v10)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v74 + 1) + 8 * v11);
        v13 = [v12 service];
        v14 = [v13 accessory];
        v15 = v14;
        if (v13)
        {
          v16 = v14 == 0;
        }

        else
        {
          v16 = 1;
        }

        if (!v16)
        {
          v17 = [(HMDHome *)self dataSource];
          v18 = [v17 hapMetadata];
          v19 = [v12 type];
          v73 = v18;
          if (([v18 shouldFilterCharacteristicOfTypeFromApp:v19] & 1) == 0)
          {
            v70 = v17;
            v72 = v19;
            v20 = [(HMDHome *)self dataSource];
            v21 = [v20 hapMetadata];
            v22 = [v13 type];
            if ([v21 shouldFilterServiceOfTypeFromApp:v22])
            {
              v67 = v21;
              goto LABEL_13;
            }

            v23 = [(HMDHome *)self dataSource];
            [v23 hapMetadata];
            v24 = v64 = v20;
            v25 = [v12 type];
            v26 = [v13 type];
            v68 = [v24 shouldFilterChangeNotificationsForCharacteristicType:v25 serviceType:v26];

            self = v61;
            v9 = v63;

            v10 = v62;
            if (v68)
            {
              goto LABEL_31;
            }

            v27 = [v15 uuid];
            v28 = [v27 UUIDString];

            v70 = v28;
            v29 = [v59 objectForKey:v28];
            v30 = [v13 instanceID];
            v31 = [v30 stringValue];

            v72 = v31;
            v73 = v29;
            v20 = [v29 objectForKey:v31];
            v32 = [v12 instanceID];
            v33 = [v32 stringValue];

            v34 = [v20 objectForKey:v33];
            v67 = v33;
            if (v34)
            {
              v60 = v34;
              v35 = v58;
              if (isAppleTV())
              {
                v65 = v20;
                v36 = [(HMDHome *)v61 dataSource];
                v37 = [v36 hapMetadata];
                v38 = [v12 type];
                v39 = [v13 type];
                v40 = [v37 requiresDeviceUnlock:v38 forService:v39];

                v17 = v70;
                if (v40)
                {
                  v41 = v57;

                  v35 = v41;
                }

                self = v61;
                v20 = v65;
              }

              else
              {
                v17 = v70;
              }

              v42 = accessoryToEncodeForXPCTransportForAccessory(v15);
              v66 = v42;
              if (v42 != v15)
              {
                v43 = [v42 uuid];
                v44 = [v43 UUIDString];

                v45 = v57;
                v17 = v44;
                v35 = v45;
              }

              v9 = v63;
              v46 = [v35 objectForKey:v17];
              if (!v46)
              {
                v47 = MEMORY[0x277CBEB38];
                v48 = [v73 count];
                v49 = v47;
                v9 = v63;
                v46 = [v49 dictionaryWithCapacity:v48];
                [v35 setObject:v46 forKey:v17];
              }

              v71 = v35;
              v50 = [v46 objectForKey:v72];
              if (!v50)
              {
                v51 = MEMORY[0x277CBEB38];
                v52 = [v20 count];
                v53 = v51;
                v9 = v63;
                v50 = [v53 dictionaryWithCapacity:v52];
                [v46 setObject:v50 forKey:v72];
              }

              v22 = v60;
              [v50 setObject:v60 forKey:v67];

              v10 = v62;
            }

            else
            {
              v22 = 0;
              v9 = v63;
LABEL_13:
              v17 = v70;
            }

            v19 = v72;
          }
        }

LABEL_31:

        ++v11;
      }

      while (v9 != v11);
      v9 = [obj countByEnumeratingWithState:&v74 objects:v78 count:16];
    }

    while (v9);
  }

  v54 = [[HMDCharacteristicUpdatesNotificationPayload alloc] initWithSPIEntitledClientUpdates:v57 allClientUpdates:v58];
  v55 = *MEMORY[0x277D85DE8];

  return v54;
}

- (void)_handleRequestHomeDataSync:(id)a3
{
  v60 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self isOwnerUser];
  v6 = MEMORY[0x277CCFD28];
  if (!v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [v4 identifier];
      v12 = [v11 UUIDString];
      *buf = 138543618;
      v57 = v10;
      v58 = 2112;
      v59 = v12;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Not owner, cannot send for message: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    v13 = [MEMORY[0x277CCA9B8] errorWithDomain:*v6 code:10 userInfo:0];
    v14 = [v4 responseHandler];

    if (v14)
    {
      v15 = [v4 responseHandler];
      (v15)[2](v15, v13, 0);
    }
  }

  v16 = [v4 stringForKey:@"pairingUsername"];
  if (!v16)
  {
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      v21 = [v4 identifier];
      v22 = [v21 UUIDString];
      *buf = 138543618;
      v57 = v20;
      v58 = 2112;
      v59 = v22;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@User is not specified for message: %@", buf, 0x16u);

      v6 = MEMORY[0x277CCFD28];
    }

    objc_autoreleasePoolPop(v17);
    v23 = [MEMORY[0x277CCA9B8] errorWithDomain:*v6 code:2 userInfo:0];
    v24 = [v4 responseHandler];

    if (v24)
    {
      v25 = [v4 responseHandler];
      (v25)[2](v25, v23, 0);
    }
  }

  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  v26 = [(HMDHome *)self users];
  v27 = [v26 countByEnumeratingWithState:&v51 objects:v55 count:16];
  if (v27)
  {
    v28 = v27;
    v29 = *v52;
LABEL_15:
    v30 = 0;
    while (1)
    {
      if (*v52 != v29)
      {
        objc_enumerationMutation(v26);
      }

      v31 = *(*(&v51 + 1) + 8 * v30);
      if (([v31 isRemoteGateway] & 1) == 0)
      {
        v32 = [v31 pairingUsername];
        v33 = [v16 isEqualToString:v32];

        if (v33)
        {
          break;
        }
      }

      if (v28 == ++v30)
      {
        v28 = [v26 countByEnumeratingWithState:&v51 objects:v55 count:16];
        if (v28)
        {
          goto LABEL_15;
        }

        goto LABEL_22;
      }
    }

    v34 = v31;

    if (v34)
    {
      goto LABEL_29;
    }
  }

  else
  {
LABEL_22:
  }

  v35 = objc_autoreleasePoolPush();
  v36 = self;
  v37 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
  {
    v38 = HMFGetLogIdentifier();
    v39 = [v4 identifier];
    v40 = [v39 UUIDString];
    *buf = 138543618;
    v57 = v38;
    v58 = 2112;
    v59 = v40;
    _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_INFO, "%{public}@Unable to find user for message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v35);
  v41 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  v42 = [v4 responseHandler];

  if (v42)
  {
    v43 = [v4 responseHandler];
    (v43)[2](v43, v41, 0);
  }

  v34 = 0;
LABEL_29:
  v44 = [v4 destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v45 = v44;
  }

  else
  {
    v45 = 0;
  }

  v46 = v45;

  if (v46)
  {
    v47 = [(HMDHome *)self homeManager];
    v48 = [v46 device];
    v49 = [v48 remoteDestinationString];
    [v47 sendUserAdded:v34 destination:v49 toHome:self];
  }

  [v4 respondWithPayload:0];

  v50 = *MEMORY[0x277D85DE8];
}

- (void)_sendInvitationCancelationRequestToInvitee:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 idsInvitationManager];
  v7 = [v4 idsInvitationUUID];
  v8 = [v4 identifier];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __54__HMDHome__sendInvitationCancelationRequestToInvitee___block_invoke;
  v10[3] = &unk_278670448;
  v10[4] = self;
  v11 = v4;
  v9 = v4;
  [v6 cancelInvitationWithIDSIdentifier:v7 homeInvitationID:v8 completionBlock:v10];
}

void __54__HMDHome__sendInvitationCancelationRequestToInvitee___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v24 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v6)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [*(a1 + 40) idsInvitationUUID];
      v13 = [v12 UUIDString];
      v18 = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = v13;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to cancel invitation state for invitee with ids identifier %@ due to error %@", &v18, 0x20u);

LABEL_6:
    }
  }

  else if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v14 = [*(a1 + 40) idsInvitationUUID];
    v13 = [v14 UUIDString];
    v15 = [*(a1 + 40) identifier];
    v16 = [v15 UUIDString];
    v18 = 138543874;
    v19 = v11;
    v20 = 2112;
    v21 = v13;
    v22 = 2112;
    v23 = v16;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Canceled invitation state for invitee with ids identifier %@, home identifier %@", &v18, 0x20u);

    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v7);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)__handleCompletedOutgoingInvitation:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 identifier];
    v10 = [v9 UUIDString];
    v13 = 138543618;
    v14 = v8;
    v15 = 2112;
    v16 = v10;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Removing outgoing invitation '%@' since it completed", &v13, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  [v4 updateInvitationState:3];
  v11 = [v4 user];
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)v6->_usersPendingUserManagementOperations removeObject:v11];
  os_unfair_recursive_lock_unlock();

  v12 = *MEMORY[0x277D85DE8];
}

- (BOOL)_doesInvitedUserHasTheSamePairingIdentityAsOwner:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4)
  {
    v5 = [(HMDHome *)self keychainStore];
    v6 = [v5 getPreferredHH2ControllerKey];

    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    v10 = v9;
    if (v6)
    {
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = [v6 identifier];
        v26 = 138543874;
        v27 = v11;
        v28 = 2112;
        v29 = v12;
        v30 = 2112;
        v31 = v4;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Owner HH2 pairing identifier: %@, Shared user pairing identifier: %@", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v7);
      v13 = [v6 identifier];
      v14 = HMFEqualObjects();
    }

    else
    {
      if (os_log_type_enabled(v9, OS_LOG_TYPE_FAULT))
      {
        v19 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v19;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_FAULT, "%{public}@We are doomed. Could not find owner's HH2 Key and we are in HH2", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v7);
      v20 = objc_autoreleasePoolPush();
      v21 = v8;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@We are doomed. Could not find owner's HH2 Key and we are in HH2", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      v14 = 0;
    }
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v26 = 138543362;
      v27 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@shared user pairing identifier is nil.", &v26, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
    v14 = 0;
  }

  v24 = *MEMORY[0x277D85DE8];
  return v14;
}

- (unint64_t)pendingUserPrivilegeFromOutgoingInvitationUUID:(id)a3
{
  v4 = a3;
  v13 = 0;
  v14 = &v13;
  v15 = 0x2020000000;
  v16 = 0;
  if (v4)
  {
    v5 = [(HMDHome *)self backingStore];
    v6 = [v5 context];

    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __58__HMDHome_pendingUserPrivilegeFromOutgoingInvitationUUID___block_invoke;
    v9[3] = &unk_27868A4D8;
    v10 = v4;
    v11 = self;
    v12 = &v13;
    [v6 unsafeSynchronousBlock:v9];
    v7 = v14[3];
  }

  else
  {
    v7 = 0;
  }

  _Block_object_dispose(&v13, 8);

  return v7;
}

void __58__HMDHome_pendingUserPrivilegeFromOutgoingInvitationUUID___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [HMCContext findOutgoingInvitationWithModelID:*(a1 + 32)];
  v3 = v2;
  if (v2)
  {
    v4 = [v2 privilege];
    *(*(*(a1 + 48) + 8) + 24) = [v4 intValue];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 40);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 32);
      v11 = 138543618;
      v12 = v8;
      v13 = 2112;
      v14 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the outgoing invitation with UUID in database: %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (id)addUserAccessCodeForUser:(id)a3 fromOutgoingInvitation:(id)a4
{
  v23 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 accessCode];

  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v8)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      v19 = 138543618;
      v20 = v13;
      v21 = 2112;
      v22 = v6;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Migrating access code from HH1 to HH2 for user : %@", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = [v7 accessCode];
    v15 = [HMDAccessCodeDataManager createUserAccessCodeModelFromAccessCode:v14 forUserUUID:v6 changedByUserUUID:0];
  }

  else
  {
    if (v12)
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v16;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@This user does not have any access code in outgoing invitation. Not adding one.", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v15 = 0;
  }

  v17 = *MEMORY[0x277D85DE8];

  return v15;
}

- (void)__handleAcceptedOutgoingInvitationResponse:(id)a3 destinationAddress:(id)a4 publicKey:(id)a5 username:(id)a6 reverseShare:(id)a7 reverseShareToken:(id)a8 issuerPublicKeyER:(id)a9 presenceAuthStatus:(id)a10 completionHandler:(id)a11
{
  v135 = *MEMORY[0x277D85DE8];
  v17 = a3;
  v110 = a4;
  v115 = a5;
  v116 = a6;
  v108 = a7;
  v114 = a8;
  v111 = a9;
  v113 = a10;
  v18 = a11;
  v117 = v17;
  v19 = [v17 user];
  v20 = objc_autoreleasePoolPush();
  v21 = self;
  v22 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
  {
    v23 = HMFGetLogIdentifier();
    v24 = [(__CFString *)v19 privilege];
    if (v24 > 5)
    {
      v25 = @"None";
    }

    else
    {
      v25 = off_278684178[v24];
    }

    v26 = v25;
    *buf = 138543874;
    v130 = v23;
    v131 = 2112;
    v132 = v19;
    v133 = 2112;
    v134 = v26;
    _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@User: %@, has accepted an invitation, processing acceptance. %@", buf, 0x20u);
  }

  v112 = v18;

  objc_autoreleasePoolPop(v20);
  [(__CFString *)v19 setHome:v21];
  v27 = [(__CFString *)v19 modelObjectWithChangeType:1];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v28 = v27;
  }

  else
  {
    v28 = 0;
  }

  v29 = v28;

  v30 = [v17 identifier];
  v31 = [(HMDHome *)v21 pendingUserPrivilegeFromOutgoingInvitationUUID:v30];

  v32 = objc_autoreleasePoolPush();
  v33 = v21;
  v34 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
  {
    v35 = HMFGetLogIdentifier();
    if (v31 > 5)
    {
      v36 = @"None";
    }

    else
    {
      v36 = off_278684178[v31];
    }

    v37 = v36;
    *buf = 138543618;
    v130 = v35;
    v131 = 2112;
    v132 = v37;
    _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Stored shared user privilege is : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v32);
  v38 = [(HMDHome *)v33 pendingUsers];
  v39 = [(__CFString *)v19 uuid];
  v40 = [v38 hmf_firstObjectWithUUID:v39];

  if (v40)
  {
    [v29 setObjectChangeType:2];
    v41 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v31];
    [v29 setPrivilege:v41];
  }

  if (v19 && v29)
  {
    v42 = v116;
    v43 = v108;
    if ([(__CFString *)v19 isRemoteGateway])
    {
      v44 = [(HMDHome *)v33 keychainStore];
      v126 = 0;
      v127 = 0;
      v45 = [v44 getControllerPublicKey:0 secretKey:0 keyPair:0 username:&v127 allowCreation:0 error:&v126];
      v46 = v127;
      v109 = v126;

      if ((v45 & 1) == 0)
      {
        v81 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3 description:@"Failed to set resident pairing name" reason:0 suggestion:0];
        v95 = v112;
        v99 = _Block_copy(v112);
        if (v99)
        {
          v107 = v99;
          (*(v99 + 2))(v99, v81);
        }

        else
        {
          v107 = 0;
        }

        v82 = v116;
LABEL_48:

        goto LABEL_49;
      }

      if ([v46 isEqualToString:v42])
      {
        v47 = [HMDDevice deviceWithDestination:v110];
        v48 = [v47 identifier];
        v49 = [v48 UUIDString];
        v50 = v42;
        v51 = v40;
        v52 = v49;

        v53 = v52;
        v40 = v51;
        v42 = v53;
      }
    }

    v109 = [objc_alloc(MEMORY[0x277D0F8B0]) initWithPairingKeyData:v115];
    v106 = [objc_alloc(MEMORY[0x277CFEC20]) initWithIdentifier:v42 publicKey:v109 privateKey:0 permissions:0];
    v54 = [v106 hmd_dictionaryEncoding];
    [v29 setPairingIdentity:v54];

    v55 = [v113 number];
    [v29 setPresenceAuthorizationStatus:v55];

    if (v108)
    {
      v56 = [v108 recordID];
      [v29 setReverseShareID:v56];
    }

    v57 = encodeRootObject();
    [v29 setReverseShareToken:v57];

    v58 = objc_opt_class();
    v59 = [(HMDHome *)v33 uniqueIDsOfAllUsers];
    v60 = [v58 createUserUniqueIDForAccessoriesWithoutDuplicatingExistingIDs:v59];

    v107 = v60;
    if (v60)
    {
      [v29 setUniqueIDForAccessories:v60];
      if (v31 == 5)
      {
        v61 = v29;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v62 = v61;
        }

        else
        {
          v62 = 0;
        }

        v63 = v62;

        [(HMDHome *)v33 _updateRestrictedGuestHomeAccessSettingsFromOutgoingInvitation:v117 forUserModel:v63];
      }

      v104 = v42;
      v105 = v40;
      if (v111 && _os_feature_enabled_impl())
      {
        [v29 setMatCredIPKExternalRepresentation:v111];
      }

      [(__CFString *)v19 setPairingIdentity:v106];
      v64 = [HMDOutgoingHomeInvitationModel alloc];
      v65 = [v117 identifier];
      v66 = [(HMDHome *)v33 uuid];
      v67 = [(HMDBackingStoreModelObject *)v64 initWithObjectChangeType:3 uuid:v65 parentUUID:v66];

      [(HMDOutgoingHomeInvitationModel *)v67 setInvitationState:&unk_283E71AB0];
      [(HMDOutgoingHomeInvitationModel *)v67 setInviteeDestinationAddress:v110];
      [(HMDOutgoingHomeInvitationModel *)v67 setPendingUserUUID:0];
      v103 = [(HMDHome *)v33 homeManager];
      v68 = [v103 backingStore];
      v69 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v102 = [v68 transaction:@"kUserManagementOperationAddedKey" options:v69];

      v101 = dispatch_group_create();
      v70 = [(HMDHome *)v33 backingStore];
      v71 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v72 = [v70 transaction:@"kAddUserRequestKey" options:v71];

      v73 = MEMORY[0x277D0F818];
      v74 = [v117 identifier];
      v75 = [v73 messageWithName:@"kAddUserRequestKey" identifier:v74 messagePayload:0];
      [v72 add:v29 withMessage:v75];

      [v72 add:v67];
      v76 = [v29 uuid];
      v77 = [(HMDHome *)v33 addUserAccessCodeForUser:v76 fromOutgoingInvitation:v117];

      if (v77)
      {
        [v72 add:v77];
      }

      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1784;
      aBlock[3] = &unk_278689B08;
      aBlock[4] = v33;
      v121 = v19;
      v122 = v101;
      v123 = v102;
      v124 = 0;
      v125 = v112;
      v78 = v102;
      v79 = v101;
      v80 = _Block_copy(aBlock);
      v118[0] = MEMORY[0x277D85DD0];
      v118[1] = 3221225472;
      v118[2] = __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_3;
      v118[3] = &unk_278670420;
      v118[4] = v33;
      v119 = v117;
      [v72 runWithCoreDataBlock:v118 withCompletionBlock:v80];

      v81 = 0;
      v82 = v116;
      v43 = v108;
      v42 = v104;
      v40 = v105;
      v46 = v106;
    }

    else
    {
      v81 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1 description:@"Failed to create uniqueIDForAccessories" reason:0 suggestion:0];
      v98 = _Block_copy(v112);
      v67 = v98;
      v46 = v106;
      if (v98)
      {
        (*&v98->super._bsoDataVersionOverride)(v98, v81);
      }

      v82 = v116;
    }

    v95 = v112;
    goto LABEL_48;
  }

  v83 = v40;
  v84 = [(HMDHome *)v33 backingStore];
  v85 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v86 = [v84 transaction:@"kUpdateInvitationStateRequestKey" options:v85];

  v87 = [HMDOutgoingHomeInvitationModel alloc];
  v88 = [v117 identifier];
  v89 = [(HMDHome *)v33 uuid];
  v90 = [(HMDBackingStoreModelObject *)v87 initWithObjectChangeType:3 uuid:v88 parentUUID:v89];

  v109 = v90;
  [v86 add:v90];
  v42 = v86;
  v91 = [HMDUserModel alloc];
  v92 = [(__CFString *)v19 uuid];
  v93 = [(HMDHome *)v33 uuid];
  v94 = [(HMDBackingStoreModelObject *)v91 initWithObjectChangeType:3 uuid:v92 parentUUID:v93];

  v46 = v94;
  [v42 add:v94];
  v128[0] = MEMORY[0x277D85DD0];
  v128[1] = 3221225472;
  v128[2] = __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke;
  v128[3] = &unk_27868A250;
  v128[4] = v33;
  [v42 run:v128];
  v81 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3 description:@"Outgoing Invitation does not have a valid invitee. Cancelling the invite." reason:0 suggestion:0];
  v95 = v112;
  v96 = _Block_copy(v112);
  v97 = v96;
  if (v96)
  {
    (*(v96 + 2))(v96, v81);
  }

  v43 = v108;
  v40 = v83;
  v82 = v116;
LABEL_49:

  v100 = *MEMORY[0x277D85DE8];
}

void __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543618;
    v10 = v7;
    v11 = 2112;
    v12 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Finished deleting the outgoing invitation with error: %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

void __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1784(uint64_t a1, void *a2)
{
  v44 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = shouldLogPrivateInformation();
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 32);
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v4)
  {
    if (!v8)
    {
      goto LABEL_7;
    }

    v9 = HMFGetLogIdentifier();
    v10 = [*(a1 + 40) userID];
    v11 = [*(a1 + 40) displayName];
    *buf = 138544130;
    v37 = v9;
    v38 = 2112;
    v39 = v10;
    v40 = 2112;
    v41 = v11;
    v42 = 2112;
    v43 = v3;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Added user with userID: %@ and displayName: %@ with error: %@", buf, 0x2Au);
  }

  else
  {
    if (!v8)
    {
      goto LABEL_7;
    }

    v9 = HMFGetLogIdentifier();
    *buf = 138544130;
    v37 = v9;
    v38 = 2112;
    v39 = @"...";
    v40 = 2112;
    v41 = @"...";
    v42 = 2112;
    v43 = v3;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Added user with userID: %@ and displayName: %@ with error: %@", buf, 0x2Au);
  }

LABEL_7:
  objc_autoreleasePoolPop(v5);
  v12 = objc_autoreleasePoolPush();
  v13 = *(a1 + 32);
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    v32 = v12;
    v16 = MEMORY[0x277CCABB0];
    v17 = [*(a1 + 32) users];
    v18 = [v16 numberWithUnsignedInteger:{objc_msgSend(v17, "count")}];
    v19 = MEMORY[0x277CCABB0];
    [*(a1 + 32) pendingUsers];
    v20 = v33 = v3;
    v21 = [v19 numberWithUnsignedInteger:{objc_msgSend(v20, "count")}];
    v22 = MEMORY[0x277CCABB0];
    v23 = [*(a1 + 32) usersIncludingPendingUsers:1];
    v24 = [v22 numberWithUnsignedInteger:{objc_msgSend(v23, "count")}];
    *buf = 138544130;
    v37 = v15;
    v38 = 2112;
    v39 = v18;
    v40 = 2112;
    v41 = v21;
    v42 = 2112;
    v43 = v24;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Users: %@, PendingUsers: %@, All Users: %@", buf, 0x2Au);

    v12 = v32;
    v3 = v33;
  }

  objc_autoreleasePoolPop(v12);
  v25 = *(a1 + 48);
  v26 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __178__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_reverseShare_reverseShareToken_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1785;
  block[3] = &unk_27868A728;
  v35 = *(a1 + 56);
  dispatch_group_notify(v25, v26, block);

  if (!v3)
  {
    v27 = *(a1 + 32);
    v28 = [*(a1 + 40) uuid];
    [v27 _loadRestrictedGuestConfigurationOnLocksAfterInviteAcceptance:v28];
  }

  v29 = _Block_copy(*(a1 + 72));
  v30 = v29;
  if (v29)
  {
    (*(v29 + 2))(v29, *(a1 + 64));
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveUserModel:(id)a3 message:(id)a4
{
  v30 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 uuid];
  v9 = [(HMDHome *)self userIncludingPendingUserWithUUID:v8];

  if (v9)
  {
    v10 = [(HMDHome *)self currentUser];

    if (v9 == v10)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v14;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Attempting to remove current user", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v11);
      [(HMDHome *)v12 setCurrentUser:0];
    }

    [(HMDHome *)self _removeUserFromContainer:v9];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_usersPendingUserManagementOperations removeObject:v9];
    os_unfair_recursive_lock_unlock();
    [v9 setHome:0];
    v15 = [v7 transactionResult];
    [v15 markChanged];
    if ([v15 source] != 1)
    {
      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
      {
        v19 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v19;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEBUG, "%{public}@Skipping remove user due to non-xpc backingstore transaction", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v16);
      [v7 respondWithPayload:0];
    }
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      v24 = [v6 uuid];
      v26 = 138543618;
      v27 = v23;
      v28 = 2112;
      v29 = v24;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Cannot find the user with UUID %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v15 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v7 respondWithError:v15];
  }

  v25 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddUserModel:(id)a3 message:(id)a4
{
  v100 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self usersIncludingPendingUsers:1];
  v9 = [v6 uuid];
  v86 = v8;
  v10 = [v8 hmf_firstObjectWithUUID:v9];

  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = [v6 debugString:1];
    *buf = 138543618;
    v95 = v14;
    v96 = 2112;
    v97 = v15;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Adding HMDUserModel: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v11);
  if (!v10)
  {
    v85 = v12;
    v21 = [(HMDHome *)v12 homeManager];
    v22 = v6;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v23 = v22;
    }

    else
    {
      v23 = 0;
    }

    v24 = v23;

    if (v24)
    {
      v10 = [[HMDResidentUser alloc] initWithModelObject:v24];
    }

    else
    {
      v10 = [[HMDUser alloc] initWithModelObject:v22];
      [(HMDResidentUser *)v10 refreshDisplayName];
      v25 = [(HMDResidentUser *)v10 userID];

      if (!v25)
      {
        if (shouldLogPrivateInformation())
        {
          v49 = [v22 userID];
        }

        else
        {
          v49 = @"...";
          v74 = @"...";
        }

        v75 = objc_autoreleasePoolPush();
        v76 = v12;
        v77 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v77, OS_LOG_TYPE_ERROR))
        {
          v78 = HMFGetLogIdentifier();
          *buf = 138543618;
          v95 = v78;
          v96 = 2112;
          v97 = v49;
          _os_log_impl(&dword_229538000, v77, OS_LOG_TYPE_ERROR, "%{public}@User created from model no longer has userID, model userID invalid %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v75);
        v24 = 0;
LABEL_56:

        goto LABEL_57;
      }
    }

    if (v10)
    {
      v82 = v24;
      v83 = v7;
      v84 = v21;
      v81 = v6;
      [(HMDResidentUser *)v10 configureWithHome:v12];
      [(HMDUser *)v10 updateRestrictedGuestSettingsFromWorkingStoreIfNeeded];
      [(HMDHome *)v12 _addUserToContainer:v10];
      [(HMDHome *)v12 _cleanRemovedUsers:v10];
      v89 = 0u;
      v90 = 0u;
      v87 = 0u;
      v88 = 0u;
      v26 = [(HMDHome *)v12 outgoingInvitations];
      v27 = [v26 countByEnumeratingWithState:&v87 objects:v93 count:16];
      if (v27)
      {
        v28 = v27;
        v29 = *v88;
        while (2)
        {
          for (i = 0; i != v28; ++i)
          {
            if (*v88 != v29)
            {
              objc_enumerationMutation(v26);
            }

            v31 = *(*(&v87 + 1) + 8 * i);
            v32 = [v31 user];
            v33 = [v32 pairingIdentity];
            v34 = [(HMDUser *)v10 pairingIdentity];
            v35 = [v33 isEqual:v34];

            if (v35)
            {
              [v31 setUser:v10];
              goto LABEL_24;
            }
          }

          v28 = [v26 countByEnumeratingWithState:&v87 objects:v93 count:16];
          if (v28)
          {
            continue;
          }

          break;
        }
      }

LABEL_24:

      v36 = v85;
      [(HMDHome *)v85 _addUserToIdentityRegistry:v10];
      v10 = v10;
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();
      if (isKindOfClass)
      {
        v38 = v10;
      }

      else
      {
        v38 = 0;
      }

      v80 = v38;

      if (isKindOfClass)
      {
        [(HMDHome *)v85 _updateConfigurationStateForResidentDevice:v10 desiredConfigState:2 message:0];
        v39 = objc_autoreleasePoolPush();
        v40 = v85;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          v43 = [(HMDResidentUser *)v10 userID];
          *buf = 138543618;
          v95 = v42;
          v96 = 2112;
          v97 = v43;
          _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Removing resident user %@ from unassociated list", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v39);
        v44 = [(HMDResidentUser *)v10 userID];
        [v84 removeFromUnassociatedPeers:v44 home:v40];

        v45 = objc_autoreleasePoolPush();
        v46 = v40;
        v47 = HMFGetOSLogHandle();
        v6 = v81;
        if (os_log_type_enabled(v47, OS_LOG_TYPE_DEBUG))
        {
          v48 = HMFGetLogIdentifier();
          *buf = 138543362;
          v95 = v48;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_DEBUG, "%{public}@Add resident device", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v45);
      }

      else
      {
        v91[0] = @"kUserUUIDKey";
        v50 = [(HMDUser *)v10 uuid];
        v51 = [v50 UUIDString];
        v92[0] = v51;
        v91[1] = @"kUserIDKey";
        v52 = [(HMDResidentUser *)v10 userID];
        v92[1] = v52;
        v91[2] = @"kUserDisplayNameKey";
        v53 = [(HMDResidentUser *)v10 displayName];
        v92[2] = v53;
        v54 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v92 forKeys:v91 count:3];

        v55 = [v54 mutableCopy];
        v56 = [(HMDResidentUser *)v10 userID];
        [v55 setObject:v56 forKeyedSubscript:@"kUserIDKey"];

        v57 = [v83 identifier];
        if (v57)
        {
          [v83 identifier];
        }

        else
        {
          [MEMORY[0x277CCAD78] UUID];
        }
        v63 = ;
        v6 = v81;

        v64 = [MEMORY[0x277D0F818] entitledMessageWithName:@"kUserAddedNotificationKey" identifier:v63 messagePayload:v55];
        v36 = v85;
        v65 = [(HMDHome *)v85 msgDispatcher];
        v66 = [(HMDHome *)v85 uuid];
        [v65 sendMessage:v64 target:v66];
      }

      v7 = v83;
      v21 = v84;
      v24 = v82;
      v49 = v80;
      if ([(HMDUser *)v10 isCurrentUser])
      {
        v67 = [(HMDHome *)v36 walletKeyManager];
        [v67 didAddCurrentUserWithUUID:v10];

        if (![(HMDHome *)v36 isOwnerUser]&& (_os_feature_enabled_impl() & 1) == 0)
        {
          v68 = objc_autoreleasePoolPush();
          v69 = v36;
          v70 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v70, OS_LOG_TYPE_INFO))
          {
            v71 = HMFGetLogIdentifier();
            *buf = 138543362;
            v95 = v71;
            _os_log_impl(&dword_229538000, v70, OS_LOG_TYPE_INFO, "%{public}@Calling replaceWalletKeyAfterHH2MigrationIfNecessary because the current shared user has been synced from the primary resident", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v68);
          v72 = [(HMDHome *)v69 walletKeyManager];
          [v72 replaceWalletKeyAfterHH2MigrationIfNecessary];

          v21 = v84;
          v24 = v82;
        }
      }

      v73 = [v83 transactionResult];
      [v73 markChanged];
    }

    else
    {
      if (shouldLogPrivateInformation())
      {
        v49 = [v22 userID];
      }

      else
      {
        v49 = @"...";
        v58 = @"...";
      }

      v59 = objc_autoreleasePoolPush();
      v60 = v12;
      v61 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
      {
        v62 = HMFGetLogIdentifier();
        *buf = 138543618;
        v95 = v62;
        v96 = 2112;
        v97 = v49;
        _os_log_impl(&dword_229538000, v61, OS_LOG_TYPE_ERROR, "%{public}@Failed to create new user %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v59);
      v10 = 0;
    }

    goto LABEL_56;
  }

  v16 = objc_autoreleasePoolPush();
  v17 = v12;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
  {
    v19 = HMFGetLogIdentifier();
    v20 = [v6 uuid];
    *buf = 138543874;
    v95 = v19;
    v96 = 2112;
    v97 = v20;
    v98 = 2112;
    v99 = v10;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@HMDUserModel %@ passed as add for existing user %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v16);
  [(HMDResidentUser *)v10 transactionObjectUpdated:0 newValues:v6 message:v7];
LABEL_57:

  v79 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateRequestForHomeInvitation:(id)a3 controllerPublicKey:(id)a4 controllerUsername:(id)a5 invitationState:(int64_t)a6 presenceAuthStatus:(id)a7 preferredUserID:(id)a8 fromHandle:(id)a9 fromAddress:(id)a10 fromMergeID:(id)a11 reverseShareURL:(id)a12 reverseShareToken:(id)a13 issuerPublicKeyER:(id)a14 message:(id)a15 messageResponseHandler:(id)a16
{
  v142 = *MEMORY[0x277D85DE8];
  v20 = a3;
  v115 = a4;
  v114 = a5;
  v113 = a7;
  v112 = a8;
  v21 = a9;
  v111 = a10;
  v22 = a11;
  v23 = a12;
  v110 = a13;
  v24 = a14;
  v25 = a15;
  v116 = v20;
  v108 = v21;
  v109 = a16;
  if ([v20 isExpired])
  {
    v26 = objc_autoreleasePoolPush();
    v27 = self;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
    {
      v29 = HMFGetLogIdentifier();
      [v20 identifier];
      v30 = v23;
      v32 = v31 = v22;
      *buf = 138543618;
      v137 = v29;
      v138 = 2112;
      v139 = v32;
      _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@Invitation (%@) has already expired, invitee cannot accept or decline", buf, 0x16u);

      v22 = v31;
      v23 = v30;
    }

    objc_autoreleasePoolPop(v26);
    v33 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:1006 userInfo:0];
    v34 = v109;
    if (v109)
    {
      (*(v109 + 2))(v109, v33, 0);
    }

    v35 = v115;
LABEL_17:
    v48 = v114;
    goto LABEL_18;
  }

  if ([v20 responseReceived])
  {
    v36 = objc_autoreleasePoolPush();
    v37 = self;
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
    {
      v39 = HMFGetLogIdentifier();
      [v20 identifier];
      v40 = v23;
      v42 = v41 = v22;
      v43 = [v20 isDeclined];
      v44 = @"accepted";
      *buf = 138543874;
      v137 = v39;
      v138 = 2112;
      if (v43)
      {
        v44 = @"declined";
      }

      v139 = v42;
      v140 = 2112;
      v141 = v44;
      _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Invitation (%@) has already been %@, invitee cannot accept or decline", buf, 0x20u);

      v22 = v41;
      v23 = v40;
    }

    objc_autoreleasePoolPop(v36);
    v45 = MEMORY[0x277CCA9B8];
    v46 = *MEMORY[0x277CCFD28];
    if ([v20 isDeclined])
    {
      v47 = 1008;
    }

    else
    {
      v47 = 1007;
    }

    v33 = [v45 errorWithDomain:v46 code:v47 userInfo:0];
    v35 = v115;
    v34 = v109;
    if (v109)
    {
      (*(v109 + 2))(v109, v33, 0);
    }

    goto LABEL_17;
  }

  if ((a6 - 3) > 1)
  {
    v68 = objc_autoreleasePoolPush();
    v69 = self;
    v70 = HMFGetOSLogHandle();
    v48 = v114;
    if (os_log_type_enabled(v70, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v72 = v71 = v22;
      *buf = 138543618;
      v137 = v72;
      v138 = 2048;
      v139 = a6;
      _os_log_impl(&dword_229538000, v70, OS_LOG_TYPE_INFO, "%{public}@Failed to update invite state since the value %ld was incorrect", buf, 0x16u);

      v22 = v71;
    }

    objc_autoreleasePoolPop(v68);
    v33 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:43 userInfo:0];
    v34 = v109;
    if (v109)
    {
      (*(v109 + 2))(v109, v33, 0);
    }

    v35 = v115;
  }

  else
  {
    v104 = v23;
    v105 = v24;
    if (a6 == 3)
    {
      v50 = v22;
      v51 = v21;
      v52 = [v20 user];
      v53 = [v52 isPending];

      if (v53)
      {
        v54 = 4;
      }

      else
      {
        v54 = 1;
      }

      v55 = [HMDSharedUserInviteOwnerResponseLogEventBuilder alloc];
      v56 = [v20 identifier];
      v57 = [v20 user];
      v58 = [v57 privilege];
      [v20 age];
      v33 = [(HMDSharedUserInviteOwnerResponseLogEventBuilder *)v55 initWithHome:self sessionIdentifier:v56 invitationType:v58 invitationAge:v54 invitationSource:?];

      [(HMDHome *)self addSharedUserResponseEventBuilder:v33];
      v48 = v114;
      v35 = v115;
      if (!v115 || !v114)
      {
        v74 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
        [(__CFString *)v33 markError:v74];
        v24 = v105;
        v34 = v109;
        if (v109)
        {
          (*(v109 + 2))(v109, v74, 0);
        }

        goto LABEL_44;
      }

      v24 = v105;
      if ([(HMDHome *)self _doesInvitedUserHasTheSamePairingIdentityAsOwner:v114])
      {
        v59 = objc_autoreleasePoolPush();
        v60 = self;
        v61 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_FAULT))
        {
          v62 = HMFGetLogIdentifier();
          *buf = 138543362;
          v137 = v62;
          _os_log_impl(&dword_229538000, v61, OS_LOG_TYPE_FAULT, "%{public}@Owner and shared user has the same pairing identities.", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v59);
        v63 = objc_autoreleasePoolPush();
        v64 = v60;
        v65 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v65, OS_LOG_TYPE_ERROR))
        {
          v66 = HMFGetLogIdentifier();
          *buf = 138543618;
          v137 = v66;
          v138 = 2112;
          v139 = &unk_283E71A98;
          _os_log_impl(&dword_229538000, v65, OS_LOG_TYPE_ERROR, "%{public}@Owner and shared user has the same pairing identities : %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v63);
        v67 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2722];
        [(__CFString *)v33 markError:v67];
        v34 = v109;
        if (v109)
        {
          (*(v109 + 2))(v109, v67, 0);
        }

        v48 = v114;
        v35 = v115;
LABEL_44:
        v22 = v50;
        v23 = v104;
        goto LABEL_18;
      }

      if (v112)
      {
        v99 = +[HMDAccountHandleFormatter defaultFormatter];
        v100 = [v99 accountHandleFromString:v112];
      }

      else
      {
        v100 = 0;
      }

      [(__CFString *)v33 markAuthenticateUserBegin];
      v121[0] = MEMORY[0x277D85DD0];
      v121[1] = 3221225472;
      v121[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke;
      v121[3] = &unk_2786703F8;
      v122 = v33;
      v135 = v109;
      v123 = v100;
      v124 = v116;
      v125 = v115;
      v48 = v114;
      v126 = v114;
      v127 = self;
      v101 = v50;
      v128 = v50;
      v23 = v104;
      v129 = v104;
      v130 = v110;
      v131 = v51;
      v132 = v111;
      v133 = v105;
      v134 = v113;
      v102 = v33;
      v33 = v100;
      v24 = v105;
      v22 = v101;
      v34 = v109;
      v35 = v115;
      __authenticateAcceptedOutgoingInvitation(self, v124, v131, v33, v121);
    }

    else
    {
      v103 = v22;
      if (shouldLogPrivateInformation())
      {
        v73 = [v20 user];
        v33 = [v73 userID];
      }

      else
      {
        v33 = @"...";
        v75 = @"...";
      }

      v76 = objc_autoreleasePoolPush();
      v77 = self;
      v78 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v78, OS_LOG_TYPE_INFO))
      {
        v79 = HMFGetLogIdentifier();
        *buf = 138543618;
        v137 = v79;
        v138 = 2112;
        v139 = v33;
        _os_log_impl(&dword_229538000, v78, OS_LOG_TYPE_INFO, "%{public}@User %@ declined invite", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v76);
      v80 = objc_alloc(MEMORY[0x277D0F7A8]);
      v81 = [(HMDHome *)v77 workQueue];
      v82 = [v80 initWithQueue:v81];

      v83 = [(HMDHome *)v77 homeManager];
      v84 = [v83 homeOwnerCloudShareManager];
      v85 = [v20 user];
      v86 = [v84 revokeAccessForUser:v85 home:v77];
      v119[0] = MEMORY[0x277D85DD0];
      v119[1] = 3221225472;
      v119[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1762;
      v119[3] = &unk_278687050;
      v119[4] = v77;
      v87 = v82;
      v120 = v116;
      v117[0] = MEMORY[0x277D85DD0];
      v117[1] = 3221225472;
      v117[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1763;
      v117[3] = &unk_2786882F0;
      v117[4] = v77;
      v88 = v120;
      v118 = v88;
      v89 = [v86 inContext:v87 then:v119 orRecover:v117];

      v90 = [v25 name];
      v91 = v90;
      v92 = @"UpdateOutgoingInvitationToAccept";
      if (v90)
      {
        v92 = v90;
      }

      v93 = v92;

      v94 = [(HMDHome *)v77 backingStore];
      v95 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v96 = [v94 transaction:v93 options:v95];

      v97 = [v88 emptyModelObjectWithChangeType:2];
      v98 = [MEMORY[0x277CCABB0] numberWithInteger:a6];
      [v97 setInvitationState:v98];

      if (v25)
      {
        [v96 add:v97 withMessage:v25];
      }

      else
      {
        [v96 add:v97];
      }

      v48 = v114;
      v22 = v103;
      v23 = v104;
      v24 = v105;
      [v96 run];

      v35 = v115;
      v34 = v109;
    }
  }

LABEL_18:

  v49 = *MEMORY[0x277D85DE8];
}

void __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  if (!v3)
  {
    [v4 markAuthenticateUserEnd];
    if (*(a1 + 40))
    {
      v6 = [*(a1 + 48) user];
      v7 = [HMDUser userIDForAccountHandle:*(a1 + 40)];
      [v6 setUserID:v7];
    }

    v8 = [objc_alloc(MEMORY[0x277D0F8B0]) initWithPairingKeyData:*(a1 + 56)];
    v9 = [objc_alloc(MEMORY[0x277CFEC20]) initWithIdentifier:*(a1 + 64) publicKey:v8 privateKey:0 permissions:0];
    v10 = [*(a1 + 72) homeManager];
    v11 = [*(a1 + 48) user];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v12 = v11;
    }

    else
    {
      v12 = 0;
    }

    v13 = v12;

    if (v13)
    {
      v14 = [v13 device];
      if (v14)
      {
        v15 = [v10 identityRegistry];
        v16 = [*(a1 + 48) user];
        [v15 registerIdentity:v9 device:v14 object:v16];

LABEL_14:
      }
    }

    else
    {
      v17 = [*(a1 + 48) user];
      v14 = [v17 account];

      if (v14)
      {
        v15 = [v10 identityRegistry];
        [v15 registerIdentity:v9 account:v14 object:*(a1 + 48)];
        goto LABEL_14;
      }
    }

    v18 = [*(a1 + 48) user];
    v19 = [HMDAccountIdentifier accountIdentifierForSenderCorrelationIdentifier:*(a1 + 80)];
    [v18 setAccountIdentifier:v19];

    v20 = [*(a1 + 48) user];
    [v20 setMergeIdentifier:*(a1 + 80)];

    v21 = [[HMDCoreDataCloudShareInvitation alloc] initWithURL:*(a1 + 88) token:*(a1 + 96)];
    v22 = [v10 homeOwnerCloudShareManager];
    v23 = objc_alloc(MEMORY[0x277D0F7A8]);
    v24 = [*(a1 + 72) workQueue];
    v25 = [v23 initWithQueue:v24];

    [*(a1 + 32) markJoiningReverseShareBegin];
    v26 = [v22 acceptShareInvitation:v21];
    v39[0] = MEMORY[0x277D85DD0];
    v39[1] = 3221225472;
    v39[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_2;
    v39[3] = &unk_2786703A8;
    v39[4] = *(a1 + 72);
    v40 = *(a1 + 104);
    v41 = *(a1 + 48);
    v42 = *(a1 + 32);
    v43 = *(a1 + 112);
    v44 = *(a1 + 56);
    v45 = *(a1 + 64);
    v46 = *(a1 + 120);
    v47 = *(a1 + 128);
    v48 = *(a1 + 136);
    v28[0] = MEMORY[0x277D85DD0];
    v28[1] = 3221225472;
    v28[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_2_1759;
    v28[3] = &unk_2786703D0;
    v28[4] = *(a1 + 72);
    v29 = *(a1 + 104);
    v30 = *(a1 + 32);
    v31 = *(a1 + 48);
    v32 = *(a1 + 112);
    v33 = *(a1 + 56);
    v34 = *(a1 + 64);
    v35 = *(a1 + 96);
    v36 = *(a1 + 120);
    v37 = *(a1 + 128);
    v38 = *(a1 + 136);
    v27 = [v26 inContext:v25 then:v39 orRecover:v28];

    goto LABEL_16;
  }

  [v4 markError:v3];
  v5 = *(a1 + 136);
  if (v5)
  {
    (*(v5 + 16))(v5, v3, 0);
  }

LABEL_16:
}

uint64_t __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1762(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) user];
    v9 = [v8 uuid];
    v10 = [*(a1 + 32) name];
    v11 = [*(a1 + 32) uuid];
    v14 = 138544130;
    v15 = v7;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully revoked cloud share for declined invite %@ for home %@/%@", &v14, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1763(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) user];
    v9 = [v8 uuid];
    v10 = [*(a1 + 32) name];
    v11 = [*(a1 + 32) uuid];
    v14 = 138544386;
    v15 = v7;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    v22 = 2112;
    v23 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to revoke cloud share for declined invite %@ for home %@/%@ due to %@", &v14, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v23 = *(a1 + 40);
    v8 = [*(a1 + 32) name];
    v9 = [*(a1 + 32) uuid];
    v10 = [*(a1 + 48) user];
    v11 = [v10 privilege];
    if (v11 > 5)
    {
      v12 = @"None";
    }

    else
    {
      v12 = off_278684178[v11];
    }

    v13 = v12;
    *buf = 138544642;
    v28 = v7;
    v29 = 2112;
    v30 = v3;
    v31 = 2112;
    v32 = v23;
    v33 = 2112;
    v34 = v8;
    v35 = 2112;
    v36 = v9;
    v37 = 2112;
    v38 = v13;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Joined cloud share %@ from shared user %@ for home %@ /%@ / %@", buf, 0x3Eu);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 56) markJoiningReverseShareEnd];
  [*(a1 + 56) markAddUserToHomeBegin];
  v14 = *(a1 + 32);
  v15 = *(a1 + 64);
  v16 = *(a1 + 72);
  v17 = *(a1 + 80);
  v18 = *(a1 + 88);
  v19 = *(a1 + 96);
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1758;
  v24[3] = &unk_278689A68;
  v20 = *(a1 + 48);
  v25 = *(a1 + 56);
  v26 = *(a1 + 104);
  [v14 __handleAcceptedOutgoingInvitationResponse:v20 destinationAddress:v15 publicKey:v16 username:v17 reverseShare:v3 reverseShareToken:0 issuerPublicKeyER:v18 presenceAuthStatus:v19 completionHandler:v24];

  v21 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_2_1759(uint64_t a1, void *a2)
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v9 = [*(a1 + 32) name];
    v10 = [*(a1 + 32) uuid];
    *buf = 138544386;
    v27 = v7;
    v28 = 2112;
    v29 = v8;
    v30 = 2112;
    v31 = v9;
    v32 = 2112;
    v33 = v10;
    v34 = 2112;
    v35 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to accept cloud share from shared user %@ for home %@/%@ due to %@, will try later", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 48) markError:v3];
  v11 = *(a1 + 32);
  v12 = *(a1 + 56);
  v13 = *(a1 + 64);
  v14 = *(a1 + 72);
  v15 = *(a1 + 80);
  v16 = *(a1 + 88);
  v17 = *(a1 + 96);
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1760;
  v24[3] = &unk_278688DD0;
  v18 = *(a1 + 104);
  v25 = *(a1 + 112);
  [v11 __handleAcceptedOutgoingInvitationResponse:v12 destinationAddress:v13 publicKey:v14 username:v15 reverseShare:0 reverseShareToken:v16 issuerPublicKeyER:v17 presenceAuthStatus:v18 completionHandler:v24];
  v19 = dispatch_time(0, 300000000000);
  v20 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_2_1761;
  block[3] = &unk_27868A728;
  block[4] = *(a1 + 32);
  dispatch_after(v19, v20, block);

  v21 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1760(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, a2, 0);
  }

  return result;
}

void __257__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_fromMergeID_reverseShareURL_reverseShareToken_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1758(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  if (v3)
  {
    [v4 markError:?];
  }

  else
  {
    [v4 markAddUserToHomeEnd];
  }

  v5 = *(a1 + 40);
  v6 = v7;
  if (v5)
  {
    (*(v5 + 16))(v5, v7, 0);
    v6 = v7;
  }
}

- (void)_processUnacceptReverseShareAccessForUsers
{
  v58 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v46[0] = 0;
    v46[1] = v46;
    v46[2] = 0x2020000000;
    v47 = 0;
    objc_initWeak(&location, self);
    v28 = [MEMORY[0x277D0F7C0] futureWithNoValue];
    v3 = objc_alloc(MEMORY[0x277D0F7A8]);
    v4 = [(HMDHome *)self workQueue];
    v26 = [v3 initWithQueue:v4];

    v44 = _HMFThreadLocalAsyncContextPush();
    v5 = [(HMDHome *)self home];
    v6 = [v5 usersSupportingPresence];

    v42 = 0u;
    v43 = 0u;
    v40 = 0u;
    v41 = 0u;
    obj = v6;
    v7 = [obj countByEnumeratingWithState:&v40 objects:v57 count:16];
    if (v7)
    {
      v8 = *v41;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v41 != v8)
          {
            objc_enumerationMutation(obj);
          }

          v10 = *(*(&v40 + 1) + 8 * i);
          if (([v10 isOwner] & 1) == 0)
          {
            *&v52 = 0;
            *(&v52 + 1) = &v52;
            v53 = 0x3032000000;
            v54 = __Block_byref_object_copy__14759;
            v55 = __Block_byref_object_dispose__14760;
            v56 = 0;
            v11 = [(HMDHome *)self backingStore];
            v12 = [v11 context];

            v36[0] = MEMORY[0x277D85DD0];
            v36[1] = 3221225472;
            v36[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke;
            v36[3] = &unk_278689D20;
            v36[4] = v10;
            v13 = v12;
            v37 = v13;
            v38 = self;
            v39 = &v52;
            [v13 unsafeSynchronousBlock:v36];
            if (*(*(&v52 + 1) + 40))
            {
              v31[0] = MEMORY[0x277D85DD0];
              v31[1] = 3221225472;
              v31[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1740;
              v31[3] = &unk_278670358;
              objc_copyWeak(&v35, &location);
              v33 = &v52;
              v31[4] = v10;
              v32 = v13;
              v34 = v46;
              v14 = [v28 then:v31];

              objc_destroyWeak(&v35);
              v28 = v14;
            }

            else
            {
              v15 = objc_autoreleasePoolPush();
              v16 = self;
              v17 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
              {
                v18 = HMFGetLogIdentifier();
                v19 = [v10 uuid];
                *buf = 138543618;
                v49 = v18;
                v50 = 2112;
                v51 = v19;
                _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_DEBUG, "%{public}@Unable to find user with UUID %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v15);
            }

            _Block_object_dispose(&v52, 8);
          }
        }

        v7 = [obj countByEnumeratingWithState:&v40 objects:v57 count:16];
      }

      while (v7);
    }

    v29[0] = MEMORY[0x277D85DD0];
    v29[1] = 3221225472;
    v29[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1745;
    v29[3] = &unk_278670380;
    objc_copyWeak(&v30, &location);
    v29[4] = v46;
    v20 = [v28 then:v29];
    objc_destroyWeak(&v30);

    _HMFThreadLocalAsyncContextPop();
    objc_destroyWeak(&location);
    _Block_object_dispose(v46, 8);
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      LODWORD(v52) = 138543362;
      *(&v52 + 4) = v24;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Will not try to accept reverse shares because this is not longer the primary resident", &v52, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
  }

  v25 = *MEMORY[0x277D85DE8];
}

void __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [*(a1 + 40) managedObjectContext];
  v4 = [_MKFHome findHomeMemberWithUUID:v2 context:v3];

  if (v4)
  {
    v5 = [v4 reverseShareToken];
    v6 = *(*(a1 + 56) + 8);
    v7 = *(v6 + 40);
    *(v6 + 40) = v5;
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 48);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [*(a1 + 32) uuid];
      v14 = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to find home member with UUID %@", &v14, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1740(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v5 = [HMDCoreDataCloudShareInvitation alloc];
  v6 = [*(*(*(a1 + 48) + 8) + 40) shareURL];
  v7 = [(HMDCoreDataCloudShareInvitation *)v5 initWithURL:v6 token:*(*(*(a1 + 48) + 8) + 40)];

  v8 = [WeakRetained homeManager];
  v9 = [v8 homeOwnerCloudShareManager];

  v10 = objc_alloc(MEMORY[0x277D0F7A8]);
  v11 = [WeakRetained workQueue];
  v12 = [v10 initWithQueue:v11];

  v13 = [v9 acceptShareInvitation:v7];
  v21[0] = MEMORY[0x277D85DD0];
  v21[1] = 3221225472;
  v21[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_2;
  v21[3] = &unk_278670308;
  objc_copyWeak(&v23, (a1 + 64));
  v14 = *(a1 + 40);
  v21[4] = *(a1 + 32);
  v22 = v14;
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1744;
  v19[3] = &unk_278670330;
  objc_copyWeak(&v20, (a1 + 64));
  v15 = *(a1 + 56);
  v19[4] = *(a1 + 32);
  v19[5] = v15;
  v16 = [v13 inContext:v12 then:v21 orRecover:v19];
  if (v16)
  {
    v17 = v16;

    objc_destroyWeak(&v20);
    objc_destroyWeak(&v23);

    return 3;
  }

  else
  {
    result = _HMFPreconditionFailure();
    __break(1u);
  }

  return result;
}

uint64_t __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1745(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained && *(*(*(a1 + 32) + 8) + 24) == 1)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v16 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@At least one shared user reverse share not accepted, scheduling retry", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = dispatch_time(0, 300000000000);
    v10 = [v6 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1746;
    block[3] = &unk_278686B80;
    objc_copyWeak(&v14, (a1 + 40));
    dispatch_after(v9, v10, block);

    objc_destroyWeak(&v14);
  }

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

void __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1746(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _processUnacceptReverseShareAccessForUsers];
}

uint64_t __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_2(uint64_t a1, void *a2)
{
  v30 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 32) accountHandle];
      v10 = [v6 name];
      v11 = [v6 uuid];
      *buf = 138544386;
      v21 = v8;
      v22 = 2112;
      v23 = v3;
      v24 = 2112;
      v25 = v9;
      v26 = 2112;
      v27 = v10;
      v28 = 2112;
      v29 = v11;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Joined cloud share %@ from shared user %@ for home %@/%@", buf, 0x34u);
    }

    objc_autoreleasePoolPop(v5);
    v12 = [v6 backingStore];
    v13 = [v12 context];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1742;
    v17[3] = &unk_27868A010;
    v14 = *(a1 + 40);
    v17[4] = *(a1 + 32);
    v18 = v14;
    v19 = v6;
    [v13 unsafeSynchronousBlock:v17];
  }

  v15 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1744(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [*(a1 + 32) accountHandle];
    v10 = [v6 name];
    v11 = [v6 uuid];
    v14 = 138544386;
    v15 = v8;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    v22 = 2112;
    v23 = v3;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to accept cloud share from shared user %@ for home %@/%@ due to %@", &v14, 0x34u);
  }

  objc_autoreleasePoolPop(v5);
  *(*(*(a1 + 40) + 8) + 24) = 1;

  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

void __53__HMDHome__processUnacceptReverseShareAccessForUsers__block_invoke_1742(id *a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] uuid];
  v3 = [a1[5] managedObjectContext];
  v4 = [_MKFHome findHomeMemberWithUUID:v2 context:v3];

  if (v4)
  {
    [v4 setReverseShareToken:0];
    v5 = +[HMCContext currentContext];
    [v5 save];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = a1[6];
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [a1[4] uuid];
      v12 = 138543618;
      v13 = v9;
      v14 = 2112;
      v15 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@After accepting share, unable to find home member with UUID %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleAcceptRequestForIDSInvitationWithIdentifier:(id)a3 payload:(id)a4 fromAddress:(id)a5 fromMergeID:(id)a6
{
  v98 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v87 = a6;
  v13 = [v11 hmf_UUIDForKey:@"kInvitationIdentifierKey"];
  v14 = [v11 hmf_dataForKey:@"kControllerPublicKey"];
  v84 = [v11 hmf_stringForKey:@"kControllerPairingNameKey"];
  v15 = [v11 hmf_dataForKey:@"HMDIssuerPublicKeyExternalRepresentationKey"];
  v86 = [MEMORY[0x277CD1F00] authWithDict:v11];
  v85 = [v11 hmf_stringForKey:@"kUserIDKey"];
  v16 = [(HMDHome *)self invitationWithIDSInvitationIdentifier:v10];
  v17 = [(HMDHome *)self invitationWithInvitationIdentifier:v13];
  v88 = v17;
  if (!(v16 | v17))
  {
    v41 = objc_autoreleasePoolPush();
    v42 = self;
    v43 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v43, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v44 = v83 = v15;
      [v10 UUIDString];
      v45 = v79 = v12;
      [v13 UUIDString];
      v46 = v14;
      v48 = v47 = v10;
      *buf = 138543874;
      v91 = v44;
      v92 = 2112;
      v93 = v45;
      v94 = 2112;
      v95 = v48;
      _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_ERROR, "%{public}@Could not find matching outgoingInvitation for idsIdentifier %@ homeIdentifier %@ to handle accept.", buf, 0x20u);

      v10 = v47;
      v14 = v46;

      v12 = v79;
      v15 = v83;
    }

    objc_autoreleasePoolPop(v41);
    v16 = 0;
    goto LABEL_19;
  }

  v81 = v14;
  v82 = v15;
  if (!v16 && v17)
  {
    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      [v10 UUIDString];
      v22 = v73 = v10;
      [v13 UUIDString];
      v23 = v70 = v18;
      [0 idsInvitationUUID];
      v77 = v13;
      v25 = v24 = v12;
      v26 = [v25 UUIDString];
      *buf = 138544130;
      v91 = v21;
      v92 = 2112;
      v93 = v22;
      v94 = 2112;
      v95 = v23;
      v96 = 2112;
      v97 = v26;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Could not find matching outgoingInvitation for idsIdentifier %@, but found one for homeIdentifier %@ with idsIdentifier %@. Using homeIdentifier accept invite.", buf, 0x2Au);

      v12 = v24;
      v13 = v77;

      v18 = v70;
      v10 = v73;
    }

    objc_autoreleasePoolPop(v18);
    v16 = v88;
    v15 = v82;
  }

  v27 = [v16 identifier];
  v28 = [v27 hmf_isEqualToUUID:v13];

  if ((v28 & 1) == 0)
  {
    v49 = objc_autoreleasePoolPush();
    v50 = self;
    v51 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_ERROR))
    {
      v52 = HMFGetLogIdentifier();
      [v10 UUIDString];
      v53 = v75 = v10;
      [v16 identifier];
      v54 = v72 = v49;
      v55 = [v54 UUIDString];
      [v13 UUIDString];
      v80 = v13;
      v57 = v56 = v12;
      *buf = 138544130;
      v91 = v52;
      v92 = 2112;
      v93 = v53;
      v94 = 2112;
      v95 = v55;
      v96 = 2112;
      v97 = v57;
      _os_log_impl(&dword_229538000, v51, OS_LOG_TYPE_ERROR, "%{public}@Found matching outgoingInvitation for idsIdentifier %@, but homeIdentifier on IDS invitation: %@ did not match the one of the found invitation %@ to handle accept.", buf, 0x2Au);

      v49 = v72;
      v12 = v56;
      v13 = v80;

      v10 = v75;
    }

    objc_autoreleasePoolPop(v49);
    v14 = v81;
    v15 = v82;
LABEL_19:
    v39 = v84;
    goto LABEL_26;
  }

  v78 = v12;
  v29 = [v11 hmf_stringForKey:@"HMDHomeInvitationShareURLKey"];
  v71 = [MEMORY[0x277CBEBC0] URLWithString:v29];
  if (v29)
  {
    v67 = v29;
    v30 = [v11 hmf_dataForKey:@"HMDHomeInvitationShareTokenKey"];
    v31 = MEMORY[0x277CCAAC8];
    v32 = [MEMORY[0x277CBEB98] setWithObject:objc_opt_class()];
    v89 = 0;
    v68 = v30;
    v33 = [v31 _strictlyUnarchivedObjectOfClasses:v32 fromData:v30 error:&v89];
    v34 = v89;

    if (v34)
    {
      v74 = v10;
      v35 = objc_autoreleasePoolPush();
      v36 = self;
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
      {
        v38 = HMFGetLogIdentifier();
        *buf = 138543618;
        v91 = v38;
        v92 = 2112;
        v93 = v34;
        _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@Unarchive share token due to error %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v35);
      v10 = v74;
      v12 = v78;
      v39 = v84;
      v40 = v33;
      v29 = v67;
    }

    else
    {
      v12 = v78;
      v64 = [HMDAccountHandle accountHandleForDestination:v78];
      v65 = self;
      v39 = v84;
      [(HMDHome *)v65 _handleUpdateRequestForHomeInvitation:v16 controllerPublicKey:v81 controllerUsername:v84 invitationState:3 presenceAuthStatus:v86 preferredUserID:v85 fromHandle:v64 fromAddress:v78 fromMergeID:v87 reverseShareURL:v71 reverseShareToken:v33 issuerPublicKeyER:v82 message:0 messageResponseHandler:&__block_literal_global_1739];

      v40 = v33;
      v29 = v67;
    }

    v14 = v81;
    v15 = v82;
  }

  else
  {
    v58 = objc_autoreleasePoolPush();
    v59 = self;
    v60 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v60, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v61 = v69 = v58;
      [(HMDHome *)v59 name];
      v62 = v76 = v10;
      v63 = [(HMDHome *)v59 uuid];
      *buf = 138543874;
      v91 = v61;
      v92 = 2112;
      v93 = v62;
      v94 = 2112;
      v95 = v63;
      _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_ERROR, "%{public}@Share URL is missing from invite for home %@/%@", buf, 0x20u);

      v15 = v82;
      v10 = v76;

      v58 = v69;
    }

    objc_autoreleasePoolPop(v58);
    v12 = v78;
    v14 = v81;
    v39 = v84;
  }

LABEL_26:
  v66 = *MEMORY[0x277D85DE8];
}

- (id)invitationWithIDSInvitationIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self outgoingInvitations];
  v6 = [v5 hmf_firstObjectWithValue:v4 forKeyPath:@"idsInvitationUUID"];

  return v6;
}

- (id)invitationWithInvitationIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self outgoingInvitations];
  v6 = [v5 hmf_firstObjectWithValue:v4 forKeyPath:@"identifier"];

  return v6;
}

- (void)handleDeclineRequestForIDSInvitationWithIdentifier:(id)a3 fromAddress:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self invitationWithIDSInvitationIdentifier:v6];
  if (v8)
  {
    [(HMDHome *)self _handleUpdateRequestForHomeInvitation:v8 controllerPublicKey:0 controllerUsername:0 invitationState:4 presenceAuthStatus:0 preferredUserID:0 fromHandle:0 fromAddress:v7 fromMergeID:0 reverseShareURL:0 reverseShareToken:0 issuerPublicKeyER:0 message:0 messageResponseHandler:&__block_literal_global_1731];
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v6 UUIDString];
      *buf = 138543618;
      v16 = v12;
      v17 = 2112;
      v18 = v13;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Could not find matching outgoingInvitation for idsIdentifier %@ to handle decline.", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateOutgoingInvitationState:(id)a3
{
  v72 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:@"kInvitationIdentifierKey"];
  v6 = [v4 numberForKey:@"kInvitationStateKey"];
  v7 = v6;
  if (!v5 || !v6)
  {
    v45 = objc_autoreleasePoolPush();
    v46 = self;
    v47 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
    {
      v48 = HMFGetLogIdentifier();
      *buf = 138543362;
      v67 = v48;
      _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Unable to accept the invitation as could not find the invite", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v45);
    v9 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    v49 = [v4 responseHandler];
    (v49)[2](v49, v9, 0);
LABEL_22:

    goto LABEL_23;
  }

  v8 = [(HMDHome *)self outgoingInvitations];
  v9 = [v8 hmf_firstObjectWithValue:v5 forKeyPath:@"identifier"];

  if (v9)
  {
    if ([v7 integerValue] == 1)
    {
      v10 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v13 = HMFGetLogIdentifier();
        v14 = [v9 identifier];
        v15 = [v14 UUIDString];
        [MEMORY[0x277CD1A88] homeInvitationStateDescription:1];
        v16 = v60 = v10;
        *buf = 138543874;
        v67 = v13;
        v68 = 2112;
        v69 = v15;
        v70 = 2112;
        v71 = v16;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@[Home] Processing request to update invitation %@ to state %@", buf, 0x20u);

        v10 = v60;
      }

      objc_autoreleasePoolPop(v10);
      if (([v9 invitationState] & 0xFFFFFFFFFFFFFFFDLL) != 4)
      {
        [(HMDHome *)v11 _sendInvitationCancelationRequestToInvitee:v9];
        v17 = objc_alloc(MEMORY[0x277D0F7A8]);
        v18 = [(HMDHome *)v11 workQueue];
        v19 = [v17 initWithQueue:v18];

        v20 = [(HMDHome *)v11 homeManager];
        v21 = [v20 homeOwnerCloudShareManager];
        v22 = [v9 user];
        v23 = [v21 revokeAccessForUser:v22 home:v11];
        v64[0] = MEMORY[0x277D85DD0];
        v64[1] = 3221225472;
        v64[2] = __48__HMDHome__handleUpdateOutgoingInvitationState___block_invoke;
        v64[3] = &unk_278687050;
        v64[4] = v11;
        v65 = v9;
        v62[0] = MEMORY[0x277D85DD0];
        v62[1] = 3221225472;
        v62[2] = __48__HMDHome__handleUpdateOutgoingInvitationState___block_invoke_1729;
        v62[3] = &unk_2786882F0;
        v62[4] = v11;
        v63 = v65;
        v24 = [v23 inContext:v19 then:v64 orRecover:v62];
      }

      v25 = [(HMDHome *)v11 backingStore];
      v26 = [v4 name];
      v27 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v28 = [v25 transaction:v26 options:v27];

      v29 = [v9 emptyModelObjectWithChangeType:3];
      [v28 add:v29 withMessage:v4];

      v30 = [v9 pendingUserUUID];
      if (!v30)
      {
        goto LABEL_26;
      }

      v31 = v30;
      v32 = [v9 user];
      if ([v32 isPending])
      {
        v33 = [v9 pendingUserUUID];
        [v9 user];
        v34 = v61 = v28;
        v35 = [v34 uuid];
        v59 = [v33 isEqual:v35];

        v28 = v61;
        if (!v59)
        {
LABEL_26:
          [v28 run];

          goto LABEL_23;
        }

        v36 = objc_autoreleasePoolPush();
        v37 = v11;
        v38 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
        {
          v39 = HMFGetLogIdentifier();
          v40 = [v9 user];
          *buf = 138543874;
          v67 = v39;
          v68 = 2112;
          v69 = v40;
          v70 = 2112;
          v71 = v9;
          _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Found pending user [%@] associated with this invitation [%@]. Going to delete it as well.", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v36);
        v41 = [HMDUserModel alloc];
        v42 = [v9 user];
        v43 = [v42 uuid];
        v44 = [(HMDHome *)v37 uuid];
        v31 = [(HMDBackingStoreModelObject *)v41 initWithObjectChangeType:3 uuid:v43 parentUUID:v44];

        [v61 add:v31];
      }

      else
      {
      }

      goto LABEL_26;
    }

    v49 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:43 userInfo:0];
    v57 = [v4 responseHandler];
    v57[2](v57, v49, 0);

    goto LABEL_22;
  }

  v50 = objc_autoreleasePoolPush();
  v51 = self;
  v52 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
  {
    v53 = HMFGetLogIdentifier();
    v54 = [v5 UUIDString];
    *buf = 138543618;
    v67 = v53;
    v68 = 2112;
    v69 = v54;
    _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@Invalid invite identifier specified %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v50);
  v55 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  v56 = [v4 responseHandler];
  (v56)[2](v56, v55, 0);

  v9 = 0;
LABEL_23:

  v58 = *MEMORY[0x277D85DE8];
}

uint64_t __48__HMDHome__handleUpdateOutgoingInvitationState___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) user];
    v9 = [v8 uuid];
    v10 = [*(a1 + 32) name];
    v11 = [*(a1 + 32) uuid];
    v14 = 138544130;
    v15 = v7;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully revoked cloud share for canceled invite %@ for home %@/%@", &v14, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __48__HMDHome__handleUpdateOutgoingInvitationState___block_invoke_1729(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) user];
    v9 = [v8 uuid];
    v10 = [*(a1 + 32) name];
    v11 = [*(a1 + 32) uuid];
    v14 = 138544386;
    v15 = v7;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    v22 = 2112;
    v23 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to revoke cloud share for canceled invite %@ for home %@/%@ due to %@", &v14, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)doesThisHomeHaveCameras
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_any:&__block_literal_global_1727];

  return v3;
}

uint64_t __34__HMDHome_doesThisHomeHaveCameras__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = v4;
  if (v4)
  {
    v6 = [v4 hasCameraStreamService];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)_sendInvitation:(id)a3 message:(id)a4 shareURL:(id)a5 shareToken:(id)a6 suppressHomeInviteNotification:(BOOL)a7 logEventBuilder:(id)a8
{
  v133[2] = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a8;
  v19 = [v14 user];
  v20 = [v19 accountHandle];

  v21 = [v14 identifier];
  v22 = [v14 endDate];
  if (a7)
  {
    v86 = 1;
  }

  else
  {
    v23 = [v14 user];
    v86 = [v23 isPending];
  }

  objc_initWeak(&location, self);
  v24 = [v14 expirationHandler];
  v25 = v24 == 0;

  if (v25)
  {
    v26 = [(HMDHome *)self workQueue];
    [v14 setClientQueue:v26];

    objc_initWeak(from, v14);
    v105[0] = MEMORY[0x277D85DD0];
    v105[1] = 3221225472;
    v105[2] = __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke;
    v105[3] = &unk_278687590;
    objc_copyWeak(&v107, &location);
    objc_copyWeak(&v108, from);
    v106 = v15;
    [v14 setExpirationHandler:v105];

    objc_destroyWeak(&v108);
    objc_destroyWeak(&v107);
    objc_destroyWeak(from);
  }

  [v18 markSendInviteBegin];
  v27 = [v14 user];
  v98[0] = MEMORY[0x277D85DD0];
  v98[1] = 3221225472;
  v99 = __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke_1716;
  v100 = &unk_278681F48;
  objc_copyWeak(&v104, &location);
  v101 = v20;
  v91 = v18;
  v102 = v91;
  v90 = v15;
  v103 = v90;
  v28 = v101;
  v94 = v21;
  v95 = v22;
  v97 = v16;
  v96 = v17;
  v29 = v27;
  v92 = v98;
  if (self)
  {
    v30 = objc_autoreleasePoolPush();
    v31 = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      v33 = HMFGetLogIdentifier();
      *from = 138543874;
      *&from[4] = v33;
      *&from[12] = 2112;
      *&from[14] = v28;
      *&from[22] = 2112;
      v122 = v29;
      _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Sending invite to: %@ for user: %@", from, 0x20u);
    }

    objc_autoreleasePoolPop(v30);
    v93 = [(HMDHome *)v31 homeManager];
    v34 = [v93 appleAccountManager];
    v35 = [v34 account];
    v36 = [v35 handles];
    v37 = [v36 containsObject:v28];

    if (v37)
    {
      v38 = objc_autoreleasePoolPush();
      v39 = v31;
      v40 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_DEFAULT))
      {
        v41 = HMFGetLogIdentifier();
        *from = 138543618;
        *&from[4] = v41;
        *&from[12] = 2112;
        *&from[14] = v28;
        _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_DEFAULT, "%{public}@Attempt to add local user: %@", from, 0x16u);
      }

      objc_autoreleasePoolPop(v38);
      v42 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      v99(v92, v42);
    }

    else
    {
      v43 = [(HMDHome *)v31 keychainStore];
      v42 = [v43 getPreferredHH2ControllerKey];

      if (v42)
      {
        if (!v97 || !v96)
        {
          _HMFPreconditionFailure();
          __break(1u);
        }

        v119 = 0;
        v85 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v96 requiringSecureCoding:1 error:&v119];
        v88 = v119;
        if (v88)
        {
          v44 = objc_autoreleasePoolPush();
          v45 = v31;
          v46 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v46, OS_LOG_TYPE_ERROR))
          {
            v47 = HMFGetLogIdentifier();
            *from = 138543618;
            *&from[4] = v47;
            *&from[12] = 2112;
            *&from[14] = v96;
            _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_ERROR, "%{public}@Failed to encode share token %@", from, 0x16u);
          }

          objc_autoreleasePoolPop(v44);
          v99(v92, v88);
        }

        else
        {
          v132[0] = @"kHomedVersionKey";
          v56 = homedVersion;
          v132[1] = @"kHomedSupportedFeaturesKey";
          v133[0] = v56;
          v133[1] = &unk_283E75590;
          v76 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v133 forKeys:v132 count:2];

          v57 = [v29 restrictedGuestAccessSettings];
          v58 = [v57 schedule];

          if (v58)
          {
            v59 = [v29 restrictedGuestAccessSettings];
            v60 = [v59 schedule];
            v75 = [v60 dictionaryRepresentation];
          }

          else
          {
            v75 = MEMORY[0x277CBEC10];
          }

          v120[0] = *MEMORY[0x277CD23D0];
          v83 = [(HMDHome *)v31 name];
          *from = v83;
          v120[1] = *MEMORY[0x277CD0640];
          v82 = [(HMDHome *)v31 uuid];
          v81 = [v82 UUIDString];
          *&from[8] = v81;
          *&from[16] = v95;
          v120[2] = @"kInvitationExpiryDateKey";
          v120[3] = @"kControllerPublicKey";
          v80 = [v42 publicKey];
          v79 = [v80 data];
          v122 = v79;
          v120[4] = @"kControllerPairingNameKey";
          v78 = [v42 identifier];
          v123 = v78;
          v120[5] = @"kInvitationIdentifierKey";
          v77 = [v94 UUIDString];
          v124 = v77;
          v125 = v76;
          v120[6] = @"kRequestedCapabilitiesKey";
          v120[7] = @"HMDHomeInvitationShareURLKey";
          v61 = [v97 absoluteString];
          v126 = v61;
          v127 = v85;
          v120[8] = @"HMDHomeInvitationShareTokenKey";
          v120[9] = @"HMDHomeSuppressInviteNotificationKey";
          v62 = [MEMORY[0x277CCABB0] numberWithBool:v86];
          v128 = v62;
          v120[10] = *MEMORY[0x277CD0010];
          v63 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v29, "privilege")}];
          v129 = v63;
          v120[11] = *MEMORY[0x277CD0748];
          v64 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome doesThisHomeHaveCameras](v31, "doesThisHomeHaveCameras")}];
          v120[12] = *MEMORY[0x277CD0D18];
          v130 = v64;
          v131 = v75;
          v87 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:from forKeys:v120 count:13];

          v65 = [HMDRemoteAccountMessageDestination alloc];
          v66 = objc_alloc(MEMORY[0x277CCAD78]);
          v67 = [v66 initWithUUIDString:*MEMORY[0x277CD23C8]];
          v84 = [(HMDRemoteAccountMessageDestination *)v65 initWithTarget:v67 handle:v28 multicast:1];

          v68 = [MEMORY[0x277D0F848] messageWithName:@"kAccessHomeInviteRequestKey" destination:v84 payload:v87];
          objc_initWeak(&v118, v31);
          v115[0] = MEMORY[0x277D85DD0];
          v115[1] = 3221225472;
          v115[2] = __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke;
          v115[3] = &unk_278689460;
          v115[4] = v31;
          v69 = v28;
          v116 = v69;
          objc_copyWeak(&v117, &v118);
          [v68 setResponseHandler:v115];
          v70 = [v93 idsInvitationManager];
          v71 = [(HMDRemoteAccountMessageDestination *)v84 remoteDestinationString];
          v72 = [v29 isRestrictedGuest];
          v110[0] = MEMORY[0x277D85DD0];
          v110[1] = 3221225472;
          v110[2] = __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke_1724;
          v110[3] = &unk_2786702E0;
          objc_copyWeak(&v114, &v118);
          v73 = v94;
          v111 = v73;
          v112 = v69;
          v113 = v92;
          [v70 sendInvitationToDestination:v71 expirationDate:v95 dictionary:v87 homeInvitationID:v73 isRestrictedGuestInvitation:v72 completionBlock:v110];

          objc_destroyWeak(&v114);
          objc_destroyWeak(&v117);

          objc_destroyWeak(&v118);
        }
      }

      else
      {
        v48 = objc_autoreleasePoolPush();
        v49 = v31;
        v50 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v50, OS_LOG_TYPE_FAULT))
        {
          v51 = HMFGetLogIdentifier();
          *from = 138543362;
          *&from[4] = v51;
          _os_log_impl(&dword_229538000, v50, OS_LOG_TYPE_FAULT, "%{public}@We are doomed. Could not find owner's HH2 Key and we are in HH2. Cannot send the invite.", from, 0xCu);
        }

        objc_autoreleasePoolPop(v48);
        v52 = objc_autoreleasePoolPush();
        v53 = v49;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_ERROR))
        {
          v55 = HMFGetLogIdentifier();
          *from = 138543362;
          *&from[4] = v55;
          _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_ERROR, "%{public}@We are doomed. Could not find owner's HH2 Key and we are in HH2. Cannot send the invite.", from, 0xCu);
        }

        objc_autoreleasePoolPop(v52);
        v89 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2723];
        v99(v92, v89);
      }
    }
  }

  objc_destroyWeak(&v104);
  objc_destroyWeak(&location);

  v74 = *MEMORY[0x277D85DE8];
}

void __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke(id *a1)
{
  v15 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 5);
  v3 = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = WeakRetained;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [v3 identifier];
      v11 = 138543618;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Expiring invitation %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [v3 updateInvitationState:{objc_msgSend(v3, "invitationState")}];
    v9 = [a1[4] name];
    [v5 saveWithReason:v9 postSyncNotification:0];
  }

  v10 = *MEMORY[0x277D85DE8];
}

void __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke_1716(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v3)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 32);
      v18 = 138543874;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to send invite to user, %@, with error: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = *(a1 + 40);
    v12 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3503 underlyingError:v3];
    [v11 markError:v12];
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 32);
      v18 = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Successfully sent invite to user: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 40) markSendInviteEnd];
  }

  v15 = [*(a1 + 48) responseHandler];

  if (v15)
  {
    v16 = [*(a1 + 48) responseHandler];
    (v16)[2](v16, v3, 0);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = *(a1 + 40);
    v25 = 138543618;
    v26 = v10;
    v27 = 2112;
    v28 = v11;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Attempting to send home invitation: %@", &v25, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (v5 && [v5 code] != 8)
  {
    v13 = objc_autoreleasePoolPush();
    v22 = WeakRetained;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = HMFGetLogIdentifier();
      v23 = *(a1 + 40);
      v25 = 138543874;
      v26 = v16;
      v27 = 2112;
      v28 = v23;
      v29 = 2112;
      v30 = v5;
      v18 = "%{public}@Failed to send invitation request to user, %@, due to error: %@";
      v19 = v15;
      v20 = OS_LOG_TYPE_DEFAULT;
      v21 = 32;
      goto LABEL_9;
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = WeakRetained;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = *(a1 + 40);
      v25 = 138543618;
      v26 = v16;
      v27 = 2112;
      v28 = v17;
      v18 = "%{public}@Successfully sent invitation to: %@";
      v19 = v15;
      v20 = OS_LOG_TYPE_INFO;
      v21 = 22;
LABEL_9:
      _os_log_impl(&dword_229538000, v19, v20, v18, &v25, v21);
    }
  }

  objc_autoreleasePoolPop(v13);
  v24 = *MEMORY[0x277D85DE8];
}

void __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke_1724(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 7);
  v8 = WeakRetained;
  if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke_2;
    v10[3] = &unk_278688B58;
    v10[4] = v8;
    v11 = a1[4];
    v12 = v6;
    v13 = a1[5];
    v14 = v5;
    v15 = a1[6];
    dispatch_async(v9, v10);
  }
}

void __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke_2(uint64_t a1)
{
  v35 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) outgoingInvitations];
  v3 = [v2 hmf_firstObjectWithValue:*(a1 + 40) forKeyPath:@"identifier"];

  if (*(a1 + 48))
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
LABEL_5:

      objc_autoreleasePoolPop(v4);
      goto LABEL_10;
    }

    v7 = HMFGetLogIdentifier();
    v9 = *(a1 + 48);
    v8 = *(a1 + 56);
    v29 = 138543874;
    v30 = v7;
    v31 = 2112;
    v32 = v8;
    v33 = 2112;
    v34 = v9;
    v10 = "%{public}@Failed to send ids invitation request to user, %@, due to error: %@";
    v11 = v6;
    v12 = OS_LOG_TYPE_ERROR;
LABEL_4:
    _os_log_impl(&dword_229538000, v11, v12, v10, &v29, 0x20u);

    goto LABEL_5;
  }

  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v13 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (!v3)
  {
    if (!v13)
    {
      goto LABEL_5;
    }

    v7 = HMFGetLogIdentifier();
    v27 = *(a1 + 40);
    v28 = *(a1 + 56);
    v29 = 138543874;
    v30 = v7;
    v31 = 2112;
    v32 = v27;
    v33 = 2112;
    v34 = v28;
    v10 = "%{public}@Outgoing invite %@ has been removed while sending it %@";
    v11 = v6;
    v12 = OS_LOG_TYPE_INFO;
    goto LABEL_4;
  }

  if (v13)
  {
    v14 = HMFGetLogIdentifier();
    v15 = *(a1 + 56);
    v16 = *(a1 + 64);
    v29 = 138543874;
    v30 = v14;
    v31 = 2112;
    v32 = v15;
    v33 = 2112;
    v34 = v16;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully sent invitation to: %@, updating home invitation with IDS invite uuid %@", &v29, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v17 = [*(a1 + 32) backingStore];
  v18 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v19 = [v17 transaction:@"kUpdateInvitationStateRequestKey" options:v18];

  v20 = [HMDOutgoingHomeInvitationModel alloc];
  v21 = [v3 identifier];
  v22 = [*(a1 + 32) uuid];
  v23 = [(HMDBackingStoreModelObject *)v20 initWithObjectChangeType:2 uuid:v21 parentUUID:v22];

  [(HMDOutgoingHomeInvitationModel *)v23 setIdsInvitationUUID:*(a1 + 64)];
  v24 = [MEMORY[0x277CBEAA8] now];
  [(HMDOutgoingHomeInvitationModel *)v23 setDateSent:v24];

  [v19 add:v23];
  [v19 run];

LABEL_10:
  v25 = *(a1 + 72);
  if (v25)
  {
    (*(v25 + 16))(v25, *(a1 + 48));
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)_addOutgoingInvitations:(id)a3 message:(id)a4 transactionCompleted:(id)a5
{
  v46 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v30 = a5;
  v10 = [(HMDHome *)self backingStore];
  v33 = v9;
  v11 = [v9 name];
  v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v13 = [v10 transaction:v11 options:v12];

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  obj = v8;
  v34 = [obj countByEnumeratingWithState:&v35 objects:v45 count:16];
  if (v34)
  {
    v32 = *v36;
    do
    {
      for (i = 0; i != v34; ++i)
      {
        if (*v36 != v32)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v35 + 1) + 8 * i);
        [v15 setHome:self];
        v16 = [v15 modelObjectWithChangeType:1 version:4];
        [v13 add:v16 withMessage:v33];
        v17 = [v15 user];
        v18 = [v17 userID];

        v19 = [(HMDHome *)self pendingUsers];
        v20 = [v19 hmf_firstObjectWithValue:v18 forKeyPath:@"userID"];

        if (v20)
        {
          v21 = objc_autoreleasePoolPush();
          v22 = self;
          v23 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
          {
            v24 = HMFGetLogIdentifier();
            *buf = 138543874;
            v40 = v24;
            v41 = 2112;
            v42 = v20;
            v43 = 2112;
            v44 = v18;
            _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Found stale pending user instance %@ that we need to remove since the owner is manually re-inviting %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v21);
          v25 = [HMDUserModel alloc];
          v26 = [v20 uuid];
          v27 = [(HMDHome *)v22 uuid];
          v28 = [(HMDBackingStoreModelObject *)v25 initWithObjectChangeType:3 uuid:v26 parentUUID:v27];

          [v13 add:v28];
        }
      }

      v34 = [obj countByEnumeratingWithState:&v35 objects:v45 count:16];
    }

    while (v34);
  }

  [(HMDHome *)self _saveOutgoingInvitationsWithRestrictedGuestSettings:obj inTransaction:v13 message:v33 transactionCompleted:v30];
  v29 = *MEMORY[0x277D85DE8];
}

- (id)_outgoingInvitationForUserWithHandle:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [(HMDHome *)self outgoingInvitations];
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        v10 = [v9 user];
        v11 = [v10 accountHandle];
        v12 = [v11 isEqual:v4];

        if (v12)
        {
          v6 = v9;
          goto LABEL_11;
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)_processOutgoingInvitationsRequest:(id)a3
{
  v48[2] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dataForKey:@"HM.invitations"];
  if (v5)
  {
    v6 = MEMORY[0x277CCAAC8];
    v7 = MEMORY[0x277CBEB98];
    v48[0] = objc_opt_class();
    v48[1] = objc_opt_class();
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v48 count:2];
    v9 = [v7 setWithArray:v8];
    v41 = 0;
    v10 = [v6 unarchivedObjectOfClasses:v9 fromData:v5 error:&v41];
    v11 = v41;

    if (v10)
    {
      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke;
      aBlock[3] = &unk_27868A010;
      v12 = v4;
      v38 = v12;
      v39 = self;
      v13 = v10;
      v40 = v13;
      v14 = _Block_copy(aBlock);
      v15 = [(HMDHome *)self featuresDataSource];
      v16 = [v15 isHomeActivityStateFeatureEnabled];

      if (v16)
      {
        v34[0] = MEMORY[0x277D85DD0];
        v34[1] = 3221225472;
        v34[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_4;
        v34[3] = &unk_278689358;
        v34[4] = self;
        v35 = v12;
        v36 = v14;
        v17 = _Block_copy(v34);
        v18 = [(HMDHome *)self dataSource];
        v19 = [v18 idsIDQueryController];
        [(HMDHome *)self verifyAdaptiveTemperatureAutomationsEnabledHomeShouldSendInvitations:v13 withQueryController:v19 completion:v17];
      }

      else
      {
        v14[2](v14);
      }

      v32 = v38;
    }

    else
    {
      v26 = objc_autoreleasePoolPush();
      v27 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
      {
        v29 = HMFGetLogIdentifier();
        v30 = [v4 identifier];
        v31 = [v30 UUIDString];
        *buf = 138543874;
        v43 = v29;
        v44 = 2112;
        v45 = v31;
        v46 = 2112;
        v47 = v11;
        _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@Failed to unarchive outgoing home invitations from serialized outgoing home invitation data: %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v26);
      v32 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      [v4 respondWithError:v32];
    }
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      v24 = [v4 identifier];
      v25 = [v24 UUIDString];
      *buf = 138543618;
      v43 = v23;
      v44 = 2112;
      v45 = v25;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Unable to find outgoing invitations to add for message: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v11 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    [v4 respondWithError:v11];
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__processOutgoingInvitationsRequest___block_invoke(id *a1)
{
  v2 = [a1[4] BOOLForKey:@"HMDHomeSuppressInviteNotificationKey"];
  objc_initWeak(&location, a1[5]);
  v4 = a1[5];
  v3 = a1[6];
  v5 = a1[4];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_2;
  v6[3] = &unk_278681A08;
  objc_copyWeak(&v8, &location);
  v7 = a1[6];
  v9 = v2;
  [v4 _addOutgoingInvitations:v3 message:v5 transactionCompleted:v6];

  objc_destroyWeak(&v8);
  objc_destroyWeak(&location);
}

void __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_4(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Rejecting invitations with verification error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 40) respondWithError:v3];
  }

  else
  {
    (*(*(a1 + 48) + 16))();
  }

  v8 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_3;
  block[3] = &unk_278688BD0;
  block[4] = WeakRetained;
  v5 = *(a1 + 32);
  v6 = *(a1 + 48);
  dispatch_async(v3, block);
}

- (void)_handleOutgoingInvitations:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self residentSyncManager];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __38__HMDHome__handleOutgoingInvitations___block_invoke;
  v6[3] = &unk_27868A398;
  v6[4] = self;
  [v5 interceptRemoteResidentRequest:v4 proceed:v6];
}

- (void)setOverriddenHomeAccessControl:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  overriddenHomeAccessControl = self->_overriddenHomeAccessControl;
  self->_overriddenHomeAccessControl = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSNumber)overriddenHomeAccessControl
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_overriddenHomeAccessControl;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)handleCurrentUserPrivilegeChanged:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __45__HMDHome_handleCurrentUserPrivilegeChanged___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v4, block);
}

uint64_t __45__HMDHome_handleCurrentUserPrivilegeChanged___block_invoke(uint64_t a1)
{
  v29 = *MEMORY[0x277D85DE8];
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 32);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 32) currentUser];
      v7 = [v6 privilege];
      if (v7 > 5)
      {
        v8 = @"None";
      }

      else
      {
        v8 = off_278684178[v7];
      }

      v9 = v8;
      v10 = [*(a1 + 32) fabric];
      v11 = [v10 accessControl];
      [v11 currentUserPrivilege];
      v12 = HMMTRUserPrivilegeAsString();
      v23 = 138543874;
      v24 = v5;
      v25 = 2112;
      v26 = v9;
      v27 = 2112;
      v28 = v12;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Updating Fabric user privilege to %@ from priv %@", &v23, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
    v13 = [*(a1 + 32) currentUser];
    v14 = +[HMDUser hmmtrUserPrivilegeFromHMDUserPrivilege:](HMDUser, "hmmtrUserPrivilegeFromHMDUserPrivilege:", [v13 privilege]);
    v15 = [*(a1 + 32) fabric];
    v16 = [v15 accessControl];
    [v16 setCurrentUserPrivilege:v14];
  }

  [*(a1 + 32) _evaluateNetworkProtectionAndRouterManagement];
  v17 = objc_autoreleasePoolPush();
  v18 = *(a1 + 32);
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v23 = 138543362;
    v24 = v20;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - handleCurrentUserPrivilegeChanged", &v23, 0xCu);
  }

  objc_autoreleasePoolPop(v17);
  result = [*(a1 + 32) _configureUserActivityStateDetectorManager];
  v22 = *MEMORY[0x277D85DE8];
  return result;
}

- (BOOL)_shouldResendOutgoingInvitation:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dateSent];
  v6 = +[HMDHomeInvitation noRetryDate];
  v7 = [v5 isEqualToDate:v6];

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v11;
      v17 = 2112;
      v18 = v4;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Should not resend abandoned invitation %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    goto LABEL_7;
  }

  if ([v4 invitationState] != 2)
  {
LABEL_7:
    LOBYTE(v12) = 0;
    goto LABEL_8;
  }

  v12 = ![(HMDHome *)self _justSentInvitation:v4];
LABEL_8:

  v13 = *MEMORY[0x277D85DE8];
  return v12;
}

- (BOOL)_justSentInvitation:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dateSent];
  if (v5)
  {
    v6 = [v4 dateSent];
    [v6 timeIntervalSinceNow];
    v8 = fabs(v7);
    v9 = vabdd_f64(60.0, v8) >= 2.22044605e-16 && v8 < 60.0;
  }

  else
  {
    v9 = 0;
  }

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    v17 = 138543874;
    v18 = v13;
    v19 = 2112;
    v20 = v4;
    v21 = 2112;
    v22 = v14;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Invitation %@ was just sent: %@", &v17, 0x20u);
  }

  objc_autoreleasePoolPop(v10);
  v15 = *MEMORY[0x277D85DE8];
  return v9;
}

- (id)outgoingInvitationToResendForUser:(id)a3
{
  v38 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  v25 = v6;
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [(HMDHome *)v6 outgoingInvitations];
    *buf = 138543618;
    v32 = v8;
    v33 = 2048;
    v34 = [v9 count];
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@There are %lu outgoing invitations", buf, 0x16u);

    v6 = v25;
  }

  objc_autoreleasePoolPop(v5);
  v29 = 0u;
  v30 = 0u;
  v27 = 0u;
  v28 = 0u;
  obj = [(HMDHome *)v6 outgoingInvitations];
  v10 = [obj countByEnumeratingWithState:&v27 objects:v37 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v28;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v28 != v12)
        {
          objc_enumerationMutation(obj);
        }

        v14 = *(*(&v27 + 1) + 8 * i);
        v15 = objc_autoreleasePoolPush();
        v16 = v6;
        v17 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
        {
          v18 = HMFGetLogIdentifier();
          v19 = [v14 user];
          *buf = 138543874;
          v32 = v18;
          v33 = 2112;
          v34 = v19;
          v35 = 2112;
          v36 = v4;
          _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_DEBUG, "%{public}@Inspecting outgoing invite to user %@ to see if it matches %@", buf, 0x20u);

          v6 = v25;
        }

        objc_autoreleasePoolPop(v15);
        v20 = [v14 user];
        if ([v20 isAccountEqualWithUser:v4])
        {
          v21 = [(HMDHome *)v16 _shouldResendOutgoingInvitation:v14];

          if (v21)
          {
            v22 = v14;
            goto LABEL_17;
          }
        }

        else
        {
        }
      }

      v11 = [obj countByEnumeratingWithState:&v27 objects:v37 count:16];
    }

    while (v11);
  }

  v22 = 0;
LABEL_17:

  v23 = *MEMORY[0x277D85DE8];

  return v22;
}

- (void)removeRemovedUser:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_removedUsers removeObject:v4];
  os_unfair_recursive_lock_unlock();
}

- (BOOL)containsRemovedUser:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v5 = [(HMDHome *)self removedUsers];
  v6 = [v5 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v6)
  {
    v7 = *v12;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(v5);
        }

        if ([*(*(&v11 + 1) + 8 * i) isEqualToUser:v4])
        {
          LOBYTE(v6) = 1;
          goto LABEL_11;
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v9 = *MEMORY[0x277D85DE8];
  return v6;
}

- (void)_refreshUserDisplayNames
{
  v49 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB58] set];
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v34 = self;
  v4 = [(HMDHome *)self outgoingInvitations];
  v5 = [v4 countByEnumeratingWithState:&v39 objects:v48 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v40;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v40 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v39 + 1) + 8 * i);
        if ([v9 refreshDisplayName])
        {
          if (isInternalBuild())
          {
            v10 = MEMORY[0x277CCACA8];
            v11 = [v9 uuid];
            v12 = [v10 stringWithFormat:@"OutgoingInviteDisplayNameUpdate_%@", v11];
            [v3 addObject:v12];
          }

          else
          {
            [v3 addObject:@"OutgoingInviteDisplayNameUpdate"];
          }
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v39 objects:v48 count:16];
    }

    while (v6);
  }

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v13 = [(HMDHome *)v34 users];
  v14 = [v13 countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v36;
    do
    {
      for (j = 0; j != v15; ++j)
      {
        if (*v36 != v16)
        {
          objc_enumerationMutation(v13);
        }

        v18 = *(*(&v35 + 1) + 8 * j);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (!v20 && [v18 refreshDisplayName])
        {
          if (isInternalBuild())
          {
            v21 = MEMORY[0x277CCACA8];
            v22 = [v18 uuid];
            v23 = [v21 stringWithFormat:@"UserDisplayNameUpdate_%@", v22];
            [v3 addObject:v23];
          }

          else
          {
            [v3 addObject:@"UserDisplayNameUpdate"];
          }
        }
      }

      v15 = [v13 countByEnumeratingWithState:&v35 objects:v47 count:16];
    }

    while (v15);
  }

  if ([v3 count])
  {
    v24 = objc_autoreleasePoolPush();
    v25 = v34;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [v3 allObjects];
      v29 = [v28 componentsJoinedByString:{@", "}];
      *buf = 138543618;
      v44 = v27;
      v45 = 2112;
      v46 = v29;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@User display names updated: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    [(HMDHome *)v25 saveToCurrentAccountWithReason:@"userDisplayNameUpdated"];
    v30 = [(HMDHome *)v25 home];
    v31 = [v30 homeManager];
    v32 = [(HMDHome *)v25 uuid];
    [v31 updateGenerationCounterWithReason:@"userDisplayNameUpdated" sourceUUID:v32 shouldNotifyClients:1];
  }

  v33 = *MEMORY[0x277D85DE8];
}

- (void)refreshUserDisplayNames
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __34__HMDHome_refreshUserDisplayNames__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)_addUserToContainer:(id)a3
{
  v16[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  [(HMDHome *)self addUser:v4];
  v5 = [(HMDHome *)self presenceMonitor];
  [v5 addNewUser:v4];

  v6 = [(HMDHome *)self notificationCenter];
  v15 = @"HMDUserNotificationKey";
  v16[0] = v4;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v16 forKeys:&v15 count:1];
  [v6 postNotificationName:@"HMDHomeUserAddedNotification" object:self userInfo:v7];

  [(HMDHome *)self updateCATIDForUsersIfNeeded:0];
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v13 = 138543362;
    v14 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Setting up shared user fabric data per user addition", &v13, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  [(HMDHome *)v9 setUpSharedUserFabricDataWithForceFetch:0 completion:0];

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_removeUserFromContainer:(id)a3
{
  v10[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self presenceMonitor];
  [v5 removeUser:v4];

  [v4 removeCloudData];
  [(HMDHome *)self _removeUser:v4];
  [v4 unconfigure];
  v6 = [(HMDHome *)self notificationCenter];
  v9 = @"HMDUserNotificationKey";
  v10[0] = v4;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v10 forKeys:&v9 count:1];

  [v6 postNotificationName:@"HMDHomeUserRemovedNotification" object:self userInfo:v7];
  v8 = *MEMORY[0x277D85DE8];
}

- (id)findAdditionalUUIDsForUser:(id)a3
{
  v4 = a3;
  v14 = 0;
  v15 = &v14;
  v16 = 0x3032000000;
  v17 = __Block_byref_object_copy__14759;
  v18 = __Block_byref_object_dispose__14760;
  v19 = 0;
  v5 = [(HMDHome *)self backingStore];
  v6 = [v5 context];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __38__HMDHome_findAdditionalUUIDsForUser___block_invoke;
  v10[3] = &unk_27868A4D8;
  v7 = v4;
  v11 = v7;
  v12 = self;
  v13 = &v14;
  [v6 unsafeSynchronousBlock:v10];

  v8 = v15[5];
  _Block_object_dispose(&v14, 8);

  return v8;
}

void __38__HMDHome_findAdditionalUUIDsForUser___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findUserWithModelID:v2];

  if (v3)
  {
    v4 = [v3 additionalModelsForSameUser];
    v5 = v4;
    if (v4)
    {
      if ([v4 count])
      {
        v6 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v5, "count")}];
        v24[0] = MEMORY[0x277D85DD0];
        v24[1] = 3221225472;
        v24[2] = __38__HMDHome_findAdditionalUUIDsForUser___block_invoke_1699;
        v24[3] = &unk_2786702B8;
        v25 = v6;
        v7 = v6;
        [v5 hmf_enumerateWithAutoreleasePoolUsingBlock:v24];
        v8 = [v7 copy];
        v9 = *(*(a1 + 48) + 8);
        v10 = *(v9 + 40);
        *(v9 + 40) = v8;
      }

      else
      {
        v20 = [MEMORY[0x277CBEB98] set];
        v21 = *(*(a1 + 48) + 8);
        v22 = *(v21 + 40);
        *(v21 + 40) = v20;
      }
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = *(a1 + 40);
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v19 = HMFGetLogIdentifier();
        *buf = 138543618;
        v27 = v19;
        v28 = 2112;
        v29 = v3;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to find potential additional users with model: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [*(a1 + 32) uuid];
      *buf = 138543618;
      v27 = v14;
      v28 = 2112;
      v29 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to find user model with modelID %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
  }

  v23 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome_findAdditionalUUIDsForUser___block_invoke_1699(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 modelID];
  [v2 addObject:v3];
}

- (void)_removeUser:(id)a3 message:(id)a4
{
  v32 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (shouldLogPrivateInformation())
  {
    v8 = [v6 userID];
  }

  else
  {
    v8 = @"...";
    v9 = @"...";
  }

  v10 = [v6 pairingIdentity];

  if (v10)
  {
    v11 = [(HMDHome *)self homeManager];
    if (isFeatureMatterLocalFabricConfigEnabled() && (![v6 privilege] || objc_msgSend(v6, "privilege") == 4))
    {
      v27[0] = MEMORY[0x277D85DD0];
      v27[1] = 3221225472;
      v27[2] = __31__HMDHome__removeUser_message___block_invoke;
      v27[3] = &unk_2786845E8;
      v27[4] = self;
      [(HMDHome *)self incrementOperatePrivilegeCATVersion:v27];
    }

    v12 = [v11 backingStore];
    v13 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v14 = [v12 transaction:@"kUserManagementOperationAddedKey" options:v13];

    v15 = dispatch_group_create();
    v16 = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __31__HMDHome__removeUser_message___block_invoke_2;
    block[3] = &unk_2786891E0;
    block[4] = self;
    v24 = v14;
    v25 = v6;
    v26 = v7;
    v17 = v14;
    dispatch_group_notify(v15, v16, block);

    goto LABEL_14;
  }

  v18 = objc_autoreleasePoolPush();
  v19 = self;
  v20 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
  {
    v21 = HMFGetLogIdentifier();
    *buf = 138543618;
    v29 = v21;
    v30 = 2112;
    v31 = v8;
    _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve user with name: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v18);
  if (v7)
  {
    v11 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    v15 = [v7 responseHandler];
    (*(v15 + 16))(v15, v11, 0);
LABEL_14:
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __31__HMDHome__removeUser_message___block_invoke_2(uint64_t a1)
{
  objc_initWeak(&location, *(a1 + 32));
  v2 = *(a1 + 40);
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __31__HMDHome__removeUser_message___block_invoke_3;
  v3[3] = &unk_278685D08;
  objc_copyWeak(&v6, &location);
  v4 = *(a1 + 48);
  v5 = *(a1 + 56);
  [v2 run:v3];

  objc_destroyWeak(&v6);
  objc_destroyWeak(&location);
}

void __31__HMDHome__removeUser_message___block_invoke_3(id *a1, void *a2)
{
  v48 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v31 = v3;
    v6 = [WeakRetained backingStore];
    v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v8 = [v6 transaction:@"kRemoveUserRequestKey" options:v7];

    v9 = [v5 __modelObjectsForRemovingOutgoingInvitationForUser:a1[4]];
    [v8 addObjects:v9];

    v41 = 0u;
    v42 = 0u;
    v40 = 0u;
    v39 = 0u;
    v10 = [v5 triggers];
    v11 = [v10 countByEnumeratingWithState:&v39 objects:v43 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v40;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v40 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v39 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v16 = v15;
          }

          else
          {
            v16 = 0;
          }

          v17 = v16;

          [v17 handleRemovalOfUser:a1[4] transaction:v8];
        }

        v12 = [v10 countByEnumeratingWithState:&v39 objects:v43 count:16];
      }

      while (v12);
    }

    v18 = objc_alloc(MEMORY[0x277D0F7A8]);
    v19 = [v5 workQueue];
    v20 = [v18 initWithQueue:v19];

    v21 = [v5 homeManager];
    v22 = [v21 homeOwnerCloudShareManager];
    v23 = [v22 revokeAccessForUser:a1[4] home:v5];
    v35[0] = MEMORY[0x277D85DD0];
    v35[1] = 3221225472;
    v35[2] = __31__HMDHome__removeUser_message___block_invoke_1694;
    v35[3] = &unk_278686878;
    v35[4] = v5;
    v36 = a1[4];
    v37 = v8;
    v38 = a1[5];
    v32[0] = MEMORY[0x277D85DD0];
    v32[1] = 3221225472;
    v32[2] = __31__HMDHome__removeUser_message___block_invoke_1698;
    v32[3] = &unk_278685D80;
    v32[4] = v5;
    v33 = a1[4];
    v34 = a1[5];
    v24 = v8;
    v25 = [v23 inContext:v20 then:v35 orRecover:v32];

    v3 = v31;
  }

  else
  {
    v26 = objc_autoreleasePoolPush();
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      v29 = a1[4];
      *buf = 138543618;
      v45 = v28;
      v46 = 2112;
      v47 = v29;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Home disappeared, cannot remove user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v26);
  }

  v30 = *MEMORY[0x277D85DE8];
}

uint64_t __31__HMDHome__removeUser_message___block_invoke_1694(id *a1, void *a2)
{
  v37 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = a1[4];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [a1[5] uuid];
    v9 = [a1[4] name];
    v10 = [a1[4] uuid];
    *buf = 138544130;
    v30 = v7;
    v31 = 2112;
    v32 = v8;
    v33 = 2112;
    v34 = v9;
    v35 = 2112;
    v36 = v10;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully revoked cloud share for shared user %@ for home %@/%@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v11 = [HMDUserModel alloc];
  v12 = [a1[5] uuid];
  v13 = [a1[4] uuid];
  v14 = [(HMDBackingStoreModelObject *)v11 initWithObjectChangeType:3 uuid:v12 parentUUID:v13];

  [a1[6] add:v14];
  v15 = [a1[4] findAdditionalUUIDsForUser:a1[5]];
  if ([v15 count])
  {
    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __31__HMDHome__removeUser_message___block_invoke_1695;
    v27[3] = &unk_278676860;
    v27[4] = a1[4];
    v28 = a1[6];
    [v15 hmf_enumerateWithAutoreleasePoolUsingBlock:v27];
  }

  v16 = objc_autoreleasePoolPush();
  v17 = a1[4];
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    v20 = a1[5];
    v21 = [a1[6] objects];
    *buf = 138543874;
    v30 = v19;
    v31 = 2112;
    v32 = v20;
    v33 = 2112;
    v34 = v21;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Going to run V4 transaction to remove user: %@ / %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v16);
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __31__HMDHome__removeUser_message___block_invoke_1697;
  v25[3] = &unk_27868A1D8;
  v25[4] = a1[4];
  v22 = a1[6];
  v26 = a1[7];
  [v22 run:v25];

  v23 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __31__HMDHome__removeUser_message___block_invoke_1698(uint64_t a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) uuid];
    v9 = [*(a1 + 32) name];
    v10 = [*(a1 + 32) uuid];
    v15 = 138544386;
    v16 = v7;
    v17 = 2112;
    v18 = v8;
    v19 = 2112;
    v20 = v9;
    v21 = 2112;
    v22 = v10;
    v23 = 2112;
    v24 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to revoke cloud share for shared user %@ for home %@/%@ due to %@", &v15, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *(a1 + 48);
  v12 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:52 userInfo:0];
  [v11 respondWithError:v12];

  v13 = *MEMORY[0x277D85DE8];
  return 1;
}

void __31__HMDHome__removeUser_message___block_invoke_1695(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [HMDUserModel alloc];
  v5 = [*(a1 + 32) uuid];
  v6 = [(HMDBackingStoreModelObject *)v4 initWithObjectChangeType:3 uuid:v3 parentUUID:v5];

  [*(a1 + 40) add:v6];
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v12 = 138543618;
    v13 = v10;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Created transaction to remove duplicate user with UUID %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *MEMORY[0x277D85DE8];
}

void __31__HMDHome__removeUser_message___block_invoke_1697(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit removeUser transaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  [*(a1 + 40) respondWithPayload:0 error:v3];

  v8 = *MEMORY[0x277D85DE8];
}

- (id)__modelObjectsForRemovingOutgoingInvitationForUser:(id)a3
{
  v52 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4)
  {
    v45 = 0u;
    v46 = 0u;
    v43 = 0u;
    v44 = 0u;
    v5 = [(HMDHome *)self outgoingInvitations];
    v6 = [v5 countByEnumeratingWithState:&v43 objects:v51 count:16];
    if (v6)
    {
      v38 = self;
      v7 = *v44;
LABEL_4:
      v8 = 0;
      while (1)
      {
        if (*v44 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v43 + 1) + 8 * v8);
        v10 = [v9 user];
        if (v10)
        {
          v11 = [v4 userID];
          v12 = [v10 userID];
          v13 = [v11 isEqualToString:v12];

          if (v13)
          {
            break;
          }
        }

        if (v6 == ++v8)
        {
          v6 = [v5 countByEnumeratingWithState:&v43 objects:v51 count:16];
          if (v6)
          {
            goto LABEL_4;
          }

          v14 = v5;
          v15 = MEMORY[0x277CBEBF8];
          goto LABEL_23;
        }
      }

      v14 = v9;
      if ([v10 isPending])
      {
        v6 = v10;
      }

      else
      {
        v6 = 0;
      }

      if (!v14)
      {
        v15 = MEMORY[0x277CBEBF8];
        goto LABEL_25;
      }

      v16 = [MEMORY[0x277CBEB18] arrayWithCapacity:2];
      v17 = objc_alloc(MEMORY[0x277D0F7A8]);
      v18 = [(HMDHome *)v38 workQueue];
      v19 = [v17 initWithQueue:v18];

      v20 = [(HMDHome *)v38 homeManager];
      v21 = [v20 homeOwnerCloudShareManager];
      v22 = [v21 revokeAccessForUser:v4 home:v38];
      v41[0] = MEMORY[0x277D85DD0];
      v41[1] = 3221225472;
      v41[2] = __62__HMDHome___modelObjectsForRemovingOutgoingInvitationForUser___block_invoke;
      v41[3] = &unk_278687050;
      v41[4] = v38;
      v42 = v4;
      v39[0] = MEMORY[0x277D85DD0];
      v39[1] = 3221225472;
      v39[2] = __62__HMDHome___modelObjectsForRemovingOutgoingInvitationForUser___block_invoke_1691;
      v39[3] = &unk_2786882F0;
      v39[4] = v38;
      v40 = v42;
      v23 = [v22 inContext:v19 then:v41 orRecover:v39];

      v24 = [HMDOutgoingHomeInvitationModel alloc];
      v25 = [v14 identifier];
      v26 = [(HMDHome *)v38 uuid];
      v27 = [(HMDBackingStoreModelObject *)v24 initWithObjectChangeType:3 uuid:v25 parentUUID:v26];

      [v16 addObject:v27];
      if (v6)
      {
        v28 = objc_autoreleasePoolPush();
        v29 = v38;
        v30 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
        {
          v31 = HMFGetLogIdentifier();
          *buf = 138543618;
          v48 = v31;
          v49 = 2112;
          v50 = v6;
          _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Going to remove pending user with invitation : %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v28);
        v32 = [HMDUserModel alloc];
        v33 = [v6 uuid];
        v34 = [(HMDHome *)v29 uuid];
        v35 = [(HMDBackingStoreModelObject *)v32 initWithObjectChangeType:3 uuid:v33 parentUUID:v34];

        [v16 addObject:v35];
      }

      v15 = [v16 copy];
    }

    else
    {
      v15 = MEMORY[0x277CBEBF8];
      v14 = v5;
    }

LABEL_23:

LABEL_25:
  }

  else
  {
    v15 = MEMORY[0x277CBEBF8];
  }

  v36 = *MEMORY[0x277D85DE8];

  return v15;
}

uint64_t __62__HMDHome___modelObjectsForRemovingOutgoingInvitationForUser___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) uuid];
    v9 = [*(a1 + 32) name];
    v10 = [*(a1 + 32) uuid];
    v13 = 138544130;
    v14 = v7;
    v15 = 2112;
    v16 = v8;
    v17 = 2112;
    v18 = v9;
    v19 = 2112;
    v20 = v10;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully revoked cloud share for pending user %@ for home %@/%@", &v13, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __62__HMDHome___modelObjectsForRemovingOutgoingInvitationForUser___block_invoke_1691(uint64_t a1, void *a2)
{
  v23 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) uuid];
    v9 = [*(a1 + 32) name];
    v10 = [*(a1 + 32) uuid];
    v13 = 138544386;
    v14 = v7;
    v15 = 2112;
    v16 = v8;
    v17 = 2112;
    v18 = v9;
    v19 = 2112;
    v20 = v10;
    v21 = 2112;
    v22 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to revoke cloud share for pending user %@ for home %@/%@ due to %@", &v13, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

- (void)_removeOutgoingInvitationForUser:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self __modelObjectsForRemovingOutgoingInvitationForUser:v4];
  if (([v5 hmf_isEmpty] & 1) == 0)
  {
    v6 = [(HMDHome *)self backingStore];
    v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v8 = [v6 transaction:@"removeOutgoingInvitation" options:v7];

    [v8 addObjects:v5];
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __44__HMDHome__removeOutgoingInvitationForUser___block_invoke;
    v9[3] = &unk_278688D58;
    v9[4] = self;
    v10 = v4;
    v11 = v5;
    [v8 run:v9];
  }
}

void __44__HMDHome__removeOutgoingInvitationForUser___block_invoke(uint64_t a1, void *a2)
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 40);
      v9 = *(a1 + 48);
      v11 = 138544130;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      v15 = 2112;
      v16 = v9;
      v17 = 2112;
      v18 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to run transaction to remove the invitation for the user: %@ / %@ / %@", &v11, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)removeUser:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v13 = v8;
    v14 = 2112;
    v15 = v4;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to remove user: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __22__HMDHome_removeUser___block_invoke;
  v11[3] = &unk_278689DC0;
  v11[4] = v6;
  v9 = [MEMORY[0x277D0F818] messageWithName:@"kDataSyncResponseNAckKey" messagePayload:0 responseHandler:v11];
  [(HMDHome *)v6 _removeUser:v4 message:v9];

  v10 = *MEMORY[0x277D85DE8];
}

void __22__HMDHome_removeUser___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v10;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Failed to remove user due to %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)removeUserWithUserID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __32__HMDHome_removeUserWithUserID___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __32__HMDHome_removeUserWithUserID___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) users];
  v4 = [v2 hmf_firstObjectWithValue:*(a1 + 40) forKeyPath:@"userID"];

  v3 = v4;
  if (v4)
  {
    [*(a1 + 32) removeUser:v4];
    v3 = v4;
  }
}

- (void)_handleRemoveUser:(id)a3
{
  v56 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(v4, "isRemote"))
  {
    v5 = [v4 uuidForKey:@"kUserUUIDKey"];
    if (v5)
    {
      v6 = [v4 stringForKey:*MEMORY[0x277CD1450]];
      if (v6)
      {
        goto LABEL_9;
      }

      v7 = objc_autoreleasePoolPush();
      v8 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        v11 = [v5 UUIDString];
        *buf = 138543618;
        *&buf[4] = v10;
        *&buf[12] = 2112;
        *&buf[14] = v11;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Message does not contain a mergeID for user being removed, looking mergeID from UUID: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      v12 = v5;
      v13 = v12;
      if (v8)
      {
        v45 = &v44;
        v46 = 0x3032000000;
        v47 = __Block_byref_object_copy__14759;
        v48 = __Block_byref_object_dispose__14760;
        v49 = 0;
        v14 = [(HMDHome *)v8 backingStore];
        v15 = [v14 context];

        v16 = [v15 managedObjectContext];
        *buf = MEMORY[0x277D85DD0];
        *&buf[8] = 3221225472;
        *&buf[16] = __35__HMDHome__findMergeIDForUserUUID___block_invoke;
        v51 = &unk_278689D20;
        v17 = v13;
        v52 = v17;
        v18 = v16;
        v53 = v18;
        v54 = v8;
        v55 = &v44;
        [v15 unsafeSynchronousBlock:buf];
        v6 = v45[5];

        _Block_object_dispose(&v44, 8);
        if (v6)
        {
LABEL_9:
          v19 = objc_autoreleasePoolPush();
          v20 = self;
          v21 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            v22 = HMFGetLogIdentifier();
            *buf = 138543618;
            *&buf[4] = v22;
            *&buf[12] = 2112;
            *&buf[14] = v6;
            _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Looking for user based on mergeID: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v19);
          v23 = [(HMDHome *)v20 userWithMergeID:v6];
          if (v23)
          {
            goto LABEL_13;
          }
        }
      }

      else
      {

        v6 = 0;
      }

      v24 = [(HMDHome *)self users];
      v23 = [v24 hmf_firstObjectWithUUID:v5];

      if (!v23)
      {
        v23 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
        v42 = [v4 responseHandler];
        (v42)[2](v42, v23, 0);

LABEL_26:
        goto LABEL_27;
      }

LABEL_13:
      v25 = [v23 isOwner];
      v26 = objc_autoreleasePoolPush();
      v27 = self;
      v28 = HMFGetOSLogHandle();
      v29 = v28;
      if (v25)
      {
        if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543362;
          *&buf[4] = v30;
          _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Owner cannot be removed from home", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v26);
        v31 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
        v32 = [v4 responseHandler];
        (v32)[2](v32, v31, 0);
      }

      else
      {
        if (os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT))
        {
          v41 = HMFGetLogIdentifier();
          *buf = 138543618;
          *&buf[4] = v41;
          *&buf[12] = 2112;
          *&buf[14] = v23;
          _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Removing user: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v26);
        [(HMDHome *)v27 _removeUser:v23 message:v4];
      }

      goto LABEL_26;
    }

    v33 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
    v34 = [v4 responseHandler];
    (v34)[2](v34, v33, 0);

    v5 = 0;
LABEL_27:

    goto LABEL_28;
  }

  v35 = objc_autoreleasePoolPush();
  v36 = self;
  v37 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
  {
    v38 = HMFGetLogIdentifier();
    *buf = 138543362;
    *&buf[4] = v38;
    _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@User management (remove) not supported for non-SPI clients", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v35);
  v39 = [v4 responseHandler];

  if (v39)
  {
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    v40 = [v4 responseHandler];
    (v40)[2](v40, v5, 0);

    goto LABEL_27;
  }

LABEL_28:

  v43 = *MEMORY[0x277D85DE8];
}

void __35__HMDHome__findMergeIDForUserUUID___block_invoke(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = [_MKFHome findHomeMemberWithUUID:*(a1 + 32) context:*(a1 + 40)];
  v3 = v2;
  if (!v2)
  {
    goto LABEL_4;
  }

  v4 = [v2 home];
  v5 = [v4 modelID];
  v6 = [*(a1 + 48) uuid];
  v7 = [v5 isEqual:v6];

  if (v7)
  {
    v8 = [v3 idsMergeIdentifier];
    v9 = *(*(a1 + 56) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;
  }

  else
  {
LABEL_4:
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 48);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v15 = *(a1 + 32);
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to find home member model with modelID %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdatePresenceConsent:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277CD1F00] authWithMessage:v4];
  if (!v5)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v37 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Received nil presence auth", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v16 = [v4 responseHandler];
    v17 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
    goto LABEL_15;
  }

  v6 = [(HMDHome *)self presenceAuthStatus];
  v7 = HMFEqualObjects();

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v11;
      v38 = 2112;
      v39 = v5;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Presence auth status is already set to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
LABEL_14:
    v16 = [v4 responseHandler];
    v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
LABEL_15:
    v26 = v17;
    (*&v16->super._bsoDataVersionOverride)(v16, v17, 0);
    goto LABEL_16;
  }

  if (([v5 value] - 1) < 2)
  {
    v18 = [HMDHomeModel alloc];
    v19 = [(HMDHome *)self uuid];
    v20 = [(HMDHome *)self homeManager];
    v21 = [v20 uuid];
    v16 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:2 uuid:v19 parentUUID:v21];

    v22 = [v5 number];
    [(HMDHomeModel *)v16 setPresenceAuthorizationStatus:v22];

    v23 = [(HMDHome *)self backingStore];
    v24 = [v4 name];
    v25 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v26 = [v23 transaction:v24 options:v25];

    [v26 add:v16];
    v33[0] = MEMORY[0x277D85DD0];
    v33[1] = 3221225472;
    v33[2] = __40__HMDHome__handleUpdatePresenceConsent___block_invoke;
    v33[3] = &unk_27868A1D8;
    v34 = v4;
    v35 = self;
    [v26 run:v33];

LABEL_16:
    goto LABEL_17;
  }

  v27 = objc_autoreleasePoolPush();
  v28 = self;
  v29 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
  {
    v30 = HMFGetLogIdentifier();
    *buf = 138543618;
    v37 = v30;
    v38 = 2112;
    v39 = v5;
    _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Received invalid parameter for presence authorization: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v27);
  v31 = [v4 responseHandler];

  if (v31)
  {
    goto LABEL_14;
  }

LABEL_17:

  v32 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome__handleUpdatePresenceConsent___block_invoke(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v8 = [MEMORY[0x277CBEB38] dictionary];
    v4 = [*(a1 + 40) currentUser];
    v5 = [v4 presenceAuthStatus];
    [v5 addToPayload:v8];

    v6 = *(a1 + 32);
    v7 = [v8 copy];
    [v6 respondWithPayload:v7];
  }
}

- (void)_readLocalHomeKeyMiscInfo
{
  v3 = [(HMDHome *)self uuid];
  v4 = [(HMDHome *)self backingStore];
  v5 = [v4 context];

  v6 = [v5 managedObjectContext];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __36__HMDHome__readLocalHomeKeyMiscInfo__block_invoke;
  v9[3] = &unk_27868A010;
  v10 = v3;
  v11 = v6;
  v12 = self;
  v7 = v6;
  v8 = v3;
  [v7 performBlockAndWait:v9];
}

void __36__HMDHome__readLocalHomeKeyMiscInfo__block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = [MKFLocalHomeKeyMiscInfo fetchLocalHomeKeyMiscInfoWithHomeUUID:*(a1 + 32) managedObjectContext:*(a1 + 40)];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 48);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_INFO);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v7;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Reading local home key miscellaneous info.", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v8 = [v2 dismissedWalletKeyUWBUnlockOnboarding];
    [*(a1 + 48) setDismissedWalletKeyUWBUnlockOnboarding:{objc_msgSend(v8, "BOOLValue")}];

    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 48);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [*(a1 + 48) dismissedWalletKeyUWBUnlockOnboarding];
      v19 = 138543618;
      v20 = v12;
      v21 = 1024;
      LODWORD(v22) = v13;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Dismissed Wallet Key UWB Unlock Onboarding settings read from local store as : %d", &v19, 0x12u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = [v2 clientWalletKeyUUID];
    [*(a1 + 48) setClientWalletKeyUUID:v14];

    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 48);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [*(a1 + 48) clientWalletKeyUUID];
      v19 = 138543618;
      v20 = v15;
      v21 = 2112;
      v22 = v16;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Client Wallet Key UUID read from local store as : %@", &v19, 0x16u);
    }
  }

  else if (v6)
  {
    v17 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v17;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Did not find home key misc info in local store.", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v18 = *MEMORY[0x277D85DE8];
}

- (void)resetHomeKeyMiscInfo
{
  v31 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self dismissedWalletKeyUWBUnlockOnboarding]|| ([(HMDHome *)self clientWalletKeyUUID], v3 = objc_claimAutoreleasedReturnValue(), v3, v3))
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      [(HMDHome *)v5 dismissedWalletKeyUWBUnlockOnboarding];
      v8 = HMFBooleanToString();
      v9 = [(HMDHome *)v5 clientWalletKeyUUID];
      *buf = 138543874;
      v26 = v7;
      v27 = 2112;
      v28 = v8;
      v29 = 2112;
      v30 = v9;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Resetting HomeKeyMiscInfo with dismissedUWB: %@ and clientWalletKeyUUID: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    v10 = [(HMDHome *)v5 uuid];
    v11 = +[HMDCoreData sharedInstance];
    v12 = [v11 newManagedObjectContext];

    v13 = HMDWorkingContextNameForHomeUUID(v10);
    [v12 setName:v13];

    v14 = @"HMD.1P";
    [v12 setTransactionAuthor:@"HMD.1P"];

    os_unfair_lock_lock_with_options();
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __31__HMDHome_resetHomeKeyMiscInfo__block_invoke;
    v22[3] = &unk_27868A010;
    v22[4] = v5;
    v15 = v10;
    v23 = v15;
    v16 = v12;
    v24 = v16;
    [v16 performBlockAndWait:v22];
    [(HMDHome *)v5 setDismissedWalletKeyUWBUnlockOnboarding:0];
    [(HMDHome *)v5 setClientWalletKeyUUID:0];

    os_unfair_lock_unlock(&v5->_dbWriteLock);
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v21;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Dismissed Wallet Key UWB Unlock Onboarding and clientWalletKeyUUID already unset, nothing to be done", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v18);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __31__HMDHome_resetHomeKeyMiscInfo__block_invoke(uint64_t a1)
{
  v27 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    *buf = 138543362;
    v22 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Going to reset HomeKeyMiscInfo Attributes", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [MKFLocalHomeKeyMiscInfo fetchLocalHomeKeyMiscInfoWithHomeUUID:*(a1 + 40) managedObjectContext:*(a1 + 48)];
  v7 = v6;
  if (v6)
  {
    [v6 setDismissedWalletKeyUWBUnlockOnboarding:MEMORY[0x277CBEC28]];
    [v7 setClientWalletKeyUUID:0];
    v8 = *(a1 + 48);
    v20 = 0;
    [v8 save:&v20];
    v9 = v20;
    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 32);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMFBooleanToString();
      *buf = 138543874;
      v22 = v13;
      v23 = 2112;
      v24 = v9;
      v25 = 2112;
      v26 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Resetting HomeKeyMiscInfo to local store with error :%@, Success : %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 32);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543362;
      v22 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Expected to find HomeKeyMiscInfo since cached home properties were not nil when attempting to reset HomeKeyMiscInfo", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)saveClientWalletKeyUUIDToLocalStore:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self uuid];
  v6 = +[HMDCoreData sharedInstance];
  v7 = [v6 newManagedObjectContext];

  v8 = HMDWorkingContextNameForHomeUUID(v5);
  [v7 setName:v8];

  v9 = @"HMD.1P";
  [v7 setTransactionAuthor:@"HMD.1P"];

  os_unfair_lock_lock_with_options();
  v13 = MEMORY[0x277D85DD0];
  v14 = 3221225472;
  v15 = __47__HMDHome_saveClientWalletKeyUUIDToLocalStore___block_invoke;
  v16 = &unk_2786891E0;
  v17 = self;
  v10 = v4;
  v18 = v10;
  v11 = v5;
  v19 = v11;
  v12 = v7;
  v20 = v12;
  [v12 performBlockAndWait:&v13];
  [(HMDHome *)self setClientWalletKeyUUID:v10, v13, v14, v15, v16, v17];

  os_unfair_lock_unlock(&self->_dbWriteLock);
}

void __47__HMDHome_saveClientWalletKeyUUIDToLocalStore___block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    *buf = 138543618;
    v18 = v5;
    v19 = 2112;
    v20 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Going to store client Wallet Key UUID : %@ to local store", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = [MKFLocalHomeKeyMiscInfo fetchLocalHomeKeyMiscInfoWithHomeUUID:*(a1 + 48) managedObjectContext:*(a1 + 56)];
  if (!v7)
  {
    v7 = [[MKFLocalHomeKeyMiscInfo alloc] initWithContext:*(a1 + 56)];
    [(MKFLocalHomeKeyMiscInfo *)v7 setHomeUUID:*(a1 + 48)];
  }

  [(MKFLocalHomeKeyMiscInfo *)v7 setClientWalletKeyUUID:*(a1 + 40)];
  v8 = *(a1 + 56);
  v16 = 0;
  [v8 save:&v16];
  v9 = v16;
  v10 = objc_autoreleasePoolPush();
  v11 = *(a1 + 32);
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    *buf = 138543874;
    v18 = v13;
    v19 = 2112;
    v20 = v9;
    v21 = 2112;
    v22 = v14;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Storing client Wallet Key UUID to local store with error :%@, Success : %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v10);
  v15 = *MEMORY[0x277D85DE8];
}

- (void)updateLocalUWBOnboardingDismissed:(BOOL)a3
{
  v5 = [(HMDHome *)self uuid];
  v6 = +[HMDCoreData sharedInstance];
  v7 = [v6 newManagedObjectContext];

  v8 = HMDWorkingContextNameForHomeUUID(v5);
  [v7 setName:v8];

  v9 = @"HMD.1P";
  [v7 setTransactionAuthor:@"HMD.1P"];

  os_unfair_lock_lock_with_options();
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __45__HMDHome_updateLocalUWBOnboardingDismissed___block_invoke;
  v12[3] = &unk_278685AA8;
  v12[4] = self;
  v15 = a3;
  v10 = v5;
  v13 = v10;
  v11 = v7;
  v14 = v11;
  [v11 performBlockAndWait:v12];

  os_unfair_lock_unlock(&self->_dbWriteLock);
}

void __45__HMDHome_updateLocalUWBOnboardingDismissed___block_invoke(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 56);
    v7 = HMFBooleanToString();
    *buf = 138543618;
    v20 = v5;
    v21 = 2112;
    v22 = v7;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Going to store dismissedWalletKeyUWBUnlockOnboarding to %@ in local store", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v8 = [MKFLocalHomeKeyMiscInfo fetchLocalHomeKeyMiscInfoWithHomeUUID:*(a1 + 40) managedObjectContext:*(a1 + 48)];
  if (!v8)
  {
    v8 = [[MKFLocalHomeKeyMiscInfo alloc] initWithContext:*(a1 + 48)];
    [(MKFLocalHomeKeyMiscInfo *)v8 setHomeUUID:*(a1 + 40)];
  }

  v9 = [MEMORY[0x277CCABB0] numberWithBool:*(a1 + 56)];
  [(MKFLocalHomeKeyMiscInfo *)v8 setDismissedWalletKeyUWBUnlockOnboarding:v9];

  v10 = *(a1 + 48);
  v18 = 0;
  [v10 save:&v18];
  v11 = v18;
  v12 = objc_autoreleasePoolPush();
  v13 = *(a1 + 32);
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    v16 = HMFBooleanToString();
    *buf = 138543874;
    v20 = v15;
    v21 = 2112;
    v22 = v11;
    v23 = 2112;
    v24 = v16;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Storing dismissedWalletKeyUWBUnlockOnboarding to local store with error :%@, Success : %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v12);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetDismissedUWBOnboarding:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isRemote])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v27 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Received remote message for a local setting of DismissedUWBOnboarding", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [v4 responseHandler];
    v10 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
    (v9)[2](v9, v10, 0);
  }

  else
  {
    v11 = [(HMDHome *)self dismissedWalletKeyUWBUnlockOnboarding];
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_INFO);
    if (v11)
    {
      if (v15)
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543362;
        v27 = v16;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Home has already been onboarded for UWB unlock", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v12);
    }

    else
    {
      if (v15)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v27 = v17;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Setting Dismissed Wallet Key UWB Unlock Onboarding", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v12);
      [(HMDHome *)v13 updateLocalUWBOnboardingDismissed:1];
      [(HMDHome *)v13 setDismissedWalletKeyUWBUnlockOnboarding:1];
      v18 = +[HMDACWGKeyManager shared];
      v19 = [(HMDHome *)v13 uuid];
      v20 = [(HMDHome *)v13 currentUser];
      v21 = [v20 uuid];
      v22 = [(HMDHome *)v13 backingStore];
      v23 = [v22 context];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __44__HMDHome__handleSetDismissedUWBOnboarding___block_invoke;
      v25[3] = &unk_278670290;
      v25[4] = v13;
      [v18 getOrCreateIssuerKeyAndSaveIfNeededWithHome:v19 user:v21 context:v23 shouldRoll:0 completionHandler:v25];
    }

    [v4 respondWithSuccess];
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__handleSetDismissedUWBOnboarding___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (!v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v10;
      v14 = 2112;
      v15 = v6;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to create ACWG issuer key with error on onboarding flow: %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateUserAnnounceAccess:(id)a3
{
  v35 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(v4, "isRemote"))
  {
    v5 = [v4 stringForKey:@"kUserIDKey"];
    v6 = [(HMDHome *)self users];
    v7 = [v6 hmf_firstObjectWithValue:v5 forKeyPath:@"userID"];

    if (v7)
    {
      v8 = [(HMDHome *)self currentUser];
      if ([v8 isAdministrator])
      {
        v9 = [v7 newModelWithChangeType:2];
        v10 = [v4 numberForKey:*MEMORY[0x277CD06A0]];
        if (v10)
        {
          [v9 setAnnounceAccessAllowed:v10];
          if ([v10 BOOLValue])
          {
            v11 = &unk_283E71A68;
          }

          else
          {
            v11 = &unk_283E71A80;
          }

          [v9 setAnnounceAccessLevel:v11];
        }

        v12 = [(HMDHome *)self backingStore];
        v13 = [v4 name];
        v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v15 = [v12 transaction:v13 options:v14];

        [v15 add:v9 withMessage:v4];
        [v15 run];

        goto LABEL_21;
      }

      v25 = objc_autoreleasePoolPush();
      v26 = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        v31 = 138543618;
        v32 = v28;
        v33 = 2112;
        v34 = v8;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Current user is not an administrator, cannot modify access: %@", &v31, 0x16u);
      }

      objc_autoreleasePoolPop(v25);
      v20 = [v4 responseHandler];
      v29 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
      (v20)[2](v20, v29, 0);
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        v31 = 138543618;
        v32 = v19;
        v33 = 2112;
        v34 = v5;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", &v31, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      v8 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      v20 = [v4 responseHandler];
      (v20)[2](v20, v8, 0);
    }

LABEL_21:
    goto LABEL_22;
  }

  v21 = objc_autoreleasePoolPush();
  v22 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    v31 = 138543362;
    v32 = v24;
    _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to update users to home", &v31, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  v5 = [v4 responseHandler];
  v7 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
  (v5)[2](v5, v7, 0);
LABEL_22:

  v30 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateAudioAnalysisAccess:(id)a3
{
  v47 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:@"kUserIDKey"];
  v6 = [(HMDHome *)self users];
  v7 = [v6 hmf_firstObjectWithValue:v5 forKeyPath:@"userID"];

  if (v7)
  {
    v8 = [(HMDHome *)self currentUser];
    if ([v8 isAdministrator])
    {
      v9 = [v7 newModelWithChangeType:2];
      v10 = [v4 numberForKey:*MEMORY[0x277CCFE60]];
      v11 = v10;
      if (v10)
      {
        v12 = [v10 integerValue];
        v13 = objc_autoreleasePoolPush();
        v14 = self;
        v15 = HMFGetOSLogHandle();
        v37 = v12;
        if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v16 = v36 = v13;
          v17 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v12];
          *buf = 138543874;
          v42 = v16;
          v43 = 2112;
          v44 = v17;
          v45 = 2112;
          v46 = v7;
          _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Updating audio analysis access level to %@ for user: %@", buf, 0x20u);

          v12 = v37;
          v13 = v36;
        }

        objc_autoreleasePoolPop(v13);
        v18 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v12];
        [v9 setAudioAnalysisUserDropInAccessLevel:v18];

        v19 = [(HMDHome *)v14 backingStore];
        v20 = [v4 name];
        v21 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v22 = [v19 transaction:v20 options:v21];

        [v22 add:v9 withMessage:v4];
        v38[0] = MEMORY[0x277D85DD0];
        v38[1] = 3221225472;
        v38[2] = __44__HMDHome__handleUpdateAudioAnalysisAccess___block_invoke;
        v38[3] = &unk_27868A188;
        v39 = v4;
        v40 = v37;
        [v22 run:v38];
      }

      else
      {
        v31 = objc_autoreleasePoolPush();
        v32 = self;
        v33 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
        {
          v34 = HMFGetLogIdentifier();
          *buf = 138543362;
          v42 = v34;
          _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Missing access level for audio analysis dropIn", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v31);
        v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        [v4 respondWithError:v22];
      }
    }

    else
    {
      v27 = objc_autoreleasePoolPush();
      v28 = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v30;
        v43 = 2112;
        v44 = v8;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Current user is not an administrator, cannot modify access: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v27);
      v9 = [v4 responseHandler];
      v11 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
      (v9)[2](v9, v11, 0);
    }
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    v24 = self;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v42 = v26;
      v43 = 2112;
      v44 = v5;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v8];
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__handleUpdateAudioAnalysisAccess___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = *(a1 + 32);
    v4 = *MEMORY[0x277D85DE8];

    [v3 respondWithError:a2];
  }

  else
  {
    v8 = *MEMORY[0x277CCFE60];
    v5 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 40)];
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];

    [*(a1 + 32) respondWithPayload:v6];
    v7 = *MEMORY[0x277D85DE8];
  }
}

- (void)_handleUpdateUserAccess:(id)a3
{
  v62 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(v4, "isRemote"))
  {
    v5 = [v4 stringForKey:@"kUserIDKey"];
    v6 = [(HMDHome *)self users];
    v7 = [v6 hmf_firstObjectWithValue:v5 forKeyPath:@"userID"];

    if (!v7)
    {
      v15 = objc_autoreleasePoolPush();
      v16 = self;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v18;
        v58 = 2112;
        v59 = v5;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
      v12 = MEMORY[0x277CCA9B8];
      v13 = *MEMORY[0x277CCFD28];
      v14 = 2;
      goto LABEL_11;
    }

    if ([v7 isOwner])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v11;
        v58 = 2112;
        v59 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot modify the owner of the home: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      v12 = MEMORY[0x277CCA9B8];
      v13 = *MEMORY[0x277CCFD28];
      v14 = 17;
LABEL_11:
      v19 = [v12 errorWithDomain:v13 code:v14 userInfo:0];
      v20 = [v4 responseHandler];
      (v20)[2](v20, v19, 0);
LABEL_42:

      goto LABEL_43;
    }

    v19 = [(HMDHome *)self currentUser];
    if (([v19 isAdministrator] & 1) == 0)
    {
      v34 = objc_autoreleasePoolPush();
      v35 = self;
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
      {
        v37 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v37;
        v58 = 2112;
        v59 = v19;
        _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_ERROR, "%{public}@Current user is not an administrator, cannot modify access: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v34);
      v20 = [v4 responseHandler];
      v26 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
      (v20)[2](v20, v26, 0);
      goto LABEL_41;
    }

    v20 = [v7 newModelWithChangeType:2];
    v25 = [v4 numberForKey:@"kUserAdministratorInformationKey"];
    v26 = v25;
    if (!v25)
    {
      goto LABEL_25;
    }

    v27 = [v25 BOOLValue];
    if (v27 && ![(HMDHome *)self isResidentSupported])
    {
      v38 = objc_autoreleasePoolPush();
      v39 = self;
      v40 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
      {
        v41 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v41;
        v58 = 2112;
        v59 = v5;
        _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_INFO, "%{public}@Cannot update user %@ to administrator because it requires a resident", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v38);
      v42 = MEMORY[0x277CCA9B8];
      v43 = *MEMORY[0x277CCFD28];
      v44 = 48;
    }

    else
    {
      if (![v7 privilege] || objc_msgSend(v7, "privilege") == 4)
      {
        if (v27)
        {
          v28 = &unk_283E71A50;
        }

        else
        {
          v28 = &unk_283E71A38;
        }

        [v20 setPrivilege:v28];
        [v7 privilege];
LABEL_25:
        v51 = v26;
        v29 = [v4 numberForKey:@"kUserRemoteAccessInformationKey"];
        if (v29)
        {
          [v20 setRemoteAccessAllowed:v29];
        }

        v30 = [(HMDHome *)self backingStore];
        v31 = [v4 name];
        v32 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v33 = [v30 transaction:v31 options:v32];

        [v33 add:v20];
        v53[0] = MEMORY[0x277D85DD0];
        v53[1] = 3221225472;
        v53[2] = __35__HMDHome__handleUpdateUserAccess___block_invoke;
        v53[3] = &unk_27868A1D8;
        v54 = v4;
        v55 = v7;
        [v33 run:v53];

        v26 = v51;
        goto LABEL_40;
      }

      v45 = objc_autoreleasePoolPush();
      v46 = self;
      v47 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v48 = v52 = v45;
        v49 = @"non-";
        *buf = 138543874;
        v57 = v48;
        v58 = 2112;
        if (v27)
        {
          v49 = &stru_283CF9D50;
        }

        v59 = v5;
        v60 = 2112;
        v61 = v49;
        _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Failed to update user %@ to %@administrator", buf, 0x20u);

        v45 = v52;
      }

      objc_autoreleasePoolPop(v45);
      v42 = MEMORY[0x277CCA9B8];
      v43 = *MEMORY[0x277CCFD28];
      v44 = 10;
    }

    v29 = [v42 errorWithDomain:v43 code:v44 userInfo:0];
    v33 = [v4 responseHandler];
    (v33)[2](v33, v29, 0);
LABEL_40:

LABEL_41:
    goto LABEL_42;
  }

  v21 = objc_autoreleasePoolPush();
  v22 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    *buf = 138543362;
    v57 = v24;
    _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to update users to home", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  v5 = [v4 responseHandler];
  v7 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
  (v5)[2](v5, v7, 0);
LABEL_43:

  v50 = *MEMORY[0x277D85DE8];
}

void __35__HMDHome__handleUpdateUserAccess___block_invoke(uint64_t a1, uint64_t a2)
{
  v13[5] = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = *(a1 + 32);
    v4 = *MEMORY[0x277D85DE8];

    [v3 respondWithError:a2];
  }

  else
  {
    v12[0] = @"kUserAdministratorInformationKey";
    v5 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isAdministrator")}];
    v13[0] = v5;
    v12[1] = @"kUserRemoteAccessInformationKey";
    v6 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isRemoteAccessAllowed")}];
    v13[1] = v6;
    v12[2] = @"kUserCamerasAccessLevelInformationKey";
    v7 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(*(a1 + 40), "camerasAccessLevel")}];
    v13[2] = v7;
    v12[3] = *MEMORY[0x277CD06A0];
    v8 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isAnnounceAccessAllowed")}];
    v13[3] = v8;
    v12[4] = *MEMORY[0x277CCFE60];
    v9 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(*(a1 + 40), "audioAnalysisUserDropInAccessLevel")}];
    v13[4] = v9;
    v10 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v13 forKeys:v12 count:5];

    [*(a1 + 32) respondWithPayload:v10];
    v11 = *MEMORY[0x277D85DE8];
  }
}

- (void)_handleUpdateUserCamerasAccessLevel:(id)a3
{
  v53 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:@"kUserIDKey"];
  v6 = [(HMDHome *)self users];
  v7 = [v6 hmf_firstObjectWithValue:v5 forKeyPath:@"userID"];

  if (!v7)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543618;
      v48 = v17;
      v49 = 2112;
      v50 = v5;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v12 = MEMORY[0x277CCA9B8];
    v13 = 2;
    goto LABEL_9;
  }

  if (![v7 isOwner])
  {
    v18 = [v7 newModelWithChangeType:2];
    v19 = [v4 numberForKey:@"kUserCamerasAccessLevelInformationKey"];
    v20 = v19;
    if (v19)
    {
      v21 = [v19 integerValue];
      if (HMUserIsValidCameraAccessLevel())
      {
        v22 = [v7 camerasAccessLevel];
        v23 = objc_autoreleasePoolPush();
        v24 = self;
        v25 = HMFGetOSLogHandle();
        v26 = v25;
        if (v22 != v21)
        {
          if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
          {
            v39 = HMFGetLogIdentifier();
            v40 = HMUserCameraAccessLevelAsString();
            *buf = 138543874;
            v48 = v39;
            v49 = 2112;
            v50 = v40;
            v51 = 2112;
            v52 = v7;
            _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Updating cameras access level to %@ for user: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v23);
          [v18 setCamerasAccessLevel:v20];
          v41 = [(HMDHome *)v24 backingStore];
          v42 = [v4 name];
          v43 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v37 = [v41 transaction:v42 options:v43];

          [v37 add:v18];
          v44[0] = MEMORY[0x277D85DD0];
          v44[1] = 3221225472;
          v44[2] = __47__HMDHome__handleUpdateUserCamerasAccessLevel___block_invoke;
          v44[3] = &unk_27868A1D8;
          v45 = v4;
          v46 = v20;
          [v37 run:v44];

          goto LABEL_24;
        }

        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          v27 = HMFGetLogIdentifier();
          v28 = HMUserCameraAccessLevelAsString();
          *buf = 138543618;
          v48 = v27;
          v49 = 2112;
          v50 = v28;
          _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Cameras access level: %@ already set", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
        v29 = MEMORY[0x277CCA9B8];
        v30 = 1;
LABEL_23:
        v37 = [v29 hmErrorWithCode:v30];
        [v4 respondWithError:v37];
LABEL_24:

        goto LABEL_25;
      }

      v31 = objc_autoreleasePoolPush();
      v32 = self;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543618;
        v48 = v36;
        v49 = 2048;
        v50 = v21;
        _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Invalid cameras access level value: %ld", buf, 0x16u);
      }
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      v32 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
      {
        v34 = HMFGetLogIdentifier();
        *buf = 138543618;
        v48 = v34;
        v49 = 2112;
        v50 = @"kUserCamerasAccessLevelInformationKey";
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Missing value for key: %@", buf, 0x16u);
      }
    }

    objc_autoreleasePoolPop(v31);
    v29 = MEMORY[0x277CCA9B8];
    v30 = 3;
    goto LABEL_23;
  }

  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543618;
    v48 = v11;
    v49 = 2112;
    v50 = v5;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot modify cameras access level for owner of the home: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  v12 = MEMORY[0x277CCA9B8];
  v13 = 48;
LABEL_9:
  v18 = [v12 hmErrorWithCode:v13];
  [v4 respondWithError:v18];
LABEL_25:

  v38 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleUpdateUserCamerasAccessLevel___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = *(a1 + 32);
    v4 = *MEMORY[0x277D85DE8];

    [v3 respondWithError:a2];
  }

  else
  {
    v5 = *(a1 + 40);
    v8 = @"kUserCamerasAccessLevelInformationKey";
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [*(a1 + 32) respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (void)_addUsersWithInviteInformations:(id)a3 message:(id)a4
{
  v70 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v41 = a4;
  v46 = [MEMORY[0x277CBEB18] array];
  v45 = [MEMORY[0x277CBEB18] array];
  v61 = 0u;
  v62 = 0u;
  v59 = 0u;
  v60 = 0u;
  obj = v6;
  v7 = [obj countByEnumeratingWithState:&v59 objects:v69 count:16];
  if (v7)
  {
    v43 = *v60;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v60 != v43)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v59 + 1) + 8 * i);
        v10 = [objc_opt_class() privilegeFromUserInviteInformation:v9];
        v11 = +[HMDAccountHandleFormatter defaultFormatter];
        v12 = [v9 userID];
        v13 = [v11 accountHandleFromString:v12];

        v14 = [[HMDUser alloc] initWithAccountHandle:v13 home:self pairingIdentity:0 privilege:v10];
        [(HMDUser *)v14 refreshDisplayName];
        -[HMDUser setRemoteAccessAllowed:](v14, "setRemoteAccessAllowed:", [v9 isRemoteAccessAllowed]);
        -[HMDUser setCamerasAccessLevel:](v14, "setCamerasAccessLevel:", [v9 camerasAccessLevel]);
        if ([v9 isAnnounceAccessAllowed])
        {
          v15 = 2;
        }

        else
        {
          v15 = 1;
        }

        [(HMDUser *)v14 setAnnounceAccessLevel:v15];
        if ([v9 isRestrictedGuest])
        {
          v16 = [HMDRestrictedGuestHomeAccessSettings alloc];
          v17 = [v9 restrictedGuestHomeAccessSettings];
          v18 = [(HMDRestrictedGuestHomeAccessSettings *)v16 initWithRestrictedGuestHomeAccessSettings:v17];

          if (v18)
          {
            [(HMDUser *)v14 setRestrictedGuestAccessSettings:v18];
          }

          v19 = objc_autoreleasePoolPush();
          v20 = self;
          v21 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            v22 = HMFGetLogIdentifier();
            *buf = 138543618;
            v66 = v22;
            v67 = 2112;
            v68 = v14;
            _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Received user invite request with restricted access settings : %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v19);
        }

        v23 = [[HMDOutgoingHomeInvitation alloc] initWithInvitee:v14 invitationState:2 forHome:self expiryDate:0 messageIdentifier:0];
        [v46 addObject:v23];
        v24 = [(HMDHomeInvitation *)v23 invitationData];
        [v45 addObject:v24];
      }

      v7 = [obj countByEnumeratingWithState:&v59 objects:v69 count:16];
    }

    while (v7);
  }

  v25 = _os_feature_enabled_impl();
  objc_initWeak(buf, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke;
  aBlock[3] = &unk_278681A08;
  objc_copyWeak(&v57, buf);
  v26 = v46;
  v56 = v26;
  v58 = v25;
  v47 = _Block_copy(aBlock);
  v27 = [(HMDHome *)self administratorHandler];
  if ([v27 shouldRelayMessages])
  {
    v28 = encodeRootObject();
    v63[0] = @"HM.invitations";
    v63[1] = @"HMDHomeSuppressInviteNotificationKey";
    v64[0] = v28;
    v29 = [MEMORY[0x277CCABB0] numberWithBool:v25];
    v64[1] = v29;
    v44 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v64 forKeys:v63 count:2];

    v30 = MEMORY[0x277D0F848];
    v51[0] = MEMORY[0x277D85DD0];
    v51[1] = 3221225472;
    v51[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_2;
    v51[3] = &unk_278689460;
    objc_copyWeak(&v54, buf);
    v52 = v26;
    v31 = v41;
    v53 = v31;
    v32 = [v30 messageWithName:@"kAddHomeInvitesInternalRequestKey" messagePayload:v44 responseHandler:v51];
    v33 = objc_alloc(MEMORY[0x277D0F820]);
    v34 = [(HMDHome *)self uuid];
    v35 = [v33 initWithTarget:v34];

    [v32 setDestination:v35];
    [v32 setQualityOfService:33];
    v50 = 0;
    v36 = [v27 operationForMessage:v32 error:&v50];
    v37 = v50;
    v38 = v37;
    if (v36)
    {
      [v27 addOperation:v36];
    }

    else
    {
      v39 = v37;
      if (!v37)
      {
        v39 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
      }

      [v31 respondWithError:v39];
      if (!v38)
      {
      }
    }

    objc_destroyWeak(&v54);
  }

  else
  {
    v48[0] = MEMORY[0x277D85DD0];
    v48[1] = 3221225472;
    v48[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_1677;
    v48[3] = &unk_278688B80;
    v49 = v47;
    [(HMDHome *)self _addOutgoingInvitations:v26 message:v41 transactionCompleted:v48];
    v28 = v49;
  }

  objc_destroyWeak(&v57);
  objc_destroyWeak(buf);

  v40 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__addUsersWithInviteInformations_message___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained __sendOutgoingInvitations:*(a1 + 32) suppressHomeInviteNotification:*(a1 + 48)];
}

void __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_2(id *a1, void *a2, void *a3)
{
  v34 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v21 = v6;
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v29 = v11;
      v30 = 2112;
      v31 = @"kAddHomeInvitesInternalRequestKey";
      v32 = 2112;
      v33 = v5;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Relayed message %@ with error %@", buf, 0x20u);
    }

    v22 = v5;

    objc_autoreleasePoolPop(v8);
    v25 = 0u;
    v26 = 0u;
    v23 = 0u;
    v24 = 0u;
    v12 = a1[4];
    v13 = [v12 countByEnumeratingWithState:&v23 objects:v27 count:16];
    if (v13)
    {
      v14 = v13;
      v15 = *v24;
      do
      {
        v16 = 0;
        do
        {
          if (*v24 != v15)
          {
            objc_enumerationMutation(v12);
          }

          v17 = [*(*(&v23 + 1) + 8 * v16) user];
          v18 = [v17 accountHandle];
          v19 = [v9 _outgoingInvitationForUserWithHandle:v18];

          [v19 notifyStateChangedForMessage:a1[5]];
          ++v16;
        }

        while (v14 != v16);
        v14 = [v12 countByEnumeratingWithState:&v23 objects:v27 count:16];
      }

      while (v14);
    }

    v5 = v22;
    [a1[5] respondWithPayload:0 error:v22];
    v6 = v21;
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)__sendOutgoingInvitation:(void *)a3 shareURL:(void *)a4 shareToken:(uint64_t)a5 suppressHomeInviteNotification:(void *)a6 logEventBuilder:
{
  if (a1)
  {
    v11 = a6;
    v12 = a4;
    v13 = a3;
    v15 = a2;
    v14 = [v15 user];
    [a1 _cleanRemovedUsers:v14];

    [a1 _sendInvitation:v15 message:0 shareURL:v13 shareToken:v12 suppressHomeInviteNotification:a5 logEventBuilder:v11];
  }
}

- (void)_fixupUsersWithoutMergeID
{
  v3 = [(HMDHome *)self backingStore];
  v4 = [v3 context];

  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __36__HMDHome__fixupUsersWithoutMergeID__block_invoke;
  v6[3] = &unk_27868A750;
  v6[4] = self;
  v7 = v4;
  v5 = v4;
  [v5 performBlock:v6];
}

void __36__HMDHome__fixupUsersWithoutMergeID__block_invoke(uint64_t a1)
{
  v50 = *MEMORY[0x277D85DE8];
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v1 = [*(a1 + 32) users];
  v2 = [v1 countByEnumeratingWithState:&v39 objects:v49 count:16];
  if (v2)
  {
    v4 = v2;
    v5 = 0;
    v6 = *v40;
    *&v3 = 138543874;
    v35 = v3;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v40 != v6)
        {
          objc_enumerationMutation(v1);
        }

        v8 = *(*(&v39 + 1) + 8 * i);
        v9 = [v8 mergeIdentifier];

        if (!v9)
        {
          v10 = [v8 account];
          v11 = [v10 senderCorrelationIdentifier];

          if (v11)
          {
            v12 = [v8 uuid];
            v13 = [*(a1 + 40) managedObjectContext];
            v14 = [_MKFHome findHomeMemberWithUUID:v12 context:v13];

            v15 = [v10 senderCorrelationIdentifier];
            [v14 setIdsMergeIdentifier:v15];

            ++v5;
          }

          else
          {
            v16 = objc_autoreleasePoolPush();
            v17 = *(a1 + 32);
            v18 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
            {
              HMFGetLogIdentifier();
              v19 = v36 = v5;
              v20 = [v8 shortDescription];
              *buf = v35;
              v44 = v19;
              v45 = 2112;
              v46 = v20;
              v47 = 2112;
              v48 = v10;
              _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to fix up mergeID for user %@ with account %@", buf, 0x20u);

              v5 = v36;
            }

            objc_autoreleasePoolPop(v16);
          }
        }
      }

      v4 = [v1 countByEnumeratingWithState:&v39 objects:v49 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  v21 = v5;

  v22 = objc_autoreleasePoolPush();
  v23 = *(a1 + 32);
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
  {
    v25 = HMFGetLogIdentifier();
    v26 = [MEMORY[0x277CCABB0] numberWithInteger:v21];
    *buf = 138543618;
    v44 = v25;
    v45 = 2112;
    v46 = v26;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Fixing up mergeIdentifier for %@ users", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v22);
  if (v21 >= 1)
  {
    v27 = *(a1 + 40);
    v38 = 0;
    v28 = [v27 save:&v38];
    v29 = v38;
    if ((v28 & 1) == 0)
    {
      v30 = objc_autoreleasePoolPush();
      v31 = *(a1 + 32);
      v32 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        v33 = HMFGetLogIdentifier();
        *buf = 138543618;
        v44 = v33;
        v45 = 2112;
        v46 = v29;
        _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_ERROR, "%{public}@Failed to save fixup mergeID for users: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v30);
    }
  }

  v34 = *MEMORY[0x277D85DE8];
}

- (void)_auditAccessForUsers
{
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  if ([(HMDHome *)self isOwnerUser])
  {
    v4 = [(HMDHome *)self usersSupportingPresence];
    v5 = [v4 mutableCopy];

    v6 = [(HMDHome *)self owner];
    [v5 removeObject:v6];

    if ([v5 count])
    {
      v7 = objc_alloc(MEMORY[0x277D0F7A8]);
      v8 = [(HMDHome *)self workQueue];
      v9 = [v7 initWithQueue:v8];

      v14[5] = _HMFThreadLocalAsyncContextPush();
      v10 = [(HMDHome *)self homeManager];
      v11 = [v10 homeOwnerCloudShareManager];
      v12 = [v11 auditAccessForUsers:v5 home:self];
      v14[0] = MEMORY[0x277D85DD0];
      v14[1] = 3221225472;
      v14[2] = __31__HMDHome__auditAccessForUsers__block_invoke;
      v14[3] = &unk_2786868A0;
      v14[4] = self;
      v13 = [v12 then:v14];

      _HMFThreadLocalAsyncContextPop();
    }
  }
}

uint64_t __31__HMDHome__auditAccessForUsers__block_invoke(uint64_t a1, void *a2)
{
  v27 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    *buf = 138543618;
    v24 = v7;
    v25 = 2112;
    v26 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Removing users that are no longer a participant in the share: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v20 = 0u;
  v21 = 0u;
  v18 = 0u;
  v19 = 0u;
  v8 = v3;
  v9 = [v8 countByEnumeratingWithState:&v18 objects:v22 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v19;
    do
    {
      v12 = 0;
      do
      {
        if (*v19 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v18 + 1) + 8 * v12);
        v14 = [*(a1 + 32) workQueue];
        v17[0] = MEMORY[0x277D85DD0];
        v17[1] = 3221225472;
        v17[2] = __31__HMDHome__auditAccessForUsers__block_invoke_1672;
        v17[3] = &unk_27868A750;
        v17[4] = *(a1 + 32);
        v17[5] = v13;
        dispatch_async(v14, v17);

        ++v12;
      }

      while (v10 != v12);
      v10 = [v8 countByEnumeratingWithState:&v18 objects:v22 count:16];
    }

    while (v10);
  }

  v15 = *MEMORY[0x277D85DE8];
  return 1;
}

- (void)auditAccessForUsers
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __30__HMDHome_auditAccessForUsers__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

uint64_t __30__HMDHome_auditAccessForUsers__block_invoke(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Auditing shared users for home", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  result = [*(a1 + 32) _auditAccessForUsers];
  v7 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_processUnsentOutgoingInvitations
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = MEMORY[0x277CBEB18];
  v4 = [(HMDHome *)self outgoingInvitations];
  v5 = [v3 arrayWithCapacity:{objc_msgSend(v4, "count")}];

  v19 = 0u;
  v20 = 0u;
  v17 = 0u;
  v18 = 0u;
  v6 = [(HMDHome *)self outgoingInvitations];
  v7 = [v6 countByEnumeratingWithState:&v17 objects:v25 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v18;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v18 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v17 + 1) + 8 * i);
        if ([(HMDHome *)self _shouldResendOutgoingInvitation:v11])
        {
          [v5 addObject:v11];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v17 objects:v25 count:16];
    }

    while (v8);
  }

  if ([v5 count])
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v22 = v15;
      v23 = 2112;
      v24 = v5;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Resending unsent outgoing invitations %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    [(HMDHome *)v13 _grantAccessAndSendOutgoingInvitation:v5 suppressHomeInviteNotification:1];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)resendOutgoingInvitationToUser:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_resendOutgoingInvitationToUser___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __42__HMDHome_resendOutgoingInvitationToUser___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) isCurrentDeviceConfirmedPrimaryResident];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_INFO);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 40);
      *buf = 138543618;
      v17 = v7;
      v18 = 2112;
      v19 = v8;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Resending outgoing invitation (if any) to %@ as prompted by shared user's HH2 upgrade", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v9 = [*(a1 + 32) outgoingInvitationToResendForUser:*(a1 + 40)];
    v10 = v9;
    if (v9)
    {
      v11 = *(a1 + 32);
      v15 = v9;
      v12 = [MEMORY[0x277CBEA60] arrayWithObjects:&v15 count:1];
      [v11 _grantAccessAndSendOutgoingInvitation:v12 suppressHomeInviteNotification:1];
    }
  }

  else
  {
    if (v6)
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v17 = v13;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Not resending outgoing invitations as this is not the primary resident.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_grantAccessAndSendOutgoingInvitation:(id)a3 suppressHomeInviteNotification:(BOOL)a4
{
  v93 = *MEMORY[0x277D85DE8];
  v5 = a3;
  if (!v5)
  {
    _HMFPreconditionFailure();
  }

  v6 = v5;
  objc_initWeak(&location, self);
  v63 = [MEMORY[0x277D0F7C0] futureWithNoValue];
  v7 = objc_alloc(MEMORY[0x277D0F7A8]);
  v8 = [(HMDHome *)self workQueue];
  v58 = [v7 initWithQueue:v8];

  v82 = _HMFThreadLocalAsyncContextPush();
  v80[0] = 0;
  v80[1] = v80;
  v80[2] = 0x2020000000;
  v81 = 0;
  v78[0] = 0;
  v78[1] = v78;
  v78[2] = 0x2020000000;
  v79 = 0;
  v9 = [(HMDHome *)self homeManager];
  v10 = [v9 homeOwnerCloudShareManager];
  [v10 shareAgeForHome:self];
  v12 = v11;

  v13 = [MEMORY[0x277D0F8D0] sharedPreferences];
  v14 = [v13 preferenceForKey:@"migrationInvitationExpirationInterval"];
  v15 = [v14 numberValue];
  [v15 doubleValue];
  v17 = v16;

  v18 = objc_autoreleasePoolPush();
  v19 = self;
  v20 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
  {
    v21 = HMFGetLogIdentifier();
    v22 = HMFBooleanToString();
    *buf = 138544130;
    v86 = v21;
    v87 = 2048;
    v88 = v12 / 86400.0;
    v89 = 2048;
    v90 = v17 / 86400.0;
    v91 = 2112;
    v92 = v22;
    _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEFAULT, "%{public}@Home is %f days old (threshold: %f days). Too old for migration invitations? %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v18);
  v76 = 0u;
  v77 = 0u;
  v74 = 0u;
  v75 = 0u;
  obj = v6;
  v62 = [obj countByEnumeratingWithState:&v74 objects:v84 count:16];
  if (!v62)
  {
    goto LABEL_33;
  }

  v61 = *v75;
  while (2)
  {
    for (i = 0; i != v62; ++i)
    {
      if (*v75 != v61)
      {
        objc_enumerationMutation(obj);
      }

      v24 = *(*(&v74 + 1) + 8 * i);
      if (![(HMDHome *)v19 isCurrentDevicePrimaryResident])
      {
        v52 = objc_autoreleasePoolPush();
        v53 = v19;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_ERROR))
        {
          v55 = HMFGetLogIdentifier();
          *buf = 138543362;
          v86 = v55;
          _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_ERROR, "%{public}@Current device is no longer primary, aborting the sending of outgoing invitations.", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v52);
        goto LABEL_33;
      }

      v25 = [v24 isMigrationInvitation];
      if (v12 > v17)
      {
        v26 = v25;
      }

      else
      {
        v26 = 0;
      }

      if (v26 == 1)
      {
        v27 = objc_autoreleasePoolPush();
        v28 = v19;
        v29 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543618;
          v86 = v30;
          v87 = 2112;
          v88 = *&v24;
          _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Skipping migration invitation %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v27);
        v31 = [(HMDHome *)v28 backingStore];
        v32 = [v31 context];
        v73[0] = MEMORY[0x277D85DD0];
        v73[1] = 3221225472;
        v73[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke;
        v73[3] = &unk_27868A750;
        v73[4] = v24;
        v73[5] = v28;
        [v32 performBlock:v73];

        continue;
      }

      if ([v24 isMigrationInvitation])
      {
        v33 = 4;
      }

      else
      {
        v33 = 1;
      }

      v34 = [v24 shareToken];
      if (v34)
      {

LABEL_23:
        v33 |= 2uLL;
        goto LABEL_24;
      }

      v35 = [v24 dateSent];
      v36 = v35 == 0;

      if (!v36)
      {
        goto LABEL_23;
      }

LABEL_24:
      [v24 setSendAttemptCount:{objc_msgSend(v24, "sendAttemptCount") + 1}];
      v37 = objc_autoreleasePoolPush();
      v38 = v19;
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
      {
        v40 = HMFGetLogIdentifier();
        v41 = COERCE_DOUBLE([v24 sendAttemptCount]);
        *buf = 138544130;
        v86 = v40;
        v87 = 2048;
        v88 = v41;
        v89 = 2048;
        v90 = *&v24;
        v91 = 2112;
        v92 = v24;
        _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Begin shared user invitation attempt %lu %p %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v37);
      v42 = [HMDSharedUserInviteOwnerSendLogEventBuilder alloc];
      v43 = [v24 identifier];
      v44 = [v24 user];
      v45 = [v44 privilege];
      [v24 age];
      v46 = [(HMDSharedUserInviteOwnerSendLogEventBuilder *)v42 initWithHome:v38 sessionIdentifier:v43 invitationType:v45 invitationAge:v33 invitationSource:?];

      [(HMDHome *)v38 addSharedUserEventBuilder:v46];
      v47 = [MEMORY[0x277CBEAA8] now];
      [v24 setDateSent:v47];

      v48 = [(HMDHome *)v38 backingStore];
      v49 = [v48 context];
      v72[0] = MEMORY[0x277D85DD0];
      v72[1] = 3221225472;
      v72[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1663;
      v72[3] = &unk_27868A750;
      v72[4] = v24;
      v72[5] = v38;
      [v49 unsafeSynchronousBlock:v72];

      v66[0] = MEMORY[0x277D85DD0];
      v66[1] = 3221225472;
      v66[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1664;
      v66[3] = &unk_278670240;
      objc_copyWeak(v70, &location);
      v66[4] = v24;
      v50 = v46;
      v71 = a4;
      v67 = v50;
      v68 = v80;
      v70[1] = v33;
      v69 = v78;
      v51 = [v63 then:v66];

      objc_destroyWeak(v70);
      v63 = v51;
    }

    v62 = [obj countByEnumeratingWithState:&v74 objects:v84 count:16];
    if (v62)
    {
      continue;
    }

    break;
  }

LABEL_33:

  v64[0] = MEMORY[0x277D85DD0];
  v64[1] = 3221225472;
  v64[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1670;
  v64[3] = &unk_278670268;
  objc_copyWeak(&v65, &location);
  v64[4] = v80;
  v64[5] = v78;
  v56 = [v63 then:v64];
  objc_destroyWeak(&v65);
  _Block_object_dispose(v78, 8);
  _Block_object_dispose(v80, 8);
  _HMFThreadLocalAsyncContextPop();

  objc_destroyWeak(&location);
  v57 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) identifier];
  v3 = [HMCContext findOutgoingInvitationWithModelID:v2];

  if (v3)
  {
    v4 = +[HMDHomeInvitation noRetryDate];
    [v3 setDateSent:v4];

    v5 = +[HMCContext currentContext];
    [v5 save];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 32) identifier];
      v12 = 138543618;
      v13 = v9;
      v14 = 2112;
      v15 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to find outgoing invitation with UUID %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1663(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) identifier];
  v3 = [HMCContext findOutgoingInvitationWithModelID:v2];

  if (v3)
  {
    v4 = [*(a1 + 32) dateSent];
    [v3 setDateSent:v4];

    v5 = +[HMCContext currentContext];
    [v5 save];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 32) identifier];
      v12 = 138543618;
      v13 = v9;
      v14 = 2112;
      v15 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to find outgoing invitation with UUID %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
}

uint64_t __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1664(uint64_t a1, void *a2)
{
  v61 = *MEMORY[0x277D85DE8];
  v40 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v51 = 0;
  v52 = &v51;
  v53 = 0x3032000000;
  v54 = __Block_byref_object_copy__14759;
  v55 = __Block_byref_object_dispose__14760;
  v56 = 0;
  v4 = [WeakRetained backingStore];
  v5 = [v4 context];
  v50[0] = MEMORY[0x277D85DD0];
  v50[1] = 3221225472;
  v50[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_2;
  v50[3] = &unk_27868A4D8;
  v50[4] = *(a1 + 32);
  v50[5] = WeakRetained;
  v50[6] = &v51;
  [v5 unsafeSynchronousBlock:v50];

  v6 = [v52[5] shareURL];

  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [*(a1 + 32) user];
      *buf = 138543618;
      v58 = v10;
      v59 = 2112;
      v60 = v11;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Resending invite, user already granted access %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    [*(a1 + 40) markUserAlreadyAddedToShare];
    v12 = *(a1 + 32);
    v13 = [v52[5] shareURL];
    [(HMDHome *)v8 __sendOutgoingInvitation:v12 shareURL:v13 shareToken:v52[5] suppressHomeInviteNotification:*(a1 + 80) logEventBuilder:*(a1 + 40)];
    v14 = 1;
  }

  else
  {
    v15 = v52[5];
    if (v15)
    {
      v16 = [v15 shareURL];
      v17 = v16 == 0;

      if (v17)
      {
        v18 = objc_autoreleasePoolPush();
        v19 = WeakRetained;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
        {
          v21 = HMFGetLogIdentifier();
          v22 = [*(a1 + 32) user];
          *buf = 138543618;
          v58 = v21;
          v59 = 2112;
          v60 = v22;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@nil shareURL on share token, will attempt to re-grant access for user: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
      }
    }

    v23 = objc_autoreleasePoolPush();
    v24 = WeakRetained;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      v27 = [*(a1 + 32) user];
      *buf = 138543618;
      v58 = v26;
      v59 = 2112;
      v60 = v27;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Granting share access for user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    v13 = [v24 homeManager];
    v28 = [v13 homeOwnerCloudShareManager];
    v29 = [*(a1 + 32) user];
    v30 = [v28 grantAccessForUser:v29 home:v24 logEventBuilder:*(a1 + 40)];
    v45[0] = MEMORY[0x277D85DD0];
    v45[1] = 3221225472;
    v45[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1665;
    v45[3] = &unk_2786701F0;
    objc_copyWeak(v48, (a1 + 64));
    v31 = *(a1 + 40);
    v32 = *(a1 + 32);
    v46 = v31;
    v47 = v32;
    v48[1] = *(a1 + 72);
    v49 = *(a1 + 80);
    v41[0] = MEMORY[0x277D85DD0];
    v41[1] = 3221225472;
    v41[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1668;
    v41[3] = &unk_278670218;
    objc_copyWeak(&v44, (a1 + 64));
    v33 = *(a1 + 56);
    v41[4] = *(a1 + 32);
    v43 = v33;
    v39 = *(a1 + 40);
    v34 = v39;
    v42 = v39;
    v35 = [v30 then:v45 orRecover:v41];
    if (!v35)
    {
      _HMFPreconditionFailure();
      __break(1u);
    }

    v36 = v35;

    objc_destroyWeak(&v44);
    objc_destroyWeak(v48);

    v14 = 3;
  }

  _Block_object_dispose(&v51, 8);
  v37 = *MEMORY[0x277D85DE8];
  return v14;
}

uint64_t __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1670(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained && *(*(*(a1 + 32) + 8) + 24) == 1)
  {
    if (*(*(*(a1 + 40) + 8) + 24))
    {
      v5 = 60.0;
    }

    else
    {
      v5 = 300.0;
    }

    v6 = objc_autoreleasePoolPush();
    v7 = WeakRetained;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v17 = v9;
      v18 = 2048;
      v19 = v5;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@At least one invite appears to have not been sent, scheduling resend in %f", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v10 = dispatch_time(0, (v5 * 1000000000.0));
    v11 = [v7 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1671;
    block[3] = &unk_278686B80;
    objc_copyWeak(&v15, (a1 + 48));
    dispatch_after(v10, v11, block);

    objc_destroyWeak(&v15);
  }

  v12 = *MEMORY[0x277D85DE8];
  return 1;
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1671(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _processUnsentOutgoingInvitations];
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_2(uint64_t a1)
{
  v17 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) identifier];
  v3 = [HMCContext findOutgoingInvitationWithModelID:v2];

  if (v3)
  {
    v4 = [v3 shareToken];
    v5 = *(*(a1 + 48) + 8);
    v6 = *(v5 + 40);
    *(v5 + 40) = v4;
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 40);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [*(a1 + 32) identifier];
      v13 = 138543618;
      v14 = v10;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Unable to find outgoing invitation with UUID %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v12 = *MEMORY[0x277D85DE8];
}

uint64_t __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1665(uint64_t a1, void *a2)
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v5 = [v3 token];
    v6 = v5;
    if (v5 && ([v5 shareURL], v7 = objc_claimAutoreleasedReturnValue(), v7, v7))
    {
      v8 = [WeakRetained backingStore];
      v9 = [v8 context];
      v32[0] = MEMORY[0x277D85DD0];
      v32[1] = 3221225472;
      v32[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1666;
      v32[3] = &unk_27868A010;
      v32[4] = *(a1 + 40);
      v32[5] = WeakRetained;
      v33 = v6;
      [v9 unsafeSynchronousBlock:v32];

      v10 = [WeakRetained isCurrentDevicePrimaryResident];
      v11 = objc_autoreleasePoolPush();
      v12 = WeakRetained;
      v13 = HMFGetOSLogHandle();
      v14 = v13;
      if (v10)
      {
        if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
        {
          v15 = HMFGetLogIdentifier();
          v16 = [*(a1 + 40) user];
          *buf = 138543618;
          v35 = v15;
          v36 = 2112;
          v37 = v16;
          _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Sending outgoing invite for user %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v11);
        v17 = *(a1 + 40);
        v18 = [v3 url];
        v19 = [v3 token];
        [(HMDHome *)v12 __sendOutgoingInvitation:v17 shareURL:v18 shareToken:v19 suppressHomeInviteNotification:*(a1 + 64) logEventBuilder:*(a1 + 32)];
      }

      else
      {
        if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
        {
          v27 = HMFGetLogIdentifier();
          *buf = 138543362;
          v35 = v27;
          _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Current device is no longer primary after granting share access, do not send outgoing invitation from here.", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v11);
        v28 = *(a1 + 32);
        if ((*(a1 + 56) & 2) != 0)
        {
          [*(a1 + 32) cancel];
        }

        else
        {
          v29 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3202];
          [v28 markError:v29];
        }
      }
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      v21 = WeakRetained;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        v24 = [v6 shareURL];
        *buf = 138543874;
        v35 = v23;
        v36 = 2112;
        v37 = v6;
        v38 = 2112;
        v39 = v24;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Nil token (%@) and/or shareURL (%@) on share invitation, not saving token, not sending outgoing invitation", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v20);
      v25 = *(a1 + 32);
      v26 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3501];
      [v25 markError:v26];
    }
  }

  else
  {
    [*(a1 + 32) cancel];
  }

  v30 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1668(uint64_t a1, void *a2)
{
  v28 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if ([*(a1 + 32) shouldRetrySendingInvitationForError:v3])
  {
    *(*(*(a1 + 48) + 8) + 24) = 1;
    if (([*(a1 + 32) isMigrationInvitation] & 1) == 0)
    {
      *(*(*(a1 + 56) + 8) + 24) = 1;
    }
  }

  else if (([*(a1 + 32) isMigrationInvitation] & 1) == 0)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 32);
      *buf = 138543618;
      v23 = v8;
      v24 = 2112;
      v25 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Will not retry anymore invitation %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = [v6 backingStore];
    v11 = [v10 context];
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1669;
    v21[3] = &unk_27868A750;
    v21[4] = *(a1 + 32);
    v21[5] = v6;
    [v11 unsafeSynchronousBlock:v21];
  }

  v12 = objc_autoreleasePoolPush();
  v13 = WeakRetained;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
  {
    v15 = HMFGetLogIdentifier();
    v16 = [*(a1 + 32) user];
    *buf = 138543874;
    v23 = v15;
    v24 = 2112;
    v25 = v16;
    v26 = 2112;
    v27 = v3;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to add user %@ to share with error %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v12);
  v17 = *(a1 + 40);
  v18 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3502 underlyingError:v3];
  [v17 markError:v18];

  v19 = *MEMORY[0x277D85DE8];
  return 1;
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1669(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) identifier];
  v3 = [HMCContext findOutgoingInvitationWithModelID:v2];

  if (v3)
  {
    v4 = +[HMDHomeInvitation noRetryDate];
    [v3 setDateSent:v4];

    v5 = +[HMCContext currentContext];
    [v5 save];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 32) identifier];
      v12 = 138543618;
      v13 = v9;
      v14 = 2112;
      v15 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to find outgoing invitation with UUID %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome__grantAccessAndSendOutgoingInvitation_suppressHomeInviteNotification___block_invoke_1666(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) identifier];
  v3 = [HMCContext findOutgoingInvitationWithModelID:v2];

  if (v3)
  {
    [v3 setShareToken:*(a1 + 48)];
    v4 = +[HMCContext currentContext];
    [v4 save];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 40);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 32) identifier];
      v11 = 138543618;
      v12 = v8;
      v13 = 2112;
      v14 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@After granting share, unable to find outgoing invitation with UUID %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveOutgoingHomeInvitationModel:(id)a3 message:(id)a4
{
  v12 = a4;
  v6 = [a3 uuid];
  v7 = [(HMDHome *)self outgoingInvitationWithUUID:v6];

  if (v7)
  {
    [(HMDHome *)self removeOutgoingInvitation:v7];
    v8 = [v12 transactionResult];
    [v8 markChanged];
    v9 = [v7 user];
    v10 = [v9 uuid];
    v11 = [(HMDHome *)self userWithUUID:v10];

    if (v11)
    {
      [(HMDHome *)self __handleCompletedOutgoingInvitation:v7];
    }

    else
    {
      if ([v8 source] == 2 || objc_msgSend(v8, "source") == 3)
      {
        [v7 cancel];
      }

      else
      {
        [(HMDHome *)self __handleCancelledOutgoingInvitation:v7];
      }

      [v7 updateInvitationState:1];
    }
  }

  [v12 respondWithPayload:0];
}

- (void)_handleAddOutgoingHomeInvitationModel:(id)a3 message:(id)a4
{
  v44 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 uuid];
  v9 = [(HMDHome *)self outgoingInvitationWithUUID:v8];

  if (!v9)
  {
    v10 = [(HMDHome *)self userFromOutgoingInvitationModel:v6];
    [v10 refreshDisplayName];
    v11 = [HMDOutgoingHomeInvitation alloc];
    v12 = [v6 uuid];
    v13 = [v6 invitationState];
    v14 = [v13 integerValue];
    v15 = [v6 expiryDate];
    v16 = [(HMDOutgoingHomeInvitation *)v11 initWithUUID:v12 invitee:v10 invitationState:v14 forHome:self expiryDate:v15 messageIdentifier:0];

    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138544130;
      v37 = v20;
      v38 = 2112;
      v39 = v10;
      v40 = 2112;
      v41 = 0;
      v42 = 2112;
      v43 = v16;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Created user [%@] from outgoing invitation: %@ / %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v17);
    v21 = objc_alloc(MEMORY[0x277D0F818]);
    v22 = [MEMORY[0x277D0F820] allMessageDestinations];
    v23 = [v21 initWithName:@"kTransactionUpdate" destination:v22 payload:0];
    [(HMDOutgoingHomeInvitation *)v16 transactionObjectUpdated:0 newValues:v6 message:v23];

    v24 = [(HMDHome *)v18 workQueue];
    [(HMDHomeInvitation *)v16 setClientQueue:v24];

    objc_initWeak(buf, v18);
    objc_initWeak(&location, v16);
    v28 = MEMORY[0x277D85DD0];
    v29 = 3221225472;
    v30 = __57__HMDHome__handleAddOutgoingHomeInvitationModel_message___block_invoke;
    v31 = &unk_278687590;
    objc_copyWeak(&v33, buf);
    objc_copyWeak(&v34, &location);
    v25 = v7;
    v32 = v25;
    [(HMDHomeInvitation *)v16 setExpirationHandler:&v28];
    [(HMDHome *)v18 addOutgoingInvitation:v16, v28, v29, v30, v31];
    [(HMDHome *)v18 _cleanRemovedUsers:v10];
    v26 = [v25 transactionResult];
    [v26 markChanged];

    objc_destroyWeak(&v34);
    objc_destroyWeak(&v33);
    objc_destroyWeak(&location);
    objc_destroyWeak(buf);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome__handleAddOutgoingHomeInvitationModel_message___block_invoke(id *a1)
{
  v15 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 5);
  v3 = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = WeakRetained;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [v3 identifier];
      v11 = 138543618;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Expiring invitation %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [v5 removeOutgoingInvitation:v3];
    [v5 __handleCancelledOutgoingInvitation:v3];
    [v3 updateInvitationState:{objc_msgSend(v3, "invitationState")}];
    v9 = [a1[4] name];
    [v5 saveWithReason:v9 postSyncNotification:0];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (id)userFromOutgoingInvitationModel:(id)a3
{
  v38 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 pendingUserUUID];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = MEMORY[0x277CCABB0];
    v11 = [(HMDHome *)v7 pendingUsers];
    v12 = [v10 numberWithUnsignedInteger:{objc_msgSend(v11, "count")}];
    v30 = 138544130;
    v31 = v9;
    v32 = 2112;
    v33 = v5;
    v34 = 2112;
    v35 = v12;
    v36 = 2112;
    v37 = v4;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@pending User UUID : %@ / %@ / %@", &v30, 0x2Au);
  }

  objc_autoreleasePoolPop(v6);
  if (v5)
  {
    v13 = objc_autoreleasePoolPush();
    v14 = v7;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v30 = 138543618;
      v31 = v16;
      v32 = 2112;
      v33 = v5;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Going to find existing pending user with UUID: %@", &v30, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [(HMDHome *)v14 pendingUsers];
    v18 = [v17 hmf_firstObjectWithUUID:v5];

    v19 = objc_autoreleasePoolPush();
    v20 = v14;
    v21 = HMFGetOSLogHandle();
    v22 = v21;
    if (v18)
    {
      if (!os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        goto LABEL_15;
      }

      v23 = HMFGetLogIdentifier();
      v30 = 138543618;
      v31 = v23;
      v32 = 2112;
      v33 = v18;
      v24 = "%{public}@Found the pending user from the list. Going to use it : %@";
      goto LABEL_14;
    }

    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      v30 = 138543618;
      v31 = v25;
      v32 = 2112;
      v33 = v5;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Did not find existing pending user with UUID: %@. Will go ahead and create a brand new user with random UUID", &v30, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
  }

  v26 = [v4 user];
  v18 = [HMDUser userWithDictionary:v26];

  [v18 setHome:v7];
  v19 = objc_autoreleasePoolPush();
  v27 = v7;
  v22 = HMFGetOSLogHandle();
  if (!os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
  {
    goto LABEL_15;
  }

  v23 = HMFGetLogIdentifier();
  v30 = 138543618;
  v31 = v23;
  v32 = 2112;
  v33 = v18;
  v24 = "%{public}@No Pending user found for the invite. Creating a brand new user : %@";
LABEL_14:
  _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, v24, &v30, 0x16u);

LABEL_15:
  objc_autoreleasePoolPop(v19);

  v28 = *MEMORY[0x277D85DE8];

  return v18;
}

- (void)_handleUserInvitations:(id)a3
{
  v96[2] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self residentDeviceManager];
  v6 = [v5 availableResidentDevices];
  v7 = [v6 count];

  if (!v7)
  {
    v46 = objc_autoreleasePoolPush();
    v47 = self;
    v48 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
    {
      v49 = HMFGetLogIdentifier();
      *buf = 138543362;
      v91 = v49;
      _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_ERROR, "%{public}@Failed to invite user(s), no resident devices in home", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v46);
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    [v4 respondWithError:v8];
    goto LABEL_47;
  }

  v8 = [v4 dataForKey:*MEMORY[0x277CD06B8]];
  if (!v8)
  {
    v50 = objc_autoreleasePoolPush();
    v51 = self;
    v52 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
    {
      v53 = HMFGetLogIdentifier();
      v54 = [v4 messagePayload];
      *buf = 138543618;
      v91 = v53;
      v92 = 2112;
      v93 = v54;
      _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@Failed to send invitations, missing user invite information: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v50);
    v14 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    [v4 respondWithError:v14];
    goto LABEL_46;
  }

  v9 = MEMORY[0x277CCAAC8];
  v10 = MEMORY[0x277CBEB98];
  v96[0] = objc_opt_class();
  v96[1] = objc_opt_class();
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v96 count:2];
  v12 = [v10 setWithArray:v11];
  v88 = 0;
  v13 = [v9 unarchivedObjectOfClasses:v12 fromData:v8 error:&v88];
  v14 = v88;

  v15 = objc_autoreleasePoolPush();
  v16 = self;
  v17 = HMFGetOSLogHandle();
  v18 = v17;
  if (!v13)
  {
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v55 = HMFGetLogIdentifier();
      *buf = 138543618;
      v91 = v55;
      v92 = 2112;
      v93 = v14;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode user invite information: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    v56 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    [v4 respondWithError:v56];
    goto LABEL_36;
  }

  v81 = v14;
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    v20 = [(HMDHome *)v16 users];
    v21 = [v20 count];
    *buf = 138543874;
    v91 = v19;
    v92 = 2048;
    v93 = v21;
    v94 = 2048;
    v95 = maximumUsersPerHome;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Adding users; current user count is %ld and max is %ld", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  v22 = [(HMDHome *)v16 users];
  v23 = [v22 count];
  v24 = v13;
  v25 = [v13 count] + v23;
  v26 = maximumUsersPerHome;

  if (v25 >= v26)
  {
    v13 = v24;
    v57 = objc_autoreleasePoolPush();
    v58 = v16;
    v59 = HMFGetOSLogHandle();
    v14 = v81;
    if (os_log_type_enabled(v59, OS_LOG_TYPE_INFO))
    {
      v60 = HMFGetLogIdentifier();
      *buf = 138543362;
      v91 = v60;
      _os_log_impl(&dword_229538000, v59, OS_LOG_TYPE_INFO, "%{public}@Can't add users; already at maximum users for home", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v57);
    v56 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:49 userInfo:0];
    v61 = [v4 responseHandler];
    (v61)[2](v61, v56, 0);

LABEL_36:
    goto LABEL_45;
  }

  v79 = v24;
  v80 = v4;
  v86 = 0u;
  v87 = 0u;
  v84 = 0u;
  v85 = 0u;
  obj = v24;
  v27 = [obj countByEnumeratingWithState:&v84 objects:v89 count:16];
  if (!v27)
  {
    goto LABEL_23;
  }

  v28 = v27;
  v29 = *v85;
  v78 = v8;
  while (2)
  {
    for (i = 0; i != v28; ++i)
    {
      if (*v85 != v29)
      {
        objc_enumerationMutation(obj);
      }

      v31 = *(*(&v84 + 1) + 8 * i);
      v32 = objc_autoreleasePoolPush();
      v33 = v16;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543618;
        v91 = v35;
        v92 = 2112;
        v93 = v31;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Processing invite information : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v32);
      v36 = [v31 userID];
      v37 = [(HMDHome *)v33 users];
      v38 = [v37 hmf_firstObjectWithValue:v36 forKeyPath:@"userID"];

      if (v38)
      {
        v62 = objc_autoreleasePoolPush();
        v63 = v33;
        v64 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v64, OS_LOG_TYPE_INFO))
        {
          v65 = HMFGetLogIdentifier();
          *buf = 138543618;
          v91 = v65;
          v92 = 2112;
          v93 = v36;
          v66 = "%{public}@Failed to invite user %@ since the user is already part of the home";
LABEL_41:
          _os_log_impl(&dword_229538000, v64, OS_LOG_TYPE_INFO, v66, buf, 0x16u);
        }

LABEL_42:

        objc_autoreleasePoolPop(v62);
        v67 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:1 userInfo:0];
        v4 = v80;
        v68 = [v80 responseHandler];
        v68[2](v68, v67, 0);

        goto LABEL_43;
      }

      v39 = [(HMDHome *)v33 outgoingInvitations];
      v38 = [v39 hmf_firstObjectWithValue:v36 forKeyPath:@"user.userID"];

      if (v38)
      {
        v62 = objc_autoreleasePoolPush();
        v63 = v33;
        v64 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v64, OS_LOG_TYPE_INFO))
        {
          v65 = HMFGetLogIdentifier();
          *buf = 138543618;
          v91 = v65;
          v92 = 2112;
          v93 = v36;
          v66 = "%{public}@Failed to invite user %@ since the user is already invited to the home";
          goto LABEL_41;
        }

        goto LABEL_42;
      }

      if ([v31 isAdministrator] && !-[HMDHome isResidentSupported](v33, "isResidentSupported"))
      {
        v70 = objc_autoreleasePoolPush();
        v71 = v33;
        v72 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v72, OS_LOG_TYPE_INFO))
        {
          v73 = HMFGetLogIdentifier();
          *buf = 138543618;
          v91 = v73;
          v92 = 2112;
          v93 = v36;
          _os_log_impl(&dword_229538000, v72, OS_LOG_TYPE_INFO, "%{public}@Cannot invite admin user %@ because it requires a resident", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v70);
        v38 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:48 userInfo:0];
        v4 = v80;
        v67 = [v80 responseHandler];
        (v67)[2](v67, v38, 0);
LABEL_43:

LABEL_44:
        v14 = v81;
        v13 = v79;

        v8 = v78;
        goto LABEL_45;
      }

      if ([v31 isRestrictedGuest])
      {
        v40 = [v31 restrictedGuestHomeAccessSettings];
        v41 = [v40 identifiersOfAccessAllowedToAccessories];
        v42 = [v41 count];

        if (v42)
        {
          v43 = [v31 restrictedGuestHomeAccessSettings];
          v44 = [v43 identifiersOfAccessAllowedToAccessories];
          v83[0] = MEMORY[0x277D85DD0];
          v83[1] = 3221225472;
          v83[2] = __34__HMDHome__handleUserInvitations___block_invoke;
          v83[3] = &unk_27868A1B0;
          v83[4] = v33;
          v45 = [v44 na_all:v83];

          if ((v45 & 1) == 0)
          {
            v74 = objc_autoreleasePoolPush();
            v75 = v33;
            v76 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v76, OS_LOG_TYPE_ERROR))
            {
              v77 = HMFGetLogIdentifier();
              *buf = 138543362;
              v91 = v77;
              _os_log_impl(&dword_229538000, v76, OS_LOG_TYPE_ERROR, "%{public}@Failed to invite guest user as could not find all the accessories in the home.", buf, 0xCu);
            }

            objc_autoreleasePoolPop(v74);
            v38 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2903];
            v4 = v80;
            [v80 respondWithError:v38];
            goto LABEL_44;
          }
        }
      }
    }

    v28 = [obj countByEnumeratingWithState:&v84 objects:v89 count:16];
    v8 = v78;
    if (v28)
    {
      continue;
    }

    break;
  }

LABEL_23:

  v4 = v80;
  [(HMDHome *)v16 _addUsersWithInviteInformations:obj message:v80];
  v14 = v81;
  v13 = v79;
LABEL_45:

LABEL_46:
LABEL_47:

  v69 = *MEMORY[0x277D85DE8];
}

BOOL __34__HMDHome__handleUserInvitations___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = [*(a1 + 32) accessoryWithUUID:a2];
  v3 = v2 != 0;

  return v3;
}

- (void)_cleanRemovedUsers:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277CBEB18] array];
  os_unfair_recursive_lock_lock_with_options();
  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  v6 = self->_removedUsers;
  v7 = [(NSMutableArray *)v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v7)
  {
    v8 = *v13;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(v6);
        }

        v10 = *(*(&v12 + 1) + 8 * i);
        if ([v10 isEqualToUser:{v4, v12}])
        {
          [v5 addObject:v10];
        }
      }

      v7 = [(NSMutableArray *)v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v7);
  }

  [(NSMutableArray *)self->_removedUsers removeObjectsInArray:v5];
  os_unfair_recursive_lock_unlock();

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_addAllUsersToAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self users];
  [(HMDHome *)self _addUsers:v5 accessory:v4];
}

- (void)removeAllUsersAndCloudDataFromAccessory:(id)a3 completionHandler:(id)a4
{
  v37 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self isOwnerUser];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v8)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v34 = v13;
      v35 = 2112;
      v36 = v6;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Removing cloud data from primary accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = v6;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;

    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    v17 = [v16 identifiersForBridgedAccessories];
    v18 = [v17 countByEnumeratingWithState:&v28 objects:v32 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = *v29;
      do
      {
        v21 = 0;
        do
        {
          if (*v29 != v20)
          {
            objc_enumerationMutation(v17);
          }

          v22 = [(HMDHome *)v10 accessoryWithUUID:*(*(&v28 + 1) + 8 * v21)];
          [v22 removeCloudData];

          ++v21;
        }

        while (v19 != v21);
        v19 = [v17 countByEnumeratingWithState:&v28 objects:v32 count:16];
      }

      while (v19);
    }

    [v14 removeCloudData];
    v23 = objc_autoreleasePoolPush();
    [HMDBackgroundOperationManagerHelper removeAllUsersFromAccessory:v14 withCompletionHandler:v7];
    objc_autoreleasePoolPop(v23);
  }

  else
  {
    if (v12)
    {
      v24 = HMFGetLogIdentifier();
      v25 = [v6 shortDescription];
      *buf = 138543618;
      v34 = v24;
      v35 = 2112;
      v36 = v25;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Not owner of home - bypassing removing users from accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v26 = _Block_copy(v7);
    v16 = v26;
    if (v26)
    {
      (*(v26 + 2))(v26);
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isUserValid:(id)a3 error:(id *)a4
{
  v24 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = v6;
  if (!v6)
  {
    if (a4)
    {
      v10 = MEMORY[0x277CCA9B8];
      v11 = @"Missing required parameter to validate user";
      v12 = 3;
LABEL_10:
      [v10 hmErrorWithCode:v12 description:v11 reason:0 suggestion:0];
      *a4 = v9 = 0;
      goto LABEL_12;
    }

LABEL_11:
    v9 = 0;
    goto LABEL_12;
  }

  v8 = [v6 pairingIdentity];

  if (!v8)
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v7 userID];
      v20 = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = v17;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Invalid user '%@', missing either pairing username or public key", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    if (a4)
    {
      v10 = MEMORY[0x277CCA9B8];
      v11 = @"Invalid user information";
      v12 = 21;
      goto LABEL_10;
    }

    goto LABEL_11;
  }

  v9 = 1;
LABEL_12:

  v18 = *MEMORY[0x277D85DE8];
  return v9;
}

- (BOOL)_verifyUserManagementPermissionForAccessory:(id)a3 error:(id *)a4
{
  v31 = *MEMORY[0x277D85DE8];
  v6 = a3;
  if (![(HMDHome *)self isAdminUser])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543362;
      v28 = v11;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_DEFAULT, "%{public}@Non administrator cannot perform user management", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    if (a4)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:17 description:@"Must be administrator to perform user management" reason:0 suggestion:0];
      *a4 = v7 = 0;
      goto LABEL_13;
    }

LABEL_12:
    v7 = 0;
    goto LABEL_13;
  }

  if (([v6 supportsUserManagement] & 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v6 name];
      *buf = 138543618;
      v28 = v15;
      v29 = 2112;
      v30 = v16;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Cannot perform user management on '%@' since it is does not support user management operations", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    if (a4)
    {
      v25[0] = *MEMORY[0x277CCA450];
      v17 = MEMORY[0x277CCACA8];
      v18 = [v6 name];
      v19 = [v17 stringWithFormat:@"Cannot perform user management on '%@'", v18];
      v26[0] = v19;
      v25[1] = *MEMORY[0x277CCA470];
      v20 = [MEMORY[0x277CCA8D8] mainBundle];
      v21 = [v20 localizedStringForKey:@"Accessory is not a primary accessory." value:&stru_283CF9D50 table:0];
      v26[1] = v21;
      v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v26 forKeys:v25 count:2];

      *a4 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:48 userInfo:v22];
    }

    goto LABEL_12;
  }

  v7 = 1;
LABEL_13:

  v23 = *MEMORY[0x277D85DE8];
  return v7;
}

- (void)_purgeResidentUsers
{
  v2 = self;
  v33 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self residentCapableDevices];
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v4 = [(HMDHome *)v2 _residentUsers];
  v5 = [v4 copy];

  v23 = [v5 countByEnumeratingWithState:&v24 objects:v32 count:16];
  if (v23)
  {
    v7 = *v25;
    p_superclass = HMDIDSActivityRegistrationModel.superclass;
    *&v6 = 138543618;
    v21 = v6;
    v22 = *v25;
    do
    {
      for (i = 0; i != v23; ++i)
      {
        if (*v25 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v24 + 1) + 8 * i);
        v11 = [v10 userID];
        v12 = [p_superclass + 324 deviceWithDestination:v11];

        if (v12 && [v3 containsObject:v12])
        {
          v13 = objc_autoreleasePoolPush();
          v14 = v2;
          v15 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v16 = v5;
            v17 = v3;
            v19 = v18 = v2;
            *buf = v21;
            v29 = v19;
            v30 = 2112;
            v31 = v10;
            _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Removing non-legacy resident user from home: %@", buf, 0x16u);

            v2 = v18;
            v3 = v17;
            v5 = v16;
            v7 = v22;
          }

          objc_autoreleasePoolPop(v13);
          [(HMDHome *)v14 _removeUser:v10];
          p_superclass = (HMDIDSActivityRegistrationModel + 8);
        }
      }

      v23 = [v5 countByEnumeratingWithState:&v24 objects:v32 count:16];
    }

    while (v23);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientsOfUpdatedResidentUser:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self _residentDeviceForResidentUser:v4];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v10;
      v17 = 2112;
      v18 = v4;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Notifying clients of updated remote access gateway: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v11 = [(HMDHome *)v7 homeManager];
    v12 = [v5 identifier];
    [v11 updateGenerationCounterWithReason:@"ResidentUserUpdated" sourceUUID:v12 shouldNotifyClients:1];
  }

  else
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = v4;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to find resident for resident user: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)_residentDeviceForResidentUser:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 device];
  if (v5)
  {
    v6 = [HMDResidentDevice alloc];
    v7 = [v4 uuid];
    v8 = [(HMDResidentDevice *)v6 initWithDevice:v5 identifier:v7];

    if (-[HMDHome isResidentSupported](self, "isResidentSupported") || [v4 configurationState] != 2)
    {
      [(HMDResidentDevice *)v8 setEnabled:0];
    }

    v9 = [(HMDHome *)self homeManager];
    v10 = [v9 messageDispatcher];
    v11 = [v10 remoteAccessDeviceForHome:self];

    if (([v11 isEqual:v5] & 1) == 0)
    {
      [(HMDResidentDevice *)v8 setReachable:0];
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = v4;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Unable to find matching device for resident user: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v8 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v8;
}

- (id)_residentUserForResidentDevice:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self owner];
  v6 = [v5 pairingIdentity];

  if (v6)
  {
    v7 = [v4 device];
    if (v7)
    {
      v8 = objc_alloc(MEMORY[0x277CFEC20]);
      v9 = [v7 identifier];
      v10 = [v9 UUIDString];
      v11 = [v6 publicKey];
      v12 = [v6 privateKey];
      v13 = [v8 initWithIdentifier:v10 publicKey:v11 privateKey:v12 permissions:{objc_msgSend(v6, "permissions")}];

      if ([v4 isEnabled])
      {
        v14 = 2;
      }

      else
      {
        v14 = 3;
      }

      v15 = [HMDResidentUser alloc];
      v16 = [v4 home];
      v17 = [(HMDResidentUser *)v15 initWithDevice:v7 home:v16 pairingIdentity:v13 configurationState:v14];

      [(HMDUser *)v17 setHome:self];
      if ([(HMDResidentUser *)v17 isBlocked])
      {
        [(HMDResidentUser *)v17 setConfigurationState:3];
      }
    }

    else
    {
      v17 = 0;
    }
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
    {
      v21 = HMFGetLogIdentifier();
      v24 = 138543618;
      v25 = v21;
      v26 = 2112;
      v27 = v4;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to retrieve owner's pairing identity to create legacy resident user for device: %@", &v24, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
    v17 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v17;
}

- (id)userWithMergeID:(id)a3
{
  v43 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (!v4)
  {
    goto LABEL_13;
  }

  v34 = 0u;
  v35 = 0u;
  v32 = 0u;
  v33 = 0u;
  v5 = [(HMDHome *)self users];
  v6 = [v5 countByEnumeratingWithState:&v32 objects:v42 count:16];
  if (!v6)
  {
    goto LABEL_12;
  }

  v7 = v6;
  v8 = *v33;
  v31 = self;
  while (2)
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v33 != v8)
      {
        objc_enumerationMutation(v5);
      }

      v10 = *(*(&v32 + 1) + 8 * i);
      v11 = [v10 account];
      v12 = [v11 senderCorrelationIdentifier];
      v13 = [v12 isEqualToString:v4];

      if (v13)
      {
        v23 = objc_autoreleasePoolPush();
        v24 = v31;
        v25 = v31;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
        {
LABEL_20:
          v28 = HMFGetLogIdentifier();
          *buf = 138543874;
          v37 = v28;
          v38 = 2112;
          v39 = v4;
          v40 = 2112;
          v41 = v10;
          _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_DEBUG, "%{public}@Found user with mergeID %@: %@", buf, 0x20u);
        }

LABEL_21:

        objc_autoreleasePoolPop(v23);
        v22 = v10;

        goto LABEL_22;
      }

      v14 = [v10 mergeIdentifier];
      if ([v14 isEqual:v4])
      {

LABEL_19:
        v23 = objc_autoreleasePoolPush();
        v24 = v31;
        v27 = v31;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
        {
          goto LABEL_20;
        }

        goto LABEL_21;
      }

      v15 = [v10 accountIdentifier];
      v16 = [v15 senderCorrelationIdentifier];
      v17 = [v16 isEqual:v4];

      if (v17)
      {
        goto LABEL_19;
      }
    }

    v7 = [v5 countByEnumeratingWithState:&v32 objects:v42 count:16];
    self = v31;
    if (v7)
    {
      continue;
    }

    break;
  }

LABEL_12:

LABEL_13:
  v18 = objc_autoreleasePoolPush();
  v19 = self;
  v20 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
  {
    v21 = HMFGetLogIdentifier();
    *buf = 138543618;
    v37 = v21;
    v38 = 2112;
    v39 = v4;
    _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEBUG, "%{public}@No user found with mergeID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v18);
  v22 = 0;
LABEL_22:

  v29 = *MEMORY[0x277D85DE8];

  return v22;
}

- (id)userWithPairingIdentityIdentifier:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4)
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    v5 = [(HMDHome *)self users];
    v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v6)
    {
      v7 = *v13;
      while (2)
      {
        for (i = 0; i != v6; i = i + 1)
        {
          if (*v13 != v7)
          {
            objc_enumerationMutation(v5);
          }

          v9 = *(*(&v12 + 1) + 8 * i);
          if ([v9 matchingPairingIdentityIdentifier:v4])
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
        if (v6)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  else
  {
    v6 = 0;
  }

  v10 = *MEMORY[0x277D85DE8];

  return v6;
}

- (id)userWithPairingIdentity:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4)
  {
    v16 = 0u;
    v17 = 0u;
    v14 = 0u;
    v15 = 0u;
    v5 = [(HMDHome *)self users];
    v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
    if (v6)
    {
      v7 = *v15;
      while (2)
      {
        for (i = 0; i != v6; i = i + 1)
        {
          if (*v15 != v7)
          {
            objc_enumerationMutation(v5);
          }

          v9 = *(*(&v14 + 1) + 8 * i);
          v10 = [v9 pairingIdentity];
          v11 = [v4 isEqual:v10];

          if (v11)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
        if (v6)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  else
  {
    v6 = 0;
  }

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (BOOL)isSiriPhraseOptionsJustSiriEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = (self->_siriPhraseOptions >> 1) & 1;
  os_unfair_recursive_lock_unlock();
  return v3;
}

- (BOOL)isSiriPhraseOptionsHeySiriEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  siriPhraseOptions = self->_siriPhraseOptions;
  os_unfair_recursive_lock_unlock();
  return siriPhraseOptions & 1;
}

- (BOOL)isSmokeAlarmEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  audioAnalysisClassifierOptions = self->_audioAnalysisClassifierOptions;
  os_unfair_recursive_lock_unlock();
  return audioAnalysisClassifierOptions & 1;
}

- (NSArray)removedUsers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_removedUsers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSArray)usersPendingUserManagementOperations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_usersPendingUserManagementOperations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (BOOL)isOwnerUser
{
  os_unfair_recursive_lock_lock_with_options();
  ownerUser = self->_ownerUser;
  os_unfair_recursive_lock_unlock();
  return ownerUser;
}

- (void)setOwnerUser:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_ownerUser = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isSharedAdmin
{
  v3 = [(HMDHome *)self isAdminUser];
  if (v3)
  {
    LOBYTE(v3) = ![(HMDHome *)self isOwnerUser];
  }

  return v3;
}

- (BOOL)isAdminUser
{
  v2 = [(HMDHome *)self currentUser];
  v3 = [v2 isAdministrator];

  return v3;
}

- (HMDUser)currentUser
{
  v17 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (!self->_currentUser)
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    v3 = [(HMDHome *)self users];
    v4 = [v3 countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v4)
    {
      v5 = *v13;
      while (2)
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v13 != v5)
          {
            objc_enumerationMutation(v3);
          }

          v7 = *(*(&v12 + 1) + 8 * i);
          if ([v7 isCurrentUser])
          {
            objc_storeStrong(&self->_currentUser, v7);
            v8 = [(HMDHome *)self presenceAuthStatus];
            [(HMDUser *)self->_currentUser setPresenceAuthStatus:v8];

            goto LABEL_12;
          }
        }

        v4 = [v3 countByEnumeratingWithState:&v12 objects:v16 count:16];
        if (v4)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  os_unfair_recursive_lock_unlock();
  currentUser = self->_currentUser;
  v10 = *MEMORY[0x277D85DE8];

  return currentUser;
}

- (void)setCurrentUser:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  currentUser = self->_currentUser;
  self->_currentUser = v4;

  os_unfair_recursive_lock_unlock();
}

- (id)owner
{
  v16 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (!self->_owner)
  {
    v13 = 0u;
    v14 = 0u;
    v11 = 0u;
    v12 = 0u;
    v3 = [(HMDHome *)self users];
    v4 = [v3 countByEnumeratingWithState:&v11 objects:v15 count:16];
    if (v4)
    {
      v5 = *v12;
      while (2)
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v12 != v5)
          {
            objc_enumerationMutation(v3);
          }

          v7 = *(*(&v11 + 1) + 8 * i);
          if ([v7 privilege] == 3)
          {
            objc_storeStrong(&self->_owner, v7);
            goto LABEL_12;
          }
        }

        v4 = [v3 countByEnumeratingWithState:&v11 objects:v15 count:16];
        if (v4)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  os_unfair_recursive_lock_unlock();
  owner = self->_owner;
  v9 = *MEMORY[0x277D85DE8];

  return owner;
}

- (void)setOwner:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  owner = self->_owner;
  self->_owner = v4;

  os_unfair_recursive_lock_unlock();
}

- (void)_removeUser:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v5 = v4;
    os_unfair_recursive_lock_lock_with_options();
    if ([(NSMutableArray *)self->_users containsObject:v5])
    {
      [(NSMutableArray *)self->_users removeObject:v5];
    }

    os_unfair_recursive_lock_unlock();
    v4 = v5;
  }
}

- (void)addUser:(id)a3
{
  v34 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  if (v4)
  {
    os_unfair_recursive_lock_lock_with_options();
    if (([(NSMutableArray *)self->_users containsObject:v4]& 1) == 0)
    {
      v6 = objc_autoreleasePoolPush();
      v7 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = HMFGetLogIdentifier();
        v30 = 138543618;
        v31 = v9;
        v32 = 2112;
        v33 = v4;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Adding a new user : %@", &v30, 0x16u);
      }

      objc_autoreleasePoolPop(v6);
      [(NSMutableArray *)self->_users addObject:v4];
    }

    os_unfair_recursive_lock_unlock();
    if (([v4 isCurrentUser] & 1) != 0 && (objc_msgSend(v4, "isPending") & 1) == 0)
    {
      v10 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v13 = HMFGetLogIdentifier();
        v14 = [v4 uuid];
        v30 = 138543618;
        v31 = v13;
        v32 = 2112;
        v33 = v14;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Setting user %@ as current user", &v30, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      [(HMDHome *)v11 setCurrentUser:v4];
      if (v5)
      {
        v15 = [(HMDHome *)v11 owner];
        v16 = [v15 isCurrentUser];

        if ((v16 & 1) == 0)
        {
          v17 = [v5 homeSharedUserCloudShareManager];
          v18 = [(HMDHome *)v11 uuid];
          [v17 removeSharesWithNoParticipantForHomeWithModelID:v18];
        }

        v19 = [(HMDHome *)v11 uuid];
        [v5 removeHomeFromSharedHomesNotYetMigrated:v19];
      }

      v20 = objc_autoreleasePoolPush();
      v21 = v11;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
      {
        v23 = HMFGetLogIdentifier();
        v30 = 138543362;
        v31 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Send the initial presence update to primary.", &v30, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      v24 = [(HMDHome *)v21 presenceFeeder];
      [v24 sendInitialPresenceUpdate];

      v25 = objc_autoreleasePoolPush();
      v26 = v21;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
      {
        v28 = HMFGetLogIdentifier();
        v30 = 138543362;
        v31 = v28;
        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - addUser", &v30, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
      [(HMDHome *)v26 _configureUserActivityStateDetectorManager];
    }
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (NSArray)usersSupportingPresence
{
  v2 = [(HMDHome *)self users];
  v3 = [HMDHome filterUsersSupportingPresence:v2];

  return v3;
}

- (id)usersIncludingPendingUsers:(BOOL)a3
{
  v3 = a3;
  os_unfair_recursive_lock_lock_with_options();
  users = self->_users;
  if (v3)
  {
    v6 = [(NSMutableArray *)users copy];
  }

  else
  {
    v6 = [(NSMutableArray *)users na_filter:&__block_literal_global_1631];
  }

  v7 = v6;
  os_unfair_recursive_lock_unlock();

  return v7;
}

- (id)pendingUsers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_users na_filter:&__block_literal_global_1629];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (id)userIncludingPendingUserWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self usersIncludingPendingUsers:1];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)restrictedGuests
{
  v2 = [(HMDHome *)self users];
  v3 = [v2 na_filter:&__block_literal_global_1627];

  return v3;
}

- (id)sharedUsers
{
  v2 = [(HMDHome *)self users];
  v3 = [v2 na_map:&__block_literal_global_1624];

  return v3;
}

id __22__HMDHome_sharedUsers__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 privilege] == 3)
  {
    v3 = 0;
  }

  else
  {
    v3 = v2;
  }

  return v3;
}

- (void)_handleRemoveAppDataModel:(id)a3 message:(id)a4
{
  v5 = a4;
  [(HMDHome *)self setAppData:0];
  v6 = [v5 transactionResult];
  [v6 markChanged];
  [v5 respondWithPayload:0];
}

- (void)_handleUpdateAppDataModel:(id)a3 message:(id)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self appData];

  if (v8)
  {
    v9 = [(HMDHome *)self appData];
    [v9 updateWithModel:v6];
  }

  else
  {
    v10 = [HMDApplicationData alloc];
    v11 = [v6 appDataDictionary];
    v12 = [(HMDHome *)self uuid];
    v13 = [(HMDApplicationData *)v10 initWithDictionary:v11 parentUUID:v12];
    [(HMDHome *)self setAppData:v13];

    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v6 appDataDictionary];
      v21 = 138543618;
      v22 = v17;
      v23 = 2112;
      v24 = v18;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_DEBUG, "%{public}@Updating the application data : %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
  }

  v19 = [v7 transactionResult];
  [v19 markChanged];
  [v7 respondWithPayload:0];

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetAppData:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v21 = 0;
  v5 = [v4 appDataDictionaryWithError:&v21];
  v6 = v21;
  if (v5)
  {
    v7 = [(HMDHome *)self _appDataContainerForMessage:v4];
    if (v7)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543874;
        v23 = v11;
        v24 = 2112;
        v25 = v7;
        v26 = 2112;
        v27 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Going to update appData for %@ to: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v8);
      v12 = [v7 appData];
      v13 = [v7 uuid];
      v14 = [HMDApplicationDataModel modelWithAppDataPayload:v5 existingAppData:v12 parentUUID:v13];
      if (v14)
      {
        v15 = [(HMDHome *)v9 backingStore];
        v16 = [v4 name];
        v17 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        [v15 transaction:v16 options:v17];
        v18 = v20 = v6;

        [v18 add:v14 withMessage:v4];
        [v18 run];

        v6 = v20;
      }

      else
      {
        [v4 respondWithSuccess];
      }
    }

    else
    {
      v12 = [v4 responseHandler];
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (v12)[2](v12, v13, 0);
    }
  }

  else
  {
    [v4 respondWithError:v6];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (id)_appDataContainerForMessage:(id)a3
{
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD0D40]];
  if (v5)
  {
    v6 = [(HMDHome *)self roomWithUUID:v5];
  }

  else
  {
    v7 = [v4 uuidForKey:*MEMORY[0x277CD25E0]];
    if (v7)
    {
      v6 = [(HMDHome *)self serviceGroupWithUUID:v7];
    }

    else
    {
      v8 = [v4 uuidForKey:*MEMORY[0x277CD2050]];
      if (v8)
      {
        v9 = [(HMDHome *)self actionSetWithUUID:v8];
      }

      else
      {
        v9 = self;
      }

      v6 = v9;
    }
  }

  return v6;
}

- (void)_handleAllowUserManagementMessage:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self residentDeviceManager];
  v6 = [v5 availableResidentDevices];
  v7 = [v6 count];

  if (!v7)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Unable to allow user management, no resident devices in home", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v13 = MEMORY[0x277CCA9B8];
    v14 = 91;
    goto LABEL_10;
  }

  if (![(HMDHome *)self isAdminUser])
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Unable to allow user management, insufficient privileges", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
    v13 = MEMORY[0x277CCA9B8];
    v14 = 17;
LABEL_10:
    v8 = [v13 hmErrorWithCode:v14];
    v19 = [v4 responseHandler];
    v19[2](v19, v8, MEMORY[0x277CBEC10]);

    goto LABEL_11;
  }

  v8 = [v4 responseHandler];
  v8[2](v8, 0, MEMORY[0x277CBEC10]);
LABEL_11:

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleExecuteConfirmationOfTrigger:(id)a3
{
  v55 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (([(__CFString *)v4 isEntitledForSPIAccess]& 1) != 0 || ([(__CFString *)v4 isRemote]& 1) != 0)
  {
    v5 = [(__CFString *)v4 uuidForKey:*MEMORY[0x277CD2768]];
    v6 = [(HMDHome *)self triggers];
    v7 = [v6 hmf_firstObjectWithSPIUniqueIdentifier:v5];

    v8 = v7;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    isWatch();
    if (isWatch() && ([v10 hasUserConfirmationSession] & 1) == 0)
    {
      v24 = objc_autoreleasePoolPush();
      v25 = self;
      v26 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
      {
        v27 = HMFGetLogIdentifier();
        isWatch();
        *buf = 138543874;
        v50 = v27;
        v51 = 2112;
        v52 = @"non-Tinker HH2";
        v53 = 2112;
        v54 = v4;
        _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Received trigger execution confirmation for relay in %@ Watch, %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v24);
      v16 = [(HMDHome *)v25 homeManager];
      v23 = [v16 companionDevice];
      if (v23 && [v16 companionReachable])
      {
        v28 = [HMDRemoteDeviceMessageDestination alloc];
        v29 = [(HMDHome *)v25 uuid];
        v43 = v23;
        v30 = [(HMDRemoteDeviceMessageDestination *)v28 initWithTarget:v29 device:v23];

        v31 = MEMORY[0x277D0F818];
        v32 = [(__CFString *)v4 messagePayload];
        v33 = [v32 copy];
        v34 = [v31 messageWithName:@"kConfirmExecuteTriggerRequestKey" qualityOfService:25 destination:v30 payload:v33];

        v47[0] = MEMORY[0x277D85DD0];
        v47[1] = 3221225472;
        v47[2] = __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke;
        v47[3] = &unk_278689DC0;
        v48 = v4;
        [v34 setResponseHandler:v47];
        v35 = objc_autoreleasePoolPush();
        v36 = v25;
        v37 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v38 = v42 = v35;
          *buf = 138543362;
          v50 = v38;
          _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_INFO, "%{public}@Sending confirmation to companion", buf, 0xCu);

          v35 = v42;
        }

        objc_autoreleasePoolPop(v35);
        v39 = [v16 messageDispatcher];
        [v39 sendMessage:v34 completionHandler:0];

        v23 = v43;
      }

      else
      {
        v30 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:63 userInfo:0];
        v40 = [(__CFString *)v4 responseHandler];
        v34 = v40;
        if (v40)
        {
          (*(v40 + 16))(v40, v30, 0);
        }
      }
    }

    else
    {
      v11 = objc_autoreleasePoolPush();
      v12 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        *buf = 138543618;
        v50 = v14;
        v51 = 2112;
        v52 = v4;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Received trigger execution confirmation on iOS or HH2 Watch: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
      if (v8)
      {
        v15 = [(__CFString *)v4 BOOLForKey:*MEMORY[0x277CD2740]];
        v44[0] = MEMORY[0x277D85DD0];
        v44[1] = 3221225472;
        v44[2] = __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke_1619;
        v44[3] = &unk_27868A1D8;
        v45 = v8;
        v46 = v4;
        [v45 userDidConfirmExecute:v15 completionHandler:v44];

        v16 = v45;
LABEL_29:

        goto LABEL_30;
      }

      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      v22 = [(__CFString *)v4 responseHandler];
      v23 = v22;
      if (v22)
      {
        (*(v22 + 16))(v22, v16, 0);
      }
    }

    goto LABEL_29;
  }

  v17 = objc_autoreleasePoolPush();
  v18 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 138543362;
    v50 = v20;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI and it's not relayed from watch.", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v17);
  v21 = [(__CFString *)v4 responseHandler];

  if (v21)
  {
    v5 = [(__CFString *)v4 responseHandler];
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    (v5)[2](v5, v8, 0);
LABEL_30:
  }

  v41 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  v3 = [*(a1 + 32) responseHandler];
  v4 = v3;
  if (v3)
  {
    (*(v3 + 16))(v3, v5, 0);
  }
}

void __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke_1619(uint64_t a1, void *a2)
{
  v5 = a2;
  if (v5 && isiOSDevice())
  {
    +[HMDBulletinUIManager presentExecutionErrorDialogForTrigger:partialSuccess:](HMDBulletinUIManager, "presentExecutionErrorDialogForTrigger:partialSuccess:", *(a1 + 32), [v5 code] == 64);
  }

  v3 = [*(a1 + 40) responseHandler];
  v4 = v3;
  if (v3)
  {
    (*(v3 + 16))(v3, v5, 0);
  }
}

- (void)_removeTrigger:(id)a3 message:(id)a4
{
  v34 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (v6)
  {
    [(HMDHome *)self removeTriggerNoNotification:v6];
    v8 = [v7 transactionResult];
    [v8 markChanged];
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v12;
      v32 = 2112;
      v33 = v6;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Remove trigger: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v13 = [(HMDHome *)v10 uuid];
    v14 = [v13 UUIDString];
    v29[0] = v14;
    v28[1] = *MEMORY[0x277CD2758];
    v15 = [v6 name];
    v29[1] = v15;
    v28[2] = *MEMORY[0x277CD2768];
    v16 = [v6 uuid];
    v17 = [v16 UUIDString];
    v29[2] = v17;
    v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:3];

    v19 = objc_autoreleasePoolPush();
    v20 = v10;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v22;
      v32 = 2112;
      v33 = v18;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Successfully Removed trigger : sending back the result: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    [v7 respondWithPayload:v18];
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    v24 = self;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v26;
      v32 = 2112;
      v33 = 0;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Could not find the Trigger : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    v8 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    [v7 respondWithError:v8];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)removeTriggerNoNotification:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v9 = v4;
    [v4 invalidate];
    v5 = [v9 name];
    v6 = [(HMDHome *)self removeName:v5];

    [(HMDHome *)self removeFromCurrentTriggers:v9];
    os_unfair_recursive_lock_lock_with_options();
    ownedTriggers = self->_ownedTriggers;
    v8 = [v9 uuid];
    [(NSMutableArray *)ownedTriggers removeObject:v8];

    os_unfair_recursive_lock_unlock();
    v4 = v9;
  }
}

- (void)removeTrigger:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __25__HMDHome_removeTrigger___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __25__HMDHome_removeTrigger___block_invoke(uint64_t a1)
{
  v12[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277D0F818];
  v3 = objc_alloc(MEMORY[0x277D0F820]);
  v4 = [*(a1 + 32) uuid];
  v5 = [v3 initWithTarget:v4];
  v11 = *MEMORY[0x277CD2768];
  v6 = [*(a1 + 40) uuid];
  v7 = [v6 UUIDString];
  v12[0] = v7;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:&v11 count:1];
  v9 = [v2 messageWithName:@"kRemoveTriggerRequestKey" destination:v5 payload:v8];

  [*(a1 + 32) _handleRemoveTrigger:v9];
  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveTriggerModel:(id)a3 message:(id)a4
{
  v21 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 uuid];
  v9 = [(HMDHome *)self triggerWithUUID:v8];

  if (v9)
  {
    [(HMDHome *)self _removeTrigger:v9 message:v7];
    v10 = [v7 transactionResult];
    [v10 markChanged];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v6 uuid];
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Couldn't find trigger with UUID %@ to remove.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v7 respondWithError:v10];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveTrigger:(id)a3
{
  v25 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD2768]];
  v6 = [(HMDHome *)self triggerWithUUID:v5];
  if (v6)
  {
    v7 = [HMDTriggerModel alloc];
    v8 = [v6 uuid];
    v9 = [(HMDHome *)self uuid];
    v10 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v8 parentUUID:v9];

    v11 = [(HMDHome *)self backingStore];
    v12 = [v4 name];
    v13 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v14 = [v11 transaction:v12 options:v13];

    [v14 add:v10 withMessage:v4];
    [v14 run];
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v18;
      v23 = 2112;
      v24 = v5;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Cannot find the trigger with UUID %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v19];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_addNewTrigger:(id)a3 message:(id)a4 payloadAnnex:(id)a5 triggerModel:(id)a6
{
  v43 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  [(HMDHome *)self addToCurrentTriggers:v10];
  os_unfair_recursive_lock_lock_with_options();
  ownedTriggers = self->_ownedTriggers;
  v15 = [v10 uuid];
  if (([(NSMutableArray *)ownedTriggers containsObject:v15]& 1) == 0)
  {
    v16 = [v10 owner];
    v17 = [v16 isOwner];

    if (!v17)
    {
      goto LABEL_5;
    }

    v18 = self->_ownedTriggers;
    v15 = [v10 uuid];
    [(NSMutableArray *)v18 addObject:v15];
  }

LABEL_5:
  os_unfair_recursive_lock_unlock();
  v19 = [(HMDHome *)self msgDispatcher];
  v20 = [(HMDHome *)self workQueue];
  [v10 configure:self messageDispatcher:v19 queue:v20];

  v21 = [v11 transactionResult];
  [v21 markChanged];
  v22 = [v11 name];
  if ([v22 isEqualToString:@"kAddEventTriggerRequestKey"])
  {
  }

  else
  {
    v23 = [v11 name];
    v24 = [v23 isEqualToString:@"kAddTimerTriggerRequestKey"];

    if ((v24 & 1) == 0)
    {
      [v11 respondWithSuccess];
      goto LABEL_14;
    }
  }

  v25 = objc_autoreleasePoolPush();
  v26 = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
  {
    v28 = HMFGetLogIdentifier();
    v29 = [v10 name];
    v37 = 138543874;
    v38 = v28;
    v39 = 2112;
    v40 = v29;
    v41 = 2112;
    v42 = v11;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Add trigger Transaction marked for change. The client will be updated next: %@, %@", &v37, 0x20u);
  }

  objc_autoreleasePoolPop(v25);
  v30 = MEMORY[0x277CBEB38];
  v31 = [v11 messagePayload];
  v32 = [v30 dictionaryWithDictionary:v31];

  v33 = HMDRemoteMessagePayloadKeysForTransportMetadata();
  [v32 removeObjectsForKeys:v33];

  v34 = [v10 uuid];
  v35 = [v34 UUIDString];
  [v32 setObject:v35 forKey:*MEMORY[0x277CD2768]];

  if (v12)
  {
    [v32 addEntriesFromDictionary:v12];
  }

  [v11 respondWithPayload:v32];

LABEL_14:
  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTimerTriggerModel:(id)a3 message:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [[HMDTimerTrigger alloc] initWithModel:v6 home:self];
  if (v8)
  {
    v9 = [v6 createPayload];
    [(HMDHome *)self _addNewTrigger:v8 message:v7 payloadAnnex:v9 triggerModel:v6];
LABEL_7:

    goto LABEL_8;
  }

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v17 = 138543362;
    v18 = v13;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Could not create timer trigger object from model", &v17, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  v14 = [v7 responseHandler];

  if (v14)
  {
    v9 = [v7 responseHandler];
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (v9)[2](v9, v15, 0);

    goto LABEL_7;
  }

LABEL_8:

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTimerTrigger:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self residentEnabledDevices];
  v6 = [v5 count];

  if (v6)
  {
    v7 = [v4 name];
    v8 = [v7 isEqualToString:*MEMORY[0x277CCF200]];

    v9 = [v4 stringForKey:*MEMORY[0x277CD2758]];
    if ([(HMDHome *)self _validateAddingNewTriggerWithName:v9 message:v4])
    {
      v10 = [v4 stringForKey:*MEMORY[0x277CD1250]];
      v11 = [MEMORY[0x277CCAD78] UUID];
      v12 = [HMDTimerTriggerModel alloc];
      v13 = [(HMDHome *)self uuid];
      v14 = [(HMDBackingStoreModelObject *)v12 initWithObjectChangeType:1 uuid:v11 parentUUID:v13];

      [(HMDTimerTriggerModel *)v14 setName:v9];
      [(HMDTimerTriggerModel *)v14 setConfiguredName:v10];
      [(HMDTimerTriggerModel *)v14 setActive:MEMORY[0x277CBEC28]];
      v15 = [HMDTimerTrigger validateTriggerModel:v14 message:v4 currentFireDate:0];

      if (!v15)
      {
LABEL_16:

        goto LABEL_17;
      }

      v33 = v11;
      v16 = v10;
      v17 = [(HMDHome *)self backingStore];
      v18 = [v4 name];
      +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v20 = v19 = v8;
      v21 = [v17 transaction:v18 options:v20];

      v22 = v19;
      if (v19)
      {
        v23 = objc_alloc_init(MEMORY[0x277CBEB38]);
        v10 = v16;
        v11 = v33;
        v24 = v21;
        if (![(HMDHome *)self _populateTriggerModel:v15 fromBuilderMessage:v4 transaction:v21 responsePayload:v23])
        {
LABEL_15:

          goto LABEL_16;
        }
      }

      else
      {
        v23 = 0;
        v10 = v16;
        v11 = v33;
        v24 = v21;
      }

      [v4 userForHome:self];
      v30 = v29 = v22;
      [v15 setOwner:v30];

      v31 = [(HMDHome *)self currentDevice];
      [v15 setOwningDevice:v31];

      if (v29)
      {
        [v24 add:v15];
        v34[0] = MEMORY[0x277D85DD0];
        v34[1] = 3221225472;
        v34[2] = __34__HMDHome__handleAddTimerTrigger___block_invoke;
        v34[3] = &unk_278688D58;
        v35 = v4;
        v23 = v23;
        v36 = v23;
        v37 = v15;
        [v24 run:v34];
      }

      else
      {
        [v24 add:v15 withMessage:v4];
        [v24 run];
      }

      goto LABEL_15;
    }

    v25 = objc_autoreleasePoolPush();
    v26 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543362;
      v39 = v28;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Trigger name is not valid", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v25);
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    [v4 respondWithError:v9];
  }

LABEL_17:

  v32 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddTimerTrigger___block_invoke(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v4 = *(a1 + 40);
    v5 = [*(a1 + 48) createPayload];
    [v4 addEntriesFromDictionary:v5];

    v6 = *(a1 + 32);
    v7 = [*(a1 + 40) copy];
    [v6 respondWithPayload:v7];
  }
}

- (void)_relayAddTriggerToResident:(id)a3
{
  v24[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v24[0] = v4;
  v5 = [MEMORY[0x277CBEA60] arrayWithObjects:v24 count:1];
  v6 = encodeRootObject();

  v22 = @"HM.triggers";
  v23 = v6;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v23 forKeys:&v22 count:1];
  objc_initWeak(&location, self);
  v8 = MEMORY[0x277D0F848];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __38__HMDHome__relayAddTriggerToResident___block_invoke;
  v18[3] = &unk_278687F40;
  objc_copyWeak(&v20, &location);
  v9 = v4;
  v19 = v9;
  v10 = [v8 messageWithName:@"kAddTriggersInternalRequestKey" messagePayload:v7 responseHandler:v18];
  v11 = objc_alloc(MEMORY[0x277D0F820]);
  v12 = [(HMDHome *)self uuid];
  v13 = [v11 initWithTarget:v12];

  [v10 setDestination:v13];
  [v10 setQualityOfService:33];
  v14 = [(HMDHome *)self administratorHandler];
  v15 = [v10 copy];
  v16 = [v14 operationForMessage:v15 error:0];

  if (v16)
  {
    [v14 addOperation:v16];
  }

  objc_destroyWeak(&v20);
  objc_destroyWeak(&location);

  v17 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__relayAddTriggerToResident___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = @"kAddTriggersInternalRequestKey";
      v20 = 2112;
      v21 = v5;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Relayed message %@ with error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    if (v5)
    {
      v12 = [v9 workQueue];
      v14[0] = MEMORY[0x277D85DD0];
      v14[1] = 3221225472;
      v14[2] = __38__HMDHome__relayAddTriggerToResident___block_invoke_1607;
      v14[3] = &unk_27868A750;
      v14[4] = v9;
      v15 = *(a1 + 32);
      dispatch_async(v12, v14);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__relayAddTriggerToResident___block_invoke_1607(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v15 = 138543618;
    v16 = v5;
    v17 = 2112;
    v18 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Removing trigger that was not added to resident: %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = [HMDTriggerModel alloc];
  v8 = [*(a1 + 40) uuid];
  v9 = [*(a1 + 32) uuid];
  v10 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v8 parentUUID:v9];

  v11 = [*(a1 + 32) backingStore];
  v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v13 = [v11 transaction:@"relayAddTrigger" options:v12];

  [v13 add:v10 withMessage:0];
  [v13 run];

  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)_validateAddingNewTriggerWithName:(id)a3 message:(id)a4
{
  v34 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (v6)
  {
    if ([v6 length])
    {
      v8 = HMMaxLengthForNaming();
      if ([v6 length] > v8)
      {
        v9 = objc_autoreleasePoolPush();
        v10 = self;
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
        {
          v12 = HMFGetLogIdentifier();
          v30 = 138543362;
          v31 = v12;
          _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v30, 0xCu);
        }

        objc_autoreleasePoolPop(v9);
        v13 = MEMORY[0x277CCA9B8];
        v14 = 46;
        goto LABEL_9;
      }

      v19 = [(HMDHome *)self triggerWithName:v6];
      if (v19)
      {
        v20 = MEMORY[0x277CCA9B8];
        v21 = 1;
      }

      else
      {
        v22 = [(HMDHome *)self triggers];
        v23 = [v22 count];
        v24 = maximumTriggersPerHome;

        if (v23 < v24)
        {
          v16 = 1;
LABEL_19:

          goto LABEL_10;
        }

        v25 = objc_autoreleasePoolPush();
        v26 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          v30 = 138543618;
          v31 = v28;
          v32 = 2112;
          v33 = v6;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Can't add trigger %@; already at maximum triggers for home", &v30, 0x16u);
        }

        objc_autoreleasePoolPop(v25);
        v20 = MEMORY[0x277CCA9B8];
        v21 = 49;
      }

      v29 = [v20 hmErrorWithCode:v21];
      [v7 respondWithError:v29];

      v16 = 0;
      goto LABEL_19;
    }

    v13 = MEMORY[0x277CCA9B8];
    v14 = 3;
  }

  else
  {
    v13 = MEMORY[0x277CCA9B8];
    v14 = 20;
  }

LABEL_9:
  v15 = [v13 hmErrorWithCode:v14];
  [v7 respondWithError:v15];

  v16 = 0;
LABEL_10:

  v17 = *MEMORY[0x277D85DE8];
  return v16;
}

- (void)_handleAddEventTriggerModel:(id)a3 message:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [[HMDEventTrigger alloc] initWithModel:v6 home:self message:v7];
  if (v8)
  {
    v9 = [v6 createPayload];
    [(HMDHome *)self _addNewTrigger:v8 message:v7 payloadAnnex:v9 triggerModel:v6];
LABEL_7:

    goto LABEL_8;
  }

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v17 = 138543362;
    v18 = v13;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Could not create event trigger object from model", &v17, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  v14 = [v7 responseHandler];

  if (v14)
  {
    v9 = [v7 responseHandler];
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (v9)[2](v9, v15, 0);

    goto LABEL_7;
  }

LABEL_8:

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)_populateTriggerModel:(id)a3 fromBuilderMessage:(id)a4 transaction:(id)a5 responsePayload:(id)a6
{
  v76 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v60 = a5;
  v62 = a6;
  v12 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v11, "BOOLForKey:", *MEMORY[0x277CD2730])}];
  [v10 setActive:v12];

  v13 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v11, "BOOLForKey:", *MEMORY[0x277CD1260])}];
  [v10 setAutoDelete:v13];

  v64 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  v70 = 0u;
  v61 = v11;
  obj = [v11 arrayForKey:*MEMORY[0x277CD2728]];
  v14 = [obj countByEnumeratingWithState:&v67 objects:v75 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v68;
    v59 = v10;
    while (2)
    {
      for (i = 0; i != v15; ++i)
      {
        if (*v68 != v16)
        {
          objc_enumerationMutation(obj);
        }

        v18 = *(*(&v67 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (!v20)
        {
          goto LABEL_18;
        }

        v21 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v20];
        if (!v21)
        {
          v20 = v18;
LABEL_18:
          v40 = objc_autoreleasePoolPush();
          v41 = self;
          v42 = HMFGetOSLogHandle();
          v29 = v60;
          v28 = v61;
          if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
          {
            v43 = HMFGetLogIdentifier();
            *buf = 138543618;
            v72 = v43;
            v73 = 2112;
            v74 = v20;
            _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_ERROR, "%{public}@Invalid ActionSet reference: '%@'", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v40);
          v44 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          [v61 respondWithError:v44];

          v45 = 0;
          v10 = v59;
          goto LABEL_29;
        }

        v22 = v21;
        v23 = [(HMDHome *)self actionSetWithUUID:v21];
        if (!v23)
        {
          v46 = objc_autoreleasePoolPush();
          v47 = self;
          v48 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
          {
            v49 = HMFGetLogIdentifier();
            *buf = 138543618;
            v72 = v49;
            v73 = 2112;
            v74 = v22;
            _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_ERROR, "%{public}@Failed to resolve ActionSet reference: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v46);
          v50 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v28 = v61;
          [v61 respondWithError:v50];

          v45 = 0;
          v10 = v59;
          v29 = v60;
          goto LABEL_29;
        }

        v24 = v23;
        v25 = [v23 uuid];
        v26 = [v25 UUIDString];
        [v64 addObject:v26];
      }

      v15 = [obj countByEnumeratingWithState:&v67 objects:v75 count:16];
      v10 = v59;
      if (v15)
      {
        continue;
      }

      break;
    }
  }

  v27 = *MEMORY[0x277CD2760];
  v28 = v61;
  [v61 dictionaryForKey:*MEMORY[0x277CD2760]];
  obj = v29 = v60;
  if (!obj)
  {
    goto LABEL_28;
  }

  v30 = [MEMORY[0x277CCAD78] UUID];
  v31 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:v30];
  v32 = [v31 UUIDString];

  v33 = *MEMORY[0x277CCF1A0];
  v65 = 0;
  v66 = 0;
  v34 = self;
  v35 = v32;
  v36 = [(HMDHome *)v34 _createActionSetWithUUID:v30 name:v32 type:v33 fromDictionary:obj transaction:v60 response:&v66 error:&v65];
  v37 = v66;
  v38 = v65;

  if (v36)
  {
    [v62 setObject:v37 forKeyedSubscript:v27];
    v39 = [v30 UUIDString];
    [v64 addObject:v39];
  }

  else
  {
    v58 = v35;
    v51 = v10;
    context = objc_autoreleasePoolPush();
    v52 = v34;
    v53 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v53, OS_LOG_TYPE_ERROR))
    {
      v54 = HMFGetLogIdentifier();
      *buf = 138543362;
      v72 = v54;
      _os_log_impl(&dword_229538000, v53, OS_LOG_TYPE_ERROR, "%{public}@Failed to create trigger-owned action set", buf, 0xCu);
    }

    objc_autoreleasePoolPop(context);
    [v61 respondWithError:v38];
    v10 = v51;
    v35 = v58;
  }

  if (!v36)
  {
    v45 = 0;
  }

  else
  {
LABEL_28:
    v20 = [v64 copy];
    [v10 setCurrentActionSets:v20];
    v45 = 1;
LABEL_29:
  }

  v55 = *MEMORY[0x277D85DE8];
  return v45;
}

- (HMDActionSet)_createActionSetWithUUID:(void *)a3 name:(void *)a4 type:(void *)a5 fromDictionary:(void *)a6 transaction:(void *)a7 response:(void *)a8 error:
{
  v78 = *MEMORY[0x277D85DE8];
  v13 = a2;
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  if (a1)
  {
    v62 = v15;
    v63 = v14;
    v18 = [[HMDActionSet alloc] initWithName:v14 uuid:v13 type:v15 home:a1 queue:0];
    v19 = [(HMDActionSet *)v18 modelObjectWithChangeType:1];
    [v17 add:v19];

    v64 = v16;
    v20 = v16;
    v21 = v18;
    v22 = [v20 hmf_arrayForKey:*MEMORY[0x277CD2030]];
    v68 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{objc_msgSend(v22, "count")}];
    v69 = 0u;
    v70 = 0u;
    v71 = 0u;
    v72 = 0u;
    obj = v22;
    v23 = [obj countByEnumeratingWithState:&v69 objects:v77 count:16];
    v66 = v18;
    if (v23)
    {
      v24 = v23;
      v25 = *v70;
      v61 = v13;
LABEL_4:
      v26 = 0;
      while (1)
      {
        if (*v70 != v25)
        {
          objc_enumerationMutation(obj);
        }

        v27 = *(*(&v69 + 1) + 8 * v26);
        objc_opt_class();
        v28 = (objc_opt_isKindOfClass() & 1) != 0 ? v27 : 0;
        v29 = v28;

        if (!v29)
        {
          break;
        }

        v30 = [a1 actionWithDictionaryRepresentation:v29];
        if (!v30)
        {
          v50 = objc_autoreleasePoolPush();
          v51 = a1;
          v52 = HMFGetOSLogHandle();
          v13 = v61;
          v15 = v62;
          v16 = v64;
          if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
          {
            v53 = HMFGetLogIdentifier();
            *buf = 138543618;
            v74 = v53;
            v75 = 2112;
            v76 = v29;
            _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@Failed to deserialize action: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v50);
          v14 = v63;
          if (a8)
          {
            *a8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          }

          v49 = obj;
LABEL_37:

          v44 = 0;
          goto LABEL_46;
        }

        v31 = v30;
        v32 = +[HMDCoreData featuresDataSource];
        v33 = [v32 isRVCEnabled];

        if (v33)
        {
          v34 = v17;
          v35 = v31;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();
          if (isKindOfClass)
          {
            v37 = v35;
          }

          else
          {
            v37 = 0;
          }

          v38 = v37;

          if (isKindOfClass)
          {
            [v35 addMatterPathsToTransactionIfNotStored:v34];
          }

          v17 = v34;
          v21 = v66;
        }

        [v68 addObject:v31];
        [v31 updateActionSetIfNil:v21];
        v39 = [v31 modelObjectWithChangeType:1];
        [v17 add:v39];

        if (v24 == ++v26)
        {
          v24 = [obj countByEnumeratingWithState:&v69 objects:v77 count:16];
          v13 = v61;
          if (v24)
          {
            goto LABEL_4;
          }

          goto LABEL_21;
        }
      }

      v45 = objc_autoreleasePoolPush();
      v46 = a1;
      v47 = HMFGetOSLogHandle();
      v14 = v63;
      if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
      {
        v48 = HMFGetLogIdentifier();
        *buf = 138543618;
        v74 = v48;
        v75 = 2112;
        v76 = v63;
        _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; invalid serialized action", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v45);
      v13 = v61;
      v15 = v62;
      v16 = v64;
      v49 = obj;
      if (a8)
      {
        *a8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      }

      goto LABEL_37;
    }

LABEL_21:

    [(HMDActionSet *)v21 setActions:v68];
    if ([a1 validateActionsDoNotConflict:v68])
    {
      v16 = v64;
      v40 = [v64 hmd_appDataDictionaryWithError:a8];
      if (v40)
      {
        v41 = [HMDApplicationDataModel modelWithAppDataPayload:v40 existingAppData:0 parentUUID:v13];
        if (v41)
        {
          [v17 add:v41];
        }

        v15 = v62;
        v14 = v63;
        if (a7)
        {
          v42 = [(HMDActionSet *)v66 createPayload];
          v43 = [v42 mutableCopy];

          [v43 setObject:v40 forKeyedSubscript:@"kAppDataInformationKey"];
          *a7 = [v43 copy];
        }

        v44 = v66;
      }

      else
      {
        v44 = 0;
        v15 = v62;
        v14 = v63;
      }

      v49 = obj;
    }

    else
    {
      v54 = objc_autoreleasePoolPush();
      v55 = a1;
      v56 = HMFGetOSLogHandle();
      v14 = v63;
      v16 = v64;
      if (os_log_type_enabled(v56, OS_LOG_TYPE_ERROR))
      {
        v57 = HMFGetLogIdentifier();
        *buf = 138543618;
        v74 = v57;
        v75 = 2112;
        v76 = v63;
        _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; conflicting actions", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v54);
      v49 = obj;
      if (a8)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        *a8 = v44 = 0;
      }

      else
      {
        v44 = 0;
      }

      v15 = v62;
    }

LABEL_46:
  }

  else
  {
    v44 = 0;
  }

  v58 = *MEMORY[0x277D85DE8];

  return v44;
}

- (void)_handleAddEventTrigger:(id)a3
{
  v75 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v72 = v8;
    v73 = 2112;
    v74 = v4;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received message %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [(HMDHome *)v6 residentEnabledDevices];
  v10 = [v9 count] == 0;

  if (!v10)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = v6;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v4 messagePayload];
      *buf = 138543618;
      v72 = v14;
      v73 = 2112;
      v74 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Add event trigger payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = [v4 name];
    v17 = [v16 isEqualToString:*MEMORY[0x277CCF1F0]];

    v18 = [v4 stringForKey:*MEMORY[0x277CD2758]];
    v50 = [v4 stringForKey:*MEMORY[0x277CD1250]];
    v51 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
    v54 = [v4 predicateForKey:*MEMORY[0x277CD2298]];
    v19 = *MEMORY[0x277CD22C8];
    v20 = [v4 numberForKey:*MEMORY[0x277CD22C8]];
    v53 = v20;
    if (v20)
    {
      [v20 unsignedIntegerValue];
      HMDaysOfTheWeekToDateComponents();
    }

    else
    {
      [v4 arrayOfDateComponentsForKey:v19];
    }
    v52 = ;
    v21 = [v4 userForHome:v12];
    v22 = [HMDEventTriggerModel alloc];
    v23 = [(HMDHome *)v12 uuid];
    v24 = [(HMDBackingStoreModelObject *)v22 initWithObjectChangeType:1 uuid:v51 parentUUID:v23];

    [(HMDEventTriggerModel *)v24 setName:v18];
    [(HMDEventTriggerModel *)v24 setConfiguredName:v50];
    [(HMDEventTriggerModel *)v24 setActive:MEMORY[0x277CBEC28]];
    [(HMDEventTriggerModel *)v24 setOwner:v21];
    v25 = [(HMDHome *)v12 currentDevice];
    [(HMDEventTriggerModel *)v24 setOwningDevice:v25];

    if (v54)
    {
      v26 = [(HMDHome *)v12 predicateUtility];
      v27 = [v26 rewritePredicateForDaemon:v54 message:v4];

      v28 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v27 requiringSecureCoding:1 error:0];
      [(HMDEventTriggerModel *)v24 setEvaluationCondition:v28];
    }

    v29 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v52 requiringSecureCoding:1 error:0];
    [(HMDEventTriggerModel *)v24 setRecurrences:v29];

    v30 = [v4 mutableCopy];
    objc_initWeak(&location, v12);
    v64[0] = MEMORY[0x277D85DD0];
    v64[1] = 3221225472;
    v64[2] = __34__HMDHome__handleAddEventTrigger___block_invoke;
    v64[3] = &unk_278670180;
    objc_copyWeak(&v68, &location);
    v31 = v4;
    v65 = v31;
    v32 = v24;
    v66 = v32;
    v69 = v17;
    v49 = v21;
    v67 = v49;
    [v30 setResponseHandler:v64];
    if (![(HMDHome *)v12 _validateAddingNewTriggerWithName:v18 message:v30])
    {
      goto LABEL_33;
    }

    if (!v53 && ![HMDEventTrigger __validateRecurrences:v52])
    {
      v43 = objc_autoreleasePoolPush();
      v44 = v12;
      v45 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
      {
        v46 = HMFGetLogIdentifier();
        *buf = 138543618;
        v72 = v46;
        v73 = 2112;
        v74 = v52;
        _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_ERROR, "%{public}@Received invalid values for recurrences: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v43);
      v36 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v30 respondWithError:v36];
      goto LABEL_32;
    }

    v33 = [(HMDHome *)v12 backingStore];
    v34 = [v31 name];
    v35 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v48 = [v33 transaction:v34 options:v35];

    if (v17)
    {
      v36 = objc_alloc_init(MEMORY[0x277CBEB38]);
      if (![(HMDHome *)v12 _populateTriggerModel:v32 fromBuilderMessage:v30 transaction:v48 responsePayload:v36])
      {
LABEL_31:

LABEL_32:
LABEL_33:

        objc_destroyWeak(&v68);
        objc_destroyWeak(&location);

        goto LABEL_34;
      }

      v37 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v31, "BOOLForKey:", *MEMORY[0x277CD22B8])}];
      [(HMDEventTriggerModel *)v32 setExecuteOnce:v37];
    }

    else
    {
      v36 = 0;
    }

    v38 = [[HMDEventTrigger alloc] initWithModel:v32 home:v12 message:v31];
    v39 = v38;
    if (v17)
    {
      v40 = v48;
    }

    else
    {
      v40 = 0;
    }

    v63 = 0;
    v41 = [(HMDEventTrigger *)v38 addEventsFromMessage:v31 preserveUUIDs:v17 ^ 1u transaction:v40 error:&v63];
    v42 = v63;
    if (v41)
    {
      if (v17)
      {
        [v48 add:v32];
        v55[0] = MEMORY[0x277D85DD0];
        v55[1] = 3221225472;
        v55[2] = __34__HMDHome__handleAddEventTrigger___block_invoke_1606;
        v55[3] = &unk_2786701A8;
        v56 = v30;
        v57 = v36;
        v58 = v32;
        v59 = v54;
        v60 = v12;
        v61 = v39;
        v62 = v49;
        [v48 run:v55];
      }

      else
      {
        [v48 add:v32 withMessage:v30];
        [v48 run];
      }
    }

    else
    {
      [v30 respondWithError:v42];
    }

    goto LABEL_31;
  }

  v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
  [v4 respondWithError:v18];
LABEL_34:

  v47 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddEventTrigger___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v34 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v28 = 138543874;
    v29 = v11;
    v30 = 2112;
    v31 = v6;
    v32 = 2112;
    v33 = v5;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Responding to the client about add event trigger status : Payload : [%@], error : [%@]", &v28, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 32) respondWithPayload:v6 error:v5];
  if (v9)
  {
    v12 = [[HMDEventTrigger alloc] initWithModel:*(a1 + 40) home:v9 message:*(a1 + 32)];
    v13 = 1;
    [(HMDEventTrigger *)v12 addEventsFromMessage:*(a1 + 32) preserveUUIDs:(*(a1 + 64) & 1) == 0 transaction:0 error:0];
    v14 = [HomeKitEventTriggerAddLogEvent alloc];
    v15 = [v9 uuid];
    v16 = [(HomeKitEventTriggerAddLogEvent *)v14 initWithHomeUUID:v15];

    v17 = [[HMDAnalyticsEventTriggerData alloc] initWithEventTrigger:v12 isAdding:1];
    v18 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v18 setEventTrigger:v17];

    v19 = [v5 code];
    v20 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v20 setResultErrorCode:v19];

    if (([*(a1 + 48) isOwner] & 1) == 0)
    {
      if ([*(a1 + 48) isAdministrator])
      {
        v13 = 2;
      }

      else
      {
        v13 = 0;
      }
    }

    v21 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v21 setRequestOrigin:v13];

    v22 = objc_autoreleasePoolPush();
    v23 = v9;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      v28 = 138543618;
      v29 = v25;
      v30 = 2112;
      v31 = v16;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Prepared the metric %@, submitting", &v28, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v26 = [v23 logEventSubmitter];
    [v26 submitLogEvent:v16];
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddEventTrigger___block_invoke_1606(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v4 = *(a1 + 40);
    v5 = [*(a1 + 48) createPayloadWithCondition:*(a1 + 56)];
    [v4 addEntriesFromDictionary:v5];

    v6 = *(a1 + 64);
    v7 = [*(a1 + 72) triggerEvents];
    v8 = [(HMDHome *)v6 _createEventsPayload:v7];
    [*(a1 + 40) setObject:v8 forKeyedSubscript:*MEMORY[0x277CD22B0]];

    v9 = *(a1 + 64);
    v10 = [*(a1 + 72) endEvents];
    v11 = [(HMDHome *)v9 _createEventsPayload:v10];
    [*(a1 + 40) setObject:v11 forKeyedSubscript:*MEMORY[0x277CD22A8]];

    v12 = [*(a1 + 80) uuid];
    v13 = [v12 UUIDString];
    [*(a1 + 40) setObject:v13 forKeyedSubscript:*MEMORY[0x277CD1268]];

    v14 = *(a1 + 32);
    v15 = [*(a1 + 40) copy];
    [v14 respondWithPayload:v15];
  }
}

- (id)_createEventsPayload:(uint64_t)a1
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (a1)
  {
    v4 = objc_alloc_init(MEMORY[0x277CBEB18]);
    v14 = 0u;
    v15 = 0u;
    v16 = 0u;
    v17 = 0u;
    v5 = v3;
    v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v15;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v15 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = [*(*(&v14 + 1) + 8 * i) createPayload];
          [v4 addObject:v10];
        }

        v7 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
      }

      while (v7);
    }

    v11 = [v4 copy];
  }

  else
  {
    v11 = 0;
  }

  v12 = *MEMORY[0x277D85DE8];

  return v11;
}

- (id)_updateAndGetOwnedTriggers
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  v4 = [(HMDHome *)self triggers];
  v5 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v5)
  {
    v6 = *v14;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v13 + 1) + 8 * i);
        if ([v8 isOwnedByThisDevice])
        {
          v9 = [v8 uuid];
          [v3 addObject:v9];
        }
      }

      v5 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v5);
  }

  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_ownedTriggers setArray:v3];
  os_unfair_recursive_lock_unlock();
  v10 = [v3 copy];

  v11 = *MEMORY[0x277D85DE8];

  return v10;
}

- (void)_handleExecuteActionSet:(id)a3
{
  v11 = a3;
  v4 = [v11 uuidForKey:*MEMORY[0x277CD2050]];
  v5 = [(HMDHome *)self actionSetWithUUID:v4];
  if (v5 || isInternalBuild() && ([(HMDHome *)self triggerOwnedActionSetWithUUID:v4], (v5 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v6 = v5;
    v7 = [v5 type];
    if ([v7 isEqualToString:*MEMORY[0x277CCF1A0]])
    {
      v8 = isInternalBuild();

      if ((v8 & 1) == 0)
      {
        v9 = [v11 responseHandler];
        v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
        (v9)[2](v9, v10, 0);

        goto LABEL_10;
      }
    }

    else
    {
    }

    v9 = +[HMDDonationHandler sharedDonationHandler];
    [v9 donateActionSet:v6 withMessage:v11];
    [v6 execute:v11];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    v9 = [v11 responseHandler];
    (v9)[2](v9, v6, 0);
  }

LABEL_10:
}

- (void)executeActionSet:(id)a3
{
  v5 = a3;
  v6 = objc_alloc(MEMORY[0x277D0F770]);
  v7 = MEMORY[0x277CCACA8];
  v8 = MEMORY[0x22AAD2510](self, a2);
  v9 = [v7 stringWithFormat:@"%@, %s:%ld", v8, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 17891];
  v10 = [v6 initWithName:v9];

  v11 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __28__HMDHome_executeActionSet___block_invoke;
  block[3] = &unk_27868A010;
  block[4] = self;
  v15 = v5;
  v16 = v10;
  v12 = v10;
  v13 = v5;
  dispatch_async(v11, block);
}

void __28__HMDHome_executeActionSet___block_invoke(id *a1)
{
  objc_initWeak(&location, a1[4]);
  v7 = MEMORY[0x277D85DD0];
  v8 = 3221225472;
  v9 = __28__HMDHome_executeActionSet___block_invoke_2;
  v10 = &unk_278685F38;
  objc_copyWeak(&v13, &location);
  v11 = a1[5];
  v12 = a1[6];
  v2 = _Block_copy(&v7);
  if ([a1[4] _shouldWaitForAccessoriesToBeReachable])
  {
    v3 = [a1[5] uuidForKey:*MEMORY[0x277CD2050]];
    v4 = [a1[4] actionSetWithUUID:v3];
    v5 = [a1[4] workQueue];
    v6 = [HMDHomeAssistantOperation homeAssistantOperationWithActionSet:v4 queue:v5];

    [a1[4] _performOperation:v6 completion:v2];
  }

  else
  {
    v2[2](v2);
  }

  objc_destroyWeak(&v13);
  objc_destroyWeak(&location);
}

void __28__HMDHome_executeActionSet___block_invoke_2(id *a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    [a1[5] begin];
    [WeakRetained _handleExecuteActionSet:a1[4]];
    [a1[5] end];
  }

  else
  {
    v3 = [a1[4] responseHandler];

    if (v3)
    {
      v4 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      v5 = [a1[4] responseHandler];
      (v5)[2](v5, v4, 0);
    }

    v6 = objc_autoreleasePoolPush();
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot execute action set", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveActionSetModel:(id)a3 message:(id)a4
{
  v63 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v48 = a4;
  v46 = v6;
  v49 = [v6 uuid];
  v7 = [(HMDHome *)self actionSetWithUUID:v49];
  if (v7 || ([(HMDHome *)self triggerOwnedActionSetWithUUID:v49], (v7 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v8 = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __47__HMDHome__handleRemoveActionSetModel_message___block_invoke;
    block[3] = &unk_27868A750;
    block[4] = self;
    v9 = v49;
    v55 = v9;
    dispatch_async(v8, block);

    v10 = [(HMDHome *)self actionSetStateSubscriptionManager];
    [v10 stopAllMonitoringForActionSetUUID:v9 completion:&__block_literal_global_1600];

    v11 = [(HMDHome *)self actionSetStateObserver];
    [v11 stopMonitoringActionSet:v7];

    v12 = [v7 name];
    v13 = [(HMDHome *)self removeName:v12];

    v52 = 0u;
    v53 = 0u;
    v50 = 0u;
    v51 = 0u;
    v14 = [(HMDHome *)self triggers];
    v15 = [v14 countByEnumeratingWithState:&v50 objects:v58 count:16];
    if (v15)
    {
      v16 = *v51;
      do
      {
        v17 = 0;
        do
        {
          if (*v51 != v16)
          {
            objc_enumerationMutation(v14);
          }

          [*(*(&v50 + 1) + 8 * v17++) removeActionSet:v7 postUpdate:1];
        }

        while (v15 != v17);
        v15 = [v14 countByEnumeratingWithState:&v50 objects:v58 count:16];
      }

      while (v15);
    }

    v47 = [v48 transactionResult];
    [v47 markChanged];
    v18 = [v7 type];
    v19 = [v18 isEqualToString:*MEMORY[0x277CCF1A0]];

    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    v23 = os_log_type_enabled(v22, OS_LOG_TYPE_INFO);
    if (v19)
    {
      if (v23)
      {
        v24 = HMFGetLogIdentifier();
        v25 = [v7 name];
        *buf = 138543618;
        v60 = v24;
        v61 = 2112;
        v62 = v25;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Remove trigger owned action set: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)v21->_triggerOwnedActionSets removeObject:v7];
      os_unfair_recursive_lock_unlock();
    }

    else
    {
      if (v23)
      {
        v26 = HMFGetLogIdentifier();
        v27 = [v7 name];
        *buf = 138543618;
        v60 = v26;
        v61 = 2112;
        v62 = v27;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Remove action set: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)v21->_actionSets removeObject:v7];
      os_unfair_recursive_lock_unlock();
      [v47 markSaveToAssistant];
    }

    [v7 invalidate];
    v56[0] = *MEMORY[0x277CD0640];
    v28 = [(HMDHome *)v21 uuid];
    v29 = [v28 UUIDString];
    v57[0] = v29;
    v56[1] = *MEMORY[0x277CD2040];
    v30 = [v7 name];
    v57[1] = v30;
    v56[2] = *MEMORY[0x277CD2050];
    v31 = [v9 UUIDString];
    v57[2] = v31;
    v56[3] = *MEMORY[0x277CCF150];
    v32 = [v7 spiClientIdentifier];
    v33 = [v32 UUIDString];
    v57[3] = v33;
    v56[4] = *MEMORY[0x277CCF128];
    v34 = [v7 urlString];
    v57[4] = v34;
    v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v57 forKeys:v56 count:5];

    logAndPostNotification(@"HMDActionSetRemovedNotification", v21, v35);
    [v48 respondWithPayload:v35];
    v36 = objc_autoreleasePoolPush();
    v37 = v21;
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
    {
      v39 = HMFGetLogIdentifier();
      *buf = 138543618;
      v60 = v39;
      v61 = 2112;
      v62 = v35;
      _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Responding back to clients after removing actionSet: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v36);
  }

  else
  {
    v41 = objc_autoreleasePoolPush();
    v42 = self;
    v43 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v43, OS_LOG_TYPE_ERROR))
    {
      v44 = HMFGetLogIdentifier();
      v45 = [v49 UUIDString];
      *buf = 138543618;
      v60 = v44;
      v61 = 2112;
      v62 = v45;
      _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_ERROR, "%{public}@Count not find action set with UUID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v41);
    v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v48 respondWithError:v7];
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleRemoveActionSetModel_message___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) notificationRegistry];
  [v2 removeRegistrationsForActionSetUUID:*(a1 + 40)];
}

- (void)_handleRemoveActionSet:(id)a3
{
  v41 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD2050]];
  v6 = [(HMDHome *)self actionSetWithUUID:v5];
  v7 = v6;
  if (!v6)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v19;
      v39 = 2112;
      v40 = v5;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Did not find the action set with UUID : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
    goto LABEL_9;
  }

  v8 = [v6 type];
  v9 = [v8 isEqualToString:*MEMORY[0x277CCF1A0]];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v13;
      v39 = 2112;
      v40 = v7;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Removing this action Set is not supported. : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 48;
LABEL_9:
    v20 = [v14 hmErrorWithCode:v15];
    [v4 respondWithError:v20];
    goto LABEL_16;
  }

  v20 = +[HMDHome getBuiltinActionSets];
  v21 = [v7 type];
  v22 = [v20 objectForKey:v21];

  if (v22)
  {
    v23 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:83 userInfo:0];
    v24 = [v4 responseHandler];
    (v24)[2](v24, v23, 0);

    v25 = objc_autoreleasePoolPush();
    v26 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      v29 = [v7 type];
      v37 = 138543618;
      v38 = v28;
      v39 = 2112;
      v40 = v29;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Cannot remove built in action set : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v25);
    [v4 respondWithError:v23];
  }

  else
  {
    v30 = [HMDActionSetModel alloc];
    v31 = [(HMDHome *)self uuid];
    v23 = [(HMDBackingStoreModelObject *)v30 initWithObjectChangeType:3 uuid:v5 parentUUID:v31];

    v32 = [(HMDHome *)self backingStore];
    v33 = [v4 name];
    v34 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v35 = [v32 transaction:v33 options:v34];

    [v35 add:v23 withMessage:v4];
    [v35 run];
  }

LABEL_16:
  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddActionSetModel:(id)a3 message:(id)a4
{
  v56 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v47 = a4;
  v7 = self;
  v8 = v6;
  v9 = [v8 name];
  if (v9)
  {
    v10 = [v8 uuid];
    v11 = [v8 type];
    if (v11)
    {
      v12 = [v8 type];
    }

    else
    {
      v12 = *MEMORY[0x277CCF1A8];
    }

    v17 = v12;

    v48 = [(HMDHome *)v7 createActionSetWithName:v9 uuid:v10 type:v17];
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = v7;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v16;
      *&buf[12] = 2112;
      *&buf[14] = v8;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@ActionSet model does not have a name %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v48 = 0;
  }

  if (v48)
  {
    v46 = [v47 transactionResult];
    [v46 markChanged];
    v18 = [v8 type];
    v19 = [v18 isEqualToString:*MEMORY[0x277CCF1A0]];

    os_unfair_recursive_lock_lock_with_options();
    if (v19)
    {
      v20 = v48;
      [(NSMutableArray *)v7->_triggerOwnedActionSets addObject:v48];
      os_unfair_recursive_lock_unlock();
    }

    else
    {
      [(NSMutableArray *)v7->_actionSets addObject:v48];
      os_unfair_recursive_lock_unlock();
      v25 = [v48 actions];
      v26 = [v25 count];

      v20 = v48;
      if (v26)
      {
        [v46 markSaveToAssistant];
        v20 = v48;
      }
    }

    v27 = v7;
    v28 = v20;
    v45 = v47;
    context = objc_autoreleasePoolPush();
    v53[0] = *MEMORY[0x277CD0640];
    v29 = [(HMDHome *)v27 uuid];
    v30 = [v29 UUIDString];
    *buf = v30;
    v53[1] = *MEMORY[0x277CD2040];
    v31 = [v28 name];
    *&buf[8] = v31;
    v53[2] = *MEMORY[0x277CD2050];
    v32 = [v28 uuid];
    v33 = [v32 UUIDString];
    *&buf[16] = v33;
    v53[3] = *MEMORY[0x277CD2048];
    v34 = [v28 type];
    v55 = v34;
    v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:buf forKeys:v53 count:4];

    v36 = objc_autoreleasePoolPush();
    v37 = v27;
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
    {
      v39 = HMFGetLogIdentifier();
      *v49 = 138543618;
      v50 = v39;
      v51 = 2112;
      v52 = v35;
      _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Add action set finished. Responding to clients with : %@", v49, 0x16u);
    }

    objc_autoreleasePoolPop(v36);
    v40 = [MEMORY[0x277CBEB38] dictionaryWithDictionary:v35];
    [v40 setObject:v28 forKeyedSubscript:@"HMDActionSetNotificationKey"];
    v41 = [(HMDHome *)v37 notificationCenter];
    v42 = [v40 copy];
    [v41 postNotificationName:@"HMDActionSetAddedNotification" object:v37 userInfo:v42];

    [v45 respondWithPayload:v35];
    objc_autoreleasePoolPop(context);
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = v7;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v24;
      *&buf[12] = 2112;
      *&buf[14] = v47;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to create action set model. %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v21);
  }

  v43 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddHomeOwnedActionSet:(id)a3
{
  v51 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v45 = 138543362;
    v46 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding Home owned action set", &v45, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = *MEMORY[0x277CD2040];
  v10 = [v4 stringForKey:*MEMORY[0x277CD2040]];
  v11 = [(HMDHome *)v6 actionSetWithName:v10];
  if (v11)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = v6;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v45 = 138543618;
      v46 = v15;
      v47 = 2112;
      v48 = v10;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@ as it already exists.", &v45, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v16 = MEMORY[0x277CCA9B8];
    v17 = 1;
LABEL_15:
    v22 = [v16 hmErrorWithCode:v17];
LABEL_16:
    [v4 respondWithError:v22];
    goto LABEL_17;
  }

  v18 = [(HMDHome *)v6 actionSets];
  v19 = [v18 count];
  v20 = maximumActionSetsPerHome;

  if (v19 >= v20)
  {
    v27 = objc_autoreleasePoolPush();
    v28 = v6;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      v30 = HMFGetLogIdentifier();
      v45 = 138543618;
      v46 = v30;
      v47 = 2112;
      v48 = v10;
      _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; already at maximum action sets for home", &v45, 0x16u);
    }

    objc_autoreleasePoolPop(v27);
    v16 = MEMORY[0x277CCA9B8];
    v17 = 49;
    goto LABEL_15;
  }

  v21 = [(HMDHome *)v6 addActionSetName:v10];
  if (v21)
  {
    v22 = v21;
    v23 = objc_autoreleasePoolPush();
    v24 = v6;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      v45 = 138543874;
      v46 = v26;
      v47 = 2112;
      v48 = v10;
      v49 = 2112;
      v50 = v22;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; namespace error %@", &v45, 0x20u);
    }

    objc_autoreleasePoolPop(v23);
    goto LABEL_16;
  }

  v32 = [HMDActionSetModel alloc];
  v33 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
  v34 = [(HMDHome *)v6 uuid];
  v35 = [(HMDBackingStoreModelObject *)v32 initWithObjectChangeType:1 uuid:v33 parentUUID:v34];

  v36 = [v4 stringForKey:v9];
  [(HMDActionSetModel *)v35 setName:v36];

  v37 = [v4 stringForKey:*MEMORY[0x277CD2048]];
  v38 = v37;
  v39 = *MEMORY[0x277CCF1A8];
  if (v37)
  {
    v40 = v37;
  }

  else
  {
    v40 = *MEMORY[0x277CCF1A8];
  }

  [(HMDActionSetModel *)v35 setType:v40];
  v41 = [(HMDHome *)v6 backingStore];
  v42 = [v4 name];
  v43 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v44 = [v41 transaction:v42 options:v43];

  [v44 add:v35 withMessage:v4];
  [v44 run];

  v22 = 0;
LABEL_17:

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTriggerOwnedActionSet:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding trigger owned action set", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDActionSetModel alloc];
  v10 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
  v11 = [(HMDHome *)v6 uuid];
  v12 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:1 uuid:v10 parentUUID:v11];

  v13 = [v4 stringForKey:*MEMORY[0x277CD2040]];
  [(HMDActionSetModel *)v12 setName:v13];

  [(HMDActionSetModel *)v12 setType:*MEMORY[0x277CCF1A0]];
  v14 = [(HMDHome *)v6 backingStore];
  v15 = [v4 name];
  v16 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v17 = [v14 transaction:v15 options:v16];

  [v17 add:v12 withMessage:v4];
  [v17 run];

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddActionSetFromBuilder:(id)a3
{
  v58 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v53 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding Home owned action set (from builder)", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
  v10 = v9;
  if (v9)
  {
    v11 = v9;
  }

  else
  {
    v11 = [MEMORY[0x277CCAD78] UUID];
  }

  v12 = v11;

  v13 = [v4 stringForKey:*MEMORY[0x277CD2048]];
  v14 = v13;
  v15 = *MEMORY[0x277CCF1A8];
  if (v13)
  {
    v15 = v13;
  }

  v16 = v15;

  v17 = [v4 stringForKey:*MEMORY[0x277CD2040]];
  v18 = [(HMDHome *)v6 actionSetWithName:v17];
  if (!v18)
  {
    v25 = [(HMDHome *)v6 actionSets];
    v26 = [v25 count];
    v27 = maximumActionSetsPerHome;

    if (v26 >= v27)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = v6;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543618;
        v53 = v36;
        v54 = 2112;
        v55 = v17;
        _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; already at maximum action sets for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v33);
      v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    }

    else
    {
      v28 = [(HMDHome *)v6 addActionSetName:v17];
      if (!v28)
      {
        v38 = [(HMDHome *)v6 backingStore];
        v39 = [v4 name];
        v40 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v41 = [v38 transaction:v39 options:v40];

        v42 = [v4 messagePayload];
        v50 = 0;
        v51 = 0;
        v43 = [(HMDHome *)v6 _createActionSetWithUUID:v12 name:v17 type:v16 fromDictionary:v42 transaction:v41 response:&v51 error:&v50];
        v44 = v51;
        v19 = v50;

        if (v43)
        {
          v46[0] = MEMORY[0x277D85DD0];
          v46[1] = 3221225472;
          v46[2] = __42__HMDHome__handleAddActionSetFromBuilder___block_invoke;
          v46[3] = &unk_278683340;
          v46[4] = v6;
          v47 = v17;
          v48 = v4;
          v49 = v44;
          [v41 run:v46];
        }

        else
        {
          v45 = [(HMDHome *)v6 removeName:v17];
          [v4 respondWithError:v19];
        }

        goto LABEL_21;
      }

      v19 = v28;
      v29 = objc_autoreleasePoolPush();
      v30 = v6;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543874;
        v53 = v32;
        v54 = 2112;
        v55 = v17;
        v56 = 2112;
        v57 = v19;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; namespace error %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
    }

    [v4 respondWithError:v19];
    goto LABEL_21;
  }

  v19 = v18;
  v20 = objc_autoreleasePoolPush();
  v21 = v6;
  v22 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
  {
    v23 = HMFGetLogIdentifier();
    *buf = 138543618;
    v53 = v23;
    v54 = 2112;
    v55 = v17;
    _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@ as it already exists.", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v20);
  v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:1];
  [v4 respondWithError:v24];

LABEL_21:
  v37 = *MEMORY[0x277D85DE8];
}

void __42__HMDHome__handleAddActionSetFromBuilder___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  if (v4)
  {
    v3 = [*(a1 + 32) removeName:*(a1 + 40)];
    [*(a1 + 48) respondWithError:v4];
  }

  else
  {
    [*(a1 + 48) respondWithPayload:*(a1 + 56)];
  }
}

- (void)_handleAddActionSet:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v23 = 138543618;
    v24 = v8;
    v25 = 2112;
    v26 = v4;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received a request to add a new action set : %@", &v23, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 stringForKey:*MEMORY[0x277CD2048]];
  if (!v9)
  {
    v9 = *MEMORY[0x277CCF1A8];
  }

  v10 = [v4 stringForKey:*MEMORY[0x277CD2040]];
  v11 = HMMaxLengthForNaming();
  if ([v10 length] <= v11)
  {
    v17 = [(HMDHome *)v6 logEventSubmitter];
    v18 = [HMDAddActionSetLogEvent alloc];
    v19 = [(HMDHome *)v6 uuid];
    v20 = [(HMDAddActionSetLogEvent *)v18 initWithActionSetType:v9 homeUUID:v19];
    [v17 submitLogEvent:v20];

    v21 = [v4 name];
    LODWORD(v20) = [v21 isEqualToString:*MEMORY[0x277CCF1E8]];

    if (v20)
    {
      [(HMDHome *)v6 _handleAddActionSetFromBuilder:v4];
    }

    else if ([v9 isEqualToString:*MEMORY[0x277CCF1A0]])
    {
      [(HMDHome *)v6 _handleAddTriggerOwnedActionSet:v4];
    }

    else
    {
      [(HMDHome *)v6 _handleAddHomeOwnedActionSet:v4];
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = v6;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v23 = 138543362;
      v24 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v23, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
    [v4 respondWithError:v16];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (id)builtInActionSetInfo
{
  v3 = [MEMORY[0x277CBEB18] array];
  v4 = [(HMDHome *)self workQueue];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __31__HMDHome_builtInActionSetInfo__block_invoke;
  v9[3] = &unk_27868A750;
  v9[4] = self;
  v5 = v3;
  v10 = v5;
  dispatch_sync(v4, v9);

  v6 = v10;
  v7 = v5;

  return v5;
}

void __31__HMDHome_builtInActionSetInfo__block_invoke(uint64_t a1)
{
  v29 = *MEMORY[0x277D85DE8];
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v1 = [*(a1 + 32) actionSets];
  v2 = [v1 countByEnumeratingWithState:&v22 objects:v28 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = *v23;
    v5 = *MEMORY[0x277CCF1A8];
    v19 = *MEMORY[0x277CD2048];
    v20 = *MEMORY[0x277CD2040];
    v18 = *MEMORY[0x277CD2050];
    do
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v23 != v4)
        {
          objc_enumerationMutation(v1);
        }

        v7 = *(*(&v22 + 1) + 8 * i);
        v8 = [v7 type];
        if (v8)
        {
          v9 = v8;
          v10 = [v7 type];
          v11 = [v10 isEqualToString:v5];

          if ((v11 & 1) == 0)
          {
            v26[0] = v20;
            v12 = [v7 name];
            v27[0] = v12;
            v26[1] = v19;
            v13 = [v7 type];
            v27[1] = v13;
            v26[2] = v18;
            v14 = [v7 uuid];
            v15 = [v14 UUIDString];
            v27[2] = v15;
            v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:v26 count:3];

            [*(a1 + 40) addObject:v16];
          }
        }
      }

      v3 = [v1 countByEnumeratingWithState:&v22 objects:v28 count:16];
    }

    while (v3);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)test_addTriggerOwnedActionSets:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_triggerOwnedActionSets addObjectsFromArray:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)triggerOwnedActionSets
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_triggerOwnedActionSets copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)test_addActionSets:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_actionSets addObjectsFromArray:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)actionSets
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_actionSets copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleRemoveServiceGroupModel:(id)a3 message:(id)a4
{
  v34 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v27 = v6;
  v8 = [v6 uuid];
  v9 = [(HMDHome *)self serviceGroupWithUUID:v8];
  v10 = v9;
  if (v9)
  {
    v11 = [v9 name];
    v12 = [(HMDHome *)self removeName:v11];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_serviceGroups removeObject:v10];
    os_unfair_recursive_lock_unlock();
    v13 = [v7 transactionResult];
    [v13 markChanged];
    [v13 markSaveToAssistant];
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v10 name];
      *buf = 138543618;
      v31 = v17;
      v32 = 2112;
      v33 = v18;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Removed service group: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v28[0] = *MEMORY[0x277CD25C0];
    v19 = [v10 name];
    v29[0] = v19;
    v28[1] = *MEMORY[0x277CD25E0];
    v20 = [v10 uuid];
    v21 = [v20 UUIDString];
    v29[1] = v21;
    v28[2] = *MEMORY[0x277CD0D58];
    v22 = [v10 spiClientIdentifier];
    v23 = [v22 UUIDString];
    v29[2] = v23;
    v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:3];

    logAndPostNotification(@"HMDServiceGroupRemovedNotification", v10, v24);
    [v7 respondWithSuccess];
  }

  else
  {
    v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v7 respondWithError:v25];
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveServiceGroup:(id)a3
{
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD25E0]];
  v6 = [(HMDHome *)self serviceGroupWithUUID:v5];
  if (v6)
  {
    v7 = [HMDServiceGroupModel alloc];
    v8 = [(HMDHome *)self uuid];
    v9 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v5 parentUUID:v8];

    v10 = [(HMDHome *)self backingStore];
    v11 = [v4 name];
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [v10 transaction:v11 options:v12];

    [v13 add:v9];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __37__HMDHome__handleRemoveServiceGroup___block_invoke;
    v14[3] = &unk_27868A250;
    v15 = v4;
    [v13 run:v14];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v9];
  }
}

- (void)_handleAddServiceGroupModel:(id)a3 message:(id)a4
{
  v40 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 name];
  v9 = [v6 uuid];
  v10 = v9;
  if (v8 && v9)
  {
    v33 = [v8 hm_truncatedNameString];

    v11 = [HMDServiceGroup alloc];
    v12 = [(HMDHome *)self workQueue];
    v13 = [(HMDServiceGroup *)v11 initWithName:v33 uuid:v10 home:self queue:v12];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_serviceGroups addObject:v13];
    os_unfair_recursive_lock_unlock();
    v14 = [(HMDHome *)self msgDispatcher];
    v15 = [(HMDHome *)self workQueue];
    [(HMDServiceGroup *)v13 configure:v14 queue:v15];

    v16 = [(HMDServiceGroup *)v13 updateServiceGroupWithModel:v6 message:v7];
    v17 = [v7 transactionResult];
    [v17 markChanged];
    v18 = [(HMDServiceGroup *)v13 serviceUUIDs];
    v19 = [v18 count];

    if (v19)
    {
      [v17 markSaveToAssistant];
    }

    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v23;
      v38 = 2112;
      v39 = v33;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Added service group: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v34[0] = *MEMORY[0x277CD25C0];
    v24 = [(HMDServiceGroup *)v13 name];
    v35[0] = v24;
    v34[1] = *MEMORY[0x277CD25E0];
    v25 = [(HMDServiceGroup *)v13 uuid];
    v26 = [v25 UUIDString];
    v35[1] = v26;
    v27 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:2];

    logAndPostNotification(@"HMDServiceGroupAddedNotification", v13, v27);
    [v7 respondWithPayload:0 error:v16];

    v8 = v33;
  }

  else
  {
    v28 = objc_autoreleasePoolPush();
    v29 = self;
    v30 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
    {
      v31 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v31;
      v38 = 2112;
      v39 = v8;
      _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; invalid parameter", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v28);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v7 respondWithError:v13];
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddServiceGroup:(id)a3
{
  v47 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CD25C0]];
  if (v5)
  {
    v6 = HMMaxLengthForNaming();
    if ([v5 length] > v6)
    {
      v7 = objc_autoreleasePoolPush();
      v8 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543362;
        v42 = v10;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v7);
      v11 = MEMORY[0x277CCA9B8];
      v12 = 46;
      goto LABEL_7;
    }

    v13 = [(HMDHome *)self serviceGroupWithName:v5];
    if (v13)
    {
      v14 = MEMORY[0x277CCA9B8];
      v15 = 1;
    }

    else
    {
      v16 = [(HMDHome *)self serviceGroups];
      v17 = [v16 count];
      v18 = maximumServiceGroupsPerHome;

      if (v17 < v18)
      {
        v19 = [(HMDHome *)self addName:v5];
        if (!v19)
        {
          v29 = [HMDServiceGroupModel alloc];
          v30 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
          v31 = [(HMDHome *)self uuid];
          v32 = [(HMDBackingStoreModelObject *)v29 initWithObjectChangeType:1 uuid:v30 parentUUID:v31];

          [(HMDServiceGroupModel *)v32 setName:v5];
          v33 = [(HMDHome *)self backingStore];
          v34 = [v4 name];
          v35 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v36 = [v33 transaction:v34 options:v35];

          [v36 add:v32];
          v38[0] = MEMORY[0x277D85DD0];
          v38[1] = 3221225472;
          v38[2] = __34__HMDHome__handleAddServiceGroup___block_invoke;
          v38[3] = &unk_27868A1D8;
          v39 = v4;
          v40 = v32;
          v37 = v32;
          [v36 run:v38];

          goto LABEL_20;
        }

        v20 = objc_autoreleasePoolPush();
        v21 = self;
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
        {
          v23 = HMFGetLogIdentifier();
          *buf = 138543874;
          v42 = v23;
          v43 = 2112;
          v44 = v5;
          v45 = 2112;
          v46 = v19;
          _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; namespace error %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v20);
LABEL_19:
        [v4 respondWithError:v19];
LABEL_20:

        goto LABEL_21;
      }

      v24 = objc_autoreleasePoolPush();
      v25 = self;
      v26 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        v27 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v27;
        v43 = 2112;
        v44 = v5;
        _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; already at maximum service groups for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v24);
      v14 = MEMORY[0x277CCA9B8];
      v15 = 49;
    }

    v19 = [v14 hmErrorWithCode:v15];
    goto LABEL_19;
  }

  v11 = MEMORY[0x277CCA9B8];
  v12 = 20;
LABEL_7:
  v13 = [v11 hmErrorWithCode:v12];
  [v4 respondWithError:v13];
LABEL_21:

  v28 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddServiceGroup___block_invoke(uint64_t a1, uint64_t a2)
{
  v12[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v11[0] = *MEMORY[0x277CD25C0];
    v6 = [*(a1 + 40) name];
    v12[0] = v6;
    v11[1] = *MEMORY[0x277CD25E0];
    v7 = [*(a1 + 40) uuid];
    v8 = [v7 UUIDString];
    v12[1] = v8;
    v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:v11 count:2];
    [v2 respondWithPayload:v9];

    v10 = *MEMORY[0x277D85DE8];
  }
}

- (void)test_addServiceGroups:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_serviceGroups addObjectsFromArray:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)serviceGroups
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_serviceGroups copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)updateHomeFirstHAPAccessoryAddedDateToNow
{
  v3 = [HMDHomeModel alloc];
  v4 = [(HMDHome *)self uuid];
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 uuid];
  v11 = [(HMDBackingStoreModelObject *)v3 initWithObjectChangeType:2 uuid:v4 parentUUID:v6];

  v7 = objc_alloc_init(MEMORY[0x277CBEAA8]);
  [(HMDHomeModel *)v11 setFirstHAPAccessoryAddedDate:v7];

  v8 = [(HMDHome *)self backingStore];
  v9 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v10 = [v8 transaction:@"updateHomeFirstHAPAccessoryAddedDate" options:v9];

  [v10 add:v11];
  [v10 run];
}

- (void)_processAccessoriesToAddForUnpairedAccessory:(id)a3 certificationStatus:(int64_t)a4 accessoryServer:(id)a5 networkCredential:(id)a6 pairingEvent:(id)a7 message:(id)a8 completionHandler:(id)a9
{
  v15 = a3;
  v38 = a5;
  v37 = a6;
  v16 = a7;
  v17 = a8;
  v18 = a9;
  v19 = objc_alloc(MEMORY[0x277D0F770]);
  v20 = MEMORY[0x277CCACA8];
  v21 = MEMORY[0x22AAD2510](self, a2);
  v22 = [v20 stringWithFormat:@"%@, %s:%ld", v21, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 16894];
  v40 = [v19 initWithName:v22];

  v23 = v15;
  if (self)
  {
    v24 = [(HMDHome *)self currentAccessory];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v25 = v24;
    }

    else
    {
      v25 = 0;
    }

    v26 = v25;

    v27 = 0;
    if (v23 && v26)
    {
      v28 = [v26 sensorAccessoryUUID];
      v29 = [v28 hmf_isEqualToUUID:v23];

      if (v29)
      {
        v30 = [v26 uuid];
        v27 = [MKFModelFactory createAppleMediaAccessoryModelWithModelID:v30];

        v31 = [v26 room];
        v32 = [v31 uuid];
        v33 = [MKFModelFactory createRoomModelWithModelID:v32];
        [v27 setRoom:v33];
      }

      else
      {
        v27 = 0;
      }
    }
  }

  else
  {
    v27 = 0;
  }

  v34 = [v27 modelID];
  v35 = [[HMDNewPairedAccessoryServerInfo alloc] initWithServer:v38 home:self primaryAccessoryUUID:v23 certificationStatus:a4 hostAccessory:v27 networkCredential:v37 pairingEvent:v16];
  [v40 begin];
  v39 = v40;
  [(HMDHome *)self _processNewlyPairedAccessoryServerInfo:v35 message:v17 completionHandler:v18];
  __HMFActivityScopeLeave();

  __HMFActivityScopeLeave();
}

- (id)_removeUserFromNewlyPairedAccessoryServer:(id)a3 user:(id)a4
{
  v22 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = [v6 identifier];
    *v19 = 138543618;
    *&v19[4] = v11;
    v20 = 2112;
    v21 = v12;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Removing user from newly paired accessory server: %@", v19, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  *v19 = 0;
  v13 = [MEMORY[0x277D0F7C0] futureWithPromise:v19];
  if ([v7 isCurrentUser])
  {
    v14 = [(HMDHome *)v9 workQueue];
    v15 = [*v19 errorOnlyResolverBlock];
    [v6 removePairingForCurrentControllerOnQueue:v14 completion:v15];
  }

  else
  {
    v14 = [v7 pairingIdentity];
    v15 = [(HMDHome *)v9 workQueue];
    v16 = [*v19 errorOnlyResolverBlock];
    [v6 removePairing:v14 completionQueue:v15 completionHandler:v16];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)_addOwnerToNewlyPairedAccessoryServer:(id)a3
{
  v25 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 identifier];
    *buf = 138543618;
    *&buf[4] = v8;
    v23 = 2112;
    v24 = v9;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding owner to newly paired accessory server: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  if ([(HMDHome *)v6 isSharedAdmin])
  {
    *buf = 0;
    v10 = [MEMORY[0x277D0F7C0] futureWithPromise:buf];
    v11 = objc_alloc(MEMORY[0x277D0F7A8]);
    v12 = [(HMDHome *)v6 workQueue];
    v13 = [v11 initWithQueue:v12];

    v14 = [v10 ignoreErrors];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __49__HMDHome__addOwnerToNewlyPairedAccessoryServer___block_invoke;
    v20[3] = &unk_278687050;
    v20[4] = v6;
    v21 = v4;
    v15 = [v14 inContext:v13 then:v20];
  }

  else
  {
    v16 = MEMORY[0x277D0F7C0];
    v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    v15 = [v16 futureWithError:v17];
  }

  v18 = *MEMORY[0x277D85DE8];

  return v15;
}

uint64_t __49__HMDHome__addOwnerToNewlyPairedAccessoryServer___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) owner];
  v5 = [v4 pairingIdentity];

  v6 = objc_alloc(MEMORY[0x277CFEC20]);
  v7 = [v5 identifier];
  v8 = [v5 publicKey];
  v9 = [v6 initWithIdentifier:v7 publicKey:v8 privateKey:0 permissions:1];

  v21 = 0;
  v10 = [MEMORY[0x277D0F7C0] futureWithPromise:&v21];
  v11 = *(a1 + 40);
  v12 = [*(a1 + 32) workQueue];
  v13 = [v21 errorOnlyResolverBlock];
  [v11 addPairing:v9 completionQueue:v12 completionHandler:v13];

  v14 = v10;
  if (v14)
  {
    v15 = v14;

    return 3;
  }

  else
  {
    v17 = _HMFPreconditionFailure();
    return [(HMDHome *)v17 _readDataNeededImmediatelyAfterPairing:v18 intoModel:v19, v20];
  }
}

- (id)_readDataNeededImmediatelyAfterPairing:(id)a3 intoModel:(id)a4
{
  v43 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [v8 UUID];
    *buf = 138543618;
    v38 = v12;
    v39 = 2112;
    v40 = v13;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Reading data needed immediately after pairing", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = [v6 server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = v14;
  }

  else
  {
    v15 = 0;
  }

  v16 = v15;

  if (v16)
  {
    v17 = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
    v18 = [v16 createDoorLockClusterObjectWithFlow:v17];
    v29 = MEMORY[0x277D85DD0];
    v30 = 3221225472;
    v31 = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke;
    v32 = &unk_278670130;
    v33 = v8;
    v34 = v7;
    v35 = v10;
    v36 = v16;
    v19 = [v18 then:&v29];
    v20 = [v19 ignoreOutcome];
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = v10;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      v25 = [v8 UUID];
      v26 = [v6 server];
      *buf = 138543874;
      v38 = v24;
      v39 = 2112;
      v40 = v25;
      v41 = 2112;
      v42 = v26;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] The accessory server is not a HMMTRAccessoryServer. server: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v21);
    v20 = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v27 = *MEMORY[0x277D85DE8];

  return v20;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 fetchAccessorySupportsPinCodesWithFlow:*(a1 + 32)];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2;
  v45[3] = &unk_278679B80;
  v5 = *(a1 + 40);
  v6 = *(a1 + 48);
  v46 = v5;
  v47 = v6;
  v48 = *(a1 + 32);
  v29 = v4;
  v7 = [v4 then:v45];
  v8 = [v7 ignoreOutcome];
  v40[0] = MEMORY[0x277D85DD0];
  v40[1] = 3221225472;
  v40[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1557;
  v40[3] = &unk_2786868C8;
  v9 = v3;
  v41 = v9;
  v10 = *(a1 + 40);
  v11 = *(a1 + 48);
  v42 = v10;
  v43 = v11;
  v44 = *(a1 + 32);
  v12 = [v8 then:v40];
  v13 = [v12 ignoreOutcome];
  v35[0] = MEMORY[0x277D85DD0];
  v35[1] = 3221225472;
  v35[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1559;
  v35[3] = &unk_2786868C8;
  v14 = v9;
  v36 = v14;
  v37 = *(a1 + 32);
  v15 = *(a1 + 40);
  v16 = *(a1 + 48);
  v38 = v15;
  v39 = v16;
  v17 = [v13 then:v35];
  v18 = [v17 ignoreOutcome];
  v31[0] = MEMORY[0x277D85DD0];
  v31[1] = 3221225472;
  v31[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1564;
  v31[3] = &unk_278670108;
  v19 = v14;
  v32 = v19;
  v20 = *(a1 + 40);
  v21 = *(a1 + 32);
  v30 = *(a1 + 48);
  v22 = *(&v30 + 1);
  *&v23 = v20;
  *(&v23 + 1) = v21;
  v33 = v23;
  v34 = v30;
  v24 = [v18 then:v31];
  if (v24)
  {
    v25 = v24;

    return 3;
  }

  else
  {
    v27 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2(v27, v28);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2(id *a1, void *a2)
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [a1[4] supportsMatterAccessCode];
  v5 = HMFEqualObjects();

  if ((v5 & 1) == 0)
  {
    [a1[4] setSupportsMatterAccessCode:v3];
    v6 = objc_autoreleasePoolPush();
    v7 = a1[5];
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [a1[6] UUID];
      v13 = 138543874;
      v14 = v9;
      v15 = 2112;
      v16 = v10;
      v17 = 2112;
      v18 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsPinCodes: %@", &v13, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1557(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) fetchAccessorySupportsTapToUnlock];
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1558;
  v12[3] = &unk_278679B80;
  v5 = *(a1 + 40);
  v6 = *(a1 + 48);
  v7 = *(a1 + 56);
  v13 = v5;
  v14 = v6;
  v15 = v7;
  v8 = [v4 then:v12];
  if (v8)
  {
    v9 = v8;

    return 3;
  }

  else
  {
    v11 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1559(v11);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1559(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) fetchFeatureMapForSupportingWeekAndYearDayScheduleWithFlow:*(a1 + 40)];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1560;
  v14[3] = &unk_27867C338;
  *&v5 = *(a1 + 48);
  *(&v5 + 1) = *(a1 + 56);
  v13 = v5;
  v6 = *(a1 + 40);
  v7 = *(a1 + 32);
  *&v8 = v6;
  *(&v8 + 1) = v7;
  v15 = v13;
  v16 = v8;
  v9 = [v4 then:v14];
  if (v9)
  {
    v10 = v9;

    return 3;
  }

  else
  {
    v12 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1564(v12);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1564(uint64_t a1, void *a2)
{
  v26 = a2;
  v3 = [*(a1 + 32) fetchReaderGroupSubIdentifier];
  v37[0] = MEMORY[0x277D85DD0];
  v37[1] = 3221225472;
  v37[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1565;
  v37[3] = &unk_278670068;
  v38 = *(a1 + 40);
  v4 = [v3 then:v37];
  v5 = [v4 ignoreOutcome];
  v34[0] = MEMORY[0x277D85DD0];
  v34[1] = 3221225472;
  v34[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_3;
  v34[3] = &unk_2786868C8;
  v6 = *(a1 + 32);
  v7 = *(a1 + 48);
  *&v8 = *(a1 + 40);
  *(&v8 + 1) = *(a1 + 56);
  *&v9 = v6;
  *(&v9 + 1) = v7;
  v35 = v9;
  v36 = v8;
  v10 = [v5 then:v34];
  v11 = [v10 ignoreOutcome];
  v31[0] = MEMORY[0x277D85DD0];
  v31[1] = 3221225472;
  v31[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1567;
  v31[3] = &unk_278686878;
  v12 = *(a1 + 32);
  v13 = *(a1 + 48);
  *&v14 = *(a1 + 40);
  *(&v14 + 1) = *(a1 + 56);
  *&v15 = v12;
  *(&v15 + 1) = v13;
  v32 = v15;
  v33 = v14;
  v16 = [v11 then:v31];
  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1571;
  v27[3] = &unk_2786700E0;
  v17 = *(a1 + 32);
  v18 = *(a1 + 48);
  *&v19 = *(a1 + 40);
  *(&v19 + 1) = *(a1 + 56);
  *&v20 = v17;
  *(&v20 + 1) = v18;
  v28 = v20;
  v29 = v19;
  v30 = *(a1 + 64);
  v21 = [v16 then:v27];
  if (v21)
  {
    v22 = v21;

    return 3;
  }

  else
  {
    v24 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1565(v24, v25);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_3(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) fetchAccessorySupportsAliroProvisioningWithFlow:*(a1 + 40)];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_4;
  v11[3] = &unk_278679B80;
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v12 = v5;
  v13 = v6;
  v14 = *(a1 + 40);
  v7 = [v4 then:v11];
  if (v7)
  {
    v8 = v7;

    return 3;
  }

  else
  {
    v10 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1567(v10);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1567(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) readAliroSupportedVersionWithFlow:*(a1 + 40)];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1568;
  v11[3] = &unk_278670090;
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v12 = v5;
  v13 = v6;
  v14 = *(a1 + 40);
  v7 = [v4 then:v11];
  if (v7)
  {
    v8 = v7;

    return 3;
  }

  else
  {
    v10 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1571(v10);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1571(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) fetchAccessorySupportsAliroBLEUWBWithFlow:*(a1 + 40)];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1572;
  v15[3] = &unk_27867C338;
  *&v5 = *(a1 + 48);
  *(&v5 + 1) = *(a1 + 56);
  v14 = v5;
  v6 = *(a1 + 40);
  v7 = *(a1 + 64);
  *&v8 = v6;
  *(&v8 + 1) = v7;
  v16 = v14;
  v17 = v8;
  v9 = [v4 then:v15];
  if (v9)
  {
    v10 = v9;

    return 3;
  }

  else
  {
    v12 = _HMFPreconditionFailure();
    return __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1572(v12, v13);
  }
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1572(id *a1, void *a2)
{
  v34 = *MEMORY[0x277D85DE8];
  v3 = a2;
  [a1[4] setSupportsMatCredACB:v3];
  v4 = objc_autoreleasePoolPush();
  v5 = a1[5];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [a1[6] UUID];
    *buf = 138543874;
    v29 = v7;
    v30 = 2112;
    v31 = v8;
    v32 = 2112;
    v33 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsMatCredACB: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = objc_autoreleasePoolPush();
  v10 = a1[5];
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [a1[6] UUID];
    *buf = 138543618;
    v29 = v12;
    v30 = 2112;
    v31 = v13;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Checking if this matter lock is MFi approved", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = [a1[5] dataSource];
  v15 = [v14 makeAccessoryMatterCapabilitiesForFilename:0];

  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1573;
  v25[3] = &unk_2786700B8;
  *&v16 = a1[7];
  *(&v16 + 1) = a1[5];
  v24 = v16;
  v17 = a1[6];
  v18 = a1[4];
  *&v19 = v17;
  *(&v19 + 1) = v18;
  v26 = v24;
  v27 = v19;
  v20 = [v15 then:v25];
  if (!v20)
  {
    _HMFPreconditionFailure();
  }

  v21 = v20;

  v22 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1573(id *a1, void *a2)
{
  v28 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [a1[4] vendorID];
  v5 = [v4 intValue];
  v6 = [a1[4] productID];
  v7 = [v3 isCapabilityAllowed:0 vendorID:v5 productID:{objc_msgSend(v6, "intValue")}];

  v8 = objc_autoreleasePoolPush();
  v9 = a1[5];
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = [a1[6] UUID];
    v13 = [a1[4] vendorID];
    v14 = [a1[4] productID];
    v18 = 138544386;
    v19 = v11;
    v20 = 2112;
    v21 = v12;
    v22 = 2112;
    v23 = v13;
    v24 = 2112;
    v25 = v14;
    v26 = 1024;
    v27 = v7;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] ECB lock with VID %@, PID %@ is certified: %{BOOL}d", &v18, 0x30u);
  }

  objc_autoreleasePoolPop(v8);
  v15 = [MEMORY[0x277CCABB0] numberWithBool:v7];
  [a1[7] setMfiCertifiedACWG:v15];

  v16 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1568(id *a1, void *a2)
{
  v29 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 expeditedTransactionSupportedVersions];
  v5 = [HMDAliroVersionUtilities concatenate:v4];
  [a1[4] setExpeditedTransactionSupportedVersions:v5];

  v6 = [v3 bleUWBSupportedVersions];
  v7 = [HMDAliroVersionUtilities concatenate:v6];
  [a1[4] setBleUWBSupportedVersions:v7];

  v8 = [v3 bleAdvertisingVersion];
  [a1[4] setBleAdvertisingVersion:v8];

  v9 = objc_autoreleasePoolPush();
  v10 = a1[5];
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [a1[6] UUID];
    v14 = [a1[4] expeditedTransactionSupportedVersions];
    v15 = [a1[4] bleUWBSupportedVersions];
    v16 = [a1[4] bleAdvertisingVersion];
    v19 = 138544386;
    v20 = v12;
    v21 = 2112;
    v22 = v13;
    v23 = 2112;
    v24 = v14;
    v25 = 2112;
    v26 = v15;
    v27 = 2112;
    v28 = v16;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] expeditedTransactionSupportedVersions: %@, bleUWBSupportedVersions: %@, bleAdvertisingVersion: %@", &v19, 0x34u);
  }

  objc_autoreleasePoolPop(v9);
  v17 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_4(id *a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  [a1[4] setSupportsMatCredACP:v3];
  v4 = objc_autoreleasePoolPush();
  v5 = a1[5];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [a1[6] UUID];
    v11 = 138543874;
    v12 = v7;
    v13 = 2112;
    v14 = v8;
    v15 = 2112;
    v16 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsMatCredACP: %@", &v11, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1560(uint64_t a1, void *a2)
{
  v47 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [MEMORY[0x277D17B88] doorLockFeatureMapSupportsWeekDaySchedule:v3];
  v5 = [*(a1 + 32) supportsMatterWeekDaySchedule];
  v6 = HMFEqualObjects();

  if ((v6 & 1) == 0)
  {
    [*(a1 + 32) setSupportsMatterWeekDaySchedule:v4];
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 40);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [*(a1 + 48) UUID];
      *buf = 138543874;
      v42 = v10;
      v43 = 2112;
      v44 = v11;
      v45 = 2112;
      v46 = v4;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsMatterWeekDaySchedule: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v12 = [MEMORY[0x277D17B88] doorLockFeatureMapSupportsYearDaySchedule:v3];
  v13 = [*(a1 + 32) supportsMatterYearDaySchedule];
  v14 = HMFEqualObjects();

  if ((v14 & 1) == 0)
  {
    [*(a1 + 32) setSupportsMatterYearDaySchedule:v12];
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 40);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [*(a1 + 48) UUID];
      *buf = 138543874;
      v42 = v18;
      v43 = 2112;
      v44 = v19;
      v45 = 2112;
      v46 = v12;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsMatterYearDaySchedule: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v15);
  }

  v20 = MEMORY[0x277D0F7C0];
  v21 = *(a1 + 56);
  v22 = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
  v23 = [v21 numberOfWeekDaySchedulesSupportedWithFlow:v22];
  v40[0] = v23;
  v24 = *(a1 + 56);
  v25 = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
  v26 = [v24 numberOfYearDaySchedulesSupportedWithFlow:v25];
  v40[1] = v26;
  v27 = [MEMORY[0x277CBEA60] arrayWithObjects:v40 count:2];
  v28 = [v20 allSettled:v27];
  v36[0] = MEMORY[0x277D85DD0];
  v36[1] = 3221225472;
  v36[2] = __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1562;
  v36[3] = &unk_278679B30;
  v29 = *(a1 + 32);
  v30 = *(a1 + 40);
  v31 = *(a1 + 48);
  v37 = v29;
  v38 = v30;
  v39 = v31;
  v32 = [v28 then:v36];
  if (!v32)
  {
    _HMFPreconditionFailure();
  }

  v33 = v32;

  v34 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_1562(id *a1, void *a2)
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 objectAtIndexedSubscript:0];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  v7 = [v3 objectAtIndexedSubscript:1];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  if (v6)
  {
    v10 = [a1[4] matterWeekDayScheduleCapacity];
    v11 = HMFEqualObjects();

    if ((v11 & 1) == 0)
    {
      [a1[4] setMatterWeekDayScheduleCapacity:v6];
      v12 = objc_autoreleasePoolPush();
      v13 = a1[5];
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v16 = [a1[6] UUID];
        v26 = 138543874;
        v27 = v15;
        v28 = 2112;
        v29 = v16;
        v30 = 2112;
        v31 = v6;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] weekDayScheduleCapacity: %@", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v12);
    }

    v17 = [a1[4] matterYearDayScheduleCapacity];
    v18 = HMFEqualObjects();

    if ((v18 & 1) == 0)
    {
      [a1[4] setMatterYearDayScheduleCapacity:v9];
      v19 = objc_autoreleasePoolPush();
      v20 = a1[5];
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v22 = HMFGetLogIdentifier();
        v23 = [a1[6] UUID];
        v26 = 138543874;
        v27 = v22;
        v28 = 2112;
        v29 = v23;
        v30 = 2112;
        v31 = v9;
        _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] yearDayScheduleCapacity: %@", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v19);
    }
  }

  v24 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __60__HMDHome__readDataNeededImmediatelyAfterPairing_intoModel___block_invoke_2_1558(id *a1, void *a2)
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [a1[4] supportsMatterWalletKey];
  v5 = HMFEqualObjects();

  if ((v5 & 1) == 0)
  {
    [a1[4] setSupportsMatterWalletKey:v3];
    v6 = objc_autoreleasePoolPush();
    v7 = a1[5];
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [a1[6] UUID];
      v13 = 138543874;
      v14 = v9;
      v15 = 2112;
      v16 = v10;
      v17 = 2112;
      v18 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] supportsMatterWalletKey: %@", &v13, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

- (id)_configureTTUAndUWBOnAccessory:(id)a3 accessoryModel:(id)a4
{
  v42 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [v8 UUID];
    *buf = 138544130;
    v35 = v12;
    v36 = 2112;
    v37 = v13;
    v38 = 2112;
    v39 = v6;
    v40 = 2112;
    v41 = v7;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Configuring ACWG on accessory with serverInfo: %@, model: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v9);
  notifyMatterMetricPairingStep(v10, 0x19uLL);
  v14 = [v6 server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = v14;
  }

  else
  {
    v15 = 0;
  }

  v16 = v15;

  if (v16)
  {
    v17 = [v16 createDoorLockClusterObjectWithFlow:v8];
    v18 = [v17 naFuture];
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke;
    v30[3] = &unk_278670040;
    v31 = v8;
    v32 = v10;
    v33 = v7;
    v19 = [v18 flatMap:v30];
    v20 = [v19 hmfFuture];
    v21 = [v20 ignoreResult];
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = v10;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      v26 = [v8 UUID];
      v27 = [v6 server];
      *buf = 138543874;
      v35 = v25;
      v36 = 2112;
      v37 = v26;
      v38 = 2112;
      v39 = v27;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find HMMTRAccessoryServer: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v22);
    v21 = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v28 = *MEMORY[0x277D85DE8];

  return v21;
}

id __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 clearAllUsersWithDeletedCreatorFabricIndexWithFlow:*(a1 + 32)];
  v5 = [v4 naFuture];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2;
  v18[3] = &unk_27866FFA0;
  v13 = *(a1 + 32);
  v6 = v13.i64[0];
  v19 = vextq_s8(v13, v13, 8uLL);
  v20 = *(a1 + 48);
  v7 = v3;
  v21 = v7;
  v8 = [v5 flatMap:v18];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1545;
  v15[3] = &unk_278670018;
  v14 = *(a1 + 32);
  v9 = v14.i64[0];
  v16 = vextq_s8(v14, v14, 8uLL);
  v17 = v7;
  v10 = v7;
  v11 = [v8 flatMap:v15];

  return v11;
}

id __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) nfcReaderKeyManager];
  v3 = [v2 fetchOrCreateReaderKeyForPairingWithFlow:*(a1 + 40)];
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_3;
  v12[3] = &unk_27866FF78;
  v4 = *(a1 + 48);
  v11 = *(a1 + 32);
  v5 = v11.i64[1];
  v6 = *(a1 + 56);
  v7.i64[0] = v4;
  v7.i64[1] = v6;
  v8 = vzip2q_s64(v11, v7);
  v7.i64[1] = v11.i64[0];
  v13 = v7;
  v14 = v8;
  v9 = [v3 flatMap:v12];

  return v9;
}

id __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1545(uint64_t a1)
{
  v2 = objc_opt_new();
  v3 = +[HMDACWGKeyManager shared];
  v4 = [*(a1 + 32) uuid];
  v5 = [*(a1 + 32) currentUser];
  v6 = [v5 uuid];
  v7 = [*(a1 + 32) backingStore];
  v8 = [v7 context];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2_1547;
  v14[3] = &unk_27866FFF0;
  v9 = *(a1 + 40);
  v14[4] = *(a1 + 32);
  v15 = v9;
  v10 = v2;
  v16 = v10;
  v17 = *(a1 + 48);
  [v3 getOrCreateIssuerKeyAndSaveIfNeededWithHome:v4 user:v6 context:v8 shouldRoll:0 completionHandler:v14];

  v11 = v17;
  v12 = v10;

  return v10;
}

void __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2_1547(id *a1, void *a2, void *a3)
{
  v47 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = [HMDNIST256Utilities publicKeyExternalRepresentationFromKeyPairExternalRepresentation:v5];
    v8 = [a1[4] users];
    v9 = [MEMORY[0x277CBEB18] array];
    v10 = [MEMORY[0x277CBEB18] array];
    v35[0] = MEMORY[0x277D85DD0];
    v35[1] = 3221225472;
    v35[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1548;
    v35[3] = &unk_27866FFC8;
    v11 = a1[4];
    v12 = a1[5];
    v36 = v7;
    v37 = v11;
    v38 = v12;
    v13 = v9;
    v39 = v13;
    v14 = v10;
    v40 = v14;
    v15 = v7;
    [v8 hmf_enumerateWithAutoreleasePoolUsingBlock:v35];
    v16 = objc_alloc(MEMORY[0x277D0F7A8]);
    v17 = [a1[4] workQueue];
    v18 = [v16 initWithQueue:v17];

    v19 = MEMORY[0x277D0F7C0];
    v29[0] = MEMORY[0x277D85DD0];
    v29[1] = 3221225472;
    v29[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1550;
    v29[3] = &unk_278679AE0;
    v30 = a1[7];
    v31 = v13;
    v32 = v14;
    v33 = a1[5];
    v34 = a1[6];
    v20 = v14;
    v21 = v13;
    v22 = [v19 inContext:v18 perform:v29];
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    v24 = a1[4];
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      v27 = [a1[5] UUID];
      *buf = 138543874;
      v42 = v26;
      v43 = 2112;
      v44 = v27;
      v45 = 2112;
      v46 = v6;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to create ACWG issuer key with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v23);
    [a1[6] finishWithError:v6];
  }

  v28 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1548(id *a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (([v3 isRestrictedGuest] & 1) == 0)
  {
    v4 = [v3 uniqueIDForAccessories];
    if ([v3 isCurrentUser])
    {
      v5 = a1[4];
    }

    else
    {
      v5 = [v3 acwgIssuerPublicKeyExternalRepresentation];
    }

    v6 = v5;
    if (v4 && v5)
    {
      [a1[7] addObject:v4];
      [a1[8] addObject:v6];
    }

    else
    {
      v7 = objc_autoreleasePoolPush();
      v8 = a1[5];
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v10 = HMFGetLogIdentifier();
        v11 = [a1[6] UUID];
        v12 = [v3 uuid];
        v14 = 138544386;
        v15 = v10;
        v16 = 2112;
        v17 = v11;
        v18 = 2112;
        v19 = v12;
        v20 = 2112;
        v21 = v4;
        v22 = 2112;
        v23 = v6;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] User is missing either uniqueIDForAccessories or issuerPublicKey. User: %@, uniqueIDForAccessories: %@, issuerPublicKey: %@", &v14, 0x34u);
      }

      objc_autoreleasePoolPop(v7);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1550(uint64_t a1)
{
  v2 = [*(a1 + 32) addNewUsersWithUserUniqueIDs:*(a1 + 40) withCorrespondingIssuerKeys:*(a1 + 48) flow:*(a1 + 56)];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2_1551;
  v9[3] = &unk_278689CB0;
  v10 = *(a1 + 64);
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_3_1552;
  v7[3] = &unk_278689CD8;
  v8 = *(a1 + 64);
  v3 = [v2 then:v9 orRecover:v7];
  if (v3)
  {
    v4 = v3;

    return 3;
  }

  else
  {
    v6 = _HMFPreconditionFailure();
    return __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_2_1551(v6);
  }
}

id __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_3(id *a1, void *a2)
{
  v60 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_opt_new();
  v5 = [v3 privateKey];
  [v4 setReaderPrivateKey:v5];

  v6 = [v3 publicKeyExternalRepresentation];
  [v4 setReaderPublicKeyExternalRepresentation:v6];

  v7 = [v3 publicKey];
  v8 = [HMDNIST256Utilities identifier16BytesForKey:v7];
  [v4 setReaderGroupIdentifier:v8];

  v9 = [a1[4] supportsMatCredACB];
  LODWORD(v7) = [v9 BOOLValue];

  if (v7)
  {
    v10 = [a1[5] acwgGroupResolvingKey];

    if (!v10)
    {
      v31 = objc_autoreleasePoolPush();
      v32 = a1[5];
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
      {
        v34 = HMFGetLogIdentifier();
        v35 = [a1[6] UUID];
        *buf = 138543618;
        v51 = v34;
        v52 = 2112;
        v53 = v35;
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Missing acwgGroupResolvingKey", buf, 0x16u);
        goto LABEL_15;
      }

LABEL_16:

      objc_autoreleasePoolPop(v31);
      v38 = MEMORY[0x277D2C900];
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      v30 = [v38 futureWithError:v25];
      goto LABEL_17;
    }

    v11 = [a1[5] acwgGroupResolvingKey];
    [v4 setGroupResolvingKey:v11];
  }

  v12 = [v4 readerPrivateKey];
  if (!v12)
  {
LABEL_11:
    v31 = objc_autoreleasePoolPush();
    v32 = a1[5];
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
    {
      v34 = HMFGetLogIdentifier();
      v35 = [a1[6] UUID];
      v36 = [v4 readerPublicKeyExternalRepresentation];
      v37 = [v4 readerGroupIdentifier];
      *buf = 138544130;
      v51 = v34;
      v52 = 2112;
      v53 = v35;
      v54 = 2112;
      v55 = v36;
      v56 = 2112;
      v57 = v37;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] User is missing either readerPrivateKey or readerPublicKey or readerGroupIdentifier. readerPublicKeyExternalRepresentation: %@, readerGroupIdentifier: %@", buf, 0x2Au);

LABEL_15:
      goto LABEL_16;
    }

    goto LABEL_16;
  }

  v13 = v12;
  v14 = [v4 readerPublicKeyExternalRepresentation];
  if (!v14)
  {

    goto LABEL_11;
  }

  v15 = v14;
  v16 = [v4 readerGroupIdentifier];

  if (!v16)
  {
    goto LABEL_11;
  }

  v17 = objc_autoreleasePoolPush();
  v18 = a1[5];
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v21 = [a1[6] UUID];
    v43 = [v4 readerPublicKeyExternalRepresentation];
    v22 = [v43 hmf_hexadecimalRepresentation];
    v42 = [v4 readerGroupIdentifier];
    [v42 hmf_hexadecimalRepresentation];
    v23 = v44 = v17;
    v41 = [v4 groupResolvingKey];
    v24 = [v41 hmf_hexadecimalRepresentation];
    *buf = 138544386;
    v51 = v20;
    v52 = 2112;
    v53 = v21;
    v54 = 2112;
    v55 = v22;
    v56 = 2112;
    v57 = v23;
    v58 = 2112;
    v59 = v24;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Setting reader config on lock. RPK: %@, RGI: %@, GRK: %@", buf, 0x34u);

    v17 = v44;
  }

  objc_autoreleasePoolPop(v17);
  v25 = [a1[7] setOrReadReaderConfig:v4 flow:a1[6]];
  v26 = [v25 naFuture];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1540;
  v45[3] = &unk_27866FF50;
  v27 = v4;
  v28 = a1[5];
  v29 = a1[6];
  v46 = v27;
  v47 = v28;
  v48 = v29;
  v49 = a1[4];
  v30 = [v26 flatMap:v45];

LABEL_17:
  v39 = *MEMORY[0x277D85DE8];

  return v30;
}

id __57__HMDHome__configureTTUAndUWBOnAccessory_accessoryModel___block_invoke_1540(id *a1, void *a2)
{
  v43 = *MEMORY[0x277D85DE8];
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (v5)
  {
    v6 = [v3 readerPublicKeyExternalRepresentation];
    v7 = [a1[4] readerPublicKeyExternalRepresentation];
    v8 = HMFEqualObjects();

    if (v8 && ([v3 readerGroupIdentifier], v9 = objc_claimAutoreleasedReturnValue(), objc_msgSend(a1[4], "readerGroupIdentifier"), v10 = objc_claimAutoreleasedReturnValue(), v11 = HMFEqualObjects(), v10, v9, v11))
    {
      v12 = [v3 groupResolvingKey];
      v13 = [a1[4] groupResolvingKey];
      v14 = HMFEqualObjects();

      if (v14)
      {
        goto LABEL_13;
      }
    }

    else
    {
    }

    v15 = objc_autoreleasePoolPush();
    v16 = a1[5];
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [a1[6] UUID];
      v31 = [v3 readerPublicKeyExternalRepresentation];
      v20 = [v31 hmf_hexadecimalRepresentation];
      v30 = [v3 readerGroupIdentifier];
      v21 = [v30 hmf_hexadecimalRepresentation];
      [v3 groupResolvingKey];
      v22 = v32 = v15;
      v23 = [v22 hmf_hexadecimalRepresentation];
      *buf = 138544386;
      v34 = v18;
      v35 = 2112;
      v36 = v19;
      v37 = 2112;
      v38 = v20;
      v39 = 2112;
      v40 = v21;
      v41 = 2112;
      v42 = v23;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Found existing reader config on lock. RPK: %@, RGI: %@, GRK: %@", buf, 0x34u);

      v15 = v32;
    }

    objc_autoreleasePoolPop(v15);
    v24 = [v3 readerPublicKeyExternalRepresentation];
    [a1[7] setPreexistingMatCredRPK:v24];

    v25 = [v3 readerGroupIdentifier];
    [a1[7] setPreexistingMatCredRGI:v25];

    v26 = [v3 groupResolvingKey];
    [a1[7] setPreexistingMatCredGRK:v26];
  }

LABEL_13:
  v27 = [MEMORY[0x277D2C900] futureWithNoResult];

  v28 = *MEMORY[0x277D85DE8];

  return v27;
}

- (id)_configureMatterV1Accessory:(id)a3 accessoryModel:(id)a4
{
  v37 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [v8 UUID];
    *buf = 138544130;
    v30 = v12;
    v31 = 2112;
    v32 = v13;
    v33 = 2112;
    v34 = v6;
    v35 = 2112;
    v36 = v7;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Configuring matter v1 accessory with serverInfo: %@, model: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v9);
  notifyMatterMetricPairingStep(v10, 0x19uLL);
  v14 = [v6 server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = v14;
  }

  else
  {
    v15 = 0;
  }

  v16 = v15;

  if (v16)
  {
    v17 = [v16 createDoorLockClusterObjectWithFlow:v8];
    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __54__HMDHome__configureMatterV1Accessory_accessoryModel___block_invoke;
    v27[3] = &unk_278683930;
    v28 = v8;
    v18 = [v17 then:v27];
  }

  else
  {
    v19 = objc_autoreleasePoolPush();
    v20 = v10;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = HMFGetLogIdentifier();
      v23 = [v8 UUID];
      v24 = [v6 server];
      *buf = 138543874;
      v30 = v22;
      v31 = 2112;
      v32 = v23;
      v33 = 2112;
      v34 = v24;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find HMMTRAccessoryServer: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v19);
    v18 = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v25 = *MEMORY[0x277D85DE8];

  return v18;
}

uint64_t __54__HMDHome__configureMatterV1Accessory_accessoryModel___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 clearAllUsersWithDeletedCreatorFabricIndexWithFlow:*(a1 + 32)];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return [(HMDHome *)v7 _configureWithFeatureSpecificDataAccessory:v8 accessoryModel:v9, v10];
  }
}

- (id)_configureWithFeatureSpecificDataAccessory:(id)a3 accessoryModel:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [MEMORY[0x277CBEB18] array];
  v9 = [v7 supportsMatCredACP];
  v10 = [v9 BOOLValue];

  if (v10)
  {
    v11 = [(HMDHome *)self _configureTTUAndUWBOnAccessory:v6 accessoryModel:v7];
  }

  else
  {
    if (![v7 supportsAnyMatterV1InPersonAccess])
    {
      goto LABEL_6;
    }

    v11 = [(HMDHome *)self _configureMatterV1Accessory:v6 accessoryModel:v7];
  }

  v12 = v11;
  [v8 addObject:v11];

LABEL_6:
  v13 = [MEMORY[0x277D0F7C0] all:v8];

  return v13;
}

- (void)_removeFailedAddWithAccessoryServerInfo:(id)a3
{
  v4 = a3;
  v5 = objc_alloc(MEMORY[0x277D0F7A8]);
  v6 = [(HMDHome *)self workQueue];
  v7 = [v5 initWithQueue:v6];

  v20 = _HMFThreadLocalAsyncContextPush();
  if ([(HMDHome *)self isSharedAdmin])
  {
    v8 = [v4 server];
    v9 = [(HMDHome *)self owner];
    v10 = [(HMDHome *)self _removeUserFromNewlyPairedAccessoryServer:v8 user:v9];
  }

  else
  {
    v10 = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __51__HMDHome__removeFailedAddWithAccessoryServerInfo___block_invoke;
  v18[3] = &unk_2786898D8;
  v18[4] = self;
  v11 = v4;
  v19 = v11;
  v12 = [v10 finally:v18];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __51__HMDHome__removeFailedAddWithAccessoryServerInfo___block_invoke_2;
  v15[3] = &unk_2786898D8;
  v13 = v11;
  v16 = v13;
  v17 = self;
  v14 = [v12 finally:v15];

  _HMFThreadLocalAsyncContextPop();
}

uint64_t __51__HMDHome__removeFailedAddWithAccessoryServerInfo___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) server];
  v4 = [*(a1 + 32) currentUser];
  v5 = [v2 _removeUserFromNewlyPairedAccessoryServer:v3 user:v4];
  if (v5)
  {
    v6 = v5;

    return 3;
  }

  else
  {
    v8 = _HMFPreconditionFailure();
    return __51__HMDHome__removeFailedAddWithAccessoryServerInfo___block_invoke_2(v8);
  }
}

uint64_t __51__HMDHome__removeFailedAddWithAccessoryServerInfo___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) networkCredential];
  v3 = [v2 clientIdentifier];

  if (v3)
  {
    [*(a1 + 40) _removeClientConfigurationWithIdentifier:v3];
  }

  return 1;
}

- (void)_processNewlyPairedAccessoryServerInfo:(id)a3 message:(id)a4 completionHandler:(id)a5
{
  v92 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v56 = a4;
  v55 = a5;
  v9 = [v8 server];
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [v9 accessories];
    *buf = 138543874;
    *&buf[4] = v13;
    *&buf[12] = 2048;
    *&buf[14] = [v14 count];
    *&buf[22] = 2112;
    v88 = v8;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Creating %tu new accessory objects for a newly paired accessory server: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v10);
  v15 = [(HMDHome *)v11 uuidToHAPAccessoryConfigTable];
  v16 = [v9 primaryAccessory];
  v17 = [v8 primaryAccessoryUUID];
  [v15 setObject:v16 forKey:v17];

  v18 = MEMORY[0x277CBEB38];
  v19 = [v9 accessories];
  v20 = [v18 dictionaryWithCapacity:{objc_msgSend(v19, "count")}];

  v85 = 0u;
  v86 = 0u;
  v83 = 0u;
  v84 = 0u;
  v21 = [v9 accessories];
  v22 = [v21 countByEnumeratingWithState:&v83 objects:v91 count:16];
  if (v22)
  {
    v23 = *v84;
    do
    {
      for (i = 0; i != v22; ++i)
      {
        if (*v84 != v23)
        {
          objc_enumerationMutation(v21);
        }

        v25 = *(*(&v83 + 1) + 8 * i);
        v26 = [v25 uniqueIdentifier];
        [v20 setObject:v25 forKey:v26];
      }

      v22 = [v21 countByEnumeratingWithState:&v83 objects:v91 count:16];
    }

    while (v22);
  }

  if ([(HMDHome *)v11 hasNeverAddedAnyHAPAccessory])
  {
    v27 = [v8 pairingEvent];
    [v27 setFirstHAPAccessoryInHome:1];

    v28 = [(HMDHome *)v11 homeManager];
    v29 = [v28 hasHAPAccessoryInAnyHome];
    v30 = [v8 pairingEvent];
    [v30 setFirstHAPAccessoryInAnyHome:v29 ^ 1u];
  }

  v31 = [v8 pairingEvent];
  v32 = [v9 primaryAccessory];
  [v31 updateEventPropertiesWithHAPAccessory:v32];

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v88 = __Block_byref_object_copy__14759;
  v89 = __Block_byref_object_dispose__14760;
  v90 = 0;
  v33 = objc_alloc(MEMORY[0x277D0F7A8]);
  v34 = [(HMDHome *)v11 workQueue];
  v59 = [v33 initWithQueue:v34];

  v82 = _HMFThreadLocalAsyncContextPush();
  if ([(HMDHome *)v11 isSharedAdmin])
  {
    v35 = [v8 server];
    v58 = [(HMDHome *)v11 _addOwnerToNewlyPairedAccessoryServer:v35];
  }

  else
  {
    v58 = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v79[0] = MEMORY[0x277D85DD0];
  v79[1] = 3221225472;
  v79[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke;
  v79[3] = &unk_27867C6C8;
  v79[4] = v11;
  v36 = v8;
  v80 = v36;
  v37 = v56;
  v81 = v37;
  v38 = [v58 then:v79];
  v39 = [v38 timeout:180.0];
  v74[0] = MEMORY[0x277D85DD0];
  v74[1] = 3221225472;
  v74[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_2;
  v74[3] = &unk_27866FE90;
  v74[4] = v11;
  v78 = buf;
  v40 = v36;
  v75 = v40;
  v41 = v37;
  v76 = v41;
  v57 = v20;
  v77 = v57;
  v42 = [v39 then:v74];
  v71[0] = MEMORY[0x277D85DD0];
  v71[1] = 3221225472;
  v71[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_3;
  v71[3] = &unk_27866FED8;
  v71[4] = v11;
  v73 = buf;
  v43 = v40;
  v72 = v43;
  v44 = [v42 then:v71];
  v68[0] = MEMORY[0x277D85DD0];
  v68[1] = 3221225472;
  v68[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_4;
  v68[3] = &unk_27866FED8;
  v68[4] = v11;
  v54 = v9;
  v69 = v54;
  v70 = buf;
  v45 = [v44 then:v68];
  v64[0] = MEMORY[0x277D85DD0];
  v64[1] = 3221225472;
  v64[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_6;
  v64[3] = &unk_27866FF00;
  v64[4] = v11;
  v67 = buf;
  v46 = v41;
  v65 = v46;
  v47 = v55;
  v66 = v47;
  v48 = [v45 then:v64];
  v60[0] = MEMORY[0x277D85DD0];
  v60[1] = 3221225472;
  v60[2] = __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_7;
  v60[3] = &unk_27866FF28;
  v60[4] = v11;
  v49 = v43;
  v61 = v49;
  v50 = v46;
  v62 = v50;
  v51 = v47;
  v63 = v51;
  v52 = [v48 recover:v60];

  _HMFThreadLocalAsyncContextPop();
  _Block_object_dispose(buf, 8);

  v53 = *MEMORY[0x277D85DE8];
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke(void *a1, void *a2)
{
  v165 = *MEMORY[0x277D85DE8];
  v140 = a2;
  v4 = a1[4];
  v3 = a1[5];
  v5 = a1[6];
  v6 = v3;
  v7 = v5;
  v142 = v4;
  v143 = v6;
  if (!v4)
  {
    goto LABEL_63;
  }

  v8 = v6;
  v9 = [v8 server];
  v10 = [v9 primaryAccessory];

  v11 = [v8 primaryAccessoryUUID];
  v12 = [v8 certificationStatus];
  v13 = [v8 networkCredential];
  v145 = v8;
  v14 = [v8 hostAccessory];
  v15 = v10;
  v16 = v11;
  obj = v13;
  v17 = v14;
  v18 = [MKFModelFactory createHAPAccessoryModelWithModelID:v16];
  HMDPopulateAccessoryModelFromHAPAccessory(v18, v15, v12, v17);
  v19 = v15;
  v20 = [v19 server];
  v21 = [v20 productData];

  v141 = v7;
  v144 = v19;
  if (v21)
  {
    v22 = [v20 productData];
    v23 = [HMDAccessory validateProductData:v22];

    if (v23)
    {
      v24 = v144;
      v25 = [v144 productData];
      if (v25)
      {
        v26 = v25;
        v27 = [v20 productData];
        v28 = [v144 productData];
        v29 = [v27 isEqualToString:v28];

        v24 = v144;
        if ((v29 & 1) == 0)
        {
          v30 = objc_autoreleasePoolPush();
          v31 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
          {
            v32 = HMFGetLogIdentifier();
            v33 = [v144 uniqueIdentifier];
            v34 = [v20 productData];
            v35 = [v144 productData];
            *buf = 138544130;
            *&buf[4] = v32;
            *&buf[12] = 2112;
            *&buf[14] = v33;
            *&buf[22] = 2112;
            v161 = v34;
            LOWORD(v162) = 2112;
            *(&v162 + 2) = v35;
            _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Accessory with identifier %@ is using productData from pair setup that differs from productData published on AIS: %@ != %@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v30);
          v24 = v144;
        }
      }

      v36 = [v20 productData];
      goto LABEL_29;
    }

    v37 = objc_autoreleasePoolPush();
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
    {
      v39 = HMFGetLogIdentifier();
      v40 = [v144 uniqueIdentifier];
      v41 = [v20 productData];
      *buf = 138543874;
      *&buf[4] = v39;
      *&buf[12] = 2112;
      *&buf[14] = v40;
      *&buf[22] = 2112;
      v161 = v41;
      _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_ERROR, "%{public}@Accessory with identifier %@ has invalid productData from pair setup: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v37);
    v19 = v144;
  }

  v42 = [v19 productData];

  if (!v42)
  {
LABEL_19:
    v51 = +[HMDVendorDataManager sharedVendorDataManager];
    v52 = [v19 manufacturer];
    v53 = [v19 model];
    v54 = [v51 vendorModelEntryForManufacturer:v52 model:v53];

    if (v54)
    {
      v55 = [v54 productData];

      if (v55)
      {
        v36 = [v54 productData];
LABEL_28:

        v24 = v144;
        goto LABEL_29;
      }

      v56 = objc_autoreleasePoolPush();
      v57 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v57, OS_LOG_TYPE_ERROR))
      {
        v58 = HMFGetLogIdentifier();
        v147 = v56;
        v59 = [v144 uniqueIdentifier];
        v60 = [v144 manufacturer];
        v61 = [v144 model];
        *buf = 138544130;
        *&buf[4] = v58;
        *&buf[12] = 2112;
        *&buf[14] = v59;
        *&buf[22] = 2112;
        v161 = v60;
        LOWORD(v162) = 2112;
        *(&v162 + 2) = v61;
        v62 = "%{public}@Accessory with identifier %@ does not have productData in the VIDB (manufacturer: '%@', model: '%@')";
        goto LABEL_26;
      }
    }

    else
    {
      v56 = objc_autoreleasePoolPush();
      v57 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v57, OS_LOG_TYPE_ERROR))
      {
        v58 = HMFGetLogIdentifier();
        v147 = v56;
        v59 = [v144 uniqueIdentifier];
        v60 = [v144 manufacturer];
        v61 = [v144 model];
        *buf = 138544130;
        *&buf[4] = v58;
        *&buf[12] = 2112;
        *&buf[14] = v59;
        *&buf[22] = 2112;
        v161 = v60;
        LOWORD(v162) = 2112;
        *(&v162 + 2) = v61;
        v62 = "%{public}@Accessory with identifier %@ could not be found in the VIDB (manufacturer: '%@', model: '%@')";
LABEL_26:
        _os_log_impl(&dword_229538000, v57, OS_LOG_TYPE_ERROR, v62, buf, 0x2Au);

        v56 = v147;
      }
    }

    objc_autoreleasePoolPop(v56);
    v36 = 0;
    goto LABEL_28;
  }

  [v19 productData];
  v44 = v43 = v19;
  v45 = [HMDAccessory validateProductData:v44];

  if (!v45)
  {
    v46 = objc_autoreleasePoolPush();
    v47 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
    {
      v48 = HMFGetLogIdentifier();
      v49 = [v144 uniqueIdentifier];
      v50 = [v144 productData];
      *buf = 138543874;
      *&buf[4] = v48;
      *&buf[12] = 2112;
      *&buf[14] = v49;
      *&buf[22] = 2112;
      v161 = v50;
      _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Accessory with identifier %@ has invalid productData published on AIS: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v46);
    v19 = v144;
    goto LABEL_19;
  }

  v36 = [v43 productData];
  v24 = v43;
LABEL_29:

  if (v36)
  {
    v63 = v18;
    v64 = v36;
    v65 = objc_autoreleasePoolPush();
    v66 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v66, OS_LOG_TYPE_DEFAULT))
    {
      v67 = HMFGetLogIdentifier();
      v68 = [v63 uniqueIdentifier];
      *buf = 138543874;
      *&buf[4] = v67;
      *&buf[12] = 2112;
      *&buf[14] = v68;
      *&buf[22] = 2112;
      v161 = v64;
      _os_log_impl(&dword_229538000, v66, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory with identifier %@ is now bound to productData %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v65);
    [v63 setProductData:v64];

    v24 = v144;
  }

  v69 = [v24 server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v70 = v69;
  }

  else
  {
    v70 = 0;
  }

  v71 = v70;

  v72 = v24;
  v73 = [v71 isWacComplete];

  v74 = v18;
  v75 = obj;
  v76 = [v75 clientIdentifier];
  [v74 setNetworkClientIdentifier:v76];

  [v74 setNetworkClientLAN:&unk_283E74750];
  v77 = [v75 networkRouterUUID];
  v78 = [v77 UUIDString];
  [v74 setNetworkRouterUUID:v78];

  v79 = [v75 wiFiPSK];
  [v74 setWiFiUniquePreSharedKey:v79];

  v80 = [v75 wiFiPSK];

  v81 = 2;
  if (!v73)
  {
    v81 = 0;
  }

  if (v80)
  {
    v82 = 3;
  }

  else
  {
    v82 = v81;
  }

  v83 = [MEMORY[0x277CCABB0] numberWithInteger:v82];
  [v74 setWiFiCredentialType:v83];

  v84 = v145;
  v85 = [v145 server];
  v86 = [v145 home];
  LODWORD(v83) = shouldCreateNativeMatterAccessoryFromServer(v85, v86);

  if (v83)
  {
    v87 = objc_autoreleasePoolPush();
    v88 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v88, OS_LOG_TYPE_INFO))
    {
      v89 = HMFGetLogIdentifier();
      v90 = [v145 primaryAccessoryUUID];
      *buf = 138543618;
      *&buf[4] = v89;
      *&buf[12] = 2112;
      *&buf[14] = v90;
      _os_log_impl(&dword_229538000, v88, OS_LOG_TYPE_INFO, "%{public}@Creating native matter accessory model uuid %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v87);
    [v74 setSupportsNativeMatter:MEMORY[0x277CBEC38]];
    v91 = [v74 providedName];

    if (!v91)
    {
      v92 = [v145 server];
      v93 = [v92 name];
      [v74 setProvidedName:v93];
    }

    v94 = [v74 configuredName];

    if (!v94)
    {
      v95 = [v74 providedName];
      [v74 setConfiguredName:v95];
    }
  }

  v96 = [v144 services];
  v97 = [v96 copy];
  v98 = HMDNewModelsFromHAPServices(v97, v74);

  v153 = 0u;
  v154 = 0u;
  v151 = 0u;
  v152 = 0u;
  v99 = [v145 server];
  v100 = [v99 accessories];

  obja = v100;
  v101 = [v100 countByEnumeratingWithState:&v151 objects:buf count:16];
  if (v101)
  {
    v102 = v101;
    v103 = *v152;
    v146 = *v152;
    do
    {
      v104 = 0;
      v148 = v102;
      do
      {
        if (*v152 != v103)
        {
          objc_enumerationMutation(obja);
        }

        v105 = *(*(&v151 + 1) + 8 * v104);
        if (([v105 isPrimary] & 1) == 0)
        {
          v106 = [v84 certificationStatus];
          v107 = v74;
          v108 = v74;
          v109 = v105;
          v110 = [v109 instanceID];
          v111 = [v110 stringValue];
          *v155 = v111;
          v112 = [MEMORY[0x277CBEA60] arrayWithObjects:v155 count:1];

          v113 = MEMORY[0x277CCAD78];
          v114 = [v108 modelID];
          v115 = [v113 hm_deriveUUIDFromBaseUUID:v114 withSalts:v112];

          v116 = [MKFModelFactory createHAPAccessoryModelWithModelID:v115];
          [v108 addHostedAccessoriesObject:v116];
          HMDPopulateAccessoryModelFromHAPAccessory(v116, v109, v106, v108);

          [v116 setWiFiCredentialType:&unk_283E74750];
          v117 = objc_autoreleasePoolPush();
          v118 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v118, OS_LOG_TYPE_INFO))
          {
            v119 = HMFGetLogIdentifier();
            v120 = [v109 uniqueIdentifier];
            v121 = [v116 modelID];
            v122 = [v121 UUIDString];
            *v155 = 138543874;
            *&v155[4] = v119;
            *&v155[12] = 2112;
            *&v155[14] = v120;
            *&v155[22] = 2112;
            v156 = v122;
            _os_log_impl(&dword_229538000, v118, OS_LOG_TYPE_INFO, "%{public}@Created secondary accessory with identifier %@ and uuid %@", v155, 0x20u);

            v84 = v145;
          }

          objc_autoreleasePoolPop(v117);
          v123 = [v109 services];
          v124 = [v123 copy];
          v125 = HMDNewModelsFromHAPServices(v124, v116);

          v74 = v107;
          v103 = v146;
          v102 = v148;
        }

        ++v104;
      }

      while (v102 != v104);
      v102 = [obja countByEnumeratingWithState:&v151 objects:buf count:16];
    }

    while (v102);
  }

  v126 = [v84 server];
  v127 = [HMDHome updatedHomeModelCHIPPropertiesForAddedHAPAccessoryServer:v126];

  v128 = [v142 _readDataNeededImmediatelyAfterPairing:v84 intoModel:v74];
  *&v151 = MEMORY[0x277D85DD0];
  *(&v151 + 1) = 3221225472;
  *&v152 = __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke;
  *(&v152 + 1) = &unk_278685D58;
  v129 = v74;
  *&v153 = v129;
  v130 = v84;
  *(&v153 + 1) = v130;
  *&v154 = v142;
  v131 = [v128 then:&v151];
  *v155 = MEMORY[0x277D85DD0];
  *&v155[8] = 3221225472;
  *&v155[16] = __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_1534;
  v156 = &unk_27867C6C8;
  v157 = v142;
  v158 = v130;
  v132 = v129;
  v159 = v132;
  v133 = [v131 then:v155];
  *buf = MEMORY[0x277D85DD0];
  *&buf[8] = 3221225472;
  *&buf[16] = __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_2;
  v161 = &unk_2786868C8;
  *&v162 = v142;
  *(&v162 + 1) = v132;
  v163 = v127;
  v134 = v141;
  v164 = v141;
  v135 = v127;
  v7 = v132;
  v4 = [v133 then:buf];

  while (1)
  {

    v136 = v4;
    if (v136)
    {
      break;
    }

    _HMFPreconditionFailure();
LABEL_63:
    v134 = v7;
  }

  v137 = v136;

  v138 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v52 = *MEMORY[0x277D85DE8];
  v38 = a2;
  v3 = [*(a1 + 32) administratorHandler];
  v4 = [v3 shouldRelayMessages];

  v5 = *(a1 + 32);
  if (v4)
  {
    v6 = [*(a1 + 32) retrieveNewlyAddedAccessoriesForPairedAccessoryServerInfo:*(a1 + 40)];
    v7 = *(*(a1 + 64) + 8);
    v8 = *(v7 + 40);
    *(v7 + 40) = v6;
  }

  else
  {
    v8 = [*(a1 + 48) identifier];
    v9 = [v5 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v8];
    v10 = *(*(a1 + 64) + 8);
    v11 = *(v10 + 40);
    *(v10 + 40) = v9;
  }

  v12 = *(a1 + 32);
  v13 = *(a1 + 56);
  v14 = *(*(*(a1 + 64) + 8) + 40);
  v15 = v13;
  v39 = v14;
  if (v12)
  {
    v42 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v14, "count")}];
    v16 = [v12 notificationRegistrations];
    v41 = [v16 count];

    v49 = 0u;
    v50 = 0u;
    v47 = 0u;
    v48 = 0u;
    obj = v14;
    v17 = [obj countByEnumeratingWithState:&v47 objects:v51 count:16];
    if (v17)
    {
      v18 = v17;
      v19 = *v48;
      p_superclass = HMDIDSActivityRegistrationModel.superclass;
      v40 = *v48;
      do
      {
        v21 = 0;
        do
        {
          if (*v48 != v19)
          {
            objc_enumerationMutation(obj);
          }

          v22 = *(*(&v47 + 1) + 8 * v21);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v23 = v22;
          }

          else
          {
            v23 = 0;
          }

          v24 = v23;

          v25 = [v24 uniqueIdentifier];
          v26 = [v15 objectForKey:v25];

          if (v24)
          {
            v27 = v26 == 0;
          }

          else
          {
            v27 = 1;
          }

          if (!v27)
          {
            v46 = 0;
            [MEMORY[0x277D0F7C0] futureWithPromise:&v46];
            v28 = v15;
            v30 = v29 = p_superclass;
            [v12 workQueue];
            v32 = v31 = v12;
            v44[0] = MEMORY[0x277D85DD0];
            v44[1] = 3221225472;
            v44[2] = __83__HMDHome__associateAccessoriesWithHAPAccessories_uniqueIdentifierHAPAccessoryMap___block_invoke;
            v44[3] = &unk_27868A728;
            v45 = v46;
            [v24 configureWithAccessory:v26 homeNotificationsEnabled:v41 != 0 queue:v32 completion:v44];

            v12 = v31;
            [v42 addObject:v30];

            p_superclass = v29;
            v15 = v28;
            v19 = v40;
          }

          ++v21;
        }

        while (v18 != v21);
        v18 = [obj countByEnumeratingWithState:&v47 objects:v51 count:16];
      }

      while (v18);
    }

    v33 = [MEMORY[0x277D0F7C0] allSettled:v42];
    v12 = [v33 ignoreOutcome];
  }

  v34 = v12;
  if (!v34)
  {
    _HMFPreconditionFailure();
  }

  v35 = v34;

  v36 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_3(uint64_t a1, void *a2)
{
  v60 = *MEMORY[0x277D85DE8];
  v35 = a2;
  v3 = *(*(*(a1 + 48) + 8) + 40);
  v4 = *(a1 + 32);
  v5 = [*(a1 + 40) pairingEvent];
  v37 = v3;
  v36 = v5;
  if (!v4)
  {
    goto LABEL_20;
  }

  v6 = objc_autoreleasePoolPush();
  v38 = v4;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v37, "count")}];
    v10 = [v36 accessoryUUID];
    *buf = 138543874;
    v55 = v8;
    v56 = 2112;
    v57 = v9;
    v58 = 2112;
    v59 = v10;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Performing post add configuration for %@ new accessories for pairing: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = objc_alloc(MEMORY[0x277D0F770]);
  v12 = MEMORY[0x277CCACA8];
  v13 = MEMORY[0x22AAD2510](v38, sel__configureNewlyAddedAccessories_pairingEvent_);
  v14 = [v12 stringWithFormat:@"%@, %s:%ld", v13, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 16778];
  v53 = [v11 initWithName:v14];

  v51[0] = 0;
  v51[1] = v51;
  v51[2] = 0x3032000000;
  v51[3] = __Block_byref_object_copy__14759;
  v51[4] = __Block_byref_object_dispose__14760;
  v52 = 0;
  v15 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v37, "count")}];
  v49 = 0u;
  v50 = 0u;
  v47 = 0u;
  v48 = 0u;
  v16 = v37;
  v17 = [v16 countByEnumeratingWithState:&v47 objects:buf count:16];
  if (v17)
  {
    v18 = *v48;
    do
    {
      v19 = 0;
      do
      {
        if (*v48 != v18)
        {
          objc_enumerationMutation(v16);
        }

        v20 = *(*(&v47 + 1) + 8 * v19);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v21 = v20;
        }

        else
        {
          v21 = 0;
        }

        v22 = v21;

        if (v22)
        {
          v39[0] = 0;
          v23 = [MEMORY[0x277D0F7C0] futureWithPromise:v39];
          v42[0] = MEMORY[0x277D85DD0];
          v42[1] = 3221225472;
          v42[2] = __56__HMDHome__configureNewlyAddedAccessories_pairingEvent___block_invoke;
          v42[3] = &unk_27867B0F8;
          v42[4] = v38;
          v24 = v22;
          v43 = v24;
          v46 = v51;
          v44 = v53;
          v45 = v39[0];
          [v24 readInitialRequiredCharacteristicsForAccessory:v42];
          [v24 checkHAPSessionRestore];
          [v15 addObject:v23];
        }

        ++v19;
      }

      while (v17 != v19);
      v17 = [v16 countByEnumeratingWithState:&v47 objects:buf count:16];
    }

    while (v17);
  }

  v25 = objc_alloc(MEMORY[0x277D0F7A8]);
  v26 = [v38 workQueue];
  v27 = [v25 initWithQueue:v26];

  v28 = [MEMORY[0x277D0F7C0] allSettled:v15];
  v29 = [v28 ignoreOutcome];
  v39[0] = MEMORY[0x277D85DD0];
  v39[1] = 3221225472;
  v39[2] = __56__HMDHome__configureNewlyAddedAccessories_pairingEvent___block_invoke_3;
  v39[3] = &unk_278670158;
  v39[4] = v38;
  v41 = v51;
  v40 = v36;
  v30 = [v29 inContext:v27 then:v39];

  _Block_object_dispose(v51, 8);
  __HMFActivityScopeLeave();

  while (1)
  {

    v31 = v30;
    if (v31)
    {
      break;
    }

    _HMFPreconditionFailure();
LABEL_20:
    v30 = 0;
  }

  v32 = v31;

  v33 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_4(uint64_t a1)
{
  [*(a1 + 32) finishPairingForServer:*(a1 + 40)];
  [*(*(*(a1 + 48) + 8) + 40) na_each:&__block_literal_global_1531];
  return 1;
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_6(uint64_t a1)
{
  [*(a1 + 32) _notifyClientOfNewlyAddedAccessories:*(*(*(a1 + 56) + 8) + 40) requestMessage:*(a1 + 40)];
  (*(*(a1 + 48) + 16))();
  return 1;
}

uint64_t __76__HMDHome__processNewlyPairedAccessoryServerInfo_message_completionHandler___block_invoke_7(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v11 = 138543874;
    v12 = v7;
    v13 = 2112;
    v14 = v8;
    v15 = 2112;
    v16 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Add accessory failed for %@ with error %@", &v11, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 32) _removeFailedAddWithAccessoryServerInfo:*(a1 + 40)];
  [*(a1 + 48) respondWithError:v3];
  (*(*(a1 + 56) + 16))();

  v9 = *MEMORY[0x277D85DE8];
  return 1;
}

void __56__HMDHome__configureNewlyAddedAccessories_pairingEvent___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) administratorHandler];
  v5 = [v4 shouldRelayMessages];

  if ((v5 & 1) == 0)
  {
    [*(a1 + 40) autoConfigureTargetController];
  }

  if ([*(a1 + 40) isPrimary])
  {
    objc_storeStrong((*(*(a1 + 64) + 8) + 40), *(a1 + 40));
    [*(a1 + 48) begin];
    v9 = *(a1 + 48);
    v6 = *(a1 + 40);
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __56__HMDHome__configureNewlyAddedAccessories_pairingEvent___block_invoke_2;
    v7[3] = &unk_27868A728;
    v8 = *(a1 + 56);
    [v6 handleUpdatedServicesForThreadManagementWithCompletion:v7];

    __HMFActivityScopeLeave();
  }

  else
  {
    [*(a1 + 56) fulfillWithValue:0];
  }
}

uint64_t __56__HMDHome__configureNewlyAddedAccessories_pairingEvent___block_invoke_3(void *a1, void *a2)
{
  v3 = a2;
  v4 = a1[5];
  v5 = a1[4];
  v6 = *(*(a1[6] + 8) + 40);
  v7 = v4;
  if (v5)
  {
    v8 = [MEMORY[0x277D0F770] currentActivity];
    v22 = 0;
    v5 = [MEMORY[0x277D0F7C0] futureWithPromise:&v22];
    if ([v6 isPrimary])
    {
      [v8 begin];
      v21 = v8;
      v9 = [MEMORY[0x277CBEAA8] date];
      v15[0] = MEMORY[0x277D85DD0];
      v15[1] = 3221225472;
      v15[2] = __60__HMDHome__commissionAccessoryToThreadNetwork_pairingEvent___block_invoke;
      v15[3] = &unk_278676CB8;
      v10 = v9;
      v16 = v10;
      v17 = v21;
      v18 = v6;
      v19 = v7;
      v20 = v22;
      [v18 commissionToThreadNetworkWithPairingEvent:v19 completion:v15];

      __HMFActivityScopeLeave();
    }

    else
    {
      [v22 fulfillWithValue:0];
    }
  }

  v11 = v5;
  if (!v11)
  {
    v14 = _HMFPreconditionFailure();
    __HMFActivityScopeLeave();
    _Unwind_Resume(v14);
  }

  v12 = v11;

  return 3;
}

uint64_t __60__HMDHome__commissionAccessoryToThreadNetwork_pairingEvent___block_invoke(uint64_t a1, void *a2)
{
  v3 = MEMORY[0x277CBEAA8];
  v4 = a2;
  v5 = [v3 date];
  [v5 timeIntervalSinceDate:*(a1 + 32)];
  v7 = v6;

  [*(a1 + 48) uuid];
  v8 = [MEMORY[0x277CCABB0] numberWithDouble:v7];
  [v4 domain];

  [v4 code];
  [*(a1 + 56) setThreadCommissioningDuration:v7];
  [*(a1 + 56) setThreadCommissioningError:v4];

  v9 = *(a1 + 64);

  return [v9 fulfillWithValue:0];
}

uint64_t __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke(id *a1, void *a2)
{
  v41 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [a1[4] supportsMatCredACP];
  if (![v4 BOOLValue])
  {
    goto LABEL_10;
  }

  v5 = [a1[4] mfiCertifiedACWG];
  if (([v5 BOOLValue] & 1) != 0 || objc_msgSend(a1[5], "certificationStatus") != 2)
  {

LABEL_10:
    goto LABEL_11;
  }

  v6 = skipAuthPromptDialog;

  if ((v6 & 1) == 0)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = a1[6];
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [a1[4] mfiCertifiedACWG];
      v12 = [v11 BOOLValue];
      [a1[5] certificationStatus];
      v13 = HMAccessoryCertificationStatusToString();
      *buf = 138544130;
      *&buf[4] = v10;
      v35 = 1024;
      v36 = v12;
      v37 = 2112;
      v38 = v13;
      v39 = 1024;
      v40 = skipAuthPromptDialog;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Uncertified ECB lock detected, showing the uncertified accessory dialog. ACWG Certification status: %{BOOL}d, certification status: %@, shouldSkipAuthPrompt: %{BOOL}d", buf, 0x22u);
    }

    objc_autoreleasePoolPop(v7);
    *buf = 0;
    v14 = [MEMORY[0x277D0F7C0] futureWithPromise:buf];
    v15 = +[HMDUIDialogPresenter sharedUIDialogPresenter];
    v16 = a1[4];
    v17 = [a1[6] workQueue];
    v32[0] = MEMORY[0x277D85DD0];
    v32[1] = 3221225472;
    v32[2] = __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_1533;
    v32[3] = &unk_27867F418;
    v32[4] = a1[6];
    v33 = *buf;
    [v15 requestUserPermissionForUnauthenticatedAliroLockWithContext:v16 queue:v17 completionHandler:v32];

    v18 = v14;
    if (!v18)
    {
      _HMFPreconditionFailure();
    }

    v19 = v18;
    v20 = 3;

    goto LABEL_16;
  }

LABEL_11:
  v21 = [a1[4] supportsMatCredACP];
  v22 = [v21 BOOLValue];

  if (v22)
  {
    v23 = objc_autoreleasePoolPush();
    v24 = a1[6];
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      v27 = [a1[4] mfiCertifiedACWG];
      v28 = [v27 BOOLValue];
      [a1[5] certificationStatus];
      v29 = HMAccessoryCertificationStatusToString();
      *buf = 138544130;
      *&buf[4] = v26;
      v35 = 1024;
      v36 = v28;
      v37 = 2112;
      v38 = v29;
      v39 = 1024;
      v40 = skipAuthPromptDialog;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@Not showing uncertified dialog for ECB lock. ACWG Certification status: %{BOOL}d, certification status: %@, shouldSkipAuthPrompt: %{BOOL}d", buf, 0x22u);
    }

    objc_autoreleasePoolPop(v23);
  }

  v20 = 1;
LABEL_16:

  v30 = *MEMORY[0x277D85DE8];
  return v20;
}

uint64_t __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_1534(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) _configureWithFeatureSpecificDataAccessory:*(a1 + 40) accessoryModel:*(a1 + 48)];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_2(v7);
  }
}

uint64_t __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_2(void **a1, void *a2)
{
  v63 = *MEMORY[0x277D85DE8];
  v3 = a2;
  notifyMatterMetricPairingStep(a1[4], 0x1AuLL);
  v4 = [a1[4] administratorHandler];
  v5 = [v4 shouldRelayMessages];

  if (!v5)
  {
    v44 = objc_autoreleasePoolPush();
    v45 = a1[4];
    v46 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
    {
      v4 = HMFGetLogIdentifier();
      v47 = a1[5];
      v48 = [a1[7] shortDescription];
      *buf = 138543874;
      *&buf[4] = v4;
      *&buf[12] = 2112;
      *&buf[14] = v47;
      *&buf[22] = 2112;
      v59 = v48;
      _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_INFO, "%{public}@Locally adding accessories for the home using primary accessory model: %@, message: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v44);
    v49 = [(HMDHome *)a1[4] _addAccessoriesUsingPrimaryAccessoryModel:a1[6] updatedHomeInfo:a1[7] message:?];
    if (v49)
    {
      v50 = v49;

      goto LABEL_25;
    }

    goto LABEL_26;
  }

  v4 = a1[4];
  v6 = a1[5];
  v7 = a1[6];
  v8 = v6;
  v9 = v7;
  v54 = v3;
  v55 = v8;
  if (v4)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = v4;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v13;
      *&buf[12] = 2112;
      *&buf[14] = v8;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Remotely adding accessories via primary resident using primary accessory model: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = objc_alloc_init(MEMORY[0x277CBEB38]);
    v15 = v8;
    v4 = 0x277CBE000;
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
LABEL_27:
      v53 = v4[135];
      objc_opt_class();
      _HMFPreconditionFailureWithFormat();
    }

    v57 = 0;
    v16 = [HMDStructuredWriter writerIntoObject:&v57 extendedTypeOptions:9];
    v17 = HMDRemoteAddCodingModel();
    [v17 encodeRootObject:v15 withWriter:v16];

    v18 = objc_autoreleasePoolPush();
    v19 = v11;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v21;
      *&buf[12] = 2112;
      *&buf[14] = v57;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Including serialized accessories: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
    [v14 setObject:v57 forKeyedSubscript:@"HMDSerializedAccessoriesMessageKey"];
    if (v9)
    {
      v22 = objc_autoreleasePoolPush();
      v23 = v19;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEBUG))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543618;
        *&buf[4] = v25;
        *&buf[12] = 2112;
        *&buf[14] = v9;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_DEBUG, "%{public}@Including updated home info: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v22);
      [v14 setObject:v9 forKeyedSubscript:@"HMDUpdatedHomeInfoMessageKey"];
    }

    v26 = [v15 hostAccessory];
    v27 = [v26 modelID];

    if (v27)
    {
      v28 = objc_autoreleasePoolPush();
      v29 = v19;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
      {
        v31 = HMFGetLogIdentifier();
        *buf = 138543618;
        *&buf[4] = v31;
        *&buf[12] = 2112;
        *&buf[14] = v27;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_DEBUG, "%{public}@Including host accessory uuid: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v28);
      v32 = [v27 UUIDString];
      [v14 setObject:v32 forKeyedSubscript:@"HMDHostAccessoryIdentifierMessageKey"];
    }

    v56 = 0;
    v33 = [MEMORY[0x277D0F7C0] futureWithPromise:&v56];
    v34 = MEMORY[0x277D0F848];
    v35 = [v14 copy];
    *buf = MEMORY[0x277D85DD0];
    *&buf[8] = 3221225472;
    *&buf[16] = __76__HMDHome__remotelyAddAccessoriesFromPrimaryAccessoryModel_updatedHomeInfo___block_invoke;
    v59 = &unk_278686658;
    v60 = v19;
    v36 = v15;
    v61 = v36;
    v62 = v56;
    v37 = [v34 messageWithName:@"HMDRemoteAddHAPAccessoriesMessage" messagePayload:v35 responseHandler:buf];

    v38 = objc_alloc(MEMORY[0x277D0F820]);
    v39 = [v19 uuid];
    v4 = [v38 initWithTarget:v39];

    [v37 setDestination:v4];
    [v37 setQualityOfService:33];
    v40 = [v19 administratorHandler];
    v41 = [v40 operationForMessage:v37 error:0];
    if (v41)
    {
      [v40 addOperation:v41];
    }
  }

  else
  {
    v33 = 0;
  }

  v42 = v33;
  if (!v42)
  {
LABEL_26:
    _HMFPreconditionFailure();
    goto LABEL_27;
  }

  v43 = v42;

  v3 = v54;
LABEL_25:

  v51 = *MEMORY[0x277D85DE8];
  return 3;
}

- (id)_addAccessoriesUsingPrimaryAccessoryModel:(void *)a3 updatedHomeInfo:(void *)a4 message:
{
  v56 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  if (a1)
  {
    v10 = dispatch_group_create();
    v11 = [a1 backingStore];
    v12 = [v9 name];
    v13 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v14 = [v11 transaction:v12 options:v13];

    v15 = v14;
    v16 = v7;
    v17 = a1;
    v18 = v10;
    v42 = v9;
    v19 = v9;
    v20 = HMDAddToTransactionBlockFromHAPAccessoryModel(v15, v16, v17, v18, v19);
    if (!v20)
    {
      v49 = 0u;
      v50 = 0u;
      v47 = 0u;
      v48 = 0u;
      v21 = [v16 hostedAccessories];
      v20 = [v21 countByEnumeratingWithState:&v47 objects:buf count:16];
      if (v20)
      {
        v40 = v8;
        v41 = v7;
        v22 = *v48;
        while (2)
        {
          for (i = 0; i != v20; i = i + 1)
          {
            if (*v48 != v22)
            {
              objc_enumerationMutation(v21);
            }

            v24 = [*(*(&v47 + 1) + 8 * i) castIfHAPAccessory];
            if (v24)
            {
              v25 = v24;
              v26 = HMDAddToTransactionBlockFromHAPAccessoryModel(v15, v24, v17, v18, v19);
              if (v26)
              {
                v20 = v26;

                v21 = v20;
                goto LABEL_15;
              }
            }
          }

          v20 = [v21 countByEnumeratingWithState:&v47 objects:buf count:16];
          if (v20)
          {
            continue;
          }

          break;
        }

LABEL_15:
        v8 = v40;
        v7 = v41;
      }
    }

    if (v20)
    {
      v27 = objc_autoreleasePoolPush();
      v28 = v17;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543874;
        *&buf[4] = v30;
        v52 = 2112;
        v53 = v16;
        v54 = 2112;
        v55 = v20;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Failed to add to transaction block from primary accessory model %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v27);
      v31 = [MEMORY[0x277D0F7C0] futureWithError:v20];

      goto LABEL_29;
    }

    v32 = v15;
    v33 = v8;
    v34 = v17;
    v35 = [v34 emptyModelObjectWithChangeType:2];
    if (v33)
    {
      v36 = [v34 updateCHIPPropertiesOnHomeModel:v35 usingUpdatedHomeInfo:v33];
      if (([v34 hasNeverAddedAnyHAPAccessory] & 1) == 0)
      {
        if (!v36)
        {
          goto LABEL_28;
        }

        goto LABEL_27;
      }
    }

    else if (![v34 hasNeverAddedAnyHAPAccessory])
    {
LABEL_28:

      *buf = 0;
      v31 = [MEMORY[0x277D0F7C0] futureWithPromise:buf];
      v43[0] = MEMORY[0x277D85DD0];
      v43[1] = 3221225472;
      v43[2] = __77__HMDHome__addAccessoriesUsingPrimaryAccessoryModel_updatedHomeInfo_message___block_invoke;
      v43[3] = &unk_278688D58;
      v44 = v18;
      v45 = v34;
      v46 = *buf;
      [v32 run:v43];

LABEL_29:
      v9 = v42;
      goto LABEL_30;
    }

    v37 = [MEMORY[0x277CBEAA8] date];
    [v35 setFirstHAPAccessoryAddedDate:v37];

LABEL_27:
    [v32 add:v35];
    goto LABEL_28;
  }

  v31 = 0;
LABEL_30:

  v38 = *MEMORY[0x277D85DE8];

  return v31;
}

void __77__HMDHome__addAccessoriesUsingPrimaryAccessoryModel_updatedHomeInfo_message___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v5 = [*(a1 + 40) workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __77__HMDHome__addAccessoriesUsingPrimaryAccessoryModel_updatedHomeInfo_message___block_invoke_2;
  v7[3] = &unk_27868A750;
  v8 = v3;
  v9 = *(a1 + 48);
  v6 = v3;
  dispatch_group_notify(v4, v5, v7);
}

uint64_t __77__HMDHome__addAccessoriesUsingPrimaryAccessoryModel_updatedHomeInfo_message___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  v1 = *(a1 + 40);
  if (v2)
  {
    return [v1 rejectWithError:?];
  }

  else
  {
    return [v1 fulfillWithValue:?];
  }
}

void __76__HMDHome__remotelyAddAccessoriesFromPrimaryAccessoryModel_updatedHomeInfo___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 40);
      v13 = 138543874;
      v14 = v10;
      v15 = 2112;
      v16 = v11;
      v17 = 2112;
      v18 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to remotely add accessories using primary accessory model %@: %@", &v13, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
    [*(a1 + 48) rejectWithError:v5];
  }

  else
  {
    [*(a1 + 48) fulfillWithValue:0];
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __65__HMDHome__addAccessoriesUsingPairedAccessoryServerInfo_message___block_invoke_1533(uint64_t a1, int a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (a2)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Uncertified ECB lock detected, user canceled pairing", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    [v9 rejectWithError:v10];
  }

  else
  {
    if (v7)
    {
      v11 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v11;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Uncertified ECB lock detected, user continued pairing", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 40) fulfillWithNoValue];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (id)retrieveNewlyAddedAccessoriesForPairedAccessoryServerInfo:(id)a3
{
  v36 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277CBEB18] array];
  v6 = [v4 primaryAccessoryUUID];
  v7 = [(HMDHome *)self accessoryWithUUID:v6];

  if (v7)
  {
    [v5 addObject:v7];
    v8 = v7;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v10 = v8;
    }

    else
    {
      v10 = 0;
    }

    v30 = v10;

    if (isKindOfClass)
    {
      v27 = v7;
      v28 = v4;
      v29 = v5;
      v33 = 0u;
      v34 = 0u;
      v31 = 0u;
      v32 = 0u;
      v11 = [(HMDHome *)self accessories];
      v12 = [v11 countByEnumeratingWithState:&v31 objects:v35 count:16];
      if (v12)
      {
        v13 = v12;
        v14 = *v32;
        do
        {
          for (i = 0; i != v13; ++i)
          {
            if (*v32 != v14)
            {
              objc_enumerationMutation(v11);
            }

            v16 = *(*(&v31 + 1) + 8 * i);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v17 = v16;
            }

            else
            {
              v17 = 0;
            }

            v18 = v17;

            v19 = [v18 bridge];
            v20 = v19;
            if (v19)
            {
              v21 = [v19 uuid];
              v22 = [v30 uuid];
              v23 = [v21 isEqual:v22];

              if (v23)
              {
                [v29 addObject:v16];
              }
            }
          }

          v13 = [v11 countByEnumeratingWithState:&v31 objects:v35 count:16];
        }

        while (v13);
      }

      v4 = v28;
      v5 = v29;
      v7 = v27;
    }
  }

  v24 = [v5 copy];

  v25 = *MEMORY[0x277D85DE8];

  return v24;
}

- (BOOL)hasNeverAddedAnyHAPAccessory
{
  v3 = [(HMDHome *)self firstHAPAccessoryAddedDate];
  if (v3)
  {
    v4 = 0;
  }

  else
  {
    v5 = [(HMDHome *)self hapAccessories];
    v4 = [v5 count] == 0;
  }

  return v4;
}

- (void)_processLegacyPairingRequestForMessage:(id)a3 cancelPairing:(BOOL)a4 context:(id)a5
{
  v6 = a4;
  v61 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v51 = a5;
  v9 = [v8 uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v9)
  {
    if (v6)
    {
      v10 = [v8 responseHandler];
      [(HMDHome *)self _cancelPairingWithAccessoryUUID:v9 context:v51 completionHandler:v10];
    }

    else
    {
      v50 = [v8 stringForKey:*MEMORY[0x277CD1FD8]];
      v49 = [v8 stringForKey:@"kAccessoryOnboardingSetupPayloadStringKey"];
      v54 = 0u;
      v55 = 0u;
      v52 = 0u;
      v53 = 0u;
      v17 = [(HMDHome *)self addPendingAccessories];
      v18 = [v17 hm_allKeys];

      v19 = [v18 countByEnumeratingWithState:&v52 objects:v56 count:16];
      if (v19)
      {
        v20 = *v53;
LABEL_9:
        v21 = 0;
        while (1)
        {
          if (*v53 != v20)
          {
            objc_enumerationMutation(v18);
          }

          v22 = *(*(&v52 + 1) + 8 * v21);
          v23 = [v22 accessoryUUID];
          v24 = [v23 isEqual:v9];

          if (v24)
          {
            break;
          }

          if (v19 == ++v21)
          {
            v19 = [v18 countByEnumeratingWithState:&v52 objects:v56 count:16];
            if (v19)
            {
              goto LABEL_9;
            }

            goto LABEL_15;
          }
        }

        v25 = v22;

        if (!v25)
        {
          goto LABEL_24;
        }

        v26 = objc_autoreleasePoolPush();
        v27 = self;
        v28 = HMFGetOSLogHandle();
        v29 = os_log_type_enabled(v28, OS_LOG_TYPE_INFO);
        if (v50)
        {
          if (v29)
          {
            v30 = HMFGetLogIdentifier();
            *buf = 138543618;
            v58 = v30;
            v59 = 2112;
            v60 = v9;
            _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@Storing the setupCode for accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v26);
          v31 = [(HMDHome *)v27 addPendingAccessorySetupCodes];
          [v31 setObject:v50 forKey:v9];

          v32 = [(HMDHome *)v27 addPendingAccessoryOnboardingSetupPayloadStrings];
          [v32 setObject:v49 forKeyedSubscript:v9];

          v33 = [(HMDHome *)v27 accessoryBrowser];
          v34 = [v33 unpairedAccessoryWithUUID:v9];

          if (v34)
          {
            v35 = [(HMDHome *)v27 accessoryBrowser];
            [v35 handleSetupCodeAvailable:v34];
          }

          v36 = [(HMDHome *)v27 addPendingAccessorySetupCodeHandlers];
          v37 = [v36 objectForKeyedSubscript:v9];

          if (v37)
          {
            os_unfair_recursive_lock_lock_with_options();
            [(NSMutableDictionary *)v27->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v9];
            os_unfair_recursive_lock_unlock();
            (v37)[2](v37, v50, v49, 0);
          }

          else
          {
            v44 = objc_autoreleasePoolPush();
            v45 = v27;
            v46 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
            {
              v47 = HMFGetLogIdentifier();
              *buf = 138543618;
              v58 = v47;
              v59 = 2112;
              v60 = v9;
              _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_INFO, "%{public}@No handler to provide the setup code to for accessory: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v44);
          }

          [v8 respondWithSuccess];
        }

        else
        {
          if (v29)
          {
            v42 = HMFGetLogIdentifier();
            *buf = 138543618;
            v58 = v42;
            v59 = 2112;
            v60 = v9;
            _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@No setupCode specified to continue pairing with accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v26);
          v43 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          [v8 respondWithError:v43];
        }
      }

      else
      {
LABEL_15:

LABEL_24:
        v38 = objc_autoreleasePoolPush();
        v39 = self;
        v40 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
        {
          v41 = HMFGetLogIdentifier();
          *buf = 138543618;
          v58 = v41;
          v59 = 2112;
          v60 = v9;
          _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_INFO, "%{public}@Accessory with UUID %@ not being added to the home", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v38);
        v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:79];
        [v8 respondWithError:v25];
      }
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v8 messagePayload];
      *buf = 138543618;
      v58 = v14;
      v59 = 2112;
      v60 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@No accessory UUID found in payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v8 respondWithError:v16];
  }

  v48 = *MEMORY[0x277D85DE8];
}

- (void)_cancelPairingWithAccessoryUUID:(id)a3 context:(id)a4 completionHandler:(id)a5
{
  v48 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v39 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self accessoryBrowser];
  v11 = [v10 unassociatedAccessories];
  v12 = [v11 hmf_firstObjectWithUUID:v8];

  v13 = v12;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  v15 = v14;

  if (v15)
  {
    v42[0] = MEMORY[0x277D85DD0];
    v42[1] = 3221225472;
    v42[2] = __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke;
    v42[3] = &unk_278688B80;
    v43 = v9;
    [v15 cancelConfigurationWithCompletionHandler:v42];
    v16 = v43;
  }

  else
  {
    v17 = [(HMDHome *)self accessoryBrowser];
    v38 = [v17 unpairedAccessoryWithUUID:v8];

    v18 = [(HMDHome *)self addPendingAccessorySetupCodeHandlers];
    v37 = [v18 objectForKeyedSubscript:v8];

    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      v23 = [v8 UUIDString];
      *buf = 138543618;
      v45 = v22;
      v46 = 2112;
      v47 = v23;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Canceling pairing and removing all state for accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    os_unfair_recursive_lock_lock_with_options();
    v24 = [(NSMapTable *)v20->_addPendingAccessories hm_allKeys];
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke_1527;
    v40[3] = &unk_27866FE40;
    v25 = v8;
    v41 = v25;
    v26 = [v24 na_firstObjectPassingTest:v40];

    [(NSMutableDictionary *)v20->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v25];
    if (v26)
    {
      [(NSMapTable *)v20->_addPendingAccessories removeObjectForKey:v26];
    }

    os_unfair_recursive_lock_unlock();
    if (v38)
    {
      v27 = [(HMDHome *)v20 accessoryBrowser];
      v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      [v27 cancelPairingWithAccessory:v38 error:v28 context:v39];
    }

    if (v37)
    {
      v29 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      (v37)[2](v37, 0, 0, v29);

      if (v9)
      {
        (*(v9 + 2))(v9, 0, 0);
      }
    }

    else
    {
      context = objc_autoreleasePoolPush();
      v30 = v20;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
      {
        v32 = HMFGetLogIdentifier();
        v33 = [v25 UUIDString];
        *buf = 138543618;
        v45 = v32;
        v46 = 2112;
        v47 = v33;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_INFO, "%{public}@Unable to find setup available completion handler for accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(context);
      if (v9)
      {
        v34 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        (*(v9 + 2))(v9, v34, 0);
      }
    }

    v16 = v38;
  }

  v35 = *MEMORY[0x277D85DE8];
}

uint64_t __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0);
  }

  return result;
}

uint64_t __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke_1527(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 accessoryUUID];
  v4 = [v2 isEqual:v3];

  return v4;
}

- (void)_processPairingRequestForMessage:(id)a3 cancelPairing:(BOOL)a4 context:(id)a5
{
  v6 = a4;
  v24 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  v10 = [v8 dataForKey:*MEMORY[0x277CD1F90]];
  v19 = 0;
  v11 = [(HMDHome *)self _setupDescriptionFromData:v10 error:&v19];
  v12 = v19;
  if (v11)
  {
    if (v6)
    {
      [(HMDHome *)self _cancelPairingWithAccessoryDescription:v11 context:v9];
      [v8 respondWithPayload:0];
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = v12;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v8 respondWithError:v17];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_cancelPairingWithAccessoryDescription:(id)a3 context:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 accessoryUUID];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v12;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Canceling pairing and removing all state for accessory with description %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)v10->_addPendingAccessories removeObjectForKey:v6];
  if (v8)
  {
    [(NSMutableDictionary *)v10->_addPendingAccessorySetupCodes removeObjectForKey:v8];
    [(NSMutableDictionary *)v10->_addPendingAccessoryOnboardingSetupPayloadStrings removeObjectForKey:v8];
    [(NSMutableDictionary *)v10->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v8];
  }

  os_unfair_recursive_lock_unlock();
  v13 = [(HMDHome *)v10 accessoryBrowser];
  v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
  [v13 cancelPairingWithAccessoryDescription:v6 error:v14 context:v7];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleCancelPairingAccessory:(id)a3
{
  v4 = MEMORY[0x277CCA9B8];
  v5 = a3;
  v6 = [v4 hmInternalErrorWithCode:1090];
  v8 = [HMDMatterAccessoryPairingEndContext hmContextWithCancelledError:v6];

  v7 = [v5 dataForKey:*MEMORY[0x277CD1F90]];

  if (v7)
  {
    [(HMDHome *)self _processPairingRequestForMessage:v5 cancelPairing:1 context:v8];
  }

  else
  {
    [(HMDHome *)self _processLegacyPairingRequestForMessage:v5 cancelPairing:1 context:v8];
  }
}

- (id)_setupCodeProviderForMessage:(id)a3
{
  v4 = a3;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke;
  aBlock[3] = &unk_27866FE68;
  objc_copyWeak(&v11, &location);
  v5 = v4;
  v10 = v5;
  v6 = _Block_copy(aBlock);
  v7 = [v6 copy];

  objc_destroyWeak(&v11);
  objc_destroyWeak(&location);

  return v7;
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v11 = WeakRetained;
  if (WeakRetained)
  {
    v12 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_2;
    block[3] = &unk_278688978;
    block[4] = v11;
    v15 = v7;
    v16 = v8;
    v18 = v9;
    v17 = *(a1 + 32);
    dispatch_async(v12, block);
  }

  else
  {
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(v9 + 2))(v9, 0, 0, v13);
  }
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke_2(id *a1)
{
  v81 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] homeManager];
  v3 = [a1[5] uuid];
  v4 = [a1[5] name];
  v5 = v4;
  if (v3)
  {
    v6 = v4 == 0;
  }

  else
  {
    v6 = 1;
  }

  if (v6 || (v7 = a1[6]) == 0)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = a1[4];
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v3 UUIDString];
      *buf = 138543874;
      v74 = v19;
      v75 = 2112;
      v76 = v5;
      v77 = 2112;
      v78 = v20;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ went away while being added to home", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    v21 = a1[8];
    v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    (*(v21 + 2))(v21, 0, 0, v22);
  }

  else
  {
    if ([v7 isEqualToString:@"HMSetupCodeProviderReasonBadPassword"])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = a1[4];
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v74 = v11;
        v75 = 2112;
        v76 = v3;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Clearing previous password on bad-password error for accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      v12 = [a1[4] addPendingAccessorySetupCodes];
      [v12 removeObjectForKey:v3];

      v13 = [a1[4] addPendingAccessoryOnboardingSetupPayloadStrings];
      [v13 removeObjectForKey:v3];
    }

    v14 = *MEMORY[0x277CD1FD8];
    v15 = [a1[7] stringForKey:*MEMORY[0x277CD1FD8]];
    if (v15 && [a1[7] isEntitledForSPIAccess])
    {
      if ([a1[6] isEqualToString:@"HMSetupCodeProviderReasonBadPassword"])
      {

LABEL_27:
        v46 = objc_autoreleasePoolPush();
        v47 = a1[4];
        v48 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
        {
          v49 = HMFGetLogIdentifier();
          v50 = [a1[7] stringForKey:v14];
          v51 = [v3 UUIDString];
          *buf = 138544130;
          v74 = v49;
          v75 = 2112;
          v76 = v50;
          v77 = 2112;
          v78 = v5;
          v79 = 2112;
          v80 = v51;
          _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_INFO, "%{public}@Provided password %@ incorrect for accessory %@/%@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v46);
        v52 = a1[8];
        v22 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2002];
        (*(v52 + 2))(v52, 0, 0, v22);
        goto LABEL_17;
      }

      v45 = [a1[6] isEqualToString:@"HMSetupCodeProviderReasontTimeoutRetry"];

      if (v45)
      {
        goto LABEL_27;
      }
    }

    else
    {
    }

    v24 = a1[4];
    os_unfair_recursive_lock_lock_with_options();
    v25 = [a1[8] copy];
    v26 = _Block_copy(v25);
    [*(a1[4] + 113) setObject:v26 forKeyedSubscript:v3];

    os_unfair_recursive_lock_unlock();
    if ([a1[6] isEqualToString:@"HMSetupCodeProviderReasonInitial"])
    {
      v27 = [a1[4] addPendingAccessorySetupCodes];
      v22 = [v27 objectForKey:v3];

      v28 = [a1[4] addPendingAccessoryOnboardingSetupPayloadStrings];
      v29 = [v28 objectForKeyedSubscript:v3];

      v30 = objc_autoreleasePoolPush();
      v31 = a1[4];
      v32 = HMFGetOSLogHandle();
      v33 = os_log_type_enabled(v32, OS_LOG_TYPE_INFO);
      if (v22)
      {
        if (v33)
        {
          v34 = HMFGetLogIdentifier();
          v35 = a1[5];
          *buf = 138543618;
          v74 = v34;
          v75 = 2112;
          v76 = v35;
          _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Providing setupCode for accessory %@ and removing from tracking", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v30);
        (*(a1[8] + 2))();
      }

      else
      {
        if (v33)
        {
          v53 = HMFGetLogIdentifier();
          *buf = 138543874;
          v74 = v53;
          v75 = 2112;
          v76 = v5;
          v77 = 2112;
          v78 = v3;
          _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ prompted for pairing setupCode but did not receive it from HomeUIService", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v30);
        if ([a1[7] BOOLForKey:*MEMORY[0x277CD2010]])
        {
          v54 = objc_autoreleasePoolPush();
          v55 = a1[4];
          v56 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
          {
            v57 = HMFGetLogIdentifier();
            v58 = [v3 UUIDString];
            *buf = 138543874;
            v74 = v57;
            v75 = 2112;
            v76 = v5;
            v77 = 2112;
            v78 = v58;
            _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_INFO, "%{public}@addAccessory request from HomeUIService - waiting for setupCode for accessory %@/%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v54);
        }

        else
        {
          v64 = [v2 accessorySetupManager];
          v65 = [a1[4] uuid];
          v66 = [a1[7] proxyConnection];
          v68[0] = MEMORY[0x277D85DD0];
          v68[1] = 3221225472;
          v68[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_1522;
          v68[3] = &unk_278689358;
          v68[4] = a1[4];
          v70 = a1[8];
          v69 = v3;
          [v64 launchAccessorySetupHostToRequestSetupCodeForAccessoryWithUUID:v69 accessoryName:v5 homeUUID:v65 clientConnection:v66 completionHandler:v68];
        }

        v22 = v29;
      }
    }

    else
    {
      v36 = objc_alloc(MEMORY[0x277D0F820]);
      v37 = [a1[4] uuid];
      v22 = [v36 initWithTarget:v37];

      v38 = objc_alloc(MEMORY[0x277D0F848]);
      v39 = a1[6];
      v71 = *MEMORY[0x277CD2018];
      v72 = v39;
      v40 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v72 forKeys:&v71 count:1];
      v41 = [v38 initWithName:*MEMORY[0x277CCFDB8] qualityOfService:33 destination:v22 payload:v40];

      v42 = [v2 accessorySetupManager];
      v43 = [v42 accessorySetupHostClientConnection];

      if (v43)
      {
        [v41 setTransport:v43];
        v44 = [a1[4] msgDispatcher];
        [v44 sendMessage:v41];
      }

      else
      {
        context = objc_autoreleasePoolPush();
        v59 = a1[4];
        v60 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v60, OS_LOG_TYPE_INFO))
        {
          v61 = HMFGetLogIdentifier();
          v62 = a1[5];
          *buf = 138543618;
          v74 = v61;
          v75 = 2112;
          v76 = v62;
          _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_INFO, "%{public}@No HomeUIService connection for accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(context);
        v63 = a1[8];
        v44 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2002];
        (*(v63 + 2))(v63, 0, 0, v44);
      }
    }
  }

LABEL_17:

  v23 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke_1522(id *a1, void *a2)
{
  v3 = a2;
  if (v3)
  {
    v4 = [a1[4] workQueue];
    v5[0] = MEMORY[0x277D85DD0];
    v5[1] = 3221225472;
    v5[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_2_1523;
    v5[3] = &unk_278689AB8;
    v5[4] = a1[4];
    v6 = v3;
    v8 = a1[6];
    v7 = a1[5];
    dispatch_async(v4, v5);
  }
}

uint64_t __40__HMDHome__setupCodeProviderForMessage___block_invoke_2_1523(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_ERROR))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    *buf = 138543618;
    v16 = v5;
    v17 = 2112;
    v18 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_ERROR, "%{public}@Failed to request setup code for accessory: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = *(a1 + 40);
  (*(*(a1 + 56) + 16))();
  v8 = *(a1 + 32);
  os_unfair_recursive_lock_lock_with_options();
  v9 = [*(*(a1 + 32) + 1192) hm_allKeys];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_1524;
  v13[3] = &unk_27866FE40;
  v14 = *(a1 + 48);
  v10 = [v9 na_firstObjectPassingTest:v13];

  if (v10)
  {
    [*(*(a1 + 32) + 1192) removeObjectForKey:v10];
  }

  [*(*(a1 + 32) + 904) removeObjectForKey:*(a1 + 48)];
  [*(*(a1 + 32) + 912) removeObjectForKey:*(a1 + 48)];
  [*(*(a1 + 32) + 920) removeObjectForKey:*(a1 + 48)];

  result = os_unfair_recursive_lock_unlock();
  v12 = *MEMORY[0x277D85DE8];
  return result;
}

uint64_t __40__HMDHome__setupCodeProviderForMessage___block_invoke_1524(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 accessoryUUID];
  v4 = [v2 isEqual:v3];

  return v4;
}

- (BOOL)hasAnyReachableAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_any:&__block_literal_global_1521];

  return v3;
}

- (void)retrieveStateForTrackedAccessory:(id)a3 stateNumber:(id *)a4 isReachable:(BOOL *)a5 linkQuality:(unint64_t *)a6 lastSeen:(id *)a7
{
  v12 = a3;
  v14 = [(HMDHome *)self accessoryBrowser];
  v13 = [v14 accessoryBrowserHapProtocol];
  [v13 retrieveCurrentStateForIdentifier:v12 stateNumber:a4 isReachable:a5 linkQuality:a6 lastSeen:a7];
}

- (void)getReachableIPAccessories:(unint64_t *)a3 btleAccessories:(unint64_t *)a4 mediaAccessories:(unint64_t *)a5
{
  v31 = *MEMORY[0x277D85DE8];
  if (a3 | a4)
  {
    v28 = 0u;
    v29 = 0u;
    v26 = 0u;
    v27 = 0u;
    obj = [(HMDHome *)self accessories];
    v5 = [obj countByEnumeratingWithState:&v26 objects:v30 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = 0;
      v8 = 0;
      v9 = 0;
      v10 = *v27;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v27 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v26 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v13 = v12;
          }

          else
          {
            v13 = 0;
          }

          v14 = v13;

          if (v14)
          {
            v15 = [v14 matchingHAPAccessoryWithLinkType:1];
            v9 += [v15 isReachable];
            v16 = [v14 matchingHAPAccessoryWithLinkType:2];

            v8 += [v16 isReachable];
          }

          v17 = v12;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v18 = v17;
          }

          else
          {
            v18 = 0;
          }

          v19 = v18;

          v20 = [v19 isReachable];
          v7 += v20;
        }

        v6 = [obj countByEnumeratingWithState:&v26 objects:v30 count:16];
      }

      while (v6);
    }

    else
    {
      v7 = 0;
      v8 = 0;
      v9 = 0;
    }

    if (a3)
    {
      *a3 = v9;
    }

    if (a4)
    {
      *a4 = v8;
    }

    if (a5)
    {
      *a5 = v7;
    }
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (int64_t)reachableAppleMediaAccessoriesCount
{
  v18 = *MEMORY[0x277D85DE8];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v14;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(v2);
        }

        v8 = *(*(&v13 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        if (v10)
        {
          v5 += [v8 isReachable];
        }
      }

      v4 = [v2 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  v11 = *MEMORY[0x277D85DE8];
  return v5;
}

- (int64_t)reachableAccessoriesCountExcludingMatter
{
  v2 = self;
  v41 = *MEMORY[0x277D85DE8];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v3 = [(HMDHome *)self accessories];
  v4 = [v3 countByEnumeratingWithState:&v30 objects:v40 count:16];
  if (v4)
  {
    v6 = v4;
    v29 = 0;
    v7 = *v31;
    *&v5 = 138543618;
    v26 = v5;
    v27 = v3;
    v28 = v2;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v31 != v7)
        {
          objc_enumerationMutation(v3);
        }

        v9 = *(*(&v30 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          if ([v11 isReachable] && (objc_msgSend(v11, "supportsCHIP") & 1) == 0)
          {
            v12 = objc_autoreleasePoolPush();
            v13 = v2;
            v14 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
            {
              v15 = HMFGetLogIdentifier();
              v16 = [v11 name];
              *buf = v26;
              v35 = v15;
              v36 = 2112;
              v37 = v16;
              _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Accessory: %@ is reachable", buf, 0x16u);

              v2 = v28;
              v3 = v27;
            }

            objc_autoreleasePoolPop(v12);
            ++v29;
          }

          if ([v11 supportsCHIP])
          {
            v17 = objc_autoreleasePoolPush();
            v18 = v2;
            v19 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
            {
              v20 = HMFGetLogIdentifier();
              v21 = [v11 name];
              v22 = [v11 isReachable];
              *buf = 138543874;
              v23 = @"NO";
              if (v22)
              {
                v23 = @"YES";
              }

              v35 = v20;
              v36 = 2112;
              v37 = v21;
              v38 = 2112;
              v39 = v23;
              _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Ignoring Matter Accessory: %@ isReachable: %@", buf, 0x20u);

              v3 = v27;
              v2 = v28;
            }

            objc_autoreleasePoolPop(v17);
          }
        }
      }

      v6 = [v3 countByEnumeratingWithState:&v30 objects:v40 count:16];
    }

    while (v6);
  }

  else
  {
    v29 = 0;
  }

  v24 = *MEMORY[0x277D85DE8];
  return v29;
}

- (int64_t)reachableAccessoriesCount
{
  v21 = *MEMORY[0x277D85DE8];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  obj = [(HMDHome *)self accessories];
  v2 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = 0;
    v5 = *v17;
    do
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v17 != v5)
        {
          objc_enumerationMutation(obj);
        }

        v7 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        v10 = v7;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v9 && [v9 isReachable])
        {
          ++v4;
        }

        else if (v12 && [v12 isCurrentAccessory])
        {
          v4 += [v12 isReachable];
        }
      }

      v3 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v3);
  }

  else
  {
    v4 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];
  return v4;
}

- (void)_reachabilityChangedForAccessory:(id)a3 reachable:(BOOL)a4
{
  v53 = a4;
  v68 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v6);

  v7 = [(HMDHome *)self reachableAccessoriesCount];
  v8 = [(HMDHome *)self previousReachableAccessoriesCount];
  v9 = [(HMDHome *)self reachableAppleMediaAccessoriesCount];
  v10 = [(HMDHome *)self previousReachableAppleMediaAccessoriesCount];
  [(HMDHome *)self setPreviousReachableAccessoriesCount:v7];
  [(HMDHome *)self setPreviousReachableAppleMediaAccessoriesCount:v9];
  v11 = v9 + v7 < 1;
  if ((v10 + v8 < 0) ^ __OFADD__(v10, v8) | (v10 + v8 == 0))
  {
    v12 = 0;
  }

  else
  {
    v12 = 1;
  }

  v13 = v11 ^ v12;
  if (((v11 ^ v12) & 1) == 0)
  {
    v52 = v5;
    v14 = v11 ^ v12;
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138544642;
      v57 = v18;
      v58 = 2048;
      v59 = v7;
      v60 = 2048;
      v61 = v9;
      v62 = 1024;
      v63 = v53;
      v64 = 2048;
      v65 = v8;
      v66 = 2048;
      v67 = v10;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Total reachable accessories %ld, apple media accessories: %ld, reachable = %d,                      last known reachable = %ld, last known apple media reachable = %ld", buf, 0x3Au);
    }

    objc_autoreleasePoolPop(v15);
    v13 = v14;
    v5 = v52;
  }

  v19 = [(HMDHome *)self localCapabilitiesDataSource];
  v20 = [v19 supportsRemoteAccess];

  if (v20)
  {
    v55 = 0;
    [(HMDHome *)self getReachableIPAccessories:&v55 btleAccessories:0 mediaAccessories:0];
    v21 = [(HMDHome *)self reachableAccessoriesCountExcludingMatter];
    v22 = [(HMDHome *)self previousReachableAccessoriesCountExcludingMatter];
    [(HMDHome *)self setPreviousReachableAccessoriesCountExcludingMatter:v21];
    v23 = [(HMDHome *)self homeLocationHandler];
    [v23 accessoryReachabilityChanged:v21 previousReachableAccessoriesCount:v22 reachableAppleMediaAccessoriesCount:v9 previousReachableAppleMediaAccessoriesCount:v10];

    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      v28 = v27;
      v29 = @"don't ";
      if (v7 > 0)
      {
        v29 = &stru_283CF9D50;
      }

      *buf = 138543618;
      v57 = v27;
      v58 = 2112;
      v59 = v29;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Notifying home manager that we %@have locally reachable accessories", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    v30 = [(HMDHome *)v25 homeManager];
    v31 = [(HMDHome *)v25 uuid];
    [v30 accessoriesAreLocallyReachableOnTransientDevice:v7 > 0 forHome:v31];

    if ([v5 accessoryReprovisionState] && v53)
    {
      v54 = v13;
      v32 = objc_autoreleasePoolPush();
      v33 = v25;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
      {
        v35 = HMFGetLogIdentifier();
        v36 = [v5 name];
        *buf = 138543618;
        v57 = v35;
        v58 = 2112;
        v59 = v36;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ reprovision state is updated to Not Required", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v32);
      [v5 setAccessoryReprovisionState:0];
      v37 = [v5 uuid];
      [v30 updateGenerationCounterWithReason:@"ReprovisionStateChange" sourceUUID:v37 shouldNotifyClients:0];

      v38 = [MEMORY[0x277CBEB38] dictionary];
      v39 = [v5 uuid];
      v40 = [v39 UUIDString];
      [v38 setObject:v40 forKeyedSubscript:*MEMORY[0x277CCF0B0]];

      [v38 setObject:&unk_283E71A38 forKeyedSubscript:*MEMORY[0x277CD2008]];
      v41 = MEMORY[0x277D0F848];
      v42 = *MEMORY[0x277CD1FF8];
      v43 = [(HMDHome *)v33 messageDestination];
      v44 = [v41 messageWithName:v42 destination:v43 payload:v38];

      v45 = [(HMDHome *)v33 msgDispatcher];
      [v45 sendMessage:v44 completionHandler:0];

      v13 = v54;
    }
  }

  if (v7 >= 1 && v8 <= 0)
  {
    v46 = objc_autoreleasePoolPush();
    v47 = self;
    v48 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
    {
      v49 = HMFGetLogIdentifier();
      *buf = 138543362;
      v57 = v49;
      _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_INFO, "%{public}@Notifying that we see at least one reachable accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v46);
    v50 = [(HMDHome *)v47 notificationCenter];
    [v50 postNotificationName:@"HMDHomeCurrentDeviceHasReachableAccessories" object:v47];
  }

  if ((v13 & 1) == 0)
  {
    [(HMFTimer *)self->_homeLocationTimer resume];
  }

  v51 = *MEMORY[0x277D85DE8];
}

- (void)_handleAccessoryReachabilityChange:(id)a3
{
  v100 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v64 = *MEMORY[0x277CD0640];
  v5 = [v4 stringForKey:?];
  v6 = [(HMDHome *)self uuid];
  v7 = [v6 UUIDString];
  v8 = [v5 isEqualToString:v7];

  v72 = self;
  v66 = v5;
  if (v8)
  {
    v65 = 0;
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [(HMDHome *)v10 uuid];
      v14 = [v13 UUIDString];
      *buf = 138543874;
      v91 = v12;
      v92 = 2112;
      v93 = v5;
      v94 = 2112;
      v95 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Home does not match, received: %@, current: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    v65 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  }

  v67 = v4;
  v15 = [v4 messagePayload];
  v16 = [v15 hmf_arrayForKey:*MEMORY[0x277CCE7A8]];

  v86 = 0u;
  v87 = 0u;
  v84 = 0u;
  v85 = 0u;
  obj = v16;
  v17 = v72;
  v70 = [obj countByEnumeratingWithState:&v84 objects:v99 count:16];
  if (v70)
  {
    v69 = *v85;
    do
    {
      v18 = 0;
      do
      {
        if (*v85 != v69)
        {
          objc_enumerationMutation(obj);
        }

        v71 = v18;
        v19 = *(*(&v84 + 1) + 8 * v18);
        v80 = 0u;
        v81 = 0u;
        v82 = 0u;
        v83 = 0u;
        v75 = [(HMDHome *)v17 accessories];
        v79 = [v75 countByEnumeratingWithState:&v80 objects:v98 count:16];
        if (v79)
        {
          v78 = *v81;
          v76 = v19;
          do
          {
            for (i = 0; i != v79; ++i)
            {
              if (*v81 != v78)
              {
                objc_enumerationMutation(v75);
              }

              v21 = *(*(&v80 + 1) + 8 * i);
              v22 = [v21 uuid];
              v23 = [v22 UUIDString];

              v24 = [v19 objectForKeyedSubscript:v23];
              if (v24)
              {
                v25 = objc_autoreleasePoolPush();
                v26 = v17;
                v27 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
                {
                  v28 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v91 = v28;
                  v92 = 2112;
                  v93 = v23;
                  v94 = 2112;
                  v95 = v24;
                  _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Setting remote reachability for accessory: %@ to: %@", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v25);
                [v21 setRemotelyReachable:{objc_msgSend(v24, "BOOLValue")}];
              }

              v29 = v21;
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v30 = v29;
              }

              else
              {
                v30 = 0;
              }

              v31 = v30;

              v32 = [v31 identifier];

              if (v32)
              {
                v33 = [v31 identifier];
                v34 = [v19 objectForKeyedSubscript:v33];

                if (v34)
                {
                  v35 = [v34 unsignedIntegerValue];
                  context = objc_autoreleasePoolPush();
                  v36 = v17;
                  v37 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v37, OS_LOG_TYPE_DEBUG))
                  {
                    v38 = HMFGetLogIdentifier();
                    v39 = [v29 identifier];
                    [v31 suspendedState];
                    HAPAccessorySuspendedStateDescription();
                    v40 = v73 = v23;
                    HAPAccessorySuspendedStateDescription();
                    v41 = v74 = v35;
                    *buf = 138544130;
                    v91 = v38;
                    v92 = 2112;
                    v93 = v39;
                    v94 = 2112;
                    v95 = v40;
                    v96 = 2112;
                    v97 = v41;
                    _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_DEBUG, "%{public}@Handle Reachability change. Setting suspended state of accessory: %@ from '%@' to '%@'", buf, 0x2Au);

                    v35 = v74;
                    v23 = v73;

                    v17 = v72;
                  }

                  objc_autoreleasePoolPop(context);
                  [v31 setSuspendedState:v35 shouldNotify:0 saveToBackingStore:1];
                }

                v19 = v76;
              }
            }

            v79 = [v75 countByEnumeratingWithState:&v80 objects:v98 count:16];
          }

          while (v79);
        }

        v18 = v71 + 1;
      }

      while (v71 + 1 != v70);
      v70 = [obj countByEnumeratingWithState:&v84 objects:v99 count:16];
    }

    while (v70);
  }

  v42 = [v67 responseHandler];

  if (v42)
  {
    v43 = [v67 responseHandler];
    (v43)[2](v43, v65, 0);
  }

  v44 = [v67 remoteSourceDevice];
  v45 = [(HMDHome *)v72 primaryResident];
  v46 = [v45 device];
  if ([v44 isEqual:v46])
  {
    v47 = [(HMDHome *)v72 currentRemoteReachabilityRegistration];

    if (v47)
    {
      goto LABEL_42;
    }
  }

  else
  {
  }

  v48 = objc_autoreleasePoolPush();
  v49 = v72;
  v50 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
  {
    v51 = HMFGetLogIdentifier();
    *buf = 138543618;
    v91 = v51;
    v92 = 2112;
    v93 = v44;
    _os_log_impl(&dword_229538000, v50, OS_LOG_TYPE_INFO, "%{public}@De-registering stale remote reachability for accessories with device = %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v48);
  v52 = objc_alloc(MEMORY[0x277D0F818]);
  v53 = [MEMORY[0x277D0F820] allMessageDestinations];
  v88 = v64;
  v54 = [(HMDHome *)v49 uuid];
  v55 = [v54 UUIDString];
  v89 = v55;
  v56 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v89 forKeys:&v88 count:1];
  v57 = [v52 initWithName:@"kDisableAccessoryReachabilityNotificationRequestKey" destination:v53 payload:v56];

  v58 = [(HMDHome *)v49 homeManager];
  v59 = [v58 messageDispatcher];
  v60 = [(HMDHome *)v49 uuid];
  v61 = [v44 remoteDestinationString];
  v62 = [(HMDHome *)v49 workQueue];
  [v59 sendSecureMessage:v57 target:v60 userID:0 destination:v61 responseQueue:v62 responseHandler:0];

LABEL_42:
  v63 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoteReachabilityNotificationTimerFired
{
  v82 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = objc_autoreleasePoolPush();
  v5 = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [(HMDHome *)v5 remoteReachabilityNotificationPendingAccessories];
    *buf = 138543618;
    v75 = v7;
    v76 = 2112;
    v77 = v8;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Reachability notification timer fired, pending list: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v70 = 0u;
  v71 = 0u;
  v68 = 0u;
  v69 = 0u;
  obj = [(HMDHome *)v5 reachabilityRegisteredDevices];
  v58 = [obj countByEnumeratingWithState:&v68 objects:v81 count:16];
  if (v58)
  {
    v57 = *v69;
    v55 = *MEMORY[0x277CD0640];
    v56 = *MEMORY[0x277CCE7A8];
    *&v9 = 138543874;
    v53 = v9;
    v10 = 0x277CCA000uLL;
    v62 = v5;
    do
    {
      v11 = 0;
      do
      {
        if (*v69 != v57)
        {
          objc_enumerationMutation(obj);
        }

        v59 = *(*(&v68 + 1) + 8 * v11);
        v60 = v11;
        v12 = MEMORY[0x277CBEB18];
        v13 = [(HMDHome *)v5 remoteReachabilityNotificationPendingAccessories];
        v63 = [v12 arrayWithCapacity:{objc_msgSend(v13, "count")}];

        v66 = 0u;
        v67 = 0u;
        v64 = 0u;
        v65 = 0u;
        v61 = [(HMDHome *)v5 accessories];
        v14 = [v61 countByEnumeratingWithState:&v64 objects:v80 count:16];
        if (v14)
        {
          v15 = v14;
          v16 = *v65;
          do
          {
            for (i = 0; i != v15; ++i)
            {
              if (*v65 != v16)
              {
                objc_enumerationMutation(v61);
              }

              v18 = *(*(&v64 + 1) + 8 * i);
              v19 = [v18 uuid];
              v20 = [v19 UUIDString];
              v21 = [(HMDHome *)v5 _getReachabilityTupleForAccessoryUUID:v20];

              if (v21)
              {
                v22 = MEMORY[0x277CBEB38];
                v23 = [*(v10 + 2992) numberWithBool:{objc_msgSend(v21, "currentReachability")}];
                v24 = [v21 accessoryUUID];
                v25 = [v22 dictionaryWithObject:v23 forKey:v24];

                v26 = v18;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v27 = v26;
                }

                else
                {
                  v27 = 0;
                }

                v28 = v27;

                v29 = [v28 identifier];

                if (v29)
                {
                  v30 = [*(v10 + 2992) numberWithUnsignedInteger:{objc_msgSend(v28, "suspendedState")}];
                  v31 = [v28 identifier];
                  [v25 setObject:v30 forKey:v31];
                }

                [v63 addObject:v25];

                v5 = v62;
              }
            }

            v15 = [v61 countByEnumeratingWithState:&v64 objects:v80 count:16];
          }

          while (v15);
        }

        if ([v63 count])
        {
          v32 = v10;
          v33 = objc_autoreleasePoolPush();
          v34 = v5;
          v35 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
          {
            v36 = HMFGetLogIdentifier();
            v37 = [v63 count];
            v38 = [v59 device];
            v39 = [v38 remoteDestinationString];
            *buf = v53;
            v75 = v36;
            v76 = 2048;
            v77 = v37;
            v78 = 2112;
            v79 = v39;
            _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Sending current reachability for %tu accessories to destination:%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v33);
          v72[0] = v56;
          v40 = [v63 copy];
          v72[1] = v55;
          v73[0] = v40;
          v41 = [(HMDHome *)v34 uuid];
          v42 = [v41 UUIDString];
          v73[1] = v42;
          v43 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v73 forKeys:v72 count:2];

          v44 = [MEMORY[0x277D0F818] messageWithName:@"kRemoteReachabilityChangedNotificationKey" identifier:0 messagePayload:v43];
          v45 = [(HMDHome *)v34 homeManager];
          v46 = [v45 messageDispatcher];
          v47 = [(HMDHome *)v34 uuid];
          v48 = [v59 device];
          v49 = [v48 remoteDestinationString];
          v50 = [(HMDHome *)v34 workQueue];
          [v46 sendSecureMessage:v44 target:v47 userID:0 destination:v49 responseQueue:v50 responseHandler:0];

          v5 = v62;
          v10 = v32;
        }

        v11 = v60 + 1;
      }

      while (v60 + 1 != v58);
      v58 = [obj countByEnumeratingWithState:&v68 objects:v81 count:16];
    }

    while (v58);
  }

  v51 = [(HMDHome *)v5 remoteReachabilityNotificationPendingAccessories];
  [v51 removeAllObjects];

  [(HMDHome *)v5 setReachabilityNotificationTimer:0];
  v52 = *MEMORY[0x277D85DE8];
}

- (void)_updateReachabilityChangeToRegisteredDevices:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [v4 uuid];
  v7 = [v6 UUIDString];

  v8 = [(HMDHome *)self _getReachabilityTupleForAccessoryUUID:v7];
  v9 = [v4 isReachable];
  v10 = v4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v10;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;

  if (v12)
  {
    [v8 setPreviouslySentSuspendedState:{objc_msgSend(v8, "currentSuspendedState")}];
    [v8 setCurrentSuspendedState:{objc_msgSend(v12, "suspendedState")}];
  }

  if (!v8)
  {
    v20 = [HMDAccessoryReachabilityTuple tupleWithAccessoryUUID:v7 reachable:v9];
    [v20 setCurrentSuspendedState:{objc_msgSend(v12, "suspendedState")}];
    v21 = [(HMDHome *)self remoteReachabilityNotificationPendingAccessories];
    [v21 addObject:v20];

    v22 = [(HMDHome *)self reachabilityNotificationTimer];

    if (!v22)
    {
      v23 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:1 options:*&remoteReachabilityNotificationsDeferPeriod];
      [(HMDHome *)self setReachabilityNotificationTimer:v23];

      v24 = [(HMDHome *)self workQueue];
      v25 = [(HMDHome *)self reachabilityNotificationTimer];
      [v25 setDelegateQueue:v24];

      v26 = [(HMDHome *)self reachabilityNotificationTimer];
      [v26 setDelegate:self];

      v27 = [(HMDHome *)self reachabilityNotificationTimer];
      [v27 resume];

      v28 = objc_autoreleasePoolPush();
      v29 = self;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
      {
        v31 = HMFGetLogIdentifier();
        v32 = [(HMDHome *)v29 reachabilityNotificationTimer];
        v34 = 138543874;
        v35 = v31;
        v36 = 2048;
        v37 = v32;
        v38 = 2048;
        v39 = remoteReachabilityNotificationsDeferPeriod;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Started reachability notification defer timer %p for %f sec", &v34, 0x20u);
      }

      objc_autoreleasePoolPop(v28);
    }

    goto LABEL_16;
  }

  [v8 setCurrentReachability:v9];
  v13 = [v8 previouslySentReachability];
  if (v13 == [v8 currentReachability])
  {
    v14 = [v8 previouslySentSuspendedState];
    if (v14 == [v8 currentSuspendedState])
    {
      v15 = objc_autoreleasePoolPush();
      v16 = self;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v19 = HMFBooleanToString();
        v34 = 138543874;
        v35 = v18;
        v36 = 2112;
        v37 = v10;
        v38 = 2112;
        v39 = v19;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ toggled reachability back to %@ ignoring", &v34, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
      v20 = [(HMDHome *)v16 remoteReachabilityNotificationPendingAccessories];
      [v20 removeObject:v8];
LABEL_16:
    }
  }

  v33 = *MEMORY[0x277D85DE8];
}

- (id)_getReachabilityTupleForAccessoryUUID:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v17 = 0u;
  v18 = 0u;
  v15 = 0u;
  v16 = 0u;
  v6 = [(HMDHome *)self remoteReachabilityNotificationPendingAccessories];
  v7 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v7)
  {
    v8 = *v16;
    while (2)
    {
      for (i = 0; i != v7; i = i + 1)
      {
        if (*v16 != v8)
        {
          objc_enumerationMutation(v6);
        }

        v10 = *(*(&v15 + 1) + 8 * i);
        v11 = [v10 accessoryUUID];
        v12 = [v11 isEqual:v4];

        if (v12)
        {
          v7 = v10;
          goto LABEL_11;
        }
      }

      v7 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v7;
}

- (void)_deregisterDeviceForReachabilityNotification:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v27 = v9;
    v28 = 2112;
    v29 = v4;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@De-registering device %@ for reachability notification", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v23 = 0u;
  v24 = 0u;
  v21 = 0u;
  v22 = 0u;
  v10 = [(HMDHome *)v7 reachabilityRegisteredDevices];
  v11 = [v10 copy];

  v12 = [v11 countByEnumeratingWithState:&v21 objects:v25 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v22;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v22 != v14)
        {
          objc_enumerationMutation(v11);
        }

        v16 = *(*(&v21 + 1) + 8 * i);
        v17 = [v16 device];
        v18 = [v17 isEqual:v4];

        if (v18)
        {
          v19 = [(HMDHome *)v7 reachabilityRegisteredDevices];
          [v19 removeObject:v16];
        }
      }

      v13 = [v11 countByEnumeratingWithState:&v21 objects:v25 count:16];
    }

    while (v13);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_registerDeviceForReachabilityNotification:(id)a3 accessoryList:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v8);

  [(HMDHome *)self _deregisterDeviceForReachabilityNotification:v6];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v12;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Registering device %@ for reachability notification", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v13 = [[HMDDeviceRegistrationEntry alloc] initWithDevice:v6 accessoryList:v7];
  if (v13)
  {
    v14 = [(HMDHome *)v10 reachabilityRegisteredDevices];
    [v14 addObject:v13];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)resetAccessoryHashedRouteIdentifiers
{
  v13 = *MEMORY[0x277D85DE8];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v9;
    do
    {
      v6 = 0;
      do
      {
        if (*v9 != v5)
        {
          objc_enumerationMutation(v2);
        }

        [*(*(&v8 + 1) + 8 * v6++) resetHashedRoute];
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v4);
  }

  v7 = *MEMORY[0x277D85DE8];
}

- (void)btleAccessoryReachabilityProbeTimer:(BOOL)a3
{
  v5 = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __47__HMDHome_btleAccessoryReachabilityProbeTimer___block_invoke;
  v6[3] = &unk_278688650;
  v6[4] = self;
  v7 = a3;
  dispatch_async(v5, v6);
}

void __47__HMDHome_btleAccessoryReachabilityProbeTimer___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) accessoryBrowser];
  [v2 btleAccessoryReachabilityProbeTimer:*(a1 + 40)];
}

- (BOOL)evaluatePredicate:(id)a3
{
  v27[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self predicateUtility];
  v6 = [v5 rewritePredicate:v4 currentCharacteristicInPredicate:0 characteristicsToRead:0 homePresence:0];

  v26 = @"THIS_OBJECT";
  v7 = [(HMDHome *)self predicateUtility];
  v27[0] = v7;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];

  [v6 allowEvaluation];
  v9 = [(HMDHome *)self predicateUtility];
  v10 = [v6 evaluateWithObject:v9 substitutionVariables:v8];

  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = HMFBooleanToString();
    v18 = 138544130;
    v19 = v14;
    v20 = 2112;
    v21 = v4;
    v22 = 2112;
    v23 = v6;
    v24 = 2112;
    v25 = v15;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Evaluating predicate %@ (rewritten %@) with result %@", &v18, 0x2Au);
  }

  objc_autoreleasePoolPop(v11);
  v16 = *MEMORY[0x277D85DE8];
  return v10;
}

- (void)handleEvaluatePredicateMessage:(id)a3
{
  v38[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 predicateForKey:*MEMORY[0x277CD24A8]];
  v6 = [v4 stringForKey:*MEMORY[0x277CD2660]];
  v7 = v6;
  if (v5)
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (v8)
  {
    v9 = [v4 responseHandler];

    if (v9)
    {
      v10 = [v4 responseHandler];
      v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      (v10)[2](v10, v11, 0);
    }
  }

  else
  {
    v31 = v5;
    v12 = [(HMDHome *)self evaluatePredicate:v5];
    v13 = [v4 responseHandler];

    if (v13)
    {
      v14 = [v4 responseHandler];
      v37 = *MEMORY[0x277CD24B8];
      v15 = [MEMORY[0x277CCABB0] numberWithBool:v12];
      v38[0] = v15;
      v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:&v37 count:1];
      (v14)[2](v14, 0, v16);
    }

    v17 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v7];
    v32 = 0u;
    v33 = 0u;
    v34 = 0u;
    v35 = 0u;
    v18 = [(HMDHome *)self accessories];
    v19 = [v18 countByEnumeratingWithState:&v32 objects:v36 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v33;
      while (2)
      {
        for (i = 0; i != v20; ++i)
        {
          if (*v33 != v21)
          {
            objc_enumerationMutation(v18);
          }

          v23 = *(*(&v32 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          v26 = [v25 serviceWithUUID:v17];
          if (v26)
          {
            v27 = v26;
            v28 = [v4 remoteSourceDevice];
            v29 = [v28 remoteDestinationString];
            [v27 updatePresenceRequestTimeForDeviceWithDestination:v29];

            goto LABEL_23;
          }
        }

        v20 = [v18 countByEnumeratingWithState:&v32 objects:v36 count:16];
        if (v20)
        {
          continue;
        }

        break;
      }
    }

LABEL_23:

    v5 = v31;
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)dispatchRequestToEvaluateCondition:(id)a3 forCharacteristics:(id)a4 completion:(id)a5
{
  v63 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if (v10 && [v9 count])
  {
    v11 = [(HMDHome *)self primaryResident];
    v12 = [v11 isCurrentDevice];

    if (v12)
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543362;
        v60 = v16;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Current device is the resident device itself, evaluating locally.", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
      if ([(HMDHome *)v14 evaluatePredicate:v8])
      {
        v10[2](v10, 0, v9);
      }
    }

    else
    {
      v17 = [(HMDHome *)self primaryResident];
      v49 = [v17 device];

      v18 = [(HMDHome *)self primaryResident];
      v19 = [v18 supportsSharedEventTriggerActivation];

      if (v19)
      {
        v20 = MEMORY[0x277CCACA8];
        v21 = [(HMDHome *)self logIdentifier];
        v48 = [v20 stringWithFormat:@"Bulletin-%@", v21];

        v45 = [[HMDPredicateUtilities alloc] initWithHome:self logIdentifier:v48];
        v47 = [(HMDPredicateUtilities *)v45 rewritePredicateForDaemon:v8 message:0];
        v57[0] = *MEMORY[0x277CD24A8];
        v22 = encodeRootObject();
        v58[0] = v22;
        v57[1] = *MEMORY[0x277CD2660];
        v23 = [v9 firstObject];
        v24 = [v23 service];
        v25 = [v24 uuid];
        v26 = [v25 UUIDString];
        v58[1] = v26;
        v46 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v58 forKeys:v57 count:2];

        v27 = [HMDRemoteDeviceMessageDestination alloc];
        v28 = [(HMDHome *)self uuid];
        v29 = [(HMDRemoteDeviceMessageDestination *)v27 initWithTarget:v28 device:v49];

        v30 = [HMDRemoteMessage secureMessageWithName:*MEMORY[0x277CD24B0] destination:v29 messagePayload:v46];
        v31 = [v30 identifier];
        objc_initWeak(&location, self);
        v50[0] = MEMORY[0x277D85DD0];
        v50[1] = 3221225472;
        v50[2] = __76__HMDHome_dispatchRequestToEvaluateCondition_forCharacteristics_completion___block_invoke;
        v50[3] = &unk_278670ED0;
        objc_copyWeak(&v55, &location);
        v32 = v31;
        v51 = v32;
        v52 = v8;
        v53 = v9;
        v54 = v10;
        [v30 setResponseHandler:v50];
        v33 = objc_autoreleasePoolPush();
        v34 = self;
        v35 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
        {
          v36 = HMFGetLogIdentifier();
          *buf = 138543618;
          v60 = v36;
          v61 = 2114;
          v62 = v32;
          _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Sending message with identifier %{public}@ to evaluate bulletin condition to resident", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v33);
        v37 = [(HMDHome *)v34 homeManager];
        v38 = [v37 messageDispatcher];

        [v38 sendMessage:v30 completionHandler:0];
        objc_destroyWeak(&v55);
        objc_destroyWeak(&location);
      }

      else
      {
        v39 = objc_autoreleasePoolPush();
        v40 = self;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          v43 = [(HMDHome *)v40 primaryResident];
          *buf = 138543618;
          v60 = v42;
          v61 = 2112;
          v62 = v43;
          _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_INFO, "%{public}@Remote access device %@ is not capable of presence status. Directly send the notification.", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v39);
        v10[2](v10, 0, v9);
      }
    }
  }

  v44 = *MEMORY[0x277D85DE8];
}

void __76__HMDHome_dispatchRequestToEvaluateCondition_forCharacteristics_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    v13 = *(a1 + 40);
    v14 = *(a1 + 48);
    *buf = 138544386;
    v26 = v11;
    v27 = 2112;
    v28 = v12;
    v29 = 2112;
    v30 = v13;
    v31 = 2112;
    v32 = v14;
    v33 = 2112;
    v34 = v5;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Message with identifier %@ to evaluate condition %@ for characteristics %@ has been sent with error %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v8);
  if (v5)
  {
    goto LABEL_7;
  }

  v15 = [v6 hmf_BOOLForKey:*MEMORY[0x277CD24B8]];
  v16 = objc_autoreleasePoolPush();
  v17 = v9;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    v20 = *(a1 + 40);
    HMFBooleanToString();
    v21 = v24 = v15;
    *buf = 138543874;
    v26 = v19;
    v27 = 2112;
    v28 = v20;
    v29 = 2112;
    v30 = v21;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Resident evaluate predicate %@ to %@.", buf, 0x20u);

    v15 = v24;
  }

  objc_autoreleasePoolPop(v16);
  if (v15)
  {
LABEL_7:
    v22 = *(a1 + 48);
    (*(*(a1 + 56) + 16))();
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)evaluateNotificationConditionForCharacteristics:(id)a3 homePresence:(id)a4 completion:(id)a5
{
  v91 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if (v10)
  {
    if ([(HMDHome *)self bulletinNotificationsSupported])
    {
      v63 = v10;
      v65 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v8, "count")}];
      v67 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v8, "count")}];
      v77 = 0u;
      v78 = 0u;
      v79 = 0u;
      v80 = 0u;
      v64 = v8;
      obj = v8;
      v11 = [obj countByEnumeratingWithState:&v77 objects:v90 count:16];
      v66 = v9;
      v72 = self;
      if (v11)
      {
        v12 = v11;
        v13 = *v78;
        v69 = *v78;
        do
        {
          v14 = 0;
          v70 = v12;
          do
          {
            if (*v78 != v13)
            {
              objc_enumerationMutation(obj);
            }

            v15 = *(*(&v77 + 1) + 8 * v14);
            v16 = [v15 service];
            v17 = [v16 bulletinBoardNotification];
            v18 = [v17 isEnabled];

            if (v18)
            {
              v19 = objc_autoreleasePoolPush();
              v20 = self;
              v21 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
              {
                v22 = HMFGetLogIdentifier();
                v23 = [v15 shortDescription];
                *buf = 138543618;
                v83 = v22;
                v84 = 2112;
                v85 = v23;
                _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Notification is enabled for characteristic: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v19);
              v24 = [v16 bulletinBoardNotification];
              v25 = [v24 condition];

              if (v25)
              {
                v26 = [(HMDHome *)v20 predicateUtility];
                v27 = [v26 containsPresenceEvents:v25];
                if (v9 || (v27 & 1) == 0)
                {
                  v33 = [v26 rewritePredicate:v25 currentCharacteristicInPredicate:0 characteristicsToRead:0 homePresence:v9];
                  v88 = @"THIS_OBJECT";
                  v89 = v26;
                  v39 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v89 forKeys:&v88 count:1];
                  [v33 allowEvaluation];
                  v40 = [v33 evaluateWithObject:v26 substitutionVariables:v39];
                  context = objc_autoreleasePoolPush();
                  v41 = v20;
                  v42 = HMFGetOSLogHandle();
                  v43 = os_log_type_enabled(v42, OS_LOG_TYPE_INFO);
                  if (v40)
                  {
                    if (v43)
                    {
                      v44 = HMFGetLogIdentifier();
                      *buf = 138543874;
                      v83 = v44;
                      v84 = 2112;
                      v85 = v25;
                      v86 = 2112;
                      v87 = v15;
                      _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_INFO, "%{public}@Condition %@ for characteristic (%@) evaluates to true, posting bulletin for it.", buf, 0x20u);
                    }

                    objc_autoreleasePoolPop(context);
                    [v67 addObject:v15];
                  }

                  else
                  {
                    if (v43)
                    {
                      v45 = HMFGetLogIdentifier();
                      *buf = 138543874;
                      v83 = v45;
                      v84 = 2112;
                      v85 = v25;
                      v86 = 2112;
                      v87 = v15;
                      _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_INFO, "%{public}@Condition %@ for characteristic (%@) evaluates to false, not posting bulletin for it.", buf, 0x20u);
                    }

                    objc_autoreleasePoolPop(context);
                  }

                  v9 = v66;
                }

                else
                {
                  v28 = objc_autoreleasePoolPush();
                  v29 = v20;
                  v30 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
                  {
                    v31 = HMFGetLogIdentifier();
                    *buf = 138543874;
                    v83 = v31;
                    v84 = 2112;
                    v85 = v25;
                    v86 = 2112;
                    v87 = v15;
                    _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Condition %@ contains presence and no homePresence presents, delaying bulletin for characteristic %@", buf, 0x20u);

                    v9 = v66;
                  }

                  objc_autoreleasePoolPop(v28);
                  v32 = [v16 uuid];
                  v33 = [v65 objectForKeyedSubscript:v32];

                  if (!v33)
                  {
                    v33 = [MEMORY[0x277CBEB18] array];
                    v34 = [v16 uuid];
                    [v65 setObject:v33 forKeyedSubscript:v34];
                  }

                  [v33 addObject:v15];
                }

                v13 = v69;

                self = v72;
              }

              else
              {
                v35 = objc_autoreleasePoolPush();
                v36 = v20;
                v37 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
                {
                  v38 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v83 = v38;
                  v84 = 2112;
                  v85 = v15;
                  _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_INFO, "%{public}@No condition is present in chr (%@)", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v35);
                [v67 addObject:v15];
                v13 = v69;
              }

              v12 = v70;
            }

            ++v14;
          }

          while (v12 != v14);
          v12 = [obj countByEnumeratingWithState:&v77 objects:v90 count:16];
        }

        while (v12);
      }

      v46 = v67;
      v10 = v63;
      if ([v67 count])
      {
        (*(v63 + 2))(v63, 0, v67);
      }

      v47 = v65;
      if ([v65 count])
      {
        v75 = 0u;
        v76 = 0u;
        v73 = 0u;
        v74 = 0u;
        v48 = [v65 allValues];
        v49 = [v48 countByEnumeratingWithState:&v73 objects:v81 count:16];
        if (v49)
        {
          v50 = v49;
          v51 = *v74;
          do
          {
            for (i = 0; i != v50; ++i)
            {
              if (*v74 != v51)
              {
                objc_enumerationMutation(v48);
              }

              v53 = *(*(&v73 + 1) + 8 * i);
              v54 = [v53 firstObject];
              v55 = [v54 service];
              v56 = [v55 bulletinBoardNotification];
              v57 = [v56 condition];
              [(HMDHome *)v72 dispatchRequestToEvaluateCondition:v57 forCharacteristics:v53 completion:v63];
            }

            v50 = [v48 countByEnumeratingWithState:&v73 objects:v81 count:16];
          }

          while (v50);
        }

        v47 = v65;
        v9 = v66;
        v46 = v67;
      }

      v8 = v64;
    }

    else
    {
      v58 = objc_autoreleasePoolPush();
      v59 = self;
      v60 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v60, OS_LOG_TYPE_DEBUG))
      {
        v61 = HMFGetLogIdentifier();
        *buf = 138543618;
        v83 = v61;
        v84 = 2112;
        v85 = v8;
        _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_DEBUG, "%{public}@Bulletin notifications are not supported, skipping evaluating bulletin for characteristics: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v58);
      (*(v10 + 2))(v10, 0, MEMORY[0x277CBEBF8]);
    }
  }

  v62 = *MEMORY[0x277D85DE8];
}

- (void)reevaluateAccessoryInfo
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v11 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Re-evaluating accessory info", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v7 = [(HMDHome *)v4 workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __34__HMDHome_reevaluateAccessoryInfo__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = v4;
  dispatch_async(v7, block);

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_reevaluateAccessoryInfoWithBadgeRefresh:(BOOL)a3
{
  v3 = a3;
  v22 = *MEMORY[0x277D85DE8];
  v5 = [(HMDHome *)self isOwnerUser];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = HMFBooleanToString();
    v11 = HMFBooleanToString();
    v16 = 138543874;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Re-evaluating accessory info with shouldRefreshBadge: %@, isOwnerUser: %@, ", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v6);
  if (v5)
  {
    v12 = +[HMDBulletinBoard sharedBulletinBoard];
    v13 = [v12 updateBulletinForFirmwareUpdateInHome:v7];
  }

  if (v3)
  {
    v14 = +[HMDBulletinBoard sharedBulletinBoard];
    [v14 refreshHomeBadgeNumber];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)sendFirmwareUpdateUINotification:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self isOwnerUser];
  v6 = [(HMDHome *)self isSharedAdmin];
  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = HMFBooleanToString();
    v12 = HMFBooleanToString();
    v15 = 138543874;
    v16 = v10;
    v17 = 2112;
    v18 = v11;
    v19 = 2112;
    v20 = v12;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Firmware update UI notification is issued, isOwnerUser: %@, isSharedAdminUser:%@ ", &v15, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  if (v5 || v6)
  {
    v13 = +[HMDBulletinBoard sharedBulletinBoard];
    [v13 insertBulletinsForMatterFirmwareUpdateInstalledInHome:v8 hmdHAPAccessory:v4];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)a3 shouldRefreshBadge:(BOOL)a4 withCompletion:(id)a5
{
  v6 = a4;
  v84 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  if ([v8 count])
  {
    v64 = self;
    v65 = v6;
    v66 = v9;
    v70 = [MEMORY[0x277CBEB38] dictionary];
    v69 = [MEMORY[0x277CBEB38] dictionary];
    v73 = 0u;
    v74 = 0u;
    v75 = 0u;
    v76 = 0u;
    v67 = v8;
    obj = v8;
    v10 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
    v62 = v10;
    v11 = 0;
    if (!v10)
    {
      goto LABEL_36;
    }

    v71 = *v74;
    v72 = v10;
    while (1)
    {
      for (i = 0; i != v72; ++i)
      {
        if (*v74 != v71)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v73 + 1) + 8 * i);
        v14 = [v13 vendorInfo];
        v15 = [v13 firmwareVersion];
        if (v15)
        {
          v16 = [v14 firmwareVersion];
          v17 = [v13 firmwareVersion];
          v18 = [v16 isGreaterThanVersion:v17];
        }

        else
        {
          v18 = 0;
        }

        v19 = [MEMORY[0x277CBEB38] dictionary];
        v20 = [MEMORY[0x277CBEB38] dictionary];
        v21 = [v14 appBundleID];

        if (v21)
        {
          v22 = [v14 appBundleID];
          [v20 setObject:v22 forKeyedSubscript:@"kAccessoryVendorInfoBundleIDKey"];

          v11 = 1;
        }

        v23 = [v14 appStoreID];

        if (v23)
        {
          v24 = [v14 appStoreID];
          [v20 setObject:v24 forKeyedSubscript:@"kAccessoryVendorInfoStoreIDKey"];

          v11 = 1;
        }

        v25 = [MEMORY[0x277CCABB0] numberWithBool:v18];
        [v20 setObject:v25 forKeyedSubscript:@"kAccessoryVendorInfoFirmwareUpdateAvailableKey"];

        v26 = [v13 serialNumber];

        if (v26)
        {
          v27 = [v13 serialNumber];
          [v20 setObject:v27 forKeyedSubscript:@"kAccessoryInfoSerialNumberKey"];

          v11 = 1;
        }

        v28 = [v13 manufacturer];

        if (v28)
        {
          v29 = [v13 manufacturer];
          [v19 setObject:v29 forKeyedSubscript:@"kAccessoryInfoManufacturerKey"];

          v30 = [v13 manufacturer];
          [v20 setObject:v30 forKeyedSubscript:@"kAccessoryInfoManufacturerKey"];
        }

        v31 = [v13 model];

        if (v31)
        {
          v32 = [v13 model];
          [v19 setObject:v32 forKeyedSubscript:@"kAccessoryInfoModelKey"];

          v33 = [v13 model];
          [v20 setObject:v33 forKeyedSubscript:@"kAccessoryInfoModelKey"];
        }

        v34 = v13;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v35 = v34;
        }

        else
        {
          v35 = 0;
        }

        v36 = v35;

        if (v36 && [v36 supportsCHIP])
        {
          v37 = [v34 displayableFirmwareVersion];

          if (!v37)
          {
            goto LABEL_30;
          }

          v38 = [v34 displayableFirmwareVersion];
          [v19 setObject:v38 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];

          v39 = [v34 displayableFirmwareVersion];
          [v20 setObject:v39 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];
        }

        else
        {
          v40 = [v34 firmwareVersion];

          if (!v40)
          {
            goto LABEL_30;
          }

          v41 = [v34 firmwareVersion];
          v42 = [v41 shortVersionString];
          [v19 setObject:v42 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];

          v39 = [v34 firmwareVersion];
          v43 = [v39 shortVersionString];
          [v20 setObject:v43 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];
        }

LABEL_30:
        if ([v20 count])
        {
          v44 = [v34 uuid];
          v45 = [v44 UUIDString];
          [v69 setObject:v20 forKeyedSubscript:v45];
        }

        if ([v19 count])
        {
          v46 = [v34 uuid];
          v47 = [v46 UUIDString];
          [v70 setObject:v19 forKeyedSubscript:v47];
        }
      }

      v72 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
      if (!v72)
      {
LABEL_36:

        v48 = objc_autoreleasePoolPush();
        v49 = v64;
        v50 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
        {
          v51 = HMFGetLogIdentifier();
          *buf = 138543874;
          v78 = v51;
          v79 = 2112;
          v80 = v70;
          v81 = 2112;
          v82 = v69;
          _os_log_impl(&dword_229538000, v50, OS_LOG_TYPE_INFO, "%{public}@Notify clients that vendor info has updated: %@  entitledInfo %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v48);
        v52 = v70;
        v53 = [v70 count];
        v54 = MEMORY[0x277CD1F98];
        if (v53)
        {
          v55 = [MEMORY[0x277D0F818] messageWithName:*MEMORY[0x277CD1F98] messagePayload:v70];
          v56 = [(HMDHome *)v49 msgDispatcher];
          v57 = [(HMDHome *)v49 messageTargetUUID];
          [v56 sendMessage:v55 target:v57];

          v52 = v70;
        }

        if (v11)
        {
          v58 = [MEMORY[0x277D0F818] entitledMessageWithName:*v54 messagePayload:v69];
          v59 = [(HMDHome *)v49 msgDispatcher];
          v60 = [(HMDHome *)v49 messageTargetUUID];
          [v59 sendMessage:v58 target:v60];
        }

        [(HMDHome *)v49 _reevaluateAccessoryInfoWithBadgeRefresh:v65, v62];
        v9 = v66;
        if (v66)
        {
          (v66)[2](v66, v63 != 0);
        }

        v8 = v67;
        goto LABEL_47;
      }
    }
  }

  if (v9)
  {
    v9[2](v9, 0);
  }

LABEL_47:

  v61 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __61__HMDHome_notifyClientsOfAccessoryInfoUpdatedForAccessories___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)_removeCloudData
{
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __27__HMDHome__removeCloudData__block_invoke;
  v6[3] = &unk_27868A250;
  v6[4] = self;
  [(HMDHome *)self _clearEventsWithCompletion:v6];
  v4 = [(HMDHome *)self userActionPredictionManager];
  [v4 removeZones];

  v5 = [(HMDHome *)self personDataManager];
  [v5 removeCloudDataDueToHomeRemoval];
}

void __27__HMDHome__removeCloudData__block_invoke(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_ERROR);
  if (v3)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543618;
      v14 = v8;
      v15 = 2112;
      v16 = v3;
      v9 = "%{public}@Failed to clear events %@";
      v10 = v6;
      v11 = 22;
LABEL_6:
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, v9, &v13, v11);
    }
  }

  else if (v7)
  {
    v8 = HMFGetLogIdentifier();
    v13 = 138543362;
    v14 = v8;
    v9 = "%{public}@Successfully cleared events";
    v10 = v6;
    v11 = 12;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v4);
  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleHomeWasRemoved
{
  v2 = [(HMDHome *)self walletKeyManager];
  [v2 handleHomeWasRemoved];
}

- (void)_removeAllHomeContentsAndAccessoryPairings:(BOOL)a3 queue:(id)a4 completionHandler:(id)a5
{
  v44 = a3;
  v75 = *MEMORY[0x277D85DE8];
  v42 = a4;
  v43 = a5;
  v7 = objc_autoreleasePoolPush();
  val = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v68 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Removing all home contents and accessory pairings", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v7);
  v10 = [(HMDHome *)val walletKeyManager];
  [v10 handleHomeWillBeRemoved];

  v65 = 0u;
  v66 = 0u;
  v63 = 0u;
  v64 = 0u;
  v11 = [(HMDHome *)val triggers];
  v12 = [v11 countByEnumeratingWithState:&v63 objects:v74 count:16];
  if (v12)
  {
    v13 = *v64;
    do
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v64 != v13)
        {
          objc_enumerationMutation(v11);
        }

        [*(*(&v63 + 1) + 8 * i) invalidate];
      }

      v12 = [v11 countByEnumeratingWithState:&v63 objects:v74 count:16];
    }

    while (v12);
  }

  v61 = 0u;
  v62 = 0u;
  v59 = 0u;
  v60 = 0u;
  v15 = [(HMDHome *)val actionSets];
  v16 = [v15 countByEnumeratingWithState:&v59 objects:v73 count:16];
  if (v16)
  {
    v17 = *v60;
    do
    {
      for (j = 0; j != v16; ++j)
      {
        if (*v60 != v17)
        {
          objc_enumerationMutation(v15);
        }

        [*(*(&v59 + 1) + 8 * j) invalidate];
      }

      v16 = [v15 countByEnumeratingWithState:&v59 objects:v73 count:16];
    }

    while (v16);
  }

  v57 = 0u;
  v58 = 0u;
  v55 = 0u;
  v56 = 0u;
  v19 = [(HMDHome *)val users];
  v20 = [v19 copy];

  v21 = [v20 countByEnumeratingWithState:&v55 objects:v72 count:16];
  if (v21)
  {
    v22 = *v56;
    do
    {
      for (k = 0; k != v21; ++k)
      {
        if (*v56 != v22)
        {
          objc_enumerationMutation(v20);
        }

        v24 = *(*(&v55 + 1) + 8 * k);
        [v24 removeCloudData];
        [v24 unconfigure];
      }

      v21 = [v20 countByEnumeratingWithState:&v55 objects:v72 count:16];
    }

    while (v21);
  }

  v25 = [(HMDHome *)val residentSyncManager];
  [v25 stop];

  [(HMDHome *)val setResidentSyncManager:0];
  objc_initWeak(&location, val);
  group = dispatch_group_create();
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v26 = [(HMDHome *)val accessories];
  v27 = [v26 countByEnumeratingWithState:&v50 objects:v71 count:16];
  if (v27)
  {
    v28 = *v51;
    do
    {
      for (m = 0; m != v27; ++m)
      {
        if (*v51 != v28)
        {
          objc_enumerationMutation(v26);
        }

        v30 = *(*(&v50 + 1) + 8 * m);
        if ([v30 isPrimary])
        {
          v31 = objc_autoreleasePoolPush();
          v32 = val;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v68 = v34;
            v69 = 2112;
            v70 = v30;
            _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Removing primary accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          dispatch_group_enter(group);
          aBlock[0] = MEMORY[0x277D85DD0];
          aBlock[1] = 3221225472;
          aBlock[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke;
          aBlock[3] = &unk_278685F38;
          objc_copyWeak(&v49, &location);
          aBlock[4] = v30;
          v48 = group;
          v35 = _Block_copy(aBlock);
          v36 = v35;
          if (v44)
          {
            [(HMDHome *)v32 removeAllUsersAndCloudDataFromAccessory:v30 completionHandler:v35];
          }

          else
          {
            (*(v35 + 2))(v35);
          }

          objc_destroyWeak(&v49);
        }
      }

      v27 = [v26 countByEnumeratingWithState:&v50 objects:v71 count:16];
    }

    while (v27);
  }

  [(HMDHome *)val _removeCloudData];
  dispatch_group_notify(group, v42, v43);
  v37 = objc_autoreleasePoolPush();
  v38 = val;
  v39 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
  {
    v40 = HMFGetLogIdentifier();
    *buf = 138543362;
    v68 = v40;
    _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Removed all accessories", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v37);
  [(HMDHome *)v38 removeSharedHomeFabricData];

  objc_destroyWeak(&location);
  v41 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v3 = *(a1 + 32);
    v5[0] = MEMORY[0x277D85DD0];
    v5[1] = 3221225472;
    v5[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_2;
    v5[3] = &unk_278689578;
    objc_copyWeak(&v7, (a1 + 48));
    v4 = *(a1 + 40);
    v5[4] = *(a1 + 32);
    v6 = v4;
    [WeakRetained _removeAccessory:v3 completionHandler:v5];

    objc_destroyWeak(&v7);
  }

  else
  {
    dispatch_group_leave(*(a1 + 40));
  }
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v30 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    *buf = 138543874;
    v25 = v11;
    v26 = 2112;
    v27 = v12;
    v28 = 2112;
    v29 = v6;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed primary accessory, %@, with error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  if (v9)
  {
    v13 = [v9 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1500;
    block[3] = &unk_278689550;
    v19 = v6;
    v20 = v9;
    v14 = v5;
    v15 = *(a1 + 32);
    v16 = *(a1 + 40);
    v21 = v14;
    v22 = v15;
    v23 = v16;
    dispatch_async(v13, block);
  }

  else
  {
    dispatch_group_leave(*(a1 + 40));
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1500(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  if (*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v6 = *(a1 + 56);
      v7 = *(a1 + 32);
      v9 = 138543874;
      v10 = v5;
      v11 = 2112;
      v12 = v6;
      v13 = 2112;
      v14 = v7;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove accessory %@ with error: %@", &v9, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
  }

  else
  {
    [*(a1 + 40) _removeAccessories:*(a1 + 48) message:0];
  }

  dispatch_group_leave(*(a1 + 64));
  v8 = *MEMORY[0x277D85DE8];
}

- (void)_removeAccessories:(id)a3 message:(id)a4
{
  v60 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v48 = self;
  v8 = [(HMDHome *)self _removeAccessoriesCommon:v6];
  v9 = [v7 name];
  v10 = [v9 isEqualToString:*MEMORY[0x277CD24F0]];

  v45 = v8;
  v46 = v7;
  if (v10)
  {
    v11 = [MEMORY[0x277CBEB38] dictionary];
    [v11 setObject:v8 forKeyedSubscript:*MEMORY[0x277CCE7A8]];
    v12 = [v11 copy];
    [v7 respondWithPayload:v12];
  }

  else
  {
    [v7 respondWithSuccess];
  }

  v51 = 0u;
  v52 = 0u;
  v49 = 0u;
  v50 = 0u;
  obj = v6;
  v13 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v50;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v50 != v15)
        {
          objc_enumerationMutation(obj);
        }

        v17 = *(*(&v49 + 1) + 8 * i);
        v18 = objc_autoreleasePoolPush();
        v19 = v48;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
        {
          v21 = HMFGetLogIdentifier();
          *buf = 138543618;
          v56 = v21;
          v57 = 2112;
          v58 = v17;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Removing accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
        v22 = v17;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v23 = v22;
        }

        else
        {
          v23 = 0;
        }

        v24 = v23;

        if (v24)
        {
          v25 = [v24 isCurrentAccessory];
          if ([v24 isDemoAccessory])
          {
            v26 = 1;
          }

          else
          {
            v26 = v25 == 0;
          }

          if (!v26)
          {
            v27 = objc_autoreleasePoolPush();
            v28 = v19;
            v29 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
            {
              v30 = HMFGetLogIdentifier();
              *buf = 138543618;
              v56 = v30;
              v57 = 2112;
              v58 = v22;
              _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Posting notification about current accessory removal %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v27);
            v31 = [(HMDHome *)v28 notificationCenter];
            v53 = @"HMDLastRemovedCurrentAccessoryUUIDKey";
            v32 = [v24 uuid];
            v54 = v32;
            v33 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v54 forKeys:&v53 count:1];
            [v31 postNotificationName:@"HMDHomeManagerDidRemoveCurrentAccessoryNotification" object:v28 userInfo:v33];
          }

          v34 = [(HMDHome *)v19 homeManager];
          v35 = [(HMDHome *)v19 capabilitiesAggregator];
          v36 = [v24 uuid];
          [v35 didRemoveAccessory:v36];

          v37 = [v24 uuid];
          v38 = [v34 accessorySetupMetricDispatcherForAccessoryUUID:v37];

          [v38 markAccessoryRemoved];
          v39 = [(HMDHome *)v19 fetchedAccessorySettingsSubscriber];
          v40 = [v24 uuid];
          [v39 unsubscribeForAccessory:v40];

          v41 = [v34 legacyAccessoryPairingController];

          if (v41)
          {
            v42 = [v34 legacyAccessoryPairingController];
            [v42 handleMessage:v46 from:v19];
          }
        }

        else
        {
          [0 isDemoAccessory];
        }

        if ([v22 isPrimary])
        {
          v43 = [v22 identifier];
          [(HMDHome *)v19 _deregisterPairedAccessory:v43];
        }

        [v22 setHome:0];
        [v22 unconfigure];
      }

      v14 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
    }

    while (v14);
  }

  v44 = *MEMORY[0x277D85DE8];
}

- (id)_removeAccessoriesCommon:(id)a3
{
  v44 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v30 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v4, "count")}];
  [(HMDHome *)self _removeAccessoriesFromContainers:v4];
  v38 = 0u;
  v39 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = v4;
  v31 = [obj countByEnumeratingWithState:&v36 objects:v43 count:16];
  if (v31)
  {
    v29 = *v37;
    v28 = *MEMORY[0x277CCF0B0];
    do
    {
      for (i = 0; i != v31; ++i)
      {
        if (*v37 != v29)
        {
          objc_enumerationMutation(obj);
        }

        v6 = *(*(&v36 + 1) + 8 * i);
        [(HMDHome *)self removeAccessory:v6];
        v7 = [v6 getConfiguredName];

        if (v7)
        {
          v8 = [v6 getConfiguredName];
          v9 = [(HMDHome *)self removeName:v8];
        }

        v10 = v6;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v12)
        {
          v34 = 0u;
          v35 = 0u;
          v32 = 0u;
          v33 = 0u;
          v13 = [v12 services];
          v14 = [v13 countByEnumeratingWithState:&v32 objects:v42 count:16];
          if (v14)
          {
            v15 = v14;
            v16 = *v33;
            do
            {
              for (j = 0; j != v15; ++j)
              {
                if (*v33 != v16)
                {
                  objc_enumerationMutation(v13);
                }

                v18 = *(*(&v32 + 1) + 8 * j);
                v19 = [v18 getConfiguredName];

                if (v19)
                {
                  v20 = [v18 getConfiguredName];
                  v21 = [(HMDHome *)self removeName:v20];
                }
              }

              v15 = [v13 countByEnumeratingWithState:&v32 objects:v42 count:16];
            }

            while (v15);
          }
        }

        v40 = v28;
        v22 = [v10 uuid];
        v23 = [v22 UUIDString];
        v41 = v23;
        v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v41 forKeys:&v40 count:1];
        [v30 addObject:v24];
      }

      v31 = [obj countByEnumeratingWithState:&v36 objects:v43 count:16];
    }

    while (v31);
  }

  v25 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_removeAccessoriesFromContainers:(id)a3
{
  v75 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 count])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v72 = v8;
      v73 = 2112;
      v74 = v4;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Removing accessories from containers : [%@]", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [(HMDHome *)v6 backingStore];
    v10 = *MEMORY[0x277CD24E8];
    v11 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v12 = [v9 transaction:v10 options:v11];

    v64 = 0u;
    v65 = 0u;
    v62 = 0u;
    v63 = 0u;
    v41 = v4;
    obj = v4;
    v13 = [obj countByEnumeratingWithState:&v62 objects:v70 count:16];
    if (v13)
    {
      v14 = v13;
      v43 = *v63;
      do
      {
        v15 = 0;
        do
        {
          if (*v63 != v43)
          {
            objc_enumerationMutation(obj);
          }

          v16 = *(*(&v62 + 1) + 8 * v15);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v17 = v16;
          }

          else
          {
            v17 = 0;
          }

          v18 = v17;

          if (v18)
          {
            v60 = 0u;
            v61 = 0u;
            v58 = 0u;
            v59 = 0u;
            v19 = [(HMDHome *)v6 serviceGroups];
            v20 = [v19 countByEnumeratingWithState:&v58 objects:v69 count:16];
            if (v20)
            {
              v21 = v20;
              v22 = *v59;
              do
              {
                v23 = 0;
                do
                {
                  if (*v59 != v22)
                  {
                    objc_enumerationMutation(v19);
                  }

                  [*(*(&v58 + 1) + 8 * v23++) removeServicesForAccessory:{v18, v41}];
                }

                while (v21 != v23);
                v21 = [v19 countByEnumeratingWithState:&v58 objects:v69 count:16];
              }

              while (v21);
            }
          }

          v56 = 0u;
          v57 = 0u;
          v54 = 0u;
          v55 = 0u;
          v24 = [(HMDHome *)v6 actionSets];
          v25 = [v24 countByEnumeratingWithState:&v54 objects:v68 count:16];
          if (v25)
          {
            v26 = v25;
            v27 = *v55;
            do
            {
              v28 = 0;
              do
              {
                if (*v55 != v27)
                {
                  objc_enumerationMutation(v24);
                }

                [*(*(&v54 + 1) + 8 * v28++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v26 != v28);
              v26 = [v24 countByEnumeratingWithState:&v54 objects:v68 count:16];
            }

            while (v26);
          }

          v52 = 0u;
          v53 = 0u;
          v50 = 0u;
          v51 = 0u;
          v29 = [(HMDHome *)v6 triggerOwnedActionSets];
          v30 = [v29 countByEnumeratingWithState:&v50 objects:v67 count:16];
          if (v30)
          {
            v31 = v30;
            v32 = *v51;
            do
            {
              v33 = 0;
              do
              {
                if (*v51 != v32)
                {
                  objc_enumerationMutation(v29);
                }

                [*(*(&v50 + 1) + 8 * v33++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v31 != v33);
              v31 = [v29 countByEnumeratingWithState:&v50 objects:v67 count:16];
            }

            while (v31);
          }

          v48 = 0u;
          v49 = 0u;
          v46 = 0u;
          v47 = 0u;
          v34 = [(HMDHome *)v6 triggers];
          v35 = [v34 countByEnumeratingWithState:&v46 objects:v66 count:16];
          if (v35)
          {
            v36 = v35;
            v37 = *v47;
            do
            {
              v38 = 0;
              do
              {
                if (*v47 != v37)
                {
                  objc_enumerationMutation(v34);
                }

                [*(*(&v46 + 1) + 8 * v38++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v36 != v38);
              v36 = [v34 countByEnumeratingWithState:&v46 objects:v66 count:16];
            }

            while (v36);
          }

          v44[0] = MEMORY[0x277D85DD0];
          v44[1] = 3221225472;
          v44[2] = __44__HMDHome__removeAccessoriesFromContainers___block_invoke;
          v44[3] = &unk_27868A1D8;
          v44[4] = v6;
          v45 = v18;
          v39 = v18;
          [v12 run:v44];

          ++v15;
        }

        while (v15 != v14);
        v14 = [obj countByEnumeratingWithState:&v62 objects:v70 count:16];
      }

      while (v14);
    }

    [(HMDHome *)v6 _evaluateShouldRelaunchAndSetRelaunch];
    v4 = v41;
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__removeAccessoriesFromContainers___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 40);
      v16 = 138543874;
      v17 = v8;
      v18 = 2112;
      v19 = v9;
      v20 = 2112;
      v21 = v3;
      v10 = "%{public}@Failed to commit removeAccessoriesFromContainersTransaction [%@]: %@";
      v11 = v7;
      v12 = OS_LOG_TYPE_ERROR;
      v13 = 32;
LABEL_6:
      _os_log_impl(&dword_229538000, v11, v12, v10, &v16, v13);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v14 = *(a1 + 40);
    v16 = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = v14;
    v10 = "%{public}@Successfully finished running removeAccessoriesFromContainersTransaction : %@";
    v11 = v7;
    v12 = OS_LOG_TYPE_INFO;
    v13 = 22;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v4);
  v15 = *MEMORY[0x277D85DE8];
}

- (void)_removeService:(id)a3
{
  v64 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self backingStore];
  v6 = *MEMORY[0x277CD2528];
  v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v8 = [v5 transaction:v6 options:v7];

  v56 = 0u;
  v57 = 0u;
  v54 = 0u;
  v55 = 0u;
  v9 = [(HMDHome *)self serviceGroups];
  v10 = [v9 countByEnumeratingWithState:&v54 objects:v63 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v55;
    do
    {
      v13 = 0;
      do
      {
        if (*v55 != v12)
        {
          objc_enumerationMutation(v9);
        }

        [*(*(&v54 + 1) + 8 * v13++) removeService:v4];
      }

      while (v11 != v13);
      v11 = [v9 countByEnumeratingWithState:&v54 objects:v63 count:16];
    }

    while (v11);
  }

  v52 = 0u;
  v53 = 0u;
  v50 = 0u;
  v51 = 0u;
  v14 = [(HMDHome *)self actionSets];
  v15 = [v14 countByEnumeratingWithState:&v50 objects:v62 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v51;
    do
    {
      v18 = 0;
      do
      {
        if (*v51 != v17)
        {
          objc_enumerationMutation(v14);
        }

        [*(*(&v50 + 1) + 8 * v18++) handleRemovalOfService:v4 transaction:v8];
      }

      while (v16 != v18);
      v16 = [v14 countByEnumeratingWithState:&v50 objects:v62 count:16];
    }

    while (v16);
  }

  v48 = 0u;
  v49 = 0u;
  v46 = 0u;
  v47 = 0u;
  v19 = [(HMDHome *)self triggerOwnedActionSets];
  v20 = [v19 countByEnumeratingWithState:&v46 objects:v61 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v47;
    do
    {
      v23 = 0;
      do
      {
        if (*v47 != v22)
        {
          objc_enumerationMutation(v19);
        }

        [*(*(&v46 + 1) + 8 * v23++) handleRemovalOfService:v4 transaction:v8];
      }

      while (v21 != v23);
      v21 = [v19 countByEnumeratingWithState:&v46 objects:v61 count:16];
    }

    while (v21);
  }

  v24 = [v4 getConfiguredName];

  if (v24)
  {
    v25 = [v4 getConfiguredName];
    v26 = [(HMDHome *)self removeName:v25];
  }

  v45 = 0u;
  v43 = 0u;
  v44 = 0u;
  v42 = 0u;
  v27 = [(HMDHome *)self triggers];
  v28 = [v27 countByEnumeratingWithState:&v42 objects:v60 count:16];
  if (v28)
  {
    v29 = v28;
    v30 = *v43;
    do
    {
      v31 = 0;
      do
      {
        if (*v43 != v30)
        {
          objc_enumerationMutation(v27);
        }

        [*(*(&v42 + 1) + 8 * v31++) handleRemovalOfService:v4 transaction:v8];
      }

      while (v29 != v31);
      v29 = [v27 countByEnumeratingWithState:&v42 objects:v60 count:16];
    }

    while (v29);
  }

  v41[0] = MEMORY[0x277D85DD0];
  v41[1] = 3221225472;
  v41[2] = __26__HMDHome__removeService___block_invoke;
  v41[3] = &unk_27868A250;
  v41[4] = self;
  [v8 run:v41];
  v32 = [(HMDHome *)self notificationCenter];
  v58 = @"HMDServiceNotificationKey";
  v59 = v4;
  v33 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v59 forKeys:&v58 count:1];
  [v32 postNotificationName:@"HMDHomeServiceRemovedNotification" object:self userInfo:v33];

  v34 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __26__HMDHome__removeService___block_invoke_1499;
  block[3] = &unk_27868A750;
  block[4] = self;
  v35 = v4;
  v40 = v35;
  dispatch_async(v34, block);

  v36 = [v35 bulletinBoardNotification];

  if (v36)
  {
    v37 = [(HMDHome *)self accessoryBulletinNotificationManager];
    [v37 handleRemovedService:v35];
  }

  v38 = *MEMORY[0x277D85DE8];
}

void __26__HMDHome__removeService___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit removeServiceTransaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = *MEMORY[0x277D85DE8];
}

void __26__HMDHome__removeService___block_invoke_1499(uint64_t a1)
{
  v3 = [*(a1 + 32) notificationRegistry];
  v2 = [*(a1 + 40) characteristics];
  [v3 removeRegistrationsForCharacteristics:v2];
}

- (void)handleMobileAssetsUpdatedNotification:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_handleMobileAssetsUpdatedNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __49__HMDHome_handleMobileAssetsUpdatedNotification___block_invoke(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) isCurrentDeviceConfirmedPrimaryResident])
  {
    v2 = [*(a1 + 40) userInfo];
    v16 = 0;
    v3 = [v2 hmf_integerForKey:@"currentContentVersion" error:&v16];
    v4 = v16;

    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    v8 = v7;
    if (v3)
    {
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v9 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v9;
        v19 = 1024;
        LODWORD(v20) = v3;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Handling mobile assets updated notification with current version: %d", buf, 0x12u);
      }

      objc_autoreleasePoolPop(v5);
      [(HMDHome *)*(a1 + 32) _maybeCheckACWGLocksForMFiCertificationWithContentVersion:v3];
    }

    else
    {
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v14;
        v19 = 2112;
        v20 = v4;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Invalid notification without content version: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v5);
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 32);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Ignoring mobile assets updated notification because we're not primary resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_auditActionSetsAndTriggersForAccessory:(id)a3
{
  v59 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  if ([(HMDHome *)self isCurrentDevicePrimaryResident]|| ![(HMDHome *)self isResidentSupported])
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v4 shortDescription];
      *buf = 138543618;
      v56 = v14;
      v57 = 2112;
      v58 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Auditing actions/events for ActionSets and Triggers for accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = [(HMDHome *)v12 backingStore];
    v17 = *MEMORY[0x277CD20C8];
    v18 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v19 = [v16 transaction:v17 options:v18];

    v50 = 0u;
    v51 = 0u;
    v48 = 0u;
    v49 = 0u;
    v20 = [(HMDHome *)v12 actionSets];
    v21 = [v20 countByEnumeratingWithState:&v48 objects:v54 count:16];
    if (v21)
    {
      v22 = v21;
      v23 = *v49;
      do
      {
        v24 = 0;
        do
        {
          if (*v49 != v23)
          {
            objc_enumerationMutation(v20);
          }

          [*(*(&v48 + 1) + 8 * v24++) auditActionsForAccessory:v4 transaction:v19];
        }

        while (v22 != v24);
        v22 = [v20 countByEnumeratingWithState:&v48 objects:v54 count:16];
      }

      while (v22);
    }

    v46 = 0u;
    v47 = 0u;
    v44 = 0u;
    v45 = 0u;
    v25 = [(HMDHome *)v12 triggerOwnedActionSets];
    v26 = [v25 countByEnumeratingWithState:&v44 objects:v53 count:16];
    if (v26)
    {
      v27 = v26;
      v28 = *v45;
      do
      {
        v29 = 0;
        do
        {
          if (*v45 != v28)
          {
            objc_enumerationMutation(v25);
          }

          [*(*(&v44 + 1) + 8 * v29++) auditActionsForAccessory:v4 transaction:v19];
        }

        while (v27 != v29);
        v27 = [v25 countByEnumeratingWithState:&v44 objects:v53 count:16];
      }

      while (v27);
    }

    v42 = 0u;
    v43 = 0u;
    v40 = 0u;
    v41 = 0u;
    v30 = [(HMDHome *)v12 triggers];
    v31 = [v30 countByEnumeratingWithState:&v40 objects:v52 count:16];
    if (v31)
    {
      v32 = v31;
      v33 = *v41;
      do
      {
        v34 = 0;
        do
        {
          if (*v41 != v33)
          {
            objc_enumerationMutation(v30);
          }

          v35 = *(*(&v40 + 1) + 8 * v34);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v36 = v35;
          }

          else
          {
            v36 = 0;
          }

          v37 = v36;

          if ([v37 isConfigured])
          {
            [v37 auditForStaleEventsWithAccessory:v4 transaction:v19];
          }

          ++v34;
        }

        while (v32 != v34);
        v32 = [v30 countByEnumeratingWithState:&v40 objects:v52 count:16];
      }

      while (v32);
    }

    v39[0] = MEMORY[0x277D85DD0];
    v39[1] = 3221225472;
    v39[2] = __51__HMDHome__auditActionSetsAndTriggersForAccessory___block_invoke;
    v39[3] = &unk_27868A250;
    v39[4] = v12;
    [v19 run:v39];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v4 shortDescription];
      *buf = 138543618;
      v56 = v9;
      v57 = 2112;
      v58 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Skipping audit of actions/events for ActionSets and Triggers for accessory %@ on non-primary resident", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v38 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__auditActionSetsAndTriggersForAccessory___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit auditActionSetsAndTriggersTransaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)checkForCATIDUpdate:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __31__HMDHome_checkForCATIDUpdate___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v4, block);
}

- (void)handleHomeDataLoaded:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __32__HMDHome_handleHomeDataLoaded___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v4, block);
}

uint64_t __32__HMDHome_handleHomeDataLoaded___block_invoke(uint64_t a1)
{
  [*(a1 + 32) updateCATIDForUsersIfNeeded:0];
  v2 = *(a1 + 32);

  return [v2 prepareOperationalFabricData];
}

- (void)_removeAccessoryWithUUID:(id)a3 message:(id)a4
{
  v29 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  objc_initWeak(&location, self);
  v8 = [(HMDHome *)self accessoryWithUUID:v6];
  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v12;
      v27 = 2112;
      v28 = v8;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Remove accessory name: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v13 = v8;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    *buf = 0;
    v16 = [v15 preferredHAPAccessoryForOperation:8 linkType:buf];
    v17 = [HMDAccessoryPairingEvent removingAccessory:v13 hapAccessory:v16];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __44__HMDHome__removeAccessoryWithUUID_message___block_invoke;
    v20[3] = &unk_27866FDA0;
    objc_copyWeak(&v24, &location);
    v21 = v7;
    v18 = v17;
    v22 = v18;
    v23 = v13;
    [(HMDHome *)v10 _removeAccessory:v23 completionHandler:v20];

    objc_destroyWeak(&v24);
  }

  else
  {
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v7 respondWithError:v15];
  }

  objc_destroyWeak(&location);
  v19 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__removeAccessoryWithUUID_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 7);
  v8 = WeakRetained;
  if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __44__HMDHome__removeAccessoryWithUUID_message___block_invoke_2;
    v12[3] = &unk_278683598;
    v12[4] = v8;
    v13 = a1[5];
    v14 = v6;
    v15 = v5;
    v16 = a1[4];
    v17 = a1[6];
    dispatch_async(v9, v12);
  }

  else
  {
    v10 = a1[4];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
    [v10 respondWithError:v11];
  }
}

void __44__HMDHome__removeAccessoryWithUUID_message___block_invoke_2(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) logEventSubmitter];
  [v2 submitLogEvent:*(a1 + 40) error:*(a1 + 48)];

  if (*(a1 + 48))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      v6 = HMFGetLogIdentifier();
      v7 = [*(a1 + 72) name];
      v8 = *(a1 + 48);
      *buf = 138543874;
      v14 = v6;
      v15 = 2112;
      v16 = v7;
      v17 = 2112;
      v18 = v8;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove accessory %@ with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 64) respondWithError:*(a1 + 48)];
    v9 = *MEMORY[0x277D85DE8];
  }

  else
  {
    [*(a1 + 32) _removeAccessories:*(a1 + 56) message:*(a1 + 64)];
    [*(a1 + 32) updateHomeLocation];
    v10 = *(a1 + 32);
    v12 = [*(a1 + 64) name];
    [v10 saveWithReason:? postSyncNotification:?];
    v11 = *MEMORY[0x277D85DE8];
  }
}

- (void)_removeAccessory:(id)a3 completionHandler:(id)a4
{
  v42 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if ([v6 isPrimary])
  {
    v8 = [(HMDHome *)self removeAccessoryInProgressForHMDAccessories];
    v9 = [v8 containsObject:v6];

    if (v9)
    {
      v10 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543618;
        v39 = v13;
        v40 = 2112;
        v41 = v6;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Already have a remove operation queued for accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      v36[0] = *MEMORY[0x277CCA450];
      v14 = MEMORY[0x277CCACA8];
      v15 = [v6 name];
      v16 = [v6 uuid];
      v17 = [v14 stringWithFormat:@"Failed to remove accessory %@(%@)", v15, v16];
      v36[1] = *MEMORY[0x277CCA470];
      v37[0] = v17;
      v18 = MEMORY[0x277CCACA8];
      v19 = [MEMORY[0x277CCA9B8] hmStringFromErrorCode:15];
      v20 = [v18 stringWithFormat:@"%ld (%@) This accessory is already being removed from the home.", 15, v19];
      v37[1] = v20;
      v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v37 forKeys:v36 count:2];

      v22 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:15 userInfo:v21];
      if (v7)
      {
        v7[2](v7, 0, v22);
      }
    }

    else
    {
      v27 = v6;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v28 = v27;
      }

      else
      {
        v28 = 0;
      }

      v21 = v28;

      v29 = [v27 home];
      if ([v29 isAdminUser])
      {
        v30 = [v21 isPaired];

        if (v30)
        {
          os_unfair_recursive_lock_lock_with_options();
          [(NSHashTable *)self->_removeAccessoryInProgressForHMDAccessories addObject:v21];
          os_unfair_recursive_lock_unlock();
          v31 = objc_autoreleasePoolPush();
          v32 = self;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v39 = v34;
            v40 = 2112;
            v41 = v21;
            _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Removing accessory %@. Also added accessory in removal-in-progress array", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          [(HMDHome *)v32 _removeAccessoriesForPrimaryAccessory:v21 error:0 completionHandler:v7];
          goto LABEL_22;
        }
      }

      else
      {
      }

      [(HMDHome *)self _removeAccessoriesForPrimaryAccessory:v27 error:0 completionHandler:v7];
    }

LABEL_22:

    goto LABEL_23;
  }

  v23 = objc_autoreleasePoolPush();
  v24 = self;
  v25 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
  {
    v26 = HMFGetLogIdentifier();
    *buf = 138543618;
    v39 = v26;
    v40 = 2112;
    v41 = v6;
    _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@cannot remove non-primary accessory %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v23);
  if (v7)
  {
    v21 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:34 userInfo:0];
    v7[2](v7, 0, v21);
    goto LABEL_22;
  }

LABEL_23:

  v35 = *MEMORY[0x277D85DE8];
}

- (void)removeAccessory:(id)a3 completionHandler:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __45__HMDHome_removeAccessory_completionHandler___block_invoke;
  block[3] = &unk_278689F98;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(v8, block);
}

- (void)_removeAccessoriesForPrimaryAccessory:(id)a3 error:(id)a4 completionHandler:(id)a5
{
  v86 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if (!v8)
  {
    v54 = objc_autoreleasePoolPush();
    v55 = self;
    v56 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v56, OS_LOG_TYPE_ERROR))
    {
      v57 = HMFGetLogIdentifier();
      *buf = 138543362;
      v80 = v57;
      _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_ERROR, "%{public}@Nil accessory was passed to remove it from the home.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v54);
    v58 = MEMORY[0x277CCA9B8];
    v59 = *MEMORY[0x277CCFD28];
    v60 = 20;
    goto LABEL_50;
  }

  v70 = self;
  if (([v8 isPrimary] & 1) == 0)
  {
    v61 = objc_autoreleasePoolPush();
    v55 = self;
    v62 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v62, OS_LOG_TYPE_ERROR))
    {
      v63 = HMFGetLogIdentifier();
      *buf = 138543618;
      v80 = v63;
      v81 = 2112;
      v82 = v8;
      _os_log_impl(&dword_229538000, v62, OS_LOG_TYPE_ERROR, "%{public}@Accessory is not primary (Bridged). Not moving further. [%@]", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v61);
    v58 = MEMORY[0x277CCA9B8];
    v59 = *MEMORY[0x277CCFD28];
    v60 = 34;
LABEL_50:
    v11 = [v58 errorWithDomain:v59 code:v60 userInfo:0];
    [(HMDHome *)v55 _sendRemoveCompletionStatusForHMDAccessories:0 withCompletion:v10 error:v11];
    goto LABEL_51;
  }

  v11 = [MEMORY[0x277CBEB18] array];
  v12 = self;
  [(HMDHome *)self removeAccessory:v8];
  [v11 addObject:v8];
  v13 = +[HMDBulletinBoard sharedBulletinBoard];
  [v13 removeBulletinsForAccessory:v8];

  v14 = v8;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  if (isKindOfClass)
  {
    v16 = v14;
  }

  else
  {
    v16 = 0;
  }

  v71 = v16;

  if (isKindOfClass)
  {
    v66 = v14;
    v67 = v10;
    v68 = v9;
    v69 = v11;
    v65 = v8;
    v77 = 0u;
    v78 = 0u;
    v75 = 0u;
    v76 = 0u;
    v17 = [(HMDHome *)v70 accessories];
    v18 = [v17 countByEnumeratingWithState:&v75 objects:v85 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = *v76;
      do
      {
        for (i = 0; i != v19; ++i)
        {
          if (*v76 != v20)
          {
            objc_enumerationMutation(v17);
          }

          v22 = *(*(&v75 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v23 = v22;
          }

          else
          {
            v23 = 0;
          }

          v24 = v23;

          v25 = [v24 identifier];
          v26 = [v71 identifier];
          if (([v25 isEqualToString:v26] & 1) == 0)
          {

            goto LABEL_20;
          }

          v27 = [v24 hostAccessory];
          objc_opt_class();
          v28 = objc_opt_isKindOfClass();

          if ((v28 & 1) == 0 || !v27)
          {
            [(HMDHome *)v70 removeAccessory:v22];
            [v69 addObject:v22];
            v25 = +[HMDBulletinBoard sharedBulletinBoard];
            [v25 removeBulletinsForAccessory:v22];
LABEL_20:
          }
        }

        v19 = [v17 countByEnumeratingWithState:&v75 objects:v85 count:16];
      }

      while (v19);
    }

    v14 = v66;
    v29 = [v66 isReachable];
    v8 = v65;
    v10 = v67;
    v9 = v68;
    v11 = v69;
    v12 = v70;
    if (v68 || !v29 || ([v66 home], v30 = objc_claimAutoreleasedReturnValue(), v31 = objc_msgSend(v30, "isAdminUser"), v30, (v31 & 1) == 0))
    {
      v32 = [(HMDHome *)v70 keychainStore];
      v33 = [v71 identifier];
      v74 = 0;
      [v32 removeAccessoryKeyForName:v33 error:&v74];
      v34 = v74;

      if (v34)
      {
        v35 = objc_autoreleasePoolPush();
        v36 = v70;
        v37 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
        {
          v38 = HMFGetLogIdentifier();
          v39 = [v66 name];
          v40 = [v71 identifier];
          *buf = 138543874;
          v80 = v38;
          v81 = 2112;
          v82 = v39;
          v83 = 2112;
          v84 = v40;
          _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove keychain entry for accessory %@ with identifier: %@", buf, 0x20u);

          v11 = v69;
          v14 = v66;
        }

        objc_autoreleasePoolPop(v35);
        v10 = v67;
        v9 = v68;
      }
    }

    v41 = [v71 identifier];
    [(HMDHome *)v70 _deregisterPairedAccessory:v41];
  }

  v42 = v14;
  objc_opt_class();
  v43 = objc_opt_isKindOfClass();
  if (v43)
  {
    v44 = v42;
  }

  else
  {
    v44 = 0;
  }

  v45 = v44;

  if (v43)
  {
    v46 = [v42 mediaProfile];
    if (v46)
    {
      v47 = [(HMDHome *)v12 workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __73__HMDHome__removeAccessoriesForPrimaryAccessory_error_completionHandler___block_invoke;
      block[3] = &unk_27868A750;
      block[4] = v12;
      v73 = v46;
      dispatch_async(v47, block);

      v48 = [v42 identifier];
      v49 = [(HMDHome *)v12 mediaSessionStateWithIdentifier:v48];

      if (v49)
      {
        [(HMDHome *)v12 removeMediaSessionState:v49];
      }
    }
  }

  v50 = objc_autoreleasePoolPush();
  v51 = v12;
  v52 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
  {
    v53 = HMFGetLogIdentifier();
    *buf = 138543618;
    v80 = v53;
    v81 = 2112;
    v82 = v11;
    _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_INFO, "%{public}@removedAccessories %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v50);
  [(HMDHome *)v51 _sendRemoveCompletionStatusForHMDAccessories:v11 withCompletion:v10 error:0];

LABEL_51:
  v64 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome__removeAccessoriesForPrimaryAccessory_error_completionHandler___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) notificationRegistry];
  [v2 removeRegistrationsForMediaProfile:*(a1 + 40)];
}

- (void)_sendRemoveCompletionStatusForHMDAccessories:(id)a3 withCompletion:(id)a4 error:(id)a5
{
  v42 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v28 = a4;
  v29 = a5;
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v28)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543874;
      v37 = v13;
      v38 = 2112;
      v39 = v29;
      v40 = 2112;
      v41 = v8;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Sending removal completion with error %@, accessories %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    v28[2](v28, v8, v29);
  }

  else
  {
    if (v12)
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v37 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@sending removal completion for accessory removal: no completion found", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
  }

  v33 = 0u;
  v34 = 0u;
  v31 = 0u;
  v32 = 0u;
  obj = v8;
  v15 = [obj countByEnumeratingWithState:&v31 objects:v35 count:16];
  if (v15)
  {
    v16 = *v32;
    do
    {
      v17 = 0;
      do
      {
        if (*v32 != v16)
        {
          objc_enumerationMutation(obj);
        }

        v18 = *(*(&v31 + 1) + 8 * v17);
        os_unfair_recursive_lock_lock_with_options();
        [(NSHashTable *)v10->_removeAccessoryInProgressForHMDAccessories removeObject:v18];
        os_unfair_recursive_lock_unlock();
        v19 = v18;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v20 = v19;
        }

        else
        {
          v20 = 0;
        }

        v21 = v20;

        if (v21 && [v19 isPrimary])
        {
          v22 = [v21 getPrimaryHAPAccessories];
          v23 = [v22 firstObject];
          v24 = [v23 server];

          v25 = [(HMDHome *)v10 accessoryBrowser];
          v26 = [v21 identifier];
          [v25 addUnpairedAccessoryServer:v24 identifier:v26];
        }

        ++v17;
      }

      while (v15 != v17);
      v15 = [obj countByEnumeratingWithState:&v31 objects:v35 count:16];
    }

    while (v15);
  }

  if ([obj count])
  {
    [(HMDHome *)v10 _reevaluateAccessoryInfoWithBadgeRefresh:1];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientOfNewlyAddedAccessories:(id)a3 requestMessage:(id)a4
{
  v79 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v58 = a4;
  v59 = [MEMORY[0x277CBEB18] array];
  v62 = [MEMORY[0x277CBEB18] array];
  v66 = 0u;
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  obj = v6;
  v7 = [obj countByEnumeratingWithState:&v66 objects:v78 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v67;
    v61 = *MEMORY[0x277CCF0B0];
    v60 = *MEMORY[0x277CCEA00];
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v67 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v66 + 1) + 8 * i);
        v12 = accessoryToEncodeForXPCTransportForAccessory(v11);
        if (v12 == v11)
        {
          v72[0] = v61;
          v17 = [v11 uuid];
          v72[1] = v60;
          v73[0] = v17;
          v18 = encodeRootObjectForSPIClients(v11);
          v73[1] = v18;
          v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v73 forKeys:v72 count:2];

          v20 = [v19 copy];
          [v62 addObject:v20];

          v21 = v11;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v22 = v21;
          }

          else
          {
            v22 = 0;
          }

          v23 = v22;

          v24 = v21;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();

          if (v23 || (isKindOfClass & (v24 != 0)) != 0)
          {
            [v59 addObject:v19];
          }
        }

        else
        {
          v13 = objc_autoreleasePoolPush();
          v14 = self;
          v15 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
          {
            v16 = HMFGetLogIdentifier();
            *buf = 138543618;
            v75 = v16;
            v76 = 2112;
            v77 = v11;
            _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Skipping notifying clients of added accessory: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v13);
        }
      }

      v8 = [obj countByEnumeratingWithState:&v66 objects:v78 count:16];
    }

    while (v8);
  }

  v70 = *MEMORY[0x277CD0640];
  v26 = [(HMDHome *)self uuid];
  v71 = v26;
  v27 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v71 forKeys:&v70 count:1];

  if ([v59 count])
  {
    v28 = [v27 mutableCopy];
    v29 = [v59 copy];
    v30 = *MEMORY[0x277CCE7A8];
    [v28 setObject:v29 forKeyedSubscript:*MEMORY[0x277CCE7A8]];

    v31 = objc_autoreleasePoolPush();
    v32 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543618;
      v75 = v34;
      v76 = 2112;
      v77 = v28;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Notifying non-SPI-entitled clients of added accessories using payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v31);
    v35 = [MEMORY[0x277D0F848] nonSPIEntitledMessageWithName:*MEMORY[0x277CCFD98] messagePayload:v28];
    v36 = v58;
    v37 = [v58 identifier];
    [v35 setIdentifier:v37];

    v38 = [(HMDHome *)v32 msgDispatcher];
    v39 = [(HMDHome *)v32 uuid];
    [v38 sendMessage:v35 target:v39];
  }

  else
  {
    v40 = objc_autoreleasePoolPush();
    v41 = self;
    v42 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v42, OS_LOG_TYPE_INFO))
    {
      v43 = HMFGetLogIdentifier();
      *buf = 138543362;
      v75 = v43;
      _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_INFO, "%{public}@Not notifying non-SPI-entitled clients of empty list of added accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v40);
    v30 = *MEMORY[0x277CCE7A8];
    v36 = v58;
  }

  v44 = [v27 mutableCopy];
  v45 = [v62 copy];
  [v44 setObject:v45 forKeyedSubscript:v30];

  v46 = objc_autoreleasePoolPush();
  v47 = self;
  v48 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
  {
    v49 = HMFGetLogIdentifier();
    *buf = 138543618;
    v75 = v49;
    v76 = 2112;
    v77 = v44;
    _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_INFO, "%{public}@Notifying SPI-entitled clients of added accessories using payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v46);
  v50 = MEMORY[0x277D0F848];
  v51 = *MEMORY[0x277CCFD98];
  v52 = [v36 identifier];
  v53 = [v50 entitledMessageWithName:v51 identifier:v52 messagePayload:v44];

  v54 = [(HMDHome *)v47 msgDispatcher];
  v55 = [(HMDHome *)v47 uuid];
  v64[0] = MEMORY[0x277D85DD0];
  v64[1] = 3221225472;
  v64[2] = __63__HMDHome__notifyClientOfNewlyAddedAccessories_requestMessage___block_invoke;
  v64[3] = &unk_27868A728;
  v65 = v36;
  v56 = v36;
  [v54 sendMessage:v53 target:v55 andInvokeCompletionHandler:v64];

  v57 = *MEMORY[0x277D85DE8];
}

- (void)_deregisterPairedAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self accessoryBrowser];
  [v5 deregisterPairedAccessory:v4];
}

- (void)_registerPairedAccessory:(id)a3 transports:(unint64_t)a4 setupHash:(id)a5
{
  v8 = a5;
  v9 = a3;
  v10 = [(HMDHome *)self accessoryBrowser];
  [v10 registerPairedAccessory:v9 transports:a4 setupHash:v8 delegate:self];
}

- (id)hapAccessoryUniqueIdentifiers
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = [(HMDHome *)self accessories];
  v3 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v2, "count")}];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v4 = v2;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          v12 = [v11 uniqueIdentifier];
          [v3 addObject:v12];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)hapAccessoryServerIdentifiers
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = [(HMDHome *)self accessories];
  v3 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v2, "count")}];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v4 = v2;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11 && [v11 isPrimary])
        {
          v12 = [v11 identifier];
          [v3 addObject:v12];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (unint64_t)accessoryCountForRoom:(id)a3
{
  v4 = [MEMORY[0x277CCAC30] predicateWithFormat:@"room == %@", a3];
  v5 = [(HMDHome *)self accessories];
  v6 = [v5 filteredArrayUsingPredicate:v4];

  v7 = [v6 count];
  return v7;
}

- (void)scheduleRemoval
{
  v4 = [(HMDHome *)self homeManager];
  v3 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  [v4 scheduleRemovalForHome:self message:0 options:v3];
}

- (id)hmdHAPAccessoryWithHAPAccessory:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [(HMDHome *)self accessories];
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v16;
LABEL_3:
    v9 = 0;
    while (1)
    {
      if (*v16 != v8)
      {
        objc_enumerationMutation(v5);
      }

      v10 = *(*(&v15 + 1) + 8 * v9);
      objc_opt_class();
      v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
      v12 = v11;

      if ([v12 matchesHAPAccessory:v4])
      {
        break;
      }

      if (v7 == ++v9)
      {
        v7 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
        if (v7)
        {
          goto LABEL_3;
        }

        goto LABEL_12;
      }
    }
  }

  else
  {
LABEL_12:
    v12 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)hapAccessoryWithIdentifier:(id)a3 instanceID:(id)a4
{
  v28 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v8 = [(HMDHome *)self accessories];
  v9 = [v8 countByEnumeratingWithState:&v23 objects:v27 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v24;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v24 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v23 + 1) + 8 * i);
        v14 = [v13 identifier];
        v15 = [v14 isEqualToString:v6];

        if (v15)
        {
          v16 = v13;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v17 = v16;
          }

          else
          {
            v17 = 0;
          }

          v18 = v17;

          if (v18)
          {
            if (!v7)
            {
              goto LABEL_17;
            }

            v19 = [v18 hapInstanceId];
            v20 = [v19 isEqualToNumber:v7];

            if (v20)
            {
              goto LABEL_17;
            }
          }
        }
      }

      v10 = [v8 countByEnumeratingWithState:&v23 objects:v27 count:16];
    }

    while (v10);
  }

  v16 = 0;
LABEL_17:

  v21 = *MEMORY[0x277D85DE8];

  return v16;
}

- (id)hapAccessoryWithIdentifier:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithIdentifier:a3];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (id)accessoryWithIdentifier:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v5 = [(HMDHome *)self accessories];
  v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v6)
  {
    v7 = *v15;
    do
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v15 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v14 + 1) + 8 * i);
        v10 = [v9 identifier];
        if ([v10 isEqualToString:v4])
        {
          v11 = [v9 isPrimary];

          if (v11)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        else
        {
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v6);
  }

LABEL_12:

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)_removeWithMergeSecondaryAccessory:(id)a3 removedFromBridgeAccessory:(id)a4 completionHandler:(id)a5
{
  v13[1] = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  [a4 removeHostedAccessory:v8];
  [(HMDHome *)self removeAccessory:v8];
  v10 = +[HMDBulletinBoard sharedBulletinBoard];
  [v10 removeBulletinsForAccessory:v8];

  [(HMDHome *)self _reevaluateAccessoryInfoWithBadgeRefresh:1];
  if (v9)
  {
    v13[0] = v8;
    v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
    v9[2](v9, v11, 0);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeWithMergeSecondaryAccessory:(id)a3 removedFromBridgeAccessory:(id)a4 completionHandler:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __90__HMDHome_removeWithMergeSecondaryAccessory_removedFromBridgeAccessory_completionHandler___block_invoke;
  v15[3] = &unk_278689AB8;
  v15[4] = self;
  v16 = v8;
  v17 = v9;
  v18 = v10;
  v12 = v10;
  v13 = v9;
  v14 = v8;
  dispatch_async(v11, v15);
}

- (void)notifyOfNewlyAddedAccessoryByThisOwnerDevice:(id)a3
{
  v17[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;
  if (v6)
  {
    v7 = v6;
    v8 = [(HMDHome *)self isOwnerUser];

    if (!v8)
    {
      goto LABEL_13;
    }

    goto LABEL_12;
  }

  v9 = v4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = v9;
  }

  else
  {
    v10 = 0;
  }

  v11 = v10;

  if (v11)
  {
    v12 = [(HMDHome *)self isOwnerUser];

    if (v12)
    {
LABEL_12:
      v13 = [(HMDHome *)self notificationCenter];
      v16 = @"HMDAccessoryNotificationKey";
      v17[0] = v4;
      v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:&v16 count:1];
      [v13 postNotificationName:@"HMDHomeThisOwnerDeviceAddedAccessoryNotification" object:self userInfo:v14];
    }
  }

LABEL_13:

  v15 = *MEMORY[0x277D85DE8];
}

- (void)notifyOfAddedAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __34__HMDHome_notifyOfAddedAccessory___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __34__HMDHome_notifyOfAddedAccessory___block_invoke(uint64_t a1)
{
  v6[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v1 = *(a1 + 40);
  v5[0] = @"HMDNotificationAddedAccessoryKey";
  v5[1] = @"HMDAccessoryKey";
  v6[0] = v1;
  v6[1] = v1;
  v3 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v6 forKeys:v5 count:2];
  logAndPostNotification(@"HMDNotificationHomeAddedAccessory", v2, v3);

  v4 = *MEMORY[0x277D85DE8];
}

- (void)notifyOfRemovedAccessory:(id)a3 source:(unint64_t)a4
{
  v6 = a3;
  v7 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __43__HMDHome_notifyOfRemovedAccessory_source___block_invoke;
  block[3] = &unk_278685DF8;
  block[4] = self;
  v10 = v6;
  v11 = a4;
  v8 = v6;
  dispatch_async(v7, block);
}

void __43__HMDHome_notifyOfRemovedAccessory_source___block_invoke(uint64_t a1)
{
  v9[4] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) notificationCenter];
  v4 = *(a1 + 32);
  v3 = *(a1 + 40);
  v8[0] = @"HMDAccessoryNotificationKey";
  v8[1] = @"HMDAccessoryKey";
  v9[0] = v3;
  v9[1] = v3;
  v9[2] = v4;
  v8[2] = @"HMDHomeKey";
  v8[3] = @"HMDNotificationSourceKey";
  v5 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 48)];
  v9[3] = v5;
  v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:v8 count:4];
  [v2 postNotificationName:@"HMDHomeAccessoryRemovedNotification" object:v4 userInfo:v6];

  v7 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveAccessoryModel:(id)a3 message:(id)a4
{
  v77 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 uuid];

  if (v8)
  {
    v9 = [v7 transactionResult];
    v10 = [v6 uuid];
    v11 = [(HMDHome *)self accessoryWithUUID:v10];

    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v6 debugString:1];
      *buf = 138543618;
      v74 = v15;
      v75 = 2112;
      v76 = v16;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Going to remove accessory : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v17 = v11;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    if (v17)
    {
      if (isInternalBuild() && ([v17 shouldProcessTransactionRemoval] & 1) == 0)
      {
        v59 = objc_autoreleasePoolPush();
        v60 = v13;
        v61 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v63 = v62 = v19;
          *buf = 138543362;
          v74 = v63;
          _os_log_impl(&dword_229538000, v61, OS_LOG_TYPE_ERROR, "%{public}@Failed to process transaction removal due to internal flag set to simulate this failure", buf, 0xCu);

          v19 = v62;
        }

        objc_autoreleasePoolPop(v59);
        [v7 respondWithSuccess];
        goto LABEL_34;
      }

      if ([v17 isPrimary])
      {
        v67 = v19;
        v20 = v17;
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();
        if (isKindOfClass)
        {
          v22 = v20;
        }

        else
        {
          v22 = 0;
        }

        v65 = v22;

        if (isKindOfClass)
        {
          v23 = [(HMDHome *)v13 mediaStateSubscriber];
          [v23 unsubscribeForAppleMediaStateForAccessory:v20 subscriptionToken:@"HMDHomeClientMediaStateRegistrationToken"];

          v24 = [(HMDHome *)v13 mediaStateSubscriber];
          [v24 localUnsubscribeForAppleMediaStateForAccessory:v20];
        }

        v25 = [(HMDHome *)v13 selfRemovalWatchdog];
        if (!v25)
        {
          goto LABEL_21;
        }

        v26 = v25;
        [v20 uuid];
        v27 = v64 = v9;
        v28 = [(HMDHome *)v13 selfRemovalWatchdog];
        v29 = [v28 currentAccessoryUUID];
        v30 = [v27 hmf_isEqualToUUID:v29];

        v9 = v64;
        if (v30)
        {
          v31 = [(HMDHome *)v13 selfRemovalWatchdog];
          v69[0] = MEMORY[0x277D85DD0];
          v69[1] = 3221225472;
          v69[2] = __47__HMDHome__handleRemoveAccessoryModel_message___block_invoke;
          v69[3] = &unk_278688D58;
          v69[4] = v13;
          v70 = v6;
          v71 = v7;
          [v31 startWithCompletion:v69];
        }

        else
        {
LABEL_21:
          v36 = [v6 uuid];
          [(HMDHome *)v13 _removeAccessoryWithUUID:v36 message:v7];
        }

        v37 = [(HMDHome *)v13 networkProtectionGroupRegistry];
        [v37 handleRemovedAccessory:v20];

        v38 = [v20 uuid];
        v39 = [(HMDHome *)v13 activeNetworkRouterUUID];
        v40 = [v38 isEqual:v39];

        v19 = v67;
        if (v40)
        {
          [(HMDHome *)v13 _evaluateNetworkRouterManagementForTransaction:v9];
        }

        v34 = v65;
      }

      else
      {
        v34 = [v19 bridge];
        [v34 removeHostedAccessory:v17];
        [(HMDHome *)v13 removeAccessory:v17];
        v72 = v17;
        v35 = [MEMORY[0x277CBEA60] arrayWithObjects:&v72 count:1];
        [(HMDHome *)v13 _removeAccessories:v35 message:0];
      }

      v41 = [v7 transactionResult];
      -[HMDHome notifyOfRemovedAccessory:source:](v13, "notifyOfRemovedAccessory:source:", v17, [v41 source]);
      v42 = [(HMDHome *)v13 homeManager];
      if ([v19 isPrimary])
      {
        v43 = [v19 matterNodeID];
        v44 = [v43 unsignedIntValue];

        if (v44)
        {
          v66 = [v42 accessoryBrowser];
          v45 = [v66 chipAccessoryServerBrowser];
          [v19 matterNodeID];
          v46 = v68 = v19;
          [(HMDHome *)v13 targetFabricUUID];
          v47 = v7;
          v49 = v48 = v9;
          [v45 handleHomeRemovedAccessoryWithNodeID:v46 fabricUUID:v49];

          v9 = v48;
          v7 = v47;

          v19 = v68;
        }
      }

      v50 = [v42 lastEventStoreController];
      v51 = [v17 uuid];
      [v50 didRemoveAccessory:v51];
    }

    v52 = [v19 supportsAdaptiveTemperatureAutomations];
    v53 = [v52 BOOLValue];

    if (v53)
    {
      v54 = objc_autoreleasePoolPush();
      v55 = v13;
      v56 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
      {
        v57 = HMFGetLogIdentifier();
        *buf = 138543362;
        v74 = v57;
        _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - accessory removed", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v54);
      [(HMDHome *)v55 configureUserActivityStateDetectorManager];
    }

    [v9 markChanged];
    [v9 markSaveToAssistant];
LABEL_34:

    goto LABEL_35;
  }

  v32 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
  v33 = [v7 responseHandler];
  (v33)[2](v33, v32, 0);

LABEL_35:
  v58 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleRemoveAccessoryModel_message___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __47__HMDHome__handleRemoveAccessoryModel_message___block_invoke_2;
  block[3] = &unk_27868A010;
  v3 = *(a1 + 40);
  block[4] = *(a1 + 32);
  v5 = v3;
  v6 = *(a1 + 48);
  dispatch_async(v2, block);
}

void __47__HMDHome__handleRemoveAccessoryModel_message___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) setSelfRemovalWatchdog:0];
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) uuid];
  [v2 _removeAccessoryWithUUID:v3 message:*(a1 + 48)];
}

- (void)_handleRemoveAccessoryAfterUserConsent:(id)a3 message:(id)a4
{
  v38 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if ([(HMDHome *)self isAdminUser])
  {
    v8 = [(HMDHome *)self administratorHandler];
    if ([v8 shouldRelayMessages] && (!isFeatureMatteriPhoneOnlyPairingControlEnabled() || -[HMDHome hasAnyResident](self, "hasAnyResident")))
    {
      v9 = objc_autoreleasePoolPush();
      v10 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 138543362;
        v35 = v12;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Sending remove accessory request to owner / primary resident", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
      v13 = [v7 mutableCopy];
      [v13 setRemoteRestriction:9];
      v31[0] = MEMORY[0x277D85DD0];
      v31[1] = 3221225472;
      v31[2] = __58__HMDHome__handleRemoveAccessoryAfterUserConsent_message___block_invoke;
      v31[3] = &unk_278686658;
      v31[4] = v10;
      v32 = v6;
      v33 = v7;
      [v13 setResponseHandler:v31];
      v7 = [v13 copy];
      v30 = 0;
      v14 = [v8 operationForMessage:v7 error:&v30];
      v15 = v30;
      if (v14)
      {
        [v8 addOperation:v14];
      }

      else
      {
        v24 = objc_autoreleasePoolPush();
        v25 = v10;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
        {
          v27 = HMFGetLogIdentifier();
          *buf = 138543618;
          v35 = v27;
          v36 = 2112;
          v37 = v15;
          _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Failed to create home administrator configuration operation for accessory removal: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v24);
        v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
        [v7 respondWithError:v28];
      }
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      v21 = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543362;
        v35 = v23;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Removing accessory locally", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      [(HMDHome *)v21 __removeAccessory:v6 isBeingReplaced:0 isForceUpdate:0 message:v7];
      [(HMDHome *)v21 _submitRemovalLogEventForAccessory:v6 isLocalRemoval:1 isLocalFallback:0 isDuplicate:0 duplicateCount:0 error:0];
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v35 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Not removing accessory due to insufficient privileges", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    [v7 respondWithError:v8];
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)__removeAccessory:(char)a3 isBeingReplaced:(int)a4 isForceUpdate:(void *)a5 message:
{
  v65 = *MEMORY[0x277D85DE8];
  v8 = a2;
  v9 = a5;
  v10 = v9;
  v45 = a1;
  if (a1)
  {
    if (a4)
    {
      v11 = [v9 untrustedClientIdentifier];
      v12 = [HMDBackingStoreTransactionOptions defaultXPCOptionsWithCDTransactionAuthor:10 clientIdentifier:v11];
    }

    else
    {
      v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    }

    v13 = [a1 backingStore];
    v14 = [v10 name];
    v38 = v12;
    v46 = [v13 transaction:v14 options:v12];

    v40 = v8;
    v15 = [MEMORY[0x277CBEB18] arrayWithObject:v8];
    v59 = 0u;
    v60 = 0u;
    v61 = 0u;
    v62 = 0u;
    v16 = [v15 countByEnumeratingWithState:&v59 objects:v64 count:16];
    if (v16)
    {
      v17 = v16;
      v18 = *v60;
      do
      {
        for (i = 0; i != v17; ++i)
        {
          if (*v60 != v18)
          {
            objc_enumerationMutation(v15);
          }

          v20 = [*(*(&v59 + 1) + 8 * i) transactionWithObjectChangeType:3];
          [v46 add:v20 withMessage:v10];
        }

        v17 = [v15 countByEnumeratingWithState:&v59 objects:v64 count:16];
      }

      while (v17);
    }

    v39 = v10;
    group = dispatch_group_create();
    v55 = 0u;
    v56 = 0u;
    v57 = 0u;
    v58 = 0u;
    obj = v15;
    v21 = [obj countByEnumeratingWithState:&v55 objects:v63 count:16];
    if (v21)
    {
      v22 = v21;
      v23 = *v56;
      do
      {
        v24 = 0;
        v41 = v22;
        do
        {
          if (*v56 != v23)
          {
            objc_enumerationMutation(obj);
          }

          v25 = *(*(&v55 + 1) + 8 * v24);
          dispatch_group_enter(group);
          v49[0] = MEMORY[0x277D85DD0];
          v49[1] = 3221225472;
          v26 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke;
          v50 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke;
          v51 = &unk_27868A010;
          v52 = v45;
          v53 = v25;
          v54 = group;
          v27 = v45;
          v28 = v25;
          v29 = v46;
          v30 = v49;
          if ((a3 & 1) == 0)
          {
            v31 = v23;
            v32 = [v28 uuid];
            v33 = [v27 activeNetworkRouterUUID];
            v34 = [v32 isEqual:v33];

            if (v34)
            {
              [v27 _updateActiveNetworkRouterAccessory:0 isReplacement:0 withTransaction:v29];
              [v27 _clearAccessoryNetworkProtectionStateWithTransaction:v29];
              [v27 _reconfigureAccessoriesOnRouterRemovalWithCompletion:v30];
              v23 = v31;
              v22 = v41;
              goto LABEL_22;
            }

            v26 = v50;
            v23 = v31;
            v22 = v41;
          }

          v26(v30);
LABEL_22:

          ++v24;
        }

        while (v22 != v24);
        v22 = [obj countByEnumeratingWithState:&v55 objects:v63 count:16];
      }

      while (v22);
    }

    v35 = [v45 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_3;
    block[3] = &unk_27868A728;
    v48 = v46;
    v36 = v46;
    dispatch_group_notify(group, v35, block);

    v10 = v39;
    v8 = v40;
  }

  v37 = *MEMORY[0x277D85DE8];
}

void __58__HMDHome__handleRemoveAccessoryAfterUserConsent_message___block_invoke(id *a1, void *a2, void *a3)
{
  v14 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (!v5)
  {
    [a1[4] _submitRemovalLogEventForAccessory:a1[5] isLocalRemoval:0 isLocalFallback:0 isDuplicate:0 duplicateCount:0 error:0];
  }

  if ([a1[4] shouldAccessoryRemovalFallbackToLocalRemovalOnError:v5 accessory:a1[5]])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = a1[4];
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove an apple media accessory via the primary resident. Removing it locally", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    [(HMDHome *)a1[4] __removeAccessory:0 isBeingReplaced:1 isForceUpdate:a1[6] message:?];
    [a1[4] _submitRemovalLogEventForAccessory:a1[5] isLocalRemoval:1 isLocalFallback:1 isDuplicate:0 duplicateCount:0 error:v5];
  }

  else
  {
    [a1[6] respondWithPayload:v6 error:v5];
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v7 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_2;
  v8 = &unk_27868A728;
  v9 = *(a1 + 48);
  v3 = v1;
  v4 = v2;
  v5 = v6;
  if (([v4 isPrimary] & 1) != 0 || objc_msgSend(v4, "conformsToProtocol:", &unk_283F01280) && objc_msgSend(v4, "supportsUserManagement"))
  {
    [v3 removeAllUsersAndCloudDataFromAccessory:v4 completionHandler:v5];
  }

  else
  {
    v7(v5);
  }
}

- (BOOL)shouldAccessoryRemovalFallbackToLocalRemovalOnError:(id)a3 accessory:(id)a4
{
  v6 = a3;
  v7 = a4;
  if ([v6 isHMError] && objc_msgSend(v6, "code") == 8 || objc_msgSend(v6, "isHMFError") && objc_msgSend(v6, "code") == 13 || objc_msgSend(v6, "isHMError") && objc_msgSend(v6, "code") == 91)
  {
    v8 = [(HMDHome *)self homeManager];
    if ([v8 isNetworkConnectionAvailable] && ((v9 = v7, objc_opt_class(), (objc_opt_isKindOfClass() & 1) == 0) ? (v10 = 0) : (v10 = v9), v11 = v10, v9, v11))
    {
      v12 = [(HMDHome *)self owner];
      v13 = [v12 isCurrentUser];
    }

    else
    {
      v13 = 0;
    }
  }

  else
  {
    v13 = 0;
  }

  return v13;
}

- (void)_handleRemoveAccessoryMessage:(id)a3
{
  v66 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [v4 uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v6)
  {
    v7 = [(HMDHome *)self accessoryWithUUID:v6];
    if (!v7)
    {
      v23 = objc_autoreleasePoolPush();
      v24 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543618;
        v63 = v26;
        v64 = 2112;
        v65 = v6;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to find accessory with UUID: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v23);
      v8 = [v4 responseHandler];

      if (v8)
      {
        v27 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        v28 = [v4 responseHandler];
        (v28)[2](v28, v27, 0);

        v8 = 0;
      }

      goto LABEL_21;
    }

    v8 = v7;
    if ([v7 isPrimary])
    {
      v9 = [v4 isRemote];
      v10 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      v13 = os_log_type_enabled(v12, OS_LOG_TYPE_INFO);
      if (v9)
      {
        if (v13)
        {
          v14 = HMFGetLogIdentifier();
          *buf = 138543618;
          v63 = v14;
          v64 = 2112;
          v65 = v8;
          _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Received remote request to remove accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v10);
        v15 = [(HMDHome *)v11 residentSyncManager];
        v59[0] = MEMORY[0x277D85DD0];
        v59[1] = 3221225472;
        v59[2] = __41__HMDHome__handleRemoveAccessoryMessage___block_invoke;
        v59[3] = &unk_2786858B0;
        v8 = v8;
        v60 = v8;
        v61 = v11;
        [v15 interceptRemoteResidentRequest:v4 proceed:v59];

        goto LABEL_21;
      }

      if (v13)
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543618;
        v63 = v36;
        v64 = 2112;
        v65 = v8;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Received request to remove accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      if ([v4 isRemote] & 1) != 0 || (objc_msgSend(v4, "isEntitledForSPIAccess"))
      {
        goto LABEL_27;
      }

      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __41__HMDHome__handleRemoveAccessoryMessage___block_invoke_1467;
      aBlock[3] = &unk_278685E48;
      aBlock[4] = v11;
      v57 = v4;
      v37 = v8;
      v58 = v37;
      v38 = _Block_copy(aBlock);
      v39 = [v37 uuid];
      v40 = [(HMDHome *)v11 activeNetworkRouterUUID];
      v41 = [v39 isEqual:v40];

      if (v41)
      {
        v42 = [(HMDHome *)v11 accessoriesRequiringManualReconfigurationOnRouterRemoval];
        v43 = [v42 na_map:&__block_literal_global_1471];

        v44 = objc_autoreleasePoolPush();
        v45 = v11;
        v46 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
        {
          v47 = HMFGetLogIdentifier();
          *buf = 138543362;
          v63 = v47;
          _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_INFO, "%{public}@Requesting permission to remove active network router accessory", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v44);
        v48 = +[HMDUIDialogPresenter sharedUIDialogPresenter];
        v49 = [v37 name];
        v50 = [v37 uuid];
        v51 = [(HMDHome *)v45 workQueue];
        [v48 requestUserPermissionForRemovalOfRouter:v49 accessoriesRequiringManualReconfiguration:v43 withContext:v50 queue:v51 completionHandler:v38];
      }

      else
      {
        if ([v37 wiFiCredentialType] != 3)
        {

LABEL_27:
          [(HMDHome *)v11 _handleRemoveAccessoryAfterUserConsent:v8 message:v4];
          goto LABEL_21;
        }

        v52 = objc_autoreleasePoolPush();
        v53 = v11;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_INFO))
        {
          v55 = HMFGetLogIdentifier();
          *buf = 138543362;
          v63 = v55;
          _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_INFO, "%{public}@Requesting permission to remove accessory with specific WiFi credential", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v52);
        v43 = +[HMDUIDialogPresenter sharedUIDialogPresenter];
        v48 = [v37 name];
        v49 = [v37 uuid];
        v50 = [(HMDHome *)v53 workQueue];
        [v43 requestUserPermissionForRemovalOfSpecificWiFiCredentialedAccessory:v48 withContext:v49 queue:v50 completionHandler:v38];
      }

      v8 = v37;
      goto LABEL_21;
    }

    v29 = objc_autoreleasePoolPush();
    v30 = self;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543618;
      v63 = v32;
      v64 = 2112;
      v65 = v8;
      _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@cannot remove bridged accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v29);
    v33 = [v4 responseHandler];

    if (!v33)
    {
      goto LABEL_21;
    }

    v22 = [v4 responseHandler];
    v34 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:34 userInfo:0];
    (v22)[2](v22, v34, 0);

LABEL_20:
LABEL_21:

    goto LABEL_22;
  }

  v16 = objc_autoreleasePoolPush();
  v17 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
  {
    v19 = HMFGetLogIdentifier();
    v20 = [v4 messagePayload];
    *buf = 138543618;
    v63 = v19;
    v64 = 2112;
    v65 = v20;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEFAULT, "%{public}@Missing target accessory UUID from message payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v16);
  v21 = [v4 responseHandler];

  if (v21)
  {
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v22 = [v4 responseHandler];
    (v22)[2](v22, v8, 0);
    goto LABEL_20;
  }

LABEL_22:

  v35 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleRemoveAccessoryMessage___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if ([*(a1 + 32) isCurrentAccessory] && objc_msgSend(*(a1 + 40), "isCurrentDevicePrimaryResident"))
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 40);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v14 = 138543362;
      v15 = v7;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Processing self removal from home", &v14, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v8 = [HMDSelfRemovalWatchdog alloc];
    v9 = [*(a1 + 32) uuid];
    v10 = [*(a1 + 40) workQueue];
    v11 = [(HMDSelfRemovalWatchdog *)v8 initWithCurrentAccessoryUUID:v9 workQueue:v10];
    [*(a1 + 40) setSelfRemovalWatchdog:v11];

    v12 = [*(a1 + 40) selfRemovalWatchdog];
    [v12 configure];
  }

  [(HMDHome *)*(a1 + 40) __removeAccessory:0 isBeingReplaced:0 isForceUpdate:v3 message:?];

  v13 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleRemoveAccessoryMessage___block_invoke_1467(uint64_t a1, int a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (a2)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@User canceled consent for removing accessory", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    [v9 respondWithError:v10];
  }

  else
  {
    if (v7)
    {
      v11 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v11;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@User accepted consent for removing accessory", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 32) _handleRemoveAccessoryAfterUserConsent:*(a1 + 48) message:*(a1 + 40)];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleRemoveAccessoryMessage:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __40__HMDHome_handleRemoveAccessoryMessage___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)handleRemoveAccessory:(id)a3 completion:(id)a4
{
  v27[1] = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = MEMORY[0x277D0F848];
  v8 = a3;
  v9 = [v7 alloc];
  v10 = *MEMORY[0x277CD24F0];
  v11 = objc_alloc(MEMORY[0x277D0F820]);
  v12 = [(HMDHome *)self uuid];
  v13 = [v11 initWithTarget:v12];
  v26 = *MEMORY[0x277CCF0B0];
  v14 = [v8 uuid];

  v15 = [v14 UUIDString];
  v27[0] = v15;
  v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];
  v17 = [v9 initWithName:v10 destination:v13 payload:v16];

  [v17 setRemoteRestriction:9];
  v21 = MEMORY[0x277D85DD0];
  v22 = 3221225472;
  v23 = __44__HMDHome_handleRemoveAccessory_completion___block_invoke;
  v24 = &unk_2786818D0;
  v25 = v6;
  v18 = v6;
  [v17 setResponseHandler:&v21];
  if ([(HMDHome *)self isCurrentDevicePrimaryResident:v21]|| isFeatureMatteriPhoneOnlyPairingControlEnabled() && ![(HMDHome *)self hasAnyResident])
  {
    [(HMDHome *)self handleRemoveAccessoryMessage:v17];
  }

  else
  {
    v19 = [(HMDHome *)self residentSyncManager];
    [v19 performResidentRequest:v17 options:0];
  }

  v20 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome_handleRemoveAccessory_completion___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  v3 = _Block_copy(*(a1 + 32));
  v4 = v3;
  if (v3)
  {
    (*(v3 + 2))(v3, v5);
  }
}

- (void)__handleAddMediaAccessoryModel:(id)a3 message:(id)a4
{
  v81 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = HMFGetOSLogHandle();
  if (os_signpost_enabled(v8))
  {
    v9 = [v6 uuid];
    v10 = [v6 parentUUID];
    v11 = [v6 bsoRecord];
    v12 = [v11 recordID];
    v13 = [v12 recordName];
    v14 = v13;
    v15 = &stru_283CF9D50;
    *buf = 138412802;
    v76 = v9;
    if (v13)
    {
      v15 = v13;
    }

    v77 = 2112;
    v78 = v10;
    v79 = 2112;
    v80 = v15;
    _os_signpost_emit_with_name_impl(&dword_229538000, v8, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "AddMediaAccessoryModel", "Identifier=%{signpost.description:attribute}@ parentUUID=%{signpost.description:attribute}@ recordName=%{signpost.description:attribute}@ ", buf, 0x20u);
  }

  v16 = objc_autoreleasePoolPush();
  v17 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    v20 = [v6 uuid];
    *buf = 138543618;
    v76 = v19;
    v77 = 2112;
    v78 = v20;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Creating new media accessory from model with UUID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v16);
  v21 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v22 = v21;
  }

  else
  {
    v22 = 0;
  }

  v23 = v22;

  v24 = v21;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v25 = v24;
  }

  else
  {
    v25 = 0;
  }

  v26 = v25;

  if (v23)
  {
    v27 = [[HMDAppleMediaAccessory alloc] initWithTransaction:v23 home:v17];
    v28 = 0;
    if (!v27)
    {
      goto LABEL_31;
    }

    goto LABEL_18;
  }

  if (v26)
  {
    v29 = [[HMDAirPlayAccessory alloc] initWithTransaction:v26 home:v17];
    v28 = [(HMDHome *)v17 isCurrentDevicePrimaryResident];
    v30 = [(HMDHome *)v17 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke;
    block[3] = &unk_27868A750;
    block[4] = v17;
    v27 = v29;
    v73 = v27;
    dispatch_async(v30, block);

    if (!v27)
    {
      goto LABEL_31;
    }

LABEL_18:
    v62 = v26;
    v63 = v24;
    v31 = v27;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v33 = v31;
    }

    else
    {
      v33 = 0;
    }

    v34 = v33;

    [(HMDAppleMediaAccessory *)v34 setDataSource:v17];
    [(HMDHome *)v17 addAccessory:v31];
    v35 = [(HMDHome *)v17 homeManager];
    v36 = [(HMDAccessory *)v31 uuid];
    v37 = [v35 accessorySetupMetricDispatcherForAccessoryUUID:v36];

    [v37 markAccessoryAddCompleted];
    v38 = [(HMDHome *)v17 _hasConfirmedPrimaryResidentDevice];

    if (v38)
    {
      [v37 markPrimaryResidentChanged];
      v39 = [(HMDHome *)v17 remoteEventRouterClientController];
      v40 = [v39 isPrimaryResidentClientConnected];

      if (v40)
      {
        [v37 markEventRouterPrimaryClientConnectStatusChanged:1];
      }
    }

    v60 = v37;
    v41 = dispatch_group_create();
    v42 = [(HMDHome *)v17 msgDispatcher];
    [(HMDAppleMediaAccessory *)v31 configureWithHome:v17 msgDispatcher:v42 configurationTracker:v41 initialConfiguration:0];

    v43 = [(HMDHome *)v17 homeManager];
    if ((isKindOfClass & 1) != 0 && [(HMDAppleMediaAccessory *)v31 isCurrentAccessory])
    {
      v44 = [v43 currentAccessorySetupMetricDispatcher];
      [v44 markSetupBeginStage:7 error:0];
    }

    v74 = v31;
    v45 = [MEMORY[0x277CBEA60] arrayWithObjects:&v74 count:{1, v60}];
    v46 = [v7 identifier];
    [(HMDHome *)v17 addNewlyConfiguredAccessories:v45 addSessionIdentifier:v46];

    v47 = [v7 transactionResult];
    [v47 markChanged];
    [v47 markSaveToAssistant];
    v48 = [(HMDHome *)v17 workQueue];
    v64[0] = MEMORY[0x277D85DD0];
    v64[1] = 3221225472;
    v64[2] = __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke_1465;
    v64[3] = &unk_2786834F8;
    v64[4] = v17;
    v65 = v31;
    v66 = v7;
    v67 = v23;
    v68 = v34;
    v71 = v28;
    v69 = v43;
    v70 = v47;
    v49 = v23;
    v50 = v47;
    v51 = v43;
    v52 = v34;
    v53 = v31;
    dispatch_group_notify(v41, v48, v64);

    v23 = v49;
    v26 = v62;
    v24 = v63;
    goto LABEL_31;
  }

  v54 = objc_autoreleasePoolPush();
  v55 = v17;
  v56 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v56, OS_LOG_TYPE_DEFAULT))
  {
    v57 = HMFGetLogIdentifier();
    *buf = 138543618;
    v76 = v57;
    v77 = 2112;
    v78 = v24;
    _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_DEFAULT, "%{public}@Invalid WHA accessory: %@", buf, 0x16u);

    v23 = 0;
  }

  objc_autoreleasePoolPop(v54);
LABEL_31:
  v58 = HMFGetOSLogHandle();
  if (os_signpost_enabled(v58))
  {
    *buf = 0;
    _os_signpost_emit_with_name_impl(&dword_229538000, v58, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "AddMediaAccessoryModel", "", buf, 2u);
  }

  v59 = *MEMORY[0x277D85DE8];
}

uint64_t __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 40) shortDescription];
    v11 = 138543618;
    v12 = v5;
    v13 = 2112;
    v14 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Going to schedule key roll operation for device if necessary for airplay accessory: %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = [*(a1 + 32) homeManager];
  v8 = [v7 bgOpsManager];
  [v8 scheduleHH2KeyRollForAirPlayAccessory:*(a1 + 40)];

  result = [HMDBackgroundOperationManagerHelper auditSharedUserEntriesInDatabaseForAccessory:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];
  return result;
}

void __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke_1465(uint64_t a1)
{
  v83 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessoryBrowser];
  v3 = [*(a1 + 40) identifier];
  [v2 registerPairedAccessory:v3 transports:objc_msgSend(*(a1 + 40) setupHash:"supportedTransports") delegate:{0, *(a1 + 32)}];

  v70 = 0u;
  v71 = 0u;
  v68 = 0u;
  v69 = 0u;
  v4 = [*(a1 + 32) accessoryBrowser];
  v5 = [v4 mediaBrowser];
  v6 = [v5 accessoryAdvertisements];

  v7 = [v6 countByEnumeratingWithState:&v68 objects:v82 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v69;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v69 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v68 + 1) + 8 * i);
        v12 = [v11 identifier];
        v13 = [*(a1 + 40) identifier];
        v14 = [v12 isEqualToString:v13];

        if (v14)
        {
          [*(a1 + 40) addAdvertisement:v11];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v68 objects:v82 count:16];
    }

    while (v8);
  }

  [*(a1 + 32) _reachabilityChangedForAccessory:*(a1 + 40) reachable:{objc_msgSend(*(a1 + 40), "isReachable")}];
  if ([*(a1 + 32) remoteAccessIsEnabled])
  {
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 32);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [*(a1 + 40) name];
      *buf = 138543618;
      *&buf[4] = v18;
      v76 = 2112;
      v77 = v19;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ setting remote access enabled", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    [*(a1 + 40) remoteAccessEnabled:1];
  }

  v20 = [*(a1 + 48) transactionResult];
  v21 = [v20 source];

  v22 = objc_autoreleasePoolPush();
  v23 = *(a1 + 32);
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
  {
    v25 = HMFGetLogIdentifier();
    v26 = [*(a1 + 40) shortDescription];
    [*(a1 + 32) isCurrentDeviceConfirmedPrimaryResident];
    v27 = HMFBooleanToString();
    *buf = 138544130;
    *&buf[4] = v25;
    v76 = 2112;
    v77 = v26;
    v78 = 2048;
    v79 = v21;
    v80 = 2112;
    v81 = v27;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Apple media accessory %@ being added to home - source %tu. IsPrimary: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v22);
  if (*(a1 + 56) && [*(a1 + 40) isCurrentAccessory])
  {
    v28 = objc_autoreleasePoolPush();
    v29 = *(a1 + 32);
    v30 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
    {
      v31 = HMFGetLogIdentifier();
      v32 = *(a1 + 40);
      *buf = 138543618;
      *&buf[4] = v31;
      v76 = 2112;
      v77 = v32;
      _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Setting up media session for current accessory during add - %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v28);
    v33 = [*(a1 + 32) _addMediaSessionForCurrentAccessory:*(a1 + 40)];
  }

  v34 = *(a1 + 64);
  if (v34)
  {
    [v34 configureAudioDestinationController];
    if ([*(a1 + 64) isCurrentAccessory])
    {
      v35 = [*(a1 + 32) accessoryBrowser];
      [v35 resetUnassociatedCurrentAccessory];

      [*(a1 + 32) createRemoteEventRouterServerIfNeeded];
      v36 = [*(a1 + 32) notificationCenter];
      v37 = *(a1 + 32);
      v38 = *(a1 + 64);
      v73 = @"HMDAccessoryNotificationKey";
      v74 = v38;
      v39 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v74 forKeys:&v73 count:1];
      [v36 postNotificationName:@"HMDHomeManagerDidAddCurrentAccessoryNotification" object:v37 userInfo:v39];

      v40 = [*(a1 + 72) currentAccessorySetupMetricDispatcher];
      [v40 markSetupEndStage:7 error:0];
    }

    v41 = *(a1 + 32);
    v72 = *(a1 + 64);
    v42 = [MEMORY[0x277CBEA60] arrayWithObjects:&v72 count:1];
    [v41 configureRemoteEventRouterClientControllerForAccessories:v42];

    v43 = [*(a1 + 32) capabilitiesAggregator];
    v44 = [*(a1 + 64) uuid];
    [v43 didAddAccessory:v44];

    v45 = *(a1 + 32);
    v46 = *(a1 + 64);
    v47 = v46;
    if (v45 && [v46 isHomePod] && objc_msgSend(v45, "isCurrentDevicePrimaryResident"))
    {
      v48 = [v45 fetchedAccessorySettingsSubscriber];
      v49 = [v47 uuid];
      *buf = v49;
      v50 = [MEMORY[0x277CBEA60] arrayWithObjects:buf count:1];
      [v48 subscribeToSettingsForAccessoryUUIDs:v50];
    }

    v51 = [*(a1 + 32) notificationRegistrationsForAppleMediaAccessories];
    v52 = [v51 count];

    if (v52)
    {
      v53 = [*(a1 + 32) mediaStateSubscriber];
      [v53 subscribeForAppleMediaStateForAccessory:*(a1 + 64) subscriptionToken:@"HMDHomeClientMediaStateRegistrationToken"];
    }

    v54 = [*(a1 + 32) mediaStateSubscriber];
    [v54 localSubscribeForAppleMediaStateForAccessory:*(a1 + 64)];
  }

  if ([*(a1 + 40) isCurrentAccessory])
  {
    v55 = objc_autoreleasePoolPush();
    v56 = *(a1 + 32);
    v57 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
    {
      v58 = HMFGetLogIdentifier();
      *buf = 138543362;
      *&buf[4] = v58;
      _os_log_impl(&dword_229538000, v57, OS_LOG_TYPE_INFO, "%{public}@Notifying that we are a reachable accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v55);
    v59 = [*(a1 + 32) notificationCenter];
    [v59 postNotificationName:@"HMDHomeCurrentDeviceHasReachableAccessories" object:*(a1 + 32)];

    v60 = *(a1 + 64);
    if (v60)
    {
      [v60 configureSensors];
    }
  }

  if (*(a1 + 88) == 1)
  {
    v61 = [*(a1 + 32) residentDeviceManager];
    [v61 confirmWithCompletionHandler:0];
  }

  v62 = *(a1 + 32);
  v63 = [*(a1 + 48) identifier];
  v64 = [v62 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v63];

  if ([*(a1 + 80) source] == 1)
  {
    [*(a1 + 32) _notifyClientOfNewlyAddedAccessories:v64 requestMessage:*(a1 + 48)];
    [*(a1 + 32) notifyOfNewlyAddedAccessoryByThisOwnerDevice:*(a1 + 40)];
  }

  else
  {
    [*(a1 + 48) respondWithPayload:0];
  }

  v65 = [*(a1 + 32) accessoryBrowser];
  v66 = [*(a1 + 40) identifier];
  [v65 removeUnassociatedAccessoryWithIdentifier:v66];

  [*(a1 + 32) notifyOfAddedAccessory:*(a1 + 40)];
  v67 = *MEMORY[0x277D85DE8];
}

- (void)__handleAddHAPAccessoryModel:(id)a3 message:(id)a4
{
  v95 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 supportsNativeMatter];
  v9 = [v8 BOOLValue];

  if (!v9)
  {
    v10 = [v6 bridgeUUID];
    if (!v10)
    {
      goto LABEL_5;
    }

    v11 = objc_alloc(MEMORY[0x277CCAD78]);
    v12 = [v6 bridgeUUID];
    v13 = [v11 initWithUUIDString:v12];
    v14 = [(HMDHome *)self accessoryWithUUID:v13];

    if (!v14)
    {
      v56 = objc_autoreleasePoolPush();
      v57 = self;
      v58 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v59 = HMFGetLogIdentifier();
        v60 = [v6 bridgeUUID];
        v61 = [v6 uuid];
        *buf = 138543874;
        v86 = v59;
        v87 = 2112;
        v88 = v60;
        v89 = 2112;
        v90 = v61;
        _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_ERROR, "%{public}@No bridge accessory %@ for added bridged accessory %@", buf, 0x20u);
      }
    }

    else
    {
LABEL_5:
      v15 = [v6 hostAccessoryUUID];
      if (!v15)
      {
        goto LABEL_7;
      }

      v16 = objc_alloc(MEMORY[0x277CCAD78]);
      v17 = [v6 hostAccessoryUUID];
      v18 = [v16 initWithUUIDString:v17];
      v19 = [(HMDHome *)self accessoryWithUUID:v18];

      if (v19)
      {
LABEL_7:
        v20 = objc_autoreleasePoolPush();
        v21 = self;
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          v23 = HMFGetLogIdentifier();
          v24 = [v6 uuid];
          v25 = [v6 name];
          v26 = [v6 uniqueIdentifier];
          v27 = [v7 shortDescription];
          *buf = 138544386;
          v86 = v23;
          v87 = 2112;
          v88 = v24;
          v89 = 2112;
          v90 = v25;
          v91 = 2112;
          v92 = v26;
          v93 = 2112;
          v94 = v27;
          _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_INFO, "%{public}@Creating new HAP accessory from model with UUID %@/%@/%@ from message: %@", buf, 0x34u);
        }

        objc_autoreleasePoolPop(v20);
        v28 = [[HMDHAPAccessory alloc] initWithTransaction:v6 home:v21];
        if (v28)
        {
          v29 = [v6 configurationTracker];
          if (!v29)
          {
            v29 = dispatch_group_create();
          }

          v30 = [(HMDHome *)v21 notificationRegistrations];
          v31 = [v30 count];
          v32 = v31 != 0;

          v33 = [(HMDHome *)v21 uuidToHAPAccessoryConfigTable];
          v34 = [v6 uuid];
          v35 = [v33 objectForKey:v34];

          if (v35)
          {
            v36 = [(HMDHome *)v21 uuidToHAPAccessoryConfigTable];
            v37 = [v6 uuid];
            [v36 removeObjectForKey:v37];

            dispatch_group_enter(v29);
            v38 = [(HMDHome *)v21 workQueue];
            v82[0] = MEMORY[0x277D85DD0];
            v82[1] = 3221225472;
            v82[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke;
            v82[3] = &unk_27868A728;
            v83 = v29;
            [(HMDHAPAccessory *)v28 configureWithAccessory:v35 homeNotificationsEnabled:v31 != 0 queue:v38 completion:v82];
          }

          if ([(HMDHAPAccessory *)v28 isPrimary])
          {
            v39 = [v7 name];
            v40 = [v39 isEqualToString:*MEMORY[0x277CD2070]];

            if ((v40 & 1) == 0)
            {
              [(HMDHAPAccessory *)v28 savePublicKeyToKeychain];
            }

            v41 = [(HMDAccessory *)v28 identifier];
            v42 = [(HMDHAPAccessory *)v28 supportedTransports];
            v43 = [(HMDHAPAccessory *)v28 setupHash];
            [(HMDHome *)v21 _registerPairedAccessory:v41 transports:v42 setupHash:v43];
          }

          [(HMDHome *)v21 addAccessory:v28];
          v44 = [(HMDHome *)v21 msgDispatcher];
          [(HMDHAPAccessory *)v28 configureWithHome:v21 msgDispatcher:v44 configurationTracker:v29 initialConfiguration:0];

          v84 = v28;
          v45 = [MEMORY[0x277CBEA60] arrayWithObjects:&v84 count:1];
          v46 = [v7 identifier];
          [(HMDHome *)v21 addNewlyConfiguredAccessories:v45 addSessionIdentifier:v46];

          v47 = [(HMDHome *)v21 accessoryBrowser];
          [v47 evaluateAccessoryDiscoveryState];

          v48 = [(HMDHAPAccessory *)v28 matterNodeID];
          if (v48)
          {
            v49 = [(HMDHAPAccessory *)v28 matterNodeID];
            v50 = [v49 isEqual:&unk_283E71A20];

            if ((v50 & 1) == 0)
            {
              if ((isFeatureMatteriPhoneOnlyPairingControlEnabled() & 1) != 0 || (-[HMDHome featuresDataSource](v21, "featuresDataSource"), v51 = objc_claimAutoreleasedReturnValue(), v52 = [v51 isRVCEnabled], v51, v52))
              {
                objc_initWeak(buf, v21);
                v79[0] = MEMORY[0x277D85DD0];
                v79[1] = 3221225472;
                v79[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1460;
                v79[3] = &unk_278687540;
                objc_copyWeak(&v81, buf);
                v80 = v28;
                [(HMDHome *)v21 setUpSharedUserFabricDataWithForceFetch:0 completion:v79];

                objc_destroyWeak(&v81);
                objc_destroyWeak(buf);
              }
            }
          }

          v53 = [v7 transactionResult];
          [v53 markChanged];
          [v53 markSaveToAssistant];
          v54 = [(HMDHome *)v21 workQueue];
          block[0] = MEMORY[0x277D85DD0];
          block[1] = 3221225472;
          block[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_2;
          block[3] = &unk_2786899C8;
          block[4] = v21;
          v75 = v28;
          v76 = v7;
          v77 = v35;
          v78 = v32;
          v55 = v35;
          dispatch_group_notify(v29, v54, block);
        }

        else
        {
          v62 = objc_autoreleasePoolPush();
          v63 = v21;
          v64 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v64, OS_LOG_TYPE_ERROR))
          {
            v65 = HMFGetLogIdentifier();
            v66 = [v6 uuid];
            v67 = [v66 UUIDString];
            *buf = 138543618;
            v86 = v65;
            v87 = 2112;
            v88 = v67;
            _os_log_impl(&dword_229538000, v64, OS_LOG_TYPE_ERROR, "%{public}@Unable to create accessory from object (null accessory) %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v62);
          v68 = [v7 responseHandler];
          v69 = v68 == 0;

          if (v69)
          {
            goto LABEL_32;
          }

          v29 = [v7 responseHandler];
          v53 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
          (*(v29 + 16))(v29, v53, 0);
        }

LABEL_32:
        goto LABEL_36;
      }

      v56 = objc_autoreleasePoolPush();
      v57 = self;
      v58 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v70 = HMFGetLogIdentifier();
        v71 = [v6 hostAccessoryUUID];
        v72 = [v6 uuid];
        *buf = 138543874;
        v86 = v70;
        v87 = 2112;
        v88 = v71;
        v89 = 2112;
        v90 = v72;
        _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_ERROR, "%{public}@No host accessory %@ for added hosted accessory %@", buf, 0x20u);
      }
    }

    objc_autoreleasePoolPop(v56);
    goto LABEL_36;
  }

  [(HMDHome *)self handleAddMatterAccessoryModel:v6 message:v7];
LABEL_36:

  v73 = *MEMORY[0x277D85DE8];
}

void __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1460(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v2 = [WeakRetained homeManager];
  v3 = [v2 accessoryBrowser];
  v4 = [v3 chipAccessoryServerBrowser];
  v5 = [*(a1 + 32) matterNodeID];
  v6 = [WeakRetained targetFabricUUID];
  [v4 handleHomeAddedAccessoryWithNodeID:v5 fabricUUID:v6 localControl:{objc_msgSend(WeakRetained, "isCurrentDevicePrimaryResident")}];
}

void __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_2(uint64_t a1)
{
  v46 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) remoteAccessIsEnabled])
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 32);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 40) shortDescription];
      *buf = 138543618;
      *&buf[4] = v5;
      v42 = 2112;
      v43 = v6;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@accessory %@ setting remote access enabled", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) remoteAccessEnabled:1];
  }

  [*(a1 + 32) _reachabilityChangedForAccessory:*(a1 + 40) reachable:{objc_msgSend(*(a1 + 40), "isReachable")}];
  v7 = [*(a1 + 48) transactionResult];
  v8 = [v7 source];

  if ([*(a1 + 40) isPrimary])
  {
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [*(a1 + 40) shortDescription];
      v14 = *(a1 + 56);
      *buf = 138543874;
      *&buf[4] = v12;
      v42 = 2112;
      v43 = v13;
      v44 = 2112;
      v45 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@accessory %@ handling added primary HAPAccessory: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    if (!*(a1 + 56))
    {
      v15 = [*(a1 + 40) identifier];
      *buf = 0;
      [*(a1 + 40) matchesHAPAccessoryWithServerIdentifier:v15 linkType:buf];
      v16 = [*(a1 + 32) accessoryBrowser];
      [v16 handleNewlyPairedAccessory:v15 linkType:*buf];

      isWatch();
      [*(a1 + 32) __requestAccessoryBrowsing];
    }

    v17 = [*(a1 + 32) accessoryBrowser];
    v18 = [*(a1 + 40) identifier];
    [v17 removeUnassociatedAccessoryWithIdentifier:v18];

    v19 = [*(a1 + 32) networkProtectionGroupRegistry];
    [v19 handleAddedAccessory:*(a1 + 40)];
  }

  v20 = *(a1 + 56);
  if (v20)
  {
    [*(a1 + 40) enableNotificationsWithHAPAccessory:v20 homeNotificationsEnabled:*(a1 + 64)];
  }

  else if (*(a1 + 64) == 1)
  {
    v21 = *(a1 + 32);
    v40 = *(a1 + 40);
    v22 = [MEMORY[0x277CBEA60] arrayWithObjects:&v40 count:1];
    [v21 _subscribeForHomeNotificationsFromRemoteGateway:1 accessories:v22];
  }

  if (*(a1 + 56))
  {
    logAndPostNotification(@"HMDAccessoryConnectedNotification", *(a1 + 40), 0);
    [*(a1 + 40) updateLightProfilesSettings];
  }

  v23 = [*(a1 + 48) name];
  if ([v23 isEqualToString:*MEMORY[0x277CD2070]])
  {
  }

  else
  {
    v24 = [*(a1 + 48) name];
    v25 = [v24 isEqualToString:@"HMDRemoteAddHAPAccessoriesMessage"];

    if ((v25 & 1) == 0)
    {
      v26 = *(a1 + 32);
      v27 = [*(a1 + 48) identifier];
      v28 = [v26 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v27];

      [*(a1 + 48) respondWithPayload:0];
    }
  }

  if (v8 == 1)
  {
    [*(a1 + 32) notifyOfNewlyAddedAccessoryByThisOwnerDevice:*(a1 + 40)];
  }

  [*(a1 + 32) notifyOfAddedAccessory:*(a1 + 40)];
  [*(a1 + 32) reevaluateAccessoryInfo];
  v29 = [*(a1 + 40) supportsAdaptiveTemperatureAutomations];
  v30 = [v29 BOOLValue];

  if (v30)
  {
    v31 = objc_autoreleasePoolPush();
    v32 = *(a1 + 32);
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543362;
      *&buf[4] = v34;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - accessory added", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v31);
    [*(a1 + 32) configureUserActivityStateDetectorManager];
  }

  if ([*(a1 + 40) isPrimary])
  {
    v35 = [*(a1 + 32) workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1461;
    block[3] = &unk_27868A750;
    v36 = *(a1 + 40);
    block[4] = *(a1 + 32);
    v39 = v36;
    dispatch_async(v35, block);
  }

  v37 = *MEMORY[0x277D85DE8];
}

uint64_t __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1461(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 40) shortDescription];
    v11 = 138543618;
    v12 = v5;
    v13 = 2112;
    v14 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Going to schedule key roll operation for device if necessary for accessory: %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = [*(a1 + 32) homeManager];
  v8 = [v7 bgOpsManager];
  [v8 scheduleHH2KeyRollForAccessory:*(a1 + 40)];

  result = [HMDBackgroundOperationManagerHelper auditSharedUserEntriesInDatabaseForAccessory:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)__requestAccessoryBrowsing
{
  v2 = [(HMDHome *)self homeManager];
  [v2 setAccessoryBrowsingRequested];
  [v2 requestAccessoryBrowsing];
}

- (void)_handleAddAccessoryModel:(id)a3 message:(id)a4
{
  v32 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v6;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;
  v10 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v10;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;

  v13 = [v10 identifier];

  if (!v13)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v10 uuid];
      v19 = [v18 UUIDString];
      v28 = 138543618;
      v29 = v17;
      v30 = 2112;
      v31 = v19;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Unable to create accessory from object (null identifier) %@", &v28, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v7 respondWithError:v20];
    goto LABEL_13;
  }

  if (v9)
  {
    [(HMDHome *)self __handleAddHAPAccessoryModel:v9 message:v7];
    goto LABEL_16;
  }

  if (v12)
  {
    [(HMDHome *)self __handleAddMediaAccessoryModel:v12 message:v7];
    goto LABEL_16;
  }

  v22 = objc_autoreleasePoolPush();
  v23 = self;
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
  {
    v25 = HMFGetLogIdentifier();
    v28 = 138543362;
    v29 = v25;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Only HAP accessories can be added to the home currently", &v28, 0xCu);
  }

  objc_autoreleasePoolPop(v22);
  v26 = [v7 responseHandler];

  if (v26)
  {
    v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    v27 = [v7 responseHandler];
    (v27)[2](v27, v20, 0);

LABEL_13:
  }

LABEL_16:

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserConsentResponseForAccessory:(id)a3
{
  v35 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSPIAccess])
  {
    v5 = [v4 dataForKey:*MEMORY[0x277CD1F90]];
    v30 = 0;
    v6 = [(HMDHome *)self _setupDescriptionFromData:v5 error:&v30];
    v7 = v30;
    if (v6)
    {
      v8 = [v4 numberForKey:*MEMORY[0x277CD06B0]];
      if (v8)
      {
        v9 = [(HMDHome *)self addPendingAccessories];
        v10 = [v9 objectForKey:v6];

        v11 = [v8 integerValue];
        if (v11 > 1)
        {
          if ((v11 & 0xFFFFFFFFFFFFFFFELL) == 2)
          {
            [(HMDHome *)self _handleUserConsentForAccessoryReplacement:v6 consent:v11 == 3 message:v10];
          }

          else
          {
            v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];

            v7 = v26;
          }
        }

        else
        {
          v12 = v11 == 1;
          v13 = [(HMDHome *)self accessoryBrowser];
          [v13 didReceiveUserConsentResponseForSetupAccessoryDetail:v6 consent:v12];
        }

        v27 = [v4 responseHandler];

        if (v27)
        {
          v28 = [v4 responseHandler];
          (v28)[2](v28, v7, 0);
        }
      }

      else
      {
        v22 = objc_autoreleasePoolPush();
        v23 = self;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          *buf = 138543362;
          v32 = v25;
          _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@user consent response is absent", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v22);
      }
    }

    else
    {
      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543618;
        v32 = v21;
        v33 = 2112;
        v34 = v7;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v32 = v17;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI for user consent response", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserConsentForAccessoryReplacement:(id)a3 consent:(BOOL)a4 message:(id)a5
{
  v36 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_INFO);
  if (a4)
  {
    if (v13)
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v9 name];
      v16 = [v9 identifier];
      v17 = [v9 messagePayload];
      v28 = 138544130;
      v29 = v14;
      v30 = 2112;
      v31 = v15;
      v32 = 2112;
      v33 = v16;
      v34 = 2112;
      v35 = v17;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@User consented to Wi-Fi router replacement; continue to adding new Wi-Fi router - message %@/%@/%@", &v28, 0x2Au);
    }

    objc_autoreleasePoolPop(v10);
    [v8 setUserConsentedForReplace:1];
    v18 = [v8 accessoryUUID];

    if (v18)
    {
      v19 = [v8 accessoryUUID];
      [(HMDHome *)v11 _continuePairingAfterUserConsentWithAccessoryUUID:v19 orUnassociatedAccessory:0 message:v9];
    }

    else
    {
      [(HMDHome *)v11 _continuePairingAfterUserConsentWithAccessoryDescription:v8 progressHandlerDelegate:0 message:v9];
    }
  }

  else
  {
    if (v13)
    {
      v20 = HMFGetLogIdentifier();
      v21 = [v9 name];
      v22 = [v9 identifier];
      v23 = [v9 messagePayload];
      v28 = 138544130;
      v29 = v20;
      v30 = 2112;
      v31 = v21;
      v32 = 2112;
      v33 = v22;
      v34 = 2112;
      v35 = v23;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@User did not consent to Wi-Fi router replacement; cancelling adding new Wi-Fi router - message %@/%@/%@", &v28, 0x2Au);
    }

    objc_autoreleasePoolPop(v10);
    v24 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:1091];
    v25 = [HMDMatterAccessoryPairingEndContext hmContextWithCancelledError:v24];
    [(HMDHome *)v11 _cancelPairingWithAccessoryDescription:v8 context:v25];

    v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    [v9 respondWithError:v26];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_performRemoteAddHAPAccessories:(id)a3
{
  v44 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 shortDescription];
    *buf = 138543618;
    *&buf[4] = v8;
    v42 = 2112;
    v43 = v9;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@performRemoteAddHAPAccessories: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [v4 messagePayload];
  v11 = [v10 objectForKey:@"HMDSerializedAccessoriesMessageKey"];

  if (v11)
  {
    v12 = [HMDStructuredReader readerFromObjectWithExtendedTypes:v11];
    v13 = HMDRemoteAddCodingModel();
    v14 = [v13 decodeRootObjectFromReader:v12];

    if (v14)
    {
      v15 = [v4 dictionaryForKey:@"HMDUpdatedHomeInfoMessageKey"];
      v16 = objc_alloc(MEMORY[0x277D0F7A8]);
      v17 = [(HMDHome *)v6 workQueue];
      v18 = [v16 initWithQueue:v17];

      v19 = [(HMDHome *)v6 wiFiRouterAccessories];
      *buf = _HMFThreadLocalAsyncContextPush();
      v20 = [(HMDHome *)v6 _addAccessoriesUsingPrimaryAccessoryModel:v14 updatedHomeInfo:v15 message:v4];
      v37[0] = MEMORY[0x277D85DD0];
      v37[1] = 3221225472;
      v37[2] = __43__HMDHome__performRemoteAddHAPAccessories___block_invoke;
      v37[3] = &unk_278686878;
      v37[4] = v6;
      v21 = v4;
      v38 = v21;
      v22 = v19;
      v39 = v22;
      v40 = v14;
      v23 = [v20 then:v37];
      v35[0] = MEMORY[0x277D85DD0];
      v35[1] = 3221225472;
      v35[2] = __43__HMDHome__performRemoteAddHAPAccessories___block_invoke_2;
      v35[3] = &unk_278689CD8;
      v36 = v21;
      v24 = [v23 recover:v35];

      _HMFThreadLocalAsyncContextPop();
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      v30 = v6;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        v33 = [v12 error];
        *buf = 138543618;
        *&buf[4] = v32;
        v42 = 2112;
        v43 = v33;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Failed to deserialize accessories in remote add request: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v29);
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v4 respondWithError:v15];
    }
  }

  else
  {
    v25 = objc_autoreleasePoolPush();
    v26 = v6;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543362;
      *&buf[4] = v28;
      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Received a nil serialized accessories value in remote add message payload", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v25);
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [v4 respondWithError:v12];
  }

  v34 = *MEMORY[0x277D85DE8];
}

uint64_t __43__HMDHome__performRemoteAddHAPAccessories___block_invoke(uint64_t a1, void *a2)
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = *(a1 + 32);
  v5 = [*(a1 + 40) identifier];
  v6 = [v4 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v5];

  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [*(a1 + 40) shortDescription];
    *buf = 138543874;
    v35 = v10;
    v36 = 2112;
    v37 = v6;
    v38 = 2112;
    v39 = v11;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Retrieved and reset newly configured accessories: %@. Message: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  [*(a1 + 32) _setupActiveNetworkRouterAccessory:v6 existingRouterAccessories:*(a1 + 48)];
  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  v12 = v6;
  v13 = [v12 countByEnumeratingWithState:&v29 objects:v33 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v30;
    do
    {
      v16 = 0;
      do
      {
        if (*v30 != v15)
        {
          objc_enumerationMutation(v12);
        }

        v17 = *(*(&v29 + 1) + 8 * v16);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v18 = v17;
        }

        else
        {
          v18 = 0;
        }

        v19 = v18;

        [v19 autoConfigureTargetController];
        ++v16;
      }

      while (v14 != v16);
      v14 = [v12 countByEnumeratingWithState:&v29 objects:v33 count:16];
    }

    while (v14);
  }

  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __43__HMDHome__performRemoteAddHAPAccessories___block_invoke_1451;
  v27[3] = &unk_278677308;
  v28 = *(a1 + 56);
  v20 = [v12 hmf_objectPassingTest:v27];
  if ([v20 requiresWaitingToBecomeReachableAfterRemoteAdd])
  {
    v21 = [HMDRemotelyAddedAccessoryReachabilityObserver alloc];
    v22 = *(a1 + 40);
    v23 = [*(a1 + 32) workQueue];
    v24 = [(HMDRemotelyAddedAccessoryReachabilityObserver *)v21 initWithAccessory:v20 message:v22 workQueue:v23];

    [(HMDRemotelyAddedAccessoryReachabilityObserver *)v24 start];
  }

  else
  {
    [*(a1 + 40) respondWithSuccess];
  }

  v25 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __43__HMDHome__performRemoteAddHAPAccessories___block_invoke_1451(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [*(a1 + 32) modelID];
  v5 = [v3 isEqual:v4];

  return v5;
}

- (void)_handleRemoteAddHAPAccessories:(id)a3
{
  v4 = a3;
  [(HMDHome *)self updateCATIDForUsersIfNeeded:1];
  v5 = [(HMDHome *)self residentSyncManager];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __42__HMDHome__handleRemoteAddHAPAccessories___block_invoke;
  v6[3] = &unk_27868A398;
  v6[4] = self;
  [v5 interceptRemoteResidentRequest:v4 proceed:v6];
}

- (void)_pairAccessoryWithAccessoryDescription:(id)a3 configuration:(id)a4 pairingEvent:(id)a5 progressHandler:(id)a6 requestMessage:(id)a7
{
  v12 = a6;
  v13 = a4;
  v14 = a3;
  v16 = __createAccessoryBrowserAddAccessoryCompletionHandler(self, v14, v13, a5, a7);
  v15 = [(HMDHome *)self accessoryBrowser];
  [v15 pairAccessoryWithDescription:v14 configuration:v13 progressHandler:v12 completionHandler:v16];
}

- (void)_continuePairingAfterUserConsentWithAccessoryDescription:(id)a3 progressHandlerDelegate:(id)a4 message:(id)a5
{
  v59 = *MEMORY[0x277D85DE8];
  v9 = a3;
  v42 = a4;
  v43 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543618;
    *&buf[4] = v13;
    *&buf[12] = 2112;
    *&buf[14] = v9;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Continue pairing after user consent with accessoryDescription %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  v14 = objc_alloc_init(HMDUnpairedHAPAccessoryConfiguration);
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setRequiresUserConsent:1];
  v15 = [(HMDHome *)v11 homeLocationHandler];
  v16 = [v15 isoCountryCode];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setIsoCountryCode:v16];

  v17 = [(HMDHome *)v11 matterFabricID];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setChipFabricID:v17];

  v18 = [(HMDHome *)v11 uuid];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setHomeUUID:v18];

  v19 = [HMDAccessoryPairingEvent pairingAccessoryWithDescription:v9 home:v11];
  if ([v19 isMatterAccessory])
  {
    notifyMatterMetricPairingStep(v11, 2uLL);
  }

  v44 = [v9 setupAccessoryPayload];
  v20 = objc_alloc(MEMORY[0x277D0F770]);
  v21 = MEMORY[0x277CCACA8];
  v22 = MEMORY[0x22AAD2510](v11, a2);
  v23 = [v21 stringWithFormat:@"%@, %s:%ld", v22, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 12372];
  v24 = [v20 initWithName:v23];

  v45 = v24;
  [v9 accessoryUUID];

  [v44 categoryNumber];
  [v19 linkType];
  v25 = HAPLinkTypeDescription();
  [v19 communicationProtocol];
  v26 = HAPCommunicationProtocolDescription();
  [v44 supportsWAC];
  v27 = HMFBooleanToString();
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 requiresUserConsent];
  v28 = HMFBooleanToString();
  v29 = HMDNetworkRouterSupportAsString([(HMDHome *)v11 networkRouterSupport]);
  v30 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome networkRouterSupportDisableReason](v11, "networkRouterSupportDisableReason")}];
  [v9 appIdentifier];

  [v19 isThreadAccessory];
  v31 = HMFBooleanToString();

  if (v42)
  {
    v32 = v42;
    if (v11)
    {
      objc_initWeak(&location, v11);
      *buf = MEMORY[0x277D85DD0];
      *&buf[8] = 3221225472;
      *&buf[16] = __74__HMDHome_createLocalAddAccessoryProgressHandler_progressHandlerDelegate___block_invoke;
      v55 = &unk_27866FC88;
      objc_copyWeak(&v56[8], &location);
      *v56 = v32;
      v41 = _Block_copy(buf);

      objc_destroyWeak(&v56[8]);
      objc_destroyWeak(&location);
    }

    else
    {
      v41 = 0;
    }
  }

  else
  {
    v41 = HMDHomeCreateAddAccessoryProgressHandler(v11, v9, v43);
  }

  v33 = objc_autoreleasePoolPush();
  v34 = v11;
  v35 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
  {
    v36 = HMFGetLogIdentifier();
    [v9 supportsWAC];
    v37 = HMFBooleanToString();
    v38 = HMDNetworkRouterSupportAsString([(HMDHome *)v34 networkRouterSupport]);
    [(HMDHome *)v34 networkRouterSupportDisableReason];
    v39 = HMNetworkRouterSupportDisableReasonAsString();
    *buf = 138544386;
    *&buf[4] = v36;
    *&buf[12] = 2112;
    *&buf[14] = v9;
    *&buf[22] = 2112;
    v55 = v37;
    *v56 = 2112;
    *&v56[2] = v38;
    v57 = 2112;
    v58 = v39;
    _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_INFO, "%{public}@Adding unpaired accessory with description: %@, supports WAC: %@, network router support: %@ (Reason: %@)", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v33);
  if ([v9 supportsWAC] && (-[HMDHome networkRouterSupport](v34, "networkRouterSupport") & 8) != 0)
  {
    v46[0] = MEMORY[0x277D85DD0];
    v46[1] = 3221225472;
    v46[2] = __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke;
    v46[3] = &unk_27866FD78;
    v46[4] = v34;
    v47 = v45;
    v48 = v9;
    v49 = v19;
    v50 = v43;
    v51 = v14;
    v52 = v41;
    [(HMDHome *)v34 _createUniquePSKClientConfigurationWithRequestMessage:v50 pairingEvent:v49 completion:v46];
  }

  else
  {
    [v45 begin];
    *buf = v45;
    [(HMDHome *)v34 _pairAccessoryWithAccessoryDescription:v9 configuration:v14 pairingEvent:v19 progressHandler:v41 requestMessage:v43];
    __HMFActivityScopeLeave();
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke_2;
  block[3] = &unk_278681528;
  v11 = a1[5];
  v12 = a1[6];
  v13 = v6;
  v14 = a1[4];
  v15 = a1[7];
  v16 = a1[8];
  v17 = a1[9];
  v18 = v5;
  v19 = a1[10];
  v8 = v5;
  v9 = v6;
  dispatch_async(v7, block);
}

void __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke_2(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 40);
  v3 = *(a1 + 32);
  [v2 accessoryUUID];

  [*(a1 + 48) domain];
  [*(a1 + 48) code];

  v4 = *(a1 + 48) == 0;
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 56);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *v15 = 138543362;
      *&v15[4] = v13;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Client configuration with WiFi unique PSK created successfully", v15, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 80) setNetworkCredential:*(a1 + 88)];
    [*(a1 + 64) setUsedWiFiPPSK:1];
    [*(a1 + 32) begin];
    *v15 = *(a1 + 32);
    [*(a1 + 56) _pairAccessoryWithAccessoryDescription:*(a1 + 40) configuration:*(a1 + 80) pairingEvent:*(a1 + 64) progressHandler:*(a1 + 96) requestMessage:*(a1 + 72)];
    __HMFActivityScopeLeave();
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 40);
      v11 = *(a1 + 48);
      *v15 = 138543874;
      *&v15[4] = v9;
      v16 = 2112;
      v17 = v10;
      v18 = 2112;
      v19 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate WiFi credential for accessory %@ with error: %@", v15, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v12 = [*(a1 + 56) logEventSubmitter];
    [v12 submitLogEvent:*(a1 + 64) error:*(a1 + 48)];

    [*(a1 + 72) respondWithError:*(a1 + 48)];
    [*(a1 + 56) _removePendingAccessoryAdd:*(a1 + 40)];
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __74__HMDHome_createLocalAddAccessoryProgressHandler_progressHandlerDelegate___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v7 = objc_autoreleasePoolPush();
  v8 = WeakRetained;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = HMSetupAccessoryProgressAsString();
    v16 = 138543618;
    v17 = v10;
    v18 = 2112;
    v19 = v11;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Local add accessory progress handler called with progress: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  if (v8)
  {
    if (*(a1 + 32))
    {
      v12 = [v5 accessoryUUID];

      if (a2 == 6)
      {
        if (v12)
        {
          v13 = *(a1 + 32);
          v14 = [v5 accessoryUUID];
          [v13 localAccessoryAddRequiresConsent:v14];
        }
      }
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessoryWithDescription:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dataForKey:*MEMORY[0x277CD1F90]];
  v14 = 0;
  v6 = [(HMDHome *)self _setupDescriptionFromData:v5 error:&v14];
  v7 = v14;
  if (v6)
  {
    [(HMDHome *)&self->super.super.isa _handleAddAccessoryWithDescription:v6 progressHandlerDelegate:0 message:v4];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v16 = v11;
      v17 = 2112;
      v18 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v12];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessoryWithDescription:(void *)a3 progressHandlerDelegate:(void *)a4 message:
{
  v59 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = v9;
  if (a1)
  {
    if (([v9 isEntitledForSPIAccess] & 1) == 0)
    {
      v30 = objc_autoreleasePoolPush();
      v31 = a1;
      v32 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        v33 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v33;
        _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v30);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [v10 respondWithError:v16];
      goto LABEL_32;
    }

    v11 = [a1 accessories];
    v12 = [v11 count];
    v13 = maximumAccessoriesPerHome;

    if (v12 >= v13)
    {
      v34 = objc_autoreleasePoolPush();
      v35 = a1;
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
      {
        v37 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v37;
        _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_INFO, "%{public}@Can't add additional accessories; already at maximum accessories for home", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v34);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
      [v10 respondWithError:v16];
      goto LABEL_32;
    }

    v52 = 0;
    v14 = [a1 _shouldAllowAddingAccessoryWithDescription:v7 requestMessage:v10 error:&v52];
    v15 = v52;
    v16 = v15;
    if (v14)
    {
      goto LABEL_5;
    }

    v38 = [v15 domain];
    if ([v38 isEqualToString:*MEMORY[0x277CCFD28]])
    {
      v39 = [v16 code] == 97;

      if (v39)
      {
LABEL_5:
        v17 = [v7 appIdentifier];
        v18 = v17 == 0;

        if (v18)
        {
          v19 = [v10 clientIdentifier];
          v20 = v19;
          if (v19)
          {
            v21 = v19;
          }

          else
          {
            v21 = &stru_283CF9D50;
          }

          [v7 updateAppIdentifier:v21];
        }

        os_unfair_recursive_lock_lock_with_options();
        [a1[149] setObject:v10 forKey:v7];
        os_unfair_recursive_lock_unlock();
        v22 = [a1 accessoryBrowser];
        v23 = [v22 unpairedHAPAccessoryWithAccessoryDescription:v7];

        v24 = [v23 uuid];
        v25 = HMDHomeCreateAddAccessoryProgressHandler(a1, v7, v10);

        v26 = [a1 accessoryBrowser];
        v27 = [v23 uuid];
        [v26 registerProgressHandler:v25 unpairedAccessoryUUID:v27];

        if (v14)
        {
          v28 = [v7 accessoryUUID];

          if (v28)
          {
            v29 = [v7 accessoryUUID];
            [a1 _continuePairingAfterUserConsentWithAccessoryUUID:v29 orUnassociatedAccessory:0 message:v10];
          }

          else
          {
            [a1 _continuePairingAfterUserConsentWithAccessoryDescription:v7 progressHandlerDelegate:v8 message:v10];
          }
        }

        else
        {
          v40 = [v23 category];
          v41 = v40 == 0;

          if (v41)
          {
            v49 = [v7 setupAccessoryPayload];
            v42 = [v49 categoryNumber];
          }

          else
          {
            v42 = 0;
          }

          v50 = [[HMDAddAccessoryProgressState alloc] initWithUnpairedAccessory:v23 server:0 categoryIdentifier:v42 certificationStatus:0];
          (v25)[2](v25, 9, v50);
        }

LABEL_32:
        goto LABEL_33;
      }
    }

    else
    {
    }

    v43 = objc_autoreleasePoolPush();
    v44 = a1;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
    {
      v46 = HMFGetLogIdentifier();
      v47 = [v7 category];
      v48 = [v47 localizedDescription];
      *buf = 138543874;
      v54 = v46;
      v55 = 2112;
      v56 = v48;
      v57 = 2112;
      v58 = v16;
      _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_INFO, "%{public}@Cannot add an accessory of category '%@', error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v43);
    [v10 respondWithError:v16];
    goto LABEL_32;
  }

LABEL_33:

  v51 = *MEMORY[0x277D85DE8];
}

- (void)_addMediaAccessory:(id)a3 message:(id)a4
{
  v45 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (self && ([v6 identifier], v8 = objc_claimAutoreleasedReturnValue(), v9 = objc_msgSend(v8, "isEqualToString:", @"00000000-0000-0000-0000-C2EE6102B308"), v8, v9))
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v13;
      *&buf[12] = 2112;
      *&buf[14] = v6;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@The accessory %@ has an unknown media route identifier", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:9001];
    [v7 respondWithError:v14];
  }

  else
  {
    v35 = 0;
    v36 = &v35;
    v37 = 0x2020000000;
    v38 = 0;
    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v42 = __Block_byref_object_copy__14759;
    v43 = __Block_byref_object_dispose__14760;
    v44 = 0;
    v15 = [(HMDHome *)self appleMediaAccessories];
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __38__HMDHome__addMediaAccessory_message___block_invoke;
    v31[3] = &unk_27866FD50;
    v16 = v6;
    v32 = v16;
    v33 = &v35;
    v34 = buf;
    [v15 na_each:v31];

    if (v36[3] >= 1)
    {
      v17 = *(*&buf[8] + 40);
      if (v17)
      {
        [HMDHome _submitRemovalLogEventForAccessory:"_submitRemovalLogEventForAccessory:isLocalRemoval:isLocalFallback:isDuplicate:duplicateCount:error:" isLocalRemoval:v17 isLocalFallback:0 isDuplicate:0 duplicateCount:1 error:?];
      }
    }

    v18 = [(HMDHome *)self homeManager];
    v19 = [v16 uuid];
    v20 = [v18 accessorySetupMetricDispatcherForAccessoryUUID:v19];

    v21 = [v16 serialNumber];
    [v20 markRemoteAccessoryAddWillStart:v21];

    v22 = [(HMDHome *)self administratorHandler];
    LODWORD(v19) = [v22 shouldRelayMessages];

    if (v19)
    {
      v23 = objc_autoreleasePoolPush();
      v24 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        v26 = HMFGetLogIdentifier();
        *v39 = 138543362;
        v40 = v26;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@This is not the primary resident, so sending the add media accessory request to primary", v39, 0xCu);
      }

      objc_autoreleasePoolPop(v23);
      v28[0] = MEMORY[0x277D85DD0];
      v28[1] = 3221225472;
      v28[2] = __38__HMDHome__addMediaAccessory_message___block_invoke_1434;
      v28[3] = &unk_27868A010;
      v28[4] = v24;
      v29 = v16;
      v30 = v7;
      [(HMDHome *)v24 _remotelyAddMediaAccessory:v29 usingRemoteMessageName:@"HMDRemoteAddMediaAccessoryRequestMessage" message:v30 fallbackBlock:v28];
    }

    else
    {
      [(HMDHome *)self _locallyAddMediaAccessory:v16 message:v7];
    }

    _Block_object_dispose(buf, 8);
    _Block_object_dispose(&v35, 8);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__addMediaAccessory_message___block_invoke(uint64_t a1, void *a2)
{
  v7 = a2;
  if ([v7 isHomePod])
  {
    v4 = [*(a1 + 32) serialNumber];
    v5 = [v7 serialNumber];
    v6 = [v4 isEqualToString:v5];

    if (v6)
    {
      ++*(*(*(a1 + 40) + 8) + 24);
      objc_storeStrong((*(*(a1 + 48) + 8) + 40), a2);
    }
  }
}

- (void)_remotelyAddMediaAccessory:(void *)a3 usingRemoteMessageName:(void *)a4 message:(void *)a5 fallbackBlock:
{
  v73 = *MEMORY[0x277D85DE8];
  v9 = a2;
  v58 = a3;
  v10 = a4;
  v11 = a5;
  if (a1)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = a1;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v70 = v15;
      v71 = 2112;
      v72 = v9;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEFAULT, "%{public}@Remotely adding unassociated media accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v66 = 0;
    v16 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v9 requiringSecureCoding:1 error:&v66];
    v17 = v66;
    if (v16)
    {
      v18 = MEMORY[0x277CCAAB0];
      v19 = [MEMORY[0x277CCAD78] UUID];
      v65 = v17;
      v20 = [v18 archivedDataWithRootObject:v19 requiringSecureCoding:1 error:&v65];
      v21 = v65;

      if (v20)
      {
        v22 = v13[27];
        if (os_signpost_enabled(v22))
        {
          v23 = v22;
          v24 = [v9 uuid];
          *buf = 138412290;
          v70 = v24;
          _os_signpost_emit_with_name_impl(&dword_229538000, v23, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "RemotelyAddAccessory", "accessoryUUID=%{signpost.description:attribute}@ ", buf, 0xCu);
        }

        v55 = v20;
        v25 = [v13 homeManager];
        v56 = v9;
        v26 = [v9 uuid];
        v27 = [v25 accessorySetupMetricDispatcherForAccessoryUUID:v26];

        [v27 markRemoteAccessoryAddStarted];
        v28 = [v10 mutableCopy];
        [v28 setName:v58];
        v29 = [v10 identifier];
        [v28 setIdentifier:v29];

        v30 = [v10 untrustedClientIdentifier];

        v57 = v11;
        v31 = v16;
        if (v30)
        {
          v67 = *MEMORY[0x277D0F1D0];
          v32 = [v10 untrustedClientIdentifier];
          v68 = v32;
          v33 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v68 forKeys:&v67 count:1];
          [v28 setHeaders:v33];
        }

        else
        {
          [v28 setHeaders:MEMORY[0x277CBEC10]];
        }

        v42 = [HMDRemoteHomeMessageDestination alloc];
        v43 = [v10 destination];
        v44 = [v43 target];
        v45 = [v13 uuid];
        v46 = [(HMDRemoteHomeMessageDestination *)v42 initWithTarget:v44 homeUUID:v45 queueTimeout:&unk_283E75E88];
        [v28 setDestination:v46];

        v47 = [v10 messagePayload];
        v48 = [v47 mutableCopy];

        v54 = v31;
        [v48 setObject:v31 forKey:@"kAccessoryEncodedMediaAccessoryKey"];
        [v48 setObject:v55 forKey:@"HMDEncodedResidentUUIDKey"];
        v49 = [v48 copy];
        [v28 setMessagePayload:v49];

        v59[0] = MEMORY[0x277D85DD0];
        v59[1] = 3221225472;
        v59[2] = __83__HMDHome__remotelyAddMediaAccessory_usingRemoteMessageName_message_fallbackBlock___block_invoke;
        v59[3] = &unk_278681920;
        v59[4] = v13;
        v60 = v27;
        v9 = v56;
        v61 = v56;
        v62 = v10;
        v63 = v57;
        v64 = 0xEEEEB0B5B2B2EEEELL;
        v50 = v27;
        [v28 setResponseHandler:v59];
        v51 = [v13 residentSyncManager];
        v52 = [v28 copy];
        [v51 performResidentRequest:v52 options:0];

        v11 = v57;
        v16 = v54;

        v20 = v55;
      }

      else
      {
        v38 = objc_autoreleasePoolPush();
        v39 = v13;
        v40 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
        {
          v41 = HMFGetLogIdentifier();
          *buf = 138543618;
          v70 = v41;
          v71 = 2112;
          v72 = v21;
          _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_ERROR, "%{public}@Failed to encode uuid for remotely add accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v38);
        v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
        [v10 respondWithError:v28];
      }

      v17 = v21;
    }

    else
    {
      v34 = objc_autoreleasePoolPush();
      v35 = v13;
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
      {
        v37 = HMFGetLogIdentifier();
        *buf = 138543618;
        v70 = v37;
        v71 = 2112;
        v72 = v17;
        _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_ERROR, "%{public}@Unable to encode media accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v34);
      v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v10 respondWithError:v20];
    }
  }

  v53 = *MEMORY[0x277D85DE8];
}

- (void)_locallyAddMediaAccessory:(void *)a3 message:
{
  v58 = *MEMORY[0x277D85DE8];
  v41 = a2;
  v5 = a3;
  if (a1)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = a1;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v5 shortDescription];
      [v7 isCurrentDevicePrimaryResident];
      v11 = HMFBooleanToString();
      *buf = 138544130;
      v51 = v9;
      v52 = 2112;
      v53 = v41;
      v54 = 2112;
      v55 = v10;
      v56 = 2112;
      v57 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Performing local add of media accessory: %@. Message: %@ - isPrimaryResident: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v6);
    v12 = HMFGetOSLogHandle();
    if (os_signpost_enabled(v12))
    {
      v13 = [v41 uuid];
      *buf = 138412290;
      v51 = v13;
      _os_signpost_emit_with_name_impl(&dword_229538000, v12, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "AddAccessory", "accessoryUUID=%{signpost.description:attribute}@ ", buf, 0xCu);
    }

    v14 = [v7 homeManager];
    v15 = [v41 uuid];
    v39 = [v14 accessorySetupMetricDispatcherForAccessoryUUID:v15];

    [v39 markLocalAccessoryAddStarted];
    v40 = [v41 addTransactionForHome:v7];
    v16 = [v7 roomForEntireHome];
    v17 = [v16 uuid];
    v18 = [v17 UUIDString];
    [v40 setRoomUUID:v18];

    v19 = [v5 untrustedClientIdentifier];
    v38 = [HMDBackingStoreTransactionOptions defaultXPCOptionsWithClientIdentifier:v19];

    v20 = [v7 backingStore];
    v21 = [v5 name];
    v22 = [v20 transaction:v21 options:v38];

    objc_initWeak(&location, v7);
    v23 = [v5 mutableCopy];
    v24 = MEMORY[0x277CCAAB0];
    v25 = [MEMORY[0x277CCAD78] UUID];
    v48 = 0;
    v26 = [v24 archivedDataWithRootObject:v25 requiringSecureCoding:1 error:&v48];
    v37 = v48;

    if (v26)
    {
      v27 = [v5 messagePayload];
      v28 = [v27 mutableCopy];

      [v28 setObject:v26 forKey:@"HMDEncodedResidentUUIDKey"];
      v29 = [v28 copy];
      [v23 setMessagePayload:v29];

      v44[0] = MEMORY[0x277D85DD0];
      v44[1] = 3221225472;
      v44[2] = __45__HMDHome__locallyAddMediaAccessory_message___block_invoke;
      v44[3] = &unk_278689460;
      v45 = v5;
      objc_copyWeak(&v47, &location);
      v30 = v41;
      v46 = v30;
      [v23 setResponseHandler:v44];
      v31 = [v23 copy];
      [v22 add:v40 withMessage:v31];

      v42[0] = MEMORY[0x277D85DD0];
      v42[1] = 3221225472;
      v42[2] = __45__HMDHome__locallyAddMediaAccessory_message___block_invoke_2;
      v42[3] = &unk_27868A1D8;
      v42[4] = v7;
      v43 = v30;
      [v22 run:v42];
      if (os_signpost_enabled(v12))
      {
        *buf = 0;
        _os_signpost_emit_with_name_impl(&dword_229538000, v12, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "AddAccessory", "", buf, 2u);
      }

      objc_destroyWeak(&v47);
    }

    else
    {
      v32 = objc_autoreleasePoolPush();
      v33 = v7;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543618;
        v51 = v35;
        v52 = 2112;
        v53 = v37;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Failed to encode uuid for locally add accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v32);
      v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v5 respondWithError:v28];
    }

    objc_destroyWeak(&location);
  }

  v36 = *MEMORY[0x277D85DE8];
}

void __45__HMDHome__locallyAddMediaAccessory_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    [a1[4] respondWithError:v5];
  }

  else
  {
    WeakRetained = objc_loadWeakRetained(a1 + 6);
    v8 = a1[4];
    if (WeakRetained)
    {
      v9 = [a1[4] dataForKey:@"HMDEncodedResidentUUIDKey"];
      v26 = v9;
      if (v9)
      {
        v27 = 0;
        v9 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v9 error:&v27];
        v5 = v27;
      }

      else
      {
        v5 = 0;
      }

      v11 = a1[5];
      v24 = v9;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v12 = v11;
      }

      else
      {
        v12 = 0;
      }

      v13 = v12;
      v14 = [v13 device];
      if (v14)
      {
        v15 = [HMDCoreData sharedInstance:v24];
        v16 = [v15 contextWithRootPartition];

        v33[0] = MEMORY[0x277D85DD0];
        v33[1] = 3221225472;
        v33[2] = __75__HMDHome__associateResidentAndDeviceWithAddedMediaAccessory_residentUUID___block_invoke;
        v33[3] = &unk_27868A010;
        v33[4] = WeakRetained;
        v34 = v14;
        v35 = v16;
        v17 = v16;
        [v17 unsafeSynchronousBlock:v33];
      }

      v18 = [WeakRetained backingStore];
      v19 = [v18 context];
      v28[0] = MEMORY[0x277D85DD0];
      v28[1] = 3221225472;
      v28[2] = __75__HMDHome__associateResidentAndDeviceWithAddedMediaAccessory_residentUUID___block_invoke_2;
      v28[3] = &unk_278689550;
      v28[4] = WeakRetained;
      v20 = v11;
      v29 = v20;
      v21 = v25;
      v30 = v21;
      v31 = v13;
      v32 = v14;
      v22 = v14;
      v23 = v13;
      [v19 unsafeSynchronousBlock:v28];

      [a1[4] respondWithPayload:v6];
    }

    else
    {
      v10 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2018];
      [v8 respondWithError:v10];

      v5 = 0;
    }
  }
}

void __45__HMDHome__locallyAddMediaAccessory_message___block_invoke_2(uint64_t a1)
{
  v33 = *MEMORY[0x277D85DE8];
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v3 = v2;
  if (v1)
  {
    v4 = [v2 uuid];
    v5 = [v1 accessoryWithUUID:v4];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if ([v7 supportsTargetControl])
    {
      v8 = 1;
    }

    else
    {
      v9 = v3;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v10 = v9;
      }

      else
      {
        v10 = 0;
      }

      v11 = v10;

      v12 = [v11 device];

      v13 = [v12 capabilities];
      v8 = [v13 supportsTargetControl];
    }

    v14 = objc_autoreleasePoolPush();
    v15 = v1;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v7 shortDescription];
      [v7 supportsTargetControl];
      v19 = HMFBooleanToString();
      v20 = HMFBooleanToString();
      v25 = 138544130;
      v26 = v17;
      v27 = 2112;
      v28 = v18;
      v29 = 2112;
      v30 = v19;
      v31 = 2112;
      v32 = v20;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Checking for auto-Configuring current target controllers with the newly added media accessory: %@ (%@/%@)", &v25, 0x2Au);
    }

    objc_autoreleasePoolPop(v14);
    if (v8)
    {
      v21 = [MEMORY[0x277D0F8D0] sharedPreferences];
      v22 = [v21 preferenceForKey:@"autoConfigureNewTargets"];
      v23 = [v22 BOOLValue];

      if (v23)
      {
        [v7 autoConfigureTargetControllers];
      }
    }
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __75__HMDHome__associateResidentAndDeviceWithAddedMediaAccessory_residentUUID___block_invoke(uint64_t a1)
{
  v33 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  if (v2)
  {
    v28 = v3;
    v4 = [v3 identifier];
    v5 = [HMCContext findDeviceWithDeviceIdentifier:v4];

    if (v5)
    {
LABEL_3:
      [v28 updateBackingModel:v5 error:0];

      v6 = *(a1 + 48);
      v7 = *MEMORY[0x277D85DE8];

      [v6 save];
      return;
    }

    v8 = +[HMDAppleAccountManager sharedManager];
    v9 = [v8 account];

    if (v9)
    {
      v10 = [v9 modelIdentifier];
      v11 = [HMCContext findAccountWithModelID:v10];

      if (v11)
      {
        [v28 setAccount:v9];
        v12 = objc_autoreleasePoolPush();
        v13 = v2;
        v14 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
        {
          v15 = HMFGetLogIdentifier();
          *buf = 138543618;
          v30 = v15;
          v31 = 2112;
          v32 = v28;
          _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEFAULT, "%{public}@Creating MKFDevice for incoming accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v12);
        v16 = [v28 modelIdentifier];
        v5 = [v11 materializeOrCreateDevicesRelationWithModelID:v16 createdNew:0];

        goto LABEL_3;
      }

      v22 = objc_autoreleasePoolPush();
      v23 = v2;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543618;
        v30 = v25;
        v31 = 2112;
        v32 = v9;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@MKFAccount not found for account %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v22);
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = v2;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        v21 = [v28 identifier];
        *buf = 138543618;
        v30 = v20;
        v31 = 2112;
        v32 = v21;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@No MKFDevice found with identifier %@ and no HMDAccount available to create one", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v17);
    }

    v26 = *MEMORY[0x277D85DE8];
    return;
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __75__HMDHome__associateResidentAndDeviceWithAddedMediaAccessory_residentUUID___block_invoke_2(uint64_t a1)
{
  v83[1] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  v4 = [*(a1 + 40) uuid];
  v5 = [HMCContext findAppleMediaAccessoryWithModelID:v4];
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543618;
      v76 = v10;
      v77 = 2112;
      v78 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Creating resident object for newly added accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v74 = 0;
    v11 = MEMORY[0x277CCAD78];
    v12 = [*(a1 + 32) uuid];
    v13 = [v4 UUIDString];
    v83[0] = v13;
    v14 = [MEMORY[0x277CBEA60] arrayWithObjects:v83 count:1];
    v15 = [v11 hm_deriveUUIDFromBaseUUID:v12 withSalts:v14];

    v16 = objc_autoreleasePoolPush();
    v17 = *(a1 + 32);
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = *(a1 + 48);
      v21 = @"random";
      *buf = 138543874;
      v76 = v19;
      if (!v20)
      {
        v21 = @"derived";
      }

      v77 = 2112;
      if (!v20)
      {
        v20 = v15;
      }

      v78 = v21;
      v79 = 2112;
      v80 = v20;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Create resident with %@ UUID: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    if (*(a1 + 48))
    {
      v22 = *(a1 + 48);
    }

    else
    {
      v22 = v15;
    }

    v23 = [v3 materializeOrCreateResidentsRelationWithModelID:v22 createdNew:&v74];
    [v23 setAppleMediaAccessory:v5];
    v24 = [*(a1 + 56) rawResidentCapabilities];
    [v23 setResidentCapabilities:v24];

    v25 = [*(a1 + 32) accessoryWithUUID:v4];
    v26 = [v25 name];
    [v23 setName:v26];

    v27 = [v5 idsIdentifier];
    v73 = v3;
    if (v27)
    {
      v28 = v27;
      v29 = [v23 idsIdentifier];

      if (!v29)
      {
        v30 = objc_autoreleasePoolPush();
        v31 = *(a1 + 32);
        v32 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
        {
          v33 = HMFGetLogIdentifier();
          v34 = [v5 idsIdentifier];
          *buf = 138544130;
          v76 = v33;
          v77 = 2160;
          v78 = 1752392040;
          v79 = 2112;
          v80 = v34;
          v81 = 2112;
          v82 = v5;
          _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_DEFAULT, "%{public}@Setting IDS identifier=%{mask.hash}@ from accessory: %@", buf, 0x2Au);

          v3 = v73;
        }

        objc_autoreleasePoolPop(v30);
        v35 = [v5 idsIdentifier];
        [v23 setIdsIdentifier:v35];
      }
    }

    v36 = [v5 pairingIdentity];

    if (v36)
    {
      v37 = objc_autoreleasePoolPush();
      v38 = *(a1 + 32);
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_DEFAULT))
      {
        v40 = HMFGetLogIdentifier();
        v41 = [v5 pairingIdentity];
        *buf = 138543874;
        v76 = v40;
        v77 = 2112;
        v78 = v41;
        v79 = 2112;
        v80 = v5;
        _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_DEFAULT, "%{public}@Setting pairingIdentity=%@ from accessory: %@", buf, 0x20u);

        v3 = v73;
      }

      objc_autoreleasePoolPop(v37);
      v42 = [v5 pairingIdentity];
      [v23 setPairingIdentity:v42];
    }

    v43 = [v5 deviceIRKData];

    if (v43)
    {
      v44 = objc_autoreleasePoolPush();
      v45 = *(a1 + 32);
      v46 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v46, OS_LOG_TYPE_DEFAULT))
      {
        v47 = HMFGetLogIdentifier();
        v48 = [v5 deviceIRKData];
        *buf = 138543874;
        v76 = v47;
        v77 = 2112;
        v78 = v48;
        v79 = 2112;
        v80 = v5;
        _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_DEFAULT, "%{public}@Setting deviceIRKData=%@ from accessory: %@", buf, 0x20u);

        v3 = v73;
      }

      objc_autoreleasePoolPop(v44);
      v49 = [v5 deviceIRKData];
      [v23 setDeviceIRKData:v49];
    }

    v50 = *(a1 + 64);
    if (v50)
    {
      v51 = [v50 identifier];
      v52 = [HMCContext findDeviceWithDeviceIdentifier:v51];

      if (v52)
      {
        v53 = objc_autoreleasePoolPush();
        v54 = *(a1 + 32);
        v55 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v55, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          v57 = *(a1 + 64);
          *buf = 138544130;
          v76 = v56;
          v77 = 2112;
          v78 = v57;
          v79 = 2112;
          v80 = v5;
          v81 = 2112;
          v82 = v23;
          _os_log_impl(&dword_229538000, v55, OS_LOG_TYPE_INFO, "%{public}@Setting device %@ on accessory model: %@, resident model: %@", buf, 0x2Au);

          v3 = v73;
        }

        objc_autoreleasePoolPop(v53);
        [v5 setDevice:v52];
        [v23 setDevice:v52];
      }

      v58 = [*(a1 + 64) idsIdentifier];
      if (v58)
      {
        v59 = objc_autoreleasePoolPush();
        v60 = *(a1 + 32);
        v61 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_DEFAULT))
        {
          HMFGetLogIdentifier();
          v62 = v71 = v15;
          *buf = 138544130;
          v76 = v62;
          v77 = 2160;
          v78 = 1752392040;
          v79 = 2112;
          v80 = v58;
          v81 = 2112;
          v82 = v5;
          _os_log_impl(&dword_229538000, v61, OS_LOG_TYPE_DEFAULT, "%{public}@Setting IDS identifier=%{mask.hash}@ for newly added accessory: %@", buf, 0x2Au);

          v15 = v71;
        }

        objc_autoreleasePoolPop(v59);
        [v5 setIdsIdentifier:v58];
        [v23 setIdsIdentifier:v58];
        v3 = v73;
      }

      v63 = [*(a1 + 64) globalDestination];
      if (v63)
      {
        v64 = objc_autoreleasePoolPush();
        v65 = *(a1 + 32);
        v66 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v66, OS_LOG_TYPE_DEFAULT))
        {
          HMFGetLogIdentifier();
          v67 = v72 = v15;
          *buf = 138544130;
          v76 = v67;
          v77 = 2160;
          v78 = 1752392040;
          v79 = 2112;
          v80 = v63;
          v81 = 2112;
          v82 = v5;
          _os_log_impl(&dword_229538000, v66, OS_LOG_TYPE_DEFAULT, "%{public}@Setting IDS destination=%{mask.hash}@ for newly added accessory: %@", buf, 0x2Au);

          v15 = v72;
        }

        objc_autoreleasePoolPop(v64);
        [v5 setIdsDestination:v63];
        [v23 setIdsDestination:v63];
        v3 = v73;
      }
    }

    v68 = +[HMCContext currentContext];
    [v68 save];
  }

  else
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v69 = HMFGetLogIdentifier();
      *buf = 138543618;
      v76 = v69;
      v77 = 2112;
      v78 = v4;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Unable to find newly added accessory with UUID %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v70 = *MEMORY[0x277D85DE8];
}

void __83__HMDHome__remotelyAddMediaAccessory_usingRemoteMessageName_message_fallbackBlock___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v39 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v34 = v10;
    v35 = 2112;
    v36 = v6;
    v37 = 2112;
    v38 = v5;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Resident responded with : %@, %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  [*(a1 + 40) markRemoteAccessoryAddEndedWithError:v5];
  if (v5)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v15 = *(a1 + 48);
      *buf = 138543874;
      v34 = v14;
      v35 = 2112;
      v36 = v15;
      v37 = 2112;
      v38 = v5;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while adding accessory [%@] on resident : %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    if (HMDIsAllowedFallbackRemoteError(v5) && ([*(a1 + 32) administratorHandler], v16 = objc_claimAutoreleasedReturnValue(), v17 = objc_msgSend(v16, "allowLocalFallbackForMessage:", *(a1 + 56)), v16, v17))
    {
      v18 = [*(a1 + 32) deviceHomeKitSetupSession];
      [v18 markHasFailedRelayAttempt];

      v19 = objc_autoreleasePoolPush();
      v20 = *(a1 + 32);
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v22 = HMFGetLogIdentifier();
        v23 = [*(a1 + 56) shortDescription];
        *buf = 138543874;
        v34 = v22;
        v35 = 2114;
        v36 = v23;
        v37 = 2112;
        v38 = v5;
        _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Allowing local fallback processing of message %{public}@ due to error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v19);
      (*(*(a1 + 64) + 16))();
    }

    else
    {
      [*(a1 + 56) respondWithError:v5];
    }
  }

  else
  {
    v24 = [*(a1 + 32) backingStore];
    v25 = [v24 context];
    v29[0] = MEMORY[0x277D85DD0];
    v29[1] = 3221225472;
    v29[2] = __83__HMDHome__remotelyAddMediaAccessory_usingRemoteMessageName_message_fallbackBlock___block_invoke_1436;
    v29[3] = &unk_278685330;
    v29[4] = *(a1 + 32);
    v30 = *(a1 + 48);
    v26 = *(a1 + 56);
    v27 = *(a1 + 72);
    v31 = v26;
    v32 = v27;
    [v25 performBlock:v29];
  }

  v28 = *MEMORY[0x277D85DE8];
}

void __83__HMDHome__remotelyAddMediaAccessory_usingRemoteMessageName_message_fallbackBlock___block_invoke_1436(uint64_t a1)
{
  v19[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) uuid];
  v4 = [v2 accessoryWithUUID:v3];

  if (v4)
  {
    v5 = *(a1 + 32);
    v19[0] = v4;
    v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v19 count:1];
    [v5 _notifyClientOfNewlyAddedAccessories:v6 requestMessage:*(a1 + 48)];
  }

  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v10;
    v17 = 2112;
    v18 = v4;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Successfully remote added accessory : %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(*(a1 + 32) + 216);
  v12 = v11;
  v13 = *(a1 + 56);
  if (v13 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v11))
  {
    LOWORD(v15) = 0;
    _os_signpost_emit_with_name_impl(&dword_229538000, v12, OS_SIGNPOST_INTERVAL_END, v13, "RemotelyAddAccessory", "", &v15, 2u);
  }

  [*(a1 + 48) respondWithSuccess];
  v14 = *MEMORY[0x277D85DE8];
}

- (void)_removePendingAccessoryAdd:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 accessoryUUID];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [v5 UUIDString];
    v12 = 138543618;
    v13 = v9;
    v14 = 2112;
    v15 = v10;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Removing accessoryDescription, setupCode and handlers for accessory %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)v7->_addPendingAccessories removeObjectForKey:v4];
  if (v5)
  {
    [(NSMutableDictionary *)v7->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v5];
    [(NSMutableDictionary *)v7->_addPendingAccessorySetupCodes removeObjectForKey:v5];
    [(NSMutableDictionary *)v7->_addPendingAccessoryOnboardingSetupPayloadStrings removeObjectForKey:v5];
  }

  os_unfair_recursive_lock_unlock();

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_accessoryPairingDidComplete:(id)a3 configuration:(id)a4 pairingEvent:(id)a5 accessoryServer:(id)a6 certificationStatus:(int64_t)a7 requestMessage:(id)a8
{
  v42 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v32 = a4;
  v15 = a5;
  v16 = a6;
  v33 = a8;
  [(HMDHome *)self _removePendingAccessoryAdd:v14];
  v17 = v16;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v18 = v17;
  }

  else
  {
    v18 = 0;
  }

  v19 = v18;

  v20 = 0;
  if ([v19 isWacComplete])
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v24;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@WAC was completed as part of accessory pairing.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
    v20 = [v32 networkCredential];
  }

  if ([v15 isMatterAccessory])
  {
    notifyMatterMetricPairingStep(self, 0x18uLL);
  }

  v25 = [MEMORY[0x277D0F770] currentActivity];
  objc_initWeak(buf, self);
  v26 = [v14 accessoryUUID];
  v34[0] = MEMORY[0x277D85DD0];
  v34[1] = 3221225472;
  v34[2] = __118__HMDHome__accessoryPairingDidComplete_configuration_pairingEvent_accessoryServer_certificationStatus_requestMessage___block_invoke;
  v34[3] = &unk_27866FD00;
  objc_copyWeak(v39, buf);
  v27 = v17;
  v35 = v27;
  v28 = v15;
  v36 = v28;
  v29 = v14;
  v37 = v29;
  v30 = v25;
  v38 = v30;
  v39[1] = a7;
  [(HMDHome *)self _processAccessoriesToAddForUnpairedAccessory:v26 certificationStatus:a7 accessoryServer:v27 networkCredential:v20 pairingEvent:v28 message:v33 completionHandler:v34];

  objc_destroyWeak(v39);
  objc_destroyWeak(buf);

  v31 = *MEMORY[0x277D85DE8];
}

void __118__HMDHome__accessoryPairingDidComplete_configuration_pairingEvent_accessoryServer_certificationStatus_requestMessage___block_invoke(uint64_t a1, void *a2)
{
  v33 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v5 = [WeakRetained _primaryAccessoryForServer:*(a1 + 32)];
  v28 = 0;
  v6 = [v5 preferredHAPAccessoryForOperation:1 linkType:&v28];
  v7 = [*(a1 + 32) pairingMetricDictionary];
  v8 = [v7 copy];
  [*(a1 + 40) setMatterMetrics:v8];

  [*(a1 + 32) clearPairingMetrics];
  [*(a1 + 40) updateEventPropertiesWithPairedAccessory:v5];
  if ([*(a1 + 40) isMatterAccessory] && objc_msgSend(*(a1 + 40), "isAddOperation"))
  {
    if (v3)
    {
      [HMDMatterAccessoryPairingEndContext hmdContextWithError:v3];
    }

    else
    {
      +[HMDMatterAccessoryPairingEndContext pairingCompletedContext];
    }
    v9 = ;
    notifyMatterMetricPairingEnded(WeakRetained, v9);
  }

  else
  {
    v9 = [WeakRetained logEventSubmitter];
    [v9 submitLogEvent:*(a1 + 40) error:v3];
  }

  v10 = objc_autoreleasePoolPush();
  v11 = WeakRetained;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [*(a1 + 48) accessoryName];
    *buf = 138543618;
    v30 = v13;
    v31 = 2112;
    v32 = v14;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@_handleAddAccessory: added accessories for accessory %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  v15 = [v5 metricLoggingVendorDetails];
  v16 = [v6 server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = v16;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  v19 = *(a1 + 48);
  v20 = *(a1 + 56);
  [v19 accessoryUUID];

  [*(a1 + 32) category];
  [v15 model];

  [v15 manufacturer];
  [v15 firmwareVersion];

  v21 = HAPLinkTypeDescription();
  [v18 isWacAccessory];

  v22 = HMFBooleanToString();
  v23 = [MEMORY[0x277CCABB0] numberWithInteger:*(a1 + 72)];
  [*(a1 + 40) isThreadAccessory];
  v24 = HMFBooleanToString();
  [*(a1 + 40) accessorySupportsWoL];

  v25 = HMFBooleanToString();
  v26 = [v11 homeLocationHandler];
  [v26 updateHomeLocation];

  [v11 _evaluateShouldRelaunchAndSetRelaunch];
  v27 = *MEMORY[0x277D85DE8];
}

- (void)_pairAccessoryWithAccessoryDescription:(id)a3 unpairedAccessory:(id)a4 configuration:(id)a5 pairingEvent:(id)a6 requestMessage:(id)a7
{
  v12 = a7;
  v13 = a6;
  v14 = a5;
  v15 = a4;
  v16 = a3;
  v18 = [(HMDHome *)self accessoryBrowser];
  v17 = __createAccessoryBrowserAddAccessoryCompletionHandler(self, v16, v14, v13, v12);

  [v18 pairAccessory:v15 configuration:v14 completionHandler:v17];
}

- (void)_continuePairingAfterUserConsentWithAccessoryUUID:(id)a3 orUnassociatedAccessory:(id)a4 message:(id)a5
{
  v113 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v96 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543618;
    *&buf[4] = v13;
    *&buf[12] = 2112;
    *&buf[14] = v8;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Continue pairing after user consent with accessoryUUID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  if (v9)
  {
    goto LABEL_5;
  }

  v14 = [(HMDHome *)v11 accessoryBrowser];
  v15 = [v14 unassociatedAccessories];
  v9 = [v15 hmf_firstObjectWithUUID:v8];

  if (v9)
  {
LABEL_5:
    v95 = v9;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v17 = v95;
    }

    else
    {
      v17 = 0;
    }

    v94 = v17;

    if (isKindOfClass)
    {
      v107 = 0u;
      v105 = 0u;
      v106 = 0u;
      v104 = 0u;
      v18 = [(HMDHome *)v11 addPendingAccessories];
      v19 = [v18 hm_allKeys];

      v20 = [v19 countByEnumeratingWithState:&v104 objects:v109 count:16];
      if (v20)
      {
        v21 = *v105;
        while (2)
        {
          for (i = 0; i != v20; ++i)
          {
            if (*v105 != v21)
            {
              objc_enumerationMutation(v19);
            }

            v23 = *(*(&v104 + 1) + 8 * i);
            v24 = [v23 accessoryUUID];
            v25 = [v24 isEqual:v8];

            if (v25)
            {
              v93 = v23;
              v34 = [(HMDHome *)v11 addPendingAccessories];
              v35 = [v34 objectForKey:v93];

              v96 = v35;
              goto LABEL_27;
            }
          }

          v20 = [v19 countByEnumeratingWithState:&v104 objects:v109 count:16];
          if (v20)
          {
            continue;
          }

          break;
        }
      }

      v93 = 0;
LABEL_27:

      v91 = [v96 stringForKey:*MEMORY[0x277CD1FD8]];
      if (v91)
      {
        v36 = objc_autoreleasePoolPush();
        v37 = v11;
        v38 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
        {
          v39 = HMFGetLogIdentifier();
          *buf = 138543618;
          *&buf[4] = v39;
          *&buf[12] = 2112;
          *&buf[14] = v94;
          _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Storing setupCode accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v36);
        v40 = [(HMDHome *)v37 addPendingAccessorySetupCodes];
        [v40 setObject:v91 forKey:v8];
      }

      else
      {
        v91 = [v93 setupCode];
      }

      v45 = [v93 appIdentifier];
      v92 = +[HMDAccessoryPairingEvent pairingAccessory:home:appIdentifier:retry:](HMDAccessoryPairingEvent, "pairingAccessory:home:appIdentifier:retry:", v94, v11, v45, [v93 retry]);

      if ([v92 isMatterAccessory])
      {
        notifyMatterMetricPairingStep(v11, 2uLL);
      }

      v46 = objc_alloc_init(HMDUnpairedHAPAccessoryConfiguration);
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setSetupCode:v91];
      v47 = [(HMDHome *)v11 _setupCodeProviderForMessage:v96];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setSetupCodeProvider:v47];

      v48 = [(HMDHome *)v11 homeLocationHandler];
      v49 = [v48 isoCountryCode];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setIsoCountryCode:v49];

      v50 = [(HMDHome *)v11 matterFabricID];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setChipFabricID:v50];

      v51 = [(HMDHome *)v11 uuid];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setHomeUUID:v51];

      v52 = [v94 preferredAccessoryServer];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v53 = v52;
      }

      else
      {
        v53 = 0;
      }

      v90 = v53;

      v54 = objc_autoreleasePoolPush();
      v55 = v11;
      v56 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
      {
        v57 = HMFGetLogIdentifier();
        v58 = [v8 UUIDString];
        [v90 isWacNeeded];
        v59 = HMFBooleanToString();
        v60 = HMDNetworkRouterSupportAsString([(HMDHome *)v55 networkRouterSupport]);
        [(HMDHome *)v55 networkRouterSupportDisableReason];
        v61 = HMNetworkRouterSupportDisableReasonAsString();
        *buf = 138544386;
        *&buf[4] = v57;
        *&buf[12] = 2112;
        *&buf[14] = v58;
        *&buf[22] = 2112;
        v111 = v59;
        *v112 = 2112;
        *&v112[2] = v60;
        *&v112[10] = 2112;
        *&v112[12] = v61;
        _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_INFO, "%{public}@Adding unpaired accessory with uuid: %@, WAC needed: %@, network router support: %@ (Reason %@)", buf, 0x34u);
      }

      objc_autoreleasePoolPop(v54);
      v62 = [MEMORY[0x277D0F770] currentActivity];
      [v93 accessoryUUID];

      v63 = [v94 preferredAccessoryServer];
      [v63 category];

      v64 = HMDNetworkRouterSupportAsString([(HMDHome *)v55 networkRouterSupport]);
      v65 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome networkRouterSupportDisableReason](v55, "networkRouterSupportDisableReason")}];
      [v92 linkType];
      v66 = HAPLinkTypeDescription();
      [v92 communicationProtocol];
      v67 = HAPCommunicationProtocolDescription();
      [v90 isWacNeeded];
      v68 = HMFBooleanToString();
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 requiresUserConsent];
      v69 = HMFBooleanToString();
      [v93 appIdentifier];

      [v92 isThreadAccessory];
      v70 = HMFBooleanToString();
      if ([v90 isWacNeeded] && (-[HMDHome networkRouterSupport](v55, "networkRouterSupport") & 8) != 0)
      {
        v97[0] = MEMORY[0x277D85DD0];
        v97[1] = 3221225472;
        v97[2] = __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke;
        v97[3] = &unk_27866FCD8;
        v97[4] = v55;
        v98 = v62;
        v99 = v93;
        v100 = v92;
        v101 = v96;
        v102 = v46;
        v103 = v94;
        [(HMDHome *)v55 _createUniquePSKClientConfigurationWithRequestMessage:v101 pairingEvent:v100 completion:v97];
      }

      else
      {
        [v62 begin];
        *buf = v62;
        [(HMDHome *)v55 _pairAccessoryWithAccessoryDescription:v93 unpairedAccessory:v94 configuration:v46 pairingEvent:v92 requestMessage:v96];
        __HMFActivityScopeLeave();
      }
    }

    else
    {
      v95 = v95;
      v96 = v96;
      if (v11)
      {
        objc_initWeak(&location, v11);
        v26 = v95;
        objc_opt_class();
        v27 = objc_opt_isKindOfClass();
        if (v27)
        {
          v28 = v26;
        }

        else
        {
          v28 = 0;
        }

        v29 = v28;

        if (v27)
        {
          v30 = objc_autoreleasePoolPush();
          v31 = v11;
          v32 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
          {
            v33 = HMFGetLogIdentifier();
            *buf = 138543618;
            *&buf[4] = v33;
            *&buf[12] = 2112;
            *&buf[14] = v29;
            _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_DEFAULT, "%{public}@Starting WAC for %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v30);
          *buf = MEMORY[0x277D85DD0];
          *&buf[8] = 3221225472;
          *&buf[16] = __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke;
          v111 = &unk_27866FD28;
          objc_copyWeak(&v112[16], &location);
          *v112 = v96;
          *&v112[8] = v29;
          [*&v112[8] startConfigurationWithCompletionHandler:buf];

          objc_destroyWeak(&v112[16]);
        }

        else
        {
          v41 = v26;
          objc_opt_class();
          v42 = objc_opt_isKindOfClass();
          if (v42)
          {
            v43 = v41;
          }

          else
          {
            v43 = 0;
          }

          v44 = v43;

          if (v42)
          {
            [(HMDHome *)v11 _addAndMaybeAssociateMediaAccessory:v44 message:v96];
          }

          else
          {
            v84 = objc_autoreleasePoolPush();
            v85 = v11;
            v86 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v86, OS_LOG_TYPE_DEFAULT))
            {
              v87 = HMFGetLogIdentifier();
              *buf = 138543618;
              *&buf[4] = v87;
              *&buf[12] = 2112;
              *&buf[14] = v41;
              _os_log_impl(&dword_229538000, v86, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to add unknown unassociated accessory: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v84);
            v88 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
            [v96 respondWithError:v88];
          }
        }

        objc_destroyWeak(&location);
      }
    }

    goto LABEL_61;
  }

  v71 = objc_autoreleasePoolPush();
  v72 = v11;
  v73 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v73, OS_LOG_TYPE_DEFAULT))
  {
    v74 = HMFGetLogIdentifier();
    v75 = [v8 UUIDString];
    *buf = 138543618;
    *&buf[4] = v74;
    *&buf[12] = 2112;
    *&buf[14] = v75;
    _os_log_impl(&dword_229538000, v73, OS_LOG_TYPE_DEFAULT, "%{public}@Unknown accessory with identifier: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v71);
  v76 = objc_autoreleasePoolPush();
  v77 = v72;
  v78 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v78, OS_LOG_TYPE_DEFAULT))
  {
    v79 = HMFGetLogIdentifier();
    v80 = [(HMDHome *)v77 accessoryBrowser];
    v81 = [(HMDHome *)v77 accessoryBrowser];
    v82 = [v81 unassociatedAccessories];
    *buf = 138543874;
    *&buf[4] = v79;
    *&buf[12] = 2112;
    *&buf[14] = v80;
    *&buf[22] = 2112;
    v111 = v82;
    _os_log_impl(&dword_229538000, v78, OS_LOG_TYPE_DEFAULT, "%{public}@AccessoryBrowser %@, Unassociated accessories: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v76);
  v83 = [v96 responseHandler];

  if (v83)
  {
    v95 = [v96 responseHandler];
    v94 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(v95 + 2))(v95, v94, 0);
LABEL_61:
  }

  v89 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke_2;
  block[3] = &unk_27866FCB0;
  v11 = a1[5];
  v12 = a1[6];
  v13 = v6;
  v14 = a1[4];
  v15 = a1[7];
  v16 = a1[8];
  v17 = a1[9];
  v18 = v5;
  v19 = a1[10];
  v8 = v5;
  v9 = v6;
  dispatch_async(v7, block);
}

void __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (!WeakRetained)
  {
    v13 = *(a1 + 32);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
LABEL_7:
    v16 = [v14 hmErrorWithCode:v15];
    [v13 respondWithError:v16];
    goto LABEL_8;
  }

  if (v5)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = *(a1 + 40);
      *buf = 138543618;
      v32 = v11;
      v33 = 2112;
      v34 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@WAC failed for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = *(a1 + 32);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 48;
    goto LABEL_7;
  }

  v18 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v19 = v18;
  }

  else
  {
    v19 = 0;
  }

  v16 = v19;

  if (v16)
  {
    v20 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke_1388;
    block[3] = &unk_27868A010;
    block[4] = WeakRetained;
    v29 = v16;
    v30 = *(a1 + 32);
    dispatch_async(v20, block);
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = WeakRetained;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v32 = v24;
      v33 = 2112;
      v34 = objc_opt_class();
      v25 = v34;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Post-WAC not supported for type %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v21);
    v26 = *(a1 + 32);
    v27 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [v26 respondWithError:v27];
  }

LABEL_8:

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_addAndMaybeAssociateMediaAccessory:(void *)a3 message:
{
  v28 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (a1)
  {
    if ([a1 isOwnerUser])
    {
      v7 = [a1 homeManager];
      v8 = [v5 uuid];
      v9 = [v7 accessorySetupMetricDispatcherForAccessoryUUID:v8];

      [v9 addHome:a1];
      if ([v5 conformsToProtocol:&unk_283EE9CC8] && objc_msgSend(v5, "supportsAssociation"))
      {
        objc_initWeak(&location, a1);
        v10 = objc_autoreleasePoolPush();
        v11 = a1;
        v12 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          v13 = HMFGetLogIdentifier();
          *buf = 138543618;
          v25 = v13;
          v26 = 2112;
          v27 = v5;
          _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Starting association for media accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v10);
        v19[0] = MEMORY[0x277D85DD0];
        v19[1] = 3221225472;
        v19[2] = __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke;
        v19[3] = &unk_278685D08;
        objc_copyWeak(&v22, &location);
        v20 = v5;
        v21 = v6;
        [v20 associateToHome:v11 completionHandler:v19];

        objc_destroyWeak(&v22);
        objc_destroyWeak(&location);
      }

      else
      {
        [a1 _addMediaAccessory:v5 message:v6];
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      v15 = a1;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v25 = v17;
        _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_DEFAULT, "%{public}@Must be owner to add WHA accessory", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v14);
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [v6 respondWithError:v9];
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke(id *a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (v3)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = v5;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = HMFGetLogIdentifier();
      v10 = a1[4];
      *buf = 138543874;
      v20 = v9;
      v21 = 2112;
      v22 = v10;
      v23 = 2112;
      v24 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to add accessory, %@, with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    [a1[5] respondWithError:v3];
  }

  else if (WeakRetained)
  {
    v11 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke_1433;
    block[3] = &unk_278685F38;
    objc_copyWeak(&v18, a1 + 6);
    v16 = a1[5];
    v17 = a1[4];
    dispatch_async(v11, block);

    objc_destroyWeak(&v18);
  }

  else
  {
    v12 = a1[5];
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v12 respondWithError:v13];
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke_1433(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v5 = WeakRetained;
  if (WeakRetained)
  {
    [WeakRetained _addMediaAccessory:*(a1 + 40) message:*(a1 + 32)];
  }

  else
  {
    v3 = *(a1 + 32);
    v4 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v3 respondWithError:v4];
  }
}

void __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke_1388(id *a1)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = a1[4];
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v7 = 138543362;
    v8 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Continuing to add accessory post-WAC", &v7, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  [(HMDHome *)a1[4] _addAndMaybeAssociateMediaAccessory:a1[6] message:?];
  v6 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke_2(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 40);
  v3 = *(a1 + 32);
  [v2 accessoryUUID];

  [*(a1 + 48) domain];
  [*(a1 + 48) code];

  v4 = *(a1 + 48) == 0;
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 56);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *v15 = 138543362;
      *&v15[4] = v13;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Client configuration with WiFi unique PSK created successfully", v15, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 80) setNetworkCredential:*(a1 + 88)];
    [*(a1 + 64) setUsedWiFiPPSK:1];
    [*(a1 + 32) begin];
    *v15 = *(a1 + 32);
    [*(a1 + 56) _pairAccessoryWithAccessoryDescription:*(a1 + 40) unpairedAccessory:*(a1 + 96) configuration:*(a1 + 80) pairingEvent:*(a1 + 64) requestMessage:*(a1 + 72)];
    __HMFActivityScopeLeave();
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 40);
      v11 = *(a1 + 48);
      *v15 = 138543874;
      *&v15[4] = v9;
      v16 = 2112;
      v17 = v10;
      v18 = 2112;
      v19 = v11;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate WiFi credential for accessory %@ with error: %@", v15, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v12 = [*(a1 + 56) logEventSubmitter];
    [v12 submitLogEvent:*(a1 + 64) error:*(a1 + 48)];

    [*(a1 + 72) respondWithError:*(a1 + 48)];
    [*(a1 + 56) _removePendingAccessoryAdd:*(a1 + 40)];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_continueLegacyAddAccessoryWithUUID:(id)a3 unassociatedAccessory:(id)a4 setupCode:(id)a5 appID:(id)a6 message:(id)a7
{
  v83 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v17 = [(HMDHome *)self accessoryWithUUID:v12];
  if (v17)
  {
    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543874;
      v78 = v21;
      v79 = 2112;
      v80 = v12;
      v81 = 2112;
      v82 = v17;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Can't add unassociated accessory: this home already has an accessory with UUID %@: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v18);
    if (_os_feature_enabled_impl() && [v16 isEntitledForSPIAccess] && objc_msgSend(v16, "isEntitledToProvideAccessorySetupPayload"))
    {
      v22 = objc_autoreleasePoolPush();
      v23 = v19;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v25;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Creating temporary progress handler to invoke with already-associated error", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v22);
      v26 = objc_alloc(MEMORY[0x277CD1DE8]);
      v27 = [(HMDHome *)v23 uuid];
      v28 = [v26 initWithAccessoryUUID:v12 accessoryName:0 appID:v15 homeUUID:v27];

      v29 = HMDHomeCreateAddAccessoryProgressHandler(v23, v28, v16);
      v30 = [[HMDAddAccessoryProgressState alloc] initWithPairedAccessory:v17];
      (v29)[2](v29, 47, v30);
    }

    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:13];
    [v16 respondWithError:v31];
    goto LABEL_47;
  }

  v32 = [(HMDHome *)self accessories];
  v33 = [v32 count];
  v34 = maximumAccessoriesPerHome;

  if (v33 >= v34)
  {
    v39 = objc_autoreleasePoolPush();
    v40 = self;
    v41 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
    {
      v42 = HMFGetLogIdentifier();
      *buf = 138543362;
      v78 = v42;
      _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_ERROR, "%{public}@Can't add unassociated accessory: already at maximum accessories for home", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v39);
    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    [v16 respondWithError:v31];
  }

  else if (([v13 associationOptions] & 2) != 0)
  {
    v43 = objc_autoreleasePoolPush();
    v44 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
    {
      v46 = HMFGetLogIdentifier();
      *buf = 138543362;
      v78 = v46;
      _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_INFO, "%{public}@Can't add unassociated accessory: software update needed on the accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v43);
    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [v16 respondWithError:v31];
  }

  else
  {
    v35 = [v13 category];
    v76 = 0;
    context = [(HMDHome *)self _shouldAllowAddingAccessoryOfCategory:v35 requestMessage:v16 error:&v76];
    v31 = v76;

    if (context)
    {
LABEL_14:
      v70 = v13;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v36 = v70;
      }

      else
      {
        v36 = 0;
      }

      v67 = v36;

      if (v67)
      {
        v37 = objc_alloc(MEMORY[0x277CD1DE8]);
        v38 = [(HMDHome *)self uuid];
        v68 = [v37 initWithAccessoryUUID:v12 accessoryName:0 appID:v15 homeUUID:v38];

        [v68 setSetupCode:v14];
        os_unfair_recursive_lock_lock_with_options();
        [(NSMapTable *)self->_addPendingAccessories setObject:v16 forKey:v68];
        os_unfair_recursive_lock_unlock();
      }

      else
      {
        v68 = 0;
      }

      if ([v16 isEntitledForSPIAccess] && objc_msgSend(v16, "isEntitledToProvideAccessorySetupPayload"))
      {
        v66 = objc_autoreleasePoolPush();
        v52 = self;
        v53 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v53, OS_LOG_TYPE_DEBUG))
        {
          v54 = HMFGetLogIdentifier();
          *buf = 138543362;
          v65 = v54;
          v78 = v54;
          _os_log_impl(&dword_229538000, v53, OS_LOG_TYPE_DEBUG, "%{public}@Registering Progress Handler", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v66);
        v55 = HMDHomeCreateAddAccessoryProgressHandler(v52, v68, v16);
        v56 = v52;
        v57 = v55;
        v58 = [(HMDHome *)v56 accessoryBrowser];
        [v58 registerProgressHandler:v57 unpairedAccessoryUUID:v12];
      }

      else
      {
        v57 = 0;
      }

      if (context)
      {
        [(HMDHome *)self _continuePairingAfterUserConsentWithAccessoryUUID:v12 orUnassociatedAccessory:v70 message:v16];
      }

      else if (v57)
      {
        v59 = [[HMDAddAccessoryProgressState alloc] initWithUnpairedAccessory:v67 server:0];
        (v57)[2](v57, 9, v59);
      }

      else
      {
        contextb = objc_autoreleasePoolPush();
        v60 = self;
        v61 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_INFO))
        {
          v62 = HMFGetLogIdentifier();
          *buf = 138543362;
          v72 = v62;
          v78 = v62;
          _os_log_impl(&dword_229538000, v61, OS_LOG_TYPE_INFO, "%{public}@No progress handler but need to request user consent to replace accessory in home", buf, 0xCu);
        }

        objc_autoreleasePoolPop(contextb);
        v63 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
        [v16 respondWithError:v63];
      }

      goto LABEL_47;
    }

    v47 = [v31 domain];
    if ([v47 isEqualToString:*MEMORY[0x277CCFD28]])
    {
      v48 = [v31 code] == 97;

      if (v48)
      {
        goto LABEL_14;
      }
    }

    else
    {
    }

    contexta = objc_autoreleasePoolPush();
    v49 = self;
    v50 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
    {
      v69 = HMFGetLogIdentifier();
      v71 = [v13 category];
      v51 = [v71 localizedDescription];
      *buf = 138543874;
      v78 = v69;
      v79 = 2112;
      v80 = v51;
      v81 = 2112;
      v82 = v31;
      _os_log_impl(&dword_229538000, v50, OS_LOG_TYPE_ERROR, "%{public}@Can't add an accessory of category %@: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(contexta);
    [v16 respondWithError:v31];
  }

LABEL_47:

  v64 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoteAddMediaAccessoryRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self residentSyncManager];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __49__HMDHome__handleRemoteAddMediaAccessoryRequest___block_invoke;
  v6[3] = &unk_27868A398;
  v6[4] = self;
  [v5 interceptRemoteResidentRequest:v4 proceed:v6];
}

void __49__HMDHome__handleRemoteAddMediaAccessoryRequest___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 dataForKey:@"kAccessoryEncodedMediaAccessoryKey"];
  if (v4)
  {
    v16 = 0;
    v5 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v4 error:&v16];
    v6 = v16;
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    v10 = v9;
    if (v5)
    {
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v11;
        v19 = 2112;
        v20 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Proceeding to add media accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      [(HMDHome *)*(a1 + 32) _locallyAddMediaAccessory:v5 message:v3];
    }

    else
    {
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v13;
        v19 = 2112;
        v20 = v6;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to decode unassociated media accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v3 respondWithError:v14];
    }
  }

  else
  {
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [v3 respondWithError:v12];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoteAddMediaAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self residentSyncManager];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __42__HMDHome__handleRemoteAddMediaAccessory___block_invoke;
  v6[3] = &unk_27868A398;
  v6[4] = self;
  [v5 interceptRemoteResidentRequest:v4 proceed:v6];
}

void __42__HMDHome__handleRemoteAddMediaAccessory___block_invoke(uint64_t a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v4)
  {
    v5 = [v3 dataForKey:@"kAccessoryEncodedMediaAccessoryKey"];
    if (v5)
    {
      v21 = 0;
      v6 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v5 error:&v21];
      v7 = v21;
      if (v6)
      {
        v8 = [v3 stringForKey:*MEMORY[0x277CD1FD8]];
        v9 = [v3 clientIdentifier];
        context = objc_autoreleasePoolPush();
        v10 = *(a1 + 32);
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v12 = v19 = v7;
          *buf = 138543618;
          v23 = v12;
          v24 = 2112;
          v25 = v6;
          _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Proceeding to add unassociated media accessory: %@", buf, 0x16u);

          v7 = v19;
        }

        objc_autoreleasePoolPop(context);
        [*(a1 + 32) _continueLegacyAddAccessoryWithUUID:v4 unassociatedAccessory:v6 setupCode:v8 appID:v9 message:v3];
      }

      else
      {
        v14 = objc_autoreleasePoolPush();
        v15 = *(a1 + 32);
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          v17 = HMFGetLogIdentifier();
          *buf = 138543618;
          v23 = v17;
          v24 = 2112;
          v25 = v7;
          _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Unable to decode unassociated media accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v14);
        v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        [v3 respondWithError:v8];
      }
    }

    else
    {
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      [v3 respondWithError:v13];
    }
  }

  else
  {
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [v3 respondWithError:v5];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldUseDeprecatedAddAccessoryMessage:(id)a3 minimumVersion:(id)a4 primaryResident:(id)a5 shouldRelayMessages:(BOOL)a6
{
  v9 = a4;
  v10 = [a5 device];
  v11 = [v10 version];

  LOBYTE(v12) = 0;
  if (v9 && a5)
  {
    v12 = [v11 isAtLeastVersion:v9] ^ 1;
  }

  v13 = v12 & a6;
  if (a3)
  {
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  return v14;
}

- (void)_handleLegacyAddAccessory:(id)a3
{
  v78 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v73 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling legacy add accessory", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v9)
  {
    v10 = [v4 stringForKey:*MEMORY[0x277CD1FD8]];
    if (v10 && ([v4 isEntitledForSPIAccess] & 1) == 0)
    {
      v45 = objc_autoreleasePoolPush();
      v46 = v6;
      v47 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
      {
        v48 = HMFGetLogIdentifier();
        *buf = 138543362;
        v73 = v48;
        _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Client provided a setup code but does not have entitlement to use SPI", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v45);
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [v4 respondWithError:v13];
      goto LABEL_38;
    }

    v11 = [(HMDHome *)v6 accessoryBrowser];
    v12 = [v11 unassociatedAccessories];
    v13 = [v12 hmf_firstObjectWithUUID:v9];

    v14 = objc_autoreleasePoolPush();
    v15 = v6;
    v16 = HMFGetOSLogHandle();
    v17 = v16;
    if (!v13)
    {
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v49 = HMFGetLogIdentifier();
        v50 = [(HMDHome *)v15 accessoryBrowser];
        v51 = [v50 unassociatedAccessories];
        *buf = 138543874;
        v73 = v49;
        v74 = 2112;
        v75 = v9;
        v76 = 2112;
        v77 = v51;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Could not find unassociated accessory with UUID %@ for legacy add accessory flow. All unassociated accessories: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v14);
      v52 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v52];
      goto LABEL_37;
    }

    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v73 = v18;
      v74 = 2112;
      v75 = v13;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Found matching unassociated accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v19 = v13;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v21 = v19;
    }

    else
    {
      v21 = 0;
    }

    v65 = v21;

    if (isKindOfClass)
    {
      v22 = objc_autoreleasePoolPush();
      v23 = v15;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v61 = HMFGetLogIdentifier();
        v62 = [v4 proxyConnection];
        v60 = [v62 shortDescription];
        [(HMDHome *)v23 hasAnyResident];
        v25 = HMFBooleanToString();
        *buf = 138543874;
        v73 = v61;
        v74 = 2112;
        v75 = v60;
        v76 = 2112;
        v77 = v25;
        v26 = v25;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Creating a device HomeKit setup session for connection %@, home.hasAnyResident = %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v22);
      v27 = [HMDDeviceHomeKitSetupSession alloc];
      v28 = [(HMDHome *)v23 hasAnyResident];
      v29 = [v4 proxyConnection];
      v30 = [(HMDDeviceHomeKitSetupSession *)v27 initWithFirstResidentForHome:!v28 clientConnection:v29];
      [(HMDHome *)v23 setDeviceHomeKitSetupSession:v30];
    }

    v31 = v19;
    objc_opt_class();
    v32 = objc_opt_isKindOfClass();
    if (v32)
    {
      v33 = v31;
    }

    else
    {
      v33 = 0;
    }

    v34 = v33;

    v35 = [(HMDHome *)v15 primaryResident];
    v36 = v35;
    if ((v32 & 1) != 0 && v35)
    {
      v37 = +[HMDHomeKitVersion version10];
      v38 = [(HMDHome *)v15 administratorHandler];
      v63 = v34;
      v39 = -[HMDHome _shouldUseDeprecatedAddAccessoryMessage:minimumVersion:primaryResident:shouldRelayMessages:](v15, "_shouldUseDeprecatedAddAccessoryMessage:minimumVersion:primaryResident:shouldRelayMessages:", v34, v37, v36, [v38 shouldRelayMessages]);

      if (v39)
      {
        v66[0] = MEMORY[0x277D85DD0];
        v66[1] = 3221225472;
        v66[2] = __37__HMDHome__handleLegacyAddAccessory___block_invoke;
        v66[3] = &unk_278689550;
        v67 = v4;
        v68 = v15;
        v69 = v9;
        v70 = v63;
        v71 = v10;
        [(HMDHome *)v15 _remotelyAddMediaAccessory:v70 usingRemoteMessageName:@"HMDRemoteAddMediaAccessoryMessage" message:v67 fallbackBlock:v66];

        v34 = v63;
LABEL_36:

        v52 = v65;
LABEL_37:

LABEL_38:
        goto LABEL_39;
      }

      v34 = v63;
    }

    v53 = objc_autoreleasePoolPush();
    v54 = v15;
    v55 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v55, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v64 = v36;
      v56 = v13;
      v58 = v57 = v34;
      *buf = 138543618;
      v73 = v58;
      v74 = 2112;
      v75 = v31;
      _os_log_impl(&dword_229538000, v55, OS_LOG_TYPE_INFO, "%{public}@Continuing legacy add for unassociated accessory: %@", buf, 0x16u);

      v34 = v57;
      v13 = v56;
      v36 = v64;
    }

    objc_autoreleasePoolPop(v53);
    v37 = [v4 clientIdentifier];
    [(HMDHome *)v54 _continueLegacyAddAccessoryWithUUID:v9 unassociatedAccessory:v31 setupCode:v10 appID:v37 message:v4];
    goto LABEL_36;
  }

  v40 = objc_autoreleasePoolPush();
  v41 = v6;
  v42 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
  {
    v43 = HMFGetLogIdentifier();
    v44 = [v4 shortDescription];
    *buf = 138543618;
    v73 = v43;
    v74 = 2112;
    v75 = v44;
    _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_ERROR, "%{public}@Legacy add accessory message is missing accessory uuid: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v40);
  v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
  [v4 respondWithError:v10];
LABEL_39:

  v59 = *MEMORY[0x277D85DE8];
}

void __37__HMDHome__handleLegacyAddAccessory___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) clientIdentifier];
  [*(a1 + 40) _continueLegacyAddAccessoryWithUUID:*(a1 + 48) unassociatedAccessory:*(a1 + 56) setupCode:*(a1 + 64) appID:v2 message:*(a1 + 32)];
}

- (BOOL)_shouldAllowAddingAccessoryWithDescription:(id)a3 requestMessage:(id)a4 error:(id *)a5
{
  v8 = a4;
  v9 = MEMORY[0x277CD1680];
  v10 = a3;
  v11 = [v10 setupAccessoryPayload];
  v12 = [v11 categoryNumber];
  v13 = [v9 categoryWithCategoryIdentifier:v12];

  v14 = [v10 category];

  if ([v14 isWiFiRouterAccessoryCategory])
  {
  }

  else
  {
    v15 = [v13 isWiFiRouterAccessoryCategory];

    if ((v15 & 1) == 0)
    {
      v16 = 1;
      goto LABEL_6;
    }
  }

  v16 = [(HMDHome *)self __shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:v8 error:a5];
LABEL_6:

  return v16;
}

- (BOOL)_shouldAllowAddingAccessoryOfCategory:(id)a3 requestMessage:(id)a4 error:(id *)a5
{
  v8 = a4;
  if ([a3 isWiFiRouterAccessoryCategory])
  {
    v9 = [(HMDHome *)self __shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:v8 error:a5];
  }

  else
  {
    v9 = 1;
  }

  return v9;
}

- (id)_setupDescriptionFromData:(id)a3 error:(id *)a4
{
  v35 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v6 error:a4];
  v8 = v7;
  if (v7)
  {
    v28 = [v7 addRequestIdentifier];
    v30 = 0u;
    v31 = 0u;
    v32 = 0u;
    v33 = 0u;
    v9 = [(HMDHome *)self addPendingAccessories];
    v10 = [v9 hm_allKeys];

    obj = v10;
    v26 = [v10 countByEnumeratingWithState:&v30 objects:v34 count:16];
    if (v26)
    {
      v27 = *v31;
      v24 = v6;
      while (2)
      {
        for (i = 0; i != v26; ++i)
        {
          if (*v31 != v27)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v30 + 1) + 8 * i);
          v13 = [v12 setupAccessoryPayload];
          v14 = [v13 setupID];
          v15 = [v8 setupAccessoryPayload];
          v16 = [v15 setupID];
          if ([v14 isEqual:v16])
          {
            goto LABEL_15;
          }

          v17 = [v12 accessoryUUID];
          v18 = [v8 accessoryUUID];
          if ([v17 isEqual:v18])
          {

LABEL_15:
LABEL_16:
            v21 = [v8 cancellationReason];
            [v12 setCancellationReason:v21];

            v20 = v12;
            v6 = v24;
            goto LABEL_17;
          }

          v19 = [v12 addRequestIdentifier];
          v29 = [v19 isEqual:v28];

          if (v29)
          {
            goto LABEL_16;
          }
        }

        v6 = v24;
        v26 = [obj countByEnumeratingWithState:&v30 objects:v34 count:16];
        if (v26)
        {
          continue;
        }

        break;
      }
    }

    v20 = v8;
LABEL_17:
  }

  else
  {
    v20 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v20;
}

- (BOOL)__shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:(id)a3 error:(id *)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  if (![(HMDHome *)self checkForNetworkRouterSupport:4 error:a4])
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMDNetworkRouterSupportAsString([(HMDHome *)v11 networkRouterSupport]);
      v15 = v14;
      if (a4)
      {
        v16 = *a4;
      }

      else
      {
        v16 = 0;
      }

      v19 = 138543874;
      v20 = v13;
      v21 = 2112;
      v22 = v14;
      v23 = 2112;
      v24 = v16;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Cannot add network router to the home - networkRouterSupport %@ error %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    goto LABEL_12;
  }

  v7 = [(HMDHome *)self wiFiRouterAccessories];
  v8 = [v7 count];

  if (!v8)
  {
    v9 = 1;
    goto LABEL_13;
  }

  if (!a4)
  {
LABEL_12:
    v9 = 0;
    goto LABEL_13;
  }

  [MEMORY[0x277CCA9B8] hmErrorWithCode:97];
  *a4 = v9 = 0;
LABEL_13:

  v17 = *MEMORY[0x277D85DE8];
  return v9;
}

- (void)performLocalAddAccessoryWithDescription:(id)a3 progressHandlerDelegate:(id)a4 completion:(id)a5
{
  v42 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self localCapabilitiesDataSource];
  v12 = [v11 supportsAddingAccessory];

  if (v12)
  {
    v13 = [(HMDHome *)self currentAccessory];
    if (v13)
    {
      v14 = [(HMDHome *)self selfRemovalWatchdog];
      v15 = [v14 currentAccessoryUUID];

      if (v15 && ([v13 uuid], v16 = objc_claimAutoreleasedReturnValue(), v17 = objc_msgSend(v15, "hmf_isEqualToUUID:", v16), v16, v17))
      {
        v18 = objc_autoreleasePoolPush();
        v19 = self;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
        {
          v21 = HMFGetLogIdentifier();
          *buf = 138543874;
          v37 = v21;
          v38 = 2112;
          v39 = v8;
          v40 = 2112;
          v41 = v13;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Will not perform local add accessory with setup description %@ when current accessory (%@) self removal is pending", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v18);
        if (!v10)
        {
          goto LABEL_19;
        }

        v22 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2505];
        v10[2](v10, v22);
      }

      else
      {
        v24 = objc_autoreleasePoolPush();
        v25 = self;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
        {
          v27 = HMFGetLogIdentifier();
          *buf = 138543618;
          v37 = v27;
          v38 = 2112;
          v39 = v8;
          _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Performing local add accessory with setup description %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v24);
        v22 = [MEMORY[0x277D0F848] internalMessageWithName:*MEMORY[0x277CD2070] messagePayload:0];
        [v22 setQualityOfService:25];
        objc_initWeak(buf, v25);
        v33[0] = MEMORY[0x277D85DD0];
        v33[1] = 3221225472;
        v33[2] = __86__HMDHome_performLocalAddAccessoryWithDescription_progressHandlerDelegate_completion___block_invoke;
        v33[3] = &unk_278689728;
        objc_copyWeak(&v35, buf);
        v34 = v10;
        [v22 setResponseHandler:v33];
        [(HMDHome *)&v25->super.super.isa _handleAddAccessoryWithDescription:v8 progressHandlerDelegate:v9 message:v22];

        objc_destroyWeak(&v35);
        objc_destroyWeak(buf);
      }
    }

    else
    {
      v28 = objc_autoreleasePoolPush();
      v29 = self;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
      {
        v31 = HMFGetLogIdentifier();
        *buf = 138543618;
        v37 = v31;
        v38 = 2112;
        v39 = v8;
        _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_ERROR, "%{public}@Will not perform local add accessory with setup description %@ without current accessory present", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v28);
      if (!v10)
      {
        goto LABEL_20;
      }

      v15 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2020];
      v10[2](v10, v15);
    }

LABEL_19:

LABEL_20:
    goto LABEL_21;
  }

  if (v10)
  {
    v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    v10[2](v10, v23);
  }

LABEL_21:

  v32 = *MEMORY[0x277D85DE8];
}

void __86__HMDHome_performLocalAddAccessoryWithDescription_progressHandlerDelegate_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    if (v5)
    {
      v12 = [MEMORY[0x277CCACA8] stringWithFormat:@"failed with error: %@", v5];
    }

    else
    {
      v12 = @"completed";
    }

    *buf = 138543618;
    v16 = v11;
    v17 = 2112;
    v18 = v12;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Perform local add accessory %@", buf, 0x16u);
    if (v5)
    {
    }
  }

  objc_autoreleasePoolPop(v8);
  v13 = *(a1 + 32);
  if (v13)
  {
    (*(v13 + 16))(v13, v5);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessory:(id)a3
{
  v15 = a3;
  v4 = [(HMDHome *)self localCapabilitiesDataSource];
  v5 = [v4 supportsAddingAccessory];

  if (v5)
  {
    v6 = [(HMDHome *)self homeManager];
    v7 = [v6 legacyAccessoryPairingController];
    if (v7)
    {
      v8 = v7;
      v9 = [v6 legacyAccessoryPairingController];
      v10 = [v9 handleMessage:v15 from:self];

      if (v10)
      {
        goto LABEL_11;
      }
    }

    else
    {
    }

    v14 = [v15 dataForKey:*MEMORY[0x277CD1F90]];

    if (v14)
    {
      [(HMDHome *)self _handleAddAccessoryWithDescription:v15];
    }

    else
    {
      [(HMDHome *)self _handleLegacyAddAccessory:v15];
    }
  }

  else
  {
    v11 = [v15 responseHandler];

    if (v11)
    {
      v12 = [v15 responseHandler];
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      (v12)[2](v12, v13, 0);
    }
  }

LABEL_11:
}

- (BOOL)_removeAccessory:(id)a3
{
  v24 = *MEMORY[0x277D85DE8];
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  accessories = self->_accessories;
  v6 = [v4 uuid];
  v7 = [(NSMutableDictionary *)accessories objectForKeyedSubscript:v6];

  if (v7)
  {
    v8 = self->_accessories;
    v9 = [v4 uuid];
    [(NSMutableDictionary *)v8 setObject:0 forKeyedSubscript:v9];

    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [v4 uuid];
      v20 = 138543618;
      v21 = v13;
      v22 = 2112;
      v23 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Successfully removed accessory from list: %@", &v20, 0x16u);
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v15 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v4 shortDescription];
      v20 = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = v17;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Asked to remove accessory that doesn't exist in list of accessories: %@", &v20, 0x16u);
    }
  }

  objc_autoreleasePoolPop(v10);
  os_unfair_recursive_lock_unlock();

  v18 = *MEMORY[0x277D85DE8];
  return v7 != 0;
}

- (void)removeAccessory:(id)a3
{
  v34 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4 && [(HMDHome *)self _removeAccessory:v4])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v8;
      v32 = 2112;
      v33 = v4;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Removed accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    if ([v4 isPrimary])
    {
      v9 = v4;
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();
      if (isKindOfClass)
      {
        v11 = v9;
      }

      else
      {
        v11 = 0;
      }

      v12 = v11;

      v13 = v9;
      objc_opt_class();
      v14 = objc_opt_isKindOfClass();
      if (v14)
      {
        v15 = v13;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;

      v17 = v13;
      objc_opt_class();
      v18 = objc_opt_isKindOfClass();
      if (v18)
      {
        v19 = v17;
      }

      else
      {
        v19 = 0;
      }

      v20 = v19;

      if (isKindOfClass)
      {
        workQueue = v6->_workQueue;
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __27__HMDHome_removeAccessory___block_invoke;
        block[3] = &unk_27868A750;
        block[4] = v6;
        v29 = v17;
        dispatch_async(workQueue, block);
        v22 = v29;
      }

      else
      {
        if ((v14 & 1) == 0)
        {
          if (v18)
          {
            v25 = [(HMDHome *)v6 accessoryBulletinNotificationManager];
            [v25 handleRemovedAccessory:v17];
          }

          goto LABEL_20;
        }

        v23 = v6->_workQueue;
        v26[0] = MEMORY[0x277D85DD0];
        v26[1] = 3221225472;
        v26[2] = __27__HMDHome_removeAccessory___block_invoke_2;
        v26[3] = &unk_27868A750;
        v26[4] = v6;
        v27 = v17;
        dispatch_async(v23, v26);
        v22 = v27;
      }

LABEL_20:
    }
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __27__HMDHome_removeAccessory___block_invoke(uint64_t a1)
{
  v22 = *MEMORY[0x277D85DE8];
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23 description:@"Retrieval cancelled reason:accessory removed" suggestion:{0, 0}];
  v3 = *(a1 + 32);
  v4 = [*(a1 + 40) identifier];
  [v3 _notifyRetrievalError:v2 accessoryServer:v4 linkType:0 accessoryOperationBlock:0];

  v19 = 0u;
  v20 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [*(a1 + 40) services];
  v6 = [v5 copy];

  v7 = [v6 countByEnumeratingWithState:&v17 objects:v21 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v18;
    do
    {
      v10 = 0;
      do
      {
        if (*v18 != v9)
        {
          objc_enumerationMutation(v6);
        }

        [*(a1 + 32) _removeService:*(*(&v17 + 1) + 8 * v10++)];
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v17 objects:v21 count:16];
    }

    while (v8);
  }

  v11 = [*(a1 + 40) cameraProfiles];
  v12 = [v11 count];

  if (v12)
  {
    v13 = [*(a1 + 32) cameraBulletinNotificationManager];
    [v13 handleRemovedCameraAccessory:*(a1 + 40)];
  }

  v14 = [*(a1 + 32) homeActivityStateManager];
  v15 = [v14 homeActivityStateAggregatorManager];
  [v15 handleRemovedAccessory:*(a1 + 40)];

  v16 = *MEMORY[0x277D85DE8];
}

void __27__HMDHome_removeAccessory___block_invoke_2(uint64_t a1)
{
  v3 = [*(a1 + 32) remoteEventRouterClientController];
  v2 = [*(a1 + 40) uuid];
  [v3 removeResidentRouterForAccessoryUUID:v2];
}

- (void)_addAccessories:(id)a3
{
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __27__HMDHome__addAccessories___block_invoke;
  v3[3] = &unk_27866FC38;
  v3[4] = self;
  [a3 na_each:v3];
}

- (BOOL)_addAccessory:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  accessories = self->_accessories;
  v6 = [v4 uuid];
  v7 = [(NSMutableDictionary *)accessories objectForKey:v6];

  if (!v7)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [v4 uuid];
      v17 = 138543618;
      v18 = v11;
      v19 = 2112;
      v20 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Added accessory to the home's list: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = self->_accessories;
    v14 = [v4 uuid];
    [(NSMutableDictionary *)v13 setObject:v4 forKey:v14];
  }

  os_unfair_recursive_lock_unlock();

  v15 = *MEMORY[0x277D85DE8];
  return v7 == 0;
}

- (void)addAccessory:(id)a3
{
  v29 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = v4;
  if (!v4)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v10;
      v11 = "%{public}@Attempting to add a nil accessory";
      v12 = v9;
      v13 = 12;
      goto LABEL_8;
    }

LABEL_9:

    objc_autoreleasePoolPop(v7);
    goto LABEL_11;
  }

  v6 = [v4 uuid];

  if (v6)
  {
    if (![(HMDHome *)self _addAccessory:v5])
    {
      v7 = objc_autoreleasePoolPush();
      v8 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543618;
        v26 = v10;
        v27 = 2112;
        v28 = v5;
        v11 = "%{public}@Attempted to add an accessory that is already present: %@";
        v12 = v9;
        v13 = 22;
LABEL_8:
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, v11, buf, v13);

        goto LABEL_9;
      }

      goto LABEL_9;
    }
  }

  else
  {
    v14 = [v5 uuid];

    if (!v14)
    {
      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_FAULT))
      {
        v19 = HMFGetLogIdentifier();
        v20 = [v5 shortDescription];
        *buf = 138543618;
        v26 = v19;
        v27 = 2112;
        v28 = v20;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_FAULT, "%{public}@Submitting ABC event for failure: Attempted to add an accessory that does not have an uuid: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      v21 = [HMDAssertionLogEvent alloc];
      v22 = [v5 shortDescription];
      v23 = [(HMDAssertionLogEvent *)v21 initWithReason:@"Attempted to add an accessory that does not have an uuid: %@", v22];

      v24 = +[HMDMetricsManager sharedLogEventSubmitter];
      [v24 submitLogEvent:v23];
    }
  }

LABEL_11:

  v15 = *MEMORY[0x277D85DE8];
}

- (unint64_t)assistantAccessCapableAccessoryCount
{
  v15 = *MEMORY[0x277D85DE8];
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v11;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v11 != v6)
        {
          objc_enumerationMutation(v2);
        }

        v5 += [HMDAssistantAccessControl isAccessorySupported:*(*(&v10 + 1) + 8 * i)];
      }

      v4 = [v2 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  v8 = *MEMORY[0x277D85DE8];
  return v5;
}

- (BOOL)shouldEncodeLegacyLocationServiceSettingForSettingsParentUUID:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self mediaSystemWithUUID:v4];
  v6 = v5;
  if (v5)
  {
    LODWORD(v7) = [v5 componentsSupportsHomeLevelLocationServiceSetting] ^ 1;
  }

  else
  {
    v8 = [(HMDHome *)self accessoryWithUUID:v4];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    if (v10)
    {
      LODWORD(v7) = [v10 supportsHomeLevelLocationServiceSetting] ^ 1;
    }

    else
    {
      v7 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        v16 = 138543618;
        v17 = v13;
        v18 = 2112;
        v19 = v4;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to filter legacy location service setting due to no parent found with uuid: %@", &v16, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      LOBYTE(v7) = 0;
    }
  }

  v14 = *MEMORY[0x277D85DE8];
  return v7;
}

- (id)destinationControllerWithCommittedDestinationIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __67__HMDHome_destinationControllerWithCommittedDestinationIdentifier___block_invoke;
  v9[3] = &unk_27866FC10;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __67__HMDHome_destinationControllerWithCommittedDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 committedData];
  v4 = [v3 destinationIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationControllerWithDestinationIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __58__HMDHome_destinationControllerWithDestinationIdentifier___block_invoke;
  v9[3] = &unk_27866FC10;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __58__HMDHome_destinationControllerWithDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 data];
  v4 = [v3 destinationIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationControllerWithIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __47__HMDHome_destinationControllerWithIdentifier___block_invoke;
  v9[3] = &unk_27866FC10;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __47__HMDHome_destinationControllerWithIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 identifier];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (id)destinationControllers
{
  v2 = [(HMDHome *)self appleMediaAccessories];
  v3 = [v2 na_map:&__block_literal_global_1341];

  return v3;
}

- (int64_t)destinationTypeForDestinationWithIdentifier:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  [(HMDHome *)self appleMediaAccessories];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v5 = v37 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v35;
    v9 = 3;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v11 = *(*(&v34 + 1) + 8 * i);
        v12 = [v11 uuid];
        v13 = [v12 hmf_isEqualToUUID:v4];

        if (v13)
        {
          v17 = v5;
          goto LABEL_26;
        }

        v14 = [v11 audioDestination];
        v15 = [v14 uniqueIdentifier];
        v16 = [v15 hmf_isEqualToUUID:v4];

        if (v16)
        {
          v17 = v5;
          v9 = 1;
          goto LABEL_26;
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  [(HMDHome *)self mediaSystems];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v17 = v33 = 0u;
  v18 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
  if (v18)
  {
    v19 = v18;
    v20 = *v31;
    while (2)
    {
      for (j = 0; j != v19; ++j)
      {
        if (*v31 != v20)
        {
          objc_enumerationMutation(v17);
        }

        v22 = *(*(&v30 + 1) + 8 * j);
        v23 = [v22 uuid];
        v24 = [v23 hmf_isEqualToUUID:v4];

        if (v24)
        {
          v9 = 4;
          goto LABEL_25;
        }

        v25 = [v22 audioDestination];
        v26 = [v25 uniqueIdentifier];
        v27 = [v26 hmf_isEqualToUUID:v4];

        if (v27)
        {
          v9 = 2;
          goto LABEL_25;
        }
      }

      v19 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
      v9 = 0;
      if (v19)
      {
        continue;
      }

      break;
    }
  }

  else
  {
    v9 = 0;
  }

LABEL_25:

LABEL_26:
  v28 = *MEMORY[0x277D85DE8];
  return v9;
}

- (id)mediaDestinationsInRoom:(id)a3
{
  v45 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self appleMediaAccessories];
  v6 = [(HMDHome *)self mediaSystems];
  v32 = v5;
  v34 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{objc_msgSend(v6, "count") + objc_msgSend(v5, "count")}];
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v7 = v6;
  v8 = [v7 countByEnumeratingWithState:&v39 objects:v44 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v40;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v40 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v39 + 1) + 8 * i);
        v13 = [v12 audioDestination];
        if (v13)
        {
          if (!v4)
          {
            goto LABEL_9;
          }

          v14 = [v12 room];
          v15 = [v14 uuid];
          v16 = [v4 uuid];
          v17 = [v15 hmf_isEqualToUUID:v16];

          if (v17)
          {
LABEL_9:
            [v34 addObject:v13];
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v39 objects:v44 count:16];
    }

    while (v9);
  }

  v33 = v7;

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v18 = v32;
  v19 = [v18 countByEnumeratingWithState:&v35 objects:v43 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v36;
    do
    {
      for (j = 0; j != v20; ++j)
      {
        if (*v36 != v21)
        {
          objc_enumerationMutation(v18);
        }

        v23 = *(*(&v35 + 1) + 8 * j);
        v24 = [v23 audioDestination];
        if (v24)
        {
          if (!v4)
          {
            if (_mediaSystemsContainsAccessory(v33, v23))
            {
              goto LABEL_25;
            }

LABEL_23:
            [v34 addObject:v24];
            goto LABEL_25;
          }

          v25 = [v23 room];
          v26 = [v25 uuid];
          v27 = [v4 uuid];
          if ([v26 hmf_isEqualToUUID:v27])
          {
            v28 = _mediaSystemsContainsAccessory(v33, v23);

            if ((v28 & 1) == 0)
            {
              goto LABEL_23;
            }
          }

          else
          {
          }
        }

LABEL_25:
      }

      v20 = [v18 countByEnumeratingWithState:&v35 objects:v43 count:16];
    }

    while (v20);
  }

  v29 = [v34 copy];
  v30 = *MEMORY[0x277D85DE8];

  return v29;
}

- (id)mediaDestinationManagersWithSupportedOptions:(unint64_t)a3
{
  v5 = [(HMDHome *)self appleMediaAccessories];
  v6 = [(HMDHome *)self mediaSystems];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke;
  v15[3] = &__block_descriptor_40_e54____HMDMediaDestinationManager__16__0__HMDMediaSystem_8l;
  v15[4] = a3;
  v7 = [v6 na_map:v15];
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke_2;
  v12[3] = &unk_27866FBC8;
  v13 = v6;
  v14 = a3;
  v8 = v6;
  v9 = [v5 na_map:v12];
  v10 = [v9 arrayByAddingObjectsFromArray:v7];

  return v10;
}

id __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 audioDestinationManager];
  v4 = [v3 destination];
  LODWORD(a1) = [v4 containsSupportedOptions:*(a1 + 32)];

  if (a1)
  {
    v5 = v3;
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

id __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = [v4 destination];
  if ([v5 containsSupportedOptions:*(a1 + 40)])
  {
    v6 = _mediaSystemsContainsAccessory(*(a1 + 32), v3);

    if ((v6 & 1) == 0)
    {
      v7 = v4;
      goto LABEL_6;
    }
  }

  else
  {
  }

  v7 = 0;
LABEL_6:

  return v7;
}

- (id)mediaDestinationManagersWithHomeTheaterSupportedOptions
{
  v3 = [(HMDHome *)self appleMediaAccessories];
  v4 = [(HMDHome *)self mediaSystems];
  v5 = [v4 na_map:&__block_literal_global_1336];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke_2;
  v10[3] = &unk_27866FB80;
  v11 = v4;
  v6 = v4;
  v7 = [v3 na_map:v10];
  v8 = [v7 arrayByAddingObjectsFromArray:v5];

  return v8;
}

id __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = [v4 destination];
  if ([v5 containsHomeTheaterSupportedOptions])
  {
    v6 = _mediaSystemsContainsAccessory(*(a1 + 32), v3);

    if ((v6 & 1) == 0)
    {
      v7 = v4;
      goto LABEL_6;
    }
  }

  else
  {
  }

  v7 = 0;
LABEL_6:

  return v7;
}

id __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 audioDestinationManager];
  v3 = [v2 destination];
  v4 = [v3 containsHomeTheaterSupportedOptions];

  if (v4)
  {
    v5 = v2;
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)destinationManagerPassingTest:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  [(HMDHome *)self appleMediaAccessories];
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v5 = v25 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v22 objects:v27 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v23;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v23 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = [*(*(&v22 + 1) + 8 * i) audioDestinationManager];
        if (v10 && (v4[2](v4, v10) & 1) != 0)
        {
          v11 = v5;
          goto LABEL_22;
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v22 objects:v27 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  [(HMDHome *)self mediaSystems];
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v11 = v21 = 0u;
  v12 = [v11 countByEnumeratingWithState:&v18 objects:v26 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v19;
LABEL_12:
    v15 = 0;
    while (1)
    {
      if (*v19 != v14)
      {
        objc_enumerationMutation(v11);
      }

      v10 = [*(*(&v18 + 1) + 8 * v15) audioDestinationManager];
      if (v10)
      {
        if (v4[2](v4, v10))
        {
          break;
        }
      }

      if (v13 == ++v15)
      {
        v13 = [v11 countByEnumeratingWithState:&v18 objects:v26 count:16];
        if (v13)
        {
          goto LABEL_12;
        }

        goto LABEL_19;
      }
    }
  }

  else
  {
LABEL_19:
    v10 = 0;
  }

LABEL_22:
  v16 = *MEMORY[0x277D85DE8];

  return v10;
}

- (id)destinationManagerWithDestinationIdentifier:(id)a3
{
  v4 = a3;
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __55__HMDHome_destinationManagerWithDestinationIdentifier___block_invoke;
  v8[3] = &unk_27867ADF8;
  v9 = v4;
  v5 = v4;
  v6 = [(HMDHome *)self destinationManagerPassingTest:v8];

  return v6;
}

uint64_t __55__HMDHome_destinationManagerWithDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 destination];
  v4 = [v3 uniqueIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationManagerWithParentIdentifier:(id)a3
{
  v4 = a3;
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __50__HMDHome_destinationManagerWithParentIdentifier___block_invoke;
  v8[3] = &unk_27867ADF8;
  v9 = v4;
  v5 = v4;
  v6 = [(HMDHome *)self destinationManagerPassingTest:v8];

  return v6;
}

uint64_t __50__HMDHome_destinationManagerWithParentIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 destination];
  v4 = [v3 parentIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)rootDestinationManagerWithDescendantDestinationIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSystems];
  v10 = MEMORY[0x277D85DD0];
  v11 = 3221225472;
  v12 = __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke;
  v13 = &unk_278689258;
  v14 = self;
  v15 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:&v10];
  v8 = [v7 audioDestinationManager];

  return v8;
}

uint64_t __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 components];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke_2;
  v7[3] = &unk_27866FB38;
  v4 = *(a1 + 40);
  v7[4] = *(a1 + 32);
  v8 = v4;
  v5 = [v3 na_any:v7];

  return v5;
}

uint64_t __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke_2(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 accessory];
  v5 = [v3 accessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v8 = *(a1 + 40);
    v9 = [v7 audioDestination];
    v10 = [v9 uniqueIdentifier];
    v11 = [v8 hmf_isEqualToUUID:v10];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = *(a1 + 32);
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543874;
      v19 = v15;
      v20 = 2112;
      v21 = v3;
      v22 = 2112;
      v23 = v4;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to apple media accessory from component: %@ accessory: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];
  return v11;
}

- (id)destinationManagersWithDestinationIdentifiers:(id)a3 supportedOptions:(unint64_t)a4
{
  v6 = a3;
  v7 = [(HMDHome *)self mediaDestinationManagersWithSupportedOptions:a4];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __74__HMDHome_destinationManagersWithDestinationIdentifiers_supportedOptions___block_invoke;
  v11[3] = &unk_27867ADF8;
  v12 = v6;
  v8 = v6;
  v9 = [v7 na_filter:v11];

  return v9;
}

uint64_t __74__HMDHome_destinationManagersWithDestinationIdentifiers_supportedOptions___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 identifier];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (id)targetAccessoriesWithDestinationIdentifiers:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self appleMediaAccessories];
  v6 = [(HMDHome *)self mediaSystems];
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke;
  v24[3] = &unk_27866FAE8;
  v7 = v4;
  v25 = v7;
  v8 = [v6 na_map:v24];
  v19 = MEMORY[0x277D85DD0];
  v20 = 3221225472;
  v21 = __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke_2;
  v22 = &unk_27866FB10;
  v9 = v7;
  v23 = v9;
  v10 = [v5 na_map:&v19];
  v11 = [v8 arrayByAddingObjectsFromArray:{v10, v19, v20, v21, v22}];
  v12 = [v11 count];
  if (v12 != [v9 count])
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543874;
      v27 = v16;
      v28 = 2112;
      v29 = v9;
      v30 = 2112;
      v31 = v11;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to get target accessories for destination identifiers: %@ targets: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v11 = MEMORY[0x277CBEBF8];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

id __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = *(a1 + 32);
  v6 = [v4 identifier];
  LODWORD(v5) = [v5 containsObject:v6];

  if (v5)
  {
    v7 = [v3 targetAccessory];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

id __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = *(a1 + 32);
  v6 = [v4 identifier];
  LODWORD(v5) = [v5 containsObject:v6];

  if (v5)
  {
    v7 = v3;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)audioDestinationControllerDataForDestination:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self appleMediaAccessories];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __56__HMDHome_audioDestinationControllerDataForDestination___block_invoke;
  v10[3] = &unk_278688F28;
  v11 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v10];

  v8 = [v7 audioDestinationControllerData];

  return v8;
}

uint64_t __56__HMDHome_audioDestinationControllerDataForDestination___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 audioDestinationControllerData];
  v4 = [v3 destinationIdentifier];
  v5 = [*(a1 + 32) uniqueIdentifier];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

- (id)mediaSystemForAppleMediaAccessory:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v5 = [(HMDHome *)self mediaSystems];
  v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v6)
  {
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if (_mediaSystemContainsAccessory(v9, v4))
        {
          v6 = v9;
          goto LABEL_11;
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v10 = *MEMORY[0x277D85DE8];

  return v6;
}

- (NSArray)appleMediaAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_1329];

  return v3;
}

void *__32__HMDHome_appleMediaAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)_setAccessories:(id)a3
{
  v7 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if (v7)
  {
    v4 = [v7 na_dictionaryWithKeyGenerator:&__block_literal_global_1327];
    v5 = [v4 mutableCopy];
    accessories = self->_accessories;
    self->_accessories = v5;
  }

  else
  {
    [(NSMutableDictionary *)self->_accessories removeAllObjects];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)setAccessories:(id)a3
{
  v29 = *MEMORY[0x277D85DE8];
  v4 = a3;
  [(HMDHome *)self _setAccessories:v4];
  v25 = 0u;
  v26 = 0u;
  v23 = 0u;
  v24 = 0u;
  v5 = v4;
  v6 = [v5 countByEnumeratingWithState:&v23 objects:v28 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v24;
    do
    {
      v9 = 0;
      do
      {
        if (*v24 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v23 + 1) + 8 * v9);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v12)
        {
          v21 = 0u;
          v22 = 0u;
          v19 = 0u;
          v20 = 0u;
          v13 = [(HMDHome *)self serviceGroups];
          v14 = [v13 countByEnumeratingWithState:&v19 objects:v27 count:16];
          if (v14)
          {
            v15 = v14;
            v16 = *v20;
            do
            {
              v17 = 0;
              do
              {
                if (*v20 != v16)
                {
                  objc_enumerationMutation(v13);
                }

                [*(*(&v19 + 1) + 8 * v17++) fixupServicesForReplacementAccessory:v12];
              }

              while (v15 != v17);
              v15 = [v13 countByEnumeratingWithState:&v19 objects:v27 count:16];
            }

            while (v15);
          }
        }

        ++v9;
      }

      while (v9 != v7);
      v7 = [v5 countByEnumeratingWithState:&v23 objects:v28 count:16];
    }

    while (v7);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (NSArray)accessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableDictionary *)self->_accessories allValues];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (HMDAccessory)currentAccessory
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_firstObjectPassingTest:&__block_literal_global_1325];

  return v3;
}

uint64_t __27__HMDHome_currentAccessory__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = v4;
  if (v4)
  {
    v6 = [v4 isCurrentAccessory];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)_handleRemoveZoneModel:(id)a3 message:(id)a4
{
  v35[5] = *MEMORY[0x277D85DE8];
  v27 = a3;
  v28 = a4;
  v29 = [v27 uuid];
  v6 = [(HMDHome *)self zoneWithUUID:v29];
  v7 = v6;
  if (v6)
  {
    v8 = [v6 name];
    v9 = [(HMDHome *)self removeName:v8];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_zones removeObject:v7];
    os_unfair_recursive_lock_unlock();
    v26 = [v28 transactionResult];
    [v26 markChanged];
    [v26 markSaveToAssistant];
    v34[0] = *MEMORY[0x277CD0640];
    v10 = [(HMDHome *)self uuid];
    v11 = [v10 UUIDString];
    v35[0] = v11;
    v34[1] = *MEMORY[0x277CD27B0];
    v12 = [v7 name];
    v35[1] = v12;
    v34[2] = *MEMORY[0x277CD27B8];
    v13 = [v7 uuid];
    v14 = [v13 UUIDString];
    v35[2] = v14;
    v34[3] = *MEMORY[0x277CD15F0];
    v15 = [v7 spiClientIdentifier];
    v16 = [v15 UUIDString];
    v35[3] = v16;
    v34[4] = *MEMORY[0x277CD15E8];
    v17 = [v7 urlString];
    v35[4] = v17;
    v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:5];

    logAndPostNotification(@"HMDZoneRemovedNotification", v7, v25);
    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      v22 = [v7 name];
      *buf = 138543618;
      v31 = v21;
      v32 = 2112;
      v33 = v22;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Removed zone: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
  }

  else
  {
    v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v28 respondWithError:v23];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveZone:(id)a3
{
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD27B8]];
  v6 = [(HMDHome *)self zoneWithUUID:v5];
  if (v6)
  {
    v7 = [HMDZoneModel alloc];
    v8 = [(HMDHome *)self uuid];
    v9 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v5 parentUUID:v8];

    v10 = [(HMDHome *)self backingStore];
    v11 = [v4 name];
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [v10 transaction:v11 options:v12];

    [v13 add:v9];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __29__HMDHome__handleRemoveZone___block_invoke;
    v14[3] = &unk_27868A250;
    v15 = v4;
    [v13 run:v14];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v9];
  }
}

- (void)_handleAddZoneModel:(id)a3 message:(id)a4
{
  v35 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 name];
  v9 = [v8 hm_truncatedNameString];

  v28 = [v6 uuid];
  if (v9 && v28)
  {
    v10 = [[HMDZone alloc] initWithName:v9 uuid:v28 home:self];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_zones addObject:v10];
    os_unfair_recursive_lock_unlock();
    v11 = [(HMDHome *)self msgDispatcher];
    v12 = [(HMDHome *)self workQueue];
    [(HMDZone *)v10 configure:v11 queue:v12];

    [(HMDZone *)v10 updateZoneWithModel:v6 message:v7 error:0];
    v13 = [v7 transactionResult];
    [v13 markChanged];
    v14 = [(HMDZone *)v10 roomUUIDs];
    v15 = [v14 count];

    if (v15)
    {
      [v13 markSaveToAssistant];
    }

    v29[0] = *MEMORY[0x277CD0640];
    v16 = [(HMDHome *)self uuid];
    v17 = [v16 UUIDString];
    v18 = *MEMORY[0x277CD27B0];
    v30[0] = v17;
    v30[1] = v9;
    v19 = *MEMORY[0x277CD27B8];
    v29[1] = v18;
    v29[2] = v19;
    v20 = [(HMDZone *)v10 uuid];
    v21 = [v20 UUIDString];
    v30[2] = v21;
    v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:v29 count:3];

    logAndPostNotification(@"HMDZoneAddedNotification", v10, v22);
    [v7 respondWithPayload:0];
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    v24 = self;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v32 = v26;
      v33 = 2112;
      v34 = v9;
      _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; invalid parameter", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v7 respondWithError:v10];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddZone:(id)a3
{
  v47 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CD27B0]];
  v6 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
  v7 = v6;
  if (v5)
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (!v8)
  {
    v11 = HMMaxLengthForNaming();
    if ([v5 length] > v11)
    {
      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        v15 = HMFGetLogIdentifier();
        *buf = 138543362;
        v44 = v15;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v12);
      v9 = MEMORY[0x277CCA9B8];
      v10 = 46;
      goto LABEL_11;
    }

    v16 = [(HMDHome *)self zoneWithName:v5];
    if (v16)
    {
      v17 = MEMORY[0x277CCA9B8];
      v18 = 1;
    }

    else
    {
      v19 = [(HMDHome *)self zones];
      v20 = [v19 count];
      v21 = maximumZonesPerHome;

      if (v20 < v21)
      {
        v22 = [(HMDHome *)self addName:v5];
        if (!v22)
        {
          v32 = [HMDZoneModel alloc];
          v33 = [(HMDHome *)self uuid];
          v34 = [(HMDBackingStoreModelObject *)v32 initWithObjectChangeType:1 uuid:v7 parentUUID:v33];

          [(HMDZoneModel *)v34 setName:v5];
          v35 = [(HMDHome *)self backingStore];
          v36 = [v4 name];
          v37 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v38 = [v35 transaction:v36 options:v37];

          [v38 add:v34];
          v39[0] = MEMORY[0x277D85DD0];
          v39[1] = 3221225472;
          v39[2] = __26__HMDHome__handleAddZone___block_invoke;
          v39[3] = &unk_278688D58;
          v40 = v4;
          v41 = v7;
          v42 = v5;
          [v38 run:v39];

          goto LABEL_24;
        }

        v23 = objc_autoreleasePoolPush();
        v24 = self;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          v26 = HMFGetLogIdentifier();
          *buf = 138543618;
          v44 = v26;
          v45 = 2112;
          v46 = v5;
          _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; invalid parameter", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
LABEL_23:
        [v4 respondWithError:v22];
LABEL_24:

        goto LABEL_25;
      }

      v27 = objc_autoreleasePoolPush();
      v28 = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543618;
        v44 = v30;
        v45 = 2112;
        v46 = v5;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; already at maximum zones for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v27);
      v17 = MEMORY[0x277CCA9B8];
      v18 = 49;
    }

    v22 = [v17 hmErrorWithCode:v18];
    goto LABEL_23;
  }

  v9 = MEMORY[0x277CCA9B8];
  v10 = 20;
LABEL_11:
  v16 = [v9 hmErrorWithCode:v10];
  [v4 respondWithError:v16];
LABEL_25:

  v31 = *MEMORY[0x277D85DE8];
}

void __26__HMDHome__handleAddZone___block_invoke(uint64_t a1, uint64_t a2)
{
  v10[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v9[0] = *MEMORY[0x277CD27B8];
    v6 = [*(a1 + 40) UUIDString];
    v9[1] = *MEMORY[0x277CD27B0];
    v10[0] = v6;
    v10[1] = *(a1 + 48);
    v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v10 forKeys:v9 count:2];
    [v2 respondWithPayload:v7];

    v8 = *MEMORY[0x277D85DE8];
  }
}

- (void)test_addZones:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_zones addObjectsFromArray:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)zones
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_zones copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleRemoveRoomModel:(id)a3 message:(id)a4
{
  v67 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v50 = a4;
  v47 = v6;
  v48 = [v6 uuid];
  v7 = [(HMDHome *)self roomWithUUID:v48];
  v8 = v7;
  if (!v7)
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v50 respondWithError:v14];
    goto LABEL_6;
  }

  v9 = [v7 uuid];
  v10 = [(HMDHome *)self roomForEntireHome];
  v11 = [v10 uuid];
  v12 = [v9 isEqual:v11];

  if (v12)
  {
    v13 = [v50 responseHandler];

    if (v13)
    {
      v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:29];
      v15 = [v50 responseHandler];
      (v15)[2](v15, v14, 0);

LABEL_6:
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v49 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [v8 name];
      *buf = 138543618;
      v64 = v18;
      v65 = 2112;
      v66 = v19;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Remove room: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v61[0] = *MEMORY[0x277CD0640];
    v20 = [(HMDHome *)v49 uuid];
    v21 = [v20 UUIDString];
    v62[0] = v21;
    v61[1] = *MEMORY[0x277CD0D30];
    v22 = [v8 name];
    v62[1] = v22;
    v61[2] = *MEMORY[0x277CD0D40];
    v23 = [v48 UUIDString];
    v62[2] = v23;
    v61[3] = *MEMORY[0x277CD0D38];
    v24 = [v8 spiClientIdentifier];
    v25 = [v24 UUIDString];
    v62[3] = v25;
    v61[4] = *MEMORY[0x277CD0D28];
    v26 = [v8 urlString];
    v62[4] = v26;
    v46 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v62 forKeys:v61 count:5];

    logAndPostNotification(@"HMDRoomRemovedNotification", v8, v46);
    v57 = 0u;
    v58 = 0u;
    v55 = 0u;
    v56 = 0u;
    v27 = [(HMDHome *)v49 zones];
    v28 = [v27 countByEnumeratingWithState:&v55 objects:v60 count:16];
    if (v28)
    {
      v29 = *v56;
      do
      {
        for (i = 0; i != v28; ++i)
        {
          if (*v56 != v29)
          {
            objc_enumerationMutation(v27);
          }

          [*(*(&v55 + 1) + 8 * i) removeRoom:v8];
        }

        v28 = [v27 countByEnumeratingWithState:&v55 objects:v60 count:16];
      }

      while (v28);
    }

    v53 = 0u;
    v54 = 0u;
    v51 = 0u;
    v52 = 0u;
    v31 = [(HMDHome *)v49 accessories];
    v32 = [v31 countByEnumeratingWithState:&v51 objects:v59 count:16];
    if (v32)
    {
      v33 = *v52;
      do
      {
        for (j = 0; j != v32; ++j)
        {
          if (*v52 != v33)
          {
            objc_enumerationMutation(v31);
          }

          v35 = *(*(&v51 + 1) + 8 * j);
          v36 = [v8 uuid];
          v37 = [v35 room];
          v38 = [v37 uuid];
          v39 = [v36 isEqual:v38];

          if (v39)
          {
            v40 = [v50 transactionResult];
            v41 = [(HMDHome *)v49 roomForEntireHome];
            [v35 updateRoom:v41 source:{objc_msgSend(v40, "source")}];
          }
        }

        v32 = [v31 countByEnumeratingWithState:&v51 objects:v59 count:16];
      }

      while (v32);
    }

    v42 = [v8 name];
    v43 = [(HMDHome *)v49 removeName:v42];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)v49->_rooms removeObject:v8];
    os_unfair_recursive_lock_unlock();
    v44 = [v50 transactionResult];
    [v44 markChanged];
    [v44 markSaveToAssistant];
    [v50 respondWithPayload:v46];
  }

  v45 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveRoom:(id)a3
{
  v61 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD0D40]];
  if (!v5)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v4 messagePayload];
      *buf = 138543618;
      v58 = v19;
      v59 = 2112;
      v60 = v20;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot find room UUID in remove room message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
    goto LABEL_9;
  }

  v6 = [(HMDHome *)self roomForEntireHome];
  v7 = [v6 uuid];
  v8 = [v5 isEqual:v7];

  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [(HMDHome *)v10 roomForEntireHome];
      *buf = 138543618;
      v58 = v12;
      v59 = 2112;
      v60 = v13;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle request to remove roomForEntireHome: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 29;
LABEL_9:
    v21 = [v14 hmErrorWithCode:v15];
    [v4 respondWithError:v21];
    goto LABEL_29;
  }

  v21 = [(HMDHome *)self roomWithUUID:v5];
  v22 = objc_autoreleasePoolPush();
  v51 = self;
  v23 = HMFGetOSLogHandle();
  v24 = v23;
  if (v21)
  {
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v25;
      v59 = 2112;
      v60 = v21;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Removing room: %@", buf, 0x16u);
    }

    v49 = v21;

    objc_autoreleasePoolPop(v22);
    v26 = [HMDRoomModel alloc];
    v27 = [(HMDHome *)v51 uuid];
    v28 = [(HMDBackingStoreModelObject *)v26 initWithObjectChangeType:3 uuid:v5 parentUUID:v27];

    v29 = [(HMDHome *)v51 backingStore];
    [v4 name];
    v31 = v30 = v4;
    v32 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v33 = [v29 transaction:v31 options:v32];

    v48 = v28;
    v50 = v30;
    [v33 add:v28 withMessage:v30];
    v54 = 0u;
    v55 = 0u;
    v52 = 0u;
    v53 = 0u;
    v34 = [(HMDHome *)v51 accessories];
    v35 = [v34 countByEnumeratingWithState:&v52 objects:v56 count:16];
    if (v35)
    {
      v36 = v35;
      v37 = *v53;
      do
      {
        for (i = 0; i != v36; ++i)
        {
          if (*v53 != v37)
          {
            objc_enumerationMutation(v34);
          }

          v39 = *(*(&v52 + 1) + 8 * i);
          v40 = [v39 room];
          v41 = [v40 uuid];
          v42 = [v5 isEqual:v41];

          if (v42)
          {
            v43 = [(HMDHome *)v51 roomForEntireHome];
            v44 = [v39 modelWithUpdatedRoom:v43];

            if (v44)
            {
              [v33 add:v44];
            }
          }
        }

        v36 = [v34 countByEnumeratingWithState:&v52 objects:v56 count:16];
      }

      while (v36);
    }

    [v33 run];
    v21 = v49;
    v4 = v50;
    v45 = v48;
  }

  else
  {
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v46;
      v59 = 2112;
      v60 = v5;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Could not find room to remove with UUID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v45 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v45];
  }

LABEL_29:
  v47 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddRoomModel:(id)a3 message:(id)a4
{
  v38 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 name];
  v31 = [v6 uuid];
  if (v8 && v31)
  {
    v9 = [v8 hm_truncatedNameString];

    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v35 = v13;
      v36 = 2112;
      v37 = v9;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Add room: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [[HMDRoom alloc] initWithName:v9 uuid:v31 home:v11];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)v11->_rooms addObject:v14];
    os_unfair_recursive_lock_unlock();
    v15 = [(HMDHome *)v11 msgDispatcher];
    v16 = [(HMDHome *)v11 workQueue];
    [(HMDRoom *)v14 configure:v15 queue:v16];

    v17 = [v7 transactionResult];
    [v17 markChanged];
    [v17 markSaveToAssistant];
    v32[0] = *MEMORY[0x277CD0640];
    v18 = [(HMDHome *)v11 uuid];
    v19 = [v18 UUIDString];
    v20 = *MEMORY[0x277CD0D30];
    v33[0] = v19;
    v33[1] = v9;
    v21 = *MEMORY[0x277CD0D40];
    v32[1] = v20;
    v32[2] = v21;
    v22 = [(HMDRoom *)v14 uuid];
    v23 = [v22 UUIDString];
    v33[2] = v23;
    v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v33 forKeys:v32 count:3];

    logAndPostNotification(@"HMDRoomAddedNotification", v14, v24);
    [v7 respondWithPayload:v24];

    v8 = v9;
    goto LABEL_10;
  }

  v25 = objc_autoreleasePoolPush();
  v26 = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
  {
    v28 = HMFGetLogIdentifier();
    *buf = 138543618;
    v35 = v28;
    v36 = 2112;
    v37 = v8;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@; invalid parameter", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v25);
  v29 = [v7 responseHandler];

  if (v29)
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v17 = [v7 responseHandler];
    (v17)[2](v17, v14, 0);
LABEL_10:
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddRoom:(id)a3
{
  v41 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CD0D30]];
  v6 = HMMaxLengthForNaming();
  if ([v5 length] <= v6)
  {
    v12 = [(HMDHome *)self roomWithName:v5];
    if (v12)
    {
      v11 = v12;
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:1];
      [v4 respondWithError:v13];

      goto LABEL_17;
    }

    v14 = [(HMDHome *)self rooms];
    v15 = [v14 count];
    v16 = maximumRoomsPerHome;

    if (v15 >= v16)
    {
      v22 = objc_autoreleasePoolPush();
      v23 = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        v25 = HMFGetLogIdentifier();
        v35 = 138543618;
        v36 = v25;
        v37 = 2112;
        v38 = v5;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@ to home; already at maximum rooms for home", &v35, 0x16u);
      }

      objc_autoreleasePoolPop(v22);
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    }

    else
    {
      v17 = [(HMDHome *)self addName:v5];
      if (!v17)
      {
        v27 = [HMDRoomModel alloc];
        v28 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
        v29 = [(HMDHome *)self uuid];
        v30 = [(HMDBackingStoreModelObject *)v27 initWithObjectChangeType:1 uuid:v28 parentUUID:v29];

        [(HMDRoomModel *)v30 setName:v5];
        v31 = [(HMDHome *)self backingStore];
        v32 = [v4 name];
        v33 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v34 = [v31 transaction:v32 options:v33];

        [v34 add:v30 withMessage:v4];
        [v34 run];

        goto LABEL_16;
      }

      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        v35 = 138543874;
        v36 = v21;
        v37 = 2112;
        v38 = v5;
        v39 = 2112;
        v40 = v17;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@ to home; namespace error %@", &v35, 0x20u);
      }

      objc_autoreleasePoolPop(v18);
    }

    [v4 respondWithError:v17];
LABEL_16:

    v11 = 0;
    goto LABEL_17;
  }

  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v35 = 138543362;
    v36 = v10;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v35, 0xCu);
  }

  objc_autoreleasePoolPop(v7);
  v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
  [v4 respondWithError:v11];
LABEL_17:

  v26 = *MEMORY[0x277D85DE8];
}

- (void)test_addRooms:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_rooms addObjectsFromArray:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)rooms
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_rooms copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleHomeDataRequest:(id)a3
{
  v5 = a3;
  v4 = [(HMDHome *)self residentSyncManager];
  [v4 performSync];

  [v5 respondWithSuccess];
}

- (id)_handleRenameHomeModel:(id)a3 message:(id)a4
{
  v24[2] = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = [a3 name];
  v8 = [v7 hm_truncatedNameString];

  if (v8 && [v8 length])
  {
    v9 = [v6 transactionResult];
    v10 = [v9 label];
    v11 = [v10 isEqualToString:*MEMORY[0x277CD2540]];

    if ((v11 & 1) == 0)
    {
      v12 = [(HMDHome *)self homeManager];
      v13 = [(HMDHome *)self name];
      v14 = [v12 uuid];
      v24[0] = v14;
      v15 = [(HMDHome *)self uuid];
      v24[1] = v15;
      v16 = [MEMORY[0x277CBEA60] arrayWithObjects:v24 count:2];
      v17 = [v12 replaceName:v13 withNewName:v8 inNamespaces:v16];
    }

    [(HMDHome *)self setName:v8];
    v22 = @"HMDHomeNameNotificationKey";
    v23 = v8;
    v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v23 forKeys:&v22 count:1];
    logAndPostNotification(@"HMDHomeNameChangedNotification", self, v18);

    v19 = 0;
  }

  else
  {
    v19 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
  }

  v20 = *MEMORY[0x277D85DE8];

  return v19;
}

- (void)_handleRename:(id)a3
{
  v35 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CD23D0]];
  v6 = HMMaxLengthForNaming();
  if ([v5 length] <= v6)
  {
    v11 = [(HMDHome *)self homeManager];
    v12 = [(HMDHome *)self name];
    v13 = [v11 uuid];
    v32[0] = v13;
    v14 = [(HMDHome *)self uuid];
    v32[1] = v14;
    v15 = [MEMORY[0x277CBEA60] arrayWithObjects:v32 count:2];
    v16 = [v11 replaceName:v12 withNewName:v5 inNamespaces:v15];

    if (v16)
    {
      if ([(HMDHomeModel *)v16 code]== 31)
      {
        v17 = MEMORY[0x277CCA9B8];
        v18 = *MEMORY[0x277CCFD28];
        v19 = [(HMDHomeModel *)v16 userInfo];
        v20 = [v17 errorWithDomain:v18 code:32 userInfo:v19];

        v16 = v20;
      }

      [v4 respondWithError:v16];
    }

    else
    {
      v21 = [HMDHomeModel alloc];
      v22 = [(HMDHome *)self uuid];
      v23 = [v11 uuid];
      v16 = [(HMDBackingStoreModelObject *)v21 initWithObjectChangeType:2 uuid:v22 parentUUID:v23];

      [(HMDHomeModel *)v16 setName:v5];
      v24 = [(HMDHome *)self backingStore];
      v25 = [v4 name];
      v26 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v27 = [v24 transaction:v25 options:v26];

      [v27 add:v16];
      v29[0] = MEMORY[0x277D85DD0];
      v29[1] = 3221225472;
      v29[2] = __25__HMDHome__handleRename___block_invoke;
      v29[3] = &unk_27868A1D8;
      v30 = v4;
      v31 = v5;
      [v27 run:v29];
    }
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v34 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
    [v4 respondWithError:v11];
  }

  v28 = *MEMORY[0x277D85DE8];
}

void __25__HMDHome__handleRename___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v5 = *(a1 + 40);
    v8 = *MEMORY[0x277CD23D0];
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [v2 respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (id)_unexpectedCharacteristicsFromCharacteristicNotifications:(id)a3
{
  v94 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self notificationRegistrations];
  v6 = [v5 count];

  if (v6)
  {
    v7 = MEMORY[0x277CBEBF8];
    goto LABEL_42;
  }

  v59 = [MEMORY[0x277CBEB18] array];
  context = objc_autoreleasePoolPush();
  v8 = [v4 allKeys];
  v82[0] = MEMORY[0x277D85DD0];
  v82[1] = 3221225472;
  v82[2] = __69__HMDHome__unexpectedCharacteristicsFromCharacteristicNotifications___block_invoke;
  v82[3] = &unk_27866FAC0;
  v45 = v4;
  v48 = v4;
  v83 = v48;
  v84 = self;
  v43 = v8;
  v9 = [v8 na_map:v82];
  v80 = 0;
  v81 = 0;
  [(HMDHome *)self _notificationPayloadsForRemoteGateway:v9 accessories:&v81 enableCharacteristicNotificationPayload:0 characteristicNotificationThresholdsPayload:&v80 disableCharacteristicNotificationPayload:0 enableMediaNotificationPayload:0 disableMediaNotificationPayload:?];
  v50 = v81;
  v49 = v80;
  v76 = 0u;
  v77 = 0u;
  v78 = 0u;
  v79 = 0u;
  obj = v9;
  v51 = [obj countByEnumeratingWithState:&v76 objects:v93 count:16];
  if (!v51)
  {
    goto LABEL_41;
  }

  v47 = *v77;
  v65 = *MEMORY[0x277CD21C0];
  v61 = self;
  do
  {
    v10 = 0;
    do
    {
      if (*v77 != v47)
      {
        objc_enumerationMutation(obj);
      }

      v52 = v10;
      v11 = *(*(&v76 + 1) + 8 * v10);
      v12 = [v11 uuid];
      v13 = [v12 UUIDString];

      v55 = [v48 hmf_dictionaryForKey:v13];
      [v50 hmf_arrayForKey:v13];
      v63 = v62 = v13;
      v60 = [v49 hmf_arrayForKey:v13];
      v72 = 0u;
      v73 = 0u;
      v74 = 0u;
      v75 = 0u;
      v53 = [v11 services];
      v56 = [v53 countByEnumeratingWithState:&v72 objects:v92 count:16];
      if (v56)
      {
        v54 = *v73;
        do
        {
          for (i = 0; i != v56; ++i)
          {
            if (*v73 != v54)
            {
              objc_enumerationMutation(v53);
            }

            v15 = *(*(&v72 + 1) + 8 * i);
            v16 = [v15 instanceID];
            v17 = [v16 stringValue];
            v18 = [v55 hmf_dictionaryForKey:v17];

            if (v18)
            {
              v57 = i;
              v70 = 0u;
              v71 = 0u;
              v68 = 0u;
              v69 = 0u;
              v64 = [v15 characteristics];
              v67 = [v64 countByEnumeratingWithState:&v68 objects:v91 count:16];
              if (!v67)
              {
                goto LABEL_36;
              }

              v66 = *v69;
              while (1)
              {
                for (j = 0; j != v67; ++j)
                {
                  if (*v69 != v66)
                  {
                    objc_enumerationMutation(v64);
                  }

                  v20 = *(*(&v68 + 1) + 8 * j);
                  v21 = [v20 instanceID];
                  v22 = [v21 stringValue];
                  v23 = [v18 objectForKey:v22];

                  if (v23)
                  {
                    v24 = [v21 stringValueSafe];
                    v25 = [v18 hmf_dictionaryForKey:v24];

                    v26 = [v25 hmf_numberForKey:v65];
                    v27 = v26;
                    if (v26 && ([v26 unsignedIntegerValue] & 1) != 0)
                    {
                      v28 = objc_autoreleasePoolPush();
                      v29 = self;
                      v30 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
                      {
                        v31 = HMFGetLogIdentifier();
                        v32 = [v20 shortDescription];
                        *buf = 138543874;
                        v86 = v31;
                        v87 = 2112;
                        v88 = v32;
                        v89 = 2112;
                        v90 = v62;
                        v33 = v30;
                        v34 = OS_LOG_TYPE_INFO;
                        v35 = "%{public}@Received persistent characteristic changed notification for bulletin characteristic (%@), accessoryUUID %@";
LABEL_31:
                        _os_log_impl(&dword_229538000, v33, v34, v35, buf, 0x20u);

                        self = v61;
                      }

LABEL_32:

                      objc_autoreleasePoolPop(v28);
                    }

                    else
                    {
                      if ([v63 containsObject:v21])
                      {
                        v28 = objc_autoreleasePoolPush();
                        v29 = self;
                        v30 = HMFGetOSLogHandle();
                        if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
                        {
                          v31 = HMFGetLogIdentifier();
                          v32 = [v20 shortDescription];
                          *buf = 138543874;
                          v86 = v31;
                          v87 = 2112;
                          v88 = v32;
                          v89 = 2112;
                          v90 = v62;
                          v33 = v30;
                          v34 = OS_LOG_TYPE_DEBUG;
                          v35 = "%{public}@Received persistent characteristic changed notification for characteristic (%@), accessoryUUID %@";
                          goto LABEL_31;
                        }

                        goto LABEL_32;
                      }

                      if ([v60 containsObject:v21])
                      {
                        v36 = objc_autoreleasePoolPush();
                        v37 = self;
                        v38 = HMFGetOSLogHandle();
                        if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
                        {
                          v39 = HMFGetLogIdentifier();
                          [v20 shortDescription];
                          v40 = v58 = v36;
                          *buf = 138543874;
                          v86 = v39;
                          v87 = 2112;
                          v88 = v40;
                          v89 = 2112;
                          v90 = v62;
                          _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_ERROR, "%{public}@Received unexpected characteristic changed notification for characteristic (%@), accessoryUUID %@", buf, 0x20u);

                          v36 = v58;
                          self = v61;
                        }

                        objc_autoreleasePoolPop(v36);
                        [v59 addObject:v20];
                      }
                    }
                  }
                }

                v67 = [v64 countByEnumeratingWithState:&v68 objects:v91 count:16];
                if (!v67)
                {
LABEL_36:

                  i = v57;
                  break;
                }
              }
            }
          }

          v56 = [v53 countByEnumeratingWithState:&v72 objects:v92 count:16];
        }

        while (v56);
      }

      v10 = v52 + 1;
    }

    while (v52 + 1 != v51);
    v51 = [obj countByEnumeratingWithState:&v76 objects:v93 count:16];
  }

  while (v51);
LABEL_41:

  objc_autoreleasePoolPop(context);
  v7 = [v59 copy];

  v4 = v45;
LABEL_42:

  v41 = *MEMORY[0x277D85DE8];

  return v7;
}

id __69__HMDHome__unexpectedCharacteristicsFromCharacteristicNotifications___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) objectForKeyedSubscript:v3];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  v6 = 0;
  if ((isKindOfClass & 1) != 0 && v4)
  {
    v7 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v3];
    v8 = [*(a1 + 40) accessoryWithUUID:v7];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v6 = v9;
  }

  return v6;
}

- (void)_notificationPayloadsForRemoteGateway:(void *)a3 accessories:(void *)a4 enableCharacteristicNotificationPayload:(void *)a5 characteristicNotificationThresholdsPayload:(void *)a6 disableCharacteristicNotificationPayload:(void *)a7 enableMediaNotificationPayload:(void *)a8 disableMediaNotificationPayload:
{
  v174 = *MEMORY[0x277D85DE8];
  v111 = a3;
  if (a1)
  {
    v9 = [MEMORY[0x277CBEB18] array];
    v157 = 0u;
    v158 = 0u;
    v159 = 0u;
    v160 = 0u;
    obj = [a1 triggers];
    v10 = [obj countByEnumeratingWithState:&v157 objects:v173 count:16];
    v126 = v9;
    v127 = a1;
    if (v10)
    {
      v11 = v10;
      v12 = *v158;
      context = *v158;
      do
      {
        v13 = 0;
        v132 = v11;
        do
        {
          if (*v158 != v12)
          {
            objc_enumerationMutation(obj);
          }

          v14 = *(*(&v157 + 1) + 8 * v13);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v15 = v14;
          }

          else
          {
            v15 = 0;
          }

          v16 = v15;

          if ([v16 shouldActivateOnLocalDevice])
          {
            v136 = v16;
            v138 = v13;
            v155 = 0u;
            v156 = 0u;
            v153 = 0u;
            v154 = 0u;
            v17 = [v16 characteristicEvents];
            v18 = [v17 countByEnumeratingWithState:&v153 objects:v172 count:16];
            if (v18)
            {
              v19 = v18;
              v20 = *v154;
              do
              {
                for (i = 0; i != v19; ++i)
                {
                  if (*v154 != v20)
                  {
                    objc_enumerationMutation(v17);
                  }

                  v22 = *(*(&v153 + 1) + 8 * i);
                  v23 = [v22 characteristic];

                  if (v23)
                  {
                    v24 = [v22 characteristic];
                    v9 = v126;
                    [v126 addObject:v24];
                  }

                  else
                  {
                    v25 = objc_autoreleasePoolPush();
                    v26 = a1;
                    v27 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
                    {
                      v28 = HMFGetLogIdentifier();
                      *buf = 138543618;
                      *&buf[4] = v28;
                      *&buf[12] = 2112;
                      *&buf[14] = v22;
                      _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Characteristic of HMDCharacteristicEvent %@ is nil!", buf, 0x16u);
                    }

                    objc_autoreleasePoolPop(v25);
                    v9 = v126;
                    a1 = v127;
                  }
                }

                v19 = [v17 countByEnumeratingWithState:&v153 objects:v172 count:16];
              }

              while (v19);
            }

            v12 = context;
            v11 = v132;
            v16 = v136;
            v13 = v138;
          }

          ++v13;
        }

        while (v13 != v11);
        v11 = [obj countByEnumeratingWithState:&v157 objects:v173 count:16];
      }

      while (v11);
    }

    v29 = 0x277CBE000uLL;
    v114 = [MEMORY[0x277CBEB38] dictionary];
    v112 = [MEMORY[0x277CBEB38] dictionary];
    v113 = [MEMORY[0x277CBEB38] dictionary];
    if (a7)
    {
      v30 = [MEMORY[0x277CBEB38] dictionary];
    }

    else
    {
      v30 = 0;
    }

    v105 = v30;
    if (a8)
    {
      v104 = [MEMORY[0x277CBEB38] dictionary];
    }

    else
    {
      v104 = 0;
    }

    v31 = 0x277CBE000uLL;
    v151 = 0u;
    v152 = 0u;
    v149 = 0u;
    v150 = 0u;
    v117 = v111;
    v32 = [v117 countByEnumeratingWithState:&v149 objects:v171 count:16];
    if (v32)
    {
      v33 = v32;
      v34 = *v150;
      v133 = *MEMORY[0x277CFE810];
      v115 = *v150;
      do
      {
        v35 = 0;
        v116 = v33;
        do
        {
          if (*v150 != v34)
          {
            objc_enumerationMutation(v117);
          }

          v36 = *(*(&v149 + 1) + 8 * v35);
          v37 = [*(v31 + 2840) array];
          v125 = [*(v31 + 2840) array];
          obja = [*(v29 + 2872) dictionary];
          v38 = v36;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v39 = v38;
          }

          else
          {
            v39 = 0;
          }

          v40 = v39;

          if (v40)
          {
            v119 = v35;
            v120 = v40;
            v128 = v37;
            if (shouldSkipRemoteAccessoryNotificationRegistration(a1))
            {
              v41 = objc_autoreleasePoolPush();
              v42 = a1;
              v43 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
              {
                v44 = HMFGetLogIdentifier();
                *&buf[8] = 0;
                *buf = 0;
                v45 = [v120 uuid];

                if (v45)
                {
                  v46 = [v120 uuid];
                  [v46 getUUIDBytes:buf];
                }

                else
                {
                  *buf = *MEMORY[0x277D0F960];
                }

                v170 = *buf;
                *buf = 138543874;
                *&buf[4] = v44;
                *&buf[12] = 1040;
                *&buf[14] = 16;
                *&buf[18] = 2096;
                *&buf[20] = &v170;
                _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@Dropping all characteristics for %{uuid_t}.16P from remote notification as partitioned network is no longer supported by residents", buf, 0x1Cu);

                v31 = 0x277CBE000;
                v29 = 0x277CBE000;
              }

              objc_autoreleasePoolPop(v41);
              v35 = v119;
              v37 = v128;
            }

            else
            {
              v118 = v38;
              v147 = 0u;
              v148 = 0u;
              v145 = 0u;
              v146 = 0u;
              v121 = [v40 services];
              v47 = obja;
              v123 = [v121 countByEnumeratingWithState:&v145 objects:v169 count:16];
              if (v123)
              {
                v122 = *v146;
                do
                {
                  v48 = 0;
                  do
                  {
                    if (*v146 != v122)
                    {
                      objc_enumerationMutation(v121);
                    }

                    v124 = v48;
                    v49 = *(*(&v145 + 1) + 8 * v48);
                    v140 = [v49 type];
                    v141 = 0u;
                    v142 = 0u;
                    v143 = 0u;
                    v144 = 0u;
                    v50 = [v49 characteristics];
                    v51 = [v50 countByEnumeratingWithState:&v141 objects:v168 count:16];
                    if (v51)
                    {
                      v52 = v51;
                      v137 = v50;
                      v139 = *v142;
                      do
                      {
                        v53 = 0;
                        do
                        {
                          if (*v142 != v139)
                          {
                            objc_enumerationMutation(v50);
                          }

                          v54 = *(*(&v141 + 1) + 8 * v53);
                          if ([v54 supportsNotification])
                          {
                            v55 = [a1 dataSource];
                            v56 = [v55 hapMetadata];
                            v57 = [v56 shouldFilterEnableNotificationsForCharacteristicType:0 serviceType:v140];

                            if ((v57 & 1) == 0)
                            {
                              if ([v140 isEqualToString:v133])
                              {
                                v58 = [v54 type];
                                v59 = [v58 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"];
                              }

                              else
                              {
                                v59 = 0;
                              }

                              v60 = [a1 dataSource];
                              v61 = [v60 hapMetadata];
                              v62 = [v54 type];
                              v63 = [v61 shouldAutoEnableNotificationForCharacteristic:v62 ofService:v140];

                              v64 = [v54 isNonHomeNotificationsEnabled];
                              if (([v9 containsObject:v54] & 1) != 0 || (v64 & 1) != 0 || (v63 & 1) != 0 || v59)
                              {
                                contexta = objc_autoreleasePoolPush();
                                v70 = a1;
                                v71 = HMFGetOSLogHandle();
                                if (os_log_type_enabled(v71, OS_LOG_TYPE_DEBUG))
                                {
                                  v72 = HMFGetLogIdentifier();
                                  v73 = HMFBooleanToString();
                                  v74 = HMFBooleanToString();
                                  v75 = HMFBooleanToString();
                                  v76 = HMFBooleanToString();
                                  *buf = 138544642;
                                  *&buf[4] = v72;
                                  *&buf[12] = 2112;
                                  *&buf[14] = v54;
                                  *&buf[22] = 2112;
                                  *&buf[24] = v73;
                                  v162 = 2112;
                                  v163 = v74;
                                  v164 = 2112;
                                  v165 = v75;
                                  v166 = 2112;
                                  v167 = v76;
                                  _os_log_impl(&dword_229538000, v71, OS_LOG_TYPE_DEBUG, "%{public}@Enabling characteristic %@ because characteristicInEvent: %@ nonHomeNotificationsEnabled: %@ autoEnableNotification: %@ accessoryFlags: %@", buf, 0x3Eu);

                                  v9 = v126;
                                }

                                objc_autoreleasePoolPop(contexta);
                                v77 = [v54 changeThresholdForNonHomeClientEnabledNotifications];
                                v78 = [v70 dataSource];
                                v79 = [v78 hapMetadata];
                                v80 = [v54 type];
                                v81 = [v79 shouldEnableHomeNotificationForCharacteristicType:v80 serviceType:v140];

                                v47 = obja;
                                if (v77 && (v81 & a2 & 1) == 0)
                                {
                                  v82 = [v54 instanceID];
                                  v83 = [v82 stringValue];
                                  [obja setObject:v77 forKeyedSubscript:v83];
                                }

                                v84 = [v54 instanceID];
                                [v128 addObject:v84];

                                a1 = v127;
                                v50 = v137;
                              }

                              else if (a2)
                              {
                                v65 = [v54 type];
                                v66 = [a1 dataSource];
                                v67 = [v66 hapMetadata];
                                v68 = [v67 shouldEnableHomeNotificationForCharacteristicType:v65 serviceType:v140];

                                v50 = v137;
                                if (v68)
                                {
                                  v69 = [v54 instanceID];
                                  [v128 addObject:v69];
                                }

                                v47 = obja;
                              }

                              else
                              {
                                v47 = obja;
                                v50 = v137;
                                if ([v54 isClientNotificationEnabled])
                                {
                                  v85 = objc_autoreleasePoolPush();
                                  v86 = a1;
                                  v87 = HMFGetOSLogHandle();
                                  if (os_log_type_enabled(v87, OS_LOG_TYPE_DEFAULT))
                                  {
                                    v88 = HMFGetLogIdentifier();
                                    v89 = [v54 notificationRegistrations];
                                    *buf = 138543874;
                                    *&buf[4] = v88;
                                    *&buf[12] = 2112;
                                    *&buf[14] = v54;
                                    *&buf[22] = 2112;
                                    *&buf[24] = v89;
                                    _os_log_impl(&dword_229538000, v87, OS_LOG_TYPE_DEFAULT, "%{public}@Not disabling characteristic %@ because client(s) are registered: %@", buf, 0x20u);

                                    v50 = v137;
                                    v47 = obja;
                                  }

                                  objc_autoreleasePoolPop(v85);
                                }

                                else
                                {
                                  v90 = [v54 instanceID];
                                  [v125 addObject:v90];
                                }
                              }
                            }
                          }

                          ++v53;
                        }

                        while (v52 != v53);
                        v91 = [v50 countByEnumeratingWithState:&v141 objects:v168 count:16];
                        v52 = v91;
                      }

                      while (v91);
                    }

                    v48 = v124 + 1;
                  }

                  while (v124 + 1 != v123);
                  v123 = [v121 countByEnumeratingWithState:&v145 objects:v169 count:16];
                }

                while (v123);
              }

              v92 = [v118 uuid];
              v93 = [v92 UUIDString];

              v37 = v128;
              if ([v128 count])
              {
                v94 = [v128 copy];
                [v114 setObject:v94 forKeyedSubscript:v93];
              }

              v95 = [v47 count];
              v31 = 0x277CBE000;
              v96 = v47;
              v29 = 0x277CBE000;
              v34 = v115;
              v33 = v116;
              v35 = v119;
              if (v95)
              {
                v97 = [v96 copy];
                [v112 setObject:v97 forKeyedSubscript:v93];
              }

              if ([v125 count])
              {
                v98 = [v125 copy];
                [v113 setObject:v98 forKeyedSubscript:v93];
              }
            }

            v40 = v120;
          }

          ++v35;
        }

        while (v35 != v33);
        v33 = [v117 countByEnumeratingWithState:&v149 objects:v171 count:16];
      }

      while (v33);
    }

    v99 = [v114 copy];
    v100 = a5;
    *a4 = v99;
    if (a5)
    {
      *v100 = [v112 copy];
    }

    v101 = [v113 copy];
    v102 = a7;
    *a6 = v101;
    if (a7)
    {
      *v102 = [v105 copy];
    }

    if (a8)
    {
      *a8 = [v104 copy];
    }
  }

  v103 = *MEMORY[0x277D85DE8];
}

- (void)_updateWoWState:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        v10 = [v9 identifier];
        v11 = [v9 matchingHAPAccessoryWithServerIdentifier:v10 linkType:1];

        if ([v9 isReachable])
        {
          v12 = v11 == 0;
        }

        else
        {
          v12 = 1;
        }

        if (v12 || ![v9 isNonClientNotificationEnabled])
        {
          v13 = [(HMDHome *)self dataSource];
          v14 = [v13 netManager];
          [v14 deregisterWoWAssertionForObject:v9];
        }

        else
        {
          v13 = [(HMDHome *)self dataSource];
          v14 = [v13 netManager];
          [v14 registerWoWAssertionForObject:v9];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (HMDUserPresenceFeeder)presenceFeeder
{
  v3 = [(HMDHome *)self userActivityStateDetectorManager];
  v4 = [v3 presenceFeeder];

  presenceFeeder = v4;
  if (!v4)
  {
    presenceFeeder = self->_presenceFeeder;
  }

  v6 = presenceFeeder;

  return v6;
}

- (void)_configureUserActivityStateDetectorManager
{
  v34 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self featuresDataSource];
  v4 = [v3 isUserActivityStateDetectionFeatureEnabled];

  if (v4)
  {
    if ([HMDUserActivityStateDetectorManager shouldRunManagerForHome:self])
    {
      v5 = [(HMDHome *)self userActivityStateDetectorManager];

      if (v5)
      {
        v6 = objc_autoreleasePoolPush();
        v7 = self;
        v8 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
        {
          v9 = HMFGetLogIdentifier();
          v32 = 138543362;
          v33 = v9;
          _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@HMDUserActivityStateDetectorManager is already configured, updating configuration if needed", &v32, 0xCu);
        }

        objc_autoreleasePoolPop(v6);
        v10 = [(HMDHome *)v7 userActivityStateDetectorManager];
        [v10 updateConfiguration];
      }

      else
      {
        v17 = [(HMDHome *)self currentUser];

        if (v17)
        {
          v18 = [(HMDHome *)self homeActivityStateManager];

          if (v18)
          {
            v19 = [(HMDHome *)self homeActivityStateManager];
            v20 = [v19 dataSource];
          }

          else
          {
            v20 = [[HMDHomeActivityStateManagerDataSource alloc] initWithHome:self];
          }

          v25 = objc_autoreleasePoolPush();
          v26 = self;
          v27 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
          {
            v28 = HMFGetLogIdentifier();
            v32 = 138543362;
            v33 = v28;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Creating and configuring HMDUserActivityStateDetectorManager", &v32, 0xCu);
          }

          objc_autoreleasePoolPop(v25);
          v29 = [[HMDUserActivityStateDetectorManager alloc] initWithDataSource:v20];
          userActivityStateDetectorManager = v26->_userActivityStateDetectorManager;
          v26->_userActivityStateDetectorManager = v29;

          v31 = [(HMDHome *)v26 userActivityStateDetectorManager];
          [v31 configure];
        }

        else
        {
          v21 = objc_autoreleasePoolPush();
          v22 = self;
          v23 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
          {
            v24 = HMFGetLogIdentifier();
            v32 = 138543362;
            v33 = v24;
            _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Not initializing HMDUserActivityStateDetectorManager because the current user is not set", &v32, 0xCu);
          }

          objc_autoreleasePoolPop(v21);
        }
      }
    }

    else
    {
      v11 = objc_autoreleasePoolPush();
      v12 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v32 = 138543362;
        v33 = v14;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@HMDUserActivityStateDetectorManager is not expected to run", &v32, 0xCu);
      }

      objc_autoreleasePoolPop(v11);
      v15 = [(HMDHome *)v12 userActivityStateDetectorManager];
      [v15 unconfigure];

      [(HMDHome *)v12 setUserActivityStateDetectorManager:0];
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)configureUserActivityStateDetectorManager
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __52__HMDHome_configureUserActivityStateDetectorManager__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)handleUserActivityStateDetectorManagerChangeNotification:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __68__HMDHome_handleUserActivityStateDetectorManagerChangeNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

uint64_t __68__HMDHome_handleUserActivityStateDetectorManagerChangeNotification___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 40) name];
    v9 = 138543618;
    v10 = v5;
    v11 = 2112;
    v12 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  result = [*(a1 + 32) _configureUserActivityStateDetectorManager];
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_registerForNotifications
{
  v22 = [(HMDHome *)self notificationCenter];
  v3 = [(HMDHome *)self homeManager];
  v4 = [v3 connectionsManager];
  [v22 addObserver:self selector:sel_handleFirstProcessDidBecomeActiveNotification_ name:@"HMDHomeManagerFirstProcessDidBecomeActiveNotification" object:v4];

  v5 = [v3 connectionsManager];
  [v22 addObserver:self selector:sel_handleLastProcessDidBecomeInactiveNotification_ name:@"HMDHomeManagerLastProcessDidBecomeInactiveNotification" object:v5];

  [v22 addObserver:self selector:sel_handleClientProcessDisconnectedNotification_ name:@"HMDHomeManagerClientProcessDisconnectedNotification" object:0];
  [v22 addObserver:self selector:sel_handleAccessoryDidAddNetworkRouterControllerNotification_ name:@"HMDAccessoryDidAddNetworkRouterControllerNotification" object:self];
  [v22 addObserver:self selector:sel_handleAccessoryDidRemoveNetworkRouterControllerNotification_ name:@"HMDAccessoryDidRemoveNetworkRouterControllerNotification" object:self];
  v6 = [(HMDHome *)self currentUser];
  [v22 addObserver:self selector:sel_handleCurrentUserPrivilegeChanged_ name:@"HMDUserPrivilegeDidChangeNotification" object:v6];

  v7 = +[HMDAppleAccountManager sharedManager];
  [v22 addObserver:self selector:sel_handleActiveAccountChanged_ name:@"HMDAppleAccountManagerAccountUpdatedNotification" object:v7];

  [v22 addObserver:self selector:sel_handleAccountHandlesUpdated_ name:@"HMDAccountHandlesUpdatedNotification" object:0];
  [v22 addObserver:self selector:sel_handleCurrentAccountMergeIdentifierUpdated_ name:@"HMDAppleAccountMergeIdentifierUpdatedNotification" object:0];
  [v22 addObserver:self selector:sel_handleHAPAccessoryServicesAddedNotification_ name:@"kHMDNotificationServicesUpdated" object:0];
  [v22 addObserver:self selector:sel_handleHAPAccessoryCharacteristicsAddedNotification_ name:@"kHMDNotificationCharacteristicsUpdated" object:0];
  [v22 addObserver:self selector:sel___handleProcessStateChange_ name:HMDProcessMonitorProcessStateDidChangeNotification object:0];
  [v22 addObserver:self selector:sel_handleAccessoryReachabilityChangeNotification_ name:@"HMDAccessoryIsReachableNotification" object:0];
  [v22 addObserver:self selector:sel_handleAccessoryReachabilityChangeNotification_ name:@"HMDAccessoryIsNotReachableNotification" object:0];
  [v22 addObserver:self selector:sel_handleRemovedMediaSessions_ name:@"HMDMediaSessionsRemovedNotification" object:0];
  [v22 addObserver:self selector:sel_handleXPCConnectionInvalidated_ name:@"HMDXPCClientConnectionDidInvalidateNotification" object:0];
  [v22 addObserver:self selector:sel_handlePrimaryResidentChangeNotification_ name:@"HMDResidentDeviceConfirmedStateChangedNotification" object:0];
  if (isiOSDevice())
  {
    [v22 addObserver:self selector:sel_handleDidReceiveIDSMessageWithNoListener_ name:@"HMDDidReceiveRemoteMessageWithNoListenerNotification" object:0];
  }

  [v22 addObserver:self selector:sel_handleSiriEndPointAddedNotification_ name:@"HMDSiriEndpointProfileAddedNotification" object:0];
  [v22 addObserver:self selector:sel_handleFindResidentsNotification_ name:@"HMDPrimaryResidentDiscoveryFindResidentsNotification" object:0];
  [v22 addObserver:self selector:sel_handleHomeDataLoaded_ name:@"HMDHomeManagerHomeDataLoadedNotification" object:0];
  v8 = [v3 mobileAssetManager];
  [v22 addObserver:self selector:sel_handleMobileAssetsUpdatedNotification_ name:@"HMDMobileAssetManagerFoundUpdateNotification" object:v8];

  v9 = [MEMORY[0x277CCAB98] defaultCenter];
  [v9 addObserver:self selector:sel_checkForCATIDUpdate_ name:@"HMDFMFStatusUpdateNotification" object:0];

  v10 = [(HMDHome *)self featuresDataSource];
  LODWORD(v8) = [v10 isUserActivityStateDetectionFeatureEnabled];

  if (v8)
  {
    v11 = [MEMORY[0x277CCAB98] defaultCenter];
    [v11 addObserver:self selector:sel_handleUserActivityStateDetectorManagerChangeNotification_ name:@"HMDFMFStatusUpdateNotification" object:0];
  }

  v12 = [(HMDHome *)self featuresDataSource];
  v13 = [v12 isUserActivityStateDetectionFeatureEnabled];

  if (v13)
  {
    v14 = [MEMORY[0x277CCAB98] defaultCenter];
    [v14 addObserver:self selector:sel_handleUserActivityStateDetectorManagerChangeNotification_ name:@"HMDAccessorySupportsAdaptiveTemperatureAutomationsDidChangeNotification" object:self];
  }

  v15 = [(HMDHome *)self localCapabilitiesDataSource];
  v16 = [v15 isResidentCapable];

  if (v16)
  {
    v17 = [(HMDHome *)self notificationCenter];
    v18 = [(HMDHome *)self primaryResidentChangeMonitor];
    [v17 addObserver:self selector:sel_handlePrimaryResidentIsCurrentDeviceChangeNotification_ name:@"HMDPrimaryResidentChangeMonitorIsCurrentDeviceChangeNotification" object:v18];

    v19 = [(HMDHome *)self notificationCenter];
    v20 = [(HMDHome *)self primaryResidentChangeMonitor];
    [v19 addObserver:self selector:sel_handlePrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification_ name:@"HMDPrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification" object:v20];
  }

  v21 = [MEMORY[0x277CCAB98] defaultCenter];
  [v21 addObserver:self selector:sel_handleUserFabricKeyUpdate_ name:*MEMORY[0x277D17AB0] object:0];
}

- (void)_registerForMessages
{
  v624[2] = *MEMORY[0x277D85DE8];
  v506 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:3 remoteAccessRequired:0];
  v507 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:0 remoteAccessRequired:0];
  v508 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:0 remoteAccessRequired:1];
  v505 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:5 remoteAccessRequired:0];
  v501 = [HMDUserMessagePolicy userMessagePolicyUsingProofOfLocalityForHome:self userPrivilege:5];
  v3 = [(HMDHome *)self administratorHandler];
  v4 = *MEMORY[0x277CD2540];
  v5 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v624[0] = v5;
  v6 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v624[1] = v6;
  v7 = [MEMORY[0x277CBEA60] arrayWithObjects:v624 count:2];
  [v3 registerForMessage:v4 receiver:self policies:v7 selector:sel__handleRename_];

  v8 = [(HMDHome *)self msgDispatcher];
  v9 = *MEMORY[0x277CD1208];
  v10 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v623 = v10;
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:&v623 count:1];
  [v8 registerForMessage:v9 receiver:self policies:v11 selector:sel__handleHomeDataRequest_];

  v12 = [(HMDHome *)self administratorHandler];
  v13 = *MEMORY[0x277CCF1F8];
  v14 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v622[0] = v14;
  v15 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v622[1] = v15;
  v16 = [MEMORY[0x277CBEA60] arrayWithObjects:v622 count:2];
  [v12 registerForMessage:v13 receiver:self policies:v16 selector:sel__handleAddRoom_];

  v17 = [(HMDHome *)self administratorHandler];
  v18 = *MEMORY[0x277CD0CA0];
  v19 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v621[0] = v19;
  v20 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v621[1] = v20;
  v21 = [MEMORY[0x277CBEA60] arrayWithObjects:v621 count:2];
  [v17 registerForMessage:v18 receiver:self policies:v21 selector:sel__handleRemoveRoom_];

  v22 = [(HMDHome *)self administratorHandler];
  v23 = *MEMORY[0x277CD20B0];
  v24 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v620[0] = v24;
  v25 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v620[1] = v25;
  v26 = [MEMORY[0x277CBEA60] arrayWithObjects:v620 count:2];
  [v22 registerForMessage:v23 receiver:self policies:v26 selector:sel__handleAddZone_];

  v27 = [(HMDHome *)self administratorHandler];
  v28 = *MEMORY[0x277CD2530];
  v29 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v619[0] = v29;
  v30 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v619[1] = v30;
  v31 = [MEMORY[0x277CBEA60] arrayWithObjects:v619 count:2];
  [v27 registerForMessage:v28 receiver:self policies:v31 selector:sel__handleRemoveZone_];

  v32 = [(HMDHome *)self administratorHandler];
  v33 = *MEMORY[0x277CD20A0];
  v34 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v618[0] = v34;
  v35 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v618[1] = v35;
  v36 = [MEMORY[0x277CBEA60] arrayWithObjects:v618 count:2];
  [v32 registerForMessage:v33 receiver:self policies:v36 selector:sel__handleAddServiceGroup_];

  v37 = [(HMDHome *)self administratorHandler];
  v38 = *MEMORY[0x277CD2520];
  v39 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v617[0] = v39;
  v40 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v617[1] = v40;
  v41 = [MEMORY[0x277CBEA60] arrayWithObjects:v617 count:2];
  [v37 registerForMessage:v38 receiver:self policies:v41 selector:sel__handleRemoveServiceGroup_];

  v42 = [(HMDHome *)self administratorHandler];
  v43 = *MEMORY[0x277CD2078];
  v44 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v616[0] = v44;
  v45 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v616[1] = v45;
  v46 = [MEMORY[0x277CBEA60] arrayWithObjects:v616 count:2];
  [v42 registerForMessage:v43 receiver:self policies:v46 selector:sel__handleAddActionSet_];

  v47 = [(HMDHome *)self administratorHandler];
  v48 = *MEMORY[0x277CCF1E8];
  v49 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v615[0] = v49;
  v50 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v615[1] = v50;
  v51 = [MEMORY[0x277CBEA60] arrayWithObjects:v615 count:2];
  [v47 registerForMessage:v48 receiver:self policies:v51 selector:sel__handleAddActionSet_];

  v52 = [(HMDHome *)self msgDispatcher];
  v53 = *MEMORY[0x277CCFD60];
  v54 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v614 = v54;
  v55 = [MEMORY[0x277CBEA60] arrayWithObjects:&v614 count:1];
  [v52 registerForMessage:v53 receiver:self policies:v55 selector:sel_handleFetchPresenceMapMessage_];

  v56 = [(HMDHome *)self administratorHandler];
  v57 = *MEMORY[0x277CD24F8];
  v58 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v613[0] = v58;
  v59 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v613[1] = v59;
  v60 = [MEMORY[0x277CBEA60] arrayWithObjects:v613 count:2];
  [v56 registerForMessage:v57 receiver:self policies:v60 selector:sel__handleRemoveActionSet_];

  v61 = [(HMDHome *)self administratorHandler];
  v62 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v612[0] = v62;
  v63 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v612[1] = v63;
  v64 = [MEMORY[0x277CBEA60] arrayWithObjects:v612 count:2];
  [v61 registerForMessage:@"kRemoveTriggerRequestKey" receiver:self policies:v64 selector:sel__handleRemoveTrigger_];

  v65 = [(HMDHome *)self administratorHandler];
  v66 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v611[0] = v66;
  v67 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v611[1] = v67;
  v68 = [MEMORY[0x277CBEA60] arrayWithObjects:v611 count:2];
  [v65 registerForMessage:@"kUpdateUserAccessRequestKey" receiver:self policies:v68 selector:sel__handleUpdateUserAccess_];

  v69 = [(HMDHome *)self administratorHandler];
  v70 = *MEMORY[0x277CD2788];
  v71 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v610[0] = v71;
  v72 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v610[1] = v72;
  v610[2] = v506;
  v73 = [MEMORY[0x277CBEA60] arrayWithObjects:v610 count:3];
  [v69 registerForMessage:v70 receiver:self policies:v73 selector:sel__handleUpdateUserCamerasAccessLevel_];

  v74 = [(HMDHome *)self administratorHandler];
  v75 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v609[0] = v75;
  v76 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v609[1] = v76;
  v77 = [MEMORY[0x277CBEA60] arrayWithObjects:v609 count:2];
  [v74 registerForMessage:@"kRemoveUserRequestKey" receiver:self policies:v77 selector:sel__handleRemoveUser_];

  v78 = [(HMDHome *)self administratorHandler];
  v79 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v608[0] = v79;
  v80 = [HMDConfigurationMessagePolicy policyWithOperationTypes:7];
  v608[1] = v80;
  v81 = [MEMORY[0x277CBEA60] arrayWithObjects:v608 count:2];
  [v78 registerForMessage:@"kSetAppDataRequestKey" receiver:self policies:v81 selector:sel__handleSetAppData_];

  v82 = [(HMDHome *)self administratorHandler];
  v83 = *MEMORY[0x277CD0678];
  v84 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v607[0] = v84;
  v85 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v607[1] = v85;
  v86 = [MEMORY[0x277CBEA60] arrayWithObjects:v607 count:2];
  [v82 registerForMessage:v83 receiver:self policies:v86 selector:sel__handleUpdateMinimumMediaUserPrivilege_];

  v87 = [(HMDHome *)self administratorHandler];
  v88 = *MEMORY[0x277CD0670];
  v89 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v606[0] = v89;
  v90 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v606[1] = v90;
  v91 = [MEMORY[0x277CBEA60] arrayWithObjects:v606 count:2];
  [v87 registerForMessage:v88 receiver:self policies:v91 selector:sel__handleUpdateMediaPeerToPeerEnabled_];

  v92 = [(HMDHome *)self administratorHandler];
  v93 = *MEMORY[0x277CD0668];
  v94 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v605[0] = v94;
  v95 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v605[1] = v95;
  v96 = [MEMORY[0x277CBEA60] arrayWithObjects:v605 count:2];
  [v92 registerForMessage:v93 receiver:self policies:v96 selector:sel__handleUpdateMediaPassword_];

  v97 = [(HMDHome *)self administratorHandler];
  v98 = *MEMORY[0x277CD0580];
  v99 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v604[0] = v99;
  v100 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v604[1] = v100;
  v101 = [MEMORY[0x277CBEA60] arrayWithObjects:v604 count:2];
  [v97 registerForMessage:v98 receiver:self policies:v101 selector:sel__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest_];

  v102 = [(HMDHome *)self administratorHandler];
  v103 = *MEMORY[0x277CD0588];
  v104 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v603[0] = v104;
  v105 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v603[1] = v105;
  v106 = [MEMORY[0x277CBEA60] arrayWithObjects:v603 count:2];
  [v102 registerForMessage:v103 receiver:self policies:v106 selector:sel__handleSetHasOnboardedForAccessCodeMessage_];

  v107 = [(HMDHome *)self administratorHandler];
  v108 = *MEMORY[0x277CD0590];
  v109 = [HMDXPCMessagePolicy policyWithEntitlements:131077];
  v602[0] = v109;
  v110 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v602[1] = v110;
  v111 = [MEMORY[0x277CBEA60] arrayWithObjects:v602 count:2];
  [v107 registerForMessage:v108 receiver:self policies:v111 selector:sel__handleSetHasOnboardedForWalletKeyMessage_];

  v112 = [(HMDHome *)self administratorHandler];
  v113 = *MEMORY[0x277CD0680];
  v114 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v601[0] = v114;
  v115 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v601[1] = v115;
  v116 = [MEMORY[0x277CBEA60] arrayWithObjects:v601 count:2];
  [v112 registerForMessage:v113 receiver:self policies:v116 selector:sel__handleUpdateNetworkProtection_];

  v117 = [(HMDHome *)self administratorHandler];
  v118 = *MEMORY[0x277CD0690];
  v119 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v600[0] = v119;
  v120 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v600[1] = v120;
  v121 = [MEMORY[0x277CBEA60] arrayWithObjects:v600 count:2];
  [v117 registerForMessage:v118 receiver:self policies:v121 selector:sel__handleUpdateUserAnnounceAccess_];

  v122 = [(HMDHome *)self administratorHandler];
  v123 = *MEMORY[0x277CCFE68];
  v124 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v599[0] = v124;
  v125 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v599[1] = v125;
  v126 = [MEMORY[0x277CBEA60] arrayWithObjects:v599 count:2];
  [v122 registerForMessage:v123 receiver:self policies:v126 selector:sel__handleUpdateAudioAnalysisAccess_];

  v127 = [(HMDHome *)self administratorHandler];
  v128 = *MEMORY[0x277CD0558];
  v129 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v598[0] = v129;
  v130 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v598[1] = v130;
  v131 = [MEMORY[0x277CBEA60] arrayWithObjects:v598 count:2];
  [v127 registerForMessage:v128 receiver:self policies:v131 selector:sel__handleResolveThreadNetworkRequest_];

  v132 = [(HMDHome *)self isOwnerUser];
  v133 = MEMORY[0x277CD0F98];
  if (v132)
  {
    v134 = [(HMDHome *)self administratorHandler];
    v135 = *v133;
    v136 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v597[0] = v136;
    v137 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v597[1] = v137;
    v597[2] = v506;
    v138 = [MEMORY[0x277CBEA60] arrayWithObjects:v597 count:3];
    [v134 registerForMessage:v135 receiver:self policies:v138 selector:sel__handleOwnerSettingsUpdate_];
  }

  else
  {
    v134 = [(HMDHome *)self msgDispatcher];
    v139 = *v133;
    v136 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v596[0] = v136;
    v137 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v596[1] = v137;
    v596[2] = v505;
    v138 = [MEMORY[0x277CBEA60] arrayWithObjects:v596 count:3];
    [v134 registerForMessage:v139 receiver:self policies:v138 selector:sel__handleSharedUserSettingsUpdate_];
  }

  v140 = [(HMDHome *)self administratorHandler];
  v141 = *MEMORY[0x277CCFE58];
  v142 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v595[0] = v142;
  v143 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v595[1] = v143;
  v144 = [MEMORY[0x277CBEA60] arrayWithObjects:v595 count:2];
  [v140 registerForMessage:v141 receiver:self policies:v144 selector:sel__handleAudioAnalysisClassifierOptionsUpdateRequest_];

  v145 = [(HMDHome *)self administratorHandler];
  v146 = *MEMORY[0x277CCFE78];
  v147 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v594[0] = v147;
  v148 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v594[1] = v148;
  v149 = [MEMORY[0x277CBEA60] arrayWithObjects:v594 count:2];
  [v145 registerForMessage:v146 receiver:self policies:v149 selector:sel__handleAudioAnalysisOnboardingUpdateRequest_];

  v150 = [(HMDHome *)self administratorHandler];
  v151 = *MEMORY[0x277CD05E8];
  v152 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v593[0] = v152;
  v153 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v593[1] = v153;
  v154 = [MEMORY[0x277CBEA60] arrayWithObjects:v593 count:2];
  [v150 registerForMessage:v151 receiver:self policies:v154 selector:sel__handleSiriPhraseOptionsUpdateRequest_];

  v155 = [(HMDHome *)self administratorHandler];
  v156 = *MEMORY[0x277CD05D0];
  v157 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v592[0] = v157;
  v158 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v592[1] = v158;
  v159 = [MEMORY[0x277CBEA60] arrayWithObjects:v592 count:2];
  [v155 registerForMessage:v156 receiver:self policies:v159 selector:sel__handleSoundCheckUpdateRequest_];

  v160 = [(HMDHome *)self administratorHandler];
  v161 = *MEMORY[0x277CD0660];
  v162 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v591[0] = v162;
  v163 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v591[1] = v163;
  v164 = [MEMORY[0x277CBEA60] arrayWithObjects:v591 count:2];
  [v160 registerForMessage:v161 receiver:self policies:v164 selector:sel__handleHomeUpdateLocationServicesEnabledRequest_];

  if (isInternalBuild())
  {
    v165 = [(HMDHome *)self administratorHandler];
    v166 = *MEMORY[0x277CD0658];
    v167 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v590[0] = v167;
    v168 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v590[1] = v168;
    v169 = [MEMORY[0x277CBEA60] arrayWithObjects:v590 count:2];
    [v165 registerForMessage:v166 receiver:self policies:v169 selector:sel__handleHomeUpdateDidOnboardLocationServicesRequest_];
  }

  if (!isWatch())
  {
    v170 = [(HMDHome *)self administratorHandler];
    v171 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v589[0] = v171;
    v172 = [HMDConfigurationMessagePolicy policyWithOperationTypes:6];
    v589[1] = v172;
    v173 = [MEMORY[0x277CBEA60] arrayWithObjects:v589 count:2];
    [v170 registerForMessage:@"kUpdateInvitationStateRequestKey" receiver:self policies:v173 selector:sel__handleUpdateOutgoingInvitationState_];
  }

  v174 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v174 setRoles:{objc_msgSend(v174, "roles") | 4}];
  v497 = v174;
  v502 = [v174 copy];
  v175 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:4 remoteAccessRequired:0];
  v176 = [(HMDHome *)self administratorHandler];
  v177 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v588[0] = v177;
  v588[1] = v175;
  v499 = v175;
  v178 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v588[2] = v178;
  v179 = [MEMORY[0x277CBEA60] arrayWithObjects:v588 count:3];
  [v176 registerForMessage:@"kAddEventTriggerRequestKey" receiver:self policies:v179 selector:sel__handleAddEventTrigger_];

  v180 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v587[0] = v180;
  v587[1] = v175;
  v181 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v587[2] = v181;
  v182 = [MEMORY[0x277CBEA60] arrayWithObjects:v587 count:3];
  v496 = v176;
  [v176 registerForMessage:@"kAddTimerTriggerRequestKey" receiver:self policies:v182 selector:sel__handleAddTimerTrigger_];

  v183 = [(HMDHome *)self administratorHandler];
  v184 = *MEMORY[0x277CCF1F0];
  v185 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v586[0] = v185;
  v186 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v586[1] = v186;
  v187 = [MEMORY[0x277CBEA60] arrayWithObjects:v586 count:2];
  [v183 registerForMessage:v184 receiver:self policies:v187 selector:sel__handleAddEventTrigger_];

  v188 = [(HMDHome *)self administratorHandler];
  v189 = *MEMORY[0x277CCF200];
  v190 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v585[0] = v190;
  v191 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v585[1] = v191;
  v192 = [MEMORY[0x277CBEA60] arrayWithObjects:v585 count:2];
  [v188 registerForMessage:v189 receiver:self policies:v192 selector:sel__handleAddTimerTrigger_];

  v193 = [MEMORY[0x277D0F8E8] productInfo];
  v194 = [v193 productPlatform];

  if (v194 == 1)
  {
    v195 = 5;
  }

  else
  {
    v195 = 1;
  }

  v196 = [(HMDHome *)self msgDispatcher];
  v197 = *MEMORY[0x277CD2070];
  v198 = [HMDXPCMessagePolicy policyWithEntitlements:v195];
  v584[0] = v198;
  v199 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v584[1] = v199;
  v200 = [MEMORY[0x277CBEA60] arrayWithObjects:v584 count:2];
  [v196 registerForMessage:v197 receiver:self policies:v200 selector:sel__handleAddAccessory_];

  v201 = [(HMDHome *)self msgDispatcher];
  v583[0] = v502;
  v583[1] = v499;
  v202 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v583[2] = v202;
  v203 = [MEMORY[0x277CBEA60] arrayWithObjects:v583 count:3];
  [v201 registerForMessage:@"HMDRemoteAddHAPAccessoriesMessage" receiver:self policies:v203 selector:sel__handleRemoteAddHAPAccessories_];

  v204 = [(HMDHome *)self msgDispatcher];
  v582[0] = v502;
  v582[1] = v499;
  v205 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v582[2] = v205;
  v206 = [MEMORY[0x277CBEA60] arrayWithObjects:v582 count:3];
  [v204 registerForMessage:@"HMDRemoteAddMediaAccessoryMessage" receiver:self policies:v206 selector:sel__handleRemoteAddMediaAccessory_];

  v207 = [(HMDHome *)self msgDispatcher];
  v581[0] = v502;
  v581[1] = v499;
  v208 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v581[2] = v208;
  v209 = [MEMORY[0x277CBEA60] arrayWithObjects:v581 count:3];
  [v207 registerForMessage:@"HMDRemoteAddMediaAccessoryRequestMessage" receiver:self policies:v209 selector:sel__handleRemoteAddMediaAccessoryRequest_];

  v210 = [(HMDHome *)self administratorHandler];
  v211 = *MEMORY[0x277CD12A8];
  v212 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v580[0] = v212;
  v580[1] = v502;
  v580[2] = v499;
  v213 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v580[3] = v213;
  v214 = [MEMORY[0x277CBEA60] arrayWithObjects:v580 count:4];
  [v210 registerForMessage:v211 receiver:self policies:v214 selector:sel__handleUpdateRestrictedGuestSettings_];

  v215 = [(HMDHome *)self msgDispatcher];
  v216 = *MEMORY[0x277CD0578];
  v217 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v579 = v217;
  v218 = [MEMORY[0x277CBEA60] arrayWithObjects:&v579 count:1];
  [v215 registerForMessage:v216 receiver:self policies:v218 selector:sel__handleSetDismissedUWBOnboarding_];

  v219 = [(HMDHome *)self msgDispatcher];
  v220 = *MEMORY[0x277CD06A8];
  v221 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v578[0] = v221;
  v578[1] = v499;
  v222 = [MEMORY[0x277CBEA60] arrayWithObjects:v578 count:2];
  [v219 registerForMessage:v220 receiver:self policies:v222 selector:sel__handleUserConsentResponseForAccessory_];

  v223 = [(HMDHome *)self msgDispatcher];
  v224 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v577[0] = v224;
  v577[1] = v499;
  v225 = [MEMORY[0x277CBEA60] arrayWithObjects:v577 count:2];
  [v223 registerForMessage:@"kContinuePairingAccessoryRequestKey" receiver:self policies:v225 selector:sel__handleContinuePairingAccessory_];

  v226 = [(HMDHome *)self msgDispatcher];
  v227 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v576[0] = v227;
  v576[1] = v499;
  v228 = [MEMORY[0x277CBEA60] arrayWithObjects:v576 count:2];
  [v226 registerForMessage:@"kCancelPairingAccessoryRequestKey" receiver:self policies:v228 selector:sel__handleCancelPairingAccessory_];

  v229 = [(HMDHome *)self msgDispatcher];
  v230 = *MEMORY[0x277CD24F0];
  v231 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v575[0] = v231;
  v575[1] = v502;
  v575[2] = v499;
  v232 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v575[3] = v232;
  v233 = [MEMORY[0x277CBEA60] arrayWithObjects:v575 count:4];
  [v229 registerForMessage:v230 receiver:self policies:v233 selector:sel__handleRemoveAccessoryMessage_];

  v234 = [(HMDHome *)self administratorHandler];
  v235 = *MEMORY[0x277CD0518];
  v236 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v574[0] = v236;
  v574[1] = v502;
  v574[2] = v499;
  v237 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v574[3] = v237;
  v238 = [MEMORY[0x277CBEA60] arrayWithObjects:v574 count:4];
  [v234 registerForMessage:v235 receiver:self policies:v238 selector:sel_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage_];

  v239 = [(HMDHome *)self administratorHandler];
  v240 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v573[0] = v240;
  v573[1] = v502;
  v573[2] = v499;
  v241 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v573[3] = v241;
  v242 = [MEMORY[0x277CBEA60] arrayWithObjects:v573 count:4];
  [v239 registerForMessage:@"HMDHomeRemoteUpdateCHIPKeyValueStoreMessage" receiver:self policies:v242 selector:sel_handleRemoteUpdateCHIPKeyValueStoreMessage_];

  v243 = [(HMDHome *)self msgDispatcher];
  v572[0] = v502;
  v572[1] = v508;
  v244 = [MEMORY[0x277CBEA60] arrayWithObjects:v572 count:2];
  [v243 registerForMessage:@"HMDHomeRequestCommissioningCertificatesMessage" receiver:self policies:v244 selector:sel_handleCommissioningCertificateRequest_];

  v245 = [(HMDHome *)self msgDispatcher];
  v246 = +[HMDRemoteMessagePolicy defaultSecurePrimaryResidentPolicy];
  v571[0] = v246;
  v571[1] = v499;
  v247 = [MEMORY[0x277CBEA60] arrayWithObjects:v571 count:2];
  [v245 registerForMessage:@"HMDHomeNotificationPairingCompletionMessage" receiver:self policies:v247 selector:sel_handleMatterPairingCompletionNotification_];

  v248 = [(HMDHome *)self msgDispatcher];
  v249 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v570[0] = v249;
  v570[1] = v499;
  v250 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v570[2] = v250;
  v251 = [MEMORY[0x277CBEA60] arrayWithObjects:v570 count:3];
  [v248 registerForMessage:@"kInviteUsersRequestKey" receiver:self policies:v251 selector:sel__handleUserInvitations_];

  v252 = [(HMDHome *)self administratorHandler];
  v253 = *MEMORY[0x277CCFEE8];
  v254 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v569[0] = v254;
  v255 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v569[1] = v255;
  v569[2] = v508;
  v569[3] = v502;
  v256 = [MEMORY[0x277CBEA60] arrayWithObjects:v569 count:4];
  [v252 registerForMessage:v253 receiver:self policies:v256 selector:sel__handleEnableMultiUserRequest_];

  v257 = [(HMDHome *)self localCapabilitiesDataSource];
  LODWORD(v254) = [v257 isResidentCapable];

  if (v254)
  {
    v258 = [(HMDHome *)self msgDispatcher];
    v568[0] = v502;
    v568[1] = v499;
    v259 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
    v568[2] = v259;
    v260 = [MEMORY[0x277CBEA60] arrayWithObjects:v568 count:3];
    [v258 registerForMessage:@"kAddHomeInvitesInternalRequestKey" receiver:self policies:v260 selector:sel__handleOutgoingInvitations_];

    v261 = [(HMDHome *)self msgDispatcher];
    v567[0] = v502;
    v567[1] = v499;
    v262 = [MEMORY[0x277CBEA60] arrayWithObjects:v567 count:2];
    [v261 registerForMessage:@"HMDHomeCreateUniquePSKClientConfigurationRequestKey" receiver:self policies:v262 selector:sel__handleCreateUniquePSKClientConfiguration_];

    v263 = [(HMDHome *)self msgDispatcher];
    v566[0] = v502;
    v566[1] = v499;
    v264 = [MEMORY[0x277CBEA60] arrayWithObjects:v566 count:2];
    [v263 registerForMessage:@"HMDHomeRemoveClientConfigurationRequestKey" receiver:self policies:v264 selector:sel__handleRemoveClientConfiguration_];
  }

  isWatch();
  v265 = [(HMDHome *)self msgDispatcher];
  v266 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v565[0] = v266;
  v565[1] = v499;
  v267 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v565[2] = v267;
  v268 = [MEMORY[0x277CBEA60] arrayWithObjects:v565 count:3];
  [v265 registerForMessage:@"kHomeLocationUpdatedNotificationKey" receiver:self policies:v268 selector:sel__handleHomeLocationUpdateFromSharedAdmin_];

  if (isInternalBuild())
  {
    v269 = [(HMDHome *)self msgDispatcher];
    v270 = *MEMORY[0x277CD0008];
    v271 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v564[0] = v271;
    v272 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v564[1] = v272;
    v273 = [MEMORY[0x277CBEA60] arrayWithObjects:v564 count:2];
    [v269 registerForMessage:v270 receiver:self policies:v273 selector:sel__handleSetMinimumNetworkRouterHomeKitVersion_];

    v274 = [(HMDHome *)self msgDispatcher];
    v275 = *MEMORY[0x277CD0000];
    v276 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v563[0] = v276;
    v277 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v563[1] = v277;
    v278 = [MEMORY[0x277CBEA60] arrayWithObjects:v563 count:2];
    [v274 registerForMessage:v275 receiver:self policies:v278 selector:sel__handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange_];
  }

  if (isInternalBuild() && isiOSDevice())
  {
    v279 = [(HMDHome *)self msgDispatcher];
    v280 = *MEMORY[0x277CD0568];
    v281 = [HMDXPCMessagePolicy policyWithEntitlements:1049605];
    v562[0] = v281;
    v282 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v562[1] = v282;
    v283 = [MEMORY[0x277CBEA60] arrayWithObjects:v562 count:2];
    [v279 registerForMessage:v280 receiver:self policies:v283 selector:sel__handleRetrieveHomeLocationForFeedback_];
  }

  v284 = [(HMDHome *)self administratorHandler];
  v285 = *MEMORY[0x277CCFF18];
  v286 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v561[0] = v286;
  v287 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v561[1] = v287;
  v561[2] = v499;
  v288 = [MEMORY[0x277CBEA60] arrayWithObjects:v561 count:3];
  [v284 registerForMessage:v285 receiver:self policies:v288 selector:sel__handleEventLogSetDidOnboard_];

  v289 = [(HMDHome *)self administratorHandler];
  v290 = *MEMORY[0x277CCFF28];
  v291 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v560[0] = v291;
  v292 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v560[1] = v292;
  v560[2] = v499;
  v293 = [MEMORY[0x277CBEA60] arrayWithObjects:v560 count:3];
  [v289 registerForMessage:v290 receiver:self policies:v293 selector:sel__handleEventLogSetEnabledMessage_];

  v294 = [(HMDHome *)self administratorHandler];
  v295 = *MEMORY[0x277CCFF20];
  v296 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v559[0] = v296;
  v297 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v559[1] = v297;
  v559[2] = v499;
  v298 = [MEMORY[0x277CBEA60] arrayWithObjects:v559 count:3];
  [v294 registerForMessage:v295 receiver:self policies:v298 selector:sel__handleEventLogSetDurationMessage_];

  v299 = [(HMDHome *)self administratorHandler];
  v300 = *MEMORY[0x277CCFEF8];
  v301 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v558[0] = v301;
  v302 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v558[1] = v302;
  v558[2] = v499;
  v303 = [MEMORY[0x277CBEA60] arrayWithObjects:v558 count:3];
  [v299 registerForMessage:v300 receiver:self policies:v303 selector:sel__handleEventLogClearMessage_];

  v304 = [(HMDHome *)self msgDispatcher];
  v305 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v557 = v305;
  v306 = [MEMORY[0x277CBEA60] arrayWithObjects:&v557 count:1];
  [v304 registerForMessage:@"HMDHome.ActivityHistory.Clear.Broadcast" receiver:self policies:v306 selector:sel__handleClearActivityHistoryBroadcastMessage_];

  v307 = [(HMDHome *)self msgDispatcher];
  v308 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v556[0] = v308;
  v556[1] = v507;
  v309 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v556[2] = v309;
  v310 = [MEMORY[0x277CBEA60] arrayWithObjects:v556 count:3];
  [v307 registerForMessage:@"kUpdateUserPresenceStatusConsentRequestKey" receiver:self policies:v310 selector:sel__handleUpdatePresenceConsent_];

  v311 = [(HMDHome *)self msgDispatcher];
  v312 = *MEMORY[0x277CD0560];
  v313 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v555[0] = v313;
  v314 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v555[1] = v314;
  v315 = [MEMORY[0x277CBEA60] arrayWithObjects:v555 count:2];
  [v311 registerForMessage:v312 receiver:self policies:v315 selector:sel__handleRetrieveAsyncResults_];

  v503 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v503 setRoles:{objc_msgSend(v503, "roles") | 6}];
  v316 = [v503 copy];
  v317 = [(HMDHome *)self msgDispatcher];
  v318 = *MEMORY[0x277CD2348];
  v319 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v554[0] = v319;
  v554[1] = v316;
  v554[2] = v508;
  v320 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v554[3] = v320;
  v321 = [MEMORY[0x277CBEA60] arrayWithObjects:v554 count:4];
  [v317 registerForMessage:v318 receiver:self policies:v321 selector:sel__handleExecuteActionSet_];

  v322 = [(HMDHome *)self msgDispatcher];
  v323 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v553[0] = v323;
  v553[1] = v316;
  v553[2] = v501;
  v324 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v553[3] = v324;
  v325 = [MEMORY[0x277CBEA60] arrayWithObjects:v553 count:4];
  [v322 registerForMessage:@"kMultipleCharacteristicWriteRequestKey" receiver:self policies:v325 selector:sel__handleMultipleCharacteristicWrite_];

  v326 = [(HMDHome *)self msgDispatcher];
  v327 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v552[0] = v327;
  v552[1] = v316;
  v552[2] = v501;
  v328 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v552[3] = v328;
  v329 = [MEMORY[0x277CBEA60] arrayWithObjects:v552 count:4];
  [v326 registerForMessage:@"kMultipleCharacteristicReadRequestKey" receiver:self policies:v329 selector:sel__handleMultipleCharacteristicRead_];

  v330 = [(HMDHome *)self msgDispatcher];
  v551[0] = v316;
  v551[1] = v501;
  v331 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v551[2] = v331;
  v332 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v551[3] = v332;
  v333 = [MEMORY[0x277CBEA60] arrayWithObjects:v551 count:4];
  [v330 registerForMessage:@"kCharacteristicWriteRequestKey" receiver:self policies:v333 selector:sel__handleCharacteristicWrite_];

  v334 = [(HMDHome *)self msgDispatcher];
  v550[0] = v316;
  v550[1] = v501;
  v335 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v550[2] = v335;
  v336 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v550[3] = v336;
  v337 = [MEMORY[0x277CBEA60] arrayWithObjects:v550 count:4];
  [v334 registerForMessage:@"kCharacteristicReadRequestKey" receiver:self policies:v337 selector:sel__handleCharacteristicRead_];

  v338 = [(HMDHome *)self msgDispatcher];
  v339 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v549[0] = v339;
  v549[1] = v316;
  v549[2] = v505;
  v340 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v549[3] = v340;
  v341 = [MEMORY[0x277CBEA60] arrayWithObjects:v549 count:4];
  [v338 registerForMessage:@"kCharacteristicEnableNotificationRequestKey" receiver:self policies:v341 selector:sel__handleCharacteristicEnableNotification_];

  isWatch();
  v342 = [(HMDHome *)self msgDispatcher];
  v548[0] = v316;
  v548[1] = v501;
  v343 = [MEMORY[0x277CBEA60] arrayWithObjects:v548 count:2];
  [v342 registerForMessage:@"kModifyCharacterisiticNotificationsRequestKey" receiver:self policies:v343 selector:sel__handleModifyCharacteristicNotifications_];

  v344 = [(HMDHome *)self msgDispatcher];
  v547[0] = v316;
  v547[1] = v501;
  v345 = [MEMORY[0x277CBEA60] arrayWithObjects:v547 count:2];
  [v344 registerForMessage:@"kEnableAccessoryReachabilityNotificationRequestKey" receiver:self policies:v345 selector:sel__handleAccessoryReachabilityRegistrationAndEnable_];

  v346 = [(HMDHome *)self msgDispatcher];
  v546[0] = v316;
  v546[1] = v501;
  v347 = [MEMORY[0x277CBEA60] arrayWithObjects:v546 count:2];
  [v346 registerForMessage:@"kDisableAccessoryReachabilityNotificationRequestKey" receiver:self policies:v347 selector:sel__handleAccessoryReachabilityRegistration_];

  v348 = [(HMDHome *)self msgDispatcher];
  v349 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v545[0] = v349;
  v545[1] = v505;
  v350 = [MEMORY[0x277CBEA60] arrayWithObjects:v545 count:2];
  [v348 registerForMessage:@"kCharacterisiticsChangedInternalNotificationKey" receiver:self policies:v350 selector:sel__handleCharacteristicsChangedNotification_];

  v351 = [(HMDHome *)self msgDispatcher];
  v352 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v544[0] = v352;
  v544[1] = v507;
  v353 = [MEMORY[0x277CBEA60] arrayWithObjects:v544 count:2];
  [v351 registerForMessage:@"HMHomeAllowUserManagementMessage" receiver:self policies:v353 selector:sel__handleAllowUserManagementMessage_];

  v354 = [(HMDHome *)self msgDispatcher];
  v355 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v543[0] = v355;
  v543[1] = v507;
  v356 = [MEMORY[0x277CBEA60] arrayWithObjects:v543 count:2];
  [v354 registerForMessage:@"kRemoteReachabilityChangedNotificationKey" receiver:self policies:v356 selector:sel__handleAccessoryReachabilityChange_];

  v357 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v357 setRequiresSecureMessage:1];
  [v357 setRoles:3];
  v504 = v357;
  v358 = [v357 copy];
  v359 = [(HMDHome *)self msgDispatcher];
  v360 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v542[0] = v360;
  v500 = v358;
  v542[1] = v358;
  v542[2] = v501;
  v361 = [MEMORY[0x277CBEA60] arrayWithObjects:v542 count:3];
  [v359 registerForMessage:@"kConfirmExecuteTriggerRequestKey" receiver:self policies:v361 selector:sel__handleExecuteConfirmationOfTrigger_];

  v362 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v362 setRoles:4];
  v363 = [v362 copy];
  v364 = [(HMDHome *)self msgDispatcher];
  v365 = *MEMORY[0x277CD24B0];
  v541[0] = v363;
  v541[1] = v507;
  v366 = [MEMORY[0x277CBEA60] arrayWithObjects:v541 count:2];
  [v364 registerForMessage:v365 receiver:self policies:v366 selector:sel_handleEvaluatePredicateMessage_];

  v367 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v367 setRoles:{objc_msgSend(v367, "roles") | 8}];
  v368 = [v367 copy];
  v540[0] = v368;
  v540[1] = v505;
  v369 = [MEMORY[0x277CBEA60] arrayWithObjects:v540 count:2];
  [(HMDHome *)self registerForBulletinNotificationRegistrationHandlersUsingPolicies:v369];

  v370 = [(HMDHome *)self msgDispatcher];
  v371 = [(HMDHome *)self administratorHandler];

  v372 = *MEMORY[0x277CD0648];
  v373 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v539[0] = v373;
  v539[1] = v506;
  v374 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v539[2] = v374;
  v375 = [MEMORY[0x277CBEA60] arrayWithObjects:v539 count:3];
  [v371 registerForMessage:v372 receiver:self policies:v375 selector:sel__handleUpdateAutomaticSoftwareUpdate_];

  v376 = *MEMORY[0x277CD0650];
  v377 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v538[0] = v377;
  v538[1] = v506;
  v378 = v507;
  p_info = HMDResidentReachabilityContext.info;
  v380 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v538[2] = v380;
  v381 = [MEMORY[0x277CBEA60] arrayWithObjects:v538 count:3];
  v498 = v371;
  [v371 registerForMessage:v376 receiver:self policies:v381 selector:sel__handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate_];

  v382 = [(HMDHome *)self msgDispatcher];
  v383 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v537[0] = v383;
  v537[1] = v508;
  v384 = [MEMORY[0x277CBEA60] arrayWithObjects:v537 count:2];
  [v382 registerForMessage:@"HMDHomeQueryResidentReachabilityForAccessoriesMessageKey" receiver:self policies:v384 selector:sel__handleQueryResidentReachabilityForAccessories_];

  v385 = [(HMDHome *)self msgDispatcher];
  v386 = *MEMORY[0x277CCFF40];
  v387 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v536[0] = v387;
  v536[1] = v507;
  v388 = [MEMORY[0x277CBEA60] arrayWithObjects:v536 count:2];
  [v385 registerForMessage:v386 receiver:self policies:v388 selector:sel_executeActionsFromMessage_];

  v389 = [(HMDHome *)self localCapabilitiesDataSource];
  LODWORD(v386) = [v389 supportsHomeNotificationEnablement];

  if (v386)
  {
    v390 = [(HMDHome *)self msgDispatcher];
    v391 = *MEMORY[0x277CCFEE0];
    v392 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v535[0] = v392;
    v535[1] = v505;
    v393 = [MEMORY[0x277CBEA60] arrayWithObjects:v535 count:2];
    [v390 registerForMessage:v391 receiver:self policies:v393 selector:sel__handleEnableNotifications_];
  }

  v394 = [(HMDHome *)self msgDispatcher];
  v395 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v534[0] = v395;
  v534[1] = v508;
  v396 = [MEMORY[0x277CBEA60] arrayWithObjects:v534 count:2];
  [v394 registerForMessage:@"kMediaPropertiesWriteRequestKey" receiver:self policies:v396 selector:sel__handleMediaPropertiesWrite_];

  v397 = [(HMDHome *)self msgDispatcher];
  v398 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v533[0] = v398;
  v533[1] = v508;
  v399 = [MEMORY[0x277CBEA60] arrayWithObjects:v533 count:2];
  [v397 registerForMessage:@"kMediaPropertiesReadRequestKey" receiver:self policies:v399 selector:sel__handleMediaPropertiesRead_];

  v400 = [(HMDHome *)self msgDispatcher];
  v401 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v402 = v506;
  v532[0] = v401;
  v532[1] = v506;
  v403 = [MEMORY[0x277CBEA60] arrayWithObjects:v532 count:2];
  [v400 registerForMessage:@"kStartDiscoveringSymptomsForNearbyDevicesRequestKey" receiver:self policies:v403 selector:sel__handleStartDiscoveringSymptomsForNearbyDevicesMessage_];

  v404 = [(HMDHome *)self msgDispatcher];
  v405 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v531[0] = v405;
  v531[1] = v506;
  v406 = [MEMORY[0x277CBEA60] arrayWithObjects:v531 count:2];
  [v404 registerForMessage:@"kStopDiscoveringSymptomsForNearbyDevicesRequestKey" receiver:self policies:v406 selector:sel__handleStopDiscoveringSymptomsForNearbyDevicesMessage_];

  if ([(HMDHome *)self isOwnerUser])
  {
    v407 = [(HMDHome *)self administratorHandler];
    v408 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v530 = v408;
    v409 = &v530;
    v410 = v506;
  }

  else
  {
    v407 = [(HMDHome *)self msgDispatcher];
    v408 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v529 = v408;
    v409 = &v529;
    v410 = v507;
  }

  v411 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v409[1] = v411;
  v409[2] = v410;
  v412 = [MEMORY[0x277CBEA60] arrayWithObjects:v409 count:3];

  [v407 registerForMessage:*MEMORY[0x277CD1300] receiver:self policies:v412 selector:sel__handleAssistantAccessControlUpdate_];
  [v407 registerForMessage:*MEMORY[0x277CD13C0] receiver:self policies:v412 selector:sel__handleMediaContentProfileAccessControlUpdate_];
  v495 = v412;
  [v407 registerForMessage:*MEMORY[0x277CD13A8] receiver:self policies:v412 selector:sel__handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs_];
  v413 = [(HMDHome *)self msgDispatcher];
  v414 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v528[0] = v414;
  v528[1] = v507;
  v415 = [MEMORY[0x277CBEA60] arrayWithObjects:v528 count:2];
  [v413 registerForMessage:@"HMDUCM.rsr" receiver:self policies:v415 selector:sel__handleRemoteUserClientCloudShareRequest_];

  v416 = [(HMDHome *)self msgDispatcher];
  v417 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v527[0] = v417;
  v527[1] = v507;
  v418 = [MEMORY[0x277CBEA60] arrayWithObjects:v527 count:2];
  [v416 registerForMessage:@"HMDUCM.rRepr" receiver:self policies:v418 selector:sel__handleRemoteUserClientCloudShareRepairRequest_];

  v419 = [(HMDHome *)self msgDispatcher];
  v420 = +[HMDRemoteMessagePolicy defaultSecurePrimaryResidentPolicy];
  v526[0] = v420;
  v526[1] = v506;
  v421 = [MEMORY[0x277CBEA60] arrayWithObjects:v526 count:2];
  [v419 registerForMessage:@"HMDHomeSetHomeManagerAppData" receiver:self policies:v421 selector:sel__handleSetHomeManagerAppData_];

  if (isInternalBuild())
  {
    v422 = [(HMDHome *)self msgDispatcher];
    v423 = *MEMORY[0x277CCFEA0];
    v424 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v525[0] = v424;
    v525[1] = v506;
    v425 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v525[2] = v425;
    v426 = [MEMORY[0x277CBEA60] arrayWithObjects:v525 count:3];
    [v422 registerForMessage:v423 receiver:self policies:v426 selector:sel__handleConfirmResidentRequest_];

    v427 = [(HMDHome *)self msgDispatcher];
    v428 = *MEMORY[0x277CD05C8];
    v429 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v524[0] = v429;
    v524[1] = v506;
    v430 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v524[2] = v430;
    v431 = [MEMORY[0x277CBEA60] arrayWithObjects:v524 count:3];
    [v427 registerForMessage:v428 receiver:self policies:v431 selector:sel__handleSetResidentElectionVersion_];

    v378 = v507;
    p_info = (HMDResidentReachabilityContext + 32);
  }

  [(HMDHome *)self _registerThreadResidentCommissioningMessageHandlers];
  if (isInternalBuild())
  {
    v432 = [(HMDHome *)self msgDispatcher];
    v433 = *MEMORY[0x277CD0610];
    v434 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v523 = v434;
    v435 = [MEMORY[0x277CBEA60] arrayWithObjects:&v523 count:1];
    [v432 registerForMessage:v433 receiver:self policies:v435 selector:sel__handleTestUpgradeToROAR_];

    p_info = HMDResidentReachabilityContext.info;
  }

  v436 = [(HMDHome *)self msgDispatcher];
  v437 = [p_info + 16 defaultSecurePolicy];
  v522[0] = v437;
  v522[1] = v378;
  v438 = [MEMORY[0x277CBEA60] arrayWithObjects:v522 count:2];
  [v436 registerForMessage:@"HMDHomeSetNaturalLightingEnabledForLightProfilesMessage" receiver:self policies:v438 selector:sel_handleSetNaturalLightingEnabledForLightProfilesMessage_];

  v439 = [(HMDHome *)self msgDispatcher];
  v440 = *MEMORY[0x277CCFF58];
  v441 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v521 = v441;
  [MEMORY[0x277CBEA60] arrayWithObjects:&v521 count:1];
  v443 = v442 = p_info;
  [v439 registerForMessage:v440 receiver:self policies:v443 selector:sel_handleFetchLightProfileSettingsMessage_];

  v444 = [(HMDHome *)self msgDispatcher];
  v445 = [v442 + 16 defaultSecurePrimaryResidentPolicy];
  v520[0] = v445;
  v520[1] = v378;
  v446 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v520[2] = v446;
  v447 = [MEMORY[0x277CBEA60] arrayWithObjects:v520 count:3];
  [v444 registerForMessage:@"HMDHomeCHIPSendRemoteRequestMessage" receiver:self policies:v447 selector:sel_handleCHIPSendRemoteRequestMessage_];

  if (isInternalBuild())
  {
    v448 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:4 remoteAccessRequired:0];
    v449 = [(HMDHome *)self msgDispatcher];
    v450 = *MEMORY[0x277CD0548];
    v451 = [v442 + 16 defaultSecurePolicy];
    v519[0] = v451;
    v519[1] = v448;
    v452 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v519[2] = v452;
    v453 = [MEMORY[0x277CBEA60] arrayWithObjects:v519 count:3];
    [v449 registerForMessage:v450 receiver:self policies:v453 selector:sel_handleResetMatterStorageRequest_];

    v454 = [(HMDHome *)self msgDispatcher];
    v455 = *MEMORY[0x277CCFE98];
    v456 = [v442 + 16 defaultSecurePolicy];
    v518[0] = v456;
    v518[1] = v448;
    v457 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v518[2] = v457;
    v458 = [MEMORY[0x277CBEA60] arrayWithObjects:v518 count:3];
    [v454 registerForMessage:v455 receiver:self policies:v458 selector:sel_handleClearMatterControllerPrivateStorageRequest_];

    v402 = v506;
    v378 = v507;
  }

  v459 = [(HMDHome *)self msgDispatcher];
  v460 = [v442 + 16 defaultSecurePolicy];
  v517[0] = v460;
  v517[1] = v378;
  v461 = [MEMORY[0x277CBEA60] arrayWithObjects:v517 count:2];
  [v459 registerForMessage:@"HMDHomeCHIPSendReportMessage" receiver:self policies:v461 selector:sel_handleCHIPSendReportMessage_];

  if (isInternalBuild())
  {
    v462 = [(HMDHome *)self msgDispatcher];
    v463 = *MEMORY[0x277CD05A0];
    v464 = [HMDXPCMessagePolicy policyWithEntitlements:1];
    v516[0] = v464;
    v465 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
    v516[1] = v465;
    v466 = [MEMORY[0x277CBEA60] arrayWithObjects:v516 count:2];
    [v462 registerForMessage:v463 receiver:self policies:v466 selector:sel_handleSetPreferredPrimaryMessage_];

    v467 = [(HMDHome *)self msgDispatcher];
    v468 = *MEMORY[0x277CD0600];
    v469 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v515[0] = v469;
    v515[1] = v402;
    v470 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v515[2] = v470;
    v471 = [MEMORY[0x277CBEA60] arrayWithObjects:v515 count:3];
    [v467 registerForMessage:v468 receiver:self policies:v471 selector:sel_handleSwitchFromResidentSelectionToREV2_];

    v378 = v507;
  }

  v472 = [(HMDHome *)self msgDispatcher];
  v473 = *MEMORY[0x277CCFF90];
  v474 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v514 = v474;
  v475 = [MEMORY[0x277CBEA60] arrayWithObjects:&v514 count:1];
  [v472 registerForMessage:v473 receiver:self policies:v475 selector:sel__handleFetchUniqueIdentifierForBundleIdentifier_];

  v476 = [(HMDHome *)self msgDispatcher];
  v477 = *MEMORY[0x277CCFF88];
  v478 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v513 = v478;
  v479 = [MEMORY[0x277CBEA60] arrayWithObjects:&v513 count:1];
  [v476 registerForMessage:v477 receiver:self policies:v479 selector:sel__handleFetchTriggerNameRequest_];

  v480 = [(HMDHome *)self featuresDataSource];
  LODWORD(v477) = [v480 isLocalPresenceEnabled];

  if (v477)
  {
    v481 = [(HMDHome *)self msgDispatcher];
    v482 = *MEMORY[0x277CD0D48];
    v483 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v512 = v483;
    v484 = [MEMORY[0x277CBEA60] arrayWithObjects:&v512 count:1];
    [v481 registerForMessage:v482 receiver:self policies:v484 selector:sel_handleRoomsSupportingLocalPresenceMessage_];
  }

  [(HMDHome *)self registerForNetworkInfoMessages];
  if (isInternalBuild())
  {
    [(HMDHome *)self registerForPowerAssertionMessages];
  }

  if (isInternalBuild())
  {
    v485 = [(HMDHome *)self msgDispatcher];
    v486 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v511 = v486;
    v487 = [MEMORY[0x277CBEA60] arrayWithObjects:&v511 count:1];
    [v485 registerForMessage:@"HomeUtil.Command.Wallet.RollReaderKey" receiver:self policies:v487 selector:sel__handleRollReaderKey_];

    v488 = [(HMDHome *)self msgDispatcher];
    v489 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v510 = v489;
    v490 = [MEMORY[0x277CBEA60] arrayWithObjects:&v510 count:1];
    [v488 registerForMessage:@"HomeUtil.Command.Wallet.FetchOrCreateReaderKey" receiver:self policies:v490 selector:sel__handleFetchOrCreateReaderKey_];

    v491 = [(HMDHome *)self msgDispatcher];
    v492 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v509 = v492;
    v493 = [MEMORY[0x277CBEA60] arrayWithObjects:&v509 count:1];
    [v491 registerForMessage:@"HomeUtil.Command.Wallet.RollACWGIssuerKey" receiver:self policies:v493 selector:sel__handleRollACWGIssuerKey_];
  }

  [(HMDHome *)self _registerForMatterRequests];
  [(HMDHome *)self _registerPerformMediaGroupReadinessCheckMessage];

  v494 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientOfVendorInfoUpdatedForManufacturers:(id)a3 withCompletion:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __74__HMDHome_notifyClientOfVendorInfoUpdatedForManufacturers_withCompletion___block_invoke;
  block[3] = &unk_278689F98;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(v8, block);
}

void __74__HMDHome_notifyClientOfVendorInfoUpdatedForManufacturers_withCompletion___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessories];
  v18 = [v2 copy];

  v3 = [MEMORY[0x277CBEB18] array];
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v15 = a1;
  obj = *(a1 + 40);
  v19 = [obj countByEnumeratingWithState:&v24 objects:v29 count:16];
  if (v19)
  {
    v17 = *v25;
    do
    {
      for (i = 0; i != v19; ++i)
      {
        if (*v25 != v17)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v24 + 1) + 8 * i);
        v20 = 0u;
        v21 = 0u;
        v22 = 0u;
        v23 = 0u;
        v6 = v18;
        v7 = [v6 countByEnumeratingWithState:&v20 objects:v28 count:16];
        if (v7)
        {
          v8 = v7;
          v9 = *v21;
          do
          {
            for (j = 0; j != v8; ++j)
            {
              if (*v21 != v9)
              {
                objc_enumerationMutation(v6);
              }

              v11 = *(*(&v20 + 1) + 8 * j);
              v12 = [v11 manufacturer];
              v13 = [v12 caseInsensitiveCompare:v5];

              if (!v13)
              {
                [v11 updateVendorInfo];
                [v3 addObject:v11];
              }
            }

            v8 = [v6 countByEnumeratingWithState:&v20 objects:v28 count:16];
          }

          while (v8);
        }
      }

      v19 = [obj countByEnumeratingWithState:&v24 objects:v29 count:16];
    }

    while (v19);
  }

  [*(v15 + 32) _notifyClientsOfAccessoryInfoUpdatedForAccessories:v3 shouldRefreshBadge:0 withCompletion:*(v15 + 48)];
  v14 = *MEMORY[0x277D85DE8];
}

- (void)resetConfiguration
{
  [(HMDHome *)self unconfigure];
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_resetConfiguration__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

void __29__HMDHome_resetConfiguration__block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessories];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543618;
    v20 = v6;
    v21 = 2112;
    v22 = v2;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@resetConfiguration - removing accessories %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v7 = v2;
  v8 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * i);
        [*(a1 + 32) removeAccessory:{v12, v14}];
        [v12 unconfigure];
      }

      v9 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_evaluateShouldRelaunchAndSetRelaunch
{
  v17 = *MEMORY[0x277D85DE8];
  if (![(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    v3 = [(HMDHome *)self accessories];
    v4 = [v3 countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v4)
    {
      v5 = v4;
      v6 = 0;
      v7 = *v13;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v13 != v7)
          {
            objc_enumerationMutation(v3);
          }

          v6 |= [*(*(&v12 + 1) + 8 * i) shouldEnableDaemonRelaunch];
        }

        v5 = [v3 countByEnumeratingWithState:&v12 objects:v16 count:16];
      }

      while (v5);

      if (v6)
      {
        goto LABEL_10;
      }
    }

    else
    {
    }

    v9 = [(HMDHome *)self launchHandler];
    v10 = [(HMDHome *)self uuid];
    [v9 deregisterRelaunchClientWithUUID:v10];
    goto LABEL_13;
  }

LABEL_10:
  v9 = [(HMDHome *)self launchHandler];
  v10 = [(HMDHome *)self uuid];
  [v9 registerRelaunchClientWithUUID:v10];
LABEL_13:

  v11 = *MEMORY[0x277D85DE8];
}

- (void)evaluateShouldRelaunchAndSetRelaunch
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __47__HMDHome_evaluateShouldRelaunchAndSetRelaunch__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

- (id)getTransactionFromHAPAccessory:(id)a3 hmdAccessory:(id)a4 uuid:(id)a5 hostAccessoryUUID:(id)a6 objectChangeType:(unint64_t)a7
{
  v103 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = v16;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  v19 = v14;
  if (v13)
  {
    v20 = [v13 transactionWithObjectChangeType:a7];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v21 = v20;
    }

    else
    {
      v21 = 0;
    }

    v22 = v21;
  }

  else
  {
    v23 = [HMDHAPAccessoryTransaction alloc];
    v20 = [(HMDHome *)self uuid];
    v22 = [(HMDBackingStoreModelObject *)v23 initWithObjectChangeType:a7 uuid:v19 parentUUID:v20];
  }

  v24 = v22;

  [(HMDHAPAccessoryTransaction *)v24 setHapAccessoryLocal:v12];
  v25 = [v13 providedName];
  if (v25)
  {
    goto LABEL_13;
  }

  if ([v12 linkType] != 2)
  {
    v25 = [v12 name];
    v26 = [v25 copy];
    [(HMDHAPAccessoryTransaction *)v24 setProvidedName:v26];

LABEL_13:
  }

  v84 = v15;
  v27 = [v12 uniqueIdentifier];
  [(HMDHAPAccessoryTransaction *)v24 setUniqueIdentifier:v27];

  v28 = [v12 identifier];
  [(HMDHAPAccessoryTransaction *)v24 setIdentifier:v28];

  v29 = [v12 identifier];
  v92 = 0;
  v30 = [(HMDHome *)self keychainStore];
  v91 = 0;
  v85 = [v30 readPublicKeyForAccessoryName:v29 registeredWithHomeKit:&v92 error:&v91];
  v83 = v91;

  if (v29 && v85 && v92 == 1)
  {
    v31 = objc_autoreleasePoolPush();
    v32 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v34 = v77 = v32;
      [v12 name];
      v35 = v78 = v31;
      [v12 uniqueIdentifier];
      v80 = self;
      v36 = v13;
      v37 = v29;
      v38 = v19;
      v40 = v39 = v18;
      *buf = 138544386;
      v94 = v34;
      v95 = 2112;
      v96 = v35;
      v97 = 2112;
      v98 = v40;
      v99 = 2112;
      v100 = v37;
      v101 = 2112;
      v102 = v85;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ setting pairing username and pubkey to ('%@', '%@')", buf, 0x34u);

      v18 = v39;
      v19 = v38;
      v29 = v37;
      v13 = v36;
      self = v80;

      v31 = v78;
      v32 = v77;
    }

    objc_autoreleasePoolPop(v31);
    [(HMDHAPAccessoryTransaction *)v24 setPairingUsername:v29];
    [(HMDHAPAccessoryTransaction *)v24 setPublicKey:v85];
  }

  else
  {
    v41 = objc_autoreleasePoolPush();
    v42 = self;
    v43 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v43, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v79 = v18;
      v44 = v81 = v13;
      [(HMDHAPAccessoryTransaction *)v24 providedName];
      v45 = self;
      v47 = v46 = v19;
      *buf = 138544130;
      v94 = v44;
      v95 = 2112;
      v96 = v47;
      v97 = 2112;
      v98 = v29;
      v99 = 2112;
      v100 = v83;
      _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_ERROR, "%{public}@Failed to read public key for accessory %@ with pairing username %@: %@", buf, 0x2Au);

      v19 = v46;
      self = v45;

      v18 = v79;
      v13 = v81;
    }

    objc_autoreleasePoolPop(v41);
  }

  v48 = [v84 UUIDString];
  [(HMDHAPAccessoryTransaction *)v24 setHostAccessoryUUID:v48];

  v49 = [(HMDHAPAccessoryTransaction *)v24 hostAccessoryUUID];
  v50 = v49;
  if (v19 && !v49 && v18)
  {
    v51 = [v18 sensorAccessoryUUID];
    v52 = [v51 hmf_isEqualToUUID:v19];

    if (!v52)
    {
      goto LABEL_29;
    }

    v50 = [v18 uuid];
    v53 = [v50 UUIDString];
    [(HMDHAPAccessoryTransaction *)v24 setHostAccessoryUUID:v53];
  }

LABEL_29:
  v82 = v19;
  v54 = [v13 category];

  if (!v54)
  {
    v55 = [v12 category];

    if (v55)
    {
      v56 = [v12 category];
      [(HMDHAPAccessoryTransaction *)v24 setAccessoryCategory:v56];
    }

    else
    {
      v56 = [(HMDHome *)self dataSource];
      v57 = [v56 hapMetadata];
      v58 = [v57 categoryForOther];
      [v58 identifier];
      v59 = v13;
      v60 = v29;
      v62 = v61 = v18;
      [(HMDHAPAccessoryTransaction *)v24 setAccessoryCategory:v62];

      v18 = v61;
      v29 = v60;
      v13 = v59;
    }
  }

  v63 = [MEMORY[0x277CBEB58] set];
  v64 = MEMORY[0x277CBEB58];
  v65 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v12, "linkType")}];
  v66 = [v64 setWithObject:v65];

  v67 = [v12 servicesOfType:@"00000701-0000-1000-8000-0026BB765291"];
  v68 = [v67 count];

  if (v68)
  {
    [v66 addObject:&unk_283E71A08];
  }

  v88[0] = MEMORY[0x277D85DD0];
  v88[1] = 3221225472;
  v88[2] = __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke;
  v88[3] = &unk_27866FA70;
  v69 = v63;
  v89 = v69;
  v90 = v12;
  v70 = v12;
  [v66 na_each:v88];
  v71 = [v13 transportInformationInstances];
  v86[0] = MEMORY[0x277D85DD0];
  v86[1] = 3221225472;
  v86[2] = __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke_2;
  v86[3] = &unk_27866FA98;
  v87 = v69;
  v72 = v69;
  [v71 na_each:v86];

  v73 = [v72 allObjects];
  [(HMDHAPAccessoryTransaction *)v24 setTransportInformation:v73];

  v74 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v70, "communicationProtocol")}];
  [(HMDHAPAccessoryTransaction *)v24 setCommunicationProtocol:v74];

  v75 = *MEMORY[0x277D85DE8];

  return v24;
}

void __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke(uint64_t a1, void *a2)
{
  v11[3] = *MEMORY[0x277D85DE8];
  v10[0] = @"HM.serverIdentifier";
  v3 = *(a1 + 32);
  v4 = *(a1 + 40);
  v5 = a2;
  v6 = [v4 serverIdentifier];
  v11[0] = v6;
  v10[1] = @"HM.instanceID";
  v7 = [*(a1 + 40) instanceID];
  v10[2] = @"linkType";
  v11[1] = v7;
  v11[2] = v5;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v11 forKeys:v10 count:3];
  [v3 addObject:v8];

  v9 = *MEMORY[0x277D85DE8];
}

void __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 transportInfoDictionary];
  [v2 addObject:v3];
}

- (id)getServiceTransaction:(id)a3 parentUUID:(id)a4 changeType:(unint64_t)a5
{
  v7 = a3;
  v8 = a4;
  v9 = [v7 instanceID];
  v10 = [HMDService generateUUIDWithAccessoryUUID:v8 serviceID:v9];

  v11 = [(HMDBackingStoreModelObject *)[HMDServiceTransaction alloc] initWithObjectChangeType:a5 uuid:v10 parentUUID:v8];
  if (v7)
  {
    v12 = [v7 instanceID];
    [(HMDServiceTransaction *)v11 setInstanceID:v12];

    v13 = [v7 type];
    [(HMDServiceTransaction *)v11 setServiceType:v13];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v7;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v15 = v14;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;

      v17 = [v16 endpoint];

      [(HMDServiceTransaction *)v11 setMatterEndpointID:v17];
    }

    v18 = [v7 linkedServices];

    if (v18)
    {
      v19 = [v7 linkedServices];
      v20 = [v19 copy];
      [(HMDServiceTransaction *)v11 setLinkedServices:v20];
    }

    v21 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v7, "serviceProperties")}];
    [(HMDServiceTransaction *)v11 setServiceProperties:v21];
  }

  return v11;
}

- (void)evaluateBulletinNotificationsSupported
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __49__HMDHome_evaluateBulletinNotificationsSupported__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

void __49__HMDHome_evaluateBulletinNotificationsSupported__block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) residentDeviceManager];
  v3 = [v2 availableResidentDevices];
  v4 = [v3 count];

  if ((v4 != 0) != [*(a1 + 32) bulletinNotificationsSupported])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      [*(a1 + 32) bulletinNotificationsSupported];
      v9 = HMFBooleanToString();
      v10 = HMFBooleanToString();
      v14 = 138543874;
      v15 = v8;
      v16 = 2112;
      v17 = v9;
      v18 = 2112;
      v19 = v10;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Bulletin notifications supported has changed from: %@ to: %@", &v14, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 32) setBulletinNotificationsSupported:v4 != 0];
    v11 = [*(a1 + 32) homeManager];
    v12 = [*(a1 + 32) uuid];
    [v11 updateGenerationCounterWithReason:@"Bulletin Notifications Supported Updated" sourceUUID:v12 shouldNotifyClients:1];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)evaluateResidentUpdate
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __33__HMDHome_evaluateResidentUpdate__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)reEvaluateHomeHubState
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __33__HMDHome_reEvaluateHomeHubState__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

void __33__HMDHome_reEvaluateHomeHubState__block_invoke(uint64_t a1)
{
  v17[1] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) residentDeviceManager];
  v3 = [v2 residentDevices];

  v4 = 2 * ([v3 count] != 0);
  v5 = [*(a1 + 32) residentDeviceManager];
  v6 = [v5 primaryResidentDevice];

  if ([v6 isEnabled] && objc_msgSend(v6, "isReachable"))
  {
    v4 = 1;
  }

  v7 = *(a1 + 32);
  if (*(v7 + 888) != v4)
  {
    *(v7 + 888) = v4;
    v8 = MEMORY[0x277D0F818];
    v9 = *MEMORY[0x277CCFFF8];
    v16 = *MEMORY[0x277CCFFF0];
    v10 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(*(a1 + 32), "homeHubState")}];
    v17[0] = v10;
    v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:&v16 count:1];
    v12 = [v8 messageWithName:v9 messagePayload:v11];

    v13 = [*(a1 + 32) msgDispatcher];
    v14 = [*(a1 + 32) uuid];
    [v13 sendMessage:v12 target:v14];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (id)matterAccessoriesWithNewFirmwareInstalledInHome
{
  v37 = *MEMORY[0x277D85DE8];
  v24 = [MEMORY[0x277CBEB18] array];
  if (([(HMDHome *)self isOwnerUser]|| [(HMDHome *)self isSharedAdmin]) && ![(HMDHome *)self isAutomaticThirdPartyAccessorySoftwareUpdateEnabled])
  {
    v28 = 0u;
    v29 = 0u;
    v26 = 0u;
    v27 = 0u;
    v3 = [(HMDHome *)self accessories];
    v4 = [v3 copy];

    v5 = [v4 countByEnumeratingWithState:&v26 objects:v36 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v27;
      v21 = self;
      v23 = v4;
      v20 = *v27;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v27 != v7)
          {
            objc_enumerationMutation(v4);
          }

          v9 = *(*(&v26 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v10 = v9;
          }

          else
          {
            v10 = 0;
          }

          v11 = v10;

          if ([v11 supportsCHIP])
          {
            v12 = [v9 softwareUpdate];
            v13 = v12;
            if (v12 && [v12 state] == 4)
            {
              context = objc_autoreleasePoolPush();
              v14 = self;
              v15 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
              {
                v16 = HMFGetLogIdentifier();
                v22 = [v9 uuid];
                v17 = [v22 UUIDString];
                *buf = 138543874;
                v31 = v16;
                v32 = 2114;
                v33 = v17;
                v34 = 2112;
                v35 = v13;
                _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ has a firmware recently installed, softwareUpdate %@", buf, 0x20u);

                self = v21;
                v7 = v20;
              }

              objc_autoreleasePoolPop(context);
              [v24 addObject:v9];
              v4 = v23;
            }
          }
        }

        v6 = [v4 countByEnumeratingWithState:&v26 objects:v36 count:16];
      }

      while (v6);
    }
  }

  v18 = *MEMORY[0x277D85DE8];

  return v24;
}

- (void)_handleConfirmResidentRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self residentDeviceManager];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome__handleConfirmResidentRequest___block_invoke;
  v7[3] = &unk_27868A250;
  v8 = v4;
  v6 = v4;
  [v5 confirmWithCompletionHandler:v7];
}

- (id)namesOfServicesWithNewFirmwareAvailableInHome
{
  v86 = *MEMORY[0x277D85DE8];
  v69 = [MEMORY[0x277CBEB18] array];
  if ([(HMDHome *)self isOwnerUser])
  {
    v75 = 0u;
    v76 = 0u;
    v73 = 0u;
    v74 = 0u;
    v3 = [(HMDHome *)self accessories];
    v4 = [v3 copy];

    obj = v4;
    v5 = [v4 countByEnumeratingWithState:&v73 objects:v85 count:16];
    if (!v5)
    {
      goto LABEL_56;
    }

    v7 = v5;
    v8 = *v74;
    *&v6 = 138544130;
    v61 = v6;
    v70 = *v74;
    while (1)
    {
      v9 = 0;
      v71 = v7;
      do
      {
        if (*v74 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v10 = *(*(&v73 + 1) + 8 * v9);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & 1) != 0 && v10)
        {
          if (![(HMDHome *)self isAutomaticThirdPartyAccessorySoftwareUpdateEnabled])
          {
            goto LABEL_11;
          }

          v12 = [(HMDHome *)self residentDeviceManager];
          v13 = [v12 availableResidentDevices];
          v14 = [v13 count];

          v7 = v71;
          if (!v14)
          {
LABEL_11:
            v15 = self;
            v16 = v10;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v17 = v16;
            }

            else
            {
              v17 = 0;
            }

            v18 = v17;

            if ([v18 supportsCHIP])
            {
              v19 = [v16 softwareUpdate];
              v20 = v19;
              if (v19 && [v19 state] == 2)
              {
                v21 = objc_autoreleasePoolPush();
                v22 = v15;
                v23 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
                {
                  v24 = HMFGetLogIdentifier();
                  [v16 uuid];
                  v25 = v66 = v21;
                  v26 = [v25 UUIDString];
                  *buf = 138543618;
                  v78 = v24;
                  v79 = 2114;
                  v80 = v26;
                  _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Matter accessory %{public}@ has a firmware update", buf, 0x16u);

                  v7 = v71;
                  v21 = v66;
                }

                objc_autoreleasePoolPop(v21);
                v27 = [v16 name];
                [v69 addObject:v27];
LABEL_48:
              }

              self = v15;
              v8 = v70;
LABEL_50:

              goto LABEL_51;
            }

            v20 = [v16 vendorInfo];
            v36 = [v16 firmwareVersion];
            if (v36 && [v16 isPrimary])
            {
              v37 = [v20 firmwareVersion];
              v38 = [v16 firmwareVersion];
              v39 = [v37 isGreaterThanVersion:v38];
            }

            else
            {
              v39 = 0;
            }

            if (v20 && ([v20 firmwareVersion], (v40 = objc_claimAutoreleasedReturnValue()) != 0) && (v41 = v40, v42 = objc_msgSend(v16, "isPrimary"), v41, (v42 & 1) != 0))
            {
              if (!v39)
              {
                self = v15;
                v8 = v70;
                v7 = v71;
                goto LABEL_50;
              }

              v43 = objc_autoreleasePoolPush();
              v44 = v15;
              v45 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
              {
                v46 = HMFGetLogIdentifier();
                v64 = [v16 uuid];
                v47 = [v64 UUIDString];
                [v20 firmwareVersion];
                v48 = v67 = v43;
                [v20 productData];
                v49 = v62 = v44;
                *buf = v61;
                v78 = v46;
                v79 = 2114;
                v80 = v47;
                v81 = 2114;
                v82 = v48;
                v83 = 2112;
                v84 = v49;
                _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ has a firmware update, vendor database indicates available firmware version %{public}@ for product data %@", buf, 0x2Au);

                v44 = v62;
                v43 = v67;
              }

              objc_autoreleasePoolPop(v43);
              v27 = [v16 namesOfServicesShowingTilesInHomeApp];
              [v69 addObjectsFromArray:v27];
            }

            else
            {
              v50 = [v16 softwareUpdate];
              v27 = v50;
              if (v50 && [v50 state] == 2)
              {
                v51 = objc_autoreleasePoolPush();
                v52 = v15;
                v53 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
                {
                  v63 = HMFGetLogIdentifier();
                  v65 = [v16 uuid];
                  [v65 UUIDString];
                  v54 = v68 = v51;
                  v55 = [v16 firmwareVersion];
                  *buf = 138543874;
                  v78 = v63;
                  v79 = 2114;
                  v80 = v54;
                  v81 = 2114;
                  v82 = v55;
                  v56 = v55;
                  _os_log_impl(&dword_229538000, v53, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ currentFirmwareVersion %{public}@ has a firmware update", buf, 0x20u);

                  v51 = v68;
                }

                objc_autoreleasePoolPop(v51);
                v57 = [v16 name];
                [v69 addObject:v57];
              }
            }

            v7 = v71;
            goto LABEL_48;
          }
        }

        else
        {
          v28 = v10;
          objc_opt_class();
          v29 = objc_opt_isKindOfClass();

          if ((v29 & 1) != 0 && v10 && ![(HMDHome *)self isAutomaticSoftwareUpdateEnabled])
          {
            v30 = v28;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v31 = v30;
            }

            else
            {
              v31 = 0;
            }

            v18 = v31;

            if ([v18 supportsTVOSUpdateManualUpdateAvailableNotification])
            {
              v32 = [v18 softwareUpdateListener];
              v33 = [v32 isSoftwareUpdateAvailable];

              if (v33)
              {
                goto LABEL_30;
              }
            }

            if (([v18 supportsTVOSUpdateManualUpdateAvailableNotification] & 1) == 0)
            {
              v34 = [v18 softwareUpdateListener];
              v35 = [v34 isSoftwareUpdateDownloadedAndReadyForInstallation];

              if (v35)
              {
LABEL_30:
                v20 = [v18 name];
                [v69 addObject:v20];
                goto LABEL_50;
              }
            }

LABEL_51:
          }
        }

        ++v9;
      }

      while (v7 != v9);
      v58 = [obj countByEnumeratingWithState:&v73 objects:v85 count:16];
      v7 = v58;
      if (!v58)
      {
LABEL_56:

        break;
      }
    }
  }

  v59 = *MEMORY[0x277D85DE8];

  return v69;
}

- (BOOL)_hasPairedReachableBTLEAccessories
{
  v2 = [(HMDHome *)self hapAccessories];
  v3 = [v2 na_any:&__block_literal_global_1012];

  return v3;
}

unint64_t __45__HMDHome__hasPairedReachableBTLEAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 hasBTLELink])
  {
    v3 = ([v2 reachableTransports] >> 1) & 1;
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)_registerForReachabilityChangeNotificationsEnabled:(BOOL)a3 completionHandler:(id)a4
{
  v4 = a3;
  v33 = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = [(HMDHome *)self isCurrentDevicePrimaryResident];
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  v11 = v10;
  if (v7)
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v30 = v12;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability notifications because we are the primary resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    v6[2](v6, 1);
  }

  else
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMFBooleanToString();
      *buf = 138543618;
      v30 = v13;
      v31 = 2112;
      v32 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Setting remote accessory reachability notifications enabled to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v15 = [(HMDHome *)v9 uuid];
    v16 = [v15 UUIDString];

    v27 = *MEMORY[0x277CD0640];
    v28 = v16;
    v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v28 forKeys:&v27 count:1];
    objc_initWeak(buf, v9);
    if (v4)
    {
      v18 = @"kEnableAccessoryReachabilityNotificationRequestKey";
    }

    else
    {
      v18 = @"kDisableAccessoryReachabilityNotificationRequestKey";
    }

    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __80__HMDHome__registerForReachabilityChangeNotificationsEnabled_completionHandler___block_invoke;
    v23[3] = &unk_27866FA48;
    objc_copyWeak(&v25, buf);
    v26 = v4;
    v24 = v6;
    v19 = [HMDRemoteMessage messageWithName:v18 messagePayload:v17 responseHandler:v23];
    v20 = [(HMDHome *)v9 uuid];
    v21 = [(HMDHome *)v9 workQueue];
    [(HMDHome *)v9 redispatchToResidentMessage:v19 target:v20 responseQueue:v21];

    objc_destroyWeak(&v25);
    objc_destroyWeak(buf);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome__registerForReachabilityChangeNotificationsEnabled_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v28 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (!WeakRetained)
  {
    goto LABEL_15;
  }

  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (!v11)
    {
      goto LABEL_13;
    }

    v12 = HMFGetLogIdentifier();
    v13 = *(a1 + 48);
    v22 = 138543874;
    v23 = v12;
    if (v13)
    {
      v14 = "register";
    }

    else
    {
      v14 = "de-register";
    }

    v24 = 2080;
    v25 = v14;
    v26 = 2112;
    v27 = v5;
    v15 = "%{public}@Failed to %s remote accessory reachability notification with error: %@";
    v16 = v10;
    v17 = 32;
  }

  else
  {
    if (!v11)
    {
      goto LABEL_13;
    }

    v18 = HMFGetLogIdentifier();
    v12 = v18;
    v19 = "de-registered";
    if (*(a1 + 48))
    {
      v19 = "registered";
    }

    v22 = 138543618;
    v23 = v18;
    v24 = 2080;
    v25 = v19;
    v15 = "%{public}@Successfully %s remote accessory reachability notification";
    v16 = v10;
    v17 = 22;
  }

  _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, v15, &v22, v17);

LABEL_13:
  objc_autoreleasePoolPop(v8);
  v20 = *(a1 + 32);
  if (v20)
  {
    (*(v20 + 16))(v20, v5 == 0);
  }

LABEL_15:

  v21 = *MEMORY[0x277D85DE8];
}

- (BOOL)currentRemoteReachabilityRegistration
{
  v2 = [(HMDHome *)self stagedRemoteReachabilityRegistration];
  v3 = [v2 value];

  LOBYTE(v2) = [v3 BOOLValue];
  return v2;
}

- (id)_primaryAccessoryForServer:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  [(HMDHome *)self hapAccessoriesForServer:v4];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v5 = v18 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        if ([v9 isPrimary])
        {
          v14 = 0;
          v10 = [v4 identifier];
          v11 = [v9 matchesHAPAccessoryWithServerIdentifier:v10 linkType:&v14];

          if (v11)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_12:

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (id)hapAccessoriesForServer:(id)a3
{
  v4 = a3;
  v5 = [v4 identifier];
  v6 = [v4 linkType];

  v7 = [(HMDHome *)self hapAccessoriesForServer:v5 linkType:v6];

  return v7;
}

- (id)hapAccessoriesForServer:(id)a3 linkType:(int64_t)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [(HMDHome *)self accessories];
  v8 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v7, "count")}];
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v9 = v7;
  v10 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v21;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v21 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = *(*(&v20 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v16 = v15;

        if (v16)
        {
          v19 = a4;
          if ([v16 matchesHAPAccessoryWithServerIdentifier:v6 linkType:&v19])
          {
            [v8 addObject:v16];
          }
        }
      }

      v11 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
    }

    while (v11);
  }

  v17 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)readProfileState:(id)a3 viaDevice:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __38__HMDHome_readProfileState_viaDevice___block_invoke;
  block[3] = &unk_27868A010;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(v8, block);
}

- (void)_readProfileState:(void *)a3 viaDevice:
{
  v30 = *MEMORY[0x277D85DE8];
  v19 = a2;
  v17 = a3;
  val = a1;
  if (a1)
  {
    v5 = MEMORY[0x277CBEB18];
    v6 = [v19 count];
    v7 = +[HMDMediaSession mediaPropertyMessageKeys];
    v8 = [v5 arrayWithCapacity:{objc_msgSend(v7, "count") * v6}];

    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    obj = v19;
    v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
    if (v9)
    {
      v10 = *v26;
      v11 = MEMORY[0x277D85DD0];
      do
      {
        v12 = 0;
        do
        {
          if (*v26 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v13 = *(*(&v25 + 1) + 8 * v12);
          v14 = +[HMDMediaSession mediaPropertyMessageKeys];
          v24[0] = v11;
          v24[1] = 3221225472;
          v24[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke;
          v24[3] = &unk_278686D38;
          v24[4] = v13;
          v15 = [v14 na_map:v24];

          [v8 addObjectsFromArray:v15];
          ++v12;
        }

        while (v9 != v12);
        v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
      }

      while (v9);
    }

    objc_initWeak(&location, val);
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke_2;
    v21[3] = &unk_2786895F0;
    objc_copyWeak(&v22, &location);
    [val redispatchMediaReadRequests:v8 viaDevice:v17 completion:v21];
    objc_destroyWeak(&v22);
    objc_destroyWeak(&location);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __39__HMDHome__readProfileState_viaDevice___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke_3;
    v7[3] = &unk_27868A750;
    v8 = v3;
    v9 = v5;
    dispatch_async(v6, v7);
  }
}

void __39__HMDHome__readProfileState_viaDevice___block_invoke_3(uint64_t a1)
{
  v1 = a1;
  v160 = *MEMORY[0x277D85DE8];
  v2 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(*(a1 + 32), "count")}];
  v130 = 0u;
  v131 = 0u;
  v132 = 0u;
  v133 = 0u;
  obj = *(v1 + 32);
  v103 = v1;
  v108 = v2;
  v106 = [obj countByEnumeratingWithState:&v130 objects:v159 count:16];
  if (v106)
  {
    v105 = *v131;
    v125 = *MEMORY[0x277CD0910];
    v122 = *MEMORY[0x277CD0938];
    v120 = *MEMORY[0x277CD0990];
    v118 = *MEMORY[0x277CD0960];
    v116 = *MEMORY[0x277CD09B0];
    v114 = *MEMORY[0x277CD0920];
    v112 = *MEMORY[0x277CD09A0];
    *&v3 = 138544130;
    v101 = v3;
    do
    {
      v4 = 0;
      do
      {
        if (*v131 != v105)
        {
          objc_enumerationMutation(obj);
        }

        v109 = v4;
        v5 = *(*(&v130 + 1) + 8 * v4);
        v126 = 0u;
        v127 = 0u;
        v128 = 0u;
        v129 = 0u;
        v6 = v5;
        v7 = [v6 countByEnumeratingWithState:&v126 objects:v158 count:16];
        if (!v7)
        {

          v9 = 0;
          v121 = 0;
          v119 = 0;
          v117 = 0;
          v115 = 0;
          v113 = 0;
LABEL_61:
          v34 = [v9 mediaSession];
          v40 = [v34 state];
          v8 = 0;
          goto LABEL_62;
        }

        v113 = 0;
        v115 = 0;
        v117 = 0;
        v119 = 0;
        v121 = 0;
        v123 = 0;
        v8 = 0;
        v9 = 0;
        v10 = *v127;
        do
        {
          for (i = 0; i != v7; i = i + 1)
          {
            if (*v127 != v10)
            {
              objc_enumerationMutation(v6);
            }

            v12 = *(*(&v126 + 1) + 8 * i);
            v13 = [v12 error];

            if (!v13)
            {
              v14 = [v12 request];
              v15 = [v14 mediaProfile];

              v16 = [v14 property];
              v17 = [v16 isEqual:v125];

              if (v17)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v8;
                v8 = v19;
                goto LABEL_47;
              }

              v21 = [v14 property];
              v22 = [v21 isEqual:v122];

              if (v22)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v123;
                v123 = v19;
                goto LABEL_47;
              }

              v23 = [v14 property];
              v24 = [v23 isEqual:v120];

              if (v24)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v121;
                v121 = v19;
                goto LABEL_47;
              }

              v25 = [v14 property];
              v26 = [v25 isEqual:v118];

              if (v26)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v119;
                v119 = v19;
                goto LABEL_47;
              }

              v27 = [v14 property];
              v28 = [v27 isEqual:v116];

              if (v28)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v117;
                v117 = v19;
                goto LABEL_47;
              }

              v29 = [v14 property];
              v30 = [v29 isEqual:v114];

              if (v30)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v115;
                v115 = v19;
                goto LABEL_47;
              }

              v31 = [v14 property];
              v32 = [v31 isEqual:v112];

              if (v32)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v113;
                v113 = v19;
LABEL_47:
                v33 = v19;
              }

              v9 = v15;
              continue;
            }
          }

          v7 = [v6 countByEnumeratingWithState:&v126 objects:v158 count:16];
        }

        while (v7);

        v2 = v108;
        if (!v8)
        {
          v1 = v103;
          v7 = v123;
          goto LABEL_61;
        }

        v34 = [v9 accessory];
        v35 = [v9 uniqueIdentifier];
        v36 = [v35 UUIDString];
        v37 = [v8 isEqualToString:v36];

        v1 = v103;
        v7 = v123;
        if (v37)
        {
          v38 = [v34 identifier];

          v8 = v38;
        }

        v39 = [v34 home];
        v40 = [v39 mediaSessionStateWithIdentifier:v8];
        if (!v40)
        {
          v41 = objc_autoreleasePoolPush();
          v42 = *(v103 + 40);
          v43 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v44 = v110 = v41;
            v45 = [v34 identifier];
            v46 = *(v103 + 32);
            *buf = v101;
            v151 = v44;
            v152 = 2112;
            v153 = v8;
            v154 = 2112;
            v155 = v45;
            v156 = 2112;
            v157 = v46;
            _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@Creating a media session state for a remote session (sessionIdentifier %@; accessoryIdentifier %@) update - responses %@", buf, 0x2Au);

            v41 = v110;
          }

          objc_autoreleasePoolPop(v41);
          v40 = [[HMDMediaSessionState alloc] initWithSessionIdentifier:v8];
          [v39 addMediaSessionState:v40];
          v7 = v123;
        }

LABEL_62:
        v47 = [v9 accessory];
        v48 = [v47 uuid];
        v49 = [v48 UUIDString];

        if (v49 && v40)
        {
          v104 = v47;
          v50 = MEMORY[0x277CBEB38];
          v107 = v49;
          v51 = [v2 hmf_dictionaryForKey:v49];
          v52 = [v50 dictionaryWithDictionary:v51];

          v53 = v7 != 0;
          v124 = v7;
          v111 = v40;
          v54 = v52;
          if (v7)
          {
            v55 = [v7 unsignedIntegerValue];
            [(HMDMediaSessionState *)v40 setPlaybackState:v55];
            v56 = objc_autoreleasePoolPush();
            v57 = *(v1 + 40);
            v58 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
            {
              v59 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v59;
              v152 = 2048;
              v153 = v55;
              _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_INFO, "%{public}@Read the profile playback state as %tu", buf, 0x16u);

              v40 = v111;
            }

            objc_autoreleasePoolPop(v56);
            v7 = v124;
            v148 = v122;
            v149 = v124;
            v60 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v149 forKeys:&v148 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v60];
          }

          if (v121)
          {
            v61 = [v121 unsignedIntegerValue];
            [(HMDMediaSessionState *)v40 setShuffleState:v61];
            v62 = objc_autoreleasePoolPush();
            v63 = *(v1 + 40);
            v64 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v64, OS_LOG_TYPE_INFO))
            {
              v65 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v65;
              v152 = 2048;
              v153 = v61;
              _os_log_impl(&dword_229538000, v64, OS_LOG_TYPE_INFO, "%{public}@Read the profile shuffle state as %tu", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v62);
            v146 = v120;
            v147 = v121;
            v53 = 1;
            v66 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v147 forKeys:&v146 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v66];

            v7 = v124;
          }

          if (v119)
          {
            v67 = [v119 unsignedIntegerValue];
            [(HMDMediaSessionState *)v111 setRepeatState:v67];
            v68 = objc_autoreleasePoolPush();
            v69 = *(v1 + 40);
            v70 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v70, OS_LOG_TYPE_INFO))
            {
              v71 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v71;
              v152 = 2048;
              v153 = v67;
              _os_log_impl(&dword_229538000, v70, OS_LOG_TYPE_INFO, "%{public}@Read the profile repeat state as %tu", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v68);
            v144 = v118;
            v145 = v119;
            v53 = 1;
            v72 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v145 forKeys:&v144 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v72];

            v7 = v124;
          }

          if (v117)
          {
            [(HMDMediaSessionState *)v111 setVolume:v117];
            v73 = objc_autoreleasePoolPush();
            v74 = *(v1 + 40);
            v75 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v75, OS_LOG_TYPE_INFO))
            {
              v76 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v76;
              v152 = 2112;
              v153 = v117;
              _os_log_impl(&dword_229538000, v75, OS_LOG_TYPE_INFO, "%{public}@Read the profile volume as %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v73);
            v142 = v116;
            v143 = v117;
            v53 = 1;
            v77 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v143 forKeys:&v142 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v77];
          }

          if (v115)
          {
            [(HMDMediaSessionState *)v111 setMediaUniqueIdentifier:v115];
            v78 = objc_autoreleasePoolPush();
            v79 = *(v1 + 40);
            v80 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v80, OS_LOG_TYPE_INFO))
            {
              v81 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v81;
              v152 = 2112;
              v153 = v115;
              _os_log_impl(&dword_229538000, v80, OS_LOG_TYPE_INFO, "%{public}@Read the profile mediaUniqueIdentifier state as %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v78);
            v140 = v114;
            v141 = v115;
            v82 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v141 forKeys:&v140 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v82];

            v40 = v111;
            v49 = v107;
            if (!v113)
            {
LABEL_89:
              [v108 setObject:v52 forKey:v49];
              goto LABEL_90;
            }

LABEL_86:
            v83 = [v113 unsignedIntegerValue];
            [(HMDMediaSessionState *)v40 setSleepWakeState:v83];
            v84 = objc_autoreleasePoolPush();
            v85 = *(v1 + 40);
            v86 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v86, OS_LOG_TYPE_INFO))
            {
              v87 = HMFGetLogIdentifier();
              *buf = 138543618;
              v151 = v87;
              v152 = 2048;
              v153 = v83;
              _os_log_impl(&dword_229538000, v86, OS_LOG_TYPE_INFO, "%{public}@Read the profile sleepWakeState as %tu", buf, 0x16u);

              v40 = v111;
            }

            objc_autoreleasePoolPop(v84);
            v138 = v112;
            v139 = v113;
            v88 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v139 forKeys:&v138 count:1];
            v52 = v54;
            [v54 addEntriesFromDictionary:v88];

            v7 = v124;
            v49 = v107;
            goto LABEL_89;
          }

          v40 = v111;
          v49 = v107;
          if (v113)
          {
            goto LABEL_86;
          }

          if (v53)
          {
            goto LABEL_89;
          }

LABEL_90:

          v2 = v108;
          v47 = v104;
        }

        v4 = v109 + 1;
      }

      while (v109 + 1 != v106);
      v89 = [obj countByEnumeratingWithState:&v130 objects:v159 count:16];
      v106 = v89;
    }

    while (v89);
  }

  if ([v2 count])
  {
    v90 = [*(v1 + 40) uuid];
    v91 = [v90 UUIDString];
    v136 = v91;
    v134 = *MEMORY[0x277CCE7A8];
    v92 = [v108 copy];
    v135 = v92;
    v93 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v135 forKeys:&v134 count:1];
    v137 = v93;
    v94 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v137 forKeys:&v136 count:1];

    v95 = [MEMORY[0x277D0F848] entitledMessageWithName:*MEMORY[0x277CD0340] messagePayload:v94];
    v96 = [[HMDHomeManagerXPCMessageSendPolicy alloc] initWithEntitlements:0 options:-1 active:1];
    [v95 setSendPolicy:v96];

    v97 = [*(v103 + 40) msgDispatcher];
    v98 = [*(v103 + 40) homeManager];
    v99 = [v98 uuid];
    [v97 sendMessage:v95 target:v99];

    v1 = v103;
    v2 = v108;
  }

  [(HMDHome *)*(v1 + 40) updateMediaStateWithResponses:0 requestMessageInformation:?];

  v100 = *MEMORY[0x277D85DE8];
}

- (void)_getRunTimeStateUpdateWithOptions:(unint64_t)a3 includeMediaAccessorySessionState:(BOOL)a4 includeResidentDeviceState:(BOOL)a5 completion:(id)a6
{
  v6 = a5;
  v90 = a4;
  v7 = a3;
  v108 = *MEMORY[0x277D85DE8];
  v9 = a6;
  v10 = v9;
  if (!v9)
  {
    goto LABEL_73;
  }

  v71 = v6;
  v73 = v9;
  v11 = [(HMDHome *)self accessories];
  v85 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v11, "count")}];
  v72 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v74 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v11, "count")}];
  v99 = 0u;
  v100 = 0u;
  v101 = 0u;
  v102 = 0u;
  obj = v11;
  v81 = self;
  v89 = [obj countByEnumeratingWithState:&v99 objects:v107 count:16];
  if (!v89)
  {
    goto LABEL_52;
  }

  v88 = v7 & 0x201;
  v87 = v7 & 0x50;
  v86 = *v100;
  v80 = *MEMORY[0x277CD0938];
  v79 = *MEMORY[0x277CD0990];
  v78 = *MEMORY[0x277CD0960];
  v77 = *MEMORY[0x277CD09B0];
  v76 = *MEMORY[0x277CD0920];
  v75 = *MEMORY[0x277CD09A0];
  v84 = v7;
  do
  {
    for (i = 0; i != v89; ++i)
    {
      if (*v100 != v86)
      {
        objc_enumerationMutation(obj);
      }

      v13 = *(*(&v99 + 1) + 8 * i);
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v14 = v13;
      }

      else
      {
        v14 = 0;
      }

      v15 = v14;

      v16 = v15;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v17 = v16;
      }

      else
      {
        v17 = 0;
      }

      v18 = v17;

      v19 = v16;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v20 = v19;
      }

      else
      {
        v20 = 0;
      }

      v21 = v20;

      v22 = v13;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v23 = v22;
      }

      else
      {
        v23 = 0;
      }

      v24 = v23;

      if (v19)
      {
        v25 = v90;
      }

      else
      {
        v25 = 0;
      }

      if (v87)
      {
        v26 = v21 == 0;
      }

      else
      {
        v26 = 1;
      }

      v27 = !v26;
      if (v88)
      {
        v28 = v24 == 0;
      }

      else
      {
        v28 = 1;
      }

      v29 = !v28;
      if (v25 || (v27 & 1) != 0 || ((v18 != 0) & (v7 >> 8)) != 0 || (v29 & 1) != 0 || (v7 & 0x400) != 0 && [v24 hasTelevisionService])
      {
        v30 = [v22 runtimeState];
        v31 = [v30 mutableCopy];

        if (v19 && v90)
        {
          v32 = [v19 mediaProfile];
          v33 = v32;
          if (v32)
          {
            v82 = [v32 mediaSession];
            v34 = [v82 state];
            if (v34)
            {
              v35 = v34;
              goto LABEL_46;
            }

            v36 = [v19 identifier];
            v35 = [(HMDHome *)v81 mediaSessionStateWithIdentifier:v36];

            if (v35)
            {
LABEL_46:
              v37 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v35, "playbackState")}];
              [v31 setObject:v37 forKeyedSubscript:v80];

              v38 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v35, "shuffleState")}];
              [v31 setObject:v38 forKeyedSubscript:v79];

              v39 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v35, "repeatState")}];
              [v31 setObject:v39 forKeyedSubscript:v78];

              v40 = [v35 volume];
              [v31 setObject:v40 forKeyedSubscript:v77];

              v41 = [v35 mediaUniqueIdentifier];
              [v31 setObject:v41 forKeyedSubscript:v76];

              v42 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v35, "sleepWakeState")}];
              [v31 setObject:v42 forKeyedSubscript:v75];
            }

            self = v81;
          }
        }

        v43 = [v31 copy];
        v44 = [v22 uuid];
        v45 = [v44 UUIDString];
        [v85 setObject:v43 forKeyedSubscript:v45];

        v7 = v84;
      }
    }

    v89 = [obj countByEnumeratingWithState:&v99 objects:v107 count:16];
  }

  while (v89);
LABEL_52:

  v105 = *MEMORY[0x277CCE7A8];
  v46 = [v85 copy];
  v106 = v46;
  v47 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v106 forKeys:&v105 count:1];
  v48 = [v47 mutableCopy];

  v10 = v73;
  if (v71)
  {
    v49 = [(HMDHome *)self residentDeviceManager];
    v50 = [v49 residentDevices];

    v51 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v50, "count")}];
    v95 = 0u;
    v96 = 0u;
    v97 = 0u;
    v98 = 0u;
    v52 = v50;
    v53 = [v52 countByEnumeratingWithState:&v95 objects:v104 count:16];
    if (v53)
    {
      v54 = v53;
      v55 = *v96;
      do
      {
        for (j = 0; j != v54; ++j)
        {
          if (*v96 != v55)
          {
            objc_enumerationMutation(v52);
          }

          v57 = *(*(&v95 + 1) + 8 * j);
          v58 = [v57 identifier];
          v59 = [v58 UUIDString];

          v60 = [v57 runtimeState];
          [v51 setObject:v60 forKey:v59];
        }

        v54 = [v52 countByEnumeratingWithState:&v95 objects:v104 count:16];
      }

      while (v54);
    }

    v61 = [v51 copy];
    [v48 setObject:v61 forKey:*MEMORY[0x277CD0550]];

    self = v81;
  }

  v62 = [v48 copy];
  v73[2](v73, v62);

  if ([v74 count])
  {
    [(HMDHome *)self _readProfileState:v74 viaDevice:0];
  }

  v93 = 0u;
  v94 = 0u;
  v91 = 0u;
  v92 = 0u;
  v63 = v72;
  v64 = [v63 countByEnumeratingWithState:&v91 objects:v103 count:16];
  if (v64)
  {
    v65 = v64;
    v66 = *v92;
    do
    {
      for (k = 0; k != v65; ++k)
      {
        if (*v92 != v66)
        {
          objc_enumerationMutation(v63);
        }

        v68 = *(*(&v91 + 1) + 8 * k);
        v69 = [v63 objectForKey:v68];
        if ([v69 count])
        {
          [(HMDHome *)self _readProfileState:v69 viaDevice:v68];
        }
      }

      v65 = [v63 countByEnumeratingWithState:&v91 objects:v103 count:16];
    }

    while (v65);
  }

LABEL_73:
  v70 = *MEMORY[0x277D85DE8];
}

- (void)getRunTimeStateUpdateWithOptions:(unint64_t)a3 includeMediaAccessorySessionState:(BOOL)a4 includeResidentDeviceState:(BOOL)a5 completion:(id)a6
{
  v10 = a6;
  v11 = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __116__HMDHome_getRunTimeStateUpdateWithOptions_includeMediaAccessorySessionState_includeResidentDeviceState_completion___block_invoke;
  v13[3] = &unk_27866FA20;
  v14 = v10;
  v15 = a3;
  v16 = a4;
  v17 = a5;
  v13[4] = self;
  v12 = v10;
  dispatch_async(v11, v13);
}

- (id)performReadRequests:(id)a3 withRetries:(int64_t)a4 timeInterval:(double)a5 loggingObject:(id)a6 flow:(id)a7
{
  v55 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v39 = a6;
  v38 = a7;
  v11 = [MEMORY[0x277CBEB38] dictionary];
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v12 = v10;
  v13 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v51;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v51 != v15)
        {
          objc_enumerationMutation(v12);
        }

        v17 = *(*(&v50 + 1) + 8 * i);
        v18 = [v17 characteristic];
        v19 = [v18 service];
        v20 = [v19 accessory];
        v21 = [v20 uuid];

        v22 = [v11 objectForKeyedSubscript:v21];

        if (v22)
        {
          v23 = [v11 objectForKeyedSubscript:v21];
          [v23 addObject:v17];
        }

        else
        {
          v23 = [MEMORY[0x277CBEB18] arrayWithObject:v17];
          [v11 setObject:v23 forKeyedSubscript:v21];
        }
      }

      v14 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
    }

    while (v14);
  }

  v24 = [v11 allValues];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke;
  v45[3] = &unk_27866F9D8;
  v49 = a5;
  v48 = a4;
  v45[4] = self;
  v25 = v39;
  v46 = v25;
  v26 = v38;
  v47 = v26;
  v27 = [v24 na_map:v45];

  v28 = MEMORY[0x277D2C900];
  v29 = MEMORY[0x277D2C938];
  v30 = [(HMDHome *)self workQueue];
  v31 = [v29 schedulerWithDispatchQueue:v30];
  v32 = [v28 combineAllFutures:v27 ignoringErrors:1 scheduler:v31];
  v42[0] = MEMORY[0x277D85DD0];
  v42[1] = 3221225472;
  v42[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_997;
  v42[3] = &unk_278683980;
  v43 = v25;
  v44 = v26;
  v33 = v26;
  v34 = v25;
  v35 = [v32 flatMap:v42];

  v36 = *MEMORY[0x277D85DE8];

  return v35;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = MEMORY[0x277D2C900];
  v5 = *(a1 + 56);
  v6 = *(a1 + 64);
  v7 = [*(a1 + 32) workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2;
  v13[3] = &unk_27866F9B0;
  v14 = *(a1 + 40);
  v8 = *(a1 + 48);
  v9 = *(a1 + 32);
  v15 = v8;
  v16 = v9;
  v17 = v3;
  v10 = v3;
  v11 = [v4 futureWithRetries:v5 timeInterval:v7 workQueue:v13 block:v6];

  return v11;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_997(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 na_map:&__block_literal_global_1000];
  if ([v4 hmf_isEmpty])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 40) UUID];
      v17 = 138543618;
      v18 = v8;
      v19 = 2112;
      v20 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] All read request retries failed.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v12 = [v10 futureWithError:v11];
  }

  else
  {
    v13 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CBEAC0] dictionaryByCombiningNonOverlappingDictionaries:v4];
    v12 = [v13 futureWithResult:v11];
  }

  v14 = v12;

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

void *__75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2_998(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v12 = 138543874;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2048;
    v17 = a2;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Performing characteristic read requests with remaining retries: %ld", &v12, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = [*(a1 + 48) performReadRequests:*(a1 + 56) loggingObject:*(a1 + 32) flow:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)performWriteRequests:(id)a3 withRetries:(int64_t)a4 timeInterval:(double)a5 loggingObject:(id)a6 flow:(id)a7
{
  v55 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v39 = a6;
  v38 = a7;
  v11 = [MEMORY[0x277CBEB38] dictionary];
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v12 = v10;
  v13 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v51;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v51 != v15)
        {
          objc_enumerationMutation(v12);
        }

        v17 = *(*(&v50 + 1) + 8 * i);
        v18 = [v17 characteristic];
        v19 = [v18 service];
        v20 = [v19 accessory];
        v21 = [v20 uuid];

        v22 = [v11 objectForKeyedSubscript:v21];

        if (v22)
        {
          v23 = [v11 objectForKeyedSubscript:v21];
          [v23 addObject:v17];
        }

        else
        {
          v23 = [MEMORY[0x277CBEB18] arrayWithObject:v17];
          [v11 setObject:v23 forKeyedSubscript:v21];
        }
      }

      v14 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
    }

    while (v14);
  }

  v24 = [v11 allValues];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke;
  v45[3] = &unk_27866F9D8;
  v49 = a5;
  v48 = a4;
  v45[4] = self;
  v25 = v39;
  v46 = v25;
  v26 = v38;
  v47 = v26;
  v27 = [v24 na_map:v45];

  v28 = MEMORY[0x277D2C900];
  v29 = MEMORY[0x277D2C938];
  v30 = [(HMDHome *)self workQueue];
  v31 = [v29 schedulerWithDispatchQueue:v30];
  v32 = [v28 combineAllFutures:v27 ignoringErrors:1 scheduler:v31];
  v42[0] = MEMORY[0x277D85DD0];
  v42[1] = 3221225472;
  v42[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_991;
  v42[3] = &unk_278683980;
  v43 = v25;
  v44 = v26;
  v33 = v26;
  v34 = v25;
  v35 = [v32 flatMap:v42];

  v36 = *MEMORY[0x277D85DE8];

  return v35;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = MEMORY[0x277D2C900];
  v5 = *(a1 + 56);
  v6 = *(a1 + 64);
  v7 = [*(a1 + 32) workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2;
  v13[3] = &unk_27866F9B0;
  v14 = *(a1 + 40);
  v8 = *(a1 + 48);
  v9 = *(a1 + 32);
  v15 = v8;
  v16 = v9;
  v17 = v3;
  v10 = v3;
  v11 = [v4 futureWithRetries:v5 timeInterval:v7 workQueue:v13 block:v6];

  return v11;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_991(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 na_map:&__block_literal_global_995];
  if ([v4 hmf_isEmpty])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 40) UUID];
      v17 = 138543618;
      v18 = v8;
      v19 = 2112;
      v20 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] All write request retries failed.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v12 = [v10 futureWithError:v11];
  }

  else
  {
    v13 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CBEAC0] dictionaryByCombiningNonOverlappingDictionaries:v4];
    v12 = [v13 futureWithResult:v11];
  }

  v14 = v12;

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

void *__76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2_992(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v12 = 138543874;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2048;
    v17 = a2;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Performing characteristic write requests with remaining retries: %ld", &v12, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = [*(a1 + 48) performWriteRequests:*(a1 + 56) loggingObject:*(a1 + 32) flow:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)performReadRequests:(id)a3 loggingObject:(id)a4 flow:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_alloc_init(MEMORY[0x277D2C900]);
  v12 = [(HMDHome *)self description];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __50__HMDHome_performReadRequests_loggingObject_flow___block_invoke;
  v20[3] = &unk_27867E7E8;
  v21 = v9;
  v22 = v10;
  v13 = v11;
  v23 = v13;
  v24 = v8;
  v14 = v8;
  v15 = v10;
  v16 = v9;
  [(HMDHome *)self readCharacteristicValues:v14 source:1120 sourceForLogging:v12 qualityOfService:-1 withCompletionHandler:v20];

  v17 = v24;
  v18 = v13;

  return v13;
}

void __50__HMDHome_performReadRequests_loggingObject_flow___block_invoke(id *a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = [a1[7] firstObject];
    v8 = [v7 characteristic];

    v24 = 0;
    v9 = [v6 hmd_valueOfCharacteristic:v8 error:&v24];
    v10 = v24;
    if (v9)
    {
      [a1[6] finishWithResult:v6];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = a1[4];
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        [a1[5] UUID];
        v21 = v23 = v17;
        *buf = 138543874;
        v26 = v20;
        v27 = 2112;
        v28 = v21;
        v29 = 2112;
        v30 = v10;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform read requests with error: %@", buf, 0x20u);

        v17 = v23;
      }

      objc_autoreleasePoolPop(v17);
      [a1[6] finishWithError:v10];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = a1[4];
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [a1[5] UUID];
      *buf = 138543874;
      v26 = v14;
      v27 = 2112;
      v28 = v15;
      v29 = 2112;
      v30 = v5;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform read requests (no response payload) with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = a1[6];
    v8 = [MEMORY[0x277CBEB68] null];
    [v16 finishWithResult:v8];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (id)performWriteRequests:(id)a3 loggingObject:(id)a4 flow:(id)a5
{
  v42 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_alloc_init(MEMORY[0x277D2C900]);
  v12 = [MEMORY[0x277CCAD78] UUID];
  v13 = objc_autoreleasePoolPush();
  v14 = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
  {
    v16 = HMFGetLogIdentifier();
    v17 = [v10 UUID];
    *buf = 0;
    *&buf[8] = 0;
    if (v12)
    {
      [v12 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v32 = *buf;
    v18 = [v8 count];
    *buf = 138544642;
    *&buf[4] = v16;
    *&buf[12] = 2112;
    *&buf[14] = v17;
    v34 = 1042;
    v35 = 16;
    v36 = 2098;
    v37 = &v32;
    v38 = 2114;
    v39 = v14;
    v40 = 2048;
    v41 = v18;
    _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Executing write requests with identifier: %{public,uuid_t}.16P from home: %{public}@ count: %lu for perform write requests", buf, 0x3Au);
  }

  objc_autoreleasePoolPop(v13);
  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __51__HMDHome_performWriteRequests_loggingObject_flow___block_invoke;
  v27[3] = &unk_27867E7E8;
  v28 = v9;
  v29 = v10;
  v19 = v11;
  v30 = v19;
  v31 = v8;
  v20 = v8;
  v21 = v10;
  v22 = v9;
  [(HMDHome *)v14 writeCharacteristicValues:v20 source:1120 identifier:v12 transport:0 qualityOfService:-1 withCompletionHandler:v27];
  v23 = v31;
  v24 = v19;

  v25 = *MEMORY[0x277D85DE8];
  return v19;
}

void __51__HMDHome_performWriteRequests_loggingObject_flow___block_invoke(id *a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = [a1[7] firstObject];
    v8 = [v7 characteristic];

    v24 = 0;
    v9 = [v6 hmd_valueOfCharacteristic:v8 error:&v24];
    v10 = v24;
    if (v9)
    {
      [a1[6] finishWithResult:v6];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = a1[4];
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        [a1[5] UUID];
        v21 = v23 = v17;
        *buf = 138543874;
        v26 = v20;
        v27 = 2112;
        v28 = v21;
        v29 = 2112;
        v30 = v10;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform write requests with error: %@", buf, 0x20u);

        v17 = v23;
      }

      objc_autoreleasePoolPop(v17);
      [a1[6] finishWithError:v10];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = a1[4];
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [a1[5] UUID];
      *buf = 138543874;
      v26 = v14;
      v27 = 2112;
      v28 = v15;
      v29 = 2112;
      v30 = v5;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform write requests (no response payload) with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = a1[6];
    v8 = [MEMORY[0x277CBEB68] null];
    [v16 finishWithResult:v8];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (void)writeCharacteristicValues:(id)a3 source:(unint64_t)a4 biomeSource:(unint64_t)a5 identifier:(id)a6 transport:(id)a7 qualityOfService:(int64_t)a8 withCompletionHandler:(id)a9
{
  v15 = a3;
  v16 = a6;
  v17 = a7;
  v18 = a9;
  v19 = objc_alloc(MEMORY[0x277D0F770]);
  v20 = MEMORY[0x277CCACA8];
  v21 = MEMORY[0x22AAD2510](self, a2);
  v22 = [v20 stringWithFormat:@"%@, %s:%ld", v21, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables/Sources/homed/Home/HMDHome.m", 7421];
  v39 = [v19 initWithName:v22];

  v23 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __116__HMDHome_writeCharacteristicValues_source_biomeSource_identifier_transport_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_27866F988;
  v36 = a4;
  v37 = a8;
  v30 = v39;
  v31 = v16;
  v32 = v17;
  v33 = self;
  v38 = a5;
  v34 = v15;
  v35 = v18;
  v24 = v18;
  v25 = v15;
  v26 = v17;
  v27 = v16;
  dispatch_async(v23, block);

  __HMFActivityScopeLeave();
}

void __116__HMDHome_writeCharacteristicValues_source_biomeSource_identifier_transport_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  v23[2] = *MEMORY[0x277D85DE8];
  v22[0] = @"sourceType";
  v2 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 80)];
  v22[1] = @"kMultiPartResponseKey";
  v23[0] = v2;
  v23[1] = MEMORY[0x277CBEC28];
  v3 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v23 forKeys:v22 count:2];

  v4 = objc_alloc(MEMORY[0x277D0F848]);
  v5 = *(a1 + 88);
  v6 = [MEMORY[0x277D0F820] allMessageDestinations];
  v7 = [v4 initWithName:@"kMultipleCharacteristicWriteRequestKey" qualityOfService:v5 destination:v6 payload:v3];

  [v7 setIdentifier:*(a1 + 40)];
  [v7 setTransport:*(a1 + 48)];
  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 56);
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    v12 = [v7 identifier];

    if (v12)
    {
      v13 = [v7 identifier];
      [v13 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v16 = *buf;
    v14 = HMDRequestSourceAsString(*(a1 + 80));
    *buf = 138544130;
    *&buf[4] = v11;
    *&buf[12] = 1042;
    *&buf[14] = 16;
    v18 = 2098;
    v19 = &v16;
    v20 = 2114;
    v21 = v14;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Issuing write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 56) _writeCharacteristicValues:*(a1 + 64) requestMessage:v7 source:*(a1 + 80) biomeSource:*(a1 + 96) withCompletionHandler:*(a1 + 72)];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)regionStateUpdated
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_regionStateUpdated__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

uint64_t __29__HMDHome_regionStateUpdated__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) homeLocationHandler];
  v3 = [v2 regionStateAtHome];

  if (v3 == 1)
  {
    v4 = [*(a1 + 32) workQueue];
    v5 = v4;
    v8 = MEMORY[0x277D85DD0];
    v9 = 3221225472;
    v10 = __29__HMDHome_regionStateUpdated__block_invoke_980;
    v11 = &unk_27868A728;
    v12 = *(a1 + 32);
    v6 = &v8;
    goto LABEL_5;
  }

  if (v3 == 2)
  {
    v4 = [*(a1 + 32) workQueue];
    v5 = v4;
    v13 = MEMORY[0x277D85DD0];
    v14 = 3221225472;
    v15 = __29__HMDHome_regionStateUpdated__block_invoke_2;
    v16 = &unk_27868A728;
    v17 = *(a1 + 32);
    v6 = &v13;
LABEL_5:
    dispatch_async(v4, v6);
  }

  return [*(a1 + 32) _updateHomeLocation];
}

void __29__HMDHome_regionStateUpdated__block_invoke_2(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Did leave home region", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeRegionExitedNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

void __29__HMDHome_regionStateUpdated__block_invoke_980(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Did enter home region", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeRegionEnteredNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

- (void)suspendedStateChangedForAccessory:(id)a3 suspendedState:(unint64_t)a4
{
  v26 = *MEMORY[0x277D85DE8];
  v6 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  if (v8)
  {
    if (a4 == 2)
    {
      v9 = objc_autoreleasePoolPush();
      v10 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
      {
        v12 = HMFGetLogIdentifier();
        v13 = HAPAccessorySuspendedStateDescription();
        *buf = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = v6;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEBUG, "%{public}@Skipping suspended state update: '%@' for accessory %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v9);
    }

    else
    {
      v14 = [(HMDHome *)self workQueue];
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __60__HMDHome_suspendedStateChangedForAccessory_suspendedState___block_invoke;
      v16[3] = &unk_278685330;
      v16[4] = self;
      v19 = a4;
      v17 = v8;
      v18 = v6;
      dispatch_async(v14, v16);
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

uint64_t __60__HMDHome_suspendedStateChangedForAccessory_suspendedState___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) reachabilityRegisteredDevices];
  v3 = [v2 count];

  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 56);
      v10 = HAPAccessorySuspendedStateDescription();
      v11 = *(a1 + 40);
      v18 = 138543874;
      v19 = v8;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v11;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Notify registered devices of suspended state change to '%@' for accessory: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 32) _updateReachabilityChangeToRegisteredDevices:*(a1 + 48)];
  }

  else
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
    {
      v12 = HMFGetLogIdentifier();
      v13 = *(a1 + 56);
      v14 = HAPAccessorySuspendedStateDescription();
      v15 = *(a1 + 48);
      v18 = 138543874;
      v19 = v12;
      v20 = 2112;
      v21 = v14;
      v22 = 2112;
      v23 = v15;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@No registered devices to send the suspended state change '%@' for accessory %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
  }

  result = [*(a1 + 32) notifyClientsOfReachabilityUpdateForAccessory:*(a1 + 48)];
  v17 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)reachabilityChangedForAccessory:(id)a3 reachable:(BOOL)a4
{
  v6 = a3;
  v7 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __53__HMDHome_reachabilityChangedForAccessory_reachable___block_invoke;
  block[3] = &unk_278688BD0;
  v10 = v6;
  v11 = self;
  v12 = a4;
  v8 = v6;
  dispatch_async(v7, block);
}

void __53__HMDHome_reachabilityChangedForAccessory_reachable___block_invoke(uint64_t a1)
{
  v22[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  if (v4)
  {
    v5 = *(a1 + 40);
    v22[0] = v4;
    v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v22 count:1];
    [v5 _updateWoWState:v6];
  }

  [*(a1 + 40) _reachabilityChangedForAccessory:*(a1 + 32) reachable:*(a1 + 48)];
  v7 = [*(a1 + 40) reachabilityRegisteredDevices];
  v8 = [v7 count];

  v9 = objc_autoreleasePoolPush();
  v10 = *(a1 + 40);
  v11 = HMFGetOSLogHandle();
  v12 = v11;
  if (v8)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 32);
      v18 = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Notify registered devices of reachability change for accessory: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    [*(a1 + 40) _updateReachabilityChangeToRegisteredDevices:*(a1 + 32)];
  }

  else
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      v16 = *(a1 + 32);
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = v16;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@No registered devices available to notify reachability change update for accessory: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (id)replaceActionSetName:(id)a3 withNewName:(id)a4
{
  v15[1] = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = a3;
  v8 = [(HMDHome *)self homeManager];
  v9 = [v8 nameValidator];
  v10 = [(HMDHome *)self uuid];
  v15[0] = v10;
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v15 count:1];
  v12 = [v9 replaceActionSetName:v7 withNewName:v6 inNamespaces:v11];

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)replaceName:(id)a3 withNewName:(id)a4
{
  v15[1] = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = a3;
  v8 = [(HMDHome *)self homeManager];
  v9 = [v8 nameValidator];
  v10 = [(HMDHome *)self uuid];
  v15[0] = v10;
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v15 count:1];
  v12 = [v9 replaceName:v7 withNewName:v6 inNamespaces:v11];

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)removeName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 nameValidator];
  v7 = [(HMDHome *)self uuid];
  v8 = [v6 removeName:v4 namespace:v7];

  return v8;
}

- (id)addActionSetName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 nameValidator];
  v7 = [(HMDHome *)self uuid];
  v8 = [v6 addActionSetName:v4 namespace:v7];

  return v8;
}

- (id)addName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 nameValidator];
  v7 = [(HMDHome *)self uuid];
  v8 = [v6 addName:v4 namespace:v7];

  return v8;
}

- (id)validateName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 nameValidator];
  v7 = [v6 validateName:v4];

  return v7;
}

- (void)removeAllHomeContentsAndAccessoryPairings:(BOOL)a3 queue:(id)a4 completionHandler:(id)a5
{
  v24 = *MEMORY[0x277D85DE8];
  v8 = a4;
  v9 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v13;
    _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Removed all home content and accessory pairings", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  v14 = [(HMDHome *)v11 workQueue];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __77__HMDHome_removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke;
  v18[3] = &unk_278685C18;
  v21 = a3;
  v18[4] = v11;
  v19 = v8;
  v20 = v9;
  v15 = v9;
  v16 = v8;
  dispatch_async(v14, v18);

  v17 = *MEMORY[0x277D85DE8];
}

- (void)removeService:(id)a3
{
  v5 = a3;
  objc_initWeak(&location, self);
  v6 = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __25__HMDHome_removeService___block_invoke;
  v8[3] = &unk_27867DEF8;
  objc_copyWeak(v10, &location);
  v9 = v5;
  v10[1] = a2;
  v7 = v5;
  dispatch_async(v6, v8);

  objc_destroyWeak(v10);
  objc_destroyWeak(&location);
}

void __25__HMDHome_removeService___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained && *(a1 + 32))
  {
    v4 = WeakRetained;
    [WeakRetained _removeService:?];
    v3 = NSStringFromSelector(*(a1 + 48));
    [v4 saveWithReason:v3 postSyncNotification:1];

    WeakRetained = v4;
  }
}

- (void)handleSignificantTimeChange
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v19 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Going to re-evaluate all the triggers as time has changed significantly", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  v7 = [(HMDHome *)v4 triggers];
  v8 = [v7 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v14;
    do
    {
      v11 = 0;
      do
      {
        if (*v14 != v10)
        {
          objc_enumerationMutation(v7);
        }

        [*(*(&v13 + 1) + 8 * v11++) reEvaluate:1];
      }

      while (v9 != v11);
      v9 = [v7 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v9);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)reEvaluateTriggers
{
  v13 = *MEMORY[0x277D85DE8];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v2 = [(HMDHome *)self triggers];
  v3 = [v2 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v9;
    do
    {
      v6 = 0;
      do
      {
        if (*v9 != v5)
        {
          objc_enumerationMutation(v2);
        }

        [*(*(&v8 + 1) + 8 * v6++) reEvaluate:0];
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v4);
  }

  v7 = *MEMORY[0x277D85DE8];
}

- (id)mediaSystemWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSystems];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)mediaSystemsWithUUIDs:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __33__HMDHome_mediaSystemsWithUUIDs___block_invoke;
  v9[3] = &unk_278675410;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_filter:v9];

  return v7;
}

uint64_t __33__HMDHome_mediaSystemsWithUUIDs___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 uuid];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (void)removeOutgoingInvitation:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_outgoingInvitations removeObject:v4];
  os_unfair_recursive_lock_unlock();
}

- (void)addOutgoingInvitation:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_outgoingInvitations addObject:v4];
  os_unfair_recursive_lock_unlock();
}

- (void)setOutgoingInvitations:(id)a3
{
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [v6 mutableCopy];
  outgoingInvitations = self->_outgoingInvitations;
  self->_outgoingInvitations = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSArray)outgoingInvitations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_outgoingInvitations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (id)outgoingInvitationWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self outgoingInvitations];
  v6 = [v5 hmf_firstObjectWithValue:v4 forKeyPath:@"identifier"];

  return v6;
}

- (id)userWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self users];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)serviceGroupWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self serviceGroups];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)serviceGroupWithName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self serviceGroups];
  v6 = [v5 hmf_firstObjectWithName:v4];

  return v6;
}

- (id)triggerWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self triggers];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)triggerWithName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self triggers];
  v6 = [v5 hmf_firstObjectWithName:v4];

  return v6;
}

- (id)triggerOwnedActionSetWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self triggerOwnedActionSets];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)actionSetWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self actionSets];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)actionSetWithName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self actionSets];
  v6 = [v5 hmf_firstObjectWithName:v4];

  return v6;
}

- (void)_evaluateOwnerTrustZoneCapabilityAndNotify
{
  v13 = *MEMORY[0x277D85DE8];
  if (![(HMDHome *)self isOwnerTrustZoneCapable])
  {
    if (-[HMDHome _isSharedHomeVersionTrustZoneCapable](self, "_isSharedHomeVersionTrustZoneCapable") || (-[HMDHome residentDeviceManager](self, "residentDeviceManager"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 hasTrustZoneCapableResident], v3, v4))
    {
      v5 = objc_autoreleasePoolPush();
      v6 = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        v11 = 138543362;
        v12 = v8;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Owner became trust zone capable after evaluating owner trust zone capability", &v11, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
      [(HMDHome *)v6 setOwnerTrustZoneCapable:1];
      v9 = [(HMDHome *)v6 notificationCenter];
      [v9 postNotificationName:@"HMDHomeOwnerBecameTrustZoneCapableNotification" object:v6];
    }
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleReceivedNonCloudSourcedSharedHomeModel
{
  v13 = *MEMORY[0x277D85DE8];
  if (-[HMDHome _isSharedHomeVersionTrustZoneCapable](self, "_isSharedHomeVersionTrustZoneCapable") || (-[HMDHome residentDeviceManager](self, "residentDeviceManager"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 hasTrustZoneCapableResident], v3, v4))
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Owner became trust zone capable after receiving shared home model", &v11, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 setOwnerTrustZoneCapable:1];
    v9 = [(HMDHome *)v6 notificationCenter];
    [v9 postNotificationName:@"HMDHomeOwnerBecameTrustZoneCapableNotification" object:v6];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isSharedHomeVersionTrustZoneCapable
{
  v2 = [(HMDHome *)self sharedHomeSourceVersion];
  v3 = +[HMDHomeKitVersion version6];
  v4 = [v2 isAtLeastVersion:v3];

  return v4;
}

- (void)setOwnerTrustZoneCapable:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_ownerTrustZoneCapable = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)ownerTrustZoneCapable
{
  os_unfair_recursive_lock_lock_with_options();
  ownerTrustZoneCapable = self->_ownerTrustZoneCapable;
  os_unfair_recursive_lock_unlock();
  return ownerTrustZoneCapable;
}

- (id)zoneWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self zones];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)zoneWithName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self zones];
  v6 = [v5 hmf_firstObjectWithName:v4];

  return v6;
}

- (id)mediaProfileWithUUID:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v5 = [(HMDHome *)self accessories];
  v6 = [v5 countByEnumeratingWithState:&v21 objects:v25 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v22;
LABEL_3:
    v9 = 0;
    while (1)
    {
      if (*v22 != v8)
      {
        objc_enumerationMutation(v5);
      }

      v10 = *(*(&v21 + 1) + 8 * v9);
      objc_opt_class();
      v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
      v12 = v11;

      if (v12)
      {
        v13 = [v12 mediaProfile];
      }

      else
      {
        v14 = v10;
        objc_opt_class();
        v15 = (objc_opt_isKindOfClass() & 1) != 0 ? v14 : 0;
        v16 = v15;

        v13 = [v16 mediaProfile];
      }

      v17 = [v13 uniqueIdentifier];
      v18 = [v17 isEqual:v4];

      if (v18)
      {
        break;
      }

      if (v7 == ++v9)
      {
        v7 = [v5 countByEnumeratingWithState:&v21 objects:v25 count:16];
        if (v7)
        {
          goto LABEL_3;
        }

        goto LABEL_18;
      }
    }
  }

  else
  {
LABEL_18:
    v13 = 0;
  }

  v19 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)accessoryWithSPIClientIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self accessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __44__HMDHome_accessoryWithSPIClientIdentifier___block_invoke;
  v9[3] = &unk_278681708;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __44__HMDHome_accessoryWithSPIClientIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 spiClientIdentifier];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (id)accessoryWithDeviceIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self accessories];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __41__HMDHome_accessoryWithDeviceIdentifier___block_invoke;
  v11[3] = &unk_278681708;
  v12 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v11];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  return v8;
}

uint64_t __41__HMDHome_accessoryWithDeviceIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 deviceForDirectMessaging];

  v7 = [v6 identifier];
  v8 = [v7 hmf_isEqualToUUID:*(a1 + 32)];

  return v8;
}

- (id)accessoryWithEndpointIdentifier:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithSPIClientIdentifier:a3];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (id)accessoryWithUUID:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableDictionary *)self->_accessories objectForKeyedSubscript:v4];
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (id)roomWithUniqueIdentifier:(id)a3 forClientIdentifierSalt:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self rooms];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __60__HMDHome_roomWithUniqueIdentifier_forClientIdentifierSalt___block_invoke;
  v13[3] = &unk_27866F960;
  v14 = v7;
  v15 = v6;
  v9 = v6;
  v10 = v7;
  v11 = [v8 na_firstObjectPassingTest:v13];

  return v11;
}

uint64_t __60__HMDHome_roomWithUniqueIdentifier_forClientIdentifierSalt___block_invoke(uint64_t a1, void *a2)
{
  v3 = MEMORY[0x277CCAD78];
  v4 = [a2 uuid];
  v5 = [v3 hm_deriveUUIDFromBaseUUID:v4 identifierSalt:*(a1 + 32)];

  v6 = [v5 isEqual:*(a1 + 40)];
  return v6;
}

- (id)roomWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self roomForEntireHome];
  v6 = [v5 uuid];
  v7 = [v6 isEqual:v4];

  if (v7)
  {
    v8 = [(HMDHome *)self roomForEntireHome];
  }

  else
  {
    v9 = [(HMDHome *)self rooms];
    v8 = [v9 hmf_firstObjectWithUUID:v4];
  }

  return v8;
}

- (id)roomWithName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self rooms];
  v6 = [v5 hmf_firstObjectWithName:v4];

  return v6;
}

- (void)_configureBulletinNotification
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  v4 = [(HMDHome *)self hapAccessories];
  v5 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v11;
    do
    {
      v8 = 0;
      do
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(v4);
        }

        [*(*(&v10 + 1) + 8 * v8++) configureBulletinNotification];
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)configureBulletinNotification
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __40__HMDHome_configureBulletinNotification__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)saveToCurrentAccountWithReason:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_saveToCurrentAccountWithReason___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

uint64_t __42__HMDHome_saveToCurrentAccountWithReason___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v9 = 138543618;
    v10 = v5;
    v11 = 2112;
    v12 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@Saving to current account with reason: %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  result = [*(a1 + 32) _configureBulletinNotification];
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_updateExpectConfigurationVersion
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self expectedConfigurationVersion];
  if (v3 < [(HMDHome *)self configurationVersion])
  {
    [(HMDHome *)self setExpectedConfigurationVersion:[(HMDHome *)self configurationVersion]];
  }

  [(HMDHome *)self setExpectedConfigurationVersion:[(HMDHome *)self expectedConfigurationVersion]+ 1];
  v4 = objc_autoreleasePoolPush();
  v5 = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543874;
    v10 = v7;
    v11 = 2048;
    v12 = [(HMDHome *)v5 expectedConfigurationVersion];
    v13 = 2048;
    v14 = [(HMDHome *)v5 configurationVersion];
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Increased expected configuration counter to %lu (current configurationVersion: %lu).", &v9, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

- (void)_updateConfigurationVersion
{
  v12 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setConfigurationVersion:[(HMDHome *)self configurationVersion]+ 1];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
  {
    v6 = HMFGetLogIdentifier();
    v8 = 138543618;
    v9 = v6;
    v10 = 2048;
    v11 = [(HMDHome *)v4 configurationVersion];
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Incrementing configuration version to %lu", &v8, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  [(HMDHome *)v4 __saveConfigurationVersionTransaction];
  v7 = *MEMORY[0x277D85DE8];
}

- (void)_handleModifyCharacteristicNotifications:(id)a3
{
  v130 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (![v4 isRemote] || (objc_msgSend(v4, "isSecureRemote") & 1) != 0)
  {
    v5 = [v4 dictionaryForKey:@"kCharacteristicNotificationsKey"];
    v6 = [v4 dictionaryForKey:@"kMediaNotificationsKey"];
    [v4 arrayForKey:@"HMDDeviceNotificationActionSetsKey"];
    v90 = v5;
    v93 = v92 = v6;
    v7 = (v93 | v5 | v6) != 0;
    if ([v4 isRemote])
    {
      v8 = [(HMDHome *)self primaryResident];
      v9 = [v8 device];
      v10 = [v9 isCurrentDevice];

      if ((v10 & 1) == 0 && ([v90 count] || objc_msgSend(v93, "count")))
      {
        v22 = objc_autoreleasePoolPush();
        v23 = self;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
        {
          v25 = HMFGetLogIdentifier();
          *buf = 138543362;
          v113 = v25;
          _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Received modify characteristic notification message from remote device, and this device is not the primary resident. Discarding.", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v22);
        v95 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3202];
        [v4 respondWithError:?];
        v21 = v90;
        goto LABEL_42;
      }
    }

    v89 = [v4 dataForKey:@"kMatterNotificationsKey"];
    if (!v89)
    {
      v95 = 0;
LABEL_28:
      LOBYTE(v109) = 0;
      v34 = [v4 BOOLForKey:*MEMORY[0x277CD2158] keyPresent:&v109];
      v35 = [v4 remoteSourceDevice];
      v36 = [v35 remoteDestinationString];

      v94 = [v4 userForHome:self];
      if (v7 && v36 && v94 && (v109 & 1) != 0)
      {
        v88 = v36;
        v91 = [v4 dictionaryForKey:@"CharacteristicNotificationThreshold"];
        v37 = objc_autoreleasePoolPush();
        v38 = self;
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
        {
          v40 = HMFGetLogIdentifier();
          v41 = HMFBooleanToString();
          v42 = [v94 shortDescription];
          *buf = 138545410;
          v113 = v40;
          v114 = 2112;
          v115 = v41;
          v116 = 2112;
          v117 = v42;
          v118 = 2112;
          v119 = v88;
          v120 = 2112;
          v121 = v90;
          v122 = 2112;
          v123 = v92;
          v124 = 2112;
          v125 = v93;
          v126 = 2112;
          v127 = v91;
          v128 = 2112;
          v129 = v95;
          _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Received modify characteristic notification message with enable: %@ user: %@ deviceIdsDestination: %@ characteristicsPayload: %@ mediaPropertiesPayload: %@ actionSetsPayload: %@characteristicChangeThresholds: %@matterNotificationPayload: %@", buf, 0x5Cu);
        }

        objc_autoreleasePoolPop(v37);
        if (!v34)
        {
          v53 = objc_alloc_init(MEMORY[0x277CBEB18]);
          v86 = v4;
          v54 = [v4 remoteSourceDevice];
          v55 = [v54 remoteDestinationString];
          v98 = v53;
          [v53 addObject:v55];

          v87 = v54;
          v56 = [v54 globalHandles];
          v57 = [v56 firstObject];

          v96 = v57;
          if (v57)
          {
            v105 = 0u;
            v106 = 0u;
            v103 = 0u;
            v104 = 0u;
            v58 = [v54 account];
            v59 = [v58 handles];

            obj = v59;
            v60 = [v59 countByEnumeratingWithState:&v103 objects:v111 count:16];
            if (v60)
            {
              v61 = v60;
              v62 = *v104;
              do
              {
                for (i = 0; i != v61; ++i)
                {
                  if (*v104 != v62)
                  {
                    objc_enumerationMutation(obj);
                  }

                  v64 = *(*(&v103 + 1) + 8 * i);
                  v65 = [v57 pushToken];
                  v66 = [v64 URI];
                  v67 = [v66 prefixedURI];
                  v68 = MEMORY[0x22AAD2AD0](v65, v67);

                  if (v68)
                  {
                    if (([v98 containsObject:v68] & 1) == 0)
                    {
                      [v98 addObject:v68];
                    }
                  }

                  else
                  {
                    v69 = objc_autoreleasePoolPush();
                    v70 = v38;
                    v71 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v71, OS_LOG_TYPE_ERROR))
                    {
                      HMFGetLogIdentifier();
                      v73 = v72 = v38;
                      *buf = 138543874;
                      v113 = v73;
                      v114 = 2112;
                      v115 = v96;
                      v116 = 2112;
                      v117 = v64;
                      _os_log_impl(&dword_229538000, v71, OS_LOG_TYPE_ERROR, "%{public}@Failed to create destination with globalHandle: %@, accountHandle: %@", buf, 0x20u);

                      v38 = v72;
                      v57 = v96;
                    }

                    objc_autoreleasePoolPop(v69);
                  }
                }

                v61 = [obj countByEnumeratingWithState:&v103 objects:v111 count:16];
              }

              while (v61);
            }
          }

          v101 = 0u;
          v102 = 0u;
          v99 = 0u;
          v100 = 0u;
          v74 = v98;
          v75 = [v74 countByEnumeratingWithState:&v99 objects:v110 count:16];
          v21 = v90;
          if (v75)
          {
            v76 = v75;
            v77 = *v100;
            while (2)
            {
              for (j = 0; j != v76; ++j)
              {
                if (*v100 != v77)
                {
                  objc_enumerationMutation(v74);
                }

                v79 = *(*(&v99 + 1) + 8 * j);
                v80 = [(HMDHome *)v38 notificationRegistry];
                LOBYTE(v79) = [v80 setNotificationsEnabled:0 user:v94 deviceIdsDestination:v79 characteristicsPayload:v90 characteristicChangeThresholdsPayload:v91 mediaPropertiesPayload:v92 actionSetsPayload:v93 matterNotificationPayload:v95];

                if (v79)
                {

                  v4 = v86;
                  v36 = v88;
                  v44 = v91;
                  goto LABEL_71;
                }
              }

              v76 = [v74 countByEnumeratingWithState:&v99 objects:v110 count:16];
              if (v76)
              {
                continue;
              }

              break;
            }
          }

          v81 = objc_autoreleasePoolPush();
          v82 = v38;
          v83 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v83, OS_LOG_TYPE_ERROR))
          {
            v84 = HMFGetLogIdentifier();
            *buf = 138543874;
            v113 = v84;
            v114 = 2112;
            v115 = v94;
            v116 = 2112;
            v117 = v74;
            _os_log_impl(&dword_229538000, v83, OS_LOG_TYPE_ERROR, "%{public}@Failed to disable notification for user: %@ with destinations: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v81);
          v85 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2 description:@"Failed to disable notification because registration was not found" reason:@"Could not find matching registration" suggestion:0];
          [v86 respondWithError:v85];

          v4 = v86;
          v36 = v88;
          v51 = v89;
          v44 = v91;
          goto LABEL_41;
        }

        v43 = [(HMDHome *)v38 notificationRegistry];
        v36 = v88;
        v21 = v90;
        v44 = v91;
        [v43 setNotificationsEnabled:1 user:v94 deviceIdsDestination:v88 characteristicsPayload:v90 characteristicChangeThresholdsPayload:v91 mediaPropertiesPayload:v92 actionSetsPayload:v93 matterNotificationPayload:v95];

        if ([v93 count])
        {
          v107[0] = MEMORY[0x277D85DD0];
          v107[1] = 3221225472;
          v107[2] = __52__HMDHome__handleModifyCharacteristicNotifications___block_invoke;
          v107[3] = &unk_278685C40;
          v108 = v4;
          [(HMDHome *)v38 actionSetResponsePayloadForActionSetsPayload:v93 completion:v107];
        }

        else
        {
LABEL_71:
          [v4 respondWithSuccess];
        }
      }

      else
      {
        v45 = objc_autoreleasePoolPush();
        v46 = self;
        v47 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v49 = v48 = v36;
          v50 = [v4 messagePayload];
          *buf = 138543618;
          v113 = v49;
          v114 = 2112;
          v115 = v50;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle modify characteristic notifications message payload: %@", buf, 0x16u);

          v36 = v48;
        }

        objc_autoreleasePoolPop(v45);
        v44 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
        [v4 respondWithError:v44];
        v21 = v90;
      }

      v51 = v89;
LABEL_41:

LABEL_42:
      goto LABEL_43;
    }

    v109 = 0;
    v11 = OPACKDecodeData();
    v12 = v11;
    if (v11)
    {
      v13 = v11;
      objc_opt_class();
      v14 = objc_opt_isKindOfClass() & 1;
      if (v14)
      {
        v15 = v13;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;
      v95 = v13;

      if (v14)
      {
        v7 = 1;
LABEL_27:

        goto LABEL_28;
      }

      v26 = objc_autoreleasePoolPush();
      v33 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        v29 = HMFGetLogIdentifier();
        *buf = 138543618;
        v113 = v29;
        v114 = 2112;
        v115 = v95;
        v30 = "%{public}@Error casting decodedMatterNotificationData to NSDictionary. decodedMatterNotificationData=%@";
        v31 = v28;
        v32 = 22;
        goto LABEL_25;
      }
    }

    else
    {
      v26 = objc_autoreleasePoolPush();
      v27 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        v29 = HMFGetLogIdentifier();
        *buf = 138544130;
        v113 = v29;
        v114 = 2048;
        v115 = v109;
        v116 = 2112;
        v117 = v89;
        v118 = 2112;
        v119 = 0;
        v30 = "%{public}@Error decoding Matter notification payload. status=%ld encodedMatterNotificationData=%@ decodedMatterNotificationData=%@";
        v31 = v28;
        v32 = 42;
LABEL_25:
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, v30, buf, v32);
      }
    }

    objc_autoreleasePoolPop(v26);
    v95 = 0;
    goto LABEL_27;
  }

  v17 = objc_autoreleasePoolPush();
  v18 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 138543618;
    v113 = v20;
    v114 = 2112;
    v115 = v4;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v17);
  v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
  [v4 respondWithError:v21];
LABEL_43:

  v52 = *MEMORY[0x277D85DE8];
}

void __52__HMDHome__handleModifyCharacteristicNotifications___block_invoke(uint64_t a1, void *a2)
{
  v8[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v7 = @"HMDDeviceNotificationActionSetsKey";
  v8[0] = a2;
  v3 = MEMORY[0x277CBEAC0];
  v4 = a2;
  v5 = [v3 dictionaryWithObjects:v8 forKeys:&v7 count:1];
  [v2 respondWithPayload:v5];

  v6 = *MEMORY[0x277D85DE8];
}

- (void)actionSetResponsePayloadForActionSetsPayload:(id)a3 completion:(id)a4
{
  v48 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if ([v6 count] && (-[HMDHome actionSetStateObserver](self, "actionSetStateObserver"), v8 = objc_claimAutoreleasedReturnValue(), v8, v8))
  {
    v33 = v7;
    v9 = [MEMORY[0x277CBEB58] set];
    v39 = 0u;
    v40 = 0u;
    v41 = 0u;
    v42 = 0u;
    v34 = v6;
    v10 = v6;
    v36 = [v10 countByEnumeratingWithState:&v39 objects:v47 count:16];
    if (v36)
    {
      v11 = *v40;
      v12 = 0x277CCA000uLL;
      v35 = *v40;
      do
      {
        for (i = 0; i != v36; ++i)
        {
          if (*v40 != v11)
          {
            objc_enumerationMutation(v10);
          }

          v14 = *(v12 + 3240);
          v15 = *(*(&v39 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v16 = v15;
          }

          else
          {
            v16 = 0;
          }

          v17 = v16;

          if (v17)
          {
            v18 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v17];
            if (v18)
            {
              [v9 addObject:v18];
            }

            else
            {
              v23 = objc_autoreleasePoolPush();
              v24 = self;
              v25 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
              {
                HMFGetLogIdentifier();
                v26 = v10;
                v27 = self;
                v29 = v28 = v9;
                *buf = 138543618;
                v44 = v29;
                v45 = 2112;
                v46 = v17;
                _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Action set uuid string (%@) could not be converted to a uuid", buf, 0x16u);

                v9 = v28;
                self = v27;
                v10 = v26;
                v11 = v35;
              }

              objc_autoreleasePoolPop(v23);
              v12 = 0x277CCA000;
            }
          }

          else
          {
            v19 = objc_autoreleasePoolPush();
            v20 = self;
            v21 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
            {
              v22 = HMFGetLogIdentifier();
              *buf = 138543362;
              v44 = v22;
              _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@Action set element was not a string", buf, 0xCu);

              v12 = 0x277CCA000;
            }

            objc_autoreleasePoolPop(v19);
          }
        }

        v36 = [v10 countByEnumeratingWithState:&v39 objects:v47 count:16];
      }

      while (v36);
    }

    if ([v9 count])
    {
      v30 = [(HMDHome *)self actionSetStateObserver];
      v31 = [v9 allObjects];
      v37[0] = MEMORY[0x277D85DD0];
      v37[1] = 3221225472;
      v37[2] = __67__HMDHome_actionSetResponsePayloadForActionSetsPayload_completion___block_invoke;
      v37[3] = &unk_278683820;
      v7 = v33;
      v38 = v33;
      [v30 currentStateForActionSetUUIDs:v31 completionHandler:v37];
    }

    else
    {
      v7 = v33;
      v33[2](v33, MEMORY[0x277CBEC10]);
    }

    v6 = v34;
  }

  else
  {
    (*(v7 + 2))(v7, MEMORY[0x277CBEC10]);
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __67__HMDHome_actionSetResponsePayloadForActionSetsPayload_completion___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  v3 = [HMDActionSetResponse serializeWithResponses:a2];
  (*(v2 + 16))(v2, v3);
}

- (void)auditDestinationsForNotifications:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __45__HMDHome_auditDestinationsForNotifications___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __45__HMDHome_auditDestinationsForNotifications___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) notificationRegistry];
  [v2 auditNotificationDestinations:*(a1 + 40) home:*(a1 + 32)];
}

void __195__HMDHome__modifyCharacteristicNotifications_characteristicChangeThresholds_mediaNotifications_actionSetNotificationPayload_matterAttributeNotifications_enableNotification_withDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v8 = WeakRetained;
  if (WeakRetained)
  {
    if (v5)
    {
      v9 = objc_autoreleasePoolPush();
      v10 = v8;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        *buf = 138543874;
        v27 = v12;
        v28 = 2112;
        v29 = v13;
        v30 = 2112;
        v31 = v5;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Failed to modify notifications with remote gateway %@ due to error %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v9);
      v14 = *(a1 + 48);
      if (v14)
      {
        (*(v14 + 16))(v14, v5);
      }
    }

    else
    {
      v17 = [WeakRetained workQueue];
      v19[0] = MEMORY[0x277D85DD0];
      v19[1] = 3221225472;
      v19[2] = __195__HMDHome__modifyCharacteristicNotifications_characteristicChangeThresholds_mediaNotifications_actionSetNotificationPayload_matterAttributeNotifications_enableNotification_withDevice_completion___block_invoke_968;
      v19[3] = &unk_278685AD0;
      objc_copyWeak(&v24, (a1 + 56));
      v20 = *(a1 + 32);
      v21 = *(a1 + 40);
      v25 = *(a1 + 64);
      v22 = v6;
      v23 = *(a1 + 48);
      dispatch_async(v17, v19);

      objc_destroyWeak(&v24);
    }
  }

  else
  {
    v15 = *(a1 + 48);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
      (*(v15 + 16))(v15, v16);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __195__HMDHome__modifyCharacteristicNotifications_characteristicChangeThresholds_mediaNotifications_actionSetNotificationPayload_matterAttributeNotifications_enableNotification_withDevice_completion___block_invoke_968(uint64_t a1)
{
  v42 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v3 = objc_autoreleasePoolPush();
  v4 = WeakRetained;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v7 = *(a1 + 32);
    *buf = 138543618;
    v39 = v6;
    v40 = 2112;
    v41 = v7;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Modified notifications with remote gateway %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  [v4 _handleRemoteGatewayNotificationRegistration:*(a1 + 40) enable:*(a1 + 72)];
  v31 = a1;
  v30 = [*(a1 + 48) hmf_dictionaryForKey:@"HMDDeviceNotificationActionSetsKey"];
  [HMDActionSetResponse responsesFromSerializedResponses:?];
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = v36 = 0u;
  v8 = [obj countByEnumeratingWithState:&v33 objects:v37 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v34;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v34 != v10)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v33 + 1) + 8 * i);
        v13 = [v12 actionSetUUID];
        v14 = [v4 actionSetWithUUID:v13];

        if (v14)
        {
          v15 = [v4 actionSetStateSubscriptionManager];
          v16 = [v14 uuid];
          v17 = [v15 isMonitoringActionSet:v16];

          if (v17)
          {
            v18 = [v4 actionSetStateSubscriptionManager];
            v19 = [v12 actionSetUUID];
            [v18 actionSetStateDidChange:v19 state:{objc_msgSend(v12, "state")}];

            goto LABEL_17;
          }

          v20 = objc_autoreleasePoolPush();
          v21 = v4;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
          {
            v23 = HMFGetLogIdentifier();
            v24 = [v12 actionSetUUID];
            *buf = 138543618;
            v39 = v23;
            v40 = 2112;
            v41 = v24;
            v25 = v22;
            v26 = OS_LOG_TYPE_DEFAULT;
            v27 = "%{public}@Got action set enable response for unregistered action set %@";
            goto LABEL_15;
          }
        }

        else
        {
          v20 = objc_autoreleasePoolPush();
          v21 = v4;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
          {
            v23 = HMFGetLogIdentifier();
            v24 = [v12 actionSetUUID];
            *buf = 138543618;
            v39 = v23;
            v40 = 2112;
            v41 = v24;
            v25 = v22;
            v26 = OS_LOG_TYPE_ERROR;
            v27 = "%{public}@Got action set enable response for unknown action set %@";
LABEL_15:
            _os_log_impl(&dword_229538000, v25, v26, v27, buf, 0x16u);
          }
        }

        objc_autoreleasePoolPop(v20);
LABEL_17:
      }

      v9 = [obj countByEnumeratingWithState:&v33 objects:v37 count:16];
    }

    while (v9);
  }

  v28 = *(v31 + 56);
  if (v28)
  {
    (*(v28 + 16))(v28, 0);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)modifyCharacteristicNotifications:(id)a3 characteristicChangeThresholds:(id)a4 mediaNotifications:(id)a5 actionSetNotificationPayload:(id)a6 enableNotification:(BOOL)a7 withDevice:(id)a8
{
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a8;
  v19 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __154__HMDHome_modifyCharacteristicNotifications_characteristicChangeThresholds_mediaNotifications_actionSetNotificationPayload_enableNotification_withDevice___block_invoke;
  block[3] = &unk_27866F910;
  block[4] = self;
  v26 = v14;
  v27 = v15;
  v28 = v16;
  v31 = a7;
  v29 = v17;
  v30 = v18;
  v20 = v18;
  v21 = v17;
  v22 = v16;
  v23 = v15;
  v24 = v14;
  dispatch_async(v19, block);
}

- (BOOL)shouldRestrictAllMessagingToLocalTransportsForUser:(id)a3
{
  v3 = a3;
  v4 = isiOSDevice();
  LOBYTE(v5) = 0;
  if (v3 && v4)
  {
    v5 = [v3 isRemoteAccessAllowed] ^ 1;
  }

  return v5;
}

- (void)_resubscribeForNotificationsOnResident:(id)a3
{
  v48 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [(HMDHome *)self primaryResident];
  v7 = [v6 device];

  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543874;
    v43 = v11;
    v44 = 2112;
    v45 = v4;
    v46 = 2112;
    v47 = v7;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Resubscribing for notifications - previousResidentDevice: %@, current primaryResident: %@", buf, 0x20u);
  }

  v36 = v4;

  objc_autoreleasePoolPop(v8);
  isWatch();
  v35 = [(HMDHome *)v9 residentEnabledDevices];
  v12 = [MEMORY[0x277CBEB18] array];
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v40 = 0u;
  v13 = [(HMDHome *)v9 _residentUsers];
  v14 = [v13 countByEnumeratingWithState:&v37 objects:v41 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v38;
    do
    {
      for (i = 0; i != v15; ++i)
      {
        if (*v38 != v16)
        {
          objc_enumerationMutation(v13);
        }

        v18 = *(*(&v37 + 1) + 8 * i);
        if ([v18 configurationState] == 2)
        {
          v19 = [v18 userID];
          v20 = [HMDDevice deviceWithDestination:v19];

          if (v20 && ([v20 isCurrentDevice] & 1) == 0)
          {
            [v12 addObject:v20];
          }
        }
      }

      v15 = [v13 countByEnumeratingWithState:&v37 objects:v41 count:16];
    }

    while (v15);
  }

  if ([v35 count] || objc_msgSend(v12, "count"))
  {
    v21 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v12, "count") + objc_msgSend(v35, "count")}];
    v22 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v12, "count") + objc_msgSend(v35, "count")}];
    if ([v7 isCurrentDevice])
    {
      [v21 addObjectsFromArray:v35];
      [v21 addObjectsFromArray:v12];
      v23 = v36;
    }

    else
    {
      v23 = v36;
      if (v36)
      {
        [v22 addObject:v36];
      }

      else
      {
        [v22 addObjectsFromArray:v12];
      }

      if (v7)
      {
        [v21 addObject:v7];
      }

      else
      {
        [v21 addObjectsFromArray:v12];
      }
    }

    [v22 minusSet:v21];
    v24 = objc_autoreleasePoolPush();
    v25 = v9;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      *buf = 138543362;
      v43 = v27;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to initial home launch or change in primary resident.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v24);
    if ([v22 count])
    {
      v28 = [v22 allObjects];
      [(HMDHome *)v25 _disableNotificationsForDevices:v28];
    }

    if ([v21 count])
    {
      v29 = [v21 allObjects];
      [(HMDHome *)v25 _enableNotificationsForDevices:v29];
    }
  }

  else
  {
    v31 = objc_autoreleasePoolPush();
    v32 = v9;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543362;
      v43 = v34;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@There are no resident devices or remote gateways to register with", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v31);
    v23 = v36;
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)resubscribeForNotificationsOnResident:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_resubscribeForNotificationsOnResident___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)_disableNotificationsForDevices:(id)a3
{
  v93 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  if ([v4 count])
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v90 = v9;
      v91 = 2112;
      v92 = v4;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Disabling Notifications on %@", buf, 0x16u);
    }

    v55 = v4;

    objc_autoreleasePoolPop(v6);
    v63 = [MEMORY[0x277CBEB38] dictionary];
    v80 = 0u;
    v81 = 0u;
    v82 = 0u;
    v83 = 0u;
    v57 = v7;
    obj = [(HMDHome *)v7 accessories];
    v59 = [obj countByEnumeratingWithState:&v80 objects:v88 count:16];
    if (v59)
    {
      v58 = *v81;
      do
      {
        for (i = 0; i != v59; ++i)
        {
          if (*v81 != v58)
          {
            objc_enumerationMutation(obj);
          }

          v11 = *(*(&v80 + 1) + 8 * i);
          v12 = [MEMORY[0x277CBEB18] array];
          v13 = v11;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v14 = v13;
          }

          else
          {
            v14 = 0;
          }

          v15 = v14;

          if (v15)
          {
            v60 = v13;
            v61 = v15;
            v62 = i;
            v78 = 0u;
            v79 = 0u;
            v76 = 0u;
            v77 = 0u;
            v16 = [v15 services];
            v17 = [v16 countByEnumeratingWithState:&v76 objects:v87 count:16];
            if (v17)
            {
              v18 = v17;
              v19 = *v77;
              do
              {
                for (j = 0; j != v18; ++j)
                {
                  if (*v77 != v19)
                  {
                    objc_enumerationMutation(v16);
                  }

                  v21 = *(*(&v76 + 1) + 8 * j);
                  v72 = 0u;
                  v73 = 0u;
                  v74 = 0u;
                  v75 = 0u;
                  v22 = [v21 characteristics];
                  v23 = [v22 countByEnumeratingWithState:&v72 objects:v86 count:16];
                  if (v23)
                  {
                    v24 = v23;
                    v25 = *v73;
                    do
                    {
                      for (k = 0; k != v24; ++k)
                      {
                        if (*v73 != v25)
                        {
                          objc_enumerationMutation(v22);
                        }

                        v27 = *(*(&v72 + 1) + 8 * k);
                        if ([v27 supportsNotification])
                        {
                          v28 = [v27 instanceID];
                          [v12 addObject:v28];
                        }
                      }

                      v24 = [v22 countByEnumeratingWithState:&v72 objects:v86 count:16];
                    }

                    while (v24);
                  }
                }

                v18 = [v16 countByEnumeratingWithState:&v76 objects:v87 count:16];
              }

              while (v18);
            }

            v29 = [v60 uuid];
            v30 = [v29 UUIDString];

            if ([v12 count])
            {
              v31 = [v12 copy];
              [v63 setObject:v31 forKeyedSubscript:v30];
            }

            v15 = v61;
            i = v62;
          }
        }

        v59 = [obj countByEnumeratingWithState:&v80 objects:v88 count:16];
      }

      while (v59);
    }

    v32 = [MEMORY[0x277CBEB18] array];
    v68 = 0u;
    v69 = 0u;
    v70 = 0u;
    v71 = 0u;
    v33 = [(HMDHome *)v57 actionSets];
    v34 = [v33 countByEnumeratingWithState:&v68 objects:v85 count:16];
    if (v34)
    {
      v35 = v34;
      v36 = *v69;
      do
      {
        for (m = 0; m != v35; ++m)
        {
          if (*v69 != v36)
          {
            objc_enumerationMutation(v33);
          }

          v38 = [*(*(&v68 + 1) + 8 * m) uuid];
          v39 = [v38 UUIDString];
          [v32 addObject:v39];
        }

        v35 = [v33 countByEnumeratingWithState:&v68 objects:v85 count:16];
      }

      while (v35);
    }

    if ([v63 count] || objc_msgSend(v32, "count"))
    {
      v66 = 0u;
      v67 = 0u;
      v64 = 0u;
      v65 = 0u;
      v40 = v55;
      v41 = [v40 countByEnumeratingWithState:&v64 objects:v84 count:16];
      if (v41)
      {
        v42 = v41;
        v43 = *v65;
        v44 = MEMORY[0x277CBEC10];
        do
        {
          for (n = 0; n != v42; ++n)
          {
            if (*v65 != v43)
            {
              objc_enumerationMutation(v40);
            }

            v46 = *(*(&v64 + 1) + 8 * n);
            v47 = [v63 copy];
            v48 = [0 copy];
            v49 = [v32 copy];
            [(HMDHome *)v57 _modifyCharacteristicNotifications:v47 characteristicChangeThresholds:v44 mediaNotifications:v48 actionSetNotificationPayload:v49 enableNotification:0 withDevice:v46];
          }

          v42 = [v40 countByEnumeratingWithState:&v64 objects:v84 count:16];
        }

        while (v42);
      }
    }

    else
    {
      v51 = objc_autoreleasePoolPush();
      v52 = v57;
      v53 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
      {
        v54 = HMFGetLogIdentifier();
        *buf = 138543362;
        v90 = v54;
        _os_log_impl(&dword_229538000, v53, OS_LOG_TYPE_INFO, "%{public}@There are no characteristics requiring deregistration", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v51);
    }

    v4 = v55;
  }

  v50 = *MEMORY[0x277D85DE8];
}

- (void)disableNotificationsForDevices:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_disableNotificationsForDevices___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)_enableNotificationsForDevices:(id)a3
{
  v208 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  if ([v4 count])
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v205 = v9;
      v206 = 2112;
      v207 = v4;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Enabling Notifications on %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v10 = [(HMDHome *)v7 notificationRegistrations];
    v145 = [v10 count];

    v11 = [(HMDHome *)v7 primaryResident];
    v152 = [v11 device];

    v125 = v4;
    if ([(HMDHome *)v7 isCurrentDeviceAvailableResident]&& ![(HMDHome *)v7 isCurrentDevicePrimaryResident])
    {
      v192 = 0u;
      v193 = 0u;
      v190 = 0u;
      v191 = 0u;
      v12 = v4;
      v13 = [v12 countByEnumeratingWithState:&v190 objects:v203 count:16];
      if (v13)
      {
        v14 = v13;
        v15 = *v191;
        while (2)
        {
          for (i = 0; i != v14; ++i)
          {
            if (*v191 != v15)
            {
              objc_enumerationMutation(v12);
            }

            if ([*(*(&v190 + 1) + 8 * i) isEqual:v152])
            {
              v151 = 1;
              goto LABEL_17;
            }
          }

          v14 = [v12 countByEnumeratingWithState:&v190 objects:v203 count:16];
          if (v14)
          {
            continue;
          }

          break;
        }
      }

      v151 = 0;
LABEL_17:
    }

    else
    {
      v151 = 0;
    }

    v155 = [MEMORY[0x277CBEB18] array];
    v186 = 0u;
    v187 = 0u;
    v188 = 0u;
    v189 = 0u;
    obj = [(HMDHome *)v7 triggers];
    v156 = v7;
    v149 = [obj countByEnumeratingWithState:&v186 objects:v202 count:16];
    if (v149)
    {
      v146 = *v187;
      do
      {
        v17 = 0;
        do
        {
          if (*v187 != v146)
          {
            objc_enumerationMutation(obj);
          }

          v157 = v17;
          v18 = *(*(&v186 + 1) + 8 * v17);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v19 = v18;
          }

          else
          {
            v19 = 0;
          }

          v20 = v19;

          v184 = 0u;
          v185 = 0u;
          v182 = 0u;
          v183 = 0u;
          v153 = v20;
          v21 = [v20 characteristicEvents];
          v22 = [v21 countByEnumeratingWithState:&v182 objects:v201 count:16];
          if (v22)
          {
            v23 = v22;
            v24 = *v183;
            do
            {
              for (j = 0; j != v23; ++j)
              {
                if (*v183 != v24)
                {
                  objc_enumerationMutation(v21);
                }

                v26 = *(*(&v182 + 1) + 8 * j);
                v27 = [v26 characteristic];

                if (v27)
                {
                  v28 = [v26 characteristic];
                  [v155 addObject:v28];
                }

                else
                {
                  v29 = objc_autoreleasePoolPush();
                  v30 = v7;
                  v31 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
                  {
                    v32 = HMFGetLogIdentifier();
                    *buf = 138543618;
                    v205 = v32;
                    v206 = 2112;
                    v207 = v26;
                    _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Characteristic of HMDCharacteristicEvent %@ is nil!", buf, 0x16u);
                  }

                  objc_autoreleasePoolPop(v29);
                  v7 = v156;
                }
              }

              v23 = [v21 countByEnumeratingWithState:&v182 objects:v201 count:16];
            }

            while (v23);
          }

          v17 = v157 + 1;
        }

        while (v157 + 1 != v149);
        v149 = [obj countByEnumeratingWithState:&v186 objects:v202 count:16];
      }

      while (v149);
    }

    v133 = [MEMORY[0x277CBEB38] dictionary];
    v132 = [MEMORY[0x277CBEB38] dictionary];
    v178 = 0u;
    v179 = 0u;
    v180 = 0u;
    v181 = 0u;
    v128 = [(HMDHome *)v7 accessories];
    v33 = [v128 countByEnumeratingWithState:&v178 objects:v200 count:16];
    if (v33)
    {
      v34 = v33;
      v35 = *v179;
      v138 = *MEMORY[0x277CFE810];
      v126 = *v179;
      do
      {
        v36 = 0;
        v127 = v34;
        do
        {
          if (*v179 != v35)
          {
            objc_enumerationMutation(v128);
          }

          v37 = *(*(&v178 + 1) + 8 * v36);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v38 = v37;
          }

          else
          {
            v38 = 0;
          }

          v39 = v38;

          if (v39)
          {
            if (shouldSkipRemoteAccessoryNotificationRegistration(v7))
            {
              v40 = v39;
              v41 = objc_autoreleasePoolPush();
              v42 = v7;
              v43 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
              {
                v44 = HMFGetLogIdentifier();
                *buf = 138543618;
                v205 = v44;
                v206 = 2112;
                v207 = v40;
                _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@Dropping all characteristics for %@ from remote notification as partitioned network is no longer supported by residents", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v41);
              v39 = v40;
              goto LABEL_106;
            }

            v129 = v37;
            v131 = v36;
            v150 = [MEMORY[0x277CBEB18] array];
            obja = [MEMORY[0x277CBEB38] dictionary];
            v174 = 0u;
            v175 = 0u;
            v176 = 0u;
            v177 = 0u;
            v130 = v39;
            v134 = [v39 services];
            v136 = [v134 countByEnumeratingWithState:&v174 objects:v199 count:16];
            if (!v136)
            {
              goto LABEL_101;
            }

            v135 = *v175;
            while (1)
            {
              v45 = 0;
              do
              {
                if (*v175 != v135)
                {
                  objc_enumerationMutation(v134);
                }

                v137 = v45;
                v46 = *(*(&v174 + 1) + 8 * v45);
                v170 = 0u;
                v171 = 0u;
                v172 = 0u;
                v173 = 0u;
                v158 = [v46 characteristics];
                v47 = [v158 countByEnumeratingWithState:&v170 objects:v198 count:16];
                if (v47)
                {
                  v48 = v47;
                  v160 = *v171;
                  v154 = v46;
                  do
                  {
                    v49 = 0;
                    do
                    {
                      if (*v171 != v160)
                      {
                        objc_enumerationMutation(v158);
                      }

                      v50 = *(*(&v170 + 1) + 8 * v49);
                      if ([v50 supportsNotification])
                      {
                        v51 = [(HMDHome *)v7 dataSource];
                        v52 = [v51 hapMetadata];
                        v53 = [v50 type];
                        v54 = [v46 type];
                        v55 = [v52 shouldFilterEnableNotificationsForCharacteristicType:v53 serviceType:v54];

                        if ((v55 & 1) == 0)
                        {
                          v56 = [v50 type];
                          v57 = [v46 type];
                          v58 = [(HMDHome *)v7 notificationRegistry];
                          v197 = v50;
                          v59 = [MEMORY[0x277CBEA60] arrayWithObjects:&v197 count:1];
                          v60 = [v58 destinationsRegisteredForNotificationsForCharacteristics:v59 applyChangeThresholding:0];
                          v61 = [v60 mutableCopy];

                          v62 = [v152 remoteDestinationString];
                          if (v62)
                          {
                            [v61 removeObject:v62];
                          }

                          v63 = [v61 count];
                          v64 = v63 != 0;
                          if ([v155 containsObject:v50] & 1) != 0 || (objc_msgSend(v50, "isNonHomeNotificationsEnabled"))
                          {
                            goto LABEL_73;
                          }

                          v65 = [(HMDHome *)v156 dataSource];
                          v66 = [v65 hapMetadata];
                          v67 = v56;
                          v68 = v66;
                          v147 = v67;
                          if ([v66 requiresDeviceUnlock:? forService:?])
                          {
                            goto LABEL_72;
                          }

                          v141 = v68;
                          v142 = v65;
                          v69 = [(HMDHome *)v156 dataSource];
                          v70 = [v69 hapMetadata];
                          if ([v70 shouldAutoEnableNotificationForCharacteristic:v147 ofService:?])
                          {

                            v68 = v141;
                            v65 = v142;
LABEL_72:

                            v56 = v147;
LABEL_73:
                            if (v151 && [v50 isNotificationEnabledForClientIdentifierPrefix:@"com.apple.HomeKitDaemon.Local"])
                            {
                              v71 = objc_autoreleasePoolPush();
                              v72 = v156;
                              v73 = HMFGetOSLogHandle();
                              if (os_log_type_enabled(v73, OS_LOG_TYPE_INFO))
                              {
                                HMFGetLogIdentifier();
                                v74 = v148 = v71;
                                *buf = 138543618;
                                v205 = v74;
                                v206 = 2112;
                                v207 = v50;
                                _os_log_impl(&dword_229538000, v73, OS_LOG_TYPE_INFO, "%{public}@Dropping characteristic for remote notifications from primary resident because it should be local only: %@", buf, 0x16u);

                                v71 = v148;
                              }

                              objc_autoreleasePoolPop(v71);
                            }

                            else
                            {
                              v75 = [v50 instanceID];
                              [v150 addObject:v75];

                              v76 = [v50 changeThresholdForEnabledNotifications];
                              if (v76 && !v145)
                              {
                                v77 = [v50 instanceID];
                                v78 = [v77 stringValue];
                                [obja setObject:v76 forKeyedSubscript:v78];
                              }
                            }

LABEL_82:

                            v7 = v156;
                            v46 = v154;
                            goto LABEL_83;
                          }

                          v139 = v70;
                          v140 = v69;
                          if ([v147 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"])
                          {
                            v79 = [v57 isEqualToString:v138];
                            if (v63)
                            {
                              v64 = 1;
                            }

                            else
                            {
                              v64 = v79;
                            }

                            if (v79 & 1 | (v145 == 0))
                            {
LABEL_96:

                              v56 = v147;
                              if (v64)
                              {
                                goto LABEL_73;
                              }

                              goto LABEL_82;
                            }
                          }

                          else if (!v145)
                          {
                            goto LABEL_96;
                          }

                          v80 = [(HMDHome *)v156 dataSource];
                          v81 = [v80 hapMetadata];
                          v82 = [v81 shouldEnableHomeNotificationForCharacteristicType:v147 serviceType:v57];
                          if (v63)
                          {
                            v64 = 1;
                          }

                          else
                          {
                            v64 = v82;
                          }

                          goto LABEL_96;
                        }
                      }

LABEL_83:
                      ++v49;
                    }

                    while (v48 != v49);
                    v83 = [v158 countByEnumeratingWithState:&v170 objects:v198 count:16];
                    v48 = v83;
                  }

                  while (v83);
                }

                v45 = v137 + 1;
              }

              while (v137 + 1 != v136);
              v136 = [v134 countByEnumeratingWithState:&v174 objects:v199 count:16];
              if (!v136)
              {
LABEL_101:

                v84 = [v129 uuid];
                v85 = [v84 UUIDString];

                if ([v150 count])
                {
                  v86 = [v150 copy];
                  [v133 setObject:v86 forKeyedSubscript:v85];
                }

                v87 = obja;
                v35 = v126;
                v34 = v127;
                v36 = v131;
                if ([obja count])
                {
                  v88 = [obja copy];
                  [v132 setObject:v88 forKeyedSubscript:v85];

                  v87 = obja;
                }

                v39 = v130;
                break;
              }
            }
          }

LABEL_106:

          ++v36;
        }

        while (v36 != v34);
        v34 = [v128 countByEnumeratingWithState:&v178 objects:v200 count:16];
      }

      while (v34);
    }

    v161 = [MEMORY[0x277CBEB18] array];
    [v133 count];
    v166 = 0u;
    v167 = 0u;
    v168 = 0u;
    v169 = 0u;
    v159 = [(HMDHome *)v7 actionSets];
    v89 = [v159 countByEnumeratingWithState:&v166 objects:v196 count:16];
    if (v89)
    {
      v90 = v89;
      v91 = *v167;
      do
      {
        for (k = 0; k != v90; ++k)
        {
          if (*v167 != v91)
          {
            objc_enumerationMutation(v159);
          }

          v93 = *(*(&v166 + 1) + 8 * k);
          v94 = [(HMDHome *)v7 notificationRegistry];
          v95 = [HMDActionSetResponse alloc];
          v96 = [v93 uuid];
          v97 = [(HMDActionSetResponse *)v95 initWithActionSetUUID:v96 state:0];
          v195 = v97;
          v98 = [MEMORY[0x277CBEA60] arrayWithObjects:&v195 count:1];
          v99 = [v94 destinationsRegisteredForNotificationsForActionSetResponses:v98];
          v100 = [v99 mutableCopy];

          v101 = [v152 remoteDestinationString];
          if (v101)
          {
            [v100 removeObject:v101];
          }

          if ([v100 count] || (-[HMDHome actionSetStateSubscriptionManager](v156, "actionSetStateSubscriptionManager"), v102 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v93, "uuid"), v103 = objc_claimAutoreleasedReturnValue(), v104 = objc_msgSend(v102, "isMonitoringActionSet:", v103), v103, v102, v104))
          {
            if (v151)
            {
              v105 = objc_autoreleasePoolPush();
              v106 = v156;
              v107 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v107, OS_LOG_TYPE_INFO))
              {
                v108 = HMFGetLogIdentifier();
                *buf = 138543618;
                v205 = v108;
                v206 = 2112;
                v207 = v93;
                _os_log_impl(&dword_229538000, v107, OS_LOG_TYPE_INFO, "%{public}@Dropping action set for remote notifications from primary resident because it should be local only: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v105);
            }

            else
            {
              v109 = [v93 uuid];
              v110 = [v109 UUIDString];
              [v161 addObject:v110];
            }
          }

          v7 = v156;
        }

        v90 = [v159 countByEnumeratingWithState:&v166 objects:v196 count:16];
      }

      while (v90);
    }

    if ([v133 count] || objc_msgSend(v161, "count"))
    {
      v164 = 0u;
      v165 = 0u;
      v162 = 0u;
      v163 = 0u;
      v111 = v125;
      v112 = [v111 countByEnumeratingWithState:&v162 objects:v194 count:16];
      if (v112)
      {
        v113 = v112;
        v114 = *v163;
        do
        {
          for (m = 0; m != v113; ++m)
          {
            if (*v163 != v114)
            {
              objc_enumerationMutation(v111);
            }

            v116 = *(*(&v162 + 1) + 8 * m);
            v117 = [v133 copy];
            v118 = [0 copy];
            v119 = [v161 copy];
            [(HMDHome *)v7 _modifyCharacteristicNotifications:v117 characteristicChangeThresholds:v132 mediaNotifications:v118 actionSetNotificationPayload:v119 enableNotification:1 withDevice:v116];
          }

          v113 = [v111 countByEnumeratingWithState:&v162 objects:v194 count:16];
        }

        while (v113);
      }
    }

    else
    {
      v121 = objc_autoreleasePoolPush();
      v122 = v7;
      v123 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v123, OS_LOG_TYPE_INFO))
      {
        v124 = HMFGetLogIdentifier();
        *buf = 138543362;
        v205 = v124;
        _os_log_impl(&dword_229538000, v123, OS_LOG_TYPE_INFO, "%{public}@There are no characteristics/media properties requiring registration", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v121);
    }

    v4 = v125;
  }

  v120 = *MEMORY[0x277D85DE8];
}

- (void)enableNotificationsForDevices:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome_enableNotificationsForDevices___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)_subscribeForHomeNotificationsFromRemoteGateway:(BOOL)a3 accessories:(id)a4
{
  v4 = a3;
  v58 = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v7);

  v48 = 0;
  v49 = 0;
  v46 = 0;
  v47 = 0;
  v45 = 0;
  [(HMDHome *)self _notificationPayloadsForRemoteGateway:v4 accessories:v6 enableCharacteristicNotificationPayload:&v49 characteristicNotificationThresholdsPayload:&v48 disableCharacteristicNotificationPayload:&v47 enableMediaNotificationPayload:&v46 disableMediaNotificationPayload:&v45];
  v8 = v49;
  v9 = v48;
  v10 = v47;
  v11 = v46;
  v12 = v45;
  if ([v10 count] || objc_msgSend(v8, "count") || objc_msgSend(v12, "count") || objc_msgSend(v11, "count"))
  {
    if ([v8 count] || objc_msgSend(v11, "count"))
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v38 = v13;
        v17 = v16 = v11;
        HMFBooleanToString();
        v18 = v39 = v12;
        [v8 shortDescription];
        v40 = v8;
        v42 = v10;
        v20 = v19 = v6;
        [v16 shortDescription];
        v22 = v21 = v9;
        *buf = 138544130;
        v51 = v17;
        v52 = 2112;
        v53 = v18;
        v54 = 2112;
        v55 = v20;
        v56 = 2112;
        v57 = v22;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Registering notifications with remote gateway when notificationEnabled: %@, characteristics: %@, properties: %@", buf, 0x2Au);

        v9 = v21;
        v6 = v19;
        v8 = v40;
        v10 = v42;

        v12 = v39;
        v11 = v16;
        v13 = v38;
      }

      objc_autoreleasePoolPop(v13);
      [(HMDHome *)v14 _modifyCharacteristicNotificationsOnResident:v8 characteristicChangeThresholds:v9 mediaNotifications:v11 actionSetNotificationPayload:MEMORY[0x277CBEBF8] matterAttributeNotifications:0 enableNotification:1];
    }

    if ([v10 count] || objc_msgSend(v12, "count"))
    {
      v23 = objc_autoreleasePoolPush();
      v24 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v26 = v43 = v11;
        HMFBooleanToString();
        v27 = v44 = v6;
        [v10 shortDescription];
        v28 = v41 = v9;
        [v12 shortDescription];
        v30 = v29 = v12;
        *buf = 138544130;
        v51 = v26;
        v52 = 2112;
        v53 = v27;
        v54 = 2112;
        v55 = v28;
        v56 = 2112;
        v57 = v30;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_INFO, "%{public}@De-registering notifications with remote gateway when notificationEnabled: %@, characteristics: %@, properties: %@", buf, 0x2Au);

        v12 = v29;
        v9 = v41;

        v6 = v44;
        v11 = v43;
      }

      objc_autoreleasePoolPop(v23);
      [(HMDHome *)v24 _modifyCharacteristicNotificationsOnResident:v10 characteristicChangeThresholds:0 mediaNotifications:v12 actionSetNotificationPayload:MEMORY[0x277CBEBF8] matterAttributeNotifications:0 enableNotification:0];
    }
  }

  else
  {
    v32 = v12;
    v33 = v11;
    v34 = objc_autoreleasePoolPush();
    v35 = self;
    v36 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
    {
      v37 = HMFGetLogIdentifier();
      *buf = 138543362;
      v51 = v37;
      _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_INFO, "%{public}@Not registering notifications with remote gateway since we have no modifications", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v34);
    v11 = v33;
    v12 = v32;
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)subscribeForNotificationsFromRemoteGateway
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __53__HMDHome_subscribeForNotificationsFromRemoteGateway__block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)_remotelySetNotificationsEnabled:(BOOL)a3 forMatterAttributes:(id)a4
{
  v4 = a3;
  v24 = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v7);

  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543874;
    v19 = v11;
    v20 = 1024;
    v21 = v4;
    v22 = 2112;
    v23 = v6;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Setting remote notifications enabled=%{BOOL}d and adding matter attributes to registration payload. Attributes=%@", buf, 0x1Cu);
  }

  objc_autoreleasePoolPop(v8);
  if (v4)
  {
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __64__HMDHome__remotelySetNotificationsEnabled_forMatterAttributes___block_invoke;
    v17[3] = &unk_278685C40;
    v17[4] = v9;
    [v6 na_each:v17];
    [(HMDHome *)v9 _createModifyNotificationsCoalesceTimerIfNeeded];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = v9;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v19 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Currently unsubscribing from Matter attributes is not supported. rdar://121935520 (Provide API for unsubscribing to attribute notifications)", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __64__HMDHome__remotelySetNotificationsEnabled_forMatterAttributes___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v18 = [v3 hmf_numberForKey:@"HMDHomeCHIPNodeIDMessageKey"];
  v4 = [v3 hmf_numberForKey:@"HMDHomeCHIPEndpointIDMessageKey"];
  v5 = [v3 hmf_numberForKey:@"HMDHomeCHIPClusterIDMessageKey"];
  v6 = [v3 hmf_numberForKey:@"HMDHomeCHIPAttributeIDMessageKey"];

  v7 = [*(a1 + 32) matterAttributesEnableNotificationPayload];
  v8 = [v7 objectForKeyedSubscript:v18];

  if (!v8)
  {
    v8 = [MEMORY[0x277CBEB38] dictionary];
    v9 = [*(a1 + 32) matterAttributesEnableNotificationPayload];
    [v9 setObject:v8 forKeyedSubscript:v18];

    v10 = [MEMORY[0x277CBEB38] dictionary];
    [v8 setObject:v10 forKeyedSubscript:@"HMDHomeCHIPEndpointsMessageKey"];

    [v8 setObject:MEMORY[0x277CBEC28] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
  }

  if (([v8 hmf_BOOLForKey:@"HMDHomeCHIPWildcardMessageKey"] & 1) == 0)
  {
    if (v4)
    {
      v11 = [v8 objectForKeyedSubscript:@"HMDHomeCHIPEndpointsMessageKey"];
      v12 = [v11 objectForKeyedSubscript:v4];
      if (!v12)
      {
        v12 = [MEMORY[0x277CBEB38] dictionary];
        [v11 setObject:v12 forKeyedSubscript:v4];
        v13 = [MEMORY[0x277CBEB38] dictionary];
        [v12 setObject:v13 forKeyedSubscript:@"HMDHomeCHIPClustersMessageKey"];

        [v12 setObject:MEMORY[0x277CBEC28] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
      }

      if (([v12 hmf_BOOLForKey:@"HMDHomeCHIPWildcardMessageKey"] & 1) == 0)
      {
        if (v5)
        {
          v14 = [v12 objectForKeyedSubscript:@"HMDHomeCHIPClustersMessageKey"];
          v15 = [v14 objectForKeyedSubscript:v5];
          if (!v15)
          {
            v15 = [MEMORY[0x277CBEB38] dictionary];
            [v14 setObject:v15 forKeyedSubscript:v5];
            v16 = [MEMORY[0x277CBEB18] array];
            [v15 setObject:v16 forKeyedSubscript:@"HMDHomeCHIPAttributesMessageKey"];

            [v15 setObject:MEMORY[0x277CBEC28] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
          }

          if (([v15 hmf_BOOLForKey:@"HMDHomeCHIPWildcardMessageKey"] & 1) == 0)
          {
            if (v6)
            {
              v17 = [v15 objectForKeyedSubscript:@"HMDHomeCHIPAttributesMessageKey"];
              if (([v17 containsObject:v6] & 1) == 0)
              {
                [v17 addObject:v6];
              }
            }

            else
            {
              [v15 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
              [v15 setObject:MEMORY[0x277CBEBF8] forKeyedSubscript:@"HMDHomeCHIPAttributesMessageKey"];
            }
          }
        }

        else
        {
          [v12 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
          [v12 setObject:MEMORY[0x277CBEC10] forKeyedSubscript:@"HMDHomeCHIPClustersMessageKey"];
        }
      }
    }

    else
    {
      [v8 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"HMDHomeCHIPWildcardMessageKey"];
      [v8 setObject:MEMORY[0x277CBEC10] forKeyedSubscript:@"HMDHomeCHIPEndpointsMessageKey"];
    }
  }
}

- (void)remotelySetNotificationsEnabled:(BOOL)a3 forMatterAttributes:(id)a4
{
  v6 = a4;
  v7 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __63__HMDHome_remotelySetNotificationsEnabled_forMatterAttributes___block_invoke;
  block[3] = &unk_278688BD0;
  v11 = a3;
  block[4] = self;
  v10 = v6;
  v8 = v6;
  dispatch_async(v7, block);
}

- (void)_createModifyNotificationsCoalesceTimerIfNeeded
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = [(HMDHome *)self modifyNotificationsCoalesceTimer];

  if (!v4)
  {
    v5 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:0 options:0.5];
    [(HMDHome *)self setModifyNotificationsCoalesceTimer:v5];

    v6 = [(HMDHome *)self workQueue];
    v7 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [v7 setDelegateQueue:v6];

    v8 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [v8 setDelegate:self];

    v9 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [v9 resume];

    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = v11;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@%@ Kicked off the modify notifications on resident request timer", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_remotelySetNotificationsEnabled:(BOOL)a3 forCharacteristics:(id)a4 characteristicChangeThresholds:(id)a5
{
  v6 = a3;
  v66 = *MEMORY[0x277D85DE8];
  v8 = a4;
  v48 = a5;
  v9 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v9);

  v53 = v6;
  if (v6)
  {
    v50 = [(HMDHome *)self enableNotificationPayload];
    [(HMDHome *)self disableNotificationPayload];
  }

  else
  {
    v50 = [(HMDHome *)self disableNotificationPayload];
    [(HMDHome *)self enableNotificationPayload];
  }
  v49 = ;
  v57 = 0u;
  v58 = 0u;
  v55 = 0u;
  v56 = 0u;
  obj = v8;
  v52 = [obj countByEnumeratingWithState:&v55 objects:v65 count:16];
  if (v52)
  {
    v51 = *v56;
    *&v10 = 138543874;
    v45 = v10;
    v46 = self;
    do
    {
      for (i = 0; i != v52; ++i)
      {
        if (*v56 != v51)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v55 + 1) + 8 * i);
        v13 = [v12 accessory];
        v14 = [v13 uuid];
        v15 = [v14 UUIDString];

        if (v15)
        {
          v16 = [v50 objectForKeyedSubscript:v15];
          if (!v16)
          {
            v16 = [MEMORY[0x277CBEB18] array];
            [v50 setObject:v16 forKeyedSubscript:v15];
          }

          v17 = [v12 instanceID];
          v18 = [v16 containsObject:v17];

          if ((v18 & 1) == 0)
          {
            v19 = [v12 instanceID];
            [v16 addObject:v19];
          }

          v20 = [v49 objectForKeyedSubscript:v15];

          v21 = [v12 instanceID];
          v22 = [v20 containsObject:v21];

          if (v22)
          {
            v23 = [v12 instanceID];
            [v20 removeObject:v23];

            v24 = objc_autoreleasePoolPush();
            v25 = self;
            v26 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
            {
              v27 = HMFGetLogIdentifier();
              v28 = HMFBooleanToString();
              *buf = v45;
              v60 = v27;
              v61 = 2112;
              v62 = v28;
              v63 = 2112;
              v64 = v12;
              _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Function call to set notification to %@, removing the entry %@ from the other payload", buf, 0x20u);

              self = v46;
            }

            objc_autoreleasePoolPop(v24);
            if (![v20 count])
            {
              [v49 removeObjectForKey:v15];
            }
          }

          v54[0] = MEMORY[0x277D85DD0];
          v54[1] = 3221225472;
          v54[2] = __94__HMDHome__remotelySetNotificationsEnabled_forCharacteristics_characteristicChangeThresholds___block_invoke;
          v54[3] = &unk_278676278;
          v54[4] = v12;
          v29 = [v48 na_firstObjectPassingTest:v54];
          v30 = [v29 threshold];

          if (v53 && v30)
          {
            v31 = [(HMDHome *)self pendingCharacteristicThresholdPayload];
            v32 = [v31 objectForKeyedSubscript:v15];

            if (!v32)
            {
              v32 = [MEMORY[0x277CBEB38] dictionary];
              v33 = [(HMDHome *)self pendingCharacteristicThresholdPayload];
              [v33 setObject:v32 forKeyedSubscript:v15];
            }

            v34 = [v12 instanceID];
            v35 = [v34 stringValue];
            [v32 setObject:v30 forKeyedSubscript:v35];
          }

          if (!v53)
          {
            v36 = [(HMDHome *)self pendingCharacteristicThresholdPayload];
            v37 = [v36 objectForKeyedSubscript:v15];
            v38 = [v12 instanceID];
            v39 = [v38 stringValue];
            [v37 setObject:0 forKeyedSubscript:v39];

            self = v46;
            v40 = [(HMDHome *)v46 pendingCharacteristicThresholdPayload];
            v41 = [v40 objectForKeyedSubscript:v15];
            v42 = [v41 count];

            if (!v42)
            {
              v43 = [(HMDHome *)v46 pendingCharacteristicThresholdPayload];
              [v43 setObject:0 forKeyedSubscript:v15];
            }
          }
        }
      }

      v52 = [obj countByEnumeratingWithState:&v55 objects:v65 count:16];
    }

    while (v52);
  }

  if ([v50 count] || objc_msgSend(v49, "count"))
  {
    [(HMDHome *)self _createModifyNotificationsCoalesceTimerIfNeeded];
  }

  v44 = *MEMORY[0x277D85DE8];
}

BOOL __94__HMDHome__remotelySetNotificationsEnabled_forCharacteristics_characteristicChangeThresholds___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 characteristic];
  v4 = v3 == *(a1 + 32);

  return v4;
}

- (void)remotelySetNotificationsEnabled:(BOOL)a3 forCharacteristics:(id)a4 characteristicChangeThresholds:(id)a5
{
  v8 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __93__HMDHome_remotelySetNotificationsEnabled_forCharacteristics_characteristicChangeThresholds___block_invoke;
  v13[3] = &unk_278685AA8;
  v16 = a3;
  v13[4] = self;
  v14 = v8;
  v15 = v9;
  v11 = v9;
  v12 = v8;
  dispatch_async(v10, v13);
}

- (void)redispatchToResidentMessage:(id)a3 target:(id)a4 responseQueue:(id)a5 viaDevice:(id)a6
{
  v95 = *MEMORY[0x277D85DE8];
  v85 = a3;
  v10 = a4;
  v11 = a5;
  v12 = a6;
  if (v10)
  {
    v13 = v85;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v15)
    {
      v16 = v13;
    }

    else
    {
      v16 = [v13 mutableCopy];
    }

    v17 = v16;

    v18 = [(HMDAssertionLogEvent *)v17 responseHandler];
    if (v18)
    {
      v86[0] = MEMORY[0x277D85DD0];
      v86[1] = 3221225472;
      v86[2] = __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke;
      v86[3] = &unk_278685AF8;
      v87 = v11;
      v88 = v18;
      [(HMDAssertionLogEvent *)v17 setResponseHandler:v86];
    }

    v19 = [(HMDAssertionLogEvent *)v17 name];
    v20 = [v19 isEqualToString:@"kMultipleCharacteristicWriteRequestKey"];

    if (!isiOSDevice())
    {
      goto LABEL_15;
    }

    if (redispatchToResidentMessage_target_responseQueue_viaDevice__pred != -1)
    {
      dispatch_once(&redispatchToResidentMessage_target_responseQueue_viaDevice__pred, &__block_literal_global_949);
    }

    v21 = redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages;
    v22 = [(HMDAssertionLogEvent *)v17 name];
    LODWORD(v21) = [v21 containsObject:v22];

    if (!v21)
    {
      goto LABEL_15;
    }

    v23 = [(HMDHome *)self currentUser];
    v24 = [v23 isRemoteAccessAllowed];

    if ((v24 & 1) == 0)
    {
      v82 = v18;
      v65 = objc_autoreleasePoolPush();
      v66 = self;
      v67 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v67, OS_LOG_TYPE_INFO))
      {
        v68 = HMFGetLogIdentifier();
        [(HMDHome *)v66 currentUser];
        v69 = v84 = v65;
        [v69 displayName];
        v70 = v80 = v10;
        *buf = 138543618;
        v90 = v68;
        v91 = 2112;
        v92 = v70;
        _os_log_impl(&dword_229538000, v67, OS_LOG_TYPE_INFO, "%{public}@Remote access is disabled for the user %@, restricting to local transports...", buf, 0x16u);

        v65 = v84;
        v10 = v80;
      }

      objc_autoreleasePoolPop(v65);
      v25 = 1;
      v18 = v82;
    }

    else
    {
LABEL_15:
      v25 = 0;
    }

    v26 = [(HMDAssertionLogEvent *)v17 messagePayload];
    v27 = [v26 mutableCopy];

    if (v25)
    {
      [(HMDAssertionLogEvent *)v17 setRemoteDisallowsIDSRacing:1];
    }

    v28 = [MEMORY[0x277D0F770] currentActivity];
    v29 = v28;
    v83 = v27;
    if (v12)
    {
      [(HMDAssertionLogEvent *)v17 setSecureRemote:1];
      v30 = [[HMDRemoteDeviceMessageDestination alloc] initWithTarget:v10 device:v12];
      [(HMDAssertionLogEvent *)v17 setDestination:v30];

      [v27 setObject:0 forKeyedSubscript:@"kIDSMessageSourceIDKey"];
      [(HMDAssertionLogEvent *)v17 setMessagePayload:v27];
      v31 = objc_autoreleasePoolPush();
      v32 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v78 = v11;
        v81 = v18;
        v35 = v34 = v10;
        v36 = [(HMDAssertionLogEvent *)v17 shortDescription];
        [v12 shortDescription];
        v38 = v37 = v29;
        *buf = 138543874;
        v90 = v35;
        v91 = 2112;
        v92 = v36;
        v93 = 2112;
        v94 = v38;
        _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to device: %@", buf, 0x20u);

        v29 = v37;
        v10 = v34;
        v11 = v78;
        v18 = v81;
      }

      objc_autoreleasePoolPop(v31);
      [(HMDAssertionLogEvent *)v17 name];

      [(HMDAssertionLogEvent *)v17 identifier];
      [v12 identifier];

      v39 = +[HMDSecureRemoteMessageTransport defaultTransport];
      v40 = [(HMDAssertionLogEvent *)v17 copy];
      [v39 sendMessage:v40 completionHandler:0];
    }

    else
    {
      v77 = v28;
      v79 = v10;
      v41 = objc_autoreleasePoolPush();
      v42 = self;
      v43 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
      {
        v44 = HMFGetLogIdentifier();
        v45 = [(HMDAssertionLogEvent *)v17 shortDescription];
        *buf = 138543618;
        v90 = v44;
        v91 = 2112;
        v92 = v45;
        _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to resident", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v41);
      v46 = [(HMDHome *)v42 homeManager];
      v47 = [v46 messageDispatcher];
      v39 = [v47 residentCommunicationHandlerForHome:v42];

      v48 = [v39 preferredDevice];
      if (v48)
      {
        v40 = v48;
        if (v20)
        {
          [v83 setObject:0 forKeyedSubscript:@"kMultiPartResponseKey"];
        }

        [(HMDAssertionLogEvent *)v17 setMessagePayload:v83];
        v49 = objc_autoreleasePoolPush();
        v50 = v42;
        v51 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v52 = v76 = v49;
          [(HMDAssertionLogEvent *)v17 shortDescription];
          v54 = v53 = v11;
          v55 = [v40 shortDescription];
          *buf = 138543874;
          v90 = v52;
          v91 = 2112;
          v92 = v54;
          v93 = 2112;
          v94 = v55;
          _os_log_impl(&dword_229538000, v51, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to remote device: %@", buf, 0x20u);

          v11 = v53;
          v12 = 0;

          v49 = v76;
        }

        objc_autoreleasePoolPop(v49);
        v10 = v79;
        [v39 redispatchMessage:v17 target:v79 responseQueue:v11];
      }

      else
      {
        v56 = objc_autoreleasePoolPush();
        v57 = v42;
        v58 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
        {
          v59 = HMFGetLogIdentifier();
          [(HMDAssertionLogEvent *)v17 shortDescription];
          v61 = v60 = v11;
          v62 = [(HMDHome *)v57 shortDescription];
          *buf = 138543874;
          v90 = v59;
          v91 = 2112;
          v92 = v61;
          v93 = 2112;
          v94 = v62;
          _os_log_impl(&dword_229538000, v58, OS_LOG_TYPE_INFO, "%{public}@Cannot redispatch message %@ because there is no resident configured for home: %@", buf, 0x20u);

          v11 = v60;
          v12 = 0;
        }

        objc_autoreleasePoolPop(v56);
        [(HMDHome *)v57 uuid];

        v63 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
        [(HMDAssertionLogEvent *)v17 respondWithError:v63];

        v40 = 0;
        v10 = v79;
      }

      v29 = v77;
    }
  }

  else
  {
    v71 = objc_autoreleasePoolPush();
    v72 = self;
    v73 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v73, OS_LOG_TYPE_FAULT))
    {
      HMFGetLogIdentifier();
      v75 = v74 = v11;
      *buf = 138543362;
      v90 = v75;
      _os_log_impl(&dword_229538000, v73, OS_LOG_TYPE_FAULT, "%{public}@Submitting ABC event for failure: TargetUUID cannot be nil", buf, 0xCu);

      v11 = v74;
    }

    objc_autoreleasePoolPop(v71);
    v17 = [[HMDAssertionLogEvent alloc] initWithReason:@"TargetUUID cannot be nil"];
    v18 = +[HMDMetricsManager sharedLogEventSubmitter];
    [v18 submitLogEvent:v17];
  }

  v64 = *MEMORY[0x277D85DE8];
}

void __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke_2;
  block[3] = &unk_278689F98;
  v7 = *(a1 + 32);
  v8 = *(a1 + 40);
  v13 = v6;
  v14 = v8;
  v12 = v5;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);
}

void __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke_3()
{
  v3[8] = *MEMORY[0x277D85DE8];
  v3[0] = @"kCharacteristicWriteRequestKey";
  v3[1] = @"kCharacteristicReadRequestKey";
  v3[2] = @"kMultipleCharacteristicWriteRequestKey";
  v3[3] = @"kMultipleCharacteristicReadRequestKey";
  v3[4] = @"kIdentifyAccessoryRequestKey";
  v3[5] = @"kMediaPropertiesWriteRequestKey";
  v3[6] = @"kMediaPropertiesReadRequestKey";
  v3[7] = @"HMDHomeSetNaturalLightingEnabledForLightProfilesMessage";
  v0 = [MEMORY[0x277CBEA60] arrayWithObjects:v3 count:8];
  v1 = redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages;
  redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages = v0;

  v2 = *MEMORY[0x277D85DE8];
}

- (void)addCompanionAsResidentUser:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __38__HMDHome_addCompanionAsResidentUser___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __38__HMDHome_addCompanionAsResidentUser___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) users];
  v3 = [*(a1 + 40) userID];
  v4 = [v2 hmf_firstObjectWithValue:v3 forKeyPath:@"userID"];

  if (!v4)
  {
    [*(a1 + 32) _addUserToContainer:*(a1 + 40)];
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Added a new resident user", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  [(HMDHome *)*(a1 + 32) _subscribeForNotificationFromRemoteGateway:?];

  v9 = *MEMORY[0x277D85DE8];
}

- (id)_characteristicNotificationPayloadsOnDirectTransports:(BOOL)a3
{
  v69 = a3;
  v103 = *MEMORY[0x277D85DE8];
  v70 = [MEMORY[0x277CBEB18] array];
  v93 = 0u;
  v94 = 0u;
  v95 = 0u;
  v96 = 0u;
  v74 = self;
  obj = [(HMDHome *)self triggers];
  v4 = [obj countByEnumeratingWithState:&v93 objects:v102 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v94;
    do
    {
      v7 = 0;
      v72 = v5;
      do
      {
        if (*v94 != v6)
        {
          objc_enumerationMutation(obj);
        }

        v8 = *(*(&v93 + 1) + 8 * v7);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        if ([v10 shouldActivateOnLocalDevice])
        {
          v91 = 0u;
          v92 = 0u;
          v89 = 0u;
          v90 = 0u;
          v11 = [v10 characteristicEvents];
          v12 = [v11 countByEnumeratingWithState:&v89 objects:v101 count:16];
          if (v12)
          {
            v13 = v12;
            v14 = *v90;
            do
            {
              for (i = 0; i != v13; ++i)
              {
                if (*v90 != v14)
                {
                  objc_enumerationMutation(v11);
                }

                v16 = *(*(&v89 + 1) + 8 * i);
                v17 = [v16 characteristic];

                if (v17)
                {
                  v18 = [v16 characteristic];
                  [v70 addObject:v18];
                }
              }

              v13 = [v11 countByEnumeratingWithState:&v89 objects:v101 count:16];
            }

            while (v13);
          }

          v5 = v72;
        }

        ++v7;
      }

      while (v7 != v5);
      v5 = [obj countByEnumeratingWithState:&v93 objects:v102 count:16];
    }

    while (v5);
  }

  v58 = [MEMORY[0x277CBEB38] dictionary];
  v57 = [MEMORY[0x277CBEB38] dictionary];
  v19 = self;
  [(HMDHome *)self accessories];
  v85 = 0u;
  v86 = 0u;
  v87 = 0u;
  v56 = v88 = 0u;
  v60 = [v56 countByEnumeratingWithState:&v85 objects:v100 count:16];
  if (v60)
  {
    v59 = *v86;
    v73 = *MEMORY[0x277CFE810];
    do
    {
      for (j = 0; j != v60; ++j)
      {
        if (*v86 != v59)
        {
          objc_enumerationMutation(v56);
        }

        v21 = *(*(&v85 + 1) + 8 * j);
        v22 = [MEMORY[0x277CBEB18] array];
        v23 = [MEMORY[0x277CBEB18] array];
        v24 = v21;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v25 = v24;
        }

        else
        {
          v25 = 0;
        }

        v26 = v25;

        if (v26)
        {
          v61 = v24;
          v62 = v26;
          v68 = v23;
          v71 = v22;
          v63 = j;
          v83 = 0u;
          v84 = 0u;
          v81 = 0u;
          v82 = 0u;
          v64 = [v26 services];
          v66 = [v64 countByEnumeratingWithState:&v81 objects:v99 count:16];
          if (!v66)
          {
            goto LABEL_61;
          }

          v65 = *v82;
          while (1)
          {
            v27 = 0;
            do
            {
              if (*v82 != v65)
              {
                objc_enumerationMutation(v64);
              }

              v67 = v27;
              v28 = *(*(&v81 + 1) + 8 * v27);
              v29 = [v28 type];
              v77 = 0u;
              v78 = 0u;
              v79 = 0u;
              v80 = 0u;
              obja = [v28 characteristics];
              v30 = [obja countByEnumeratingWithState:&v77 objects:v98 count:16];
              if (v30)
              {
                v31 = v30;
                v32 = *v78;
                do
                {
                  v33 = 0;
                  do
                  {
                    if (*v78 != v32)
                    {
                      objc_enumerationMutation(obja);
                    }

                    v34 = *(*(&v77 + 1) + 8 * v33);
                    if ([v34 supportsNotification])
                    {
                      v35 = [(HMDHome *)v19 dataSource];
                      v36 = [v35 hapMetadata];
                      v37 = [v34 type];
                      v38 = [v36 shouldFilterEnableNotificationsForCharacteristicType:v37 serviceType:v29];

                      if ((v38 & 1) == 0)
                      {
                        if ([v29 isEqualToString:v73])
                        {
                          v39 = [v34 type];
                          v40 = [v39 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"];
                        }

                        else
                        {
                          v40 = 0;
                        }

                        v41 = [(HMDHome *)v19 dataSource];
                        v42 = [v41 hapMetadata];
                        v43 = [v34 type];
                        v44 = [v42 shouldAutoEnableNotificationForCharacteristic:v43 ofService:v29];

                        if ([v34 isClientNotificationEnabled] & 1) != 0 || (objc_msgSend(v70, "containsObject:", v34) & 1) != 0 || ((objc_msgSend(v34, "isNonHomeNotificationsEnabled") | v40 | v44))
                        {
                          v45 = v71;
LABEL_50:
                          [v45 addObject:v34];
                          v19 = v74;
                          goto LABEL_51;
                        }

                        if (!v69)
                        {
                          v45 = v68;
                          goto LABEL_50;
                        }

                        v46 = [v34 type];
                        v19 = v74;
                        v47 = [(HMDHome *)v74 dataSource];
                        v48 = [v47 hapMetadata];
                        v49 = [v48 shouldEnableHomeNotificationForCharacteristicType:v46 serviceType:v29];

                        if (v49)
                        {
                          [v71 addObject:v34];
                        }
                      }
                    }

LABEL_51:
                    ++v33;
                  }

                  while (v31 != v33);
                  v50 = [obja countByEnumeratingWithState:&v77 objects:v98 count:16];
                  v31 = v50;
                }

                while (v50);
              }

              v27 = v67 + 1;
            }

            while (v67 + 1 != v66);
            v66 = [v64 countByEnumeratingWithState:&v81 objects:v99 count:16];
            if (!v66)
            {
LABEL_61:

              v26 = v62;
              j = v63;
              v22 = v71;
              v23 = v68;
              v24 = v61;
              break;
            }
          }
        }

        v51 = [v24 uuid];
        v52 = [v51 UUIDString];

        if ([v22 count])
        {
          [v58 setObject:v22 forKeyedSubscript:v52];
        }

        if ([v23 count])
        {
          [v57 setObject:v23 forKeyedSubscript:v52];
        }
      }

      v60 = [v56 countByEnumeratingWithState:&v85 objects:v100 count:16];
    }

    while (v60);
  }

  v97[0] = v57;
  v97[1] = v58;
  v53 = [MEMORY[0x277CBEA60] arrayWithObjects:v97 count:2];

  v54 = *MEMORY[0x277D85DE8];

  return v53;
}

- (void)_handleRemoteGatewayNotificationRegistration:(id)a3 enable:(BOOL)a4
{
  v18 = a4;
  v25 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v19 = [MEMORY[0x277CBEAA8] date];
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v6 = v5;
  v7 = [v6 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v21;
    do
    {
      v10 = 0;
      do
      {
        if (*v21 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v20 + 1) + 8 * v10);
        v12 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v11];
        v13 = [(HMDHome *)self accessoryWithUUID:v12];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if (v15)
        {
          v16 = [v6 hmf_arrayForKey:v11];
          if ([v16 count])
          {
            [v15 handleRemoteGatewayNotificationRegistration:v16 enable:v18 enableTime:v19];
          }
        }

        ++v10;
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v20 objects:v24 count:16];
    }

    while (v8);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (BOOL)applyDeviceLockStatus:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isRemote])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [v4 shortDescription];
      v19 = 138543618;
      v20 = v8;
      v21 = 2112;
      v22 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@%@ is from remote source; ignoring this device's lock status", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = 0;
  }

  else if ([v4 BOOLForKey:@"kApplyDeviceUnlockKey"])
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Treating device as always locked.", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v10 = 1;
  }

  else
  {
    v15 = [(HMDHome *)self dataSource];
    v16 = [v15 deviceLockStateDataSource];
    v10 = [v16 isLocked];
  }

  v17 = *MEMORY[0x277D85DE8];
  return v10;
}

- (id)mediaProfileForAppleMediaAccessoryUUID:(id)a3 mediaStateSubscriber:(id)a4
{
  v5 = a3;
  v6 = [(HMDHome *)self appleMediaAccessories];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __71__HMDHome_mediaProfileForAppleMediaAccessoryUUID_mediaStateSubscriber___block_invoke;
  v11[3] = &unk_278688F28;
  v12 = v5;
  v7 = v5;
  v8 = [v6 na_firstObjectPassingTest:v11];
  v9 = [v8 mediaProfile];

  return v9;
}

uint64_t __71__HMDHome_mediaProfileForAppleMediaAccessoryUUID_mediaStateSubscriber___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (id)currentAccessoryUUIDsForMediaStateSubscriber:(id)a3
{
  v3 = [(HMDHome *)self currentAccessory];
  v4 = [v3 uuid];

  return v4;
}

- (id)appleMediaAccessoryUUIDsForMediaStateSubscriber:(id)a3
{
  v3 = [(HMDHome *)self appleMediaAccessories];
  v4 = [v3 na_map:&__block_literal_global_936];

  return v4;
}

- (void)configureMediaGroupsAggregateConsumer
{
  v33 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) == 0)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v19;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is disabled", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
  }

  else
  {
    v3 = [(HMDHome *)self homeManager];
    v4 = [(HMDHome *)self uuid];
    v5 = [(HMDHome *)self notificationCenter];
    v6 = [v3 localAndRemoteSubscriptionProvider];
    v7 = [v3 userDefaults];
    v8 = v7;
    if (v6 && v4 && v5 && v7)
    {
      v9 = [[HMDMediaGroupsStageManager alloc] initWithIdentifier:v4 userDefaults:v7];
      v10 = [[HMDMediaGroupsAggregateConsumer alloc] initWithIdentifier:v4 subscriptionProvider:v6 notificationCenter:v5 stageManager:v9];
      mediaGroupsAggregateConsumer = self->_mediaGroupsAggregateConsumer;
      self->_mediaGroupsAggregateConsumer = v10;

      [(HMDMediaGroupsStageManager *)v9 setDelegate:self->_mediaGroupsAggregateConsumer];
      [(HMDMediaGroupsAggregateConsumer *)self->_mediaGroupsAggregateConsumer setDelegate:self];
      [(HMDMediaGroupsAggregateConsumer *)self->_mediaGroupsAggregateConsumer configureWithHome:self];
    }

    else
    {
      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        v15 = HMFGetLogIdentifier();
        v21 = 138544642;
        v22 = v15;
        v23 = 2112;
        v24 = v4;
        v25 = 2112;
        v26 = v6;
        v27 = 2112;
        v28 = v5;
        v29 = 2112;
        v30 = v8;
        v31 = 2112;
        v32 = v3;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups aggregate consumer with dependencies homeUUID: %@ subscriptionProvider: %@ notificationCenter: %@ userDefaults: %@ homeManager: %@", &v21, 0x3Eu);
      }

      objc_autoreleasePoolPop(v12);
    }
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (id)roomForAllDestinationParentIdentifiers:(id)a3
{
  v36 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 count])
  {
    v5 = [(HMDHome *)self accessoriesWithUUIDs:v4];
    v6 = [(HMDHome *)self mediaSystemsWithUUIDs:v4];
    v7 = [v4 count];
    v8 = [v5 count];
    if (v7 == [v6 count] + v8)
    {
      v9 = [v5 firstObject];
      v10 = [v9 room];
      v11 = v10;
      if (v10)
      {
        v12 = v10;
      }

      else
      {
        v18 = [v6 firstObject];
        v12 = [v18 room];
      }

      v26[0] = MEMORY[0x277D85DD0];
      v26[1] = 3221225472;
      v26[2] = __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke;
      v26[3] = &unk_278681708;
      v19 = v12;
      v27 = v19;
      if ([v5 na_allObjectsPassTest:v26])
      {
        v24[0] = MEMORY[0x277D85DD0];
        v24[1] = 3221225472;
        v24[2] = __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke_2;
        v24[3] = &unk_278675410;
        v20 = v19;
        v25 = v20;
        if ([v6 na_allObjectsPassTest:v24])
        {
          v21 = v20;
        }

        else
        {
          v21 = 0;
        }

        v13 = v21;
      }

      else
      {
        v13 = 0;
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      v15 = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138544130;
        v29 = v17;
        v30 = 2112;
        v31 = v4;
        v32 = 2112;
        v33 = v5;
        v34 = 2112;
        v35 = v6;
        _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to find room due to missing destination parent identifiers: %@ found accessories: %@ found media systems: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v14);
      v13 = 0;
    }
  }

  else
  {
    v13 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v13;
}

uint64_t __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 room];
  v4 = [v3 uuid];
  v5 = [*(a1 + 32) uuid];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

uint64_t __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 room];
  v4 = [v3 uuid];
  v5 = [*(a1 + 32) uuid];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

- (id)roomForAccessoryUUID:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithUUID:a3];
  v4 = [v3 room];

  return v4;
}

- (id)sameRoomAccessoryUUIDsForDestinationControllerData:(id)a3 mediaGroupsAggregator:(id)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 parentIdentifier];
  v9 = [(HMDHome *)self roomForAccessoryUUID:v8];

  if (v9)
  {
    v10 = [(HMDHome *)self accessories];
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __84__HMDHome_sameRoomAccessoryUUIDsForDestinationControllerData_mediaGroupsAggregator___block_invoke;
    v19[3] = &unk_27866F8E8;
    v20 = v9;
    v11 = [v10 na_map:v19];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v6 parentIdentifier];
      *buf = 138543618;
      v22 = v15;
      v23 = 2112;
      v24 = v16;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to get available destinations due to no room for accessory uuid: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = MEMORY[0x277CBEBF8];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

id __84__HMDHome_sameRoomAccessoryUUIDsForDestinationControllerData_mediaGroupsAggregator___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 room];
  v5 = [v4 uuid];
  v6 = [*(a1 + 32) uuid];
  if ([v5 hmf_isEqualToUUID:v6])
  {
    v7 = [v3 uuid];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)eventSourceForMediaGroupsAggregator:(id)a3
{
  v3 = [(HMDHome *)self homeManager];
  v4 = [v3 currentEventSource];

  return v4;
}

- (id)participantDataTopicForAccessory:(id)a3 mediaGroupsAggregator:(id)a4
{
  v5 = MEMORY[0x277CD16F0];
  v6 = *MEMORY[0x277CCEA70];
  v7 = a3;
  v8 = [(HMDHome *)self uuid];
  v9 = [v7 uuid];

  v10 = [v5 topicFromSuffixID:v6 homeUUID:v8 accessoryUUID:v9];

  return v10;
}

- (void)configureMediaGroupsAggregator
{
  v51 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) == 0)
  {
    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543362;
      v32 = v22;
      _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v19);
  }

  else
  {
    v3 = [(HMDHome *)self uuid];
    v4 = [(HMDHome *)self homeManager];
    v5 = [v4 uuid];
    v30 = [(HMDHome *)self notificationCenter];
    v29 = [(HMDHome *)self primaryResidentChangeMonitor];
    v6 = [v4 eventForwarder];
    v7 = [v4 localAndRemoteSubscriptionProvider];
    v8 = [v4 eventStoreReadHandle];
    v9 = [(HMDHome *)self msgDispatcher];
    v28 = v9;
    if (v3 && v30 && v29 && v6 && v7 && v8 && v9)
    {
      v10 = [[HMDMediaGroupsAggregatorBackupSender alloc] initWithIdentifier:v3];
      v24 = [[HMDMediaGroupsLocalDataStorage alloc] initWithIdentifier:v3 backupSender:v10];
      v11 = objc_alloc_init(HMDMediaGroupsAggregatorMessenger);
      v26 = v5;
      v12 = [[HMDMediaGroupsAggregator alloc] initWithIdentifier:v3 messenger:v11 eventForwarder:v6 subscriptionProvider:v7 eventStoreReadHandle:v8 groupsLocalDataStorage:v24];
      [(HMDMediaGroupsAggregatorBackupSender *)v10 setDataSource:v24];
      [(HMDMediaGroupsLocalDataStorage *)v24 setDataSource:self];
      [(HMDMediaGroupsAggregatorMessenger *)v11 setDataSource:self];
      [(HMDMediaGroupsAggregatorMessenger *)v11 setDelegate:v12];
      [(HMDMediaGroupsAggregator *)v12 setDataSource:self];
      [(HMDHome *)self setMediaGroupsAggregator:v12];
      v13 = [(HMDHome *)self mediaGroupsAggregator];
      v14 = self;
      v15 = v28;
      [v13 configureWithHome:v14 messageDispatcher:v28 notificationCenter:v30 primaryResidentChangeMonitor:v29];

      v5 = v26;
    }

    else
    {
      v27 = v8;
      context = objc_autoreleasePoolPush();
      v16 = self;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        v18 = HMFGetLogIdentifier();
        *buf = 138545666;
        v32 = v18;
        v33 = 2112;
        v34 = v3;
        v35 = 2112;
        v36 = v5;
        v37 = 2112;
        v38 = v30;
        v39 = 2112;
        v40 = v29;
        v41 = 2112;
        v42 = v6;
        v43 = 2112;
        v44 = v7;
        v45 = 2112;
        v46 = v27;
        v47 = 2112;
        v48 = v4;
        v49 = 2112;
        v50 = v28;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups aggregator with dependencies homeUUID: %@ homeManagerUUID: %@ notificationCenter: %@ primaryChangeMonitor: %@ eventForwarder: %@ subscriptionProvider: %@ eventStoreReadHandle: %@ homeManager: %@ message dispatcher: %@", buf, 0x66u);
      }

      objc_autoreleasePoolPop(context);
      v8 = v27;
      v15 = v28;
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)configureMediaGroupsUnconfiguredParticipantOnboardingManager
{
  v23 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", &v17, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

  else
  {
    v3 = [(HMDHome *)self uuid];
    v4 = [(HMDHome *)self notificationCenter];
    v5 = v4;
    if (v3 && v4)
    {
      v6 = [[HMDMediaGroupsUnconfiguredParticipantOnboardingManager alloc] initWithIdentifier:v3];
      [(HMDMediaGroupsUnconfiguredParticipantOnboardingManager *)v6 setDataSource:self];
      [(HMDHome *)self setMediaGroupsUnconfiguredParticipantOnboardingManager:v6];
      v7 = [(HMDHome *)self mediaGroupsUnconfiguredParticipantOnboardingManager];
      [v7 configureWithNotificationCenter:v5];
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        v17 = 138543874;
        v18 = v11;
        v19 = 2112;
        v20 = v3;
        v21 = 2112;
        v22 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups unconfigured participant onboarding manager with dependencies homeUUID: %@ notificationCenter: %@", &v17, 0x20u);
      }

      objc_autoreleasePoolPop(v8);
    }
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (id)receiverForParticipantAccessoryUUID:(id)a3 mediaGroupsLocalDataStorage:(id)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self homeManager];
  v9 = [v8 mediaGroupParticipantDataLocalStorage];
  v10 = [v9 groupsBackupReceiver];
  v11 = v10;
  if (v10)
  {
    v12 = v10;
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543874;
      v20 = v16;
      v21 = 2112;
      v22 = v8;
      v23 = 2112;
      v24 = v9;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to get groups backup receiver with homeManager: %@ participantStorage: %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

- (id)routerForParticipantAccessoryUUID:(id)a3 mediaGroupsLocalDataStorage:(id)a4
{
  v22 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  if (v10)
  {
    v11 = [v10 messageRouter];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = v6;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to get router for unknown accessory uuid: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v11;
}

- (void)mergeMediaDestinationsWithConsumer:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self appleMediaAccessories];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke;
  v11[3] = &unk_27867BBE0;
  v6 = v4;
  v12 = v6;
  [v5 na_each:v11];

  v7 = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke_2;
  v9[3] = &unk_27866F8C0;
  v10 = v6;
  v8 = v6;
  [v7 na_each:v9];
}

void __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestination:v6];
  }
}

void __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestination:v6];
  }
}

- (void)mergeMediaDestinationControllerDataWithConsumer:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self appleMediaAccessories];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __59__HMDHome_mergeMediaDestinationControllerDataWithConsumer___block_invoke;
  v7[3] = &unk_27867BBE0;
  v8 = v4;
  v6 = v4;
  [v5 na_each:v7];
}

void __59__HMDHome_mergeMediaDestinationControllerDataWithConsumer___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationControllerDataWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestinationControllerData:v6];
  }
}

- (void)mergeMediaGroupsAggregateDataWithConsumer:(id)a3
{
  v4 = a3;
  [(HMDHome *)self mergeMediaDestinationsWithConsumer:v4];
  [(HMDHome *)self mergeMediaDestinationControllerDataWithConsumer:v4];
  v6 = [(HMDHome *)self mediaSystemController];
  v5 = [v4 allMediaSystemData];

  [v6 mergeMediaSystemData:v5];
}

- (void)didUpdateAggregateDataForMediaGroupsAggregateConsumer:(id)a3
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Updating home graph due to updated media groups aggregate data", &v16, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  [(HMDHome *)v6 mergeMediaGroupsAggregateDataWithConsumer:v4];
  v9 = [(HMDHome *)v6 homeManager];
  if (v9)
  {
    v10 = [(HMDHome *)v6 uuid];
    [v9 updateGenerationCounterWithReason:@"HMDMediaGroupsAggregateConsumerDelegateUpdatedAggregateData" sourceUUID:v10 shouldNotifyClients:1];

    [v9 assistantSyncDataChanged:@"HMDMediaGroupsAggregateConsumerDelegateUpdatedAggregateData"];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = v6;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v16 = 138543362;
      v17 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Failed to update home graph for media groups due to no home manager", &v16, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (BOOL)isLocalPresenceSupported
{
  v2 = [(HMDHome *)self roomUUIDsSupportingLocalPresence];
  v3 = [v2 count] != 0;

  return v3;
}

- (HMDDevice)currentDevice
{
  v2 = +[HMDAppleAccountManager sharedManager];
  v3 = [v2 device];

  return v3;
}

- (HMFWiFiManager)wifiManager
{
  v2 = [(HMDHome *)self dataSource];
  v3 = [v2 wifiManager];

  return v3;
}

- (void)_handleFetchUniqueIdentifierForBundleIdentifier:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CCFE48]];
  if (v5)
  {
    v18 = 0;
    v6 = [HMDApplicationInfo clientIdentifierSaltForBundleIdentifier:v5 error:&v18];
    v7 = v18;
    if (v6)
    {
      v8 = MEMORY[0x277CCAD78];
      v9 = [(HMDHome *)self uuid];
      v10 = [v8 hm_deriveUUIDFromBaseUUID:v9 identifierSalt:v6];

      v19 = *MEMORY[0x277CD0570];
      v20 = v10;
      v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v20 forKeys:&v19 count:1];
      [v4 respondWithPayload:v11];
    }

    else
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543874;
        v22 = v16;
        v23 = 2112;
        v24 = v5;
        v25 = 2112;
        v26 = v7;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Failed to get client identifier salt for bundle identifier: %@, error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
      if (v7)
      {
        [v4 respondWithError:v7];
        goto LABEL_10;
      }

      v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v10];
    }

LABEL_10:
    goto LABEL_11;
  }

  v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2 description:0 reason:@"Payload is missing the bundle identifier." suggestion:0];
  [v4 respondWithError:v12];

LABEL_11:
  v17 = *MEMORY[0x277D85DE8];
}

- (void)configureMediaGroupObjects
{
  v11 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) == 0)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v7;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v8 = *MEMORY[0x277D85DE8];
  }

  else
  {
    [(HMDHome *)self configureMediaGroupsUnconfiguredParticipantOnboardingManager];
    [(HMDHome *)self configureMediaGroupsAggregator];
    v3 = *MEMORY[0x277D85DE8];

    [(HMDHome *)self configureMediaGroupsAggregateConsumer];
  }
}

- (id)accessoriesWithUUIDs:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self accessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __32__HMDHome_accessoriesWithUUIDs___block_invoke;
  v9[3] = &unk_278681708;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_filter:v9];

  return v7;
}

uint64_t __32__HMDHome_accessoriesWithUUIDs___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 uuid];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (void)configureNaturalLightingWithDemoModeEnabled:(BOOL)a3
{
  v5 = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __55__HMDHome_configureNaturalLightingWithDemoModeEnabled___block_invoke;
  v6[3] = &unk_278688650;
  v6[4] = self;
  v7 = a3;
  dispatch_async(v5, v6);
}

void __55__HMDHome_configureNaturalLightingWithDemoModeEnabled___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) localCapabilitiesDataSource];
  if ([v2 isResidentCapable])
  {
  }

  else
  {
    v3 = *(a1 + 40);

    if ((v3 & 1) == 0)
    {
      return;
    }
  }

  v4 = [[HMDHomeNaturalLightingContextUpdater alloc] initWithHome:*(a1 + 32) demoModeEnabled:*(a1 + 40)];
  [*(a1 + 32) setNaturalLightingContextUpdater:v4];

  v5 = [*(a1 + 32) naturalLightingContextUpdater];
  [v5 configure];
}

- (void)configureMediaDestinationControllersForAccessories:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [v4 na_map:&__block_literal_global_910];

  [v6 na_each:&__block_literal_global_913];
}

void *__62__HMDHome_configureMediaDestinationControllersForAccessories___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)configureMediaSystems
{
  v6 = [(HMDHome *)self mediaSystemController];
  v3 = [(HMDHome *)self workQueue];
  v4 = [(HMDHome *)self msgDispatcher];
  v5 = [(HMDHome *)self notificationCenter];
  [v6 configure:self delegate:self dataSource:self queue:v3 messageDispatcher:v4 notificationCenter:v5];
}

- (BOOL)hasSiriEndpointAccessory
{
  v17 = *MEMORY[0x277D85DE8];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v3)
  {
    v4 = *v13;
    while (2)
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v13 != v4)
        {
          objc_enumerationMutation(v2);
        }

        v6 = *(*(&v12 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v7 = v6;
        }

        else
        {
          v7 = 0;
        }

        v8 = v7;

        if (v8)
        {
          v9 = [v8 siriEndpointProfile];

          if (v9)
          {
            LOBYTE(v3) = 1;
            goto LABEL_15;
          }
        }
      }

      v3 = [v2 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v3)
      {
        continue;
      }

      break;
    }
  }

LABEL_15:

  v10 = *MEMORY[0x277D85DE8];
  return v3;
}

- (BOOL)supportsDeviceWithCapabilities:(id)a3
{
  v4 = a3;
  if (-[HMDHome hasSiriEndpointAccessory](self, "hasSiriEndpointAccessory") && ![v4 supportsSiriEndpointSetup])
  {
    v5 = 0;
  }

  else
  {
    v5 = [v4 supportsResidentFirstAccessoryCommunication];
  }

  return v5;
}

- (void)registerForDeviceWithCapabilities
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v10 = 138543362;
    v11 = v6;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Registering for device with capabilities and confirming resident device", &v10, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v7 = [(HMDHome *)v4 residentDeviceManager];
  [v7 addDataSource:v4];

  v8 = [(HMDHome *)v4 residentDeviceManager];
  [v8 confirmWithCompletionHandler:0];

  v9 = *MEMORY[0x277D85DE8];
}

- (id)eventRouterServerDiagnosticInfo
{
  v2 = [(HMDHome *)self remoteEventRouterServer];
  v3 = [v2 diagnosticInfo];

  return v3;
}

- (void)createRemoteEventRouterServerIfNeeded
{
  v65 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self homeManager];
  v4 = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  v7 = [(HMDHome *)self remoteEventRouterServer];
  v8 = [v7 residentModeUUID];

  if (v6)
  {
    v9 = [(HMDHome *)self localCapabilitiesDataSource];
    if ([v9 isResidentCapable])
    {
      if (!v8)
      {

LABEL_14:
        v18 = [v6 uuid];
        v19 = [v8 isEqual:v18];

        if ((v19 & 1) == 0)
        {
          v20 = objc_autoreleasePoolPush();
          v21 = self;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
          {
            v23 = HMFGetLogIdentifier();
            v24 = [v6 uuid];
            *buf = 138543874;
            v58 = v23;
            v59 = 2112;
            v60 = v8;
            v61 = 2112;
            v62 = v24;
            _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Overwriting stale remote event router server with uuid: %@ to current accessory uuid: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v20);
        }

        v25 = objc_autoreleasePoolPush();
        v26 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          *buf = 138543618;
          v58 = v28;
          v59 = 2112;
          v60 = v6;
          _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Creating remote event router server with current accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v25);
        v29 = [v3 localOnlySubscriptionProvider];
        if (objc_opt_respondsToSelector())
        {
          v30 = [(HMDHome *)v26 serverDelegatingEventRouter];
          v31 = [v29 synchronousSubscriptionProvider];
          [v30 registerSubRouter:v31];

          v32 = [(HMDHome *)v26 serverDelegatingEventRouter];

          v29 = v32;
        }

        v54 = v29;
        v55 = v8;
        v33 = [(HMDHome *)v26 remoteEventRouterClientController];
        v34 = [v33 residentDelegatingEventRouter];

        if (v34)
        {
          v35 = [(HMDHome *)v26 serverDelegatingEventRouter];
          [v35 registerSubRouter:v34];
        }

        v53 = v34;
        v51 = [HMDRemoteEventRouterServer alloc];
        v50 = [(HMDHome *)v26 uuid];
        v36 = [v6 uuid];
        [v3 workQueue];
        v37 = v52 = v6;
        v38 = [(HMDHome *)v26 msgDispatcher];
        v39 = [(HMDHome *)v26 notificationCenter];
        v40 = [(HMDHome *)v26 serverDelegatingEventRouter];
        v41 = [v3 eventForwarder];
        v42 = [v3 eventStoreReadHandle];
        v43 = [(HMDRemoteEventRouterServer *)v51 initWithPrimaryModeUUID:v50 residentModeUUID:v36 queue:v37 messageDispatcher:v38 dataSource:v26 notificationCenter:v39 requestMessageName:@"RemoteEventRouterRequestMessage" updateMessageName:@"RemoteEventRouterUpdateMessageName" multiHopFetchResponseMessageName:@"RER.MHF.ResponseMessageName" subscriptionProvider:v40 registrationEventRouter:v41 storeReadHandle:v42];
        [(HMDHome *)v26 setRemoteEventRouterServer:v43];

        v6 = v52;
        v44 = [HMDUserMessagePolicy userMessagePolicyWithHome:v26 userPrivilege:0 remoteAccessRequired:0];
        v45 = isTVOSDevice();
        v46 = [(HMDHome *)v26 remoteEventRouterServer];
        v47 = [(HMDHome *)v26 isCurrentDevicePrimaryResident];
        v56 = v44;
        v48 = [MEMORY[0x277CBEA60] arrayWithObjects:&v56 count:1];
        [v46 configureWithHome:v26 isPrimaryResident:v47 isResidentEventProviding:v45 additionalPolicies:v48];

        v8 = v55;
        goto LABEL_25;
      }

      v10 = [v6 uuid];
      v11 = [v8 isEqual:v10];

      if ((v11 & 1) == 0)
      {
        goto LABEL_14;
      }
    }

    else
    {
    }
  }

  v12 = objc_autoreleasePoolPush();
  v13 = self;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    v16 = [(HMDHome *)v13 localCapabilitiesDataSource];
    [v16 isResidentCapable];
    v17 = HMFBooleanToString();
    *buf = 138544130;
    v58 = v15;
    v59 = 2112;
    v60 = v6;
    v61 = 2112;
    v62 = v17;
    v63 = 2112;
    v64 = v8;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@Cannot create remote event router server with currentAccessory: %@ isResidentCapable: %@ serverAccessoryUUID: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v12);
LABEL_25:

  v49 = *MEMORY[0x277D85DE8];
}

- (void)configureRemoteEventRouterClientControllerForAccessories:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          v12 = [v9 isCurrentAccessory];
          v13 = [(HMDHome *)self remoteEventRouterClientController];
          v14 = [v9 uuid];
          if (v12)
          {
            [v13 updateCurrentAccessoryUUID:v14];
          }

          else
          {
            [v13 createResidentRouterForAccessoryUUID:v14];
          }
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)handlePrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __89__HMDHome_handlePrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v4, block);
}

void __89__HMDHome_handlePrimaryResidentChangeMonitorConfirmedDeviceIdentifierChangeNotification___block_invoke(uint64_t a1)
{
  v14 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) homeManager];
  v3 = [*(a1 + 32) currentDevice];

  if (v3)
  {
    [*(a1 + 32) handlePrimaryResidentChanged];
    v4 = [v2 currentAccessorySetupMetricDispatcher];
    [v4 markSetupEndStage:14 error:0];
    v5 = [*(a1 + 32) remoteEventRouterServer];

    if (v5)
    {
      [v4 markSetupBeginStage:15 error:0];
    }

    else
    {
      v6 = objc_autoreleasePoolPush();
      v7 = *(a1 + 32);
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = HMFGetLogIdentifier();
        v12 = 138543362;
        v13 = v9;
        _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Remote event router server does not exist.", &v12, 0xCu);
      }

      objc_autoreleasePoolPop(v6);
    }
  }

  v10 = [v2 accessorySetupMetricDispatchersForHome:*(a1 + 32)];
  [v10 na_each:&__block_literal_global_901];

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handlePrimaryResidentDidBecomeOtherDevice
{
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = [(HMDHome *)self fetchedAccessorySettingsSubscriber];
  [v4 unsubscribeToAllAccessories];

  [(HMDHome *)self updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange];
  v5 = [(HMDHome *)self homeActivityStateManager];
  [v5 handlePrimaryResidentDidBecomeOtherDevice];

  [(HMDHome *)self handlePrimaryResidentDidBecomeOtherDeviceSwiftExtensions];
}

- (void)_handlePrimaryResidentDidBecomeCurrentDevice
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  [(HMDHome *)self subscribeToAccessoryLanguageSettingsIfNeeded];
  [(HMDHome *)self updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange];
  v4 = objc_autoreleasePoolPush();
  v5 = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    *buf = 138543362;
    v11 = v7;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Current device became primary resident. Setting up operational fabric data", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
  v9 = 0;
  [(HMDHome *)v5 setUpOperationalFabricDataWithError:&v9];
  [(HMDHome *)v5 handlePrimaryResidentDidBecomeCurrentDeviceSwiftExtensions];
  v8 = *MEMORY[0x277D85DE8];
}

- (void)subscribeToAccessoryLanguageSettingsIfNeeded
{
  if (a1 && [a1 isCurrentDevicePrimaryResident])
  {
    v4 = [a1 fetchedAccessorySettingsSubscriber];
    v2 = [a1 appleMediaAccessories];
    v3 = [v2 na_map:&__block_literal_global_904];
    [v4 subscribeToSettingsForAccessoryUUIDs:v3];
  }
}

id __55__HMDHome_subscribeToAccessoryLanguageSettingsIfNeeded__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 isHomePod])
  {
    v3 = [v2 uuid];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)handlePrimaryResidentIsCurrentDeviceChangeNotification:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __66__HMDHome_handlePrimaryResidentIsCurrentDeviceChangeNotification___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v4, block);
}

uint64_t __66__HMDHome_handlePrimaryResidentIsCurrentDeviceChangeNotification___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) isCurrentDevicePrimaryResident];
  v3 = *(a1 + 32);
  if (v2)
  {

    return [v3 _handlePrimaryResidentDidBecomeCurrentDevice];
  }

  else
  {

    return [v3 _handlePrimaryResidentDidBecomeOtherDevice];
  }
}

- (void)createAndConfigureBulletinManagers
{
  v60 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 availableResidentDevices];
  -[HMDHome setBulletinNotificationsSupported:](self, "setBulletinNotificationsSupported:", [v4 count] != 0);

  if (+[HMDDeviceCapabilities supportsBulletinBoard](HMDDeviceCapabilities, "supportsBulletinBoard") || (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 isResidentCapable], v5, (v6 & 1) != 0))
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v59 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Creating and Configuring Bulletin Notification Managers...", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v55 = [[HMDPresenceNotificationConditionHandler alloc] initWithHome:v8];
    v54 = [[HMDTimePeriodNotificationConditionHandler alloc] initWithHome:v8];
    v11 = [HMDNotificationConditionEvaluator alloc];
    v12 = MEMORY[0x277CBEB98];
    v57[0] = v55;
    v57[1] = v54;
    v13 = [MEMORY[0x277CBEA60] arrayWithObjects:v57 count:2];
    v14 = [v12 setWithArray:v13];
    v15 = [(HMDNotificationConditionEvaluator *)v11 initWithConditionHandlers:v14];

    v16 = [HMDAccessoryBulletinNotificationManager alloc];
    v17 = [(HMDHome *)v8 workQueue];
    v18 = +[HMDAppleAccountManager sharedManager];
    v19 = [MEMORY[0x277CCAB98] defaultCenter];
    v53 = v15;
    v20 = [(HMDAccessoryBulletinNotificationManager *)v16 initWithHome:v8 workQueue:v17 accountManager:v18 evaluator:v15 notificationCenter:v19];
    [(HMDHome *)v8 setAccessoryBulletinNotificationManager:v20];

    v21 = [(HMDHome *)v8 accessoryBulletinNotificationManager];
    v22 = +[HMDDeviceCapabilities deviceCapabilities];
    [v21 configureWithDeviceIsResidentCapable:{objc_msgSend(v22, "isResidentCapable")}];

    v52 = [[HMDCameraSignificantEventFaceClassificationResolver alloc] initWithHome:v8];
    v23 = [HMDDoorbellPressTracker alloc];
    v24 = [(HMDHome *)v8 workQueue];
    v25 = [(HMDHome *)v8 notificationCenter];
    v51 = [(HMDDoorbellPressTracker *)v23 initWithWorkQueue:v24 notificationCenter:v25];

    v26 = [HMDCameraBulletinNotificationManager alloc];
    v27 = [(HMDHome *)v8 workQueue];
    v28 = [(HMDHome *)v8 msgDispatcher];
    v29 = +[HMDAppleAccountManager sharedManager];
    v30 = [MEMORY[0x277CCAB98] defaultCenter];
    v31 = [(HMDCameraBulletinNotificationManager *)v26 initWithHome:v8 workQueue:v27 messageDispatcher:v28 accountManager:v29 faceClassificationResolver:v52 doorbellPressTracker:v51 evaluator:v15 notificationCenter:v30];
    [(HMDHome *)v8 setCameraBulletinNotificationManager:v31];

    v32 = [(HMDHome *)v8 cameraBulletinNotificationManager];
    v33 = +[HMDDeviceCapabilities deviceCapabilities];
    [v32 configureWithDeviceIsResidentCapable:{objc_msgSend(v33, "isResidentCapable")}];

    v34 = [HMDAudioAnalysisBulletinNotificationManager alloc];
    v35 = [(HMDHome *)v8 workQueue];
    v36 = [(HMDHome *)v8 msgDispatcher];
    v37 = +[HMDAppleAccountManager sharedManager];
    v38 = [HMDNotificationConditionEvaluator alloc];
    v39 = MEMORY[0x277CBEB98];
    v56[0] = v55;
    v56[1] = v54;
    v40 = [MEMORY[0x277CBEA60] arrayWithObjects:v56 count:2];
    v41 = [v39 setWithArray:v40];
    v42 = [(HMDNotificationConditionEvaluator *)v38 initWithConditionHandlers:v41];
    v43 = [MEMORY[0x277CCAB98] defaultCenter];
    v44 = [(HMDAudioAnalysisBulletinNotificationManager *)v34 initWithHome:v8 workQueue:v35 messageDispatcher:v36 accountManager:v37 evaluator:v42 notificationCenter:v43];
    [(HMDHome *)v8 setAudioAnalysisBulletinNotificationManager:v44];

    v45 = [(HMDHome *)v8 audioAnalysisBulletinNotificationManager];
    [v45 configure];
  }

  else
  {
    v46 = objc_autoreleasePoolPush();
    v47 = self;
    v48 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
    {
      v49 = HMFGetLogIdentifier();
      *buf = 138543362;
      v59 = v49;
      _os_log_impl(&dword_229538000, v48, OS_LOG_TYPE_INFO, "%{public}@Not creating bulletin notification managers as bulletins are not supported on this non-resident capable device", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v46);
  }

  v50 = *MEMORY[0x277D85DE8];
}

- (void)configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:(id)a3 accessories:(id)a4 uncommittedTransactions:(id)a5
{
  v53 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    *buf = 138543362;
    v50 = v14;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Configuring after accessories configuration tracker notifications", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v11);
  v15 = [(HMDHome *)v12 workQueue];
  dispatch_assert_queue_V2(v15);

  [(HMDHome *)v12 configureBulletinNotification];
  [(HMDHome *)v12 _evaluateNetworkProtectionAndRouterManagement];
  if (v8)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = v12;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v50 = v19;
      v51 = 2112;
      v52 = v8;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Setting up media session for current accessory during configure - %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [(HMDHome *)v17 _addMediaSessionForCurrentAccessory:v8];
    v21 = v8;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v23 = v21;
    }

    else
    {
      v23 = 0;
    }

    v24 = v23;

    if (isKindOfClass)
    {
      [v21 configureSensors];
    }
  }

  v25 = [(HMDHome *)v12 homeManager];
  v26 = [(HMDHome *)v12 localCapabilitiesDataSource];
  v27 = [v26 isResidentCapable];

  if (v27)
  {
    v28 = [HMDFetchedAccessorySettingsSubscriber alloc];
    v29 = [(HMDHome *)v12 workQueue];
    v30 = [v25 localAndRemoteSubscriptionProvider];
    v48 = @"root.siri.availableLanguages";
    v31 = [MEMORY[0x277CBEA60] arrayWithObjects:&v48 count:1];
    v32 = [(HMDHome *)v12 uuid];
    v33 = [(HMDFetchedAccessorySettingsSubscriber *)v28 initWithWorkQueue:v29 subscriptionProvider:v30 keyPaths:v31 homeUUID:v32];
    [(HMDHome *)v12 setFetchedAccessorySettingsSubscriber:v33];

    v34 = [(HMDHome *)v12 fetchedAccessorySettingsSubscriber];
    [v34 setDelegate:v12];

    [(HMDHome *)v12 subscribeToAccessoryLanguageSettingsIfNeeded];
  }

  v35 = [HMDHomeMediaStateSubscriber alloc];
  v36 = [(HMDHome *)v12 uuid];
  v37 = [(HMDHome *)v12 workQueue];
  v38 = [v25 localAndRemoteSubscriptionProvider];
  v39 = [v25 localOnlySubscriptionProvider];
  v40 = [(HMDHomeMediaStateSubscriber *)v35 initWithHomeUUID:v36 workQueue:v37 dataSource:v12 remoteSubscriptionProvider:v38 localSubscriptionProvider:v39];
  [(HMDHome *)v12 setMediaStateSubscriber:v40];

  v41 = [(HMDHome *)v12 notificationRegistrationsForAppleMediaAccessories];
  v42 = [v41 count];

  if (v42)
  {
    v43 = [(HMDHome *)v12 mediaStateSubscriber];
    [v43 subscribeForAppleMediaStateWithSubscriptionToken:@"HMDHomeClientMediaStateRegistrationToken"];
  }

  v44 = [(HMDHome *)v12 mediaStateSubscriber];
  [v44 localSubscribeForAppleMediaState];

  [(HMDHome *)v12 configureMediaSystems];
  [(HMDHome *)v12 configureMediaDestinationControllersForAccessories:v9];
  if (isInternalBuild() && ((_os_feature_enabled_impl() & 1) != 0 || _os_feature_enabled_impl()))
  {
    v45 = [(HMDHome *)v12 homeIntelligenceActivityLogger];
    [v45 configure];
  }

  [(HMDHome *)v12 registerForDeviceWithCapabilities];
  [(HMDHome *)v12 configureMediaGroupObjects];
  v46 = [(HMDHome *)v12 accessories];
  [(HMDHome *)v12 configureRemoteEventRouterClientControllerForAccessories:v46];

  v47 = *MEMORY[0x277D85DE8];
}

- (BOOL)configureWithHomeManager:(id)a3 accessoriesPresent:(id)a4 uncommittedTransactions:(id)a5 source:(unint64_t)a6
{
  v540 = *MEMORY[0x277D85DE8];
  v436 = a3;
  v448 = a4;
  v432 = a5;
  HMFUptime();
  v10 = v9;
  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = [(HMDHome *)v12 uuid];
    [(HMDHome *)v12 locationServicesEnabled];
    v16 = HMFBooleanToString();
    *buf = 138545410;
    v500 = v14;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configuring home with location service enabled";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"start";
    v509 = 2114;
    v510 = @"homeUUID";
    v511 = 2112;
    v512 = v15;
    v513 = 2114;
    v514 = @"status";
    v515 = 2112;
    v516 = v16;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v11);
  v17 = [MEMORY[0x277D17DE8] sharedInstance];
  v18 = objc_alloc(MEMORY[0x277D17DF8]);
  v19 = [(HMDHome *)v12 uuid];
  [(HMDHome *)v12 locationServicesEnabled];
  v20 = HMFBooleanToString();
  v21 = HMDTaggedLoggingCreateDictionary();
  v22 = [v18 initWithTag:@"homeConfigureStart" data:{v21, @"state", @"start", @"homeUUID", v19, @"status", v20}];
  v23 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v17 submitTaggedEvent:v22 processorList:v23];

  [(HMDHome *)v12 setHomeManager:v436];
  v24 = [v436 messageDispatcher];
  [(HMDHome *)v12 setMsgDispatcher:v24];

  v25 = [v436 accessoryBrowser];
  [(HMDHome *)v12 setAccessoryBrowser:v25];

  v26 = [v436 metricsManager];
  v27 = [v26 logEventSubmitter];
  logEventSubmitter = v12->_logEventSubmitter;
  v12->_logEventSubmitter = v27;

  if (!v12->_metricsDispatcher)
  {
    v29 = [(HMDHome *)v12 dataSource];
    uuid = v12->_uuid;
    v31 = [(HMDHome *)v12 logEventSubmitter];
    v32 = [v29 makeHomeMetricsDispatcherWithIdentifier:uuid logEventSubmitter:v31];
    metricsDispatcher = v12->_metricsDispatcher;
    v12->_metricsDispatcher = v32;
  }

  v34 = [HMDHomePrimaryResidentMessagingHandler alloc];
  v35 = [(HMDHome *)v12 msgDispatcher];
  v36 = [(HMDHome *)v12 uuid];
  v37 = [(HMDHome *)v12 residentDeviceManager];
  v38 = [(HMDHomePrimaryResidentMessagingHandler *)v34 initWithMessageDispatcher:v35 homeUUID:v36 residentDeviceManager:v37];
  primaryResidentMessagingHandler = v12->_primaryResidentMessagingHandler;
  v12->_primaryResidentMessagingHandler = v38;

  v40 = [v436 messageDispatcher];
  v41 = [v40 secureRemoteTransport];
  v42 = [(HMDHome *)v12 primaryResidentMessagingHandler];
  [v41 registerHomeMessageDestinationHandler:v42];

  if ([(HMDHome *)v12 isOwnerUser])
  {
    v12->_isUpdatedToHH2 = [(HMDHome *)v12 isThisHomeMigratedToHH2];
  }

  v43 = [MEMORY[0x277CD1F00] authWithValue:1];
  presenceAuthStatus = v12->_presenceAuthStatus;
  v12->_presenceAuthStatus = v43;

  v45 = objc_autoreleasePoolPush();
  v46 = v12;
  v47 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
  {
    v48 = HMFGetLogIdentifier();
    v49 = v12->_presenceAuthStatus;
    *buf = 138543618;
    v500 = v48;
    v501 = 2112;
    v502 = v49;
    _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Home Presence Auth Status : [%@]", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v45);
  [(HMDHome *)v46 _readLocalHomeKeyMiscInfo];
  v50 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:8 options:7.0];
  homeLocationTimer = v46->_homeLocationTimer;
  v46->_homeLocationTimer = v50;

  [(HMFTimer *)v46->_homeLocationTimer setDelegateQueue:v46->_workQueue];
  [(HMFTimer *)v46->_homeLocationTimer setDelegate:v46];
  v52 = [MEMORY[0x277D0F8D0] sharedPreferences];
  v53 = [v52 preferenceForKey:@"accessoryReachabilityCoalescePeriod"];
  v435 = [v53 numberValue];

  LODWORD(v52) = [v435 unsignedIntValue];
  v54 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:0 options:v52];
  accessoryReachabilityUpdatesTimer = v46->_accessoryReachabilityUpdatesTimer;
  v46->_accessoryReachabilityUpdatesTimer = v54;

  [(HMFTimer *)v46->_accessoryReachabilityUpdatesTimer setDelegate:v46];
  [(HMFTimer *)v46->_accessoryReachabilityUpdatesTimer setDelegateQueue:v46->_workQueue];
  v56 = [(HMDHome *)v46 roomForEntireHome];
  v57 = [(HMDHome *)v46 msgDispatcher];
  v58 = [(HMDHome *)v46 workQueue];
  [v56 configure:v57 queue:v58];

  v59 = [(HMDHome *)v46 periodicReader];
  [v59 configure:v46];

  v60 = [(HMDHome *)v46 presenceMonitor];
  v61 = [(HMDHome *)v46 msgDispatcher];
  [v60 configure:v46 messageDispatcher:v61];

  v62 = [(HMDHome *)v46 featuresDataSource];
  LOBYTE(v61) = [v62 isUserActivityStateDetectionFeatureEnabled];

  if ((v61 & 1) == 0)
  {
    v63 = [(HMDHome *)v46 presenceFeeder];
    v64 = [(HMDHome *)v46 msgDispatcher];
    [v63 configure:v46 messageDispatcher:v64];

    v65 = objc_autoreleasePoolPush();
    v66 = v46;
    v67 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v67, OS_LOG_TYPE_INFO))
    {
      v68 = HMFGetLogIdentifier();
      v69 = [(HMDHome *)v66 presenceFeeder];
      *buf = 138543618;
      v500 = v68;
      v501 = 2112;
      v502 = v69;
      _os_log_impl(&dword_229538000, v67, OS_LOG_TYPE_INFO, "%{public}@Configured presenceFeeder: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v65);
  }

  v70 = [(HMDHome *)v46 homeLocationHandler];
  v71 = [(HMDHome *)v46 workQueue];
  v72 = [(HMDHome *)v46 msgDispatcher];
  [v70 configure:v46 queue:v71 messageDispatcher:v72];

  v73 = [(HMDHome *)v46 homeReprovisionHandler];
  v74 = [(HMDHome *)v46 workQueue];
  v75 = [(HMDHome *)v46 msgDispatcher];
  [v73 configure:v46 queue:v74 messageDispatcher:v75];

  v76 = [(HMDHome *)v46 sharedHomeUpdateHandler];
  [v76 registerForMessages];

  v77 = [(HMDHome *)v46 reachabilityChangedLogEventManager];
  [v77 configure];

  [(HMDHome *)v46 updateHomeLocation];
  v78 = [(HMDHome *)v46 featuresDataSource];
  LODWORD(v74) = [v78 isStateSyncEnabled];

  if (v74)
  {
    v79 = [(HMDHome *)v46 stateSyncManager];
    [v79 configure];
  }

  v80 = [(HMDHome *)v46 residentDeviceManager];
  v81 = +[HMDMessageDispatcher defaultDispatcher];
  [v80 configureWithHome:v46 messageDispatcher:v81];

  v82 = [(HMDHome *)v46 residentDeviceManager];
  [v82 setDelegate:v46];

  v83 = [(HMDHome *)v46 primaryResidentChangeMonitor];
  [v83 configureWithHome:v46];

  [(HMDHome *)v46 _purgeResidentUsers];
  if ([(HMDHome *)v46 isOwnerUser])
  {
    v84 = [(HMDHome *)v46 primaryResident];
    v85 = [v84 device];
    v86 = [v85 isCurrentDevice];

    v87 = [(HMDHome *)v46 accessoryBrowser];
    [v87 setQOS:v86];
  }

  v88 = [(HMDHome *)v46 name];
  v89 = [(HMDHome *)v46 addName:v88];

  v90 = [(HMDHome *)v46 roomForEntireHome];
  v91 = [v90 name];
  v92 = [(HMDHome *)v46 addName:v91];

  v93 = [(HMDHome *)v46 notificationRegistrations];
  LOBYTE(v91) = [v93 count] == 0;

  if ((v91 & 1) == 0)
  {
    v497 = 0u;
    v498 = 0u;
    v495 = 0u;
    v496 = 0u;
    v94 = [(HMDHome *)v46 mediaSessions];
    v95 = [v94 countByEnumeratingWithState:&v495 objects:v539 count:16];
    if (v95)
    {
      v96 = *v496;
      do
      {
        for (i = 0; i != v95; ++i)
        {
          if (*v496 != v96)
          {
            objc_enumerationMutation(v94);
          }

          [*(*(&v495 + 1) + 8 * i) registerForSessionUpdates:1];
        }

        v95 = [v94 countByEnumeratingWithState:&v495 objects:v539 count:16];
      }

      while (v95);
    }
  }

  group = dispatch_group_create();
  [(HMDHome *)v46 createAndConfigureBulletinManagers];
  v98 = [(HMDHome *)v46 accessories];
  v445 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v98, "count")}];
  HMFUptime();
  v100 = v99;
  v101 = objc_autoreleasePoolPush();
  v102 = v46;
  v103 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v103, OS_LOG_TYPE_DEBUG))
  {
    v104 = HMFGetLogIdentifier();
    v105 = [(HMDHome *)v102 uuid];
    *buf = 138544898;
    v500 = v104;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configuring accessories";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfigureAccessories";
    v509 = 2114;
    v510 = @"homeUUID";
    v511 = 2112;
    v512 = v105;
    _os_log_impl(&dword_229538000, v103, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v101);
  v106 = [MEMORY[0x277D17DE8] sharedInstance];
  v107 = objc_alloc(MEMORY[0x277D17DF8]);
  v108 = [(HMDHome *)v102 uuid];
  v109 = HMDTaggedLoggingCreateDictionary();
  v110 = [v107 initWithTag:@"homeConfigureStart" data:{v109, @"state", @"homeConfigureAccessories", @"homeUUID", v108}];
  v111 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v106 submitTaggedEvent:v110 processorList:v111];

  v493 = 0u;
  v494 = 0u;
  v491 = 0u;
  v492 = 0u;
  obj = v98;
  v112 = [obj countByEnumeratingWithState:&v491 objects:v538 count:16];
  if (v112)
  {
    v442 = 0;
    v450 = *v492;
    do
    {
      for (j = 0; j != v112; ++j)
      {
        if (*v492 != v450)
        {
          objc_enumerationMutation(obj);
        }

        v114 = *(*(&v491 + 1) + 8 * j);
        v115 = objc_autoreleasePoolPush();
        v116 = v114;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v117 = v116;
        }

        else
        {
          v117 = 0;
        }

        v118 = v117;

        [v118 setDataSource:v102];
        v119 = v116;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v120 = v119;
        }

        else
        {
          v120 = 0;
        }

        v121 = v120;

        if (v121)
        {
          if ([v121 isPrimary])
          {
            v122 = [v121 identifier];
            v123 = [v121 supportedTransports];
            v124 = [v121 setupHash];
            [(HMDHome *)v102 _registerPairedAccessory:v122 transports:v123 setupHash:v124];
          }

          [v445 addObject:v121];
        }

        v125 = v119;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v126 = v125;
        }

        else
        {
          v126 = 0;
        }

        v127 = v126;

        if (v127)
        {
          if (v118)
          {
            v128 = [(HMDHome *)v102 capabilitiesAggregator];
            v129 = [v118 uuid];
            [v128 didAddAccessory:v129];
          }

          if ([v118 isCurrentAccessory])
          {
            v130 = v118;

            v442 = v130;
          }

          v131 = [v127 identifier];
          -[HMDHome _registerPairedAccessory:transports:setupHash:](v102, "_registerPairedAccessory:transports:setupHash:", v131, [v127 supportedTransports], 0);
        }

        v132 = [(HMDHome *)v102 msgDispatcher];
        [v125 configureWithHome:v102 msgDispatcher:v132 configurationTracker:group initialConfiguration:1];

        v133 = [v125 uuid];
        v134 = [v133 UUIDString];
        [v448 addObject:v134];

        objc_autoreleasePoolPop(v115);
      }

      v112 = [obj countByEnumeratingWithState:&v491 objects:v538 count:16];
    }

    while (v112);
  }

  else
  {
    v442 = 0;
  }

  v135 = objc_autoreleasePoolPush();
  v136 = v102;
  v137 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v137, OS_LOG_TYPE_INFO))
  {
    v138 = HMFGetLogIdentifier();
    v139 = MEMORY[0x277CCACA8];
    HMFUptime();
    v141 = [v139 stringWithFormat:@"%.3f", v140 - v100];
    v142 = [(HMDHome *)v136 uuid];
    v143 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(obj, "count")}];
    *buf = 138545922;
    v500 = v138;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configured accessories";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfiguredAccessories";
    v509 = 2114;
    v510 = @"duration";
    v511 = 2112;
    v512 = v141;
    v513 = 2114;
    v514 = @"homeUUID";
    v515 = 2112;
    v516 = v142;
    v517 = 2114;
    v518 = @"accessoriesCount";
    v519 = 2112;
    v520 = v143;
    _os_log_impl(&dword_229538000, v137, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x70u);
  }

  objc_autoreleasePoolPop(v135);
  v144 = [MEMORY[0x277D17DE8] sharedInstance];
  v145 = objc_alloc(MEMORY[0x277D17DF8]);
  v146 = MEMORY[0x277CCACA8];
  HMFUptime();
  v148 = [v146 stringWithFormat:@"%.3f", v147 - v100];
  v149 = [(HMDHome *)v136 uuid];
  v150 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(obj, "count")}];
  v151 = HMDTaggedLoggingCreateDictionary();
  v152 = [v145 initWithTag:@"homeConfigureStart" data:{v151, @"state", @"homeConfiguredAccessories", @"duration", v148, @"homeUUID", v149, @"accessoriesCount", v150}];
  v153 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v144 submitTaggedEvent:v152 processorList:v153];

  HMFUptime();
  v155 = v154;
  v156 = objc_autoreleasePoolPush();
  v157 = v136;
  v158 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v158, OS_LOG_TYPE_DEBUG))
  {
    v159 = HMFGetLogIdentifier();
    v160 = [(HMDHome *)v157 uuid];
    *buf = 138544898;
    v500 = v159;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configuring rooms, zones, groups, etc";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfigureProperties";
    v509 = 2114;
    v510 = @"homeUUID";
    v511 = 2112;
    v512 = v160;
    _os_log_impl(&dword_229538000, v158, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v156);
  v161 = [MEMORY[0x277D17DE8] sharedInstance];
  v162 = objc_alloc(MEMORY[0x277D17DF8]);
  v163 = [(HMDHome *)v157 uuid];
  v164 = HMDTaggedLoggingCreateDictionary();
  v165 = [v162 initWithTag:@"homeConfigureStart" data:{v164, @"state", @"homeConfigureProperties", @"homeUUID", v163}];
  v166 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v161 submitTaggedEvent:v165 processorList:v166];

  v489 = 0u;
  v490 = 0u;
  v487 = 0u;
  v488 = 0u;
  v167 = [(HMDHome *)v157 rooms];
  v168 = [v167 countByEnumeratingWithState:&v487 objects:v537 count:16];
  if (v168)
  {
    v169 = *v488;
    do
    {
      for (k = 0; k != v168; ++k)
      {
        if (*v488 != v169)
        {
          objc_enumerationMutation(v167);
        }

        v171 = *(*(&v487 + 1) + 8 * k);
        v172 = [(HMDHome *)v157 msgDispatcher];
        v173 = [(HMDHome *)v157 workQueue];
        [v171 configure:v172 queue:v173];

        v174 = [v171 name];
        v175 = [(HMDHome *)v157 addName:v174];
      }

      v168 = [v167 countByEnumeratingWithState:&v487 objects:v537 count:16];
    }

    while (v168);
  }

  v485 = 0u;
  v486 = 0u;
  v483 = 0u;
  v484 = 0u;
  v176 = [(HMDHome *)v157 zones];
  v177 = [v176 countByEnumeratingWithState:&v483 objects:v536 count:16];
  if (v177)
  {
    v178 = *v484;
    do
    {
      for (m = 0; m != v177; ++m)
      {
        if (*v484 != v178)
        {
          objc_enumerationMutation(v176);
        }

        v180 = *(*(&v483 + 1) + 8 * m);
        v181 = [(HMDHome *)v157 msgDispatcher];
        v182 = [(HMDHome *)v157 workQueue];
        [v180 configure:v181 queue:v182];

        v183 = [v180 name];
        v184 = [(HMDHome *)v157 addName:v183];
      }

      v177 = [v176 countByEnumeratingWithState:&v483 objects:v536 count:16];
    }

    while (v177);
  }

  v481 = 0u;
  v482 = 0u;
  v479 = 0u;
  v480 = 0u;
  v185 = [(HMDHome *)v157 serviceGroups];
  v186 = [v185 countByEnumeratingWithState:&v479 objects:v535 count:16];
  if (v186)
  {
    v187 = *v480;
    do
    {
      for (n = 0; n != v186; ++n)
      {
        if (*v480 != v187)
        {
          objc_enumerationMutation(v185);
        }

        v189 = *(*(&v479 + 1) + 8 * n);
        v190 = [(HMDHome *)v157 msgDispatcher];
        v191 = [(HMDHome *)v157 workQueue];
        [v189 configure:v190 queue:v191];

        v192 = [v189 name];
        v193 = [(HMDHome *)v157 addName:v192];
      }

      v186 = [v185 countByEnumeratingWithState:&v479 objects:v535 count:16];
    }

    while (v186);
  }

  v477 = 0u;
  v478 = 0u;
  v475 = 0u;
  v476 = 0u;
  v194 = [(HMDHome *)v157 actionSets];
  v195 = [v194 countByEnumeratingWithState:&v475 objects:v534 count:16];
  if (v195)
  {
    v451 = 0;
    v196 = *v476;
    do
    {
      for (ii = 0; ii != v195; ++ii)
      {
        if (*v476 != v196)
        {
          objc_enumerationMutation(v194);
        }

        v198 = *(*(&v475 + 1) + 8 * ii);
        v199 = objc_autoreleasePoolPush();
        v200 = [(HMDHome *)v157 msgDispatcher];
        v201 = [(HMDHome *)v157 workQueue];
        v202 = [v198 configure:v157 messageDispatcher:v200 queue:v201];

        v203 = [v198 name];
        v204 = [(HMDHome *)v157 addName:v203];

        objc_autoreleasePoolPop(v199);
        v451 |= v202;
      }

      v195 = [v194 countByEnumeratingWithState:&v475 objects:v534 count:16];
    }

    while (v195);
  }

  else
  {
    v451 = 0;
  }

  v473 = 0u;
  v474 = 0u;
  v471 = 0u;
  v472 = 0u;
  v205 = [(HMDHome *)v157 triggerOwnedActionSets];
  v206 = [v205 countByEnumeratingWithState:&v471 objects:v533 count:16];
  if (v206)
  {
    v207 = *v472;
    do
    {
      for (jj = 0; jj != v206; ++jj)
      {
        if (*v472 != v207)
        {
          objc_enumerationMutation(v205);
        }

        v209 = *(*(&v471 + 1) + 8 * jj);
        v210 = objc_autoreleasePoolPush();
        v211 = [(HMDHome *)v157 msgDispatcher];
        v212 = [(HMDHome *)v157 workQueue];
        LOBYTE(v209) = [v209 configure:v157 messageDispatcher:v211 queue:v212];

        objc_autoreleasePoolPop(v210);
        v451 |= v209;
      }

      v206 = [v205 countByEnumeratingWithState:&v471 objects:v533 count:16];
    }

    while (v206);
  }

  v469 = 0u;
  v470 = 0u;
  v467 = 0u;
  v468 = 0u;
  v213 = [(HMDHome *)v157 triggers];
  v214 = [v213 countByEnumeratingWithState:&v467 objects:v532 count:16];
  if (v214)
  {
    v215 = *v468;
    do
    {
      for (kk = 0; kk != v214; ++kk)
      {
        if (*v468 != v215)
        {
          objc_enumerationMutation(v213);
        }

        v217 = *(*(&v467 + 1) + 8 * kk);
        v218 = [(HMDHome *)v157 msgDispatcher];
        v219 = [(HMDHome *)v157 workQueue];
        [v217 configure:v157 messageDispatcher:v218 queue:v219];

        v220 = [v217 owner];
        LODWORD(v218) = v220 == 0;

        if (v218)
        {
          v221 = [(HMDHome *)v157 currentUser];
          [v217 setOwner:v221];
        }

        v222 = objc_autoreleasePoolPush();
        v223 = v157;
        v224 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v224, OS_LOG_TYPE_INFO))
        {
          v225 = HMFGetLogIdentifier();
          *buf = 138543362;
          v500 = v225;
          _os_log_impl(&dword_229538000, v224, OS_LOG_TYPE_INFO, "%{public}@Not updating trigger owning device in HH2", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v222);
      }

      v214 = [v213 countByEnumeratingWithState:&v467 objects:v532 count:16];
    }

    while (v214);
  }

  v226 = objc_autoreleasePoolPush();
  v227 = v157;
  v228 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v228, OS_LOG_TYPE_INFO))
  {
    v229 = HMFGetLogIdentifier();
    v230 = MEMORY[0x277CCACA8];
    HMFUptime();
    v232 = [v230 stringWithFormat:@"%.3f", v231 - v155];
    v233 = [(HMDHome *)v227 uuid];
    *buf = 138545410;
    v500 = v229;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configured rooms, zones, triggers, etc.";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfiguredProperties";
    v509 = 2114;
    v510 = @"duration";
    v511 = 2112;
    v512 = v232;
    v513 = 2114;
    v514 = @"homeUUID";
    v515 = 2112;
    v516 = v233;
    _os_log_impl(&dword_229538000, v228, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v226);
  v234 = [MEMORY[0x277D17DE8] sharedInstance];
  v235 = objc_alloc(MEMORY[0x277D17DF8]);
  v236 = MEMORY[0x277CCACA8];
  HMFUptime();
  v238 = [v236 stringWithFormat:@"%.3f", v237 - v155];
  v239 = [(HMDHome *)v227 uuid];
  v240 = HMDTaggedLoggingCreateDictionary();
  v241 = [v235 initWithTag:@"homeConfigureStart" data:{v240, @"state", @"homeConfiguredProperties", @"duration", v238, @"homeUUID", v239}];
  v242 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v234 submitTaggedEvent:v241 processorList:v242];

  HMFUptime();
  v244 = v243;
  v245 = objc_autoreleasePoolPush();
  v246 = v227;
  v247 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v247, OS_LOG_TYPE_DEBUG))
  {
    v248 = HMFGetLogIdentifier();
    v249 = [(HMDHome *)v246 uuid];
    *buf = 138544898;
    v500 = v248;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configuring users";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfigureUsers";
    v509 = 2114;
    v510 = @"homeUUID";
    v511 = 2112;
    v512 = v249;
    _os_log_impl(&dword_229538000, v247, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v245);
  v250 = [MEMORY[0x277D17DE8] sharedInstance];
  v251 = objc_alloc(MEMORY[0x277D17DF8]);
  v252 = [(HMDHome *)v246 uuid];
  v253 = HMDTaggedLoggingCreateDictionary();
  v254 = [v251 initWithTag:@"homeConfigureStart" data:{v253, @"state", @"homeConfigureUsers", @"homeUUID", v252}];
  v255 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v250 submitTaggedEvent:v254 processorList:v255];

  v465 = 0u;
  v466 = 0u;
  v463 = 0u;
  v464 = 0u;
  v256 = [(HMDHome *)v246 removedUsers];
  v257 = [v256 countByEnumeratingWithState:&v463 objects:v531 count:16];
  if (v257)
  {
    v258 = *v464;
    do
    {
      for (mm = 0; mm != v257; ++mm)
      {
        if (*v464 != v258)
        {
          objc_enumerationMutation(v256);
        }

        v260 = [*(*(&v463 + 1) + 8 * mm) user];
        [(HMDHome *)v246 _addUserToIdentityRegistry:v260];
      }

      v257 = [v256 countByEnumeratingWithState:&v463 objects:v531 count:16];
    }

    while (v257);
  }

  v461 = 0u;
  v462 = 0u;
  v459 = 0u;
  v460 = 0u;
  v438 = [(HMDHome *)v246 users];
  v261 = [v438 countByEnumeratingWithState:&v459 objects:v530 count:16];
  if (v261)
  {
    v446 = *v460;
    do
    {
      for (nn = 0; nn != v261; ++nn)
      {
        if (*v460 != v446)
        {
          objc_enumerationMutation(v438);
        }

        v263 = *(*(&v459 + 1) + 8 * nn);
        v264 = [(__CFString *)v263 userID];
        v265 = [(__CFString *)v263 isRemoteGateway];
        if (v264)
        {
          v266 = v265;
        }

        else
        {
          v266 = 1;
        }

        if ((v266 & 1) == 0)
        {
          v267 = [HMDDeviceHandle deviceHandleForDestination:v264];
          if (v267)
          {
            v268 = objc_autoreleasePoolPush();
            v269 = v246;
            v270 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v270, OS_LOG_TYPE_DEFAULT))
            {
              v271 = HMFGetLogIdentifier();
              *buf = 138543618;
              v500 = v271;
              v501 = 2112;
              v502 = v263;
              _os_log_impl(&dword_229538000, v270, OS_LOG_TYPE_DEFAULT, "%{public}@Migrating invalid resident user: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v268);
            [(HMDHome *)v269 _removeUser:v263];
            v272 = +[HMDAccountRegistry sharedRegistry];
            v273 = [v272 deviceForHandle:v267];

            v274 = [HMDResidentUser alloc];
            v275 = [(__CFString *)v263 pairingIdentity];
            v276 = [(HMDResidentUser *)v274 initWithDevice:v273 home:v269 pairingIdentity:v275 configurationState:0];

            v277 = [(__CFString *)v263 uuid];
            [(HMDUser *)v276 setUUID:v277];

            [(HMDHome *)v269 addUser:v276];
          }
        }

        [(HMDHome *)v246 _addUserToIdentityRegistry:v263];
        [(__CFString *)v263 configureWithHome:v246];
      }

      v261 = [v438 countByEnumeratingWithState:&v459 objects:v530 count:16];
    }

    while (v261);
  }

  v278 = objc_autoreleasePoolPush();
  v279 = v246;
  v280 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v280, OS_LOG_TYPE_INFO))
  {
    v281 = HMFGetLogIdentifier();
    v282 = MEMORY[0x277CCACA8];
    HMFUptime();
    v284 = [v282 stringWithFormat:@"%.3f", v283 - v244];
    v285 = MEMORY[0x277CCABB0];
    v286 = [(HMDHome *)v279 users];
    v287 = [v285 numberWithUnsignedInteger:{objc_msgSend(v286, "count")}];
    *buf = 138545410;
    v500 = v281;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configured users";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfiguredUsers";
    v509 = 2114;
    v510 = @"duration";
    v511 = 2112;
    v512 = v284;
    v513 = 2114;
    v514 = @"usersCount";
    v515 = 2112;
    v516 = v287;
    _os_log_impl(&dword_229538000, v280, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v278);
  v288 = [MEMORY[0x277D17DE8] sharedInstance];
  v289 = objc_alloc(MEMORY[0x277D17DF8]);
  v290 = MEMORY[0x277CCACA8];
  HMFUptime();
  v292 = [v290 stringWithFormat:@"%.3f", v291 - v244];
  v293 = MEMORY[0x277CCABB0];
  v294 = [(HMDHome *)v279 users];
  v295 = [v293 numberWithUnsignedInteger:{objc_msgSend(v294, "count")}];
  v296 = HMDTaggedLoggingCreateDictionary();
  v297 = [v289 initWithTag:@"homeConfigureStart" data:{v296, @"state", @"homeConfiguredUsers", @"duration", v292, @"usersCount", v295}];
  v298 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v288 submitTaggedEvent:v297 processorList:v298];

  v299 = [(HMDHome *)v279 networkProtectionGroupRegistry];
  [v299 configure];

  v300 = [(HMDHome *)v279 localCapabilitiesDataSource];
  LODWORD(v292) = [v300 isResidentCapable];

  if (v292)
  {
    v301 = [(HMDHome *)v279 uuid];
    v302 = [v301 UUIDString];
    v303 = [@"Home.EventRouter.Server.Delegating." stringByAppendingString:v302];

    v304 = objc_alloc(MEMORY[0x277D17498]);
    v305 = [v436 workQueue];
    v306 = v303;
    v307 = [v303 UTF8String];
    v308 = [(HMDHome *)v279 uuid];
    v309 = [v304 initWithQueue:v305 dataSource:v279 storeReadHandle:0 logCategory:v307 identifier:v308];
    serverDelegatingEventRouter = v279->_serverDelegatingEventRouter;
    v279->_serverDelegatingEventRouter = v309;

    [(HMDHome *)v279 createRemoteEventRouterServerIfNeeded];
  }

  v439 = [HMDUserMessagePolicy userMessagePolicyWithHome:v279 userPrivilege:3 remoteAccessRequired:0];
  v437 = [v436 eventRouterAssertionController];
  v311 = [HMDHomeRemoteEventRouterClientController alloc];
  v312 = [(HMDHome *)v279 messageTargetUUID];
  v313 = [v436 workQueue];
  v314 = [v442 uuid];
  v315 = [(HMDHomeRemoteEventRouterClientController *)v311 initWithMessageTargetUUID:v312 workQueue:v313 dataSource:v279 requestMessageName:@"RemoteEventRouterRequestMessage" updateMessageName:@"RemoteEventRouterUpdateMessageName" multiHopFetchResponseMessageName:@"RER.MHF.ResponseMessageName" clientUserMessagePolicy:v439 currentAccessoryUUID:v314 assertionController:v437];
  [(HMDHome *)v279 setRemoteEventRouterClientController:v315];

  v316 = [v436 localAndRemoteSubscriptionProvider];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v317 = v316;
  }

  else
  {
    v317 = 0;
  }

  v434 = v317;

  v318 = [(HMDHome *)v279 remoteEventRouterClientController];
  v447 = [v318 residentDelegatingEventRouter];

  if (v447)
  {
    [v434 registerSubRouter:v447];
  }

  v319 = [(HMDHome *)v279 swiftExtensions];
  [v319 configureWithHome:v279];

  objc_initWeak(&location, v279);
  v320 = [(HMDHome *)v279 workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke;
  block[3] = &unk_278687568;
  objc_copyWeak(&v457, &location);
  v431 = v442;
  v454 = v431;
  obja = obj;
  v455 = obja;
  v433 = v432;
  v456 = v433;
  dispatch_group_notify(group, v320, block);

  v321 = [(HMDHome *)v279 uuid];
  [v436 removeHomeFromAwaitingAutoAcceptHomes:v321];

  HMFUptime();
  v323 = v322;
  v324 = objc_autoreleasePoolPush();
  v325 = v279;
  v326 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v326, OS_LOG_TYPE_DEBUG))
  {
    v327 = HMFGetLogIdentifier();
    v328 = [(HMDHome *)v325 uuid];
    *buf = 138544898;
    v500 = v327;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configuring profiles and settings";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfigureProfiles";
    v509 = 2114;
    v510 = @"homeUUID";
    v511 = 2112;
    v512 = v328;
    _os_log_impl(&dword_229538000, v326, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v324);
  v329 = [MEMORY[0x277D17DE8] sharedInstance];
  v330 = objc_alloc(MEMORY[0x277D17DF8]);
  v331 = [(HMDHome *)v325 uuid];
  v332 = HMDTaggedLoggingCreateDictionary();
  v333 = [v330 initWithTag:@"homeConfigureStart" data:{v332, @"state", @"homeConfigureProfiles", @"homeUUID", v331}];
  v334 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v329 submitTaggedEvent:v333 processorList:v334];

  v335 = objc_autoreleasePoolPush();
  [(HMDHome *)v325 _registerForMessages];
  objc_autoreleasePoolPop(v335);
  [(HMDHome *)v325 _registerForNotifications];
  [(HMDHome *)v325 resubscribeForNotificationsOnResident:0];
  [(HMDHome *)v325 configureMultiuserSettingsMessengerWithMessengerFactory:v325];
  [(HMDHome *)v325 _evaluateShouldRelaunchAndSetRelaunch];
  [(HMDHome *)v325 reEvaluateHomeHubState];
  v336 = objc_autoreleasePoolPush();
  v337 = v325;
  v338 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v338, OS_LOG_TYPE_INFO))
  {
    v339 = HMFGetLogIdentifier();
    v340 = [v337 triggers];
    *buf = 138543618;
    v500 = v339;
    v501 = 2112;
    v502 = v340;
    _os_log_impl(&dword_229538000, v338, OS_LOG_TYPE_INFO, "%{public}@Triggers: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v336);
  [v337 migrateAfterResidentChange];
  [v337 _updateWoWState:v445];
  if ((v451 & 1) != 0 && [v337 isOwnerUser])
  {
    [v337 _updateConfigurationVersion];
  }

  v341 = [[HMDMediaActionRouter alloc] initWithDataSource:v337];
  [v337 setMediaActionRouter:v341];

  v342 = [v337 personDataManager];
  [v342 configure];

  v343 = [[HMDUserActionPredictionManager alloc] initWithHome:v337];
  [v337 setUserActionPredictionManager:v343];

  v344 = [v337 userActionPredictionManager];
  [v344 configure];

  v345 = [v337 reachabilityNotificationManager];
  v346 = [v436 messageDispatcher];
  v347 = [v346 secureRemoteTransport];
  v348 = [v347 deviceMonitor];
  [v345 configureWithHome:v337 deviceMonitor:v348];

  [v337 configureNaturalLightingWithDemoModeEnabled:0];
  v349 = [v337 walletKeyManager];
  [v349 configureWithHome:v337];

  v350 = [v337 nfcReaderKeyManager];
  [v350 configureWithHome:v337];

  v351 = [v337 lockNotificationManager];
  [v351 configureWithHome:v337];

  v352 = [v337 analysisStatePublisher];
  [v352 configureWithHome:v337];

  [v337 configurePrimaryResidentMessageRouterWithFactory:v337 metricsDispatcherFactory:v337];
  v353 = [HMDAppleMediaAccessoryMessageRouter alloc];
  v354 = [v337 uuid];
  v355 = [v337 msgDispatcher];
  v356 = [(HMDAppleMediaAccessoryMessageRouter *)v353 initWithIdentifier:v354 messageDispatcher:v355];
  [v337 setAppleDeviceRouter:v356];

  v357 = [v337 appleDeviceRouter];
  [v357 setDataSource:v337];

  v358 = [HMDDelegatingMessageRouter alloc];
  v359 = [v337 msgDispatcher];
  v360 = [v337 appleDeviceRouter];
  v529[0] = v360;
  v361 = [v337 primaryResidentMessageRouter];
  v529[1] = v361;
  v362 = [MEMORY[0x277CBEA60] arrayWithObjects:v529 count:2];
  v363 = [(HMDDelegatingMessageRouter *)v358 initWithMessageDispatcher:v359 routers:v362];
  [v337 setAccessoryMessageRouterViaPrimary:v363];

  v364 = [v337 accessoryMessageRouterViaPrimary];
  [v364 setDataSource:v337];

  [v337 configureUnifiedLanguageValueListSettingDataProviderWithFactory:v337];
  [v337 configureAccessorySettingsMessengerWithMessengerFactory:v337 messageHandlerFactory:v337];
  [v337 configureSiriEndpointProfilesMessengerWithMessengerFactory:v337 messageHandlerFactory:v337];
  v365 = [v337 accessoryConnectionCoordinator];
  v366 = [v337 localCapabilitiesDataSource];
  [v365 configureWithIsResidentCapable:{objc_msgSend(v366, "isResidentCapable")}];

  v367 = [v337 workQueue];
  v452[0] = MEMORY[0x277D85DD0];
  v452[1] = 3221225472;
  v452[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_875;
  v452[3] = &unk_27868A728;
  v452[4] = v337;
  dispatch_async(v367, v452);

  v368 = objc_autoreleasePoolPush();
  v369 = v337;
  v370 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v370, OS_LOG_TYPE_INFO))
  {
    v371 = HMFGetLogIdentifier();
    v372 = MEMORY[0x277CCACA8];
    HMFUptime();
    v374 = [v372 stringWithFormat:@"%.3f", v373 - v323];
    v375 = [v369 uuid];
    *buf = 138545410;
    v500 = v371;
    v501 = 2114;
    v502 = @"homeConfigureStart";
    v503 = 2112;
    v504 = @"Configured profiles and settings";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"homeConfiguredProfiles";
    v509 = 2114;
    v510 = @"duration";
    v511 = 2112;
    v512 = v374;
    v513 = 2114;
    v514 = @"homeUUID";
    v515 = 2112;
    v516 = v375;
    _os_log_impl(&dword_229538000, v370, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v368);
  v376 = [MEMORY[0x277D17DE8] sharedInstance];
  v377 = objc_alloc(MEMORY[0x277D17DF8]);
  v378 = MEMORY[0x277CCACA8];
  HMFUptime();
  v380 = [v378 stringWithFormat:@"%.3f", v379 - v323];
  v381 = [v369 uuid];
  v382 = HMDTaggedLoggingCreateDictionary();
  v383 = [v377 initWithTag:@"homeConfigureStart" data:{v382, @"state", @"homeConfiguredProfiles", @"duration", v380, @"homeUUID", v381}];
  v384 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v376 submitTaggedEvent:v383 processorList:v384];

  v385 = [HMDResidentSyncManager alloc];
  v386 = [MEMORY[0x277CCAB98] defaultCenter];
  v387 = +[HMDMainDriver driver];
  v388 = [v387 coreData];
  v389 = [v369 logEventSubmitter];
  v390 = [(HMDResidentSyncManager *)v385 initWithHome:v369 notificationCenter:v386 persistence:v388 logEventSubmitter:v389];
  [v369 setResidentSyncManager:v390];

  v391 = [v369 residentSyncManager];
  v392 = [v391 start];

  [v369 updateAccessoryBrowsing];
  v393 = [v369 featuresDataSource];
  LODWORD(v387) = [v393 isHomeActivityStateFeatureEnabled];

  if (v387)
  {
    v394 = [v369 homeActivityStateManager];
    [v394 configure];
  }

  v395 = objc_autoreleasePoolPush();
  v396 = v369;
  v397 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v397, OS_LOG_TYPE_INFO))
  {
    v398 = HMFGetLogIdentifier();
    *buf = 138543362;
    v500 = v398;
    _os_log_impl(&dword_229538000, v397, OS_LOG_TYPE_INFO, "%{public}@Configuring HMDUserActivityStateDetectorManager - configureWithHomeManager", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v395);
  [v396 _configureUserActivityStateDetectorManager];
  [v396[142] configureWithHome:v396];
  if ([v436 isDemoModeV2Active] && isDemoModeV2Locked())
  {
    [v396 deregisterForMessagesInDemoModeV2];
  }

  v399 = objc_autoreleasePoolPush();
  v400 = v396;
  v401 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v401, OS_LOG_TYPE_INFO))
  {
    v443 = v399;
    v402 = HMFGetLogIdentifier();
    v403 = MEMORY[0x277CCACA8];
    HMFUptime();
    v405 = [v403 stringWithFormat:@"%.3f", v404 - v10];
    v406 = [v400 uuid];
    v407 = HMFBooleanToString();
    v408 = MEMORY[0x277CCABB0];
    v409 = [v400 accessories];
    v410 = [v408 numberWithUnsignedInteger:{objc_msgSend(v409, "count")}];
    v411 = MEMORY[0x277CCABB0];
    v412 = [v400 users];
    v413 = [v411 numberWithUnsignedInteger:{objc_msgSend(v412, "count")}];
    *buf = 138546946;
    v500 = v402;
    v501 = 2114;
    v502 = @"homeConfigureDone";
    v503 = 2112;
    v504 = @"Configured home";
    v505 = 2114;
    v506 = @"state";
    v507 = 2112;
    v508 = @"end";
    v509 = 2114;
    v510 = @"duration";
    v511 = 2112;
    v512 = v405;
    v513 = 2114;
    v514 = @"homeUUID";
    v515 = 2112;
    v516 = v406;
    v517 = 2114;
    v518 = @"configChanged";
    v519 = 2112;
    v520 = v407;
    v521 = 2114;
    v522 = @"accessoriesCount";
    v523 = 2112;
    v524 = v410;
    v525 = 2114;
    v526 = @"usersCount";
    v527 = 2112;
    v528 = v413;
    _os_log_impl(&dword_229538000, v401, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x98u);

    v399 = v443;
  }

  objc_autoreleasePoolPop(v399);
  v444 = [MEMORY[0x277D17DE8] sharedInstance];
  v414 = objc_alloc(MEMORY[0x277D17DF8]);
  v415 = MEMORY[0x277CCACA8];
  HMFUptime();
  v417 = [v415 stringWithFormat:@"%.3f", v416 - v10];
  v418 = [v400 uuid];
  v419 = HMFBooleanToString();
  v420 = MEMORY[0x277CCABB0];
  v421 = [v400 accessories];
  v422 = [v420 numberWithUnsignedInteger:{objc_msgSend(v421, "count")}];
  v423 = MEMORY[0x277CCABB0];
  v424 = [v400 users];
  v425 = [v423 numberWithUnsignedInteger:{objc_msgSend(v424, "count")}];
  v426 = HMDTaggedLoggingCreateDictionary();
  v427 = [v414 initWithTag:@"homeConfigureDone" data:{v426, @"state", @"end", @"duration", v417, @"homeUUID", v418, @"configChanged", v419, @"accessoriesCount", v422, @"usersCount", v425}];
  v428 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v444 submitTaggedEvent:v427 processorList:v428];

  objc_destroyWeak(&v457);
  objc_destroyWeak(&location);

  v429 = *MEMORY[0x277D85DE8];
  return v451 & 1;
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:*(a1 + 32) accessories:*(a1 + 40) uncommittedTransactions:*(a1 + 48)];
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_875(uint64_t a1)
{
  v2 = [*(a1 + 32) accessCodeManager];
  v3 = [*(a1 + 32) msgDispatcher];
  [v2 configureWithMessageDispatcher:v3];

  v9 = objc_opt_new();
  v4 = [HMDHomeHindsightCloudShareManager alloc];
  v5 = *(a1 + 32);
  v6 = [v5 workQueue];
  v7 = [(HMDHomeHindsightCloudShareManager *)v4 initWithHome:v5 workQueue:v6 dataSource:v9];
  [*(a1 + 32) setHindsightCloudShareManager:v7];

  v8 = [*(a1 + 32) hindsightCloudShareManager];
  [v8 configure];
}

- (void)_setupActiveNetworkRouterAccessory:(id)a3 existingRouterAccessories:(id)a4
{
  v63 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  v8 = v6;
  v9 = [v8 countByEnumeratingWithState:&v51 objects:v62 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v52;
    while (2)
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v52 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v51 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if ([v15 isPrimary])
        {
          v16 = [v15 networkRouterController];

          if (v16)
          {
            v42 = v8;
            v43 = v7;
            v49 = 0u;
            v50 = 0u;
            v47 = 0u;
            v48 = 0u;
            v17 = v7;
            v18 = [v17 countByEnumeratingWithState:&v47 objects:v61 count:16];
            v19 = v15;
            v46 = v15;
            if (v18)
            {
              v20 = v18;
              v21 = *v48;
              v44 = v17;
              v45 = *v48;
              do
              {
                for (j = 0; j != v20; ++j)
                {
                  if (*v48 != v21)
                  {
                    objc_enumerationMutation(v17);
                  }

                  v23 = *(*(&v47 + 1) + 8 * j);
                  if (([v23 isEqual:{v19, v42, v43}] & 1) == 0)
                  {
                    v24 = objc_autoreleasePoolPush();
                    v25 = self;
                    v26 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
                    {
                      HMFGetLogIdentifier();
                      v28 = v27 = self;
                      [v23 shortDescription];
                      v30 = v29 = v20;
                      v31 = [v19 shortDescription];
                      *buf = 138543874;
                      v56 = v28;
                      v57 = 2112;
                      v58 = v30;
                      v59 = 2112;
                      v60 = v31;
                      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@Removing existing Wi-Fi router accessory '%@' while adding a new Wi-Fi router accessory '%@'", buf, 0x20u);

                      v19 = v46;
                      v20 = v29;

                      self = v27;
                      v17 = v44;
                      v21 = v45;
                    }

                    objc_autoreleasePoolPop(v24);
                    [(HMDHome *)v25 __removeAccessory:v23 isBeingReplaced:1 isForceUpdate:0 message:0];
                  }
                }

                v20 = [v17 countByEnumeratingWithState:&v47 objects:v61 count:16];
              }

              while (v20);
            }

            v32 = [v19 uuid];
            v33 = [(HMDHome *)self activeNetworkRouterUUID];
            v34 = [v32 isEqual:v33];

            if (v34)
            {
              [(HMDHome *)self _evaluateNetworkProtectionAndRouterManagement];
              v8 = v42;
              v7 = v43;
              v35 = v46;
            }

            else
            {
              v36 = objc_autoreleasePoolPush();
              v37 = self;
              v38 = HMFGetOSLogHandle();
              v8 = v42;
              v7 = v43;
              if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
              {
                v39 = HMFGetLogIdentifier();
                v40 = [v46 shortDescription];
                *buf = 138543618;
                v56 = v39;
                v57 = 2112;
                v58 = v40;
                _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_INFO, "%{public}@Adding transaction to set %@ as active network router accessory", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v36);
              v35 = v46;
              -[HMDHome _addTransactionForActiveNetworkRouterAccessory:isReplacement:](v37, "_addTransactionForActiveNetworkRouterAccessory:isReplacement:", v46, [v17 count] != 0);
            }

            goto LABEL_31;
          }
        }
      }

      v10 = [v8 countByEnumeratingWithState:&v51 objects:v62 count:16];
      if (v10)
      {
        continue;
      }

      break;
    }
  }

LABEL_31:

  v41 = *MEMORY[0x277D85DE8];
}

- (void)setBackingStore:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  backingStore = self->_backingStore;
  self->_backingStore = v4;

  os_unfair_recursive_lock_unlock();
}

- (HMDBackingStore)backingStore
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_backingStore;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setWatchSkipVersionCheck:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_watchSkipVersionCheck = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)watchSkipVersionCheck
{
  os_unfair_recursive_lock_lock_with_options();
  watchSkipVersionCheck = self->_watchSkipVersionCheck;
  os_unfair_recursive_lock_unlock();
  return watchSkipVersionCheck;
}

- (void)_addUserToIdentityRegistry:(id)a3
{
  v12 = a3;
  v3 = [v12 userID];
  v4 = v12;
  if (v3)
  {
    v5 = [v12 pairingIdentity];

    v4 = v12;
    if (v5)
    {
      v6 = v12;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v7 = v6;
      }

      else
      {
        v7 = 0;
      }

      v8 = v7;

      if (v8)
      {
        v9 = [v8 device];
        if (v9)
        {
          v10 = +[HMDIdentityRegistry sharedRegistry];
          v11 = [v6 pairingIdentity];
          [v10 registerIdentity:v11 device:v9 object:v6];
LABEL_11:
        }
      }

      else
      {
        v9 = [v6 account];
        if (v9)
        {
          v10 = +[HMDIdentityRegistry sharedRegistry];
          v11 = [v6 pairingIdentity];
          [v10 registerIdentity:v11 account:v9 object:v6];
          goto LABEL_11;
        }
      }

      v4 = v12;
    }
  }
}

- (void)_removeMediaSessionWithIdentifier:(id)a3
{
  v4 = [(HMDHome *)self mediaSessionWithIdentifier:a3];
  if (v4)
  {
    v5 = v4;
    [v4 registerForSessionUpdates:0];
    [(HMDHome *)self removeMediaSession:v5];
    v4 = v5;
  }
}

- (id)_createMediaSessionWithEndpoint:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 sessionIdentifier];
  if (v5)
  {
    v6 = [(HMDHome *)self mediaSessionStateWithIdentifier:v5];
    if (!v6)
    {
      v6 = [[HMDMediaSessionState alloc] initWithSessionIdentifier:v5];
      [(HMDHome *)self addMediaSessionState:v6];
    }

    v7 = [HMDMediaSession alloc];
    v8 = [MEMORY[0x277CBEA60] array];
    v9 = [(HMDMediaSession *)v7 initWithEndpoint:v4 mediaProfiles:v8 state:v6];

    [(HMDHome *)self __addMediaSession:v9];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = v4;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Cannot create a mediaSession with nil sessionIdentifier for endpoint %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v9 = 0;
  }

  v14 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)_addMediaSessionForCurrentAccessory:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  v7 = [v6 mediaProfile];
  if (v7)
  {
    v8 = [v4 identifier];
    v9 = [HMDMediaSession sessionForCurrentAccessoryWithSessionIdentifier:v8 mediaProfile:v7];

    if (v9)
    {
      v10 = [v9 state];
      [(HMDHome *)self addMediaSessionState:v10];

      [(HMDHome *)self __addMediaSession:v9];
      [v4 updateMediaSession:v9];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v4 name];
      v18 = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v15;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEFAULT, "%{public}@Current accessory '%@' not an Apple media accessory or no media profile", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v9 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)__addMediaSession:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v7 = v4;
    v5 = [(HMDHome *)self notificationRegistrations];
    v6 = [v5 count];

    if (v6)
    {
      [v7 registerForSessionUpdates:1];
    }

    [(HMDHome *)self addMediaSession:v7];
    v4 = v7;
  }
}

- (id)_createBuiltinActionSets
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  +[HMDHome getBuiltinActionSets];
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v4 = v28 = 0u;
  v24 = [v4 countByEnumeratingWithState:&v25 objects:v35 count:16];
  if (v24)
  {
    v23 = *v26;
    *&v5 = 138543874;
    v20 = v5;
    v21 = self;
    v22 = v4;
    do
    {
      for (i = 0; i != v24; ++i)
      {
        if (*v26 != v23)
        {
          objc_enumerationMutation(v4);
        }

        v7 = *(*(&v25 + 1) + 8 * i);
        v8 = [v4 objectForKeyedSubscript:{v7, v20}];
        v9 = HMDLocalizedStringForKey(v8);

        v10 = [(HMDHome *)self addName:v9];
        if (v10)
        {
          v11 = objc_autoreleasePoolPush();
          v12 = self;
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
          {
            v14 = HMFGetLogIdentifier();
            [(HMDHome *)v12 name];
            v16 = v15 = v3;
            *buf = v20;
            v30 = v14;
            v31 = 2112;
            v32 = v9;
            v33 = 2112;
            v34 = v16;
            _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEFAULT, "%{public}@Could not add builtin actionSet '%@' to home '%@' namespace", buf, 0x20u);

            v3 = v15;
            self = v21;
          }

          objc_autoreleasePoolPop(v11);
          v4 = v22;
        }

        v17 = [(HMDHome *)self createActionSetWithName:v9 uuid:0 type:v7];
        [v3 addObject:v17];
      }

      v24 = [v4 countByEnumeratingWithState:&v25 objects:v35 count:16];
    }

    while (v24);
  }

  v18 = *MEMORY[0x277D85DE8];

  return v3;
}

- (id)createActionSetWithName:(id)a3 uuid:(id)a4 type:(id)a5
{
  v8 = a5;
  v9 = a4;
  v10 = a3;
  v11 = [HMDActionSet alloc];
  v12 = [(HMDHome *)self workQueue];
  v13 = [(HMDActionSet *)v11 initWithName:v10 uuid:v9 type:v8 home:self queue:v12];

  v14 = [(HMDHome *)self msgDispatcher];
  v15 = [(HMDHome *)self workQueue];
  [(HMDActionSet *)v13 configure:self messageDispatcher:v14 queue:v15];

  return v13;
}

- (id)filterBuiltinActionSets:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v4 = +[HMDHome getBuiltinActionSets];
  v5 = [v4 allKeys];

  v6 = [MEMORY[0x277CBEB18] array];
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v7 = v3;
  v8 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v18;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v18 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v17 + 1) + 8 * i);
        v13 = [v12 type];
        v14 = [v5 containsObject:v13];

        if (v14)
        {
          [v6 addObject:v12];
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
    }

    while (v9);
  }

  v15 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)computeBridgedAccessoriesForAllBridges
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB38] dictionary];
  v4 = [(HMDHome *)self accessories];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v5 = [v4 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v35;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v35 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v34 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 bridge];
        v13 = v12;
        if (v12)
        {
          v14 = [v12 uuid];
          v15 = [v3 hmf_mutableSetForKey:v14];

          if (!v15)
          {
            v15 = [MEMORY[0x277CBEB58] set];
            v16 = [v13 uuid];
            [v3 setObject:v15 forKey:v16];
          }

          v17 = [v9 uuid];
          [v15 addObject:v17];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v34 objects:v39 count:16];
    }

    while (v6);
  }

  v32 = 0u;
  v33 = 0u;
  v30 = 0u;
  v31 = 0u;
  v18 = v3;
  v19 = [v18 countByEnumeratingWithState:&v30 objects:v38 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v31;
    do
    {
      for (j = 0; j != v20; ++j)
      {
        if (*v31 != v21)
        {
          objc_enumerationMutation(v18);
        }

        v23 = *(*(&v30 + 1) + 8 * j);
        v24 = [v18 hmf_mutableSetForKey:{v23, v30}];
        v25 = [v4 hmf_firstObjectWithUUID:v23];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v26 = v25;
        }

        else
        {
          v26 = 0;
        }

        v27 = v26;

        if (v27)
        {
          v28 = v24 == 0;
        }

        else
        {
          v28 = 1;
        }

        if (!v28)
        {
          [v27 setIdentifiersForBridgedAccessories:v24];
        }
      }

      v20 = [v18 countByEnumeratingWithState:&v30 objects:v38 count:16];
    }

    while (v20);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)__handleProcessStateChange:(id)a3
{
  v4 = [a3 userInfo];
  v5 = [v4 objectForKeyedSubscript:@"processInfo"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v8 = [v7 bundleIdentifier];
    v9 = [v7 state];
    if (v8)
    {
      v10 = v9 > 4;
    }

    else
    {
      v10 = 1;
    }

    if (!v10 && ((1 << v9) & 0x1A) != 0)
    {
      v12 = [(HMDHome *)self workQueue];
      v14 = MEMORY[0x277D85DD0];
      v15 = 3221225472;
      v16 = __38__HMDHome___handleProcessStateChange___block_invoke;
      v17 = &unk_27868A750;
      v18 = v8;
      v19 = self;
      dispatch_async(v12, &v14);
    }

    v13 = [(HMDHome *)self hapAccessories:v14];
    [v13 hmf_enumerateWithAutoreleasePoolUsingBlock:&__block_literal_global_818];
  }
}

uint64_t __38__HMDHome___handleProcessStateChange___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = +[HMDAccessorySetupManager accessorySetupHostBundleIdentifier];
  LODWORD(v2) = [v2 isEqualToString:v3];

  if (v2)
  {
    [*(a1 + 40) _cleanAddAccessoryOperations];
  }

  v5 = *(a1 + 32);
  v4 = *(a1 + 40);

  return [v4 _disableNotificationsForClient:v5];
}

- (void)_startHomeNotificationDeregistrationTimer
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self disableNotificationTimer];

  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [(HMDHome *)v5 disableNotificationTimer];
      v22 = 138543618;
      v23 = v7;
      v24 = 2112;
      v25 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Kicking notification disable timer: %@", &v22, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v9 = [(HMDHome *)v5 disableNotificationTimer];
    [v9 kick];
  }

  else
  {
    v10 = objc_alloc(MEMORY[0x277D0F920]);
    v11 = [v10 initWithTimeInterval:1 options:*&disableNotificationsDeferPeriod];
    [(HMDHome *)self setDisableNotificationTimer:v11];

    v12 = [(HMDHome *)self workQueue];
    v13 = [(HMDHome *)self disableNotificationTimer];
    [v13 setDelegateQueue:v12];

    v14 = [(HMDHome *)self disableNotificationTimer];
    [v14 setDelegate:self];

    v15 = [(HMDHome *)self disableNotificationTimer];
    [v15 resume];

    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [(HMDHome *)v17 disableNotificationTimer];
      v22 = 138543618;
      v23 = v19;
      v24 = 2112;
      v25 = v20;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Started notification disable timer: %@", &v22, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_disableDirectCharacteristicNotificationsForClient:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v25[0] = 0;
  v25[1] = v25;
  v25[2] = 0x2020000000;
  v26 = 0;
  v5 = dispatch_group_create();
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v6 = [(HMDHome *)self accessories];
  v7 = [v6 copy];

  v8 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
  if (v8)
  {
    v9 = *v22;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v22 != v9)
        {
          objc_enumerationMutation(v7);
        }

        v11 = *(*(&v21 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = v11;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if (v13)
        {
          dispatch_group_enter(v5);
          aBlock[0] = MEMORY[0x277D85DD0];
          aBlock[1] = 3221225472;
          aBlock[2] = __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke;
          aBlock[3] = &unk_278685E20;
          v20 = v25;
          v19 = v5;
          v14 = _Block_copy(aBlock);
          [v13 disableNotificationsForBundleID:v4 completionHandler:v14];
        }
      }

      v8 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
    }

    while (v8);
  }

  v15 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke_2;
  block[3] = &unk_27868A688;
  block[4] = self;
  block[5] = v25;
  dispatch_group_notify(v5, v15, block);

  _Block_object_dispose(v25, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke(uint64_t a1, int a2)
{
  if (a2)
  {
    *(*(*(a1 + 40) + 8) + 24) = 1;
  }

  dispatch_group_leave(*(a1 + 32));
}

uint64_t __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke_2(uint64_t result)
{
  if (*(*(*(result + 40) + 8) + 24) == 1)
  {
    return [*(result + 32) saveToCurrentAccountWithReason:@"HMDApplicationTerminatedSaveReason"];
  }

  return result;
}

- (void)_disableNotificationsForClient:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v9;
    v17 = 2112;
    v18 = v4;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Disabling notification for client %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [(HMDHome *)v7 notificationRegistrations];
  if ([v10 containsObject:v4])
  {
    v11 = [(HMDHome *)v7 notificationDeregistrations];
    v12 = [v11 containsObject:v4];

    if ((v12 & 1) == 0)
    {
      [(HMDHome *)v7 addNotificationDeregistrationForClientIdentifier:v4];
      [(HMDHome *)v7 _startHomeNotificationDeregistrationTimer];
    }
  }

  else
  {
  }

  v13 = [@"com.apple.HomeKit.client." stringByAppendingString:v4];
  [(HMDHome *)v7 _disableDirectCharacteristicNotificationsForClient:v13];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_cleanAddAccessoryOperations
{
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)self->_addPendingAccessories removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessorySetupCodeHandlers removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessorySetupCodes removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessoryOnboardingSetupPayloadStrings removeAllObjects];

  os_unfair_recursive_lock_unlock();
}

- (void)handleAccessoryReachabilityChangeNotification:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __57__HMDHome_handleAccessoryReachabilityChangeNotification___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v4, block);
}

uint64_t __57__HMDHome_handleAccessoryReachabilityChangeNotification___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) _hasPairedReachableBTLEAccessories];
  v3 = *(a1 + 32);

  return [v3 setAnyBTLEAccessoryReachable:v2];
}

- (void)handleClientProcessDisconnectedNotification:(id)a3
{
  v4 = [a3 object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  if (v6)
  {
    v7 = [v6 bundleIdentifier];
    if (v7)
    {
      v8 = [(HMDHome *)self workQueue];
      v9[0] = MEMORY[0x277D85DD0];
      v9[1] = 3221225472;
      v9[2] = __55__HMDHome_handleClientProcessDisconnectedNotification___block_invoke;
      v9[3] = &unk_27868A750;
      v9[4] = self;
      v10 = v7;
      dispatch_async(v8, v9);
    }
  }
}

- (void)_registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5
{
  v6 = a3;
  v49 = *MEMORY[0x277D85DE8];
  v8 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v10);

  if ([(HMDHome *)self isFeatureMatteriPhoneOnlyPairingControlEnabled])
  {
    if (v9)
    {
      v11 = v9;
    }

    else
    {
      v11 = v8;
    }

    v12 = v11;
    if (([v12 isEqualToString:*MEMORY[0x277CCFE40]] & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD09C8]) & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD11A0]) & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD06C8]) & 1) != 0 || objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD0638]))
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG);
      if (v6)
      {
        if (v16)
        {
          v17 = HMFGetLogIdentifier();
          v43 = 138543874;
          v44 = v17;
          v45 = 2112;
          v46 = v9;
          v47 = 2112;
          v48 = v8;
          _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEBUG, "%{public}@registerForMatterFabricNotifications:YES - skip registering client %@, registrationIdentifier = %@", &v43, 0x20u);
        }

        objc_autoreleasePoolPop(v13);
        goto LABEL_35;
      }

      if (v16)
      {
        v18 = HMFGetLogIdentifier();
        v43 = 138543874;
        v44 = v18;
        v45 = 2112;
        v46 = v9;
        v47 = 2112;
        v48 = v8;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEBUG, "%{public}@registerForMatterFabricNotifications:NO - allow deregistration for client %@, registrationIdentifier = %@", &v43, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
    }

    else if (v6)
    {
      v41 = [(HMDHome *)self matterFabricEnabledClients];
      v42 = [v41 containsObject:v8];

      if (v42)
      {
LABEL_19:
        v20 = [(HMDHome *)self homeManager];
        v21 = [(HMDHome *)self matterFabricEnabledClients];
        v22 = [v21 count];

        if (v22)
        {
          v23 = [(HMDHome *)self currentMatterClientRegistration];
          v24 = objc_autoreleasePoolPush();
          v25 = self;
          v26 = HMFGetOSLogHandle();
          v27 = v26;
          if (v23)
          {
            if (!os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
            {
LABEL_24:

              objc_autoreleasePoolPop(v24);
LABEL_34:

LABEL_35:
              goto LABEL_36;
            }

            v28 = HMFGetLogIdentifier();
            v29 = [(HMDHome *)v25 matterFabricEnabledClients];
            v43 = 138543618;
            v44 = v28;
            v45 = 2112;
            v46 = v29;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEBUG, "%{public}@Not updating matter fabric registration as we are registered and have the clients %@", &v43, 0x16u);

LABEL_23:
            goto LABEL_24;
          }

          if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
          {
            v38 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v38;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Updating matter fabric registration as we are not registered but have clients", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          v39 = [v20 chipDataSource];
          [v39 updateNotificationsEnabled:1 forHome:v25 keepAliveOnly:1];

          v36 = v25;
          v37 = 1;
        }

        else
        {
          v30 = [(HMDHome *)self matterFabricEnabledClients];
          v31 = [v30 count];

          if (v31)
          {
            goto LABEL_34;
          }

          v32 = [(HMDHome *)self currentMatterClientRegistration];
          v24 = objc_autoreleasePoolPush();
          v25 = self;
          v33 = HMFGetOSLogHandle();
          v27 = v33;
          if (!v32)
          {
            if (!os_log_type_enabled(v33, OS_LOG_TYPE_DEBUG))
            {
              goto LABEL_24;
            }

            v28 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v28;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEBUG, "%{public}@Not updating matter fabric registration as we are not registered and have no clients", &v43, 0xCu);
            goto LABEL_23;
          }

          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            v34 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v34;
            _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Updating matter fabric registration as we are registered but have no clients", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          v35 = [v20 chipDataSource];
          [v35 updateNotificationsEnabled:0 forHome:v25 keepAliveOnly:1];

          v36 = v25;
          v37 = 0;
        }

        [(HMDHome *)v36 setCurrentMatterClientRegistration:v37];
        goto LABEL_34;
      }

      v19 = [(HMDHome *)self matterFabricEnabledClients];
      [v19 addObject:v8];
LABEL_18:

      goto LABEL_19;
    }

    v19 = [(HMDHome *)self matterFabricEnabledClients];
    [v19 removeObject:v8];
    goto LABEL_18;
  }

LABEL_36:

  v40 = *MEMORY[0x277D85DE8];
}

- (void)registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5
{
  v8 = a5;
  v9 = a4;
  v10 = [(HMDHome *)self workQueue];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __88__HMDHome_registerForMatterFabricNotifications_registrationIdentifier_clientIdentifier___block_invoke;
  v11[3] = &unk_278685AA8;
  v12 = a3;
  v11[4] = self;
  v11[5] = v9;
  v11[6] = v8;
  dispatch_async(v10, v11);
}

- (void)registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4
{
  v6 = a4;
  v7 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __71__HMDHome_registerForMatterFabricNotifications_registrationIdentifier___block_invoke;
  block[3] = &unk_278688BD0;
  v9 = a3;
  block[4] = self;
  block[5] = v6;
  dispatch_async(v7, block);
}

- (void)_registerForAccessoryReachabilityNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5
{
  v6 = a3;
  v40 = *MEMORY[0x277D85DE8];
  v8 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v10);

  v11 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  v12 = v11;
  if (v6)
  {
    v13 = [v11 containsObject:v8];

    if (v13)
    {
      goto LABEL_6;
    }

    v12 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
    [v12 addObject:v8];
  }

  else
  {
    [v11 removeObject:v8];
  }

LABEL_6:
  v14 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  v15 = [v14 count];

  if (v15)
  {
    v16 = [(HMDHome *)self currentRemoteReachabilityRegistration];
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    v20 = v19;
    if (v16)
    {
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        v21 = HMFGetLogIdentifier();
        v22 = [(HMDHome *)v18 accessoryRemoteReachabilityEnabledClients];
        v36 = 138543618;
        v37 = v21;
        v38 = 2112;
        v39 = v22;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability registration as we are registered and have the clients %@", &v36, 0x16u);
      }

      objc_autoreleasePoolPop(v17);
    }

    else
    {
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v23;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_DEFAULT, "%{public}@Updating remote accessory reachability registration as we are not registered but have clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      if (v9)
      {
        v24 = v9;
      }

      else
      {
        v24 = v8;
      }

      [(HMDHome *)v18 __registerForRemoteAccessoryReachabilityNotifications:1 clientIdentifier:v24];
    }
  }

  v25 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  v26 = [v25 count];

  if (!v26)
  {
    v27 = [(HMDHome *)self currentRemoteReachabilityRegistration];
    v28 = objc_autoreleasePoolPush();
    v29 = self;
    v30 = HMFGetOSLogHandle();
    v31 = v30;
    if (v27)
    {
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v32 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v32;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_DEFAULT, "%{public}@Updating remote accessory reachability registration as we are registered but have no clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v28);
      if (v9)
      {
        v33 = v9;
      }

      else
      {
        v33 = v8;
      }

      [(HMDHome *)v29 __registerForRemoteAccessoryReachabilityNotifications:0 clientIdentifier:v33];
    }

    else
    {
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
      {
        v34 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v34;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability registration as we are not registered and have no clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v28);
    }
  }

  v35 = *MEMORY[0x277D85DE8];
}

- (void)registerForAccessoryReachabilityNotifications:(BOOL)a3 registrationIdentifier:(id)a4
{
  v6 = a4;
  v7 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __80__HMDHome_registerForAccessoryReachabilityNotifications_registrationIdentifier___block_invoke;
  block[3] = &unk_278688BD0;
  v9 = a3;
  block[4] = self;
  block[5] = v6;
  dispatch_async(v7, block);
}

- (void)handleLastProcessDidBecomeInactiveNotification:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __58__HMDHome_handleLastProcessDidBecomeInactiveNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __58__HMDHome_handleLastProcessDidBecomeInactiveNotification___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_stringForKey:@"HMDXPCConnectionClientIdentifierKey"];

  [*(a1 + 40) _registerForAccessoryReachabilityNotifications:0 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v3];
  [*(a1 + 40) _registerForMatterFabricNotifications:0 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v3];
  v4 = [*(a1 + 40) WiFiAssertion];

  if (v4)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 40);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Releasing WiFi assertion", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [*(a1 + 40) wifiManager];
    v10 = [*(a1 + 40) WiFiAssertion];
    [v9 endActiveAssertion:v10];

    v11 = [*(a1 + 40) wifiManager];
    [v11 releaseWoWAssertion];

    [*(a1 + 40) setWiFiAssertion:0];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleFirstProcessDidBecomeActiveNotification:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __57__HMDHome_handleFirstProcessDidBecomeActiveNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __57__HMDHome_handleFirstProcessDidBecomeActiveNotification___block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  if (isWatch())
  {
    if ([*(a1 + 32) remoteAccessIsEnabled])
    {
      v2 = [*(a1 + 32) WiFiAssertion];

      if (!v2)
      {
        v3 = objc_autoreleasePoolPush();
        v4 = *(a1 + 32);
        v5 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
        {
          v6 = HMFGetLogIdentifier();
          *buf = 138543362;
          v17 = v6;
          _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Taking WiFi assertion", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v3);
        v7 = [*(a1 + 32) wifiManager];
        v8 = MEMORY[0x277CCACA8];
        v9 = [*(a1 + 32) shortDescription];
        v10 = [v8 stringWithFormat:@"Remote Access for %@", v9];
        v11 = [v7 beginActiveAssertionWithOptions:0 reason:v10];
        [*(a1 + 32) setWiFiAssertion:v11];

        v12 = [*(a1 + 32) wifiManager];
        [v12 takeWoWAssertion];
      }
    }
  }

  v13 = [*(a1 + 40) userInfo];
  v14 = [v13 hmf_stringForKey:@"HMDXPCConnectionClientIdentifierKey"];

  [*(a1 + 32) _registerForAccessoryReachabilityNotifications:1 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v14];
  [*(a1 + 32) _registerForMatterFabricNotifications:1 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v14];

  v15 = *MEMORY[0x277D85DE8];
}

- (HMMDailyScheduler)dailyScheduler
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 metricsManager];
  v4 = [v3 dailyScheduler];

  return v4;
}

- (void)setThreadOperationalDataset:(id)a3
{
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [v6 copy];
  threadOperationalDataset = self->_threadOperationalDataset;
  self->_threadOperationalDataset = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSData)threadOperationalDataset
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSData *)self->_threadOperationalDataset copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setPrimaryNetworkRouterManagingDeviceUUID:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  primaryNetworkRouterManagingDeviceUUID = self->_primaryNetworkRouterManagingDeviceUUID;
  self->_primaryNetworkRouterManagingDeviceUUID = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSUUID)primaryNetworkRouterManagingDeviceUUID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_primaryNetworkRouterManagingDeviceUUID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setActiveNetworkRouterInitialSetupNeeded:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_activeNetworkRouterInitialSetupNeeded = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isActiveNetworkRouterInitialSetupNeeded
{
  os_unfair_recursive_lock_lock_with_options();
  activeNetworkRouterInitialSetupNeeded = self->_activeNetworkRouterInitialSetupNeeded;
  os_unfair_recursive_lock_unlock();
  return activeNetworkRouterInitialSetupNeeded;
}

- (void)setActiveNetworkRouterUUID:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  activeNetworkRouterUUID = self->_activeNetworkRouterUUID;
  self->_activeNetworkRouterUUID = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSUUID)activeNetworkRouterUUID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_activeNetworkRouterUUID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setRouterClientManager:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  routerClientManager = self->_routerClientManager;
  self->_routerClientManager = v4;

  os_unfair_recursive_lock_unlock();
}

- (HMDNetworkRouterClientManager)routerClientManager
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_routerClientManager;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  minHomeKitVersionForAccessoryNetworkProtectionChange = self->_minHomeKitVersionForAccessoryNetworkProtectionChange;
  self->_minHomeKitVersionForAccessoryNetworkProtectionChange = v4;

  os_unfair_recursive_lock_unlock();
}

- (HMDHomeKitVersion)minHomeKitVersionForAccessoryNetworkProtectionChange
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_minHomeKitVersionForAccessoryNetworkProtectionChange;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setMinimumNetworkRouterSupportHomeKitVersion:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  minimumNetworkRouterSupportHomeKitVersion = self->_minimumNetworkRouterSupportHomeKitVersion;
  self->_minimumNetworkRouterSupportHomeKitVersion = v4;

  os_unfair_recursive_lock_unlock();
}

- (HMDHomeKitVersion)minimumNetworkRouterSupportHomeKitVersion
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_minimumNetworkRouterSupportHomeKitVersion;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNetworkRouterSupport:(unint64_t)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_networkRouterSupport = a3;

  os_unfair_recursive_lock_unlock();
}

- (unint64_t)networkRouterSupport
{
  os_unfair_recursive_lock_lock_with_options();
  networkRouterSupport = self->_networkRouterSupport;
  os_unfair_recursive_lock_unlock();
  return networkRouterSupport;
}

- (void)setNetworkRouterSupportDisableReason:(unint64_t)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_networkRouterSupportDisableReason = a3;

  os_unfair_recursive_lock_unlock();
}

- (unint64_t)networkRouterSupportDisableReason
{
  os_unfair_recursive_lock_lock_with_options();
  networkRouterSupportDisableReason = self->_networkRouterSupportDisableReason;
  os_unfair_recursive_lock_unlock();
  return networkRouterSupportDisableReason;
}

- (void)setProtectionMode:(int64_t)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_protectionMode = a3;

  os_unfair_recursive_lock_unlock();
}

- (int64_t)protectionMode
{
  os_unfair_recursive_lock_lock_with_options();
  protectionMode = self->_protectionMode;
  os_unfair_recursive_lock_unlock();
  return protectionMode;
}

- (id)retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableDictionary *)self->_newlyConfiguredAccessories objectForKeyedSubscript:v4];
  v6 = [v5 copy];

  if (v6)
  {
    [(NSMutableDictionary *)self->_newlyConfiguredAccessories removeObjectForKey:v4];
    v7 = v6;
  }

  else
  {
    v7 = MEMORY[0x277CBEBF8];
  }

  v8 = v7;

  os_unfair_recursive_lock_unlock();

  return v8;
}

- (NSMapTable)addPendingAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMapTable *)self->_addPendingAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSMutableDictionary)addPendingAccessorySetupCodeHandlers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableDictionary *)self->_addPendingAccessorySetupCodeHandlers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSHashTable)removeAccessoryInProgressForHMDAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSHashTable *)self->_removeAccessoryInProgressForHMDAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)removeFromCurrentTriggers:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_currentTriggers containsObject:v4])
  {
    [(NSMutableArray *)self->_currentTriggers removeObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addToCurrentTriggers:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_currentTriggers containsObject:v4]& 1) == 0)
  {
    [(NSMutableArray *)self->_currentTriggers addObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (NSArray)triggers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_currentTriggers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)addNewlyConfiguredAccessories:(id)a3 addSessionIdentifier:(id)a4
{
  v8 = a3;
  v6 = a4;
  os_unfair_recursive_lock_lock_with_options();
  v7 = [(NSMutableDictionary *)self->_newlyConfiguredAccessories objectForKeyedSubscript:v6];
  if (!v7)
  {
    v7 = [MEMORY[0x277CBEB18] arrayWithCapacity:1];
    [(NSMutableDictionary *)self->_newlyConfiguredAccessories setObject:v7 forKeyedSubscript:v6];
  }

  [v7 addObjectsFromArray:v8];

  os_unfair_recursive_lock_unlock();
}

- (id)allNewlyConfiguredAccessories
{
  v16 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  v3 = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  v4 = [(NSMutableDictionary *)self->_newlyConfiguredAccessories allValues];
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = *v12;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(v4);
        }

        [v3 addObjectsFromArray:*(*(&v11 + 1) + 8 * i)];
      }

      v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v5);
  }

  v8 = [v3 copy];
  os_unfair_recursive_lock_unlock();
  v9 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)setAnyBTLEAccessoryReachable:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_anyBTLEAccessoryReachable = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isAnyBTLEAccessoryReachable
{
  os_unfair_recursive_lock_lock_with_options();
  anyBTLEAccessoryReachable = self->_anyBTLEAccessoryReachable;
  os_unfair_recursive_lock_unlock();
  return anyBTLEAccessoryReachable;
}

- (void)setName:(id)a3
{
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [v6 hm_truncatedNameString];
  name = self->_name;
  self->_name = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSString)name
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_name;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (HMDFeaturesDataSource)featuresDataSource
{
  v2 = [(HMDHome *)self dataSource];
  v3 = [v2 featuresDataSource];

  return v3;
}

- (id)dumpStateWithPrivacyLevel:(unint64_t)a3
{
  v200 = *MEMORY[0x277D85DE8];
  v158 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:12];
  v152 = MEMORY[0x277CCACA8];
  v150 = [(HMDHome *)self name];
  v159 = [(HMDHome *)self uuid];
  v5 = [v159 UUIDString];
  v155 = [(HMDHome *)self spiClientIdentifier];
  v6 = [v155 UUIDString];
  v7 = [(HMDHome *)self zoneID];
  v8 = [v7 UUIDString];
  [(HMDHome *)self isMultiUserEnabled];
  v9 = HMFBooleanToString();
  [(HMDHome *)self hasAnyUserAcknowledgedCameraRecordingOnboarding];
  v10 = HMFBooleanToString();
  v11 = [(HMDHome *)self urlString];
  v12 = [v152 stringWithFormat:@"name: %@, uuid: %@, spiClientIdentifier: %@, zoneID: %@, multiUserEnabled: %@, acknowledgedCameraOnboarding: %@, assistantIdentifier: %@", v150, v5, v6, v8, v9, v10, v11];

  v146 = v12;
  [v158 setObject:v12 forKeyedSubscript:*MEMORY[0x277D0F170]];
  v13 = [(HMDHome *)self appData];
  v14 = [v13 dumpStateWithPrivacyLevel:a3];
  [v158 setObject:v14 forKeyedSubscript:*MEMORY[0x277D0F050]];

  v15 = [(HMDHome *)self homeLocationWithPrivacyLevel:a3];
  v16 = v15;
  v17 = MEMORY[0x277CCACA8];
  if (v15)
  {
    v18 = v15;
  }

  else
  {
    v18 = @"Unknown";
  }

  v19 = [(HMDHome *)self homeLocationHandler];
  [v19 regionStateAtHome];
  v20 = HMRegionStateString();
  v21 = [(HMDHome *)self homeLocationHandler];
  [v21 regionStateNearbyHome];
  v22 = HMRegionStateString();
  v160 = self;
  v23 = [(HMDHome *)self atHomeLevel];
  v145 = v16;
  v153 = v21;
  v156 = v19;
  v24 = v20;
  if (v23 > 3)
  {
    v25 = @"HMDAtHomeLevelNotAtHome";
  }

  else
  {
    v25 = off_278670AF0[v23];
  }

  [(HMDHome *)self homeLocation];
  v26 = HMStringFromHomeLocation();
  v27 = [(HMDHome *)self homeLocationHandler];
  v28 = HMDHomeLocationSourceToString([v27 locationSource]);
  v29 = [v17 stringWithFormat:@"Location: %@, At Home Region State: %@, Nearby Home Region State: %@, At Home Level: %@, State: %@, Source: %@", v18, v24, v22, v25, v26, v28];

  v30 = v158;
  v144 = v29;
  [v158 setObject:v29 forKeyedSubscript:*MEMORY[0x277D0F0F8]];
  v31 = [(HMDHome *)self featuresDataSource];
  v32 = [v31 isHomeActivityStateFeatureEnabled];

  if (v32)
  {
    v33 = [(HMDHome *)self homeActivityStateManager];
    v34 = [v33 dumpStateWithPrivacyLevel:a3];
    [v158 setObject:v34 forKeyedSubscript:@"HMDHomeActivityStateManager"];

    v35 = [(HMDHome *)self userActivityStateDetectorManager];
    v36 = [v35 dumpStateWithPrivacyLevel:a3];
    [v158 setObject:v36 forKeyedSubscript:@"HMDUserActivityStateDetectorManager"];
  }

  v37 = MEMORY[0x277CCACA8];
  [(HMDHome *)self minimumMediaUserPrivilege];
  v38 = HMUserPrivilegeToString();
  [(HMDHome *)self isMediaPeerToPeerEnabled];
  v39 = HMFBooleanToString();
  v40 = [(HMDHome *)self mediaPassword];
  v41 = @"<set>";
  if (!v40)
  {
    v41 = @"<null>";
  }

  v42 = [v37 stringWithFormat:@"Minimum Media User Privilege: %@, Media Peer to Peer Enabled: %@, has Media Password: %@", v38, v39, v41];

  v143 = v42;
  [v158 setObject:v42 forKeyedSubscript:@"User Privilege"];
  v43 = [(HMDHome *)self rooms];
  v44 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v43, "count") + 1}];
  v45 = [(HMDHome *)self roomForEntireHome];

  if (v45)
  {
    v46 = [(HMDHome *)self roomForEntireHome];
    v47 = [v46 dumpStateWithPrivacyLevel:a3];
    [v44 addObject:v47];
  }

  v187 = 0u;
  v188 = 0u;
  v185 = 0u;
  v186 = 0u;
  v48 = v43;
  v49 = [v48 countByEnumeratingWithState:&v185 objects:v199 count:16];
  if (v49)
  {
    v50 = v49;
    v51 = *v186;
    do
    {
      for (i = 0; i != v50; ++i)
      {
        if (*v186 != v51)
        {
          objc_enumerationMutation(v48);
        }

        v53 = [*(*(&v185 + 1) + 8 * i) dumpStateWithPrivacyLevel:a3];
        [v44 addObject:v53];
      }

      v50 = [v48 countByEnumeratingWithState:&v185 objects:v199 count:16];
    }

    while (v50);
  }

  if ([v44 count])
  {
    [v158 setObject:v44 forKeyedSubscript:*MEMORY[0x277D0F140]];
  }

  v157 = [(HMDHome *)self zones];
  if ([v157 count])
  {
    v54 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v157, "count")}];
    v181 = 0u;
    v182 = 0u;
    v183 = 0u;
    v184 = 0u;
    v55 = v157;
    v56 = [v55 countByEnumeratingWithState:&v181 objects:v198 count:16];
    if (v56)
    {
      v57 = v56;
      v58 = *v182;
      do
      {
        for (j = 0; j != v57; ++j)
        {
          if (*v182 != v58)
          {
            objc_enumerationMutation(v55);
          }

          v60 = [*(*(&v181 + 1) + 8 * j) dumpStateWithPrivacyLevel:a3];
          [v54 addObject:v60];
        }

        v57 = [v55 countByEnumeratingWithState:&v181 objects:v198 count:16];
      }

      while (v57);
    }

    [v158 setObject:v54 forKeyedSubscript:*MEMORY[0x277D0F198]];
    self = v160;
  }

  v61 = [(HMDHome *)self accessories];
  v62 = [v61 copy];

  v154 = v62;
  if ([v62 count])
  {
    v63 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v62, "count")}];
    v177 = 0u;
    v178 = 0u;
    v179 = 0u;
    v180 = 0u;
    v64 = v154;
    v65 = [v64 countByEnumeratingWithState:&v177 objects:v197 count:16];
    if (v65)
    {
      v66 = v65;
      v67 = *v178;
      do
      {
        for (k = 0; k != v66; ++k)
        {
          if (*v178 != v67)
          {
            objc_enumerationMutation(v64);
          }

          v69 = *(*(&v177 + 1) + 8 * k);
          v70 = objc_autoreleasePoolPush();
          v71 = [v69 dumpStateWithPrivacyLevel:a3];
          [v63 addObject:v71];

          objc_autoreleasePoolPop(v70);
        }

        v66 = [v64 countByEnumeratingWithState:&v177 objects:v197 count:16];
      }

      while (v66);
    }

    v30 = v158;
    [v158 setObject:v63 forKeyedSubscript:*MEMORY[0x277D0F028]];

    self = v160;
  }

  v151 = [(HMDHome *)self serviceGroups];
  if ([v151 count])
  {
    v72 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v151, "count")}];
    v173 = 0u;
    v174 = 0u;
    v175 = 0u;
    v176 = 0u;
    v73 = v151;
    v74 = [v73 countByEnumeratingWithState:&v173 objects:v196 count:16];
    if (v74)
    {
      v75 = v74;
      v76 = *v174;
      do
      {
        for (m = 0; m != v75; ++m)
        {
          if (*v174 != v76)
          {
            objc_enumerationMutation(v73);
          }

          v78 = [*(*(&v173 + 1) + 8 * m) dumpStateWithPrivacyLevel:a3];
          [v72 addObject:v78];
        }

        v75 = [v73 countByEnumeratingWithState:&v173 objects:v196 count:16];
      }

      while (v75);
    }

    [v30 setObject:v72 forKeyedSubscript:*MEMORY[0x277D0F148]];
    self = v160;
  }

  v149 = [(HMDHome *)self triggers];
  if ([v149 count])
  {
    v79 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v149, "count")}];
    v169 = 0u;
    v170 = 0u;
    v171 = 0u;
    v172 = 0u;
    v80 = v149;
    v81 = [v80 countByEnumeratingWithState:&v169 objects:v195 count:16];
    if (v81)
    {
      v82 = v81;
      v83 = *v170;
      do
      {
        for (n = 0; n != v82; ++n)
        {
          if (*v170 != v83)
          {
            objc_enumerationMutation(v80);
          }

          v85 = [*(*(&v169 + 1) + 8 * n) dumpStateWithPrivacyLevel:a3];
          [v79 addObject:v85];
        }

        v82 = [v80 countByEnumeratingWithState:&v169 objects:v195 count:16];
      }

      while (v82);
    }

    [v30 setObject:v79 forKeyedSubscript:*MEMORY[0x277D0F188]];
    self = v160;
  }

  v86 = [(HMDHome *)self currentUser];
  v87 = [v86 dumpStateWithPrivacyLevel:a3];
  [v30 setObject:v87 forKeyedSubscript:*MEMORY[0x277D0F090]];

  v148 = [(HMDHome *)self usersIncludingPendingUsers:1];
  if ([v148 count])
  {
    v88 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v148, "count")}];
    v165 = 0u;
    v166 = 0u;
    v167 = 0u;
    v168 = 0u;
    v89 = v148;
    v90 = [v89 countByEnumeratingWithState:&v165 objects:v194 count:16];
    if (v90)
    {
      v91 = v90;
      v92 = *v166;
      do
      {
        for (ii = 0; ii != v91; ++ii)
        {
          if (*v166 != v92)
          {
            objc_enumerationMutation(v89);
          }

          v94 = [*(*(&v165 + 1) + 8 * ii) dumpStateWithPrivacyLevel:a3];
          [v88 addObject:v94];
        }

        v91 = [v89 countByEnumeratingWithState:&v165 objects:v194 count:16];
      }

      while (v91);
    }

    [v30 setObject:v88 forKeyedSubscript:*MEMORY[0x277D0F190]];
    self = v160;
  }

  v147 = [(HMDHome *)self removedUsers];
  if ([v147 count])
  {
    v95 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v147, "count")}];
    v161 = 0u;
    v162 = 0u;
    v163 = 0u;
    v164 = 0u;
    v96 = v147;
    v97 = [v96 countByEnumeratingWithState:&v161 objects:v193 count:16];
    if (v97)
    {
      v98 = v97;
      v99 = *v162;
      do
      {
        for (jj = 0; jj != v98; ++jj)
        {
          if (*v162 != v99)
          {
            objc_enumerationMutation(v96);
          }

          v101 = [*(*(&v161 + 1) + 8 * jj) user];
          v102 = [v101 dumpStateWithPrivacyLevel:a3];
          [v95 addObject:v102];
        }

        v98 = [v96 countByEnumeratingWithState:&v161 objects:v193 count:16];
      }

      while (v98);
    }

    v30 = v158;
    [v158 setObject:v95 forKeyedSubscript:*MEMORY[0x277D0F130]];

    self = v160;
  }

  v103 = [(HMDHome *)self residentDeviceManager];

  if (v103)
  {
    v104 = [(HMDHome *)self residentDeviceManager];
    v105 = [v104 dumpState];
    [v30 setObject:v105 forKeyedSubscript:*MEMORY[0x277D0F138]];
  }

  v141 = MEMORY[0x277CBEB38];
  v191[0] = @"Registered";
  v142 = [(HMDHome *)self notificationRegistrations];
  v106 = [v142 allObjects];
  v192[0] = v106;
  v191[1] = @"Apple Media Registered";
  v107 = [(HMDHome *)v160 notificationRegistrationsForAppleMediaAccessories];
  v108 = [v107 allObjects];
  v192[1] = v108;
  v191[2] = @"Deregistered";
  v109 = [(HMDHome *)v160 notificationDeregistrations];
  v110 = [v109 allObjects];
  v192[2] = v110;
  v111 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v192 forKeys:v191 count:3];
  v112 = [v141 dictionaryWithDictionary:v111];

  v113 = [(HMDHome *)v160 notificationsUpdatedTime];

  if (v113)
  {
    v114 = [(HMDHome *)v160 notificationsUpdatedTime];
    v115 = [v114 shortDescription];
    [v112 setObject:v115 forKey:@"UpdateTime"];
  }

  [v158 setObject:v112 forKeyedSubscript:*MEMORY[0x277D0F0C8]];
  v116 = [(HMDHome *)v160 pendingResponses];
  v117 = [v116 description];
  [v158 setObject:v117 forKeyedSubscript:*MEMORY[0x277D0F118]];

  v118 = [(HMDHome *)v160 sharedHomeUpdateHandler];
  v119 = [v118 dumpStateWithPrivacyLevel:a3];
  [v158 setObject:v119 forKeyedSubscript:*MEMORY[0x277D0F160]];

  v120 = [(HMDHome *)v160 sharedHomeSourceVersion];
  v121 = [v120 versionString];
  [v158 setObject:v121 forKeyedSubscript:*MEMORY[0x277D0F158]];

  v122 = MEMORY[0x277CCACA8];
  v123 = [(HMDHome *)v160 unfilteredThreadNetworkID];
  v124 = [v122 stringWithFormat:@"threadNetworkID=%@", v123];
  [v158 setObject:v124 forKeyedSubscript:@"ThreadNetwork"];

  v125 = [(HMDHome *)v160 personManagerSettings];
  v126 = [v125 description];
  [v158 setObject:v126 forKeyedSubscript:@"Person Manager Settings"];

  v127 = [(HMDHome *)v160 labelsByAccessCode];
  v128 = [v127 description];
  [v158 setObject:v128 forKeyedSubscript:@"Simple Label Access Codes"];

  v129 = [(HMDHome *)v160 labelIdentifiersByAccessCode];
  v130 = [v129 description];
  [v158 setObject:v130 forKeyedSubscript:@"Simple Label Access Code Identifiers"];

  v131 = [(HMDHome *)v160 chipStorage];
  v132 = [v131 debugDictionaryRepresentation];
  [v158 setObject:v132 forKeyedSubscript:@"CHIP Home Storage"];

  v133 = [(HMDHome *)v160 controllerPrivateStorage];
  v134 = [v133 debugDictionaryRepresentation];
  [v158 setObject:v134 forKeyedSubscript:@"CHIP Controller Private Storage"];

  v189[0] = @"HomeSettingEnabled";
  [(HMDHome *)v160 isEventLogHomeSettingEnabled];
  v135 = HMFBooleanToString();
  v190[0] = v135;
  v189[1] = @"DidOnboard";
  [(HMDHome *)v160 didOnboardEventLog];
  v136 = HMFBooleanToString();
  v190[1] = v136;
  v189[2] = @"Duration";
  v137 = [MEMORY[0x277CCACA8] stringWithFormat:@"%lu", -[HMDHome eventLogDuration](v160, "eventLogDuration")];
  v190[2] = v137;
  v138 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v190 forKeys:v189 count:3];
  [v158 setObject:v138 forKeyedSubscript:@"Activity History"];

  v139 = *MEMORY[0x277D85DE8];

  return v158;
}

- (id)homeLocationWithPrivacyLevel:(unint64_t)a3
{
  if (a3 == 2)
  {
    v3 = [(HMDHome *)self homeLocationHandler];
    v4 = [v3 location];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)descriptionWithPointer:(BOOL)a3
{
  v3 = a3;
  v5 = MEMORY[0x277CCACA8];
  v6 = [objc_opt_class() shortDescription];
  if (v3)
  {
    v7 = [MEMORY[0x277CCACA8] stringWithFormat:@" %p", self];
  }

  else
  {
    v7 = &stru_283CF9D50;
  }

  v8 = [(HMDHome *)self uuid];
  v9 = [v8 UUIDString];
  v10 = [(HMDHome *)self spiClientIdentifier];
  v11 = [v10 UUIDString];
  v12 = [(HMDHome *)self name];
  v13 = [v5 stringWithFormat:@"<%@%@, ID = %@, spiID = %@, NM = %@>", v6, v7, v9, v11, v12];

  if (v3)
  {
  }

  return v13;
}

- (id)shortDescription
{
  if (isInternalBuild())
  {
    v3 = MEMORY[0x277CCACA8];
    v4 = [(HMDHome *)self name];
    v5 = [(HMDHome *)self uuid];
    v6 = [v3 stringWithFormat:@"%@/%@", v4, v5];
  }

  else
  {
    v4 = [(HMDHome *)self uuid];
    v6 = [v4 UUIDString];
  }

  return v6;
}

- (void)dealloc
{
  [(HMDHome *)self unconfigure];
  v3.receiver = self;
  v3.super_class = HMDHome;
  [(HMDHome *)&v3 dealloc];
}

- (void)unconfigure
{
  v3 = [(HMDHome *)self notificationCenter];
  [v3 removeObserver:self];

  v4 = [(HMDHome *)self msgDispatcher];
  [v4 deregisterReceiver:self];

  v5 = [(HMDHome *)self mediaGroupsAggregateConsumer];
  [v5 unconfigure];

  v6 = [(HMDHome *)self accessCodeManager];
  [v6 unconfigure];

  v7 = [(HMDHome *)self nfcReaderKeyManager];
  [v7 unconfigure];

  v8 = [(HMDHome *)self walletKeyManager];
  [v8 unconfigure];

  v9 = [(HMDHome *)self homeActivityStateManager];
  [v9 unconfigure];

  v10 = [(HMDHome *)self swiftExtensions];
  [v10 unconfigureWithHome:self];

  v12 = [MEMORY[0x277CCAB98] defaultCenter];
  v11 = [(HMDHome *)self backingStore];
  [v12 removeObserver:v11];
}

- (HMDHome)initWithName:(id)a3 uuid:(id)a4 defaultRoomUUID:(id)a5 owner:(id)a6 homeManager:(id)a7 presenceAuth:(id)a8 dataSource:(id)a9 logEventSubmitter:(id)a10 carPlayDataSource:(id)a11 administratorHandlerFactory:(id)a12 localCapabilitiesDataSource:(id)a13 notificationCenter:(id)a14 keychainStore:(id)a15
{
  v328 = *MEMORY[0x277D85DE8];
  v309 = a3;
  v312 = a4;
  v308 = a5;
  v315 = a6;
  obj = a7;
  v20 = a8;
  v311 = a8;
  v21 = a9;
  v313 = a10;
  v303 = a11;
  v307 = a12;
  v304 = a13;
  v310 = a14;
  v305 = a15;
  v323.receiver = self;
  v323.super_class = HMDHome;
  v22 = [(HMDHome *)&v323 init];
  v23 = v22;
  if (v22)
  {
    objc_storeStrong(&v22->_dataSource, a9);
    +[HMDHome _initialize];
    v302 = [obj sharedUserAcceptEventBuilderForHomeUuid:v312];
    [v302 markCreatedHome];
    objc_storeStrong(&v23->_localCapabilitiesDataSource, a13);
    v24 = HMFGetOSLogHandle();
    logger = v23->_logger;
    v23->_logger = v24;

    if (v312)
    {
      v301 = [v312 copy];
    }

    else
    {
      v301 = [MEMORY[0x277CCAD78] UUID];
    }

    v26 = [MEMORY[0x277D0F890] hmf_cachedInstanceForNSUUID:v301];
    uuid = v23->_uuid;
    v23->_uuid = v26;

    v300 = spiClientIdentifierForUUID(v23->_uuid);
    v28 = [MEMORY[0x277D0F890] hmf_cachedInstanceForNSUUID:v300];
    spiClientIdentifier = v23->_spiClientIdentifier;
    v23->_spiClientIdentifier = v28;

    v30 = [(NSUUID *)v23->_uuid UUIDString];
    v306 = [@"com.apple.hmd.home" stringByAppendingString:v30];

    v31 = v306;
    v32 = [v306 UTF8String];
    v33 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
    v34 = dispatch_queue_create(v32, v33);
    workQueue = v23->_workQueue;
    v23->_workQueue = v34;

    [MEMORY[0x277D0F7A8] blessWithImplicitContext:v23->_workQueue];
    objc_storeStrong(&v23->_notificationCenter, a14);
    v36 = [[HMDPrimaryResidentChangeMonitor alloc] initWithIdentifier:v23->_uuid notificationCenter:v310];
    primaryResidentChangeMonitor = v23->_primaryResidentChangeMonitor;
    v23->_primaryResidentChangeMonitor = v36;

    [(HMDPrimaryResidentChangeMonitor *)v23->_primaryResidentChangeMonitor setDataSource:v23];
    objc_storeStrong(&v23->_logEventSubmitter, a10);
    objc_storeStrong(&v23->_keychainStore, a15);
    v38 = [v21 makeReportingSessionManager];
    reportingSessionManager = v23->_reportingSessionManager;
    v23->_reportingSessionManager = v38;

    if (v313)
    {
      v40 = [v21 makeHomeMetricsDispatcherWithIdentifier:v23->_uuid logEventSubmitter:v313];
      metricsDispatcher = v23->_metricsDispatcher;
      v23->_metricsDispatcher = v40;
    }

    v42 = [v309 hm_truncatedNameString];
    v43 = [v42 copy];
    name = v23->_name;
    v23->_name = v43;

    v45 = [HMDHome zoneIDFromHomeUUID:v23->_uuid];
    zoneID = v23->_zoneID;
    v23->_zoneID = v45;

    objc_storeWeak(&v23->_homeManager, obj);
    v47 = [obj messageDispatcher];
    msgDispatcher = v23->_msgDispatcher;
    v23->_msgDispatcher = v47;

    objc_storeStrong(&v23->_owner, a6);
    v23->_ownerTrustZoneCapable = [v315 isCurrentUser];
    v49 = [v315 pairingUsername];
    ownerName = v23->_ownerName;
    v23->_ownerName = v49;

    v23->_allowsRemoteAccess = 1;
    v51 = +[HMDHomeKitVersion currentVersion];
    currentHomeKitVersion = v23->_currentHomeKitVersion;
    v23->_currentHomeKitVersion = v51;

    v53 = objc_autoreleasePoolPush();
    v54 = v23;
    v55 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v55, OS_LOG_TYPE_INFO))
    {
      v56 = HMFGetLogIdentifier();
      *buf = 138543618;
      v325 = v56;
      v326 = 2112;
      v327 = v311;
      _os_log_impl(&dword_229538000, v55, OS_LOG_TYPE_INFO, "%{public}@Home Presence auth : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v53);
    if (v311)
    {
      objc_storeStrong(&v54->_presenceAuthStatus, v20);
    }

    presenceComputeStatus = v54->_presenceComputeStatus;
    v54->_presenceComputeStatus = 0;

    v54->_homeLocation = 0;
    v58 = [MEMORY[0x277CBEB58] set];
    reachabilityUpdatedAccessories = v54->_reachabilityUpdatedAccessories;
    v54->_reachabilityUpdatedAccessories = v58;

    v60 = [[HMDHomeObjectChangeHandler alloc] initWithHome:v54];
    homeObjectChangeHandler = v54->_homeObjectChangeHandler;
    v54->_homeObjectChangeHandler = v60;

    v62 = [obj accessoryBrowser];
    accessoryBrowser = v54->_accessoryBrowser;
    v54->_accessoryBrowser = v62;

    v64 = [MEMORY[0x277CBEB18] array];
    rooms = v54->_rooms;
    v54->_rooms = v64;

    v66 = [MEMORY[0x277CBEB18] array];
    zones = v54->_zones;
    v54->_zones = v66;

    v68 = [MEMORY[0x277CBEB38] dictionary];
    accessories = v54->_accessories;
    v54->_accessories = v68;

    v70 = [MEMORY[0x277CBEB18] array];
    serviceGroups = v54->_serviceGroups;
    v54->_serviceGroups = v70;

    v72 = [MEMORY[0x277CBEB18] array];
    actionSets = v54->_actionSets;
    v54->_actionSets = v72;

    v74 = [MEMORY[0x277CBEB18] array];
    currentTriggers = v54->_currentTriggers;
    v54->_currentTriggers = v74;

    v76 = [MEMORY[0x277CBEB18] array];
    triggerOwnedActionSets = v54->_triggerOwnedActionSets;
    v54->_triggerOwnedActionSets = v76;

    v78 = [MEMORY[0x277CBEB18] array];
    users = v54->_users;
    v54->_users = v78;

    v80 = [MEMORY[0x277CBEB18] array];
    usersPendingUserManagementOperations = v54->_usersPendingUserManagementOperations;
    v54->_usersPendingUserManagementOperations = v80;

    v82 = [MEMORY[0x277CBEB18] array];
    removedUsers = v54->_removedUsers;
    v54->_removedUsers = v82;

    v84 = [MEMORY[0x277CBEB18] array];
    outgoingInvitations = v54->_outgoingInvitations;
    v54->_outgoingInvitations = v84;

    v86 = [MEMORY[0x277CBEB18] array];
    ownedTriggers = v54->_ownedTriggers;
    v54->_ownedTriggers = v86;

    v88 = [MEMORY[0x277CBEB58] set];
    pendingResponsesForRemoteAccessSetup = v54->_pendingResponsesForRemoteAccessSetup;
    v54->_pendingResponsesForRemoteAccessSetup = v88;

    v90 = [MEMORY[0x277CBEB38] dictionary];
    enableNotificationPayload = v54->_enableNotificationPayload;
    v54->_enableNotificationPayload = v90;

    v92 = [MEMORY[0x277CBEB38] dictionary];
    disableNotificationPayload = v54->_disableNotificationPayload;
    v54->_disableNotificationPayload = v92;

    v94 = [MEMORY[0x277CBEB38] dictionary];
    pendingCharacteristicThresholdPayload = v54->_pendingCharacteristicThresholdPayload;
    v54->_pendingCharacteristicThresholdPayload = v94;

    v96 = [MEMORY[0x277CBEB18] array];
    actionSetsEnableNotificationPayload = v54->_actionSetsEnableNotificationPayload;
    v54->_actionSetsEnableNotificationPayload = v96;

    v98 = [MEMORY[0x277CBEB18] array];
    actionSetsDisableNotificationPayload = v54->_actionSetsDisableNotificationPayload;
    v54->_actionSetsDisableNotificationPayload = v98;

    v100 = [MEMORY[0x277CBEB38] dictionary];
    matterAttributesEnableNotificationPayload = v54->_matterAttributesEnableNotificationPayload;
    v54->_matterAttributesEnableNotificationPayload = v100;

    v102 = [MEMORY[0x277CBEB38] dictionary];
    notificationHandlerMap = v54->_notificationHandlerMap;
    v54->_notificationHandlerMap = v102;

    v104 = [MEMORY[0x277CBEB58] set];
    notificationRegistrations = v54->_notificationRegistrations;
    v54->_notificationRegistrations = v104;

    v106 = [MEMORY[0x277CBEB58] set];
    notificationRegistrationsForAppleMediaAccessories = v54->_notificationRegistrationsForAppleMediaAccessories;
    v54->_notificationRegistrationsForAppleMediaAccessories = v106;

    v108 = [MEMORY[0x277CBEB58] set];
    notificationDeregistrations = v54->_notificationDeregistrations;
    v54->_notificationDeregistrations = v108;

    v110 = [MEMORY[0x277CBEAA8] distantFuture];
    notificationsUpdatedTime = v54->_notificationsUpdatedTime;
    v54->_notificationsUpdatedTime = v110;

    v112 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    uuidToHAPAccessoryConfigTable = v54->_uuidToHAPAccessoryConfigTable;
    v54->_uuidToHAPAccessoryConfigTable = v112;

    v114 = +[HMDAppleAccountSettings sharedSettings];
    accountSettings = v54->_accountSettings;
    v54->_accountSettings = v114;

    objc_storeStrong(&v54->_carPlayDataSource, a11);
    if (isiOSDevice())
    {
      v116 = [MEMORY[0x277CBEB58] set];
      heartbeatPingMessagesQueuedWithServer = v54->_heartbeatPingMessagesQueuedWithServer;
      v54->_heartbeatPingMessagesQueuedWithServer = v116;
    }

    if (v315)
    {
      [(NSMutableArray *)v54->_users addObject:v315];
      [v315 setHome:v54];
    }

    v118 = [HMDRoom alloc];
    v119 = HMDDefaultRoomName();
    v120 = [(HMDRoom *)v118 initWithName:v119 uuid:v308 home:v54];
    roomForEntireHome = v54->_roomForEntireHome;
    v54->_roomForEntireHome = v120;

    v54->_configurationVersion = 0;
    v54->_previousReachableAccessoriesCount = 0;
    v54->_previousReachableAppleMediaAccessoriesCount = 0;
    v122 = [MEMORY[0x277CBEB18] array];
    unconfiguredResidentDevices = v54->_unconfiguredResidentDevices;
    v54->_unconfiguredResidentDevices = v122;

    v124 = [MEMORY[0x277CCAA50] weakObjectsHashTable];
    removeAccessoryInProgressForHMDAccessories = v54->_removeAccessoryInProgressForHMDAccessories;
    v54->_removeAccessoryInProgressForHMDAccessories = v124;

    v126 = [MEMORY[0x277CBEB18] array];
    retrievalAccessoryCompletionTuples = v54->_retrievalAccessoryCompletionTuples;
    v54->_retrievalAccessoryCompletionTuples = v126;

    v128 = [MEMORY[0x277CBEB18] array];
    accessoryRemoteReachabilityEnabledClients = v54->_accessoryRemoteReachabilityEnabledClients;
    v54->_accessoryRemoteReachabilityEnabledClients = v128;

    objc_initWeak(&location, v54);
    v130 = [HMDManagedStagedValue alloc];
    v131 = [MEMORY[0x277D0F788] BOOLeanWithBool:0];
    v320[0] = MEMORY[0x277D85DD0];
    v320[1] = 3221225472;
    v320[2] = __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke;
    v320[3] = &unk_27866F810;
    objc_copyWeak(&v321, &location);
    v132 = [(HMDManagedStagedValue *)v130 initWithValue:v131 commitBlock:v320];
    stagedRemoteReachabilityRegistration = v54->_stagedRemoteReachabilityRegistration;
    v54->_stagedRemoteReachabilityRegistration = v132;

    v134 = [MEMORY[0x277CBEB18] array];
    reachabilityRegisteredDevices = v54->_reachabilityRegisteredDevices;
    v54->_reachabilityRegisteredDevices = v134;

    v136 = [MEMORY[0x277CBEB18] array];
    remoteReachabilityNotificationPendingAccessories = v54->_remoteReachabilityNotificationPendingAccessories;
    v54->_remoteReachabilityNotificationPendingAccessories = v136;

    v138 = [MEMORY[0x277CBEB38] dictionary];
    pendingResponses = v54->_pendingResponses;
    v54->_pendingResponses = v138;

    v140 = [v21 makeHomeLocationHandler];
    homeLocationHandler = v54->_homeLocationHandler;
    v54->_homeLocationHandler = v140;

    v142 = [v21 makeHomeReprovisionHandler];
    homeReprovisionHandler = v54->_homeReprovisionHandler;
    v54->_homeReprovisionHandler = v142;

    v144 = [MEMORY[0x277CBEB38] dictionary];
    newlyConfiguredAccessories = v54->_newlyConfiguredAccessories;
    v54->_newlyConfiguredAccessories = v144;

    v146 = [MEMORY[0x277CCAB00] mapTableWithKeyOptions:512 valueOptions:0];
    addPendingAccessories = v54->_addPendingAccessories;
    v54->_addPendingAccessories = v146;

    v148 = [MEMORY[0x277CBEB38] dictionary];
    addPendingAccessorySetupCodes = v54->_addPendingAccessorySetupCodes;
    v54->_addPendingAccessorySetupCodes = v148;

    v150 = [MEMORY[0x277CBEB38] dictionary];
    addPendingAccessoryOnboardingSetupPayloadStrings = v54->_addPendingAccessoryOnboardingSetupPayloadStrings;
    v54->_addPendingAccessoryOnboardingSetupPayloadStrings = v150;

    v152 = [MEMORY[0x277CBEB38] dictionary];
    addPendingAccessorySetupCodeHandlers = v54->_addPendingAccessorySetupCodeHandlers;
    v54->_addPendingAccessorySetupCodeHandlers = v152;

    v54->_anyBTLEAccessoryReachable = 0;
    v154 = [v21 makeResidentDeviceManagerWithHomeUUID:v23->_uuid];
    residentDeviceManager = v54->_residentDeviceManager;
    v54->_residentDeviceManager = v154;

    [(HMDResidentDeviceManager *)v54->_residentDeviceManager setDelegate:v54];
    v319 = 0;
    v156 = [MEMORY[0x277D0F7C0] futureWithPromise:&v319];
    residentSyncClientDidSyncFuture = v54->_residentSyncClientDidSyncFuture;
    v54->_residentSyncClientDidSyncFuture = v156;

    objc_storeStrong(&v54->_residentSyncClientDidSyncPromise, v319);
    v158 = v307[2](v307, v54);
    administratorHandler = v54->_administratorHandler;
    v54->_administratorHandler = v158;

    v160 = [HMDHomeMediaSystemHandler alloc];
    v161 = [(HMDHomeMediaSystemHandler *)v160 initWithMediaSystems:MEMORY[0x277CBEBF8]];
    mediaSystemController = v54->_mediaSystemController;
    v54->_mediaSystemController = v161;

    v54->_automaticSoftwareUpdateEnabled = 1;
    v54->_automaticThirdPartyAccessorySoftwareUpdateEnabled = 0;
    v54->_protectionMode = 0;
    v54->_networkRouterSupportDisableReason = 0;
    v54->_networkRouterSupport = [(HMDHome *)v54 deriveNetworkRouterSupport:0];
    v54->_mediaPeerToPeerEnabled = 0;
    v54->_soundCheckEnabled = 1;
    v163 = [v21 makeNotificationRegistry];
    notificationRegistry = v54->_notificationRegistry;
    v54->_notificationRegistry = v163;

    [(HMDNotificationRegistry *)v54->_notificationRegistry configureWithHome:v54];
    v165 = [MEMORY[0x277CBEB18] array];
    mediaSessions = v54->_mediaSessions;
    v54->_mediaSessions = v165;

    v167 = [MEMORY[0x277CBEB18] array];
    mediaSessionStates = v54->_mediaSessionStates;
    v54->_mediaSessionStates = v167;

    v169 = [MEMORY[0x277CCAA50] weakObjectsHashTable];
    connectionsDiscoveringSymptomsForNearbyDevices = v54->_connectionsDiscoveringSymptomsForNearbyDevices;
    v54->_connectionsDiscoveringSymptomsForNearbyDevices = v169;

    isWatch();
    if (v315 && [(HMDHomeLocalDeviceCapabilitiesDataSource *)v23->_localCapabilitiesDataSource isResidentCapable])
    {
      v171 = [(HMDHome *)v54 featuresDataSource];
      v172 = [v171 isHomeActivityStateReplacesPresenceMonitorFeatureEnabled];

      if ((v172 & 1) == 0)
      {
        v173 = [(HMDHome *)v54 dataSource];
        v174 = [v173 makeHomePresenceMonitor];
        presenceMonitor = v54->_presenceMonitor;
        v54->_presenceMonitor = v174;
      }

      v176 = objc_alloc_init(HMDHomePeriodicReader);
      periodicReader = v54->_periodicReader;
      v54->_periodicReader = v176;
    }

    v178 = [(HMDHome *)v54 featuresDataSource];
    v179 = [v178 isHomeActivityStateFeatureEnabled];

    if ((v179 & 1) == 0)
    {
      v180 = objc_alloc_init(HMDUserPresenceFeeder);
      presenceFeeder = v54->_presenceFeeder;
      v54->_presenceFeeder = v180;

      v182 = objc_autoreleasePoolPush();
      v183 = v54;
      v184 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v184, OS_LOG_TYPE_INFO))
      {
        v185 = HMFGetLogIdentifier();
        v186 = [(HMDHome *)v183 presenceFeeder];
        *buf = 138543618;
        v325 = v185;
        v326 = 2112;
        v327 = v186;
        _os_log_impl(&dword_229538000, v184, OS_LOG_TYPE_INFO, "%{public}@Allocated presenceFeeder on HMDHome: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v182);
    }

    v187 = [HMDPredicateUtilities alloc];
    v188 = [(HMDHome *)v54 name];
    v189 = [(HMDPredicateUtilities *)v187 initWithHome:v54 logIdentifier:v188];
    predicateUtility = v54->_predicateUtility;
    v54->_predicateUtility = v189;

    v191 = [[HMDMediaActionRouter alloc] initWithDataSource:v54];
    mediaActionRouter = v54->_mediaActionRouter;
    v54->_mediaActionRouter = v191;

    v54->_multiUserEnabled = 1;
    v54->_hasAnyUserAcknowledgedCameraRecordingOnboarding = 0;
    v193 = [HMDAccessoryNetworkProtectionGroupRegistry alloc];
    v194 = [(HMDHome *)v54 notificationCenter];
    v195 = [(HMDAccessoryNetworkProtectionGroupRegistry *)v193 initWithHome:v54 notificationCenter:v194];
    networkProtectionGroupRegistry = v54->_networkProtectionGroupRegistry;
    v54->_networkProtectionGroupRegistry = v195;

    v197 = [HMDResidentReachabilityNotificationManager alloc];
    v198 = objc_alloc_init(HMDResidentReachabilityContext);
    v199 = [(HMDResidentReachabilityNotificationManager *)v197 initWithResidentReachabilityContext:v198 workQueue:v23->_workQueue];
    reachabilityNotificationManager = v54->_reachabilityNotificationManager;
    v54->_reachabilityNotificationManager = v199;

    v201 = [[HMDAccessoryReachabilityChangedLogEventManager alloc] initWithHome:v54];
    reachabilityChangedLogEventManager = v54->_reachabilityChangedLogEventManager;
    v54->_reachabilityChangedLogEventManager = v201;

    v203 = [v21 makeNaturalLightingCurveWriterWithHome:v54];
    naturalLightingCurveWriter = v54->_naturalLightingCurveWriter;
    v54->_naturalLightingCurveWriter = v203;

    if (isInternalBuild() && ((_os_feature_enabled_impl() & 1) != 0 || _os_feature_enabled_impl()))
    {
      v205 = objc_autoreleasePoolPush();
      v206 = v54;
      v207 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v207, OS_LOG_TYPE_INFO))
      {
        v208 = HMFGetLogIdentifier();
        *buf = 138543362;
        v325 = v208;
        _os_log_impl(&dword_229538000, v207, OS_LOG_TYPE_INFO, "%{public}@Initialized HomeIntelligenceActivityLogger", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v205);
      v209 = [[HomeIntelligenceActivityLogger alloc] initWithHome:v206];
      homeIntelligenceActivityLogger = v206->_homeIntelligenceActivityLogger;
      v206->_homeIntelligenceActivityLogger = v209;
    }

    v211 = [HMDHAPAccessoryConnectionCoordinator alloc];
    v212 = [(HMDHome *)v54 notificationCenter];
    v213 = [(HMDHAPAccessoryConnectionCoordinator *)v211 initWithHome:v54 notificationCenter:v212];
    accessoryConnectionCoordinator = v54->_accessoryConnectionCoordinator;
    v54->_accessoryConnectionCoordinator = v213;

    v215 = [[HMDHAPAccessoryReaderWriter alloc] initWithHome:v54];
    accessoryReaderWriter = v54->_accessoryReaderWriter;
    v54->_accessoryReaderWriter = v215;

    v217 = [[HMDHomePersonDataManager alloc] initWithHome:v54 workQueue:v23->_workQueue];
    personDataManager = v54->_personDataManager;
    v54->_personDataManager = v217;

    v219 = [[HMDHomeWalletKeyManager alloc] initWithUUID:v23->_uuid workQueue:v23->_workQueue];
    walletKeyManager = v54->_walletKeyManager;
    v54->_walletKeyManager = v219;

    v221 = objc_autoreleasePoolPush();
    v222 = v54;
    v223 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v223, OS_LOG_TYPE_DEFAULT))
    {
      v224 = HMFGetLogIdentifier();
      *buf = 138543362;
      v325 = v224;
      _os_log_impl(&dword_229538000, v223, OS_LOG_TYPE_DEFAULT, "%{public}@Created wallet key manager", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v221);
    v222->_dbWriteLock._os_unfair_lock_opaque = 0;
    v225 = [v21 makeNFCReaderKeyManagerWithHomeUUID:v23->_uuid workQueue:v23->_workQueue];
    nfcReaderKeyManager = v222->_nfcReaderKeyManager;
    v222->_nfcReaderKeyManager = v225;

    v227 = objc_autoreleasePoolPush();
    v228 = v222;
    v229 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v229, OS_LOG_TYPE_DEFAULT))
    {
      v230 = HMFGetLogIdentifier();
      *buf = 138543362;
      v325 = v230;
      _os_log_impl(&dword_229538000, v229, OS_LOG_TYPE_DEFAULT, "%{public}@Created nfc reader key manager", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v227);
    v228->_shouldEncodeHasOnboardedForWalletKey = 1;
    v228->_shouldEncodeNFCReaderKey = 1;
    v231 = [MEMORY[0x277CBEB38] dictionary];
    labelsByAccessCode = v228->_labelsByAccessCode;
    v228->_labelsByAccessCode = v231;

    v233 = [MEMORY[0x277CBEB38] dictionary];
    labelIdentifiersByAccessCode = v228->_labelIdentifiersByAccessCode;
    v228->_labelIdentifiersByAccessCode = v233;

    v235 = [HMDLastSeenStatusManager alloc];
    v236 = [(HMDHome *)v228 workQueue];
    v237 = [(HMDLastSeenStatusManager *)v235 initWithHome:v228 queue:v236];
    lastSeenStatusManager = v228->_lastSeenStatusManager;
    v228->_lastSeenStatusManager = v237;

    v239 = [MEMORY[0x277CBEB38] dictionary];
    removedUserInfoByAccessCode = v228->_removedUserInfoByAccessCode;
    v228->_removedUserInfoByAccessCode = v239;

    v241 = [HMDAccessCodeManagerContext alloc];
    v242 = [(HMDHome *)v228 workQueue];
    v243 = [(HMDAccessCodeManagerContext *)v241 initWithHome:v228 workQueue:v242];

    v244 = [[HMDAccessCodeManager alloc] initWithContext:v243];
    accessCodeManager = v228->_accessCodeManager;
    v228->_accessCodeManager = v244;

    v246 = [(HMDHome *)v228 uuid];
    v247 = [(HMDHome *)v228 workQueue];
    v248 = [v21 makeLockNotificationManagerWithHomeUUID:v246 workQueue:v247];
    lockNotificationManager = v228->_lockNotificationManager;
    v228->_lockNotificationManager = v248;

    v250 = [[HMDCameraAnalysisStatePublisher alloc] initWithHome:v228];
    analysisStatePublisher = v228->_analysisStatePublisher;
    v228->_analysisStatePublisher = v250;

    if ([(HMDHomeLocalDeviceCapabilitiesDataSource *)v23->_localCapabilitiesDataSource isResidentCapable])
    {
      v252 = [[HMDHomeRemoteEventAccessController alloc] initWithDataSource:v228];
      homeRemoteEventAccessController = v228->_homeRemoteEventAccessController;
      v228->_homeRemoteEventAccessController = v252;
    }

    v254 = objc_alloc_init(HMDHomeAudioAnalysisStereoPairController);
    audioAnalysisStereoPairController = v228->_audioAnalysisStereoPairController;
    v228->_audioAnalysisStereoPairController = v254;

    v256 = objc_autoreleasePoolPush();
    v257 = v228;
    v258 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v258, OS_LOG_TYPE_DEFAULT))
    {
      v259 = HMFGetLogIdentifier();
      *buf = 138543362;
      v325 = v259;
      _os_log_impl(&dword_229538000, v258, OS_LOG_TYPE_DEFAULT, "%{public}@Creating setup metric dispatchers for media system and home theater", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v256);
    v260 = [[HMDMediaGroupSetupMetricDispatcher alloc] initWithDataSource:v257 logEventSubmitter:v313];
    v261 = v257[206];
    v257[206] = v260;

    v262 = [[HMDMediaGroupSetupMetricDispatcher alloc] initWithDataSource:v257 logEventSubmitter:v313];
    v263 = v257[207];
    v257[207] = v262;

    v264 = objc_alloc_init(HMDCHIPHomeStorage);
    v265 = v257[195];
    v257[195] = v264;

    if ([v257 isFeatureMatterLocalFabricConfigEnabled])
    {
      v266 = [MEMORY[0x277CBEB18] array];
      v267 = v257[150];
      v257[150] = v266;

      v268 = [[HMDCHIPControllerPrivateStorage alloc] initWithHome:v257];
      v269 = v257[197];
      v257[197] = v268;

      v270 = objc_alloc(MEMORY[0x277D17AE8]);
      v271 = [v257 workQueue];
      v272 = [v270 initWithDelegate:v257 queue:v271];
      v273 = v257[198];
      v257[198] = v272;

      [v257[198] setControllerEntityIdentifier:v23->_uuid];
      LODWORD(v270) = [v315 isCurrentUser];
      v274 = [v257[198] accessControl];
      [v274 setCurrentUserPrivilege:v270];

      v275 = [v257[198] accessControl];
      LODWORD(v270) = [v275 currentUserPrivilege] == 0;

      if (v270)
      {
        objc_initWeak(buf, v257);
        v317[0] = MEMORY[0x277D85DD0];
        v317[1] = 3221225472;
        v317[2] = __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke_722;
        v317[3] = &unk_27866F838;
        objc_copyWeak(&v318, buf);
        v276 = [v257[198] accessControl];
        [v276 setPrivilegeGetter:v317];

        objc_destroyWeak(&v318);
        objc_destroyWeak(buf);
      }
    }

    v257[216] = 0;
    v257[217] = 0;
    v277 = [MEMORY[0x277CCAD78] UUID];
    v278 = v257[201];
    v257[201] = v277;

    v279 = [MEMORY[0x277CBEB18] array];
    v280 = v257[202];
    v257[202] = v279;

    v281 = [v257 featuresDataSource];
    v282 = [v281 isHomeActivityStateFeatureEnabled];

    if (v282)
    {
      v283 = [v257 dataSource];
      v284 = [v283 makeHomeActivityStateManagerWithHome:v257];
      v285 = v257[107];
      v257[107] = v284;
    }

    v286 = objc_alloc_init(MEMORY[0x277CBEB38]);
    [v286 setObject:@"com.apple.home.hh2.hmmm.rid" forKeyedSubscript:@"com.apple.DistributedTimers.request"];
    [v286 setObject:@"hmmm.client.rid.prefix_com.apple.private.alloy.energykit" forKeyedSubscript:@"EnergyKitShareRequest_v1"];
    v287 = [v21 makeModernMessagingHandlerWithMappings:v286];
    v288 = v257[142];
    v257[142] = v287;

    v289 = [v257 featuresDataSource];
    v290 = [v289 isStateSyncEnabled];

    if (v290)
    {
      v291 = v54->_residentDeviceManager;
      v292 = [HMDStateSyncManager alloc];
      v293 = [v257 workQueue];
      v294 = [(HMDStateSyncManager *)v292 initWithHome:v257 queue:v293 residentDeviceManagerContext:v291];
      v295 = v257[208];
      v257[208] = v294;
    }

    v296 = [v21 makeSwiftExtensionsWithHome:v257];
    v297 = v257[109];
    v257[109] = v296;

    objc_destroyWeak(&v321);
    objc_destroyWeak(&location);
  }

  v298 = *MEMORY[0x277D85DE8];
  return v23;
}

void __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v7 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (v7)
  {
    [WeakRetained _registerForReachabilityChangeNotificationsEnabled:objc_msgSend(v7 completionHandler:{"BOOLValue"), v5}];
  }
}

unint64_t __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke_722(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained)
  {
    v3 = [WeakRetained currentUser];
    v4 = +[HMDUser hmmtrUserPrivilegeFromHMDUserPrivilege:](HMDUser, "hmmtrUserPrivilegeFromHMDUserPrivilege:", [v3 privilege]);
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (HMDHome)initWithName:(id)a3 uuid:(id)a4 defaultRoomUUID:(id)a5 owner:(id)a6 homeManager:(id)a7 presenceAuth:(id)a8 dataSource:(id)a9
{
  v15 = a9;
  v29 = a8;
  v16 = a7;
  v26 = a6;
  v17 = a5;
  v18 = a4;
  v19 = a3;
  v30 = [v16 metricsManager];
  v20 = [v30 logEventSubmitter];
  v25 = objc_alloc_init(HMDCarPlayDataSource);
  v24 = objc_alloc_init(HMDHomeLocalDeviceCapabilitiesDataSource);
  v21 = [MEMORY[0x277CCAB98] defaultCenter];
  v22 = [MEMORY[0x277CFEC78] systemStore];
  v28 = [(HMDHome *)self initWithName:v19 uuid:v18 defaultRoomUUID:v17 owner:v26 homeManager:v16 presenceAuth:v29 dataSource:v15 logEventSubmitter:v20 carPlayDataSource:v25 administratorHandlerFactory:&__block_literal_global_670 localCapabilitiesDataSource:v24 notificationCenter:v21 keychainStore:v22];

  return v28;
}

HMDHomeAdministratorHandler *__87__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [[HMDHomeAdministratorHandler alloc] initWithHome:v2];

  return v3;
}

uint64_t __58__HMDHome_filterAllowedToPostBulletinFromCharacteristics___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 service];
  v3 = [v2 accessory];
  v4 = [v3 home];
  v5 = [v4 shouldPostBulletin];

  return v5;
}

+ (void)dumpAccessories:(id)a3 usingTag:(id)a4 flow:(id)a5
{
  v8 = a4;
  v9 = a5;
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __41__HMDHome_dumpAccessories_usingTag_flow___block_invoke;
  v12[3] = &unk_278670A10;
  v14 = v8;
  v15 = a1;
  v13 = v9;
  v10 = v8;
  v11 = v9;
  [a3 hmf_enumerateWithAutoreleasePoolUsingBlock:v12];
}

void __41__HMDHome_dumpAccessories_usingTag_flow___block_invoke(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 48);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 32) UUID];
    v9 = *(a1 + 40);
    v10 = [v3 modelID];
    v11 = [v3 castIfHAPAccessory];
    v14 = 138544386;
    v12 = @"YES";
    v15 = v7;
    if (!v11)
    {
      v12 = @"NO";
    }

    v16 = 2112;
    v17 = v8;
    v18 = 2112;
    v19 = v9;
    v20 = 2112;
    v21 = v10;
    v22 = 2112;
    v23 = v12;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] %@ : %@ (isHAPAccessory : %@)", &v14, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  v13 = *MEMORY[0x277D85DE8];
}

+ (id)logCategory
{
  if (logCategory__hmf_once_t1541 != -1)
  {
    dispatch_once(&logCategory__hmf_once_t1541, &__block_literal_global_2074);
  }

  v3 = logCategory__hmf_once_v1542;

  return v3;
}

void __22__HMDHome_logCategory__block_invoke()
{
  v0 = *MEMORY[0x277D0F1A8];
  v1 = HMFCreateOSLogHandle();
  v2 = logCategory__hmf_once_v1542;
  logCategory__hmf_once_v1542 = v1;
}

+ (id)supportedAccessoryClasses
{
  if (supportedAccessoryClasses_onceToken != -1)
  {
    dispatch_once(&supportedAccessoryClasses_onceToken, &__block_literal_global_1989);
  }

  v3 = supportedAccessoryClasses_supportedAccessoryClasses;

  return v3;
}

void __36__HMDHome_supportedAccessoryClasses__block_invoke()
{
  v5[2] = *MEMORY[0x277D85DE8];
  v0 = MEMORY[0x277CBEB98];
  v5[0] = objc_opt_class();
  v5[1] = objc_opt_class();
  v1 = [MEMORY[0x277CBEA60] arrayWithObjects:v5 count:2];
  v2 = [v0 setWithArray:v1];
  v3 = supportedAccessoryClasses_supportedAccessoryClasses;
  supportedAccessoryClasses_supportedAccessoryClasses = v2;

  v4 = *MEMORY[0x277D85DE8];
}

+ (void)appendCharacteristicsToAccessoryList:(id)a3 responseTuples:(id)a4 forMultipleCharacteristicsRemoteRead:(id)a5
{
  v39 = *MEMORY[0x277D85DE8];
  v33 = a3;
  v30 = a4;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = a5;
  v7 = [obj countByEnumeratingWithState:&v34 objects:v38 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v35;
    v29 = *MEMORY[0x277CCFD28];
    do
    {
      v10 = 0;
      v31 = v8;
      do
      {
        if (*v35 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v34 + 1) + 8 * v10);
        v12 = [v11 characteristic];
        v13 = [v12 service];
        v14 = [v13 accessory];
        v15 = v14;
        if (v12)
        {
          v16 = v13 == 0;
        }

        else
        {
          v16 = 1;
        }

        if (v16 || v14 == 0)
        {
          v20 = [MEMORY[0x277CCA9B8] errorWithDomain:v29 code:4 userInfo:0];
          v18 = [HMDCharacteristicResponse responseWithRequest:v11 error:v20];
          [v30 addObject:v18];
        }

        else
        {
          v19 = [v14 uuid];
          v20 = [v19 UUIDString];

          v21 = [v33 hmf_mutableDictionaryForKey:v20];
          v18 = v21;
          if (!v21)
          {
            v18 = [MEMORY[0x277CBEB38] dictionary];
            [v33 setObject:v18 forKey:v20];
          }

          v22 = [v13 instanceID];
          v23 = [v22 stringValue];
          v24 = [v18 hmf_mutableArrayForKey:v23];

          if (!v24)
          {
            v24 = [MEMORY[0x277CBEB18] array];
            v25 = [v13 instanceID];
            v26 = [v25 stringValue];
            [v18 setObject:v24 forKey:v26];
          }

          v27 = [v12 instanceID];
          [v24 addObject:v27];

          v8 = v31;
        }

        ++v10;
      }

      while (v8 != v10);
      v8 = [obj countByEnumeratingWithState:&v34 objects:v38 count:16];
    }

    while (v8);
  }

  v28 = *MEMORY[0x277D85DE8];
}

+ (void)appendCharacteristicsToAccessoryList:(id)a3 responseTuples:(id)a4 forMultipleCharacteristicsRemoteWrite:(id)a5 message:(id)a6
{
  v64 = *MEMORY[0x277D85DE8];
  v53 = a3;
  v49 = a4;
  v9 = a5;
  v48 = a6;
  v59 = 0u;
  v60 = 0u;
  v61 = 0u;
  v62 = 0u;
  obj = v9;
  v10 = [v9 countByEnumeratingWithState:&v59 objects:v63 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v60;
    v46 = *MEMORY[0x277CCFD28];
    v13 = *MEMORY[0x277CD2120];
    v44 = *MEMORY[0x277CD2120];
    v45 = *MEMORY[0x277CD2050];
    v52 = *MEMORY[0x277CD2678];
    v47 = *v60;
    do
    {
      v14 = 0;
      v50 = v11;
      do
      {
        if (*v60 != v12)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v59 + 1) + 8 * v14);
        v16 = [v15 characteristic];
        v17 = [v16 service];
        v18 = [v17 accessory];
        v19 = v18;
        if (v16)
        {
          v20 = v17 == 0;
        }

        else
        {
          v20 = 1;
        }

        if (v20 || v18 == 0)
        {
          v22 = [MEMORY[0x277CCA9B8] errorWithDomain:v46 code:4 userInfo:0];
          v23 = [HMDCharacteristicResponse responseWithRequest:v15 error:v22];
          [v49 addObject:v23];
        }

        else
        {
          v24 = [v18 uuid];
          v25 = [v24 UUIDString];

          v26 = [v17 instanceID];
          v27 = [v26 stringValue];

          v28 = [v16 instanceID];
          v58 = [v28 stringValue];

          v29 = [v53 hmf_mutableDictionaryForKey:v25];
          v30 = v29;
          if (!v29)
          {
            v30 = [MEMORY[0x277CBEB38] dictionary];
            [v53 setObject:v30 forKeyedSubscript:v25];
          }

          v57 = v25;
          v31 = [v30 hmf_mutableDictionaryForKey:v27];
          if (!v31)
          {
            v31 = [MEMORY[0x277CBEB38] dictionary];
            [v30 setObject:v31 forKeyedSubscript:v27];
          }

          v55 = v30;
          v56 = v27;
          v32 = [v16 authorizationData];
          if (v32)
          {
            v33 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v58, @"kAuthorizationDataKey"];
            [v31 setObject:v32 forKeyedSubscript:v33];
          }

          v54 = v32;
          v34 = [v19 home];
          v35 = [v34 currentUser];
          v36 = [v35 notificationContextHAPIdentifier];
          v37 = [v16 contextDataForWriteRequestWithIdentifier:v36];

          if (v37)
          {
            v38 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v58, v44];
            [v31 setObject:v37 forKeyedSubscript:v38];
          }

          v39 = [v48 uuidForKey:v45];
          v40 = [v48 BOOLForKey:v52];
          if (v39 || v40)
          {
            [v53 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:v52];
          }

          v41 = [v15 value];
          [v31 setObject:v41 forKeyedSubscript:v58];

          v42 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v15, "includeResponseValue")}];
          [v31 setObject:v42 forKeyedSubscript:@"HMDCharacteristicWriteRequestIncludeResponseValueKey"];

          v12 = v47;
          v23 = v56;
          v22 = v57;
          v11 = v50;
        }

        ++v14;
      }

      while (v11 != v14);
      v11 = [obj countByEnumeratingWithState:&v59 objects:v63 count:16];
    }

    while (v11);
  }

  v43 = *MEMORY[0x277D85DE8];
}

+ (id)notificationPayloadForChangedCharacteristics:(id)a3 destination:(id)a4 destinationIsXPCTransport:(BOOL)a5
{
  v89 = a5;
  v108 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v76 = a4;
  v75 = [MEMORY[0x277CBEB38] dictionary];
  v7 = +[HMDHAPMetadata getSharedInstance];
  v93 = 0u;
  v94 = 0u;
  v95 = 0u;
  v96 = 0u;
  obj = v6;
  v8 = [obj countByEnumeratingWithState:&v93 objects:v107 count:16];
  if (v8)
  {
    v10 = v8;
    v11 = *v94;
    v72 = *MEMORY[0x277CD21B8];
    v69 = *MEMORY[0x277CD21E0];
    v67 = *MEMORY[0x277CD2150];
    v68 = *MEMORY[0x277CD21D0];
    v70 = *MEMORY[0x277CD2110];
    v66 = *MEMORY[0x277CD21C0];
    v65 = *MEMORY[0x277CD20F0];
    *&v9 = 138544130;
    v64 = v9;
    v87 = v7;
    v84 = *v94;
    do
    {
      v12 = 0;
      v85 = v10;
      do
      {
        if (*v94 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v93 + 1) + 8 * v12);
        v14 = [v13 characteristic];
        v15 = [v14 service];
        v16 = [v15 accessory];
        v17 = [v16 home];
        v18 = v17;
        if (v14)
        {
          v19 = v15 == 0;
        }

        else
        {
          v19 = 1;
        }

        if (!v19 && v16 != 0 && v17 != 0)
        {
          v22 = [v13 updatedValue];
          v23 = v22;
          if (v22)
          {
            v24 = !v89;
          }

          else
          {
            v24 = 1;
          }

          if (v24)
          {
            if (v22)
            {
              goto LABEL_24;
            }
          }

          else
          {
            v25 = v22;
            objc_opt_class();
            isKindOfClass = objc_opt_isKindOfClass();

            if ((isKindOfClass & 1) == 0)
            {
LABEL_24:
              if (!v89)
              {
                goto LABEL_27;
              }

              v27 = [v14 type];
              if ([v87 shouldFilterCharacteristicOfTypeFromApp:v27])
              {
LABEL_52:
              }

              else
              {
                v28 = [v15 type];
                v29 = [v87 shouldFilterServiceOfTypeFromApp:v28];

                if ((v29 & 1) == 0)
                {
LABEL_27:
                  v30 = [v16 uuid];
                  v31 = [v30 UUIDString];

                  v32 = v31;
                  v33 = [v75 hmf_mutableDictionaryForKey:v31];
                  if (!v33)
                  {
                    v33 = [MEMORY[0x277CBEB38] dictionary];
                    [v75 setObject:v33 forKey:v32];
                  }

                  v81 = v32;
                  v34 = [v15 instanceID];
                  v35 = [v34 stringValue];
                  v36 = v33;
                  v37 = v35;
                  v83 = v36;
                  v38 = [v36 hmf_mutableDictionaryForKey:v35];

                  v82 = v38;
                  if (!v38)
                  {
                    v39 = [MEMORY[0x277CBEB38] dictionary];
                    v40 = [v15 instanceID];
                    v41 = [v40 stringValue];
                    v82 = v39;
                    [v83 setObject:v39 forKey:v41];
                  }

                  v105 = v72;
                  v106 = v23;
                  v42 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v106 forKeys:&v105 count:1];
                  v43 = [v42 mutableCopy];

                  v91 = 0;
                  v92 = 0;
                  v90 = 0;
                  [v14 getLastKnownValueUpdateTime:&v92 stateNumber:&v91 notificationContext:&v90];
                  v44 = v92;
                  v45 = v91;
                  v88 = v90;
                  if (v44)
                  {
                    [v43 setObject:v44 forKey:v69];
                  }

                  if (v45)
                  {
                    [v43 setObject:v45 forKey:v68];
                  }

                  v79 = v45;
                  v80 = v44;
                  if (v88)
                  {
                    v77 = v43;
                    context = objc_autoreleasePoolPush();
                    v46 = a1;
                    v47 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
                    {
                      v48 = HMFGetLogIdentifier();
                      *buf = 138543618;
                      v98 = v48;
                      v99 = 2112;
                      v100 = v88;
                      _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Setting notification context in notification payload to %@ ", buf, 0x16u);
                    }

                    objc_autoreleasePoolPop(context);
                    v43 = v77;
                    [v77 setObject:v88 forKey:v67];
                  }

                  v49 = [v13 isBroadcast];
                  v50 = MEMORY[0x277CBEC38];
                  if ((v49 & 1) != 0 || (v51 = [v16 isBLELinkConnected], v50 = MEMORY[0x277CBEC28], v51))
                  {
                    [v43 setObject:v50 forKey:v70];
                  }

                  if (!v89)
                  {
                    v52 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v13, "reasons", v50)}];
                    [v43 setObject:v52 forKey:v66];
                  }

                  if (v76 && [HMDBulletinUserAttributionManager currentStateCharacteristicSupportsUserAttribution:v14])
                  {
                    v53 = [v18 bulletinUserAttributionManager];
                    v54 = [v53 attributedUserUUIDForCurrentStateCharacteristic:v14 destination:v76];

                    if (v54)
                    {
                      v78 = v43;
                      v55 = objc_autoreleasePoolPush();
                      v56 = a1;
                      v57 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
                      {
                        HMFGetLogIdentifier();
                        v58 = contexta = v55;
                        *buf = v64;
                        v98 = v58;
                        v99 = 2112;
                        v100 = v54;
                        v101 = 2112;
                        v102 = v14;
                        v103 = 2112;
                        v104 = v76;
                        _os_log_impl(&dword_229538000, v57, OS_LOG_TYPE_INFO, "%{public}@Including attributedUserUUID=%@ in characteristic=%@ update message to destination=%@", buf, 0x2Au);

                        v55 = contexta;
                      }

                      objc_autoreleasePoolPop(v55);
                      v59 = [v54 UUIDString];
                      v43 = v78;
                      [v78 setObject:v59 forKey:v65];
                    }
                  }

                  v60 = [v14 instanceID];
                  v61 = [v60 stringValue];
                  [v82 setObject:v43 forKey:v61];

                  v27 = v81;
                  goto LABEL_52;
                }
              }
            }
          }

          v7 = v87;
          v11 = v84;
          v10 = v85;
        }

        ++v12;
      }

      while (v10 != v12);
      v10 = [obj countByEnumeratingWithState:&v93 objects:v107 count:16];
    }

    while (v10);
  }

  v62 = *MEMORY[0x277D85DE8];

  return v75;
}

+ (unint64_t)privilegeFromUserInviteInformation:(id)a3
{
  v3 = a3;
  if ([v3 isRestrictedGuest])
  {
    v4 = 5;
  }

  else if ([v3 isAdministrator])
  {
    v4 = 4;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

+ (id)filterUsersSupportingPresence:(id)a3
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v4 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v3, "count")}];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v5 = v3;
  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v13 + 1) + 8 * i);
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          [v4 addObject:{v10, v13}];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return v4;
}

+ (id)shortDescription
{
  v2 = objc_opt_class();

  return NSStringFromClass(v2);
}

+ (id)zoneIDFromHomeUUID:(id)a3
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = MEMORY[0x277CCAD78];
  v10 = *MEMORY[0x277CD23C8];
  v4 = MEMORY[0x277CBEA60];
  v5 = a3;
  v6 = [v4 arrayWithObjects:&v10 count:1];
  v7 = [v3 hm_deriveUUIDFromBaseUUID:v5 identifierSalt:0 withSalts:{v6, v10, v11}];

  v8 = *MEMORY[0x277D85DE8];

  return v7;
}

+ (BOOL)isObjectContainedInHome:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a3;
  +[HMDHome _initialize];
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  v4 = allowedClasses;
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = *v12;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v11 + 1) + 8 * i);
        if (objc_opt_isKindOfClass())
        {
          LOBYTE(v5) = 1;
          goto LABEL_11;
        }
      }

      v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v5)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v9 = *MEMORY[0x277D85DE8];
  return v5;
}

+ (id)getBuiltinActionSets
{
  if (getBuiltinActionSets_onceToken != -1)
  {
    dispatch_once(&getBuiltinActionSets_onceToken, &__block_literal_global_664);
  }

  v3 = getBuiltinActionSets_builtinActionSets;

  return v3;
}

void __31__HMDHome_getBuiltinActionSets__block_invoke()
{
  v9[4] = *MEMORY[0x277D85DE8];
  v0 = *MEMORY[0x277CCF148];
  v1 = *MEMORY[0x277CCF198];
  v8[0] = *MEMORY[0x277CCF1B0];
  v8[1] = v1;
  v2 = *MEMORY[0x277CCF140];
  v9[0] = v0;
  v9[1] = v2;
  v3 = *MEMORY[0x277CCF188];
  v8[2] = *MEMORY[0x277CCF180];
  v8[3] = v3;
  v4 = *MEMORY[0x277CCF138];
  v9[2] = *MEMORY[0x277CCF130];
  v9[3] = v4;
  v5 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:v8 count:4];
  v6 = getBuiltinActionSets_builtinActionSets;
  getBuiltinActionSets_builtinActionSets = v5;

  v7 = *MEMORY[0x277D85DE8];
}

+ (void)_initialize
{
  if (_initialize_onceToken != -1)
  {
    dispatch_once(&_initialize_onceToken, &__block_literal_global_15087);
  }
}

void __22__HMDHome__initialize__block_invoke()
{
  v16 = *MEMORY[0x277D85DE8];
  v0 = MEMORY[0x277CBEB98];
  v5 = objc_opt_class();
  v6 = objc_opt_class();
  v7 = objc_opt_class();
  v8 = objc_opt_class();
  v9 = objc_opt_class();
  v10 = objc_opt_class();
  v11 = objc_opt_class();
  v12 = objc_opt_class();
  v13 = objc_opt_class();
  v14 = objc_opt_class();
  v15 = objc_opt_class();
  v1 = [MEMORY[0x277CBEA60] arrayWithObjects:&v5 count:11];
  v2 = [v0 setWithArray:{v1, v5, v6, v7, v8, v9, v10, v11, v12, v13, v14}];
  v3 = allowedClasses;
  allowedClasses = v2;

  v4 = *MEMORY[0x277D85DE8];
}

- (void)_notifyThreadLayerOfResidentChange
{
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = [(HMDHome *)self home];
  v5 = v4;
  if (v4)
  {
    v14 = v4;
    v6 = [v4 isCurrentDeviceAvailableResident];
    v5 = v14;
    if (v6)
    {
      v7 = +[HMDThreadResidentCommissioner sharedCommissioner];
      v8 = [v14 primaryResident];
      v9 = [v8 isCurrentDevice];
      v10 = [v14 primaryResident];
      v11 = [v10 capabilities];
      [v7 informThreadLayerOfResidentChange:v9 primaryResidentIsThreadCapable:{objc_msgSend(v11, "supportsThreadBorderRouter")}];

      if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
      {
        v12 = [(HMDHome *)self threadOperationalDataset];

        if (v12)
        {
          v13 = [(HMDHome *)self threadOperationalDataset];
          [(HMDHome *)self saveAndSyncWithThreadOperationalDataset:v13 forceUpdate:1];
        }
      }

      v5 = v14;
    }
  }
}

- (void)_updateThreadNetworkWithModel:(id)a3 message:(id)a4
{
  v32 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 setProperties];
  v9 = [v8 containsObject:@"threadNetworkID"];

  if (!v9)
  {
LABEL_13:
    [v7 respondWithPayload:0];
    goto LABEL_14;
  }

  v10 = [(HMDHome *)self unfilteredThreadNetworkID];
  v11 = [v6 threadNetworkID];
  v12 = [(HMDHome *)self threadNetworkID];

  if (!v12)
  {
    v18 = [v7 transactionResult];
    v19 = [v18 source];

    if (v19 == 2 && v11 && [(HMDHome *)self attemptToUpdateThreadNetworkID:v11])
    {
      v20 = objc_autoreleasePoolPush();
      v21 = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v23;
        v28 = 2112;
        v29 = v10;
        v30 = 2112;
        v31 = v11;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@threadNetworkID updated from cloud: %@ -> %@", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v20);
      [(HMDHome *)v21 startThreadNetwork:0];
    }

    v24 = [v7 transactionResult];
    [v24 markChanged];

    goto LABEL_13;
  }

  v13 = objc_autoreleasePoolPush();
  v14 = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
  {
    v16 = HMFGetLogIdentifier();
    v26 = 138543874;
    v27 = v16;
    v28 = 2112;
    v29 = v10;
    v30 = 2112;
    v31 = v11;
    _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Ignoring threadNetworkID update from cloud: %@ -> %@", &v26, 0x20u);
  }

  objc_autoreleasePoolPop(v13);
  v17 = [v7 transactionResult];
  [v17 markChanged];

  [v7 respondWithPayload:0];
LABEL_14:

  v25 = *MEMORY[0x277D85DE8];
}

- (void)saveAndSyncWithThreadOperationalDataset:(id)a3 forceUpdate:(BOOL)a4
{
  v37 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [(HMDHome *)self home];
  v8 = v7;
  if (v6)
  {
    v9 = [v7 residentDeviceManager];
    v10 = [v9 residentDevices];
    if ([v10 count] && !-[HMDHome isCurrentDeviceConfirmedPrimaryResident](self, "isCurrentDeviceConfirmedPrimaryResident"))
    {
      v26 = objc_autoreleasePoolPush();
      v27 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
      {
        v29 = HMFGetLogIdentifier();
        *buf = 138543618;
        v34 = v29;
        v35 = 2112;
        v36 = v8;
        _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_INFO, "%{public}@There are residents for home: %@, but we are not the primary. Updated locally but not syncing ThreadOperationalDataset.", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v26);
      [(HMDHome *)v27 setThreadOperationalDataset:v6];
      goto LABEL_19;
    }

    v11 = [(HMDHome *)self threadOperationalDataset];
    v12 = HMFEqualObjects();

    if (v12)
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      v16 = os_log_type_enabled(v15, OS_LOG_TYPE_INFO);
      if (!a4)
      {
        if (v16)
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543362;
          v34 = v30;
          _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Thread operational dataset has not changed, ignoring request to save and sync", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v13);
        goto LABEL_19;
      }

      if (v16)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v34 = v17;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Thread operational dataset has not changed, but pushing out update because forceUpdate is true", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
    }

    v18 = [(HMDHome *)self emptyModelObjectWithChangeType:2];
    [v18 setThreadOperationalDataset:v6];
    [(HMDHome *)self setThreadOperationalDataset:v6];
    v19 = [(HMDHome *)self backingStore];
    v20 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v21 = [v19 transaction:@"Update thread operational dataset" options:v20];

    [v21 add:v18];
    v32[0] = MEMORY[0x277D85DD0];
    v32[1] = 3221225472;
    v32[2] = __92__HMDHome_ThreadResidentCommissioning__saveAndSyncWithThreadOperationalDataset_forceUpdate___block_invoke;
    v32[3] = &unk_27868A250;
    v32[4] = self;
    [v21 run:v32];
    [(HMDHome *)self setThreadOperationalDataset:v6];

LABEL_19:
    goto LABEL_20;
  }

  v22 = objc_autoreleasePoolPush();
  v23 = self;
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
  {
    v25 = HMFGetLogIdentifier();
    *buf = 138543618;
    v34 = v25;
    v35 = 2112;
    v36 = v8;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@threadOperationalDataset is null for home %@, not saving...", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v22);
LABEL_20:

  v31 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome_ThreadResidentCommissioning__saveAndSyncWithThreadOperationalDataset_forceUpdate___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to sync thread operational dataset, error: %@", &v12, 0x16u);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [*(a1 + 32) threadOperationalDataset];
    v12 = 138543618;
    v13 = v9;
    v14 = 2048;
    v15 = [v10 length];
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Successfully sync'ed thread operational dataset, Length: %lu", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
}

- (void)updateThreadOperationalDatasetWithHomeModel:(id)a3 message:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    v8 = [v6 threadOperationalDataset];
    [(HMDHome *)self setThreadOperationalDataset:v8];

    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [(HMDHome *)v10 threadOperationalDataset];
      v15 = 138543618;
      v16 = v12;
      v17 = 2048;
      v18 = [v13 length];
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Updated thread operational dataset, Length: %lu", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)stopThreadAccessoryFirmwareUpdateWithCompletion:(id)a3
{
  v3 = a3;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v4 = objc_claimAutoreleasedReturnValue(), v5 = [v4 supportsThreadService], v4, (v5 & 1) != 0))
  {
    v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __88__HMDHome_ThreadResidentCommissioning__stopThreadAccessoryFirmwareUpdateWithCompletion___block_invoke;
    v7[3] = &unk_278688DD0;
    v8 = v3;
    [v6 stopThreadAccessoryFirmwareUpdateWithCompletion:v7];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(v3 + 2))(v3, v6);
  }
}

- (void)stopThreadAccessoryPairingWithCompletion:(id)a3
{
  v3 = a3;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v4 = objc_claimAutoreleasedReturnValue(), v5 = [v4 supportsThreadService], v4, (v5 & 1) != 0))
  {
    v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __81__HMDHome_ThreadResidentCommissioning__stopThreadAccessoryPairingWithCompletion___block_invoke;
    v7[3] = &unk_278688DD0;
    v8 = v3;
    [v6 stopThreadAccessoryPairingWithCompletion:v7];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(v3 + 2))(v3, v6);
  }
}

- (void)onThreadNetworkCallStateChange:(BOOL)a3
{
  v11 = *MEMORY[0x277D85DE8];
  if (!a3 && [(HMDHome *)self threadNetworkShouldRestartOnNetworkChange])
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v7;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Restarting thread network after call end", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [(HMDHome *)v5 startThreadNetwork:1];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)onThreadNetworkPeripheralDeviceNodeTypeChange:(id)a3
{
  v3 = MEMORY[0x277CCAB98];
  v4 = a3;
  v5 = [v3 defaultCenter];
  [v5 postNotificationName:@"HMDHomeThreadNetworkPeripheralDeviceNodeTypeChangedNotification" object:v4];
}

- (void)onThreadNetworkWakeOnDeviceConnectionStateChange:(id)a3
{
  v3 = MEMORY[0x277CCAB98];
  v4 = a3;
  v5 = [v3 defaultCenter];
  [v5 postNotificationName:@"HMDHomeThreadNetworkWakeOnConnectionStateChangeNotification" object:v4];
}

- (void)onThreadNetworkNodeTypeStateChange:(int64_t)a3
{
  v15 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self threadNetworkNodeType]!= a3)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2048;
      v14 = a3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread network node type changed to %ld", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 setThreadNetworkNodeType:a3];
    v9 = [MEMORY[0x277CCAB98] defaultCenter];
    [v9 postNotificationName:@"HMDHomeThreadNetworkNodeTypeChangeNotification" object:v6];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)onThreadNetworkConnectionStateChange:(int64_t)a3
{
  v15 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self threadNetworkConnectionState]!= a3)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2048;
      v14 = a3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread network connection state changed to %ld", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 setThreadNetworkConnectionState:a3];
    v9 = [MEMORY[0x277CCAB98] defaultCenter];
    [v9 postNotificationName:@"HMDHomeThreadNetworkConnectionStateChangeNotification" object:v6];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)connectToThreadAccessoryWithExtendedMACAddress:(id)a3 completion:(id)a4
{
  v5 = a3;
  v6 = a4;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v7 = objc_claimAutoreleasedReturnValue(), v8 = [v7 supportsThreadService], v7, (v8 & 1) != 0))
  {
    v9 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __98__HMDHome_ThreadResidentCommissioning__connectToThreadAccessoryWithExtendedMACAddress_completion___block_invoke;
    v10[3] = &unk_278688DD0;
    v11 = v6;
    [v9 connectToThreadAccessoryWithExtendedMACAddress:v5 completion:v10];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(v6 + 2))(v6, v9);
  }
}

- (void)_unjoinThreadNetworkWithCompletion:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [(HMDHome *)v7 threadNetworkID];
    *buf = 138543618;
    v16 = v9;
    v17 = 2112;
    v18 = v10;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Request to unjoin previous thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  [(HMDHome *)v7 setThreadNetworkID:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __75__HMDHome_ThreadResidentCommissioning___unjoinThreadNetworkWithCompletion___block_invoke;
  v13[3] = &unk_278689A68;
  v13[4] = v7;
  v14 = v4;
  v11 = v4;
  [(HMDHome *)v7 _stopThreadNetworkWithCompletion:v13];

  v12 = *MEMORY[0x277D85DE8];
}

void __75__HMDHome_ThreadResidentCommissioning___unjoinThreadNetworkWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v8;
      v18 = 2112;
      v19 = v3;
      v9 = "%{public}@Failed to leave previous thread network: %@";
      v10 = v7;
      v11 = OS_LOG_TYPE_ERROR;
      v12 = 22;
LABEL_6:
      _os_log_impl(&dword_229538000, v10, v11, v9, &v16, v12);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    v9 = "%{public}@Successfully left previous thread network";
    v10 = v7;
    v11 = OS_LOG_TYPE_DEFAULT;
    v12 = 12;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v4);
  (*(*(a1 + 40) + 16))(*(a1 + 40), v3, v13, v14);

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_stopThreadNetworkWithCompletion:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  [(HMDHome *)self setThreadNetworkShouldRestartOnNetworkChange:0];
  [(HMDHome *)self _incrementCurrentSequenceNumber];
  [(HMDHome *)self _unregisterForThreadNetworkEvents];
  v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __73__HMDHome_ThreadResidentCommissioning___stopThreadNetworkWithCompletion___block_invoke;
  v8[3] = &unk_278688DD0;
  v9 = v4;
  v7 = v4;
  [v6 stopThreadNetworkWithCompletion:v8];
}

- (void)stopThreadNetworkWithCompletion:(BOOL)a3 completion:(id)a4
{
  v5 = a4;
  v6 = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke;
  v8[3] = &unk_27868A7A0;
  v8[4] = self;
  v9 = v5;
  v7 = v5;
  dispatch_async(v6, v8);
}

void __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 32) threadNetworkID];
    *buf = 138543618;
    v12 = v5;
    v13 = 2112;
    v14 = v6;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Stop thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = *(a1 + 32);
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke_61;
  v9[3] = &unk_278689A68;
  v9[4] = v7;
  v10 = *(a1 + 40);
  [v7 _stopThreadNetworkWithCompletion:v9];

  v8 = *MEMORY[0x277D85DE8];
}

void __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke_61(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = v3;
    v9 = "%{public}@Failed to stop thread network: %@";
    v10 = v7;
    v11 = OS_LOG_TYPE_ERROR;
    v12 = 22;
  }

  else
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    v9 = "%{public}@Successfully stopped thread network";
    v10 = v7;
    v11 = OS_LOG_TYPE_DEFAULT;
    v12 = 12;
  }

  _os_log_impl(&dword_229538000, v10, v11, v9, &v16, v12);

LABEL_7:
  objc_autoreleasePoolPop(v4);
  v13 = _Block_copy(*(a1 + 40));
  v14 = v13;
  if (v13)
  {
    (*(v13 + 2))(v13);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkWithCompletion:(id)a3
{
  v5 = a3;
  v4 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v4);

  [(HMDHome *)self _startThreadNetworkOnControllerWithCompletion:v5];
}

- (void)_startThreadNetworkOnResidentWithCompletion:(id)a3
{
  v14 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v8;
    v12 = 2112;
    v13 = v6;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread start starting for home %@ using operational dataset", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  [(HMDHome *)v6 setStartThreadNetworkInProgress:1];
  [(HMDHome *)v6 _fetchThreadCredentialsAndStartThreadNetworkWithCompletion:v4];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkOnControllerWithCompletion:(id)a3
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled())
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2112;
      v14 = v6;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread start starting for home %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 setStartThreadNetworkInProgress:1];
    [(HMDHome *)v6 setThreadNetworkShouldRestartOnNetworkChange:1];
    [(HMDHome *)v6 _fetchThreadCredentialsAndStartThreadNetworkWithCompletion:v4];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    v4[2](v4, v9);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_fetchThreadCredentialsAndStartThreadNetworkWithCompletion:(id)a3
{
  v4 = a3;
  v20[0] = 0;
  v20[1] = v20;
  v20[2] = 0x2020000000;
  v21 = 0;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke;
  aBlock[3] = &unk_27867B828;
  objc_copyWeak(&v18, &location);
  v17 = v20;
  v5 = v4;
  v16 = v5;
  v6 = _Block_copy(aBlock);
  if (![(HMDHome *)self _overrideStartThreadTimeout])
  {
    v7 = dispatch_time(0, 20000000000);
    v8 = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_2;
    block[3] = &unk_278688B80;
    v14 = v6;
    dispatch_after(v7, v8, block);
  }

  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_3;
  v10[3] = &unk_278686D60;
  objc_copyWeak(&v12, &location);
  v9 = v6;
  v11 = v9;
  [(HMDHome *)self _retrievePreferredNetworkWithCompletion:v10];

  objc_destroyWeak(&v12);
  objc_destroyWeak(&v18);
  objc_destroyWeak(&location);
  _Block_object_dispose(v20, 8);
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v42 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (v3)
  {
    if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
    {
      v5 = objc_autoreleasePoolPush();
      v6 = WeakRetained;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543874;
        v37 = v8;
        v38 = 2112;
        v39 = v6;
        v40 = 2112;
        v41 = v3;
        _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Error starting thread for home %@, resetting state: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v5);
      if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
      {
        v9 = objc_autoreleasePoolPush();
        v10 = v6;
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          v12 = HMFGetLogIdentifier();
          *buf = 138543874;
          v37 = v12;
          v38 = 2112;
          v39 = v10;
          v40 = 2112;
          v41 = v3;
          _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Thread start completed for home %@, error = %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v9);
        [v10 setStartThreadNetworkInProgress:0];
        *(*(*(a1 + 40) + 8) + 24) = 1;
        v13 = [v10 workQueue];
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_59;
        block[3] = &unk_27868A7A0;
        v31 = *(a1 + 32);
        v30 = v3;
        dispatch_async(v13, block);

        v14 = v31;
LABEL_18:
      }
    }
  }

  else
  {
    if (!*(*(*(a1 + 40) + 8) + 24))
    {
      goto LABEL_13;
    }

    v15 = objc_autoreleasePoolPush();
    v16 = WeakRetained;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v18;
      v38 = 2112;
      v39 = v16;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Starting thread took longer than expected for home %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
    {
LABEL_13:
      v19 = [WeakRetained threadOperationalDataset];

      if (v19)
      {
        v20 = [WeakRetained threadOperationalDataset];
        v34[0] = MEMORY[0x277D85DD0];
        v34[1] = 3221225472;
        v34[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_56;
        v34[3] = &unk_27867FAA0;
        v34[4] = WeakRetained;
        v28 = *(a1 + 32);
        v21 = v28;
        v35 = v28;
        [WeakRetained _startThreadNetworkOnCommissionerWithOperationalDataset:v20 completion:v34];

        v14 = v35;
      }

      else
      {
        v22 = objc_autoreleasePoolPush();
        v23 = WeakRetained;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          *buf = 138543618;
          v37 = v25;
          v38 = 2112;
          v39 = v23;
          _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Thread operational dataset not available. Cancelling thread start for home %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v22);
        [v23 setStartThreadNetworkInProgress:0];
        *(*(*(a1 + 40) + 8) + 24) = 1;
        v26 = [v23 workQueue];
        v32[0] = MEMORY[0x277D85DD0];
        v32[1] = 3221225472;
        v32[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_58;
        v32[3] = &unk_278688B80;
        v33 = *(a1 + 32);
        dispatch_async(v26, v32);

        v14 = v33;
      }

      goto LABEL_18;
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_2(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:8];
  (*(v1 + 16))(v1, v2);
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_3(uint64_t a1, void *a2)
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = WeakRetained;
  if (v3 || !WeakRetained)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = v5;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v9;
      v30 = 2112;
      v31 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve preferred thread network: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v10 = [v7 threadOperationalDataset];

    if (!v10)
    {
      v24 = *(a1 + 32);
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      (*(v24 + 16))(v24, v25);

      goto LABEL_12;
    }

    v11 = objc_autoreleasePoolPush();
    v12 = v7;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v12 threadOperationalDataset];
      v16 = [v12 threadNetworkID];
      v17 = [v12 home];
      *buf = 138544130;
      v29 = v14;
      v30 = 2112;
      v31 = v15;
      v32 = 2112;
      v33 = v16;
      v34 = 2112;
      v35 = v17;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Using cached threadOperationalDataset %@ and uuid %@ from home %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v11);
  }

  v18 = objc_autoreleasePoolPush();
  v19 = v5;
  v20 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
  {
    v21 = HMFGetLogIdentifier();
    *buf = 138543618;
    v29 = v21;
    v30 = 2112;
    v31 = v19;
    _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@Successfully fetched preferred network, scheduling startThread for home %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v18);
  v22 = [v19 workQueue];
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_60;
  v26[3] = &unk_27868A7A0;
  v26[4] = v19;
  v27 = *(a1 + 32);
  dispatch_async(v22, v26);

LABEL_12:
  v23 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_60(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) startThreadNetworkInProgress])
  {
    v2 = *(*(a1 + 40) + 16);
    v3 = *MEMORY[0x277D85DE8];

    v2();
  }

  else
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 32);
      v12 = 138543618;
      v13 = v7;
      v14 = 2112;
      v15 = v8;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Thread network stop was requested by the time preferred network was fetched to start Thread for home %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    (*(v9 + 16))(v9, v10);

    v11 = *MEMORY[0x277D85DE8];
  }
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_56(uint64_t a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543618;
      v21 = v7;
      v22 = 2112;
      v23 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Unable to start thread with operational dataset: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 32);
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    *buf = 138543874;
    v21 = v11;
    v22 = 2112;
    v23 = v12;
    v24 = 2112;
    v25 = v3;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Thread start completed for home %@, error = %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  *(*(*(a1 + 48) + 8) + 24) = 1;
  v13 = [*(a1 + 32) workQueue];
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_57;
  v17[3] = &unk_27868A7A0;
  v14 = *(a1 + 40);
  v18 = v3;
  v19 = v14;
  v15 = v3;
  dispatch_async(v13, v17);

  v16 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_58(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
  (*(v1 + 16))(v1, v2);
}

- (void)_retrievePreferredNetworkOnControllerWithCompletion:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v27 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve request for Thread Network Credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = +[HMDThreadNetworkMetadataStore defaultStore];
  if (v9)
  {
    if ([(HMDHome *)v6 isOwnerUser])
    {
      objc_initWeak(buf, v6);
      v10 = [(HMDHome *)v6 threadOperationalDataset];
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __92__HMDHome_ThreadResidentCommissioning___retrievePreferredNetworkOnControllerWithCompletion___block_invoke;
      v23[3] = &unk_27867B760;
      objc_copyWeak(&v25, buf);
      v24 = v4;
      [v9 retrievePreferredNetwork:v10 completion:v23];

      objc_destroyWeak(&v25);
      objc_destroyWeak(buf);
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = v6;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        v20 = [(HMDHome *)v17 threadOperationalDataset];
        v21 = [(HMDHome *)v17 home];
        *buf = 138543874;
        v27 = v19;
        v28 = 2112;
        v29 = v20;
        v30 = 2112;
        v31 = v21;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Shared user -  always use cached threadOperationalDataset %@ for home %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v16);
      (*(v4 + 2))(v4, 0);
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = v6;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v27 = v14;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:58];
    (*(v4 + 2))(v4, v15);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome_ThreadResidentCommissioning___retrievePreferredNetworkOnControllerWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5)
{
  v40 = *MEMORY[0x277D85DE8];
  v9 = a2;
  v10 = a3;
  v11 = a4;
  v12 = a5;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v14 = objc_autoreleasePoolPush();
  v15 = WeakRetained;
  if (!v12 && v9 && WeakRetained)
  {
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138544130;
      v33 = v17;
      v34 = 2112;
      v35 = v9;
      v36 = 2112;
      v37 = v10;
      v38 = 2112;
      v39 = v11;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Successfully retrieved preferred thread credentials %@ with UUID %@ and operationalDataset %@ from network metadata store", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v14);
    if (v11)
    {
      v18 = [v11 copy];
      [v15 saveAndSyncWithThreadOperationalDataset:v18];

      v19 = objc_autoreleasePoolPush();
      v20 = v15;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v22 = v30 = v9;
        [v20 threadOperationalDataset];
        v23 = v29 = v10;
        [v20 home];
        v24 = v31 = v19;
        *buf = 138543874;
        v33 = v22;
        v34 = 2112;
        v35 = v23;
        v36 = 2112;
        v37 = v24;
        _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@threadOperationalDataset set to %@ for home %@", buf, 0x20u);

        v19 = v31;
        v10 = v29;

        v9 = v30;
      }

      objc_autoreleasePoolPop(v19);
    }

    if (v10)
    {
      v25 = [v10 copy];
      [v15 setThreadNetworkID:v25];
    }
  }

  else
  {
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v27;
      v34 = 2112;
      v35 = v12;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
  }

  (*(*(a1 + 32) + 16))();

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkOnCommissionerWithOperationalDataset:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v8);

  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke;
  aBlock[3] = &unk_278682000;
  aBlock[4] = self;
  v9 = v6;
  v19 = v9;
  v10 = v7;
  v20 = v10;
  v11 = _Block_copy(aBlock);
  v12 = [(HMDHome *)self homeManager];
  v13 = [v12 chipDataSource];

  if (v13)
  {
    v14 = [(HMDHome *)self home];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_53;
    v16[3] = &unk_278671380;
    v17 = v11;
    [v13 hasValidGeoOrPreferredNetworkForHome:v14 completion:v16];

    v15 = v17;
  }

  else
  {
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(v11 + 2))(v11, 0, v15);
  }
}

void __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [*(a1 + 32) threadNetworkID];
    v11 = *(a1 + 40);
    v12 = HMFBooleanToString();
    *buf = 138544386;
    v22 = v9;
    v23 = 2112;
    v24 = v10;
    v25 = 2112;
    v26 = v11;
    v27 = 2112;
    v28 = v12;
    v29 = 2112;
    v30 = v5;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Start thread network with uuid: %@, credentials: %@, geoAvailable: %@, error %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v6);
  v13 = +[HMDThreadResidentCommissioner sharedCommissioner];
  [v13 setGeoAvailable:a2];
  v14 = *(a1 + 40);
  v15 = [*(a1 + 32) isOwnerUser];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_50;
  v18[3] = &unk_278689358;
  v16 = *(a1 + 40);
  v18[4] = *(a1 + 32);
  v19 = v16;
  v20 = *(a1 + 48);
  [v13 startThreadNetworkWithOperationalDataset:v14 threadNetworkID:@"770E5B2E-0A0D-0A0D-0A0D-EE86505EFF8F" isOwnerUser:v15 completion:v18];

  v17 = *MEMORY[0x277D85DE8];
}

void __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_50(uint64_t a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [*(a1 + 32) threadNetworkID];
      v9 = *(a1 + 40);
      *buf = 138544130;
      v19 = v7;
      v20 = 2112;
      v21 = v8;
      v22 = 2112;
      v23 = v9;
      v24 = 2112;
      v25 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to attach to thread network %@ with operational data set%@: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
  }

  v10 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_51;
  block[3] = &unk_278689F98;
  v11 = *(a1 + 32);
  v15 = v3;
  v16 = v11;
  v17 = *(a1 + 48);
  v12 = v3;
  dispatch_async(v10, block);

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_51(uint64_t a1)
{
  v11 = *MEMORY[0x277D85DE8];
  if (!*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v5;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Attached to thread network using operational dataset", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) setThreadNetworkID:@"770E5B2E-0A0D-0A0D-0A0D-EE86505EFF8F"];
  }

  [*(a1 + 40) _registerForThreadNetworkEvents];
  [*(a1 + 40) setStartThreadNetworkInProgress:0];
  [*(a1 + 40) _scheduleThreadNetworkUpdate];
  v6 = *(a1 + 32);
  result = (*(*(a1 + 48) + 16))();
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_startThreadNetworkOnCommissionerWithCompletion:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v18 = 0;
  v19 = &v18;
  v20 = 0x3032000000;
  v21 = __Block_byref_object_copy__21464;
  v22 = __Block_byref_object_dispose__21465;
  v23 = [(HMDHome *)self threadNetworkID];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    v9 = HMFGetLogIdentifier();
    v10 = v19[5];
    *buf = 138543618;
    v25 = v9;
    v26 = 2112;
    v27 = v10;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Start thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = +[HMDThreadResidentCommissioner sharedCommissioner];
  v12 = v19[5];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke;
  v15[3] = &unk_278671358;
  v15[4] = v7;
  v13 = v4;
  v16 = v13;
  v17 = &v18;
  [v11 startThreadNetworkWithID:v12 completion:v15];

  _Block_object_dispose(&v18, 8);
  v14 = *MEMORY[0x277D85DE8];
}

void __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v38 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = *(*(*(a1 + 48) + 8) + 40);
    if (v7 && ![v7 isEqualToString:v5])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_12;
      }

      v11 = HMFGetLogIdentifier();
      v24 = *(*(*(a1 + 48) + 8) + 40);
      *buf = 138543874;
      v33 = v11;
      v34 = 2112;
      v35 = v5;
      v36 = 2112;
      v37 = v24;
      v12 = "%{public}@Attached to thread network %@, but expected to attach to %@";
      v13 = v10;
      v14 = OS_LOG_TYPE_ERROR;
      v15 = 32;
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_12;
      }

      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v11;
      v34 = 2112;
      v35 = v5;
      v12 = "%{public}@Attached to thread network %@";
      v13 = v10;
      v14 = OS_LOG_TYPE_DEFAULT;
      v15 = 22;
    }

    _os_log_impl(&dword_229538000, v13, v14, v12, buf, v15);

LABEL_12:
    objc_autoreleasePoolPop(v8);
    if (!*(*(*(a1 + 48) + 8) + 40) || ([v5 isEqualToString:?] & 1) == 0)
    {
      [*(a1 + 32) setThreadNetworkID:v5];
    }

    v23 = [*(a1 + 32) workQueue];
    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_48;
    v27[3] = &unk_27868A7A0;
    v25 = *(a1 + 40);
    v27[4] = *(a1 + 32);
    v22 = &v28;
    v28 = v25;
    dispatch_async(v23, v27);
    goto LABEL_16;
  }

  v16 = objc_autoreleasePoolPush();
  v17 = *(a1 + 32);
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
  {
    v19 = HMFGetLogIdentifier();
    *buf = 138543874;
    v33 = v19;
    v34 = 2112;
    v35 = 0;
    v36 = 2112;
    v37 = v6;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to attach to thread network %@: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v16);
  v20 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_47;
  block[3] = &unk_278689F98;
  v21 = *(a1 + 40);
  block[4] = *(a1 + 32);
  v22 = &v31;
  v31 = v21;
  v30 = v6;
  dispatch_async(v20, block);

  v23 = v30;
LABEL_16:

  v26 = *MEMORY[0x277D85DE8];
}

uint64_t __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_47(uint64_t a1)
{
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  v2 = *(a1 + 40);
  v3 = *(*(a1 + 48) + 16);

  return v3();
}

uint64_t __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_48(uint64_t a1)
{
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  [*(a1 + 32) _scheduleThreadNetworkUpdate];
  v2 = *(*(a1 + 40) + 16);

  return v2();
}

- (void)_retryStartThreadNetwork:(double)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = 30.0;
  if (a3 > 0.0)
  {
    v7 = fmin(a3 + a3, 1800.0);
    if (a3 < 2.22044605e-16)
    {
      v6 = 30.0;
    }

    else
    {
      v6 = v7;
    }
  }

  v8 = [(HMDHome *)self threadNetworkSequenceNumber];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke;
  aBlock[3] = &unk_278671330;
  objc_copyWeak(v20, &location);
  v20[1] = *&a3;
  v20[2] = v8;
  v20[3] = *&v6;
  v9 = _Block_copy(aBlock);
  v10 = v9;
  v11 = a3 <= 0.0;
  if (a3 < 2.22044605e-16)
  {
    v11 = 1;
  }

  if (v11)
  {
    (*(v9 + 2))(v9);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v23 = v15;
      v24 = 2048;
      v25 = a3;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Next resident commissioning attempt will happen in %lu seconds", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v16 = dispatch_time(0, (a3 * 1000000000.0));
    v17 = [(HMDHome *)v13 workQueue];
    dispatch_after(v16, v17, v10);
  }

  objc_destroyWeak(v20);
  objc_destroyWeak(&location);
  v18 = *MEMORY[0x277D85DE8];
}

void __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke(uint64_t a1)
{
  v28 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (!WeakRetained)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@Home has died, resident commissioning canceled", buf, 0xCu);
    }

    v14 = v11;
    goto LABEL_17;
  }

  v3 = *(a1 + 40);
  if (v3 > 0.0 && v3 >= 2.22044605e-16)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning timer expired", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = [WeakRetained threadNetworkSequenceNumber];
  v10 = v9;
  if (v9 != *(a1 + 48))
  {
    v15 = objc_autoreleasePoolPush();
    v16 = WeakRetained;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = *(a1 + 48);
      *buf = 138543874;
      v23 = v18;
      v24 = 2048;
      v25 = v19;
      v26 = 2048;
      v27 = v10;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning sequence number no longer matches: %lu != %lu", buf, 0x20u);
    }

    v14 = v15;
LABEL_17:
    objc_autoreleasePoolPop(v14);
    goto LABEL_18;
  }

  v21[0] = MEMORY[0x277D85DD0];
  v21[1] = 3221225472;
  v21[2] = __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke_45;
  v21[3] = &unk_278671308;
  v21[4] = WeakRetained;
  v21[5] = v9;
  v21[6] = *(a1 + 56);
  [WeakRetained _startThreadNetworkWithCompletion:v21];
LABEL_18:

  v20 = *MEMORY[0x277D85DE8];
}

void __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke_45(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (v3)
  {
    v5 = [v3 domain];
    if ([v5 isEqualToString:*MEMORY[0x277CCFD28]])
    {
      if ([v4 code] == 48)
      {

        goto LABEL_12;
      }

      v13 = [v4 code];

      if (v13 == 23)
      {
        goto LABEL_12;
      }
    }

    else
    {
    }

    v6 = [*(a1 + 32) threadNetworkSequenceNumber];
    if (v6 == *(a1 + 40))
    {
      [*(a1 + 32) _retryStartThreadNetwork:*(a1 + 48)];
    }

    else
    {
      v7 = v6;
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = *(a1 + 40);
        v15 = 138543874;
        v16 = v11;
        v17 = 2048;
        v18 = v12;
        v19 = 2048;
        v20 = v7;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning sequence number no longer matches: %lu != %lu", &v15, 0x20u);
      }

      objc_autoreleasePoolPop(v8);
    }
  }

LABEL_12:

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_incrementCurrentSequenceNumber
{
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = [(HMDHome *)self threadNetworkSequenceNumber];
  [(HMDHome *)self setThreadNetworkSequenceNumber:v4 + 1];
  if (v4 == -1)
  {
    v5 = [(HMDHome *)self threadNetworkSequenceNumber]+ 1;

    [(HMDHome *)self setThreadNetworkSequenceNumber:v5];
  }
}

- (void)startThreadNetwork:(BOOL)a3
{
  v21 = *MEMORY[0x277D85DE8];
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 supportsThreadService], v5, (v6 & 1) != 0))
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v20 = v10;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Starting resident commissioning timer", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [(HMDHome *)v8 workQueue];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __59__HMDHome_ThreadResidentCommissioning__startThreadNetwork___block_invoke;
    v17[3] = &unk_278688650;
    v17[4] = v8;
    v18 = a3;
    dispatch_async(v11, v17);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v20 = v15;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Thread commissioning is not supported on this platform", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __59__HMDHome_ThreadResidentCommissioning__startThreadNetwork___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) homeManager];
  if ([v2 isStartThreadNetworkInProgress])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v6;
      v7 = "%{public}@Not starting thread network, start already in progress for another network";
LABEL_4:
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, v7, &v11, 0xCu);
    }
  }

  else
  {
    if (*(a1 + 40) & 1) != 0 || ([*(a1 + 32) threadNetworkID], v8 = objc_claimAutoreleasedReturnValue(), v9 = objc_msgSend(v2, "isCurrentResidentDeviceRunningThreadNetwork:", v8), v8, (v9))
    {
      [*(a1 + 32) _incrementCurrentSequenceNumber];
      [*(a1 + 32) _retryStartThreadNetwork:0.0];
      goto LABEL_9;
    }

    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v6;
      v7 = "%{public}@Not starting thread network, not associated with thread network homes";
      goto LABEL_4;
    }
  }

  objc_autoreleasePoolPop(v3);
LABEL_9:

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleUnjoinThreadNetworkMessage:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke(uint64_t a1)
{
  v2[0] = MEMORY[0x277D85DD0];
  v2[1] = 3221225472;
  v2[2] = __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke_2;
  v2[3] = &unk_27868A250;
  v1 = *(a1 + 32);
  v3 = *(a1 + 40);
  [v1 _unjoinThreadNetworkWithCompletion:v2];
}

- (void)_handleJoinOrFormThreadNetworkMessage:(id)a3
{
  v25 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = _os_feature_enabled_impl();
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled())
  {
    v6 = +[HMDDeviceCapabilities deviceCapabilities];
    v7 = [v6 supportsThreadService];

    if (((v7 | v5) & 1) == 0)
    {
LABEL_3:
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543362;
        v24 = v11;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Resident commissioning is disabled", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
      v12 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:5];
      [v4 respondWithPayload:0 error:v12];
      goto LABEL_13;
    }
  }

  else if ((v5 & 1) == 0)
  {
    goto LABEL_3;
  }

  v13 = [v4 messagePayload];

  if (v13)
  {
    v14 = [v4 messagePayload];
    v15 = [v14 objectForKey:*MEMORY[0x277CD0628]];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v16 = v15;
    }

    else
    {
      v16 = 0;
    }

    v13 = v16;
  }

  v17 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke;
  block[3] = &unk_27868A010;
  v20 = v13;
  v21 = self;
  v22 = v4;
  v12 = v13;
  dispatch_async(v17, block);

LABEL_13:
  v18 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  if (*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 40) threadNetworkID];
      v7 = *(a1 + 32);
      *buf = 138543874;
      v13 = v5;
      v14 = 2112;
      v15 = v6;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Updating thread network %@ -> %@ and starting", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) setThreadNetworkID:*(a1 + 32)];
  }

  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke_43;
  v10[3] = &unk_27868A250;
  v8 = *(a1 + 40);
  v11 = *(a1 + 48);
  [v8 _startThreadNetworkWithCompletion:v10];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_handleThreadNetworkCredentialsRequest:(id)a3
{
  v24 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve request for Thread Network Credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [(HMDHome *)v6 threadNetworkMetadataStore];
  if (v9)
  {
    objc_initWeak(buf, v6);
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke;
    aBlock[3] = &unk_2786712E0;
    aBlock[4] = v6;
    objc_copyWeak(&v21, buf);
    v20 = v4;
    v10 = _Block_copy(aBlock);
    v11 = [(HMDHome *)v6 threadOperationalDataset];
    v12 = [(HMDHome *)v6 home];
    [v9 retrieveMetadata:v11 homeHasResident:objc_msgSend(v12 completion:{"doesHomeContainResident"), v10}];

    objc_destroyWeak(&v21);
    objc_destroyWeak(buf);
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = v6;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v16;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v4 respondWithError:v17];
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke_2;
  v10[3] = &unk_278687568;
  objc_copyWeak(&v14, a1 + 6);
  v11 = v5;
  v12 = v6;
  v13 = a1[5];
  v8 = v6;
  v9 = v5;
  dispatch_async(v7, v10);

  objc_destroyWeak(&v14);
}

void __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke_2(uint64_t a1)
{
  v36 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained && *(a1 + 32))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = WeakRetained;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 32);
      *buf = 138543618;
      v31 = v6;
      v32 = 2112;
      v33 = v7;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Successfully retrieved thread credentials %@ from network metadata store", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v8 = [*(a1 + 32) operationalDataset];

    if (v8)
    {
      v9 = [*(a1 + 32) operationalDataset];
      v10 = [v9 copy];
      [v4 saveAndSyncWithThreadOperationalDataset:v10];
    }

    v11 = *(a1 + 32);
    v29 = 0;
    v12 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v11 requiringSecureCoding:1 error:&v29];
    v13 = v29;
    if (v12)
    {
      v14 = [MEMORY[0x277CBEB38] dictionary];
      [v14 setObject:v12 forKeyedSubscript:*MEMORY[0x277CD0620]];
      v15 = [*(a1 + 32) masterKey];
      [v14 setObject:v15 forKeyedSubscript:@"HMHomeThreadNetworkCredentialsMasterKeyMessageKey"];

      [*(a1 + 48) respondWithPayload:v14];
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      v24 = v4;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543618;
        v31 = v26;
        v32 = 2112;
        v33 = v13;
        _os_log_impl(&dword_229538000, v25, OS_LOG_TYPE_ERROR, "%{public}@Unable to encode credentials: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v23);
      v27 = *(a1 + 48);
      v14 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
      [v27 respondWithError:v14];
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = WeakRetained;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v17 threadNetworkID];
      v21 = *(a1 + 40);
      *buf = 138543874;
      v31 = v19;
      v32 = 2112;
      v33 = v20;
      v34 = 2112;
      v35 = v21;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network '%@': %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    v22 = *(a1 + 48);
    v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v22 respondWithError:v13];
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)handleCurrentWiFiNetworkChangedNotification:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __84__HMDHome_ThreadResidentCommissioning__handleCurrentWiFiNetworkChangedNotification___block_invoke;
  block[3] = &unk_27868A728;
  block[4] = self;
  dispatch_async(v4, block);
}

void __84__HMDHome_ThreadResidentCommissioning__handleCurrentWiFiNetworkChangedNotification___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) threadNetworkShouldRestartOnNetworkChange];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_INFO);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v7;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Restarting Thread network upon WiFi network changed notification", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 32) startThreadNetwork:1];
  }

  else
  {
    if (v6)
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Ignoring WiFi network changed notification when Thread is not up", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_registerThreadResidentCommissioningMessageHandlers
{
  v11 = *MEMORY[0x277D85DE8];
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    v3 = objc_autoreleasePoolPush();
    v4 = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v6;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@Registering for HMFWiFiManagerCurrentNetworkDidChangeNotification", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v7 = [MEMORY[0x277CCAB98] defaultCenter];
    [v7 addObserver:v4 selector:sel_handleCurrentWiFiNetworkChangedNotification_ name:*MEMORY[0x277D0F768] object:0];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceThreadPreferredPrimaryResident
{
  v2 = +[HMDDeviceCapabilities deviceCapabilities];
  v3 = [v2 supportsThreadBorderRouter];

  return v3;
}

- (void)setThreadNetworkID:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = [(HMDHome *)self threadNetworkID];
  if (v6 && (v7 = v6, v8 = [v5 isEqualToString:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"], v7, (v8 & 1) == 0))
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [(HMDHome *)v15 unfilteredThreadNetworkID];
      v20 = 138543874;
      v21 = v17;
      v22 = 2112;
      v23 = v5;
      v24 = 2112;
      v25 = v18;
      _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Unable to set threadNetworkID to %@. (current value=%@)", &v20, 0x20u);
    }

    objc_autoreleasePoolPop(v14);
  }

  else if ([(HMDHome *)self attemptToUpdateThreadNetworkID:v5])
  {
    v9 = [HMDHomeThreadNetworkModel defaultModelForHome:self];
    [v9 setThreadNetworkID:v5];
    v10 = [(HMDHome *)self backingStore];
    v11 = NSStringFromSelector(a2);
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [v10 transaction:v11 options:v12];

    [v13 add:v9 withMessage:0];
    [v13 run];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (NSString)threadNetworkID
{
  v2 = [(HMDHome *)self unfilteredThreadNetworkID];
  if ([v2 isEqualToString:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"])
  {
    v3 = 0;
  }

  else
  {
    v3 = v2;
  }

  return v3;
}

- (void)_unregisterForThreadNetworkEvents
{
  objc_initWeak(&location, self);
  v3 = [(HMDHome *)self workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __73__HMDHome_ThreadResidentCommissioning___unregisterForThreadNetworkEvents__block_invoke;
  v4[3] = &unk_278686B80;
  objc_copyWeak(&v5, &location);
  dispatch_async(v3, v4);

  objc_destroyWeak(&v5);
  objc_destroyWeak(&location);
}

void __73__HMDHome_ThreadResidentCommissioning___unregisterForThreadNetworkEvents__block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained && ([WeakRetained threadNetworkPeriodicStatusReporter], v3 = objc_claimAutoreleasedReturnValue(), v3, v3))
  {
    v4 = [v2 threadNetworkPeriodicStatusReporter];
    [v4 unregisterForThreadNetworkEvents];

    [v2 setThreadNetworkPeriodicStatusReporter:0];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = v2;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@_unregisterForThreadNetworkEvents already unregistered", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_registerForThreadNetworkEvents
{
  objc_initWeak(&location, self);
  v3 = [(HMDHome *)self workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __71__HMDHome_ThreadResidentCommissioning___registerForThreadNetworkEvents__block_invoke;
  v4[3] = &unk_278686B80;
  objc_copyWeak(&v5, &location);
  dispatch_async(v3, v4);

  objc_destroyWeak(&v5);
  objc_destroyWeak(&location);
}

void __71__HMDHome_ThreadResidentCommissioning___registerForThreadNetworkEvents__block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained)
  {
    v3 = [WeakRetained threadNetworkPeriodicStatusReporter];

    if (!v3)
    {
      v4 = [[HMDThreadNetworkStatusReporter alloc] initWithHome:v2];
      [v2 setThreadNetworkPeriodicStatusReporter:v4];
    }

    v5 = [v2 threadNetworkPeriodicStatusReporter];
    [v5 registerForThreadNetworkEvents];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@_registerForThreadNetworkEvents could not get a strong reference to self", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceThreadBorderRouterCapable
{
  v2 = +[HMDDeviceCapabilities deviceCapabilities];
  v3 = [v2 supportsThreadBorderRouter];

  return v3;
}

- (BOOL)isThreadNetworkUp
{
  [(HMDHome *)self _scheduleThreadNetworkUpdate];

  return [(HMDHome *)self threadNetworkIsUp];
}

- (BOOL)isThreadCapable
{
  v3 = [(HMDHome *)self threadNetworkID];

  if (v3)
  {
    return 1;
  }

  [(HMDHome *)self _scheduleThreadNetworkUpdate];

  return [(HMDHome *)self threadPreferredNetworkExists];
}

- (id)dumpBulletinNotificationRegistrationsState
{
  v3 = [MEMORY[0x277CBEB38] dictionary];
  v4 = [(HMDHome *)self accessoryBulletinNotificationManager];
  v5 = [v4 serviceRegistrationsForCurrentDevice];

  if (v5)
  {
    v6 = [v5 description];
    [v3 setObject:v6 forKeyedSubscript:@"Service Registrations (Local)"];
  }

  v7 = [(HMDHome *)self accessoryBulletinNotificationManager];
  v8 = [v7 accessoryRegistrationsForCurrentDevice];

  if (v8)
  {
    v9 = [v8 description];
    [v3 setObject:v9 forKeyedSubscript:@"Accessory Characteristic Registrations (Local)"];
  }

  v10 = [(HMDHome *)self accessoryBulletinNotificationManager];
  v11 = [v10 accessoryRegistrations];

  if (v11)
  {
    v12 = [v11 description];
    [v3 setObject:v12 forKeyedSubscript:@"Accessory Characteristic Registrations"];
  }

  v13 = [(HMDHome *)self cameraBulletinNotificationManager];
  v14 = [v13 cameraSignificantEventRegistrationsForCurrentDevice];

  if (v14)
  {
    v15 = [v14 description];
    [v3 setObject:v15 forKeyedSubscript:@"Camera Significant Event Registrations (Local)"];
  }

  v16 = [(HMDHome *)self cameraBulletinNotificationManager];
  v17 = [v16 cameraSignificantEventRegistrations];

  if (v17)
  {
    v18 = [v17 description];
    [v3 setObject:v18 forKeyedSubscript:@"Camera Significant Event Registrations"];
  }

  v19 = [(HMDHome *)self cameraBulletinNotificationManager];
  v20 = [v19 cameraReachabilityRegistrationsForCurrentDevice];

  if (v20)
  {
    v21 = [v20 description];
    [v3 setObject:v21 forKeyedSubscript:@"Camera Reachability Registrations (Local)"];
  }

  v38 = v8;
  v22 = [(HMDHome *)self cameraBulletinNotificationManager];
  v23 = [v22 cameraReachabilityRegistrations];

  if (v23)
  {
    v24 = [v23 description];
    [v3 setObject:v24 forKeyedSubscript:@"Camera Reachability Registrations"];
  }

  v25 = v5;
  v26 = [(HMDHome *)self cameraBulletinNotificationManager];
  v27 = [v26 cameraAccessModeRegistrationsForCurrentDevice];

  if (v27)
  {
    v28 = [v27 description];
    [v3 setObject:v28 forKeyedSubscript:@"Camera Access Mode Registrations (Local)"];
  }

  v29 = [(HMDHome *)self cameraBulletinNotificationManager];
  v30 = [v29 cameraAccessModeRegistrations];

  if (v30)
  {
    v31 = [v30 description];
    [v3 setObject:v31 forKeyedSubscript:@"Camera Access Mode Registrations"];
  }

  v32 = [(HMDHome *)self audioAnalysisBulletinNotificationManager];
  v33 = [v32 registrations];

  if (v33)
  {
    v34 = [v33 description];
    [v3 setObject:v34 forKeyedSubscript:@"Audio Analysis Registrations"];
  }

  v35 = [v3 copy];

  return v35;
}

- (BOOL)insertOrUpdateCameraAccessModeBulletinRegistration:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 user:(id)a7 context:(id)a8
{
  v40 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  if (v16 || (v33 = 0, [MEMORY[0x277CCAD78] UUID], v20 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v18, "materializeOrCreateBulletinRegistrationsRelationOfTypeCameraAccessModeBulletinRegistrationWithModelID:createdNew:", v20, &v33), v16 = objc_claimAutoreleasedReturnValue(), v20, (v33 & 1) != 0))
  {
    v21 = [v15 deviceAddress];
    v22 = [v21 idsIdentifier];
    [v16 setDeviceIdsIdentifier:v22];

    v23 = [v15 deviceAddress];
    v24 = [v23 idsDestination];
    [v16 setDeviceIdsDestination:v24];

    [v16 setAccessory:v17];
    v25 = [v14 conditions];
    v26 = [(HMDHome *)self addBulletinConditions:v25 on:v16 context:v19];
  }

  else
  {
    v29 = objc_autoreleasePoolPush();
    v30 = self;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543874;
      v35 = v32;
      v36 = 2112;
      v37 = v18;
      v38 = 2112;
      v39 = v14;
      _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize camera reachability bulletin registration on user: %@, registration: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v29);
    v26 = 0;
  }

  v27 = *MEMORY[0x277D85DE8];
  return v26;
}

- (BOOL)insertOrUpdateAudioAnalysisEventBulletinRegistrations:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 user:(id)a7 context:(id)a8
{
  v41 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  if (v16 || (v34 = 0, [MEMORY[0x277CCAD78] UUID], v20 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v18, "materializeOrCreateBulletinRegistrationsRelationOfTypeAnalysisEventBulletinRegistrationWithModelID:createdNew:", v20, &v34), v16 = objc_claimAutoreleasedReturnValue(), v20, (v34 & 1) != 0))
  {
    v21 = [v15 deviceAddress];
    v22 = [v21 idsIdentifier];
    [v16 setDeviceIdsIdentifier:v22];

    v23 = [v15 deviceAddress];
    v24 = [v23 idsDestination];
    [v16 setDeviceIdsDestination:v24];

    [v16 setAccessory:v17];
    v25 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v14, "audioAnalysisClassifierOptions")}];
    [v16 setClassifierOptions:v25];

    v26 = [v14 conditions];
    v27 = [(HMDHome *)self addBulletinConditions:v26 on:v16 context:v19];
  }

  else
  {
    v30 = objc_autoreleasePoolPush();
    v31 = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
    {
      v33 = HMFGetLogIdentifier();
      *buf = 138543874;
      v36 = v33;
      v37 = 2112;
      v38 = v18;
      v39 = 2112;
      v40 = v14;
      _os_log_impl(&dword_229538000, v32, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize audio analysis reachability bulletin registration on user: %@, registration: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v30);
    v27 = 0;
  }

  v28 = *MEMORY[0x277D85DE8];
  return v27;
}

- (BOOL)insertOrUpdateCameraReachabilityBulletinRegistration:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 user:(id)a7 context:(id)a8
{
  v40 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  if (v16 || (v33 = 0, [MEMORY[0x277CCAD78] UUID], v20 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v18, "materializeOrCreateBulletinRegistrationsRelationOfTypeCameraReachabilityBulletinRegistrationWithModelID:createdNew:", v20, &v33), v16 = objc_claimAutoreleasedReturnValue(), v20, (v33 & 1) != 0))
  {
    v21 = [v15 deviceAddress];
    v22 = [v21 idsIdentifier];
    [v16 setDeviceIdsIdentifier:v22];

    v23 = [v15 deviceAddress];
    v24 = [v23 idsDestination];
    [v16 setDeviceIdsDestination:v24];

    [v16 setAccessory:v17];
    v25 = [v14 conditions];
    v26 = [(HMDHome *)self addBulletinConditions:v25 on:v16 context:v19];
  }

  else
  {
    v29 = objc_autoreleasePoolPush();
    v30 = self;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543874;
      v35 = v32;
      v36 = 2112;
      v37 = v18;
      v38 = 2112;
      v39 = v14;
      _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize camera reachability bulletin registration on user: %@, registration: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v29);
    v26 = 0;
  }

  v27 = *MEMORY[0x277D85DE8];
  return v26;
}

- (BOOL)insertOrUpdateCameraSignificantEventBulletinRegistration:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 user:(id)a7 context:(id)a8
{
  v43 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  if (v16 || (v36 = 0, [MEMORY[0x277CCAD78] UUID], v20 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v18, "materializeOrCreateBulletinRegistrationsRelationOfTypeCameraSignificantEventBulletinRegistrationWithModelID:createdNew:", v20, &v36), v16 = objc_claimAutoreleasedReturnValue(), v20, (v36 & 1) != 0))
  {
    v21 = [v15 deviceAddress];
    v22 = [v21 idsIdentifier];
    [v16 setDeviceIdsIdentifier:v22];

    v23 = [v15 deviceAddress];
    v24 = [v23 idsDestination];
    [v16 setDeviceIdsDestination:v24];

    [v16 setAccessory:v17];
    v25 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v14, "notificationModes")}];
    [v16 setNotificationModes:v25];

    v26 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v14, "significantEventTypes")}];
    [v16 setSignificantEventTypes:v26];

    v27 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v14, "personFamiliarityOptions")}];
    [v16 setPersonFamiliarityOptions:v27];

    v28 = [v14 conditions];
    v29 = [(HMDHome *)self addBulletinConditions:v28 on:v16 context:v19];
  }

  else
  {
    v32 = objc_autoreleasePoolPush();
    v33 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      *buf = 138543874;
      v38 = v35;
      v39 = 2112;
      v40 = v18;
      v41 = 2112;
      v42 = v14;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize camera significant event bulletin registration on user: %@, registration: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v32);
    v29 = 0;
  }

  v30 = *MEMORY[0x277D85DE8];
  return v29;
}

- (BOOL)addPresenceBulletinCondition:(id)a3 on:(id)a4 context:(id)a5
{
  v31 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v28 = 0;
  v11 = [MEMORY[0x277CCAD78] UUID];
  v12 = [v9 materializeOrCreateConditionsRelationOfTypePresenceBulletinConditionWithModelID:v11 createdNew:&v28];

  if (v28)
  {
    v13 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v8, "presenceEventType")}];
    [v12 setPresenceEventType:v13];

    v14 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v8, "presenceEventUserType")}];
    [v12 setPresenceEventUserType:v14];

    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x2020000000;
    v30 = 1;
    v15 = [v8 userUUIDs];
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __74__HMDHome_BulletinNotifications__addPresenceBulletinCondition_on_context___block_invoke;
    v23[3] = &unk_278671E70;
    v24 = v10;
    v25 = self;
    v27 = buf;
    v26 = v12;
    [v15 hmf_enumerateWithAutoreleasePoolUsingBlock:v23];

    v16 = *(*&buf[8] + 24);
    _Block_object_dispose(buf, 8);
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v20;
      *&buf[12] = 2112;
      *&buf[14] = v8;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Unable to create the presence condition from %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
    v16 = 0;
  }

  v21 = *MEMORY[0x277D85DE8];
  return v16 & 1;
}

void __74__HMDHome_BulletinNotifications__addPresenceBulletinCondition_on_context___block_invoke(uint64_t a1, void *a2, _BYTE *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = [*(a1 + 32) managedObjectContext];
  v7 = [_MKFHome findHomeMemberWithUUID:v5 context:v6];

  if (v7)
  {
    v8 = [v7 isRestrictedGuest];
    v9 = *(a1 + 48);
    if (v8)
    {
      v10 = [v7 castIfGuest];
      [v9 addGuestsObject:v10];
    }

    else
    {
      v10 = [v7 castIfUser];
      [v9 addUsersObject:v10];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v14;
      v18 = 2112;
      v19 = v5;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the user: %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    *a3 = 1;
    *(*(*(a1 + 56) + 8) + 24) = 0;
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (BOOL)addSunriseSunSetTimePeriodElement:(id)a3 toCondition:(id)a4 isStartElement:(BOOL)a5
{
  v5 = a5;
  v30 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v23 = 0;
  v10 = [MEMORY[0x277CCAD78] UUID];
  if (v5)
  {
    [v9 materializeOrCreateStartElementRelationOfTypeSunriseSunsetTimeSpecificationWithModelID:v10 createdNew:&v23];
  }

  else
  {
    [v9 materializeOrCreateEndElementRelationOfTypeSunriseSunsetTimeSpecificationWithModelID:v10 createdNew:&v23];
  }
  v11 = ;

  if ((v23 & 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = HMFBooleanToString();
      *buf = 138543874;
      v25 = v15;
      v26 = 2112;
      v27 = v16;
      v28 = 2112;
      v29 = v8;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Unable to create sunrise sunset time period element: (start = %@) (element = %@)", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
  }

  v17 = [v8 significantEvent];
  [v11 setSignificantEvent:v17];

  v18 = MEMORY[0x277CCABB0];
  v19 = [v8 offset];
  v20 = [v18 numberWithInteger:{HMDTimeOffsetFromDateComponents(v19, 0)}];
  [v11 setOffsetSeconds:v20];

  v21 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)addTimeOfDayTimePeriodElement:(id)a3 toCondition:(id)a4 isStartElement:(BOOL)a5
{
  v5 = a5;
  v29 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v22 = 0;
  v10 = [MEMORY[0x277CCAD78] UUID];
  if (v5)
  {
    [v9 materializeOrCreateStartElementRelationOfTypeTimeOfDayTimeSpecificationWithModelID:v10 createdNew:&v22];
  }

  else
  {
    [v9 materializeOrCreateEndElementRelationOfTypeTimeOfDayTimeSpecificationWithModelID:v10 createdNew:&v22];
  }
  v11 = ;

  v12 = v22;
  if (v22)
  {
    v13 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v8, "hour")}];
    [v11 setHour:v13];

    v14 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v8, "minute")}];
    [v11 setMinute:v14];
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v19 = HMFBooleanToString();
      *buf = 138543874;
      v24 = v18;
      v25 = 2112;
      v26 = v19;
      v27 = 2112;
      v28 = v8;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Unable to create time of day time period element: (start = %@) (element = %@)", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v15);
  }

  v20 = *MEMORY[0x277D85DE8];
  return v12;
}

- (BOOL)addTimePeriodBulletinCondition:(id)a3 on:(id)a4
{
  v30 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v25 = 0;
  v8 = [MEMORY[0x277CCAD78] UUID];
  v9 = [v7 materializeOrCreateConditionsRelationOfTypeTimePeriodBulletinConditionWithModelID:v8 createdNew:&v25];

  if ((v25 & 1) == 0)
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v18;
      v28 = 2112;
      v29 = v6;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Unable to create the time period condition from %@", buf, 0x16u);
LABEL_12:

      goto LABEL_13;
    }

    goto LABEL_13;
  }

  v10 = [v6 startElement];
  v11 = [(HMDHome *)self addElement:v10 toCondition:v9 isStartElement:1];

  if (!v11)
  {
    v15 = objc_autoreleasePoolPush();
    v19 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v20 = [v6 startElement];
      *buf = 138543618;
      v27 = v18;
      v28 = 2112;
      v29 = v20;
      v21 = "%{public}@Unable to add start element to the condition: %@";
LABEL_11:
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, v21, buf, 0x16u);

      goto LABEL_12;
    }

LABEL_13:

    objc_autoreleasePoolPop(v15);
    v14 = 0;
    goto LABEL_14;
  }

  v12 = [v6 endElement];
  v13 = [(HMDHome *)self addElement:v12 toCondition:v9 isStartElement:0];

  if (!v13)
  {
    v15 = objc_autoreleasePoolPush();
    v22 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v20 = [v6 startElement];
      *buf = 138543618;
      v27 = v18;
      v28 = 2112;
      v29 = v20;
      v21 = "%{public}@Unable to add end element to the condition: %@";
      goto LABEL_11;
    }

    goto LABEL_13;
  }

  v14 = 1;
LABEL_14:

  v23 = *MEMORY[0x277D85DE8];
  return v14;
}

- (BOOL)addBulletinConditions:(id)a3 on:(id)a4 context:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v10 managedObjectContext];
  [v11 hmd_assertIsExecuting];

  v12 = [v9 conditions];
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __67__HMDHome_BulletinNotifications__addBulletinConditions_on_context___block_invoke;
  v25[3] = &unk_278671E20;
  v13 = v10;
  v26 = v13;
  [v12 hmf_enumerateWithAutoreleasePoolUsingBlock:v25];

  v21 = 0;
  v22 = &v21;
  v23 = 0x2020000000;
  v24 = 1;
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __67__HMDHome_BulletinNotifications__addBulletinConditions_on_context___block_invoke_2;
  v17[3] = &unk_278671E48;
  v20 = &v21;
  v17[4] = self;
  v14 = v9;
  v18 = v14;
  v15 = v13;
  v19 = v15;
  [v8 hmf_enumerateWithAutoreleasePoolUsingBlock:v17];
  LOBYTE(v13) = *(v22 + 24);

  _Block_object_dispose(&v21, 8);
  return v13;
}

void __67__HMDHome_BulletinNotifications__addBulletinConditions_on_context___block_invoke_2(uint64_t a1, void *a2, _BYTE *a3)
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = v6;
    }

    else
    {
      v7 = 0;
    }

    v8 = v7;

    v9 = [*(a1 + 32) addPresenceBulletinCondition:v8 on:*(a1 + 40) context:*(a1 + 48)];
LABEL_11:
    *(*(*(a1 + 56) + 8) + 24) = v9;

    goto LABEL_15;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = v5;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v11 = v10;
    }

    else
    {
      v11 = 0;
    }

    v8 = v11;

    v9 = [*(a1 + 32) addTimePeriodBulletinCondition:v8 on:*(a1 + 40)];
    goto LABEL_11;
  }

  v12 = objc_autoreleasePoolPush();
  v13 = *(a1 + 32);
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
  {
    v15 = HMFGetLogIdentifier();
    v17 = 138543618;
    v18 = v15;
    v19 = 2112;
    v20 = v5;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Unknown bulletin condition found on the bulletin registration : %@", &v17, 0x16u);
  }

  objc_autoreleasePoolPop(v12);
  *(*(*(a1 + 56) + 8) + 24) = 0;
LABEL_15:
  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0)
  {
    *a3 = 1;
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)insertOrUpdateMatterBulletinRegistration:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 homeMember:(id)a7 context:(id)a8
{
  v49 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  v20 = [v19 managedObjectContext];
  [v20 hmd_assertIsExecuting];

  v21 = +[HMDCoreData featuresDataSource];
  v22 = [v21 isRVCEnabled];

  if (!v22)
  {
LABEL_8:
    v31 = 0;
    goto LABEL_9;
  }

  if (!v16)
  {
    v42 = 0;
    v23 = [MEMORY[0x277CCAD78] UUID];
    v16 = [v18 materializeOrCreateBulletinRegistrationsRelationOfTypeMatterBulletinRegistrationWithModelID:v23 createdNew:&v42];

    if ((v42 & 1) == 0)
    {
      v32 = objc_autoreleasePoolPush();
      v33 = self;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543874;
        v44 = v35;
        v45 = 2112;
        v46 = v18;
        v47 = 2112;
        v48 = v14;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize Matter bulletin registration on home member: %@, registration: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v32);
      goto LABEL_8;
    }
  }

  v24 = [v15 deviceAddress];
  v25 = [v24 idsIdentifier];
  [v16 setDeviceIdsIdentifier:v25];

  v26 = [v15 deviceAddress];
  v27 = [v26 idsDestination];
  [v16 setDeviceIdsDestination:v27];

  v28 = [v14 matterPaths];
  v38[0] = MEMORY[0x277D85DD0];
  v38[1] = 3221225472;
  v38[2] = __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke;
  v38[3] = &unk_278671DF8;
  v38[4] = self;
  v29 = v14;
  v39 = v29;
  v16 = v16;
  v40 = v16;
  v41 = v18;
  [v28 na_each:v38];
  v30 = [v29 conditions];
  v31 = [(HMDHome *)self addBulletinConditions:v30 on:v16 context:v19];

LABEL_9:
  v36 = *MEMORY[0x277D85DE8];
  return v31;
}

void __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke(uint64_t a1, void *a2)
{
  v71 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v50 = [v3 uuid];
  v4 = [v3 accessory];
  v5 = [v4 uuid];

  if (v5)
  {
    v6 = [HMCContext findHAPAccessoryWithModelID:v5];
    v7 = v6;
    if (!v6)
    {
      v35 = objc_autoreleasePoolPush();
      v36 = *(a1 + 32);
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
      {
        v38 = HMFGetLogIdentifier();
        *buf = 138543618;
        v58 = v38;
        v59 = 2112;
        v60 = v5;
        _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@No MKFHAPAccessory found with uuid=%@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v35);
      goto LABEL_20;
    }

    v8 = [v6 matterPaths];
    v55[0] = MEMORY[0x277D85DD0];
    v55[1] = 3221225472;
    v55[2] = __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke_1347;
    v55[3] = &unk_278671DA8;
    v9 = v3;
    v56 = v9;
    v10 = [v8 na_firstObjectPassingTest:v55];

    if (!v10)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = *(a1 + 32);
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        *buf = 138543618;
        v58 = v14;
        v59 = 2112;
        v60 = v50;
        _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@Could not locate the MKFMatterPath with UUID: %@, creating one", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
      v54 = 0;
      v10 = [v7 materializeOrCreateMatterPathsRelationWithModelID:v50 createdNew:&v54];
      if ((v54 & 1) == 0)
      {
        v40 = objc_autoreleasePoolPush();
        v41 = *(a1 + 32);
        v42 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
        {
          v43 = HMFGetLogIdentifier();
          v44 = *(a1 + 40);
          *buf = 138543874;
          v58 = v43;
          v59 = 2112;
          v60 = v7;
          v61 = 2112;
          v62 = v44;
          _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize Matter Path on accessory: %@ for registration: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v40);
        goto LABEL_13;
      }

      v15 = [v9 endpointID];
      [v10 setEndpointID:v15];

      v16 = [v9 clusterID];
      [v10 setClusterID:v16];

      v17 = [v9 attributeID];
      [v10 setAttributeID:v17];

      v18 = [v9 eventID];
      [v10 setEventID:v18];

      [v7 addMatterPathsObject:v10];
    }

    v19 = [*(a1 + 48) matterPaths];
    v51[0] = MEMORY[0x277D85DD0];
    v51[1] = 3221225472;
    v51[2] = __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke_1349;
    v51[3] = &unk_278671DD0;
    v20 = v9;
    v52 = v20;
    v53 = v5;
    v21 = [v19 na_any:v51];

    if ((v21 & 1) == 0)
    {
      [*(a1 + 48) addMatterPathsObject:v10];
      [v10 addMatterBulletinRegistrationsObject:*(a1 + 48)];
      v22 = objc_autoreleasePoolPush();
      v23 = *(a1 + 32);
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v48 = HMFGetLogIdentifier();
        v46 = [v20 accessory];
        [v46 uuid];
        v25 = v45 = v23;
        [v20 endpointID];
        v26 = log = v24;
        v27 = [v20 clusterID];
        [v20 attributeID];
        v28 = v47 = v22;
        v29 = [v20 eventID];
        v30 = [*(a1 + 56) uniqueIDForAccessories];
        *buf = 138544898;
        v58 = v48;
        v59 = 2112;
        v60 = v25;
        v61 = 2112;
        v62 = v26;
        v63 = 2112;
        v64 = v27;
        v65 = 2112;
        v66 = v28;
        v67 = 2112;
        v68 = v29;
        v69 = 2112;
        v70 = v30;
        _os_log_impl(&dword_229538000, log, OS_LOG_TYPE_INFO, "%{public}@Inserted Matter bulletin registration with accessoryModelID=%@ endpointID=%@ clusterID=%@ attributeID=%@ eventID=%@ for home member uniqueID=%@", buf, 0x48u);

        v22 = v47;
        v24 = log;

        v23 = v45;
      }

      objc_autoreleasePoolPop(v22);
    }

LABEL_13:
LABEL_20:

    goto LABEL_21;
  }

  v31 = objc_autoreleasePoolPush();
  v32 = *(a1 + 32);
  v33 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
  {
    v34 = HMFGetLogIdentifier();
    *buf = 138543618;
    v58 = v34;
    v59 = 2112;
    v60 = v3;
    _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Matter path is missing accessory: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v31);
LABEL_21:

  v39 = *MEMORY[0x277D85DE8];
}

uint64_t __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke_1347(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 endpointID];
  v5 = [*(a1 + 32) endpointID];
  v6 = HMFEqualObjects();

  if (!v6)
  {
    goto LABEL_5;
  }

  v7 = [v3 clusterID];
  v8 = [*(a1 + 32) clusterID];
  v9 = HMFEqualObjects();

  if (!v9)
  {
    goto LABEL_5;
  }

  v10 = [v3 attributeID];
  v11 = [*(a1 + 32) attributeID];
  v12 = HMFEqualObjects();

  if (v12)
  {
    v13 = [v3 eventID];
    v14 = [*(a1 + 32) eventID];
    v15 = HMFEqualObjects();
  }

  else
  {
LABEL_5:
    v15 = 0;
  }

  return v15;
}

uint64_t __139__HMDHome_BulletinNotifications__insertOrUpdateMatterBulletinRegistration_source_managedBulletinRegistration_accessory_homeMember_context___block_invoke_1349(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 endpointID];
  v5 = [*(a1 + 32) endpointID];
  v6 = HMFEqualObjects();

  if (!v6)
  {
    goto LABEL_6;
  }

  v7 = [v3 accessory];
  v8 = [v7 modelID];
  v9 = *(a1 + 40);
  v10 = HMFEqualObjects();

  if (!v10)
  {
    goto LABEL_6;
  }

  v11 = [v3 clusterID];
  v12 = [*(a1 + 32) clusterID];
  v13 = HMFEqualObjects();

  if (!v13)
  {
    goto LABEL_6;
  }

  v14 = [v3 attributeID];
  v15 = [*(a1 + 32) attributeID];
  v16 = HMFEqualObjects();

  if (v16)
  {
    v17 = [v3 eventID];
    v18 = [*(a1 + 32) eventID];
    v19 = HMFEqualObjects();
  }

  else
  {
LABEL_6:
    v19 = 0;
  }

  return v19;
}

- (BOOL)insertOrUpdateCharacteristicBulletinRegistration:(id)a3 source:(id)a4 managedBulletinRegistration:(id)a5 accessory:(id)a6 homeMember:(id)a7 context:(id)a8
{
  v52 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  v20 = [v19 managedObjectContext];
  [v20 hmd_assertIsExecuting];

  if (v16 || (v45 = 0, [MEMORY[0x277CCAD78] UUID], v21 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v18, "materializeOrCreateBulletinRegistrationsRelationOfTypeCharacteristicBulletinRegistrationWithModelID:createdNew:", v21, &v45), v16 = objc_claimAutoreleasedReturnValue(), v21, (v45 & 1) != 0))
  {
    v22 = [v15 deviceAddress];
    v23 = [v22 idsIdentifier];
    [v16 setDeviceIdsIdentifier:v23];

    v24 = [v15 deviceAddress];
    v25 = [v24 idsDestination];
    [v16 setDeviceIdsDestination:v25];

    v26 = [v14 characteristicInstanceID];
    v27 = [v19 managedObjectContext];
    v28 = [v17 characteristicFromInstanceID:v26 context:v27];

    if (v28)
    {
      [v16 setCharacteristic:v28];
      [v14 conditions];
      v30 = v29 = v18;
      v31 = [(HMDHome *)self addBulletinConditions:v30 on:v16 context:v19];

      v18 = v29;
    }

    else
    {
      v32 = objc_autoreleasePoolPush();
      v33 = self;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v35 = v43 = v32;
        [v14 characteristicInstanceID];
        v36 = v44 = v18;
        *buf = 138543618;
        v47 = v35;
        v48 = 2112;
        v49 = v36;
        _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Could not locate the characteristic with instance ID: %@", buf, 0x16u);

        v18 = v44;
        v32 = v43;
      }

      objc_autoreleasePoolPop(v32);
      v31 = 0;
    }
  }

  else
  {
    v39 = objc_autoreleasePoolPush();
    v40 = self;
    v41 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
    {
      v42 = HMFGetLogIdentifier();
      *buf = 138543874;
      v47 = v42;
      v48 = 2112;
      v49 = v18;
      v50 = 2112;
      v51 = v14;
      _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_ERROR, "%{public}@Unable to create or materialize characteristic bulletin registration on home member: %@, registration: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v39);
    v31 = 0;
  }

  v37 = *MEMORY[0x277D85DE8];
  return v31;
}

- (id)findBulletinRegistration:(id)a3 source:(id)a4 homeMember:(id)a5 context:(id)a6
{
  v155 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v14 = [v13 managedObjectContext];
  [v14 hmd_assertIsExecuting];

  v15 = [MEMORY[0x277CBEB38] dictionary];
  objc_opt_class();
  v143 = v11;
  v144 = v13;
  if (objc_opt_isKindOfClass())
  {
    v135 = self;
    v16 = v15;
    v139 = v10;
    v17 = v10;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    v20 = [v19 accessoryUUID];
    v21 = [v19 serviceInstanceID];
    v22 = [v19 characteristicInstanceID];
    v23 = [v11 deviceAddress];
    [v23 idsIdentifier];
    v25 = v24 = v12;
    v26 = [v13 managedObjectContext];
    v137 = [v24 characteristicBulletinRegistrationForAccessory:v20 serviceInstanceID:v21 characteristicInstanceID:v22 deviceIdsIdentifier:v25 context:v26];

    v27 = v24;
    v28 = [v24 home];
    v29 = [v19 accessoryUUID];
    v30 = [v28 findAccessoriesRelationOfTypeHAPAccessoryWithModelID:v29];

    if (v30)
    {
      v15 = v16;
      [v16 setObject:v30 forKeyedSubscript:@"HMD.BU.TUP.acc"];

      v10 = v139;
      v12 = v27;
      v11 = v143;
      v31 = v137;
LABEL_53:
      [v15 setObject:v31 forKeyedSubscript:@"HMD.BU.TUP.bulletin"];
      v66 = v15;
      goto LABEL_87;
    }

    v62 = objc_autoreleasePoolPush();
    v63 = v135;
    v64 = HMFGetOSLogHandle();
    v15 = v16;
    if (os_log_type_enabled(v64, OS_LOG_TYPE_ERROR))
    {
      v65 = HMFGetLogIdentifier();
      *buf = 138543618;
      v146 = v65;
      v147 = 2112;
      v148 = v17;
      _os_log_impl(&dword_229538000, v64, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the accessory : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v62);
    v66 = MEMORY[0x277CBEC10];
    v10 = v139;
    v12 = v27;
    v11 = v143;
    v31 = v137;
    goto LABEL_87;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v48 = self;
      v33 = v15;
      v49 = v10;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v50 = v49;
      }

      else
      {
        v50 = 0;
      }

      v36 = v50;

      v51 = v12;
      if ([v51 conformsToProtocol:&unk_283EF6078])
      {
        v52 = v51;
      }

      else
      {
        v52 = 0;
      }

      v53 = v52;

      if (!v53)
      {
        v73 = objc_autoreleasePoolPush();
        v74 = v48;
        v75 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
        {
          v76 = HMFGetLogIdentifier();
          *buf = 138543618;
          v146 = v76;
          v147 = 2112;
          v148 = v51;
          v77 = "%{public}@Camera access bulletin notification registrations are not supported for guests : %@";
          goto LABEL_79;
        }

LABEL_80:

        objc_autoreleasePoolPop(v73);
LABEL_86:

        v31 = 0;
        v66 = MEMORY[0x277CBEC10];
        v15 = v33;
        v11 = v143;
        goto LABEL_87;
      }

      v54 = [v53 home];
      [v36 accessoryUUID];
      v55 = v141 = v36;
      v56 = [v54 findAccessoriesRelationOfTypeHAPAccessoryWithModelID:v55];

      if (v56)
      {
        v15 = v33;
        [v33 setObject:v56 forKeyedSubscript:@"HMD.BU.TUP.acc"];
        v11 = v143;
        v57 = [v143 deviceAddress];
        v58 = [v57 idsIdentifier];
        [v13 managedObjectContext];
        v60 = v59 = v12;
        v61 = [v56 cameraAccessModeBulletinRegistrationWithDeviceIdsIdentifier:v58 user:v53 context:v60];
LABEL_52:
        v31 = v61;

        v12 = v59;
        goto LABEL_53;
      }

      v36 = v141;
      v114 = objc_autoreleasePoolPush();
      v115 = v48;
      v116 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v116, OS_LOG_TYPE_ERROR))
      {
LABEL_69:
        HMFGetLogIdentifier();
        v118 = v117 = v114;
        *buf = 138543618;
        v146 = v118;
        v147 = 2112;
        v148 = v49;
        v119 = "%{public}@Unable to find the accessory : %@";
LABEL_84:
        _os_log_impl(&dword_229538000, v116, OS_LOG_TYPE_ERROR, v119, buf, 0x16u);

        v114 = v117;
      }
    }

    else
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v67 = self;
        v33 = v15;
        v49 = v10;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v68 = v49;
        }

        else
        {
          v68 = 0;
        }

        v36 = v68;

        v69 = v12;
        if ([v69 conformsToProtocol:&unk_283EF6078])
        {
          v70 = v69;
        }

        else
        {
          v70 = 0;
        }

        v53 = v70;

        if (!v53)
        {
          v73 = objc_autoreleasePoolPush();
          v74 = v67;
          v75 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
          {
            v76 = HMFGetLogIdentifier();
            *buf = 138543618;
            v146 = v76;
            v147 = 2112;
            v148 = v69;
            v77 = "%{public}@Camera reachability bulletin notification registrations are not supported for guests : %@";
            goto LABEL_79;
          }

          goto LABEL_80;
        }

        v71 = [v53 home];
        [v36 accessoryUUID];
        v72 = v141 = v36;
        v56 = [v71 findAccessoriesRelationOfTypeHAPAccessoryWithModelID:v72];

        if (v56)
        {
          v15 = v33;
          [v33 setObject:v56 forKeyedSubscript:@"HMD.BU.TUP.acc"];
          v11 = v143;
          v57 = [v143 deviceAddress];
          v58 = [v57 idsIdentifier];
          [v13 managedObjectContext];
          v60 = v59 = v12;
          v61 = [v56 cameraReachabilityBulletinRegistrationWithDeviceIdsIdentifier:v58 user:v53 context:v60];
          goto LABEL_52;
        }

        v36 = v141;
        v114 = objc_autoreleasePoolPush();
        v115 = v67;
        v116 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v116, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_69;
        }
      }

      else
      {
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          v90 = v12;
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) == 0)
          {
            v120 = v15;
            v121 = objc_autoreleasePoolPush();
            v122 = self;
            v123 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v123, OS_LOG_TYPE_INFO))
            {
              v124 = HMFGetLogIdentifier();
              *buf = 138543618;
              v146 = v124;
              v147 = 2112;
              v148 = v10;
              _os_log_impl(&dword_229538000, v123, OS_LOG_TYPE_INFO, "%{public}@(b) Unknown bulletin registration type found. Ignoring it : %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v121);
            v15 = v120;
            v31 = 0;
            goto LABEL_53;
          }

          v91 = +[HMDCoreData featuresDataSource];
          v92 = [v91 isRVCEnabled];

          if (!v92)
          {
            v31 = 0;
            goto LABEL_53;
          }

          v142 = v15;
          v93 = v10;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v94 = v93;
          }

          else
          {
            v94 = 0;
          }

          v95 = v94;
          v132 = v93;

          v138 = v95;
          v96 = [v95 matterPaths];
          v97 = [v96 firstObject];

          v98 = [v97 endpointID];
          v136 = v97;
          v99 = [v97 accessory];
          v100 = [v99 uuid];

          v101 = objc_autoreleasePoolPush();
          v102 = self;
          v103 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v103, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v104 = v133 = v101;
            v105 = [v12 uniqueIDForAccessories];
            v106 = [v143 deviceAddress];
            v107 = [v106 idsIdentifier];
            *buf = 138544386;
            v146 = v104;
            v147 = 2112;
            v148 = v105;
            v149 = 2112;
            v150 = v98;
            v151 = 2112;
            v152 = v100;
            v153 = 2112;
            v154 = v107;
            _os_log_impl(&dword_229538000, v103, OS_LOG_TYPE_INFO, "%{public}@Finding HMDMatterBulletinNotificationRegistration for HomeMemberUniqueIDForAccessories=%@ endpointID=%@ accessoryUUID=%@ deviceIdsIdentifier=%@", buf, 0x34u);

            v101 = v133;
          }

          objc_autoreleasePoolPop(v101);
          v108 = [v143 deviceAddress];
          v109 = [v108 idsIdentifier];
          v110 = [v144 managedObjectContext];
          v134 = v98;
          v31 = [v90 matterBulletinRegistrationForEndpointID:v98 accessoryUUID:v100 deviceIdsIdentifier:v109 context:v110];

          v12 = v90;
          v111 = [v90 home];
          v112 = [v111 findAccessoriesRelationOfTypeHAPAccessoryWithModelID:v100];

          v113 = v100;
          if (v112)
          {
            v15 = v142;
            [v142 setObject:v112 forKeyedSubscript:@"HMD.BU.TUP.acc"];
            v11 = v143;
          }

          else
          {
            v127 = v31;
            v128 = objc_autoreleasePoolPush();
            v129 = v102;
            v130 = HMFGetOSLogHandle();
            v15 = v142;
            if (os_log_type_enabled(v130, OS_LOG_TYPE_ERROR))
            {
              v131 = HMFGetLogIdentifier();
              *buf = 138543618;
              v146 = v131;
              v147 = 2112;
              v148 = v132;
              _os_log_impl(&dword_229538000, v130, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the accessory : %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v128);
            v11 = v143;
            v31 = v127;
          }

          if (v112)
          {
            goto LABEL_53;
          }

          v66 = MEMORY[0x277CBEC10];
          goto LABEL_87;
        }

        v78 = self;
        v33 = v15;
        v79 = v10;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v80 = v79;
        }

        else
        {
          v80 = 0;
        }

        v36 = v80;

        v81 = v12;
        if ([v81 conformsToProtocol:&unk_283EF6078])
        {
          v82 = v81;
        }

        else
        {
          v82 = 0;
        }

        v53 = v82;

        if (!v53)
        {
          v73 = objc_autoreleasePoolPush();
          v74 = v78;
          v75 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
          {
            v76 = HMFGetLogIdentifier();
            *buf = 138543618;
            v146 = v76;
            v147 = 2112;
            v148 = v81;
            v77 = "%{public}@Audio analysis event bulletin notification registrations are not supported for guests : %@";
            goto LABEL_79;
          }

          goto LABEL_80;
        }

        v83 = [v53 home];
        [v36 accessoryUUID];
        v84 = v141 = v36;
        v56 = [v83 findAccessoriesRelationOfTypeAppleMediaAccessoryWithModelID:v84];

        if (v56)
        {
          v15 = v33;
          [v33 setObject:v56 forKeyedSubscript:@"HMD.BU.TUP.acc"];
          v11 = v143;
          v57 = [v143 deviceAddress];
          v58 = [v57 idsIdentifier];
          [v13 managedObjectContext];
          v60 = v59 = v12;
          v61 = [v56 analysisBulletinRegistrationWithDeviceIdsIdentifier:v58 user:v53 context:v60];
          goto LABEL_52;
        }

        v36 = v141;
        v114 = objc_autoreleasePoolPush();
        v115 = v78;
        v116 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v116, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v118 = v117 = v114;
          *buf = 138543618;
          v146 = v118;
          v147 = 2112;
          v148 = v79;
          v119 = "%{public}@Unable to find the accessory for audio analysis registration registration :%@";
          goto LABEL_84;
        }
      }
    }

    objc_autoreleasePoolPop(v114);
    goto LABEL_86;
  }

  v32 = self;
  v33 = v15;
  v34 = v10;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v35 = v34;
  }

  else
  {
    v35 = 0;
  }

  v36 = v35;

  v37 = v12;
  if ([v37 conformsToProtocol:&unk_283EF6078])
  {
    v38 = v37;
  }

  else
  {
    v38 = 0;
  }

  v39 = v38;

  if (!v39)
  {
    v73 = objc_autoreleasePoolPush();
    v74 = v32;
    v75 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
    {
      v76 = HMFGetLogIdentifier();
      *buf = 138543618;
      v146 = v76;
      v147 = 2112;
      v148 = v37;
      v77 = "%{public}@Camera significant event bulletin notification registrations are not supported for guests : %@";
LABEL_79:
      _os_log_impl(&dword_229538000, v75, OS_LOG_TYPE_ERROR, v77, buf, 0x16u);

      goto LABEL_80;
    }

    goto LABEL_80;
  }

  v140 = v10;
  v40 = [v39 home];
  [v36 cameraIdentifier];
  v42 = v41 = v36;
  v43 = [v40 findAccessoriesRelationOfTypeHAPAccessoryWithModelID:v42];

  if (v43)
  {
    v15 = v33;
    [v33 setObject:v43 forKeyedSubscript:@"HMD.BU.TUP.acc"];
    v11 = v143;
    v44 = [v143 deviceAddress];
    v45 = [v44 idsIdentifier];
    [v13 managedObjectContext];
    v47 = v46 = v12;
    v31 = [v43 cameraSignificantEventBulletinRegistrationWithDeviceIdsIdentifier:v45 user:v39 context:v47];

    v12 = v46;
    v10 = v140;
    goto LABEL_53;
  }

  v85 = v41;
  v86 = objc_autoreleasePoolPush();
  v87 = v32;
  v88 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v88, OS_LOG_TYPE_ERROR))
  {
    v89 = HMFGetLogIdentifier();
    *buf = 138543618;
    v146 = v89;
    v147 = 2112;
    v148 = v34;
    _os_log_impl(&dword_229538000, v88, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the accessory : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v86);
  v31 = 0;
  v66 = MEMORY[0x277CBEC10];
  v15 = v33;
  v10 = v140;
  v11 = v143;
LABEL_87:

  v125 = *MEMORY[0x277D85DE8];

  return v66;
}

- (void)maybeRemoveStaleRegistrationsFromPreviousUserForSource:(id)a3 homeMember:(id)a4 context:(id)a5
{
  v43[2] = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v10 managedObjectContext];
  [v11 hmd_assertIsExecuting];

  v12 = [v8 deviceAddress];
  v13 = [v12 idsIdentifier];

  v14 = +[_MKFBulletinRegistration fetchRequest];
  v15 = [MEMORY[0x277CCAC30] predicateWithFormat:@"(%K == %@) && (%K != %@)", @"deviceIdsIdentifier", v13, @"user", v9];
  [v14 setPredicate:v15];
  v16 = [MEMORY[0x277CCAC30] predicateWithFormat:@"(%K == %@) && (%K != %@)", @"deviceIdsIdentifier", v13, @"guest", v9];
  v17 = MEMORY[0x277CCA920];
  v43[0] = v15;
  v43[1] = v16;
  v18 = [MEMORY[0x277CBEA60] arrayWithObjects:v43 count:2];
  v19 = [v17 orPredicateWithSubpredicates:v18];
  [v14 setPredicate:v19];

  v20 = [v10 managedObjectContext];
  v36 = 0;
  v21 = [v20 executeFetchRequest:v14 error:&v36];
  v33 = v36;

  if (v21)
  {
    if ([v21 count])
    {
      context = objc_autoreleasePoolPush();
      v22 = self;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v24 = v29 = v8;
        *buf = 138543874;
        v38 = v24;
        v39 = 2112;
        v40 = v21;
        v41 = 2112;
        v42 = v13;
        _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Deleting stale registrations: %@ for idsIdentifier: %@", buf, 0x20u);

        v8 = v29;
      }

      objc_autoreleasePoolPop(context);
      v34[0] = MEMORY[0x277D85DD0];
      v34[1] = 3221225472;
      v34[2] = __108__HMDHome_BulletinNotifications__maybeRemoveStaleRegistrationsFromPreviousUserForSource_homeMember_context___block_invoke;
      v34[3] = &unk_27867ED28;
      v35 = v10;
      [v21 na_each:v34];
    }
  }

  else
  {
    contexta = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v27 = v30 = v8;
      *buf = 138543618;
      v38 = v27;
      v39 = 2112;
      v40 = v13;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch bulletin registrations for idsIdentifier: %@", buf, 0x16u);

      v8 = v30;
    }

    objc_autoreleasePoolPop(contexta);
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)disableBulletinRegistrations:(id)a3 source:(id)a4 homeMember:(id)a5 context:(id)a6
{
  v10 = a4;
  v11 = a5;
  v12 = a6;
  v13 = a3;
  v14 = [v12 managedObjectContext];
  [v14 hmd_assertIsExecuting];

  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __89__HMDHome_BulletinNotifications__disableBulletinRegistrations_source_homeMember_context___block_invoke;
  v18[3] = &unk_278671D80;
  v18[4] = self;
  v19 = v10;
  v20 = v11;
  v21 = v12;
  v15 = v12;
  v16 = v11;
  v17 = v10;
  [v13 hmf_enumerateWithAutoreleasePoolUsingBlock:v18];
}

void __89__HMDHome_BulletinNotifications__disableBulletinRegistrations_source_homeMember_context___block_invoke(uint64_t a1, uint64_t a2)
{
  v4 = [*(a1 + 32) findBulletinRegistration:a2 source:*(a1 + 40) homeMember:*(a1 + 48) context:*(a1 + 56)];
  v3 = [v4 objectForKeyedSubscript:@"HMD.BU.TUP.bulletin"];
  if (v3)
  {
    [*(a1 + 56) deleteObject:v3];
  }
}

- (BOOL)enableBulletinRegistrations:(id)a3 source:(id)a4 homeMember:(id)a5 context:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v14 = [v13 managedObjectContext];
  [v14 hmd_assertIsExecuting];

  v24 = 0;
  v25 = &v24;
  v26 = 0x2020000000;
  v27 = 1;
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __88__HMDHome_BulletinNotifications__enableBulletinRegistrations_source_homeMember_context___block_invoke;
  v19[3] = &unk_278671D58;
  v19[4] = self;
  v15 = v11;
  v20 = v15;
  v16 = v12;
  v21 = v16;
  v17 = v13;
  v22 = v17;
  v23 = &v24;
  [v10 hmf_enumerateWithAutoreleasePoolUsingBlock:v19];
  LOBYTE(v11) = *(v25 + 24);

  _Block_object_dispose(&v24, 8);
  return v11;
}

void __88__HMDHome_BulletinNotifications__enableBulletinRegistrations_source_homeMember_context___block_invoke(uint64_t a1, void *a2, _BYTE *a3)
{
  v158 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = [*(a1 + 32) findBulletinRegistration:v5 source:*(a1 + 40) homeMember:*(a1 + 48) context:*(a1 + 56)];
  v7 = [v6 objectForKeyedSubscript:@"HMD.BU.TUP.bulletin"];
  v8 = [v6 objectForKeyedSubscript:@"HMD.BU.TUP.acc"];
  if (v8)
  {
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      v36 = 1;
      goto LABEL_23;
    }

    v146 = a3;
    v152 = v8;
    v9 = v8;
    v10 = [v9 conformsToProtocol:&unk_283F1F3B0];
    v11 = v10;
    if (v10)
    {
      v12 = v9;
    }

    else
    {
      v12 = 0;
    }

    v13 = v12;

    v14 = v5;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;

    v17 = [v7 castIfAnalysisEventBulletinRegistration];
    if (v11)
    {
      v143 = v7;
      v18 = v14;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v19 = v18;
      }

      else
      {
        v19 = 0;
      }

      v20 = v19;

      if (v17)
      {
        v21 = [HMDBulletinNotificationRegistrationUtilities audioAnalysisNotificationRegistrationFromRemoteRegistration:v17];
        v22 = [v21 registration];
        if ([v22 isEqual:v20])
        {
          [v21 source];
          v140 = v17;
          v23 = v5;
          v24 = v6;
          v25 = v20;
          v27 = v26 = v16;
          v28 = [v27 isEqual:*(a1 + 40)];

          v16 = v26;
          v20 = v25;
          v6 = v24;
          v5 = v23;
          v17 = v140;

          if (v28)
          {
            v29 = objc_autoreleasePoolPush();
            v139 = *(a1 + 32);
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
            {
              HMFGetLogIdentifier();
              v31 = v138 = v29;
              *buf = 138543618;
              v155 = v31;
              v156 = 2112;
              v157 = v20;
              _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Audio Analysis bulletin registration: %@ matches existing registration, skipping", buf, 0x16u);

              v29 = v138;
            }

            objc_autoreleasePoolPop(v29);
            goto LABEL_62;
          }
        }

        else
        {
        }
      }

      v76 = *(a1 + 48);
      if ([v76 conformsToProtocol:&unk_283EF6078])
      {
        v77 = v76;
      }

      else
      {
        v77 = 0;
      }

      v21 = v77;

      if (v21)
      {
        v78 = [*(a1 + 32) insertOrUpdateAudioAnalysisEventBulletinRegistrations:v20 source:*(a1 + 40) managedBulletinRegistration:v17 accessory:v9 user:v21 context:*(a1 + 56)];
        v36 = v78;
        v79 = v78 ^ 1;
        goto LABEL_63;
      }

      v80 = objc_autoreleasePoolPush();
      v81 = *(a1 + 32);
      v82 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v82, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v83 = v142 = v80;
        v84 = *(a1 + 48);
        *buf = 138543618;
        v155 = v83;
        v156 = 2112;
        v157 = v84;
        _os_log_impl(&dword_229538000, v82, OS_LOG_TYPE_ERROR, "%{public}@Audio analysis bulletin notification registrations are not supported for guests : %@", buf, 0x16u);

        v80 = v142;
      }

      objc_autoreleasePoolPop(v80);
      v21 = 0;
LABEL_62:
      v79 = 0;
      v36 = 1;
LABEL_63:

      v7 = v143;
      a3 = v146;
      v8 = v152;
      if (!v79)
      {
        goto LABEL_144;
      }

LABEL_23:
      v37 = v8;
      v38 = [v37 conformsToProtocol:&unk_283F59838];
      v39 = v38;
      if (v38)
      {
        v40 = v37;
      }

      else
      {
        v40 = 0;
      }

      v41 = v40;

      if ((v39 & 1) == 0)
      {
        *a3 = 1;
        *(*(*(a1 + 64) + 8) + 24) = 0;
        v54 = objc_autoreleasePoolPush();
        v55 = *(a1 + 32);
        v56 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v56, OS_LOG_TYPE_ERROR))
        {
          v57 = HMFGetLogIdentifier();
          *buf = 138543618;
          v155 = v57;
          v156 = 2112;
          v157 = v5;
          _os_log_impl(&dword_229538000, v56, OS_LOG_TYPE_ERROR, "%{public}@Did not find the accessory on which this bulletin needs to be applied upon. %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v54);
        goto LABEL_143;
      }

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v147 = a3;
        v42 = v5;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v43 = v42;
        }

        else
        {
          v43 = 0;
        }

        v44 = v43;

        v45 = [v7 castIfCharacteristicBulletinRegistration];
        if (v45)
        {
          v141 = v41;
          v144 = v7;
          v153 = v8;
          v46 = [HMDBulletinNotificationRegistrationUtilities accessoryRegistrationFromMKFRegistration:v45];
          v47 = [v46 registration];
          if ([v47 isEqual:v44])
          {
            v48 = [v46 source];
            v49 = [v48 isEqual:*(a1 + 40)];

            if (v49)
            {
              v50 = objc_autoreleasePoolPush();
              v51 = *(a1 + 32);
              v52 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
              {
                v53 = HMFGetLogIdentifier();
                *buf = 138543618;
                v155 = v53;
                v156 = 2112;
                v157 = v44;
                _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_INFO, "%{public}@Characteristic bulletin registration: %@ matches existing registration, skipping", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v50);
              goto LABEL_89;
            }
          }

          else
          {
          }

          v41 = v141;
          v7 = v144;
          v8 = v153;
        }

        v90 = [*(a1 + 32) insertOrUpdateCharacteristicBulletinRegistration:v44 source:*(a1 + 40) managedBulletinRegistration:v45 accessory:v37 homeMember:*(a1 + 48) context:{*(a1 + 56), v138}];

        a3 = v147;
        if (v90)
        {
          goto LABEL_143;
        }

LABEL_142:
        *a3 = 1;
        *(*(*(a1 + 64) + 8) + 24) = 0;
        goto LABEL_143;
      }

      objc_opt_class();
      v153 = v8;
      if (objc_opt_isKindOfClass())
      {
        v63 = v5;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v64 = v63;
        }

        else
        {
          v64 = 0;
        }

        v65 = v64;

        v144 = v7;
        v66 = [v7 castIfCameraSignificantEventBulletinRegistration];
        if (v66)
        {
          v148 = a3;
          v141 = v41;
          v67 = [HMDBulletinNotificationRegistrationUtilities cameraSignificantEventRegistrationFromMKFRegistration:v66];
          v68 = [v67 registration];
          if ([v68 isEqual:v65])
          {
            v69 = [v67 source];
            v70 = [v69 isEqual:*(a1 + 40)];

            if (v70)
            {
              v71 = objc_autoreleasePoolPush();
              v72 = *(a1 + 32);
              v73 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v73, OS_LOG_TYPE_INFO))
              {
                v74 = HMFGetLogIdentifier();
                *buf = 138543618;
                v155 = v74;
                v156 = 2112;
                v157 = v65;
                v75 = "%{public}@Camera Significant Event bulletin registration: %@ matches existing registration, skipping";
LABEL_87:
                _os_log_impl(&dword_229538000, v73, OS_LOG_TYPE_INFO, v75, buf, 0x16u);

                goto LABEL_88;
              }

              goto LABEL_88;
            }
          }

          else
          {
          }

          v41 = v141;
          a3 = v148;
        }

        v96 = *(a1 + 48);
        if ([v96 conformsToProtocol:&unk_283EF6078])
        {
          v97 = v96;
        }

        else
        {
          v97 = 0;
        }

        v98 = v97;

        if (v98)
        {
          v99 = [*(a1 + 32) insertOrUpdateCameraSignificantEventBulletinRegistration:v65 source:*(a1 + 40) managedBulletinRegistration:v66 accessory:v37 user:v98 context:*(a1 + 56)];
          goto LABEL_130;
        }

        v100 = objc_autoreleasePoolPush();
        v101 = *(a1 + 32);
        v102 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v102, OS_LOG_TYPE_ERROR))
        {
          v103 = HMFGetLogIdentifier();
          v104 = *(a1 + 48);
          *buf = 138543618;
          v155 = v103;
          v156 = 2112;
          v157 = v104;
          v105 = "%{public}@Camera significant event bulletin notification registrations are not supported for guests : %@";
LABEL_134:
          _os_log_impl(&dword_229538000, v102, OS_LOG_TYPE_ERROR, v105, buf, 0x16u);

          goto LABEL_135;
        }

        goto LABEL_135;
      }

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v85 = v5;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v86 = v85;
        }

        else
        {
          v86 = 0;
        }

        v65 = v86;

        v144 = v7;
        v66 = [v7 castIfCameraAccessModeBulletinRegistration];
        if (v66)
        {
          v149 = a3;
          v141 = v41;
          v67 = [HMDBulletinNotificationRegistrationUtilities cameraAccessModeRegistrationFromMKFRegistration:v66];
          v87 = [v67 registration];
          if ([v87 isEqual:v65])
          {
            v88 = [v67 source];
            v89 = [v88 isEqual:*(a1 + 40)];

            if (v89)
            {
              v71 = objc_autoreleasePoolPush();
              v72 = *(a1 + 32);
              v73 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v73, OS_LOG_TYPE_INFO))
              {
                v74 = HMFGetLogIdentifier();
                *buf = 138543618;
                v155 = v74;
                v156 = 2112;
                v157 = v65;
                v75 = "%{public}@Camera Access Mode bulletin registration: %@ matches existing registration, skipping";
                goto LABEL_87;
              }

LABEL_88:

              objc_autoreleasePoolPop(v71);
LABEL_89:
              v7 = v144;
LABEL_90:
              v8 = v153;
              v41 = v141;
LABEL_143:

              goto LABEL_144;
            }
          }

          else
          {
          }

          v41 = v141;
          a3 = v149;
        }

        v120 = *(a1 + 48);
        if ([v120 conformsToProtocol:&unk_283EF6078])
        {
          v121 = v120;
        }

        else
        {
          v121 = 0;
        }

        v98 = v121;

        if (!v98)
        {
          v100 = objc_autoreleasePoolPush();
          v101 = *(a1 + 32);
          v102 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v102, OS_LOG_TYPE_ERROR))
          {
            v103 = HMFGetLogIdentifier();
            v122 = *(a1 + 48);
            *buf = 138543618;
            v155 = v103;
            v156 = 2112;
            v157 = v122;
            v105 = "%{public}@Camera access mode bulletin notification registrations are not supported for guests : %@";
            goto LABEL_134;
          }

LABEL_135:

          objc_autoreleasePoolPop(v100);
          v7 = v144;
          v8 = v153;
          goto LABEL_143;
        }

        v99 = [*(a1 + 32) insertOrUpdateCameraAccessModeBulletinRegistration:v65 source:*(a1 + 40) managedBulletinRegistration:v66 accessory:v37 user:v98 context:*(a1 + 56)];
      }

      else
      {
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          v151 = a3;
          v141 = v41;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v106 = +[HMDCoreData featuresDataSource];
            v107 = [v106 isRVCEnabled];

            if (v107)
            {
              v108 = v5;
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v109 = v108;
              }

              else
              {
                v109 = 0;
              }

              v145 = v109;

              v110 = [v7 castIfMatterBulletinRegistration];
              if (v110)
              {
                v111 = [HMDBulletinNotificationRegistrationUtilities matterRegistrationFromMKFRegistration:v110 home:*(a1 + 32)];
                v112 = [v111 registration];
                if ([v112 isEqual:v145])
                {
                  v113 = [v111 source];
                  v114 = [v113 isEqual:*(a1 + 40)];

                  if (v114)
                  {
                    v115 = v7;
                    v116 = objc_autoreleasePoolPush();
                    v117 = *(a1 + 32);
                    v118 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v118, OS_LOG_TYPE_INFO))
                    {
                      v119 = HMFGetLogIdentifier();
                      *buf = 138543618;
                      v155 = v119;
                      v156 = 2112;
                      v157 = v145;
                      _os_log_impl(&dword_229538000, v118, OS_LOG_TYPE_INFO, "%{public}@Matter bulletin registration: %@ matches existing registration, skipping", buf, 0x16u);
                    }

                    objc_autoreleasePoolPop(v116);
                    v7 = v115;
                    goto LABEL_90;
                  }
                }

                else
                {
                }
              }

              v132 = v7;
              v133 = objc_autoreleasePoolPush();
              v134 = *(a1 + 32);
              v135 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v135, OS_LOG_TYPE_INFO))
              {
                v136 = HMFGetLogIdentifier();
                *buf = 138543362;
                v155 = v136;
                _os_log_impl(&dword_229538000, v135, OS_LOG_TYPE_INFO, "%{public}@Inserting Matter bulletin registration", buf, 0xCu);
              }

              objc_autoreleasePoolPop(v133);
              v36 = [*(a1 + 32) insertOrUpdateMatterBulletinRegistration:v145 source:*(a1 + 40) managedBulletinRegistration:v110 accessory:v37 homeMember:*(a1 + 48) context:*(a1 + 56)];

              v7 = v132;
              v8 = v153;
            }
          }

          else
          {
            v123 = v8;
            v124 = objc_autoreleasePoolPush();
            v125 = *(a1 + 32);
            v126 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v126, OS_LOG_TYPE_ERROR))
            {
              v127 = HMFGetLogIdentifier();
              *buf = 138543618;
              v155 = v127;
              v156 = 2112;
              v157 = v5;
              _os_log_impl(&dword_229538000, v126, OS_LOG_TYPE_ERROR, "%{public}@(a) Unknown bulletin registration type found. Ignoring it : %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v124);
            v8 = v123;
          }

          v41 = v141;
          a3 = v151;
          if (v36)
          {
            goto LABEL_143;
          }

          goto LABEL_142;
        }

        v91 = v5;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v92 = v91;
        }

        else
        {
          v92 = 0;
        }

        v65 = v92;

        v144 = v7;
        v66 = [v7 castIfCameraReachabilityBulletinRegistration];
        if (v66)
        {
          v150 = a3;
          v141 = v41;
          v67 = [HMDBulletinNotificationRegistrationUtilities cameraReachabilityRegistrationFromMKFRegistration:v66];
          v93 = [v67 registration];
          if ([v93 isEqual:v65])
          {
            v94 = [v67 source];
            v95 = [v94 isEqual:*(a1 + 40)];

            if (v95)
            {
              v71 = objc_autoreleasePoolPush();
              v72 = *(a1 + 32);
              v73 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v73, OS_LOG_TYPE_INFO))
              {
                v74 = HMFGetLogIdentifier();
                *buf = 138543618;
                v155 = v74;
                v156 = 2112;
                v157 = v65;
                v75 = "%{public}@Camera Reachability bulletin registration: %@ matches existing registration, skipping";
                goto LABEL_87;
              }

              goto LABEL_88;
            }
          }

          else
          {
          }

          v41 = v141;
          a3 = v150;
        }

        v128 = *(a1 + 48);
        if ([v128 conformsToProtocol:&unk_283EF6078])
        {
          v129 = v128;
        }

        else
        {
          v129 = 0;
        }

        v98 = v129;

        if (!v98)
        {
          v100 = objc_autoreleasePoolPush();
          v101 = *(a1 + 32);
          v102 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v102, OS_LOG_TYPE_ERROR))
          {
            v103 = HMFGetLogIdentifier();
            v131 = *(a1 + 48);
            *buf = 138543618;
            v155 = v103;
            v156 = 2112;
            v157 = v131;
            v105 = "%{public}@Camera reachability bulletin notification registrations are not supported for guests : %@";
            goto LABEL_134;
          }

          goto LABEL_135;
        }

        v99 = [*(a1 + 32) insertOrUpdateCameraReachabilityBulletinRegistration:v65 source:*(a1 + 40) managedBulletinRegistration:v66 accessory:v37 user:v98 context:*(a1 + 56)];
      }

LABEL_130:
      v130 = v99;

      v7 = v144;
      v8 = v153;
      if (v130)
      {
        goto LABEL_143;
      }

      goto LABEL_142;
    }

    v58 = objc_autoreleasePoolPush();
    v59 = *(a1 + 32);
    v60 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v60, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v62 = v61 = v7;
      *buf = 138543618;
      v155 = v62;
      v156 = 2112;
      v157 = v16;
      _os_log_impl(&dword_229538000, v60, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the accessory : %@", buf, 0x16u);

      v7 = v61;
    }

    objc_autoreleasePoolPop(v58);
    *v146 = 1;
    *(*(*(a1 + 64) + 8) + 24) = 0;

    v8 = v152;
  }

  else
  {
    *a3 = 1;
    *(*(*(a1 + 64) + 8) + 24) = 0;
    v32 = objc_autoreleasePoolPush();
    v33 = *(a1 + 32);
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      *buf = 138543618;
      v155 = v35;
      v156 = 2112;
      v157 = v5;
      _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Did not find the accessory on which this bulletin needs to be applied upon. %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v32);
  }

LABEL_144:

  v137 = *MEMORY[0x277D85DE8];
}

- (void)updateEnabledBulletinRegistrations:(id)a3 disabledBulletinRegistrations:(id)a4 source:(id)a5 context:(id)a6 completionHandler:(id)a7
{
  v45 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v17 = objc_autoreleasePoolPush();
  v18 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 138544130;
    v38 = v20;
    v39 = 2112;
    v40 = v14;
    v41 = 2112;
    v42 = v12;
    v43 = 2112;
    v44 = v13;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Updating bulletin registrations for source: %@ enabled: %@ disabled: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v17);
  v21 = [v14 userUUID];
  v29[0] = MEMORY[0x277D85DD0];
  v29[1] = 3221225472;
  v29[2] = __132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke;
  v29[3] = &unk_2786873D8;
  v30 = v21;
  v31 = v15;
  v35 = v12;
  v36 = v16;
  v32 = v18;
  v33 = v14;
  v34 = v13;
  v22 = v12;
  v23 = v13;
  v24 = v14;
  v25 = v16;
  v26 = v15;
  v27 = v21;
  [v26 unsafeSynchronousBlock:v29];

  v28 = *MEMORY[0x277D85DE8];
}

void __132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke(uint64_t a1)
{
  v51 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) managedObjectContext];
  v4 = [_MKFHome findHomeMemberWithUUID:v2 context:v3];

  if (!v4)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = *(a1 + 48);
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      v24 = *(a1 + 32);
      *buf = 138543618;
      v46 = v23;
      v47 = 2112;
      v48 = v24;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the home member with UUID: %@", buf, 0x16u);
LABEL_13:
    }

LABEL_14:

    objc_autoreleasePoolPop(v20);
    v27 = *(a1 + 80);
    v28 = MEMORY[0x277CCA9B8];
    v29 = 2;
    goto LABEL_15;
  }

  v5 = [v4 home];
  v6 = [v5 modelID];
  v7 = [*(a1 + 48) uuid];
  v8 = [v6 isEqual:v7];

  if ((v8 & 1) == 0)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = *(a1 + 48);
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      v25 = *(a1 + 32);
      v26 = [*(a1 + 48) uuid];
      *buf = 138543874;
      v46 = v23;
      v47 = 2112;
      v48 = v25;
      v49 = 2112;
      v50 = v26;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Home member with UUID: %@ is not part of current home: %@", buf, 0x20u);

      goto LABEL_13;
    }

    goto LABEL_14;
  }

  [*(a1 + 48) maybeRemoveStaleRegistrationsFromPreviousUserForSource:*(a1 + 56) homeMember:v4 context:*(a1 + 40)];
  [*(a1 + 48) disableBulletinRegistrations:*(a1 + 64) source:*(a1 + 56) homeMember:v4 context:*(a1 + 40)];
  if ([*(a1 + 48) enableBulletinRegistrations:*(a1 + 72) source:*(a1 + 56) homeMember:v4 context:*(a1 + 40)])
  {
    v9 = *(a1 + 40);
    v44 = 0;
    v10 = [v9 save:&v44];
    v11 = v44;
    v12 = v11;
    if (!v10 || v11)
    {
      v35 = objc_autoreleasePoolPush();
      v36 = *(a1 + 48);
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
      {
        v38 = HMFGetLogIdentifier();
        *buf = 138543618;
        v46 = v38;
        v47 = 2112;
        v48 = v12;
        _os_log_impl(&dword_229538000, v37, OS_LOG_TYPE_ERROR, "%{public}@Unable to save the bulletin registration changes requested, error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v35);
      v39 = *(a1 + 80);
      if (v39)
      {
        (*(v39 + 16))(v39, v12);
      }
    }

    else
    {
      v42[0] = MEMORY[0x277D85DD0];
      v42[1] = 3221225472;
      v42[2] = __132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke_108;
      v42[3] = &unk_278671D30;
      v13 = *(a1 + 64);
      v43 = *(a1 + 56);
      v14 = [v13 na_map:v42];
      v15 = *(a1 + 72);
      v40[0] = MEMORY[0x277D85DD0];
      v40[1] = 3221225472;
      v40[2] = __132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke_2;
      v40[3] = &unk_278671D30;
      v41 = *(a1 + 56);
      v16 = [v15 na_map:v40];
      v17 = [*(a1 + 48) accessoryBulletinNotificationManager];
      [v17 handleDisabledRegistrations:v14];

      v18 = [*(a1 + 48) accessoryBulletinNotificationManager];
      [v18 handleEnabledRegistrations:v16];

      v19 = *(a1 + 80);
      if (v19)
      {
        (*(v19 + 16))(v19, 0);
      }

      v12 = 0;
    }

    goto LABEL_17;
  }

  v31 = objc_autoreleasePoolPush();
  v32 = *(a1 + 48);
  v33 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
  {
    v34 = HMFGetLogIdentifier();
    *buf = 138543362;
    v46 = v34;
    _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Unable to insert or update bulletin registrations", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v31);
  [*(a1 + 40) reset];
  v27 = *(a1 + 80);
  v28 = MEMORY[0x277CCA9B8];
  v29 = 43;
LABEL_15:
  v12 = [v28 hmErrorWithCode:v29];
  if (v27)
  {
    (*(v27 + 16))(v27, v12);
  }

LABEL_17:

  v30 = *MEMORY[0x277D85DE8];
}

HMDAccessoryBulletinNotificationRegistrationRemote *__132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke_108(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  if (v5)
  {
    v6 = [[HMDAccessoryBulletinNotificationRegistrationRemote alloc] initWithAccessoryBulletinNotificationRegistration:v5 source:*(a1 + 32)];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

HMDAccessoryBulletinNotificationRegistrationRemote *__132__HMDHome_BulletinNotifications__updateEnabledBulletinRegistrations_disabledBulletinRegistrations_source_context_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  if (v5)
  {
    v6 = [[HMDAccessoryBulletinNotificationRegistrationRemote alloc] initWithAccessoryBulletinNotificationRegistration:v5 source:*(a1 + 32)];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)_performUpdateBulletinRegistrations:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 messagePayload];
    *buf = 138543618;
    v25 = v8;
    v26 = 2112;
    v27 = v9;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Received message to update bulletin notifications : [%@]", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = objc_autoreleasePoolPush();
  v11 = [v4 messagePayload];
  v12 = [(HMDHome *)v6 registrationSourceFromPayload:v11];
  if (v12)
  {
    v13 = [(HMDHome *)v6 registrationsFromPayload:v11 enabled:1];
    v14 = [(HMDHome *)v6 registrationsFromPayload:v11 enabled:0];
    v15 = [(HMDHome *)v6 backingStore];
    v16 = [v15 context];

    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __70__HMDHome_BulletinNotifications___performUpdateBulletinRegistrations___block_invoke;
    v22[3] = &unk_27868A250;
    v23 = v4;
    [(HMDHome *)v6 updateEnabledBulletinRegistrations:v13 disabledBulletinRegistrations:v14 source:v12 context:v16 completionHandler:v22];
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = v6;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543618;
      v25 = v20;
      v26 = 2112;
      v27 = v11;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Unable to decode registration source from payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
    v13 = [MEMORY[0x277CCA9B8] hmfUnspecifiedError];
    [v4 respondWithError:v13];
  }

  objc_autoreleasePoolPop(v10);
  v21 = *MEMORY[0x277D85DE8];
}

uint64_t __70__HMDHome_BulletinNotifications___performUpdateBulletinRegistrations___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithSuccess];
  }
}

- (void)handleUpdateBulletinRegistrations:(id)a3
{
  v4 = a3;
  v5 = [v4 dictionaryForKey:@"$HMDRS$"];
  if (v5)
  {
    v6 = [(HMDHome *)self residentSyncManager];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __68__HMDHome_BulletinNotifications__handleUpdateBulletinRegistrations___block_invoke;
    v7[3] = &unk_27868A398;
    v7[4] = self;
    [v6 interceptRemoteResidentRequest:v4 proceed:v7];
  }

  else
  {
    [(HMDHome *)self _performUpdateBulletinRegistrations:v4];
  }
}

- (void)registerForBulletinNotificationRegistrationHandlersUsingPolicies:(id)a3
{
  v5 = a3;
  if (isTVOSDevice())
  {
    v4 = [(HMDHome *)self msgDispatcher];
    [v4 registerForMessage:@"HMD.UP.BU.RoR" receiver:self policies:v5 selector:sel_handleUpdateBulletinRegistrations_];
  }
}

- (id)registrationSourceFromPayload:(id)a3
{
  v3 = [a3 objectForKeyedSubscript:@"HMD.S.BU"];
  if (v3)
  {
    v4 = [[HMDBulletinNotificationRegistrationSource alloc] initWithDictionary:v3];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)registrationsFromPayload:(id)a3 enabled:(BOOL)a4
{
  if (a4)
  {
    v6 = @"HMD.EN.BU";
  }

  else
  {
    v6 = @"HMD.DIS.BU";
  }

  v7 = [a3 objectForKeyedSubscript:v6];
  v8 = [MEMORY[0x277CBEB58] set];
  v12 = MEMORY[0x277D85DD0];
  v13 = 3221225472;
  v14 = __67__HMDHome_BulletinNotifications__registrationsFromPayload_enabled___block_invoke;
  v15 = &unk_278689E38;
  v16 = self;
  v17 = v8;
  v9 = v8;
  [v7 hmf_enumerateWithAutoreleasePoolUsingBlock:&v12];
  v10 = [v9 copy];

  return v10;
}

void __67__HMDHome_BulletinNotifications__registrationsFromPayload_enabled___block_invoke(uint64_t a1, void *a2)
{
  v30 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_opt_class();
  v5 = [objc_opt_class() type];
  LODWORD(v4) = [v4 doesTypeMatch:v3 against:v5];

  if (v4)
  {
    v6 = HMDAccessoryBulletinNotificationRegistration;
LABEL_11:
    v15 = [[v6 alloc] initWithDictionary:v3];
LABEL_12:
    v16 = v15;
    if (v15)
    {
      [*(a1 + 40) addObject:v15];
    }

    goto LABEL_14;
  }

  v7 = objc_opt_class();
  v8 = [objc_opt_class() type];
  LODWORD(v7) = [v7 doesTypeMatch:v3 against:v8];

  if (v7)
  {
    v6 = HMDCameraSignificantEventBulletinNotificationRegistration;
    goto LABEL_11;
  }

  v9 = objc_opt_class();
  v10 = [objc_opt_class() type];
  LODWORD(v9) = [v9 doesTypeMatch:v3 against:v10];

  if (v9)
  {
    v6 = HMDCameraAccessModeBulletinNotificationRegistration;
    goto LABEL_11;
  }

  v11 = objc_opt_class();
  v12 = [objc_opt_class() type];
  LODWORD(v11) = [v11 doesTypeMatch:v3 against:v12];

  if (v11)
  {
    v6 = HMDCameraReachabilityBulletinNotificationRegistration;
    goto LABEL_11;
  }

  v13 = objc_opt_class();
  v14 = [objc_opt_class() type];
  LODWORD(v13) = [v13 doesTypeMatch:v3 against:v14];

  if (v13)
  {
    v6 = HMDAudioAnalysisEventBulletinNotificationRegistration;
    goto LABEL_11;
  }

  v18 = objc_opt_class();
  v19 = [objc_opt_class() type];
  LODWORD(v18) = [v18 doesTypeMatch:v3 against:v19];

  if (v18)
  {
    v20 = +[HMDCoreData featuresDataSource];
    v21 = [v20 isRVCEnabled];

    if (!v21)
    {
      goto LABEL_14;
    }

    v15 = [[HMDMatterBulletinNotificationRegistration alloc] initWithDictionary:v3 withHome:*(a1 + 32)];
    goto LABEL_12;
  }

  v22 = objc_autoreleasePoolPush();
  v23 = *(a1 + 32);
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
  {
    v25 = HMFGetLogIdentifier();
    v26 = 138543618;
    v27 = v25;
    v28 = 2112;
    v29 = v3;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Unknown bulletin registration type found. Ignoring it : %@", &v26, 0x16u);
  }

  objc_autoreleasePoolPop(v22);
LABEL_14:

  v17 = *MEMORY[0x277D85DE8];
}

- (id)payloadFromRegistrations:(id)a3
{
  v4 = MEMORY[0x277CBEB18];
  v5 = a3;
  v6 = [v4 arrayWithCapacity:{objc_msgSend(v5, "count")}];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __59__HMDHome_BulletinNotifications__payloadFromRegistrations___block_invoke;
  v11[3] = &unk_278671D08;
  v11[4] = self;
  v7 = v6;
  v12 = v7;
  [v5 hmf_enumerateWithAutoreleasePoolUsingBlock:v11];

  v8 = v12;
  v9 = v7;

  return v7;
}

void __59__HMDHome_BulletinNotifications__payloadFromRegistrations___block_invoke(uint64_t a1, void *a2, _BYTE *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = [v5 serializedRegistrationForRemoteMessage];
  if (v6)
  {
    [*(a1 + 40) addObject:v6];
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v10;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_ERROR, "%{public}@Unable to serialize bulletin registration. %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    *a3 = 1;
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (id)payloadFromEnableRegistrations:(id)a3 disableRegistration:(id)a4 source:(id)a5
{
  v21[3] = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self payloadFromRegistrations:v8];
  v12 = [v11 count];
  if (v12 != [v8 count])
  {
    _HMFPreconditionFailure();
    goto LABEL_8;
  }

  v13 = [(HMDHome *)self payloadFromRegistrations:v9];
  v14 = [v13 count];
  if (v14 != [v9 count])
  {
LABEL_8:
    _HMFPreconditionFailure();
LABEL_9:
    _HMFPreconditionFailure();
  }

  v15 = [v10 serializedRegistrationForRemoteMessage];
  if (!v15)
  {
    goto LABEL_9;
  }

  v16 = v15;
  v20[0] = @"HMD.S.BU";
  v20[1] = @"HMD.EN.BU";
  v21[0] = v15;
  v21[1] = v11;
  v20[2] = @"HMD.DIS.BU";
  v21[2] = v13;
  v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v21 forKeys:v20 count:3];

  v18 = *MEMORY[0x277D85DE8];

  return v17;
}

- (void)updateBulletinRegistrationOnPrimaryResidentWithSource:(id)a3 enableRegistrations:(id)a4 disableRegistration:(id)a5 completionHandler:(id)a6
{
  v48 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v14 = [(HMDHome *)self residentDeviceManager];
  v15 = [v14 primaryResidentDevice];

  v16 = objc_autoreleasePoolPush();
  if (v15)
  {
    if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
    {
      v17 = [(HMDHome *)self backingStore];
      v18 = [v17 context];

      [(HMDHome *)self updateEnabledBulletinRegistrations:v11 disabledBulletinRegistrations:v12 source:v10 context:v18 completionHandler:v13];
    }

    else
    {
      v39 = v10;
      v23 = [(HMDHome *)self payloadFromEnableRegistrations:v11 disableRegistration:v12 source:v10];
      v24 = [HMDRemoteDeviceMessageDestination alloc];
      v25 = [(HMDHome *)self messageTargetUUID];
      v26 = [v15 device];
      v27 = [(HMDRemoteDeviceMessageDestination *)v24 initWithTarget:v25 device:v26];

      v37 = v27;
      v38 = v23;
      v28 = [[HMDRemoteMessage alloc] initWithName:@"HMD.UP.BU.RoR" destination:v27 payload:v23 type:0 timeout:1 secure:0.0];
      v40[0] = MEMORY[0x277D85DD0];
      v40[1] = 3221225472;
      v40[2] = __146__HMDHome_BulletinNotifications__updateBulletinRegistrationOnPrimaryResidentWithSource_enableRegistrations_disableRegistration_completionHandler___block_invoke;
      v40[3] = &unk_278685AF8;
      v40[4] = self;
      v41 = v13;
      [(HMDRemoteMessage *)v28 setResponseHandler:v40];
      v29 = objc_autoreleasePoolPush();
      v30 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v32 = v36 = v16;
        v33 = [(HMFObject *)v28 shortDescription];
        *buf = 138543874;
        v43 = v32;
        v44 = 2112;
        v45 = v33;
        v46 = 2112;
        v47 = v15;
        _os_log_impl(&dword_229538000, v31, OS_LOG_TYPE_INFO, "%{public}@Sending bulletin notification registration message %@ to primary resident: %@", buf, 0x20u);

        v16 = v36;
      }

      objc_autoreleasePoolPop(v29);
      v34 = [(HMDHome *)v30 residentSyncManager];
      [v34 performResidentRequest:v28 options:0];

      v10 = v39;
    }

    objc_autoreleasePoolPop(v16);
  }

  else
  {
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543362;
      v43 = v21;
      _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident to send bulletin registration request", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    if (v13)
    {
      (*(v13 + 2))(v13, v22);
    }
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __146__HMDHome_BulletinNotifications__updateBulletinRegistrationOnPrimaryResidentWithSource_enableRegistrations_disableRegistration_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v13 = 138543618;
    v14 = v10;
    v15 = 2112;
    v16 = v5;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Sending remote bulletin notification finished with error: %@", &v13, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 40);
  if (v11)
  {
    (*(v11 + 16))(v11, v5);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeCameraNotificationSettingsMigrationFileFromDisk
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = objc_alloc(MEMORY[0x277CBEBC0]);
  v4 = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v5 = [v3 initFileURLWithPath:v4];

  v6 = [MEMORY[0x277CCAA00] defaultManager];
  v13 = 0;
  [v6 removeItemAtURL:v5 error:&v13];
  v7 = v13;

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while removing camera notification settings migration file from disk : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeBulletinBoardNotificationsMigrationFileFromDisk
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = objc_alloc(MEMORY[0x277CBEBC0]);
  v4 = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v5 = [v3 initFileURLWithPath:v4];

  v6 = [MEMORY[0x277CCAA00] defaultManager];
  v13 = 0;
  [v6 removeItemAtURL:v5 error:&v13];
  v7 = v13;

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while removing bulletin board notification migration file from disk : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (id)loadMigrationCameraNotificationSettingsFromDisk
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v17 = 0;
  v4 = [MEMORY[0x277CBEA90] dataWithContentsOfFile:v3 options:2 error:&v17];
  v5 = v17;
  v6 = v5;
  if (v4)
  {
    v7 = v5 == 0;
  }

  else
  {
    v7 = 0;
  }

  if (v7)
  {
    v12 = [HMDHome decodedMigrationCameraNotificationSettings:v4];
    v8 = objc_autoreleasePoolPush();
    v13 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Camera notification settings for migration: [%@]", buf, 0x16u);
    }
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = v3;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to read data from file : %@ / %@", buf, 0x20u);
    }

    v12 = 0;
  }

  objc_autoreleasePoolPop(v8);
  v15 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)loadMigrationBulletinBoardNotificationsFromDisk
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v17 = 0;
  v4 = [MEMORY[0x277CBEA90] dataWithContentsOfFile:v3 options:2 error:&v17];
  v5 = v17;
  v6 = v5;
  if (v4)
  {
    v7 = v5 == 0;
  }

  else
  {
    v7 = 0;
  }

  if (v7)
  {
    v12 = [HMDHome decodedMigrationBulletinBoardNotifications:v4];
    v8 = objc_autoreleasePoolPush();
    v13 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Bulletin board notifications for migration: [%@]", buf, 0x16u);
    }
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = v3;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to read data from file : %@ / %@", buf, 0x20u);
    }

    v12 = 0;
  }

  objc_autoreleasePoolPop(v8);
  v15 = *MEMORY[0x277D85DE8];

  return v12;
}

- (void)storeMigrationCameraNotificationSettingsToDisk
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = [HMDHome migrationCameraNotificationSettingsForHome:self];
  v5 = [v4 count];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v9)
    {
      v10 = HMFGetLogIdentifier();
      v11 = [(HMDHome *)v7 name];
      v26 = 138543874;
      v27 = v10;
      v28 = 2112;
      v29 = v11;
      v30 = 2112;
      v31 = v4;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Archiving camera notification settings for migration for home: %@, [%@]", &v26, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [HMDHome encodedMigrationCameraNotificationSettings:v4];
    if (v12)
    {
      v13 = [(HMDHome *)v7 getCameraNotificationSettingsSerializedFileName];
      v14 = [HMDPersistentStore writeData:v12 toStorePath:v13 dataLabel:@"CameraNotificationSettings"];
      v15 = objc_autoreleasePoolPush();
      v16 = v7;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v18;
        v28 = 2112;
        v29 = v14;
        v30 = 2112;
        v31 = v13;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Stored camera notification settings ([%@] bytes) to [%@]", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
    }

    else
    {
      v21 = objc_autoreleasePoolPush();
      v22 = v7;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v24;
        _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to store camera notification settings during migration, archived data is nil", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
    }
  }

  else
  {
    if (v9)
    {
      v19 = HMFGetLogIdentifier();
      v20 = [(HMDHome *)v7 name];
      v26 = 138543618;
      v27 = v19;
      v28 = 2112;
      v29 = v20;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@No camera notification settings to migrate for home: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  objc_autoreleasePoolPop(v3);
  v25 = *MEMORY[0x277D85DE8];
}

- (void)storeMigrationBulletinBoardNotificationsToDisk
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = [HMDHome migrationBulletinBoardNotificationsForHome:self];
  v5 = [v4 count];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v9)
    {
      v10 = HMFGetLogIdentifier();
      v11 = [(HMDHome *)v7 name];
      v26 = 138543874;
      v27 = v10;
      v28 = 2112;
      v29 = v11;
      v30 = 2112;
      v31 = v4;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Archiving bulletin board notifications for migration for home: %@, [%@]", &v26, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [HMDHome encodedMigrationBulletinBoardNotifications:v4];
    if (v12)
    {
      v13 = [(HMDHome *)v7 getBulletinBoardNotificationSerializedFileName];
      v14 = [HMDPersistentStore writeData:v12 toStorePath:v13 dataLabel:@"BulletinBoardNotifications"];
      v15 = objc_autoreleasePoolPush();
      v16 = v7;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v18;
        v28 = 2112;
        v29 = v14;
        v30 = 2112;
        v31 = v13;
        _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@Stored bulletin board notifications ([%@] bytes) to [%@]", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
    }

    else
    {
      v21 = objc_autoreleasePoolPush();
      v22 = v7;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v24;
        _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to store bulletin board notifications during migration, archived data is nil", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
    }
  }

  else
  {
    if (v9)
    {
      v19 = HMFGetLogIdentifier();
      v20 = [(HMDHome *)v7 name];
      v26 = 138543618;
      v27 = v19;
      v28 = 2112;
      v29 = v20;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@No bulletin board notifications to migrate for home: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  objc_autoreleasePoolPop(v3);
  v25 = *MEMORY[0x277D85DE8];
}

- (id)getCameraNotificationSettingsSerializedFileName
{
  v3 = MEMORY[0x277CCACA8];
  v4 = hh1ToHH2PerDeviceMigrationDirectoryPath;
  v5 = [(HMDHome *)self uuid];
  v6 = [v3 stringWithFormat:@"%@/HMDHome-Camera-Notification-Settings-%@.plist", v4, v5];

  return v6;
}

- (id)getBulletinBoardNotificationSerializedFileName
{
  v3 = MEMORY[0x277CCACA8];
  v4 = hh1ToHH2PerDeviceMigrationDirectoryPath;
  v5 = [(HMDHome *)self uuid];
  v6 = [v3 stringWithFormat:@"%@/HMDHome-Bulletin-Board-Notifications-%@.plist", v4, v5];

  return v6;
}

- (BOOL)cameraNotificationSettingsMigrationFileExistsOnDisk
{
  v3 = [MEMORY[0x277CCAA00] defaultManager];
  v4 = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v5 = [v3 fileExistsAtPath:v4];

  return v5;
}

- (BOOL)bulletinBoardNotificationsMigrationFileExistsOnDisk
{
  v3 = [MEMORY[0x277CCAA00] defaultManager];
  v4 = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v5 = [v3 fileExistsAtPath:v4];

  return v5;
}

+ (id)decodedMigrationCameraNotificationSettings:(id)a3
{
  v31[10] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = MEMORY[0x277CBEB98];
  v31[0] = objc_opt_class();
  v31[1] = objc_opt_class();
  v31[2] = objc_opt_class();
  v31[3] = objc_opt_class();
  v31[4] = objc_opt_class();
  v31[5] = objc_opt_class();
  v31[6] = objc_opt_class();
  v31[7] = objc_opt_class();
  v31[8] = objc_opt_class();
  v31[9] = objc_opt_class();
  v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v31 count:10];
  v7 = [v5 setWithArray:v6];

  v26 = 0;
  v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClasses:v7 fromData:v4 error:&v26];
  v9 = v26;
  v10 = v9;
  if (!v8 || v9)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = a1;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v19;
      v29 = 2112;
      v30 = v10;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to unarchive camera notification settings: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v15 = 0;
  }

  else
  {
    v11 = v8;
    objc_opt_class();
    v12 = objc_opt_isKindOfClass() & 1;
    if (v12)
    {
      v13 = v11;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    if (v12)
    {
      v15 = v11;
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      v21 = a1;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v23;
        v29 = 2112;
        v30 = v11;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unarchived data is the wrong type : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      v15 = 0;
    }
  }

  v24 = *MEMORY[0x277D85DE8];

  return v15;
}

+ (id)decodedMigrationBulletinBoardNotifications:(id)a3
{
  v31[9] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = MEMORY[0x277CBEB98];
  v31[0] = objc_opt_class();
  v31[1] = objc_opt_class();
  v31[2] = objc_opt_class();
  v31[3] = objc_opt_class();
  v31[4] = objc_opt_class();
  v31[5] = objc_opt_class();
  v31[6] = objc_opt_class();
  v31[7] = objc_opt_class();
  v31[8] = objc_opt_class();
  v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v31 count:9];
  v7 = [v5 setWithArray:v6];

  v26 = 0;
  v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClasses:v7 fromData:v4 error:&v26];
  v9 = v26;
  v10 = v9;
  if (!v8 || v9)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = a1;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v19;
      v29 = 2112;
      v30 = v10;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to unarchive bulletin board notifications: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v15 = 0;
  }

  else
  {
    v11 = v8;
    objc_opt_class();
    v12 = objc_opt_isKindOfClass() & 1;
    if (v12)
    {
      v13 = v11;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    if (v12)
    {
      v15 = v11;
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      v21 = a1;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v23;
        v29 = 2112;
        v30 = v11;
        _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unarchived data is the wrong type : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      v15 = 0;
    }
  }

  v24 = *MEMORY[0x277D85DE8];

  return v15;
}

+ (id)encodedMigrationCameraNotificationSettings:(id)a3
{
  v3 = MEMORY[0x277CCAAB0];
  v4 = a3;
  v5 = [[v3 alloc] initRequiringSecureCoding:1];
  [v5 encodeObject:v4 forKey:*MEMORY[0x277CCA308]];

  [v5 finishEncoding];
  v6 = [v5 encodedData];

  return v6;
}

+ (id)encodedMigrationBulletinBoardNotifications:(id)a3
{
  v3 = MEMORY[0x277CCAAB0];
  v4 = a3;
  v5 = [[v3 alloc] initRequiringSecureCoding:1];
  [v5 encodeObject:v4 forKey:*MEMORY[0x277CCA308]];

  [v5 finishEncoding];
  v6 = [v5 encodedData];

  return v6;
}

+ (id)migrationCameraNotificationSettingsForHome:(id)a3
{
  v4 = MEMORY[0x277CBEB18];
  v5 = a3;
  v6 = [v4 array];
  v7 = [v5 cameraAccessories];

  v11 = MEMORY[0x277D85DD0];
  v12 = 3221225472;
  v13 = __77__HMDHome_BulletinNotifications__migrationCameraNotificationSettingsForHome___block_invoke;
  v14 = &unk_278671CE0;
  v15 = v6;
  v16 = a1;
  v8 = v6;
  [v7 na_each:&v11];

  v9 = [v8 copy];

  return v9;
}

void __77__HMDHome_BulletinNotifications__migrationCameraNotificationSettingsForHome___block_invoke(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 cameraProfileNotificationSettings];
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 40);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v3 uuid];
      *buf = 138543874;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v4;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Adding camera notification settings entry for migration: accessoryUUID: %@ cameraProfileNotificationSettings: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = *(a1 + 32);
    v12 = [v3 uuid];
    v16[1] = @"HMD.CNS";
    v17[0] = v12;
    v17[1] = v4;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:v16 count:2];
    [v11 addObject:v13];
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Camera accessory: %@ missing camera profile notification settings during migration", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v15 = *MEMORY[0x277D85DE8];
}

+ (id)migrationBulletinBoardNotificationsForHome:(id)a3
{
  v4 = MEMORY[0x277CBEB18];
  v5 = a3;
  v6 = [v4 array];
  v7 = [v5 hapAccessories];

  v11 = MEMORY[0x277D85DD0];
  v12 = 3221225472;
  v13 = __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke;
  v14 = &unk_278671CE0;
  v15 = v6;
  v16 = a1;
  v8 = v6;
  [v7 na_each:&v11];

  v9 = [v8 copy];

  return v9;
}

void __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 services];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke_2;
  v8[3] = &unk_278671CB8;
  v9 = v3;
  v7 = *(a1 + 32);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  [v4 na_each:v8];
}

void __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke_2(uint64_t a1, void *a2)
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 bulletinBoardNotification];
  if (v4)
  {
    v5 = [MEMORY[0x277CBEB68] null];
    v6 = [v4 condition];

    if (v6)
    {
      v7 = [objc_alloc(MEMORY[0x277CCAAB0]) initRequiringSecureCoding:1];
      v8 = [v4 condition];
      [v7 encodeObject:v8 forKey:*MEMORY[0x277CCA308]];

      [v7 finishEncoding];
      v9 = [v7 encodedData];

      v5 = v9;
    }

    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 48);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) uuid];
      v15 = [v3 instanceID];
      [v4 isEnabled];
      HMFBooleanToString();
      v16 = v23 = v10;
      *buf = 138544386;
      v27 = v13;
      v28 = 2112;
      v29 = v14;
      v30 = 2112;
      v31 = v15;
      v32 = 2112;
      v33 = v5;
      v34 = 2112;
      v35 = v16;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Adding bulletin board notification entry for migration: accessoryUUID: %@ serviceInstanceID: %@ predicate: %@ enabled: %@", buf, 0x34u);

      v10 = v23;
    }

    objc_autoreleasePoolPop(v10);
    v24[0] = @"HMD.BBN.A";
    v17 = *(a1 + 40);
    v18 = [*(a1 + 32) uuid];
    v25[0] = v18;
    v24[1] = @"HMD.BBN.S";
    v19 = [v3 instanceID];
    v25[1] = v19;
    v25[2] = v5;
    v24[2] = @"HMD.BBN.P";
    v24[3] = @"HMD.BBN.E";
    v20 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v4, "isEnabled")}];
    v25[3] = v20;
    v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v25 forKeys:v24 count:4];
    [v17 addObject:v21];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (id)actionWithDictionaryRepresentation:(id)a3
{
  v25 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = v4;
  if (!v4)
  {
    v11 = 0;
    goto LABEL_14;
  }

  v6 = [v4 hmf_numberForKey:*MEMORY[0x277CD2058]];
  v7 = v6;
  if (!v6)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v15;
      v16 = "%{public}@Unable to determine the action type";
      v17 = v14;
      v18 = 12;
      goto LABEL_11;
    }

LABEL_12:

    objc_autoreleasePoolPop(v12);
    v11 = 0;
    goto LABEL_13;
  }

  v8 = [v6 integerValue];
  if (v8 > 5 || (v9 = *off_278672330[v8], objc_opt_class(), (v10 = objc_claimAutoreleasedReturnValue()) == 0))
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v15;
      v23 = 2112;
      v24 = v7;
      v16 = "%{public}@Unknown action type: %@";
      v17 = v14;
      v18 = 22;
LABEL_11:
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, v16, &v21, v18);

      goto LABEL_12;
    }

    goto LABEL_12;
  }

  v11 = [v10 actionWithDictionaryRepresentation:v5 home:self];
LABEL_13:

LABEL_14:
  v19 = *MEMORY[0x277D85DE8];

  return v11;
}

- (void)_auditChangedCharacteristics:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v4 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v3, "count")}];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v5 = v3;
  v6 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v35;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v34 + 1) + 8 * i);
        v11 = [v10 notificationRegistrations];
        v12 = [v11 count];

        if (!v12)
        {
          v13 = [v10 accessory];
          v14 = [v13 uuid];
          [v4 addObject:v14];

          if (([v13 isPrimary] & 1) == 0)
          {
            v15 = [v13 bridge];
            v16 = [v15 identifiersForBridgedAccessories];
            [v4 unionSet:v16];
          }
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
    }

    while (v7);
  }

  if ([v4 count] == 1)
  {
    v17 = [v5 firstObject];
    v18 = [v17 accessory];
    [(HMDHome *)self _auditAndDeregisterCharacteristicsForHAPAccessory:v18];
  }

  else
  {
    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    v17 = [(HMDHome *)self accessories];
    v19 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v31;
      do
      {
        for (j = 0; j != v20; ++j)
        {
          if (*v31 != v21)
          {
            objc_enumerationMutation(v17);
          }

          v23 = *(*(&v30 + 1) + 8 * j);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          if (v25)
          {
            v26 = [v25 uuid];
            v27 = [v4 containsObject:v26];

            if (v27)
            {
              [(HMDHome *)self _auditAndDeregisterCharacteristicsForHAPAccessory:v25];
            }
          }
        }

        v20 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
      }

      while (v20);
    }
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_auditAndDeregisterCharacteristicsForHAPAccessory:(id)a3
{
  v24 = self;
  v46 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v4 = [MEMORY[0x277CBEB18] array];
  v5 = [MEMORY[0x277CCAB68] string];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v25 = v3;
  obj = [v3 services];
  v28 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
  if (v28)
  {
    v27 = *v35;
    do
    {
      v6 = 0;
      do
      {
        if (*v35 != v27)
        {
          objc_enumerationMutation(obj);
        }

        v29 = v6;
        v7 = *(*(&v34 + 1) + 8 * v6);
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v33 = 0u;
        v8 = [v7 characteristics];
        v9 = [v8 countByEnumeratingWithState:&v30 objects:v44 count:16];
        if (v9)
        {
          v10 = v9;
          v11 = *v31;
          do
          {
            for (i = 0; i != v10; ++i)
            {
              if (*v31 != v11)
              {
                objc_enumerationMutation(v8);
              }

              v13 = *(*(&v30 + 1) + 8 * i);
              v14 = [v13 notificationRegistrations];
              v15 = [v14 count];

              if (!v15)
              {
                [v4 addObject:v13];
                v16 = [v13 shortDescription];
                [v5 appendString:v16];

                [v5 appendString:@"\n"];
              }
            }

            v10 = [v8 countByEnumeratingWithState:&v30 objects:v44 count:16];
          }

          while (v10);
        }

        v6 = v29 + 1;
      }

      while (v29 + 1 != v28);
      v28 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
    }

    while (v28);
  }

  v17 = objc_autoreleasePoolPush();
  v18 = v24;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    v21 = [v25 uuid];

    if (v21)
    {
      v22 = [v25 uuid];
      [v22 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v38 = *buf;
    *buf = 138544130;
    *&buf[4] = v20;
    *&buf[12] = 1040;
    *&buf[14] = 16;
    v40 = 2096;
    v41 = &v38;
    v42 = 2112;
    v43 = v5;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Audit de-registering notifications accessory %{uuid_t}.16P characteristics %@", buf, 0x26u);
  }

  objc_autoreleasePoolPop(v17);
  [v25 enableNotification:0 forCharacteristics:v4 message:0 clientIdentifier:0];

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_registerForMatterRequests
{
  v9[2] = *MEMORY[0x277D85DE8];
  v3 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:0 remoteAccessRequired:0];
  v4 = [(HMDHome *)self msgDispatcher];
  v5 = *MEMORY[0x277D26748];
  v6 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v9[0] = v6;
  v9[1] = v3;
  v7 = [MEMORY[0x277CBEA60] arrayWithObjects:v9 count:2];
  [v4 registerForMessage:v5 receiver:self policies:v7 selector:sel__handleIncomingMTRPluginMatterRequest_];

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_handleIncomingMTRPluginMatterRequest:(id)a3
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4)
  {
    v5 = [MEMORY[0x277D26768] sharedInstance];
    [v5 handleIncomingMessage:v4];

    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      v10 = HMFBooleanToString();
      v14 = 138543618;
      v15 = v9;
      v16 = 2112;
      v17 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_DEBUG, "%{public}@[[MTRPluginServer sharedInstance] handleIncomingMessage:]: %@", &v14, 0x16u);
    }
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v11 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v14 = 138543362;
      v15 = v12;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_ERROR, "%{public}@Empty message for _handleIncomingMTRPluginMatterRequest", &v14, 0xCu);
    }
  }

  objc_autoreleasePoolPop(v6);
  v13 = *MEMORY[0x277D85DE8];
}

- (BOOL)shouldSendMatterCommandsToResident
{
  v29 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self primaryResident];
  v4 = v3;
  if (!v3)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v25 = 138543362;
      v26 = v9;
      v10 = "%{public}@shouldSendMatterCommandsToResident: No. Reason: No primary resident";
LABEL_9:
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, v10, &v25, 0xCu);
    }

LABEL_10:

    objc_autoreleasePoolPop(v6);
    v11 = 0;
    goto LABEL_21;
  }

  if (([v3 isReachable] & 1) == 0)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v25 = 138543362;
      v26 = v9;
      v10 = "%{public}@shouldSendMatterCommandsToResident: No. Reason: Primary resident is not reachable";
      goto LABEL_9;
    }

    goto LABEL_10;
  }

  if ([(HMDHome *)self _isResidentNativeMatterCapable:v4])
  {
    v5 = @" {primarySupportsNativeMtr:Yes}";
  }

  else
  {
    v12 = [(HMDHome *)self featuresDataSource];
    v13 = [v12 isRVCEnabled];

    if (v13)
    {
      if ([(HMDHome *)self _homeHasNativeMatterAccessories])
      {
        v14 = objc_autoreleasePoolPush();
        v15 = self;
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          v17 = HMFGetLogIdentifier();
          v25 = 138543362;
          v26 = v17;
          _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Primary is not native matter capable and home has have native matter accessories", &v25, 0xCu);
        }

        objc_autoreleasePoolPop(v14);
        v5 = @" {primarySupportsNativeMtr:No, currentDeviceSupportsNativeMatter:Yes, homeHasNativeMatterAccessories:Yes, IgnoreFailure:Yes}";
      }

      else
      {
        v5 = @" {primarySupportsNativeMtr:No, currentDeviceSupportsNativeMatter:Yes, homeHasNativeMatterAccessories:No}";
      }
    }

    else
    {
      v5 = @" {primarySupportsNativeMtr:No, currentDeviceSupportsNativeMatter:No}";
    }
  }

  v18 = [&stru_283CF9D50 stringByAppendingString:v5];
  v19 = objc_autoreleasePoolPush();
  v20 = self;
  v21 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
  {
    v22 = HMFGetLogIdentifier();
    v25 = 138543618;
    v26 = v22;
    v27 = 2112;
    v28 = v18;
    _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@shouldSendMatterCommandsToResident: Yes. Reason: Local link not required%@", &v25, 0x16u);
  }

  objc_autoreleasePoolPop(v19);
  v11 = 1;
LABEL_21:

  v23 = *MEMORY[0x277D85DE8];
  return v11;
}

- (BOOL)_isResidentNativeMatterCapable:(id)a3
{
  v3 = [a3 capabilities];
  v4 = [v3 supportsNativeMatterPlugin];

  return v4;
}

- (BOOL)_isResidentThreadCapable:(id)a3
{
  v3 = [a3 capabilities];
  v4 = [v3 supportsThreadBorderRouter];

  return v4;
}

- (BOOL)_homeHasMatterThreadAccessories
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v3 = [(HMDHome *)self matterAccessories];
  v4 = [v3 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v12;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(v3);
        }

        if ([(HMDHome *)self _matterAccessoryRequiresThread:*(*(&v11 + 1) + 8 * i)])
        {
          v8 = 1;
          goto LABEL_11;
        }
      }

      v5 = [v3 countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v5)
      {
        continue;
      }

      break;
    }
  }

  v8 = 0;
LABEL_11:

  v9 = *MEMORY[0x277D85DE8];
  return v8;
}

- (BOOL)_matterAccessoryRequiresThread:(id)a3
{
  v3 = a3;
  v4 = [v3 supportedLinkLayerTypes];

  if (v4)
  {
    v5 = [v3 supportedLinkLayerTypes];
    v6 = [v5 unsignedIntValue];

    v7 = [v3 supportedLinkLayerTypes];
    v8 = [v7 unsignedIntValue];

    if (v8)
    {
      v9 = (v6 >> 4) & 1;
    }

    else
    {
      LOBYTE(v9) = 1;
    }
  }

  else
  {
    LOBYTE(v9) = 1;
  }

  return v9;
}

- (BOOL)_homeHasNativeMatterAccessories
{
  v25 = *MEMORY[0x277D85DE8];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v3 = [(HMDHome *)self matterAccessories];
  v4 = [v3 countByEnumeratingWithState:&v16 objects:v24 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v17;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v17 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v8 = *(*(&v16 + 1) + 8 * i);
        if ([(HMDHome *)self _accessoryRequiresNativeMatter:v8])
        {
          v10 = objc_autoreleasePoolPush();
          v11 = self;
          v12 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
          {
            v13 = HMFGetLogIdentifier();
            *buf = 138543618;
            v21 = v13;
            v22 = 2112;
            v23 = v8;
            _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@Home has native matter accessory: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v10);
          v9 = 1;
          goto LABEL_13;
        }
      }

      v5 = [v3 countByEnumeratingWithState:&v16 objects:v24 count:16];
      if (v5)
      {
        continue;
      }

      break;
    }
  }

  v9 = 0;
LABEL_13:

  v14 = *MEMORY[0x277D85DE8];
  return v9;
}

- (BOOL)_accessoryRequiresNativeMatter:(id)a3
{
  v3 = [a3 matterAdapter];
  v4 = [v3 useMatterPlugin];

  return v4;
}

- (BOOL)sendMatterMessagePayloadToPrimaryResident:(id)a3 timeout:(double)a4 responseHandler:(id)a5
{
  v36 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  v10 = [(HMDHome *)self shouldSendMatterCommandsToResident];
  if (v10)
  {
    v11 = [HMDRemoteHomeMessageDestination alloc];
    v12 = [(HMDHome *)self uuid];
    v13 = [(HMDHome *)self uuid];
    v14 = [(HMDRemoteHomeMessageDestination *)v11 initWithTarget:v12 homeUUID:v13];

    v15 = objc_alloc(MEMORY[0x277D0F848]);
    v16 = [v15 initWithName:*MEMORY[0x277D26748] destination:v14 payload:v8];
    [v16 setRemote:1];
    [v16 setSecureRemote:1];
    if (a4 != 0.0)
    {
      [v16 setTimeout:a4];
    }

    [v16 setResponseHandler:v9];
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
    {
      v20 = HMFGetLogIdentifier();
      v28 = 138544130;
      v29 = v20;
      v30 = 2112;
      v31 = v16;
      v32 = 2112;
      v33 = v14;
      v34 = 2048;
      v35 = a4;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Sending MatterRequest message: %@  to resident: %@  timeout: %f", &v28, 0x2Au);
    }

    objc_autoreleasePoolPop(v17);
    v21 = [(HMDHome *)v18 msgDispatcher];
    [v21 sendMessage:v16];
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      v28 = 138543362;
      v29 = v25;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Couldn't find compatible resident to send Matter request", &v28, 0xCu);
    }

    objc_autoreleasePoolPop(v22);
  }

  v26 = *MEMORY[0x277D85DE8];
  return v10;
}

- (BOOL)sendMatterHMFMessageRequest:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 destination];
    v13 = 138543874;
    v14 = v8;
    v15 = 2112;
    v16 = v4;
    v17 = 2112;
    v18 = v9;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Sending MatterRequest message: %@ to destination: %@", &v13, 0x20u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [(HMDHome *)v6 msgDispatcher];
  [v10 sendMessage:v4];

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

+ (id)matterDeviceControllerWithUUID:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [objc_alloc(MEMORY[0x277CD5558]) initWithXPConnectionBlock:&__block_literal_global_61284 uniqueIdentifier:v4];
  v16 = 0;
  v6 = [objc_alloc(MEMORY[0x277CD5318]) initWithParameters:v5 error:&v16];
  v7 = v16;
  v8 = v7;
  if (v6)
  {
    v9 = v7 == 0;
  }

  else
  {
    v9 = 0;
  }

  if (!v9)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = a1;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543874;
      v18 = v13;
      v19 = 2112;
      v20 = v4;
      v21 = 2112;
      v22 = v8;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to create a matter controller with UUID: %@. Error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
  }

  v14 = *MEMORY[0x277D85DE8];

  return v6;
}

id __60__HMDHome_MatterExtensions__matterDeviceControllerWithUUID___block_invoke()
{
  v0 = objc_alloc(MEMORY[0x277CCAE80]);
  v1 = [v0 initWithMachServiceName:*MEMORY[0x277CD15D8] options:0];

  return v1;
}

- (id)userForActivityStatus:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 user];
  if ([v5 conformsToProtocol:&unk_283EF3CF0])
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v8 = v5;

LABEL_10:
    v11 = [v8 modelID];
    v12 = [(HMDHome *)self userWithUUID:v11];

    goto LABEL_11;
  }

  v8 = [v4 guest];
  if ([v8 conformsToProtocol:&unk_283EF3CF0])
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  if (v10)
  {
    goto LABEL_10;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
  {
    v18 = HMFGetLogIdentifier();
    v19 = 138543618;
    v20 = v18;
    v21 = 2112;
    v22 = v4;
    _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@Back reference to MKFUser or MKFGuest is unexpectedly nil for %@", &v19, 0x16u);
  }

  objc_autoreleasePoolPop(v15);
  v12 = 0;
LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)isAccessoryCertifiedForNaturalLighting:(id)a3
{
  v77 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (CFPreferencesGetAppBooleanValue(@"MatterAdaptiveLighting", @"/Library/Managed Preferences/mobile/com.apple.homed.plist", 0))
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [v4 uuid];
      *buf = 138543618;
      v58 = v8;
      v59 = 2112;
      v60 = v9;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Natural lighting is allowed because of profile present for accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = [MEMORY[0x277D0F7C0] futureWithValue:MEMORY[0x277CBEC38]];
  }

  else
  {
    v56 = 0;
    v10 = [MEMORY[0x277D0F7C0] futureWithPromise:&v56];
    v11 = [v4 bridge];

    if (v11)
    {
      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
      {
        v49 = HMFGetLogIdentifier();
        v48 = [v4 uuid];
        v47 = [v4 matterVendorID];
        v46 = [v4 matterProductID];
        v41 = [v4 firmwareVersion];
        [v41 rawVersionString];
        v44 = v40 = v13;
        v39 = [v4 bridge];
        [v39 uuid];
        v43 = log = v14;
        v38 = [v4 bridge];
        v15 = [v38 matterVendorID];
        v37 = [v4 bridge];
        v16 = [v37 matterProductID];
        v36 = [v4 bridge];
        v17 = [v36 firmwareVersion];
        [v4 bridge];
        v18 = v42 = v12;
        v19 = [v18 firmwareVersion];
        v20 = [v19 rawVersionString];
        *buf = 138545666;
        v58 = v49;
        v59 = 2112;
        v60 = v48;
        v61 = 2112;
        v62 = v47;
        v63 = 2112;
        v64 = v46;
        v65 = 2112;
        v66 = v44;
        v67 = 2112;
        v68 = v43;
        v69 = 2112;
        v70 = v15;
        v71 = 2112;
        v72 = v16;
        v73 = 2112;
        v74 = v17;
        v75 = 2112;
        v76 = v20;
        _os_log_impl(&dword_229538000, log, OS_LOG_TYPE_DEBUG, "%{public}@Bridged accessory UUID: %@ identifiers: [%@ : %@ : %@] Bridge UUID: %@ identifiers: [%@ : %@ : %@: %@]", buf, 0x66u);

        v12 = v42;
        v14 = log;

        v13 = v40;
      }

      objc_autoreleasePoolPop(v12);
      v21 = [v4 bridge];

      v4 = v21;
    }

    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      v26 = [v4 matterVendorID];
      v27 = [v4 matterProductID];
      v28 = [v4 firmwareVersion];
      [v28 rawVersionString];
      v50 = v22;
      v30 = v29 = v10;
      v31 = HMFBooleanToString();
      *buf = 138544386;
      v58 = v25;
      v59 = 2112;
      v60 = v26;
      v61 = 2112;
      v62 = v27;
      v63 = 2112;
      v64 = v30;
      v65 = 2112;
      v66 = v31;
      _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@Checking if natural lighting is allowed based on allow list for accessory: [%@ : %@ : %@] isBridged: %@", buf, 0x34u);

      v10 = v29;
      v22 = v50;
    }

    objc_autoreleasePoolPop(v22);
    v32 = [HMDMatterCapabilitiesFactory makeInstanceForAssetFilename:1];
    v53[0] = MEMORY[0x277D85DD0];
    v53[1] = 3221225472;
    v53[2] = __57__HMDHome_Light__isAccessoryCertifiedForNaturalLighting___block_invoke;
    v53[3] = &unk_2786755C8;
    v4 = v4;
    v54 = v4;
    v55 = v56;
    v51[0] = MEMORY[0x277D85DD0];
    v51[1] = 3221225472;
    v51[2] = __57__HMDHome_Light__isAccessoryCertifiedForNaturalLighting___block_invoke_2;
    v51[3] = &unk_2786882F0;
    v51[4] = v23;
    v52 = v55;
    v33 = [v32 then:v53 orRecover:v51];
  }

  v34 = *MEMORY[0x277D85DE8];

  return v10;
}

uint64_t __57__HMDHome_Light__isAccessoryCertifiedForNaturalLighting___block_invoke(uint64_t a1, void *a2)
{
  v3 = *(a1 + 32);
  v4 = a2;
  v5 = [v3 matterVendorID];
  v6 = [v5 intValue];
  v7 = [*(a1 + 32) matterProductID];
  v8 = [v7 intValue];
  v9 = [*(a1 + 32) firmwareVersion];
  v10 = [v9 rawVersionString];
  v11 = [v4 isCapabilityAllowed:1 vendorID:v6 productID:v8 firmwareVersion:{objc_msgSend(v10, "intValue")}];

  v12 = *(a1 + 40);
  v13 = [MEMORY[0x277CCABB0] numberWithBool:v11];
  [v12 fulfillWithValue:v13];

  return 1;
}

uint64_t __57__HMDHome_Light__isAccessoryCertifiedForNaturalLighting___block_invoke_2(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v7;
    v12 = 2112;
    v13 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Natural lighting is not allowed because allow list check failed with error: %@", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 40) fulfillWithValue:MEMORY[0x277CBEC28]];

  v8 = *MEMORY[0x277D85DE8];
  return 1;
}

- (id)executeMatterNaturalLightingActions:(id)a3
{
  v61 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v37 = [MEMORY[0x277CBEB38] dictionary];
  v36 = [MEMORY[0x277CBEB58] set];
  v35 = [MEMORY[0x277CBEB58] set];
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  v55 = 0u;
  obj = v3;
  v4 = [obj countByEnumeratingWithState:&v52 objects:v60 count:16];
  if (v4)
  {
    v6 = v4;
    v7 = *v53;
    *&v5 = 138543618;
    v34 = v5;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v53 != v7)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v52 + 1) + 8 * i);
        v10 = [v9 lightProfile];
        v11 = [v9 uuid];
        v12 = [v11 UUIDString];

        if ([v10 isNaturalLightingSupported])
        {
          if ([v9 isNaturalLightingEnabled])
          {
            v13 = v36;
          }

          else
          {
            v13 = v35;
          }

          [v13 addObject:v10];
        }

        else
        {
          v14 = objc_autoreleasePoolPush();
          v15 = [(HMDHome *)self lightLogCategory];
          v16 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            v17 = HMFGetLogIdentifier();
            *buf = v34;
            v57 = v17;
            v58 = 2112;
            v59 = v9;
            _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Skipping executing natural lighting action for matter, light profile doesn't support matter NL: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v14);
          v18 = MEMORY[0x277CBEAC0];
          v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          v20 = [v18 hmd_dictionaryWithActionExecutionError:v19];
          [v37 setObject:v20 forKeyedSubscript:v12];
        }
      }

      v6 = [obj countByEnumeratingWithState:&v52 objects:v60 count:16];
    }

    while (v6);
  }

  if ([v36 hmf_isEmpty] && objc_msgSend(v35, "hmf_isEmpty"))
  {
    v21 = [MEMORY[0x277D0F7C0] futureWithValue:MEMORY[0x277CBEC10]];
    v22 = v37;
  }

  else
  {
    v23 = objc_alloc(MEMORY[0x277D0F7A8]);
    v24 = [(HMDHome *)self workQueue];
    v25 = [v23 initWithQueue:v24];

    v26 = [MEMORY[0x277CBEB18] array];
    v22 = v37;
    if (([v36 hmf_isEmpty] & 1) == 0)
    {
      v27 = [(HMDHome *)self handleSetNaturalLightingEnabled:1 forMatterLightProfiles:v36];
      [v26 addObject:v27];
      v48[0] = MEMORY[0x277D85DD0];
      v48[1] = 3221225472;
      v48[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke;
      v48[3] = &unk_2786755A0;
      v48[4] = self;
      v49 = v36;
      v50 = obj;
      v51 = v37;
      v47[0] = MEMORY[0x277D85DD0];
      v47[1] = 3221225472;
      v47[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_45;
      v47[3] = &unk_278689CD8;
      v47[4] = self;
      v28 = [v27 inContext:v25 then:v48 orRecover:v47];
    }

    if (([v35 hmf_isEmpty] & 1) == 0)
    {
      v29 = [(HMDHome *)self handleSetNaturalLightingEnabled:0 forMatterLightProfiles:v35];
      [v26 addObject:v29];
      v43[0] = MEMORY[0x277D85DD0];
      v43[1] = 3221225472;
      v43[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_47;
      v43[3] = &unk_2786755A0;
      v43[4] = self;
      v44 = v35;
      v45 = obj;
      v46 = v37;
      v42[0] = MEMORY[0x277D85DD0];
      v42[1] = 3221225472;
      v42[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_49;
      v42[3] = &unk_278689CD8;
      v42[4] = self;
      v30 = [v29 inContext:v25 then:v43 orRecover:v42];
    }

    v31 = [MEMORY[0x277D0F7C0] allSettled:v26];
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_50;
    v40[3] = &unk_2786868A0;
    v41 = v37;
    v21 = [v31 inContext:v25 then:v40];
  }

  v32 = *MEMORY[0x277D85DE8];

  return v21;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke(uint64_t a1, void *a2)
{
  v45 = *MEMORY[0x277D85DE8];
  v34 = a2;
  v3 = objc_autoreleasePoolPush();
  v4 = [*(a1 + 32) lightLogCategory];
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543618;
    v42 = v6;
    v43 = 2112;
    v44 = v34;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEBUG, "%{public}@_executeNaturalLightingActionsForMatter returned result: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  v38 = 0u;
  v39 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = *(a1 + 40);
  v7 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
  if (v7)
  {
    v9 = v7;
    v33 = *v37;
    *&v8 = 138543618;
    v31 = v8;
    do
    {
      v10 = 0;
      do
      {
        if (*v37 != v33)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v36 + 1) + 8 * v10);
        v12 = *(a1 + 48);
        v35[0] = MEMORY[0x277D85DD0];
        v35[1] = 3221225472;
        v35[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_42;
        v35[3] = &unk_278675578;
        v35[4] = v11;
        v13 = [v12 na_firstObjectPassingTest:{v35, v31}];
        v14 = [v34 objectForKey:v11];
        v15 = [v14 BOOLValue];
        v16 = objc_autoreleasePoolPush();
        v17 = [*(a1 + 32) lightLogCategory];
        v18 = HMFGetOSLogHandle();
        v19 = v18;
        if (v15)
        {
          if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
          {
            v20 = HMFGetLogIdentifier();
            *buf = v31;
            v42 = v20;
            v43 = 2112;
            v44 = v11;
            _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Successfully set natural lighting for matter light profile %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v16);
          v21 = [MEMORY[0x277CBEAC0] hmd_dictionaryWithActionExecutionError:0];
          v22 = *(a1 + 56);
          v23 = [v13 uuid];
          v24 = [v23 UUIDString];
          [v22 setObject:v21 forKeyedSubscript:v24];
        }

        else
        {
          if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
          {
            v25 = HMFGetLogIdentifier();
            *buf = v31;
            v42 = v25;
            v43 = 2112;
            v44 = v11;
            _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Failed to set natural lighting for matter light profile %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v16);
          v26 = MEMORY[0x277CBEAC0];
          v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          v23 = [v26 hmd_dictionaryWithActionExecutionError:v21];
          v27 = *(a1 + 56);
          v24 = [v13 uuid];
          v28 = [v24 UUIDString];
          [v27 setObject:v23 forKeyedSubscript:v28];
        }

        ++v10;
      }

      while (v9 != v10);
      v9 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
    }

    while (v9);
  }

  v29 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_45(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v7;
    v12 = 2112;
    v13 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to set natural lighting for all matter light profiles with error: %@", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_47(uint64_t a1, void *a2)
{
  v45 = *MEMORY[0x277D85DE8];
  v34 = a2;
  v3 = objc_autoreleasePoolPush();
  v4 = [*(a1 + 32) lightLogCategory];
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543618;
    v42 = v6;
    v43 = 2112;
    v44 = v34;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEBUG, "%{public}@_executeNaturalLightingActionsForMatter returned result: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  v38 = 0u;
  v39 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = *(a1 + 40);
  v7 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
  if (v7)
  {
    v9 = v7;
    v33 = *v37;
    *&v8 = 138543618;
    v31 = v8;
    do
    {
      v10 = 0;
      do
      {
        if (*v37 != v33)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v36 + 1) + 8 * v10);
        v12 = *(a1 + 48);
        v35[0] = MEMORY[0x277D85DD0];
        v35[1] = 3221225472;
        v35[2] = __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_48;
        v35[3] = &unk_278675578;
        v35[4] = v11;
        v13 = [v12 na_firstObjectPassingTest:{v35, v31}];
        v14 = [v34 objectForKey:v11];
        v15 = [v14 BOOLValue];
        v16 = objc_autoreleasePoolPush();
        v17 = [*(a1 + 32) lightLogCategory];
        v18 = HMFGetOSLogHandle();
        v19 = v18;
        if (v15)
        {
          if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
          {
            v20 = HMFGetLogIdentifier();
            *buf = v31;
            v42 = v20;
            v43 = 2112;
            v44 = v11;
            _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Successfully set natural lighting for matter light profile %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v16);
          v21 = [MEMORY[0x277CBEAC0] hmd_dictionaryWithActionExecutionError:0];
          v22 = *(a1 + 56);
          v23 = [v13 uuid];
          v24 = [v23 UUIDString];
          [v22 setObject:v21 forKeyedSubscript:v24];
        }

        else
        {
          if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
          {
            v25 = HMFGetLogIdentifier();
            *buf = v31;
            v42 = v25;
            v43 = 2112;
            v44 = v11;
            _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Failed to set natural lighting for matter light profile %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v16);
          v26 = MEMORY[0x277CBEAC0];
          v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          v23 = [v26 hmd_dictionaryWithActionExecutionError:v21];
          v27 = *(a1 + 56);
          v24 = [v13 uuid];
          v28 = [v24 UUIDString];
          [v27 setObject:v23 forKeyedSubscript:v28];
        }

        ++v10;
      }

      while (v9 != v10);
      v9 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
    }

    while (v9);
  }

  v29 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_49(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) lightLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v7;
    v12 = 2112;
    v13 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to set natural lighting for all matter light profiles with error: %@", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_48(uint64_t a1, void *a2)
{
  v3 = [a2 lightProfileUUID];
  v4 = [*(a1 + 32) uniqueIdentifier];
  v5 = [v3 hmf_isEqualToUUID:v4];

  return v5;
}

uint64_t __54__HMDHome_Light__executeMatterNaturalLightingActions___block_invoke_42(uint64_t a1, void *a2)
{
  v3 = [a2 lightProfileUUID];
  v4 = [*(a1 + 32) uniqueIdentifier];
  v5 = [v3 hmf_isEqualToUUID:v4];

  return v5;
}

uint64_t __68__HMDHome_Light___handleSetNaturalLightingEnabled_forLightProfiles___block_invoke(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __68__HMDHome_Light___handleSetNaturalLightingEnabled_forLightProfiles___block_invoke_2;
  v11[3] = &unk_278675550;
  v12 = *(a1 + 32);
  [v3 hmf_enumerateWithAutoreleasePoolUsingBlock:v11];
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 40) lightLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 32);
    *buf = 138543618;
    v14 = v7;
    v15 = 2112;
    v16 = v8;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_DEBUG, "%{public}@_handleSetNaturalLightingEnabledresponses: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 32) copy];

  v9 = *MEMORY[0x277D85DE8];
  return 1;
}

void __68__HMDHome_Light___handleSetNaturalLightingEnabled_forLightProfiles___block_invoke_2(uint64_t a1, void *a2)
{
  v5 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v5;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  if (v4)
  {
    [*(a1 + 32) addEntriesFromDictionary:v4];
  }
}

- (void)handleSetNaturalLightingEnabledForLightProfilesMessage:(id)a3
{
  v33 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v6 = [v4 BOOLForKey:@"HMDLightProfileEnableNaturalLightingCodingKey"];
    v7 = [v4 arrayForKey:*MEMORY[0x277CD0430]];
    v8 = v7;
    if (v7 && ![v7 hmf_isEmpty])
    {
      v23 = v6;
      v14 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v8, "count")}];
      v26 = 0u;
      v27 = 0u;
      v28 = 0u;
      v29 = 0u;
      v8 = v8;
      v15 = [v8 countByEnumeratingWithState:&v26 objects:v30 count:16];
      if (v15)
      {
        v16 = v15;
        v17 = *v27;
        do
        {
          v18 = 0;
          do
          {
            if (*v27 != v17)
            {
              objc_enumerationMutation(v8);
            }

            v19 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:*(*(&v26 + 1) + 8 * v18)];
            v20 = [(HMDHome *)self lightProfileWithUUID:v19];

            if (v20)
            {
              [v14 addObject:v20];
            }

            ++v18;
          }

          while (v16 != v18);
          v16 = [v8 countByEnumeratingWithState:&v26 objects:v30 count:16];
        }

        while (v16);
      }

      if ([v14 hmf_isEmpty])
      {
        v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [v4 respondWithError:v21];
      }

      else
      {
        v21 = [(HMDHome *)self _handleSetNaturalLightingEnabled:v23 forLightProfiles:v14];
        v24[0] = MEMORY[0x277D85DD0];
        v24[1] = 3221225472;
        v24[2] = __73__HMDHome_Light__handleSetNaturalLightingEnabledForLightProfilesMessage___block_invoke;
        v24[3] = &unk_27867DBA0;
        v24[4] = self;
        v25 = v4;
        [v21 getResultWithCompletion:v24];
      }
    }

    else
    {
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v4 respondWithError:v9];
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = [(HMDHome *)self lightLogCategory];
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v32 = v13;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_INFO, "%{public}@Not handling remote message to set natural lighting enabled for light profiles on non-primary resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [v4 respondWithError:v8];
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome_Light__handleSetNaturalLightingEnabledForLightProfilesMessage___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = [*(a1 + 32) lightLogCategory];
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v17 = v10;
    v18 = 2112;
    v19 = v6;
    v20 = 2112;
    v21 = v5;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Responding to message with error: %@ responses: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 40);
  v14 = @"HMDHomeSetNaturalLightingEnabledByLightProfileUUIDsCodingKey";
  v15 = v5;
  v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v15 forKeys:&v14 count:1];
  [v11 respondWithPayload:v12];

  v13 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome_Light__handleSetNaturalLightingEnabled_forMatterLightProfiles___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v36 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v31 = v10;
    v32 = 2112;
    v33 = v6;
    v34 = 2112;
    v35 = v5;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Completed setting natural lighitng with error: %@ responses: %@", buf, 0x20u);
  }

  v21 = v6;

  objc_autoreleasePoolPop(v7);
  v22 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v23 = v5;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  v11 = [v5 allKeys];
  v12 = [v11 countByEnumeratingWithState:&v25 objects:v29 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v26;
    do
    {
      v15 = 0;
      do
      {
        if (*v26 != v14)
        {
          objc_enumerationMutation(v11);
        }

        v16 = *(*(&v25 + 1) + 8 * v15);
        v17 = *(a1 + 40);
        v24[0] = MEMORY[0x277D85DD0];
        v24[1] = 3221225472;
        v24[2] = __73__HMDHome_Light__handleSetNaturalLightingEnabled_forMatterLightProfiles___block_invoke_29;
        v24[3] = &unk_2786782C8;
        v24[4] = v16;
        v18 = [v17 na_firstObjectPassingTest:{v24, v21}];
        if (v18)
        {
          v19 = [v23 objectForKeyedSubscript:v16];
          [v22 setObject:v19 forKey:v18];
        }

        ++v15;
      }

      while (v13 != v15);
      v13 = [v11 countByEnumeratingWithState:&v25 objects:v29 count:16];
    }

    while (v13);
  }

  [*(a1 + 48) fulfillWithValue:v22];
  v20 = *MEMORY[0x277D85DE8];
}

void __73__HMDHome_Light__handleSetNaturalLightingEnabled_forMatterLightProfiles___block_invoke_3(uint64_t a1, void *a2, void *a3)
{
  v40 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (!WeakRetained)
  {
    v23 = *(a1 + 32);
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    v24 = v23;
    v25 = v8;
LABEL_15:
    [v24 rejectWithError:v25];
    goto LABEL_16;
  }

  v8 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  if (!v6)
  {
    v24 = *(a1 + 32);
    v25 = v5;
    goto LABEL_15;
  }

  v30 = v5;
  v9 = objc_autoreleasePoolPush();
  v28 = WeakRetained;
  v10 = [WeakRetained lightLogCategory];
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    *buf = 138543618;
    v37 = v12;
    v38 = 2112;
    v39 = v6;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@setNaturalLightingEnabledForLightProfiles responsePayload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v29 = v6;
  v13 = [v6 hmf_dictionaryForKey:@"HMDHomeSetNaturalLightingEnabledByLightProfileUUIDsCodingKey"];
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v27 = a1;
  v14 = *(a1 + 40);
  v15 = [v14 countByEnumeratingWithState:&v31 objects:v35 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v32;
    do
    {
      for (i = 0; i != v16; ++i)
      {
        if (*v32 != v17)
        {
          objc_enumerationMutation(v14);
        }

        v19 = *(*(&v31 + 1) + 8 * i);
        v20 = [v19 uniqueIdentifier];
        v21 = [v20 UUIDString];
        v22 = [v13 hmf_numberForKey:v21];

        [v8 setObject:v22 forKey:v19];
      }

      v16 = [v14 countByEnumeratingWithState:&v31 objects:v35 count:16];
    }

    while (v16);
  }

  [*(v27 + 32) fulfillWithValue:v8];
  v6 = v29;
  v5 = v30;
  WeakRetained = v28;
LABEL_16:

  v26 = *MEMORY[0x277D85DE8];
}

id __73__HMDHome_Light__handleSetNaturalLightingEnabled_forMatterLightProfiles___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = [a2 uniqueIdentifier];
  v3 = [v2 UUIDString];

  return v3;
}

uint64_t __73__HMDHome_Light__handleSetNaturalLightingEnabled_forMatterLightProfiles___block_invoke_29(uint64_t a1, void *a2)
{
  v3 = [a2 uniqueIdentifier];
  v4 = [v3 UUIDString];
  v5 = [v4 isEqual:*(a1 + 32)];

  return v5;
}

- (void)updateLightProfilesSettings:(id)a3
{
  v38 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277CBEB58] set];
  v6 = [MEMORY[0x277CBEB58] set];
  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  v7 = v4;
  v8 = [v7 countByEnumeratingWithState:&v29 objects:v37 count:16];
  if (v8)
  {
    v9 = *v30;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v30 != v9)
        {
          objc_enumerationMutation(v7);
        }

        v11 = *(*(&v29 + 1) + 8 * i);
        v12 = [v11 readCharacteristicRequests];
        if ([v12 count])
        {
          v13 = [v12 allObjects];
          [v5 addObjectsFromArray:v13];

          [v6 addObject:v11];
        }
      }

      v8 = [v7 countByEnumeratingWithState:&v29 objects:v37 count:16];
    }

    while (v8);
  }

  v14 = [v5 count] == 0;
  v15 = objc_autoreleasePoolPush();
  if (v14)
  {
    v22 = [(HMDHome *)self lightLogCategory];
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v34 = v24;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_DEBUG, "%{public}@No characteristic read requests for light profiles", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  else
  {
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [v5 count];
      *buf = 138543618;
      v34 = v18;
      v35 = 2048;
      v36 = v19;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@update light profiles settings, read characteristic count %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    objc_initWeak(buf, v16);
    v20 = [v5 allObjects];
    v21 = [(HMDHome *)v16 description];
    v26[0] = MEMORY[0x277D85DD0];
    v26[1] = 3221225472;
    v26[2] = __46__HMDHome_Light__updateLightProfilesSettings___block_invoke;
    v26[3] = &unk_278687F40;
    objc_copyWeak(&v28, buf);
    v27 = v6;
    [(HMDHome *)v16 readCharacteristicValues:v20 source:1140 sourceForLogging:v21 qualityOfService:-1 withCompletionHandler:v26];

    objc_destroyWeak(&v28);
    objc_destroyWeak(buf);
  }

  v25 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome_Light__updateLightProfilesSettings___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v36 = *MEMORY[0x277D85DE8];
  v20 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v7 = v5;
    if ([v5 count])
    {
      v27 = 0u;
      v28 = 0u;
      v25 = 0u;
      v26 = 0u;
      obj = *(a1 + 32);
      v8 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
      if (v8)
      {
        v9 = v8;
        v10 = *v26;
        do
        {
          for (i = 0; i != v9; ++i)
          {
            if (*v26 != v10)
            {
              objc_enumerationMutation(obj);
            }

            v12 = *(*(&v25 + 1) + 8 * i);
            v13 = [v12 workQueue];
            block[0] = MEMORY[0x277D85DD0];
            block[1] = 3221225472;
            block[2] = __46__HMDHome_Light__updateLightProfilesSettings___block_invoke_24;
            block[3] = &unk_2786891E0;
            block[4] = v12;
            v5 = v7;
            v22 = v7;
            v23 = WeakRetained;
            v24 = v20;
            dispatch_async(v13, block);
          }

          v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
        }

        while (v9);
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      v15 = [WeakRetained lightLogCategory];
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543874;
        v31 = v17;
        v32 = 2112;
        v33 = v7;
        v34 = 2112;
        v35 = v20;
        _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Received empty response payload for light profile charactersitic read requests %@:%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v14);
      v5 = v7;
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome_Light__updateLightProfilesSettings___block_invoke_24(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v18 = 0;
  v4 = [v2 updateSettingsWithReadCharacteristicResponsePayload:v3 error:&v18];
  v5 = v18;
  v6 = objc_autoreleasePoolPush();
  v7 = [*(a1 + 48) lightLogCategory];
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v4)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 32);
      *buf = 138543874;
      v20 = v10;
      v21 = 2112;
      v22 = v11;
      v23 = 2112;
      v24 = v4;
      v12 = "%{public}@Successfully updated light profile settings %@:%@";
      v13 = v9;
      v14 = OS_LOG_TYPE_INFO;
LABEL_6:
      _os_log_impl(&dword_229538000, v13, v14, v12, buf, 0x20u);
    }
  }

  else if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v15 = *(a1 + 32);
    v16 = *(a1 + 56);
    *buf = 138543874;
    v20 = v10;
    v21 = 2112;
    v22 = v15;
    v23 = 2112;
    v24 = v16;
    v12 = "%{public}@Failed to update light profile settings %@:%@";
    v13 = v9;
    v14 = OS_LOG_TYPE_ERROR;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v6);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled:(BOOL)a3
{
  v3 = a3;
  v24 = *MEMORY[0x277D85DE8];
  v5 = [MEMORY[0x277CBEB58] set];
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v6 = [(HMDHome *)self accessories];
  v7 = [v6 countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v20;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v20 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v19 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = v11;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if (v13)
        {
          v14 = [v13 lightProfiles];
          v15 = v14;
          if (v3)
          {
            v16 = [v14 na_filter:&__block_literal_global_69872];

            v15 = v16;
          }

          v17 = [v15 allObjects];
          [v5 addObjectsFromArray:v17];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v19 objects:v23 count:16];
    }

    while (v8);
  }

  [(HMDHome *)self updateLightProfilesSettings:v5];
  v18 = *MEMORY[0x277D85DE8];
}

BOOL __82__HMDHome_Light__updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 notificationEnabledCharacteristics];
  v3 = [v2 count] != 0;

  return v3;
}

- (void)respondMessage:(id)a3 withSettingResults:(id)a4
{
  v27 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v18 = 0;
  v8 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v7 requiringSecureCoding:1 error:&v18];
  v9 = v18;
  v10 = objc_autoreleasePoolPush();
  v11 = [(HMDHome *)self lightLogCategory];
  v12 = HMFGetOSLogHandle();
  v13 = v12;
  if (v8)
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v22 = v14;
      v23 = 2112;
      v24 = v7;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Responding with light profile settings: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v19 = *MEMORY[0x277CD0438];
    v20 = v8;
    v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v20 forKeys:&v19 count:1];
    [v6 respondWithPayload:v15];
  }

  else
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543874;
      v22 = v16;
      v23 = 2112;
      v24 = v7;
      v25 = 2112;
      v26 = v9;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to encode profile setting results: %@ with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
    [v6 respondWithError:v15];
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)handleFetchLightProfileSettingsMessage:(id)a3 withLightProfileUUIDs:(id)a4
{
  v55 = *MEMORY[0x277D85DE8];
  v36 = a3;
  v6 = a4;
  v7 = objc_autoreleasePoolPush();
  v37 = self;
  v8 = [(HMDHome *)self lightLogCategory];
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543618;
    v52 = v10;
    v53 = 2112;
    v54 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Handling fetch light profiles settings for profiles: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = [MEMORY[0x277CBEB38] dictionary];
  v40 = [MEMORY[0x277CBEB58] set];
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v48 = 0u;
  obj = v6;
  v12 = [obj countByEnumeratingWithState:&v45 objects:v50 count:16];
  v13 = self;
  if (v12)
  {
    v14 = v12;
    v15 = *v46;
    do
    {
      v16 = 0;
      v38 = v14;
      do
      {
        if (*v46 != v15)
        {
          objc_enumerationMutation(obj);
        }

        v17 = *(*(&v45 + 1) + 8 * v16);
        v18 = [(HMDHome *)v13 lightProfileWithUUID:v17];
        if (v18)
        {
          [v40 addObject:v18];
        }

        else
        {
          v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          v20 = [objc_alloc(MEMORY[0x277CD1A80]) initWithError:v19];
          v21 = v11;
          [v11 setObject:v20 forKeyedSubscript:v17];

          v22 = objc_autoreleasePoolPush();
          v23 = [(HMDHome *)v13 lightLogCategory];
          v24 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
          {
            v25 = HMFGetLogIdentifier();
            *buf = 138543618;
            v52 = v25;
            v53 = 2112;
            v54 = v17;
            _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Could not find light profile with uuid: %@", buf, 0x16u);

            v13 = v37;
          }

          objc_autoreleasePoolPop(v22);
          v11 = v21;
          v14 = v38;
        }

        ++v16;
      }

      while (v14 != v16);
      v14 = [obj countByEnumeratingWithState:&v45 objects:v50 count:16];
    }

    while (v14);
  }

  v43 = 0u;
  v44 = 0u;
  v41 = 0u;
  v42 = 0u;
  v26 = v40;
  v27 = [v26 countByEnumeratingWithState:&v41 objects:v49 count:16];
  if (v27)
  {
    v28 = v27;
    v29 = *v42;
    do
    {
      for (i = 0; i != v28; ++i)
      {
        if (*v42 != v29)
        {
          objc_enumerationMutation(v26);
        }

        v31 = *(*(&v41 + 1) + 8 * i);
        v32 = [v31 settings];
        v33 = [objc_alloc(MEMORY[0x277CD1A80]) initWithSettings:v32];
        v34 = [v31 uniqueIdentifier];
        [v11 setObject:v33 forKeyedSubscript:v34];
      }

      v28 = [v26 countByEnumeratingWithState:&v41 objects:v49 count:16];
    }

    while (v28);
  }

  [(HMDHome *)v37 respondMessage:v36 withSettingResults:v11];
  v35 = *MEMORY[0x277D85DE8];
}

- (void)handleFetchLightProfileSettingsMessage:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [v4 setForKey:*MEMORY[0x277CD0430]];
  [(HMDHome *)self handleFetchLightProfileSettingsMessage:v4 withLightProfileUUIDs:v6];
}

- (id)lightProfileWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self accessories];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __39__HMDHome_Light__lightProfileWithUUID___block_invoke;
  v10[3] = &unk_2786754E0;
  v11 = v4;
  v6 = v4;
  v7 = [v5 na_map:v10];

  v8 = [v7 firstObject];

  return v8;
}

id __39__HMDHome_Light__lightProfileWithUUID___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = v5;
  if (v5)
  {
    v7 = [v5 lightProfiles];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __39__HMDHome_Light__lightProfileWithUUID___block_invoke_2;
    v10[3] = &unk_2786782C8;
    v11 = *(a1 + 32);
    v8 = [v7 na_firstObjectPassingTest:v10];
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

uint64_t __39__HMDHome_Light__lightProfileWithUUID___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 uniqueIdentifier];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (id)createPrimaryResidentMessageRouterWithHomeUUID:(id)a3 messageDispatcher:(id)a4 metricsDispatcher:(id)a5
{
  v7 = a5;
  v8 = a4;
  v9 = a3;
  v10 = [[HMDPrimaryResidentMessageRouter alloc] initWithHomeUUID:v9 messageDispatcher:v8 metricsDispatcher:v7];

  return v10;
}

- (void)configurePrimaryResidentMessageRouterWithFactory:(id)a3 metricsDispatcherFactory:(id)a4
{
  v21 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring primary resident message router", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [(HMDHome *)v9 msgDispatcher];
  v13 = [(HMDHome *)v9 msgDispatcher];

  if (!v13)
  {
    _HMFPreconditionFailure();
  }

  v14 = +[HMDMetricsManager sharedLogEventSubmitter];
  v15 = [v7 createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:v14];
  v16 = [(HMDHome *)v9 uuid];
  v17 = [v6 createPrimaryResidentMessageRouterWithHomeUUID:v16 messageDispatcher:v12 metricsDispatcher:v15];

  [v17 setDataSource:v9];
  [(HMDHome *)v9 setPrimaryResidentMessageRouter:v17];

  v18 = *MEMORY[0x277D85DE8];
}

- (id)createAccessorySettingsLocalMessageHandlerWithHomeUUID:(id)a3 languageValuesDataProvider:(id)a4
{
  v5 = a4;
  v6 = a3;
  v7 = [[HMDAccessorySettingsLocalMessageHandler alloc] initWithHomeUUID:v6 languageValuesDataProvider:v5];

  return v7;
}

- (id)languageValueList
{
  v3 = [(HMDHome *)self appleMediaAccessories];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __83__HMDHome_UnifiedLanguageValueListSettingDataProviderDataSource__languageValueList__block_invoke;
  v6[3] = &unk_278677020;
  v6[4] = self;
  v4 = [v3 na_flatMap:v6];

  return v4;
}

id __83__HMDHome_UnifiedLanguageValueListSettingDataProviderDataSource__languageValueList__block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = [v2 fetchedAccessorySettingsSubscriber];
  v5 = [v3 uuid];

  v6 = [v4 cachedSettingForAccessory:v5 keyPath:@"root.siri.availableLanguages"];

  v7 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  v10 = [v9 languageValues];

  return v10;
}

- (id)dataProvidersForUnifiedLanguageValueListSettingDataProvider:(id)a3
{
  v6[1] = *MEMORY[0x277D85DE8];
  v6[0] = self;
  v3 = [MEMORY[0x277CBEA60] arrayWithObjects:v6 count:1];
  v4 = *MEMORY[0x277D85DE8];

  return v3;
}

- (id)handleRemoveUserUniqueIdentifier:(id)a3 fromAccessory:(id)a4
{
  v39 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = [(HMDHome *)self walletLogCategory];
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = [v7 uuid];
    *buf = 138543874;
    v34 = v11;
    v35 = 2112;
    v36 = v6;
    v37 = 2112;
    v38 = v12;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@handleRemoveUserUniqueIdentifier: %@, fromAccessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  v13 = objc_alloc(MEMORY[0x277D0F7A8]);
  v14 = [(HMDHome *)self workQueue];
  v15 = [v13 initWithQueue:v14];

  v16 = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
  v17 = [v7 waitForDoorLockClusterObjectWithFlow:v16];
  v31[0] = MEMORY[0x277D85DD0];
  v31[1] = 3221225472;
  v31[2] = __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke;
  v31[3] = &unk_278683930;
  v18 = v6;
  v32 = v18;
  v19 = [v17 inContext:v15 then:v31];
  v28[0] = MEMORY[0x277D85DD0];
  v28[1] = 3221225472;
  v28[2] = __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke_2;
  v28[3] = &unk_27867C6C8;
  v28[4] = self;
  v29 = v18;
  v30 = v7;
  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke_142;
  v25[3] = &unk_278685D80;
  v25[4] = self;
  v26 = v29;
  v27 = v30;
  v20 = v29;
  v21 = v30;
  v22 = [v19 inContext:v15 then:v28 orRecover:v25];

  v23 = *MEMORY[0x277D85DE8];

  return v22;
}

uint64_t __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 removeUserWithUniqueID:*(a1 + 32)];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke_2(v7);
  }
}

uint64_t __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke_2(uint64_t a1, void *a2)
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v9 = [*(a1 + 48) uuid];
    v12 = 138543874;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2112;
    v17 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully removed user with userUniqueID: %@, fromAccessory: %@", &v12, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __83__HMDHome_AccessoryUserIdentifier__handleRemoveUserUniqueIdentifier_fromAccessory___block_invoke_142(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v9 = [*(a1 + 48) uuid];
    v15 = 138543874;
    v16 = v7;
    v17 = 2112;
    v18 = v8;
    v19 = 2112;
    v20 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to remove user with userUniqueID: %@, fromAccessory: %@", &v15, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = v3;
  v11 = v10;
  if (v10)
  {
    v12 = v10;
  }

  else
  {
    [MEMORY[0x277CCA9B8] hmfUnspecifiedError];
    objc_claimAutoreleasedReturnValue();
  }

  v13 = *MEMORY[0x277D85DE8];
  return 2;
}

- (id)auditOrAddRestrictedGuestUserUniqueIdentifier:(id)a3 onAccessory:(id)a4 user:(id)a5 requireFullScheduleAudit:(BOOL)a6 flow:(id)a7
{
  v51 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a7;
  v16 = objc_autoreleasePoolPush();
  v17 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    [v15 UUID];
    v35 = v15;
    v20 = v14;
    v22 = v21 = a6;
    v23 = [v13 uuid];
    *buf = 138544130;
    v44 = v19;
    v45 = 2112;
    v46 = v22;
    v47 = 2112;
    v48 = v12;
    v49 = 2112;
    v50 = v23;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] auditOrAddRestrictedGuestUserUniqueIdentifier: %@ onAccessory: %@", buf, 0x2Au);

    a6 = v21;
    v14 = v20;
    v15 = v35;
  }

  objc_autoreleasePoolPop(v16);
  v24 = [v13 weekDayScheduleCapacity];
  if ([v24 BOOLValue])
  {
    v25 = [v13 yearDayScheduleCapacity];
    v26 = [v25 BOOLValue];
  }

  else
  {
    v26 = 0;
  }

  v27 = [v14 restrictedGuestAccessSettings];
  v28 = [v27 schedule];
  v29 = [v13 supportsConfiguredSchedule:v28];

  if (v29)
  {
    v30 = [v13 waitForDoorLockClusterObjectWithFlow:v15];
    v36[0] = MEMORY[0x277D85DD0];
    v36[1] = 3221225472;
    v36[2] = __129__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuestUserUniqueIdentifier_onAccessory_user_requireFullScheduleAudit_flow___block_invoke;
    v36[3] = &unk_278677548;
    v41 = v26;
    v36[4] = v17;
    v37 = v15;
    v38 = v13;
    v39 = v12;
    v40 = v14;
    v42 = a6;
    v31 = [v30 then:v36];
  }

  else
  {
    v32 = MEMORY[0x277D0F7C0];
    v30 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:5];
    v31 = [v32 futureWithError:v30];
  }

  v33 = *MEMORY[0x277D85DE8];

  return v31;
}

uint64_t __129__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuestUserUniqueIdentifier_onAccessory_user_requireFullScheduleAudit_flow___block_invoke(uint64_t a1, void *a2)
{
  v35 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (*(a1 + 72) == 1)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 40) UUID];
      v10 = [*(a1 + 48) uuid];
      v11 = *(a1 + 56);
      *buf = 138544130;
      v28 = v8;
      v29 = 2112;
      v30 = v9;
      v31 = 2112;
      v32 = v10;
      v33 = 2112;
      v34 = v11;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Accessory[%@] supports schedules, auditing schedules for userUniqueID[%@]", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v5);
    v12 = *(a1 + 56);
    v13 = [*(a1 + 64) restrictedGuestAccessSettings];
    v14 = [v13 matterWeekDaySchedules];
    v15 = [*(a1 + 64) restrictedGuestAccessSettings];
    v16 = [*(a1 + 32) timeZone];
    v17 = [v15 matterYearDaySchedulesWithTimeZone:v16];
    v18 = [v4 findOrAddUserWithUniqueID:v12 withWeekDaySchedules:v14 andYearDaySchedules:v17 requireFullScheduleAudit:*(a1 + 73) flow:*(a1 + 40)];
  }

  else
  {
    v18 = [v3 findOrAddUserWithUniqueID:*(a1 + 56) flow:*(a1 + 40)];
  }

  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __129__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuestUserUniqueIdentifier_onAccessory_user_requireFullScheduleAudit_flow___block_invoke_141;
  v24[3] = &unk_278677520;
  v19 = *(a1 + 40);
  v24[4] = *(a1 + 32);
  v25 = v19;
  v26 = *(a1 + 56);
  v20 = [v18 then:v24];
  if (!v20)
  {
    _HMFPreconditionFailure();
  }

  v21 = v20;

  v22 = *MEMORY[0x277D85DE8];
  return 3;
}

uint64_t __129__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuestUserUniqueIdentifier_onAccessory_user_requireFullScheduleAudit_flow___block_invoke_141(uint64_t a1, void *a2)
{
  v29 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 existingUser];

  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 32);
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v4)
  {
    if (v8)
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 40) UUID];
      v11 = [v3 existingUser];
      v12 = [v11 userIndex];
      v13 = *(a1 + 48);
      v21 = 138544130;
      v22 = v9;
      v23 = 2112;
      v24 = v10;
      v25 = 2112;
      v26 = v12;
      v27 = 2112;
      v28 = v13;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Found userIndex: %@ for userUniqueID: %@", &v21, 0x2Au);
    }

    objc_autoreleasePoolPop(v5);
    v14 = [v3 existingUser];
    [v14 userIndex];
    objc_claimAutoreleasedReturnValue();
  }

  else
  {
    if (v8)
    {
      v15 = HMFGetLogIdentifier();
      v16 = [*(a1 + 40) UUID];
      v17 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v3, "newUserSlot")}];
      v18 = *(a1 + 48);
      v21 = 138544130;
      v22 = v15;
      v23 = 2112;
      v24 = v16;
      v25 = 2112;
      v26 = v17;
      v27 = 2112;
      v28 = v18;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Created new user with userIndex: %@ for userUniqueID: %@", &v21, 0x2Au);
    }

    objc_autoreleasePoolPop(v5);
    [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v3, "newUserSlot")}];
    objc_claimAutoreleasedReturnValue();
  }

  v19 = *MEMORY[0x277D85DE8];
  return 1;
}

- (id)handleFindOrAddUserUniqueIdentifier:(id)a3 onAccessory:(id)a4 flow:(id)a5
{
  v40 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = [v10 UUID];
    v16 = [v9 uuid];
    *buf = 138544130;
    v33 = v14;
    v34 = 2112;
    v35 = v15;
    v36 = 2112;
    v37 = v8;
    v38 = 2112;
    v39 = v16;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] handleFindOrAddUserUniqueIdentifier: %@ onAccessory: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v11);
  v17 = [v9 waitForDoorLockClusterObjectWithFlow:v10];
  v29[0] = MEMORY[0x277D85DD0];
  v29[1] = 3221225472;
  v29[2] = __89__HMDHome_AccessoryUserIdentifier__handleFindOrAddUserUniqueIdentifier_onAccessory_flow___block_invoke;
  v29[3] = &unk_27868A6D8;
  v18 = v8;
  v30 = v18;
  v19 = v10;
  v31 = v19;
  v20 = [v17 then:v29];
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __89__HMDHome_AccessoryUserIdentifier__handleFindOrAddUserUniqueIdentifier_onAccessory_flow___block_invoke_2;
  v26[3] = &unk_278677520;
  v26[4] = v12;
  v27 = v19;
  v28 = v18;
  v21 = v18;
  v22 = v19;
  v23 = [v20 then:v26];

  v24 = *MEMORY[0x277D85DE8];

  return v23;
}

uint64_t __89__HMDHome_AccessoryUserIdentifier__handleFindOrAddUserUniqueIdentifier_onAccessory_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 findOrAddUserWithUniqueID:*(a1 + 32) flow:*(a1 + 40)];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return __89__HMDHome_AccessoryUserIdentifier__handleFindOrAddUserUniqueIdentifier_onAccessory_flow___block_invoke_2(v7);
  }
}

uint64_t __89__HMDHome_AccessoryUserIdentifier__handleFindOrAddUserUniqueIdentifier_onAccessory_flow___block_invoke_2(uint64_t a1, void *a2)
{
  v29 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 existingUser];

  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 32);
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v4)
  {
    if (v8)
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 40) UUID];
      v11 = [v3 existingUser];
      v12 = [v11 userIndex];
      v13 = *(a1 + 48);
      v21 = 138544130;
      v22 = v9;
      v23 = 2112;
      v24 = v10;
      v25 = 2112;
      v26 = v12;
      v27 = 2112;
      v28 = v13;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Found userIndex: %@ for userUniqueID: %@", &v21, 0x2Au);
    }

    objc_autoreleasePoolPop(v5);
    v14 = [v3 existingUser];
    [v14 userIndex];
    objc_claimAutoreleasedReturnValue();
  }

  else
  {
    if (v8)
    {
      v15 = HMFGetLogIdentifier();
      v16 = [*(a1 + 40) UUID];
      v17 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v3, "newUserSlot")}];
      v18 = *(a1 + 48);
      v21 = 138544130;
      v22 = v15;
      v23 = 2112;
      v24 = v16;
      v25 = 2112;
      v26 = v17;
      v27 = 2112;
      v28 = v18;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Found userIndex: %@ for userUniqueID: %@", &v21, 0x2Au);
    }

    objc_autoreleasePoolPop(v5);
    [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v3, "newUserSlot")}];
    objc_claimAutoreleasedReturnValue();
  }

  v19 = *MEMORY[0x277D85DE8];
  return 1;
}

- (id)findUserSlotForUserUniqueIdentifier:(id)a3 onAccessory:(id)a4
{
  v5 = a3;
  v6 = MEMORY[0x277D0F7B8];
  v7 = a4;
  v8 = [v6 untrackedPlaceholderFlow];
  v9 = [v7 waitForDoorLockClusterObjectWithFlow:v8];

  v10 = [v9 naFuture];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __84__HMDHome_AccessoryUserIdentifier__findUserSlotForUserUniqueIdentifier_onAccessory___block_invoke;
  v14[3] = &unk_278688428;
  v15 = v5;
  v11 = v5;
  v12 = [v10 flatMap:v14];

  return v12;
}

id __84__HMDHome_AccessoryUserIdentifier__findUserSlotForUserUniqueIdentifier_onAccessory___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = MEMORY[0x277D0F7B8];
  v4 = a2;
  v5 = [v3 untrackedPlaceholderFlow];
  v6 = [v4 findUserOrAvailableSlotWithUserUniqueID:v2 flow:v5];

  v7 = [v6 naFuture];
  v8 = [v7 flatMap:&__block_literal_global_138];

  return v8;
}

id __84__HMDHome_AccessoryUserIdentifier__findUserSlotForUserUniqueIdentifier_onAccessory___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 user];

  v4 = MEMORY[0x277D2C900];
  if (v3)
  {
    v5 = [v2 user];
    v6 = [v5 userIndex];
    v7 = [v4 futureWithResult:v6];
  }

  else
  {
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v7 = [v4 futureWithError:v5];
  }

  return v7;
}

- (id)createUserUniqueIDForAccessories
{
  v2 = [(HMDHome *)self uniqueIDsOfAllUsers];
  v3 = [objc_opt_class() createUserUniqueIDForAccessoriesWithoutDuplicatingExistingIDs:v2];

  return v3;
}

- (id)saveUserUniqueID:(id)a3 ForGuestAccessCode:(id)a4
{
  v6 = a3;
  v7 = a4;
  v26 = 0;
  v8 = [MEMORY[0x277D0F7C0] futureWithPromise:&v26];
  v9 = [(HMDHome *)self backingStore];
  v10 = [v9 context];

  v11 = [HMDHomeAccessCodeModel alloc];
  v12 = [(HMDHome *)self uuid];
  v13 = [(HMDHomeAccessCodeModel *)v11 initWithHomeUUID:v12 value:v7 label:&stru_283CF9D50];

  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __72__HMDHome_AccessoryUserIdentifier__saveUserUniqueID_ForGuestAccessCode___block_invoke;
  v19[3] = &unk_278683598;
  v20 = v13;
  v21 = self;
  v22 = v7;
  v23 = v26;
  v24 = v6;
  v25 = v10;
  v14 = v10;
  v15 = v6;
  v16 = v7;
  v17 = v13;
  [v14 performBlock:v19];

  return v8;
}

void __72__HMDHome_AccessoryUserIdentifier__saveUserUniqueID_ForGuestAccessCode___block_invoke(uint64_t a1)
{
  v37 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findGuestAccessCodeWithModelID:v2];

  if (!v3)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = [*(a1 + 40) walletLogCategory];
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      v24 = *(a1 + 48);
      *buf = 138543618;
      v32 = v23;
      v33 = 2112;
      v34 = v24;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@MKFGuestAccessCode model not found, failed to save unique ID for accessCode: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v25 = *(a1 + 56);
    v12 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
    v26 = v25;
    goto LABEL_14;
  }

  [v3 setUserUniqueIDForAccessories:*(a1 + 64)];
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 40) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 72) managedObjectContext];
    [v8 hasChanges];
    v9 = HMFBooleanToString();
    *buf = 138543618;
    v32 = v7;
    v33 = 2112;
    v34 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@moc has changes %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = *(a1 + 72);
  v30 = 0;
  v11 = [v10 save:&v30];
  v12 = v30;
  v13 = objc_autoreleasePoolPush();
  v14 = [*(a1 + 40) walletLogCategory];
  v15 = HMFGetOSLogHandle();
  v16 = os_log_type_enabled(v15, OS_LOG_TYPE_INFO);
  if ((v11 & 1) == 0)
  {
    if (v16)
    {
      v27 = HMFGetLogIdentifier();
      v28 = *(a1 + 48);
      *buf = 138543874;
      v32 = v27;
      v33 = 2112;
      v34 = v28;
      v35 = 2112;
      v36 = v12;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Failed to save userUniqueID for guest access code: %@ with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v26 = *(a1 + 56);
LABEL_14:
    [v26 rejectWithError:v12];
    goto LABEL_15;
  }

  if (v16)
  {
    v17 = HMFGetLogIdentifier();
    v18 = *(a1 + 48);
    v19 = *(a1 + 64);
    *buf = 138543874;
    v32 = v17;
    v33 = 2112;
    v34 = v18;
    v35 = 2112;
    v36 = v19;
    _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Successfully saved userUniqueID for guest access code: %@ userUniqueID: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v13);
  [*(a1 + 56) fulfillWithNoValue];
LABEL_15:

  v29 = *MEMORY[0x277D85DE8];
}

- (void)getOrCreateUniqueIDForAccessoriesForUser:(id)a3 flow:(id)a4 completionHandler:(id)a5
{
  v8 = a5;
  v9 = [(HMDHome *)self getOrCreateUniqueIDForAccessoriesForUser:a3 flow:a4];
  [v9 getResultWithCompletion:v8];
}

- (id)getOrCreateUniqueIDForAccessoriesForUser:(id)a3 flow:(id)a4
{
  v6 = a3;
  v7 = a4;
  v21 = 0;
  v8 = [MEMORY[0x277D0F7C0] futureWithPromise:&v21];
  v9 = [(HMDHome *)self backingStore];
  v10 = [v9 context];

  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __82__HMDHome_AccessoryUserIdentifier__getOrCreateUniqueIDForAccessoriesForUser_flow___block_invoke;
  v15[3] = &unk_278689550;
  v16 = v6;
  v17 = v10;
  v18 = self;
  v19 = v7;
  v20 = v21;
  v11 = v7;
  v12 = v10;
  v13 = v6;
  [v12 performBlock:v15];

  return v8;
}

void __82__HMDHome_AccessoryUserIdentifier__getOrCreateUniqueIDForAccessoriesForUser_flow___block_invoke(id *a1)
{
  v53 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] uuid];
  v3 = [a1[5] managedObjectContext];
  v4 = [_MKFHome findHomeMemberWithUUID:v2 context:v3];

  if (!v4)
  {
    v24 = objc_autoreleasePoolPush();
    v25 = a1[6];
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [a1[7] UUID];
      v29 = [a1[4] uuid];
      *buf = 138543874;
      v46 = v27;
      v47 = 2112;
      v48 = v28;
      v49 = 2112;
      v50 = v29;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find home member with UUID: %@", buf, 0x20u);
    }

    v30 = v24;
    goto LABEL_20;
  }

  v5 = [v4 uniqueIDForAccessories];
  v6 = v5;
  if (!v5 || ([v5 isEqualToNumber:&unk_283E728D8] & 1) != 0)
  {
    v7 = [a1[6] createUserUniqueIDForAccessories];

    v8 = objc_autoreleasePoolPush();
    v9 = a1[6];
    v10 = HMFGetOSLogHandle();
    v11 = v10;
    if (v7)
    {
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        v13 = [a1[7] UUID];
        v14 = [a1[4] uuid];
        *buf = 138544130;
        v46 = v12;
        v47 = 2112;
        v48 = v13;
        v49 = 2112;
        v50 = v7;
        v51 = 2112;
        v52 = v14;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Created uniqueIDForAccessories:%@ for user:%@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v8);
      [v4 setUniqueIDForAccessories:v7];
      v15 = a1[5];
      v44 = 0;
      [v15 save:&v44];
      v16 = v44;
      v17 = objc_autoreleasePoolPush();
      v18 = a1[6];
      v19 = HMFGetOSLogHandle();
      v20 = v19;
      if (v16)
      {
        if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
        {
          v21 = HMFGetLogIdentifier();
          v22 = [a1[7] UUID];
          v23 = [a1[4] uuid];
          *buf = 138544130;
          v46 = v21;
          v47 = 2112;
          v48 = v22;
          v49 = 2112;
          v50 = v23;
          v51 = 2112;
          v52 = v16;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to save userUniqueID for user: %@ with error: %@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v17);
        [a1[8] rejectWithError:v16];
      }

      else
      {
        if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
        {
          v40 = HMFGetLogIdentifier();
          v41 = [a1[7] UUID];
          v42 = [a1[4] uuid];
          *buf = 138544130;
          v46 = v40;
          v47 = 2112;
          v48 = v41;
          v49 = 2112;
          v50 = v42;
          v51 = 2112;
          v52 = v7;
          _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Successfully saved userUniqueID for user: %@ userUniqueID: %@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v17);
        [a1[8] fulfillWithValue:v7];
      }

      v6 = v7;
      goto LABEL_25;
    }

    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v36 = HMFGetLogIdentifier();
      v37 = [a1[7] UUID];
      v38 = [a1[4] uuid];
      *buf = 138543874;
      v46 = v36;
      v47 = 2112;
      v48 = v37;
      v49 = 2112;
      v50 = v38;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to create uniqueID for user: %@", buf, 0x20u);
    }

    v30 = v8;
LABEL_20:
    objc_autoreleasePoolPop(v30);
    v39 = a1[8];
    v6 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
    [v39 rejectWithError:v6];
    goto LABEL_25;
  }

  v31 = objc_autoreleasePoolPush();
  v32 = a1[6];
  v33 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
  {
    v34 = HMFGetLogIdentifier();
    v35 = [a1[7] UUID];
    *buf = 138543874;
    v46 = v34;
    v47 = 2112;
    v48 = v35;
    v49 = 2112;
    v50 = v6;
    _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Found existing userUniqueID: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v31);
  [a1[8] fulfillWithValue:v6];
LABEL_25:

  v43 = *MEMORY[0x277D85DE8];
}

- (id)uniqueIDsOfAllUsers
{
  v3 = [MEMORY[0x277CBEB18] array];
  v4 = [(HMDHome *)self backingStore];
  v5 = [v4 context];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke;
  v10[3] = &unk_27868A750;
  v10[4] = self;
  v6 = v3;
  v11 = v6;
  [v5 unsafeSynchronousBlock:v10];

  v7 = v11;
  v8 = v6;

  return v6;
}

void __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke(uint64_t a1)
{
  v22 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [HMCContext findHomeWithModelID:v2];

  if (v3)
  {
    v4 = [v3 homeMembers];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke_127;
    v16[3] = &unk_278677490;
    v5 = *(a1 + 40);
    v16[4] = *(a1 + 32);
    v17 = v5;
    [v4 hmf_enumerateWithAutoreleasePoolUsingBlock:v16];

    v6 = [v3 guestAccessCodes];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke_129;
    v14[3] = &unk_2786774B8;
    v7 = *(a1 + 40);
    v14[4] = *(a1 + 32);
    v15 = v7;
    [v6 hmf_enumerateWithAutoreleasePoolUsingBlock:v14];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = [*(a1 + 32) walletLogCategory];
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [*(a1 + 32) uuid];
      *buf = 138543618;
      v19 = v11;
      v20 = 2112;
      v21 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to find the mkfHome with UUID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke_127(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [v3 modelID];
    v9 = [v3 uniqueIDForAccessories];
    v14 = 138543874;
    v15 = v7;
    v16 = 2112;
    v17 = v8;
    v18 = 2112;
    v19 = v9;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@HomeMember: %@, uniqueID: %@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v10 = [v3 uniqueIDForAccessories];

  if (v10)
  {
    v11 = *(a1 + 40);
    v12 = [v3 uniqueIDForAccessories];
    [v11 addObject:v12];
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome_AccessoryUserIdentifier__uniqueIDsOfAllUsers__block_invoke_129(uint64_t a1, void *a2)
{
  v23 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [v3 label];
    v9 = [v3 accessCode];
    v10 = [v3 userUniqueIDForAccessories];
    v15 = 138544130;
    v16 = v7;
    v17 = 2112;
    v18 = v8;
    v19 = 2112;
    v20 = v9;
    v21 = 2112;
    v22 = v10;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Guest: %@: %@, uniqueID: %@", &v15, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v11 = [v3 userUniqueIDForAccessories];

  if (v11)
  {
    v12 = *(a1 + 40);
    v13 = [v3 userUniqueIDForAccessories];
    [v12 addObject:v13];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)removeGuestAccessCode:(id)a3 fromAccessory:(id)a4
{
  v21 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if ([v7 supportsCHIP])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = [(HMDHome *)self walletLogCategory];
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [v7 uuid];
      v17 = 138543618;
      v18 = v11;
      v19 = 2112;
      v20 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Not a matter accessory, cannot remove user from accessory: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  else
  {
    v14 = [(HMDHome *)self userUniqueIDForGuestAccessCode:v6];
    if (v14)
    {
      [(HMDHome *)self handleRemoveUserUniqueIdentifier:v14 fromAccessory:v7];
    }

    else
    {
      [MEMORY[0x277D0F7C0] futureWithNoValue];
    }
    v13 = ;
  }

  v15 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)userUniqueIDForGuestAccessCode:(id)a3
{
  v4 = a3;
  v13 = 0;
  v14 = &v13;
  v15 = 0x3032000000;
  v16 = __Block_byref_object_copy__93296;
  v17 = __Block_byref_object_dispose__93297;
  v18 = 0;
  v5 = [(HMDHome *)self backingStore];
  v6 = [v5 context];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __67__HMDHome_AccessoryUserIdentifier__userUniqueIDForGuestAccessCode___block_invoke;
  v10[3] = &unk_27868A4D8;
  v10[4] = self;
  v7 = v4;
  v11 = v7;
  v12 = &v13;
  [v6 unsafeSynchronousBlock:v10];

  v8 = v14[5];
  _Block_object_dispose(&v13, 8);

  return v8;
}

void __67__HMDHome_AccessoryUserIdentifier__userUniqueIDForGuestAccessCode___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = [HMDHomeAccessCodeModel alloc];
  v3 = [*(a1 + 32) uuid];
  v4 = [(HMDHomeAccessCodeModel *)v2 initWithHomeUUID:v3 value:*(a1 + 40) label:&stru_283CF9D50];

  v5 = [(HMDBackingStoreModelObject *)v4 uuid];
  v6 = [HMCContext findGuestAccessCodeWithModelID:v5];

  if (v6)
  {
    v7 = [v6 userUniqueIDForAccessories];
    v8 = *(*(a1 + 48) + 8);
    v9 = *(v8 + 40);
    *(v8 + 40) = v7;
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = [*(a1 + 32) walletLogCategory];
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 40);
      v16 = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = v14;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@MKFGuestAccessCode model not found, returning nil unique ID for accessCode: %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (id)findOrAddUserUniqueIDForGuestAccessCode:(id)a3 onAccessory:(id)a4
{
  v46 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = [(HMDHome *)self walletLogCategory];
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = [v7 uuid];
    *buf = 138543874;
    v41 = v11;
    v42 = 2112;
    v43 = v6;
    v44 = 2112;
    v45 = v12;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@findOrAddUserUniqueIDForGuestAccessCode: %@ onAccessory: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  if (([v7 supportsCHIP] & 1) == 0)
  {
    v17 = objc_autoreleasePoolPush();
    v18 = [(HMDHome *)self walletLogCategory];
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      v21 = [v7 uuid];
      *buf = 138543618;
      v41 = v20;
      v42 = 2112;
      v43 = v21;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Not a matter accessory, cannot find or add homeAccessCode on accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
    v22 = MEMORY[0x277D0F7C0];
    v23 = MEMORY[0x277CCA9B8];
    v24 = 5;
    goto LABEL_9;
  }

  v13 = [(HMDHome *)self userUniqueIDForGuestAccessCode:v6];
  if (!v13)
  {
    v25 = [(HMDHome *)self createUserUniqueIDForAccessories];
    v26 = objc_autoreleasePoolPush();
    v27 = [(HMDHome *)self walletLogCategory];
    v28 = HMFGetOSLogHandle();
    v29 = v28;
    if (v25)
    {
      if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543874;
        v41 = v30;
        v42 = 2112;
        v43 = v25;
        v44 = 2112;
        v45 = v6;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_INFO, "%{public}@Created uniqueIDForAccessories:%@ for guest access code: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v26);
      v31 = objc_alloc(MEMORY[0x277D0F7A8]);
      v32 = [(HMDHome *)self workQueue];
      v15 = [v31 initWithQueue:v32];

      v33 = [(HMDHome *)self saveUserUniqueID:v25 ForGuestAccessCode:v6];
      v37[0] = MEMORY[0x277D85DD0];
      v37[1] = 3221225472;
      v37[2] = __88__HMDHome_AccessoryUserIdentifier__findOrAddUserUniqueIDForGuestAccessCode_onAccessory___block_invoke;
      v37[3] = &unk_278685D58;
      v37[4] = self;
      v38 = v25;
      v39 = v7;
      v14 = v25;
      v16 = [v33 inContext:v15 then:v37 orRecover:&__block_literal_global_123];

      goto LABEL_14;
    }

    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      v36 = HMFGetLogIdentifier();
      *buf = 138543618;
      v41 = v36;
      v42 = 2112;
      v43 = v6;
      _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Failed to create uniqueID for guest access code: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v26);
    v22 = MEMORY[0x277D0F7C0];
    v23 = MEMORY[0x277CCA9B8];
    v24 = 15;
LABEL_9:
    v14 = [v23 hmfErrorWithCode:v24];
    v16 = [v22 futureWithError:v14];
    goto LABEL_15;
  }

  v14 = v13;
  v15 = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
  v16 = [(HMDHome *)self handleFindOrAddUserUniqueIdentifier:v14 onAccessory:v7 flow:v15];
LABEL_14:

LABEL_15:
  v34 = *MEMORY[0x277D85DE8];

  return v16;
}

uint64_t __88__HMDHome_AccessoryUserIdentifier__findOrAddUserUniqueIDForGuestAccessCode_onAccessory___block_invoke(void *a1, void *a2)
{
  v3 = a2;
  v4 = a1[4];
  v5 = a1[5];
  v6 = a1[6];
  v7 = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
  v8 = [v4 handleFindOrAddUserUniqueIdentifier:v5 onAccessory:v6 flow:v7];
  if (v8)
  {
    v9 = v8;

    return 3;
  }

  else
  {
    v11 = _HMFPreconditionFailure();
    return __88__HMDHome_AccessoryUserIdentifier__findOrAddUserUniqueIDForGuestAccessCode_onAccessory___block_invoke_2(v11);
  }
}

uint64_t __88__HMDHome_AccessoryUserIdentifier__findOrAddUserUniqueIDForGuestAccessCode_onAccessory___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [MEMORY[0x277D0F7C0] futureWithError:v2];
  if (v3)
  {
    v4 = v3;

    return 3;
  }

  else
  {
    v6 = _HMFPreconditionFailure();
    return [(HMDHome *)v6 removeUser:v7 fromAccessory:v8, v9];
  }
}

- (id)removeUser:(id)a3 fromAccessory:(id)a4
{
  v34 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = [(HMDHome *)self walletLogCategory];
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = [v6 uuid];
    v13 = [v7 uuid];
    v28 = 138543874;
    v29 = v11;
    v30 = 2112;
    v31 = v12;
    v32 = 2112;
    v33 = v13;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Removing user from matter accessory. user: %@, accessory: %@", &v28, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  if ([v7 supportsCHIP])
  {
    v14 = [v6 uniqueIDForAccessories];
    if (v14)
    {
      v15 = [(HMDHome *)self handleRemoveUserUniqueIdentifier:v14 fromAccessory:v7];
    }

    else
    {
      v22 = objc_autoreleasePoolPush();
      v23 = [(HMDHome *)self walletLogCategory];
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v25 = HMFGetLogIdentifier();
        v28 = 138543362;
        v29 = v25;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_INFO, "%{public}@User does not have uniqueIDForAccessories, so nothing to do", &v28, 0xCu);
      }

      objc_autoreleasePoolPop(v22);
      v15 = [MEMORY[0x277D0F7C0] futureWithNoValue];
    }

    v21 = v15;
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = [(HMDHome *)self walletLogCategory];
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v7 uuid];
      v28 = 138543618;
      v29 = v19;
      v30 = 2112;
      v31 = v20;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Not a matter accessory, cannot remove user from accessory: %@", &v28, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v21 = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v26 = *MEMORY[0x277D85DE8];

  return v21;
}

- (id)removeUserFromMatterAccessories:(id)a3
{
  v4 = a3;
  v5 = MEMORY[0x277D0F7C0];
  v6 = [(HMDHome *)self matterAccessories];
  v11 = MEMORY[0x277D85DD0];
  v12 = 3221225472;
  v13 = __68__HMDHome_AccessoryUserIdentifier__removeUserFromMatterAccessories___block_invoke;
  v14 = &unk_278677468;
  v15 = self;
  v16 = v4;
  v7 = v4;
  v8 = [v6 na_map:&v11];
  v9 = [v5 allSettled:{v8, v11, v12, v13, v14, v15}];

  return v9;
}

id __68__HMDHome_AccessoryUserIdentifier__removeUserFromMatterAccessories___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  if (v5)
  {
    v6 = [*(a1 + 32) removeUser:*(a1 + 40) fromAccessory:v5];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (id)removeUsersFromAccessory:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 supportsCHIP])
  {
    v5 = objc_alloc(MEMORY[0x277D0F7A8]);
    v6 = [(HMDHome *)self workQueue];
    v7 = [v5 initWithQueue:v6];

    v8 = [MEMORY[0x277D0F7B8] untrackedPlaceholderFlow];
    v9 = [v4 waitForDoorLockClusterObjectWithFlow:v8];
    v10 = [v9 inContext:v7 then:&__block_literal_global_116];
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __61__HMDHome_AccessoryUserIdentifier__removeUsersFromAccessory___block_invoke_2;
    v21[3] = &unk_2786882A0;
    v21[4] = self;
    v22 = v4;
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __61__HMDHome_AccessoryUserIdentifier__removeUsersFromAccessory___block_invoke_118;
    v19[3] = &unk_2786882F0;
    v19[4] = self;
    v20 = v22;
    v11 = [v10 inContext:v7 then:v21 orRecover:v19];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = [(HMDHome *)self walletLogCategory];
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v4 uuid];
      *buf = 138543618;
      v24 = v15;
      v25 = 2112;
      v26 = v16;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@Not a matter accessory, cannot remove user from accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = [MEMORY[0x277D0F7C0] futureWithNoValue];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

uint64_t __61__HMDHome_AccessoryUserIdentifier__removeUsersFromAccessory___block_invoke_2(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) uuid];
    v11 = 138543618;
    v12 = v7;
    v13 = 2112;
    v14 = v8;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Successfully removed all users from Accessory: %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
  return 1;
}

uint64_t __61__HMDHome_AccessoryUserIdentifier__removeUsersFromAccessory___block_invoke_118(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = [*(a1 + 32) walletLogCategory];
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) uuid];
    v14 = 138543874;
    v15 = v7;
    v16 = 2112;
    v17 = v8;
    v18 = 2112;
    v19 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove all users from Accessory: %@ with error: %@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = v3;
  v10 = v9;
  if (v9)
  {
    v11 = v9;
  }

  else
  {
    [MEMORY[0x277CCA9B8] hmfUnspecifiedError];
    objc_claimAutoreleasedReturnValue();
  }

  v12 = *MEMORY[0x277D85DE8];
  return 2;
}

uint64_t __61__HMDHome_AccessoryUserIdentifier__removeUsersFromAccessory___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 removeAllUsers];
  v4 = [v3 timeout:15.0];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return [(HMDHome *)v7 auditOrAddRestrictedGuest:v8 onAccessory:v9 flow:v10, v11];
  }
}

- (id)auditOrAddRestrictedGuest:(id)a3 onAccessory:(id)a4 flow:(id)a5
{
  v40 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if ([v9 supportsCHIP])
  {
    if ([v8 isRestrictedGuest])
    {
      v11 = objc_alloc(MEMORY[0x277D0F7A8]);
      v12 = [(HMDHome *)self workQueue];
      v13 = [v11 initWithQueue:v12];

      v14 = [(HMDHome *)self getOrCreateUniqueIDForAccessoriesForUser:v8 flow:v10];
      v28[0] = MEMORY[0x277D85DD0];
      v28[1] = 3221225472;
      v28[2] = __79__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuest_onAccessory_flow___block_invoke;
      v28[3] = &unk_27867C338;
      v28[4] = self;
      v29 = v9;
      v30 = v8;
      v31 = v10;
      v15 = [v14 inContext:v13 then:v28 orRecover:&__block_literal_global_112_93314];

      goto LABEL_10;
    }

    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v23 = [v10 UUID];
      v24 = [v8 uuid];
      *buf = 138543874;
      v33 = v19;
      v34 = 2112;
      v35 = v23;
      v36 = 2112;
      v37 = v24;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Not a restricted guest %@", buf, 0x20u);

      goto LABEL_8;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v10 UUID];
      v21 = [v9 uuid];
      [v9 supportsCHIP];
      v22 = HMFBooleanToString();
      *buf = 138544130;
      v33 = v19;
      v34 = 2112;
      v35 = v20;
      v36 = 2112;
      v37 = v21;
      v38 = 2112;
      v39 = v22;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Not a matter accessory, cannot find or add user on accessory: %@, supportsCHIP: %@", buf, 0x2Au);

LABEL_8:
    }
  }

  objc_autoreleasePoolPop(v16);
  v25 = MEMORY[0x277D0F7C0];
  v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:5];
  v15 = [v25 futureWithError:v13];
LABEL_10:

  v26 = *MEMORY[0x277D85DE8];

  return v15;
}

uint64_t __79__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuest_onAccessory_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) auditOrAddRestrictedGuestUserUniqueIdentifier:v3 onAccessory:*(a1 + 40) user:*(a1 + 48) requireFullScheduleAudit:1 flow:*(a1 + 56)];
  if (v4)
  {
    v5 = v4;

    return 3;
  }

  else
  {
    v7 = _HMFPreconditionFailure();
    return __79__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuest_onAccessory_flow___block_invoke_2(v7);
  }
}

uint64_t __79__HMDHome_AccessoryUserIdentifier__auditOrAddRestrictedGuest_onAccessory_flow___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [MEMORY[0x277D0F7C0] futureWithError:v2];
  if (v3)
  {
    v4 = v3;

    return 3;
  }

  else
  {
    v6 = _HMFPreconditionFailure();
    return [(HMDHome *)v6 findOrAddUser:v7 onAccessory:v8 didRedispatch:v9 flow:v10, v11];
  }
}

- (id)findOrAddUser:(id)a3 onAccessory:(id)a4 didRedispatch:(BOOL)a5 flow:(id)a6
{
  v52 = *MEMORY[0x277D85DE8];
  v9 = a3;
  v10 = a4;
  v11 = a6;
  v12 = objc_autoreleasePoolPush();
  v13 = self;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    v16 = [v11 UUID];
    [v9 uuid];
    v36 = v11;
    v18 = v17 = v9;
    v19 = [v10 uuid];
    v20 = HMFBooleanToString();
    *buf = 138544386;
    v43 = v15;
    v44 = 2112;
    v45 = v16;
    v46 = 2112;
    v47 = v18;
    v48 = 2112;
    v49 = v19;
    v50 = 2112;
    v51 = v20;
    _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] findOrAddUser: %@ onAccessory: %@, didRedispatch: %@", buf, 0x34u);

    v9 = v17;
    v11 = v36;
  }

  objc_autoreleasePoolPop(v12);
  if ([v10 supportsCHIP])
  {
    v21 = objc_alloc(MEMORY[0x277D0F7A8]);
    v22 = [(HMDHome *)v13 workQueue];
    v23 = [v21 initWithQueue:v22];

    v24 = [(HMDHome *)v13 getOrCreateUniqueIDForAccessoriesForUser:v9 flow:v11];
    v37[0] = MEMORY[0x277D85DD0];
    v37[1] = 3221225472;
    v37[2] = __81__HMDHome_AccessoryUserIdentifier__findOrAddUser_onAccessory_didRedispatch_flow___block_invoke;
    v37[3] = &unk_27867C338;
    v38 = v9;
    v39 = v13;
    v40 = v10;
    v41 = v11;
    v25 = [v24 inContext:v23 then:v37 orRecover:&__block_literal_global_110_93318];
  }

  else
  {
    v26 = objc_autoreleasePoolPush();
    v27 = v13;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      v29 = HMFGetLogIdentifier();
      v30 = [v11 UUID];
      v31 = [v10 uuid];
      [v10 supportsCHIP];
      v32 = HMFBooleanToString();
      *buf = 138544130;
      v43 = v29;
      v44 = 2112;
      v45 = v30;
      v46 = 2112;
      v47 = v31;
      v48 = 2112;
      v49 = v32;
      _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Not a matter accessory, cannot find or add user on accessory: %@, supportsCHIP: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v26);
    v33 = MEMORY[0x277D0F7C0];
    v23 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:5];
    v25 = [v33 futureWithError:v23];
  }

  v34 = *MEMORY[0x277D85DE8];

  return v25;
}

uint64_t __81__HMDHome_AccessoryUserIdentifier__findOrAddUser_onAccessory_didRedispatch_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) isRestrictedGuest];
  v5 = *(a1 + 40);
  v6 = *(a1 + 48);
  if (v4)
  {
    [v5 auditOrAddRestrictedGuestUserUniqueIdentifier:v3 onAccessory:v6 user:*(a1 + 32) requireFullScheduleAudit:0 flow:*(a1 + 56)];
  }

  else
  {
    [v5 handleFindOrAddUserUniqueIdentifier:v3 onAccessory:v6 flow:*(a1 + 56)];
  }
  v7 = ;
  if (v7)
  {
    v8 = v7;

    return 3;
  }

  else
  {
    v10 = _HMFPreconditionFailure();
    return __81__HMDHome_AccessoryUserIdentifier__findOrAddUser_onAccessory_didRedispatch_flow___block_invoke_2(v10);
  }
}

uint64_t __81__HMDHome_AccessoryUserIdentifier__findOrAddUser_onAccessory_didRedispatch_flow___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [MEMORY[0x277D0F7C0] futureWithError:v2];
  if (v3)
  {
    v4 = v3;

    return 3;
  }

  else
  {
    v6 = _HMFPreconditionFailure();
    return [(HMDHome *)v6 findOrAddUser:v7 onAccessory:v8 flow:v9, v10];
  }
}

- (id)findOrAddUserIndexForUserUUID:(id)a3 guestName:(id)a4 accessory:(id)a5 flow:(id)a6
{
  v58 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v14 = objc_autoreleasePoolPush();
  v15 = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    v17 = HMFGetLogIdentifier();
    v18 = [v13 UUID];
    v19 = [v12 uuid];
    *buf = 138544386;
    v49 = v17;
    v50 = 2112;
    v51 = v18;
    v52 = 2112;
    v53 = v10;
    v54 = 2112;
    v55 = v11;
    v56 = 2112;
    v57 = v19;
    _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] findOrAddUserIndexForUserUUID: %@ guestName: %@, accessory: %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v14);
  if (v10 | v11)
  {
    if (v10)
    {
      v20 = [(HMDHome *)v15 userWithUUID:v10];
      if (!v20)
      {
        v33 = objc_autoreleasePoolPush();
        v34 = v15;
        v35 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
        {
          v36 = HMFGetLogIdentifier();
          *buf = 138543618;
          v49 = v36;
          v50 = 2112;
          v51 = v10;
          _os_log_impl(&dword_229538000, v35, OS_LOG_TYPE_ERROR, "%{public}@Failed to findOrAddUserIndexForUserUUID because could not find user in home with UUID: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v33);
        v37 = MEMORY[0x277D2C900];
        v21 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
        v23 = [v37 futureWithError:v21];
        goto LABEL_15;
      }

      v21 = [(HMDHome *)v15 findOrAddUser:v20 onAccessory:v12 flow:v13];
      v22 = [v21 naFuture];
      v44[0] = MEMORY[0x277D85DD0];
      v44[1] = 3221225472;
      v44[2] = __91__HMDHome_AccessoryUserIdentifier__findOrAddUserIndexForUserUUID_guestName_accessory_flow___block_invoke;
      v44[3] = &unk_278683340;
      v44[4] = v15;
      v45 = v13;
      v46 = v20;
      v47 = v12;
      v23 = [v22 addFailureBlock:v44];

      v24 = v45;
    }

    else
    {
      v31 = [(HMDHome *)v15 labelsByAccessCode];
      v32 = [v31 firstKeyWithValue:v11];

      v20 = [(HMDHome *)v15 findOrAddUserUniqueIDForGuestAccessCode:v32 onAccessory:v12];
      v21 = [v20 naFuture];
      v40[0] = MEMORY[0x277D85DD0];
      v40[1] = 3221225472;
      v40[2] = __91__HMDHome_AccessoryUserIdentifier__findOrAddUserIndexForUserUUID_guestName_accessory_flow___block_invoke_104;
      v40[3] = &unk_278683340;
      v40[4] = v15;
      v41 = v13;
      v42 = v32;
      v43 = v12;
      v22 = v32;
      v23 = [v21 addFailureBlock:v40];

      v24 = v41;
    }

LABEL_15:
    goto LABEL_16;
  }

  v25 = objc_autoreleasePoolPush();
  v26 = v15;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
  {
    v28 = HMFGetLogIdentifier();
    v29 = [v13 UUID];
    *buf = 138543618;
    v49 = v28;
    v50 = 2112;
    v51 = v29;
    _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Both userUUID and guestName are nil, this is a bug", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v25);
  v30 = MEMORY[0x277D2C900];
  v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
  v23 = [v30 futureWithError:v20];
LABEL_16:

  v38 = *MEMORY[0x277D85DE8];

  return v23;
}

void __91__HMDHome_AccessoryUserIdentifier__findOrAddUserIndexForUserUUID_guestName_accessory_flow___block_invoke(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v9 = *(a1 + 48);
    v10 = *(a1 + 56);
    v12 = 138544130;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find or add userIndex for user: %@, on accessory: %@", &v12, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
}

void __91__HMDHome_AccessoryUserIdentifier__findOrAddUserIndexForUserUUID_guestName_accessory_flow___block_invoke_104(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v9 = *(a1 + 48);
    v10 = *(a1 + 56);
    v12 = 138544130;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2112;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@[Flow: %@] Failed to find or add userIndex for guest access code: %@, on accessory: %@", &v12, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
}

- (id)findUserIndexForUserUUID:(id)a3 guestName:(id)a4 accessory:(id)a5
{
  v37 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_autoreleasePoolPush();
  v12 = [(HMDHome *)self walletLogCategory];
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = [v10 uuid];
    v29 = 138544130;
    v30 = v14;
    v31 = 2112;
    v32 = v8;
    v33 = 2112;
    v34 = v9;
    v35 = 2112;
    v36 = v15;
    _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@findUserIndexForUserUUID: %@ guestName: %@, accessory: %@", &v29, 0x2Au);
  }

  objc_autoreleasePoolPop(v11);
  if (v9)
  {
    v16 = [(HMDHome *)self labelsByAccessCode];
    v17 = [v16 firstKeyWithValue:v9];

    [(HMDHome *)self userUniqueIDForGuestAccessCode:v17];
  }

  else
  {
    v17 = [(HMDHome *)self userWithUUID:v8];
    [v17 uniqueIDForAccessories];
  }
  v18 = ;

  if (v18)
  {
    v19 = [(HMDHome *)self findUserSlotForUserUniqueIdentifier:v18 onAccessory:v10];
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    v21 = [(HMDHome *)self walletLogCategory];
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      v24 = [v10 uuid];
      v29 = 138544130;
      v30 = v23;
      v31 = 2112;
      v32 = v8;
      v33 = 2112;
      v34 = v9;
      v35 = 2112;
      v36 = v24;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_ERROR, "%{public}@Failed to find userUniqueID for user: %@, guest: %@, accessory: %@", &v29, 0x2Au);
    }

    objc_autoreleasePoolPop(v20);
    v25 = MEMORY[0x277D2C900];
    v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v19 = [v25 futureWithError:v26];
  }

  v27 = *MEMORY[0x277D85DE8];

  return v19;
}

- (id)accessCodeForMatterUserWithUserUniqueID:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = [(HMDHome *)self walletLogCategory];
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [(HMDHome *)self uniqueIDsOfAllUsers];
    *buf = 138543618;
    v25 = v8;
    v26 = 2112;
    v27 = v9;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@uniqueIDsOfAllUsers: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = &stru_283CF9D50;
  if (v4)
  {
    v11 = [(HMDHome *)self users];
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __76__HMDHome_AccessoryUserIdentifier__accessCodeForMatterUserWithUserUniqueID___block_invoke;
    v22[3] = &unk_278688680;
    v12 = v4;
    v23 = v12;
    v13 = [v11 na_firstObjectPassingTest:v22];

    if (v13)
    {
      v10 = [v13 accessCode];
    }

    else
    {
      v14 = [(HMDHome *)self labelsByAccessCode];
      v19[0] = MEMORY[0x277D85DD0];
      v19[1] = 3221225472;
      v19[2] = __76__HMDHome_AccessoryUserIdentifier__accessCodeForMatterUserWithUserUniqueID___block_invoke_2;
      v19[3] = &unk_278677420;
      v20 = v12;
      v21 = self;
      v15 = [v14 na_firstKeyPassingTest:v19];

      if (v15)
      {
        v16 = v15;
      }

      else
      {
        v16 = &stru_283CF9D50;
      }

      v10 = v16;
    }
  }

  v17 = *MEMORY[0x277D85DE8];

  return v10;
}

uint64_t __76__HMDHome_AccessoryUserIdentifier__accessCodeForMatterUserWithUserUniqueID___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uniqueIDForAccessories];
  v4 = [v3 isEqualToNumber:*(a1 + 32)];

  return v4;
}

uint64_t __76__HMDHome_AccessoryUserIdentifier__accessCodeForMatterUserWithUserUniqueID___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) userUniqueIDForGuestAccessCode:a2];
  v4 = HMFEqualObjects();

  return v4;
}

+ (id)createUserUniqueIDForAccessoriesWithoutDuplicatingExistingIDs:(id)a3
{
  v3 = a3;
  v4 = 0;
  do
  {
    v5 = arc4random_uniform(0xFFFFFFFF);
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __98__HMDHome_AccessoryUserIdentifier__createUserUniqueIDForAccessoriesWithoutDuplicatingExistingIDs___block_invoke;
    v10[3] = &__block_descriptor_36_e18_B16__0__NSNumber_8l;
    v11 = v5;
    v6 = (v5 == 0) | [v3 na_any:v10];
    if ((v6 & 1) == 0)
    {
      break;
    }
  }

  while (v4++ < 9);
  if (v6)
  {
    v8 = 0;
  }

  else
  {
    v8 = [MEMORY[0x277CCABB0] numberWithUnsignedLong:v5];
  }

  return v8;
}

- (HMDAccessoryCount)accessoryCount
{
  v2 = [[HMDAccessoryCount alloc] initWithHome:self];

  return v2;
}

- (id)createSiriEndpointProfileMessageHandlerWithHomeUUID:(id)a3
{
  v3 = a3;
  v4 = [[HMDSiriEndpointProfileMessageHandler alloc] initWithHomeUUID:v3];

  return v4;
}

- (id)createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:(id)a3
{
  v3 = a3;
  v4 = [[HMDPrimaryResidentMessageRouterMetricsDispatcher alloc] initWithLogEventSubmitter:v3];

  return v4;
}

- (void)_reconfigureAccessoriesOnRouterRemovalWithCompletion:(id)a3
{
  v46 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [(HMDHome *)self accessories];
  v7 = [v6 hmf_objectsPassingTest:&__block_literal_global_2];

  if ([v7 count])
  {
    v8 = [(HMDHome *)self activeNetworkRouterAccessory];
    v9 = [v8 networkRouterController];
    v10 = [v9 wiFiSSID];

    v11 = [HMDWiFiManagementController sharedPSKForNetworkWithSSID:v10];
    v12 = v11;
    v32 = v10;
    if (v10 && v11)
    {
      block = v4;
      v31 = v11;
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543874;
        v41 = v16;
        v42 = 2048;
        v43 = [v7 count];
        v44 = 2112;
        v45 = v32;
        _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Reconfiguring %ld accessories on '%@' due to router removal", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
      v17 = dispatch_group_create();
      v35 = 0u;
      v36 = 0u;
      v37 = 0u;
      v38 = 0u;
      v18 = v7;
      v19 = [v18 countByEnumeratingWithState:&v35 objects:v39 count:16];
      if (v19)
      {
        v20 = v19;
        v21 = *v36;
        do
        {
          for (i = 0; i != v20; ++i)
          {
            if (*v36 != v21)
            {
              objc_enumerationMutation(v18);
            }

            v23 = *(*(&v35 + 1) + 8 * i);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v24 = v23;
            }

            else
            {
              v24 = 0;
            }

            v25 = v24;

            v26 = [v25 wiFiManagementController];

            if (v26)
            {
              dispatch_group_enter(v17);
              v27 = objc_alloc_init(HMDWiFiReconfigurationLogEvent);
              [(HMDWiFiReconfigurationLogEvent *)v27 setCredentialType:2];
              v33[0] = MEMORY[0x277D85DD0];
              v33[1] = 3221225472;
              v33[2] = __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke_5;
              v33[3] = &unk_27868A1D8;
              v33[4] = v23;
              v34 = v17;
              [v26 reconfigureWithSSID:v32 PSK:v31 logEvent:v27 completion:v33];
            }
          }

          v20 = [v18 countByEnumeratingWithState:&v35 objects:v39 count:16];
        }

        while (v20);
      }

      v28 = [(HMDHome *)v14 workQueue];
      v4 = block;
      dispatch_group_notify(v17, v28, block);

      v12 = v31;
    }

    else
    {
      v4[2](v4);
    }
  }

  else
  {
    v4[2](v4);
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke_5(uint64_t a1, uint64_t a2)
{
  [*(a1 + 32) saveWiFiUniquePreSharedKey:0 credentialType:2 * (a2 == 0)];
  v3 = *(a1 + 40);

  dispatch_group_leave(v3);
}

uint64_t __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 wiFiCredentialType] == 3)
  {
    v3 = isReconfigurationPossible(v2);
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (NSArray)accessoriesRequiringManualReconfigurationOnRouterRemoval
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 hmf_objectsPassingTest:&__block_literal_global_115476];

  return v3;
}

uint64_t __83__HMDHome_WiFiManagement__accessoriesRequiringManualReconfigurationOnRouterRemoval__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 wiFiCredentialType] == 3)
  {
    v3 = isReconfigurationPossible(v2) ^ 1;
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)playbackArchiveWithSessionIdentifier:(id)a3
{
  v39 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self actionSets];
  v6 = [(HMDHome *)self triggerOwnedActionSets];
  v7 = [v5 arrayByAddingObjectsFromArray:v6];

  v35 = 0u;
  v36 = 0u;
  v33 = 0u;
  v34 = 0u;
  v8 = v7;
  v26 = [v8 countByEnumeratingWithState:&v33 objects:v38 count:16];
  if (v26)
  {
    v9 = *v34;
    v28 = v8;
    v25 = *v34;
    do
    {
      v10 = 0;
      do
      {
        if (*v34 != v9)
        {
          objc_enumerationMutation(v8);
        }

        v27 = v10;
        v11 = *(*(&v33 + 1) + 8 * v10);
        v29 = 0u;
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v12 = [v11 actions];
        v13 = [v12 countByEnumeratingWithState:&v29 objects:v37 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v30;
          while (2)
          {
            for (i = 0; i != v14; ++i)
            {
              if (*v30 != v15)
              {
                objc_enumerationMutation(v12);
              }

              v17 = *(*(&v29 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v18 = v17;
              }

              else
              {
                v18 = 0;
              }

              v19 = v18;

              v20 = [v19 playbackArchive];
              v21 = [v20 playbackSessionIdentifier];
              v22 = [v21 isEqualToString:v4];

              if (v22)
              {

                v8 = v28;
                goto LABEL_22;
              }
            }

            v14 = [v12 countByEnumeratingWithState:&v29 objects:v37 count:16];
            if (v14)
            {
              continue;
            }

            break;
          }
        }

        v10 = v27 + 1;
        v8 = v28;
        v9 = v25;
      }

      while (v27 + 1 != v26);
      v20 = 0;
      v26 = [v28 countByEnumeratingWithState:&v33 objects:v38 count:16];
    }

    while (v26);
  }

  else
  {
    v20 = 0;
  }

LABEL_22:

  v23 = *MEMORY[0x277D85DE8];

  return v20;
}

- (id)createAccessorySettingsMessengerWithMessageTargetUUID:(id)a3 messageDispatcher:(id)a4 messageRouter:(id)a5 messageHandler:(id)a6 logEventSubmitter:(id)a7
{
  v34 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v17 = objc_autoreleasePoolPush();
  v18 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v24 = 138544386;
    v25 = v20;
    v26 = 2112;
    v27 = v12;
    v28 = 2112;
    v29 = v13;
    v30 = 2112;
    v31 = v14;
    v32 = 2112;
    v33 = v15;
    _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_INFO, "%{public}@Creating accessory settings messenger with message target UUID: %@ message dispatcher: %@ message router: %@ message handler: %@", &v24, 0x34u);
  }

  objc_autoreleasePoolPop(v17);
  v21 = [[HMDAccessorySettingsMessenger alloc] initWithMessageTargetUUID:v12 messageDispatcher:v13 messageRouter:v14 messageHandler:v15 logEventSubmitter:v16];

  v22 = *MEMORY[0x277D85DE8];

  return v21;
}

- (void)configureAccessorySettingsMessengerWithMessengerFactory:(id)a3 messageHandlerFactory:(id)a4
{
  v26 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v24 = 138543362;
    v25 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring accessory settings messenger", &v24, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [(HMDHome *)v9 msgDispatcher];
  v13 = [(HMDHome *)v9 accessoryMessageRouterViaPrimary];
  v14 = [(HMDHome *)v9 unifiedLanguageValueListSettingDataProvider];
  if (!v12)
  {
    _HMFPreconditionFailure();
    goto LABEL_8;
  }

  if (!v13)
  {
LABEL_8:
    _HMFPreconditionFailure();
LABEL_9:
    _HMFPreconditionFailure();
  }

  v15 = v14;
  if (!v14)
  {
    goto LABEL_9;
  }

  v16 = [(HMDHome *)v9 uuid];
  v17 = [v7 createAccessorySettingsLocalMessageHandlerWithHomeUUID:v16 languageValuesDataProvider:v15];

  [v17 setDataSource:v9];
  v18 = [(HMDHome *)v9 homeManager];
  v19 = [v18 compositeSettingsControllerManager];
  [v17 setDelegate:v19];

  v20 = [(HMDHome *)v9 accessorySettingsMessengerMessageTargetUUID];
  v21 = [(HMDHome *)v9 logEventSubmitter];
  v22 = [v6 createAccessorySettingsMessengerWithMessageTargetUUID:v20 messageDispatcher:v12 messageRouter:v13 messageHandler:v17 logEventSubmitter:v21];

  [v22 registerForMessagesWithHome:v9];
  [(HMDHome *)v9 setAccessorySettingsMessenger:v22];

  v23 = *MEMORY[0x277D85DE8];
}

- (id)accessorySettingsMessengerMessageTargetUUID
{
  v2 = MEMORY[0x277CD17B0];
  v3 = [(HMDHome *)self uuid];
  v4 = [v2 messageTargetUUIDWithHomeUUID:v3];

  return v4;
}

- (BOOL)_deviceEligibleForDarkPoll
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self featuresDataSource];
  v4 = [v3 isWakeOnLanV2Enabled];

  if (!v4)
  {
    goto LABEL_11;
  }

  if (![(HMDHome *)self isCurrentDevicePrimaryResident])
  {
    if (![(HMDHome *)self hasAnyResident]&& [(HMDHome *)self homeLocation]== 1)
    {
      v5 = objc_autoreleasePoolPush();
      v11 = self;
      v7 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
      {
        goto LABEL_6;
      }

      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      v9 = "%{public}@[LPM] Device at home, and no residents in home";
      goto LABEL_5;
    }

LABEL_11:
    result = 0;
    goto LABEL_12;
  }

  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    v13 = 138543362;
    v14 = v8;
    v9 = "%{public}@[LPM] Device is primary resident";
LABEL_5:
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, v9, &v13, 0xCu);
  }

LABEL_6:

  objc_autoreleasePoolPop(v5);
  result = 1;
LABEL_12:
  v12 = *MEMORY[0x277D85DE8];
  return result;
}

- (id)hubAccessories
{
  v2 = [(HMDHome *)self appleMediaAccessories];
  v3 = [v2 na_filter:&__block_literal_global_156625];

  return v3;
}

- (id)createAppleMediaAccessoriesStateMessengerWithIdentifier:(id)a3 messageDispatcher:(id)a4
{
  v5 = a4;
  v6 = a3;
  v7 = [[HMDAppleMediaAccessoriesStateMessenger alloc] initWithIdentifier:v6 messageDispatcher:v5];

  return v7;
}

- (BOOL)isCarPlayAccessAllowedForActionSet:(id)a3 withMessage:(id)a4 fromSource:(unint64_t)a5
{
  v21 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  if (([(HMDHome *)self isMessageEntitledForCarPlayAccess:v9 source:a5]& 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *v18 = 138543874;
      *&v18[4] = v15;
      *&v18[12] = 2112;
      *&v18[14] = v8;
      *&v18[22] = 2048;
      v19 = a5;
      _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_INFO, "%{public}@CarPlay access is not allowed for action set: %@ because message from source: %lu does not have sufficient entitlements", v18, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
    goto LABEL_9;
  }

  if (self)
  {
    if ([(HMDHome *)self homeLocation]== 1 || [(HMDHome *)self homeLocation]== 3)
    {
      v10 = [v8 actions];
      v11 = [v10 na_filter:&__block_literal_global_160225];

      *v18 = MEMORY[0x277D85DD0];
      *&v18[8] = 3221225472;
      *&v18[16] = __55__HMDHome_CarPlay__isActionSetAllowedForCarPlayAccess___block_invoke_2;
      v19 = &unk_27867C048;
      v20 = self;
      LOBYTE(self) = [v11 na_all:v18];

      goto LABEL_10;
    }

LABEL_9:
    LOBYTE(self) = 0;
  }

LABEL_10:

  v16 = *MEMORY[0x277D85DE8];
  return self;
}

- (uint64_t)isMessageEntitledForCarPlayAccess:(uint64_t)a3 source:
{
  v5 = a2;
  v6 = v5;
  if (!a1)
  {
    goto LABEL_5;
  }

  if (a3 != 1)
  {
    if ([v5 isEntitledForSecureAccess])
    {
      a3 = [v6 isEntitledForSPIAccess];
      goto LABEL_6;
    }

LABEL_5:
    a3 = 0;
  }

LABEL_6:

  return a3;
}

uint64_t __55__HMDHome_CarPlay__isActionSetAllowedForCarPlayAccess___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = v3;
  if (v2 && ![v3 type])
  {
    v6 = v4;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = v6;
    }

    else
    {
      v7 = 0;
    }

    v8 = v7;

    if (v8)
    {
      v9 = [v8 characteristic];
      v5 = [HMDHome isCharacteristicAllowedForCarPlayAccess:v9];
    }

    else
    {
      v5 = 0;
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (uint64_t)isCharacteristicAllowedForCarPlayAccess:(void *)a1
{
  v1 = [a1 service];
  v2 = [v1 serviceType];

  if ([v2 isEqualToString:*MEMORY[0x277CD0E58]])
  {
    v3 = 1;
  }

  else
  {
    v3 = [v2 isEqualToString:*MEMORY[0x277CD0EB0]];
  }

  return v3;
}

- (BOOL)isCarPlayAccessAllowedForCharacteristic:(id)a3 withMessage:(id)a4 fromSource:(unint64_t)a5
{
  v23 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  if (([(HMDHome *)self isMessageEntitledForCarPlayAccess:v9 source:a5]& 1) == 0)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v17 = 138543874;
      v18 = v14;
      v19 = 2112;
      v20 = v8;
      v21 = 2048;
      v22 = a5;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_INFO, "%{public}@CarPlay access is not allowed for characteristic: %@ because message from source: %lu does not have sufficient entitlements", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    goto LABEL_9;
  }

  if (!self || [(HMDHome *)self homeLocation]!= 1 && [(HMDHome *)self homeLocation]!= 3)
  {
LABEL_9:
    v10 = 0;
    goto LABEL_10;
  }

  v10 = [HMDHome isCharacteristicAllowedForCarPlayAccess:v8];
LABEL_10:

  v15 = *MEMORY[0x277D85DE8];
  return v10;
}

- (BOOL)synchronouslyFetchIsConnectedToCarPlayNetwork
{
  v2 = [(HMDHome *)self carPlayDataSource];
  v3 = [v2 synchronouslyFetchIsConnectedToCarPlayNetwork];

  return v3;
}

- (BOOL)synchronouslyFetchIsCarPlayConnectedStatus
{
  v2 = [(HMDHome *)self carPlayDataSource];
  v3 = [v2 synchronouslyFetchIsCarPlayConnectedStatus];

  return v3;
}

- (void)_didOnboardHindsightChanged
{
  v11 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self didOnboardEventLog])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v6;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Clearing notification observer because we onboarded", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v7 = [(HMDHome *)v4 notificationCenter];
    [v7 removeObserver:v4 name:@"HMDHomeManagerDidUpdateApplicationData" object:0];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_fixupHindsightOnboarding
{
  v16 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self didOnboardEventLog])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG))
    {
      v6 = HMFGetLogIdentifier();
      v14 = 138543362;
      v15 = v6;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEBUG, "%{public}@[Hindsight] Skipping hindsight fixup, we're already onboarded", &v14, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  else
  {
    v7 = [(HMDHome *)self homeManager];
    if (v7)
    {
      v8 = [(HMDHome *)self notificationCenter];
      [v8 addObserver:self selector:sel__homeManagerAppDataChanged_ name:@"HMDHomeManagerDidUpdateApplicationData" object:0];

      [(HMDHome *)self _checkHomeManagerAppData:v7];
    }

    else
    {
      v9 = objc_autoreleasePoolPush();
      v10 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        v14 = 138543362;
        v15 = v12;
        _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] No home manager?", &v14, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_checkHomeManagerAppData:(void *)a1
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (a1)
  {
    v5 = [v3 appData];
    v6 = objc_opt_class();
    v7 = [v5 applicationDataForIdentifier:@"com.apple.homekit-entitledclient.identifer"];
    v8 = [v6 didHomeAppOnboardHindsightWithAppData:v7];

    v9 = objc_autoreleasePoolPush();
    v10 = a1;
    v11 = HMFGetOSLogHandle();
    v12 = v11;
    if (v8)
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
      {
        v13 = HMFGetLogIdentifier();
        v16 = 138543362;
        v17 = v13;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@[Hindsight] Home app showed Hindsight onboarded, updating didOnboard", &v16, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
      [v10 _setDidOnboardEventLog:1 message:0];
    }

    else
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
      {
        v14 = HMFGetLogIdentifier();
        v16 = 138543362;
        v17 = v14;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@[Hindsight] We haven't yet onboarded", &v16, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_homeManagerAppDataChanged:(id)a3
{
  v4 = a3;
  v5 = [v4 object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v8 = [(HMDHome *)self workQueue];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __49__HMDHome_Hindsight___homeManagerAppDataChanged___block_invoke;
    v10[3] = &unk_27868A750;
    v10[4] = self;
    v10[5] = v7;
    dispatch_async(v8, v10);
  }

  else
  {
    v9 = _HMFPreconditionFailure();
    __49__HMDHome_Hindsight___homeManagerAppDataChanged___block_invoke(v9);
  }
}

void __49__HMDHome_Hindsight___homeManagerAppDataChanged___block_invoke(uint64_t a1)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v7 = 138543362;
    v8 = v5;
    _os_log_impl(&dword_229538000, v4, OS_LOG_TYPE_INFO, "%{public}@[Hindsight]Checking if new HomeManager appData onboarded Hindsight", &v7, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  [(HMDHome *)*(a1 + 32) _checkHomeManagerAppData:?];
  v6 = *MEMORY[0x277D85DE8];
}

- (void)_handleEventLogClearMessage:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v19 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@[Hindsight] Clearing activity history", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v12 = MEMORY[0x277D85DD0];
  v13 = 3221225472;
  v14 = __50__HMDHome_Hindsight___handleEventLogClearMessage___block_invoke;
  v15 = &unk_27868A1D8;
  v16 = v6;
  v17 = v4;
  v9 = v4;
  v10 = _Block_copy(&v12);
  [(HMDHome *)v6 _clearEventsWithCompletion:v10, v12, v13, v14, v15, v16];

  v11 = *MEMORY[0x277D85DE8];
}

void __50__HMDHome_Hindsight___handleEventLogClearMessage___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v15 = 138543874;
      v16 = v8;
      v17 = 2114;
      v18 = @"Failed to clear activity history";
      v19 = 2114;
      v20 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] %{public}@: %{public}@", &v15, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = MEMORY[0x277CCA9B8];
    v11 = [v3 localizedFailureReason];
    v12 = [v10 hmErrorWithCode:-1 description:@"Failed to clear activity history" reason:v11 suggestion:0 underlyingError:v3];
    [v9 respondWithError:v12];
  }

  else
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v13;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@[Hindsight] Activity history cleared", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 32) _broadcastClearActivityHistoryToOwnerDevices];
    [*(a1 + 32) _synchronizeHindsightCloudShareManager];
    [*(a1 + 40) respondWithSuccess];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleEventLogSetDurationMessage:(id)a3
{
  v54 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = *MEMORY[0x277CCFF00];
  v7 = [v5 objectForKeyedSubscript:*MEMORY[0x277CCFF00]];

  if (v7)
  {
    v8 = v7;
    objc_opt_class();
    v9 = objc_opt_isKindOfClass() & 1;
    if (v9)
    {
      v10 = v8;
    }

    else
    {
      v10 = 0;
    }

    v11 = v10;

    if (v9)
    {
      v12 = [v8 unsignedIntegerValue];
      if (v12 == [(HMDHome *)self eventLogDuration])
      {
        v13 = objc_autoreleasePoolPush();
        v14 = self;
        v15 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
        {
          v16 = HMFGetLogIdentifier();
          *buf = 138543618;
          v47 = v16;
          v48 = 2048;
          v49 = v12;
          _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Activity history duration is already %lu", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v13);
        [v4 respondWithSuccess];
      }

      else
      {
        v28 = [HMDHomeModel alloc];
        v29 = [(HMDHome *)self uuid];
        v30 = [(HMDHome *)self homeManager];
        v31 = [v30 uuid];
        v32 = [(HMDBackingStoreModelObject *)v28 initWithObjectChangeType:2 uuid:v29 parentUUID:v31];

        v33 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v12];
        [(HMDHomeModel *)v32 setEventLogDuration:v33];

        v34 = objc_autoreleasePoolPush();
        v35 = self;
        v36 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_DEFAULT))
        {
          v37 = HMFGetLogIdentifier();
          *buf = 138543618;
          v47 = v37;
          v48 = 2048;
          v49 = v12;
          _os_log_impl(&dword_229538000, v36, OS_LOG_TYPE_DEFAULT, "%{public}@[Hindsight] Setting activity history duration to %lu", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v34);
        v38 = [(HMDHome *)v35 backingStore];
        v39 = [v4 name];
        v40 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v41 = [v38 transaction:v39 options:v40];

        [v41 add:v32];
        v43[0] = MEMORY[0x277D85DD0];
        v43[1] = 3221225472;
        v43[2] = __56__HMDHome_Hindsight___handleEventLogSetDurationMessage___block_invoke;
        v43[3] = &unk_278682338;
        v45 = v12;
        v43[4] = v35;
        v44 = v4;
        [v41 run:v43];
      }
    }

    else
    {
      v22 = objc_autoreleasePoolPush();
      v23 = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        v25 = HMFGetLogIdentifier();
        v26 = [v4 name];
        *buf = 138544130;
        v47 = v25;
        v48 = 2114;
        v49 = v26;
        v50 = 2114;
        v51 = v6;
        v52 = 2112;
        v53 = v8;
        _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is invalid: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v22);
      v27 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v4 respondWithError:v27];
    }
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      v21 = [v4 name];
      *buf = 138543874;
      v47 = v20;
      v48 = 2114;
      v49 = v21;
      v50 = 2114;
      v51 = v6;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is a required parameter", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v17);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v11];
  }

  v42 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_Hindsight___handleEventLogSetDurationMessage___block_invoke(uint64_t a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = [MEMORY[0x277CCACA8] stringWithFormat:@"Failed to set activity history to %lu", *(a1 + 48)];
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543874;
      v20 = v8;
      v21 = 2114;
      v22 = v4;
      v23 = 2114;
      v24 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] %{public}@: %{public}@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v9 = *(a1 + 40);
    v10 = MEMORY[0x277CCA9B8];
    v11 = [v3 localizedFailureReason];
    v12 = [v10 hmErrorWithCode:-1 description:v4 reason:v11 suggestion:0 underlyingError:v3];
    [v9 respondWithError:v12];
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = *(a1 + 32);
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = *(a1 + 48);
      *buf = 138543618;
      v20 = v16;
      v21 = 2048;
      v22 = v17;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Finished running transaction to set activity history duration to %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    [*(a1 + 40) respondWithSuccess];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleEventLogSetEnabledMessage:(id)a3
{
  v66 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self isEventLogHomeSettingEnabled];
  v6 = [(HMDHome *)self didOnboardEventLog];
  v7 = [v4 messagePayload];
  v8 = *MEMORY[0x277CCFF08];
  v9 = [v7 objectForKeyedSubscript:*MEMORY[0x277CCFF08]];

  if (v9)
  {
    v10 = v9;
    objc_opt_class();
    v11 = objc_opt_isKindOfClass() & 1;
    if (v11)
    {
      v12 = v10;
    }

    else
    {
      v12 = 0;
    }

    v13 = v12;

    if (v11)
    {
      v14 = [v10 BOOLValue];
      v15 = v14;
      if (v5 == v14 && ((v14 ^ 1 | v6) & 1) != 0)
      {
        v16 = objc_autoreleasePoolPush();
        v17 = self;
        v18 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
        {
          v19 = HMFGetLogIdentifier();
          v20 = HMFEnabledStatusToString();
          *buf = 138543618;
          v59 = v19;
          v60 = 2114;
          v61 = v20;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Activity history is already %{public}@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v16);
        [v4 respondWithSuccess];
      }

      else
      {
        v54 = v14 ^ 1 | v6;
        v32 = v5 ^ v14;
        v33 = [HMDHomeModel alloc];
        v34 = [(HMDHome *)self uuid];
        v35 = [(HMDHome *)self homeManager];
        v36 = [v35 uuid];
        v37 = [(HMDBackingStoreModelObject *)v33 initWithObjectChangeType:2 uuid:v34 parentUUID:v36];

        if (v32)
        {
          v38 = objc_autoreleasePoolPush();
          v39 = self;
          v40 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v40, OS_LOG_TYPE_DEFAULT))
          {
            v41 = HMFGetLogIdentifier();
            HMFEnabledStatusToString();
            v42 = v53 = v38;
            *buf = 138543618;
            v59 = v41;
            v60 = 2114;
            v61 = v42;
            _os_log_impl(&dword_229538000, v40, OS_LOG_TYPE_DEFAULT, "%{public}@[Hindsight] Setting activity history enabled to %{public}@", buf, 0x16u);

            v38 = v53;
          }

          objc_autoreleasePoolPop(v38);
          v43 = [MEMORY[0x277CCABB0] numberWithBool:v15];
          [(HMDHomeModel *)v37 setEventLogHomeSettingEnabled:v43];
        }

        if ((v54 & 1) == 0)
        {
          v44 = objc_autoreleasePoolPush();
          v45 = self;
          v46 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
          {
            v47 = HMFGetLogIdentifier();
            *buf = 138543362;
            v59 = v47;
            _os_log_impl(&dword_229538000, v46, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Finished running transaction to set activity history did onboard to YES", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v44);
          [(HMDHomeModel *)v37 setDidOnboardEventLog:MEMORY[0x277CBEC38]];
        }

        v48 = [(HMDHome *)self backingStore];
        v49 = [v4 name];
        v50 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v51 = [v48 transaction:v49 options:v50];

        [v51 add:v37];
        v55[0] = MEMORY[0x277D85DD0];
        v55[1] = 3221225472;
        v55[2] = __55__HMDHome_Hindsight___handleEventLogSetEnabledMessage___block_invoke;
        v55[3] = &unk_27867C610;
        v57 = v15;
        v55[4] = self;
        v56 = v4;
        [v51 run:v55];
      }
    }

    else
    {
      v26 = objc_autoreleasePoolPush();
      v27 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        v29 = HMFGetLogIdentifier();
        v30 = [v4 name];
        *buf = 138544130;
        v59 = v29;
        v60 = 2114;
        v61 = v30;
        v62 = 2114;
        v63 = v8;
        v64 = 2112;
        v65 = v10;
        _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is invalid: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v26);
      v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v4 respondWithError:v31];
    }
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      v25 = [v4 name];
      *buf = 138543874;
      v59 = v24;
      v60 = 2114;
      v61 = v25;
      v62 = 2114;
      v63 = v8;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is a required parameter", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v21);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v13];
  }

  v52 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome_Hindsight___handleEventLogSetEnabledMessage___block_invoke(uint64_t a1, void *a2)
{
  v29 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = MEMORY[0x277CCACA8];
    v5 = *(a1 + 48);
    v6 = HMFEnabledStatusToString();
    v7 = [v4 stringWithFormat:@"Failed to run transaction to set activity history to %@", v6];

    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v24 = v11;
      v25 = 2114;
      v26 = v7;
      v27 = 2114;
      v28 = v3;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] %{public}@: %{public}@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    v12 = *(a1 + 40);
    v13 = MEMORY[0x277CCA9B8];
    v14 = [v3 localizedFailureReason];
    v15 = [v13 hmErrorWithCode:-1 description:v7 reason:v14 suggestion:0 underlyingError:v3];
    [v12 respondWithError:v15];
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = *(a1 + 32);
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = *(a1 + 48);
      v21 = HMFEnabledStatusToString();
      *buf = 138543618;
      v24 = v19;
      v25 = 2114;
      v26 = v21;
      _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Finished running transaction to set activity history to %{public}@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    [*(a1 + 40) respondWithSuccess];
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __53__HMDHome_Hindsight___setDidOnboardEventLog_message___block_invoke(uint64_t a1, void *a2)
{
  v34 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 48);
      v9 = HMFBooleanToString();
      *buf = 138544130;
      v27 = v7;
      v28 = 2114;
      v29 = @"Failed to set activity history did onboard";
      v30 = 2114;
      v31 = v9;
      v32 = 2114;
      v33 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] %{public}@ to %{public}@: %{public}@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
    v10 = *(a1 + 40);
    v11 = MEMORY[0x277CCA9B8];
    v12 = [v3 localizedFailureReason];
    v13 = [v11 hmErrorWithCode:-1 description:@"Failed to set activity history did onboard" reason:v12 suggestion:0 underlyingError:v3];
    [v10 respondWithError:v13];
  }

  else
  {
    v14 = [*(a1 + 32) isEventLogEnabled];
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 32);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = *(a1 + 48);
      v20 = HMFBooleanToString();
      v21 = HMFBooleanToString();
      *buf = 138543874;
      v27 = v18;
      v28 = 2114;
      v29 = v20;
      v30 = 2114;
      v31 = v21;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Finished running transaction to set activity history did onboard to %{public}@, isEventLogEnabled is now %{public}@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v15);
    v22 = *(a1 + 40);
    v12 = [MEMORY[0x277CCABB0] numberWithBool:{v14, *MEMORY[0x277CCFF08]}];
    v25 = v12;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v25 forKeys:&v24 count:1];
    [v22 respondWithPayload:v13];
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_handleEventLogSetDidOnboard:(id)a3
{
  v38 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = *MEMORY[0x277CCFF10];
  v7 = [v5 objectForKeyedSubscript:*MEMORY[0x277CCFF10]];

  if (v7)
  {
    v8 = v7;
    objc_opt_class();
    v9 = objc_opt_isKindOfClass() & 1;
    if (v9)
    {
      v10 = v8;
    }

    else
    {
      v10 = 0;
    }

    v11 = v10;

    if (v9)
    {
      v12 = [v8 BOOLValue];
      if (v12 & 1) != 0 || (isInternalBuild())
      {
        if (v12 == [(HMDHome *)self didOnboardEventLog])
        {
          v24 = objc_autoreleasePoolPush();
          v25 = self;
          v26 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
          {
            v27 = HMFGetLogIdentifier();
            v28 = HMFBooleanToString();
            v30 = 138543618;
            v31 = v27;
            v32 = 2114;
            v33 = v28;
            _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_INFO, "%{public}@[Hindsight] Activity history onboarding is already %{public}@", &v30, 0x16u);
          }

          objc_autoreleasePoolPop(v24);
          [v4 respondWithSuccess];
        }

        else
        {
          [(HMDHome *)self _setDidOnboardEventLog:v12 message:v4];
        }

        goto LABEL_19;
      }

      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_14;
      }
    }

    else
    {
      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
LABEL_14:
        v21 = HMFGetLogIdentifier();
        v22 = [v4 name];
        v30 = 138544130;
        v31 = v21;
        v32 = 2114;
        v33 = v22;
        v34 = 2114;
        v35 = v6;
        v36 = 2112;
        v37 = v8;
        _os_log_impl(&dword_229538000, v20, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is invalid: %@", &v30, 0x2Au);
      }
    }

    objc_autoreleasePoolPop(v18);
    v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v23];

    goto LABEL_19;
  }

  v13 = objc_autoreleasePoolPush();
  v14 = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
  {
    v16 = HMFGetLogIdentifier();
    v17 = [v4 name];
    v30 = 138543874;
    v31 = v16;
    v32 = 2114;
    v33 = v17;
    v34 = 2114;
    v35 = v6;
    _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] '%{public}@.%{public}@' is a required parameter", &v30, 0x20u);
  }

  objc_autoreleasePoolPop(v13);
  v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
  [v4 respondWithError:v11];
LABEL_19:

  v29 = *MEMORY[0x277D85DE8];
}

- (BOOL)isEventLogEnabled
{
  v3 = [(HMDHome *)self isEventLogHomeSettingEnabled];
  if (v3)
  {

    LOBYTE(v3) = [(HMDHome *)self didOnboardEventLog];
  }

  return v3;
}

+ (BOOL)didHomeAppOnboardHindsightWithAppData:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 objectForKeyedSubscript:@"lastOnboardingNewFeaturesVersionSeen"];
  v6 = v5;
  if (v5)
  {
    v7 = v5;
    objc_opt_class();
    v8 = objc_opt_isKindOfClass() & 1;
    if (v8)
    {
      v9 = v7;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    v11 = objc_autoreleasePoolPush();
    v12 = a1;
    v13 = HMFGetOSLogHandle();
    v14 = v13;
    if (v8)
    {
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
      {
        v15 = HMFGetLogIdentifier();
        v24 = 138543874;
        v25 = v15;
        v26 = 2112;
        v27 = @"lastOnboardingNewFeaturesVersionSeen";
        v28 = 2112;
        v29 = v7;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_DEBUG, "%{public}@[Hindsight] Home manager has application data '%@' = %@", &v24, 0x20u);
      }

      objc_autoreleasePoolPop(v11);
      v16 = [v7 integerValue] > 3;
    }

    else
    {
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        v24 = 138543874;
        v25 = v21;
        v26 = 2112;
        v27 = @"lastOnboardingNewFeaturesVersionSeen";
        v28 = 2112;
        v29 = v4;
        _os_log_impl(&dword_229538000, v14, OS_LOG_TYPE_ERROR, "%{public}@[Hindsight] Application data dictionary has invalid value for '%@': %@", &v24, 0x20u);
      }

      objc_autoreleasePoolPop(v11);
      v16 = 0;
    }
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = a1;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
    {
      v20 = HMFGetLogIdentifier();
      v24 = 138543874;
      v25 = v20;
      v26 = 2112;
      v27 = @"lastOnboardingNewFeaturesVersionSeen";
      v28 = 2112;
      v29 = v4;
      _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEBUG, "%{public}@[Hindsight] Application data dictionary has no value for '%@': %@", &v24, 0x20u);
    }

    objc_autoreleasePoolPop(v17);
    v16 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];
  return v16;
}

- (NSDictionary)assistantObject
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self name];

  if (v3)
  {
    v16[0] = *MEMORY[0x277D48158];
    v4 = [(HMDHome *)self name:@"objectType"];
    v16[1] = v4;
    v15[2] = @"objectIdentifier";
    v5 = [(HMDHome *)self urlString];
    v16[2] = v5;
    v15[3] = @"objectHomeIdentifier";
    v6 = [(HMDHome *)self urlString];
    v15[4] = @"objectReference";
    v16[3] = v6;
    v16[4] = self;
    v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v16 forKeys:v15 count:5];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [(HMDHome *)self uuid];
      v12 = [v11 UUIDString];
      *buf = 138543618;
      v18 = v10;
      v19 = 2112;
      v20 = v12;
      _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Skipping because home.name is nil for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v7 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];

  return v7;
}

- (NSString)urlString
{
  v2 = *MEMORY[0x277CCF290];
  v3 = [(HMDHome *)self uuid];
  v4 = hm_assistantIdentifier();

  return v4;
}

- (id)multiUserSettings
{
  v47 = *MEMORY[0x277D85DE8];
  v42 = 0;
  v43 = &v42;
  v44 = 0x2020000000;
  v45 = 0;
  v38 = 0;
  v39 = &v38;
  v40 = 0x2020000000;
  v41 = 0;
  v2 = [(HMDHome *)self users];
  v3 = [v2 count];
  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = v2;
  v4 = [obj countByEnumeratingWithState:&v34 objects:v46 count:16];
  v27 = v3;
  v5 = 0;
  v6 = 0;
  if (v4)
  {
    v28 = 0;
    v29 = 0;
    v7 = 0;
    v30 = 0;
    v32 = 0;
    v8 = *v35;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v10 = *(*(&v34 + 1) + 8 * i);
        if (([v10 isOwner] & 1) == 0)
        {
          v11 = [v10 sharedSettingValuesByKeyPath];
          v12 = [v11 mutableCopy];

          if ([v12 count])
          {
            v33[0] = MEMORY[0x277D85DD0];
            v33[1] = 3221225472;
            v33[2] = __54__HMDHome_MultiUserSettingsMetrics__multiUserSettings__block_invoke;
            v33[3] = &unk_27867D2E0;
            v33[4] = &v42;
            v33[5] = &v38;
            [v12 enumerateKeysAndObjectsUsingBlock:v33];
            ++v32;
          }

          else
          {
            v13 = [v10 cloudShareTrustManager];
            v14 = [v13 isTrustConfigured];

            v15 = [v10 sharedUserSettingsLogEventBackingStoreControllerRunState];
            v16 = v28;
            v29 += v14 ^ 1u;
            if (v15 == 5)
            {
              v17 = v6 + 1;
            }

            else
            {
              v17 = v6;
            }

            if (v15 == 4)
            {
              v18 = v5 + 1;
            }

            else
            {
              v18 = v5;
            }

            if (v15 == 4)
            {
              v17 = v6;
            }

            if (v15 == 3)
            {
              v18 = v5;
              v17 = v6;
              v19 = v28 + 1;
            }

            else
            {
              v19 = v28;
            }

            if (v15 == 2)
            {
              v20 = v7 + 1;
            }

            else
            {
              v20 = v7;
            }

            if (v15 < 2)
            {
              v20 = v7;
            }

            v21 = v30;
            if (v15 >= 2)
            {
              v22 = v30;
            }

            else
            {
              v22 = v30 + 1;
            }

            if (v15 > 2)
            {
              v5 = v18;
              v6 = v17;
              v16 = v19;
            }

            v28 = v16;
            if (v15 <= 2)
            {
              v7 = v20;
              v21 = v22;
            }

            v30 = v21;
          }
        }
      }

      v4 = [obj countByEnumeratingWithState:&v34 objects:v46 count:16];
    }

    while (v4);
  }

  else
  {
    v28 = 0;
    v29 = 0;
    v7 = 0;
    v30 = 0;
    v32 = 0;
  }

  v23 = objc_alloc(MEMORY[0x277CD1C20]);
  v24 = [v23 initWithNumSharedUsers:(v27 - 1) & ~((v27 - 1) >> 63) numUsersWithSettings:v32 numUsersWithIdentifyVoiceOff:v43[3] numUsersWithPlayBackInfluencesForYouOff:v39[3] numUsersCloudShareTrustNotConfigured:v29 numUsersSharedBackingStoreNotStarted:v30 numUsersSharedBackingStoreRunning:v7 numUsersSharedBackingStoreNotRunningDueToError:v28 numUsersSharedBackingStoreNotRunningDueToStopped:v5 numUsersSharedBackingStoreSharedZoneWaitingForShareInvitation:v6];

  _Block_object_dispose(&v38, 8);
  _Block_object_dispose(&v42, 8);
  v25 = *MEMORY[0x277D85DE8];

  return v24;
}

void __54__HMDHome_MultiUserSettingsMetrics__multiUserSettings__block_invoke(uint64_t a1, void *a2, void *a3)
{
  v14 = a2;
  v5 = a3;
  if ([v14 isEqualToString:@"shared.root.siri.identifyVoice"])
  {
    v6 = v5;
    objc_opt_class();
    v7 = (objc_opt_isKindOfClass() & 1) != 0 ? v6 : 0;
    v8 = v7;

    v9 = [v8 intValue];
    if (!v9)
    {
      ++*(*(*(a1 + 32) + 8) + 24);
    }
  }

  if ([v14 isEqualToString:@"shared.root.music.playbackInfluencesForYou"])
  {
    v10 = v5;
    objc_opt_class();
    v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
    v12 = v11;

    v13 = [v12 intValue];
    if (!v13)
    {
      ++*(*(*(a1 + 40) + 8) + 24);
    }
  }
}

+ (HMDHome)homeWithHomeManager:(id)a3 backingStore:(id)a4 model:(id)a5 error:(id *)a6
{
  v83 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v76 = 0;
  if (a6)
  {
    v13 = a6;
  }

  else
  {
    v13 = &v76;
  }

  v14 = objc_alloc(MEMORY[0x277CCAD78]);
  v15 = [v12 ownerUUID];
  v16 = v14;
  v17 = v11;
  v18 = [v16 initWithUUIDString:v15];

  v19 = [v17 cdlsFetchObjectWithUUID:v18 ofModelType:objc_opt_class() error:v13];
  v20 = v19;
  if (v19)
  {
    v21 = [v19 accountHandle];
    if (v21)
    {
LABEL_6:

LABEL_16:
      v36 = [[HMDUser alloc] initWithModelObject:v20];
      if (v36)
      {
        v71 = v18;
        v37 = MEMORY[0x277CD1F00];
        v38 = [v12 presenceComputeStatus];
        v66 = [v37 authWithNumber:v38];

        v65 = [HMDHome alloc];
        v39 = [v12 name];
        [v12 uuid];
        v41 = v40 = v10;
        v42 = objc_alloc(MEMORY[0x277CCAD78]);
        [v12 defaultRoomUUID];
        v67 = v17;
        v43 = v68 = v12;
        v44 = v20;
        v45 = [v42 initWithUUIDString:v43];
        v46 = objc_alloc_init(HMDHomeDefaultDataSource);
        v29 = [(HMDHome *)v65 initWithName:v39 uuid:v41 defaultRoomUUID:v45 owner:v36 homeManager:v40 presenceAuth:v66 dataSource:v46];

        v20 = v44;
        v17 = v67;
        v12 = v68;

        v10 = v40;
        v47 = [v68 owned];
        -[HMDHome setOwnerUser:](v29, "setOwnerUser:", [v47 BOOLValue]);

        v48 = [v68 residentSelectionVersion];
        [(HMDHome *)v29 setResidentSelectionVersion:v48];

        [(HMDHome *)v29 setBackingStore:v67];
        [v67 setDelegate:v29];
        v49 = [[HMDHomeObjectLookup alloc] initWithHome:v29];
        [v67 setLookup:v49];

        v18 = v71;
        [v67 setHome:v29];
      }

      else
      {
        v50 = objc_autoreleasePoolPush();
        v51 = a1;
        v52 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v54 = v53 = v18;
          *buf = 138543362;
          v78 = v54;
          _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_ERROR, "%{public}@Unable to create owner from model.", buf, 0xCu);

          v18 = v53;
        }

        objc_autoreleasePoolPop(v50);
        v29 = 0;
      }

      goto LABEL_22;
    }

    if (![v10 isCloudKitRequiredForHH2])
    {
      goto LABEL_16;
    }

    v70 = v20;
    v30 = v18;
    v31 = +[HMDAppleAccountManager sharedManager];
    v21 = [v31 account];

    if (v21)
    {
      v32 = [v21 handles];
      v33 = [v32 firstObject];

      if (v33)
      {
        v34 = [v17 context];
        v72[0] = MEMORY[0x277D85DD0];
        v72[1] = 3221225472;
        v72[2] = __67__HMDHome_DataModel__homeWithHomeManager_backingStore_model_error___block_invoke;
        v72[3] = &unk_27868A010;
        v73 = v30;
        v74 = v33;
        v75 = v17;
        v35 = v33;
        [v34 performBlock:v72];

        v18 = v30;
        v20 = v70;
        [v70 setAccountHandle:v35];

        goto LABEL_6;
      }

      if (!*v13)
      {
        *v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
      }

      v61 = objc_autoreleasePoolPush();
      v62 = a1;
      v63 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v63, OS_LOG_TYPE_ERROR))
      {
        v64 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v64;
        _os_log_impl(&dword_229538000, v63, OS_LOG_TYPE_ERROR, "%{public}@Unable to load home (user has no account handle and we do not appear to be logged in (no handles).", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v61);
      v29 = 0;
      v18 = v30;
    }

    else
    {
      v18 = v30;
      if (!*v13)
      {
        *v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
      }

      v57 = objc_autoreleasePoolPush();
      v58 = a1;
      v59 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v59, OS_LOG_TYPE_ERROR))
      {
        v60 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v60;
        _os_log_impl(&dword_229538000, v59, OS_LOG_TYPE_ERROR, "%{public}@Unable to load home (user has no account handle and we do not appear to be logged in (no account).", buf, 0xCu);

        v18 = v30;
      }

      objc_autoreleasePoolPop(v57);
      v29 = 0;
    }

    v20 = v70;
    goto LABEL_22;
  }

  if (!*v13)
  {
    *v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
  }

  v22 = objc_autoreleasePoolPush();
  v23 = a1;
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
  {
    HMFGetLogIdentifier();
    v25 = v69 = v10;
    [v17 uuid];
    v27 = v26 = v18;
    v28 = *v13;
    *buf = 138543874;
    v78 = v25;
    v79 = 2112;
    v80 = v27;
    v81 = 2112;
    v82 = v28;
    _os_log_impl(&dword_229538000, v24, OS_LOG_TYPE_ERROR, "%{public}@Unable to fetch owner model from backing store %@: %@", buf, 0x20u);

    v18 = v26;
    v20 = 0;

    v10 = v69;
  }

  objc_autoreleasePoolPop(v22);
  v29 = 0;
LABEL_22:

  v55 = *MEMORY[0x277D85DE8];

  return v29;
}

void __67__HMDHome_DataModel__homeWithHomeManager_backingStore_model_error___block_invoke(uint64_t a1)
{
  v2 = [HMCContext findUserWithModelID:*(a1 + 32)];
  if (v2)
  {
    v4 = v2;
    [v2 setAccountHandle:*(a1 + 40)];
    v3 = [*(a1 + 48) context];
    [v3 save];

    v2 = v4;
  }
}

+ (id)createNewHomeModelsWithModelID:(id)a3 parentModelID:(id)a4 name:(id)a5 acwgGroupResolvingKey:(id)a6 acwgIssuerPublicKeyExternalRepresentation:(id)a7 userUniqueIDForAccessories:(id)a8 hasOnboardedActivityHistory:(BOOL)a9 ownedBy:(id)a10
{
  v15 = a3;
  v16 = a4;
  v17 = a5;
  v18 = a6;
  v19 = a7;
  v20 = a8;
  v21 = a10;
  if (!v15)
  {
    _HMFPreconditionFailure();
    goto LABEL_7;
  }

  if (!v16)
  {
LABEL_7:
    _HMFPreconditionFailure();
    goto LABEL_8;
  }

  if (!v17)
  {
LABEL_8:
    _HMFPreconditionFailure();
    goto LABEL_9;
  }

  v22 = v21;
  if (v21)
  {
    v23 = [MEMORY[0x277CBEB18] array];
    v24 = [(HMDBackingStoreModelObject *)[HMDHomeModel alloc] initWithUUID:v15 parentUUID:v16];
    [(HMDHomeModel *)v24 setName:v17];
    [v22 pairingUsername];
    v51 = v17;
    v26 = v25 = v18;
    [(HMDHomeModel *)v24 setOwnerName:v26];

    v27 = [v22 uuid];
    [v27 UUIDString];
    v28 = v50 = v16;
    [(HMDHomeModel *)v24 setOwnerUUID:v28];

    v29 = [v22 userID];
    [(HMDHomeModel *)v24 setOwnerUserID:v29];

    v30 = [v22 publicKey];
    [(HMDHomeModel *)v24 setOwnerPublicKey:v30];

    v31 = [MEMORY[0x277CCAD78] UUID];
    v32 = [v31 UUIDString];
    [(HMDHomeModel *)v24 setDefaultRoomUUID:v32];

    [(HMDHomeModel *)v24 setMatCredGRK:v25];
    [(HMDHomeModel *)v24 setOwned:MEMORY[0x277CBEC38]];
    v33 = [MEMORY[0x277CCABB0] numberWithBool:a9];
    [(HMDHomeModel *)v24 setDidOnboardEventLog:v33];

    [v23 addObject:v24];
    v34 = [v22 backingStoreObjects:4];
    v55[0] = MEMORY[0x277D85DD0];
    v55[1] = 3221225472;
    v55[2] = __199__HMDHome_DataModel__createNewHomeModelsWithModelID_parentModelID_name_acwgGroupResolvingKey_acwgIssuerPublicKeyExternalRepresentation_userUniqueIDForAccessories_hasOnboardedActivityHistory_ownedBy___block_invoke;
    v55[3] = &unk_27867D500;
    v35 = v15;
    v56 = v35;
    v57 = v19;
    v58 = v20;
    v36 = v23;
    v59 = v36;
    v37 = v20;
    v38 = v19;
    [v34 hmf_enumerateWithAutoreleasePoolUsingBlock:v55];

    v39 = +[HMDHome getBuiltinActionSets];
    v52[0] = MEMORY[0x277D85DD0];
    v52[1] = 3221225472;
    v52[2] = __199__HMDHome_DataModel__createNewHomeModelsWithModelID_parentModelID_name_acwgGroupResolvingKey_acwgIssuerPublicKeyExternalRepresentation_userUniqueIDForAccessories_hasOnboardedActivityHistory_ownedBy___block_invoke_2;
    v52[3] = &unk_278681FB0;
    v53 = v35;
    v40 = v36;
    v54 = v40;
    v41 = v35;
    [v39 enumerateKeysAndObjectsUsingBlock:v52];

    v42 = [HMDHomeMediaSettingsModel defaultModelForHomeUUID:v41];
    [v40 addObject:v42];

    v43 = [HMDHomePersonManagerSettingsModel defaultModelForHomeUUID:v41];
    [v40 addObject:v43];

    v44 = [HMDHomeThreadNetworkModel defaultModelForHomeUUID:v41];
    [v40 addObject:v44];

    v45 = v54;
    v46 = v40;

    return v40;
  }

LABEL_9:
  v48 = _HMFPreconditionFailure();
  __199__HMDHome_DataModel__createNewHomeModelsWithModelID_parentModelID_name_acwgGroupResolvingKey_acwgIssuerPublicKeyExternalRepresentation_userUniqueIDForAccessories_hasOnboardedActivityHistory_ownedBy___block_invoke(v48, v49);
  return result;
}

void __199__HMDHome_DataModel__createNewHomeModelsWithModelID_parentModelID_name_acwgGroupResolvingKey_acwgIssuerPublicKeyExternalRepresentation_userUniqueIDForAccessories_hasOnboardedActivityHistory_ownedBy___block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v6;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = v4;
  if (v4)
  {
    [v4 setParentUUID:*(a1 + 32)];
    [v5 setMatCredIPKExternalRepresentation:*(a1 + 40)];
    [v5 setUniqueIDForAccessories:*(a1 + 48)];
  }

  [*(a1 + 56) addObject:v6];
}

void __199__HMDHome_DataModel__createNewHomeModelsWithModelID_parentModelID_name_acwgGroupResolvingKey_acwgIssuerPublicKeyExternalRepresentation_userUniqueIDForAccessories_hasOnboardedActivityHistory_ownedBy___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = MEMORY[0x277CCAD78];
  v6 = *(a1 + 32);
  v15 = a2;
  v7 = MEMORY[0x277CBEA60];
  v8 = a3;
  v9 = a2;
  v10 = [v7 arrayWithObjects:&v15 count:1];
  v11 = [v5 hm_deriveUUIDFromBaseUUID:v6 identifierSalt:0 withSalts:{v10, v15, v16}];

  v12 = [(HMDBackingStoreModelObject *)[HMDActionSetModel alloc] initWithUUID:v11 parentUUID:*(a1 + 32)];
  v13 = HMDLocalizedStringForKey(v8);

  [(HMDActionSetModel *)v12 setName:v13];
  [(HMDActionSetModel *)v12 setType:v9];
  [*(a1 + 40) addObject:v12];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_evaluateNetworkProtectionSupport
{
  v2 = self;
  v86 = *MEMORY[0x277D85DE8];
  v66 = 0u;
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 residentDevices];

  v5 = [v4 countByEnumeratingWithState:&v66 objects:v85 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v67;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v67 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v66 + 1) + 8 * i);
        v10 = [v9 device];
        if ([v9 isEnabled])
        {
          v11 = [v9 capabilities];
          v12 = [v11 supportsRouterManagement];

          if (v12)
          {
            v13 = [(HMDHome *)v2 minimumNetworkRouterSupportHomeKitVersion];
            if (!v13)
            {
              goto LABEL_13;
            }

            v14 = v13;
            v15 = [v10 version];
            [(HMDHome *)v2 minimumNetworkRouterSupportHomeKitVersion];
            v16 = v7;
            v17 = v4;
            v19 = v18 = v2;
            v64 = [v15 isAtLeastVersion:v19];

            v2 = v18;
            v4 = v17;
            v7 = v16;

            if (v64)
            {
LABEL_13:
              v21 = objc_autoreleasePoolPush();
              v22 = v2;
              v23 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
              {
                HMFGetLogIdentifier();
                v25 = v24 = v2;
                *buf = 138543618;
                v76 = v25;
                v77 = 2112;
                v78 = v9;
                _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_INFO, "%{public}@Found resident with router management support: %@", buf, 0x16u);

                v2 = v24;
              }

              objc_autoreleasePoolPop(v21);
              v20 = 1;
              goto LABEL_16;
            }
          }
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v66 objects:v85 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v20 = 0;
LABEL_16:

  v26 = [(HMDHome *)v2 activeNetworkRouterAccessory];

  v27 = [(HMDHome *)v2 _isNetworkRouterSupportEnabledForCurrentDevice];
  v28 = objc_autoreleasePoolPush();
  v29 = v2;
  v30 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
  {
    v31 = v27;
    v32 = HMFGetLogIdentifier();
    v33 = [(HMDHome *)v29 name];
    v34 = HMFBooleanToString();
    v35 = HMFBooleanToString();
    HMFBooleanToString();
    v36 = v65 = v28;
    *buf = 138544386;
    v76 = v32;
    v77 = 2112;
    v78 = v33;
    v79 = 2112;
    v80 = v34;
    v81 = 2112;
    v82 = v35;
    v83 = 2112;
    v84 = v36;
    _os_log_impl(&dword_229538000, v30, OS_LOG_TYPE_INFO, "%{public}@Evaluating network protection support for home %@, Router Managing Device: %@, Active Network Router Accessory: %@, Router support enabled: %@", buf, 0x34u);

    v28 = v65;
    v27 = v31;
  }

  objc_autoreleasePoolPop(v28);
  v37 = [(HMDHome *)v29 minHomeKitVersionForAccessoryNetworkProtectionChange];
  if (v37)
  {
    v38 = v37;
    v39 = [(HMDHome *)v29 minHomeKitVersionForAccessoryNetworkProtectionChange];
    v40 = +[HMDHomeKitVersion currentVersion];
    v41 = [v39 isGreaterThanVersion:v40];

    v42 = v41 ^ 1;
  }

  else
  {
    v42 = 1;
  }

  v43 = [(HMDHome *)v29 isAdminUser];
  v44 = 4;
  if (v43)
  {
    v44 = 0;
  }

  if (!v26)
  {
    v44 |= 8uLL;
  }

  v45 = v44 | v20 ^ 1u;
  if (!v27)
  {
    v45 |= 2uLL;
  }

  if (v42)
  {
    v46 = v45;
  }

  else
  {
    v46 = v45 | 0x10;
  }

  if ([(HMDHome *)v29 networkRouterSupportDisableReason]!= v46)
  {
    [(HMDHome *)v29 setNetworkRouterSupportDisableReason:v46];
    [(HMDHome *)v29 setNetworkRouterSupport:[(HMDHome *)v29 deriveNetworkRouterSupport:v46]];
    v47 = ([(HMDHome *)v29 networkRouterSupport]>> 2) & 1;
    v48 = MEMORY[0x277D0F848];
    v49 = *MEMORY[0x277CD0470];
    v50 = [(HMDHome *)v29 messageDestination];
    v72 = *MEMORY[0x277CD0468];
    v51 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v46];
    v74[0] = v51;
    v73 = *MEMORY[0x277CCFE18];
    v52 = v73;
    v53 = [MEMORY[0x277CCABB0] numberWithBool:v47];
    v74[1] = v53;
    v54 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v74 forKeys:&v72 count:2];
    v55 = [v48 messageWithName:v49 destination:v50 payload:v54];

    [v55 setRequiresSPIEntitlement];
    v56 = [(HMDHome *)v29 msgDispatcher];
    [v56 sendMessage:v55 completionHandler:0];

    v57 = MEMORY[0x277D0F848];
    v58 = [(HMDHome *)v29 messageDestination];
    v70 = v52;
    v59 = [MEMORY[0x277CCABB0] numberWithBool:v47];
    v71 = v59;
    v60 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v71 forKeys:&v70 count:1];
    v61 = [v57 messageWithName:v49 destination:v58 payload:v60];

    [v61 setRequiresNoSPIEntitlement];
    v62 = [(HMDHome *)v29 msgDispatcher];
    [v62 sendMessage:v61 completionHandler:0];
  }

  v63 = *MEMORY[0x277D85DE8];
}

- (void)_requestRemoveClientConfigurationWithIdentifier:(id)a3
{
  location[3] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self residentDeviceManager];
  v6 = [v5 primaryResidentDevice];
  v7 = [v6 device];

  if (v7)
  {
    v8 = [HMDRemoteDeviceMessageDestination alloc];
    v9 = [(HMDHome *)self uuid];
    v10 = [(HMDRemoteDeviceMessageDestination *)v8 initWithTarget:v9 device:v7];

    v11 = objc_alloc(MEMORY[0x277D0F848]);
    v26 = @"HMDH.NetworkClientIdentifierMessageKey";
    v27 = v4;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
    v13 = [v11 initWithName:@"HMDHomeRemoveClientConfigurationRequestKey" destination:v10 payload:v12];

    [v13 setSecureRemote:1];
    objc_initWeak(location, self);
    v20 = MEMORY[0x277D85DD0];
    v21 = 3221225472;
    v22 = __82__HMDHome_NetworkRouterInternal___requestRemoveClientConfigurationWithIdentifier___block_invoke;
    v23 = &unk_278687F40;
    objc_copyWeak(&v25, location);
    v24 = v4;
    [v13 setResponseHandler:&v20];
    v14 = [(HMDHome *)self msgDispatcher:v20];
    [v14 sendMessage:v13 completionHandler:0];

    objc_destroyWeak(&v25);
    objc_destroyWeak(location);
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v18;
      _os_log_impl(&dword_229538000, v17, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request to remove client configuration", location, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  v19 = *MEMORY[0x277D85DE8];
}

void __82__HMDHome_NetworkRouterInternal___requestRemoveClientConfigurationWithIdentifier___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = v10;
    if (v5)
    {
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        v20 = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = v5;
        v14 = "%{public}@Request to remove client configuration %@ failed with error: %@";
        v15 = v11;
        v16 = OS_LOG_TYPE_ERROR;
        v17 = 32;
LABEL_7:
        _os_log_impl(&dword_229538000, v15, v16, v14, &v20, v17);
      }
    }

    else if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v18 = *(a1 + 32);
      v20 = 138543618;
      v21 = v12;
      v22 = 2112;
      v23 = v18;
      v14 = "%{public}@Request remove client configuration %@ successful";
      v15 = v11;
      v16 = OS_LOG_TYPE_INFO;
      v17 = 22;
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)_removeClientConfigurationWithIdentifier:(id)a3 completion:(id)a4
{
  v28 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self activeNetworkRouterAccessory];
  v9 = [v8 networkRouterController];

  if (v9)
  {
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __86__HMDHome_NetworkRouterInternal___removeClientConfigurationWithIdentifier_completion___block_invoke;
    v19[3] = &unk_278689358;
    v19[4] = self;
    v20 = v6;
    v21 = v7;
    [v9 removeClientConfigurationWithClientIdentifier:v20 completion:v19];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [(HMDHome *)v11 activeNetworkRouterAccessory];
      v15 = [v14 uuid];
      v16 = [v15 UUIDString];
      *buf = 138543874;
      v23 = v13;
      v24 = 2112;
      v25 = v6;
      v26 = 2112;
      v27 = v16;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove client configuration %@ due to no router controller found on the active network router %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    if (v7)
    {
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (*(v7 + 2))(v7, v17);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __86__HMDHome_NetworkRouterInternal___removeClientConfigurationWithIdentifier_completion___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 40);
      v16 = 138543874;
      v17 = v8;
      v18 = 2112;
      v19 = v9;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove client configuration %@ due to error %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = *(v10 + 16);
LABEL_10:
      v11();
    }
  }

  else
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = *(a1 + 40);
      v16 = 138543618;
      v17 = v12;
      v18 = 2112;
      v19 = v13;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Removed client configuration %@ successfully", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v14 = *(a1 + 48);
    if (v14)
    {
      v11 = *(v14 + 16);
      goto LABEL_10;
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_removeClientConfigurationWithIdentifier:(id)a3
{
  v4 = a3;
  if ([(HMDHome *)self isOwnerUser])
  {
    [(HMDHome *)self _removeClientConfigurationWithIdentifier:v4 completion:0];
  }

  else
  {
    [(HMDHome *)self _requestRemoveClientConfigurationWithIdentifier:v4];
  }
}

- (void)_requestUniquePSKClientConfigurationWithCompletion:(id)a3
{
  location[3] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self residentDeviceManager];
  v6 = [v5 primaryResidentDevice];
  v7 = [v6 device];

  if (v7)
  {
    v8 = [HMDRemoteDeviceMessageDestination alloc];
    v9 = [(HMDHome *)self uuid];
    v10 = [(HMDRemoteDeviceMessageDestination *)v8 initWithTarget:v9 device:v7];

    v11 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeCreateUniquePSKClientConfigurationRequestKey" destination:v10 payload:0];
    [v11 setSecureRemote:1];
    objc_initWeak(location, self);
    v18 = MEMORY[0x277D85DD0];
    v19 = 3221225472;
    v20 = __85__HMDHome_NetworkRouterInternal___requestUniquePSKClientConfigurationWithCompletion___block_invoke;
    v21 = &unk_278689728;
    objc_copyWeak(&v23, location);
    v22 = v4;
    [v11 setResponseHandler:&v18];
    v12 = [(HMDHome *)self msgDispatcher:v18];
    [v12 sendMessage:v11 completionHandler:0];

    objc_destroyWeak(&v23);
    objc_destroyWeak(location);
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v16;
      _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request unique PSK from", location, 0xCu);
    }

    objc_autoreleasePoolPop(v13);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    (*(v4 + 2))(v4, 0, v10);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __85__HMDHome_NetworkRouterInternal___requestUniquePSKClientConfigurationWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v45 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v38 = v11;
        v39 = 2112;
        v40 = v5;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for unique PSK failed with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:@"HMDH.UniquePSKMessageKey"];
      v13 = [v6 hmf_numberForKey:@"HMDH.NetworkClientIdentifierMessageKey"];
      v14 = objc_alloc(MEMORY[0x277CCAD78]);
      v15 = [v6 hmf_stringForKey:@"HMDH.NetworkRouterUUIDMessageKey"];
      v16 = [v14 initWithUUIDString:v15];

      v17 = objc_autoreleasePoolPush();
      v18 = WeakRetained;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        HMFGetLogIdentifier();
        v33 = v17;
        v21 = v20 = v13;
        HMFBooleanToString();
        v22 = v34 = v12;
        [v16 UUIDString];
        v23 = v35 = v16;
        *buf = 138544130;
        v38 = v21;
        v39 = 2112;
        v40 = v22;
        v41 = 2112;
        v42 = v20;
        v43 = 2112;
        v44 = v23;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Request for unique PSK results successful. PSK: %@, Client Identifier: %@, Network Router UUID: %@", buf, 0x2Au);

        v16 = v35;
        v12 = v34;

        v13 = v20;
        v17 = v33;
      }

      objc_autoreleasePoolPop(v17);
      if (v12 && v13 && v16)
      {
        v24 = [[HMDAccessoryNetworkCredential alloc] initWithNetworkRouterUUID:v16 clientIdentifier:v13 wiFiPSK:v12];
        v25 = *(*(a1 + 32) + 16);
      }

      else
      {
        v26 = objc_autoreleasePoolPush();
        v27 = v18;
        v28 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v36 = v16;
          v30 = v29 = v13;
          *buf = 138543362;
          v38 = v30;
          _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_ERROR, "%{public}@Missing info in response", buf, 0xCu);

          v13 = v29;
          v16 = v36;
        }

        objc_autoreleasePoolPop(v26);
        v31 = *(a1 + 32);
        v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        v25 = *(v31 + 16);
      }

      v25();
    }
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)_createUniquePSKClientConfigurationWithRequestMessage:(id)a3 pairingEvent:(id)a4 completion:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __112__HMDHome_NetworkRouterInternal___createUniquePSKClientConfigurationWithRequestMessage_pairingEvent_completion___block_invoke;
  aBlock[3] = &unk_27867E540;
  objc_copyWeak(&v19, &location);
  v11 = v9;
  v16 = v11;
  v12 = v8;
  v17 = v12;
  v13 = v10;
  v18 = v13;
  v14 = _Block_copy(aBlock);
  [(HMDHome *)self _requestUniquePSKClientConfigurationWithCompletion:v14];

  objc_destroyWeak(&v19);
  objc_destroyWeak(&location);
}

void __112__HMDHome_NetworkRouterInternal___createUniquePSKClientConfigurationWithRequestMessage_pairingEvent_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v11 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v7 = *(a1 + 48);
    if (v5)
    {
      v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:98 description:0 reason:0 suggestion:0 underlyingError:v5];
      (*(v7 + 16))(v7, v11, v8);
    }

    else
    {
      (*(v7 + 16))(v7, v11, 0);
    }
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];

    if (*(a1 + 32))
    {
      v10 = +[HMDMetricsManager sharedLogEventSubmitter];
      [v10 submitLogEvent:*(a1 + 32) error:v9];
    }

    [*(a1 + 40) respondWithError:v9];
  }
}

- (void)_evaluateNetworkProtectionAndRouterManagement
{
  v23 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self _evaluateNetworkProtectionSupport];
  v3 = [(HMDHome *)self activeNetworkRouterAccessory];
  v4 = [v3 networkRouterController];

  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v4)
  {
    if (v8)
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v3 uuid];
      v11 = [v10 UUIDString];
      v12 = [v3 name];
      v17 = 138543874;
      v18 = v9;
      v19 = 2112;
      v20 = v11;
      v21 = 2112;
      v22 = v12;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Found active network router accessory %@/%@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 _configureNetworkRouterClientManager:v3];
  }

  else
  {
    if (v8)
    {
      v13 = HMFGetLogIdentifier();
      v14 = [(HMDHome *)v6 activeNetworkRouterUUID];
      v15 = [v3 name];
      v17 = 138543874;
      v18 = v13;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = v15;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@No active network router accessory with router info %@/%@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 _unconfigureNetworkRouterClientManager];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleNetworkProtectionModeChangeForTransaction:(id)a3
{
  v5 = a3;
  v4 = [v5 userInfo];
  [v4 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"NetworkProtectionModeChanged"];

  [(HMDHome *)self _scheduleApplyNetworkRouterSettingsAction:v5];
}

- (void)_evaluateNetworkRouterManagementForTransaction:(id)a3
{
  v5 = a3;
  v4 = [v5 userInfo];
  [v4 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"EvaluateRouterManagement"];

  [(HMDHome *)self _scheduleApplyNetworkRouterSettingsAction:v5];
}

- (void)_scheduleApplyNetworkRouterSettingsAction:(id)a3
{
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke;
  v3[3] = &unk_27867E518;
  v3[4] = self;
  [a3 addPostApplyActionIfNotPresent:@"HMDNetworkRouterApplySettingsAction" usingBlock:v3];
}

void __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke_2;
  v7[3] = &unk_27868A750;
  v5 = *(a1 + 32);
  v8 = v3;
  v9 = v5;
  v6 = v3;
  dispatch_async(v4, v7);
}

void __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"EvaluateRouterManagement"];

  if (v3)
  {
    [*(a1 + 40) _evaluateNetworkProtectionAndRouterManagement];
  }

  v4 = [*(a1 + 32) userInfo];
  v5 = [v4 objectForKeyedSubscript:@"NetworkProtectionModeChanged"];

  if (v5)
  {
    v6 = [MEMORY[0x277CCAB98] defaultCenter];
    [v6 postNotificationName:@"HMDHomeNetworkProtectionUpdatedNotificationKey" object:*(a1 + 40)];
  }
}

- (void)handleAccessoryDidRemoveNetworkRouterControllerNotification:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __94__HMDHome_NetworkRouterInternal__handleAccessoryDidRemoveNetworkRouterControllerNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __94__HMDHome_NetworkRouterInternal__handleAccessoryDidRemoveNetworkRouterControllerNotification___block_invoke(uint64_t a1)
{
  v17 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"HMDNetworkRouterAccessoryNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (!v5)
  {
    _HMFPreconditionFailure();
  }

  v6 = [*(a1 + 40) activeNetworkRouterAccessory];
  v7 = [v6 isEqual:v5];
  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 40);
  v10 = HMFGetOSLogHandle();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
  if (v7)
  {
    if (v11)
    {
      v12 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v12;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed network router profile for active network router accessory", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    [*(a1 + 40) _addTransactionForActiveNetworkRouterAccessory:0 isReplacement:0];
  }

  else
  {
    if (v11)
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v13;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed network router profile for non-active network router accessory", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)handleAccessoryDidAddNetworkRouterControllerNotification:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __91__HMDHome_NetworkRouterInternal__handleAccessoryDidAddNetworkRouterControllerNotification___block_invoke;
  v7[3] = &unk_27868A750;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __91__HMDHome_NetworkRouterInternal__handleAccessoryDidAddNetworkRouterControllerNotification___block_invoke(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"HMDNetworkRouterAccessoryNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (!v5)
  {
    _HMFPreconditionFailure();
  }

  v6 = [v5 uuid];
  v7 = [*(a1 + 40) activeNetworkRouterUUID];
  v8 = [v6 isEqual:v7];

  v9 = objc_autoreleasePoolPush();
  v10 = *(a1 + 40);
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v8)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      v14 = [v5 uuid];
      v19 = 138543618;
      v20 = v13;
      v21 = 2112;
      v22 = v14;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Added network router controller is for active network router accessory %@", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    [*(a1 + 40) _evaluateNetworkProtectionAndRouterManagement];
  }

  else
  {
    if (v12)
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v5 uuid];
      v17 = [*(a1 + 40) activeNetworkRouterUUID];
      v19 = 138543874;
      v20 = v15;
      v21 = 2112;
      v22 = v16;
      v23 = 2112;
      v24 = v17;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_INFO, "%{public}@Ignoring added network router controller for accessory %@ since it is not for the active network router accessory %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_unconfigureNetworkRouterClientManager
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self routerClientManager];
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v7;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Shutting down firewall rule manager and network router client manager", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [v3 stop];
    [(HMDHome *)v5 setRouterClientManager:0];
    v8 = +[HMDNetworkRouterFirewallRuleManager sharedInstance];
    [v8 shutdownForClient:v3];
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_configureNetworkRouterClientManager:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self supportsRouterManagement])
  {
    v5 = [(HMDHome *)self routerClientManager];

    if (v5)
    {
      v6 = [(HMDHome *)self routerClientManager];
      [v6 replaceActiveNetworkRouterAccessory:v4];
    }

    else
    {
      v7 = objc_autoreleasePoolPush();
      v8 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        v11 = [v4 name];
        v12 = [v4 uuid];
        v13 = [v12 UUIDString];
        *buf = 138543874;
        v27 = v10;
        v28 = 2112;
        v29 = v11;
        v30 = 2112;
        v31 = v13;
        _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Creating network router client manager with accessory %@/%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v7);
      v14 = +[HMDNetworkRouterFirewallRuleManager sharedInstance];
      v15 = [HMDNetworkRouterClientManager alloc];
      v16 = [(HMDHome *)v8 workQueue];
      v17 = [MEMORY[0x277CCAB98] defaultCenter];
      v18 = [(HMDNetworkRouterClientManager *)v15 initWithNetworkRouterAccessory:v4 workQueue:v16 firewallRuleManager:v14 notificationCenter:v17];
      [(HMDHome *)v8 setRouterClientManager:v18];

      v19 = [(HMDHome *)v8 routerClientManager];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke;
      v25[3] = &unk_27868A250;
      v25[4] = v8;
      [v14 startupForClient:v19 completion:v25];

      v20 = [(HMDHome *)v8 residentDeviceManager];
      v21 = [(HMDHome *)v8 routerClientManager];
      [v20 addDataSource:v21];

      v22 = [(HMDHome *)v8 residentDeviceManager];
      v24[0] = MEMORY[0x277D85DD0];
      v24[1] = 3221225472;
      v24[2] = __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke_84;
      v24[3] = &unk_27868A250;
      v24[4] = v8;
      [v22 confirmWithCompletionHandler:v24];
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543618;
      v11 = v7;
      v12 = 2112;
      v13 = v3;
      _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_ERROR, "%{public}@Firewall rule manager failed to start with error %@", &v10, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  else
  {
    v8 = [*(a1 + 32) routerClientManager];
    [v8 evaluateManagement];
  }

  v9 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke_84(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543618;
    v10 = v7;
    v11 = 2112;
    v12 = v3;
    _os_log_impl(&dword_229538000, v6, OS_LOG_TYPE_INFO, "%{public}@Confirming primary resident with active network router in the home completed with %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveClientConfiguration:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v15 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Received request to remove a client configuration", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 numberForKey:@"HMDH.NetworkClientIdentifierMessageKey"];
  if (v9)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __67__HMDHome_NetworkRouterInternal___handleRemoveClientConfiguration___block_invoke;
    v12[3] = &unk_27868A250;
    v13 = v4;
    [(HMDHome *)v6 _removeClientConfigurationWithIdentifier:v9 completion:v12];
    v10 = v13;
  }

  else
  {
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [v4 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

uint64_t __67__HMDHome_NetworkRouterInternal___handleRemoveClientConfiguration___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithPayload:0];
  }
}

- (void)_handleCreateUniquePSKClientConfiguration:(id)a3
{
  v41 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    *&buf[4] = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Received request to create a unique PSK client configuration", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [(HMDHome *)v6 activeNetworkRouterAccessory];
  v28 = MEMORY[0x277D85DD0];
  v29 = 3221225472;
  v30 = __76__HMDHome_NetworkRouterInternal___handleCreateUniquePSKClientConfiguration___block_invoke;
  v31 = &unk_27867E4F0;
  v32 = v6;
  v33 = v4;
  v10 = v4;
  v11 = v9;
  v12 = &v28;
  v13 = generateWiFiUniquePreSharedKey();
  v14 = [v13 dataUsingEncoding:{1, v28, v29}];

  v15 = [v11 networkRouterController];
  v16 = v15;
  if (v14 && v15)
  {
    v17 = [HMDNetworkRouterClientConfiguration configurationForOpenProtectionWithClientIdentifier:0];
    v18 = objc_alloc_init(HMDNetworkRouterCredential);
    [v17 setCredential:v18];

    v19 = [v17 credential];
    [v19 setPsk:v14];

    *buf = MEMORY[0x277D85DD0];
    *&buf[8] = 3221225472;
    *&buf[16] = __HMDCreateUniquePSKClientConfiguration_block_invoke;
    v35 = &unk_2786862E8;
    v40 = v12;
    v20 = v16;
    v36 = v20;
    v37 = v17;
    v38 = v11;
    v39 = v14;
    v21 = v17;
    [v20 writeManagedNetworkEnable:1 completion:buf];
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      v25 = v24;
      v26 = @"no router controller found";
      if (v16)
      {
        v26 = @"PSK generation";
      }

      *buf = 138543618;
      *&buf[4] = v24;
      *&buf[12] = 2112;
      *&buf[14] = v26;
      _os_log_impl(&dword_229538000, v23, OS_LOG_TYPE_ERROR, "%{public}@Failed to create unique PSK client configuration due to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
    v30(v12, 0, v21);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __76__HMDHome_NetworkRouterInternal___handleCreateUniquePSKClientConfiguration___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v6)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v26 = v11;
      v27 = 2112;
      v28 = v6;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to create a unique PSK client configuration with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    [*(a1 + 40) respondWithError:v6];
  }

  else
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v5 clientIdentifier];
      v14 = [v5 networkRouterUUID];
      v15 = [v14 UUIDString];
      *buf = 138543874;
      v26 = v12;
      v27 = 2112;
      v28 = v13;
      v29 = 2112;
      v30 = v15;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Created unique PSK client configuration with client identifier %@ on network router %@ for remote request", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
    v16 = *(a1 + 40);
    v17 = [v5 clientIdentifier];
    v24[0] = v17;
    v23[1] = @"HMDH.UniquePSKMessageKey";
    v18 = [v5 wiFiPSK];
    v24[1] = v18;
    v23[2] = @"HMDH.NetworkRouterUUIDMessageKey";
    v19 = [v5 networkRouterUUID];
    v20 = [v19 UUIDString];
    v24[2] = v20;
    v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v24 forKeys:v23 count:3];
    [v16 respondWithPayload:v21];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3
{
  v7 = a3;
  v4 = [v7 stringForKey:@"kHomedVersionKey"];
  if (v4)
  {
    v5 = [[HMDHomeKitVersion alloc] initWithString:v4];
    if (v5)
    {
      [(HMDHome *)self _addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:v5 message:v7];
    }

    else
    {
      v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v7 respondWithError:v6];
    }
  }

  else
  {
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v7 respondWithError:v5];
  }
}

- (void)_handleSetMinimumNetworkRouterHomeKitVersion:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:@"kHomedVersionKey"];
  v6 = [[HMDHomeKitVersion alloc] initWithString:v5];
  if (v6)
  {
    v7 = +[HMDHomeKitVersion currentVersion];
    if ([v7 isGreaterThanVersion:v6])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = [(HMDHomeKitVersion *)v6 versionString];
        [v7 versionString];
        v13 = v16 = v8;
        *buf = 138543874;
        v18 = v11;
        v19 = 2112;
        v20 = v12;
        v21 = 2112;
        v22 = v13;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Attempting to set the network router support HomeKit version to %@ - lower than version of HomeKit on this device - %@", buf, 0x20u);

        v8 = v16;
      }

      objc_autoreleasePoolPop(v8);
    }

    [(HMDHome *)self _addTransactionForMinimumNetworkRouterHomeKitVersion:v6 message:v4];
  }

  else
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v14];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateNetworkProtection:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 numberForKey:*MEMORY[0x277CD23D8]];
  if (!v5)
  {
    v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
LABEL_9:
    [v4 respondWithError:v7];
    goto LABEL_10;
  }

  v15 = 0;
  v6 = [(HMDHome *)self checkForNetworkRouterSupport:1 error:&v15];
  v7 = v15;
  if (!v6)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v12 = HMDNetworkRouterSupportAsString([(HMDHome *)v9 networkRouterSupport]);
      *buf = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = v12;
      v20 = 2112;
      v21 = v7;
      _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot update home network protection mode - networkRouterSupport %@ error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    goto LABEL_9;
  }

  if ([v5 integerValue] > 1)
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v14];
  }

  else
  {
    [(HMDHome *)self _addTransactionWithProtectionMode:v5 message:v4];
  }

LABEL_10:

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3 message:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [HMDHomeNetworkRouterSettingsModel alloc];
  v9 = [(HMDHome *)self uuid];
  v10 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:v9];
  v11 = [(HMDHome *)self uuid];
  v16 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v10 parentUUID:v11];

  v12 = [v7 versionString];

  [(HMDHomeNetworkRouterSettingsModel *)v16 setMinHomeKitVersionForAccessoryNetworkProtectionChange:v12];
  v13 = [(HMDHome *)self backingStore];
  v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v15 = [v13 transaction:@"Update Minimum HomeKit Version For Accessory Network Protection Change" options:v14];

  [v15 add:v16 withMessage:v6];
  [v15 run];
}

- (void)_addTransactionForMinimumNetworkRouterHomeKitVersion:(id)a3 message:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [HMDHomeNetworkRouterSettingsModel alloc];
  v9 = [(HMDHome *)self uuid];
  v10 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:v9];
  v11 = [(HMDHome *)self uuid];
  v16 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v10 parentUUID:v11];

  v12 = [v7 versionString];

  [(HMDHomeNetworkRouterSettingsModel *)v16 setMinimumNetworkRouterSupportHomeKitVersion:v12];
  v13 = [(HMDHome *)self backingStore];
  v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v15 = [v13 transaction:@"Update Minimum Network Router Support HomeKit Version" options:v14];

  [v15 add:v16 withMessage:v6];
  [v15 run];
}

- (void)_clearAccessoryNetworkProtectionStateWithTransaction:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [(HMDHome *)self accessories];
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v16;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v16 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v15 + 1) + 8 * i);
        v11 = [v10 networkRouterUUID];
        if (v11)
        {
        }

        else
        {
          v12 = [v10 networkClientIdentifier];

          if (!v12)
          {
            continue;
          }
        }

        v13 = [v10 transactionWithObjectChangeType:2];
        [v13 setNetworkRouterUUID:0];
        [v13 setNetworkClientIdentifier:0];
        [v13 setNetworkClientProfileFingerprint:0];
        [v13 setAppliedFirewallWANRules:0];
        [v13 setNetworkClientLAN:&unk_283E73AC0];
        [v13 setCurrentNetworkProtectionMode:&unk_283E73AD8];
        [v4 add:v13];
      }

      v7 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v7);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_updateActiveNetworkRouterAccessory:(id)a3 isReplacement:(BOOL)a4 withTransaction:(id)a5
{
  v5 = a4;
  v22 = a5;
  v8 = a3;
  v9 = [HMDHomeNetworkRouterSettingsModel alloc];
  v10 = [(HMDHome *)self uuid];
  v11 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:v10];
  v12 = [(HMDHome *)self uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:v11 parentUUID:v12];

  v14 = [v8 uuid];

  v15 = [v14 UUIDString];

  [(HMDHomeNetworkRouterSettingsModel *)v13 setActiveNetworkRouterAccessoryUUID:v15];
  if (v5)
  {
    v16 = 0;
  }

  else
  {
    v16 = v15;
  }

  [(HMDHomeNetworkRouterSettingsModel *)v13 setActiveNetworkRouterInitialSetupNeededUUID:v16];
  [v22 add:v13];
  if (!v5)
  {
    v17 = [HMDHomeModel alloc];
    v18 = [(HMDHome *)self uuid];
    v19 = [(HMDHome *)self homeManager];
    v20 = [v19 uuid];
    v21 = [(HMDBackingStoreModelObject *)v17 initWithObjectChangeType:2 uuid:v18 parentUUID:v20];

    [(HMDHomeModel *)v21 setNetworkProtectionMode:&unk_283E73AA8];
    [v22 add:v21];
  }
}

- (void)_addTransactionWithProtectionMode:(id)a3 message:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [HMDHomeModel alloc];
  v9 = [(HMDHome *)self uuid];
  v10 = [(HMDHome *)self homeManager];
  v11 = [v10 uuid];
  v12 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v9 parentUUID:v11];

  [(HMDHomeModel *)v12 setNetworkProtectionMode:v7];
  v13 = [(HMDHome *)self backingStore];
  v14 = [v6 name];
  v15 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v16 = [v13 transaction:v14 options:v15];

  [v16 add:v12 withMessage:v6];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __76__HMDHome_NetworkRouterInternal___addTransactionWithProtectionMode_message___block_invoke;
  v18[3] = &unk_27868A1D8;
  v19 = v6;
  v20 = self;
  v17 = v6;
  [v16 run:v18];
}

void __76__HMDHome_NetworkRouterInternal___addTransactionWithProtectionMode_message___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v8 = *MEMORY[0x277CD23D8];
    v5 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(*(a1 + 40), "protectionMode")}];
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [v2 respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (unint64_t)deriveNetworkRouterSupport:(unint64_t)a3
{
  v3 = a3;
  v4 = 4;
  if ((a3 & 8) == 0)
  {
    v4 = 15;
  }

  if (a3)
  {
    v5 = v4 & 8;
    if ([(HMDHome *)self isOwnerUser])
    {
      v4 = v5;
    }

    else
    {
      v4 = 0;
    }
  }

  if ((v3 & 2) != 0)
  {
    v4 = 0;
  }

  if ((v3 & 4) != 0)
  {
    v4 &= 9u;
  }

  if ((v3 & 0x10) != 0)
  {
    return v4 & 0xFFFFFFFFFFFFFFFDLL;
  }

  else
  {
    return v4;
  }
}

- (BOOL)checkForNetworkRouterSupport:(unint64_t)a3 error:(id *)a4
{
  v5 = a3;
  v6 = [(HMDHome *)self networkRouterSupportDisableReason];
  if ((v5 & 4) != 0)
  {
    if ((v6 & 4) != 0)
    {
      goto LABEL_16;
    }

    if ((v6 & 2) != 0)
    {
      goto LABEL_22;
    }

    if (v6)
    {
      goto LABEL_14;
    }
  }

  if ((v5 & 3) == 0)
  {
    goto LABEL_7;
  }

  if ((v6 & 4) == 0)
  {
    if ((v6 & 8) != 0 || (v6 & 2) != 0)
    {
      goto LABEL_22;
    }

    if (v6)
    {
      goto LABEL_14;
    }

LABEL_7:
    if ((v5 & 2) == 0 || (v6 & 0x10) == 0)
    {
      if ((v5 & 8) == 0)
      {
        return 1;
      }

      if ((v6 & 8) == 0 && (v6 & 2) == 0)
      {
        if ((v6 & 1) == 0)
        {
          return 1;
        }

LABEL_14:
        if (a4)
        {
          v8 = 92;
LABEL_24:
          v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:v8];
          v10 = v9;
          result = 0;
          *a4 = v9;
          return result;
        }

        return 0;
      }
    }

LABEL_22:
    if (a4)
    {
      v8 = 48;
      goto LABEL_24;
    }

    return 0;
  }

LABEL_16:
  if (a4)
  {
    v8 = 17;
    goto LABEL_24;
  }

  return 0;
}

- (HMDHAPAccessory)activeNetworkRouterAccessory
{
  v3 = [(HMDHome *)self activeNetworkRouterUUID];
  v4 = [(HMDHome *)self accessoryWithUUID:v3];

  v5 = v4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  return v6;
}

- (NSArray)wiFiRouterAccessories
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] arrayWithCapacity:1];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v4 = [(HMDHome *)self accessories];
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 networkRouterController];

        if (v12)
        {
          [v3 addObject:v11];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (BOOL)supportsRouterManagement
{
  if (![(HMDHome *)self _isNetworkRouterSupportEnabledForCurrentDevice]|| ![(HMDHome *)self isOwnerUser])
  {
    return 0;
  }

  v3 = [(HMDHome *)self _currentDeviceCapabilities];
  v4 = [v3 supportsRouterManagement];

  return v4;
}

- (BOOL)_isNetworkRouterSupportEnabledForCurrentDevice
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = +[HMDHomeKitVersion currentVersion];
  v4 = [(HMDHome *)self minimumNetworkRouterSupportHomeKitVersion];
  if (v4)
  {
    v5 = v4;
    v6 = [(HMDHome *)self minimumNetworkRouterSupportHomeKitVersion];
    v7 = [v6 isGreaterThanVersion:v3];

    if (v7)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = [(HMDHome *)v9 minimumNetworkRouterSupportHomeKitVersion];
        v13 = [v12 versionString];
        v14 = [v3 versionString];
        v30 = 138543874;
        v31 = v11;
        v32 = 2112;
        v33 = v13;
        v34 = 2112;
        v35 = v14;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Network router support requires minimum HomeKit version of %@ - current %@; disabling", &v30, 0x20u);

LABEL_9:
        goto LABEL_10;
      }

      goto LABEL_10;
    }
  }

  v15 = [(HMDHome *)self activeNetworkRouterAccessory];
  v16 = [v15 primaryProfileVersion];
  if (v16)
  {
    v17 = v16;
    v18 = [(HMDHome *)self activeNetworkRouterAccessory];
    v19 = [v18 primaryProfileVersion];
    v20 = [v19 majorVersion];

    if (v20 >= 2)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v21 = MEMORY[0x277CCABB0];
        v22 = [(HMDHome *)v9 activeNetworkRouterAccessory];
        v23 = [v22 primaryProfileVersion];
        v24 = [v21 numberWithUnsignedInteger:{objc_msgSend(v23, "majorVersion")}];
        v30 = 138543874;
        v31 = v11;
        v32 = 2112;
        v33 = v24;
        v34 = 2112;
        v35 = &unk_283E73A90;
        _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Network router major version %@ not supported on this device - only supports up to major version %@; disabling", &v30, 0x20u);

        goto LABEL_9;
      }

LABEL_10:

      objc_autoreleasePoolPop(v8);
      v25 = 0;
      goto LABEL_17;
    }
  }

  else
  {
  }

  v26 = [MEMORY[0x277D0F8D0] sharedPreferences];
  v27 = [v26 preferenceForKey:@"enableNetworkRouterSupport"];

  v25 = !v27 || [v27 BOOLValue];
LABEL_17:

  v28 = *MEMORY[0x277D85DE8];
  return v25;
}

- (void)updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange
{
  v3 = [(HMDHome *)self actionSets];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __103__HMDHome_HMDActionSetState__updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange__block_invoke;
  v6[3] = &unk_27867F788;
  v6[4] = self;
  v4 = [v3 na_map:v6];

  if ([v4 count])
  {
    v5 = [(HMDHome *)self actionSetStateObserver];
    [v5 stateRegistrationsDidChangeForActionSetUUIDs:v4];
  }
}

id __103__HMDHome_HMDActionSetState__updateLocallyObservedActionSetsOnCurrentDevicePrimaryResidentStatusChange__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) actionSetStateSubscriptionManager];
  v5 = [v3 uuid];
  v6 = [v4 isMonitoringActionSet:v5];

  if (v6)
  {
    v7 = [v3 uuid];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (void)stateObserverStoppedMonitoringCharacteristics:(id)a3
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v4 = [MEMORY[0x277CBEB38] dictionary];
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v5 = v3;
  v6 = [v5 countByEnumeratingWithState:&v33 objects:v38 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v34;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v34 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v33 + 1) + 8 * i);
        v11 = [v10 accessory];
        v12 = v11;
        if (v11)
        {
          v13 = [v11 uuid];
          v14 = [v4 objectForKeyedSubscript:v13];

          if (!v14)
          {
            v15 = [MEMORY[0x277CBEB58] set];
            v16 = [v12 uuid];
            [v4 setObject:v15 forKeyedSubscript:v16];
          }

          v17 = [v12 uuid];
          v18 = [v4 objectForKeyedSubscript:v17];
          [v18 addObject:v10];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v33 objects:v38 count:16];
    }

    while (v7);
  }

  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  v19 = v4;
  v20 = [v19 countByEnumeratingWithState:&v29 objects:v37 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v30;
    do
    {
      for (j = 0; j != v21; ++j)
      {
        if (*v30 != v22)
        {
          objc_enumerationMutation(v19);
        }

        v24 = [v19 objectForKeyedSubscript:{*(*(&v29 + 1) + 8 * j), v29}];
        v25 = [v24 anyObject];
        v26 = [v25 accessory];

        if (v26)
        {
          v27 = [v24 allObjects];
          [v26 setNotificationsEnabled:0 forCharacteristics:v27 clientIdentifier:@"com.apple.HomeKitDaemon.ActionSetStateObserver"];
        }
      }

      v21 = [v19 countByEnumeratingWithState:&v29 objects:v37 count:16];
    }

    while (v21);
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)stateObserverStartedMonitoringCharacteristics:(id)a3 completionHandler:(id)a4
{
  v40 = self;
  v61 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v41 = a4;
  v6 = [MEMORY[0x277CBEB38] dictionary];
  v7 = [MEMORY[0x277CBEB18] array];
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  obj = v5;
  v8 = [obj countByEnumeratingWithState:&v51 objects:v60 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v52;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v52 != v10)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v51 + 1) + 8 * i);
        v13 = [v12 accessory];
        v14 = v13;
        if (v13)
        {
          v15 = [v13 uuid];
          v16 = [v6 objectForKeyedSubscript:v15];

          if (!v16)
          {
            v17 = [MEMORY[0x277CBEB58] set];
            v18 = [v14 uuid];
            [v6 setObject:v17 forKeyedSubscript:v18];
          }

          v19 = [v14 uuid];
          v20 = [v6 objectForKeyedSubscript:v19];
          [v20 addObject:v12];

          v21 = [HMDCharacteristicRequest requestWithCharacteristic:v12];
          [v7 addObject:v21];
        }
      }

      v9 = [obj countByEnumeratingWithState:&v51 objects:v60 count:16];
    }

    while (v9);
  }

  v49 = 0u;
  v50 = 0u;
  v47 = 0u;
  v48 = 0u;
  v22 = v6;
  v23 = [v22 countByEnumeratingWithState:&v47 objects:v59 count:16];
  if (v23)
  {
    v24 = v23;
    v25 = *v48;
    do
    {
      for (j = 0; j != v24; ++j)
      {
        if (*v48 != v25)
        {
          objc_enumerationMutation(v22);
        }

        v27 = [v22 objectForKeyedSubscript:{*(*(&v47 + 1) + 8 * j), v40}];
        v28 = [v27 anyObject];
        v29 = [v28 accessory];

        if (v29)
        {
          v30 = [v27 allObjects];
          [v29 setNotificationsEnabled:1 forCharacteristics:v30 clientIdentifier:@"com.apple.HomeKitDaemon.ActionSetStateObserver"];
        }
      }

      v24 = [v22 countByEnumeratingWithState:&v47 objects:v59 count:16];
    }

    while (v24);
  }

  v31 = objc_autoreleasePoolPush();
  v32 = v40;
  v33 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
  {
    v34 = HMFGetLogIdentifier();
    v35 = [v7 count];
    *buf = 138543618;
    v56 = v34;
    v57 = 2048;
    v58 = v35;
    _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_INFO, "%{public}@Issuing %ld read requests for ActionSetStateObserver", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v31);
  v36 = [v7 copy];
  v43[0] = MEMORY[0x277D85DD0];
  v43[1] = 3221225472;
  v43[2] = __94__HMDHome_HMDActionSetState__stateObserverStartedMonitoringCharacteristics_completionHandler___block_invoke;
  v43[3] = &unk_2786862C0;
  v44 = v7;
  v45 = v32;
  v46 = v41;
  v37 = v41;
  v38 = v7;
  [(HMDHome *)v32 readCharacteristicValues:v36 source:1060 qualityOfService:-1 withCompletionHandler:v43];

  v39 = *MEMORY[0x277D85DE8];
}

void __94__HMDHome_HMDActionSetState__stateObserverStartedMonitoringCharacteristics_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v41 = *MEMORY[0x277D85DE8];
  v24 = a2;
  v28 = a3;
  v26 = [MEMORY[0x277CBEB18] array];
  v27 = a1;
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  obj = *(a1 + 32);
  v5 = [obj countByEnumeratingWithState:&v30 objects:v40 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v31;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v31 != v7)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v30 + 1) + 8 * i);
        v10 = [v9 characteristic];
        v29 = 0;
        v11 = [v28 hmd_valueOfCharacteristic:v10 error:&v29];
        v12 = v29;

        v13 = objc_autoreleasePoolPush();
        v14 = *(v27 + 40);
        v15 = HMFGetOSLogHandle();
        v16 = v15;
        if (v11)
        {
          if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
          {
            v17 = HMFGetLogIdentifier();
            *buf = 138543874;
            v35 = v17;
            v36 = 2112;
            v37 = v9;
            v38 = 2112;
            v39 = v11;
            _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Characteristic read request succeeded when ActionSetStateObserver enabled notifications %@:%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v13);
          v18 = [HMDCharacteristicResponse responseWithRequest:v9 error:0];
          [v18 setValue:v11];
        }

        else
        {
          if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
          {
            v19 = HMFGetLogIdentifier();
            *buf = 138543874;
            v35 = v19;
            v36 = 2112;
            v37 = v9;
            v38 = 2112;
            v39 = v12;
            _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_ERROR, "%{public}@Characteristic read request when ActionSetStateObserver enabled notification failed %@:%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v13);
          if (v24)
          {
            v18 = [HMDCharacteristicResponse responseWithRequest:v9 error:?];
          }

          else
          {
            v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:74];
            v18 = [HMDCharacteristicResponse responseWithRequest:v9 error:v20];
          }
        }

        [v26 addObject:v18];
      }

      v6 = [obj countByEnumeratingWithState:&v30 objects:v40 count:16];
    }

    while (v6);
  }

  v21 = *(v27 + 48);
  v22 = [v26 copy];
  (*(v21 + 16))(v21, v22);

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_notifyChangedActionSetResponses:(id)a3 notificationUpdateIdentifier:(id)a4 toUserDeviceAddress:(id)a5
{
  v32 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v11);

  if (v10)
  {
    v12 = [(HMDHome *)self notificationHandlerMap];
    v13 = [v12 objectForKey:v10];

    if (!v13)
    {
      v14 = [(HMDHome *)self homeManager];
      v27 = 0u;
      v28 = 0u;
      v29 = 0u;
      v30 = 0u;
      v15 = [v14 watchManager];
      v16 = [v15 connectedWatches];

      v17 = [v16 countByEnumeratingWithState:&v27 objects:v31 count:16];
      if (v17)
      {
        v26 = v14;
        v18 = *v28;
        while (2)
        {
          for (i = 0; i != v17; ++i)
          {
            if (*v28 != v18)
            {
              objc_enumerationMutation(v16);
            }

            v20 = [*(*(&v27 + 1) + 8 * i) remoteDestinationString];
            v21 = [v20 isEqual:v10];

            if (v21)
            {
              v17 = 1;
              goto LABEL_13;
            }
          }

          v17 = [v16 countByEnumeratingWithState:&v27 objects:v31 count:16];
          if (v17)
          {
            continue;
          }

          break;
        }

LABEL_13:
        v14 = v26;
      }

      v22 = [HMDDeviceNotificationHandler alloc];
      v23 = [(HMDHome *)self msgDispatcher];
      v13 = [(HMDDeviceNotificationHandler *)v22 initWithDestination:v10 watchDevice:v17 withRequestIdentifier:0 messageDispatcher:v23 home:self];

      v24 = [(HMDHome *)self notificationHandlerMap];
      [v24 setObject:v13 forKey:v10];
    }

    [(HMDDeviceNotificationHandler *)v13 sendNotificationForActionSetResponses:v8 notificationUpdateIdentifier:v9];
  }

  v25 = *MEMORY[0x277D85DE8];
}

- (void)_notifyRemoteUsersOfChangedActionSetResponses:(id)a3
{
  v48 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  v33 = v7;
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v42 = v9;
    _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Notifying users registered with resident of changes in action sets", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [(HMDHome *)v7 notificationRegistry];
  v11 = [v10 destinationsRegisteredForNotificationsForActionSetResponses:v4];

  v12 = [MEMORY[0x277CBEB58] set];
  v13 = [MEMORY[0x277CCAD78] UUID];
  v34 = [v13 UUIDString];

  v39 = 0u;
  v40 = 0u;
  v37 = 0u;
  v38 = 0u;
  v14 = v11;
  v15 = v7;
  obj = v14;
  v16 = [v14 countByEnumeratingWithState:&v37 objects:v47 count:16];
  if (v16)
  {
    v18 = v16;
    v19 = *v38;
    *&v17 = 138543874;
    v30 = v17;
    v31 = v4;
    v32 = v12;
    v35 = *v38;
    do
    {
      for (i = 0; i != v18; ++i)
      {
        if (*v38 != v19)
        {
          objc_enumerationMutation(obj);
        }

        v21 = *(*(&v37 + 1) + 8 * i);
        v22 = [HMDDevice deviceWithDestination:v21, v30];
        if (v22)
        {
          [v12 addObject:v22];
          if ([(HMDHome *)v15 _shouldSendToDestination:v21 device:v22 remoteSourceDevice:0])
          {
            v23 = [(HMDHome *)v15 notificationRegistry];
            v24 = [v23 filterActionSetResponses:v4 deviceIdsDestination:v21];

            if ([v24 count])
            {
              v25 = objc_autoreleasePoolPush();
              v26 = v15;
              v27 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
              {
                v28 = HMFGetLogIdentifier();
                *buf = v30;
                v42 = v28;
                v43 = 2112;
                v44 = v21;
                v45 = 2112;
                v46 = v34;
                _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_INFO, "%{public}@Fanning out to device %@ with the action sets that changed with notificationUpdateIdentifier: %@", buf, 0x20u);

                v4 = v31;
              }

              objc_autoreleasePoolPop(v25);
              [(HMDHome *)v26 _notifyChangedActionSetResponses:v24 notificationUpdateIdentifier:v34 toUserDeviceAddress:v21];
              v12 = v32;
              v15 = v33;
            }

            v19 = v35;
          }
        }
      }

      v18 = [obj countByEnumeratingWithState:&v37 objects:v47 count:16];
    }

    while (v18);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)notifyRemoteUsersOfChangedActionSetResponses:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __75__HMDHome_HMDActionSetState__notifyRemoteUsersOfChangedActionSetResponses___block_invoke;
  v7[3] = &unk_27868A750;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)_remotelySetNotificationsEnabled:(BOOL)a3 forActionSetUUIDs:(id)a4
{
  v42 = *MEMORY[0x277D85DE8];
  v6 = a4;
  v30 = self;
  v7 = [(HMDHome *)self primaryResident];
  v8 = [v7 capabilities];
  v9 = [v8 supportsResidentActionSetStateEvaluation];

  if (v9)
  {
    v10 = [(HMDHome *)v30 workQueue];
    dispatch_assert_queue_V2(v10);

    if (a3)
    {
      v11 = [(HMDHome *)v30 actionSetsEnableNotificationPayload];
      [(HMDHome *)v30 actionSetsDisableNotificationPayload];
    }

    else
    {
      v11 = [(HMDHome *)v30 actionSetsDisableNotificationPayload];
      [(HMDHome *)v30 actionSetsEnableNotificationPayload];
    }
    v12 = ;
    v33 = 0u;
    v34 = 0u;
    v31 = 0u;
    v32 = 0u;
    v27 = v6;
    v13 = v6;
    v14 = [v13 countByEnumeratingWithState:&v31 objects:v41 count:16];
    if (v14)
    {
      v15 = v14;
      v16 = *v32;
      v28 = v11;
      v29 = v12;
      do
      {
        for (i = 0; i != v15; ++i)
        {
          if (*v32 != v16)
          {
            objc_enumerationMutation(v13);
          }

          v18 = [*(*(&v31 + 1) + 8 * i) UUIDString];
          if (([v11 containsObject:v18] & 1) == 0)
          {
            [v11 addObject:v18];
          }

          if ([v12 containsObject:v18])
          {
            [v12 removeObject:v18];
            v19 = objc_autoreleasePoolPush();
            v20 = v30;
            v21 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
            {
              v22 = HMFGetLogIdentifier();
              HMFBooleanToString();
              v23 = v16;
              v25 = v24 = v13;
              *buf = 138543874;
              v36 = v22;
              v37 = 2112;
              v38 = v25;
              v39 = 2112;
              v40 = v18;
              _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@Function call to set notification to %@, removing the entry %@ from the other action set payload", buf, 0x20u);

              v13 = v24;
              v16 = v23;

              v11 = v28;
              v12 = v29;
            }

            objc_autoreleasePoolPop(v19);
          }
        }

        v15 = [v13 countByEnumeratingWithState:&v31 objects:v41 count:16];
      }

      while (v15);
    }

    if ([v11 count] || objc_msgSend(v12, "count"))
    {
      [(HMDHome *)v30 _createModifyNotificationsCoalesceTimerIfNeeded];
    }

    v6 = v27;
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)remotelySetNotificationsEnabled:(BOOL)a3 forActionSetUUIDs:(id)a4
{
  v6 = a4;
  v7 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __80__HMDHome_HMDActionSetState__remotelySetNotificationsEnabled_forActionSetUUIDs___block_invoke;
  block[3] = &unk_278688BD0;
  v11 = a3;
  block[4] = self;
  v10 = v6;
  v8 = v6;
  dispatch_sync(v7, block);
}

- (id)createMultiuserSettingsMessenger:(id)a3 messageDispatcher:(id)a4
{
  v22 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = [v6 uuid];
    v16 = 138543874;
    v17 = v11;
    v18 = 2112;
    v19 = v12;
    v20 = 2112;
    v21 = v7;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Creating Multiuser settings messenger with current home UUID: %@ message dispatcher: %@", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  v13 = [[HMDMultiuserSettingsMessenger alloc] initWithHome:v6 messageDispatcher:v7];

  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (void)configureMultiuserSettingsMessengerWithMessengerFactory:(id)a3
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [(HMDHome *)v6 home];
    v14 = 138543618;
    v15 = v8;
    v16 = 2112;
    v17 = v9;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Configuring Multiuser settings messenger %@", &v14, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [(HMDHome *)v6 home];
  v11 = [(HMDHome *)v6 msgDispatcher];
  v12 = [v4 createMultiuserSettingsMessenger:v10 messageDispatcher:v11];

  [v12 registerForMessages];
  [(HMDHome *)v6 setMultiuserSettingsMessenger:v12];

  v13 = *MEMORY[0x277D85DE8];
}

- (BOOL)_processTestModeSkipHH2MigrationOverride:(id)a3 error:(id *)a4
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = [v5 hmf_BOOLForKey:@"kConfigTestingSkipMigrationCheckOverrideKey"];
  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v13 = 138543618;
    v14 = v10;
    v15 = 1024;
    v16 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_INFO, "%{public}@Setting for HH2 skip migration check override to %{BOOL}d", &v13, 0x12u);
  }

  objc_autoreleasePoolPop(v7);
  [(HMDHome *)v8 setOverrideSentinelZoneForConvergencePeriod:v6];

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)isThisHomeMigratedToHH2
{
  v44 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self homeManager];
  v4 = v3;
  if (v3)
  {
    v5 = [v3 hh2FrameworkSwitch];

    if (v5)
    {
      v6 = [(HMDHome *)self owner];
      v7 = [v6 isCurrentUser];

      v8 = [v4 hh2FrameworkSwitch];
      v9 = [v8 checkExistenceOfHH2SentinelZone];

      v10 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
      {
        v13 = HMFGetLogIdentifier();
        v14 = HMFBooleanToString();
        HMFBooleanToString();
        v15 = v33 = v7;
        [(HMDHome *)v11 isUpdatedToHH2];
        v16 = HMFBooleanToString();
        v17 = HMFBooleanToString();
        *buf = 138544386;
        v35 = v13;
        v36 = 2112;
        v37 = v14;
        v38 = 2112;
        v39 = v15;
        v40 = 2112;
        v41 = v16;
        v42 = 2112;
        v43 = v17;
        _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_DEBUG, "%{public}@[HH2 Sentinel zone exist : %@], [isOwner: %@], [Is Shared Home Updated to HH2: %@], [Running in HH2 daemon: %@]", buf, 0x34u);

        v7 = v33;
      }

      objc_autoreleasePoolPop(v10);
      if ((v9 & 1) == 0)
      {
        v18 = [v4 isCloudKitRequiredForHH2];
        v19 = objc_autoreleasePoolPush();
        v20 = v11;
        v21 = HMFGetOSLogHandle();
        v22 = os_log_type_enabled(v21, OS_LOG_TYPE_INFO);
        if (v18)
        {
          if (v22)
          {
            v23 = HMFGetLogIdentifier();
            [(HMDHome *)v20 overrideSentinelZoneForConvergencePeriod];
            v24 = HMFBooleanToString();
            *buf = 138543618;
            v35 = v23;
            v36 = 2112;
            v37 = v24;
            _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@This is an invalid configuration but allowed during development & convergence period. If that is the case please ignore this message. [Override = %@]", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v19);
          v25 = [(HMDHome *)v20 overrideSentinelZoneForConvergencePeriod];
          if (!(v7 & 1 | ((v25 & 1) == 0)))
          {
            v25 = [(HMDHome *)v20 isUpdatedToHH2];
          }

          goto LABEL_18;
        }

        if (v22)
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543362;
          v35 = v30;
          _os_log_impl(&dword_229538000, v21, OS_LOG_TYPE_INFO, "%{public}@CloudKit is not required in this configuration, pretending that the sentinel zone exists", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v19);
      }

      v25 = 1;
      goto LABEL_18;
    }
  }

  v26 = objc_autoreleasePoolPush();
  v27 = self;
  v28 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT))
  {
    v29 = HMFGetLogIdentifier();
    *buf = 138543362;
    v35 = v29;
    _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to find a valid instance of homeManager or this OS is not capable of running ROAR. Marking this home as not migrated to ROAR", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v26);
  v25 = 0;
LABEL_18:

  v31 = *MEMORY[0x277D85DE8];
  return v25;
}

- (unint64_t)accessNotAllowedReasonCode
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
  {
    v6 = HMFGetLogIdentifier();
    v9 = 138543618;
    v10 = v6;
    v11 = 2048;
    v12 = 1;
    _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Home access is not allowed with reason code : %lu", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  v7 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)_isAccessToHomeAllowed
{
  v3 = [(HMDHome *)self isThisHomeMigratedToHH2];
  if (!v3)
  {
    v4 = [(HMDHome *)self homeManager];
    [v4 isHH1EOLEnabled];
  }

  return v3;
}

- (void)storeMigrationCharacteristicsAuthorizationData
{
  v45 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = [(HMDHome *)self currentUser];
  v5 = [v4 isOwner];

  if (v5)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [(HMDHome *)v7 name];
      *buf = 138543618;
      v40 = v9;
      v41 = 2112;
      v42 = v10;
      _os_log_impl(&dword_229538000, v8, OS_LOG_TYPE_INFO, "%{public}@Skipping characteristic authorization archiving for home: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  else
  {
    v11 = [MEMORY[0x277CBEB38] dictionary];
    v12 = [(HMDHome *)self hapAccessories];
    v37[0] = MEMORY[0x277D85DD0];
    v37[1] = 3221225472;
    v37[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke;
    v37[3] = &unk_278682958;
    v13 = v11;
    v38 = v13;
    [v12 na_each:v37];

    v14 = [v13 count];
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    v18 = v17;
    if (v14)
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        v20 = [(HMDHome *)v16 name];
        *buf = 138543874;
        v40 = v19;
        v41 = 2112;
        v42 = v20;
        v43 = 2112;
        v44 = v13;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Archiving characteristic authorization data for migration for home: %@, [%@]", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
      v21 = [objc_alloc(MEMORY[0x277CCAAB0]) initRequiringSecureCoding:1];
      [v21 encodeObject:v13 forKey:*MEMORY[0x277CCA308]];
      [v21 finishEncoding];
      v22 = [v21 encodedData];
      if (v22)
      {
        v23 = [(HMDHome *)v16 uuid];
        v24 = getAccessoryAuthorizationsSettingsSerializedFilePath(v23);

        v25 = [HMDPersistentStore writeData:v22 toStorePath:v24 dataLabel:@"CharacteristicAuthorizationData"];
        v26 = objc_autoreleasePoolPush();
        v27 = v16;
        v28 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_DEBUG))
        {
          v29 = HMFGetLogIdentifier();
          *buf = 138543874;
          v40 = v29;
          v41 = 2112;
          v42 = v25;
          v43 = 2112;
          v44 = v24;
          _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_DEBUG, "%{public}@Stored characteristic authorization data ([%@] bytes) to [%@]", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v26);
      }

      else
      {
        v32 = objc_autoreleasePoolPush();
        v33 = v16;
        v34 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
        {
          v35 = HMFGetLogIdentifier();
          *buf = 138543362;
          v40 = v35;
          _os_log_impl(&dword_229538000, v34, OS_LOG_TYPE_ERROR, "%{public}@Unable to store characteristic authorization data during migration, archived data is nil", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v32);
      }
    }

    else
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
      {
        v30 = HMFGetLogIdentifier();
        v31 = [(HMDHome *)v16 name];
        *buf = 138543618;
        v40 = v30;
        v41 = 2112;
        v42 = v31;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEBUG, "%{public}@No characteristic authorization data to migrate for home: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
    }
  }

  objc_autoreleasePoolPop(v3);
  v36 = *MEMORY[0x277D85DE8];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 services];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_2;
  v6[3] = &unk_278682930;
  v7 = *(a1 + 32);
  v8 = v3;
  v5 = v3;
  [v4 na_each:v6];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 characteristics];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_3;
  v4[3] = &unk_278682908;
  v5 = *(a1 + 32);
  v6 = *(a1 + 40);
  [v3 na_each:v4];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_3(uint64_t a1, void *a2)
{
  v15 = a2;
  v3 = [v15 getCharacteristicDictionary];
  v4 = [v3 objectForKeyedSubscript:*MEMORY[0x277CD2100]];

  if (v4)
  {
    v5 = *(a1 + 32);
    v6 = [*(a1 + 40) uuid];
    v7 = [v5 objectForKeyedSubscript:v6];

    if (!v7)
    {
      v8 = [MEMORY[0x277CBEB38] dictionary];
      v9 = *(a1 + 32);
      v10 = [*(a1 + 40) uuid];
      [v9 setObject:v8 forKeyedSubscript:v10];
    }

    v11 = *(a1 + 32);
    v12 = [*(a1 + 40) uuid];
    v13 = [v11 objectForKeyedSubscript:v12];
    v14 = [v15 instanceID];
    [v13 setObject:v4 forKeyedSubscript:v14];
  }
}

+ (id)loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID__onceToken != -1)
  {
    dispatch_once(&loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID__onceToken, &__block_literal_global_221326);
  }

  v5 = getAccessoryAuthorizationsSettingsSerializedFilePath(v4);
  v6 = [MEMORY[0x277CCAA00] defaultManager];
  v7 = [v6 fileExistsAtPath:v5];

  if (v7)
  {
    v33 = 0;
    v8 = [MEMORY[0x277CBEA90] dataWithContentsOfFile:v5 options:2 error:&v33];
    v9 = v33;
    v10 = v9;
    if (!v8 || v9)
    {
      v24 = objc_autoreleasePoolPush();
      v25 = a1;
      v26 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        v27 = HMFGetLogIdentifier();
        *buf = 138543874;
        v35 = v27;
        v36 = 2112;
        v37 = v5;
        v38 = 2112;
        v39 = v10;
        _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Unable to read data from file : %@ / %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v24);
      v15 = 0;
    }

    else
    {
      v32 = 0;
      v11 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClasses:loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID__allowedClasses fromData:v8 error:&v32];
      v12 = v32;
      v10 = v12;
      if (!v11 || v12)
      {
        v16 = objc_autoreleasePoolPush();
        v28 = a1;
        v18 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
        {
          v29 = HMFGetLogIdentifier();
          *buf = 138543618;
          v35 = v29;
          v36 = 2112;
          v37 = v10;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to unarchive characteristic authorization data: %@", buf, 0x16u);
        }

        v15 = 0;
      }

      else
      {
        v13 = v11;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        v16 = objc_autoreleasePoolPush();
        v17 = a1;
        v18 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
        {
          v19 = HMFGetLogIdentifier();
          *buf = 138543874;
          v35 = v19;
          v36 = 2112;
          v37 = v4;
          v38 = 2112;
          v39 = v15;
          _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEBUG, "%{public}@Found characteristic authorization data for migration of home: %@: [%@]", buf, 0x20u);
        }
      }

      objc_autoreleasePoolPop(v16);
    }
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    v21 = a1;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEBUG))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543618;
      v35 = v23;
      v36 = 2112;
      v37 = v5;
      _os_log_impl(&dword_229538000, v22, OS_LOG_TYPE_DEBUG, "%{public}@No characteristic authorization file found at %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v15 = 0;
  }

  v30 = *MEMORY[0x277D85DE8];

  return v15;
}

void __110__HMDHome_CharacteristicAuthorizationData__loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID___block_invoke()
{
  v5[6] = *MEMORY[0x277D85DE8];
  v0 = MEMORY[0x277CBEB98];
  v5[0] = objc_opt_class();
  v5[1] = objc_opt_class();
  v5[2] = objc_opt_class();
  v5[3] = objc_opt_class();
  v5[4] = objc_opt_class();
  v5[5] = objc_opt_class();
  v1 = [MEMORY[0x277CBEA60] arrayWithObjects:v5 count:6];
  v2 = [v0 setWithArray:v1];
  v3 = loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID__allowedClasses;
  loadMigrationCharacteristicsAuthorizationDataFromDiskWithHomeUUID__allowedClasses = v2;

  v4 = *MEMORY[0x277D85DE8];
}

+ (void)removeCharacteristicAuthorizationDataMigrationFileFromDiskWithhHomeUUID:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_alloc(MEMORY[0x277CBEBC0]);
  v6 = getAccessoryAuthorizationsSettingsSerializedFilePath(v4);
  v7 = [v5 initFileURLWithPath:v6];

  v8 = [MEMORY[0x277CCAA00] defaultManager];
  v15 = 0;
  [v8 removeItemAtURL:v7 error:&v15];
  v9 = v15;

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = a1;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = v9;
      _os_log_impl(&dword_229538000, v12, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while removing accessory authorization migration file from disk : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_unitTest_setRetrievalCompletionsTimeout:(double)a3
{
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  v6 = [v5 copy];

  os_unfair_recursive_lock_unlock();
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke;
  v7[3] = &unk_278681DA0;
  v7[4] = self;
  *&v7[5] = a3;
  [v6 na_each:v7];
}

void __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke_2;
  v6[3] = &unk_27868A0D0;
  v7 = v3;
  v8 = *(a1 + 40);
  v5 = v3;
  dispatch_async(v4, v6);
}

uint64_t __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) stop];
  [*(a1 + 32) setRetrievalTimeout:*(a1 + 40)];
  v2 = *(a1 + 32);

  return [v2 start];
}

- (void)_notifyRetrievalError:(id)a3 accessoryServer:(id)a4 linkType:(int64_t)a5 accessoryOperationBlock:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a6;
  v13 = [(HMDHome *)self hapAccessories];
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke;
  v17[3] = &unk_278681D78;
  v18 = v11;
  v19 = self;
  v21 = v12;
  v22 = a5;
  v20 = v10;
  v14 = v10;
  v15 = v12;
  v16 = v11;
  [v13 na_each:v17];
}

void __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 matchesHAPAccessoryWithServerIdentifier:*(a1 + 32) linkType:0])
  {
    v4 = _Block_copy(*(a1 + 56));
    v5 = v4;
    if (v4)
    {
      (*(v4 + 2))(v4, v3);
    }

    v6 = [*(a1 + 40) workQueue];
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke_2;
    v9[3] = &unk_278685330;
    v9[4] = *(a1 + 40);
    v7 = v3;
    v8 = *(a1 + 64);
    v10 = v7;
    v12 = v8;
    v11 = *(a1 + 48);
    dispatch_async(v6, v9);
  }
}

- (void)_retrieveHAPAccessoryForHMDHAPAccessory:(id)a3 linkType:(int64_t)a4 forceRetrieve:(BOOL)a5 completion:(id)a6
{
  v7 = a5;
  v73 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a6;
  v12 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v12);

  v13 = [v10 bridge];
  v14 = v13;
  if (v13)
  {
    v15 = v13;
  }

  else
  {
    v15 = v10;
  }

  v16 = v15;

  v17 = [(HMDHome *)self accessoryBrowser];
  v18 = [v17 isBrowsingAllowed];

  if (v18)
  {
    v19 = [(HMDHome *)self accessories];
    v20 = [v19 containsObject:v10];

    if (v20)
    {
      v21 = [v16 matchingHAPAccessoryServerIdentifierWithLinkType:a4];
      v62 = 0;
      v22 = [(HMDHome *)self _enqueueRetrievalTupleForAccessory:v16 linkType:a4 inProgress:&v62 completion:v11];
      v23 = v22;
      if (v62 == 1 && !v7)
      {
        goto LABEL_24;
      }

      v58 = v22;
      v37 = objc_autoreleasePoolPush();
      v38 = self;
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
      {
        v56 = HMFGetLogIdentifier();
        v53 = [v16 shortDescription];
        if (a4 > 2)
        {
          v40 = @"Undefined";
        }

        else
        {
          v40 = off_2786768F0[a4];
        }

        v51 = v40;
        v41 = HMFBooleanToString();
        *buf = 138544130;
        v64 = v56;
        v65 = 2112;
        v66 = v53;
        v67 = 2112;
        v68 = v51;
        v69 = 2112;
        v70 = v41;
        _os_log_impl(&dword_229538000, v39, OS_LOG_TYPE_INFO, "%{public}@Retrieving accessory %@/%@. Force: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v37);
      v23 = v58;
      [v58 start];
      v42 = [(HMDHome *)v38 accessoryBrowser];
      v59[0] = MEMORY[0x277D85DD0];
      v59[1] = 3221225472;
      v59[2] = __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke;
      v59[3] = &unk_278682338;
      v59[4] = v38;
      v60 = v16;
      v61 = a4;
      [v42 discoverAccessoryServer:v21 linkType:a4 errorHandler:v59];

      if (v62)
      {
LABEL_24:
        v43 = objc_autoreleasePoolPush();
        v44 = self;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
        {
          v55 = HMFGetLogIdentifier();
          v54 = [v16 shortDescription];
          v57 = v43;
          if (a4 > 2)
          {
            v46 = @"Undefined";
          }

          else
          {
            v46 = off_2786768F0[a4];
          }

          v47 = v46;
          v48 = MEMORY[0x277CCABB0];
          log = [v23 completions];
          v49 = [v48 numberWithUnsignedInteger:{-[NSObject count](log, "count")}];
          *buf = 138544386;
          v64 = v55;
          v65 = 2112;
          v66 = v54;
          v67 = 2112;
          v68 = v21;
          v69 = 2112;
          v70 = v47;
          v71 = 2112;
          v72 = v49;
          _os_log_impl(&dword_229538000, v45, OS_LOG_TYPE_DEBUG, "%{public}@Retrieval already in progress for accessory (%@) with server %@/%@ and %@ completions.", buf, 0x34u);

          v43 = v57;
        }

        objc_autoreleasePoolPop(v43);
      }

      goto LABEL_31;
    }

    v31 = objc_autoreleasePoolPush();
    v32 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
    {
      v34 = HMFGetLogIdentifier();
      v35 = [v10 shortDescription];
      *buf = 138543618;
      v64 = v34;
      v65 = 2112;
      v66 = v35;
      _os_log_impl(&dword_229538000, v33, OS_LOG_TYPE_ERROR, "%{public}@Cannot retrieve HAP accessory: %@. Requested accessory not part of this home", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v31);
    v21 = _Block_copy(v11);
    if (v21)
    {
      v29 = MEMORY[0x277CCA9B8];
      v30 = 3;
      goto LABEL_17;
    }
  }

  else
  {
    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [v16 shortDescription];
      *buf = 138543618;
      v64 = v27;
      v65 = 2112;
      v66 = v28;
      _os_log_impl(&dword_229538000, v26, OS_LOG_TYPE_ERROR, "%{public}@Ignoring request to retrieve HAP accessory: %@. Browsing not allowed (companion is connected or no app)", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    v21 = _Block_copy(v11);
    if (v21)
    {
      v29 = MEMORY[0x277CCA9B8];
      v30 = 48;
LABEL_17:
      v36 = [v29 hmErrorWithCode:v30];
      (v21->data)(v21, v36);
    }
  }

LABEL_31:

  v50 = *MEMORY[0x277D85DE8];
}

void __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (v3)
  {
    v4 = [*(a1 + 32) workQueue];
    v8[0] = MEMORY[0x277D85DD0];
    v8[1] = 3221225472;
    v8[2] = __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke_2;
    v8[3] = &unk_278685330;
    v5 = *(a1 + 40);
    v8[4] = *(a1 + 32);
    v6 = v5;
    v7 = *(a1 + 48);
    v9 = v6;
    v11 = v7;
    v10 = v3;
    dispatch_async(v4, v8);
  }
}

- (void)_dequeueRetrievalForAccessory:(id)a3 linkType:(int64_t)a4 error:(id)a5
{
  v43 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v10);

  v11 = [v8 bridge];
  v12 = v11;
  if (v11)
  {
    v13 = v11;
  }

  else
  {
    v13 = v8;
  }

  v14 = v13;

  v15 = [(HMDHome *)self _retrieveTupleForPrimaryAccessory:v14 linkType:a4];
  if (v15)
  {
    [(HMDHome *)self _removeRetrievalCompletionTuple:v15];
    [v15 stop];
    if (v9)
    {
      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        v28 = [v14 shortDescription];
        v29 = v16;
        if (a4 > 2)
        {
          v19 = @"Undefined";
        }

        else
        {
          v19 = off_2786768F0[a4];
        }

        v20 = v19;
        v21 = [MEMORY[0x277CCA9B8] hmStringFromErrorCode:{objc_msgSend(v9, "code")}];
        v22 = MEMORY[0x277CCABB0];
        v27 = [v15 completions];
        v23 = [v22 numberWithUnsignedInteger:{objc_msgSend(v27, "count")}];
        *buf = 138544386;
        v34 = v30;
        v35 = 2112;
        v36 = v28;
        v37 = 2112;
        v38 = v20;
        v39 = 2112;
        v40 = v21;
        v41 = 2112;
        v42 = v23;
        _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_INFO, "%{public}@Calling accessory retrieval for %@/%@ with error: %@ and %@ completions.", buf, 0x34u);

        v16 = v29;
      }

      objc_autoreleasePoolPop(v16);
    }

    v24 = [v15 completions];
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __76__HMDHome_AccessoryRetrieval___dequeueRetrievalForAccessory_linkType_error___block_invoke;
    v31[3] = &unk_278687BD0;
    v32 = v9;
    [v24 na_each:v31];

    v25 = [v15 completions];
    [v25 removeAllObjects];
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (id)_enqueueRetrievalTupleForAccessory:(id)a3 linkType:(int64_t)a4 inProgress:(BOOL *)a5 completion:(id)a6
{
  v39 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a6;
  v12 = [v10 bridge];
  v13 = v12;
  if (v12)
  {
    v14 = v12;
  }

  else
  {
    v14 = v10;
  }

  v15 = v14;

  v16 = objc_autoreleasePoolPush();
  v17 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
  {
    v28 = v16;
    v19 = HMFGetLogIdentifier();
    if (v11)
    {
      v20 = @" with completion";
    }

    else
    {
      v20 = &stru_283CF9D50;
    }

    v21 = [v15 shortDescription];
    v30 = a5;
    if (a4 > 2)
    {
      v22 = @"Undefined";
    }

    else
    {
      v22 = off_2786768F0[a4];
    }

    v23 = v22;
    *buf = 138544130;
    v32 = v19;
    v33 = 2112;
    v34 = v20;
    v35 = 2112;
    v36 = v21;
    v37 = 2112;
    v38 = v23;
    _os_log_impl(&dword_229538000, v18, OS_LOG_TYPE_DEBUG, "%{public}@Enqueueing retrieval tuple%@ for %@/%@.", buf, 0x2Au);

    v16 = v29;
    a5 = v30;
  }

  objc_autoreleasePoolPop(v16);
  v24 = [(HMDHome *)v17 _retrieveTupleForPrimaryAccessory:v15 linkType:a4];
  if (v24)
  {
    v25 = v24;
    if (a5)
    {
      *a5 = 1;
    }

    if (v11)
    {
      goto LABEL_16;
    }
  }

  else
  {
    v25 = [[HMDAccessoryRetrievalCompletionTuple alloc] initWithHome:v17 accessory:v15 linkType:a4];
    [(HMDHome *)v17 _addRetrievalCompletionTuple:v25];
    if (v11)
    {
LABEL_16:
      [(HMDAccessoryRetrievalCompletionTuple *)v25 addCompletion:v11];
    }
  }

  v26 = *MEMORY[0x277D85DE8];

  return v25;
}

- (BOOL)_isRetrievalInProgressForPrimaryAccessory:(id)a3 linkType:(int64_t)a4
{
  v4 = [(HMDHome *)self _retrieveTupleForPrimaryAccessory:a3 linkType:a4];
  v5 = v4 != 0;

  return v5;
}

- (void)_removeRetrievalCompletionTuple:(id)a3
{
  v5 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  [v4 removeObject:v5];

  os_unfair_recursive_lock_unlock();
}

- (void)_addRetrievalCompletionTuple:(id)a3
{
  v5 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  [v4 addObject:v5];

  os_unfair_recursive_lock_unlock();
}

- (id)_retrieveTupleForPrimaryAccessory:(id)a3 linkType:(int64_t)a4
{
  v6 = a3;
  v7 = [v6 bridge];
  v8 = v7;
  if (v7)
  {
    v9 = v7;
  }

  else
  {
    v9 = v6;
  }

  v10 = v9;

  os_unfair_recursive_lock_lock_with_options();
  v11 = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __74__HMDHome_AccessoryRetrieval___retrieveTupleForPrimaryAccessory_linkType___block_invoke;
  v15[3] = &unk_278681D50;
  v12 = v10;
  v16 = v12;
  v17 = a4;
  v13 = [v11 na_firstObjectPassingTest:v15];

  os_unfair_recursive_lock_unlock();

  return v13;
}

BOOL __74__HMDHome_AccessoryRetrieval___retrieveTupleForPrimaryAccessory_linkType___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 accessory];
  v5 = [v4 uuid];
  v6 = [*(a1 + 32) uuid];
  if ([v5 isEqual:v6])
  {
    v7 = [v3 linkType] == *(a1 + 40);
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)createSiriEndpointProfilesMessengerWithMessageTargetUUID:(id)a3 messageDispatcher:(id)a4 messageRouter:(id)a5 messageHandler:(id)a6
{
  v9 = a6;
  v10 = a5;
  v11 = a4;
  v12 = a3;
  v13 = [[HMDSiriEndpointProfilesMessenger alloc] initWithMessageTargetUUID:v12 messageDispatcher:v11 messageRouter:v10 messageHandler:v9];

  return v13;
}

- (void)configureSiriEndpointProfilesMessengerWithMessengerFactory:(id)a3 messageHandlerFactory:(id)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v23 = 138543362;
    v24 = v11;
    _os_log_impl(&dword_229538000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring siri endpoint profiles messenger", &v23, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [(HMDHome *)v9 msgDispatcher];
  v13 = [(HMDHome *)v9 primaryResidentMessageRouter];
  if (!v12)
  {
    _HMFPreconditionFailure();
LABEL_7:
    _HMFPreconditionFailure();
  }

  v14 = v13;
  if (!v13)
  {
    goto LABEL_7;
  }

  v15 = MEMORY[0x277CD1E30];
  v16 = [(HMDHome *)v9 uuid];
  v17 = [v15 messageTargetUUIDWithHomeUUID:v16];

  v18 = [(HMDHome *)v9 uuid];
  v19 = [v7 createSiriEndpointProfileMessageHandlerWithHomeUUID:v18];

  v20 = [(HMDHome *)v9 homeManager];
  [v19 setDataSource:v20];

  v21 = [v6 createSiriEndpointProfilesMessengerWithMessageTargetUUID:v17 messageDispatcher:v12 messageRouter:v14 messageHandler:v19];
  [v21 registerForMessagesWithHome:v9];
  [(HMDHome *)v9 setSiriEndpointProfilesMessenger:v21];

  v22 = *MEMORY[0x277D85DE8];
}

- (unint64_t)accessorySettingsLocalMessageHandler:(id)a3 callerPrivilegeWithMessage:(id)a4
{
  v21 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 userForHome:self];
  v9 = v8;
  if (v8)
  {
    v10 = [v8 privilege];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = v7;
      _os_log_impl(&dword_229538000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to get accessory settings local message handler caller privilege from message: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v10 = 2;
  }

  v15 = *MEMORY[0x277D85DE8];
  return v10;
}

- (id)createUnifiedLanguageValueListSettingDataProvider
{
  v2 = objc_alloc_init(HMDUnifiedLanguageValueListSettingDataProvider);

  return v2;
}

- (void)configureUnifiedLanguageValueListSettingDataProviderWithFactory:(id)a3
{
  v13 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v11 = 138543362;
    v12 = v8;
    _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_INFO, "%{public}@Configuring unified language value list setting data provider", &v11, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 createUnifiedLanguageValueListSettingDataProvider];
  [v9 setDataSource:v6];
  [(HMDHome *)v6 setUnifiedLanguageValueListSettingDataProvider:v9];

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_performMediaGroupReadinessCheckAndSubmitMetricEventWithMessage:(id)a3
{
  v91[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = [v5 objectForKeyedSubscript:*MEMORY[0x277CD0498]];

  v7 = [v4 messagePayload];
  v8 = [v7 objectForKeyedSubscript:*MEMORY[0x277CCF0B0]];

  v9 = [v4 messagePayload];
  v10 = [v9 objectForKeyedSubscript:*MEMORY[0x277CD0490]];

  [v6 doubleValue];
  v12 = v11;
  v13 = objc_autoreleasePoolPush();
  v14 = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
  {
    v16 = HMFGetLogIdentifier();
    *buf = 138543618;
    v83 = v16;
    v84 = 2112;
    v85 = v10;
    _os_log_impl(&dword_229538000, v15, OS_LOG_TYPE_INFO, "%{public}@Perform media group readiness check for setup session: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v13);
  v17 = [(HMDHome *)v14 featuresDataSource];
  v18 = [v17 isStereoOdeonTTSUBypassingPrimaryEnabled];

  if (v18)
  {
    v19 = fabs(v12) >= 2.22044605e-16 && v12 > 0.0;
    v20 = [(HMDHome *)v14 accessoryWithUUID:v8];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v21 = v20;
    }

    else
    {
      v21 = 0;
    }

    v22 = v21;

    v23 = [(HMDHome *)v14 homeManager];
    v24 = v23;
    if (!v19 || v22 == 0 || v23 == 0)
    {
      v27 = objc_autoreleasePoolPush();
      v28 = v14;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v69 = v6;
        v30 = v10;
        v31 = v8;
        v33 = v32 = v24;
        v34 = [MEMORY[0x277CCABB0] numberWithBool:v19];
        *buf = 138544130;
        v83 = v33;
        v84 = 2112;
        v85 = v34;
        v86 = 2112;
        v87 = v22;
        v88 = 2112;
        v89 = v32;
        _os_log_impl(&dword_229538000, v29, OS_LOG_TYPE_ERROR, "%{public}@Invalid parameters: timeout %@ accessory: %@ homeManager: %@", buf, 0x2Au);

        v24 = v32;
        v8 = v31;
        v10 = v30;
        v6 = v69;
      }

      objc_autoreleasePoolPop(v27);
      v80 = *MEMORY[0x277CD0488];
      v81 = MEMORY[0x277CBEC28];
      v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v81 forKeys:&v80 count:1];
      v36 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:9014];
      v37 = v4;
      v38 = v35;
      v39 = v36;
    }

    else
    {
      v44 = [v22 deviceForDirectMessaging];
      if (!v44)
      {
        v60 = objc_autoreleasePoolPush();
        v61 = v14;
        v62 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v63 = v6;
          v64 = v10;
          v65 = v8;
          v67 = v66 = v24;
          *buf = 138543362;
          v83 = v67;
          _os_log_impl(&dword_229538000, v62, OS_LOG_TYPE_INFO, "%{public}@Respond with YES as the peer device is just being setup and not ready to be messaged.", buf, 0xCu);

          v24 = v66;
          v8 = v65;
          v10 = v64;
          v6 = v63;
        }

        objc_autoreleasePoolPop(v60);
        v78 = *MEMORY[0x277CD0488];
        v79 = MEMORY[0x277CBEC38];
        v36 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v79 forKeys:&v78 count:1];
        [v4 respondWithPayload:v36 error:0];
        v35 = 0;
        goto LABEL_37;
      }

      v35 = v44;
      if (([v22 supportsStereoOdeonTTSUBypassingPrimary] & 1) != 0 || !objc_msgSend(v22, "isHomePod"))
      {
        v70 = v24;
        v52 = objc_autoreleasePoolPush();
        v53 = v14;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_DEFAULT))
        {
          v55 = HMFGetLogIdentifier();
          *buf = 138543618;
          v83 = v55;
          v84 = 2112;
          v85 = v22;
          _os_log_impl(&dword_229538000, v54, OS_LOG_TYPE_DEFAULT, "%{public}@Performing media group preflight check fetch for accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v52);
        HMFUptime();
        v57 = v56;
        v58 = [v22 category];
        v59 = [v58 categoryType];

        v71[0] = MEMORY[0x277D85DD0];
        v71[1] = 3221225472;
        v71[2] = __101__HMDHome_MediaGroupReadinessCheck___performMediaGroupReadinessCheckAndSubmitMetricEventWithMessage___block_invoke;
        v71[3] = &unk_27868A2A0;
        v75 = v57;
        v71[4] = v53;
        v72 = v4;
        v73 = v10;
        v74 = v59;
        v36 = v59;
        v24 = v70;
        [v70 fetchSetupDiagnosticStateWithOptions:1 accessoryUUID:v8 remoteMessageTimeout:9 remoteMessageRestriction:v71 completion:v12];

        goto LABEL_37;
      }

      v45 = objc_autoreleasePoolPush();
      v46 = v14;
      v47 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v69 = v6;
        v48 = v10;
        v49 = v8;
        v51 = v50 = v24;
        *buf = 138543362;
        v83 = v51;
        _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_INFO, "%{public}@Respond with YES as the peer device does not support the new feature.", buf, 0xCu);

        v24 = v50;
        v8 = v49;
        v10 = v48;
        v6 = v69;
      }

      objc_autoreleasePoolPop(v45);
      v76 = *MEMORY[0x277CD0488];
      v77 = MEMORY[0x277CBEC38];
      v36 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v77 forKeys:&v76 count:1];
      v37 = v4;
      v38 = v36;
      v39 = 0;
    }

    [v37 respondWithPayload:v38 error:{v39, v69}];
LABEL_37:

    goto LABEL_38;
  }

  v40 = objc_autoreleasePoolPush();
  v41 = v14;
  v42 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v42, OS_LOG_TYPE_INFO))
  {
    v43 = HMFGetLogIdentifier();
    *buf = 138543362;
    v83 = v43;
    _os_log_impl(&dword_229538000, v42, OS_LOG_TYPE_INFO, "%{public}@Respond with YES since the feature is not enabled.", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v40);
  v90 = *MEMORY[0x277CD0488];
  v91[0] = MEMORY[0x277CBEC38];
  v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v91 forKeys:&v90 count:1];
  [v4 respondWithPayload:v22 error:0];
LABEL_38:

  v68 = *MEMORY[0x277D85DE8];
}

void __101__HMDHome_MediaGroupReadinessCheck___performMediaGroupReadinessCheckAndSubmitMetricEventWithMessage___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v92[1] = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  HMFUptime();
  v8 = v7 - *(a1 + 64);
  v9 = objc_autoreleasePoolPush();
  v10 = *(a1 + 32);
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [MEMORY[0x277CCABB0] numberWithDouble:v8];
    *buf = 138543874;
    v78 = v12;
    v79 = 2112;
    v80 = v13;
    v81 = 2112;
    v82 = v6;
    _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Performing media group preflight check fetch completed with duration %@ error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = objc_autoreleasePoolPush();
  v15 = *(a1 + 32);
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    v17 = HMFGetLogIdentifier();
    *buf = 138543618;
    v78 = v17;
    v79 = 2112;
    v80 = v5;
    _os_log_impl(&dword_229538000, v16, OS_LOG_TYPE_INFO, "%{public}@Fetched diagnostic info: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v14);
  v18 = [v5 appleMediaAccessoryDiagnosticInfo];
  v19 = [v18 cloudInfo];
  v20 = [v18 idsInfo];
  v74 = [v18 currentAccessoryInfo];
  v21 = [v18 eventRouterServerInfo];
  if (v19)
  {
    v22 = [v19 firstCloudImportComplete];
    v23 = [v19 cloudState] == 1;
    if (v20)
    {
      goto LABEL_7;
    }

LABEL_10:
    v72 = 0;
    if (v19)
    {
      goto LABEL_8;
    }

    goto LABEL_11;
  }

  v22 = 0;
  v23 = 0;
  if (!v20)
  {
    goto LABEL_10;
  }

LABEL_7:
  v72 = [v20 idsState] == 1;
  if (v19)
  {
LABEL_8:
    v71 = [v19 octagonState] == 1;
    goto LABEL_12;
  }

LABEL_11:
  v71 = 0;
LABEL_12:
  v67 = v18;
  v24 = [v18 mediaRouteIdString];

  v73 = v6;
  v68 = v5;
  v69 = v23;
  v70 = v22;
  if (v6)
  {
    v25 = v21;
    v26 = objc_autoreleasePoolPush();
    v27 = *(a1 + 32);
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      v29 = HMFGetLogIdentifier();
      *buf = 138543618;
      v78 = v29;
      v79 = 2112;
      v80 = v6;
      _os_log_impl(&dword_229538000, v28, OS_LOG_TYPE_ERROR, "%{public}@Responding with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v26);
    v30 = *(a1 + 40);
    v91 = *MEMORY[0x277CD0488];
    v92[0] = MEMORY[0x277CBEC28];
    v31 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v92 forKeys:&v91 count:1];
    [v30 respondWithPayload:v31 error:v6];
    v21 = v25;
  }

  else
  {
    if (v24)
    {
      v32 = v22 & v23 & (v72 && v71);
    }

    else
    {
      v32 = 0;
    }

    v33 = objc_autoreleasePoolPush();
    v34 = *(a1 + 32);
    v35 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT))
    {
      HMFGetLogIdentifier();
      v58 = v24;
      v64 = v59 = v34;
      v36 = v32;
      v63 = HMFBooleanToString();
      v37 = HMFBooleanToString();
      HMFBooleanToString();
      v38 = log = v35;
      v39 = HMFBooleanToString();
      HMFBooleanToString();
      v40 = v60 = v33;
      HMFBooleanToString();
      v61 = v36;
      v42 = v41 = v21;
      *buf = 138544898;
      v78 = v64;
      v79 = 2112;
      v80 = v63;
      v81 = 2112;
      v82 = v37;
      v83 = 2112;
      v84 = v38;
      v85 = 2112;
      v86 = v39;
      v43 = v39;
      v87 = 2112;
      v88 = v40;
      v89 = 2112;
      v90 = v42;
      _os_log_impl(&dword_229538000, log, OS_LOG_TYPE_DEFAULT, "%{public}@Fetched the state of the peer: isReady: %@, firstImport: %@, isCloudSignedIn: %@, isIdsReady: %@, isManateeReady: %@, hasMediaRouteIdentifier: %@", buf, 0x48u);

      v21 = v41;
      v32 = v61;

      v33 = v60;
      v24 = v58;

      v35 = log;
      v34 = v59;
    }

    objc_autoreleasePoolPop(v33);
    v44 = *(a1 + 40);
    v75 = *MEMORY[0x277CD0488];
    v31 = [MEMORY[0x277CCABB0] numberWithBool:v32];
    v76 = v31;
    v45 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v76 forKeys:&v75 count:1];
    [v44 respondWithPayload:v45 error:0];
  }

  v46 = [v74 publicPairingIdentity];

  v66 = v19;
  v65 = v21;
  if (v21)
  {
    v47 = [v21 connectionState] == 1;
  }

  else
  {
    v47 = 0;
  }

  v48 = v24 != 0;
  v49 = *(a1 + 32);
  v50 = [*(a1 + 48) UUIDString];
  v51 = *(a1 + 56);
  v52 = [*(a1 + 32) isOwnerUser];
  v53 = [*(a1 + 32) uuid];
  BYTE3(v57) = v52;
  BYTE2(v57) = v72;
  BYTE1(v57) = v71;
  LOBYTE(v57) = v69;
  v54 = [v49 preflightCheckLogEventWithSessionIdentifier:v50 accessoryCategory:v51 fetchDuration:v70 firstImportCompleted:v48 hasMediaRouteIdentifier:v46 != 0 hasPairingIdentity:v47 hasConnectedEventRouterClient:v8 isCloudSignedIn:v57 hasManatee:v53 isIdsReady:? isOwnerUser:? homeUUID:?];

  v55 = [*(a1 + 32) logEventSubmitter];
  [v55 submitLogEvent:v54 error:v73];

  v56 = *MEMORY[0x277D85DE8];
}

- (void)_registerPerformMediaGroupReadinessCheckMessage
{
  v8[1] = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self msgDispatcher];
  v4 = *MEMORY[0x277CD0480];
  v5 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v8[0] = v5;
  v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v8 count:1];
  [v3 registerForMessage:v4 receiver:self policies:v6 selector:sel__handlePerformMediaGroupReadinessCheck_];

  v7 = *MEMORY[0x277D85DE8];
}

- (BOOL)validateActionsDoNotConflict:(id)a3
{
  v81 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (![v4 count])
  {
    v38 = 1;
    goto LABEL_55;
  }

  v54 = self;
  v57 = v4;
  v60 = [MEMORY[0x277CBEB58] set];
  v5 = [MEMORY[0x277CBEB58] set];
  v56 = [MEMORY[0x277CBEB58] set];
  v55 = [MEMORY[0x277CBEB38] dictionary];
  v75 = 0u;
  v76 = 0u;
  v73 = 0u;
  v74 = 0u;
  obj = v4;
  v6 = [obj countByEnumeratingWithState:&v73 objects:v80 count:16];
  if (!v6)
  {
    v38 = 1;
    goto LABEL_54;
  }

  v59 = *v74;
  v53 = v62;
  while (2)
  {
    for (i = 0; i != v6; ++i)
    {
      if (*v74 != v59)
      {
        objc_enumerationMutation(obj);
      }

      v8 = *(*(&v73 + 1) + 8 * i);
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v9 = v8;
      }

      else
      {
        v9 = 0;
      }

      v10 = v9;

      if (!v10)
      {
        v12 = v8;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v13 = v12;
        }

        else
        {
          v13 = 0;
        }

        v11 = v13;

        if (v11)
        {
          v71 = 0u;
          v72 = 0u;
          v69 = 0u;
          v70 = 0u;
          v14 = [v11 mediaProfiles];
          v15 = [v14 countByEnumeratingWithState:&v69 objects:v79 count:16];
          if (v15)
          {
            v16 = *v70;
            while (2)
            {
              for (j = 0; j != v15; ++j)
              {
                if (*v70 != v16)
                {
                  objc_enumerationMutation(v14);
                }

                v18 = *(*(&v69 + 1) + 8 * j);
                if ([v5 containsObject:{v18, v53}])
                {
                  v39 = objc_autoreleasePoolPush();
                  v40 = v54;
                  v41 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
                  {
                    v42 = HMFGetLogIdentifier();
                    *buf = 138543618;
                    *&buf[4] = v42;
                    *&buf[12] = 2112;
                    *&buf[14] = v12;
                    _os_log_impl(&dword_229538000, v41, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", buf, 0x16u);
                  }

                  objc_autoreleasePoolPop(v39);
                  v36 = v11;
                  v37 = v14;
                  goto LABEL_51;
                }

                [v5 addObject:v18];
              }

              v15 = [v14 countByEnumeratingWithState:&v69 objects:v79 count:16];
              if (v15)
              {
                continue;
              }

              break;
            }
          }
        }

        else
        {
          v19 = v12;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v20 = v19;
          }

          else
          {
            v20 = 0;
          }

          v21 = v20;

          if (v21)
          {
            v22 = [v21 accessory];
            if ([v56 containsObject:v22])
            {
              v49 = objc_autoreleasePoolPush();
              v50 = v54;
              v51 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v51, OS_LOG_TYPE_ERROR))
              {
                v52 = HMFGetLogIdentifier();
                *buf = 138543618;
                *&buf[4] = v52;
                *&buf[12] = 2112;
                *&buf[14] = v19;
                _os_log_impl(&dword_229538000, v51, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v49);
              v11 = 0;
              v10 = 0;
              goto LABEL_52;
            }

            [v56 addObject:v22];

            v11 = 0;
            goto LABEL_43;
          }

          v23 = +[HMDCoreData featuresDataSource];
          v24 = [v23 isRVCEnabled];

          if (v24 && ((v25 = v19, objc_opt_class(), (objc_opt_isKindOfClass() & 1) == 0) ? (v26 = 0) : (v26 = v25), v27 = v26, v25, v27))
          {
            v28 = [v27 accessory];
            v29 = [v28 uuid];
            v30 = [v55 objectForKeyedSubscript:v29];

            if (!v30)
            {
              v30 = [MEMORY[0x277CBEB58] set];
              v31 = [v28 uuid];
              [v55 setObject:v30 forKeyedSubscript:v31];
            }

            *buf = 0;
            *&buf[8] = buf;
            *&buf[16] = 0x2020000000;
            v78 = 0;
            v32 = [v27 commands];
            v61[0] = MEMORY[0x277D85DD0];
            v61[1] = 3221225472;
            v62[0] = __59__HMDHome_HMActionExecution__validateActionsDoNotConflict___block_invoke;
            v62[1] = &unk_27868A500;
            v33 = v30;
            v63 = v33;
            v64 = v54;
            v65 = v25;
            v68 = buf;
            v66 = v55;
            v34 = v28;
            v67 = v34;
            [v32 hmf_enumerateWithAutoreleasePoolUsingBlock:v61];

            v35 = *(*&buf[8] + 24);
            _Block_object_dispose(buf, 8);

            v14 = 0;
            v36 = 0;
            v37 = 0;
            if (v35)
            {
LABEL_51:

              v10 = 0;
              v11 = v36;
LABEL_52:

              v38 = 0;
              goto LABEL_54;
            }
          }

          else
          {
            v14 = 0;
          }
        }

LABEL_43:
        v10 = 0;
        goto LABEL_44;
      }

      v11 = [v10 characteristic];
      if ([v60 containsObject:v11])
      {
        v45 = objc_autoreleasePoolPush();
        v46 = v54;
        v47 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
        {
          v48 = HMFGetLogIdentifier();
          *buf = 138543618;
          *&buf[4] = v48;
          *&buf[12] = 2112;
          *&buf[14] = v8;
          _os_log_impl(&dword_229538000, v47, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v45);
        goto LABEL_52;
      }

      [v60 addObject:v11];
LABEL_44:
    }

    v6 = [obj countByEnumeratingWithState:&v73 objects:v80 count:16];
    v38 = 1;
    if (v6)
    {
      continue;
    }

    break;
  }

LABEL_54:

  v4 = v57;
LABEL_55:

  v43 = *MEMORY[0x277D85DE8];
  return v38;
}

void __59__HMDHome_HMActionExecution__validateActionsDoNotConflict___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v23 = *MEMORY[0x277D85DE8];
  v6 = a2;
  v7 = *(a1 + 32);
  v8 = [v6 matterPath];
  LODWORD(v7) = [v7 containsObject:v8];

  if (v7)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 40);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v13 = *(a1 + 48);
      v19 = 138543618;
      v20 = v12;
      v21 = 2112;
      v22 = v13;
      _os_log_impl(&dword_229538000, v11, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    *(*(*(a1 + 72) + 8) + 24) = 1;
    *a4 = 1;
  }

  v14 = *(a1 + 56);
  v15 = [*(a1 + 64) uuid];
  v16 = [v14 objectForKeyedSubscript:v15];
  v17 = [v6 matterPath];
  [v16 addObject:v17];

  v18 = *MEMORY[0x277D85DE8];
}

- (void)executeActionsFromMessage:(id)a3
{
  v179 = *MEMORY[0x277D85DE8];
  v113 = a3;
  v102 = [v113 arrayForKey:*MEMORY[0x277CCFF38]];
  if ([v102 count])
  {
    if ([v102 hmf_objectsAreKindOfClass:objc_opt_class()])
    {
      v111 = [MEMORY[0x277CBEAA8] date];
      v101 = [v113 source];
      v100 = [v113 transport];
      v104 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v102, "count")}];
      v158 = 0u;
      v159 = 0u;
      v156 = 0u;
      v157 = 0u;
      v4 = v102;
      v5 = [v4 countByEnumeratingWithState:&v156 objects:v178 count:16];
      if (!v5)
      {
        goto LABEL_17;
      }

      v6 = *v157;
      while (2)
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v157 != v6)
          {
            objc_enumerationMutation(v4);
          }

          v8 = *(*(&v156 + 1) + 8 * i);
          v9 = [(HMDHome *)self actionWithDictionaryRepresentation:v8];
          if (!v9)
          {
            v78 = objc_autoreleasePoolPush();
            v79 = self;
            v80 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v80, OS_LOG_TYPE_ERROR))
            {
              v81 = HMFGetLogIdentifier();
              *buf = 138543618;
              v166 = v81;
              v167 = 2112;
              *v168 = v8;
              _os_log_impl(&dword_229538000, v80, OS_LOG_TYPE_ERROR, "%{public}@Failed to deserialize action: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v78);
            v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
            [v113 respondWithError:v10];
LABEL_94:

            goto LABEL_106;
          }

          v10 = v9;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();
          if (isKindOfClass)
          {
            v12 = v10;
          }

          else
          {
            v12 = 0;
          }

          v13 = v12;

          if (isKindOfClass)
          {
            v14 = [v113 proxyConnection];
            if (v14)
            {
              v15 = [v113 isEntitledForShortcutsAutomationAccess];

              if ((v15 & 1) == 0)
              {
                v84 = objc_autoreleasePoolPush();
                v85 = self;
                v86 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v86, OS_LOG_TYPE_ERROR))
                {
                  v87 = HMFGetLogIdentifier();
                  *buf = 138543362;
                  v166 = v87;
                  _os_log_impl(&dword_229538000, v86, OS_LOG_TYPE_ERROR, "%{public}@Missing ShortcutsAutomationAccess Entitlement for Execute", buf, 0xCu);
                }

                objc_autoreleasePoolPop(v84);
                v88 = [MEMORY[0x277CCA9B8] hmErrorWithCode:80 description:@"Missing Entitlement" reason:0 suggestion:0];
                [v113 respondWithError:v88];

                goto LABEL_94;
              }
            }
          }

          [v104 addObject:v10];
        }

        v5 = [v4 countByEnumeratingWithState:&v156 objects:v178 count:16];
        if (v5)
        {
          continue;
        }

        break;
      }

LABEL_17:

      v16 = [(HMDHome *)self validateActionsDoNotConflict:v104];
      v17 = objc_autoreleasePoolPush();
      val = self;
      v18 = HMFGetOSLogHandle();
      v19 = v18;
      if (v16)
      {
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          v20 = HMFGetLogIdentifier();
          *buf = 138543618;
          v166 = v20;
          v167 = 2112;
          *v168 = v104;
          _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_DEFAULT, "%{public}@Executing actions: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v17);
        v150 = 0;
        v151 = &v150;
        v152 = 0x3032000000;
        v153 = __Block_byref_object_copy__285295;
        v154 = __Block_byref_object_dispose__285296;
        v155 = 0;
        v105 = [(HMDHome *)val workQueue];
        v21 = dispatch_group_create();
        v115 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v104, "count")}];
        v112 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
        v106 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
        v103 = [MEMORY[0x277CBEB18] array];
        v148 = 0u;
        v149 = 0u;
        v146 = 0u;
        v147 = 0u;
        obj = v104;
        v22 = [obj countByEnumeratingWithState:&v146 objects:v177 count:16];
        group = v21;
        if (!v22)
        {
LABEL_75:

          v64 = group;
          if ([v115 count])
          {
            objc_initWeak(&location, val);
            dispatch_group_enter(group);
            v65 = [MEMORY[0x277CCAD78] UUID];
            v66 = objc_autoreleasePoolPush();
            v67 = val;
            v68 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v68, OS_LOG_TYPE_INFO))
            {
              v69 = HMFGetLogIdentifier();
              v163 = 0uLL;
              if (v65)
              {
                [v65 getUUIDBytes:&v163];
              }

              else
              {
                v163 = *MEMORY[0x277D0F960];
              }

              v161 = v163;
              v163 = 0uLL;
              v89 = [v113 identifier];

              if (v89)
              {
                v90 = [v113 identifier];
                [v90 getUUIDBytes:&v163];
              }

              else
              {
                v163 = *MEMORY[0x277D0F960];
              }

              v160 = v163;
              v91 = [v115 count];
              *buf = 138544898;
              v166 = v69;
              v167 = 1042;
              *v168 = 16;
              *&v168[4] = 2098;
              *&v168[6] = &v161;
              v169 = 1042;
              v170 = 16;
              v171 = 2098;
              v172 = &v160;
              v173 = 2114;
              v174 = v67;
              v175 = 2048;
              v176 = v91;
              _os_log_impl(&dword_229538000, v68, OS_LOG_TYPE_INFO, "%{public}@Executing write requests with identifier: %{public,uuid_t}.16P for request identifier %{public,uuid_t}.16P from home: %{public}@ count: %lu for characteristic write actions", buf, 0x40u);
            }

            objc_autoreleasePoolPop(v66);
            v92 = [v113 qualityOfService];
            v126[0] = MEMORY[0x277D85DD0];
            v126[1] = 3221225472;
            v126[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_29;
            v126[3] = &unk_27868A488;
            v127 = v105;
            objc_copyWeak(&v133, &location);
            v128 = v115;
            v129 = v106;
            v130 = v112;
            v132 = &v150;
            v131 = group;
            [(HMDHome *)v67 writeCharacteristicValues:v128 source:v101 biomeSource:0 identifier:v65 transport:v100 qualityOfService:v92 withCompletionHandler:v126];

            objc_destroyWeak(&v133);
            objc_destroyWeak(&location);
            v64 = group;
          }

          if (([v103 hmf_isEmpty] & 1) == 0)
          {
            v93 = objc_autoreleasePoolPush();
            v94 = val;
            v95 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v95, OS_LOG_TYPE_DEBUG))
            {
              v96 = HMFGetLogIdentifier();
              *buf = 138543618;
              v166 = v96;
              v167 = 2112;
              *v168 = v103;
              _os_log_impl(&dword_229538000, v95, OS_LOG_TYPE_DEBUG, "%{public}@Executing matter natural lighting actions: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v93);
            dispatch_group_enter(group);
            v97 = [(HMDHome *)v94 executeMatterNaturalLightingActions:v103];
            v123[0] = MEMORY[0x277D85DD0];
            v123[1] = 3221225472;
            v123[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_31;
            v123[3] = &unk_27868A4B0;
            v123[4] = v94;
            v125 = &v150;
            v124 = group;
            [v97 getResultWithCompletion:v123];

            v64 = group;
          }

          v98 = [(HMDHome *)val workQueue];
          block[0] = MEMORY[0x277D85DD0];
          block[1] = 3221225472;
          block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_33;
          block[3] = &unk_27868A4D8;
          v120 = v113;
          v122 = &v150;
          v121 = obj;
          dispatch_group_notify(v64, v98, block);

          _Block_object_dispose(&v150, 8);
          goto LABEL_106;
        }

        v116 = *v147;
        while (2)
        {
          v117 = v22;
          v23 = 0;
LABEL_23:
          if (*v147 != v116)
          {
            objc_enumerationMutation(obj);
          }

          v24 = *(*(&v146 + 1) + 8 * v23);
          [v24 configureWithHome:val];
          v25 = v24;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v26 = v25;
          }

          else
          {
            v26 = 0;
          }

          v27 = v26;

          if (v27)
          {
            v28 = [v27 characteristic];
            v29 = [v27 targetValue];
            v30 = [v28 authorizationData];
            v31 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:v28 value:v29 authorizationData:v30 type:1];

            if (v31)
            {
              [v115 addObject:v31];
              [v112 setObject:v27 forKey:v31];
              goto LABEL_73;
            }
          }

          v32 = v25;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v33 = v32;
          }

          else
          {
            v33 = 0;
          }

          v28 = v33;

          v34 = [v28 lightProfile];
          v31 = v34;
          if (v34)
          {
            if ([v34 supportsCHIP] && objc_msgSend(v31, "isNaturalLightingSupported"))
            {
              [v103 addObject:v28];
              goto LABEL_73;
            }

            v35 = [v28 writeRequestForTransitionStartWithLightProfile:v31 startDate:v111 type:1];
            if (v35)
            {
              [v106 setObject:v28 forKey:v35];
              [v115 addObject:v35];
            }

            else
            {
              v41 = objc_autoreleasePoolPush();
              v42 = val;
              v43 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v43, OS_LOG_TYPE_ERROR))
              {
                v44 = HMFGetLogIdentifier();
                *buf = 138543618;
                v166 = v44;
                v167 = 2112;
                *v168 = v28;
                _os_log_impl(&dword_229538000, v43, OS_LOG_TYPE_ERROR, "%{public}@Failed to create characteristic write request for natural lighting action: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v41);
              v35 = 0;
            }

LABEL_72:

LABEL_73:
            if (v117 == ++v23)
            {
              v22 = [obj countByEnumeratingWithState:&v146 objects:v177 count:16];
              if (!v22)
              {
                goto LABEL_75;
              }

              continue;
            }

            goto LABEL_23;
          }

          break;
        }

        if (v28)
        {
          v36 = objc_autoreleasePoolPush();
          v37 = val;
          v38 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
          {
            v39 = HMFGetLogIdentifier();
            *buf = 138543618;
            v166 = v39;
            v167 = 2112;
            *v168 = v28;
            _os_log_impl(&dword_229538000, v38, OS_LOG_TYPE_ERROR, "%{public}@Skipping executing natural lighting action, missing light profile: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v36);
          v40 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          v35 = v151[5];
          v151[5] = v40;
          goto LABEL_72;
        }

        v45 = v32;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v46 = v45;
        }

        else
        {
          v46 = 0;
        }

        v47 = v46;
        v108 = v45;

        if (v47)
        {
          v48 = [v47 convertedCharacteristicWriteRequests];
          v49 = v48;
          if (v48)
          {
            v35 = [v48 residualAction];

            v110 = [v49 characteristicWriteRequests];
            if (!v35)
            {
LABEL_58:

              goto LABEL_59;
            }
          }

          else
          {
            v110 = 0;
            v35 = v45;
          }

          [v35 setEncodePlaybackArchiveForExecution:1];
          goto LABEL_58;
        }

        v110 = 0;
        v35 = 0;
LABEL_59:
        objc_initWeak(&location, val);
        if ([v110 count])
        {
          dispatch_group_enter(group);
          v107 = [MEMORY[0x277CCAD78] UUID];
          v50 = objc_autoreleasePoolPush();
          v51 = val;
          v52 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
          {
            v53 = HMFGetLogIdentifier();
            v163 = 0uLL;
            if (v107)
            {
              [v107 getUUIDBytes:&v163];
            }

            else
            {
              v163 = *MEMORY[0x277D0F960];
            }

            v164 = v163;
            v163 = 0uLL;
            v54 = [v113 identifier];

            if (v54)
            {
              v55 = [v113 identifier];
              [v55 getUUIDBytes:&v163];
            }

            else
            {
              v163 = *MEMORY[0x277D0F960];
            }

            v162 = v163;
            v56 = [v110 count];
            *buf = 138544898;
            v166 = v53;
            v167 = 1042;
            *v168 = 16;
            *&v168[4] = 2098;
            *&v168[6] = &v164;
            v169 = 1042;
            v170 = 16;
            v171 = 2098;
            v172 = &v162;
            v173 = 2114;
            v174 = val;
            v175 = 2048;
            v176 = v56;
            _os_log_impl(&dword_229538000, v52, OS_LOG_TYPE_INFO, "%{public}@Executing write requests with identifier: %{public,uuid_t}.16P for request identifier %{public,uuid_t}.16P from home: %{public}@ count: %lu for media actions", buf, 0x40u);
          }

          objc_autoreleasePoolPop(v50);
          v57 = [v113 source];
          v58 = [v113 qualityOfService];
          v139[0] = MEMORY[0x277D85DD0];
          v139[1] = 3221225472;
          v139[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke;
          v139[3] = &unk_27868A3E8;
          v140 = v105;
          objc_copyWeak(&v144, &location);
          v59 = v110;
          v141 = v59;
          v143 = &v150;
          v142 = group;
          [(HMDHome *)v51 writeCharacteristicValues:v59 source:v57 biomeSource:0 identifier:v107 transport:v100 qualityOfService:v58 withCompletionHandler:v139];

          objc_destroyWeak(&v144);
        }

        v60 = [v113 clientName];
        v61 = v60;
        v62 = @"Unknown";
        if (v60)
        {
          v62 = v60;
        }

        v63 = v62;

        dispatch_group_enter(group);
        v134[0] = MEMORY[0x277D85DD0];
        v134[1] = 3221225472;
        v134[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_26;
        v134[3] = &unk_27868A438;
        v135 = v105;
        objc_copyWeak(&v138, &location);
        v137 = &v150;
        v136 = group;
        [v108 executeWithSource:v101 clientName:v63 completionHandler:v134];

        objc_destroyWeak(&v138);
        objc_destroyWeak(&location);

        goto LABEL_72;
      }

      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v82 = HMFGetLogIdentifier();
        *buf = 138543362;
        v166 = v82;
        _os_log_impl(&dword_229538000, v19, OS_LOG_TYPE_ERROR, "%{public}@Failed to validate actions", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      v83 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v113 respondWithError:v83];

LABEL_106:
    }

    else
    {
      v74 = objc_autoreleasePoolPush();
      v75 = self;
      v76 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v76, OS_LOG_TYPE_ERROR))
      {
        v77 = HMFGetLogIdentifier();
        *buf = 138543618;
        v166 = v77;
        v167 = 2112;
        *v168 = v113;
        _os_log_impl(&dword_229538000, v76, OS_LOG_TYPE_ERROR, "%{public}@Invalid actions payload: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v74);
      v111 = [MEMORY[0x277CCA9B8] hmErrorWithCode:22];
      [v113 respondWithError:v111];
    }
  }

  else
  {
    v70 = objc_autoreleasePoolPush();
    v71 = self;
    v72 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v72, OS_LOG_TYPE_ERROR))
    {
      v73 = HMFGetLogIdentifier();
      *buf = 138543618;
      v166 = v73;
      v167 = 2112;
      *v168 = v113;
      _os_log_impl(&dword_229538000, v72, OS_LOG_TYPE_ERROR, "%{public}@No Actions in message:(%@)", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v70);
    v111 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v113 respondWithError:v111];
  }

  v99 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2;
  block[3] = &unk_27868A3C0;
  objc_copyWeak(&v17, (a1 + 64));
  v13 = v5;
  v14 = *(a1 + 40);
  v15 = v6;
  v11 = *(a1 + 48);
  v8 = v11;
  v16 = v11;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);

  objc_destroyWeak(&v17);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_26(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_27;
  block[3] = &unk_27868A410;
  objc_copyWeak(&v11, (a1 + 56));
  v9 = v3;
  v7 = *(a1 + 40);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  dispatch_async(v4, block);

  objc_destroyWeak(&v11);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_29(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_30;
  block[3] = &unk_27868A460;
  objc_copyWeak(&v19, (a1 + 80));
  v13 = v5;
  v14 = *(a1 + 40);
  v15 = *(a1 + 48);
  v16 = v6;
  v17 = *(a1 + 56);
  v11 = *(a1 + 64);
  v8 = v11;
  v18 = v11;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);

  objc_destroyWeak(&v19);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_31(uint64_t a1, void *a2, void *a3)
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    v15 = 138543874;
    v16 = v10;
    v17 = 2112;
    v18 = v5;
    v19 = 2112;
    v20 = v6;
    _os_log_impl(&dword_229538000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Finished execution of all matter natural lighting actions with response: %@ error: %@", &v15, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  if (v6)
  {
    v11 = *(*(a1 + 48) + 8);
    v13 = *(v11 + 40);
    v12 = (v11 + 40);
    if (!v13)
    {
      objc_storeStrong(v12, a3);
    }
  }

  dispatch_group_leave(*(a1 + 40));

  v14 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_33(uint64_t a1)
{
  v2 = [*(a1 + 32) responseHandler];

  if (v2)
  {
    v3 = [*(a1 + 32) responseHandler];
    (*(v3 + 2))(v3, *(*(*(a1 + 48) + 8) + 40), 0);
  }
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_30(uint64_t a1)
{
  v56 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 88));
  v3 = *(a1 + 32);
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v48 = 0u;
  obj = *(a1 + 40);
  v42 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
  if (v42)
  {
    v41 = *v46;
    v38 = WeakRetained;
    do
    {
      for (i = 0; i != v42; ++i)
      {
        if (*v46 != v41)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v45 + 1) + 8 * i);
        v6 = [*(a1 + 48) objectForKey:v5];
        v7 = v6;
        if (v6)
        {
          v8 = *(a1 + 56);
          v9 = [v6 isNaturalLightingEnabled];
          v44 = 0;
          v10 = [v8 hmd_isValidResponseForWriteRequest:v5 naturalLightingEnabled:v9 error:&v44];
          v11 = v44;
          v12 = objc_autoreleasePoolPush();
          v13 = WeakRetained;
          v14 = HMFGetOSLogHandle();
          v15 = v14;
          if (v10)
          {
            if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
            {
              v16 = HMFGetLogIdentifier();
              *buf = 138543618;
              v50 = v16;
              v51 = 2112;
              v52 = v7;
              v17 = v15;
              v18 = OS_LOG_TYPE_INFO;
              v19 = "%{public}@Successfully executed natural lighting action: %@";
              v20 = 22;
              goto LABEL_15;
            }
          }

          else if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
          {
            v16 = HMFGetLogIdentifier();
            *buf = 138543874;
            v50 = v16;
            v51 = 2112;
            v52 = v7;
            v53 = 2112;
            v54 = v11;
            v17 = v15;
            v18 = OS_LOG_TYPE_ERROR;
            v19 = "%{public}@Failed to execute natural lighting action %@:%@";
            v20 = 32;
LABEL_15:
            _os_log_impl(&dword_229538000, v17, v18, v19, buf, v20);
          }

          objc_autoreleasePoolPop(v12);
          if (v3)
          {
            goto LABEL_24;
          }

          goto LABEL_22;
        }

        v40 = v3;
        v21 = [*(a1 + 64) objectForKey:v5];
        v22 = *(a1 + 56);
        v23 = [v5 characteristic];
        v43 = 0;
        v24 = [v22 hmd_valueOfCharacteristic:v23 error:&v43];
        v11 = v43;

        v25 = objc_autoreleasePoolPush();
        v26 = WeakRetained;
        v27 = HMFGetOSLogHandle();
        v28 = v27;
        if (v24)
        {
          if (!os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
          {
            goto LABEL_21;
          }

          v29 = HMFGetLogIdentifier();
          *buf = 138543618;
          v50 = v29;
          v51 = 2112;
          v52 = v21;
          v30 = v28;
          v31 = OS_LOG_TYPE_INFO;
          v32 = "%{public}@Successfully executed characteristic write action: %@";
          v33 = 22;
        }

        else
        {
          if (!os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_21;
          }

          v29 = HMFGetLogIdentifier();
          *buf = 138543874;
          v50 = v29;
          v51 = 2112;
          v52 = v21;
          v53 = 2112;
          v54 = v11;
          v30 = v28;
          v31 = OS_LOG_TYPE_ERROR;
          v32 = "%{public}@Failed to execute characteristic write action %@:%@";
          v33 = 32;
        }

        _os_log_impl(&dword_229538000, v30, v31, v32, buf, v33);

        WeakRetained = v38;
LABEL_21:

        objc_autoreleasePoolPop(v25);
        v3 = v40;
        if (v40)
        {
          goto LABEL_24;
        }

LABEL_22:
        if (v11)
        {
          v3 = v11;
        }

LABEL_24:
      }

      v42 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
    }

    while (v42);
  }

  if (v3)
  {
    v34 = *(*(a1 + 80) + 8);
    v36 = *(v34 + 40);
    v35 = (v34 + 40);
    if (!v36)
    {
      objc_storeStrong(v35, v3);
    }
  }

  dispatch_group_leave(*(a1 + 72));

  v37 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_27(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (*(a1 + 32))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = WeakRetained;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 32);
      v12 = 138543618;
      v13 = v6;
      v14 = 2112;
      v15 = v7;
      _os_log_impl(&dword_229538000, v5, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute action with error: %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v8 = *(*(a1 + 48) + 8);
    v10 = *(v8 + 40);
    v9 = (v8 + 40);
    if (!v10)
    {
      objc_storeStrong(v9, *(a1 + 32));
    }
  }

  dispatch_group_leave(*(a1 + 40));

  v11 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2(id *a1)
{
  v73 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 9);
  v3 = a1[4];
  v34 = a1;
  if (v3)
  {
    v4 = v3;
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v61 = v8;
      v62 = 2112;
      v63 = v4;
      _os_log_impl(&dword_229538000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute write requests for converted media action with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  else
  {
    v31 = [a1[5] count];
    v56 = 0u;
    v57 = 0u;
    v58 = 0u;
    v59 = 0u;
    v12 = a1[6];
    v35 = [v12 countByEnumeratingWithState:&v56 objects:v72 count:16];
    if (!v35)
    {

      v4 = 0;
      v11 = 0;
      goto LABEL_37;
    }

    v13 = 0;
    v4 = 0;
    obj = v12;
    v33 = *v57;
    v45 = *MEMORY[0x277CD2128];
    do
    {
      v14 = 0;
      do
      {
        if (*v57 != v33)
        {
          v15 = v14;
          objc_enumerationMutation(obj);
          v14 = v15;
        }

        v36 = v14;
        v41 = *(*(&v56 + 1) + 8 * v14);
        v16 = [v34[6] hmf_dictionaryForKey:v31];
        v52 = 0u;
        v53 = 0u;
        v54 = 0u;
        v55 = 0u;
        v39 = v16;
        v38 = [v39 countByEnumeratingWithState:&v52 objects:v71 count:16];
        if (v38)
        {
          v37 = *v53;
          do
          {
            v17 = 0;
            do
            {
              if (*v53 != v37)
              {
                objc_enumerationMutation(v39);
              }

              v40 = v17;
              v42 = *(*(&v52 + 1) + 8 * v17);
              v18 = [v39 hmf_dictionaryForKey:?];
              v48 = 0u;
              v49 = 0u;
              v50 = 0u;
              v51 = 0u;
              v19 = v18;
              v47 = [v19 countByEnumeratingWithState:&v48 objects:v70 count:16];
              if (v47)
              {
                v46 = *v49;
                v44 = v19;
                do
                {
                  for (i = 0; i != v47; ++i)
                  {
                    if (*v49 != v46)
                    {
                      objc_enumerationMutation(v19);
                    }

                    v21 = *(*(&v48 + 1) + 8 * i);
                    v22 = [v19 hmf_dictionaryForKey:v21];
                    v23 = [v22 hmf_dataForKey:v45];
                    if (v23)
                    {
                      v24 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v23 error:0];

                      v25 = objc_autoreleasePoolPush();
                      v26 = WeakRetained;
                      v27 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
                      {
                        HMFGetLogIdentifier();
                        v43 = v13;
                        v29 = v28 = WeakRetained;
                        *buf = 138544386;
                        v61 = v29;
                        v62 = 2112;
                        v63 = v41;
                        v64 = 2112;
                        v65 = v42;
                        v66 = 2112;
                        v67 = v21;
                        v68 = 2112;
                        v69 = v24;
                        _os_log_impl(&dword_229538000, v27, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute write requests for %@/%@/%@ with error: %@", buf, 0x34u);

                        WeakRetained = v28;
                        v13 = v43;
                      }

                      ++v13;

                      objc_autoreleasePoolPop(v25);
                      v4 = v24;
                      v19 = v44;
                    }
                  }

                  v47 = [v19 countByEnumeratingWithState:&v48 objects:v70 count:16];
                }

                while (v47);
              }

              v17 = v40 + 1;
            }

            while (v40 + 1 != v38);
            v38 = [v39 countByEnumeratingWithState:&v52 objects:v71 count:16];
          }

          while (v38);
        }

        v14 = v36 + 1;
      }

      while (v36 + 1 != v35);
      v35 = [obj countByEnumeratingWithState:&v56 objects:v72 count:16];
    }

    while (v35);

    v11 = 0;
    if (!v31 || v31 != v13)
    {
      goto LABEL_37;
    }

    if (!v4)
    {
      goto LABEL_38;
    }
  }

  v9 = v34;
  v10 = *(v34[8] + 1);
  if (!*(v10 + 40))
  {
    v11 = v4;
    v4 = *(v10 + 40);
    *(v10 + 40) = v11;
LABEL_37:

    v4 = v11;
LABEL_38:
    v9 = v34;
  }

  dispatch_group_leave(v9[7]);

  v30 = *MEMORY[0x277D85DE8];
}

@end