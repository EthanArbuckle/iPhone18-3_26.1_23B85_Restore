@interface HMDHome
+ (BOOL)isObjectContainedInHome:(id)a3;
+ (BOOL)updateCHIPPropertiesOnHomeModel:(id)a3 forAddedHAPAccessoryServer:(id)a4;
+ (id)decodedMigrationBulletinBoardNotifications:(id)a3;
+ (id)decodedMigrationCameraNotificationSettings:(id)a3;
+ (id)encodedMigrationBulletinBoardNotifications:(id)a3;
+ (id)encodedMigrationCameraNotificationSettings:(id)a3;
+ (id)filterUsersSupportingPresence:(id)a3;
+ (id)getBuiltinActionSets;
+ (id)logCategory;
+ (id)migrationBulletinBoardNotificationsForHome:(id)a3;
+ (id)migrationCameraNotificationSettingsForHome:(id)a3;
+ (id)nfcIssuerKeyIdentifierWithPairingIdentity:(id)a3;
+ (id)notificationPayloadForChangedCharacteristics:(id)a3 destinationIsXPCTransport:(BOOL)a4;
+ (id)shortDescription;
+ (id)supportedAccessoryClasses;
+ (id)zoneIDFromHomeUUID:(id)a3;
+ (unint64_t)privilegeFromUserInviteInformation:(id)a3;
+ (void)_initialize;
+ (void)appendCharacteristicsToAccessoryList:(id)a3 responseTuples:(id)a4 forMultipleCharacteristicsRemoteRead:(id)a5;
+ (void)appendCharacteristicsToAccessoryList:(id)a3 responseTuples:(id)a4 forMultipleCharacteristicsRemoteWrite:(id)a5 message:(id)a6;
+ (void)updateCHIPPropertiesOnAccessoryModel:(id)a3 forAddedHAPAccessoryServer:(id)a4;
- (BOOL)__shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:(id)a3 error:(id *)a4;
- (BOOL)_addAccessory:(id)a3;
- (BOOL)_addOwnerToPrimaryAccessory:(id)a3 error:(id *)a4;
- (BOOL)_canCurrentDeviceRegisterForReachabilityEventNotification;
- (BOOL)_doesUsersHaveCATID;
- (BOOL)_ensureDevicesSymptomDiscoveryMessageCanBeHandled:(id)a3;
- (BOOL)_hasPairedReachableBTLEAccessories;
- (BOOL)_isAccessToHomeAllowed;
- (BOOL)_isEventTriggerOnLocalDeviceForAccessory:(id)a3;
- (BOOL)_isEventTriggerOnRemoteGatewayForAccessory:(id)a3;
- (BOOL)_isNetworkRouterSupportEnabledForCurrentDevice;
- (BOOL)_isReadRequestAllowForCharacteristics:(id)a3 message:(id)a4 error:(id *)a5;
- (BOOL)_isRegisteredForNotificationsForClients:(id)a3;
- (BOOL)_isRegisteredForNotificationsWithRemoteGateway:(id)a3;
- (BOOL)_isRetrievalInProgressForPrimaryAccessory:(id)a3 linkType:(int64_t)a4;
- (BOOL)_isSecureClassTriggeredByCharacteristics:(id)a3;
- (BOOL)_isSharedHomeVersionTrustZoneCapable;
- (BOOL)_isUserValid:(id)a3 error:(id *)a4;
- (BOOL)_loadBalanceWriteRequestOnResidentForAccessory:(id)a3 accessoryWriteRequestMapTable:(id)a4 requestMessage:(id)a5 source:(unint64_t)a6 biomeSource:(unint64_t)a7 responseTuples:(id)a8 withCompletionHandler:(id)a9;
- (BOOL)_passReadRequestToCompanion:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 pendingResponses:(id)a6 remoteAccessories:(id)a7 withCompletionHandler:(id)a8;
- (BOOL)_passWriteRequestToCompanion:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 biomeSource:(unint64_t)a6 remoteAccessories:(id)a7 responseTuples:(id)a8 withCompletionHandler:(id)a9;
- (BOOL)_populateTriggerModel:(id)a3 fromBuilderMessage:(id)a4 transaction:(id)a5 responsePayload:(id)a6;
- (BOOL)_processTestModeHomeAccessControlOverride:(id)a3 error:(id *)a4;
- (BOOL)_processTestModeHomeLocationStatusOverride:(id)a3 error:(id *)a4;
- (BOOL)_processTestModeSkipHH2MigrationOverride:(id)a3 error:(id *)a4;
- (BOOL)_processTestModeUpdateHomeLocation:(id)a3 error:(id *)a4;
- (BOOL)_removeAccessory:(id)a3;
- (BOOL)_residentDeviceAvailable;
- (BOOL)_shouldAllowAddingAccessoryOfCategory:(id)a3 requestMessage:(id)a4 error:(id *)a5;
- (BOOL)_shouldAllowAddingAccessoryWithDescription:(id)a3 requestMessage:(id)a4 error:(id *)a5;
- (BOOL)_shouldAvoidTombstoningAccessoryServer:(id)a3 accessory:(id)a4;
- (BOOL)_shouldFallbackLocallyForRemoteMatterRequest:(id)a3;
- (BOOL)_shouldRateLimitChangeNotificationsForCharacteristic:(id)a3;
- (BOOL)_shouldRegisterForNotificationsWithDevice:(id)a3;
- (BOOL)_shouldSendToDestination:(id)a3 device:(id)a4 remoteSourceDevice:(id)a5;
- (BOOL)_shouldUseDeprecatedAddAccessoryMessage:(id)a3 minimumVersion:(id)a4 primaryResident:(id)a5 shouldRelayMessages:(BOOL)a6;
- (BOOL)_shouldWaitForAccessoriesToBeReachable;
- (BOOL)_validateAddingNewTriggerWithName:(id)a3 message:(id)a4;
- (BOOL)_verifyUserManagementPermissionForAccessory:(id)a3 error:(id *)a4;
- (BOOL)applyDeviceLockStatus:(id)a3;
- (BOOL)areAllResidentsUnreachable;
- (BOOL)areAllThreadResidentNodesUnreachable;
- (BOOL)attemptToUpdateThreadNetworkID:(id)a3;
- (BOOL)auditStorageWithFabricData:(id)a3;
- (BOOL)bulletinBoardNotificationsMigrationFileExistsOnDisk;
- (BOOL)cameraNotificationSettingsMigrationFileExistsOnDisk;
- (BOOL)canTopicBeForwardedToPrimaryFromResident:(id)a3;
- (BOOL)checkForNetworkRouterSupport:(unint64_t)a3 error:(id *)a4;
- (BOOL)configureWithHomeManager:(id)a3 accessoriesPresent:(id)a4 uncommittedTransactions:(id)a5 source:(unint64_t)a6;
- (BOOL)containsRemovedUser:(id)a3;
- (BOOL)currentDeviceSupportsSidekickSettings;
- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithNoPasscodeForSiriSecureAccessoryAccessController:(id)a3;
- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithWatchAuthForSiriSecureAccessoryAccessController:(id)a3;
- (BOOL)currentRemoteReachabilityRegistration;
- (BOOL)defaultRoomContainsAccessoryWithUUID:(id)a3;
- (BOOL)doesHomeContainResident;
- (BOOL)doesThisHomeHaveCameras;
- (BOOL)enabledResidentsSupportsHomeHub;
- (BOOL)evaluatePredicate:(id)a3;
- (BOOL)getUpdateTransactionForAccessory:(id)a3 hapAccessory:(id)a4 accessoryTransaction:(id)a5 addSvcTransactions:(id *)a6 updateSvcTransactions:(id *)a7 removeSvcTransactions:(id *)a8;
- (BOOL)hasActiveWACPairing;
- (BOOL)hasAnyAccessoryWithWalletKeyAndAccessCodeSupport;
- (BOOL)hasAnyAccessoryWithWalletKeySupport;
- (BOOL)hasAnyReachableAccessories;
- (BOOL)hasCharacteristicNotificationRegistrations;
- (BOOL)hasNeverAddedAnyHAPAccessory;
- (BOOL)hasPostedWalletKeyOnboardingBulletinForAnyAccessory;
- (BOOL)hasResidentDevicesForPrimaryResidentChangeMonitor:(id)a3;
- (BOOL)hasSharedUser;
- (BOOL)hasSiriEndpointAccessory;
- (BOOL)hasThreadCapableResident;
- (BOOL)isAccessAllowedForCharacteristicsWithMessage:(id)a3;
- (BOOL)isActiveNetworkRouterInitialSetupNeeded;
- (BOOL)isAdminUser;
- (BOOL)isAnyBTLEAccessoryReachable;
- (BOOL)isAppleMediaAccessory:(id)a3;
- (BOOL)isAutomaticSoftwareUpdateEnabled;
- (BOOL)isAutomaticThirdPartyAccessorySoftwareUpdateEnabled;
- (BOOL)isCarPlayAccessAllowedForActionSet:(id)a3 withMessage:(id)a4 fromSource:(unint64_t)a5;
- (BOOL)isCarPlayAccessAllowedForCharacteristic:(id)a3 withMessage:(id)a4 fromSource:(unint64_t)a5;
- (BOOL)isClientIdentifierSubscribedToAppleMediaAccessoryState:(id)a3;
- (BOOL)isCompanionReachable;
- (BOOL)isCurrentDeviceAvailableResident;
- (BOOL)isCurrentDeviceConfirmedPrimaryResident;
- (BOOL)isCurrentDevicePairedWithWatchForSiriSecureAccessoryAccessController:(id)a3;
- (BOOL)isCurrentDevicePrimaryResident;
- (BOOL)isCurrentDevicePrimaryResidentForRemoteEventRouterClientController:(id)a3;
- (BOOL)isCurrentDeviceResidentCapableForRemoteEventRouterClientController:(id)a3;
- (BOOL)isCurrentDeviceThreadBorderRouterCapable;
- (BOOL)isCurrentDeviceThreadPreferredPrimaryResident;
- (BOOL)isDeviceIdentifierPrimaryResident:(id)a3;
- (BOOL)isDevicePrimaryResident:(id)a3;
- (BOOL)isMediaPeerToPeerEnabled;
- (BOOL)isMediaSystem:(id)a3;
- (BOOL)isOwnerUser;
- (BOOL)isPrimaryResidentNodeReachable;
- (BOOL)isRemoteAccessDeviceReachable;
- (BOOL)isResidentReachable:(id)a3;
- (BOOL)isResidentSupported;
- (BOOL)isSharedAdmin;
- (BOOL)isSidekickAccessory:(id)a3;
- (BOOL)isSiriPhraseOptionsHeySiriEnabled;
- (BOOL)isSiriPhraseOptionsJustSiriEnabled;
- (BOOL)isSmokeAlarmEnabled;
- (BOOL)isThisHomeMigratedToHH2;
- (BOOL)isThreadCapable;
- (BOOL)isThreadNetworkUp;
- (BOOL)ownerTrustZoneCapable;
- (BOOL)remoteAccessIsEnabled;
- (BOOL)remoteEventAllowedForTopic:(id)a3 deviceType:(unint64_t)a4 userType:(unint64_t)a5;
- (BOOL)requiresUnlockToAccessCharacteristics:(id)a3 withMessage:(id)a4;
- (BOOL)router:(id)a3 shouldHandleMessage:(id)a4 usingRouter:(id)a5;
- (BOOL)setUpAccessoryServerBrowserWithOperationalFabricData:(id)a3 ownerDataSnapshot:(id)a4 error:(id *)a5;
- (BOOL)setUpOperationalFabricDataWithError:(id *)a3;
- (BOOL)shouldAccessoryRemovalFallbackToLocalRemovalOnError:(id)a3 accessory:(id)a4;
- (BOOL)shouldAllowTopic:(id)a3 forDeviceWithMessageIdentifier:(id)a4;
- (BOOL)shouldEnableResidentFirstAccessoryCommunication;
- (BOOL)shouldEncodeLegacyLocationServiceSettingForSettingsParentUUID:(id)a3;
- (BOOL)shouldRelayNotificationToRegisteredDevicesForSource:(id)a3;
- (BOOL)shouldRestrictAllMessagingToLocalTransportsForUser:(id)a3;
- (BOOL)storeIntoLegacyStorageWithFabricData:(id)a3;
- (BOOL)storeNewFabricData:(id)a3;
- (BOOL)storeSharedHomeFabricData:(id)a3;
- (BOOL)supportsDeviceWithCapabilities:(id)a3;
- (BOOL)supportsRouterManagement;
- (BOOL)supportsSiriEndpointOnBoarding;
- (BOOL)synchronouslyFetchIsCarPlayConnectedStatus;
- (BOOL)synchronouslyFetchIsConnectedToCarPlayNetwork;
- (BOOL)updateFabricUsingHomeModel:(id)a3;
- (BOOL)validateActionsDoNotConflict:(id)a3;
- (BOOL)watchSkipVersionCheck;
- (HMDAccessory)currentAccessory;
- (HMDAccessoryCount)accessoryCount;
- (HMDActionSet)_createActionSetWithUUID:(void *)a3 name:(void *)a4 type:(void *)a5 fromDictionary:(void *)a6 transaction:(void *)a7 response:(void *)a8 error:;
- (HMDBackingStore)backingStore;
- (HMDDevice)companionDevice;
- (HMDDevice)currentDevice;
- (HMDFeaturesDataSource)featuresDataSource;
- (HMDHAPAccessory)activeNetworkRouterAccessory;
- (HMDHome)initWithCoder:(id)a3;
- (HMDHome)initWithName:(id)a3 uuid:(id)a4 defaultRoomUUID:(id)a5 owner:(id)a6 homeManager:(id)a7 presenceAuth:(id)a8 dataSource:(id)a9;
- (HMDHome)initWithName:(id)a3 uuid:(id)a4 defaultRoomUUID:(id)a5 owner:(id)a6 homeManager:(id)a7 presenceAuth:(id)a8 dataSource:(id)a9 logEventSubmitter:(id)a10 carPlayDataSource:(id)a11 administratorHandlerFactory:(id)a12 localCapabilitiesDataSource:(id)a13 notificationCenter:(id)a14 keychainStore:(id)a15;
- (HMDHomeKitVersion)minHomeKitVersionForAccessoryNetworkProtectionChange;
- (HMDHomeKitVersion)minimumNetworkRouterSupportHomeKitVersion;
- (HMDHomeManager)homeManager;
- (HMDHomeNFCReaderKey)nfcReaderKey;
- (HMDHomePersonManager)personManager;
- (HMDNaturalLightingContext)naturalLightingContext;
- (HMDNetworkRouterClientManager)routerClientManager;
- (HMDSiriSecureAccessoryAccessController)siriSecureAccessoryAccessController;
- (HMDUser)currentUser;
- (HMEEventForwarder)eventForwarder;
- (HMFMessageDestination)messageDestination;
- (HMFWiFiManager)wifiManager;
- (HMHomePersonManagerSettings)personManagerSettings;
- (HMMDailyScheduler)dailyScheduler;
- (NSArray)accessories;
- (NSArray)accessoriesRequiringManualReconfigurationOnRouterRemoval;
- (NSArray)accessoriesWithWalletKeySupport;
- (NSArray)actionSets;
- (NSArray)appleMediaAccessories;
- (NSArray)cameraAccessories;
- (NSArray)enabledResidents;
- (NSArray)hapAccessories;
- (NSArray)hapAccessoriesForLegacyDataBlobEncoding;
- (NSArray)matterAccessories;
- (NSArray)mediaSessionStates;
- (NSArray)mediaSessions;
- (NSArray)mediaSystems;
- (NSArray)outgoingInvitations;
- (NSArray)removedUsers;
- (NSArray)residentCapableDevices;
- (NSArray)residentEnabledDevices;
- (NSArray)rooms;
- (NSArray)serviceGroups;
- (NSArray)triggerOwnedActionSets;
- (NSArray)triggers;
- (NSArray)users;
- (NSArray)usersPendingUserManagementOperations;
- (NSArray)usersSupportingPresence;
- (NSArray)wiFiRouterAccessories;
- (NSArray)zones;
- (NSData)threadOperationalDataset;
- (NSDictionary)assistantObject;
- (NSHashTable)removeAccessoryInProgressForHMDAccessories;
- (NSMapTable)addPendingAccessories;
- (NSMutableDictionary)addPendingAccessorySetupCodeHandlers;
- (NSNumber)availableBSPsCount;
- (NSNumber)availableBorderRouters;
- (NSNumber)matterFabricID;
- (NSNumber)overriddenHomeAccessControl;
- (NSSet)notificationDeregistrations;
- (NSSet)notificationRegistrations;
- (NSString)contextID;
- (NSString)name;
- (NSString)threadNetworkID;
- (NSString)unfilteredThreadNetworkID;
- (NSString)urlString;
- (NSUUID)activeNetworkRouterUUID;
- (NSUUID)contextSPIUniqueIdentifier;
- (NSUUID)primaryNetworkRouterManagingDeviceUUID;
- (id)__modelObjectsForRemovingOutgoingInvitationForUser:(id)a3;
- (id)__readWriteResponseHandler:(id)a3 unhandledRequests:(id)a4;
- (id)__residentDeviceForAccessory:(id)a3 fromMap:(id)a4;
- (id)_addMediaSessionForCurrentAccessory:(id)a3;
- (id)_appDataContainerForMessage:(id)a3;
- (id)_buildRequestMapTableFromRequests:(id)a3 pendingResponses:(id)a4;
- (id)_changedHMDCharacteristicsForHAPCharacteristics:(id)a3 stateNumber:(id)a4 broadcast:(BOOL)a5 accessoryServer:(id)a6;
- (id)_characteristicNotificationPayloadsOnDirectTransports:(BOOL)a3;
- (id)_checkResidentCapabilitiesForCredentialSharing:(id)a3;
- (id)_createBuiltinActionSets;
- (id)_createEventsPayload:(uint64_t)a1;
- (id)_createMediaSessionWithEndpoint:(id)a3;
- (id)_createMessageForReadWriteRequest:(id)a3 source:(unint64_t)a4 withCompletionHandler:(id)a5;
- (id)_disablePayloadFromRemotelyUpdatedCharacteristicNotifications:(id)a3;
- (id)_enqueueRetrievalTupleForAccessory:(id)a3 linkType:(int64_t)a4 inProgress:(BOOL *)a5 completion:(id)a6;
- (id)_getReachabilityTupleForAccessoryUUID:(id)a3;
- (id)_handleRenameHomeModel:(id)a3 message:(id)a4;
- (id)_hasConfirmedPrimaryResidentDevice;
- (id)_hmdCharacteristicsForUpdatedHAPCharacteristics:(id)a3 accessoryServer:(id)a4;
- (id)_initWithCoder:(id)a3;
- (id)_outgoingInvitationForUserWithHandle:(id)a3;
- (id)_primaryAccessoryForServer:(id)a3;
- (id)_productDataFromHAPAccessory:(id)a3;
- (id)_readRequestTuplesFromMessage:(id)a3 outUnhandledRequests:(id *)a4;
- (id)_removeAccessoriesCommon:(id)a3;
- (id)_residentDeviceForResidentUser:(id)a3;
- (id)_residentUserForResidentDevice:(id)a3;
- (id)_residentUsers;
- (id)_retrieveTupleForPrimaryAccessory:(id)a3 linkType:(int64_t)a4;
- (id)_setupCodeProviderForMessage:(id)a3;
- (id)_setupDescriptionFromData:(id)a3 error:(id *)a4;
- (id)_setupPendingResponseTimerIdentifier:(id)a3 originalRequestIdentifier:(id)a4;
- (id)_splitCharacteristicChanges:(id)a3 changedAccessories:(id)a4;
- (id)_unexpectedCharacteristicsFromCharacteristicNotifications:(id)a3;
- (id)_updateAndGetOwnedTriggers;
- (id)_userForDevice:(id)a3;
- (id)accessoriesWithUUIDs:(id)a3;
- (id)accessoryAdministerPrivilegeCATID:(BOOL)a3;
- (id)accessoryForMediaProfileUniqueIdentifier:(id)a3;
- (id)accessoryOperatePrivilegeCATID:(BOOL)a3;
- (id)accessorySettingsMessengerMessageTargetUUID;
- (id)accessoryWithDeviceIdentifier:(id)a3;
- (id)accessoryWithEndpointIdentifier:(id)a3;
- (id)accessoryWithIdentifier:(id)a3;
- (id)accessoryWithSPIClientIdentifier:(id)a3;
- (id)accessoryWithUUID:(id)a3;
- (id)actionSetWithName:(id)a3;
- (id)actionSetWithUUID:(id)a3;
- (id)actionWithDictionaryRepresentation:(id)a3;
- (id)addActionSetName:(id)a3;
- (id)addName:(id)a3;
- (id)allNewlyConfiguredAccessories;
- (id)audioDestinationControllerDataForDestination:(id)a3;
- (id)backingStoreObjects:(int64_t)a3;
- (id)balancedResidentMapForAccessories:(id)a3;
- (id)builtInActionSetInfo;
- (id)createAccessorySettingsLocalMessageHandlerWithHomeUUID:(id)a3 languageValuesDataProvider:(id)a4;
- (id)createAccessorySettingsMessengerWithMessageTargetUUID:(id)a3 messageDispatcher:(id)a4 messageRouter:(id)a5 messageHandler:(id)a6 logEventSubmitter:(id)a7 legacyMessageReceiver:(id)a8;
- (id)createActionSetWithName:(id)a3 uuid:(id)a4 type:(id)a5;
- (id)createAppleMediaAccessoriesStateManagerMetricsDispatcherWithIdentifier:(id)a3 logEventSubmitter:(id)a4;
- (id)createAppleMediaAccessoriesStateManagerWithIdentifier:(id)a3 messenger:(id)a4 metricsDispatcher:(id)a5;
- (id)createAppleMediaAccessoriesStateMessengerWithIdentifier:(id)a3 messageDispatcher:(id)a4;
- (id)createMultiuserSettingsMessenger:(id)a3 messageDispatcher:(id)a4;
- (id)createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:(id)a3 operationalKeyPair:(id)a4 error:(id *)a5;
- (id)createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:(id)a3;
- (id)createPrimaryResidentMessageRouterWithHomeUUID:(id)a3 messageDispatcher:(id)a4 metricsDispatcher:(id)a5;
- (id)createSiriEndpointProfileMessageHandlerWithHomeUUID:(id)a3;
- (id)createSiriEndpointProfilesMessengerWithMessageTargetUUID:(id)a3 messageDispatcher:(id)a4 messageRouter:(id)a5 messageHandler:(id)a6;
- (id)createUnifiedLanguageValueListSettingDataProvider;
- (id)currentAccessoryHomeUUID;
- (id)currentAccessorySetupMetricDispatcher;
- (id)deletedBackingStoreObject;
- (id)descriptionWithPointer:(BOOL)a3;
- (id)destinationControllerDataForAppleMediaAccessory:(id)a3;
- (id)destinationControllerWithCommittedDestinationIdentifier:(id)a3;
- (id)destinationControllerWithDestinationIdentifier:(id)a3;
- (id)destinationControllerWithIdentifier:(id)a3;
- (id)destinationControllers;
- (id)destinationForAppleMediaAccessory:(id)a3;
- (id)destinationForMediaSystem:(id)a3;
- (id)destinationManagerPassingTest:(id)a3;
- (id)destinationManagerWithDestinationIdentifier:(id)a3;
- (id)destinationManagerWithParentIdentifier:(id)a3;
- (id)destinationManagersWithDestinationIdentifiers:(id)a3 supportedOptions:(unint64_t)a4;
- (id)deviceForAccessoryUUID:(id)a3 forRemoteEventRouterClientController:(id)a4;
- (id)deviceForAppleMediaAccessoryMessageRouter:(id)a3 message:(id)a4;
- (id)deviceForPrimaryResidentForRemoteEventRouterClientController:(id)a3;
- (id)dumpActionSetDescriptionWithPrivacyLevel:(unint64_t)a3;
- (id)dumpCharacteristicNotificationRegistry;
- (id)dumpMediaSessionDescriptionWithPrivacyLevel:(unint64_t)a3;
- (id)dumpStateWithPrivacyLevel:(unint64_t)a3;
- (id)emptyModelObjectWithChangeType:(unint64_t)a3;
- (id)eventRouterDumpStateInfo;
- (id)eventRouterServerDiagnosticInfo;
- (id)eventSourceForMediaGroupsAggregator:(id)a3;
- (id)eventStoreReadHandle;
- (id)eventStoreReadHandleForRemoteEventRouterClientController:(id)a3;
- (id)eventStoreWriteHandleForRemoteEventRouterClientController:(id)a3;
- (id)expandedTopicsWithTopics:(id)a3;
- (id)fabricDataInLegacyStorage;
- (id)fetchOperationalFabricDataWithError:(id *)a3;
- (id)filterBuiltinActionSets:(id)a3;
- (id)getBulletinBoardNotificationSerializedFileName;
- (id)getCameraNotificationSettingsSerializedFileName;
- (id)getServiceTransaction:(id)a3 parentUUID:(id)a4 changeType:(unint64_t)a5;
- (id)getTransactionFromHAPAccessory:(id)a3 hmdAccessory:(id)a4 uuid:(id)a5 hostAccessoryUUID:(id)a6 objectChangeType:(unint64_t)a7;
- (id)hapAccessoriesForServer:(id)a3;
- (id)hapAccessoriesForServer:(id)a3 linkType:(int64_t)a4;
- (id)hapAccessoryServerIdentifiers;
- (id)hapAccessoryUniqueIdentifiers;
- (id)hapAccessoryWithIdentifier:(id)a3;
- (id)hapAccessoryWithIdentifier:(id)a3 instanceID:(id)a4;
- (id)hmdHAPAccessoryWithHAPAccessory:(id)a3;
- (id)homeBulletinContext;
- (id)homeConfigurationModelObjectWithChangeType:(unint64_t)a3;
- (id)homeConfigurationUUID;
- (id)homeLocationWithPrivacyLevel:(unint64_t)a3;
- (id)hubAccessories;
- (id)iCloudIdentifier;
- (id)lightProfileWithUUID:(id)a3;
- (id)loadMigrationBulletinBoardNotificationsFromDisk;
- (id)loadMigrationCameraNotificationSettingsFromDisk;
- (id)localAndRemoteSubscriptionProvider;
- (id)matterAccessoriesWithNewFirmwareInstalledInHome;
- (id)matterAccessoryWithIdentifier:(id)a3;
- (id)matterAccessoryWithNodeID:(id)a3;
- (id)mediaDestinationManagersWithHomeTheaterSupportedOptions;
- (id)mediaDestinationManagersWithSupportedOptions:(unint64_t)a3;
- (id)mediaDestinationsInRoom:(id)a3;
- (id)mediaGroupsAggregateDataTopicName;
- (id)mediaNotificationPayloadForProfile:(void *)a1;
- (id)mediaPassword;
- (id)mediaProfileWithUUID:(id)a3;
- (id)mediaSessionStateWithIdentifier:(id)a3;
- (id)mediaSessionWithIdentifier:(id)a3;
- (id)mediaSessionWithUUID:(id)a3;
- (id)mediaSystemController:(id)a3 accessoryForUUID:(id)a4;
- (id)mediaSystemForAppleMediaAccessory:(id)a3;
- (id)mediaSystemWithUUID:(id)a3;
- (id)mediaSystemsWithUUIDs:(id)a3;
- (id)messageTargetForDeviceIdentifier:(id)a3;
- (id)migrateOwnedTriggers;
- (id)modelObjectWithChangeType:(unint64_t)a3 version:(int64_t)a4;
- (id)multiUserSettings;
- (id)namesOfServicesWithNewFirmwareAvailableInHome;
- (id)newFabricData;
- (id)notificationRegistrationsForAppleMediaAccessories;
- (id)operationalKeyPairForPairing;
- (id)outgoingInvitationWithUUID:(id)a3;
- (id)owner;
- (id)participantDataTopicForAccessory:(id)a3 mediaGroupsAggregator:(id)a4;
- (id)performReadRequests:(id)a3 loggingObject:(id)a4 flow:(id)a5;
- (id)performReadRequests:(id)a3 withRetries:(int64_t)a4 timeInterval:(double)a5 loggingObject:(id)a6 flow:(id)a7;
- (id)performWriteRequests:(id)a3 loggingObject:(id)a4 flow:(id)a5;
- (id)performWriteRequests:(id)a3 withRetries:(int64_t)a4 timeInterval:(double)a5 loggingObject:(id)a6 flow:(id)a7;
- (id)playbackArchiveWithSessionIdentifier:(id)a3;
- (id)prepareUserManagementOperationForUser:(id)a3 accessories:(id)a4 type:(unint64_t)a5 error:(id *)a6;
- (id)prepareUserManagementOperationForUser:(id)a3 accessory:(id)a4 type:(unint64_t)a5 model:(id)a6 error:(id *)a7;
- (id)primaryResident;
- (id)primaryResidentDeviceIdentifierForRemoteEventRouterClientController:(id)a3;
- (id)propertiesRegisteredForMediaProfileUniqueIdentifier:(id)a3;
- (id)receiverForParticipantAccessoryUUID:(id)a3 mediaGroupsLocalDataStorage:(id)a4;
- (id)removeName:(id)a3;
- (id)replaceActionSetName:(id)a3 withNewName:(id)a4;
- (id)replaceName:(id)a3 withNewName:(id)a4;
- (id)resolveReceiverForMessageTargetUUID:(id)a3;
- (id)retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:(id)a3;
- (id)roomForAccessoryUUID:(id)a3;
- (id)roomForAllDestinationParentIdentifiers:(id)a3;
- (id)roomWithName:(id)a3;
- (id)roomWithUUID:(id)a3;
- (id)roomWithUniqueIdentifier:(id)a3 forClientIdentifierSalt:(id)a4;
- (id)rootDestinationManagerWithDescendantDestinationIdentifier:(id)a3;
- (id)routerForParticipantAccessoryUUID:(id)a3 mediaGroupsLocalDataStorage:(id)a4;
- (id)routerServerUserAccessControlProviderForIdentifier:(id)a3;
- (id)routerServerUserAccessControlProviderIdentifierForMessage:(id)a3;
- (id)sameRoomAccessoryUUIDsForDestinationControllerData:(id)a3 mediaGroupsAggregator:(id)a4;
- (id)serviceGroupWithName:(id)a3;
- (id)serviceGroupWithUUID:(id)a3;
- (id)sharedHomeModel;
- (id)sharedUsers;
- (id)shortDescription;
- (id)storedFabricDataWithDataPresentInV2FabricDataStore:(BOOL *)a3 error:(id *)a4;
- (id)storedOperationalKeyPair;
- (id)storedSharedHomeFabricData;
- (id)targetAccessoriesWithDestinationIdentifiers:(id)a3;
- (id)timerWithTimerInterval:(double)a3;
- (id)triggerOwnedActionSetWithUUID:(id)a3;
- (id)triggerWithName:(id)a3;
- (id)triggerWithUUID:(id)a3;
- (id)updateHomeWithModel:(id)a3 message:(id)a4;
- (id)updatePersonManagerSettings:(id)a3;
- (id)userWithMergeID:(id)a3;
- (id)userWithPairingIdentity:(id)a3;
- (id)userWithPairingIdentityIdentifier:(id)a3;
- (id)userWithUUID:(id)a3;
- (id)validateName:(id)a3;
- (id)writeRequestTuplesFromMessage:(id)a3 outUnhandledRequests:(id *)a4;
- (id)zoneWithName:(id)a3;
- (id)zoneWithUUID:(id)a3;
- (int64_t)atHomeLevel;
- (int64_t)destinationTypeForDestinationWithIdentifier:(id)a3;
- (int64_t)homeLocation;
- (int64_t)minimumMediaUserPrivilege;
- (int64_t)protectionMode;
- (int64_t)reachableAccessoriesCount;
- (int64_t)reachableAccessoriesCountExcludingMatter;
- (int64_t)reachableAppleMediaAccessoriesCount;
- (uint64_t)isCharacteristicAllowedForCarPlayAccess:(void *)a1;
- (uint64_t)isMessageEntitledForCarPlayAccess:(uint64_t)a3 source:;
- (uint64_t)supportsUnifiedMediaNotificationsOnResidents;
- (unint64_t)accessNotAllowedReasonCode;
- (unint64_t)accessoryCountForRoom:(id)a3;
- (unint64_t)accessorySettingsLocalMessageHandler:(id)a3 callerPrivilegeWithMessage:(id)a4;
- (unint64_t)assistantAccessCapableAccessoryCount;
- (unint64_t)deriveNetworkRouterSupport:(unint64_t)a3;
- (unint64_t)networkRouterSupport;
- (unint64_t)networkRouterSupportDisableReason;
- (unint64_t)numMatterV2Keys;
- (unint64_t)threadNetworkSequenceNumber;
- (void)__addMediaSession:(id)a3;
- (void)__encodeAccessoriesWithCoder:(id)a3 options:(unint64_t)a4;
- (void)__handleAcceptedOutgoingInvitationResponse:(id)a3 destinationAddress:(id)a4 publicKey:(id)a5 username:(id)a6 issuerPublicKeyER:(id)a7 presenceAuthStatus:(id)a8 completionHandler:(id)a9;
- (void)__handleAddHAPAccessoryModel:(id)a3 message:(id)a4;
- (void)__handleAddMediaAccessoryModel:(id)a3 message:(id)a4;
- (void)__handleCancelledOutgoingInvitation:(id)a3;
- (void)__handleCompletedOutgoingInvitation:(id)a3;
- (void)__handleProcessStateChange:(id)a3;
- (void)__removeAccessory:(void *)a1 isBeingReplaced:(void *)a2 isForceUpdate:(char)a3 message:(void *)a4;
- (void)__requestAccessoryBrowsing;
- (void)__saveConfigurationVersionTransaction;
- (void)__updateServiceTransaction:(id)a3 accessoryTransaction:(id)a4 service:(id)a5 accessory:(id)a6 hapService:(id)a7;
- (void)_accessoryPairingDidComplete:(id)a3 configuration:(id)a4 pairingEvent:(id)a5 accessoryServer:(id)a6 certificationStatus:(int64_t)a7 requestMessage:(id)a8;
- (void)_addAccessories:(id)a3;
- (void)_addAccessoryToBalancedResidentMap:(id)a3 residentDevice:(id)a4 balancedResidentMap:(id)a5;
- (void)_addAllUsersToAccessory:(id)a3;
- (void)_addAndMaybeAssociateMediaAccessory:(void *)a3 message:;
- (void)_addMediaAccessory:(id)a3 message:(id)a4;
- (void)_addNewTrigger:(id)a3 message:(id)a4 payloadAnnex:(id)a5 triggerModel:(id)a6;
- (void)_addOutgoingInvitations:(id)a3 message:(id)a4 transactionCompleted:(id)a5;
- (void)_addResidentWithUsername:(id)a3 publicKey:(id)a4 destination:(id)a5;
- (void)_addResponseTuplesFromDictionary:(id)a3 accessoryRequestMapTable:(id)a4 responseTuples:(id)a5 completedGroup:(id)a6 logEvents:(id)a7;
- (void)_addRetrievalCompletionTuple:(id)a3;
- (void)_addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3 message:(id)a4;
- (void)_addTransactionForMinimumNetworkRouterHomeKitVersion:(id)a3 message:(id)a4;
- (void)_addTransactionWithProtectionMode:(id)a3 message:(id)a4;
- (void)_addUserToContainer:(id)a3;
- (void)_addUserToIdentityRegistry:(id)a3;
- (void)_addUsers:(id)a3 accessory:(id)a4;
- (void)_addUsersWithInviteInformations:(id)a3 message:(id)a4;
- (void)_applyDeviceLockCheck:(uint64_t)a3 forSource:(void *)a4 message:(void *)a5 completion:;
- (void)_applyNotificationDeregistrations;
- (void)_areWriteRequestsAllowed:(id)a3 message:(id)a4 completion:(id)a5;
- (void)_auditAndDeregisterCharacteristicsForHAPAccessory:(id)a3;
- (void)_auditChangedCharacteristics:(id)a3;
- (void)_buildCharacteristicWriteRequest:(id)a3 accessoryWriteRequestMapTable:(id)a4 accessoryList:(id)a5 responseTuples:(id)a6 user:(id)a7;
- (void)_cancelPairingWithAccessoryDescription:(id)a3 context:(id)a4;
- (void)_cancelPairingWithAccessoryUUID:(id)a3 context:(id)a4 completionHandler:(id)a5;
- (void)_cleanAddAccessoryOperations;
- (void)_cleanRemovedUsers:(id)a3;
- (void)_clearAccessoryNetworkProtectionStateWithTransaction:(id)a3;
- (void)_clearCHIPStorageWithCompletion:(id)a3;
- (void)_configureBulletinNotification;
- (void)_configureConfiguredResident:(id)a3 desiredConfigState:(unint64_t)a4 message:(id)a5;
- (void)_configureNetworkRouterClientManager:(id)a3;
- (void)_configureUnconfiguredResident:(id)a3 desiredConfigState:(unint64_t)a4;
- (void)_continueLegacyAddAccessoryWithUUID:(id)a3 unassociatedAccessory:(id)a4 setupCode:(id)a5 appID:(id)a6 message:(id)a7;
- (void)_continuePairingAfterUserConsentWithAccessoryDescription:(id)a3 progressHandlerDelegate:(id)a4 message:(id)a5;
- (void)_continuePairingAfterUserConsentWithAccessoryUUID:(id)a3 orUnassociatedAccessory:(id)a4 message:(id)a5;
- (void)_createModifyNotificationsCoalesceTimerIfNeeded;
- (void)_createUniquePSKClientConfigurationWithRequestMessage:(id)a3 pairingEvent:(id)a4 completion:(id)a5;
- (void)_dequeueRetrievalForAccessory:(id)a3 linkType:(int64_t)a4 error:(id)a5;
- (void)_deregisterDeviceForReachabilityNotification:(id)a3;
- (void)_deregisterPairedAccessory:(id)a3;
- (void)_disableDirectCharacteristicNotificationsForClient:(id)a3;
- (void)_disableNotificationsForClient:(id)a3;
- (void)_disableNotificationsForDevices:(id)a3;
- (void)_dispatchCHIPReport:(id)a3 destination:(id)a4;
- (void)_enableMediaNotifications:(void *)a3 directlyOnMediaAccessory:(void *)a4 completion:;
- (void)_enableMediaNotifications:(void *)a3 forMediaAccessory:;
- (void)_enableMultiUserWithMessage:(void *)a1;
- (void)_enableNotificationsForDevices:(id)a3;
- (void)_encodeActionSets:(id)a3 coder:(id)a4;
- (void)_encodeObjectsWithAccessoriesWithCoder:(id)a3;
- (void)_encodeWithCoder:(id)a3;
- (void)_evaluateNetworkProtectionAndRouterManagement;
- (void)_evaluateNetworkProtectionSupport;
- (void)_evaluateNetworkRouterManagementForTransaction:(id)a3;
- (void)_evaluateOwnerTrustZoneCapabilityAndNotify;
- (void)_evaluateShouldRelaunchAndSetRelaunch;
- (void)_fetchMetadataFromPrimaryResidentWithCompletion:(id)a3;
- (void)_fetchMetadataOnCurrentDeviceWithCompletion:(id)a3;
- (void)_fetchThreadCredentialsAndStartThreadNetworkWithCompletion:(id)a3;
- (void)_getRunTimeStateUpdateWithOptions:(unint64_t)a3 includeMediaAccessorySessionState:(BOOL)a4 includeResidentDeviceState:(BOOL)a5 completion:(id)a6;
- (void)_handleAccessoryReachabilityChange:(id)a3;
- (void)_handleAccessoryReachabilityEventNotificationsRegistration:(id)a3;
- (void)_handleAccessoryReachabilityUpdatesTimerFired;
- (void)_handleAddAccessories:(id)a3;
- (void)_handleAddAccessory:(id)a3;
- (void)_handleAddAccessoryModel:(id)a3 message:(id)a4;
- (void)_handleAddAccessoryWithDescription:(id)a3;
- (void)_handleAddAccessoryWithDescription:(void *)a3 progressHandlerDelegate:(void *)a4 message:;
- (void)_handleAddActionSet:(id)a3;
- (void)_handleAddActionSetFromBuilder:(id)a3;
- (void)_handleAddActionSetModel:(id)a3 message:(id)a4;
- (void)_handleAddEventTrigger:(id)a3;
- (void)_handleAddEventTriggerModel:(id)a3 message:(id)a4;
- (void)_handleAddHomeOwnedActionSet:(id)a3;
- (void)_handleAddOutgoingHomeInvitationModel:(id)a3 message:(id)a4;
- (void)_handleAddRoom:(id)a3;
- (void)_handleAddRoomModel:(id)a3 message:(id)a4;
- (void)_handleAddServiceGroup:(id)a3;
- (void)_handleAddServiceGroupModel:(id)a3 message:(id)a4;
- (void)_handleAddTimerTrigger:(id)a3;
- (void)_handleAddTimerTriggerModel:(id)a3 message:(id)a4;
- (void)_handleAddTriggerOwnedActionSet:(id)a3;
- (void)_handleAddTriggers:(id)a3;
- (void)_handleAddUserModel:(id)a3 message:(id)a4;
- (void)_handleAddZone:(id)a3;
- (void)_handleAddZoneModel:(id)a3 message:(id)a4;
- (void)_handleAllowUserManagementMessage:(id)a3;
- (void)_handleAssistantAccessControlUpdate:(id)a3;
- (void)_handleCHIPSendRemoteRequestMessage:(id)a3;
- (void)_handleCancelPairingAccessory:(id)a3;
- (void)_handleCharacteristicEnableNotification:(id)a3;
- (void)_handleCharacteristicRead:(id)a3;
- (void)_handleCharacteristicWrite:(id)a3;
- (void)_handleCharacteristicsChangedNotification:(id)a3;
- (void)_handleCoalescedModifyNotifications;
- (void)_handleConfirmResidentRequest:(id)a3;
- (void)_handleCreateUniquePSKClientConfiguration:(id)a3;
- (void)_handleDidOnboardLocationServicesChange:(id)a3 message:(id)a4;
- (void)_handleDidReceiveIDSMessageWithNoListenerFromAddress:(id)a3;
- (void)_handleDisableNotificationsTimerFired;
- (void)_handleEnableMultiUserRequest:(id)a3;
- (void)_handleEnableNotifications:(id)a3;
- (void)_handleExecuteActionSet:(id)a3;
- (void)_handleExecuteConfirmationOfTrigger:(id)a3;
- (void)_handleFailedAccessories:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 pendingResponses:(id)a6 fastFailedAccessories:(id)a7 slowFailedAccessories:(id)a8 tmpErrorResponseTuples:(id)a9 waitGroup:(id)a10 failureWaitGroup:(id)a11 activity:(id)a12;
- (void)_handleFetchTriggerNameRequest:(id)a3;
- (void)_handleFetchUniqueIdentifierForBundleIdentifier:(id)a3;
- (void)_handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:(id)a3 message:(id)a4;
- (void)_handleHomeDataRequest:(id)a3;
- (void)_handleHomeLocationChange:(int64_t)a3 previousLocation:(int64_t)a4;
- (void)_handleHomeLocationUpdateFromSharedAdmin:(id)a3;
- (void)_handleHomeUpdateDidOnboardLocationServicesRequest:(id)a3;
- (void)_handleHomeUpdateLocationServicesEnabledRequest:(id)a3;
- (void)_handleJoinOrFormThreadNetworkMessage:(id)a3;
- (void)_handleLegacyAddAccessory:(id)a3;
- (void)_handleLocationServicesEnabledChange:(id)a3 message:(id)a4;
- (void)_handleMediaContentProfileAccessControlUpdate:(id)a3;
- (void)_handleMediaPropertiesRead:(id)a3;
- (void)_handleMediaPropertiesWrite:(id)a3;
- (void)_handleModifyCharacteristicNotifications:(id)a3;
- (void)_handleMultiUserEnabledChange:(id)a3 message:(id)a4;
- (void)_handleMultipleCharacteristicRead:(id)a3;
- (void)_handleMultipleCharacteristicWrite:(id)a3;
- (void)_handleNetworkProtectionModeChangeForTransaction:(id)a3;
- (void)_handleQueryResidentReachabilityForAccessories:(id)a3;
- (void)_handleReadMediaProperties:(id)a3 source:(unint64_t)a4 message:(id)a5 completionHandler:(id)a6;
- (void)_handleReceivedNonCloudSourcedSharedHomeModel;
- (void)_handleRemoteGatewayNotificationRegistration:(id)a3 enable:(BOOL)a4;
- (void)_handleRemoteReachabilityNotificationTimerFired;
- (void)_handleRemoteUserClientCloudShareRepairRequest:(id)a3;
- (void)_handleRemoteUserClientCloudShareRequest:(id)a3;
- (void)_handleRemoveAccessoryAfterUserConsent:(id)a3 message:(id)a4;
- (void)_handleRemoveAccessoryMessage:(id)a3;
- (void)_handleRemoveAccessoryModel:(id)a3 message:(id)a4;
- (void)_handleRemoveActionSet:(id)a3;
- (void)_handleRemoveActionSetModel:(id)a3 message:(id)a4;
- (void)_handleRemoveAppDataModel:(id)a3 message:(id)a4;
- (void)_handleRemoveClientConfiguration:(id)a3;
- (void)_handleRemoveOutgoingHomeInvitationModel:(id)a3 message:(id)a4;
- (void)_handleRemoveRoom:(id)a3;
- (void)_handleRemoveRoomModel:(id)a3 message:(id)a4;
- (void)_handleRemoveServiceGroup:(id)a3;
- (void)_handleRemoveServiceGroupModel:(id)a3 message:(id)a4;
- (void)_handleRemoveTrigger:(id)a3;
- (void)_handleRemoveTriggerModel:(id)a3 message:(id)a4;
- (void)_handleRemoveUser:(id)a3;
- (void)_handleRemoveUserModel:(id)a3 message:(id)a4;
- (void)_handleRemoveZone:(id)a3;
- (void)_handleRemoveZoneModel:(id)a3 message:(id)a4;
- (void)_handleRename:(id)a3;
- (void)_handleRequestHomeDataSync:(id)a3;
- (void)_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)a3;
- (void)_handleResetMatterStorageRequest:(id)a3;
- (void)_handleResidentChange;
- (void)_handleResolveThreadNetworkRequest:(id)a3;
- (void)_handleResponseForElectMessageToResident:(id)a3 error:(id)a4;
- (void)_handleRetrieveAsyncResults:(id)a3;
- (void)_handleRetrieveHomeLocationForFeedback:(id)a3;
- (void)_handleRollReaderKey:(id)a3;
- (void)_handleSendingNotificationsForRequest:(id)a3 requestIdentifier:(id)a4 supportsMultiPartResponse:(BOOL)a5 characteristicUpdates:(id)a6 completion:(id)a7;
- (void)_handleSetAppData:(id)a3;
- (void)_handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest:(id)a3;
- (void)_handleSetHasOnboardedForAccessCodeChange:(id)a3 message:(id)a4;
- (void)_handleSetHasOnboardedForAccessCodeMessage:(id)a3;
- (void)_handleSetHasOnboardedForWalletKeyChange:(id)a3 message:(id)a4;
- (void)_handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3;
- (void)_handleSetMinimumNetworkRouterHomeKitVersion:(id)a3;
- (void)_handleSiriPhraseOptionsStatusChange:(id)a3 message:(id)a4;
- (void)_handleSiriPhraseOptionsUpdateRequest:(id)a3;
- (void)_handleSoundCheckChange:(id)a3 message:(id)a4;
- (void)_handleSoundCheckUpdateRequest:(id)a3;
- (void)_handleStartDiscoveringSymptomsForNearbyDevicesMessage:(id)a3;
- (void)_handleStopDiscoveringSymptomsForNearbyDevicesMessage:(id)a3;
- (void)_handleTestUpgradeToROAR:(id)a3;
- (void)_handleThreadNetworkCredentialsRequest:(id)a3;
- (void)_handleUnjoinThreadNetworkMessage:(id)a3;
- (void)_handleUpdateAppDataModel:(id)a3 message:(id)a4;
- (void)_handleUpdateAutomaticSoftwareUpdate:(id)a3;
- (void)_handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate:(id)a3;
- (void)_handleUpdateMediaPassword:(id)a3;
- (void)_handleUpdateMediaPeerToPeerEnabled:(id)a3;
- (void)_handleUpdateMinimumMediaUserPrivilege:(id)a3;
- (void)_handleUpdateNetworkProtection:(id)a3;
- (void)_handleUpdateNetworkProtectionWithHomeModel:(id)a3 message:(id)a4;
- (void)_handleUpdateOutgoingInvitationState:(id)a3;
- (void)_handleUpdatePresenceConsent:(id)a3;
- (void)_handleUpdateRequestForHomeInvitation:(id)a3 controllerPublicKey:(id)a4 controllerUsername:(id)a5 invitationState:(int64_t)a6 presenceAuthStatus:(id)a7 preferredUserID:(id)a8 fromHandle:(id)a9 fromAddress:(id)a10 issuerPublicKeyER:(id)a11 message:(id)a12 messageResponseHandler:(id)a13;
- (void)_handleUpdateRequestForHomeInvitationFromInvitee:(id)a3;
- (void)_handleUpdateUserAccess:(id)a3;
- (void)_handleUpdateUserAnnounceAccess:(id)a3;
- (void)_handleUpdateUserCamerasAccessLevel:(id)a3;
- (void)_handleUserConsentForAccessoryReplacement:(id)a3 consent:(BOOL)a4 message:(id)a5;
- (void)_handleUserConsentResponseForAccessory:(id)a3;
- (void)_handleUserInvitations:(id)a3;
- (void)_handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:(id)a3;
- (void)_handleWriteMediaProperties:(id)a3 source:(unint64_t)a4 requestMessage:(id)a5 completionHandler:(id)a6;
- (void)_incrementCurrentSequenceNumber;
- (void)_loadBalancedRedispatchForAccessories:(id)a3 source:(unint64_t)a4 biomeSource:(unint64_t)a5 dispatchGroup:(id)a6 writeRequestMap:(id)a7 requestMessage:(id)a8 responseTuples:(id)a9;
- (void)_migrateAppleMediaAccessoriesWithCloudZone:(id)a3 migrationQueue:(id)a4 completion:(id)a5;
- (void)_migrateHomeAllObjectsCloudZone:(id)a3 migrationGroup:(id)a4 migrationQueue:(id)a5 saveModels:(id)a6 runModels:(id)a7;
- (void)_migrateHomeMediaSettingsCloudZone:(id)a3 migrationQueue:(id)a4 completion:(id)a5;
- (void)_migrateHomeObjectCloudZone:(id)a3 defaultModel:(id)a4 completion:(id)a5;
- (void)_migrateHomeSettingsCloudZone:(id)a3 migrationQueue:(id)a4 completion:(id)a5;
- (void)_migrateHomeUsersCloudZone:(id)a3 migrationQueue:(id)a4 completion:(id)a5;
- (void)_migrateResidentDevicesCloudZone:(id)a3 migrationQueue:(id)a4 completion:(id)a5;
- (void)_migrateUnknownAccessoriesWithCloudZone:(id)a3 accessoryUUIDs:(id)a4 migrationQueue:(id)a5 completion:(id)a6;
- (void)_modifyCharacteristicNotificationsOnResident:(id)a3 mediaNotifications:(id)a4 actionSetNotificationPayload:(id)a5 enableNotification:(BOOL)a6;
- (void)_notificationPayloadsForRemoteGateway:(void *)a3 accessories:(void *)a4 enableCharacteristicNotificationPayload:(void *)a5 characteristicNotificationThresholdsPayload:(void *)a6 disableCharacteristicNotificationPayload:(void *)a7 enableMediaNotificationPayload:(void *)a8 disableMediaNotificationPayload:;
- (void)_notifyChangedProperties:(id)a3 withRequestIdentifier:(id)a4 notificationUpdateIdentifier:(id)a5 toUserDeviceAddress:(id)a6;
- (void)_notifyClientOfNewlyAddedAccessories:(id)a3 requestMessage:(id)a4;
- (void)_notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)a3 shouldRefreshBadge:(BOOL)a4 withCompletion:(id)a5;
- (void)_notifyClientsOfUpdatedResidentUser:(id)a3;
- (void)_notifyOwnerOfAddedAccessories:(id)a3 completion:(id)a4;
- (void)_notifyRemoteUsersOfChangedCharacteristics:(id)a3 message:(id)a4 broadcast:(BOOL)a5;
- (void)_notifyRemoteUsersOfChangedProperties:(id)a3 requestMessageInformation:(id)a4;
- (void)_notifyRetrievalError:(id)a3 accessoryServer:(id)a4 linkType:(int64_t)a5 accessoryOperationBlock:(id)a6;
- (void)_notifyThreadLayerOfResidentChange;
- (void)_notifyUpdatedCharacteristic:(id)a3 withRequestIdentifier:(id)a4 notificationUpdateIdentifier:(id)a5 toUserDeviceAddress:(id)a6 completion:(id)a7;
- (void)_pairAccessoryWithAccessoryDescription:(id)a3 configuration:(id)a4 pairingEvent:(id)a5 progressHandler:(id)a6 requestMessage:(id)a7;
- (void)_pairAccessoryWithAccessoryDescription:(id)a3 unpairedAccessory:(id)a4 configuration:(id)a5 pairingEvent:(id)a6 requestMessage:(id)a7;
- (void)_performAllowedWriteCharacteristicValues:(uint64_t)a3 source:(void *)a4 identifier:(uint64_t)a5 qualityOfService:(void *)a6 withCompletionHandler:(void *)a7 activity:;
- (void)_performOperation:(id)a3 completion:(id)a4;
- (void)_performPostSaveActionsWithReason:(id)a3;
- (void)_postInternalNotificationForChangedCharacteristics:(id)a3 previouslyNilChangedCharacteristics:(id)a4 modifiedCharacteristics:(id)a5 changedByThisDevice:(BOOL)a6 residentShouldNotifyPeers:(BOOL)a7 message:(id)a8 broadcast:(BOOL)a9;
- (void)_processAccessoriesToAddForUnpairedAccessory:(id)a3 certificationStatus:(int64_t)a4 accessoryServer:(id)a5 networkCredential:(id)a6 pairingEvent:(id)a7 message:(id)a8 completionHandler:(id)a9;
- (void)_processLegacyPairingRequestForMessage:(id)a3 cancelPairing:(BOOL)a4 context:(id)a5;
- (void)_processOutgoingInvitationsRequest:(id)a3;
- (void)_processPairingRequestForMessage:(id)a3 cancelPairing:(BOOL)a4 context:(id)a5;
- (void)_processProductDataForNewlyAddedAccessory:(id)a3 transaction:(id)a4;
- (void)_processUpdatedAccessoryServer:(id)a3 reAddServices:(BOOL)a4;
- (void)_processUpdatedProductDataForAccessory:(id)a3 hapAccessory:(id)a4 transaction:(id)a5;
- (void)_purgeResidentUsers;
- (void)_reachabilityChangedForAccessory:(id)a3 reachable:(BOOL)a4;
- (void)_readCharacteristicValues:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 withCompletionHandler:(id)a6;
- (void)_readCharacteristicValuesForAccessories:(id)a3 readRequestMap:(id)a4 responseTuples:(id)a5 requestMessage:(id)a6 source:(unint64_t)a7 viaDevice:(id)a8 completionHandler:(id)a9;
- (void)_readProfileState:(void *)a3 viaDevice:;
- (void)_reallyRedispatchReadsToDevice:(id)a3 accessories:(id)a4 dispatchGroup:(id)a5 requestMap:(id)a6 requestMessage:(id)a7 source:(unint64_t)a8 responseTuples:(id)a9 activity:(id)a10;
- (void)_reallyRedispatchWritesToDevice:(id)a3 accessories:(id)a4 dispatchGroup:(id)a5 requestMap:(id)a6 requestMessage:(id)a7 source:(unint64_t)a8 biomeSource:(unint64_t)a9 responseTuples:(id)a10 activity:(id)a11;
- (void)_reconfigureAccessoriesOnRouterRemovalWithCompletion:(id)a3;
- (void)_redispatchReadForAccessories:(id)a3 dispatchGroup:(id)a4 requestMap:(id)a5 requestMessage:(id)a6 source:(unint64_t)a7 responseTuples:(id)a8 errorResponseTuples:(id)a9;
- (void)_redispatchWriteForAccessories:(id)a3 dispatchGroup:(id)a4 requestMap:(id)a5 requestMessage:(id)a6 source:(unint64_t)a7 biomeSource:(unint64_t)a8 responseTuples:(id)a9;
- (void)_reevaluateAccessoryInfoWithBadgeRefresh:(BOOL)a3;
- (void)_refreshCharacteristicValuesOnHomeNotificationEnable;
- (void)_refreshMediaProfilesOnHomeNotificationEnable;
- (void)_refreshUserDisplayNames;
- (void)_registerCameraReachabilityEventNotificationsWithCompletionHandler:(id)a3;
- (void)_registerDeviceForReachabilityNotification:(id)a3 accessoryList:(id)a4;
- (void)_registerForAccessoryReachabilityNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5;
- (void)_registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5;
- (void)_registerForMessages;
- (void)_registerForNotifications;
- (void)_registerForReachabilityChangeNotificationsEnabled:(BOOL)a3 completionHandler:(id)a4;
- (void)_registerForThreadNetworkEvents;
- (void)_registerPairedAccessory:(id)a3 transports:(unint64_t)a4 setupHash:(id)a5;
- (void)_registerResidentReachabilityNotificationWithEnableAccessories:(id)a3 disableAccessories:(id)a4 completionHandler:(id)a5;
- (void)_registerThreadResidentCommissioningMessageHandlers;
- (void)_relayAddTriggerToResident:(id)a3;
- (void)_remoteAccessEnabled:(BOOL)a3;
- (void)_remoteAccessHealthMonitorTimerDidFire;
- (void)_remotelySetNotificationsEnabled:(BOOL)a3 forCharacteristics:(id)a4 characteristicChangeThresholds:(id)a5;
- (void)_removeAccessories:(id)a3 message:(id)a4;
- (void)_removeAccessoriesForPrimaryAccessory:(id)a3 error:(id)a4 completionHandler:(id)a5;
- (void)_removeAccessoriesFromContainers:(id)a3;
- (void)_removeAccessory:(id)a3 completionHandler:(id)a4;
- (void)_removeAccessoryWithUUID:(id)a3 message:(id)a4;
- (void)_removeAllHomeContentsAndAccessoryPairings:(BOOL)a3 queue:(id)a4 completionHandler:(id)a5;
- (void)_removeCharacteristic:(id)a3;
- (void)_removeClientConfigurationWithIdentifier:(id)a3;
- (void)_removeClientConfigurationWithIdentifier:(id)a3 completion:(id)a4;
- (void)_removeCloudData;
- (void)_removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:(id)a3;
- (void)_removeCorruptAccessories;
- (void)_removeMediaSessionWithIdentifier:(id)a3;
- (void)_removeOutgoingInvitationForUser:(id)a3;
- (void)_removePendingAccessoryAdd:(id)a3;
- (void)_removeRetrievalCompletionTuple:(id)a3;
- (void)_removeService:(id)a3;
- (void)_removeTrigger:(id)a3 message:(id)a4;
- (void)_removeUser:(id)a3;
- (void)_removeUser:(id)a3 message:(id)a4;
- (void)_removeUserFromContainer:(id)a3;
- (void)_removeWithMergeSecondaryAccessory:(id)a3 removedFromBridgeAccessory:(id)a4 completionHandler:(id)a5;
- (void)_requestRemoveClientConfigurationWithIdentifier:(id)a3;
- (void)_requestUniquePSKClientConfigurationWithCompletion:(id)a3;
- (void)_resubscribeForNotificationsOnResident:(id)a3;
- (void)_retrieveHAPAccessoryForHMDHAPAccessory:(id)a3 linkType:(int64_t)a4 forceRetrieve:(BOOL)a5 completion:(id)a6;
- (void)_retrievePreferredNetworkOnControllerWithCompletion:(id)a3;
- (void)_retryStartThreadNetwork:(double)a3;
- (void)_saveAndSyncMatterFabricIDWithCompletion:(id)a3;
- (void)_saveSharedHomeToAccountWithReason:(id)a3 postSyncNotification:(BOOL)a4 options:(id)a5;
- (void)_scheduleApplyNetworkRouterSettingsAction:(id)a3;
- (void)_sendClientCharacteristicsChangedNotificationWithIdentifier:(id)a3 requestMessage:(id)a4 multiPartResponse:(BOOL)a5 moreInMultiPartResponse:(BOOL)a6 characteristicChanges:(id)a7 completionHandler:(id)a8;
- (void)_sendCoalescedRemoteNotificationsForRequestMessage:(id)a3 accessories:(id)a4;
- (void)_sendInvitation:(id)a3 message:(id)a4 shareURL:(id)a5 shareToken:(id)a6 suppressHomeInviteNotification:(BOOL)a7 logEventBuilder:(id)a8;
- (void)_sendInvitationCancelationRequestToInvitee:(id)a3;
- (void)_sendReadRequestToAccessoryServer:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 pendingResponses:(id)a6 slowFailedAccessories:(id)a7 fastFailedAccessories:(id)a8 unreachableWaitGroup:(id)a9 waitGroup:(id)a10 activity:(id)a11;
- (void)_sendRemoteMessageUsingNodeId:(unint64_t)a3 payload:(id)a4 completion:(id)a5;
- (void)_sendRemoveCompletionStatusForHMDAccessories:(id)a3 withCompletion:(id)a4 error:(id)a5;
- (void)_sendResidentInviteWithDestination:(id)a3;
- (void)_sendWriteRequestToAccessoryServer:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 failedAccessories:(id)a6 responseTuples:(id)a7 activity:(id)a8 waitGroup:(id)a9 unreachableWaitGroup:(id)a10;
- (void)_setAccessories:(id)a3;
- (void)_setupActiveNetworkRouterAccessory:(id)a3 existingRouterAccessories:(id)a4;
- (void)_sharedAdminDidFailToAddAccessories:(id)a3;
- (void)_startHomeNotificationDeregistrationTimer;
- (void)_startThreadNetworkOnCommissionerWithCompletion:(id)a3;
- (void)_startThreadNetworkOnCommissionerWithOperationalDataset:(id)a3 completion:(id)a4;
- (void)_startThreadNetworkOnControllerWithCompletion:(id)a3;
- (void)_startThreadNetworkOnResidentWithCompletion:(id)a3;
- (void)_startThreadNetworkWithCompletion:(id)a3;
- (void)_stopThreadNetworkWithCompletion:(id)a3;
- (void)_subscribeForHomeAppleMediaNotificationsOnDirectTransports:(void *)a1;
- (void)_subscribeForHomeNotificationsFromRemoteGateway:(BOOL)a3 accessories:(id)a4;
- (void)_subscribeForHomeNotificationsOnDirectTransports:(void *)a1;
- (void)_subscribeForNotificationFromRemoteGateway:(void *)a1;
- (void)_unconfigureNetworkRouterClientManager;
- (void)_unconfigurePairedAccessoriesForServer:(id)a3 updateReachability:(BOOL)a4;
- (void)_unitTest_setRetrievalCompletionsTimeout:(double)a3;
- (void)_unjoinThreadNetworkWithCompletion:(id)a3;
- (void)_unregisterForThreadNetworkEvents;
- (void)_updateActiveNetworkRouterAccessory:(id)a3 isReplacement:(BOOL)a4 withTransaction:(id)a5;
- (void)_updateConfigurationStateForResidentDevice:(id)a3 desiredConfigState:(unint64_t)a4 message:(id)a5;
- (void)_updateConfigurationVersion;
- (void)_updateCurrentUserForSharedHome;
- (void)_updateDirectAppleMediaNotificationsOnResidentChange:(void *)a3 previousResidentDevice:;
- (void)_updateExpectConfigurationVersion;
- (void)_updateHomeLocation;
- (void)_updateOutgoingInvitationsWithCompleteUserManagementOperation:(id)a3;
- (void)_updateReachabilityChangeToRegisteredDevices:(id)a3;
- (void)_updateResidentFirstAccessoryCommunicationEnabled;
- (void)_updateThreadNetworkWithModel:(id)a3 message:(id)a4;
- (void)_updateWoWState:(id)a3;
- (void)_waitForEarlyDispatchTimeout:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 biomeSource:(unint64_t)a6 failedAccessories:(id)a7 responseTuples:(id)a8 activity:(id)a9 unreachableWaitGroup:(id)a10 failureWaitGroup:(id)a11;
- (void)_waitForEarlyDispatchTimeoutOnReadRequest:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 pendingResponses:(id)a6 activity:(id)a7 slowFailedAccessories:(id)a8 tmpErrorResponseTuples:(id)a9 unreachableWaitGroup:(id)a10 failureWaitGroup:(id)a11;
- (void)_waitForWriteRequestFanOut:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 biomeSource:(unint64_t)a6 responseTuples:(id)a7 failedAccessories:(id)a8 activity:(id)a9 waitGroup:(id)a10 failureWaitGroup:(id)a11;
- (void)_wol_processChangedCharacteristicResponses:(id)a3;
- (void)_writeCharacteristicValues:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 biomeSource:(unint64_t)a6 withCompletionHandler:(id)a7;
- (void)_writeCharacteristicValues:(void *)a3 source:(void *)a4 message:(void *)a5 identifier:(void *)a6 qualityOfService:(void *)a7 withCompletionHandler:(void *)a8 activity:;
- (void)_writeCharacteristicValuesForAccessories:(id)a3 writeRequestMap:(id)a4 responseTuples:(id)a5 requestMessage:(id)a6 viaDevice:(id)a7 source:(unint64_t)a8 biomeSource:(unint64_t)a9 completionHandler:(id)a10;
- (void)_writeLogData:(id)a3 logName:(id)a4 completion:(id)a5;
- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didDiscoverAccessories:(id)a5 transaction:(id)a6 error:(id)a7;
- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didStopPairingWithError:(id)a5;
- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateCategory:(id)a5;
- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateHasPairings:(BOOL)a5;
- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateValuesForCharacteristics:(id)a5 stateNumber:(id)a6 broadcast:(BOOL)a7;
- (void)accessoryBrowser:(id)a3 didAddAccessoryAdvertisement:(id)a4;
- (void)accessoryBrowser:(id)a3 didFindAccessoryServer:(id)a4 stateChanged:(BOOL)a5 stateNumber:(id)a6 completion:(id)a7;
- (void)accessoryBrowser:(id)a3 didFindAccessoryServerNeedingReprovisioning:(id)a4 error:(id)a5;
- (void)accessoryBrowser:(id)a3 didFinishPairingForAccessoryServer:(id)a4;
- (void)accessoryBrowser:(id)a3 didFinishWACForAccessoryWithIdentifier:(id)a4 error:(id)a5;
- (void)accessoryBrowser:(id)a3 didRemoveAccessoryAdvertisement:(id)a4;
- (void)accessoryBrowser:(id)a3 didRemoveAccessoryServer:(id)a4 error:(id)a5;
- (void)accessoryBrowser:(id)a3 didTombstoneAccessoryServer:(id)a4;
- (void)accessoryBrowser:(id)a3 didUpdateEndpoint:(id)a4;
- (void)accessoryBrowser:(id)a3 discoveryFailedWithError:(id)a4 accessoryServer:(id)a5 linkType:(int64_t)a6;
- (void)addAccessory:(id)a3;
- (void)addCompanionAsResidentUser:(id)a3;
- (void)addMediaSession:(id)a3;
- (void)addMediaSessionState:(id)a3;
- (void)addNewlyConfiguredAccessories:(id)a3 addSessionIdentifier:(id)a4;
- (void)addNotificationDeregistrationForClientIdentifier:(id)a3;
- (void)addNotificationRegistrationForClientIdentifier:(id)a3 includesAppleMediaAccessories:(BOOL)a4;
- (void)addOutgoingInvitation:(id)a3;
- (void)addResidentCapableDevice:(id)a3;
- (void)addSharedUserEventBuilder:(id)a3;
- (void)addSharedUserResponseEventBuilder:(id)a3;
- (void)addToCurrentTriggers:(id)a3;
- (void)addUnconfiguredResidentDevice:(id)a3;
- (void)addUser:(id)a3;
- (void)aggregator:(id)a3 changedAccessoryCapabilities:(id)a4 rawCapabilities:(id)a5 accessoryUUID:(id)a6 homeUUID:(id)a7;
- (void)aggregator:(id)a3 changedResidentCapabilities:(id)a4 rawCapabilities:(id)a5 accessoryUUID:(id)a6 homeUUID:(id)a7;
- (void)auditUsersForNotifications:(id)a3;
- (void)btleAccessoryReachabilityProbeTimer:(BOOL)a3;
- (void)checkTimerTriggers;
- (void)cleanChangesIfNoAddChangeObjectID:(id)a3 completion:(id)a4;
- (void)clearAccessoryServerBrowserOperationalFabricData;
- (void)clientController:(id)a3 didReceiveFetchedCachedEvents:(id)a4 source:(id)a5;
- (void)completePotentialFabricDataCreation;
- (void)computeBridgedAccessoriesForAllBridges;
- (void)configureAccessorySettingsMessengerWithMessengerFactory:(id)a3 messageHandlerFactory:(id)a4;
- (void)configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:(id)a3 accessories:(id)a4 uncommittedTransactions:(id)a5;
- (void)configureAppleMediaAccessoriesStateManagerWithStateManagerWithFactory:(id)a3 messengerFactory:(id)a4 metricsDispatcherFactory:(id)a5;
- (void)configureBulletinNotification;
- (void)configureMediaDestinationControllersForAccessories:(id)a3;
- (void)configureMediaGroupObjects;
- (void)configureMediaGroupsAggregateConsumer;
- (void)configureMediaGroupsAggregator;
- (void)configureMediaGroupsUnconfiguredParticipantOnboardingManager;
- (void)configureMediaSystems;
- (void)configureMultiuserSettingsMessengerWithMessengerFactory:(id)a3;
- (void)configureNaturalLightingForDemoMode;
- (void)configureNaturalLightingWithDemoModeEnabled:(BOOL)a3;
- (void)configurePrimaryResidentMessageRouterWithFactory:(id)a3 metricsDispatcherFactory:(id)a4;
- (void)configureRemoteEventRouterClientControllerForAccessories:(id)a3;
- (void)configureSiriEndpointProfilesMessengerWithMessengerFactory:(id)a3 messageHandlerFactory:(id)a4;
- (void)configureUnifiedLanguageValueListSettingDataProviderWithFactory:(id)a3;
- (void)connectToThreadAccessoryWithExtendedMACAddress:(id)a3 completion:(id)a4;
- (void)createRemoteEventRouterServerIfNeeded;
- (void)dealloc;
- (void)didReceiveAccessorySetting:(id)a3 accessoryUUID:(id)a4;
- (void)didUpdateAggregateDataForMediaGroupsAggregateConsumer:(id)a3;
- (void)disableNotificationsForDevices:(id)a3;
- (void)dispatchRequestToEvaluateCondition:(id)a3 forCharacteristics:(id)a4 completion:(id)a5;
- (void)downloadLogWithController:(id)a3 nodeId:(id)a4 type:(int64_t)a5 timeout:(double)a6 completion:(id)a7;
- (void)dropAllChangesWithArrayOfObjectIDs:(id)a3;
- (void)dropAllChangesWithObjectID:(id)a3;
- (void)enableHomeNotificationsForMediaAccessory:(id)a3;
- (void)enableMediaNotifications:(BOOL)a3 directlyOnMediaAccessory:(id)a4 completion:(id)a5;
- (void)enableMultiUser;
- (void)enableNotificationsForDevices:(id)a3;
- (void)enableUserListeningHistoryForAccessoryUUID:(id)a3 userUUID:(id)a4;
- (void)encodeMediaSystemsWithCoder:(id)a3 modifiedOptions:(unint64_t)a4;
- (void)encodeWithCoder:(id)a3;
- (void)endReportingSessionForMessage:(id)a3;
- (void)evaluateNotificationConditionForCharacteristics:(id)a3 homePresence:(id)a4 completion:(id)a5;
- (void)evaluateResidentUpdate;
- (void)evaluateShouldRelaunchAndSetRelaunch;
- (void)exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:(id)a3 commissioneeNodeID:(id)a4 fabricID:(id)a5 publicKey:(id)a6 sender:(id)a7 completion:(id)a8;
- (void)executeActionSet:(id)a3;
- (void)executeActionsFromMessage:(id)a3;
- (void)fetchAllMigratedObjectsForCloudZone:(id)a3 completion:(id)a4;
- (void)fetchFabricDataForPairingWithCompletion:(id)a3;
- (void)fetchOperationalCertificatesForNewFabricWithFabricID:(id)a3 publicKey:(id)a4 fetchFromResident:(BOOL)a5 completion:(id)a6;
- (void)filterServiceTransactions:(id)a3 removedServiceUUIDs:(id)a4;
- (void)finishPairingForServer:(id)a3;
- (void)fixupHomeAfterDecoding;
- (void)getReachableIPAccessories:(unint64_t *)a3 btleAccessories:(unint64_t *)a4 mediaAccessories:(unint64_t *)a5;
- (void)getRunTimeStateUpdateWithOptions:(unint64_t)a3 includeMediaAccessorySessionState:(BOOL)a4 includeResidentDeviceState:(BOOL)a5 completion:(id)a6;
- (void)handleAccessoryDidAddNetworkRouterControllerNotification:(id)a3;
- (void)handleAccessoryDidRemoveNetworkRouterControllerNotification:(id)a3;
- (void)handleAccessoryReachabilityChangeNotification:(id)a3;
- (void)handleAccountHandlesUpdated:(id)a3;
- (void)handleActiveAccountChanged:(id)a3;
- (void)handleCATUpdate;
- (void)handleCHIPSendRemoteRequestMessage:(id)a3;
- (void)handleCHIPSendReportMessage:(id)a3;
- (void)handleClearMatterControllerPrivateStorageRequest:(id)a3;
- (void)handleClientProcessDisconnectedNotification:(id)a3;
- (void)handleCommissioningCertificateRequest:(id)a3;
- (void)handleCommissioningCertificateRequestWithCommissionerNodeID:(id)a3 commissioneeNodeID:(id)a4 fabricID:(id)a5 publicKey:(id)a6 sender:(id)a7 completion:(id)a8;
- (void)handleCurrentUserPrivilegeChanged:(id)a3;
- (void)handleCurrentWiFiNetworkChangedNotification:(id)a3;
- (void)handleDeviceCapabilitiesUpdated:(id)a3;
- (void)handleDidReceiveIDSMessageWithNoListener:(id)a3;
- (void)handleEvaluatePredicateMessage:(id)a3;
- (void)handleFetchLightProfileSettingsMessage:(id)a3;
- (void)handleFetchLightProfileSettingsMessage:(id)a3 withLightProfileUUIDs:(id)a4;
- (void)handleFirstProcessDidBecomeActiveNotification:(id)a3;
- (void)handleHomeWasRemoved;
- (void)handleLastProcessDidBecomeInactiveNotification:(id)a3;
- (void)handleMatterPairingCompletionNotification:(id)a3;
- (void)handlePrimaryResidentChangeNotification:(id)a3;
- (void)handleRemoteDeviceBecameReachableNotification:(id)a3;
- (void)handleRemoveAccessory:(id)a3 completion:(id)a4;
- (void)handleRemoveAccessoryMessage:(id)a3;
- (void)handleRemovedMediaSessions:(id)a3;
- (void)handleReportingSessionResponseMessage:(id)a3;
- (void)handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)a3;
- (void)handleResetMatterStorageRequest:(id)a3;
- (void)handleSetPreferredPrimaryMessage:(id)a3;
- (void)handleSignificantTimeChange;
- (void)handleSiriEndPointAddedNotification:(id)a3;
- (void)handleUpdatedCHIPPropertiesOnHomeModel:(id)a3 actions:(id)a4;
- (void)handleUpdatedCharacteristics:(id)a3 accessoryServer:(id)a4;
- (void)handleUserFabricKeyUpdate:(id)a3;
- (void)handleXPCConnectionInvalidated:(id)a3;
- (void)incrementOperatePrivilegeCATVersion:(id)a3;
- (void)invokeCommandWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 commandId:(id)a6 fields:(id)a7 timedInvokeTimeout:(id)a8 source:(unint64_t)a9 completion:(id)a10;
- (void)mediaSystemController:(id)a3 didRemoveMediaSystem:(id)a4;
- (void)mediaSystemController:(id)a3 removeAccessories:(id)a4 fromAssistantAccessControl:(id)a5;
- (void)mergeMediaDestinationControllerDataWithConsumer:(id)a3;
- (void)mergeMediaDestinationsWithConsumer:(id)a3;
- (void)mergeMediaGroupsAggregateDataWithConsumer:(id)a3;
- (void)migrateAfterCloudMerge:(id)a3;
- (void)migrateAfterResidentChange;
- (void)migrateCloudZone:(id)a3 completion:(id)a4;
- (void)migrateLegacyLocationServiceSettings;
- (void)modifyCharacteristicNotifications:(id)a3 mediaNotifications:(id)a4 actionSetNotificationPayload:(id)a5 enableNotification:(BOOL)a6 withDevice:(id)a7;
- (void)notifyClientOfVendorInfoUpdatedForManufacturers:(id)a3 withCompletion:(id)a4;
- (void)notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)a3;
- (void)notifyClientsOfReachabilityUpdateForAccessory:(id)a3;
- (void)notifyNewRemotePeersFound:(BOOL)a3 remoteUsersRemoved:(id)a4 forceRemoteNotificationRegistration:(BOOL)a5;
- (void)notifyOfAddedAccessory:(id)a3;
- (void)notifyOfChangedCharacteristic:(id)a3 changedByThisDevice:(BOOL)a4 residentShouldNotifyPeers:(BOOL)a5 message:(id)a6;
- (void)notifyOfNewlyAddedAccessoryByThisOwnerDevice:(id)a3;
- (void)notifyOfRemovedAccessory:(id)a3 source:(unint64_t)a4;
- (void)notifyRemoteUsersOfChangedCharacteristics:(id)a3 message:(id)a4 broadcast:(BOOL)a5;
- (void)notifyRemoteUsersOfChangedProperties:(id)a3 requestMessageInformation:(id)a4;
- (void)onThreadNetworkCallStateChange:(BOOL)a3;
- (void)onThreadNetworkConnectionStateChange:(int64_t)a3;
- (void)onThreadNetworkNodeTypeStateChange:(int64_t)a3;
- (void)onThreadNetworkPeripheralDeviceNodeTypeChange:(id)a3;
- (void)onThreadNetworkWakeOnDeviceConnectionStateChange:(id)a3;
- (void)performLocalAddAccessoryWithDescription:(id)a3 progressHandlerDelegate:(id)a4 completion:(id)a5;
- (void)performPostSaveActionsWithReason:(id)a3;
- (void)prepareOperationalFabricData;
- (void)primaryResidentClientHasConnectivityDidChangeForRemoteEventRouterClientController:(id)a3;
- (void)queryPrimaryResidentReachabilityForAccessories:(id)a3 completion:(id)a4;
- (void)reEvaluateHomeHubState;
- (void)reEvaluateTriggers;
- (void)reachabilityChangedForAccessory:(id)a3 reachable:(BOOL)a4;
- (void)readAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 params:(id)a7 completion:(id)a8;
- (void)readCharacteristicValues:(id)a3 identifier:(id)a4 source:(unint64_t)a5 qualityOfService:(int64_t)a6 withCompletionHandler:(id)a7;
- (void)readCharacteristicValues:(id)a3 source:(unint64_t)a4 sourceForLogging:(id)a5 qualityOfService:(int64_t)a6 withCompletionHandler:(id)a7;
- (void)readProfileState:(id)a3 viaDevice:(id)a4;
- (void)redispatchMediaReadRequests:(id)a3 viaDevice:(id)a4 completion:(id)a5;
- (void)redispatchMediaWriteRequests:(id)a3 viaDevice:(id)a4 completion:(id)a5;
- (void)redispatchToResidentMessage:(id)a3 target:(id)a4 responseQueue:(id)a5 viaDevice:(id)a6;
- (void)reevaluateAccessoryInfo;
- (void)refreshUserDisplayNames;
- (void)regionStateUpdated;
- (void)registerCameraReachabilityEventNotificationsWithCompletionHandler:(id)a3;
- (void)registerForAccessoryReachabilityNotifications:(BOOL)a3 registrationIdentifier:(id)a4;
- (void)registerForDeviceWithCapabilities;
- (void)registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4;
- (void)registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5;
- (void)remoteAccessEnabled:(BOOL)a3;
- (void)remoteAccessHealthMonitorTimerDidFire;
- (void)remotelySetNotificationsEnabled:(BOOL)a3 forCharacteristics:(id)a4 characteristicChangeThresholds:(id)a5;
- (void)removeAccessory:(id)a3;
- (void)removeAccessory:(id)a3 completionHandler:(id)a4;
- (void)removeAllHomeContentsAndAccessoryPairings:(BOOL)a3 queue:(id)a4 completionHandler:(id)a5;
- (void)removeAllUsersAndCloudDataFromAccessory:(id)a3 completionHandler:(id)a4;
- (void)removeBulletinBoardNotificationsMigrationFileFromDisk;
- (void)removeCameraNotificationSettingsMigrationFileFromDisk;
- (void)removeCharacteristic:(id)a3;
- (void)removeFromCurrentTriggers:(id)a3;
- (void)removeMediaSession:(id)a3;
- (void)removeMediaSessionState:(id)a3;
- (void)removeNotificationDeregistrationForClientIdentifier:(id)a3;
- (void)removeOutgoingInvitation:(id)a3;
- (void)removeRemovedUser:(id)a3;
- (void)removeResidentCapableDevice:(id)a3;
- (void)removeService:(id)a3;
- (void)removeSharedHomeFabricData;
- (void)removeSharedUserEventBuilder:(id)a3;
- (void)removeSharedUserResponseEventBuilder:(id)a3;
- (void)removeThreadNetworkPreferredNetworkWithCompletion:(id)a3;
- (void)removeTrigger:(id)a3;
- (void)removeTriggerNoNotification:(id)a3;
- (void)removeUnconfiguredResidentDeviceWithUserID:(id)a3;
- (void)removeUser:(id)a3;
- (void)removeUserWithUserID:(id)a3;
- (void)removeWithMergeSecondaryAccessory:(id)a3 removedFromBridgeAccessory:(id)a4 completionHandler:(id)a5;
- (void)resetAccessoryHashedRouteIdentifiers;
- (void)resetConfiguration;
- (void)residentDeviceManager:(id)a3 didUpdatePrimaryResident:(id)a4 previousPrimaryResident:(id)a5;
- (void)residentDeviceManager:(id)a3 didUpdateResidentAvailable:(BOOL)a4;
- (void)residentDeviceManagerDidUpdateResidents:(id)a3;
- (void)respondMessage:(id)a3 withSettingResults:(id)a4;
- (void)resubscribeForNotificationsOnResident:(id)a3;
- (void)retrieveHAPAccessoryForHMDAccessory:(id)a3 linkType:(int64_t)a4 forceRetrieve:(BOOL)a5 queue:(id)a6 completion:(id)a7;
- (void)retrieveOperationalCertificatesForFabricID:(id)a3 commissioneeNodeID:(id)a4 publicKey:(id)a5 completion:(id)a6;
- (void)retrieveOperationalCertificatesForFabricID:(id)a3 commissionerNodeID:(id)a4 commissioneeNodeID:(id)a5 publicKey:(id)a6 completion:(id)a7;
- (void)retrieveStateForTrackedAccessory:(id)a3 stateNumber:(id *)a4 isReachable:(BOOL *)a5 linkQuality:(unint64_t *)a6 lastSeen:(id *)a7;
- (void)retrieveThreadNetworkMetadataWithCompletion:(id)a3;
- (void)retrieveThreadNetworkMetadataWithNoFallbackWithCompletion:(id)a3;
- (void)runPotentialFabricDataCreationBlock:(id)a3;
- (void)saveAndSyncWithThreadOperationalDataset:(id)a3 forceUpdate:(BOOL)a4;
- (void)saveSharedHomeToAccountWithReason:(id)a3 postSyncNotification:(BOOL)a4 options:(id)a5;
- (void)saveToCurrentAccountWithReason:(id)a3;
- (void)scheduleRemoval;
- (void)sendFirmwareUpdateUINotification:(id)a3;
- (void)setAccessories:(id)a3;
- (void)setActiveNetworkRouterInitialSetupNeeded:(BOOL)a3;
- (void)setActiveNetworkRouterUUID:(id)a3;
- (void)setAnyBTLEAccessoryReachable:(BOOL)a3;
- (void)setAtHomeLevel:(int64_t)a3;
- (void)setAutomaticSoftwareUpdateEnabled:(BOOL)a3;
- (void)setAvailableBSPsCount:(id)a3;
- (void)setAvailableBorderRouters:(id)a3;
- (void)setBackingStore:(id)a3;
- (void)setCHIPReportHandlerWithSubscriber:(id)a3 handler:(id)a4;
- (void)setCameraReachabilityEventNotificationsEnabled:(BOOL)a3 forAccessory:(id)a4 completionHandler:(id)a5;
- (void)setCurrentUser:(id)a3;
- (void)setHomeLocation:(int64_t)a3;
- (void)setHomeUpdatedToROARAndInformClients;
- (void)setMediaPassword:(id)a3;
- (void)setMediaPeerToPeerEnabled:(BOOL)a3;
- (void)setMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3;
- (void)setMinimumMediaUserPrivilege:(int64_t)a3;
- (void)setMinimumNetworkRouterSupportHomeKitVersion:(id)a3;
- (void)setName:(id)a3;
- (void)setNaturalLightingContext:(id)a3;
- (void)setNetworkRouterSupport:(unint64_t)a3;
- (void)setNetworkRouterSupportDisableReason:(unint64_t)a3;
- (void)setNfcReaderKey:(id)a3;
- (void)setOutgoingInvitations:(id)a3;
- (void)setOverriddenHomeAccessControl:(id)a3;
- (void)setOwner:(id)a3;
- (void)setOwnerTrustZoneCapable:(BOOL)a3;
- (void)setOwnerUser:(BOOL)a3;
- (void)setPersonManagerSettings:(id)a3;
- (void)setPrimaryNetworkRouterManagingDeviceUUID:(id)a3;
- (void)setProtectionMode:(int64_t)a3;
- (void)setRemoteAccessEnabled:(BOOL)a3;
- (void)setRouterClientManager:(id)a3;
- (void)setThreadNetworkID:(id)a3;
- (void)setThreadNetworkSequenceNumber:(unint64_t)a3;
- (void)setThreadOperationalDataset:(id)a3;
- (void)setUpFabricForPairingWithCompletion:(id)a3;
- (void)setUpSharedUserFabricDataWithForceFetch:(BOOL)a3 completion:(id)a4;
- (void)setWatchSkipVersionCheck:(BOOL)a3;
- (void)setupBackingStore;
- (void)startReportingSessionForMessage:(id)a3;
- (void)startThreadNetwork:(BOOL)a3;
- (void)stopThreadAccessoryFirmwareUpdateWithCompletion:(id)a3;
- (void)stopThreadAccessoryPairingWithCompletion:(id)a3;
- (void)stopThreadNetworkWithCompletion:(BOOL)a3 completion:(id)a4;
- (void)storeMigrationBulletinBoardNotificationsToDisk;
- (void)storeMigrationCameraNotificationSettingsToDisk;
- (void)storeMigrationCharacteristicsAuthorizationData;
- (void)submitLogEventForCommandResponse:(id)a3 nodeID:(unint64_t)a4 endpointID:(id)a5 clusterID:(id)a6 commandID:(id)a7 source:(unint64_t)a8 error:(id)a9;
- (void)submitLogEventForWriteAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 value:(id)a7 timedWriteTimeout:(id)a8 error:(id)a9;
- (void)subscribeForNotificationsFromRemoteGateway;
- (void)suspendedStateChangedForAccessory:(id)a3 suspendedState:(unint64_t)a4;
- (void)test_addActionSets:(id)a3;
- (void)test_addRooms:(id)a3;
- (void)test_addServiceGroups:(id)a3;
- (void)test_addTriggerOwnedActionSets:(id)a3;
- (void)test_addZones:(id)a3;
- (void)timerDidFire:(id)a3;
- (void)transactionObjectRemoved:(id)a3 message:(id)a4;
- (void)transactionObjectUpdated:(id)a3 newValues:(id)a4 message:(id)a5;
- (void)unconfigure;
- (void)unsetFabricForPairing;
- (void)updateAppData:(id)a3 identifierKey:(id)a4 lookup:(id)a5;
- (void)updateCATIDsForUsersIfNeeded:(BOOL)a3 completion:(id)a4;
- (void)updateHasOnboardedForWalletKey:(BOOL)a3 message:(id)a4;
- (void)updateHomeConfigurationWithModel:(id)a3 message:(id)a4;
- (void)updateHomeFirstHAPAccessoryAddedDateToNow;
- (void)updateHomeLocation;
- (void)updateLightProfilesSettings:(id)a3;
- (void)updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled:(BOOL)a3;
- (void)updateMediaStateWithResponses:(void *)a3 requestMessageInformation:;
- (void)updateNetworkConnectivity:(BOOL)a3 companionReachable:(BOOL)a4;
- (void)updateNetworkRouterManagingDeviceSettingsWithModel:(id)a3 message:(id)a4;
- (void)updateNetworkRouterSettingsWithModel:(id)a3 message:(id)a4;
- (void)updateROARStatus:(id)a3 message:(id)a4;
- (void)updateThreadOperationalDatasetWithHomeModel:(id)a3 message:(id)a4;
- (void)updateUserCATWithOperatePrivilege:(id)a3 administerPrivilege:(id)a4 completion:(id)a5;
- (void)userAssistantAccessControlDidUpdate:(id)a3 accessories:(id)a4;
- (void)userManagementOperationDidFinish:(id)a3;
- (void)writeAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 value:(id)a7 timedWriteTimeout:(id)a8 completion:(id)a9;
- (void)writeCharacteristicValues:(id)a3 message:(id)a4 withCompletionHandler:(id)a5;
- (void)writeCharacteristicValues:(id)a3 source:(unint64_t)a4 biomeSource:(unint64_t)a5 identifier:(id)a6 transport:(id)a7 qualityOfService:(int64_t)a8 withCompletionHandler:(id)a9;
- (void)writeCharacteristicValues:(id)a3 source:(unint64_t)a4 message:(id)a5 identifier:(id)a6 qualityOfService:(int64_t)a7 withCompletionHandler:(id)a8;
@end

@implementation HMDHome

- (id)resolveReceiverForMessageTargetUUID:(id)a3
{
  v4 = sub_253CCFF58();
  v5 = *(v4 - 8);
  v6 = *(v5 + 64);
  MEMORY[0x28223BE20](v4);
  v8 = (&v12 - ((v7 + 15) & 0xFFFFFFFFFFFFFFF0));
  sub_253CCFF38();
  v9 = self;
  v10 = sub_25320612C(v8);

  (*(v5 + 8))(v8, v4);

  return v10;
}

- (void)submitLogEventForWriteAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 value:(id)a7 timedWriteTimeout:(id)a8 error:(id)a9
{
  v14 = a4;
  v15 = a5;
  v16 = a6;
  swift_unknownObjectRetain();
  v17 = self;
  v18 = a8;
  v19 = a9;
  sub_253CD0E18();
  swift_unknownObjectRelease();
  sub_2532086C0(a3, v14, v15, v16, v20, a8, a9);

  __swift_destroy_boxed_opaque_existential_0(v20);
}

- (void)submitLogEventForCommandResponse:(id)a3 nodeID:(unint64_t)a4 endpointID:(id)a5 clusterID:(id)a6 commandID:(id)a7 source:(unint64_t)a8 error:(id)a9
{
  if (a3)
  {
    sub_253CD08D8();
  }

  v15 = a5;
  v16 = a6;
  v17 = a7;
  v19 = a9;
  v18 = self;
  sub_253208D18(a4, v15, v16, v17, a8, a9);
}

- (id)homeBulletinContext
{
  v10[2] = *MEMORY[0x277D85DE8];
  v9[0] = @"home";
  v3 = [(HMDHome *)self contextID];
  v10[0] = v3;
  v9[1] = *MEMORY[0x277CCF328];
  v4 = [(HMDHome *)self contextSPIUniqueIdentifier];
  v5 = [v4 UUIDString];
  v10[1] = v5;
  v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v10 forKeys:v9 count:2];

  v7 = *MEMORY[0x277D85DE8];

  return v6;
}

- (NSUUID)contextSPIUniqueIdentifier
{
  v3 = +[HMDProcessInfo privateClientIdentifierSalt];
  v4 = MEMORY[0x277CCAD78];
  v5 = [(HMDHome *)self uuid];
  v6 = [v4 hm_deriveUUIDFromBaseUUID:v5 identifierSalt:v3];

  return v6;
}

- (NSString)contextID
{
  v2 = [(HMDHome *)self uuid];
  v3 = [v2 UUIDString];

  return v3;
}

- (void)updateHasOnboardedForWalletKey:(BOOL)a3 message:(id)a4
{
  v4 = a3;
  v32 = *MEMORY[0x277D85DE8];
  v6 = a4;
  if ([(HMDHome *)self hasOnboardedForWalletKey]!= v4)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      [(HMDHome *)v8 hasOnboardedForWalletKey];
      v11 = HMFBooleanToString();
      v12 = HMFBooleanToString();
      v24 = 138544130;
      v25 = v10;
      v26 = 2112;
      v27 = v11;
      v28 = 2112;
      v29 = v12;
      v30 = 2112;
      v31 = v6;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Updating has onboarded for wallet key from %@ to %@ with message: %@", &v24, 0x2Au);
    }

    objc_autoreleasePoolPop(v7);
    v13 = [HMDHomeModel alloc];
    v14 = [(HMDHome *)v8 uuid];
    v15 = [(HMDHome *)v8 homeManager];
    v16 = [v15 uuid];
    v17 = [(HMDBackingStoreModelObject *)v13 initWithObjectChangeType:2 uuid:v14 parentUUID:v16];

    if (v4)
    {
      v18 = MEMORY[0x277CBEC38];
    }

    else
    {
      v18 = MEMORY[0x277CBEC28];
    }

    [(HMDHomeModel *)v17 setHasOnboardedForWalletKey:v18];
    v19 = [(HMDHome *)v8 backingStore];
    v20 = [v6 name];
    v21 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v22 = [v19 transaction:v20 options:v21];

    [v22 add:v17 withMessage:v6];
    [v22 run];
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (BOOL)hasPostedWalletKeyOnboardingBulletinForAnyAccessory
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_any:&__block_literal_global_153_1468];

  return v3;
}

uint64_t __70__HMDHome_Wallet__hasPostedWalletKeyOnboardingBulletinForAnyAccessory__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 hasPostedBulletinForWalletKeyOnboarding];

  return v5;
}

- (NSArray)accessoriesWithWalletKeySupport
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_151];

  return v3;
}

id __50__HMDHome_Wallet__accessoriesWithWalletKeySupport__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = 0;
  if ([v4 supportsWalletKey])
  {
    v5 = v4;
  }

  return v5;
}

- (BOOL)hasAnyAccessoryWithWalletKeyAndAccessCodeSupport
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_any:&__block_literal_global_148];

  return v3;
}

uint64_t __67__HMDHome_Wallet__hasAnyAccessoryWithWalletKeyAndAccessCodeSupport__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 supportsAccessCode];
  v6 = [v4 supportsWalletKey];

  return v6 & v5;
}

- (BOOL)hasAnyAccessoryWithWalletKeySupport
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_any:&__block_literal_global_1469];

  return v3;
}

uint64_t __54__HMDHome_Wallet__hasAnyAccessoryWithWalletKeySupport__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 supportsWalletKey];

  return v5;
}

+ (id)nfcIssuerKeyIdentifierWithPairingIdentity:(id)a3
{
  v3 = [a3 publicKey];
  v4 = [v3 data];
  v5 = [HMDHomeNFCReaderKey identifierForKey:v4];

  return v5;
}

- (id)createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:(id)a3 operationalKeyPair:(id)a4 error:(id *)a5
{
  v40 = *MEMORY[0x277D85DE8];
  v7 = a3;
  v8 = a4;
  v9 = [(HMDHome *)self currentDeviceControllerNodeID];
  v10 = [(HMDHome *)self accessoryAdministerPrivilegeCATID:0];
  if (v10)
  {
    v11 = [MEMORY[0x277CBEB98] setWithObject:v10];
    if (!v9)
    {
      goto LABEL_6;
    }

LABEL_5:
    if (![v9 isEqual:&unk_2866276B8])
    {
      goto LABEL_7;
    }

    goto LABEL_6;
  }

  v11 = 0;
  if (v9)
  {
    goto LABEL_5;
  }

LABEL_6:
  v12 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:{objc_msgSend(MEMORY[0x277D17B90], "randomNodeID")}];

  v13 = [(HMDHome *)self privateDataSourceForNode:v12];
  v9 = v12;
LABEL_7:
  v14 = objc_autoreleasePoolPush();
  v15 = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    HMFGetLogIdentifier();
    v17 = v28 = v8;
    v18 = [v7 rootCert];
    v19 = [v7 fabricID];
    *buf = 138544386;
    v31 = v17;
    v32 = 2112;
    v33 = v9;
    v34 = 2112;
    v35 = v11;
    v36 = 2112;
    v37 = v18;
    v38 = 2112;
    v39 = v19;
    _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Creating operational certificate for controller node ID %@ CAT %@ root cert %@, fabric ID %@", buf, 0x34u);

    v8 = v28;
  }

  objc_autoreleasePoolPop(v14);
  v20 = MEMORY[0x277CD5230];
  v21 = [v7 rootKeyPair];
  v22 = [v7 rootCert];
  v23 = [v8 publicKey];
  v24 = [v7 fabricID];
  v25 = [v20 createOperationalCertificate:v21 signingCertificate:v22 operationalPublicKey:v23 fabricID:v24 nodeID:v9 caseAuthenticatedTags:v11 error:a5];

  v26 = *MEMORY[0x277D85DE8];

  return v25;
}

- (id)fetchOperationalFabricDataWithError:(id *)a3
{
  v47 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [(HMDHome *)self storedFabricDataWithError:a3];
    if (*a3)
    {
      v6 = objc_autoreleasePoolPush();
      v7 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = HMFGetLogIdentifier();
        v10 = *a3;
        v43 = 138543618;
        v44 = v9;
        v45 = 2112;
        v46 = v10;
        _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data from local storage: %@", &v43, 0x16u);
      }

      objc_autoreleasePoolPop(v6);
      v11 = 0;
      goto LABEL_38;
    }

    if ([(HMDHome *)self isCurrentDevicePrimaryResident])
    {
      v16 = [v5 residentOperationalCert];
      v17 = [v5 residentOperationalKeyPair];
      goto LABEL_19;
    }

    if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
    {
      v17 = [(HMDHome *)self storedOperationalKeyPair];
      if (v17)
      {
        v16 = [(HMDHome *)self createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:v5 operationalKeyPair:v17 error:a3];
        if (*a3)
        {
          v18 = objc_autoreleasePoolPush();
          v19 = self;
          v20 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
          {
            v21 = HMFGetLogIdentifier();
            v22 = *a3;
            v43 = 138543618;
            v44 = v21;
            v45 = 2112;
            v46 = v22;
            _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data due to cert generation failure: %@", &v43, 0x16u);
          }

          objc_autoreleasePoolPop(v18);
          v11 = 0;
          goto LABEL_37;
        }

LABEL_19:
        v23 = [v5 rootCert];

        if (v23)
        {
          if (v16)
          {
            goto LABEL_21;
          }
        }

        else
        {
          v24 = objc_autoreleasePoolPush();
          v25 = self;
          v26 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
          {
            v27 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v27;
            _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while root cert is missing from storage", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          if (v16)
          {
LABEL_21:
            if (v17)
            {
LABEL_32:
              v36 = [v5 rootCert];

              if (v17 && v16 && v36)
              {
                v37 = objc_alloc(MEMORY[0x277D17B58]);
                v38 = [v5 rootCert];
                v39 = [v5 ipk];
                v40 = [v5 residentNodeID];
                v11 = [v37 initWithRootCert:v38 ipk:v39 residentNodeID:v40 operationalCert:v16 operationalKeyPair:v17];
              }

              else
              {
                [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
                *a3 = v11 = 0;
              }

LABEL_37:

LABEL_38:
              goto LABEL_39;
            }

LABEL_29:
            v32 = objc_autoreleasePoolPush();
            v33 = self;
            v34 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
            {
              v35 = HMFGetLogIdentifier();
              v43 = 138543362;
              v44 = v35;
              _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while operational key pair is missing", &v43, 0xCu);
            }

            objc_autoreleasePoolPop(v32);
            goto LABEL_32;
          }
        }

        v28 = objc_autoreleasePoolPush();
        v29 = self;
        v30 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
        {
          v31 = HMFGetLogIdentifier();
          v43 = 138543362;
          v44 = v31;
          _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while operational cert is missing from storage", &v43, 0xCu);
        }

        objc_autoreleasePoolPop(v28);
        if (v17)
        {
          goto LABEL_32;
        }

        goto LABEL_29;
      }
    }

    else
    {
      v17 = 0;
    }

    v16 = 0;
    goto LABEL_19;
  }

  v12 = objc_autoreleasePoolPush();
  v13 = self;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
  {
    v15 = HMFGetLogIdentifier();
    v43 = 138543362;
    v44 = v15;
    _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Fetching operational fabric data failed for shared user while caching is not supported", &v43, 0xCu);
  }

  objc_autoreleasePoolPop(v12);
  [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
  *a3 = v11 = 0;
LABEL_39:
  v41 = *MEMORY[0x277D85DE8];

  return v11;
}

void __102__HMDHome_CHIP__fetchOrCreateFabricDataForPairingWithOperationalKeyPair_fetchFromResident_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, void *a6)
{
  v65 = *MEMORY[0x277D85DE8];
  v11 = a2;
  v55 = a3;
  v12 = a4;
  v13 = a5;
  v14 = a6;
  if (!v14)
  {
    v19 = *(a1 + 32);
    v56 = 0;
    v20 = [v19 storedFabricDataWithError:&v56];
    v54 = v56;
    if (v54)
    {
      v21 = objc_autoreleasePoolPush();
      v22 = *(a1 + 32);
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v25 = v24 = v11;
        *buf = 138543618;
        v58 = v25;
        v59 = 2112;
        v60 = v54;
        _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@No stored fabric data for pairing: %@", buf, 0x16u);

        v11 = v24;
      }

      objc_autoreleasePoolPop(v21);
    }

    v53 = v11;
    v26 = [objc_alloc(MEMORY[0x277D17B58]) initWithRootCert:v11 ipk:v13 residentNodeID:v12 operationalCert:v55 operationalKeyPair:*(a1 + 40)];
    v27 = [v26 fabricID];

    if (!v27)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = *(a1 + 32);
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v36 = v51 = v33;
        *buf = 138543362;
        v58 = v36;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_ERROR, "%{public}@Fabric data for pairing fetched from a resident is corrupt", buf, 0xCu);

        v33 = v51;
      }

      objc_autoreleasePoolPop(v33);
      v37 = *(a1 + 48);
      v38 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
      (*(v37 + 16))(v37, 0, 0, v38);

      goto LABEL_22;
    }

    v28 = [v20 rootKeyPair];
    if (v28)
    {
      v29 = v28;
      v30 = [v20 rootCert];
      if (v30)
      {
        v31 = v30;
        v32 = [v20 fabricID];

        if (v32)
        {
LABEL_21:
          (*(*(a1 + 48) + 16))();
LABEL_22:
          v11 = v53;

          goto LABEL_23;
        }
      }

      else
      {
      }
    }

    v39 = objc_autoreleasePoolPush();
    v40 = *(a1 + 32);
    v41 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v42 = v50 = v26;
      v48 = [v20 rootKeyPair];
      HMFBooleanToString();
      v43 = v49 = v40;
      v47 = [v20 rootCert];
      v44 = HMFBooleanToString();
      [v20 fabricID];
      v45 = v52 = v39;
      *buf = 138544130;
      v58 = v42;
      v59 = 2112;
      v60 = v43;
      v61 = 2112;
      v62 = v44;
      v63 = 2112;
      v64 = v45;
      _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Stored fabric data insufficient for pairing: rootKeyPair %@, rootCert %@, fabricID %@", buf, 0x2Au);

      v39 = v52;
      v40 = v49;

      v26 = v50;
    }

    objc_autoreleasePoolPop(v39);
    v20 = 0;
    goto LABEL_21;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = *(a1 + 32);
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
  {
    v18 = HMFGetLogIdentifier();
    *buf = 138543618;
    v58 = v18;
    v59 = 2112;
    v60 = v14;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch fabric data for pairing from resident: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v15);
  (*(*(a1 + 48) + 16))();
LABEL_23:

  v46 = *MEMORY[0x277D85DE8];
}

- (void)fetchFabricDataForPairingWithCompletion:(id)a3
{
  v81 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (![(HMDHome *)self doesHomeContainResident])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      v14 = [(HMDHome *)self fabric];

      if (v14)
      {
        v15 = [(HMDHome *)self operationalKeyPairForPairing];
        v65[0] = MEMORY[0x277D85DD0];
        v65[1] = 3221225472;
        v65[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_329;
        v65[3] = &unk_279721B00;
        v65[4] = self;
        v66 = v4;
        [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:v15 fetchFromResident:0 completion:v65];

        v13 = v66;
        goto LABEL_10;
      }
    }

    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v74 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot fetch fabric data for pairing without a resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    (*(v4 + 2))(v4, 0, 0, v20);
    goto LABEL_18;
  }

  v5 = [(HMDHome *)self primaryResident];
  if (v5)
  {
    v6 = v5;
    v7 = [(HMDHome *)self primaryResident];
    v8 = [v7 capabilities];

    if (v8)
    {
      if ([(HMDHome *)self isOwnerUser])
      {
        v9 = [(HMDHome *)self primaryResident];
        v10 = [v9 capabilities];
        v11 = [v10 supportsMatterOwnerCertFetch];

        if (v11)
        {
          v12 = [(HMDHome *)self operationalKeyPairForPairing];
          v69[0] = MEMORY[0x277D85DD0];
          v69[1] = 3221225472;
          v69[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_2;
          v69[3] = &unk_279721C58;
          v70 = v4;
          [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:v12 fetchFromResident:1 completion:v69];

          v13 = v70;
LABEL_10:

          goto LABEL_19;
        }

        v68 = 0;
        v29 = [(HMDHome *)self storedFabricDataWithError:&v68];
        v30 = v68;
        if (v30)
        {
          v31 = objc_autoreleasePoolPush();
          v32 = self;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v74 = v34;
            v75 = 2112;
            v76 = v30;
            _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_ERROR, "%{public}@Could to retrieve stored fabric data for pairing: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          (*(v4 + 2))(v4, 0, 0, v30);
LABEL_35:

          goto LABEL_19;
        }

        v35 = [v29 residentOperationalKeyPair];
        if (!v35)
        {
          goto LABEL_32;
        }

        v36 = v35;
        v37 = [v29 rootKeyPair];
        if (v37)
        {
          v38 = v37;
          v39 = [v29 rootCert];
          if (v39)
          {
            v40 = v39;
            v41 = [v29 fabricID];

            if (v41)
            {
              v42 = [v29 residentOperationalKeyPair];
              v67 = 0;
              v43 = [(HMDHome *)self createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:v29 operationalKeyPair:v42 error:&v67];
              v44 = v67;
              if (v43)
              {
                v45 = objc_alloc(MEMORY[0x277D17B58]);
                v46 = [v29 rootCert];
                v47 = [v29 ipk];
                v48 = [v29 residentNodeID];
                v49 = [v45 initWithRootCert:v46 ipk:v47 residentNodeID:v48 operationalCert:v43 operationalKeyPair:v42];

                (*(v4 + 2))(v4, v49, 0, 0);
              }

              else
              {
                v58 = objc_autoreleasePoolPush();
                v59 = self;
                v60 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v60, OS_LOG_TYPE_ERROR))
                {
                  v61 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v74 = v61;
                  v75 = 2112;
                  v76 = v44;
                  _os_log_impl(&dword_2531F8000, v60, OS_LOG_TYPE_ERROR, "%{public}@Could not generate operational certificate for pairing: %@", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v58);
                (*(v4 + 2))(v4, 0, 0, v44);
              }

              goto LABEL_19;
            }

LABEL_32:
            v50 = objc_autoreleasePoolPush();
            v51 = self;
            v52 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
            {
              v53 = HMFGetLogIdentifier();
              v63 = [v29 rootKeyPair];
              v54 = HMFBooleanToString();
              v62 = [v29 rootCert];
              HMFBooleanToString();
              v55 = v64 = v50;
              v56 = [v29 fabricID];
              *buf = 138544130;
              v74 = v53;
              v75 = 2112;
              v76 = v54;
              v77 = 2112;
              v78 = v55;
              v79 = 2112;
              v80 = v56;
              _os_log_impl(&dword_2531F8000, v52, OS_LOG_TYPE_ERROR, "%{public}@Stored fabric data insufficient for pairing: rootKeyPair %@, rootCert %@, fabricID %@", buf, 0x2Au);

              v50 = v64;
            }

            objc_autoreleasePoolPop(v50);
            v57 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
            (*(v4 + 2))(v4, 0, 0, v57);

            goto LABEL_35;
          }
        }

        goto LABEL_32;
      }

      v20 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
      v71[0] = MEMORY[0x277D85DD0];
      v71[1] = 3221225472;
      v71[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke;
      v71[3] = &unk_279721C58;
      v72 = v4;
      [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:v20 fetchFromResident:1 completion:v71];

LABEL_18:
      goto LABEL_19;
    }
  }

  v21 = objc_autoreleasePoolPush();
  v22 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    *buf = 138543362;
    v74 = v24;
    _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Cannot fetch fabric data for pairing when a primary resident is unreachable", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  v25 = MEMORY[0x277CCA9B8];
  v26 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
  v27 = [v25 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v26];
  (*(v4 + 2))(v4, 0, 0, v27);

LABEL_19:
  v28 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_329(uint64_t a1, void *a2, void *a3, void *a4)
{
  v24 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  if (v8 | v9)
  {
    v10 = v9;
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Cannot use fetched operational fabric data without stored fabric data for owner local pairing", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];

    v7 = 0;
  }

  v15 = MEMORY[0x277CD5230];
  v16 = [v8 residentOperationalKeyPair];
  v17 = [v7 operationalCert];
  LODWORD(v15) = [v15 keypair:v16 matchesCertificate:v17];

  if (v15)
  {
    v18 = *(a1 + 32);
    v19 = [v7 operationalNodeID];
    v20 = [v18 privateDataSourceForNode:v19];
  }

  (*(*(a1 + 40) + 16))();

  v21 = *MEMORY[0x277D85DE8];
}

- (void)clearAccessoryServerBrowserOperationalFabricData
{
  v6 = [(HMDHome *)self homeManager];
  v3 = [v6 accessoryBrowser];
  v4 = [v3 chipAccessoryServerBrowser];
  v5 = [(HMDHome *)self targetFabricUUID];
  [v4 clearOperationalFabricDataForTargetFabricUUID:v5];
}

- (BOOL)setUpAccessoryServerBrowserWithOperationalFabricData:(id)a3 ownerDataSnapshot:(id)a4 error:(id *)a5
{
  v54 = *MEMORY[0x277D85DE8];
  v7 = a3;
  v8 = a4;
  v9 = objc_alloc(MEMORY[0x277D17B50]);
  if (v8)
  {
    v10 = [v8 rootKeyPair];
    v11 = [v7 rootCert];
    v12 = [v7 fabricID];
    v13 = [v9 initWithRootKeyPair:v10 rootCertificate:v11 fabricID:v12];
  }

  else
  {
    v10 = [v7 fabricID];
    v13 = [v9 initWithRemoteDelegate:self fabricID:v10];
  }

  v14 = [(HMDHome *)self targetFabricUUID];
  v15 = [(HMDHome *)self homeManager];
  v16 = [v15 chipDataSource];
  v17 = [v16 allTargetFabricUUIDs];

  v18 = [v7 operationalNodeID];
  v19 = [(HMDHome *)self privateDataSourceForNode:v18];

  v20 = [(HMDHome *)self isFeatureMatterLocalFabricConfigEnabled];
  if (v19)
  {
    LODWORD(v21) = 0;
  }

  else
  {
    LODWORD(v21) = v20;
  }

  if (v21 == 1)
  {
    v40 = v17;
    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v25 = v21 = v13;
      *buf = 138543362;
      v47 = v25;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Cannot set up operational fabric data without private data source", buf, 0xCu);

      v13 = v21;
      LOBYTE(v21) = 1;
    }

    objc_autoreleasePoolPop(v22);
    *a5 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
    v17 = v40;
  }

  else
  {
    v26 = [v8 rootKeyPair];

    if (v26)
    {
      v27 = [v8 rootKeyPair];
      v45 = SecKeyCopyExternalRepresentation([v27 publicKey], 0);
    }

    else
    {
      v45 = 0;
    }

    v42 = v13;
    v43 = v14;
    if ([(HMDHome *)self isCurrentDevicePrimaryResident])
    {
      v28 = [(HMDHome *)self matterAccessories];
      v29 = [v28 na_map:&__block_literal_global_325];
      v39 = [v29 na_filter:&__block_literal_global_327];
    }

    else
    {
      v39 = 0;
    }

    v41 = v21;
    v30 = objc_autoreleasePoolPush();
    v31 = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      v33 = HMFGetLogIdentifier();
      v34 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[__CFData hash](v45, "hash")}];
      *buf = 138544130;
      v47 = v33;
      v48 = 2112;
      v49 = v7;
      v50 = 2112;
      v51 = v43;
      v52 = 2112;
      v53 = v34;
      _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_INFO, "%{public}@Setting operational fabric data %@ for target fabric UUID %@, signing key: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v30);
    v35 = [v15 accessoryBrowser];
    v21 = [v35 chipAccessoryServerBrowser];
    v36 = [(HMDHome *)v31 uuid];
    v13 = v42;
    [v21 setOperationalFabricData:v7 operationalCertIssuer:v42 storageDataSource:v19 allTargetFabricUUIDs:v17 entityIdentifier:v36 accessoryServerNodeIDs:v39 forTargetFabricUUID:v43];

    v14 = v43;
    LOBYTE(v21) = v41;
  }

  v37 = *MEMORY[0x277D85DE8];
  return v21 ^ 1;
}

- (id)storedSharedHomeFabricData
{
  v3 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  v4 = [(HMDHome *)self uuid];
  v5 = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v3 initWithHomeUUID:v4 iCloudIdentifier:v5];

  v7 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v6 fabricData];

  return v7;
}

- (void)removeSharedHomeFabricData
{
  v3 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  v4 = [(HMDHome *)self uuid];
  v5 = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v3 initWithHomeUUID:v4 iCloudIdentifier:v5];

  [(HMDCHIPSharedHomeKeychainFabricDataStore *)v6 removeFabricData];
}

- (BOOL)storeSharedHomeFabricData:(id)a3
{
  v4 = a3;
  v5 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  v6 = [(HMDHome *)self uuid];
  v7 = [(HMDHome *)self iCloudIdentifier];
  v8 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v5 initWithHomeUUID:v6 iCloudIdentifier:v7];

  LOBYTE(v7) = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v8 storeFabricData:v4];
  return v7;
}

- (BOOL)auditStorageWithFabricData:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 fabricID];
  if (v5)
  {
    v6 = v5;
    v7 = [v4 fabricID];
    v8 = [v7 isEqual:&unk_2866276B8];

    if (!v8)
    {
      v15 = [(HMDHome *)self fabricDataInLegacyStorage];
      v16 = [v15 rootCert];
      if (!v16)
      {
        goto LABEL_15;
      }

      v17 = v16;
      v18 = [v15 residentOperationalCert];
      if (v18)
      {
        v19 = v18;
        v20 = MEMORY[0x277CD5230];
        v21 = [v15 rootCert];
        v22 = [v4 rootCert];
        if ([v20 isCertificate:v21 equalTo:v22])
        {
          v23 = MEMORY[0x277CD5230];
          v24 = [v15 residentOperationalCert];
          v25 = [v4 residentOperationalCert];
          if ([v23 isCertificate:v24 equalTo:v25])
          {
            [v15 ipk];
            v26 = v34 = v24;
            v27 = [v4 ipk];
            v35 = [v26 isEqual:v27];

            if (v35)
            {
              v14 = 1;
LABEL_18:

              goto LABEL_19;
            }

LABEL_15:
            v28 = objc_autoreleasePoolPush();
            v29 = self;
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
            {
              v31 = HMFGetLogIdentifier();
              *buf = 138543362;
              v37 = v31;
              _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@Updating fabric data in legacy storage", buf, 0xCu);
            }

            objc_autoreleasePoolPop(v28);
            v14 = [(HMDHome *)v29 storeIntoLegacyStorageWithFabricData:v4];
            goto LABEL_18;
          }
        }
      }

      goto LABEL_15;
    }
  }

  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [v4 fabricID];
    *buf = 138543618;
    v37 = v12;
    v38 = 2112;
    v39 = v13;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot audit storage with invalid fabricID: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = 0;
LABEL_19:

  v32 = *MEMORY[0x277D85DE8];
  return v14;
}

- (BOOL)storeIntoLegacyStorageWithFabricData:(id)a3
{
  v4 = a3;
  v5 = [HMDCHIPHomeDataSource alloc];
  v6 = [v4 fabricID];
  v7 = [(HMDCHIPHomeDataSource *)v5 initWithFabricID:v6 home:self];

  v8 = objc_alloc_init(MEMORY[0x277D17B00]);
  v9 = objc_alloc_init(MEMORY[0x277D17B40]);
  v10 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:v4 chipStorageDelegate:v7 keychainDelegate:v8 v2FabricDataStoreDelegate:v9];

  LOBYTE(v4) = [v10 commit];
  return v4;
}

- (id)fabricDataInLegacyStorage
{
  v3 = [HMDCHIPHomeDataSource alloc];
  v4 = [(HMDHome *)self matterFabricID];
  v5 = [(HMDCHIPHomeDataSource *)v3 initWithFabricID:v4 home:self];

  v6 = objc_alloc_init(MEMORY[0x277D17B00]);
  v7 = objc_alloc_init(MEMORY[0x277D17B30]);
  v8 = [objc_alloc(MEMORY[0x277D17B28]) initWithCHIPStorageDelegate:v5 keychainDelegate:v6 v2FabricDataStoreDelegate:v7];
  v11 = 0;
  v9 = [v8 locallyStoredFabricDataWithDataPresentInV2FabricDataStore:0 error:&v11];

  return v9;
}

- (BOOL)storeNewFabricData:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 fabricID];
  if (v5 && (v6 = v5, [v4 fabricID], v7 = objc_claimAutoreleasedReturnValue(), v8 = objc_msgSend(v7, "isEqual:", &unk_2866276B8), v7, v6, !v8))
  {
    v15 = [HMDCHIPHomeDataSource alloc];
    v16 = [v4 fabricID];
    v17 = [(HMDCHIPHomeDataSource *)v15 initWithFabricID:v16 home:self];

    v18 = objc_alloc_init(MEMORY[0x277D17B00]);
    v19 = [HMDCHIPHomeKeychainFabricData alloc];
    v20 = [(HMDHome *)self uuid];
    v21 = [(HMDHome *)self iCloudIdentifier];
    v22 = [(HMDCHIPHomeKeychainFabricData *)v19 initWithHomeUUID:v20 iCloudIdentifier:v21];

    v23 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:v4 chipStorageDelegate:v17 keychainDelegate:v18 v2FabricDataStoreDelegate:v22];
    v14 = [v23 commit];
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v4 fabricID];
      v26 = 138543618;
      v27 = v12;
      v28 = 2112;
      v29 = v13;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot store new fabric data with invalid fabricID: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = 0;
  }

  v24 = *MEMORY[0x277D85DE8];
  return v14;
}

- (id)newFabricData
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self matterFabricID];
  if (v3)
  {
    v4 = v3;
  }

  else
  {
    v4 = &unk_2866276B8;
  }

  v5 = [[HMDCHIPHomeDataSource alloc] initWithFabricID:v4 home:self];
  v6 = objc_alloc_init(MEMORY[0x277D17B00]);
  v7 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:v5 keychainDelegate:v6];
  v8 = [v7 newFabricData];
  if (!v8)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v13;
      v14 = "%{public}@Failed to create new fabric data";
LABEL_11:
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, v14, &v17, 0xCu);
    }

LABEL_12:

    objc_autoreleasePoolPop(v10);
    v9 = 0;
    goto LABEL_13;
  }

  if (![(HMDHome *)self storeNewFabricData:v8])
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v13;
      v14 = "%{public}@Failed to store newly created fabric data";
      goto LABEL_11;
    }

    goto LABEL_12;
  }

  v9 = v8;
LABEL_13:

  v15 = *MEMORY[0x277D85DE8];
  return v9;
}

- (id)storedFabricDataWithDataPresentInV2FabricDataStore:(BOOL *)a3 error:(id *)a4
{
  v7 = [(HMDHome *)self matterFabricID];
  if (v7)
  {
    v8 = v7;
  }

  else
  {
    v8 = &unk_2866276B8;
  }

  v9 = [[HMDCHIPHomeDataSource alloc] initWithFabricID:v8 home:self];
  v10 = objc_alloc_init(MEMORY[0x277D17B00]);
  v11 = [HMDCHIPHomeKeychainFabricData alloc];
  v12 = [(HMDHome *)self uuid];
  v13 = [(HMDHome *)self iCloudIdentifier];
  v14 = [(HMDCHIPHomeKeychainFabricData *)v11 initWithHomeUUID:v12 iCloudIdentifier:v13];

  v15 = [objc_alloc(MEMORY[0x277D17B28]) initWithCHIPStorageDelegate:v9 keychainDelegate:v10 v2FabricDataStoreDelegate:v14];
  v16 = [v15 locallyStoredFabricDataWithDataPresentInV2FabricDataStore:a3 error:a4];

  return v16;
}

- (id)iCloudIdentifier
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 appleAccountManager];

  if (![v3 isLoggedInToPrimaryAccount] || (objc_msgSend(v3, "accountContext"), v4 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v4, "identifier"), v5 = objc_claimAutoreleasedReturnValue(), v4, !v5))
  {
    v5 = @"NOT-LOGGED-IN";
    v6 = @"NOT-LOGGED-IN";
  }

  return v5;
}

- (id)storedOperationalKeyPair
{
  v21 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isOwnerUser])
  {
    v16 = 0;
    v3 = [(HMDHome *)self storedFabricDataWithError:&v16];
    v4 = v16;
    if (!v3)
    {
      v5 = objc_autoreleasePoolPush();
      v6 = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v8;
        v19 = 2112;
        v20 = v4;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Failed to fetch sstored operational key pair, which may happen when owner never created the key: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v5);
    }

    v9 = [v3 residentOperationalKeyPair];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v13;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Unexpected call to storedOperationalKeyPair for shared user", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    v9 = 0;
  }

  v14 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)operationalKeyPairForPairing
{
  v2 = [(HMDHome *)self storedOperationalKeyPair];
  if (!v2)
  {
    v2 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
  }

  return v2;
}

- (BOOL)isPrimaryResidentNodeReachable
{
  v2 = [(HMDHome *)self primaryResident];
  v3 = [v2 isReachable];

  return v3;
}

- (BOOL)areAllThreadResidentNodesUnreachable
{
  v2 = [(HMDHome *)self enabledResidents];
  v3 = [v2 na_allObjectsPassTest:&__block_literal_global_317];

  return v3;
}

uint64_t __53__HMDHome_CHIP__areAllThreadResidentNodesUnreachable__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 capabilities];
  if ([v3 supportsThreadBorderRouter])
  {
    v4 = [v2 isReachable] ^ 1;
  }

  else
  {
    v4 = 1;
  }

  return v4;
}

- (void)updateUserCATWithOperatePrivilege:(id)a3 administerPrivilege:(id)a4 completion:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __82__HMDHome_CHIP__updateUserCATWithOperatePrivilege_administerPrivilege_completion___block_invoke;
  v15[3] = &unk_279734578;
  v15[4] = self;
  v16 = v8;
  v17 = v9;
  v18 = v10;
  v12 = v10;
  v13 = v9;
  v14 = v8;
  dispatch_async(v11, v15);
}

void __82__HMDHome_CHIP__updateUserCATWithOperatePrivilege_administerPrivilege_completion___block_invoke(uint64_t a1)
{
  v1 = a1;
  v48 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) backingStore];
  v3 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v33 = [v2 transaction:@"UpdatingUserCATIDs" options:v3];

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v4 = [*(v1 + 32) users];
  v5 = [v4 countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v5)
  {

    goto LABEL_23;
  }

  v7 = v5;
  v8 = 0;
  v9 = *v36;
  v34 = (v1 + 48);
  v32 = v1;
  v10 = (v1 + 40);
  *&v6 = 138544130;
  v29 = v6;
  v31 = v4;
  do
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(v4);
      }

      v12 = *(*(&v35 + 1) + 8 * i);
      v13 = [v12 privilege];
      if (v13 != 4)
      {
        if (v13 == 3)
        {
          if (!*v34)
          {
            continue;
          }

          v17 = [v12 matterCASEAuthenticatedTagID];
          v18 = [v17 isEqual:*v34];

          v16 = v34;
          if (v18)
          {
            continue;
          }

          goto LABEL_14;
        }

        if (v13)
        {
          continue;
        }
      }

      if (!*v10)
      {
        continue;
      }

      v14 = [v12 matterCASEAuthenticatedTagID];
      v15 = [v14 isEqual:*v10];

      v16 = v10;
      if (v15)
      {
        continue;
      }

LABEL_14:
      v19 = *v16;
      if (v19)
      {
        v20 = v19;
        v21 = [v12 newModelWithChangeType:2];
        [v21 setMatterCASEAuthenticatedTagID:v20];
        [v33 add:v21];
        v22 = objc_autoreleasePoolPush();
        v23 = *(v32 + 32);
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v25 = v30 = v22;
          v26 = [v20 integerValue];
          *buf = v29;
          v40 = v25;
          v41 = 2112;
          v42 = v12;
          v43 = 2048;
          v44 = v26;
          v45 = 2112;
          v46 = v20;
          _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Updated CATID transaction for user %@ to 0x%lX (%@)", buf, 0x2Au);

          v22 = v30;
        }

        objc_autoreleasePoolPop(v22);
        v8 = 1;
        v4 = v31;
      }
    }

    v7 = [v4 countByEnumeratingWithState:&v35 objects:v47 count:16];
  }

  while (v7);

  v1 = v32;
  if (v8)
  {
    [v33 run:*(v32 + 56)];
    goto LABEL_25;
  }

LABEL_23:
  v27 = *(v1 + 56);
  if (v27)
  {
    (*(v27 + 16))(v27, 0);
  }

LABEL_25:

  v28 = *MEMORY[0x277D85DE8];
}

- (void)incrementOperatePrivilegeCATVersion:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self accessoryOperatePrivilegeCATID:1];
  v13 = 0;
  [MEMORY[0x277D17B90] parseCaseAuthenticatedTag:v5 identifier:&v13 + 2 version:&v13];
  v6 = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:HIWORD(v13) version:(v13 + 1)];
  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [v6 integerValue];
    *buf = 138543874;
    v15 = v10;
    v16 = 2048;
    v17 = v11;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Bumping tag version for operate as 0x%lX (%@)", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v4[2](v4, v6);

  v12 = *MEMORY[0x277D85DE8];
}

- (id)accessoryAdministerPrivilegeCATID:(BOOL)a3
{
  v3 = a3;
  v48 = *MEMORY[0x277D85DE8];
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  v5 = [(HMDHome *)self users];
  v6 = [v5 countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v6)
  {
LABEL_21:

LABEL_22:
    v8 = [(HMDHome *)self currentAdministerCATID];

    if (v8)
    {
      v8 = [(HMDHome *)self currentAdministerCATID];
    }

    if (!v8 && v3)
    {
      v8 = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:objc_msgSend(MEMORY[0x277D17B90] version:{"randomCASEAuthenticatedTagIdentifier"), 1}];
      v27 = objc_autoreleasePoolPush();
      v28 = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        v31 = [v8 integerValue];
        *buf = 138543874;
        v40 = v30;
        v41 = 2048;
        v42 = v31;
        v43 = 2112;
        v44 = v8;
        _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_INFO, "%{public}@Generated new CAT for accessory administer 0x%lX (%@)", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v27);
    }

    goto LABEL_29;
  }

  v7 = v6;
  v34 = v3;
  v8 = 0;
  v9 = *v36;
  while (2)
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(v5);
      }

      v11 = *(*(&v35 + 1) + 8 * i);
      if ([v11 privilege] == 3)
      {
        if (v8 || ([v11 matterCASEAuthenticatedTagID], v18 = objc_claimAutoreleasedReturnValue(), v18, !v18))
        {
          v12 = [v11 matterCASEAuthenticatedTagID];
          v13 = [v12 isEqual:v8];

          if ((v13 & 1) == 0)
          {
            v14 = [v11 matterCASEAuthenticatedTagID];
            if (v14)
            {
              v15 = v14;
              v16 = [v11 matterCASEAuthenticatedTagID];
              v17 = [v16 isEqual:v8];

              if ((v17 & 1) == 0)
              {
                v19 = objc_autoreleasePoolPush();
                v20 = self;
                v21 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
                {
                  v23 = HMFGetLogIdentifier();
                  v24 = [v8 integerValue];
                  v25 = [v11 matterCASEAuthenticatedTagID];
                  v26 = [v25 integerValue];
                  *buf = 138544130;
                  v40 = v23;
                  v41 = 2048;
                  v42 = v24;
                  v43 = 2048;
                  v44 = v26;
                  v45 = 2112;
                  v46 = v11;
                  _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@CATID mismatch between users - current 0x%lX userCAT 0x%lX user %@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v19);
                v3 = v34;
                goto LABEL_21;
              }
            }
          }
        }

        else
        {
          v8 = [v11 matterCASEAuthenticatedTagID];
        }
      }
    }

    v7 = [v5 countByEnumeratingWithState:&v35 objects:v47 count:16];
    if (v7)
    {
      continue;
    }

    break;
  }

  v3 = v34;
  if (!v8)
  {
    goto LABEL_22;
  }

LABEL_29:
  [(HMDHome *)self setCurrentAdministerCATID:v8];
  v32 = *MEMORY[0x277D85DE8];

  return v8;
}

- (id)accessoryOperatePrivilegeCATID:(BOOL)a3
{
  v3 = a3;
  v48 = *MEMORY[0x277D85DE8];
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  v5 = [(HMDHome *)self users];
  v6 = [v5 countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v6)
  {
LABEL_21:

LABEL_22:
    v8 = [(HMDHome *)self currentOperateCATID];

    if (v8)
    {
      v8 = [(HMDHome *)self currentOperateCATID];
    }

    if (!v8 && v3)
    {
      v8 = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:objc_msgSend(MEMORY[0x277D17B90] version:{"randomCASEAuthenticatedTagIdentifier"), 1}];
      v27 = objc_autoreleasePoolPush();
      v28 = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        v31 = [v8 integerValue];
        *buf = 138543874;
        v40 = v30;
        v41 = 2048;
        v42 = v31;
        v43 = 2112;
        v44 = v8;
        _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_INFO, "%{public}@Generated new CAT for accessory operate 0x%lX (%@)", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v27);
    }

    goto LABEL_29;
  }

  v7 = v6;
  v34 = v3;
  v8 = 0;
  v9 = *v36;
  while (2)
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(v5);
      }

      v11 = *(*(&v35 + 1) + 8 * i);
      if (([v11 privilege] | 4) == 4)
      {
        if (v8 || ([v11 matterCASEAuthenticatedTagID], v18 = objc_claimAutoreleasedReturnValue(), v18, !v18))
        {
          v12 = [v11 matterCASEAuthenticatedTagID];
          v13 = [v12 isEqual:v8];

          if ((v13 & 1) == 0)
          {
            v14 = [v11 matterCASEAuthenticatedTagID];
            if (v14)
            {
              v15 = v14;
              v16 = [v11 matterCASEAuthenticatedTagID];
              v17 = [v16 isEqual:v8];

              if ((v17 & 1) == 0)
              {
                v19 = objc_autoreleasePoolPush();
                v20 = self;
                v21 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
                {
                  v23 = HMFGetLogIdentifier();
                  v24 = [v8 integerValue];
                  v25 = [v11 matterCASEAuthenticatedTagID];
                  v26 = [v25 integerValue];
                  *buf = 138544130;
                  v40 = v23;
                  v41 = 2048;
                  v42 = v24;
                  v43 = 2048;
                  v44 = v26;
                  v45 = 2112;
                  v46 = v11;
                  _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@CATID mismatch between users - current 0x%lX userCAT 0x%lX user %@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v19);
                v3 = v34;
                goto LABEL_21;
              }
            }
          }
        }

        else
        {
          v8 = [v11 matterCASEAuthenticatedTagID];
        }
      }
    }

    v7 = [v5 countByEnumeratingWithState:&v35 objects:v47 count:16];
    if (v7)
    {
      continue;
    }

    break;
  }

  v3 = v34;
  if (!v8)
  {
    goto LABEL_22;
  }

LABEL_29:
  [(HMDHome *)self setCurrentOperateCATID:v8];
  v32 = *MEMORY[0x277D85DE8];

  return v8;
}

- (BOOL)hasSharedUser
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [(HMDHome *)self users];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * i);
        if ([v7 privilege] == 4 || !objc_msgSend(v7, "privilege"))
        {
          v8 = 1;
          goto LABEL_13;
        }
      }

      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
      v8 = 0;
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  else
  {
    v8 = 0;
  }

LABEL_13:

  v9 = *MEMORY[0x277D85DE8];
  return v8;
}

- (void)updateCATIDsForUsersIfNeeded:(BOOL)a3 completion:(id)a4
{
  if (a4)
  {
    (*(a4 + 2))(a4, 0);
  }
}

- (BOOL)_doesUsersHaveCATID
{
  v18 = *MEMORY[0x277D85DE8];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v2 = [(HMDHome *)self users];
  v3 = [v2 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v14;
LABEL_3:
    v6 = 0;
    while (1)
    {
      if (*v14 != v5)
      {
        objc_enumerationMutation(v2);
      }

      v7 = *(*(&v13 + 1) + 8 * v6);
      v8 = [v7 matterCASEAuthenticatedTagID];
      if (!v8)
      {
        break;
      }

      v9 = [v7 matterCASEAuthenticatedTagID];
      v10 = [v9 intValue];

      if (!v10)
      {
        LOBYTE(v8) = 0;
        break;
      }

      if (v4 == ++v6)
      {
        v4 = [v2 countByEnumeratingWithState:&v13 objects:v17 count:16];
        LOBYTE(v8) = 1;
        if (v4)
        {
          goto LABEL_3;
        }

        break;
      }
    }
  }

  else
  {
    LOBYTE(v8) = 1;
  }

  v11 = *MEMORY[0x277D85DE8];
  return v8;
}

- (void)_clearCHIPStorageWithCompletion:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self chipStorage];
  v6 = [v5 keyValueStore];
  v7 = [v6 count];

  if (v7)
  {
    v8 = [HMDCHIPHomeDataSource alloc];
    v9 = [(HMDHome *)self matterFabricID];
    v10 = [(HMDCHIPHomeDataSource *)v8 initWithFabricID:v9 home:self];

    v11[0] = MEMORY[0x277D85DD0];
    v11[1] = 3221225472;
    v11[2] = __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke;
    v11[3] = &unk_279733F30;
    v11[4] = self;
    v12 = v4;
    [(HMDCHIPHomeDataSource *)v10 updateKeyValueStore:MEMORY[0x277CBEC10] completion:v11];
  }

  else
  {
    (*(v4 + 2))(v4, 0);
  }
}

void __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke_2;
  v7[3] = &unk_279735738;
  v5 = *(a1 + 40);
  v8 = v3;
  v9 = v5;
  v6 = v3;
  dispatch_async(v4, v7);
}

- (void)_handleResetMatterStorageRequest:(id)a3
{
  v81 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CD0538]];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v78 = v9;
    v79 = 2112;
    v80 = v5;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Handling request to reset Matter storage with corruption option: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  if ([(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0530]])
  {
    v10 = [HMDCHIPHomeDataSource alloc];
    v11 = [(HMDHome *)v7 matterFabricID];
    v12 = [(HMDCHIPHomeDataSource *)v10 initWithFabricID:v11 home:v7];

    v13 = objc_alloc_init(MEMORY[0x277D17AF8]);
    v14 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:v12 keychainDelegate:v13];
    v15 = [v14 newFabricData];
    if (v15)
    {
      v16 = objc_alloc_init(MEMORY[0x277D17B40]);
      v17 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:v15 chipStorageDelegate:v12 keychainDelegate:v13 v2FabricDataStoreDelegate:v16];
      v72 = v5;
      if ([v17 commit])
      {
        if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
        {
          v18 = [(HMDHome *)v7 fabric];
          [v18 invalidateCachedData];
        }

        v19 = objc_autoreleasePoolPush();
        v20 = v7;
        v21 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v22 = v69 = v4;
          *buf = 138543362;
          v78 = v22;
          _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Stored bad fabric data into CHIP storage", buf, 0xCu);

          v4 = v69;
        }

        objc_autoreleasePoolPop(v19);
        v76 = 0;
        [(HMDHome *)v20 setUpOperationalFabricDataWithError:&v76];
        v23 = v76;
        [v4 respondWithSuccess];
      }

      else
      {
        v47 = objc_autoreleasePoolPush();
        v48 = v7;
        v49 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v49, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v50 = v71 = v4;
          *buf = 138543362;
          v78 = v50;
          _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_ERROR, "%{public}@Failed to store bad fabric data", buf, 0xCu);

          v4 = v71;
        }

        objc_autoreleasePoolPop(v47);
        v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [v4 respondWithError:v23];
      }

      v5 = v72;
    }

    else
    {
      v43 = objc_autoreleasePoolPush();
      v44 = v7;
      v45 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
      {
        v46 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v46;
        _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate bad fabric data", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v43);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [v4 respondWithError:v16];
    }
  }

  else
  {
    if ([(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0528]])
    {
      v12 = [v4 numberForKey:*MEMORY[0x277CD0540]];
      if (v12)
      {
        v73 = v5;
        v13 = objc_alloc_init(MEMORY[0x277D17B08]);
        v24 = objc_alloc_init(MEMORY[0x277D17AF8]);
        v25 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:v13 keychainDelegate:v24];
        v26 = [v25 newFabricData];
        if (v26)
        {
          v70 = v24;
          v27 = v4;
          v28 = [HMDCHIPHomeKeychainFabricData alloc];
          v29 = [(HMDHome *)v7 uuid];
          v30 = [(HMDHome *)v7 iCloudIdentifier];
          v31 = [(HMDCHIPHomeKeychainFabricData *)v28 initWithHomeUUID:v29 iCloudIdentifier:v30];

          LOBYTE(v28) = [(HMDCHIPHomeKeychainFabricData *)v31 storeFabricData:v26 dataVersion:v12];
          context = objc_autoreleasePoolPush();
          v32 = v7;
          v33 = HMFGetOSLogHandle();
          v34 = v33;
          if (v28)
          {
            v4 = v27;
            if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
            {
              v35 = HMFGetLogIdentifier();
              *buf = 138543618;
              v78 = v35;
              v79 = 2112;
              v80 = v12;
              _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_INFO, "%{public}@Stored additional V2 fabric data item to keychain with data version: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(context);
            [v27 respondWithSuccess];
          }

          else
          {
            v4 = v27;
            if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
            {
              v64 = HMFGetLogIdentifier();
              *buf = 138543362;
              v78 = v64;
              _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Failed to store additional fabric data", buf, 0xCu);
            }

            objc_autoreleasePoolPop(context);
            v65 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
            [v27 respondWithError:v65];
          }

          v24 = v70;
        }

        else
        {
          v60 = objc_autoreleasePoolPush();
          v61 = v7;
          v62 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v62, OS_LOG_TYPE_ERROR))
          {
            v63 = HMFGetLogIdentifier();
            *buf = 138543362;
            v78 = v63;
            _os_log_impl(&dword_2531F8000, v62, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate additional fabric data", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v60);
          v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          [v4 respondWithError:v31];
        }

        v5 = v73;
      }

      else
      {
        v52 = objc_autoreleasePoolPush();
        v53 = v7;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_ERROR))
        {
          v55 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v55;
          _os_log_impl(&dword_2531F8000, v54, OS_LOG_TYPE_ERROR, "%{public}@Data version is missing for additional V2 key request", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v52);
        v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        [v4 respondWithError:v13];
      }

      goto LABEL_34;
    }

    if (![(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0520]])
    {
      v74[0] = MEMORY[0x277D85DD0];
      v74[1] = 3221225472;
      v74[2] = __50__HMDHome_CHIP___handleResetMatterStorageRequest___block_invoke;
      v74[3] = &unk_2797358C8;
      v74[4] = v7;
      v75 = v4;
      [(HMDHome *)v7 _clearCHIPStorageWithCompletion:v74];

      goto LABEL_35;
    }

    v12 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
    v36 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
    v13 = v36;
    if (v12 && v36)
    {
      v14 = objc_alloc_init(MEMORY[0x277D17B00]);
      v37 = [v14 forceUpdateNocSigner:v12 ownerSharedOperationalKeyPair:v13];
      v38 = objc_autoreleasePoolPush();
      v39 = v7;
      v40 = HMFGetOSLogHandle();
      v41 = v40;
      if (v37)
      {
        if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v42;
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Stored new V0 keys to keychain", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v38);
        [v4 respondWithSuccess];
      }

      else
      {
        if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
        {
          v66 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v66;
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_ERROR, "%{public}@Failed to write new V0 keys", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v38);
        v67 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [v4 respondWithError:v67];
      }
    }

    else
    {
      v56 = objc_autoreleasePoolPush();
      v57 = v7;
      v58 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v59 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v59;
        _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_ERROR, "%{public}@Failed to create new V0 keys", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v56);
      v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [v4 respondWithError:v14];
    }
  }

LABEL_34:
LABEL_35:

  v51 = *MEMORY[0x277D85DE8];
}

void __50__HMDHome_CHIP___handleResetMatterStorageRequest___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543618;
      v18 = v7;
      v19 = 2112;
      v20 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to clear CHIP storage: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 40) respondWithError:v3];
  }

  else
  {
    if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
    {
      v8 = [*(a1 + 32) fabric];
      [v8 invalidateCachedData];
    }

    v9 = *(a1 + 32);
    v16 = 0;
    [v9 setUpOperationalFabricDataWithError:&v16];
    v10 = v16;
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Cleared and left CHIP storage as empty", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    [*(a1 + 40) respondWithSuccess];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)handleMatterPairingCompletionNotification:(id)a3
{
  v37 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 numberForKey:@"HMDHomePairingCompletionNodeIDMessageKey"];
  v6 = [v4 numberForKey:@"HMDHomePairingCompletionFabricIDMessageKey"];
  v7 = [v4 numberForKey:@"HMDHomePairingCompletionVendorIDMessageKey"];
  v8 = [v4 numberForKey:@"HMDHomePairingCompletionProductIDMessageKey"];
  v9 = [v4 numberForKey:@"HMDHomePairingCompletionConfigNumberMessageKey"];
  v10 = [v4 numberForKey:@"HMDHomePairingCompletionCategoryMessageKey"];
  v11 = [v4 dataForKey:@"HMDHomePairingCompletionTopologyMessageKey"];
  v12 = v11;
  if (v5 && v6)
  {
    v29 = [(HMDHome *)self homeManager];
    v27 = [v29 accessoryBrowserInternal];
    [v27 chipAccessoryServerBrowser];
    v13 = v5;
    v14 = v6;
    v15 = v10;
    v16 = v9;
    v17 = v8;
    v19 = v18 = v7;
    v20 = [(HMDHome *)self targetFabricUUID];
    [v19 handlePairingCompletionForAccessoryWithNodeID:v13 targetFabricUUID:v20 fabricID:v14 vendorID:v18 productID:v17 configNumber:v16 category:v15 topology:v12];

    v7 = v18;
    v8 = v17;
    v9 = v16;
    v10 = v15;
    v6 = v14;
    v5 = v13;

    [v4 respondWithSuccess];
  }

  else
  {
    v30 = v11;
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v24 = v28 = v21;
      *buf = 138543874;
      v32 = v24;
      v33 = 2112;
      v34 = v5;
      v35 = 2112;
      v36 = v6;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Resident cannot establish connection with accessory with accessory node ID = %@, fabric ID = %@", buf, 0x20u);

      v21 = v28;
    }

    objc_autoreleasePoolPop(v21);
    v25 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
    [v4 respondWithError:v25];

    v12 = v30;
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)completePotentialFabricDataCreation
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v4 = [v3 count];

  if (v4)
  {
    v5 = [(HMDHome *)self potentialFabricDataCreationBlocks];
    [v5 removeObjectAtIndex:0];
  }

  v6 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v7 = [v6 count];

  if (v7)
  {
    v8 = [(HMDHome *)self potentialFabricDataCreationBlocks];
    v9 = [v8 objectAtIndexedSubscript:0];

    os_unfair_recursive_lock_unlock();
    if (v9)
    {
      v9[2]();
    }
  }

  else
  {

    os_unfair_recursive_lock_unlock();
  }
}

- (void)runPotentialFabricDataCreationBlock:(id)a3
{
  aBlock = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v5 = [v4 count];

  v6 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v7 = _Block_copy(aBlock);
  [v6 addObject:v7];

  os_unfair_recursive_lock_unlock();
  if (!v5)
  {
    aBlock[2]();
  }
}

- (void)exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:(id)a3 commissioneeNodeID:(id)a4 fabricID:(id)a5 publicKey:(id)a6 sender:(id)a7 completion:(id)a8
{
  v71 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  if (![(HMDHome *)self isOwnerUser])
  {
    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_17;
    }

    v27 = HMFGetLogIdentifier();
    *buf = 138543362;
    v66 = v27;
    v29 = "%{public}@Non-owner user cannot handle request to generate certificates";
    v30 = v26;
    v31 = 12;
LABEL_15:
    _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_ERROR, v29, buf, v31);
LABEL_16:

    goto LABEL_17;
  }

  if (!v17)
  {
    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_17;
    }

    v27 = HMFGetLogIdentifier();
    *buf = 138543618;
    v66 = v27;
    v67 = 2112;
    v68 = 0;
    v29 = "%{public}@Cannot handle remote request to retrieve certificates with public Key: %@";
    v30 = v26;
    v31 = 22;
    goto LABEL_15;
  }

  if (!isFeatureMatterLocalFabricConfigEnabled())
  {
    if (([v16 isEqual:&unk_2866276B8] & 1) == 0)
    {
      if (v16)
      {
        v20 = [(HMDHome *)self chipStorage];
        v44 = [v20 fabricID];
        if (!v44)
        {
          goto LABEL_21;
        }

        v22 = v44;
        v55 = [(HMDHome *)self chipStorage];
        v23 = [v55 fabricID];
        if ([v23 isEqual:&unk_2866276B8])
        {
LABEL_36:

          goto LABEL_21;
        }

        v51 = [(HMDHome *)self chipStorage];
        v49 = [v51 fabricID];
        v54 = [v16 isEqual:v49];

        if ((v54 & 1) == 0)
        {
          v24 = objc_autoreleasePoolPush();
          v25 = self;
          v26 = HMFGetOSLogHandle();
          if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_17;
          }

          v27 = HMFGetLogIdentifier();
          v53 = [(HMDHome *)v25 chipStorage];
          v56 = v24;
          v28 = [v53 fabricID];
          *buf = 138543874;
          v66 = v27;
          v67 = 2112;
          v68 = v16;
          v69 = 2112;
          v70 = v28;
          goto LABEL_46;
        }
      }

LABEL_22:
      if ([v14 isEqualToNumber:&unk_2866276B8])
      {

        v14 = 0;
      }

      if (v15 && !v16)
      {
        v34 = objc_autoreleasePoolPush();
        v35 = self;
        v36 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
LABEL_29:

          objc_autoreleasePoolPop(v34);
          v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          (*(v19 + 2))(v19, 0, 0, 0, 0, v16);
          goto LABEL_18;
        }

        v37 = HMFGetLogIdentifier();
        *buf = 138543874;
        v66 = v37;
        v67 = 2112;
        v68 = v15;
        v69 = 2112;
        v70 = 0;
        v38 = "%{public}@Cannot handle remote request to retrieve certificates with device Node ID %@ and fabricID %@";
        v39 = v36;
        v40 = 32;
LABEL_28:
        _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_ERROR, v38, buf, v40);

        goto LABEL_29;
      }

      if (isFeatureMatterLocalFabricConfigEnabled())
      {
        v41 = [(HMDHome *)self fabric];
        v42 = [v41 fabricID];

        v43 = [v18 isOwner];
        if (v42)
        {
          goto LABEL_42;
        }
      }

      else
      {
        v45 = [(HMDHome *)self chipStorage];
        v42 = [v45 fabricID];

        v43 = 0;
        if (v42)
        {
          goto LABEL_42;
        }
      }

      if (![(HMDHome *)self isCurrentDevicePrimaryResident]&& [(HMDHome *)self doesHomeContainResident])
      {
        v34 = objc_autoreleasePoolPush();
        v35 = self;
        v36 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_29;
        }

        v37 = HMFGetLogIdentifier();
        *buf = 138543362;
        v66 = v37;
        v38 = "%{public}@Failing commissioning cert because operational cert creation is not allowed in this device while there is a resident in Home";
        v39 = v36;
        v40 = 12;
        goto LABEL_28;
      }

LABEL_42:
      v46 = [(HMDHome *)self homeManager];
      v57[0] = MEMORY[0x277D85DD0];
      v57[1] = 3221225472;
      v57[2] = __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke;
      v57[3] = &unk_279721C10;
      v57[4] = self;
      v58 = v42;
      v63 = v19;
      v59 = v46;
      v14 = v14;
      v60 = v14;
      v61 = v15;
      v64 = v43;
      v62 = v17;
      v47 = v46;
      v16 = v42;
      [(HMDHome *)self updateCATIDsForUsersIfNeeded:1 completion:v57];

      goto LABEL_18;
    }

LABEL_20:
    v20 = v16;
    v16 = 0;
LABEL_21:

    goto LABEL_22;
  }

  if ([v16 isEqualToNumber:&unk_2866276B8])
  {
    goto LABEL_20;
  }

  if (!v16)
  {
    goto LABEL_22;
  }

  v20 = [(HMDHome *)self fabric];
  v21 = [v20 fabricID];
  if (!v21)
  {
    goto LABEL_21;
  }

  v22 = v21;
  v55 = [(HMDHome *)self fabric];
  v23 = [v55 fabricID];
  if ([v23 isEqual:&unk_2866276B8])
  {
    goto LABEL_36;
  }

  v50 = [(HMDHome *)self fabric];
  v48 = [v50 fabricID];
  v52 = [v16 isEqual:v48];

  if (v52)
  {
    goto LABEL_22;
  }

  v24 = objc_autoreleasePoolPush();
  v25 = self;
  v26 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
  {
    v27 = HMFGetLogIdentifier();
    v53 = [(HMDHome *)v25 fabric];
    v56 = v24;
    v28 = [v53 fabricID];
    *buf = 138543874;
    v66 = v27;
    v67 = 2112;
    v68 = v16;
    v69 = 2112;
    v70 = v28;
LABEL_46:
    _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle remote request to retrieve certificates for unknown fabricID %@. Current home fabric ID %@", buf, 0x20u);

    v24 = v56;
    goto LABEL_16;
  }

LABEL_17:

  objc_autoreleasePoolPop(v24);
  v32 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
  (*(v19 + 2))(v19, 0, 0, 0, 0, v32);

LABEL_18:
  v33 = *MEMORY[0x277D85DE8];
}

void __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke(uint64_t a1, void *a2)
{
  v48 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v43 = 0;
  v4 = *(a1 + 32);
  v42 = 0;
  v5 = [v4 storedFabricDataWithDataPresentInV2FabricDataStore:&v43 error:&v42];
  v6 = v42;
  v7 = v6;
  if (!v5)
  {
    v8 = [v6 underlyingErrors];
    if ([v8 na_any:&__block_literal_global_301])
    {
    }

    else
    {
      v30 = [v7 domain];
      if ([v30 isEqual:*MEMORY[0x277D0F1A0]])
      {
        v31 = [v7 code];

        if (v31 == 2)
        {
          goto LABEL_4;
        }
      }

      else
      {
      }

      v34 = *(a1 + 40);
      if (!v34 || ([v34 isEqual:&unk_2866276B8] & 1) != 0 || (objc_msgSend(v7, "underlyingErrors"), v35 = objc_claimAutoreleasedReturnValue(), v36 = objc_msgSend(v35, "na_any:", &__block_literal_global_303), v35, (v36 & 1) == 0))
      {
        v37 = objc_autoreleasePoolPush();
        v38 = *(a1 + 32);
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_DEFAULT))
        {
          v40 = HMFGetLogIdentifier();
          *buf = 138543618;
          v45 = v40;
          v46 = 2112;
          v47 = v7;
          _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot handle commissioning cert request due to fabric data fetch error: %@", buf, 0x16u);
        }

        v33 = v37;
        goto LABEL_28;
      }
    }

LABEL_4:
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v12;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Creating new fabric data", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v5 = [*(a1 + 32) newFabricData];
    v13 = objc_autoreleasePoolPush();
    v14 = *(a1 + 32);
    v15 = HMFGetOSLogHandle();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);
    if (v5)
    {
      if (v16)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v17;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@New fabric data created and stored", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
      v43 = 1;
      v18 = [v5 fabricID];
      v19 = [*(a1 + 32) fabric];
      [v19 setFabricID:v18];

      v20 = [v5 fabricID];
      v21 = [*(a1 + 32) chipStorage];
      [v21 setFabricID:v20];

      goto LABEL_10;
    }

    if (v16)
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v32;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to create new fabric data when handling commissioning cert request", buf, 0xCu);
    }

    v33 = v13;
LABEL_28:
    objc_autoreleasePoolPop(v33);
    (*(*(a1 + 80) + 16))();
    goto LABEL_29;
  }

LABEL_10:
  if ((v43 & 1) == 0)
  {
    v22 = objc_autoreleasePoolPush();
    v23 = *(a1 + 32);
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v25;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Migrating fabric data to V2 fabric data store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v22);
    [*(a1 + 32) storeNewFabricData:v5];
  }

  v26 = [*(a1 + 32) accessoryAdministerPrivilegeCATID:0];
  v27 = [*(a1 + 32) accessoryOperatePrivilegeCATID:0];
  v28 = [*(a1 + 48) accessoryBrowser];
  v29 = [v28 chipAccessoryServerBrowser];
  [v29 fetchCertificatesForMatterNodeWithCommissionerNodeID:*(a1 + 56) commissioneeNodeID:*(a1 + 64) forOwner:*(a1 + 88) publicKey:*(a1 + 72) fabricData:v5 adminCAT:v26 opCAT:v27 completionHandler:*(a1 + 80)];

LABEL_29:
  v41 = *MEMORY[0x277D85DE8];
}

BOOL __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_3(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 domain];
  if ([v3 isEqual:*MEMORY[0x277D17A00]])
  {
    v4 = [v2 code] == 1;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

BOOL __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 domain];
  if ([v3 isEqual:*MEMORY[0x277D17A00]])
  {
    v4 = [v2 code] == 2;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)handleCommissioningCertificateRequestWithCommissionerNodeID:(id)a3 commissioneeNodeID:(id)a4 fabricID:(id)a5 publicKey:(id)a6 sender:(id)a7 completion:(id)a8
{
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  objc_initWeak(&location, self);
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke;
  v26[3] = &unk_279723038;
  objc_copyWeak(&v33, &location);
  v20 = v14;
  v27 = v20;
  v21 = v15;
  v28 = v21;
  v22 = v16;
  v29 = v22;
  v23 = v17;
  v30 = v23;
  v24 = v18;
  v31 = v24;
  v25 = v19;
  v32 = v25;
  [(HMDHome *)self runPotentialFabricDataCreationBlock:v26];

  objc_destroyWeak(&v33);
  objc_destroyWeak(&location);
}

void __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v3 = *(a1 + 32);
  v4 = *(a1 + 40);
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v7 = *(a1 + 64);
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2;
  v8[3] = &unk_279721BC8;
  objc_copyWeak(&v10, (a1 + 80));
  v9 = *(a1 + 72);
  [WeakRetained exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:v3 commissioneeNodeID:v4 fabricID:v5 publicKey:v6 sender:v7 completion:v8];

  objc_destroyWeak(&v10);
}

void __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2(uint64_t a1, void *a2, void *a3, void *a4, void *a5, void *a6)
{
  v11 = a6;
  v12 = a5;
  v13 = a4;
  v14 = a3;
  v15 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  (*(*(a1 + 32) + 16))();

  [WeakRetained completePotentialFabricDataCreation];
}

- (void)handleCommissioningCertificateRequest:(id)a3
{
  v4 = a3;
  v5 = [v4 numberForKey:@"HMDHomeCommissioningDeviceNodeIDMessageKey"];
  v6 = [v4 numberForKey:@"HMDHomeCommissioningFabricIDMessageKey"];
  v7 = [v4 dataForKey:@"HMDHomeCommissioningPublicKeyMessageKey"];
  v8 = [v4 userForHome:self];
  if (!isFeatureMatterLocalFabricConfigEnabled())
  {
    goto LABEL_4;
  }

  v9 = [v4 numberForKey:@"HMDHomeCommissioningCommissionerNodeIDMessageKey"];
  if ([v9 isEqualToNumber:&unk_2866276B8])
  {

LABEL_4:
    v9 = 0;
  }

  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __55__HMDHome_CHIP__handleCommissioningCertificateRequest___block_invoke;
  v11[3] = &unk_279721BA0;
  v12 = v4;
  v10 = v4;
  [(HMDHome *)self handleCommissioningCertificateRequestWithCommissionerNodeID:v9 commissioneeNodeID:v5 fabricID:v6 publicKey:v7 sender:v8 completion:v11];
}

void __55__HMDHome_CHIP__handleCommissioningCertificateRequest___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, uint64_t a6)
{
  v15 = a2;
  v11 = a3;
  v12 = a4;
  v13 = a5;
  if (a6)
  {
    [*(a1 + 32) respondWithError:a6];
  }

  else
  {
    v14 = [MEMORY[0x277CBEB38] dictionary];
    [v14 setObject:v15 forKeyedSubscript:@"HMDHomeCommissioningRootCertMessageKey"];
    [v14 setObject:v11 forKeyedSubscript:@"HMDHomeCommissioningOperationalCertMessageKey"];
    [v14 setObject:v12 forKeyedSubscript:@"HMDHomeCommissioningOwnerNodeIDMessageKey"];
    [v14 setObject:v13 forKeyedSubscript:@"HMDHomeCommissioningIPKMessageKey"];
    [*(a1 + 32) respondWithPayload:v14];
  }
}

- (void)_dispatchCHIPReport:(id)a3 destination:(id)a4
{
  v35 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [HMDDeviceHandle deviceHandleForDestination:v7];
  v9 = +[HMDAccountRegistry sharedRegistry];
  v10 = [v9 deviceForHandle:v8];

  v11 = [v10 account];

  if (v11)
  {
    if (![v10 isCurrentDevice])
    {
      objc_initWeak(buf, self);
      v20 = [(HMDHome *)self homeManager];
      v21 = [v6 copy];
      v22 = [(HMDHome *)self uuid];
      v23 = [(HMDHome *)self workQueue];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __49__HMDHome_CHIP___dispatchCHIPReport_destination___block_invoke;
      v25[3] = &unk_279735248;
      objc_copyWeak(&v28, buf);
      v26 = v6;
      v27 = v7;
      [v20 sendSecureMessage:v21 target:v22 userID:v27 destination:v27 responseQueue:v23 responseHandler:v25];

      objc_destroyWeak(&v28);
      objc_destroyWeak(buf);
      goto LABEL_10;
    }

    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v30 = v15;
      v31 = 2112;
      v32 = v7;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Skipping device %@ - ourselves", buf, 0x16u);
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [v10 shortDescription];
      *buf = 138543874;
      v30 = v18;
      v31 = 2112;
      v32 = v19;
      v33 = 2112;
      v34 = v7;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Device %@ for CHIP report destination %@ has no user attached to it. Destination removed.", buf, 0x20u);
    }
  }

  objc_autoreleasePoolPop(v12);
  v16 = [(HMDHome *)v13 notificationRegistry];
  v17 = [v16 chipRemoteSubscribers];
  [v17 removeObject:v7];

LABEL_10:
  v24 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome_CHIP___dispatchCHIPReport_destination___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v23 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
    if (v5)
    {
      if (v11)
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 40);
        v17 = 138543874;
        v18 = v12;
        v19 = 2112;
        v20 = v13;
        v21 = 2112;
        v22 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Failed to send CHIP report to user %@ due to error %@", &v17, 0x20u);
LABEL_7:
      }
    }

    else if (v11)
    {
      v12 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) messagePayload];
      v15 = *(a1 + 40);
      v17 = 138543874;
      v18 = v12;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = v15;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Sent CHIP report: %@ to user %@", &v17, 0x20u);

      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleCHIPSendRemoteRequestMessage:(id)a3
{
  v60 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v48 = [v4 numberForKey:@"HMDHomeCHIPNodeIDMessageKey"];
  if (v48)
  {
    v46 = v4;
    v51 = 0u;
    v52 = 0u;
    v49 = 0u;
    v50 = 0u;
    v5 = [(HMDHome *)self matterAccessories];
    v6 = [v5 countByEnumeratingWithState:&v49 objects:v59 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v50;
      while (2)
      {
        v9 = 0;
        v47 = v7;
        do
        {
          if (*v50 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = *(*(&v49 + 1) + 8 * v9);
          v11 = objc_autoreleasePoolPush();
          v12 = self;
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
          {
            HMFGetLogIdentifier();
            v14 = v8;
            v15 = self;
            v17 = v16 = v5;
            v18 = [v10 matterNodeID];
            *buf = 138543874;
            v54 = v17;
            v55 = 2112;
            v56 = v18;
            v57 = 2112;
            v58 = v48;
            _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Remote request dispatch compares %@ with %@", buf, 0x20u);

            v5 = v16;
            self = v15;
            v8 = v14;
            v7 = v47;
          }

          objc_autoreleasePoolPop(v11);
          v19 = [v10 matterNodeID];
          if ([v19 isEqual:&unk_2866276B8])
          {
          }

          else
          {
            v20 = [v10 matterNodeID];
            v21 = [v20 isEqualToNumber:v48];

            if (v21)
            {
              v32 = objc_autoreleasePoolPush();
              v33 = v12;
              v34 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v34, OS_LOG_TYPE_DEBUG))
              {
                v35 = HMFGetLogIdentifier();
                v36 = [v10 identifier];
                *buf = 138543618;
                v54 = v35;
                v55 = 2112;
                v56 = v36;
                _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_DEBUG, "%{public}@Dispatching remote request to accessory %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v32);
              v4 = v46;
              v37 = [v46 dictionaryForKey:@"HMDHomeCHIPRequestMessageKey"];
              v38 = [v37 CHIPRemoteCommand];
              v39 = [v38 isEqualToString:*MEMORY[0x277D17C88]];

              if (v39)
              {
                v40 = objc_autoreleasePoolPush();
                v41 = v33;
                v42 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
                {
                  v43 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v54 = v43;
                  v55 = 2112;
                  v56 = v46;
                  _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_ERROR, "%{public}@Rejecting CHIP remote request as subscription using this interface is not supported: %@", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v40);
                v44 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
                [v46 respondWithError:v44];
              }

              else
              {
                [v10 handleCHIPSendRemoteRequestMessage:v46];
              }

              goto LABEL_29;
            }
          }

          ++v9;
        }

        while (v7 != v9);
        v7 = [v5 countByEnumeratingWithState:&v49 objects:v59 count:16];
        if (v7)
        {
          continue;
        }

        break;
      }
    }

    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    v4 = v46;
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543618;
      v54 = v25;
      v55 = 2112;
      v56 = v46;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory for CHIP remote request: %@", buf, 0x16u);
    }

    v26 = v22;
  }

  else
  {
    v27 = objc_autoreleasePoolPush();
    v28 = self;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      v30 = HMFGetLogIdentifier();
      v31 = [v4 messagePayload];
      *buf = 138543618;
      v54 = v30;
      v55 = 2112;
      v56 = v31;
      _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Cannot find node ID in CHIP remote request message payload: %@", buf, 0x16u);
    }

    v26 = v27;
  }

  objc_autoreleasePoolPop(v26);
  v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
  [v4 respondWithError:v5];
LABEL_29:

  v45 = *MEMORY[0x277D85DE8];
}

- (void)_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)a3
{
  v31 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v5)
  {
    v6 = [(HMDHome *)self matterAccessories];
    v25[0] = MEMORY[0x277D85DD0];
    v25[1] = 3221225472;
    v25[2] = __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke;
    v25[3] = &unk_27972B940;
    v7 = v5;
    v26 = v7;
    v8 = [v6 na_firstObjectPassingTest:v25];

    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    v12 = v11;
    if (v8)
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v13;
        v29 = 2112;
        v30 = v8;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Resetting and removing all CHIP pairings from accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke_296;
      v23[3] = &unk_2797358C8;
      v23[4] = v10;
      v24 = v4;
      [v8 removeAllCHIPPairingsWithCompletion:v23];
    }

    else
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v20;
        v29 = 2112;
        v30 = v7;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory with UUID %@ for reset and remove all CHIP pairings message", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v21];
    }

    v19 = v26;
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v4 messagePayload];
      *buf = 138543618;
      v28 = v17;
      v29 = 2112;
      v30 = v18;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory UUID in reset and remove all CHIP pairings message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v19];
  }

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

void __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke_296(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Ignoring remove all CHIP pairings error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  [*(a1 + 32) handleRemoveAccessoryMessage:*(a1 + 40)];

  v8 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldFallbackLocallyForRemoteMatterRequest:(id)a3
{
  v3 = a3;
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    v4 = [v3 code];
    v5 = 1;
    if (v4 > 8 || ((1 << v4) & 0x11C) == 0)
    {
      v5 = v4 == 3201;
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (void)_sendRemoteMessageUsingNodeId:(unint64_t)a3 payload:(id)a4 completion:(id)a5
{
  v32[2] = *MEMORY[0x277D85DE8];
  v8 = a4;
  v9 = a5;
  v10 = objc_alloc(MEMORY[0x277D0F820]);
  v11 = [(HMDHome *)self uuid];
  v12 = [v10 initWithTarget:v11];

  v31[0] = @"HMDHomeCHIPNodeIDMessageKey";
  v13 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:a3];
  v31[1] = @"HMDHomeCHIPRequestMessageKey";
  v32[0] = v13;
  v32[1] = v8;
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v32 forKeys:v31 count:2];

  v15 = [MEMORY[0x277D0F848] messageWithName:@"HMDHomeCHIPSendRemoteRequestMessage" destination:v12 payload:v14];
  v16 = [v8 CHIPRemoteMessageTimeout];

  if (v16)
  {
    v17 = [v8 CHIPRemoteMessageTimeout];
    [v17 doubleValue];
    [v15 setTimeout:?];
  }

  v22 = MEMORY[0x277D85DD0];
  v23 = 3221225472;
  v24 = __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke;
  v25 = &unk_279721B78;
  v29 = v9;
  v30 = a3;
  v26 = self;
  v27 = v12;
  v28 = v14;
  v18 = v14;
  v19 = v12;
  v20 = v9;
  [v15 setResponseHandler:&v22];
  [(HMDHome *)self handleCHIPSendRemoteRequestMessage:v15, v22, v23, v24, v25, v26];

  v21 = *MEMORY[0x277D85DE8];
}

void __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    if ([*(a1 + 32) _shouldFallbackLocallyForRemoteMatterRequest:v5])
    {
      v7 = [MEMORY[0x277D0F848] messageWithName:@"HMDHomeCHIPSendRemoteRequestMessage" destination:*(a1 + 40) payload:*(a1 + 48)];
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke_294;
      v23[3] = &unk_279721B50;
      v9 = *(a1 + 56);
      v8 = *(a1 + 64);
      v23[4] = *(a1 + 32);
      v25 = v8;
      v24 = v9;
      [v7 setResponseHandler:v23];
      [*(a1 + 32) _handleCHIPSendRemoteRequestMessage:v7];
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = *(a1 + 32);
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v19 = HMFGetLogIdentifier();
        v20 = *(a1 + 64);
        *buf = 138543874;
        v27 = v19;
        v28 = 2048;
        v29 = v20;
        v30 = 2112;
        v31 = v5;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute CHIP remote operation for nodeID=%llu: error=%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v16);
      v21 = *(a1 + 56);
      v7 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
      (*(v21 + 16))(v21, v7, v5);
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 32);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 64);
      *buf = 138543618;
      v27 = v13;
      v28 = 2048;
      v29 = v14;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Successfully executed CHIP remote operation for nodeID=%llu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v15 = *(a1 + 56);
    v7 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
    (*(v15 + 16))(v15, v7, 0);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke_294(uint64_t a1, void *a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v5)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = *(a1 + 48);
      v21 = 138543874;
      v22 = v11;
      v23 = 2048;
      v24 = v12;
      v25 = 2112;
      v26 = v5;
      v13 = "%{public}@Failed to execute CHIP local fallback operation for nodeID=%llu: error=%@";
      v14 = v10;
      v15 = OS_LOG_TYPE_ERROR;
      v16 = 32;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v14, v15, v13, &v21, v16);
    }
  }

  else if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v17 = *(a1 + 48);
    v21 = 138543618;
    v22 = v11;
    v23 = 2048;
    v24 = v17;
    v13 = "%{public}@Successfully executed CHIP local fallback operation for nodeID=%llu";
    v14 = v10;
    v15 = OS_LOG_TYPE_INFO;
    v16 = 22;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v7);
  v18 = *(a1 + 40);
  v19 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
  (*(v18 + 16))(v18, v19, v5);

  v20 = *MEMORY[0x277D85DE8];
}

- (unint64_t)numMatterV2Keys
{
  v3 = [HMDCHIPHomeKeychainFabricData alloc];
  v4 = [(HMDHome *)self uuid];
  v5 = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPHomeKeychainFabricData *)v3 initWithHomeUUID:v4 iCloudIdentifier:v5];

  v7 = [(HMDCHIPHomeKeychainFabricData *)v6 fabricDataItems];
  v8 = [v7 count];

  return v8;
}

- (void)retrieveOperationalCertificatesForFabricID:(id)a3 commissioneeNodeID:(id)a4 publicKey:(id)a5 completion:(id)a6
{
  v10 = a6;
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __100__HMDHome_CHIP__retrieveOperationalCertificatesForFabricID_commissioneeNodeID_publicKey_completion___block_invoke;
  v12[3] = &unk_279721B28;
  v13 = v10;
  v11 = v10;
  [(HMDHome *)self retrieveOperationalCertificatesForFabricID:a3 commissionerNodeID:0 commissioneeNodeID:a4 publicKey:a5 completion:v12];
}

- (void)fetchOperationalCertificatesForNewFabricWithFabricID:(id)a3 publicKey:(id)a4 fetchFromResident:(BOOL)a5 completion:(id)a6
{
  v24 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a6;
  if (a5)
  {
    [(HMDHome *)self retrieveOperationalCertificatesForFabricID:v10 commissionerNodeID:0 commissioneeNodeID:0 publicKey:v11 completion:v12];
  }

  else
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      v13 = [(HMDHome *)self currentUser];
      [(HMDHome *)self handleCommissioningCertificateRequestWithCommissionerNodeID:0 commissioneeNodeID:0 fabricID:v10 publicKey:v11 sender:v13 completion:v12];
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      v15 = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        v18 = [(HMDHome *)v15 currentUser];
        v20 = 138543618;
        v21 = v17;
        v22 = 2112;
        v23 = v18;
        _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Current user %@ is not the owner. Therefore it must request NOC from the primary resident", &v20, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:10];
      (*(v12 + 2))(v12, 0, 0, 0, 0, v13);
    }
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)handleClearMatterControllerPrivateStorageRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __66__HMDHome_CHIP__handleClearMatterControllerPrivateStorageRequest___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __66__HMDHome_CHIP__handleClearMatterControllerPrivateStorageRequest___block_invoke(uint64_t a1)
{
  v11 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_ERROR))
  {
    v5 = HMFGetLogIdentifier();
    v9 = 138543362;
    v10 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_ERROR, "%{public}@Matter controller private storage is not available to clear", &v9, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = *(a1 + 40);
  v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
  [v6 respondWithError:v7];

  v8 = *MEMORY[0x277D85DE8];
}

- (void)handleResetMatterStorageRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) primaryResidentMessageRouter];
  v3 = v2;
  if (v2)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke_289;
    v12[3] = &unk_279733FD8;
    v4 = *(a1 + 40);
    v12[4] = *(a1 + 32);
    [v2 routeMessage:v4 localHandler:v12];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to handle request to reset Matter storage", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v9 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleCHIPSendReportMessage:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke(uint64_t a1)
{
  v46 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) isCurrentDevicePrimaryResident])
  {
    v2 = [*(a1 + 32) notificationRegistry];
    v3 = [v2 chipRemoteSubscribers];
    v4 = [v3 copy];

    v38 = 0u;
    v39 = 0u;
    v36 = 0u;
    v37 = 0u;
    v5 = v4;
    v6 = [v5 countByEnumeratingWithState:&v36 objects:v45 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v37;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v37 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = *(*(&v36 + 1) + 8 * i);
          v11 = objc_autoreleasePoolPush();
          v12 = *(a1 + 32);
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
          {
            v14 = HMFGetLogIdentifier();
            *buf = 138543618;
            v42 = v14;
            v43 = 2112;
            v44 = v10;
            _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Dispatch CHIP report to %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v11);
          [*(a1 + 32) _dispatchCHIPReport:*(a1 + 40) destination:v10];
        }

        v7 = [v5 countByEnumeratingWithState:&v36 objects:v45 count:16];
      }

      while (v7);
    }
  }

  v15 = [*(a1 + 40) numberForKey:@"HMDHomeCHIPNodeIDMessageKey"];
  v31 = [v15 unsignedIntegerValue];

  v16 = [*(a1 + 40) arrayForKey:@"HMDHomeCHIPReportMessageKey"];
  v17 = [v16 na_filter:&__block_literal_global_288];

  v34 = 0u;
  v35 = 0u;
  v32 = 0u;
  v33 = 0u;
  obj = [*(a1 + 32) chipLocalSubscribers];
  v18 = [obj countByEnumeratingWithState:&v32 objects:v40 count:16];
  if (v18)
  {
    v19 = v18;
    v20 = *v33;
    do
    {
      for (j = 0; j != v19; ++j)
      {
        if (*v33 != v20)
        {
          objc_enumerationMutation(obj);
        }

        v22 = *(*(&v32 + 1) + 8 * j);
        v23 = objc_autoreleasePoolPush();
        v24 = *(a1 + 32);
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
        {
          v26 = HMFGetLogIdentifier();
          *buf = 138543618;
          v42 = v26;
          v43 = 2112;
          v44 = v22;
          _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_DEBUG, "%{public}@Calling CHIP report handler for subscriber %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
        v27 = [*(a1 + 32) chipLocalSubscribers];
        v28 = [v27 objectForKeyedSubscript:v22];
        (v28)[2](v28, v31, v17);
      }

      v19 = [obj countByEnumeratingWithState:&v32 objects:v40 count:16];
    }

    while (v19);
  }

  [*(a1 + 40) respondWithSuccess];
  v29 = *MEMORY[0x277D85DE8];
}

uint64_t __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_285(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & (v2 != 0);
}

- (void)handleCHIPSendRemoteRequestMessage:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) primaryResidentMessageRouter];
  v3 = v2;
  if (v2)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke_284;
    v12[3] = &unk_279733FD8;
    v4 = *(a1 + 40);
    v12[4] = *(a1 + 32);
    [v2 routeMessage:v4 localHandler:v12];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to handle CHIP remote request", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v9 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self primaryResidentMessageRouter];
  v6 = v5;
  if (v5)
  {
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __73__HMDHome_CHIP__handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke;
    v13[3] = &unk_279733FD8;
    v13[4] = self;
    [v5 routeMessage:v4 localHandler:v13];
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v15 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to handle reset and remove all CHIP pairings message", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v11];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (BOOL)hasThreadCapableResident
{
  v2 = [(HMDHome *)self enabledResidents];
  v3 = [v2 na_any:&__block_literal_global_282];

  return v3;
}

uint64_t __41__HMDHome_CHIP__hasThreadCapableResident__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 capabilities];
  v3 = [v2 supportsThreadBorderRouter];

  return v3;
}

- (void)setUpSharedUserFabricDataWithForceFetch:(BOOL)a3 completion:(id)a4
{
  v13 = *MEMORY[0x277D85DE8];
  v5 = a4;
  if (![(HMDHome *)self isOwnerUser])
  {
    goto LABEL_5;
  }

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v11 = 138543362;
    v12 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Owner doesn't set up shared user fabric data", &v11, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  if (v5)
  {
LABEL_5:
    v5[2](v5, 0);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)prepareOperationalFabricData
{
  v17 = *MEMORY[0x277D85DE8];
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    v12 = 0;
    v3 = [(HMDHome *)self setUpOperationalFabricDataWithError:&v12];
    v4 = v12;
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
    if (v3)
    {
      if (v8)
      {
        v9 = HMFGetLogIdentifier();
        v10 = [(HMDHome *)v6 fabric];
        *buf = 138543618;
        v14 = v9;
        v15 = 2112;
        v16 = v10;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Successfully set up operational fabric data for fabric %@", buf, 0x16u);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v9;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Delay setting up operational fabric data, matter data source not yet configured", buf, 0xCu);
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v5);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)setUpOperationalFabricDataWithError:(id *)a3
{
  v44 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self fabricSetUpForPairing])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Operational fabric data set up is deferred till pairing is complete", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [MEMORY[0x277CCA9B8] hmfErrorWithCode:9];
    *a3 = v9 = 0;
  }

  else
  {
    v10 = [(HMDHome *)self fetchOperationalFabricDataWithError:a3];
    if (*a3)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v15 = *a3;
        *buf = 138543618;
        v41 = v14;
        v42 = 2112;
        v43 = v15;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to set up operational fabric data due to failure to fetch data with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
      if ([(HMDHome *)v12 retainFabricDataWhenLocallyUnavailable])
      {
        v16 = objc_autoreleasePoolPush();
        v17 = v12;
        v18 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
        {
          v19 = HMFGetLogIdentifier();
          *buf = 138543362;
          v41 = v19;
          _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Will keep using fabric data set up by pairing while fabric data isn't locally available", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v16);
      }

      else
      {
        [(HMDHome *)v12 clearAccessoryServerBrowserOperationalFabricData];
      }

      v20 = [*a3 copy];
      [(HMDHome *)v12 setOperationalFabricError:v20];
      v9 = 0;
    }

    else
    {
      [(HMDHome *)self setRetainFabricDataWhenLocallyUnavailable:0];
      if ([(HMDHome *)self isOwnerUser]&& ![(HMDHome *)self doesHomeContainResident])
      {
        v39 = 0;
        v20 = [(HMDHome *)self storedFabricDataWithError:&v39];
        v33 = v39;
        if (v33)
        {
          v34 = v33;
          v35 = objc_autoreleasePoolPush();
          v36 = self;
          v37 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
          {
            v38 = HMFGetLogIdentifier();
            *buf = 138543618;
            v41 = v38;
            v42 = 2112;
            v43 = v20;
            _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@Ignoring error %@ while fetching owner stored fabric data to set up operational fabric data", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v35);
        }
      }

      else
      {
        v20 = 0;
      }

      v21 = [(HMDHome *)self matterFabricID];
      if (!v21)
      {
        goto LABEL_17;
      }

      v22 = v21;
      v23 = [(HMDHome *)self matterFabricID];
      v24 = [v10 fabricID];
      v25 = [v23 isEqual:v24];

      if ((v25 & 1) == 0)
      {
LABEL_17:
        v26 = [v10 fabricID];
        v27 = [(HMDHome *)self fabric];
        [v27 setFabricID:v26];

        v28 = [v10 fabricID];
        v29 = [(HMDHome *)self chipStorage];
        [v29 setFabricID:v28];
      }

      v9 = [(HMDHome *)self setUpAccessoryServerBrowserWithOperationalFabricData:v10 ownerDataSnapshot:v20 error:a3];
      if (*a3)
      {
        v30 = [*a3 copy];
        [(HMDHome *)self setOperationalFabricError:v30];
      }

      else
      {
        [(HMDHome *)self setOperationalFabricError:0];
      }
    }
  }

  v31 = *MEMORY[0x277D85DE8];
  return v9;
}

- (void)unsetFabricForPairing
{
  v11 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setRetainFabricDataWhenLocallyUnavailable:[(HMDHome *)self fabricSetUpForPairing]];
  [(HMDHome *)self setFabricSetUpForPairing:0];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v10 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Attempting to set operational fabric data after pairing completion", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v8 = 0;
  [(HMDHome *)v4 setUpOperationalFabricDataWithError:&v8];
  v7 = *MEMORY[0x277D85DE8];
}

- (void)setUpFabricForPairingWithCompletion:(id)a3
{
  v4 = a3;
  [(HMDHome *)self setFabricSetUpForPairing:1];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_CHIP__setUpFabricForPairingWithCompletion___block_invoke;
  v6[3] = &unk_279721B00;
  v6[4] = self;
  v7 = v4;
  v5 = v4;
  [(HMDHome *)self fetchFabricDataForPairingWithCompletion:v6];
}

void __53__HMDHome_CHIP__setUpFabricForPairingWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v31 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = *(a1 + 32);
  if (v9)
  {
    [v10 setFabricSetUpForPairing:0];
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v14;
      v29 = 2112;
      v30 = v9;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch fabric data to set up fabric for pairing: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
  }

  else
  {
    v15 = [v10 matterFabricID];
    if (!v15)
    {
      goto LABEL_7;
    }

    v16 = v15;
    v17 = [*(a1 + 32) matterFabricID];
    v18 = [v7 fabricID];
    v19 = [v17 isEqual:v18];

    if ((v19 & 1) == 0)
    {
LABEL_7:
      v20 = [v7 fabricID];
      v21 = [*(a1 + 32) fabric];
      [v21 setFabricID:v20];

      v22 = [v7 fabricID];
      v23 = [*(a1 + 32) chipStorage];
      [v23 setFabricID:v22];
    }

    v24 = *(a1 + 32);
    v26 = 0;
    [v24 setUpAccessoryServerBrowserWithOperationalFabricData:v7 ownerDataSnapshot:v8 error:&v26];
    v9 = v26;
    if (v9)
    {
      [*(a1 + 32) setFabricSetUpForPairing:0];
    }
  }

  (*(*(a1 + 40) + 16))();

  v25 = *MEMORY[0x277D85DE8];
}

- (void)handleUserFabricKeyUpdate:(id)a3
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v14 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling user fabric key update", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [(HMDHome *)v6 homeManager];
  v10 = [v9 hasLoadedData];

  if ([(HMDHome *)v6 isCurrentDevicePrimaryResident]|| (isFeatureMatteriPhoneOnlyPairingControlEnabled() & v10) == 1)
  {
    v12 = 0;
    [(HMDHome *)v6 setUpOperationalFabricDataWithError:&v12];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleCATUpdate
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v14 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Handling CAT update", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v7 = [(HMDHome *)v4 homeManager];
  if ([(HMDHome *)v4 isOwnerUser])
  {
    if ([(HMDHome *)v4 isCurrentDevicePrimaryResident])
    {
      v8 = [v7 accessoryBrowser];
      v9 = [v8 chipAccessoryServerBrowser];
      v10 = [(HMDHome *)v4 fabric];
      [v9 updateAccessoryACLForFabric:v10];
    }

    else
    {
      v12 = 0;
      [(HMDHome *)v4 setUpOperationalFabricDataWithError:&v12];
    }
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)setCHIPReportHandlerWithSubscriber:(id)a3 handler:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __60__HMDHome_CHIP__setCHIPReportHandlerWithSubscriber_handler___block_invoke;
  block[3] = &unk_2797355D0;
  v12 = v6;
  v13 = v7;
  block[4] = self;
  v9 = v6;
  v10 = v7;
  dispatch_async(v8, block);
}

void __60__HMDHome_CHIP__setCHIPReportHandlerWithSubscriber_handler___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 48);
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 40);
      v16 = 138543618;
      v17 = v7;
      v18 = 2112;
      v19 = v8;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEBUG, "%{public}@Register CHIP report handler for subscriber %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v9 = [*(a1 + 32) chipLocalSubscribers];

    if (!v9)
    {
      v10 = objc_alloc_init(MEMORY[0x277CBEB38]);
      [*(a1 + 32) setChipLocalSubscribers:v10];
    }

    v11 = _Block_copy(*(a1 + 48));
    v12 = [*(a1 + 32) chipLocalSubscribers];
    [v12 setObject:v11 forKeyedSubscript:*(a1 + 40)];
  }

  else
  {
    if (v6)
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 40);
      v16 = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = v14;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEBUG, "%{public}@Deregister CHIP report handler for subscriber %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v11 = [*(a1 + 32) chipLocalSubscribers];
    [v11 setObject:0 forKeyedSubscript:*(a1 + 40)];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)finishPairingForServer:(id)a3
{
  v5 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v5;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  [v4 finishPairing];
}

- (void)_saveAndSyncMatterFabricIDWithCompletion:(id)a3
{
  v4 = a3;
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [(HMDHome *)self emptyModelObjectWithChangeType:2];
    v6 = [(HMDHome *)self fabric];
    v7 = [v6 fabricID];
    [v5 setMatterFabricID:v7];

    v8 = [(HMDHome *)self backingStore];
    v9 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v10 = [v8 transaction:@"Update Matter Fabric ID" options:v9];

    [v10 add:v5];
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __58__HMDHome_CHIP___saveAndSyncMatterFabricIDWithCompletion___block_invoke;
    v12[3] = &unk_279733F30;
    v12[4] = self;
    v13 = v4;
    [v10 run:v12];
  }

  else
  {
    v11 = _Block_copy(v4);
    v5 = v11;
    if (v11)
    {
      (*(v11 + 2))(v11, 0);
    }
  }
}

void __58__HMDHome_CHIP___saveAndSyncMatterFabricIDWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v9 = [*(a1 + 32) fabric];
    v10 = [v9 fabricID];
    v17 = 138543618;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v11 = "%{public}@Failed to sync Matter Fabric ID to %@";
    v12 = v7;
    v13 = OS_LOG_TYPE_ERROR;
  }

  else
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v9 = [*(a1 + 32) fabric];
    v10 = [v9 fabricID];
    v17 = 138543618;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v11 = "%{public}@Successfully sync'ed Matter Fabric ID to %@";
    v12 = v7;
    v13 = OS_LOG_TYPE_INFO;
  }

  _os_log_impl(&dword_2531F8000, v12, v13, v11, &v17, 0x16u);

LABEL_7:
  objc_autoreleasePoolPop(v4);
  v14 = _Block_copy(*(a1 + 40));
  v15 = v14;
  if (v14)
  {
    (*(v14 + 2))(v14, v3);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)updateFabricUsingHomeModel:(id)a3
{
  v54 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 setProperties];
  if (![v5 containsObject:@"matterFabricID"])
  {
    goto LABEL_11;
  }

  v6 = [(HMDHome *)self fabric];
  v7 = [v6 fabricID];
  v8 = [v4 matterFabricID];
  v9 = HMFEqualObjects();

  if (v9 || ([v4 matterFabricID], (v10 = objc_claimAutoreleasedReturnValue()) == 0))
  {
LABEL_11:

    goto LABEL_12;
  }

  v11 = v10;
  v12 = [v10 isEqualToNumber:&unk_2866276B8];

  if (v12)
  {
LABEL_12:
    v25 = 0;
    goto LABEL_13;
  }

  v13 = [(HMDHome *)self fabric];
  v14 = [v13 fabricID];

  v15 = objc_autoreleasePoolPush();
  v16 = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    v19 = [(HMDHome *)v16 fabric];
    v20 = [v19 fabricID];
    v21 = [v4 matterFabricID];
    v48 = 138543874;
    v49 = v18;
    v50 = 2112;
    v51 = v20;
    v52 = 2112;
    v53 = v21;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Updating fabric ID from %@ to %@", &v48, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  v22 = [v4 matterFabricID];
  v23 = [(HMDHome *)v16 fabric];
  [v23 setFabricID:v22];

  if (v14 && ([v14 isEqualToNumber:&unk_2866276B8] & 1) == 0)
  {
    v24 = [(HMDHome *)v16 fabric];
    [v24 invalidateCachedData];
  }

  v25 = 1;
LABEL_13:
  v26 = [(HMDHome *)self chipStorage];
  v27 = [v26 fabricID];
  v28 = v27;
  if (v27 && ([v27 isEqualToNumber:&unk_2866276B8] & 1) == 0)
  {
    v30 = [(HMDHome *)self fabric];
    v31 = [v30 fabricID];
    v32 = [(HMDHome *)self chipStorage];
    v33 = [v32 fabricID];
    v34 = HMFEqualObjects();

    if (v34)
    {
      if (!v25)
      {
        goto LABEL_16;
      }
    }

    else
    {
      v35 = objc_autoreleasePoolPush();
      v36 = self;
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
      {
        v38 = HMFGetLogIdentifier();
        v39 = [(HMDHome *)v36 fabric];
        v40 = [v39 fabricID];
        v41 = [(HMDHome *)v36 chipStorage];
        v42 = [v41 fabricID];
        v48 = 138543874;
        v49 = v38;
        v50 = 2112;
        v51 = v40;
        v52 = 2112;
        v53 = v42;
        _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@Updating fabric ID from CHIPStorage from %@ to %@", &v48, 0x20u);
      }

      objc_autoreleasePoolPop(v35);
      v43 = [(HMDHome *)v36 chipStorage];
      v44 = [v43 fabricID];
      v45 = [(HMDHome *)v36 fabric];
      [v45 setFabricID:v44];
    }

LABEL_23:
    [(HMDHome *)self _saveAndSyncMatterFabricIDWithCompletion:0];
    v29 = 1;
    goto LABEL_24;
  }

  if (v25)
  {
    goto LABEL_23;
  }

LABEL_16:
  v29 = 0;
LABEL_24:

  v46 = *MEMORY[0x277D85DE8];
  return v29;
}

- (void)handleUpdatedCHIPPropertiesOnHomeModel:(id)a3 actions:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self chipStorage];
  v9 = [v8 updateUsingHomeModel:v6];

  if (isFeatureMatterLocalFabricConfigEnabled() && [(HMDHome *)self updateFabricUsingHomeModel:v6])
  {
    [v7 markChanged];
  }

  if (v9)
  {
    v10 = [(HMDHome *)self workQueue];
    v12 = MEMORY[0x277D85DD0];
    v13 = 3221225472;
    v14 = __64__HMDHome_CHIP__handleUpdatedCHIPPropertiesOnHomeModel_actions___block_invoke;
    v15 = &unk_2797359B0;
    v16 = self;
    v11 = v7;
    v17 = v11;
    dispatch_async(v10, &v12);

    [v11 markChanged];
  }
}

void __64__HMDHome_CHIP__handleUpdatedCHIPPropertiesOnHomeModel_actions___block_invoke(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) homeManager];
  if (![v2 hasLoadedData])
  {

    goto LABEL_5;
  }

  if (([*(a1 + 32) isCurrentDevicePrimaryResident] & 1) == 0)
  {
    v4 = isFeatureMatteriPhoneOnlyPairingControlEnabled();

    if (v4)
    {
      goto LABEL_7;
    }

LABEL_5:
    v3 = 0;
    goto LABEL_10;
  }

LABEL_7:
  v5 = *(a1 + 32);
  v14 = 0;
  [v5 setUpOperationalFabricDataWithError:&v14];
  v3 = v14;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v18 = v9;
    v19 = 2112;
    v20 = v3;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Set up operational fabric data per CHIP properties change on home model with error: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
LABEL_10:
  v10 = [*(a1 + 40) source] < 2;
  v15 = @"HMDHomeCHIPStorageIsLocalChangeNotificationKey";
  v11 = [MEMORY[0x277CCABB0] numberWithBool:v10];
  v16 = v11;
  v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v16 forKeys:&v15 count:1];

  logAndPostNotification(@"HMDHomeCHIPStorageUpdatedNotification", *(a1 + 32), v12);
  v13 = *MEMORY[0x277D85DE8];
}

- (void)_writeLogData:(id)a3 logName:(id)a4 completion:(id)a5
{
  v44 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = v10;
  if (v8 && v9)
  {
    v12 = [(HMDHome *)self homeManager];
    v13 = [v12 chipDataSource];
    v14 = [v13 fileManager];

    v15 = MEMORY[0x277CBEBC0];
    v16 = HMDCreateHomeKitDaemonCacheDirectory();
    v17 = [v15 fileURLWithPath:v16];

    v18 = [v17 URLByAppendingPathComponent:@"MatterDiagnostics"];

    v37 = 0;
    LOBYTE(v16) = [v14 createDirectoryAtURL:v18 withIntermediateDirectories:1 attributes:0 error:&v37];
    v19 = v37;
    if (v16)
    {
      v20 = [v18 URLByAppendingPathComponent:v9];
      v36 = v19;
      v21 = [v14 writeData:v8 toURL:v20 options:0 error:&v36];
      v22 = v36;

      if ((v21 & 1) == 0)
      {
        v23 = objc_autoreleasePoolPush();
        v24 = self;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v26 = v35 = v23;
          *buf = 138543874;
          v39 = v26;
          v40 = 2112;
          v41 = v20;
          v42 = 2112;
          v43 = v22;
          _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Failed to write log file to path: %@ error: %@", buf, 0x20u);

          v23 = v35;
        }

        objc_autoreleasePoolPop(v23);
        v20 = 0;
      }

      v27 = _Block_copy(v11);
      if (v27)
      {
        v28 = [v20 path];
        v27[2](v27, v28, v22);
      }
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      v30 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543874;
        v39 = v32;
        v40 = 2112;
        v41 = v18;
        v42 = 2112;
        v43 = v19;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Failed to create directory at path: %@ error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
      v33 = _Block_copy(v11);
      v20 = v33;
      if (v33)
      {
        (*(v33 + 2))(v33, 0, v19);
      }

      v22 = v19;
    }

    goto LABEL_19;
  }

  v14 = _Block_copy(v10);
  if (v14)
  {
    v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (v14)[2](v14, 0, v18);
LABEL_19:
  }

  v34 = *MEMORY[0x277D85DE8];
}

- (void)downloadLogWithController:(id)a3 nodeId:(id)a4 type:(int64_t)a5 timeout:(double)a6 completion:(id)a7
{
  v11 = a4;
  v12 = a7;
  v13 = [MEMORY[0x277CBEB38] dictionary];
  [v13 setCHIPRemoteCommand:*MEMORY[0x277D17C70]];
  v14 = [MEMORY[0x277CCABB0] numberWithInteger:a5];
  [v13 setCHIPDownloadLogType:v14];

  v15 = [MEMORY[0x277CCABB0] numberWithDouble:a6];
  [v13 setCHIPDownloadTimeout:v15];

  if (a6)
  {
    v16 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:(a6 + 10.0)];
    [v13 setCHIPRemoteMessageTimeout:v16];
  }

  v17 = [v11 unsignedLongValue];
  v18 = [v13 copy];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __74__HMDHome_CHIP__downloadLogWithController_nodeId_type_timeout_completion___block_invoke;
  v20[3] = &unk_279725E38;
  v20[4] = self;
  v21 = v12;
  v19 = v12;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:v17 payload:v18 completion:v20];
}

void __74__HMDHome_CHIP__downloadLogWithController_nodeId_type_timeout_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v16 = 138543874;
    v17 = v10;
    v18 = 2112;
    v19 = v5;
    v20 = 2112;
    v21 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Download log response: %@, error: %@", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = [v5 hmf_dataForKey:*MEMORY[0x277D17C98]];
  v12 = [v5 hmf_stringForKey:*MEMORY[0x277D17CA0]];
  if (v6)
  {
    v13 = _Block_copy(*(a1 + 40));
    v14 = v13;
    if (v13)
    {
      (*(v13 + 2))(v13, 0, v6);
    }
  }

  else
  {
    [*(a1 + 32) _writeLogData:v11 logName:v12 completion:*(a1 + 40)];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)invokeCommandWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 commandId:(id)a6 fields:(id)a7 timedInvokeTimeout:(id)a8 source:(unint64_t)a9 completion:(id)a10
{
  v16 = a4;
  v17 = a5;
  v18 = a6;
  v19 = a7;
  v20 = a8;
  v21 = a10;
  v22 = objc_alloc_init(MEMORY[0x277CBEB38]);
  [v22 setCHIPRemoteCommand:*MEMORY[0x277D17C68]];
  [v22 setCHIPEndpointId:v16 clusterId:v17 commandId:v18];
  if (v19)
  {
    [v22 setCHIPCommandFields:v19];
  }

  if (v20)
  {
    [v22 setCHIPTimedInvokeTimeout:v20];
  }

  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __116__HMDHome_CHIP__invokeCommandWithNodeId_endpointId_clusterId_commandId_fields_timedInvokeTimeout_source_completion___block_invoke;
  v27[3] = &unk_279721AD8;
  v31 = v21;
  v32 = a3;
  v27[4] = self;
  v28 = v16;
  v29 = v17;
  v30 = v18;
  v33 = a9;
  v23 = v18;
  v24 = v17;
  v25 = v16;
  v26 = v21;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:a3 payload:v22 completion:v27];
}

void __116__HMDHome_CHIP__invokeCommandWithNodeId_endpointId_clusterId_commandId_fields_timedInvokeTimeout_source_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Invoke command response: %@, error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 64);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  [*(a1 + 32) submitLogEventForCommandResponse:v5 nodeID:*(a1 + 72) endpointID:*(a1 + 40) clusterID:*(a1 + 48) commandID:*(a1 + 56) source:*(a1 + 80) error:v6];
  v13 = *MEMORY[0x277D85DE8];
}

- (void)writeAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 value:(id)a7 timedWriteTimeout:(id)a8 completion:(id)a9
{
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  v20 = a9;
  v21 = objc_alloc_init(MEMORY[0x277CBEB38]);
  [v21 setCHIPRemoteCommand:*MEMORY[0x277D17C90]];
  [v21 setCHIPEndpointId:v15 clusterId:v16 attributeId:v17];
  [v21 setCHIPData:v18];
  if (v19)
  {
    [v21 setCHIPTimedWriteTimeout:v19];
  }

  v28[0] = MEMORY[0x277D85DD0];
  v28[1] = 3221225472;
  v28[2] = __110__HMDHome_CHIP__writeAttributeWithNodeId_endpointId_clusterId_attributeId_value_timedWriteTimeout_completion___block_invoke;
  v28[3] = &unk_279721AB0;
  v34 = v20;
  v35 = a3;
  v28[4] = self;
  v29 = v15;
  v30 = v16;
  v31 = v17;
  v32 = v18;
  v33 = v19;
  v22 = v19;
  v23 = v18;
  v24 = v17;
  v25 = v16;
  v26 = v15;
  v27 = v20;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:a3 payload:v21 completion:v28];
}

void __110__HMDHome_CHIP__writeAttributeWithNodeId_endpointId_clusterId_attributeId_value_timedWriteTimeout_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Write attribute response: %@, error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 80);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  [*(a1 + 32) submitLogEventForWriteAttributeWithNodeId:*(a1 + 88) endpointId:*(a1 + 40) clusterId:*(a1 + 48) attributeId:*(a1 + 56) value:*(a1 + 64) timedWriteTimeout:*(a1 + 72) error:v6];
  v13 = *MEMORY[0x277D85DE8];
}

- (void)readAttributeWithNodeId:(unint64_t)a3 endpointId:(id)a4 clusterId:(id)a5 attributeId:(id)a6 params:(id)a7 completion:(id)a8
{
  v14 = a8;
  v15 = MEMORY[0x277CBEB38];
  v16 = a7;
  v17 = a6;
  v18 = a5;
  v19 = a4;
  v20 = objc_alloc_init(v15);
  [v20 setCHIPRemoteCommand:*MEMORY[0x277D17C80]];
  [v20 setCHIPEndpointId:v19 clusterId:v18 attributeId:v17];

  [v20 setCHIPEncodedParams:v16];
  v22[0] = MEMORY[0x277D85DD0];
  v22[1] = 3221225472;
  v22[2] = __92__HMDHome_CHIP__readAttributeWithNodeId_endpointId_clusterId_attributeId_params_completion___block_invoke;
  v22[3] = &unk_279725E38;
  v22[4] = self;
  v23 = v14;
  v21 = v14;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:a3 payload:v20 completion:v22];
}

void __92__HMDHome_CHIP__readAttributeWithNodeId_endpointId_clusterId_attributeId_params_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    v14 = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Read attribute response: %@, error: %@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 40);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  v13 = *MEMORY[0x277D85DE8];
}

- (id)matterAccessoryWithNodeID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self matterAccessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __43__HMDHome_CHIP__matterAccessoryWithNodeID___block_invoke;
  v9[3] = &unk_27972B940;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __43__HMDHome_CHIP__matterAccessoryWithNodeID___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 matterNodeID];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

+ (void)updateCHIPPropertiesOnAccessoryModel:(id)a3 forAddedHAPAccessoryServer:(id)a4
{
  v10 = a3;
  v5 = a4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;
  v8 = v7;
  if (v7)
  {
    v9 = [v7 nodeID];
    [v10 setChipNodeID:v9];
  }
}

+ (BOOL)updateCHIPPropertiesOnHomeModel:(id)a3 forAddedHAPAccessoryServer:(id)a4
{
  v5 = a3;
  v6 = a4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;
  v9 = [v8 fabricID];

  if (v9)
  {
    v10 = [v8 fabricID];
    [v5 setChipFabricID:v10];

    v11 = [v8 fabricID];
    [v5 setChipFabricIndex:v11];
  }

  return v9 != 0;
}

- (void)removeCameraNotificationSettingsMigrationFileFromDisk
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = objc_alloc(MEMORY[0x277CBEBC0]);
  v4 = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v5 = [v3 initFileURLWithPath:v4];

  v6 = [MEMORY[0x277CCAA00] defaultManager];
  v13 = 0;
  [v6 removeItemAtURL:v5 error:&v13];
  v7 = v13;

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while removing camera notification settings migration file from disk : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeBulletinBoardNotificationsMigrationFileFromDisk
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = objc_alloc(MEMORY[0x277CBEBC0]);
  v4 = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v5 = [v3 initFileURLWithPath:v4];

  v6 = [MEMORY[0x277CCAA00] defaultManager];
  v13 = 0;
  [v6 removeItemAtURL:v5 error:&v13];
  v7 = v13;

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while removing bulletin board notification migration file from disk : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (id)loadMigrationCameraNotificationSettingsFromDisk
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v17 = 0;
  v4 = [MEMORY[0x277CBEA90] dataWithContentsOfFile:v3 options:2 error:&v17];
  v5 = v17;
  v6 = v5;
  if (v4)
  {
    v7 = v5 == 0;
  }

  else
  {
    v7 = 0;
  }

  if (v7)
  {
    v12 = [HMDHome decodedMigrationCameraNotificationSettings:v4];
    v8 = objc_autoreleasePoolPush();
    v13 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Camera notification settings for migration: [%@]", buf, 0x16u);
    }
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = v3;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to read data from file : %@ / %@", buf, 0x20u);
    }

    v12 = 0;
  }

  objc_autoreleasePoolPop(v8);
  v15 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)loadMigrationBulletinBoardNotificationsFromDisk
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v17 = 0;
  v4 = [MEMORY[0x277CBEA90] dataWithContentsOfFile:v3 options:2 error:&v17];
  v5 = v17;
  v6 = v5;
  if (v4)
  {
    v7 = v5 == 0;
  }

  else
  {
    v7 = 0;
  }

  if (v7)
  {
    v12 = [HMDHome decodedMigrationBulletinBoardNotifications:v4];
    v8 = objc_autoreleasePoolPush();
    v13 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Bulletin board notifications for migration: [%@]", buf, 0x16u);
    }
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = v3;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to read data from file : %@ / %@", buf, 0x20u);
    }

    v12 = 0;
  }

  objc_autoreleasePoolPop(v8);
  v15 = *MEMORY[0x277D85DE8];

  return v12;
}

- (void)storeMigrationCameraNotificationSettingsToDisk
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = [HMDHome migrationCameraNotificationSettingsForHome:self];
  v5 = [v4 count];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v9)
    {
      v10 = HMFGetLogIdentifier();
      v11 = [(HMDHome *)v7 name];
      v26 = 138543874;
      v27 = v10;
      v28 = 2112;
      v29 = v11;
      v30 = 2112;
      v31 = v4;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Archiving camera notification settings for migration for home: %@, [%@]", &v26, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [HMDHome encodedMigrationCameraNotificationSettings:v4];
    if (v12)
    {
      v13 = [(HMDHome *)v7 getCameraNotificationSettingsSerializedFileName];
      v14 = [HMDPersistentStore writeData:v12 toStorePath:v13 dataLabel:@"CameraNotificationSettings"];
      v15 = objc_autoreleasePoolPush();
      v16 = v7;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v18;
        v28 = 2112;
        v29 = v14;
        v30 = 2112;
        v31 = v13;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Stored camera notification settings ([%@] bytes) to [%@]", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
    }

    else
    {
      v21 = objc_autoreleasePoolPush();
      v22 = v7;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v24;
        _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to store camera notification settings during migration, archived data is nil", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
    }
  }

  else
  {
    if (v9)
    {
      v19 = HMFGetLogIdentifier();
      v20 = [(HMDHome *)v7 name];
      v26 = 138543618;
      v27 = v19;
      v28 = 2112;
      v29 = v20;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@No camera notification settings to migrate for home: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  objc_autoreleasePoolPop(v3);
  v25 = *MEMORY[0x277D85DE8];
}

- (void)storeMigrationBulletinBoardNotificationsToDisk
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = [HMDHome migrationBulletinBoardNotificationsForHome:self];
  v5 = [v4 count];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v9)
    {
      v10 = HMFGetLogIdentifier();
      v11 = [(HMDHome *)v7 name];
      v26 = 138543874;
      v27 = v10;
      v28 = 2112;
      v29 = v11;
      v30 = 2112;
      v31 = v4;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Archiving bulletin board notifications for migration for home: %@, [%@]", &v26, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [HMDHome encodedMigrationBulletinBoardNotifications:v4];
    if (v12)
    {
      v13 = [(HMDHome *)v7 getBulletinBoardNotificationSerializedFileName];
      v14 = [HMDPersistentStore writeData:v12 toStorePath:v13 dataLabel:@"BulletinBoardNotifications"];
      v15 = objc_autoreleasePoolPush();
      v16 = v7;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v18;
        v28 = 2112;
        v29 = v14;
        v30 = 2112;
        v31 = v13;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Stored bulletin board notifications ([%@] bytes) to [%@]", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
    }

    else
    {
      v21 = objc_autoreleasePoolPush();
      v22 = v7;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v24;
        _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to store bulletin board notifications during migration, archived data is nil", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
    }
  }

  else
  {
    if (v9)
    {
      v19 = HMFGetLogIdentifier();
      v20 = [(HMDHome *)v7 name];
      v26 = 138543618;
      v27 = v19;
      v28 = 2112;
      v29 = v20;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@No bulletin board notifications to migrate for home: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  objc_autoreleasePoolPop(v3);
  v25 = *MEMORY[0x277D85DE8];
}

- (id)getCameraNotificationSettingsSerializedFileName
{
  v3 = MEMORY[0x277CCACA8];
  v4 = hh1ToHH2PerDeviceMigrationDirectoryPath;
  v5 = [(HMDHome *)self uuid];
  v6 = [v3 stringWithFormat:@"%@/HMDHome-Camera-Notification-Settings-%@.plist", v4, v5];

  return v6;
}

- (id)getBulletinBoardNotificationSerializedFileName
{
  v3 = MEMORY[0x277CCACA8];
  v4 = hh1ToHH2PerDeviceMigrationDirectoryPath;
  v5 = [(HMDHome *)self uuid];
  v6 = [v3 stringWithFormat:@"%@/HMDHome-Bulletin-Board-Notifications-%@.plist", v4, v5];

  return v6;
}

- (BOOL)cameraNotificationSettingsMigrationFileExistsOnDisk
{
  v3 = [MEMORY[0x277CCAA00] defaultManager];
  v4 = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v5 = [v3 fileExistsAtPath:v4];

  return v5;
}

- (BOOL)bulletinBoardNotificationsMigrationFileExistsOnDisk
{
  v3 = [MEMORY[0x277CCAA00] defaultManager];
  v4 = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v5 = [v3 fileExistsAtPath:v4];

  return v5;
}

+ (id)decodedMigrationCameraNotificationSettings:(id)a3
{
  v31[10] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = MEMORY[0x277CBEB98];
  v31[0] = objc_opt_class();
  v31[1] = objc_opt_class();
  v31[2] = objc_opt_class();
  v31[3] = objc_opt_class();
  v31[4] = objc_opt_class();
  v31[5] = objc_opt_class();
  v31[6] = objc_opt_class();
  v31[7] = objc_opt_class();
  v31[8] = objc_opt_class();
  v31[9] = objc_opt_class();
  v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v31 count:10];
  v7 = [v5 setWithArray:v6];

  v26 = 0;
  v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClasses:v7 fromData:v4 error:&v26];
  v9 = v26;
  v10 = v9;
  if (!v8 || v9)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = a1;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v19;
      v29 = 2112;
      v30 = v10;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to unarchive camera notification settings: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v15 = 0;
  }

  else
  {
    v11 = v8;
    objc_opt_class();
    v12 = objc_opt_isKindOfClass() & 1;
    if (v12)
    {
      v13 = v11;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    if (v12)
    {
      v15 = v11;
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      v21 = a1;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v23;
        v29 = 2112;
        v30 = v11;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unarchived data is the wrong type : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      v15 = 0;
    }
  }

  v24 = *MEMORY[0x277D85DE8];

  return v15;
}

+ (id)decodedMigrationBulletinBoardNotifications:(id)a3
{
  v31[9] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = MEMORY[0x277CBEB98];
  v31[0] = objc_opt_class();
  v31[1] = objc_opt_class();
  v31[2] = objc_opt_class();
  v31[3] = objc_opt_class();
  v31[4] = objc_opt_class();
  v31[5] = objc_opt_class();
  v31[6] = objc_opt_class();
  v31[7] = objc_opt_class();
  v31[8] = objc_opt_class();
  v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v31 count:9];
  v7 = [v5 setWithArray:v6];

  v26 = 0;
  v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClasses:v7 fromData:v4 error:&v26];
  v9 = v26;
  v10 = v9;
  if (!v8 || v9)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = a1;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v19;
      v29 = 2112;
      v30 = v10;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to unarchive bulletin board notifications: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v15 = 0;
  }

  else
  {
    v11 = v8;
    objc_opt_class();
    v12 = objc_opt_isKindOfClass() & 1;
    if (v12)
    {
      v13 = v11;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    if (v12)
    {
      v15 = v11;
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      v21 = a1;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v23;
        v29 = 2112;
        v30 = v11;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unarchived data is the wrong type : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      v15 = 0;
    }
  }

  v24 = *MEMORY[0x277D85DE8];

  return v15;
}

+ (id)encodedMigrationCameraNotificationSettings:(id)a3
{
  v3 = MEMORY[0x277CCAAB0];
  v4 = a3;
  v5 = [[v3 alloc] initRequiringSecureCoding:1];
  [v5 encodeObject:v4 forKey:*MEMORY[0x277CCA308]];

  [v5 finishEncoding];
  v6 = [v5 encodedData];

  return v6;
}

+ (id)encodedMigrationBulletinBoardNotifications:(id)a3
{
  v3 = MEMORY[0x277CCAAB0];
  v4 = a3;
  v5 = [[v3 alloc] initRequiringSecureCoding:1];
  [v5 encodeObject:v4 forKey:*MEMORY[0x277CCA308]];

  [v5 finishEncoding];
  v6 = [v5 encodedData];

  return v6;
}

+ (id)migrationCameraNotificationSettingsForHome:(id)a3
{
  v4 = MEMORY[0x277CBEB18];
  v5 = a3;
  v6 = [v4 array];
  v7 = [v5 cameraAccessories];

  v11 = MEMORY[0x277D85DD0];
  v12 = 3221225472;
  v13 = __77__HMDHome_BulletinNotifications__migrationCameraNotificationSettingsForHome___block_invoke;
  v14 = &unk_279721ED8;
  v15 = v6;
  v16 = a1;
  v8 = v6;
  [v7 na_each:&v11];

  v9 = [v8 copy];

  return v9;
}

void __77__HMDHome_BulletinNotifications__migrationCameraNotificationSettingsForHome___block_invoke(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 cameraProfileNotificationSettings];
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 40);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v3 uuid];
      *buf = 138543874;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v4;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Adding camera notification settings entry for migration: accessoryUUID: %@ cameraProfileNotificationSettings: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = *(a1 + 32);
    v12 = [v3 uuid];
    v16[1] = @"HMD.CNS";
    v17[0] = v12;
    v17[1] = v4;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:v16 count:2];
    [v11 addObject:v13];
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Camera accessory: %@ missing camera profile notification settings during migration", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v15 = *MEMORY[0x277D85DE8];
}

+ (id)migrationBulletinBoardNotificationsForHome:(id)a3
{
  v4 = MEMORY[0x277CBEB18];
  v5 = a3;
  v6 = [v4 array];
  v7 = [v5 hapAccessories];

  v11 = MEMORY[0x277D85DD0];
  v12 = 3221225472;
  v13 = __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke;
  v14 = &unk_279721ED8;
  v15 = v6;
  v16 = a1;
  v8 = v6;
  [v7 na_each:&v11];

  v9 = [v8 copy];

  return v9;
}

void __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 services];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke_2;
  v8[3] = &unk_279721EB0;
  v9 = v3;
  v7 = *(a1 + 32);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  [v4 na_each:v8];
}

void __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke_2(uint64_t a1, void *a2)
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 bulletinBoardNotification];
  if (v4)
  {
    v5 = [MEMORY[0x277CBEB68] null];
    v6 = [v4 condition];

    if (v6)
    {
      v7 = [objc_alloc(MEMORY[0x277CCAAB0]) initRequiringSecureCoding:1];
      v8 = [v4 condition];
      [v7 encodeObject:v8 forKey:*MEMORY[0x277CCA308]];

      [v7 finishEncoding];
      v9 = [v7 encodedData];

      v5 = v9;
    }

    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 48);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) uuid];
      v15 = [v3 instanceID];
      [v4 isEnabled];
      HMFBooleanToString();
      v16 = v23 = v10;
      *buf = 138544386;
      v27 = v13;
      v28 = 2112;
      v29 = v14;
      v30 = 2112;
      v31 = v15;
      v32 = 2112;
      v33 = v5;
      v34 = 2112;
      v35 = v16;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Adding bulletin board notification entry for migration: accessoryUUID: %@ serviceInstanceID: %@ predicate: %@ enabled: %@", buf, 0x34u);

      v10 = v23;
    }

    objc_autoreleasePoolPop(v10);
    v24[0] = @"HMD.BBN.A";
    v17 = *(a1 + 40);
    v18 = [*(a1 + 32) uuid];
    v25[0] = v18;
    v24[1] = @"HMD.BBN.S";
    v19 = [v3 instanceID];
    v25[1] = v19;
    v25[2] = v5;
    v24[2] = @"HMD.BBN.P";
    v24[3] = @"HMD.BBN.E";
    v20 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v4, "isEnabled")}];
    v25[3] = v20;
    v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v25 forKeys:v24 count:4];
    [v17 addObject:v21];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (HMDHomeManager)homeManager
{
  WeakRetained = objc_loadWeakRetained(&self->_homeManager);

  return WeakRetained;
}

- (void)removeSharedUserResponseEventBuilder:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v5 = v4;
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableSet *)self->_sharedUserResponseEventBuilders removeObject:v5];
    os_unfair_recursive_lock_unlock();
    v4 = v5;
  }
}

- (void)addSharedUserResponseEventBuilder:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v8 = v4;
    os_unfair_recursive_lock_lock_with_options();
    sharedUserResponseEventBuilders = self->_sharedUserResponseEventBuilders;
    if (!sharedUserResponseEventBuilders)
    {
      v6 = [MEMORY[0x277CBEB58] set];
      v7 = self->_sharedUserResponseEventBuilders;
      self->_sharedUserResponseEventBuilders = v6;

      sharedUserResponseEventBuilders = self->_sharedUserResponseEventBuilders;
    }

    [(NSMutableSet *)sharedUserResponseEventBuilders addObject:v8];
    os_unfair_recursive_lock_unlock();
    v4 = v8;
  }
}

- (void)removeSharedUserEventBuilder:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v5 = v4;
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableSet *)self->_sharedUserInviteEventBuilders removeObject:v5];
    os_unfair_recursive_lock_unlock();
    v4 = v5;
  }
}

- (void)addSharedUserEventBuilder:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v8 = v4;
    os_unfair_recursive_lock_lock_with_options();
    sharedUserInviteEventBuilders = self->_sharedUserInviteEventBuilders;
    if (!sharedUserInviteEventBuilders)
    {
      v6 = [MEMORY[0x277CBEB58] set];
      v7 = self->_sharedUserInviteEventBuilders;
      self->_sharedUserInviteEventBuilders = v6;

      sharedUserInviteEventBuilders = self->_sharedUserInviteEventBuilders;
    }

    [(NSMutableSet *)sharedUserInviteEventBuilders addObject:v8];
    os_unfair_recursive_lock_unlock();
    v4 = v8;
  }
}

- (void)_handleFetchTriggerNameRequest:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:@"triggerUUID"];
  if (v5)
  {
    v6 = [(HMDHome *)self triggers];
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __42__HMDHome__handleFetchTriggerNameRequest___block_invoke;
    v21[3] = &unk_27972A1C0;
    v22 = v5;
    v7 = [v6 na_firstObjectPassingTest:v21];

    v8 = [v7 configuredName];
    if (v8 || ([v7 name], (v8 = objc_claimAutoreleasedReturnValue()) != 0))
    {
      v9 = v8;
      v23 = *MEMORY[0x277CD2758];
      v24 = v8;
      v10 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v24 forKeys:&v23 count:1];
      [v4 respondWithPayload:v10];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = self;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        *buf = 138543362;
        v26 = v20;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_ERROR, "%{public}@trigger name is nil.", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v4 respondWithError:v9];
    }

    v11 = v22;
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@message does not contain the trigger SPI identifier", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v11];
  }

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __42__HMDHome__handleFetchTriggerNameRequest___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 spiClientIdentifier];
  v4 = *(a1 + 32);
  v5 = HMFEqualObjects();

  return v5;
}

- (BOOL)defaultRoomContainsAccessoryWithUUID:(id)a3
{
  v4 = [(HMDHome *)self accessoryWithUUID:a3];
  v5 = [(HMDHome *)self roomForEntireHome];
  v6 = [v4 room];
  v7 = [v5 isEqual:v6];

  return v7;
}

- (BOOL)hasActiveWACPairing
{
  v2 = [(HMDHome *)self accessoryBrowser];
  v3 = [v2 hasActiveWACPairing];

  return v3;
}

- (id)destinationForAppleMediaAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaGroupsAggregateConsumer];
  v6 = [v4 uuid];

  v7 = [v5 destinationWithParentIdentifier:v6];

  return v7;
}

- (id)destinationControllerDataForAppleMediaAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaGroupsAggregateConsumer];
  v6 = [v4 uuid];

  v7 = [v5 destinationControllerDataWithParentIdentifier:v6];

  return v7;
}

- (id)mediaGroupsAggregateDataTopicName
{
  v2 = MEMORY[0x277CD1A78];
  v3 = *MEMORY[0x277CCFF30];
  v4 = [(HMDHome *)self uuid];
  v5 = [v2 topicFromSuffixID:v3 homeUUID:v4];

  return v5;
}

- (void)_handleRetrieveHomeLocationForFeedback:(id)a3
{
  v24 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self homeLocationHandler];

  if (v5)
  {
    v6 = [MEMORY[0x277CBEB38] dictionary];
    v7 = [(HMDHome *)self homeLocationHandler];
    v8 = [v7 locationUpdateTimestamp];

    if (v8)
    {
      v9 = [(HMDHome *)self homeLocationHandler];
      v10 = [v9 locationUpdateTimestamp];
      [v6 setObject:v10 forKeyedSubscript:*MEMORY[0x277CD0048]];
    }

    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v20 = 138543618;
      v21 = v14;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Retrieve home location for feedback : %@", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    [v4 respondWithPayload:v6];
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v20 = 138543362;
      v21 = v18;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Home Location Handler does not exist.", &v20, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v6];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (BOOL)_processTestModeHomeAccessControlOverride:(id)a3 error:(id *)a4
{
  v26 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [v6 hmf_BOOLForKey:@"kConfigTestingResetOverrideKey"];
  v8 = [v6 hmf_numberForKey:@"kConfigTestingHomeAccessControlKey"];
  if (v8)
  {
    v9 = 1;
  }

  else
  {
    v9 = v7;
  }

  if (v9)
  {
    os_unfair_recursive_lock_lock_with_options();
    if (v7)
    {

      v8 = 0;
    }

    overriddenHomeAccessControl = self->_overriddenHomeAccessControl;
    v11 = HMFEqualObjects();
    objc_storeStrong(&self->_overriddenHomeAccessControl, v8);
    os_unfair_recursive_lock_unlock();
    if (v11)
    {
      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v22 = 138543618;
        v23 = v15;
        v24 = 2112;
        v25 = v6;
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Home Access Control overridden to %@", &v22, 0x16u);
      }

      objc_autoreleasePoolPop(v12);
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home access control override: missing data in payload", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    if (a4)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      *a4 = v8 = 0;
    }

    else
    {
      v8 = 0;
    }
  }

  v20 = *MEMORY[0x277D85DE8];
  return v9;
}

- (BOOL)_processTestModeUpdateHomeLocation:(id)a3 error:(id *)a4
{
  v44 = *MEMORY[0x277D85DE8];
  v6 = a3;
  if (isInternalBuild())
  {
    v7 = [v6 dataForKey:@"kHomeLocationDataKey"];
    if (v7)
    {
      v37 = 0;
      v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v7 error:&v37];
      v9 = v37;
      v10 = v9;
      v11 = v8 != 0;
      if (v8)
      {
        v36 = v9;
        v12 = [v6 hmf_numberForKey:@"homeLocationSource"];
        v13 = [v12 intValue];

        v14 = objc_autoreleasePoolPush();
        v15 = self;
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
        {
          v17 = HMFGetLogIdentifier();
          v18 = HMDHomeLocationSourceToString(v13);
          *buf = 138543874;
          v39 = v17;
          v40 = 2112;
          v41 = v8;
          v42 = 2112;
          v43 = v18;
          _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Received new home location override from shared admin: %@, source : %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v14);
        v19 = [(HMDHome *)v15 homeLocationHandler];
        v20 = [MEMORY[0x277CBEAA8] date];
        [v19 runTransactionWithLocation:v8 updatedTime:v20 source:v13];

        v10 = v36;
      }

      else
      {
        v29 = objc_autoreleasePoolPush();
        v30 = self;
        v31 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
        {
          v32 = HMFGetLogIdentifier();
          *buf = 138543874;
          v39 = v32;
          v40 = 2112;
          v41 = v7;
          v42 = 2112;
          v43 = v10;
          _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: failed to unarchive location from data %@: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v29);
        if (a4)
        {
          v33 = v10;
          *a4 = v10;
        }
      }
    }

    else
    {
      v25 = objc_autoreleasePoolPush();
      v26 = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        *buf = 138543362;
        v39 = v28;
        _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: no home location data found in payload", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
      if (a4)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        *a4 = v11 = 0;
      }

      else
      {
        v11 = 0;
      }
    }
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v39 = v24;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: not running on an internal build", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
    if (a4)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      *a4 = v11 = 0;
    }

    else
    {
      v11 = 0;
    }
  }

  v34 = *MEMORY[0x277D85DE8];
  return v11;
}

- (BOOL)_processTestModeHomeLocationStatusOverride:(id)a3 error:(id *)a4
{
  v23 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [v6 hmf_BOOLForKey:@"kConfigTestingResetOverrideKey"];
  v8 = [v6 hmf_numberForKey:@"kConfigTestingHomeLocationStatusKey"];
  v9 = v8;
  if (v8)
  {
    v10 = 1;
  }

  else
  {
    v10 = v7;
  }

  if (v10)
  {
    v11 = [v8 unsignedIntegerValue];
    v12 = [(HMDHome *)self homeLocation];
    os_unfair_recursive_lock_lock_with_options();
    if (v7)
    {
      if (!self->_overrideHomeLocation)
      {
        self->_overriddenHomeLocation = v11;
        os_unfair_recursive_lock_unlock();
        goto LABEL_16;
      }

      v13 = 0;
    }

    else
    {
      v13 = 1;
    }

    self->_overrideHomeLocation = v13;
    self->_overriddenHomeLocation = v11;
    os_unfair_recursive_lock_unlock();
    v18 = [(HMDHome *)self homeLocation];
    if (v18 != v12)
    {
      [(HMDHome *)self _handleHomeLocationChange:v18 previousLocation:v12];
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v17;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location status override: missing data in payload", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
    if (a4)
    {
      *a4 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    }
  }

LABEL_16:

  v19 = *MEMORY[0x277D85DE8];
  return v10;
}

- (void)aggregator:(id)a3 changedResidentCapabilities:(id)a4 rawCapabilities:(id)a5 accessoryUUID:(id)a6 homeUUID:(id)a7
{
  v26 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v17 = objc_autoreleasePoolPush();
  v18 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v22 = 138543618;
    v23 = v20;
    v24 = 2112;
    v25 = v15;
    _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received resident capabilities for accessory: %@", &v22, 0x16u);
  }

  objc_autoreleasePoolPop(v17);
  [(HMDHome *)v18 _writeResidentCapabilities:v14 accessoryUUID:v15 homeUUID:v16];

  v21 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)a3 changedAccessoryCapabilities:(id)a4 rawCapabilities:(id)a5 accessoryUUID:(id)a6 homeUUID:(id)a7
{
  v26 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v17 = objc_autoreleasePoolPush();
  v18 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v22 = 138543618;
    v23 = v20;
    v24 = 2112;
    v25 = v15;
    _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received accessory capabilities for accessory: %@", &v22, 0x16u);
  }

  objc_autoreleasePoolPop(v17);
  [(HMDHome *)v18 _writeAccessoryCapabilities:v14 accessoryUUID:v15 homeUUID:v16];

  v21 = *MEMORY[0x277D85DE8];
}

- (id)localAndRemoteSubscriptionProvider
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 localAndRemoteSubscriptionProvider];

  return v3;
}

- (id)eventStoreReadHandle
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 eventStoreReadHandle];

  return v3;
}

- (HMEEventForwarder)eventForwarder
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 eventForwarder];

  return v3;
}

- (void)didReceiveAccessorySetting:(id)a3 accessoryUUID:(id)a4
{
  v35 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  if (v10 && ([v10 keyPath], v11 = objc_claimAutoreleasedReturnValue(), v12 = objc_msgSend(v11, "isEqualToString:", @"root.siri.availableLanguages"), v11, (v12 & 1) != 0))
  {
    v13 = [(HMDHome *)self accessoryWithUUID:v7];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v15)
    {
      v16 = [(HMDHome *)self notificationCenter];
      v27 = @"HMDHomeNotificationKey";
      v28 = self;
      v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v28 forKeys:&v27 count:1];
      [v16 postNotificationName:@"HMDAppleMediaAccessoryLanguagesChangedNotification" object:self userInfo:v17];
    }

    else
    {
      v22 = objc_autoreleasePoolPush();
      v23 = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543874;
        v30 = v25;
        v31 = 2112;
        v32 = v8;
        v33 = 2112;
        v34 = v7;
        _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Received accessory setting %@ that is not for an accessory %@ in this home", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v22);
    }
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543618;
      v30 = v21;
      v31 = 2112;
      v32 = v8;
      _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Unexpectedly received accessory setting %@ that is not for available languages", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (id)deviceForAppleMediaAccessoryMessageRouter:(id)a3 message:(id)a4
{
  v5 = [a4 messagePayload];
  v6 = [v5 hmf_UUIDForKey:*MEMORY[0x277CCF0B8]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  v10 = [v9 device];

  return v10;
}

- (BOOL)isCurrentDevicePairedWithWatchForSiriSecureAccessoryAccessController:(id)a3
{
  v3 = [(HMDHome *)self homeManager];
  v4 = [v3 isPairedWithWatch];

  return v4;
}

- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithWatchAuthForSiriSecureAccessoryAccessController:(id)a3
{
  v3 = [(HMDHome *)self localCapabilitiesDataSource];
  v4 = [v3 supportsSiriUnsecuringActionsWithWatchAuth];

  return v4;
}

- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithNoPasscodeForSiriSecureAccessoryAccessController:(id)a3
{
  v3 = [(HMDHome *)self localCapabilitiesDataSource];
  v4 = [v3 supportsSiriUnsecuringActionsWithNoPasscode];

  return v4;
}

- (HMDSiriSecureAccessoryAccessController)siriSecureAccessoryAccessController
{
  v3 = [(HMDHome *)self dataSource];
  v4 = [v3 makeSiriSecureAccessoryAccessControllerWithDataSource:self];

  return v4;
}

- (BOOL)isMediaSystem:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __25__HMDHome_isMediaSystem___block_invoke;
  v9[3] = &unk_279726148;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7 != 0;
}

uint64_t __25__HMDHome_isMediaSystem___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (BOOL)isSidekickAccessory:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithUUID:a3];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = v5;
  if (v5)
  {
    v7 = [v5 siriEndpointProfile];
    v8 = v7 != 0;
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (BOOL)isAppleMediaAccessory:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithUUID:a3];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & (v3 != 0);
}

- (BOOL)router:(id)a3 shouldHandleMessage:(id)a4 usingRouter:(id)a5
{
  v35 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self accessoryMessageRouterViaPrimary];

  if (v11 != v8)
  {
    v12 = 0;
    goto LABEL_18;
  }

  v13 = [v9 messagePayload];
  v14 = [v13 hmf_UUIDForKey:*MEMORY[0x277CCF0B8]];

  v15 = [(HMDHome *)self accessoryWithUUID:v14];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v16 = v15;
  }

  else
  {
    v16 = 0;
  }

  v17 = v16;

  v18 = [(HMDHome *)self currentAccessory];
  v19 = [v18 uuid];
  v20 = [v17 uuid];
  v21 = [v19 hmf_isEqualToUUID:v20];

  if (v17)
  {
    v22 = [(HMDHome *)self appleDeviceRouter];
    v23 = v22;
    if (v22 == v10)
    {
      v24 = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident]| v21;

      if (v24)
      {
        v25 = objc_autoreleasePoolPush();
        v26 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_DEBUG))
        {
          v28 = HMFGetLogIdentifier();
          v33 = 138543362;
          v34 = v28;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEBUG, "%{public}@accepting accessory router", &v33, 0xCu);
        }

        objc_autoreleasePoolPop(v25);
        v29 = 1;
        goto LABEL_14;
      }
    }

    else
    {
    }
  }

  v29 = 0;
LABEL_14:
  v30 = [(HMDHome *)self primaryResidentMessageRouter];

  if (v30 == v10)
  {
    v12 = 1;
  }

  else
  {
    v12 = v29;
  }

LABEL_18:
  v31 = *MEMORY[0x277D85DE8];
  return v12;
}

- (BOOL)remoteEventAllowedForTopic:(id)a3 deviceType:(unint64_t)a4 userType:(unint64_t)a5
{
  v8 = a3;
  v9 = [(HMDHome *)self homeRemoteEventAccessController];
  LOBYTE(a5) = [v9 remoteEventAllowedForTopic:v8 deviceType:a4 userType:a5];

  return a5;
}

- (id)currentAccessoryHomeUUID
{
  v3 = [(HMDHome *)self currentAccessory];

  if (v3)
  {
    v4 = [(HMDHome *)self uuid];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)currentAccessorySetupMetricDispatcher
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 currentAccessorySetupMetricDispatcher];

  return v3;
}

- (id)expandedTopicsWithTopics:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [HMDHomeEventsGenerated expandedTopicsWithTopics:v4 homeManager:v5];

  return v6;
}

- (BOOL)canTopicBeForwardedToPrimaryFromResident:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    if (self)
    {
      v8 = MEMORY[0x277CD16F0];
      v9 = v7;
      v10 = [(HMDHome *)self uuid];
      v11 = [v9 uuid];

      self = [v8 topicPrefixWithHomeUUID:v10 accessoryUUID:v11];
    }

    v12 = [v4 hasPrefix:self];
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

- (id)messageTargetForDeviceIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self residentDeviceManager];
  v6 = [v5 residentDevices];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __44__HMDHome_messageTargetForDeviceIdentifier___block_invoke;
  v11[3] = &unk_27972AE10;
  v12 = v4;
  v7 = v4;
  v8 = [v6 na_firstObjectPassingTest:v11];
  v9 = [v8 device];

  return v9;
}

uint64_t __44__HMDHome_messageTargetForDeviceIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 device];
  v4 = [v3 identifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (BOOL)isDeviceIdentifierPrimaryResident:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self primaryResident];
  v6 = [v5 device];
  v7 = [v6 identifier];
  v8 = [v7 hmf_isEqualToUUID:v4];

  return v8;
}

- (BOOL)isDevicePrimaryResident:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self primaryResident];
  v6 = [v5 device];
  v7 = [v6 isEqual:v4];

  return v7;
}

- (BOOL)shouldAllowTopic:(id)a3 forDeviceWithMessageIdentifier:(id)a4
{
  v14[1] = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [(HMDHome *)self accessoryWithDeviceIdentifier:a4];
  if (v7)
  {
    v14[0] = v6;
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v14 count:1];
    v9 = [v7 uuid];
    v10 = [HMDAccessoryEventsGenerated topicsRemovingAccessoryTopics:v8 accessoryUUID:v9];
    v11 = [v10 count] != 0;
  }

  else
  {
    v11 = 1;
  }

  v12 = *MEMORY[0x277D85DE8];
  return v11;
}

- (id)routerServerUserAccessControlProviderForIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self users];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __62__HMDHome_routerServerUserAccessControlProviderForIdentifier___block_invoke;
  v9[3] = &unk_27972E540;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __62__HMDHome_routerServerUserAccessControlProviderForIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (id)routerServerUserAccessControlProviderIdentifierForMessage:(id)a3
{
  v3 = [a3 matchingRemoteIdentityUserForHome:self];
  v4 = [v3 uuid];

  return v4;
}

- (void)primaryResidentClientHasConnectivityDidChangeForRemoteEventRouterClientController:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self remoteEventRouterClientController];

  if (v5 == v4)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v4 primaryResidentClientHasConnectivity];
      v11 = @"down";
      if (v10)
      {
        v11 = @"up";
      }

      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Connectivity to primary resident is %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    [(HMDHome *)v7 canReachPrimaryResidentChanged];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDevicePrimaryResidentForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 isCurrentDevicePrimaryResident];

  return v4;
}

- (BOOL)isCurrentDeviceResidentCapableForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self localCapabilitiesDataSource];
  v4 = [v3 isResidentCapable];

  return v4;
}

- (id)deviceForPrimaryResidentForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 primaryResidentDevice];
  v5 = [v4 device];

  if ([v5 isCurrentDevice])
  {
    v6 = 0;
  }

  else
  {
    v6 = v5;
  }

  return v6;
}

- (id)deviceForAccessoryUUID:(id)a3 forRemoteEventRouterClientController:(id)a4
{
  v4 = [(HMDHome *)self accessoryWithUUID:a3, a4];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  if (v6)
  {
    v7 = [v6 deviceForDirectMessaging];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)eventStoreWriteHandleForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self homeManager];
  v4 = [v3 eventStoreWriteHandle];

  return v4;
}

- (id)eventStoreReadHandleForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self homeManager];
  v4 = [v3 eventStoreReadHandle];

  return v4;
}

- (id)primaryResidentDeviceIdentifierForRemoteEventRouterClientController:(id)a3
{
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 primaryResidentDevice];
  v5 = [v4 device];
  v6 = [v5 identifier];

  return v6;
}

- (void)clientController:(id)a3 didReceiveFetchedCachedEvents:(id)a4 source:(id)a5
{
  v7 = a5;
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __65__HMDHome_clientController_didReceiveFetchedCachedEvents_source___block_invoke;
  v9[3] = &unk_279722E70;
  v9[4] = self;
  v10 = v7;
  v8 = v7;
  [a4 hmf_enumerateKeysAndObjectsWithAutoreleasePoolUsingBlock:v9];
}

void __65__HMDHome_clientController_didReceiveFetchedCachedEvents_source___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = *(a1 + 32);
  v6 = a3;
  v7 = a2;
  v9 = [v5 homeManager];
  v8 = [v9 memoryEventConsumer];
  [v8 didReceiveCachedEvent:v6 topic:v7 source:*(a1 + 40)];
}

- (id)eventRouterDumpStateInfo
{
  v20[1] = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self uuid];
  v4 = [v3 UUIDString];

  v19 = v4;
  v17[0] = @"RemoteClientController";
  v5 = [(HMDHome *)self remoteEventRouterClientController];
  v6 = [v5 dumpStateDescription];
  v7 = v6;
  if (v6)
  {
    v8 = v6;
  }

  else
  {
    v8 = &stru_286509E58;
  }

  v17[1] = @"RemoteServer";
  v18[0] = v8;
  v9 = [(HMDHome *)self remoteEventRouterServer];
  v10 = [v9 dumpStateDescription];
  v11 = v10;
  if (v10)
  {
    v12 = v10;
  }

  else
  {
    v12 = &stru_286509E58;
  }

  v18[1] = v12;
  v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v18 forKeys:v17 count:2];
  v20[0] = v13;
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v20 forKeys:&v19 count:1];

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

- (void)_handleRetrieveAsyncResults:(id)a3
{
  v60 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 shortDescription];
    *buf = 138543618;
    v54 = v8;
    v55 = 2112;
    v56 = v9;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling retrieve async results message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [v4 dataForKey:*MEMORY[0x277CD0510]];
  if (v10)
  {
    v11 = [(HMDHome *)v6 reportingSessionManager];
    v12 = [v11 consumeResponseMessagePayloadsForSessionWithReportContextRequestInfo:v10];

    if ([v12 count])
    {
      v45 = v10;
      v51 = 0u;
      v52 = 0u;
      v49 = 0u;
      v50 = 0u;
      v13 = v12;
      v48 = [v13 countByEnumeratingWithState:&v49 objects:v59 count:16];
      if (v48)
      {
        v47 = *v50;
        obj = v13;
        do
        {
          for (i = 0; i != v48; ++i)
          {
            if (*v50 != v47)
            {
              objc_enumerationMutation(obj);
            }

            v15 = *(*(&v49 + 1) + 8 * i);
            v16 = objc_autoreleasePoolPush();
            v17 = [v15 mutableCopy];
            [v17 setObject:MEMORY[0x277CBEC28] forKeyedSubscript:@"kMultiPartResponseKey"];
            v18 = objc_autoreleasePoolPush();
            v19 = v6;
            v20 = v6;
            v21 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
            {
              v22 = HMFGetLogIdentifier();
              *buf = 138543874;
              v54 = v22;
              v55 = 2112;
              v56 = v15;
              v57 = 2112;
              v58 = v17;
              _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Overriding payload in last cached message from %@ to %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v18);
            if ([v4 qualityOfService] < 17)
            {
              v23 = 17;
            }

            else
            {
              v23 = [v4 qualityOfService];
            }

            v24 = objc_alloc(MEMORY[0x277D0F820]);
            v25 = [(HMDHome *)v20 uuid];
            v26 = [v24 initWithTarget:v25];

            v27 = objc_alloc(MEMORY[0x277D0F848]);
            v28 = [v17 copy];
            v29 = [v27 initWithName:@"kMultipleCharacteristicValuesUpdatedNotificationKey" qualityOfService:v23 destination:v26 payload:v28];

            v30 = [v4 transport];
            [v29 setTransport:v30];
            v31 = [v4 identifier];
            [v29 setIdentifier:v31];

            v32 = [(HMDHome *)v20 msgDispatcher];
            [v32 sendMessage:v29];

            objc_autoreleasePoolPop(v16);
            v6 = v19;
          }

          v13 = obj;
          v48 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
        }

        while (v48);
      }

      [v4 respondWithSuccess];
      v10 = v45;
    }

    else
    {
      v38 = v12;
      v39 = objc_autoreleasePoolPush();
      v40 = v6;
      v41 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT))
      {
        v42 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v42;
        _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_DEFAULT, "%{public}@Did not find any response message payloads to retrieve", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v39);
      v43 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v43];

      v13 = v38;
    }
  }

  else
  {
    v33 = objc_autoreleasePoolPush();
    v34 = v6;
    v35 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
    {
      v36 = HMFGetLogIdentifier();
      v37 = [v4 messagePayload];
      *buf = 138543618;
      v54 = v36;
      v55 = 2112;
      v56 = v37;
      _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_ERROR, "%{public}@Could not find request info in message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v33);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v13];
  }

  v44 = *MEMORY[0x277D85DE8];
}

- (void)endReportingSessionForMessage:(id)a3
{
  v10 = a3;
  v4 = reportContextFromMessage(v10);
  if (v4)
  {
    v5 = v10;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (!v7)
    {
      v8 = [(HMDHome *)self reportingSessionManager];
      v9 = [v5 identifier];
      [v8 endSessionWithUUID:v9];
    }
  }
}

- (void)handleReportingSessionResponseMessage:(id)a3
{
  v4 = a3;
  v7 = [(HMDHome *)self reportingSessionManager];
  v5 = [v4 messagePayload];
  v6 = [v4 identifier];

  [v7 addResponseMessagePayload:v5 toSessionWithUUID:v6];
}

- (void)startReportingSessionForMessage:(id)a3
{
  v10 = a3;
  v4 = reportContextFromMessage(v10);
  if (v4)
  {
    v5 = [v10 transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      v8 = [(HMDHome *)self reportingSessionManager];
      v9 = [v10 identifier];
      [v8 startSessionWithUUID:v9 reportContext:v4 xpcClientConnection:v7];
    }
  }
}

- (BOOL)hasCharacteristicNotificationRegistrations
{
  v2 = [(HMDHome *)self notificationRegistrations];
  v3 = [v2 count] != 0;

  return v3;
}

- (void)_applyNotificationDeregistrations
{
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationRegistrations minusSet:self->_notificationDeregistrations];
  [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories minusSet:self->_notificationDeregistrations];
  [(NSMutableSet *)self->_notificationDeregistrations removeAllObjects];

  os_unfair_recursive_lock_unlock();
}

- (void)removeNotificationDeregistrationForClientIdentifier:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationDeregistrations removeObject:v4];
  os_unfair_recursive_lock_unlock();
}

- (void)addNotificationDeregistrationForClientIdentifier:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationDeregistrations addObject:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSSet)notificationDeregistrations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationDeregistrations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (BOOL)isClientIdentifierSubscribedToAppleMediaAccessoryState:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories containsObject:v4];
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (void)addNotificationRegistrationForClientIdentifier:(id)a3 includesAppleMediaAccessories:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationRegistrations addObject:v6];
  if (v4)
  {
    [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories addObject:v6];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)notificationRegistrationsForAppleMediaAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSSet)notificationRegistrations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationRegistrations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)handleSetPreferredPrimaryMessage:(id)a3
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 messagePayload];
    v11 = 138543618;
    v12 = v8;
    v13 = 2112;
    v14 = v9;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@SetPreferredPrimary - Received set preferred primary message with payload: %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  [v4 respondWithSuccess];

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleRollReaderKey:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [v5 UUID];
    *buf = 138543618;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Homeutil command received to roll reader key in this home", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = [(HMDHome *)v7 nfcReaderKeyManager];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __32__HMDHome__handleRollReaderKey___block_invoke;
  v14[3] = &unk_2797359D8;
  v15 = v4;
  v12 = v4;
  [v11 rollReaderKeyWithFlow:v5 withCompletion:v14];

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __32__HMDHome__handleRollReaderKey___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithSuccess];
  }
}

- (void)_handleTestUpgradeToROAR:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 numberForKey:*MEMORY[0x277CD0608]];
  v6 = v5;
  if (v5)
  {
    if ([v5 BOOLValue])
    {
      v7 = [HMDHomeUpgradedToROAR defaultModelForHome:self];
    }

    else
    {
      [(HMDHome *)self setIsUpdatedToHH2:0];
      v13 = [HMDHomeUpgradedToROAR alloc];
      v14 = [HMDHomeUpgradedToROAR modelIDForHome:self];
      v15 = [(HMDHome *)self uuid];
      v7 = [(HMDBackingStoreModelObject *)v13 initWithObjectChangeType:3 uuid:v14 parentUUID:v15];

      [(HMDHome *)self saveWithReason:@"Downgrading To HH1" postSyncNotification:0 objectChange:1];
    }

    v16 = [(HMDHome *)self backingStore];
    v17 = [v4 name];
    v18 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v19 = [v16 transaction:v17 options:v18];

    [v19 add:v7 withMessage:v4];
    [v19 run];
    [v4 respondWithSuccess];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v11;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Update flag is needed.", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
    [v4 respondWithError:v12];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (HMDHomeNFCReaderKey)nfcReaderKey
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_nfcReaderKey;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNfcReaderKey:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  nfcReaderKey = self->_nfcReaderKey;
  self->_nfcReaderKey = v4;

  os_unfair_recursive_lock_unlock();
}

- (void)configureNaturalLightingForDemoMode
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Setting up natural lighting for demo mode", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  [(HMDHome *)v4 configureNaturalLightingWithDemoModeEnabled:1];
  v7 = *MEMORY[0x277D85DE8];
}

- (HMDNaturalLightingContext)naturalLightingContext
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_naturalLightingContext;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNaturalLightingContext:(id)a3
{
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if ([(HMDNaturalLightingContext *)self->_naturalLightingContext isEqual:v6])
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    v4 = [v6 copy];
    naturalLightingContext = self->_naturalLightingContext;
    self->_naturalLightingContext = v4;

    os_unfair_recursive_lock_unlock();
    logAndPostNotification(@"HMDHomeNaturalLightingContextUpdatedNotification", self, 0);
  }
}

- (NSArray)mediaSystems
{
  v2 = [(HMDHome *)self mediaSystemController];
  v3 = [v2 mediaSystems];

  return v3;
}

- (BOOL)isResidentReachable:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (-[HMDHome isCurrentDevicePrimaryResident](self, "isCurrentDevicePrimaryResident") || (-[HMDHome primaryResident](self, "primaryResident"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 isEqual:v4], v5, v6))
  {
    v7 = [v4 isReachable];
  }

  else
  {
    v25 = 0u;
    v26 = 0u;
    v23 = 0u;
    v24 = 0u;
    v10 = [(HMDHome *)self appleMediaAccessories];
    v11 = [v10 countByEnumeratingWithState:&v23 objects:v31 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v24;
      while (2)
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v24 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v23 + 1) + 8 * i);
          v16 = [v15 device];
          v17 = [v4 device];
          v18 = [v16 isEqual:v17];

          if (v18)
          {
            if ([v15 isReachable])
            {
              v7 = 1;
            }

            else
            {
              v7 = [v15 isDeviceReachable];
            }

            goto LABEL_4;
          }
        }

        v12 = [v10 countByEnumeratingWithState:&v23 objects:v31 count:16];
        if (v12)
        {
          continue;
        }

        break;
      }
    }

    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v22;
      v29 = 2112;
      v30 = v4;
      _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_DEBUG, "%{public}@Could not find matching accessory for resident %@ so assuming unreachable", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    v7 = 0;
  }

LABEL_4:

  v8 = *MEMORY[0x277D85DE8];
  return v7;
}

- (BOOL)isCompanionReachable
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 companionReachable];

  return v3;
}

- (HMDDevice)companionDevice
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 companionDevice];

  return v3;
}

- (void)_wol_processChangedCharacteristicResponses:(id)a3
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v4 = [v3 countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v20;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v20 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v8 = *(*(&v19 + 1) + 8 * i);
        v9 = [v8 request];
        v10 = [v9 characteristic];

        v11 = [v10 accessory];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = v11;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if ([v13 canWakeUpViaWoL])
        {
          v14 = [v8 request];
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();

          v16 = (v14 == 0) | ~isKindOfClass;
          v17 = [v8 error];
          [v13 _wol_processReadWriteResponseForCharacteristic:v10 isRead:v16 & 1 response:v8 error:v17];
        }
      }

      v5 = [v3 countByEnumeratingWithState:&v19 objects:v23 count:16];
    }

    while (v5);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (BOOL)attemptToUpdateThreadNetworkID:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v5 = a3;
  os_unfair_recursive_lock_lock_with_options();
  unfilteredThreadNetworkID = self->_unfilteredThreadNetworkID;
  v7 = HMFEqualObjects();
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  if (v7)
  {
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v11 = HMFGetLogIdentifier();
      v17 = 138543618;
      v18 = v11;
      v19 = 2112;
      v20 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_DEBUG, "%{public}@unfilteredThreadNetworkID did not change (%@)", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  else
  {
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = self->_unfilteredThreadNetworkID;
      v17 = 138543874;
      v18 = v13;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = v5;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@unfilteredThreadNetworkID changed: %@ -> %@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    objc_storeStrong(&self->_unfilteredThreadNetworkID, a3);
  }

  os_unfair_recursive_lock_unlock();

  v15 = *MEMORY[0x277D85DE8];
  return v7 ^ 1;
}

- (NSString)unfilteredThreadNetworkID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_unfilteredThreadNetworkID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setThreadNetworkSequenceNumber:(unint64_t)a3
{
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  self->_threadNetworkSequenceNumber = a3;
}

- (unint64_t)threadNetworkSequenceNumber
{
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  return self->_threadNetworkSequenceNumber;
}

- (void)_handleRemoteUserClientCloudShareRepairRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  [v5 handleRemoteUserClientCloudShareRepairRequest:v4];
}

- (void)_handleRemoteUserClientCloudShareRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  [v5 handleRemoteUserClientCloudShareRequest:v4];
}

- (void)handleXPCConnectionInvalidated:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_handleXPCConnectionInvalidated___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __42__HMDHome_handleXPCConnectionInvalidated___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"connection"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (v5)
  {
    [*(a1 + 40) _removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:v5];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 32);
      v12 = 138543618;
      v13 = v9;
      v14 = 2112;
      v15 = v10;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Received connection invalidated notification, but no connection object was found: %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (id)updatePersonManagerSettings:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self personDataManager];
  v6 = [v5 updateSettingsModelWithSettings:v4];

  return v6;
}

- (HMDHomePersonManager)personManager
{
  v2 = [(HMDHome *)self personDataManager];
  v3 = [v2 personManager];

  return v3;
}

- (void)setPersonManagerSettings:(id)a3
{
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if (([(HMHomePersonManagerSettings *)self->_personManagerSettings isEqual:v6]& 1) != 0)
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    v4 = [v6 copy];
    personManagerSettings = self->_personManagerSettings;
    self->_personManagerSettings = v4;

    os_unfair_recursive_lock_unlock();
    logAndPostNotification(@"HMDHomePersonManagerSettingsDidChangeNotification", self, 0);
  }
}

- (HMHomePersonManagerSettings)personManagerSettings
{
  os_unfair_recursive_lock_lock_with_options();
  personManagerSettings = self->_personManagerSettings;
  if (personManagerSettings)
  {
    v4 = personManagerSettings;
  }

  else
  {
    v4 = objc_alloc_init(MEMORY[0x277CD1AB0]);
  }

  v5 = v4;
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (void)_removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:(id)a3
{
  v7 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices containsObject:v7])
  {
    [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices removeObject:v7];
    v4 = [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices count];
    os_unfair_recursive_lock_unlock();
    if (!v4)
    {
      v5 = +[HMDMainDriver driver];
      v6 = [v5 symptomManager];
      [v6 stopDiscoveringSymptomsRequiringNearbyInfo];
    }
  }

  else
  {
    os_unfair_recursive_lock_unlock();
  }
}

- (void)_handleStopDiscoveringSymptomsForNearbyDevicesMessage:(id)a3
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self _ensureDevicesSymptomDiscoveryMessageCanBeHandled:v4])
  {
    v5 = [v4 transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      [(HMDHome *)self _removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:v7];
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        v13 = 138543362;
        v14 = v11;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Asked to stop discovering symptoms, but no connection proxy was available", &v13, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
    }

    [v4 respondWithPayload:0];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_handleStartDiscoveringSymptomsForNearbyDevicesMessage:(id)a3
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self _ensureDevicesSymptomDiscoveryMessageCanBeHandled:v4])
  {
    v5 = [v4 transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      os_unfair_recursive_lock_lock_with_options();
      if ([(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices containsObject:v7])
      {
        os_unfair_recursive_lock_unlock();
      }

      else
      {
        [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices addObject:v7];
        v12 = [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices count];
        os_unfair_recursive_lock_unlock();
        if (v12 == 1)
        {
          v13 = +[HMDMainDriver driver];
          v14 = [v13 symptomManager];
          [v14 startDiscoveringSymptomsRequiringNearbyInfo];
        }
      }
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        v16 = 138543362;
        v17 = v11;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Asked to start discovering symptoms, but no connection proxy was available", &v16, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
    }

    [v4 respondWithPayload:0];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (BOOL)_ensureDevicesSymptomDiscoveryMessageCanBeHandled:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSPIAccess])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      LOBYTE(v5) = 1;
      goto LABEL_13;
    }

    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      v18 = 138543362;
      v19 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Only owners may start discovering symptoms for nearby devices", &v18, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v5 = [v4 responseHandler];

    if (v5)
    {
      v10 = 17;
      goto LABEL_12;
    }
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      v18 = 138543362;
      v19 = v9;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Only entitled clients may stop discovering symptoms for nearby devices", &v18, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
    v5 = [v4 responseHandler];

    if (v5)
    {
      v10 = 10;
LABEL_12:
      v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:v10];
      v15 = [v4 responseHandler];
      (v15)[2](v15, v5, 0);

      LOBYTE(v5) = 0;
    }
  }

LABEL_13:

  v16 = *MEMORY[0x277D85DE8];
  return v5;
}

- (void)mediaSystemController:(id)a3 didRemoveMediaSystem:(id)a4
{
  v5 = a4;
  v7 = [(HMDHome *)self homeManager];
  v6 = [v7 lastEventStoreController];
  [v6 didRemoveMediaSystem:v5];
}

- (void)mediaSystemController:(id)a3 removeAccessories:(id)a4 fromAssistantAccessControl:(id)a5
{
  v11 = a4;
  v7 = a5;
  v8 = [(HMDHome *)self currentUser];
  v9 = [v8 isEqual:v7];

  if (v9)
  {
    v10 = [(HMDHome *)self currentUser];
    [v10 removeAccessoriesFromAssistantAccessControlList:v11];
  }
}

- (id)mediaSystemController:(id)a3 accessoryForUUID:(id)a4
{
  v5 = a4;
  v6 = [(HMDHome *)self accessories];
  v7 = [v6 hmf_firstObjectWithUUID:v5];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  return v8;
}

- (id)destinationForMediaSystem:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaGroupsAggregateConsumer];
  v6 = [v4 uuid];

  v7 = [v5 destinationWithParentIdentifier:v6];

  return v7;
}

- (void)userAssistantAccessControlDidUpdate:(id)a3 accessories:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self currentUser];
  v9 = [v8 isEqual:v6];

  if (v9)
  {
    v10 = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __59__HMDHome_userAssistantAccessControlDidUpdate_accessories___block_invoke;
    block[3] = &unk_279734960;
    block[4] = self;
    v12 = v6;
    v13 = v7;
    dispatch_async(v10, block);
  }
}

void __59__HMDHome_userAssistantAccessControlDidUpdate_accessories___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) mediaSystemController];
  [v2 _userAssistantAccessControlDidUpdate:*(a1 + 40) accessories:*(a1 + 48)];
}

- (NSArray)cameraAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_2131];

  return v3;
}

id __28__HMDHome_cameraAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 cameraProfiles];
  v6 = [v5 count];

  if (v6)
  {
    v7 = v4;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (NSArray)hapAccessoriesForLegacyDataBlobEncoding
{
  v2 = [(HMDHome *)self hapAccessories];
  v3 = [v2 na_filter:&__block_literal_global_2129];

  return v3;
}

uint64_t __50__HMDHome_hapAccessoriesForLegacyDataBlobEncoding__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  v3 = (v2 == 0) | ~objc_opt_isKindOfClass();

  return v3 & 1;
}

- (id)matterAccessoryWithIdentifier:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithIdentifier:a3];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (NSArray)matterAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_1999];

  return v3;
}

id __28__HMDHome_matterAccessories__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 conformsToProtocol:&unk_286699378])
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 supportsCHIP];
  if ((v6 & 1) != 0 || ([v5 matterNodeID], v2 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v2, "unsignedIntValue")))
  {
    v7 = v5;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = v7;
    }

    else
    {
      v8 = 0;
    }

    v9 = v8;

    if (v6)
    {
      goto LABEL_13;
    }
  }

  else
  {
    v9 = 0;
  }

LABEL_13:

  return v9;
}

- (NSArray)hapAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_1996];

  return v3;
}

void *__25__HMDHome_hapAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)_handleMediaPropertiesWrite:(id)a3
{
  v4 = a3;
  v5 = [v4 source];
  v6 = [v4 dictionaryForKey:@"kMediaPropertiesListKey"];
  objc_initWeak(&location, self);
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __39__HMDHome__handleMediaPropertiesWrite___block_invoke;
  v8[3] = &unk_279729BD8;
  objc_copyWeak(&v10, &location);
  v7 = v4;
  v9 = v7;
  [(HMDHome *)self _handleWriteMediaProperties:v6 source:v5 requestMessage:v7 completionHandler:v8];

  objc_destroyWeak(&v10);
  objc_destroyWeak(&location);
}

void __39__HMDHome__handleMediaPropertiesWrite___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Responding to media write with %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [*(a1 + 32) responseHandler];
    (v9)[2](v9, 0, v3);
  }

  else
  {
    v9 = [*(a1 + 32) responseHandler];
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    (v9)[2](v9, v10, 0);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleWriteMediaProperties:(id)a3 source:(unint64_t)a4 requestMessage:(id)a5 completionHandler:(id)a6
{
  v63 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v33 = a5;
  v34 = a6;
  v41 = v8;
  v40 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v8, "count")}];
  group = dispatch_group_create();
  objc_initWeak(&location, self);
  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  v9 = [v8 allKeys];
  v10 = [v9 countByEnumeratingWithState:&v51 objects:v62 count:16];
  if (v10)
  {
    v39 = *v52;
    obj = v9;
    do
    {
      v42 = v10;
      for (i = 0; i != v42; ++i)
      {
        if (*v52 != v39)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v51 + 1) + 8 * i);
        v13 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:{v12, v33}];
        v14 = [(HMDHome *)self mediaProfileWithUUID:v13];
        v15 = [v41 hmf_dictionaryForKey:v12];
        v16 = [HMDMediaPropertyWriteRequest deserializeWriteRequests:v15 mediaProfile:v14];
        if ([v16 count])
        {
          v17 = [v14 mediaSession];
          if (v17)
          {
            dispatch_group_enter(group);
            v47[0] = MEMORY[0x277D85DD0];
            v47[1] = 3221225472;
            v47[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke;
            v47[3] = &unk_2797353D0;
            objc_copyWeak(&v50, &location);
            v48 = v40;
            v49 = group;
            [v17 writeProperties:v16 completion:v47];

            objc_destroyWeak(&v50);
          }

          else
          {
            v20 = objc_autoreleasePoolPush();
            v21 = self;
            v22 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
            {
              log = v22;
              v36 = v20;
              v23 = HMFGetLogIdentifier();
              v24 = [v14 accessory];
              v25 = [v24 name];
              *buf = 138543874;
              v57 = v23;
              v58 = 2112;
              v59 = v25;
              v60 = 2112;
              v61 = v12;
              _os_log_impl(&dword_2531F8000, log, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ not reachable for writing", buf, 0x20u);

              v20 = v36;
              v22 = log;
            }

            objc_autoreleasePoolPop(v20);
            v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
            v27 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v16 error:v26];
            v28 = [HMDMediaPropertyResponse serializeResponses:v27];
            [v40 addEntriesFromDictionary:v28];

            v17 = 0;
          }
        }

        else
        {
          v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v18 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v16 error:v17];
          v19 = [HMDMediaPropertyResponse serializeResponses:v18];
          [v40 addEntriesFromDictionary:v19];
        }
      }

      v9 = obj;
      v10 = [obj countByEnumeratingWithState:&v51 objects:v62 count:16];
    }

    while (v10);
  }

  v29 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_3;
  block[3] = &unk_279735738;
  v45 = v40;
  v46 = v34;
  v30 = v40;
  v31 = v34;
  dispatch_group_notify(group, v29, block);

  objc_destroyWeak(&location);
  v32 = *MEMORY[0x277D85DE8];
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke(id *a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_2;
    block[3] = &unk_279734960;
    v8 = a1[4];
    v9 = v3;
    v10 = a1[5];
    dispatch_async(v6, block);
  }
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_3(uint64_t a1)
{
  v1 = *(a1 + 40);
  if (v1)
  {
    v2 = [*(a1 + 32) copy];
    (*(v1 + 16))(v1, v2);
  }
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_2(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

- (void)redispatchMediaWriteRequests:(id)a3 viaDevice:(id)a4 completion:(id)a5
{
  v29[1] = *MEMORY[0x277D85DE8];
  v8 = a3;
  v21 = a4;
  v9 = a5;
  v10 = [HMDMediaPropertyWriteRequest serializeWriteRequests:v8];
  if ([v10 count])
  {
    v11 = [(HMDHome *)self uuid];
    v12 = [v11 UUIDString];

    v13 = *MEMORY[0x277CD0640];
    v27[0] = @"kMediaPropertiesListKey";
    v27[1] = v13;
    v28[0] = v10;
    v28[1] = v12;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];
    v15 = MEMORY[0x277D0F848];
    v16 = [(HMDHome *)self messageDestination];
    v17 = [v15 messageWithName:@"kMediaPropertiesWriteRequestKey" qualityOfService:25 destination:v16 payload:v14];

    objc_initWeak(&location, self);
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __61__HMDHome_redispatchMediaWriteRequests_viaDevice_completion___block_invoke;
    v22[3] = &unk_279731AF8;
    objc_copyWeak(&v25, &location);
    v24 = v9;
    v23 = v8;
    [v17 setResponseHandler:v22];
    v18 = [(HMDHome *)self uuid];
    v19 = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v17 target:v18 responseQueue:v19 viaDevice:v21];

    objc_destroyWeak(&v25);
    objc_destroyWeak(&location);
LABEL_5:

    goto LABEL_6;
  }

  if (v9)
  {
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v14 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v8 error:v12];
    v29[0] = v14;
    v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v29 count:1];
    (*(v9 + 2))(v9, v17);
    goto LABEL_5;
  }

LABEL_6:

  v20 = *MEMORY[0x277D85DE8];
}

void __61__HMDHome_redispatchMediaWriteRequests_viaDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v13[1] = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = *(a1 + 40);
    if (v5)
    {
      if (v8)
      {
        v9 = [HMDMediaPropertyResponse propertyResponsesFromRequests:*(a1 + 32) error:v5];
        v10 = *(a1 + 40);
        v13[0] = v9;
        v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
        (*(v10 + 16))(v10, v11);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v6 requests:*(a1 + 32) home:WeakRetained];
      (*(*(a1 + 40) + 16))();
      goto LABEL_7;
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_handleMediaPropertiesRead:(id)a3
{
  location[3] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dictionaryForKey:@"kMediaPropertiesListKey"];
  if ([v5 count])
  {
    v6 = [v4 source];
    objc_initWeak(location, self);
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __38__HMDHome__handleMediaPropertiesRead___block_invoke;
    v13[3] = &unk_279729BD8;
    objc_copyWeak(&v15, location);
    v14 = v4;
    [(HMDHome *)self _handleReadMediaProperties:v5 source:v6 message:v14 completionHandler:v13];

    objc_destroyWeak(&v15);
    objc_destroyWeak(location);
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@None of the properties in media properties read are valid", location, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v11];
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__handleMediaPropertiesRead___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Responding to media read with %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 32) respondWithPayload:v3];
  }

  else
  {
    v9 = *(a1 + 32);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v9 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleReadMediaProperties:(id)a3 source:(unint64_t)a4 message:(id)a5 completionHandler:(id)a6
{
  v119 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v66 = a5;
  v67 = a6;
  group = dispatch_group_create();
  v73 = v8;
  v70 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v8, "count")}];
  objc_initWeak(&location, self);
  v103 = 0u;
  v104 = 0u;
  v101 = 0u;
  v102 = 0u;
  obj = [v8 allKeys];
  v76 = [obj countByEnumeratingWithState:&v101 objects:v110 count:16];
  if (v76)
  {
    v75 = *v102;
    v89 = *MEMORY[0x277CD0910];
    v88 = *MEMORY[0x277CD0938];
    v87 = *MEMORY[0x277CD0990];
    v86 = *MEMORY[0x277CD0960];
    v83 = *MEMORY[0x277CD09B0];
    v80 = *MEMORY[0x277CD0920];
    do
    {
      v84 = 0;
      do
      {
        if (*v102 != v75)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v101 + 1) + 8 * v84);
        v82 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v9];
        v85 = [(HMDHome *)self mediaProfileWithUUID:?];
        if (v85)
        {
          v78 = [v73 hmf_arrayForKey:v9];
          v10 = [HMDMediaPropertyRequest deserializeReadRequests:"deserializeReadRequests:mediaProfile:" mediaProfile:?];
          if (![v10 count])
          {
            goto LABEL_51;
          }

          v79 = [v85 mediaSession];
          v11 = [v85 accessory];
          v77 = v10;
          v74 = v11;
          if (v11)
          {
            v12 = [v11 identifier];
            v13 = [(HMDHome *)self mediaSessionStateWithIdentifier:v12];

            if (!v79 && v13)
            {
              if ([(HMDHome *)self isCurrentDevicePrimaryResident])
              {
                v14 = objc_autoreleasePoolPush();
                v69 = self;
                v15 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
                {
                  v16 = HMFGetLogIdentifier();
                  v17 = [v85 accessory];
                  v18 = [v17 name];
                  *buf = 138543874;
                  v112 = v16;
                  v113 = 2112;
                  v114 = v18;
                  v115 = 2112;
                  v116 = v9;
                  _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ has no session, returning local state", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v14);
                v13 = v13;
                v19 = v77;
                v68 = v19;
                if (self)
                {
                  v20 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v19, "count")}];
                  v21 = [MEMORY[0x277CBEAA8] now];
                  v108 = 0u;
                  v109 = 0u;
                  v106 = 0u;
                  v107 = 0u;
                  v22 = v68;
                  v23 = [v22 countByEnumeratingWithState:&v106 objects:buf count:16];
                  if (!v23)
                  {
                    goto LABEL_40;
                  }

                  v24 = *v107;
                  while (1)
                  {
                    for (i = 0; i != v23; ++i)
                    {
                      if (*v107 != v24)
                      {
                        objc_enumerationMutation(v22);
                      }

                      v26 = *(*(&v106 + 1) + 8 * i);
                      v27 = [v26 property];
                      v28 = [v27 isEqualToString:v89];

                      if (v28)
                      {
                        v29 = [v13 sessionIdentifier];
                        v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                      }

                      else
                      {
                        v31 = [v26 property];
                        v32 = [v31 isEqualToString:v88];

                        if (v32)
                        {
                          v29 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "playbackState")}];
                          v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                        }

                        else
                        {
                          v33 = [v26 property];
                          v34 = [v33 isEqualToString:v87];

                          if (v34)
                          {
                            v29 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "shuffleState")}];
                            v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                          }

                          else
                          {
                            v35 = [v26 property];
                            v36 = [v35 isEqualToString:v86];

                            if (v36)
                            {
                              v29 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "repeatState")}];
                              v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                            }

                            else
                            {
                              v37 = [v26 property];
                              if ([v37 isEqualToString:v83])
                              {
                                v38 = [v13 volume];
                                v39 = v38 == 0;

                                if (!v39)
                                {
                                  v29 = [v13 volume];
                                  v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                                  goto LABEL_35;
                                }
                              }

                              else
                              {
                              }

                              v40 = [v26 property];
                              if (![v40 isEqualToString:v80])
                              {
                                goto LABEL_37;
                              }

                              v41 = [v13 mediaUniqueIdentifier];
                              v42 = v41 == 0;

                              if (v42)
                              {
                                continue;
                              }

                              v29 = [v13 mediaUniqueIdentifier];
                              v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:v29 updatedTime:v21];
                            }
                          }
                        }
                      }

LABEL_35:
                      v40 = v30;

                      if (!v40)
                      {
                        continue;
                      }

                      [v20 addObject:v40];
LABEL_37:
                    }

                    v23 = [v22 countByEnumeratingWithState:&v106 objects:buf count:16];
                    if (!v23)
                    {
LABEL_40:

                      v43 = [v20 copy];
                      goto LABEL_41;
                    }
                  }
                }

                v43 = 0;
LABEL_41:

                dispatch_group_enter(group);
                v44 = [(HMDHome *)v69 workQueue];
                block[0] = MEMORY[0x277D85DD0];
                block[1] = 3221225472;
                block[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke;
                block[3] = &unk_279734960;
                v98 = v70;
                v99 = v43;
                v100 = group;
                v45 = v43;
                dispatch_async(v44, block);

LABEL_50:
                v10 = v77;
LABEL_51:

                goto LABEL_52;
              }

LABEL_47:
              v52 = objc_autoreleasePoolPush();
              v53 = self;
              v54 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v54, OS_LOG_TYPE_INFO))
              {
                v55 = HMFGetLogIdentifier();
                v56 = [v85 accessory];
                v57 = [v56 name];
                *buf = 138543874;
                v112 = v55;
                v113 = 2112;
                v114 = v57;
                v115 = 2112;
                v116 = v9;
                _os_log_impl(&dword_2531F8000, v54, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ not reachable for reading", buf, 0x20u);
              }

              objc_autoreleasePoolPop(v52);
              v58 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
              v59 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v77 error:v58];
              v60 = [HMDMediaPropertyResponse serializeResponses:v59];
              [v70 addEntriesFromDictionary:v60];

              goto LABEL_50;
            }
          }

          else
          {
            v13 = 0;
          }

          if (v79)
          {
            dispatch_group_enter(group);
            v46 = objc_autoreleasePoolPush();
            v47 = self;
            v48 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
            {
              v49 = HMFGetLogIdentifier();
              v50 = [v85 accessory];
              v51 = [v50 name];
              *buf = 138544130;
              v112 = v49;
              v113 = 2112;
              v114 = v51;
              v115 = 2112;
              v116 = v9;
              v117 = 2112;
              v118 = v79;
              _os_log_impl(&dword_2531F8000, v48, OS_LOG_TYPE_INFO, "%{public}@Reading state for accessory with media profile %@/%@ from media session: %@", buf, 0x2Au);
            }

            objc_autoreleasePoolPop(v46);
            v93[0] = MEMORY[0x277D85DD0];
            v93[1] = 3221225472;
            v93[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_1992;
            v93[3] = &unk_2797353D0;
            objc_copyWeak(&v96, &location);
            v94 = group;
            v95 = v70;
            [v79 readProperties:v77 completion:v93];

            objc_destroyWeak(&v96);
            goto LABEL_50;
          }

          goto LABEL_47;
        }

LABEL_52:

        ++v84;
      }

      while (v84 != v76);
      v61 = [obj countByEnumeratingWithState:&v101 objects:v110 count:16];
      v76 = v61;
    }

    while (v61);
  }

  v62 = [(HMDHome *)self workQueue];
  v90[0] = MEMORY[0x277D85DD0];
  v90[1] = 3221225472;
  v90[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_3;
  v90[3] = &unk_279735738;
  v91 = v70;
  v92 = v67;
  v63 = v70;
  v64 = v67;
  dispatch_group_notify(group, v62, v90);

  objc_destroyWeak(&location);
  v65 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_1992(id *a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2;
    block[3] = &unk_279734960;
    v8 = a1[5];
    v9 = v3;
    v10 = a1[4];
    dispatch_async(v6, block);
  }

  else
  {
    dispatch_group_leave(a1[4]);
  }
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_3(uint64_t a1)
{
  v1 = *(a1 + 40);
  if (v1)
  {
    v2 = [*(a1 + 32) copy];
    (*(v1 + 16))(v1, v2);
  }
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

- (void)redispatchMediaReadRequests:(id)a3 viaDevice:(id)a4 completion:(id)a5
{
  v29[1] = *MEMORY[0x277D85DE8];
  v8 = a3;
  v21 = a4;
  v9 = a5;
  v10 = [HMDMediaPropertyRequest serializeReadRequests:v8];
  if ([v10 count])
  {
    v11 = [(HMDHome *)self uuid];
    v12 = [v11 UUIDString];

    v13 = *MEMORY[0x277CD0640];
    v27[0] = @"kMediaPropertiesListKey";
    v27[1] = v13;
    v28[0] = v10;
    v28[1] = v12;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];
    v15 = MEMORY[0x277D0F848];
    v16 = [(HMDHome *)self messageDestination];
    v17 = [v15 messageWithName:@"kMediaPropertiesReadRequestKey" qualityOfService:33 destination:v16 payload:v14];

    objc_initWeak(&location, self);
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __60__HMDHome_redispatchMediaReadRequests_viaDevice_completion___block_invoke;
    v22[3] = &unk_279731AF8;
    objc_copyWeak(&v25, &location);
    v24 = v9;
    v23 = v8;
    [v17 setResponseHandler:v22];
    v18 = [(HMDHome *)self uuid];
    v19 = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v17 target:v18 responseQueue:v19 viaDevice:v21];

    objc_destroyWeak(&v25);
    objc_destroyWeak(&location);
LABEL_5:

    goto LABEL_6;
  }

  if (v9)
  {
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v14 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v8 error:v12];
    v29[0] = v14;
    v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v29 count:1];
    (*(v9 + 2))(v9, v17);
    goto LABEL_5;
  }

LABEL_6:

  v20 = *MEMORY[0x277D85DE8];
}

void __60__HMDHome_redispatchMediaReadRequests_viaDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v13[1] = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = *(a1 + 40);
    if (v5)
    {
      if (v8)
      {
        v9 = [HMDMediaPropertyResponse propertyResponsesFromRequests:*(a1 + 32) error:v5];
        v10 = *(a1 + 40);
        v13[0] = v9;
        v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
        (*(v10 + 16))(v10, v11);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v6 requests:*(a1 + 32) home:WeakRetained];
      (*(*(a1 + 40) + 16))();
      goto LABEL_7;
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeMediaSessionState:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_mediaSessionStates containsObject:v4])
  {
    [(NSMutableArray *)self->_mediaSessionStates removeObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addMediaSessionState:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_mediaSessionStates containsObject:v4]& 1) == 0)
  {
    [(NSMutableArray *)self->_mediaSessionStates addObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)mediaSessionStateWithIdentifier:(id)a3
{
  v4 = a3;
  if ([v4 hasPrefix:@"direct://"])
  {
    v5 = v4;
    v6 = [v5 substringFromIndex:8];
  }

  else
  {
    v5 = [MEMORY[0x277CCACA8] stringWithFormat:@"direct://%@", v4];
    v6 = v4;
  }

  v7 = v6;
  v8 = [(HMDHome *)self mediaSessionStates];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __43__HMDHome_mediaSessionStateWithIdentifier___block_invoke;
  v13[3] = &unk_279722E28;
  v14 = v5;
  v15 = v7;
  v9 = v7;
  v10 = v5;
  v11 = [v8 na_firstObjectPassingTest:v13];

  return v11;
}

uint64_t __43__HMDHome_mediaSessionStateWithIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 sessionIdentifier];
  if ([v4 isEqualToString:*(a1 + 32)])
  {
    v5 = 1;
  }

  else
  {
    v6 = [v3 sessionIdentifier];
    v5 = [v6 isEqualToString:*(a1 + 40)];
  }

  return v5;
}

- (NSArray)mediaSessionStates
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_mediaSessionStates copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)removeMediaSession:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_mediaSessions containsObject:v4])
  {
    [(NSMutableArray *)self->_mediaSessions removeObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addMediaSession:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_mediaSessions containsObject:v4]& 1) == 0)
  {
    [(NSMutableArray *)self->_mediaSessions addObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)mediaSessionWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSessions];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)mediaSessionWithIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSessions];
  v6 = [v5 hmf_firstObjectWithValue:v4 forKeyPath:@"sessionIdentifier"];

  return v6;
}

- (NSArray)mediaSessions
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_mediaSessions copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)migrateAfterCloudMerge:(id)a3
{
  v4 = a3;
  [(HMDHome *)self setMigrationNeeded:0];
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [MEMORY[0x277CBEB18] array];
    v6 = [MEMORY[0x277CBEB18] array];
    v7 = HMDispatchQueueNameString();
    v8 = [v7 UTF8String];
    v9 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
    v10 = dispatch_queue_create(v8, v9);

    v11 = dispatch_group_create();
    objc_initWeak(location, self);
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke;
    aBlock[3] = &unk_279732670;
    objc_copyWeak(&v42, location);
    v12 = v5;
    v40 = v12;
    v13 = v6;
    v41 = v13;
    v14 = _Block_copy(aBlock);
    dispatch_group_enter(v11);
    v34[0] = MEMORY[0x277D85DD0];
    v34[1] = 3221225472;
    v34[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_4;
    v34[3] = &unk_27972A0E0;
    objc_copyWeak(&v38, location);
    v15 = v12;
    v35 = v15;
    v16 = v13;
    v36 = v16;
    v17 = v11;
    v37 = v17;
    [(HMDHome *)self _migrateHomeSettingsCloudZone:v4 migrationQueue:v10 completion:v34];
    dispatch_group_enter(v17);
    v29[0] = MEMORY[0x277D85DD0];
    v29[1] = 3221225472;
    v29[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_5;
    v29[3] = &unk_27972A0E0;
    objc_copyWeak(&v33, location);
    v18 = v15;
    v30 = v18;
    v19 = v16;
    v31 = v19;
    v20 = v17;
    v32 = v20;
    [(HMDHome *)self _migrateHomeMediaSettingsCloudZone:v4 migrationQueue:v10 completion:v29];
    dispatch_group_enter(v20);
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_6;
    v24[3] = &unk_27972A0E0;
    objc_copyWeak(&v28, location);
    v21 = v18;
    v25 = v21;
    v22 = v19;
    v26 = v22;
    v23 = v20;
    v27 = v23;
    [(HMDHome *)self _migrateHomeUsersCloudZone:v4 migrationQueue:v10 completion:v24];
    dispatch_group_notify(v23, v10, v14);

    objc_destroyWeak(&v28);
    objc_destroyWeak(&v33);

    objc_destroyWeak(&v38);
    objc_destroyWeak(&v42);
    objc_destroyWeak(location);
  }
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke(id *a1)
{
  v1 = a1;
  v67 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v37 = WeakRetained;
    v39 = v1;
    if ([v1[4] count])
    {
      v3 = objc_autoreleasePoolPush();
      v43 = WeakRetained;
      v4 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        v5 = HMFGetLogIdentifier();
        *buf = 138543362;
        v61 = v5;
        _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@General Merge Migrating (Save Transactions)", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v3);
      v6 = [v43 backingStore];
      v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v45 = [v6 transaction:@"generalMergeHomeSaveMigration" options:v7];

      v57 = 0u;
      v58 = 0u;
      v55 = 0u;
      v56 = 0u;
      obj = v39[4];
      v8 = [obj countByEnumeratingWithState:&v55 objects:v66 count:16];
      if (v8)
      {
        v9 = *v56;
        do
        {
          for (i = 0; i != v8; ++i)
          {
            if (*v56 != v9)
            {
              objc_enumerationMutation(obj);
            }

            v11 = *(*(&v55 + 1) + 8 * i);
            v12 = objc_autoreleasePoolPush();
            v13 = v43;
            v14 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
            {
              v15 = HMFGetLogIdentifier();
              v16 = [v13 uuid];
              v17 = [v16 UUIDString];
              *buf = 138543874;
              v61 = v15;
              v62 = 2112;
              v63 = v17;
              v64 = 2112;
              v65 = v11;
              _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_DEBUG, "%{public}@[General Merge Home Migration %@] Object Change: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v12);
            [v45 add:v11 withMessage:0];
          }

          v8 = [obj countByEnumeratingWithState:&v55 objects:v66 count:16];
        }

        while (v8);
      }

      v18 = [v43 metricsDispatcher];
      [v18 submitMigrationEventMetricsForModels:v39[4] reason:@"generalMergeHomeSaveMigration"];

      v1 = v39;
    }

    else
    {
      v45 = 0;
    }

    if ([v1[5] count])
    {
      v19 = objc_autoreleasePoolPush();
      obja = v38;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543362;
        v61 = v21;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@General Merge New Object Migrating (Run Transactions)", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v19);
      v22 = [obja backingStore];
      v23 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v44 = [v22 transaction:@"generalMergeHomeRunNewObjectMigration" options:v23];

      v54 = 0u;
      v52 = 0u;
      v53 = 0u;
      v51 = 0u;
      v40 = v39[5];
      v24 = [v40 countByEnumeratingWithState:&v51 objects:v59 count:16];
      if (v24)
      {
        v25 = *v52;
        do
        {
          for (j = 0; j != v24; ++j)
          {
            if (*v52 != v25)
            {
              objc_enumerationMutation(v40);
            }

            v27 = *(*(&v51 + 1) + 8 * j);
            v28 = objc_autoreleasePoolPush();
            v29 = obja;
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
            {
              v31 = HMFGetLogIdentifier();
              v32 = [v29 uuid];
              v33 = [v32 UUIDString];
              *buf = 138543874;
              v61 = v31;
              v62 = 2112;
              v63 = v33;
              v64 = 2112;
              v65 = v27;
              _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_DEBUG, "%{public}@[General Merge Home New Migration %@] Object Change: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v28);
            [v44 add:v27 withMessage:0];
          }

          v24 = [v40 countByEnumeratingWithState:&v51 objects:v59 count:16];
        }

        while (v24);
      }

      v34 = [obja metricsDispatcher];
      [v34 submitMigrationEventMetricsForModels:v39[5] reason:@"generalMergeHomeRunNewObjectMigration"];

      if (!v45)
      {
        if (v44)
        {
          v46[0] = MEMORY[0x277D85DD0];
          v46[1] = 3221225472;
          v46[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_3;
          v46[3] = &unk_279734708;
          v35 = &v47;
          objc_copyWeak(&v47, v39 + 6);
          [v44 run:v46];
LABEL_34:
          objc_destroyWeak(v35);
        }

LABEL_35:

        WeakRetained = v38;
        goto LABEL_36;
      }
    }

    else
    {
      if (!v45)
      {
        goto LABEL_35;
      }

      v44 = 0;
    }

    v48[0] = MEMORY[0x277D85DD0];
    v48[1] = 3221225472;
    v48[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_1981;
    v48[3] = &unk_2797338E8;
    v35 = &v50;
    objc_copyWeak(&v50, v39 + 6);
    v44 = v44;
    v49 = v44;
    [v45 save:v48];

    goto LABEL_34;
  }

LABEL_36:

  v36 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_4(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_5(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_6(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_1981(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = WeakRetained;
  v6 = *(a1 + 32);
  if (v6)
  {
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_2;
    v9[3] = &unk_279734708;
    objc_copyWeak(&v10, (a1 + 40));
    [v6 run:v9];
    objc_destroyWeak(&v10);
  }

  else
  {
    v7 = [WeakRetained homeManager];
    v8 = [v5 zoneID];
    [v7 uploadHomeToCloudZone:v8 withDelay:0.0];
  }
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained homeManager];
  v2 = [WeakRetained zoneID];
  [v1 uploadHomeToCloudZone:v2 withDelay:0.0];
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained homeManager];
  v2 = [WeakRetained zoneID];
  [v1 uploadHomeToCloudZone:v2 withDelay:0.0];
}

- (void)migrateCloudZone:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  [(HMDHome *)self setMigrationNeeded:0];
  if ([(HMDHome *)self isOwnerUser])
  {
    v8 = [MEMORY[0x277CBEB18] array];
    v9 = [MEMORY[0x277CBEB18] array];
    [(HMDHome *)self setupBackingStore];
    v10 = HMDispatchQueueNameString();
    v11 = [v10 UTF8String];
    v12 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
    v13 = dispatch_queue_create(v11, v12);

    v14 = dispatch_group_create();
    objc_initWeak(location, self);
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke;
    aBlock[3] = &unk_279733CA8;
    objc_copyWeak(&v38, location);
    v15 = v7;
    v37 = v15;
    v16 = v8;
    v35 = v16;
    v17 = v9;
    v36 = v17;
    v18 = _Block_copy(aBlock);
    v25[0] = MEMORY[0x277D85DD0];
    v25[1] = 3221225472;
    v25[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_4;
    v25[3] = &unk_279722E00;
    objc_copyWeak(&v33, location);
    v31 = v15;
    v24 = v6;
    v26 = v6;
    v19 = v14;
    v27 = v19;
    v20 = v13;
    v28 = v20;
    v21 = v16;
    v29 = v21;
    v22 = v17;
    v30 = v22;
    v23 = v18;
    v32 = v23;
    [(HMDHome *)self fetchAllMigratedObjectsForCloudZone:v26 completion:v25];

    objc_destroyWeak(&v33);
    objc_destroyWeak(&v38);
    objc_destroyWeak(location);

    v6 = v24;
  }

  else if (v7)
  {
    (*(v7 + 2))(v7, 0);
  }
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke(id *a1)
{
  v1 = a1;
  v70 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 7);
  if (WeakRetained)
  {
    v39 = WeakRetained;
    v41 = v1;
    if ([v1[4] count])
    {
      v3 = objc_autoreleasePoolPush();
      v45 = WeakRetained;
      v4 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        v5 = HMFGetLogIdentifier();
        *buf = 138543362;
        v64 = v5;
        _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@General Migrating (Save Transactions)", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v3);
      v6 = [v45 backingStore];
      v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v47 = [v6 transaction:@"generalHomeSaveMigration" options:v7];

      v60 = 0u;
      v61 = 0u;
      v58 = 0u;
      v59 = 0u;
      obj = v41[4];
      v8 = [obj countByEnumeratingWithState:&v58 objects:v69 count:16];
      if (v8)
      {
        v9 = *v59;
        do
        {
          for (i = 0; i != v8; ++i)
          {
            if (*v59 != v9)
            {
              objc_enumerationMutation(obj);
            }

            v11 = *(*(&v58 + 1) + 8 * i);
            v12 = objc_autoreleasePoolPush();
            v13 = v45;
            v14 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
            {
              v15 = HMFGetLogIdentifier();
              v16 = [v13 uuid];
              v17 = [v16 UUIDString];
              *buf = 138543874;
              v64 = v15;
              v65 = 2112;
              v66 = v17;
              v67 = 2112;
              v68 = v11;
              _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_DEBUG, "%{public}@[General Home Migration %@] Object Change: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v12);
            [v47 add:v11 withMessage:0];
          }

          v8 = [obj countByEnumeratingWithState:&v58 objects:v69 count:16];
        }

        while (v8);
      }

      v18 = [v45 metricsDispatcher];
      [v18 submitMigrationEventMetricsForModels:v41[4] reason:@"generalHomeSaveMigration"];

      v1 = v41;
    }

    else
    {
      v47 = 0;
    }

    if ([v1[5] count])
    {
      v20 = objc_autoreleasePoolPush();
      obja = v40;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138543362;
        v64 = v22;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@General New Object Migrating (Run Transactions)", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      v23 = [obja backingStore];
      v24 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v46 = [v23 transaction:@"generalHomeRunNewObjectMigration" options:v24];

      v56 = 0u;
      v57 = 0u;
      v54 = 0u;
      v55 = 0u;
      v42 = v41[5];
      v25 = [v42 countByEnumeratingWithState:&v54 objects:v62 count:16];
      if (v25)
      {
        v26 = *v55;
        do
        {
          for (j = 0; j != v25; ++j)
          {
            if (*v55 != v26)
            {
              objc_enumerationMutation(v42);
            }

            v28 = *(*(&v54 + 1) + 8 * j);
            v29 = objc_autoreleasePoolPush();
            v30 = obja;
            v31 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v31, OS_LOG_TYPE_DEBUG))
            {
              v32 = HMFGetLogIdentifier();
              v33 = [v30 uuid];
              v34 = [v33 UUIDString];
              *buf = 138543874;
              v64 = v32;
              v65 = 2112;
              v66 = v34;
              v67 = 2112;
              v68 = v28;
              _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_DEBUG, "%{public}@[General Home New Migration %@] Object Change: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v29);
            [v46 add:v28 withMessage:0];
          }

          v25 = [v42 countByEnumeratingWithState:&v54 objects:v62 count:16];
        }

        while (v25);
      }

      v35 = [obja metricsDispatcher];
      [v35 submitMigrationEventMetricsForModels:v41[5] reason:@"generalHomeRunNewObjectMigration"];

      if (v47)
      {
        v36 = v41;
LABEL_33:
        v50[0] = MEMORY[0x277D85DD0];
        v50[1] = 3221225472;
        v50[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_1964;
        v50[3] = &unk_2797346E0;
        objc_copyWeak(&v53, v36 + 7);
        v46 = v46;
        v51 = v46;
        v52 = v41[6];
        [v47 save:v50];

        objc_destroyWeak(&v53);
LABEL_39:

        WeakRetained = v40;
        goto LABEL_40;
      }

      v36 = v41;
      if (v46)
      {
        v48[0] = MEMORY[0x277D85DD0];
        v48[1] = 3221225472;
        v48[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_3;
        v48[3] = &unk_279734708;
        objc_copyWeak(&v49, v41 + 7);
        [v46 run:v48];
        objc_destroyWeak(&v49);
        v36 = v41;
      }

      else
      {
        v46 = 0;
      }
    }

    else
    {
      v46 = 0;
      v36 = v41;
      if (v47)
      {
        goto LABEL_33;
      }
    }

    v37 = v36[6];
    if (v37)
    {
      v37[2](v37, 0);
    }

    goto LABEL_39;
  }

  v19 = v1[6];
  if (v19)
  {
    v19[2](v19, 0);
  }

LABEL_40:

  v38 = *MEMORY[0x277D85DE8];
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_4(uint64_t a1, void *a2, void *a3)
{
  v96 = *MEMORY[0x277D85DE8];
  v47 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 88));
  v7 = WeakRetained;
  v46 = v5;
  if (WeakRetained)
  {
    v48 = a1;
    v49 = WeakRetained;
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = v49;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v90 = v11;
        v91 = 2112;
        v92 = v46;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to fetch migration changes in this house because of error (%@).", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
    }

    if (![v47 count])
    {
      goto LABEL_20;
    }

    v12 = objc_autoreleasePoolPush();
    v52 = v49;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v90 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@General Object Migrating (Run Transactions)", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v15 = [v52 backingStore];
    v16 = +[HMDBackingStoreTransactionOptions defaultCloudOptions];
    v51 = [v15 transaction:@"generalHomeRunObjectMigration" options:v16];

    v87 = 0u;
    v88 = 0u;
    v85 = 0u;
    v86 = 0u;
    obj = v47;
    v17 = [obj countByEnumeratingWithState:&v85 objects:v95 count:16];
    if (v17)
    {
      v18 = *v86;
      do
      {
        for (i = 0; i != v17; ++i)
        {
          if (*v86 != v18)
          {
            objc_enumerationMutation(obj);
          }

          v20 = *(*(&v85 + 1) + 8 * i);
          v21 = objc_autoreleasePoolPush();
          v22 = v52;
          v23 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
          {
            v24 = HMFGetLogIdentifier();
            v25 = [v22 uuid];
            v26 = [v25 UUIDString];
            *buf = 138543874;
            v90 = v24;
            v91 = 2112;
            v92 = v26;
            v93 = 2112;
            v94 = v20;
            _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_DEBUG, "%{public}@[General Home Migration %@] Object Change: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v21);
          [v51 add:v20 withMessage:0];
        }

        v17 = [obj countByEnumeratingWithState:&v85 objects:v95 count:16];
      }

      while (v17);
    }

    if (v51)
    {
      v78[0] = MEMORY[0x277D85DD0];
      v78[1] = 3221225472;
      v78[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_1968;
      v78[3] = &unk_279722DD8;
      objc_copyWeak(&v84, v48 + 11);
      v82 = v48[9];
      v27 = v48[4];
      v28 = v48[5];
      v29 = v48[6];
      v30 = v48[7];
      *&v31 = v29;
      *(&v31 + 1) = v30;
      *&v32 = v27;
      *(&v32 + 1) = v28;
      v79 = v32;
      v80 = v31;
      v81 = v48[8];
      v83 = v48[10];
      [v51 run:v78];

      objc_destroyWeak(&v84);
    }

    else
    {
LABEL_20:
      dispatch_group_enter(v48[5]);
      v33 = v48[4];
      v34 = v48[6];
      v73[0] = MEMORY[0x277D85DD0];
      v73[1] = 3221225472;
      v73[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_7;
      v73[3] = &unk_27972A0E0;
      objc_copyWeak(&v77, v48 + 11);
      v74 = v48[7];
      v75 = v48[8];
      v76 = v48[5];
      [v49 _migrateResidentDevicesCloudZone:v33 migrationQueue:v34 completion:v73];
      dispatch_group_enter(v48[5]);
      v35 = v48[4];
      v36 = v48[6];
      v68[0] = MEMORY[0x277D85DD0];
      v68[1] = 3221225472;
      v68[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_8;
      v68[3] = &unk_27972A0E0;
      objc_copyWeak(&v72, v48 + 11);
      v69 = v48[7];
      v70 = v48[8];
      v71 = v48[5];
      [v49 _migrateHomeSettingsCloudZone:v35 migrationQueue:v36 completion:v68];
      dispatch_group_enter(v48[5]);
      v37 = v48[4];
      v38 = v48[6];
      v63[0] = MEMORY[0x277D85DD0];
      v63[1] = 3221225472;
      v63[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_9;
      v63[3] = &unk_27972A0E0;
      objc_copyWeak(&v67, v48 + 11);
      v64 = v48[7];
      v65 = v48[8];
      v66 = v48[5];
      [v49 _migrateHomeMediaSettingsCloudZone:v37 migrationQueue:v38 completion:v63];
      dispatch_group_enter(v48[5]);
      v39 = v48[4];
      v40 = v48[6];
      v58[0] = MEMORY[0x277D85DD0];
      v58[1] = 3221225472;
      v58[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_10;
      v58[3] = &unk_27972A0E0;
      objc_copyWeak(&v62, v48 + 11);
      v59 = v48[7];
      v60 = v48[8];
      v61 = v48[5];
      [v49 _migrateHomeUsersCloudZone:v39 migrationQueue:v40 completion:v58];
      dispatch_group_enter(v48[5]);
      v41 = v48[4];
      v42 = v48[6];
      v53[0] = MEMORY[0x277D85DD0];
      v53[1] = 3221225472;
      v53[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_11;
      v53[3] = &unk_27972A0E0;
      objc_copyWeak(&v57, v48 + 11);
      v43 = v48;
      v54 = v48[7];
      v55 = v48[8];
      v56 = v48[5];
      [v49 _migrateAppleMediaAccessoriesWithCloudZone:v41 migrationQueue:v42 completion:v53];
      [v49 _migrateHomeAllObjectsCloudZone:v43[4] migrationGroup:v43[5] migrationQueue:v43[6] saveModels:v43[7] runModels:v43[8]];
      dispatch_group_notify(v43[5], v43[6], v43[10]);

      objc_destroyWeak(&v57);
      objc_destroyWeak(&v62);

      objc_destroyWeak(&v67);
      objc_destroyWeak(&v72);

      objc_destroyWeak(&v77);
    }

    v7 = v49;
  }

  else
  {
    v44 = *(a1 + 72);
    if (v44)
    {
      (*(v44 + 16))(v44, 0);
    }
  }

  v45 = *MEMORY[0x277D85DE8];
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_1968(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 88));
  if (WeakRetained)
  {
    [*(a1 + 32) markMigratedObjectsAsMigrated];
    dispatch_group_enter(*(a1 + 40));
    v5 = *(a1 + 32);
    v6 = *(a1 + 48);
    v36[0] = MEMORY[0x277D85DD0];
    v36[1] = 3221225472;
    v36[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_2_1969;
    v36[3] = &unk_27972A0E0;
    objc_copyWeak(v40, (a1 + 88));
    v37 = *(a1 + 56);
    v38 = *(a1 + 64);
    v39 = *(a1 + 40);
    [WeakRetained _migrateResidentDevicesCloudZone:v5 migrationQueue:v6 completion:v36];
    dispatch_group_enter(*(a1 + 40));
    v7 = *(a1 + 32);
    v8 = *(a1 + 48);
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_3_1970;
    v31[3] = &unk_27972A0E0;
    objc_copyWeak(&v35, (a1 + 88));
    v32 = *(a1 + 56);
    v33 = *(a1 + 64);
    v34 = *(a1 + 40);
    [WeakRetained _migrateHomeSettingsCloudZone:v7 migrationQueue:v8 completion:v31];
    dispatch_group_enter(*(a1 + 40));
    v9 = *(a1 + 32);
    v10 = *(a1 + 48);
    v26[0] = MEMORY[0x277D85DD0];
    v26[1] = 3221225472;
    v26[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_4_1971;
    v26[3] = &unk_27972A0E0;
    objc_copyWeak(&v30, (a1 + 88));
    v27 = *(a1 + 56);
    v28 = *(a1 + 64);
    v29 = *(a1 + 40);
    [WeakRetained _migrateHomeMediaSettingsCloudZone:v9 migrationQueue:v10 completion:v26];
    dispatch_group_enter(*(a1 + 40));
    v11 = *(a1 + 32);
    v12 = *(a1 + 48);
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_5;
    v21[3] = &unk_27972A0E0;
    objc_copyWeak(&v25, (a1 + 88));
    v22 = *(a1 + 56);
    v23 = *(a1 + 64);
    v24 = *(a1 + 40);
    [WeakRetained _migrateHomeUsersCloudZone:v11 migrationQueue:v12 completion:v21];
    dispatch_group_enter(*(a1 + 40));
    v13 = *(a1 + 32);
    v14 = *(a1 + 48);
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_6;
    v16[3] = &unk_27972A0E0;
    objc_copyWeak(&v20, (a1 + 88));
    v17 = *(a1 + 56);
    v18 = *(a1 + 64);
    v19 = *(a1 + 40);
    [WeakRetained _migrateAppleMediaAccessoriesWithCloudZone:v13 migrationQueue:v14 completion:v16];
    [WeakRetained _migrateHomeAllObjectsCloudZone:*(a1 + 32) migrationGroup:*(a1 + 40) migrationQueue:*(a1 + 48) saveModels:*(a1 + 56) runModels:*(a1 + 64)];
    dispatch_group_notify(*(a1 + 40), *(a1 + 48), *(a1 + 80));

    objc_destroyWeak(&v20);
    objc_destroyWeak(&v25);

    objc_destroyWeak(&v30);
    objc_destroyWeak(&v35);

    objc_destroyWeak(v40);
  }

  else
  {
    v15 = *(a1 + 72);
    if (v15)
    {
      (*(v15 + 16))(v15, 0);
    }
  }
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_7(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_8(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_9(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_10(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_11(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_2_1969(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_3_1970(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_4_1971(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_5(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_6(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_1964(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v5 = WeakRetained;
  v6 = *(a1 + 32);
  if (v6)
  {
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_2;
    v10[3] = &unk_279734708;
    objc_copyWeak(&v11, (a1 + 48));
    [v6 run:v10];
    objc_destroyWeak(&v11);
  }

  else
  {
    v7 = [WeakRetained homeManager];
    v8 = [v5 zoneID];
    [v7 uploadHomeToCloudZone:v8 withDelay:0.0];
  }

  v9 = *(a1 + 40);
  if (v9)
  {
    (*(v9 + 16))(v9, 0);
  }
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained homeManager];
  v2 = [WeakRetained zoneID];
  [v1 uploadHomeToCloudZone:v2 withDelay:0.0];
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained homeManager];
  v2 = [WeakRetained zoneID];
  [v1 uploadHomeToCloudZone:v2 withDelay:0.0];
}

- (void)fetchAllMigratedObjectsForCloudZone:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  v41[0] = 0;
  v41[1] = v41;
  v41[2] = 0x3032000000;
  v41[3] = __Block_byref_object_copy__10664;
  v41[4] = __Block_byref_object_dispose__10665;
  v42 = [MEMORY[0x277CBEB18] array];
  v39[0] = 0;
  v39[1] = v39;
  v39[2] = 0x3032000000;
  v39[3] = __Block_byref_object_copy__10664;
  v39[4] = __Block_byref_object_dispose__10665;
  v40 = [MEMORY[0x277CBEB58] set];
  v37[0] = 0;
  v37[1] = v37;
  v37[2] = 0x3032000000;
  v37[3] = __Block_byref_object_copy__10664;
  v37[4] = __Block_byref_object_dispose__10665;
  v38 = [MEMORY[0x277CBEB18] array];
  v35[0] = 0;
  v35[1] = v35;
  v35[2] = 0x3032000000;
  v35[3] = __Block_byref_object_copy__10664;
  v35[4] = __Block_byref_object_dispose__10665;
  v36 = 0;
  v8 = HMDispatchQueueNameString();
  v9 = [v8 UTF8String];
  v10 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
  v11 = dispatch_queue_create(v9, v10);

  v12 = dispatch_group_create();
  dispatch_group_enter(v12);
  objc_initWeak(&location, self);
  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke;
  v27[3] = &unk_279722D60;
  objc_copyWeak(&v33, &location);
  v29 = v35;
  v13 = v12;
  v28 = v13;
  v30 = v41;
  v31 = v39;
  v32 = v37;
  [v6 fetchMigratedObjects:v27];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke_1954;
  block[3] = &unk_279722DB0;
  v22 = v37;
  v23 = v41;
  v24 = v35;
  block[4] = self;
  v19 = v6;
  v14 = v7;
  v20 = v11;
  v21 = v7;
  v15 = v11;
  v16 = v6;
  v17 = v14;
  objc_copyWeak(&v26, &location);
  v25 = v39;
  dispatch_group_notify(v13, v15, block);
  objc_destroyWeak(&v26);

  objc_destroyWeak(&v33);
  objc_destroyWeak(&location);

  _Block_object_dispose(v35, 8);
  _Block_object_dispose(v37, 8);

  _Block_object_dispose(v39, 8);
  _Block_object_dispose(v41, 8);
}

void __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v53 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  v8 = WeakRetained;
  if (v6 || !WeakRetained)
  {
    objc_storeStrong((*(*(a1 + 40) + 8) + 40), a3);
  }

  else if ([v5 count])
  {
    v9 = objc_autoreleasePoolPush();
    v43 = v8;
    v10 = v8;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v52 = v12;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Found General Objects to Migrate", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v13 = [MEMORY[0x277CBEB18] array];
    v14 = *(*(a1 + 48) + 8);
    v15 = *(v14 + 40);
    *(v14 + 40) = v13;

    v16 = [MEMORY[0x277CBEB58] set];
    v17 = *(*(a1 + 56) + 8);
    v18 = *(v17 + 40);
    *(v17 + 40) = v16;

    v19 = [MEMORY[0x277CBEB18] array];
    v20 = *(*(a1 + 64) + 8);
    v21 = *(v20 + 40);
    *(v20 + 40) = v19;

    v48 = 0u;
    v49 = 0u;
    v46 = 0u;
    v47 = 0u;
    v44 = v5;
    obj = v5;
    v22 = [obj countByEnumeratingWithState:&v46 objects:v50 count:16];
    if (v22)
    {
      v23 = v22;
      v24 = *v47;
      do
      {
        for (i = 0; i != v23; ++i)
        {
          if (*v47 != v24)
          {
            objc_enumerationMutation(obj);
          }

          v26 = *(*(&v46 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v27 = v26;
          }

          else
          {
            v27 = 0;
          }

          v28 = v27;

          if (v28)
          {
            v29 = [v28 uuid];
            v30 = [v10 accessoryWithUUID:v29];

            if (!v30)
            {
              v31 = *(*(*(a1 + 64) + 8) + 40);
              v32 = [v28 uuid];
              [v31 addObject:v32];
            }
          }

          v33 = v26;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v34 = v33;
          }

          else
          {
            v34 = 0;
          }

          v35 = v34;

          if (v35)
          {
            v36 = [v35 uuid];
            v37 = [v10 accessoryWithUUID:v36];

            if (!v37)
            {
              v38 = *(*(*(a1 + 64) + 8) + 40);
              v39 = [v35 uuid];
              [v38 addObject:v39];
            }
          }

          [*(*(*(a1 + 48) + 8) + 40) addObject:{v33, v43}];
          v40 = *(*(*(a1 + 56) + 8) + 40);
          v41 = [v33 uuid];
          [v40 addObject:v41];
        }

        v23 = [obj countByEnumeratingWithState:&v46 objects:v50 count:16];
      }

      while (v23);
    }

    v6 = 0;
    v5 = v44;
    v8 = v43;
  }

  dispatch_group_leave(*(a1 + 32));

  v42 = *MEMORY[0x277D85DE8];
}

void __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke_1954(uint64_t a1)
{
  if ([*(*(*(a1 + 64) + 8) + 40) count])
  {
    v2 = *(a1 + 32);
    v3 = *(a1 + 40);
    v4 = *(*(*(a1 + 64) + 8) + 40);
    v5 = *(a1 + 48);
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke_2;
    v12[3] = &unk_279722D88;
    objc_copyWeak(&v17, (a1 + 96));
    v6 = *(a1 + 72);
    v14 = *(a1 + 88);
    v15 = v6;
    v7 = *(a1 + 56);
    v8 = *(a1 + 80);
    v13 = v7;
    v16 = v8;
    [v2 _migrateUnknownAccessoriesWithCloudZone:v3 accessoryUUIDs:v4 migrationQueue:v5 completion:v12];

    objc_destroyWeak(&v17);
  }

  else
  {
    v9 = *(*(*(a1 + 72) + 8) + 40);
    v10 = *(*(*(a1 + 80) + 8) + 40);
    v11 = *(*(a1 + 56) + 16);

    v11();
  }
}

void __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke_2(uint64_t a1, void *a2, uint64_t a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v7 = WeakRetained;
  if (!a3 && WeakRetained)
  {
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v8 = v5;
    v9 = [v8 countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v22;
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v22 != v11)
          {
            objc_enumerationMutation(v8);
          }

          v13 = *(*(&v21 + 1) + 8 * i);
          v14 = *(*(*(a1 + 40) + 8) + 40);
          v15 = [v13 uuid];
          LOBYTE(v14) = [v14 containsObject:v15];

          if ((v14 & 1) == 0)
          {
            [*(*(*(a1 + 48) + 8) + 40) addObject:v13];
            v16 = *(*(*(a1 + 40) + 8) + 40);
            v17 = [v13 uuid];
            [v16 addObject:v17];
          }
        }

        v10 = [v8 countByEnumeratingWithState:&v21 objects:v25 count:16];
      }

      while (v10);
    }
  }

  v18 = *(*(*(a1 + 48) + 8) + 40);
  v19 = *(*(*(a1 + 56) + 8) + 40);
  (*(*(a1 + 32) + 16))();

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_migrateUnknownAccessoriesWithCloudZone:(id)a3 accessoryUUIDs:(id)a4 migrationQueue:(id)a5 completion:(id)a6
{
  v40 = *MEMORY[0x277D85DE8];
  v27 = a3;
  v9 = a4;
  queue = a5;
  v24 = a6;
  v10 = [MEMORY[0x277CBEB18] array];
  v11 = HMDispatchQueueNameString();
  v12 = [v11 UTF8String];
  v13 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
  v14 = dispatch_queue_create(v12, v13);

  v15 = dispatch_group_create();
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  obj = v9;
  v16 = [obj countByEnumeratingWithState:&v35 objects:v39 count:16];
  if (v16)
  {
    v17 = v16;
    v18 = *v36;
    do
    {
      v19 = 0;
      do
      {
        if (*v36 != v18)
        {
          objc_enumerationMutation(obj);
        }

        v20 = *(*(&v35 + 1) + 8 * v19);
        dispatch_group_enter(v15);
        v31[0] = MEMORY[0x277D85DD0];
        v31[1] = 3221225472;
        v31[2] = __92__HMDHome__migrateUnknownAccessoriesWithCloudZone_accessoryUUIDs_migrationQueue_completion___block_invoke;
        v31[3] = &unk_279733F88;
        v32 = v14;
        v33 = v10;
        v34 = v15;
        [v27 allDescendentsCloudRecordsForParentID:v20 completionHandler:v31];

        ++v19;
      }

      while (v17 != v19);
      v17 = [obj countByEnumeratingWithState:&v35 objects:v39 count:16];
    }

    while (v17);
  }

  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __92__HMDHome__migrateUnknownAccessoriesWithCloudZone_accessoryUUIDs_migrationQueue_completion___block_invoke_3;
  block[3] = &unk_279735738;
  v29 = v10;
  v30 = v24;
  v21 = v10;
  v22 = v24;
  dispatch_group_notify(v15, queue, block);

  v23 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome__migrateUnknownAccessoriesWithCloudZone_accessoryUUIDs_migrationQueue_completion___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v5, "count")}];
  if (!a3)
  {
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v7 = v5;
    v8 = [v7 countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v22;
      do
      {
        v11 = 0;
        do
        {
          if (*v22 != v10)
          {
            objc_enumerationMutation(v7);
          }

          v12 = [*(*(&v21 + 1) + 8 * v11) extractObjectChange];
          v13 = v12;
          if (v12)
          {
            [v12 setObjectChangeType:1];
            [v6 addObject:v13];
          }

          ++v11;
        }

        while (v9 != v11);
        v9 = [v7 countByEnumeratingWithState:&v21 objects:v25 count:16];
      }

      while (v9);
    }
  }

  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __92__HMDHome__migrateUnknownAccessoriesWithCloudZone_accessoryUUIDs_migrationQueue_completion___block_invoke_2;
  block[3] = &unk_279734960;
  v14 = *(a1 + 32);
  v18 = *(a1 + 40);
  v19 = v6;
  v20 = *(a1 + 48);
  v15 = v6;
  dispatch_async(v14, block);

  v16 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome__migrateUnknownAccessoriesWithCloudZone_accessoryUUIDs_migrationQueue_completion___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) addObjectsFromArray:*(a1 + 40)];
  v2 = *(a1 + 48);

  dispatch_group_leave(v2);
}

- (void)_migrateHomeAllObjectsCloudZone:(id)a3 migrationGroup:(id)a4 migrationQueue:(id)a5 saveModels:(id)a6 runModels:(id)a7
{
  v90 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke;
  aBlock[3] = &unk_279722D10;
  v65 = v14;
  v79 = v65;
  objc_copyWeak(&v83, &location);
  v64 = v15;
  v80 = v64;
  v66 = v16;
  v81 = v66;
  v17 = v13;
  v82 = v17;
  v18 = _Block_copy(aBlock);
  v73[0] = MEMORY[0x277D85DD0];
  v73[1] = 3221225472;
  v73[2] = __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke_3;
  v73[3] = &unk_279722D38;
  group = v17;
  v74 = group;
  v75 = self;
  v63 = v12;
  v76 = v63;
  v68 = v18;
  v77 = v68;
  v69 = _Block_copy(v73);
  v19 = [(HMDHome *)self uuid];
  v20 = [HMDHomeNetworkRouterManagingDeviceSettingsModel defaultModelForHomeUUID:v19];
  v69[2](v69, v20);

  v21 = [(HMDHome *)self uuid];
  v70 = [HMDHomeNetworkRouterSettingsModel defaultModelForHomeUUID:v21];

  v22 = [(HMDHome *)self activeNetworkRouterUUID];
  v23 = [v22 UUIDString];
  [v70 setActiveNetworkRouterAccessoryUUID:v23];

  v24 = [(HMDHome *)self minimumNetworkRouterSupportHomeKitVersion];
  v25 = [v24 versionString];
  [v70 setMinimumNetworkRouterSupportHomeKitVersion:v25];

  v26 = [(HMDHome *)self minHomeKitVersionForAccessoryNetworkProtectionChange];
  v27 = [v26 versionString];
  [v70 setMinHomeKitVersionForAccessoryNetworkProtectionChange:v27];

  v69[2](v69, v70);
  v28 = MEMORY[0x277CBEB18];
  v29 = [(HMDHome *)self accessories];
  v30 = [v28 arrayWithCapacity:{objc_msgSend(v29, "count")}];

  v31 = self;
  v71 = v30;
  v72 = v31;
  v85 = 0u;
  v86 = 0u;
  v87 = 0u;
  v88 = 0u;
  v32 = [(HMDHome *)v31 accessories];
  v33 = [v32 countByEnumeratingWithState:&v85 objects:v89 count:16];
  if (v33)
  {
    v34 = *v86;
    do
    {
      v35 = 0;
      do
      {
        if (*v86 != v34)
        {
          objc_enumerationMutation(v32);
        }

        v36 = *(*(&v85 + 1) + 8 * v35);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v37 = v36;
        }

        else
        {
          v37 = 0;
        }

        v38 = v37;

        if (v38)
        {
          v39 = objc_alloc([objc_opt_class() transactionClass]);
          v40 = [v38 uuid];
          v41 = [(HMDHome *)v72 uuid];
          v42 = [v39 initWithObjectChangeType:2 uuid:v40 parentUUID:v41];

          v43 = [v38 initialManufacturer];
          if (v43)
          {
            v44 = 0;
            goto LABEL_14;
          }

          v45 = [v38 manufacturer];
          v46 = v45 == 0;

          if (v46)
          {
            v44 = 0;
          }

          else
          {
            v43 = [v38 manufacturer];
            [v42 setInitialManufacturer:v43];
            v44 = 1;
LABEL_14:
          }

          v47 = [v38 initialModel];
          if (v47)
          {
LABEL_18:
          }

          else
          {
            v48 = [v38 model];
            v49 = v48 == 0;

            if (!v49)
            {
              v47 = [v38 model];
              [v42 setInitialModel:v47];
              v44 = 1;
              goto LABEL_18;
            }
          }

          v50 = [v38 initialCategoryIdentifier];
          if (v50)
          {
LABEL_20:
          }

          else
          {
            v53 = [v38 category];
            v54 = v53 == 0;

            if (!v54)
            {
              v55 = MEMORY[0x277CD1680];
              v56 = [v38 category];
              v50 = [v55 categoryIdentifierForCategory:v56];

              if (v50)
              {
                v57 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:1];
                v58 = [v50 isEqualToNumber:v57];

                if ((v58 & 1) == 0)
                {
                  [v42 setInitialCategoryIdentifier:v50];
                  v44 = 1;
                }
              }

              goto LABEL_20;
            }
          }

          v51 = [v38 initialServiceTypeUUIDs];
          v52 = v51 == 0;

          if (v52)
          {
            v59 = [v38 serviceTypeUUIDs];
            [v42 setInitialServiceTypeUUIDs:v59];
          }

          else if (!v44)
          {
            goto LABEL_30;
          }

          [v71 addObject:v42];
LABEL_30:
        }

        ++v35;
      }

      while (v33 != v35);
      v60 = [v32 countByEnumeratingWithState:&v85 objects:v89 count:16];
      v33 = v60;
    }

    while (v60);
  }

  if ([v71 count])
  {
    dispatch_group_enter(group);
    v61 = [MEMORY[0x277CBEA60] array];
    (*(v68 + 2))(v68, v61, v71, 0);
  }

  objc_destroyWeak(&v83);
  objc_destroyWeak(&location);

  v62 = *MEMORY[0x277D85DE8];
}

void __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke_2;
  block[3] = &unk_279722CE8;
  objc_copyWeak(&v21, (a1 + 64));
  v15 = v9;
  v16 = *(a1 + 40);
  v17 = v7;
  v18 = *(a1 + 48);
  v19 = v8;
  v20 = *(a1 + 56);
  v11 = v8;
  v12 = v7;
  v13 = v9;
  dispatch_async(v10, block);

  objc_destroyWeak(&v21);
}

void __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke_3(uint64_t a1, void *a2)
{
  v3 = *(a1 + 32);
  v4 = a2;
  dispatch_group_enter(v3);
  [*(a1 + 40) _migrateHomeObjectCloudZone:*(a1 + 48) defaultModel:v4 completion:*(a1 + 56)];
}

void __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  if (WeakRetained && !*(a1 + 32))
  {
    [*(a1 + 40) addObjectsFromArray:*(a1 + 48)];
    [*(a1 + 56) addObjectsFromArray:*(a1 + 64)];
  }

  dispatch_group_leave(*(a1 + 72));
}

- (void)_migrateHomeObjectCloudZone:(id)a3 defaultModel:(id)a4 completion:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [MEMORY[0x277CBEB18] array];
  v12 = [MEMORY[0x277CBEB18] array];
  objc_initWeak(&location, self);
  v13 = [v9 uuid];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __63__HMDHome__migrateHomeObjectCloudZone_defaultModel_completion___block_invoke;
  v18[3] = &unk_279722CC0;
  objc_copyWeak(&v23, &location);
  v14 = v10;
  v22 = v14;
  v15 = v11;
  v19 = v15;
  v16 = v12;
  v20 = v16;
  v17 = v9;
  v21 = v17;
  [v8 cloudRecordWithObjectID:v13 completionHandler:v18];

  objc_destroyWeak(&v23);
  objc_destroyWeak(&location);
}

void __63__HMDHome__migrateHomeObjectCloudZone_defaultModel_completion___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 8);
  if (WeakRetained && !v5)
  {
    v10 = [a1[6] uuid];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __63__HMDHome__migrateHomeObjectCloudZone_defaultModel_completion___block_invoke_2;
    v16[3] = &unk_279730C48;
    objc_copyWeak(&v19, a1 + 8);
    v11 = a1[4];
    v12 = a1[6];
    v13 = a1[7];
    *&v14 = a1[5];
    *(&v14 + 1) = v13;
    *&v15 = v11;
    *(&v15 + 1) = v12;
    v17 = v15;
    v18 = v14;
    [WeakRetained cleanChangesIfNoAddChangeObjectID:v10 completion:v16];

    objc_destroyWeak(&v19);
  }

  else
  {
    v8 = a1[4];
    v9 = a1[5];
    (*(a1[7] + 2))();
  }
}

void __63__HMDHome__migrateHomeObjectCloudZone_defaultModel_completion___block_invoke_2(uint64_t a1, char a2)
{
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained && (a2 & 1) == 0)
  {
    [*(a1 + 32) addObject:*(a1 + 40)];
  }

  v4 = *(a1 + 32);
  v5 = *(a1 + 48);
  (*(*(a1 + 56) + 16))();
}

- (void)_migrateAppleMediaAccessoriesWithCloudZone:(id)a3 migrationQueue:(id)a4 completion:(id)a5
{
  v8 = a3;
  v9 = a5;
  v10 = a4;
  v11 = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v12 = v11;
  }

  else
  {
    v12 = 0;
  }

  v13 = v12;

  if (v13)
  {
    [v13 migrateWithCloudZone:v8 migrationQueue:v10 completion:v9];
  }

  else
  {
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __80__HMDHome__migrateAppleMediaAccessoriesWithCloudZone_migrationQueue_completion___block_invoke;
    block[3] = &unk_2797348C0;
    v15 = v9;
    dispatch_async(v10, block);

    v10 = v15;
  }
}

- (void)_migrateHomeUsersCloudZone:(id)a3 migrationQueue:(id)a4 completion:(id)a5
{
  v39 = *MEMORY[0x277D85DE8];
  v22 = a3;
  queue = a4;
  v21 = a5;
  v8 = [MEMORY[0x277CBEB18] array];
  v9 = [MEMORY[0x277CBEB18] array];
  v10 = dispatch_group_create();
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v11 = [(HMDHome *)self users];
  v12 = [v11 copy];

  v13 = [v12 countByEnumeratingWithState:&v34 objects:v38 count:16];
  if (v13)
  {
    v14 = *v35;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v35 != v14)
        {
          objc_enumerationMutation(v12);
        }

        v16 = *(*(&v34 + 1) + 8 * i);
        dispatch_group_enter(v10);
        objc_initWeak(&location, self);
        v28[0] = MEMORY[0x277D85DD0];
        v28[1] = 3221225472;
        v28[2] = __64__HMDHome__migrateHomeUsersCloudZone_migrationQueue_completion___block_invoke;
        v28[3] = &unk_27972A0E0;
        objc_copyWeak(&v32, &location);
        v29 = v8;
        v30 = v9;
        v31 = v10;
        [v16 migrateCloudZone:v22 migrationQueue:queue completion:v28];

        objc_destroyWeak(&v32);
        objc_destroyWeak(&location);
      }

      v13 = [v12 countByEnumeratingWithState:&v34 objects:v38 count:16];
    }

    while (v13);
  }

  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __64__HMDHome__migrateHomeUsersCloudZone_migrationQueue_completion___block_invoke_2;
  block[3] = &unk_2797355D0;
  v26 = v9;
  v27 = v21;
  v25 = v8;
  v17 = v9;
  v18 = v8;
  v19 = v21;
  dispatch_group_notify(v10, queue, block);

  v20 = *MEMORY[0x277D85DE8];
}

void __64__HMDHome__migrateHomeUsersCloudZone_migrationQueue_completion___block_invoke(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

- (void)_migrateHomeMediaSettingsCloudZone:(id)a3 migrationQueue:(id)a4 completion:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [MEMORY[0x277CBEB18] array];
  v12 = [MEMORY[0x277CBEB18] array];
  v13 = [(HMDHome *)self uuid];
  v14 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:v13];

  objc_initWeak(&location, self);
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke;
  v20[3] = &unk_279722C98;
  objc_copyWeak(&v26, &location);
  v15 = v9;
  v21 = v15;
  v16 = v10;
  v25 = v16;
  v17 = v11;
  v22 = v17;
  v18 = v12;
  v23 = v18;
  v19 = v14;
  v24 = v19;
  [v8 cloudRecordWithObjectID:v19 completionHandler:v20];

  objc_destroyWeak(&v26);
  objc_destroyWeak(&location);
}

void __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  if (!WeakRetained)
  {
    v11 = *(a1 + 32);
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke_2;
    v23[3] = &unk_2797355D0;
    v26 = *(a1 + 64);
    v24 = *(a1 + 40);
    v25 = *(a1 + 48);
    dispatch_async(v11, v23);

    v10 = v26;
    goto LABEL_6;
  }

  if (!v5)
  {
    v12 = *(a1 + 56);
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke_3;
    v17[3] = &unk_279730C48;
    objc_copyWeak(&v22, (a1 + 72));
    v18 = *(a1 + 48);
    v21 = *(a1 + 64);
    v19 = *(a1 + 32);
    v20 = *(a1 + 40);
    [WeakRetained cleanChangesIfNoAddChangeObjectID:v12 completion:v17];

    objc_destroyWeak(&v22);
    goto LABEL_8;
  }

  v8 = *(a1 + 64);
  if (v8)
  {
    v9 = *(a1 + 32);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke_2_1945;
    block[3] = &unk_2797355D0;
    v16 = v8;
    v14 = *(a1 + 40);
    v15 = *(a1 + 48);
    dispatch_async(v9, block);

    v10 = v16;
LABEL_6:
  }

LABEL_8:
}

void __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke_3(uint64_t a1, char a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained && (a2 & 1) == 0)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v21 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Creating home media settings and adding transaction to push to cloud", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [v8 uuid];
    v12 = [HMDHomeMediaSettingsModel defaultModelForHomeUUID:v11];

    [*(a1 + 32) addObject:v12];
  }

  v13 = *(a1 + 56);
  if (v13)
  {
    v14 = *(a1 + 40);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke_1944;
    block[3] = &unk_2797355D0;
    v19 = v13;
    v17 = *(a1 + 48);
    v18 = *(a1 + 32);
    dispatch_async(v14, block);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_migrateHomeSettingsCloudZone:(id)a3 migrationQueue:(id)a4 completion:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [MEMORY[0x277CBEB18] array];
  v12 = [MEMORY[0x277CBEB18] array];
  v13 = [(HMDHome *)self uuid];
  v14 = [HMDHomeSettingsModel modelIDForHomeUUID:v13];

  objc_initWeak(&location, self);
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke;
  v20[3] = &unk_279722C98;
  objc_copyWeak(&v26, &location);
  v15 = v9;
  v21 = v15;
  v16 = v10;
  v25 = v16;
  v17 = v11;
  v22 = v17;
  v18 = v12;
  v23 = v18;
  v19 = v14;
  v24 = v19;
  [v8 cloudRecordWithObjectID:v19 completionHandler:v20];

  objc_destroyWeak(&v26);
  objc_destroyWeak(&location);
}

void __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  if (!WeakRetained)
  {
    v11 = *(a1 + 32);
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke_2;
    v23[3] = &unk_2797355D0;
    v26 = *(a1 + 64);
    v24 = *(a1 + 40);
    v25 = *(a1 + 48);
    dispatch_async(v11, v23);

    v10 = v26;
    goto LABEL_6;
  }

  if (!v5)
  {
    v12 = *(a1 + 56);
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke_3;
    v17[3] = &unk_279730C48;
    objc_copyWeak(&v22, (a1 + 72));
    v18 = *(a1 + 48);
    v21 = *(a1 + 64);
    v19 = *(a1 + 32);
    v20 = *(a1 + 40);
    [WeakRetained cleanChangesIfNoAddChangeObjectID:v12 completion:v17];

    objc_destroyWeak(&v22);
    goto LABEL_8;
  }

  v8 = *(a1 + 64);
  if (v8)
  {
    v9 = *(a1 + 32);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke_2_1943;
    block[3] = &unk_2797355D0;
    v16 = v8;
    v14 = *(a1 + 40);
    v15 = *(a1 + 48);
    dispatch_async(v9, block);

    v10 = v16;
LABEL_6:
  }

LABEL_8:
}

void __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke_3(uint64_t a1, char a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained && (a2 & 1) == 0)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v21 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Creating home settings and adding transaction to push to cloud", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [v8 uuid];
    v12 = [HMDHomeSettingsModel defaultModelForHomeUUID:v11];

    [*(a1 + 32) addObject:v12];
  }

  v13 = *(a1 + 56);
  if (v13)
  {
    v14 = *(a1 + 40);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke_1942;
    block[3] = &unk_2797355D0;
    v19 = v13;
    v17 = *(a1 + 48);
    v18 = *(a1 + 32);
    dispatch_async(v14, block);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_migrateResidentDevicesCloudZone:(id)a3 migrationQueue:(id)a4 completion:(id)a5
{
  v42 = *MEMORY[0x277D85DE8];
  v23 = a3;
  v8 = a4;
  v9 = a5;
  v10 = [MEMORY[0x277CBEB18] array];
  v11 = [MEMORY[0x277CBEB18] array];
  v39 = 0u;
  v40 = 0u;
  v37 = 0u;
  v38 = 0u;
  v12 = [(HMDHome *)self residentDeviceManager];
  v13 = [v12 residentDevices];

  v14 = [v13 countByEnumeratingWithState:&v37 objects:v41 count:16];
  if (v14)
  {
    v15 = *v38;
LABEL_3:
    v16 = 0;
    while (1)
    {
      if (*v38 != v15)
      {
        objc_enumerationMutation(v13);
      }

      v17 = *(*(&v37 + 1) + 8 * v16);
      if ([v17 isCurrentDevice])
      {
        break;
      }

      if (v14 == ++v16)
      {
        v14 = [v13 countByEnumeratingWithState:&v37 objects:v41 count:16];
        if (v14)
        {
          goto LABEL_3;
        }

        goto LABEL_9;
      }
    }

    v18 = v17;

    if (!v18)
    {
      goto LABEL_12;
    }

    v19 = [v18 identifier];
    objc_initWeak(&location, self);
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_2;
    v24[3] = &unk_279722C70;
    objc_copyWeak(&v31, &location);
    v25 = v8;
    v30 = v9;
    v26 = v10;
    v27 = v11;
    v20 = v19;
    v28 = v20;
    v21 = v18;
    v29 = v21;
    [v23 cloudRecordWithObjectID:v20 completionHandler:v24];

    objc_destroyWeak(&v31);
    objc_destroyWeak(&location);

    goto LABEL_14;
  }

LABEL_9:

LABEL_12:
  if (v9)
  {
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke;
    block[3] = &unk_2797355D0;
    v36 = v9;
    v34 = v10;
    v35 = v11;
    dispatch_async(v8, block);

    v21 = v36;
LABEL_14:
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  if (!WeakRetained)
  {
    v11 = *(a1 + 32);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_3;
    block[3] = &unk_2797355D0;
    v27 = *(a1 + 72);
    v25 = *(a1 + 40);
    v26 = *(a1 + 48);
    dispatch_async(v11, block);

    v10 = v27;
    goto LABEL_6;
  }

  if (!v5)
  {
    v12 = *(a1 + 56);
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_4;
    v17[3] = &unk_279722C48;
    objc_copyWeak(&v23, (a1 + 80));
    v18 = *(a1 + 64);
    v19 = *(a1 + 40);
    v22 = *(a1 + 72);
    v20 = *(a1 + 32);
    v21 = *(a1 + 48);
    [WeakRetained cleanChangesIfNoAddChangeObjectID:v12 completion:v17];

    objc_destroyWeak(&v23);
    goto LABEL_8;
  }

  v8 = *(a1 + 72);
  if (v8)
  {
    v9 = *(a1 + 32);
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_2_1940;
    v13[3] = &unk_2797355D0;
    v16 = v8;
    v14 = *(a1 + 40);
    v15 = *(a1 + 48);
    dispatch_async(v9, v13);

    v10 = v16;
LABEL_6:
  }

LABEL_8:
}

void __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_4(uint64_t a1, char a2, void *a3)
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  if (WeakRetained && (a2 & 1) == 0)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v20 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Creating resident device and adding transaction to push to cloud", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [*(a1 + 32) modelObjectWithChangeType:1 version:4];
    [*(a1 + 40) addObject:v11];
  }

  v12 = *(a1 + 64);
  if (v12)
  {
    v13 = *(a1 + 48);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_1939;
    block[3] = &unk_2797355D0;
    v18 = v12;
    v16 = *(a1 + 40);
    v17 = *(a1 + 56);
    dispatch_async(v13, block);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)cleanChangesIfNoAddChangeObjectID:(id)a3 completion:(id)a4
{
  v48 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (v6)
  {
    *&v45 = 0;
    *(&v45 + 1) = &v45;
    v46 = 0x2020000000;
    v47 = 0;
    v8 = [MEMORY[0x277CBEB58] set];
    objc_initWeak(&location, self);
    v9 = [HMDBackingStoreLogFetchOperation alloc];
    v35[0] = MEMORY[0x277D85DD0];
    v35[1] = 3221225472;
    v35[2] = __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke;
    v35[3] = &unk_279722C20;
    v10 = v6;
    v36 = v10;
    v11 = v8;
    v38 = self;
    v39 = &v45;
    v37 = v11;
    v12 = [(HMDBackingStoreLogFetchOperation *)v9 initWithNeedsPushTo:2 result:v35];
    v26 = MEMORY[0x277D85DD0];
    v27 = 3221225472;
    v28 = __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke_1938;
    v29 = &unk_279732DE0;
    objc_copyWeak(&v34, &location);
    v33 = &v45;
    v13 = v11;
    v30 = v13;
    v14 = v10;
    v31 = v14;
    v32 = v7;
    [(HMDBackingStoreOperation *)v12 setResultBlock:&v26];
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v42 = v18;
      v43 = 2112;
      v44 = v14;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_DEBUG, "%{public}@Cleaning of objects for %@ from datastore started", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    v19 = [(HMDHome *)v16 backingStore:v26];
    [v19 submit:v12];

    objc_destroyWeak(&v34);
    objc_destroyWeak(&location);

    _Block_object_dispose(&v45, 8);
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      LODWORD(v45) = 138543362;
      *(&v45 + 4) = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@ObjectID must be defined", &v45, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    (*(v7 + 2))(v7, 0, v24);
  }

  v25 = *MEMORY[0x277D85DE8];
}

uint64_t __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v38 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v29 = 0u;
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v10 = v7;
  v11 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
  if (v11)
  {
    v12 = v11;
    v27 = v9;
    v28 = v8;
    v13 = *v30;
    while (2)
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v30 != v13)
        {
          objc_enumerationMutation(v10);
        }

        v15 = *(*(&v29 + 1) + 8 * i);
        v16 = [v15 uuid];
        v17 = [v16 isEqual:*(a1 + 32)];

        if (v17)
        {
          if ([v15 objectChangeType] == 1 && !objc_msgSend(*(a1 + 40), "count"))
          {
            v24 = 0;
            *(*(*(a1 + 56) + 8) + 24) = 1;
            goto LABEL_16;
          }

          v18 = objc_autoreleasePoolPush();
          v19 = *(a1 + 48);
          v20 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
          {
            v21 = HMFGetLogIdentifier();
            *buf = 138543618;
            v34 = v21;
            v35 = 2112;
            v36 = v15;
            _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Removing object change from homes transaction store %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v18);
          v22 = *(a1 + 40);
          v23 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:{objc_msgSend(v15, "bsoLogRowID")}];
          [v22 addObject:v23];
        }
      }

      v12 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
      if (v12)
      {
        continue;
      }

      break;
    }

    v24 = 1;
LABEL_16:
    v9 = v27;
    v8 = v28;
  }

  else
  {
    v24 = 1;
  }

  v25 = *MEMORY[0x277D85DE8];
  return v24;
}

void __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke_1938(uint64_t a1, void *a2)
{
  v30 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained && (*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && [*(a1 + 32) count])
  {
    v5 = [HMDBackingStoreLogUpdateOperation alloc];
    v6 = [*(a1 + 32) allObjects];
    v7 = [(HMDBackingStoreLogUpdateOperation *)v5 initWithRowIDs:v6 successfullyPushedTo:3];

    v18 = MEMORY[0x277D85DD0];
    v19 = 3221225472;
    v20 = __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke_2;
    v21 = &unk_279732DB8;
    objc_copyWeak(&v25, (a1 + 64));
    v22 = *(a1 + 40);
    v8 = *(a1 + 48);
    v9 = *(a1 + 56);
    v23 = v8;
    v24 = v9;
    [(HMDBackingStoreOperation *)v7 setResultBlock:&v18];
    v10 = objc_autoreleasePoolPush();
    v11 = WeakRetained;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 40);
      *buf = 138543618;
      v27 = v13;
      v28 = 2112;
      v29 = v14;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEBUG, "%{public}@Scheduling cleanup of objects for %@ in home in datastore", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v15 = [v11 backingStore];
    [v15 submit:v7];

    objc_destroyWeak(&v25);
  }

  else
  {
    v16 = *(a1 + 48);
    if (v16)
    {
      (*(v16 + 16))(v16, *(*(*(a1 + 56) + 8) + 24), v3);
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    v9 = *(a1 + 32);
    v12 = 138543618;
    v13 = v8;
    v14 = 2112;
    v15 = v9;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Cleaned objects for %@ in home in datastore", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = *(a1 + 40);
  if (v10)
  {
    (*(v10 + 16))(v10, *(*(*(a1 + 48) + 8) + 24), v3);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)dropAllChangesWithObjectID:(id)a3
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = v4;
  if (v4)
  {
    v12 = v4;
    v6 = [MEMORY[0x277CBEA60] arrayWithObjects:&v12 count:1];
    [(HMDHome *)self dropAllChangesWithArrayOfObjectIDs:v6];
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@ObjectID must be defined", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)dropAllChangesWithArrayOfObjectIDs:(id)a3
{
  v31 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277CBEB58] set];
  objc_initWeak(&location, self);
  v6 = [HMDBackingStoreLogFetchOperation alloc];
  v22[0] = MEMORY[0x277D85DD0];
  v22[1] = 3221225472;
  v22[2] = __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke;
  v22[3] = &unk_279722BF8;
  v7 = v4;
  v23 = v7;
  v24 = self;
  v8 = v5;
  v25 = v8;
  v9 = [(HMDBackingStoreLogFetchOperation *)v6 initWithNeedsPushTo:2 result:v22];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke_1936;
  v18[3] = &unk_279731988;
  objc_copyWeak(&v21, &location);
  v10 = v8;
  v19 = v10;
  v11 = v7;
  v20 = v11;
  [(HMDBackingStoreOperation *)v9 setResultBlock:v18];
  v12 = objc_autoreleasePoolPush();
  v13 = self;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    *buf = 138543618;
    v28 = v15;
    v29 = 2112;
    v30 = v11;
    _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Dropping of changes datastore started for %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v12);
  v16 = [(HMDHome *)v13 backingStore];
  [v16 submit:v9];

  objc_destroyWeak(&v21);
  objc_destroyWeak(&location);

  v17 = *MEMORY[0x277D85DE8];
}

uint64_t __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v35 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v25 = a3;
  v24 = a4;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  v29 = 0u;
  v8 = v7;
  v9 = [v8 countByEnumeratingWithState:&v26 objects:v34 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v27;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v27 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v26 + 1) + 8 * i);
        v14 = *(a1 + 32);
        v15 = [v13 uuid];
        LODWORD(v14) = [v14 containsObject:v15];

        if (v14)
        {
          v16 = objc_autoreleasePoolPush();
          v17 = *(a1 + 40);
          v18 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
          {
            v19 = HMFGetLogIdentifier();
            *buf = 138543618;
            v31 = v19;
            v32 = 2112;
            v33 = v13;
            _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Removing object change from homes transaction store %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v16);
          v20 = *(a1 + 48);
          v21 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:{objc_msgSend(v13, "bsoLogRowID")}];
          [v20 addObject:v21];
        }
      }

      v10 = [v8 countByEnumeratingWithState:&v26 objects:v34 count:16];
    }

    while (v10);
  }

  v22 = *MEMORY[0x277D85DE8];
  return 1;
}

void __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke_1936(id *a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained && [a1[4] count])
  {
    v5 = [HMDBackingStoreLogUpdateOperation alloc];
    v6 = [a1[4] allObjects];
    v7 = [(HMDBackingStoreLogUpdateOperation *)v5 initWithRowIDs:v6 successfullyPushedTo:3];

    v15 = MEMORY[0x277D85DD0];
    v16 = 3221225472;
    v17 = __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke_2;
    v18 = &unk_2797338E8;
    objc_copyWeak(&v20, a1 + 6);
    v19 = a1[5];
    [(HMDBackingStoreOperation *)v7 setResultBlock:&v15];
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v12 = a1[5];
      *buf = 138543618;
      v22 = v11;
      v23 = 2112;
      v24 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Scheduling dropping of changes in home in datastore for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = [v9 backingStore];
    [v13 submit:v7];

    objc_destroyWeak(&v20);
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke_2(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = *(a1 + 32);
    v11 = 138543618;
    v12 = v8;
    v13 = 2112;
    v14 = v9;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Dropped changes in home in datastore for %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = *MEMORY[0x277D85DE8];
}

- (id)homeConfigurationModelObjectWithChangeType:(unint64_t)a3
{
  v5 = [HMDHomeConfigurationModel alloc];
  v6 = [(HMDHome *)self homeConfigurationUUID];
  v7 = [(HMDHome *)self uuid];
  v8 = [(HMDBackingStoreModelObject *)v5 initWithObjectChangeType:a3 uuid:v6 parentUUID:v7];

  v9 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome configurationVersion](self, "configurationVersion")}];
  [(HMDHomeConfigurationModel *)v8 setConfigurationVersion:v9];

  return v8;
}

- (id)homeConfigurationUUID
{
  v8[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277CCAD78];
  v3 = [(HMDHome *)self uuid];
  v8[0] = @"6741775F-2ED4-4DF8-B582-1F64BB3D1C75";
  v4 = [MEMORY[0x277CBEA60] arrayWithObjects:v8 count:1];
  v5 = [v2 hm_deriveUUIDFromBaseUUID:v3 identifierSalt:0 withSalts:v4];

  v6 = *MEMORY[0x277D85DE8];

  return v5;
}

- (id)emptyModelObjectWithChangeType:(unint64_t)a3
{
  v5 = [HMDHomeModel alloc];
  v6 = [(HMDHome *)self uuid];
  v7 = objc_alloc(MEMORY[0x277CCAD78]);
  v8 = [v7 initWithUUIDString:*MEMORY[0x277CD23C8]];
  v9 = [(HMDBackingStoreModelObject *)v5 initWithObjectChangeType:a3 uuid:v6 parentUUID:v8];

  return v9;
}

- (id)modelObjectWithChangeType:(unint64_t)a3 version:(int64_t)a4
{
  v6 = [(HMDHome *)self emptyModelObjectWithChangeType:a3];
  v7 = [(HMDHome *)self name];
  [v6 setName:v7];

  v8 = [(HMDHome *)self ownerName];
  if (v8)
  {
    v9 = v8;
    v10 = [(HMDHome *)self owner];
    v11 = [v10 publicKey];

    if (v11)
    {
      v12 = [(HMDHome *)self ownerName];
      [v6 setOwnerName:v12];

      v13 = [(HMDHome *)self owner];
      v14 = [v13 uuid];
      v15 = [v14 UUIDString];
      [v6 setOwnerUUID:v15];

      v16 = [(HMDHome *)self owner];
      v17 = [v16 userID];
      [v6 setOwnerUserID:v17];

      v18 = [(HMDHome *)self owner];
      v19 = [v18 publicKey];
      [v6 setOwnerPublicKey:v19];
    }
  }

  v20 = [(HMDHome *)self creationDate];

  if (v20)
  {
    v21 = [(HMDHome *)self creationDate];
    [v6 setCreationDate:v21];
  }

  v22 = [(HMDHome *)self firstHAPAccessoryAddedDate];

  if (v22)
  {
    v23 = [(HMDHome *)self firstHAPAccessoryAddedDate];
    [v6 setFirstHAPAccessoryAddedDate:v23];
  }

  v24 = [(HMDHome *)self roomForEntireHome];
  v25 = [v24 uuid];
  v26 = [v25 UUIDString];
  [v6 setDefaultRoomUUID:v26];

  v27 = [(HMDHome *)self homeLocationHandler];
  v28 = [v27 locationData];
  v29 = encodeRootObject();
  [v6 setHomeLocationData:v29];

  if (a4 >= 3)
  {
    v30 = [(HMDHome *)self residentDeviceManager];
    v31 = [v30 primaryResidentUUID];
    v32 = [v31 UUIDString];
    [v6 setPrimaryResidentUUID:v32];

    if (a4 != 3)
    {
      v33 = [(HMDHome *)self presenceAuthStatus];

      if (v33)
      {
        v34 = [(HMDHome *)self presenceAuthStatus];
        v35 = [v34 number];
        [v6 setPresenceAuthorizationStatus:v35];
      }

      v36 = [(HMDHome *)self presenceComputeStatus];

      if (v36)
      {
        v37 = [(HMDHome *)self presenceComputeStatus];
        v38 = [v37 number];
        [v6 setPresenceComputeStatus:v38];
      }

      v39 = [(HMDHome *)self sharedHomeSourceVersion];

      if (v39)
      {
        v40 = [(HMDHome *)self sharedHomeSourceVersion];
        [v6 setSharedHomeSourceVersion:v40];
      }

      v41 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome protectionMode](self, "protectionMode")}];
      [v6 setNetworkProtectionMode:v41];
    }
  }

  if ([(HMDHome *)self isMultiUserEnabled])
  {
    v42 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isMultiUserEnabled](self, "isMultiUserEnabled")}];
    [v6 setMultiUserEnabled:v42];
  }

  v43 = [v6 hasAnyUserAcknowledgedCameraRecordingOnboarding];

  if (v43)
  {
    v44 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasAnyUserAcknowledgedCameraRecordingOnboarding](self, "hasAnyUserAcknowledgedCameraRecordingOnboarding")}];
    [v6 setHasAnyUserAcknowledgedCameraRecordingOnboarding:v44];
  }

  if ([(HMDHome *)self hasOnboardedForAccessCode])
  {
    v45 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasOnboardedForAccessCode](self, "hasOnboardedForAccessCode")}];
    [v6 setHasOnboardedForAccessCode:v45];
  }

  if ([(HMDHome *)self shouldEncodeHasOnboardedForWalletKey])
  {
    v46 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasOnboardedForWalletKey](self, "hasOnboardedForWalletKey")}];
    [v6 setHasOnboardedForWalletKey:v46];
  }

  v47 = [(HMDHome *)self naturalLightingContext];
  if (v47)
  {
    [v6 setNaturalLightingContext:v47];
  }

  v48 = [(HMDHome *)self chipStorage];
  [v48 updateHomeModel:v6];

  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    v49 = [(HMDHome *)self fabric];
    v50 = [v49 fabricID];
    [v6 setMatterFabricID:v50];
  }

  v51 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome soundCheckEnabled](self, "soundCheckEnabled")}];
  [v6 setSoundCheckEnabled:v51];

  v52 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome siriPhraseOptions](self, "siriPhraseOptions")}];
  [v6 setSiriPhraseOptions:v52];

  v53 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome locationServicesEnabled](self, "locationServicesEnabled")}];
  [v6 setLocationServicesEnabled:v53];

  v54 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome didOnboardLocationServices](self, "didOnboardLocationServices")}];
  [v6 setDidOnboardLocationServices:v54];

  return v6;
}

- (id)backingStoreObjects:(int64_t)a3
{
  v209 = *MEMORY[0x277D85DE8];
  v5 = [MEMORY[0x277CBEB18] array];
  v6 = [(HMDHome *)self modelObjectWithChangeType:1 version:a3];
  [v5 addObject:v6];

  v7 = [(HMDHome *)self homeConfigurationModelObjectWithChangeType:1];
  [v5 addObject:v7];

  v192 = 0u;
  v193 = 0u;
  v190 = 0u;
  v191 = 0u;
  v8 = [(HMDHome *)self accessories];
  v9 = [v8 countByEnumeratingWithState:&v190 objects:v208 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v191;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v191 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v190 + 1) + 8 * i);
        if (a3 <= 3)
        {
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) == 0)
          {
            continue;
          }
        }

        v14 = [v13 backingStoreObjects:a3];
        [v5 addObjectsFromArray:v14];
      }

      v10 = [v8 countByEnumeratingWithState:&v190 objects:v208 count:16];
    }

    while (v10);
  }

  v188 = 0u;
  v189 = 0u;
  v186 = 0u;
  v187 = 0u;
  v148 = self;
  v15 = [(HMDHome *)self actionSets];
  v16 = [v15 countByEnumeratingWithState:&v186 objects:v207 count:16];
  if (v16)
  {
    v17 = v16;
    v18 = *v187;
    do
    {
      for (j = 0; j != v17; ++j)
      {
        if (*v187 != v18)
        {
          objc_enumerationMutation(v15);
        }

        v20 = *(*(&v186 + 1) + 8 * j);
        if (a3 <= 1)
        {
          v21 = MEMORY[0x277CD1800];
          v22 = [*(*(&v186 + 1) + 8 * j) type];
          LOBYTE(v21) = [v21 isBuiltinActionSetType:v22];

          if (v21)
          {
            continue;
          }
        }

        v23 = [v20 backingStoreObjects:a3];
        [v5 addObjectsFromArray:v23];
      }

      v17 = [v15 countByEnumeratingWithState:&v186 objects:v207 count:16];
    }

    while (v17);
  }

  if (a3 >= 3 && !isWatch())
  {
    v184 = 0u;
    v185 = 0u;
    v182 = 0u;
    v183 = 0u;
    v24 = [(HMDHome *)v148 triggerOwnedActionSets];
    v25 = [v24 countByEnumeratingWithState:&v182 objects:v206 count:16];
    if (v25)
    {
      v26 = v25;
      v27 = *v183;
      do
      {
        for (k = 0; k != v26; ++k)
        {
          if (*v183 != v27)
          {
            objc_enumerationMutation(v24);
          }

          v29 = [*(*(&v182 + 1) + 8 * k) backingStoreObjects:a3];
          [v5 addObjectsFromArray:v29];
        }

        v26 = [v24 countByEnumeratingWithState:&v182 objects:v206 count:16];
      }

      while (v26);
    }

    v180 = 0u;
    v181 = 0u;
    v178 = 0u;
    v179 = 0u;
    v30 = [(HMDHome *)v148 triggers];
    v31 = [v30 countByEnumeratingWithState:&v178 objects:v205 count:16];
    if (v31)
    {
      v32 = v31;
      v33 = *v179;
      do
      {
        for (m = 0; m != v32; ++m)
        {
          if (*v179 != v33)
          {
            objc_enumerationMutation(v30);
          }

          v35 = *(*(&v178 + 1) + 8 * m);
          v36 = [v35 requiresDataVersion4];
          if (a3 > 3 || (v36 & 1) == 0)
          {
            v37 = [v35 backingStoreObjects:a3];
            [v5 addObjectsFromArray:v37];
          }
        }

        v32 = [v30 countByEnumeratingWithState:&v178 objects:v205 count:16];
      }

      while (v32);
    }
  }

  v176 = 0u;
  v177 = 0u;
  v174 = 0u;
  v175 = 0u;
  v38 = [(HMDHome *)v148 rooms];
  v39 = [v38 countByEnumeratingWithState:&v174 objects:v204 count:16];
  if (v39)
  {
    v40 = v39;
    v41 = *v175;
    do
    {
      for (n = 0; n != v40; ++n)
      {
        if (*v175 != v41)
        {
          objc_enumerationMutation(v38);
        }

        v43 = [*(*(&v174 + 1) + 8 * n) backingStoreObjects:a3];
        [v5 addObjectsFromArray:v43];
      }

      v40 = [v38 countByEnumeratingWithState:&v174 objects:v204 count:16];
    }

    while (v40);
  }

  v172 = 0u;
  v173 = 0u;
  v170 = 0u;
  v171 = 0u;
  v44 = [(HMDHome *)v148 zones];
  v45 = [v44 countByEnumeratingWithState:&v170 objects:v203 count:16];
  if (v45)
  {
    v46 = v45;
    v47 = *v171;
    do
    {
      for (ii = 0; ii != v46; ++ii)
      {
        if (*v171 != v47)
        {
          objc_enumerationMutation(v44);
        }

        v49 = [*(*(&v170 + 1) + 8 * ii) backingStoreObjects:a3];
        [v5 addObjectsFromArray:v49];
      }

      v46 = [v44 countByEnumeratingWithState:&v170 objects:v203 count:16];
    }

    while (v46);
  }

  v168 = 0u;
  v169 = 0u;
  v166 = 0u;
  v167 = 0u;
  v50 = [(HMDHome *)v148 serviceGroups];
  v51 = [v50 countByEnumeratingWithState:&v166 objects:v202 count:16];
  if (v51)
  {
    v52 = v51;
    v53 = *v167;
    do
    {
      for (jj = 0; jj != v52; ++jj)
      {
        if (*v167 != v53)
        {
          objc_enumerationMutation(v50);
        }

        v55 = [*(*(&v166 + 1) + 8 * jj) backingStoreObjects:a3];
        [v5 addObjectsFromArray:v55];
      }

      v52 = [v50 countByEnumeratingWithState:&v166 objects:v202 count:16];
    }

    while (v52);
  }

  v56 = objc_autoreleasePoolPush();
  v57 = v148;
  v58 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
  {
    v59 = HMFGetLogIdentifier();
    [(HMDHome *)v57 isUpdatedToHH2];
    v60 = HMFBooleanToString();
    *buf = 138543618;
    v199 = v59;
    v200 = 2112;
    v201 = v60;
    _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_INFO, "%{public}@HH2 status : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v56);
  if ([(HMDHome *)v57 isUpdatedToHH2])
  {
    v61 = [HMDHomeUpgradedToROAR defaultModelForHome:v57];
    [v5 addObject:v61];
  }

  v164 = 0u;
  v165 = 0u;
  v162 = 0u;
  v163 = 0u;
  v62 = [(HMDHome *)v57 users];
  v63 = [v62 countByEnumeratingWithState:&v162 objects:v197 count:16];
  if (v63)
  {
    v64 = v63;
    v65 = *v163;
    do
    {
      for (kk = 0; kk != v64; ++kk)
      {
        if (*v163 != v65)
        {
          objc_enumerationMutation(v62);
        }

        v67 = *(*(&v162 + 1) + 8 * kk);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();
        v69 = isKindOfClass;
        if ((a3 > 1 || (isKindOfClass & 1) == 0) && (!isWatch() || (v69 & 1) == 0 && [v67 isOwner]) && (a3 > 3 || (objc_msgSend(v67, "requiresMakoSupport") & 1) == 0))
        {
          v70 = [v67 backingStoreObjects:a3];
          [v5 addObjectsFromArray:v70];
        }
      }

      v64 = [v62 countByEnumeratingWithState:&v162 objects:v197 count:16];
    }

    while (v64);
  }

  if (a3 >= 2)
  {
    v160 = 0u;
    v161 = 0u;
    v158 = 0u;
    v159 = 0u;
    v149 = v57;
    v71 = [(HMDHome *)v57 outgoingInvitations];
    v72 = [v71 countByEnumeratingWithState:&v158 objects:v196 count:16];
    if (v72)
    {
      v73 = v72;
      v74 = *v159;
      do
      {
        for (mm = 0; mm != v73; ++mm)
        {
          if (*v159 != v74)
          {
            objc_enumerationMutation(v71);
          }

          v76 = *(*(&v158 + 1) + 8 * mm);
          if (a3 <= 3)
          {
            v77 = [*(*(&v158 + 1) + 8 * mm) user];
            v78 = [v77 requiresMakoSupport];

            if (v78)
            {
              continue;
            }
          }

          v79 = [v76 modelObjectWithChangeType:1 version:a3];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v80 = v79;
          }

          else
          {
            v80 = 0;
          }

          v81 = v80;

          if (v81)
          {
            [v5 addObject:v81];
          }
        }

        v73 = [v71 countByEnumeratingWithState:&v158 objects:v196 count:16];
      }

      while (v73);
    }

    if (a3 >= 3)
    {
      v156 = 0u;
      v157 = 0u;
      v154 = 0u;
      v155 = 0u;
      v82 = [(HMDHome *)v57 residentDeviceManager];
      v83 = [v82 residentDevices];

      v84 = [v83 countByEnumeratingWithState:&v154 objects:v195 count:16];
      if (v84)
      {
        v85 = v84;
        v86 = *v155;
        do
        {
          for (nn = 0; nn != v85; ++nn)
          {
            if (*v155 != v86)
            {
              objc_enumerationMutation(v83);
            }

            v88 = [*(*(&v154 + 1) + 8 * nn) modelObjectWithChangeType:1 version:a3];
            [v5 addObject:v88];
          }

          v85 = [v83 countByEnumeratingWithState:&v154 objects:v195 count:16];
        }

        while (v85);
      }

      v89 = [(HMDHome *)v57 appData];

      if (v89)
      {
        v90 = [(HMDHome *)v57 appData];
        v91 = [v90 modelObjectWithChangeType:1];
        [v5 addObject:v91];
      }

      if (a3 >= 4)
      {
        v92 = [HMDHomeSettingsModel alloc];
        v93 = [(HMDHome *)v57 uuid];
        v94 = [HMDHomeSettingsModel modelIDForHomeUUID:v93];
        v95 = [(HMDHome *)v57 uuid];
        v96 = [(HMDBackingStoreModelObject *)v92 initWithObjectChangeType:1 uuid:v94 parentUUID:v95];

        v97 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isAutomaticSoftwareUpdateEnabled](v57, "isAutomaticSoftwareUpdateEnabled")}];
        [(HMDHomeSettingsModel *)v96 setAutomaticSoftwareUpdateEnabled:v97];

        v98 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isAutomaticThirdPartyAccessorySoftwareUpdateEnabled](v57, "isAutomaticThirdPartyAccessorySoftwareUpdateEnabled")}];
        [(HMDHomeSettingsModel *)v96 setAutomaticThirdPartyAccessorySoftwareUpdateEnabled:v98];

        [v5 addObject:v96];
        v99 = [HMDHomeMediaSettingsModel alloc];
        v100 = [(HMDHome *)v57 uuid];
        v101 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:v100];
        v102 = [(HMDHome *)v57 uuid];
        v103 = [(HMDBackingStoreModelObject *)v99 initWithObjectChangeType:1 uuid:v101 parentUUID:v102];

        v104 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome minimumMediaUserPrivilege](v57, "minimumMediaUserPrivilege")}];
        [(HMDHomeMediaSettingsModel *)v103 setMinimumMediaUserPrivilege:v104];

        v105 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isMediaPeerToPeerEnabled](v57, "isMediaPeerToPeerEnabled")}];
        [(HMDHomeMediaSettingsModel *)v103 setMediaPeerToPeerEnabled:v105];

        v106 = [(HMDHome *)v57 mediaPassword];
        [(HMDHomeMediaSettingsModel *)v103 setMediaPassword:v106];

        [v5 addObject:v103];
        v107 = [(HMDHome *)v57 mediaSystemController];
        v108 = [v107 backingStoreObjectsForVersion:a3];

        if ([v108 count])
        {
          [v5 addObjectsFromArray:v108];
        }

        v109 = [(HMDHome *)v57 uuid];
        v110 = [HMDHomeNetworkRouterManagingDeviceSettingsModel defaultModelForHomeUUID:v109];

        v111 = [(HMDHome *)v57 primaryNetworkRouterManagingDeviceUUID];
        v112 = [v111 UUIDString];
        [v110 setPrimaryNetworkRouterManagingDeviceUUID:v112];

        [v5 addObject:v110];
        v113 = [(HMDHome *)v57 uuid];
        v114 = [HMDHomeNetworkRouterSettingsModel defaultModelForHomeUUID:v113];

        v115 = [(HMDHome *)v57 activeNetworkRouterUUID];
        v116 = [v115 UUIDString];
        [v114 setActiveNetworkRouterAccessoryUUID:v116];

        v117 = +[HMDHomeKitVersion version6];
        v118 = [(HMDHome *)v57 minimumNetworkRouterSupportHomeKitVersion];
        if (!v118)
        {
          goto LABEL_113;
        }

        v119 = v118;
        v120 = [(HMDHome *)v57 minimumNetworkRouterSupportHomeKitVersion];
        v121 = [v120 compare:v117];

        v122 = v121 == -1;
        v57 = v149;
        if (v122)
        {
LABEL_113:
          v123 = [v117 versionString];
          [v114 setMinimumNetworkRouterSupportHomeKitVersion:v123];
        }

        v124 = [(HMDHome *)v57 minHomeKitVersionForAccessoryNetworkProtectionChange];
        v125 = [v124 versionString];
        [v114 setMinHomeKitVersionForAccessoryNetworkProtectionChange:v125];

        [v5 addObject:v114];
        v152 = 0u;
        v153 = 0u;
        v150 = 0u;
        v151 = 0u;
        v126 = [(HMDHome *)v57 networkProtectionGroupRegistry];
        v127 = [v126 persistedGroups];

        v128 = [v127 countByEnumeratingWithState:&v150 objects:v194 count:16];
        if (v128)
        {
          v129 = v128;
          v130 = *v151;
          do
          {
            for (i1 = 0; i1 != v129; ++i1)
            {
              if (*v151 != v130)
              {
                objc_enumerationMutation(v127);
              }

              v132 = [*(*(&v150 + 1) + 8 * i1) modelForVersion:a3];
              [v5 addObject:v132];
            }

            v129 = [v127 countByEnumeratingWithState:&v150 objects:v194 count:16];
          }

          while (v129);
        }

        v133 = [HMDHomeThreadNetworkModel defaultModelForHome:v149];
        v134 = [(HMDHome *)v149 unfilteredThreadNetworkID];
        [v133 setThreadNetworkID:v134];

        [v5 addObject:v133];
        v135 = [(HMDHome *)v149 uuid];
        v136 = [HMDHomePersonManagerSettingsModel defaultModelForHomeUUID:v135];

        v137 = [(HMDHome *)v149 personManagerZoneUUID];
        [v136 setZoneUUID:v137];

        [v5 addObject:v136];
        v138 = [(HMDHome *)v149 labelsByAccessCode];
        v139 = [HMDAccessCodeDataManager createHomeAccessCodeModelsFromLabelsByAccessCode:v138 forHome:v149];

        [v5 addObjectsFromArray:v139];
        v140 = [(HMDHome *)v149 removedUserInfoByAccessCode];
        v141 = [HMDAccessCodeDataManager createRemovedUserInfoModelsFromRemovedUserInfoByAccessCode:v140 forHome:v149];

        [v5 addObjectsFromArray:v141];
        v142 = [HMDHomeNFCReaderKeyModel defaultModelForHome:v149];
        if ([(HMDHome *)v149 shouldEncodeNFCReaderKey])
        {
          v143 = [(HMDHome *)v149 nfcReaderKey];
          [v142 setNfcReaderKey:v143];
        }

        [v5 addObject:v142];
      }
    }
  }

  v144 = v5;

  v145 = *MEMORY[0x277D85DE8];
  return v5;
}

- (id)sharedHomeModel
{
  v3 = [HMDSharedHomeModel alloc];
  v4 = [(HMDHome *)self uuid];
  v5 = objc_alloc(MEMORY[0x277CCAD78]);
  v6 = [v5 initWithUUIDString:*MEMORY[0x277CD23C8]];
  v7 = [(HMDBackingStoreModelObject *)v3 initWithObjectChangeType:1 uuid:v4 parentUUID:v6];

  v8 = [(HMDHome *)self homeManager];
  v9 = [v8 generateDataForSharedHomeModel:self];
  [(HMDSharedHomeModel *)v7 setHomeData:v9];

  v10 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome configurationVersion](self, "configurationVersion")}];
  [(HMDSharedHomeModel *)v7 setConfigurationVersion:v10];

  return v7;
}

- (id)deletedBackingStoreObject
{
  v3 = [(HMDHome *)self homeManager];
  v4 = [(HMDHome *)self isOwnerUser];
  v5 = off_27971A150;
  if (!v4)
  {
    v5 = off_27971A238;
  }

  v6 = objc_alloc(*v5);
  v7 = [(HMDHome *)self uuid];
  v8 = [v3 uuid];
  v9 = [v6 initWithObjectChangeType:3 uuid:v7 parentUUID:v8];

  return v9;
}

- (void)transactionObjectRemoved:(id)a3 message:(id)a4
{
  v56 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v6;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;
  if (!v9)
  {
    v11 = v6;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v12 = v11;
    }

    else
    {
      v12 = 0;
    }

    v10 = v12;

    if (!v10)
    {
      v21 = v11;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v22 = v21;
      }

      else
      {
        v22 = 0;
      }

      v14 = v22;

      if (!v14)
      {
        v37 = [(HMDHome *)self homeObjectChangeHandler];
        [v37 handleObjectRemove:v21 message:v7];

        v14 = 0;
LABEL_38:

        goto LABEL_39;
      }

      v23 = [v7 messagePayload];
      v24 = [v23 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

      if (v24)
      {
        v25 = objc_autoreleasePoolPush();
        v26 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          [v24 UUID];
          v29 = v49 = v25;
          *buf = 138543618;
          v53 = v28;
          v54 = 2112;
          v55 = v29;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Handling removed removed-user access code model", buf, 0x16u);

          v25 = v49;
        }
      }

      else
      {
        v24 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
        v25 = objc_autoreleasePoolPush();
        v38 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v39 = v50 = v25;
          v40 = [v24 UUID];
          *buf = 138543618;
          v53 = v39;
          v54 = 2112;
          v55 = v40;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling removed removed-user access code model", buf, 0x16u);

          v25 = v50;
        }
      }

      objc_autoreleasePoolPop(v25);
      v41 = [(HMDHome *)self accessCodeManager];
      v42 = [v41 dataManager];

      if (v42)
      {
        [v42 handleRemovedHMDRemovedUserAccessCodeModel:v14 message:v7 flow:v24];
      }

      else
      {
        v43 = objc_autoreleasePoolPush();
        v44 = self;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v46 = v51 = v43;
          *buf = 138543362;
          v53 = v46;
          _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDRemovedUserAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);

          v43 = v51;
        }

        objc_autoreleasePoolPop(v43);
        v47 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [v7 respondWithError:v47];
      }

LABEL_37:
      goto LABEL_38;
    }

    v13 = [v7 messagePayload];
    v14 = [v13 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

    if (v14)
    {
      v15 = objc_autoreleasePoolPush();
      v16 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_23;
      }

      v18 = HMFGetLogIdentifier();
      v19 = [v14 UUID];
      *buf = 138543618;
      v53 = v18;
      v54 = 2112;
      v55 = v19;
      v20 = "%{public}@[Flow: %@] Handling removed home access code model";
    }

    else
    {
      v14 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
      v15 = objc_autoreleasePoolPush();
      v30 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_23;
      }

      v18 = HMFGetLogIdentifier();
      v19 = [v14 UUID];
      *buf = 138543618;
      v53 = v18;
      v54 = 2112;
      v55 = v19;
      v20 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling removed home access code model";
    }

    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, v20, buf, 0x16u);

LABEL_23:
    objc_autoreleasePoolPop(v15);
    v31 = [(HMDHome *)self accessCodeManager];
    v24 = [v31 dataManager];

    if (v24)
    {
      [v24 handleRemovedHomeAccessCodeModel:v10 message:v7 flow:v14];
    }

    else
    {
      v32 = objc_autoreleasePoolPush();
      v33 = self;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543362;
        v53 = v35;
        _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDHomeAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v32);
      v36 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [v7 respondWithError:v36];
    }

    goto LABEL_37;
  }

  v10 = [(HMDHome *)self residentDeviceManager];
  [v10 transactionObjectRemoved:v6 message:v7];
LABEL_39:

  v48 = *MEMORY[0x277D85DE8];
}

- (void)transactionObjectUpdated:(id)a3 newValues:(id)a4 message:(id)a5
{
  v119 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v9;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;
  if (!v12)
  {
    v14 = v9;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;

    if (v16)
    {
      [(HMDHome *)self updateHomeConfigurationWithModel:v16 message:v10];
LABEL_114:

      goto LABEL_115;
    }

    v17 = v14;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    if (v19)
    {
      v20 = [(HMDHome *)self residentDeviceManager];
      [v20 transactionObjectUpdated:v8 newValues:v17 message:v10];

LABEL_113:
      goto LABEL_114;
    }

    v21 = v17;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v22 = v21;
    }

    else
    {
      v22 = 0;
    }

    v23 = v22;

    if (v23)
    {
      v24 = [(HMDHome *)self homeManager];
      [v24 transactionObjectUpdated:v8 newValues:v21 message:v10];

LABEL_112:
      goto LABEL_113;
    }

    v25 = v21;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v26 = v25;
    }

    else
    {
      v26 = 0;
    }

    v27 = v26;

    if (v27)
    {
      __transactionHomeSettingsUpdated(self, v27, v10);
      v23 = 0;
LABEL_111:

      goto LABEL_112;
    }

    v28 = v25;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v29 = v28;
    }

    else
    {
      v29 = 0;
    }

    v30 = v29;

    if (v30)
    {
      __transactionHomeMediaSettingsUpdated(self, v30, v10);
      v31 = v30;
      v23 = 0;
LABEL_110:

      goto LABEL_111;
    }

    v32 = v28;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v33 = v32;
    }

    else
    {
      v33 = 0;
    }

    v34 = v33;

    if (v34)
    {
      [(HMDHome *)self updateNetworkRouterSettingsWithModel:v34 message:v10];
      v35 = v34;
      v23 = 0;
LABEL_109:

      v31 = 0;
      goto LABEL_110;
    }

    v36 = v32;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v37 = v36;
    }

    else
    {
      v37 = 0;
    }

    v38 = v37;

    if (v38)
    {
      [(HMDHome *)self updateNetworkRouterManagingDeviceSettingsWithModel:v38 message:v10];
      v39 = v38;
      v23 = 0;
LABEL_108:

      v35 = 0;
      goto LABEL_109;
    }

    v40 = v36;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v41 = v40;
    }

    else
    {
      v41 = 0;
    }

    v42 = v41;

    if (v42)
    {
      [(HMDHome *)self _updateThreadNetworkWithModel:v42 message:v10];
      v43 = v42;
      v23 = 0;
LABEL_107:

      v39 = 0;
      goto LABEL_108;
    }

    v44 = v40;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v45 = v44;
    }

    else
    {
      v45 = 0;
    }

    v46 = v45;

    if (v46)
    {
      v47 = v8;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v48 = v47;
      }

      else
      {
        v48 = 0;
      }

      v109 = v48;

      v49 = [(HMDHome *)self personDataManager];
      [v49 handleUpdatedSettingsModel:v46 previousSettingsModel:v109 message:v10];

      goto LABEL_106;
    }

    v50 = v44;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v51 = v50;
    }

    else
    {
      v51 = 0;
    }

    v52 = v51;

    v105 = v52;
    if (v52)
    {
      v53 = [v10 messagePayload];
      v54 = [v53 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

      v110 = v54;
      if (v54)
      {
        context = objc_autoreleasePoolPush();
        v55 = self;
        log = HMFGetOSLogHandle();
        if (os_log_type_enabled(log, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          v57 = [v54 UUID];
          *buf = 138543618;
          v114 = v56;
          v115 = 2112;
          v116 = v57;
          v58 = "%{public}@[Flow: %@] Handling updated home access code model";
LABEL_70:
          _os_log_impl(&dword_2531F8000, log, OS_LOG_TYPE_INFO, v58, buf, 0x16u);
        }
      }

      else
      {
        v110 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
        context = objc_autoreleasePoolPush();
        v68 = self;
        log = HMFGetOSLogHandle();
        if (os_log_type_enabled(log, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          v57 = [v110 UUID];
          *buf = 138543618;
          v114 = v56;
          v115 = 2112;
          v116 = v57;
          v58 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling updated home access code model";
          goto LABEL_70;
        }
      }

      objc_autoreleasePoolPop(context);
      v69 = [(HMDHome *)self accessCodeManager];
      v70 = [v69 dataManager];

      loga = v70;
      if (!v70)
      {
        logb = objc_autoreleasePoolPush();
        v71 = self;
        v72 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v72, OS_LOG_TYPE_ERROR))
        {
          v73 = HMFGetLogIdentifier();
          *buf = 138543362;
          v114 = v73;
          _os_log_impl(&dword_2531F8000, v72, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDHomeAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
        }

        objc_autoreleasePoolPop(logb);
        v74 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [v10 respondWithError:v74];

        goto LABEL_105;
      }

      [v70 handleUpdatedHomeAccessCodeModel:v105 message:v10 flow:v110];
LABEL_104:

LABEL_105:
      v46 = 0;
LABEL_106:

      v23 = 0;
      v43 = 0;
      goto LABEL_107;
    }

    v59 = v50;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v60 = v59;
    }

    else
    {
      v60 = 0;
    }

    v61 = v60;

    v110 = v61;
    if (!v61)
    {
      v75 = v59;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v76 = v75;
      }

      else
      {
        v76 = 0;
      }

      v77 = v76;

      loga = v77;
      if (v77)
      {
        v111 = [v77 nfcReaderKey];
        v78 = [v77 setProperties];
        if ([v78 containsObject:@"encodedNfcReaderKey"])
        {
          v79 = [(HMDHome *)self nfcReaderKey];
          contextd = HMFEqualObjects();

          if ((contextd & 1) == 0)
          {
            contextb = objc_autoreleasePoolPush();
            v80 = self;
            v81 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v81, OS_LOG_TYPE_INFO))
            {
              v98 = HMFGetLogIdentifier();
              [(HMDHome *)v80 nfcReaderKey];
              *buf = 138543874;
              v114 = v98;
              v116 = v115 = 2112;
              v82 = v116;
              v117 = 2112;
              v118 = v111;
              _os_log_impl(&dword_2531F8000, v81, OS_LOG_TYPE_INFO, "%{public}@Updating nfc reader key from %@ -> %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(contextb);
            v83 = [MEMORY[0x277CBEB38] dictionary];
            v84 = [(HMDHome *)v80 nfcReaderKey];
            [v83 setObject:v84 forKeyedSubscript:@"HMDHomeDidUpdateNFCReaderKeyNotificationKeyPreviousNFCReaderKey"];

            [(HMDHome *)v80 setNfcReaderKey:v111];
            logAndPostNotification(@"HMDHomeDidUpdateNFCReaderKeyNotification", v80, v83);
            v85 = [v10 transactionResult];
            [v85 markChanged];
          }
        }

        else
        {
        }

        [v10 respondWithSuccess];
      }

      else
      {
        v92 = v75;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v93 = v92;
        }

        else
        {
          v93 = 0;
        }

        v94 = v93;
        v112 = v92;

        if (v94)
        {
          [(HMDHome *)self updateROARStatus:v94 message:v10];
          [v10 respondWithSuccess];
        }

        else
        {
          v95 = [(HMDHome *)self homeObjectChangeHandler];
          [v95 handleObjectUpdate:v8 newValues:v112 message:v10];
        }

        loga = 0;
      }

      v110 = 0;
      goto LABEL_104;
    }

    v62 = [v10 messagePayload];
    v63 = [v62 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

    loga = v63;
    if (v63)
    {
      v97 = objc_autoreleasePoolPush();
      v64 = self;
      contexta = HMFGetOSLogHandle();
      if (os_log_type_enabled(contexta, OS_LOG_TYPE_INFO))
      {
        v65 = HMFGetLogIdentifier();
        v66 = [v63 UUID];
        *buf = 138543618;
        v114 = v65;
        v115 = 2112;
        v116 = v66;
        v67 = "%{public}@[Flow: %@] Handling updated removed-user access code model";
LABEL_87:
        _os_log_impl(&dword_2531F8000, contexta, OS_LOG_TYPE_INFO, v67, buf, 0x16u);
      }
    }

    else
    {
      loga = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
      v97 = objc_autoreleasePoolPush();
      v86 = self;
      contexta = HMFGetOSLogHandle();
      if (os_log_type_enabled(contexta, OS_LOG_TYPE_INFO))
      {
        v65 = HMFGetLogIdentifier();
        v66 = [loga UUID];
        *buf = 138543618;
        v114 = v65;
        v115 = 2112;
        v116 = v66;
        v67 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling updated removed-user access code model";
        goto LABEL_87;
      }
    }

    objc_autoreleasePoolPop(v97);
    v87 = [(HMDHome *)self accessCodeManager];
    v88 = [v87 dataManager];

    if (v88)
    {
      [v88 handleUpdatedHMDRemovedUserAccessCodeModel:v110 message:v10 flow:loga];
    }

    else
    {
      contextc = objc_autoreleasePoolPush();
      v89 = self;
      v90 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v90, OS_LOG_TYPE_ERROR))
      {
        v99 = HMFGetLogIdentifier();
        *buf = 138543362;
        v114 = v99;
        _os_log_impl(&dword_2531F8000, v90, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDRemovedUserAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
      }

      objc_autoreleasePoolPop(contextc);
      v91 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [v10 respondWithError:v91];
    }

    goto LABEL_104;
  }

  v13 = [(HMDHome *)self updateHomeWithModel:v12 message:v10];
LABEL_115:

  v96 = *MEMORY[0x277D85DE8];
}

- (void)updateNetworkRouterManagingDeviceSettingsWithModel:(id)a3 message:(id)a4
{
  v15 = a3;
  v6 = a4;
  v7 = [v15 setProperties];
  if ([v7 containsObject:@"primaryNetworkRouterManagingDeviceUUID"])
  {
    v8 = [(HMDHome *)self primaryNetworkRouterManagingDeviceUUID];
    v9 = [v8 UUIDString];
    v10 = [v15 primaryNetworkRouterManagingDeviceUUID];
    v11 = HMFEqualObjects();

    if (v11)
    {
      goto LABEL_5;
    }

    v12 = objc_alloc(MEMORY[0x277CCAD78]);
    v13 = [v15 primaryNetworkRouterManagingDeviceUUID];
    v7 = [v12 initWithUUIDString:v13];

    [(HMDHome *)self setPrimaryNetworkRouterManagingDeviceUUID:v7];
    v14 = [v6 transactionResult];
    [(HMDHome *)self _evaluateNetworkRouterManagementForTransaction:v14];
    [v14 markChanged];
  }

LABEL_5:
  [v6 respondWithPayload:0];
}

- (void)setHomeUpdatedToROARAndInformClients
{
  v15 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isUpdatedToHH2])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v6;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@isUpdatedToHH2 is already set on this home. Not doing anything.", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  else if (![(HMDHome *)self isUpdatedToHH2])
  {
    [(HMDHome *)self setIsUpdatedToHH2:1];
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Marked home upgraded to HH2 & informing clients about the status", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    [(HMDHome *)v8 saveWithReason:@"Upgraded To HH2" postSyncNotification:0 objectChange:1];
    v11 = [(HMDHome *)v8 homeManager];
    [v11 checkAndMoveDirectlyToHH2IfOnlyHH2SharedHomesExistAllowEmptyOwnedHomes:1];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)updateROARStatus:(id)a3 message:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543618;
    v17 = v11;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Found ROAR Model : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [v7 transactionResult];
  v13 = [(HMDHome *)v9 workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __36__HMDHome_updateROARStatus_message___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = v9;
  dispatch_async(v13, block);

  [v12 markSaveToAssistant];
  [v12 markChanged];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)updateNetworkRouterSettingsWithModel:(id)a3 message:(id)a4
{
  v59 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 transactionResult];
  v9 = [v6 setProperties];
  v10 = [v9 containsObject:@"activeNetworkRouterAccessoryUUID"];

  if (v10)
  {
    v11 = objc_alloc(MEMORY[0x277CCAD78]);
    v12 = [v6 activeNetworkRouterAccessoryUUID];
    v13 = [v11 initWithUUIDString:v12];

    v14 = [(HMDHome *)self activeNetworkRouterUUID];
    v15 = HMFEqualObjects();

    if ((v15 & 1) == 0)
    {
      [(HMDHome *)self setActiveNetworkRouterUUID:v13];
      if (v13)
      {
        v16 = [v6 activeNetworkRouterAccessoryUUID];
        v17 = [v6 activeNetworkRouterInitialSetupNeededUUID];
        -[HMDHome setActiveNetworkRouterInitialSetupNeeded:](self, "setActiveNetworkRouterInitialSetupNeeded:", [v16 isEqual:v17]);
      }

      else
      {
        [(HMDHome *)self setActiveNetworkRouterInitialSetupNeeded:0];
      }
    }

    v18 = v15 ^ 1;
  }

  else
  {
    v18 = 0;
  }

  v19 = [v6 setProperties];
  v20 = [v19 containsObject:@"minimumNetworkRouterSupportHomeKitVersion"];

  if (v20)
  {
    v21 = [v6 minimumNetworkRouterSupportHomeKitVersion];

    if (v21)
    {
      v22 = [HMDHomeKitVersion alloc];
      v23 = [v6 minimumNetworkRouterSupportHomeKitVersion];
      v21 = [(HMDHomeKitVersion *)v22 initWithString:v23];
    }

    v24 = +[HMDHomeKitVersion version6];
    if (-[HMDHome isOwnerUser](self, "isOwnerUser") && [v8 source] != 1 && -[HMDHomeKitVersion isGreaterThanVersion:](v21, "isGreaterThanVersion:", v24))
    {
      v25 = objc_autoreleasePoolPush();
      v26 = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v45 = v25;
        v29 = v28 = v24;
        *buf = 138543874;
        v54 = v29;
        v55 = 2112;
        v56 = v21;
        v57 = 2112;
        v58 = v28;
        _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Overriding minimum router support HomeKit version to enable network router support from %@ in cloud to our version %@", buf, 0x20u);

        v24 = v28;
        v25 = v45;
      }

      objc_autoreleasePoolPop(v25);
      v30 = [(HMDHome *)v26 workQueue];
      block = MEMORY[0x277D85DD0];
      v47 = 3221225472;
      v48 = __56__HMDHome_updateNetworkRouterSettingsWithModel_message___block_invoke;
      v49 = &unk_279734960;
      v50 = v26;
      v51 = v21;
      v52 = v7;
      dispatch_async(v30, &block);
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      v32 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        [(HMDHome *)v32 minimumNetworkRouterSupportHomeKitVersion];
        v45 = v8;
        v36 = v35 = v24;
        *buf = 138543874;
        v54 = v34;
        v55 = 2112;
        v56 = v36;
        v57 = 2112;
        v58 = v21;
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Updating minimum router support HomeKit version to enable network router support from %@ to cloud version %@", buf, 0x20u);

        v24 = v35;
        v8 = v45;
      }

      objc_autoreleasePoolPop(v31);
      [(HMDHome *)v32 setMinimumNetworkRouterSupportHomeKitVersion:v21];
      v18 = 1;
    }
  }

  v37 = [v6 setProperties];
  v38 = [v37 containsObject:@"minHomeKitVersionForAccessoryNetworkProtectionChange"];

  if (v38)
  {
    v39 = [v6 minHomeKitVersionForAccessoryNetworkProtectionChange];

    if (v39)
    {
      v40 = [HMDHomeKitVersion alloc];
      v41 = [v6 minHomeKitVersionForAccessoryNetworkProtectionChange];
      v39 = [(HMDHomeKitVersion *)v40 initWithString:v41];
    }

    v42 = [(HMDHome *)self minHomeKitVersionForAccessoryNetworkProtectionChange];
    v43 = HMFEqualObjects();

    if (v43)
    {

      if ((v18 & 1) == 0)
      {
        goto LABEL_31;
      }
    }

    else
    {
      [(HMDHome *)self setMinHomeKitVersionForAccessoryNetworkProtectionChange:v39];
    }
  }

  else if (!v18)
  {
    goto LABEL_31;
  }

  [(HMDHome *)self _evaluateNetworkRouterManagementForTransaction:v8];
  [v8 markChanged];
LABEL_31:
  [v7 respondWithPayload:0];

  v44 = *MEMORY[0x277D85DE8];
}

- (void)updateHomeConfigurationWithModel:(id)a3 message:(id)a4
{
  v31 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 transactionResult];
  v9 = [v6 setProperties];
  v10 = [v9 containsObject:@"configurationVersion"];

  if (v10)
  {
    v11 = [v6 configurationVersion];
    v12 = [v11 integerValue];

    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = HMFGetLogIdentifier();
      v23 = 138544130;
      v24 = v16;
      v25 = 2048;
      v26 = v12;
      v27 = 2048;
      v28 = [(HMDHome *)v14 lastSyncedConfigurationVersion];
      v29 = 2048;
      v30 = [(HMDHome *)v14 configurationVersion];
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Received incoming configuration version %lu, last synced was %lu, and current is %lu", &v23, 0x2Au);
    }

    objc_autoreleasePoolPop(v13);
    if ([(HMDHome *)v14 isOwnerUser])
    {
      if (v12 >= [(HMDHome *)v14 configurationVersion])
      {
        v21 = [(HMDHome *)v14 configurationVersion];
        if (v21 <= [(HMDHome *)v14 lastSyncedConfigurationVersion])
        {
          [(HMDHome *)v14 setConfigurationVersion:v12];
        }

        else
        {
          [(HMDHome *)v14 setConfigurationVersion:v12 + 1];
          [(HMDHome *)v14 __saveConfigurationVersionTransaction];
        }

        [(HMDHome *)v14 setLastSyncedConfigurationVersion:v12];
      }

      else
      {
        [(HMDHome *)v14 __saveConfigurationVersionTransaction];
      }
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = v14;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        v20 = HMFGetLogIdentifier();
        v23 = 138543362;
        v24 = v20;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Shared user will use incoming configuration version", &v23, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      [(HMDHome *)v18 setConfigurationVersion:v12];
      [(HMDHome *)v18 setLastSyncedConfigurationVersion:v12];
      [(HMDHome *)v18 setExpectedConfigurationVersion:0];
    }
  }

  [v7 respondWithPayload:0];
  [v8 markChanged];

  v22 = *MEMORY[0x277D85DE8];
}

- (id)updateHomeWithModel:(id)a3 message:(id)a4
{
  v207 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)v7 transactionResult];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    *buf = 138543874;
    v202 = v12;
    v203 = 2112;
    v204 = v6;
    v205 = 2112;
    v206 = v7;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Updating home with model: %@ / %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v9);
  v13 = [(__CFString *)v6 setProperties];
  v14 = [v13 containsObject:@"primaryResidentUUID"];

  v186 = v8;
  if (v14)
  {
    v15 = [(__CFString *)v6 primaryResidentUUID];

    if (v15)
    {
      v16 = objc_alloc(MEMORY[0x277CCAD78]);
      v17 = [(__CFString *)v6 primaryResidentUUID];
      v15 = [v16 initWithUUIDString:v17];
    }

    v18 = [(HMDHome *)v10 residentDeviceManager];
    v19 = [v18 primaryResidentUUID];

    v20 = [(HMDHome *)v10 primaryResident];
    v21 = [v20 device];

    v22 = [(HMDHome *)v10 residentDeviceManager];
    [v22 updatePrimaryResidentWithUUID:v15 actions:v8];

    if (HMFEqualObjects())
    {
      v23 = objc_autoreleasePoolPush();
      v24 = v10;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543362;
        v202 = v26;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_INFO, "%{public}@Not resubscribing since the primary resident did not change", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v23);
      v8 = v186;
    }

    else
    {
      v27 = [(HMDHome *)v10 backingStore];
      v195[0] = MEMORY[0x277D85DD0];
      v195[1] = 3221225472;
      v195[2] = __39__HMDHome_updateHomeWithModel_message___block_invoke;
      v195[3] = &unk_279730430;
      v195[4] = v10;
      v196 = v15;
      v197 = v19;
      v198 = v21;
      [v27 submitBlock:v195];
    }

    if ([v8 source] == 1)
    {
      v28 = [(HMDHome *)v10 residentDeviceManager];
      v29 = [v28 primaryResidentDevice];
      v30 = [v29 isReachable];

      if ((v30 & 1) == 0)
      {
        v31 = [(HMDHome *)v10 residentDeviceManager];
        [v31 electResidentDevice:1];
      }
    }
  }

  v185 = [(HMDHome *)v10 currentUser];
  v32 = [(__CFString *)v6 setProperties];
  v33 = [v32 containsObject:@"presenceAuthorizationStatus"];

  if (v33)
  {
    v34 = MEMORY[0x277CD1F00];
    v35 = [(__CFString *)v6 presenceAuthorizationStatus];
    v36 = [v34 authWithNumber:v35];

    if (isPresenceAuthorizationValid())
    {
      v37 = [(HMDHome *)v10 presenceAuthStatus];
      v38 = HMFEqualObjects();

      if (v38)
      {
        v39 = objc_autoreleasePoolPush();
        v40 = v10;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          v43 = [(HMDHome *)v40 presenceAuthStatus];
          *buf = 138543618;
          v202 = v42;
          v203 = 2112;
          v204 = v43;
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Presence auth is not changing from %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v39);
        v8 = v186;
      }

      else
      {
        [(HMDHome *)v10 setPresenceAuthStatus:v36];
        [v185 setPresenceAuthStatus:v36];
        [v8 markChanged];
      }

      v182 = v38 ^ 1;
      if (![(HMDHome *)v10 isOwnerUser])
      {
        [v8 markSaveToSharedUserAccount];
      }
    }

    else
    {
      v44 = objc_autoreleasePoolPush();
      v45 = v10;
      v46 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
      {
        v47 = HMFGetLogIdentifier();
        v48 = [(__CFString *)v6 presenceAuthorizationStatus];
        *buf = 138543618;
        v202 = v47;
        v203 = 2112;
        v204 = v48;
        _os_log_impl(&dword_2531F8000, v46, OS_LOG_TYPE_INFO, "%{public}@Ignoring the value for presence auth in home model: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v44);
      v182 = 0;
    }
  }

  else
  {
    v182 = 0;
  }

  v49 = [(__CFString *)v6 setProperties];
  v50 = [v49 containsObject:@"presenceComputeStatus"];

  if (v50)
  {
    v51 = MEMORY[0x277CD1F08];
    v52 = [(__CFString *)v6 presenceComputeStatus];
    v53 = [v51 computeWithNumber:v52];

    if (v53)
    {
      v54 = [(HMDHome *)v10 presenceComputeStatus];
      v55 = HMFEqualObjects();

      if ((v55 & 1) == 0)
      {
        [(HMDHome *)v10 setPresenceComputeStatus:v53];
        if (![(HMDHome *)v10 isOwnerUser])
        {
          [v8 markSaveToSharedUserAccount];
        }

        [v8 markChanged];
      }
    }
  }

  v56 = [(__CFString *)v6 setProperties];
  v57 = [v56 containsObject:@"homeLocationData"];

  v183 = v7;
  if (v57)
  {
    v58 = [(HMDHome *)v10 homeLocationHandler];
    v59 = [v58 _handleHomeLocationData:v6 message:v7];

    if (v59)
    {
      v60 = v59;
    }

    else
    {
      v61 = [MEMORY[0x277CBEB58] set];
      v191 = 0u;
      v192 = 0u;
      v193 = 0u;
      v194 = 0u;
      v62 = [(HMDHome *)v10 dataSource];
      v63 = [v62 xpcMessageTransport];
      v64 = [v63 connections];

      v65 = [v64 countByEnumeratingWithState:&v191 objects:v200 count:16];
      if (v65)
      {
        v66 = v65;
        v67 = *v192;
        do
        {
          for (i = 0; i != v66; ++i)
          {
            if (*v192 != v67)
            {
              objc_enumerationMutation(v64);
            }

            v69 = [*(*(&v191 + 1) + 8 * i) processInfo];
            v70 = [v69 locationAuthorization];

            if (v70)
            {
              [v61 addObject:v70];
            }
          }

          v66 = [v64 countByEnumeratingWithState:&v191 objects:v200 count:16];
        }

        while (v66);
      }

      v189 = 0u;
      v190 = 0u;
      v187 = 0u;
      v188 = 0u;
      v71 = v61;
      v72 = [v71 countByEnumeratingWithState:&v187 objects:v199 count:16];
      v8 = v186;
      if (v72)
      {
        v73 = v72;
        v74 = *v188;
        do
        {
          for (j = 0; j != v73; ++j)
          {
            if (*v188 != v74)
            {
              objc_enumerationMutation(v71);
            }

            v76 = *(*(&v187 + 1) + 8 * j);
            if ([v76 isAuthorized])
            {
              [v76 mark];
            }
          }

          v73 = [v71 countByEnumeratingWithState:&v187 objects:v199 count:16];
        }

        while (v73);
      }

      v60 = 0;
      v7 = v183;
    }
  }

  else
  {
    v60 = 0;
  }

  v77 = [(__CFString *)v6 naturalLightingContext];
  v78 = [(__CFString *)v6 setProperties];
  v184 = v77;
  if ([v78 containsObject:@"encodedNaturalLightingContext"])
  {
    v79 = [(HMDHome *)v10 naturalLightingContext];
    v80 = [v79 isEqual:v77];

    if ((v80 & 1) == 0)
    {
      v81 = objc_autoreleasePoolPush();
      v82 = v10;
      v83 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v83, OS_LOG_TYPE_INFO))
      {
        v84 = HMFGetLogIdentifier();
        v85 = [(HMDHome *)v82 naturalLightingContext];
        *buf = 138543874;
        v202 = v84;
        v203 = 2112;
        v204 = v85;
        v205 = 2112;
        v206 = v77;
        _os_log_impl(&dword_2531F8000, v83, OS_LOG_TYPE_INFO, "%{public}@Updating natural lighting context from %@ -> %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v81);
      [(HMDHome *)v82 setNaturalLightingContext:v77];
      v8 = v186;
      [v186 markChanged];
    }
  }

  else
  {
  }

  v86 = [(__CFString *)v6 setProperties];
  if (![v86 containsObject:@"name"])
  {
    goto LABEL_71;
  }

  v87 = [(__CFString *)v6 name];
  v88 = [(HMDHome *)v10 name];
  v89 = [v87 isEqualToString:v88];

  if ((v89 & 1) == 0)
  {
    v90 = [(HMDHome *)v10 _handleRenameHomeModel:v6 message:v7];
    v86 = v90;
    if (v90)
    {
      v91 = v90;

      v60 = v91;
    }

    [v8 markSaveToAssistant];
    [v8 markChanged];
LABEL_71:
  }

  v92 = [(__CFString *)v6 creationDate];
  if (v92)
  {
    v93 = v92;
    v94 = [(__CFString *)v6 creationDate];
    v95 = [(HMDHome *)v10 creationDate];
    v96 = [v94 isEqualToDate:v95];

    if ((v96 & 1) == 0)
    {
      v97 = [(__CFString *)v6 creationDate];
      [(HMDHome *)v10 setCreationDate:v97];

      [v8 markChanged];
    }
  }

  v98 = [(__CFString *)v6 firstHAPAccessoryAddedDate];
  if (v98)
  {
    v99 = v98;
    v100 = [(__CFString *)v6 firstHAPAccessoryAddedDate];
    v101 = [(HMDHome *)v10 firstHAPAccessoryAddedDate];
    v102 = [v100 isEqualToDate:v101];

    if ((v102 & 1) == 0)
    {
      v103 = [(__CFString *)v6 firstHAPAccessoryAddedDate];
      [(HMDHome *)v10 setFirstHAPAccessoryAddedDate:v103];

      [v8 markChanged];
    }
  }

  v104 = [(__CFString *)v6 setProperties];
  if ([v104 containsObject:@"multiUserEnabled"])
  {
    v105 = [(__CFString *)v6 multiUserEnabled];
    v106 = [v105 BOOLValue];
    v107 = [(HMDHome *)v10 isMultiUserEnabled];

    if (v106 != v107)
    {
      v108 = objc_autoreleasePoolPush();
      v109 = v10;
      v110 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v110, OS_LOG_TYPE_INFO))
      {
        v111 = HMFGetLogIdentifier();
        v112 = [(__CFString *)v6 multiUserEnabled];
        v113 = @"YES";
        *buf = 138543874;
        v202 = v111;
        v203 = 2112;
        if (!v112)
        {
          v113 = @"NO";
        }

        v204 = v113;
        v205 = 2112;
        v206 = v109;
        _os_log_impl(&dword_2531F8000, v110, OS_LOG_TYPE_INFO, "%{public}@Merging multi-user enabled value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v108);
      [(HMDHome *)v109 _handleMultiUserEnabledChange:v6 message:v7];
      v8 = v186;
      [v186 markChanged];
    }
  }

  else
  {
  }

  if ([(__CFString *)v6 propertyWasSet:@"soundCheckEnabled"])
  {
    v114 = [(__CFString *)v6 soundCheckEnabled];
    v115 = [v114 BOOLValue];
    v116 = [(HMDHome *)v10 soundCheckEnabled];

    if (v115 != v116)
    {
      [(HMDHome *)v10 _handleSoundCheckChange:v6 message:v7];
      [v8 markChanged];
    }
  }

  if ([(__CFString *)v6 propertyWasSet:@"siriPhraseOptions"])
  {
    v117 = [(__CFString *)v6 siriPhraseOptions];
    v118 = [v117 unsignedIntegerValue];
    v119 = [(HMDHome *)v10 siriPhraseOptions];

    if (v118 != v119)
    {
      [(HMDHome *)v10 _handleSiriPhraseOptionsStatusChange:v6 message:v7];
      [v8 markChanged];
    }
  }

  if ([(__CFString *)v6 propertyWasSet:@"locationServicesEnabled"])
  {
    v120 = [(__CFString *)v6 locationServicesEnabled];
    v121 = [v120 BOOLValue];
    v122 = [(HMDHome *)v10 locationServicesEnabled];

    if (v121 != v122)
    {
      [(HMDHome *)v10 _handleLocationServicesEnabledChange:v6 message:v7];
      [v8 markChanged];
    }
  }

  if ([(__CFString *)v6 propertyWasSet:@"didOnboardLocationServices"])
  {
    v123 = [(__CFString *)v6 didOnboardLocationServices];
    v124 = [v123 BOOLValue];
    v125 = [(HMDHome *)v10 didOnboardLocationServices];

    if (v124 != v125)
    {
      [(HMDHome *)v10 _handleDidOnboardLocationServicesChange:v6 message:v7];
      [v8 markChanged];
    }
  }

  v126 = [(__CFString *)v6 setProperties];
  if ([v126 containsObject:@"hasAnyUserAcknowledgedCameraRecordingOnboarding"])
  {
    v127 = [(__CFString *)v6 hasAnyUserAcknowledgedCameraRecordingOnboarding];
    v128 = [v127 BOOLValue];
    v129 = [(HMDHome *)v10 hasAnyUserAcknowledgedCameraRecordingOnboarding];

    if (v128 != v129)
    {
      v130 = objc_autoreleasePoolPush();
      v131 = v10;
      v132 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v132, OS_LOG_TYPE_INFO))
      {
        v133 = HMFGetLogIdentifier();
        v134 = [(__CFString *)v6 hasAnyUserAcknowledgedCameraRecordingOnboarding];
        v135 = @"YES";
        *buf = 138543874;
        v202 = v133;
        v203 = 2112;
        if (!v134)
        {
          v135 = @"NO";
        }

        v204 = v135;
        v205 = 2112;
        v206 = v131;
        _os_log_impl(&dword_2531F8000, v132, OS_LOG_TYPE_INFO, "%{public}@Merging home's has any user acknowledged camera recording onboarding value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v130);
      [(HMDHome *)v131 _handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:v6 message:v7];
      v8 = v186;
      [v186 markChanged];
    }
  }

  else
  {
  }

  v136 = [(__CFString *)v6 setProperties];
  if ([v136 containsObject:@"hasOnboardedForAccessCode"])
  {
    v137 = [(__CFString *)v6 hasOnboardedForAccessCode];
    v138 = [v137 BOOLValue];
    v139 = [(HMDHome *)v10 hasOnboardedForAccessCode];

    if (v138 != v139)
    {
      v140 = objc_autoreleasePoolPush();
      v141 = v10;
      v142 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v142, OS_LOG_TYPE_INFO))
      {
        v143 = HMFGetLogIdentifier();
        v144 = [(__CFString *)v6 hasOnboardedForAccessCode];
        [v144 BOOLValue];
        v145 = HMFBooleanToString();
        *buf = 138543874;
        v202 = v143;
        v203 = 2112;
        v204 = v145;
        v205 = 2112;
        v206 = v141;
        _os_log_impl(&dword_2531F8000, v142, OS_LOG_TYPE_INFO, "%{public}@Merging home's has onboarded for access code value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v140);
      [(HMDHome *)v141 _handleSetHasOnboardedForAccessCodeChange:v6 message:v7];
      v8 = v186;
      [v186 markChanged];
    }
  }

  else
  {
  }

  v146 = [(__CFString *)v6 setProperties];
  if ([v146 containsObject:@"hasOnboardedForWalletKey"])
  {
    v147 = [(__CFString *)v6 hasOnboardedForWalletKey];
    v148 = [v147 BOOLValue];
    v149 = [(HMDHome *)v10 hasOnboardedForWalletKey];

    if (v148 != v149)
    {
      v150 = objc_autoreleasePoolPush();
      v151 = v10;
      v152 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v152, OS_LOG_TYPE_INFO))
      {
        v153 = HMFGetLogIdentifier();
        v154 = [(__CFString *)v6 hasOnboardedForWalletKey];
        [v154 BOOLValue];
        v155 = HMFBooleanToString();
        *buf = 138543874;
        v202 = v153;
        v203 = 2112;
        v204 = v155;
        v205 = 2112;
        v206 = v151;
        _os_log_impl(&dword_2531F8000, v152, OS_LOG_TYPE_INFO, "%{public}@Merging home's has onboarded for wallet key value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v150);
      [(HMDHome *)v151 _handleSetHasOnboardedForWalletKeyChange:v6 message:v7];
      v8 = v186;
      [v186 markChanged];
    }
  }

  else
  {
  }

  v156 = [(__CFString *)v6 setProperties];
  v157 = [v156 containsObject:@"networkProtectionMode"];

  if (v157)
  {
    [(HMDHome *)v10 _handleUpdateNetworkProtectionWithHomeModel:v6 message:v7];
  }

  if (![(HMDHome *)v10 isOwnerUser])
  {
    v165 = [v8 source] != 2 && objc_msgSend(v8, "source") != 3;
    v170 = [(__CFString *)v6 setProperties];
    v171 = [v170 containsObject:@"sharedHomeSourceVersion"];

    if (v171)
    {
      if (v165)
      {
        [(HMDHome *)v10 _handleReceivedNonCloudSourcedSharedHomeModel];
        v172 = objc_autoreleasePoolPush();
        v173 = v10;
        v174 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v174, OS_LOG_TYPE_INFO))
        {
          v175 = HMFGetLogIdentifier();
          v176 = [(HMDHome *)v173 sharedHomeSourceVersion];
          v177 = [(__CFString *)v6 sharedHomeSourceVersion];
          *buf = 138543874;
          v202 = v175;
          v203 = 2112;
          v204 = v176;
          v205 = 2112;
          v206 = v177;
          _os_log_impl(&dword_2531F8000, v174, OS_LOG_TYPE_INFO, "%{public}@Updating shared home source version from %@ to %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v172);
        v178 = [(HMDHome *)v173 sharedHomeSourceVersion];
        v179 = [(__CFString *)v6 sharedHomeSourceVersion];
        v180 = HMFEqualObjects();

        v8 = v186;
        if ((v180 & 1) == 0)
        {
          v181 = [(__CFString *)v6 sharedHomeSourceVersion];
          [(HMDHome *)v173 setSharedHomeSourceVersion:v181];

          [v186 markChanged];
        }
      }
    }
  }

  if ([(__CFString *)v6 propertyWasSet:@"threadOperationalDataset"])
  {
    v158 = [(__CFString *)v6 threadOperationalDataset];

    if (v158)
    {
      [(HMDHome *)v10 updateThreadOperationalDatasetWithHomeModel:v6 message:v183];
    }
  }

  [(HMDHome *)v10 handleUpdatedCHIPPropertiesOnHomeModel:v6 actions:v8];
  v159 = [(HMDHome *)v183 responseHandler];

  if (v159)
  {
    v160 = [(HMDHome *)v183 responseHandler];
    (v160)[2](v160, v60, 0);
  }

  if (v182)
  {
    v161 = [(HMDHome *)v183 name];
    v162 = HMFEqualObjects();

    v163 = [(HMDHome *)v10 presenceFeeder];
    v164 = v163;
    if (v162)
    {
      [v163 presenceAuthChanged];
    }

    else
    {
      v166 = [(HMDHome *)v10 presenceAuthStatus];
      [v164 presenceAuthStatusChangedForUser:v185 presenceAuthStatus:v166];
    }
  }

  v167 = v60;

  v168 = *MEMORY[0x277D85DE8];
  return v60;
}

void __39__HMDHome_updateHomeWithModel_message___block_invoke(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v9 = *(a1 + 48);
    v11 = 138543874;
    v12 = v7;
    v13 = 2112;
    v14 = v8;
    v15 = 2112;
    v16 = v9;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Scheduling resubscription for new primary resident: %@, old primary: %@", &v11, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 32) resubscribeForNotificationsOnResident:*(a1 + 56)];

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateNetworkProtectionWithHomeModel:(id)a3 message:(id)a4
{
  v9 = a4;
  v6 = [a3 networkProtectionMode];
  v7 = [v6 unsignedIntegerValue];

  if ([(HMDHome *)self protectionMode]!= v7)
  {
    [(HMDHome *)self setProtectionMode:v7];
    v8 = [v9 transactionResult];
    [(HMDHome *)self _handleNetworkProtectionModeChangeForTransaction:v8];
    [v8 markChanged];
  }
}

- (id)timerWithTimerInterval:(double)a3
{
  v3 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:0 options:a3];

  return v3;
}

- (id)propertiesRegisteredForMediaProfileUniqueIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self notificationRegistry];
  v6 = [v5 propertiesRegisteredForMediaProfileUniqueIdentifier:v4];

  return v6;
}

- (id)accessoryForMediaProfileUniqueIdentifier:(id)a3
{
  v3 = [(HMDHome *)self mediaProfileWithUUID:a3];
  v4 = [v3 accessory];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  return v5;
}

- (NSNumber)availableBorderRouters
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_availableBorderRouters;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setAvailableBorderRouters:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  availableBorderRouters = self->_availableBorderRouters;
  self->_availableBorderRouters = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSNumber)availableBSPsCount
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_availableBSPsCount;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setAvailableBSPsCount:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  availableBSPsCount = self->_availableBSPsCount;
  self->_availableBSPsCount = v4;

  os_unfair_recursive_lock_unlock();
}

- (id)dumpMediaSessionDescriptionWithPrivacyLevel:(unint64_t)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = MEMORY[0x277CBEB18];
  v6 = [(HMDHome *)self mediaSessionStates];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(v6, "count")}];

  v18 = 0u;
  v19 = 0u;
  v16 = 0u;
  v17 = 0u;
  v8 = [(HMDHome *)self mediaSessionStates];
  v9 = [v8 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v17;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v17 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = [*(*(&v16 + 1) + 8 * i) dumpStateWithPrivacyLevel:a3];
        [v7 addObject:v13];
      }

      v10 = [v8 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v10);
  }

  v14 = *MEMORY[0x277D85DE8];

  return v7;
}

- (id)dumpCharacteristicNotificationRegistry
{
  v3 = MEMORY[0x277CCAB68];
  v4 = [(HMDHome *)self name];
  v5 = [(HMDHome *)self uuid];
  v6 = [v5 UUIDString];
  v7 = [v3 stringWithFormat:@"Home %@/%@:", v4, v6];

  v8 = [(HMDHome *)self notificationRegistry];
  v9 = [v8 shortDescription];
  [v7 appendString:v9];

  return v7;
}

- (id)dumpActionSetDescriptionWithPrivacyLevel:(unint64_t)a3
{
  v33 = *MEMORY[0x277D85DE8];
  v5 = MEMORY[0x277CBEB18];
  v6 = [(HMDHome *)self mediaSessionStates];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(v6, "count")}];

  v8 = [(HMDHome *)self actionSets];
  v27 = 0u;
  v28 = 0u;
  v29 = 0u;
  v30 = 0u;
  v9 = [v8 countByEnumeratingWithState:&v27 objects:v32 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v28;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v28 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = [*(*(&v27 + 1) + 8 * i) dumpStateWithPrivacyLevel:a3];
        [v7 addObject:v13];
      }

      v10 = [v8 countByEnumeratingWithState:&v27 objects:v32 count:16];
    }

    while (v10);
  }

  v14 = [(HMDHome *)self triggerOwnedActionSets];
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v15 = [v14 countByEnumeratingWithState:&v23 objects:v31 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v24;
    do
    {
      for (j = 0; j != v16; ++j)
      {
        if (*v24 != v17)
        {
          objc_enumerationMutation(v14);
        }

        v19 = [*(*(&v23 + 1) + 8 * j) dumpStateWithPrivacyLevel:a3];
        [v7 addObject:v19];
      }

      v16 = [v14 countByEnumeratingWithState:&v23 objects:v31 count:16];
    }

    while (v16);
  }

  v20 = [v7 copy];

  v21 = *MEMORY[0x277D85DE8];

  return v20;
}

- (void)_handleResponseForElectMessageToResident:(id)a3 error:(id)a4
{
  v44 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v8);

  if ([(HMDHome *)self remoteAccessIsEnabled])
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
LABEL_5:

      objc_autoreleasePoolPop(v9);
      goto LABEL_19;
    }

    v12 = HMFGetLogIdentifier();
    v13 = [v6 userID];
    v38 = 138543618;
    v39 = v12;
    v40 = 2112;
    v41 = v13;
    v14 = "%{public}@Received response for ping message to resident %@. Remote access is already setup, dropping response";
LABEL_4:
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, v14, &v38, 0x16u);

    goto LABEL_5;
  }

  if (v7)
  {
    v15 = [v7 domain];
    if ([v15 isEqualToString:*MEMORY[0x277D18538]])
    {
      if ([v7 code] == 16)
      {

LABEL_21:
        v9 = objc_autoreleasePoolPush();
        v10 = self;
        v11 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          goto LABEL_5;
        }

        v12 = HMFGetLogIdentifier();
        v13 = [v6 userID];
        v38 = 138543618;
        v39 = v12;
        v40 = 2112;
        v41 = v13;
        v14 = "%{public}@Failed to ping resident %@, will try again at next heartbeat";
        goto LABEL_4;
      }

      v37 = [v7 code];

      if (v37 == 23)
      {
        goto LABEL_21;
      }
    }

    else
    {
    }

    v29 = objc_autoreleasePoolPush();
    v30 = self;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
    {
      v32 = HMFGetLogIdentifier();
      v33 = [v6 userID];
      v38 = 138543874;
      v39 = v32;
      v40 = 2112;
      v41 = v33;
      v42 = 2112;
      v43 = v7;
      _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_INFO, "%{public}@Failed to ping resident %@, but error %@ is not specific IDS error, will not re-try at next heartbeat", &v38, 0x20u);
    }

    objc_autoreleasePoolPop(v29);
    v34 = [(HMDHome *)v30 heartbeatPingMessagesQueuedWithServer];
    v35 = [v6 userID];
    [v34 addObject:v35];
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v6 userID];
      v38 = 138543618;
      v39 = v19;
      v40 = 2112;
      v41 = v20;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Successfully sent ping message to resident %@, remembering queued message", &v38, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v21 = [(HMDHome *)v17 heartbeatPingMessagesQueuedWithServer];
    v22 = [v6 userID];
    [v21 addObject:v22];

    v23 = objc_autoreleasePoolPush();
    v24 = v17;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      v38 = 138543362;
      v39 = v26;
      _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled, requesting electing a remote peer", &v38, 0xCu);
    }

    objc_autoreleasePoolPop(v23);
    v27 = [(HMDHome *)v24 homeManager];
    v28 = [(HMDHome *)v24 uuid];
    [v27 electRemoteAccessPeerForHome:v28];
  }

LABEL_19:

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_remoteAccessHealthMonitorTimerDidFire
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  if (![(HMDHome *)self remoteAccessIsEnabled])
  {
    v4 = [(HMDHome *)self _residentUsers];
    objc_initWeak(&location, self);
    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    obj = v4;
    v5 = [obj countByEnumeratingWithState:&v30 objects:v39 count:16];
    if (v5)
    {
      v27 = *v31;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v31 != v27)
          {
            objc_enumerationMutation(obj);
          }

          v7 = *(*(&v30 + 1) + 8 * i);
          v8 = [(HMDHome *)self heartbeatPingMessagesQueuedWithServer];
          v9 = [v7 userID];
          v10 = [v8 containsObject:v9];

          v11 = objc_autoreleasePoolPush();
          v12 = self;
          if (v10)
          {
            v13 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
            {
              v14 = HMFGetLogIdentifier();
              v15 = [v7 userID];
              *buf = 138543618;
              v36 = v14;
              v37 = 2112;
              v38 = v15;
              _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Remote access health monitor fired, but we already have a ping queued with server to %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v11);
          }

          else
          {
            v16 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
            {
              v17 = HMFGetLogIdentifier();
              v18 = [v7 userID];
              *buf = 138543618;
              v36 = v17;
              v37 = 2112;
              v38 = v18;
              _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Remote access health monitor fired, sending ping elect message to %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v11);
            aBlock[0] = MEMORY[0x277D85DD0];
            aBlock[1] = 3221225472;
            aBlock[2] = __49__HMDHome__remoteAccessHealthMonitorTimerDidFire__block_invoke;
            aBlock[3] = &unk_279722BD0;
            objc_copyWeak(&v29, &location);
            aBlock[4] = v7;
            v19 = _Block_copy(aBlock);
            v20 = [(HMDHome *)v12 homeManager];
            v21 = [v20 messageDispatcher];
            v22 = [v7 userID];
            v23 = [v7 userID];
            v24 = [(HMDHome *)v12 workQueue];
            [v21 electDeviceForHH1User:v22 destination:v23 deviceCapabilities:0 responseTimeout:v24 responseQueue:v19 responseHandler:600.0];

            objc_destroyWeak(&v29);
          }
        }

        v5 = [obj countByEnumeratingWithState:&v30 objects:v39 count:16];
      }

      while (v5);
    }

    objc_destroyWeak(&location);
  }

  v25 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome__remoteAccessHealthMonitorTimerDidFire__block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v6)
    {
      v4 = [v6 userInfo];
      v5 = [v4 objectForKeyedSubscript:*MEMORY[0x277CCA7E8]];

      [WeakRetained _handleResponseForElectMessageToResident:*(a1 + 32) error:v5];
    }

    else
    {
      [WeakRetained _handleResponseForElectMessageToResident:*(a1 + 32) error:0];
    }
  }
}

- (void)remoteAccessHealthMonitorTimerDidFire
{
  if (isiOSDevice())
  {
    v3 = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __48__HMDHome_remoteAccessHealthMonitorTimerDidFire__block_invoke;
    block[3] = &unk_279735D00;
    block[4] = self;
    dispatch_async(v3, block);
  }
}

- (void)_handleDidReceiveIDSMessageWithNoListenerFromAddress:(id)a3
{
  v36 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = shouldLogPrivateInformation();
  v6 = @"...";
  if (v5)
  {
    v6 = v4;
  }

  v7 = v6;
  if ([(HMDHome *)self remoteAccessIsEnabled])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v11;
      v34 = 2112;
      v35 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Received IDS message from %@ but home has remote access enabled, ignoring notification", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  else
  {
    v29 = 0u;
    v30 = 0u;
    v27 = 0u;
    v28 = 0u;
    v12 = [(HMDHome *)self _residentUsers];
    v13 = [v12 countByEnumeratingWithState:&v27 objects:v31 count:16];
    if (v13)
    {
      v14 = v13;
      v15 = *v28;
      while (2)
      {
        for (i = 0; i != v14; ++i)
        {
          if (*v28 != v15)
          {
            objc_enumerationMutation(v12);
          }

          v17 = *(*(&v27 + 1) + 8 * i);
          if ([v17 configurationState] == 2)
          {
            v18 = [v17 userID];
            v19 = [v18 isEqualToString:v4];

            if (v19)
            {
              v20 = objc_autoreleasePoolPush();
              v21 = self;
              v22 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
              {
                v23 = HMFGetLogIdentifier();
                *buf = 138543618;
                v33 = v23;
                v34 = 2112;
                v35 = v7;
                _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled but we received a message from resident at %@, requesting electing a remote peer", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v20);
              v24 = [(HMDHome *)v21 homeManager];
              v25 = [(HMDHome *)v21 uuid];
              [v24 electRemoteAccessPeerForHome:v25];

              goto LABEL_20;
            }
          }
        }

        v14 = [v12 countByEnumeratingWithState:&v27 objects:v31 count:16];
        if (v14)
        {
          continue;
        }

        break;
      }
    }

LABEL_20:
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)handleDidReceiveIDSMessageWithNoListener:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __52__HMDHome_handleDidReceiveIDSMessageWithNoListener___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __52__HMDHome_handleDidReceiveIDSMessageWithNoListener___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) userInfo];

  if (v2)
  {
    v3 = [*(a1 + 32) userInfo];
    v5 = [v3 hmf_stringForKey:@"kIDSMessageSourceIDKey"];

    v4 = v5;
    if (v5)
    {
      [*(a1 + 40) _handleDidReceiveIDSMessageWithNoListenerFromAddress:v5];
      v4 = v5;
    }
  }
}

- (void)handleActiveAccountChanged:(id)a3
{
  v4 = [a3 userInfo];
  v5 = [v4 objectForKeyedSubscript:@"HMDAccountNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  v8 = [(HMDHome *)self workQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __38__HMDHome_handleActiveAccountChanged___block_invoke;
  v10[3] = &unk_2797359B0;
  v10[4] = self;
  v11 = v7;
  v9 = v7;
  dispatch_async(v8, v10);
}

- (void)handleAccountHandlesUpdated:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __39__HMDHome_handleAccountHandlesUpdated___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __39__HMDHome_handleAccountHandlesUpdated___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v7 = v3;

  v4 = +[HMDAppleAccountManager sharedManager];
  v5 = [v4 account];
  v6 = [v7 isEqualToAccount:v5];

  if (v6)
  {
    __updateAccountHandleForCurrentUser(*(a1 + 40), v7);
  }
}

- (void)removeUnconfiguredResidentDeviceWithUserID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __54__HMDHome_removeUnconfiguredResidentDeviceWithUserID___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __54__HMDHome_removeUnconfiguredResidentDeviceWithUserID___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) unconfiguredResidentDevices];
  v4 = [v2 hmf_firstObjectWithValue:*(a1 + 40) forKeyPath:@"userID"];

  if (v4)
  {
    [v4 setConfigurationState:2];
    v3 = [*(a1 + 32) unconfiguredResidentDevices];
    [v3 removeObject:v4];
  }
}

- (void)addUnconfiguredResidentDevice:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome_addUnconfiguredResidentDevice___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __41__HMDHome_addUnconfiguredResidentDevice___block_invoke(uint64_t a1)
{
  v42 = *MEMORY[0x277D85DE8];
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v2 = [*(a1 + 32) unconfiguredResidentDevices];
  v3 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v32 objects:v41 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v33;
LABEL_3:
    v6 = 0;
    while (1)
    {
      if (*v33 != v5)
      {
        objc_enumerationMutation(v2);
      }

      v7 = [*(*(&v32 + 1) + 8 * v6) device];
      v8 = [v7 isEqual:*(a1 + 40)];

      if (v8)
      {
        break;
      }

      if (v4 == ++v6)
      {
        v4 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v32 objects:v41 count:16];
        if (v4)
        {
          goto LABEL_3;
        }

        goto LABEL_9;
      }
    }

    v21 = objc_autoreleasePoolPush();
    v22 = *(a1 + 32);
    v23 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      goto LABEL_25;
    }

    v24 = HMFGetLogIdentifier();
    v25 = [*(a1 + 40) shortDescription];
    *buf = 138543618;
    v38 = v24;
    v39 = 2112;
    v40 = v25;
    v26 = "%{public}@Not adding resident device, %@, to unconfigured list since it already exists";
  }

  else
  {
LABEL_9:

    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    v2 = [*(a1 + 32) _residentUsers];
    v9 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v28 objects:v36 count:16];
    if (!v9)
    {
LABEL_17:

      v15 = objc_autoreleasePoolPush();
      v16 = *(a1 + 32);
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v19 = [*(a1 + 40) shortDescription];
        *buf = 138543618;
        v38 = v18;
        v39 = 2112;
        v40 = v19;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Adding resident device, %@, to unconfigured list and posting notification", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
      v2 = [[HMDResidentUser alloc] initWithDevice:*(a1 + 40) home:*(a1 + 32) pairingIdentity:0 configurationState:1];
      v20 = [*(a1 + 32) unconfiguredResidentDevices];
      [v20 addObject:v2];

      [(HMDUser *)v2 setHome:*(a1 + 32)];
      [*(a1 + 32) _configureUnconfiguredResident:v2 desiredConfigState:2];
      goto LABEL_26;
    }

    v10 = v9;
    v11 = *v29;
LABEL_11:
    v12 = 0;
    while (1)
    {
      if (*v29 != v11)
      {
        objc_enumerationMutation(v2);
      }

      v13 = [*(*(&v28 + 1) + 8 * v12) device];
      v14 = [v13 isEqual:*(a1 + 40)];

      if (v14)
      {
        break;
      }

      if (v10 == ++v12)
      {
        v10 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v28 objects:v36 count:16];
        if (v10)
        {
          goto LABEL_11;
        }

        goto LABEL_17;
      }
    }

    v21 = objc_autoreleasePoolPush();
    v22 = *(a1 + 32);
    v23 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      goto LABEL_25;
    }

    v24 = HMFGetLogIdentifier();
    v25 = [*(a1 + 40) shortDescription];
    *buf = 138543618;
    v38 = v24;
    v39 = 2112;
    v40 = v25;
    v26 = "%{public}@Not adding resident device, %@, to unconfigured list since it already exists in users";
  }

  _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, v26, buf, 0x16u);

LABEL_25:
  objc_autoreleasePoolPop(v21);
LABEL_26:

  v27 = *MEMORY[0x277D85DE8];
}

- (void)timerDidFire:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [(HMDHome *)self modifyNotificationsCoalesceTimer];

  if (v6 == v4)
  {
    [(HMDHome *)self _handleCoalescedModifyNotifications];
  }

  else
  {
    v7 = [(HMDHome *)self disableNotificationTimer];

    if (v7 == v4)
    {
      [(HMDHome *)self _handleDisableNotificationsTimerFired];
    }

    else
    {
      v8 = [(HMDHome *)self reachabilityNotificationTimer];

      if (v8 == v4)
      {
        [(HMDHome *)self _handleRemoteReachabilityNotificationTimerFired];
      }

      else
      {
        v9 = [(HMDHome *)self pendingResponsesTimer];

        if (v9 == v4)
        {
          [(HMDHome *)self _handlePendingResponsesTimerFired:0];
        }

        else if (self->_homeLocationTimer == v4)
        {
          v10 = objc_autoreleasePoolPush();
          v11 = self;
          v12 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
          {
            v13 = HMFGetLogIdentifier();
            v15 = 138543362;
            v16 = v13;
            _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Evaluating home location", &v15, 0xCu);
          }

          objc_autoreleasePoolPop(v10);
          [(HMDHome *)v11 updateHomeLocation];
        }

        else if (self->_accessoryReachabilityUpdatesTimer == v4)
        {
          [(HMDHome *)self _handleAccessoryReachabilityUpdatesTimerFired];
        }
      }
    }
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleAccessoryReachabilityUpdatesTimerFired
{
  v102 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_reachabilityUpdatedAccessories allObjects];
  [(NSMutableSet *)self->_reachabilityUpdatedAccessories removeAllObjects];
  os_unfair_recursive_lock_unlock();
  v4 = self;
  v69 = v3;
  v59 = [v69 count];
  v5 = objc_autoreleasePoolPush();
  v72 = v4;
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (v59)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v99 = v8;
      v100 = 2048;
      v101 = v59;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Sending accessory reachability updates - number of entries %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v71 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
    v61 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
    v70 = [MEMORY[0x277CBEB18] arrayWithCapacity:v59];
    v87 = 0u;
    v88 = 0u;
    v85 = 0u;
    v86 = 0u;
    obj = [(HMDHome *)v72 accessories];
    v9 = [obj countByEnumeratingWithState:&v85 objects:buf count:16];
    if (v9)
    {
      v66 = *v86;
      v62 = *MEMORY[0x277CCEC80];
      v60 = *MEMORY[0x277CCF048];
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v86 != v66)
          {
            objc_enumerationMutation(obj);
          }

          v11 = *(*(&v85 + 1) + 8 * i);
          v12 = [v11 uuid];
          v13 = [v12 UUIDString];

          if ([v69 containsObject:v13])
          {
            v14 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v11, "isReachableForXPCClients")}];
            v15 = [v11 messageSendPolicy];
            v16 = [v71 hmf_mutableDictionaryForKey:v15];
            if (!v16)
            {
              v16 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
              [v71 setObject:v16 forKey:v15];
            }

            v17 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:3];
            [v17 setObject:v14 forKeyedSubscript:@"kAccessoryIsReachableKey"];
            v18 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v11, "reachableTransports")}];
            [v17 setObject:v18 forKeyedSubscript:v62];

            v19 = v11;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v20 = v19;
            }

            else
            {
              v20 = 0;
            }

            v21 = v20;

            if (v21)
            {
              v22 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v21, "suspendedState")}];
              [v17 setObject:v22 forKeyedSubscript:v60];
            }

            v23 = [v17 copy];
            [v16 setObject:v23 forKeyedSubscript:v13];

            if (([v15 entitlements] & 4) == 0)
            {
              v24 = [v61 hmf_mutableDictionaryForKey:v15];
              if (!v24)
              {
                v24 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
                [v61 setObject:v24 forKey:v15];
              }

              v96 = @"kAccessoryIsReachableKey";
              v97 = v14;
              v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v97 forKeys:&v96 count:1];
              [v24 setObject:v25 forKeyedSubscript:v13];
            }
          }
        }

        v9 = [obj countByEnumeratingWithState:&v85 objects:buf count:16];
      }

      while (v9);
    }

    v83 = 0u;
    v84 = 0u;
    v81 = 0u;
    v82 = 0u;
    obja = [v71 allKeys];
    v26 = [obja countByEnumeratingWithState:&v81 objects:v95 count:16];
    if (v26)
    {
      v27 = *v82;
      v28 = *MEMORY[0x277CCE9C0];
      v67 = *MEMORY[0x277CCE7A8];
      do
      {
        for (j = 0; j != v26; ++j)
        {
          if (*v82 != v27)
          {
            objc_enumerationMutation(obja);
          }

          v30 = *(*(&v81 + 1) + 8 * j);
          v31 = [v71 hmf_mutableDictionaryForKey:{v30, v59}];
          if ([v31 count])
          {
            v32 = MEMORY[0x277D0F848];
            v33 = [(HMDHome *)v72 messageDestination];
            v93 = v67;
            v34 = [v31 copy];
            v94 = v34;
            v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v94 forKeys:&v93 count:1];
            v36 = [v32 messageWithName:v28 destination:v33 payload:v35];

            if (([v30 entitlements] & 4) != 0)
            {
              v37 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v30 entitlements], objc_msgSend(v30, "options"), 1);
            }

            else
            {
              v37 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v30 entitlements] | 4, objc_msgSend(v30, "options"), 1);
            }

            v38 = v37;
            [v36 setSendPolicy:v37];

            [v70 addObject:v36];
          }
        }

        v26 = [obja countByEnumeratingWithState:&v81 objects:v95 count:16];
      }

      while (v26);
    }

    v79 = 0u;
    v80 = 0u;
    v77 = 0u;
    v78 = 0u;
    objb = [v61 allKeys];
    v39 = [objb countByEnumeratingWithState:&v77 objects:v92 count:16];
    if (v39)
    {
      v40 = *v78;
      v41 = *MEMORY[0x277CCE9C0];
      v68 = *MEMORY[0x277CCE7A8];
      do
      {
        for (k = 0; k != v39; ++k)
        {
          if (*v78 != v40)
          {
            objc_enumerationMutation(objb);
          }

          v43 = *(*(&v77 + 1) + 8 * k);
          v44 = [v71 hmf_mutableDictionaryForKey:{v43, v59}];
          if ([v44 count])
          {
            v45 = MEMORY[0x277D0F848];
            v46 = [(HMDHome *)v72 messageDestination];
            v90 = v68;
            v47 = [v44 copy];
            v91 = v47;
            v48 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v91 forKeys:&v90 count:1];
            v49 = [v45 messageWithName:v41 destination:v46 payload:v48];

            [v49 setRequiresNoSPIEntitlement:1];
            v50 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v43 entitlements], objc_msgSend(v43, "options"), 1);
            [v49 setSendPolicy:v50];
            [v70 addObject:v49];
          }
        }

        v39 = [objb countByEnumeratingWithState:&v77 objects:v92 count:16];
      }

      while (v39);
    }

    v51 = [v70 copy];
  }

  else
  {
    if (v7)
    {
      v52 = HMFGetLogIdentifier();
      *buf = 138543362;
      v99 = v52;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Reachability update timer fired but no entries", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v51 = MEMORY[0x277CBEBF8];
  }

  v73 = 0u;
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  v53 = [v51 countByEnumeratingWithState:&v73 objects:v89 count:16];
  if (v53)
  {
    v54 = *v74;
    do
    {
      for (m = 0; m != v53; ++m)
      {
        if (*v74 != v54)
        {
          objc_enumerationMutation(v51);
        }

        v56 = *(*(&v73 + 1) + 8 * m);
        v57 = [(HMDHome *)v72 msgDispatcher];
        [v57 sendMessage:v56];
      }

      v53 = [v51 countByEnumeratingWithState:&v73 objects:v89 count:16];
    }

    while (v53);
  }

  v58 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientsOfReachabilityUpdateForAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __57__HMDHome_notifyClientsOfReachabilityUpdateForAccessory___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __57__HMDHome_notifyClientsOfReachabilityUpdateForAccessory___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [v2 UUIDString];

  if (v3)
  {
    v4 = *(a1 + 40);
    os_unfair_recursive_lock_lock_with_options();
    if ([*(*(a1 + 40) + 184) containsObject:v3])
    {
      v5 = 0;
    }

    else
    {
      [*(*(a1 + 40) + 184) addObject:v3];
      v5 = [*(*(a1 + 40) + 184) count] == 1;
    }

    os_unfair_recursive_lock_unlock();
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [*(a1 + 32) shortDescription];
      v16 = HMFBooleanToString();
      v18 = 138543874;
      v19 = v14;
      v20 = 2112;
      v21 = v15;
      v22 = 2112;
      v23 = v16;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Queuing up reachability update for accessory %@. Started timer: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    if (v5)
    {
      [*(*(a1 + 40) + 176) resume];
    }
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 32);
      v18 = 138543618;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Attempt to queue reachability update for accessory with no UUID - %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleDisableNotificationsTimerFired
{
  v38 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = [(HMDHome *)self notificationRegistrations];
  v5 = [v4 copy];

  v6 = [(HMDHome *)self notificationDeregistrations];
  v7 = [v6 copy];

  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = [v5 shortDescription];
    v13 = [v7 shortDescription];
    v32 = 138543874;
    v33 = v11;
    v34 = 2112;
    v35 = v12;
    v36 = 2112;
    v37 = v13;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Notification disable timer fired - registrations %@  deregistrations %@", &v32, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [(HMDHome *)v9 setDisableNotificationTimer:0];
  v14 = [(HMDHome *)v9 notificationRegistrationsForAppleMediaAccessories];
  v15 = [v14 count];

  [(HMDHome *)v9 _applyNotificationDeregistrations];
  v16 = [(HMDHome *)v9 notificationRegistrations];
  v17 = [v16 count];

  v18 = [(HMDHome *)v9 notificationRegistrationsForAppleMediaAccessories];
  v19 = [v18 count];

  if (!v19 && v15)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = v9;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      v32 = 138543362;
      v33 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Modifying Apple Media notification registrations with devices due to HomeKit client no longer active", &v32, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    [(HMDHome *)v21 _subscribeForHomeAppleMediaNotificationsOnDirectTransports:?];
  }

  if (!v17)
  {
    v24 = objc_autoreleasePoolPush();
    v25 = v9;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      v32 = 138543362;
      v33 = v27;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to HomeKit client no longer active", &v32, 0xCu);
    }

    objc_autoreleasePoolPop(v24);
    [(HMDHome *)v25 _subscribeForHomeNotificationsFromRemoteGateway:0];
    [(HMDHome *)v25 _subscribeForHomeNotificationsOnDirectTransports:?];
    v28 = [MEMORY[0x277CBEAA8] date];
    [(HMDHome *)v25 setNotificationsUpdatedTime:v28];

    v29 = [(HMDHome *)v25 homeManager];
    v30 = [v29 chipDataSource];
    [v30 updateNotificationsEnabled:0 forHome:v25 keepAliveOnly:0];

    logAndPostNotification(@"HMDHomeDidDisableCharacteristicNotifyEventNotification", v25, 0);
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_subscribeForHomeAppleMediaNotificationsOnDirectTransports:(void *)a1
{
  v15 = *MEMORY[0x277D85DE8];
  if (a1)
  {
    v4 = [a1 workQueue];
    dispatch_assert_queue_V2(v4);

    if (([(HMDHome *)a1 supportsUnifiedMediaNotificationsOnResidents]& 1) == 0)
    {
      v5 = objc_autoreleasePoolPush();
      v6 = a1;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543362;
        v14 = v8;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Registering for apple media notifications on direct transports since we have no primary resident that supports unified notifications", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
      v9 = [v6 accessories];
      v11[0] = MEMORY[0x277D85DD0];
      v11[1] = 3221225472;
      v11[2] = __70__HMDHome__subscribeForHomeAppleMediaNotificationsOnDirectTransports___block_invoke;
      v11[3] = &unk_279722088;
      v11[4] = v6;
      v12 = a2;
      [v9 na_each:v11];
    }
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_subscribeForHomeNotificationsOnDirectTransports:(void *)a1
{
  v62 = *MEMORY[0x277D85DE8];
  if (a1)
  {
    v2 = a2;
    v4 = [a1 _characteristicNotificationPayloadsOnDirectTransports:a2];
    v5 = [v4 objectAtIndex:0];
    v6 = [v4 objectAtIndex:1];
    if ([v5 count] || objc_msgSend(v6, "count"))
    {
      if ([v5 count])
      {
        v7 = objc_autoreleasePoolPush();
        v8 = a1;
        v9 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
        {
          v10 = HMFGetLogIdentifier();
          v11 = [v5 shortDescription];
          *buf = 138543618;
          v59 = v10;
          v60 = 2112;
          v61 = v11;
          _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Deregistering notifications %@ with direct transports", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v7);
      }

      v47 = v2;
      v46 = v6;
      v54 = 0u;
      v55 = 0u;
      v52 = 0u;
      v53 = 0u;
      v45 = v5;
      v12 = v5;
      v13 = [v12 countByEnumeratingWithState:&v52 objects:v57 count:16];
      if (v13)
      {
        v14 = v13;
        v15 = *v53;
        do
        {
          for (i = 0; i != v14; ++i)
          {
            if (*v53 != v15)
            {
              objc_enumerationMutation(v12);
            }

            v17 = *(*(&v52 + 1) + 8 * i);
            v18 = [v12 objectForKey:{v17, v45}];
            v19 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v17];
            v20 = [a1 accessoryWithUUID:v19];

            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v21 = v20;
            }

            else
            {
              v21 = 0;
            }

            v22 = v21;

            [v22 enableNotification:0 forCharacteristics:v18 message:0 clientIdentifier:@"com.apple.HomeKitDaemon.homeNotifications"];
          }

          v14 = [v12 countByEnumeratingWithState:&v52 objects:v57 count:16];
        }

        while (v14);
      }

      if ([v46 count])
      {
        v23 = objc_autoreleasePoolPush();
        v24 = a1;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
        {
          v26 = HMFGetLogIdentifier();
          v27 = [v46 shortDescription];
          *buf = 138543618;
          v59 = v26;
          v60 = 2112;
          v61 = v27;
          _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_DEBUG, "%{public}@Registering notifications %@ with direct transports", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
      }

      v50 = 0u;
      v51 = 0u;
      v48 = 0u;
      v49 = 0u;
      v28 = v46;
      v29 = [v28 countByEnumeratingWithState:&v48 objects:v56 count:16];
      v5 = v45;
      if (v29)
      {
        v30 = v29;
        v31 = *v49;
        do
        {
          for (j = 0; j != v30; ++j)
          {
            if (*v49 != v31)
            {
              objc_enumerationMutation(v28);
            }

            v33 = *(*(&v48 + 1) + 8 * j);
            v34 = [v28 objectForKey:{v33, v45}];
            v35 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v33];
            v36 = [a1 accessoryWithUUID:v35];

            v37 = v36;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v38 = v37;
            }

            else
            {
              v38 = 0;
            }

            v39 = v38;

            if (v39)
            {
              if (v47)
              {
                [v39 enableNotification:1 forCharacteristics:v34 message:0 clientIdentifier:@"com.apple.HomeKitDaemon.homeNotifications"];
              }

              else
              {
                [v39 updateNotificationEnabled:0 forCharacteristics:v34 onBehalfOf:@"com.apple.HomeKitDaemon.homeNotifications"];
              }

              [v39 checkHAPSessionRestore];
            }
          }

          v30 = [v28 countByEnumeratingWithState:&v48 objects:v56 count:16];
        }

        while (v30);
      }

      v6 = v46;
    }

    else
    {
      v41 = objc_autoreleasePoolPush();
      v42 = a1;
      v43 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
      {
        v44 = HMFGetLogIdentifier();
        *buf = 138543362;
        v59 = v44;
        _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Not registering notifications on direct transports since we have no modifications", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v41);
    }
  }

  v40 = *MEMORY[0x277D85DE8];
}

- (uint64_t)supportsUnifiedMediaNotificationsOnResidents
{
  if (!a1)
  {
    return 0;
  }

  v1 = [a1 primaryResident];
  v2 = [v1 device];
  if (v2)
  {
    v3 = [v1 capabilities];
    v4 = [v3 supportsUnifiedMediaNotifications];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

void __70__HMDHome__subscribeForHomeAppleMediaNotificationsOnDirectTransports___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v5;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  if (v4)
  {
    [(HMDHome *)*(a1 + 32) _enableMediaNotifications:v4 forMediaAccessory:?];
  }
}

- (void)_enableMediaNotifications:(void *)a3 forMediaAccessory:
{
  v9[1] = *MEMORY[0x277D85DE8];
  v5 = a3;
  if (a1)
  {
    v6 = [a1 workQueue];
    dispatch_assert_queue_V2(v6);

    if (([a1 isCurrentDevicePrimaryResident] & 1) != 0 || !-[HMDHome supportsUnifiedMediaNotificationsOnResidents](a1))
    {
      [(HMDHome *)a1 _enableMediaNotifications:a2 directlyOnMediaAccessory:v5 completion:0];
    }

    else
    {
      v9[0] = v5;
      v7 = [MEMORY[0x277CBEA60] arrayWithObjects:v9 count:1];
      [a1 _subscribeForHomeNotificationsFromRemoteGateway:a2 accessories:v7];
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_enableMediaNotifications:(void *)a3 directlyOnMediaAccessory:(void *)a4 completion:
{
  v33 = *MEMORY[0x277D85DE8];
  v7 = a3;
  v8 = a4;
  if (a1)
  {
    v9 = [a1 workQueue];
    dispatch_assert_queue_V2(v9);

    v10 = [v7 device];
    v11 = [v7 mediaProfile];
    v12 = v11;
    if (v10 && v11)
    {
      v13 = [(HMDHome *)a1 mediaNotificationPayloadForProfile:v11];
      v14 = objc_autoreleasePoolPush();
      v15 = a1;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        v17 = HMFGetLogIdentifier();
        HMFBooleanToString();
        v18 = v24 = v14;
        *buf = 138544130;
        v26 = v17;
        v27 = 2112;
        v28 = v18;
        v29 = 2112;
        v30 = v12;
        v31 = 2112;
        v32 = v10;
        _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Registering for media notifications (enabled: %@) on profile %@ with device %@", buf, 0x2Au);

        v14 = v24;
      }

      objc_autoreleasePoolPop(v14);
      [v15 _modifyCharacteristicNotifications:MEMORY[0x277CBEC10] mediaNotifications:v13 actionSetNotificationPayload:MEMORY[0x277CBEBF8] enableNotification:a2 withDevice:v10 completion:v8];
    }

    else
    {
      v19 = objc_autoreleasePoolPush();
      v20 = a1;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138544130;
        v26 = v22;
        v27 = 2112;
        v28 = v7;
        v29 = 2112;
        v30 = v10;
        v31 = 2112;
        v32 = v12;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Unable to enable media notifications on apple media accessory %@ due to no device (%@) or profile (%@)", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v19);
      if (!v8)
      {
        goto LABEL_12;
      }

      v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
      v8[2](v8, v13);
    }

LABEL_12:
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (id)mediaNotificationPayloadForProfile:(void *)a1
{
  v11[1] = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (a1)
  {
    if (!v3)
    {
      _HMFPreconditionFailure();
    }

    v5 = [v3 uniqueIdentifier];
    v6 = [v5 UUIDString];

    v10 = v6;
    v7 = +[HMDMediaSession mediaPropertyMessageKeys];
    v11[0] = v7;
    a1 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v11 forKeys:&v10 count:1];
  }

  v8 = *MEMORY[0x277D85DE8];

  return a1;
}

- (void)_handleCoalescedModifyNotifications
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  [(HMDHome *)self setModifyNotificationsCoalesceTimer:0];
  v4 = objc_autoreleasePoolPush();
  v5 = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    *buf = 138543362;
    v16 = v7;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to notification coalesce timer firing", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __46__HMDHome__handleCoalescedModifyNotifications__block_invoke;
  aBlock[3] = &unk_279722BA8;
  aBlock[4] = v5;
  v8 = _Block_copy(aBlock);
  v9 = [(HMDHome *)v5 enableNotificationPayload];
  v10 = [MEMORY[0x277CBEB18] array];
  v8[2](v8, v9, v10, 1);

  v11 = [(HMDHome *)v5 disableNotificationPayload];
  v12 = [MEMORY[0x277CBEB18] array];
  v8[2](v8, v11, v12, 0);

  v13 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleCoalescedModifyNotifications__block_invoke(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v11 = a2;
  v7 = a3;
  if ([v11 count] || objc_msgSend(v7, "count"))
  {
    v8 = [v11 na_dictionaryByMappingValues:&__block_literal_global_1836];
    v9 = [v8 copy];

    v10 = [v7 copy];
    [*(a1 + 32) _modifyCharacteristicNotificationsOnResident:v9 mediaNotifications:MEMORY[0x277CBEC10] actionSetNotificationPayload:v10 enableNotification:a4];
    [v11 removeAllObjects];
    [v7 removeAllObjects];
  }
}

id __46__HMDHome__handleCoalescedModifyNotifications__block_invoke_2(uint64_t a1, uint64_t a2, void *a3)
{
  v3 = [a3 copy];

  return v3;
}

- (void)userManagementOperationDidFinish:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __44__HMDHome_userManagementOperationDidFinish___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __44__HMDHome_userManagementOperationDidFinish___block_invoke(uint64_t a1)
{
  v56 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) isAuditOperation];
  v3 = *(a1 + 40);
  if (v2)
  {
    v4 = [v3 backingStore];
    v5 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v6 = [v4 transaction:@"HMDUserManagementOperationDelete" options:v5];

    v7 = *(a1 + 40);
    v8 = [*(a1 + 32) accessory];
    v9 = [v8 uuid];
    v10 = [v7 accessoryWithUUID:v9];

    v11 = [v10 home];
    v12 = v11;
    if (!v10 || !v11)
    {
      goto LABEL_15;
    }

    if ([*(a1 + 32) isExpired])
    {
      v13 = [v10 transactionWithObjectChangeType:2];
      v14 = [HMDUserManagementOperationTimestamp alloc];
      v15 = [*(a1 + 40) currentDevice];
      v16 = [(HMDUserManagementOperationTimestamp *)v14 initWithDevice:v15 state:2];
      [v13 setPairingsAuditedTimestamp:v16];

      v17 = objc_autoreleasePoolPush();
      v18 = *(a1 + 40);
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v40 = HMFGetLogIdentifier();
        v20 = [v10 name];
        [v10 uuid];
        v42 = v46 = v17;
        v21 = [v42 UUIDString];
        [v13 pairingsAuditedTimestamp];
        v22 = v44 = v13;
        *buf = 138544130;
        v49 = v40;
        v50 = 2112;
        v51 = v20;
        v52 = 2112;
        v53 = v21;
        v23 = v21;
        v54 = 2112;
        v55 = v22;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ pairings audit failed %@", buf, 0x2Au);

        v13 = v44;
        v17 = v46;
      }
    }

    else
    {
      if ([*(a1 + 32) isCancelled])
      {
        goto LABEL_15;
      }

      v13 = [v10 transactionWithObjectChangeType:2];
      v26 = [HMDUserManagementOperationTimestamp alloc];
      v27 = [*(a1 + 40) currentDevice];
      v28 = [(HMDUserManagementOperationTimestamp *)v26 initWithDevice:v27 state:0];
      [v13 setPairingsAuditedTimestamp:v28];

      v17 = objc_autoreleasePoolPush();
      v18 = *(a1 + 40);
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v41 = HMFGetLogIdentifier();
        v29 = [v10 name];
        [v10 uuid];
        v43 = v47 = v17;
        v30 = [v43 UUIDString];
        [v13 pairingsAuditedTimestamp];
        v31 = v45 = v13;
        *buf = 138544130;
        v49 = v41;
        v50 = 2112;
        v51 = v29;
        v52 = 2112;
        v53 = v30;
        v32 = v30;
        v54 = 2112;
        v55 = v31;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ pairings audit completed %@", buf, 0x2Au);

        v13 = v45;
        v17 = v47;
      }
    }

    objc_autoreleasePoolPop(v17);
    [v6 add:v13];

LABEL_15:
    v33 = *(a1 + 32);
    v34 = [v33 accessory];
    v35 = [v34 uuid];
    v36 = [v33 modelObjectWithChangeType:3 parentUUID:v35];

    [v6 add:v36];
    [v6 run];
    if (v10 && ([*(a1 + 32) isCancelled] & 1) == 0 && (objc_msgSend(*(a1 + 32), "isExpired") & 1) == 0)
    {
      v37 = *(a1 + 40);
      v38 = [*(a1 + 32) auditUsersToBeAdded];
      [v37 _addUsers:v38 accessory:v10];
    }

    v39 = *MEMORY[0x277D85DE8];
    return;
  }

  v24 = *(a1 + 32);
  v25 = *MEMORY[0x277D85DE8];

  [v3 _updateOutgoingInvitationsWithCompleteUserManagementOperation:v24];
}

- (id)balancedResidentMapForAccessories:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 residentMesh];
  v7 = [v6 balancedResidentMapForAccessories:v4];

  return v7;
}

- (void)residentDeviceManagerDidUpdateResidents:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __51__HMDHome_residentDeviceManagerDidUpdateResidents___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v4, block);
}

uint64_t __51__HMDHome_residentDeviceManagerDidUpdateResidents___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _evaluateOwnerTrustZoneCapabilityAndNotify];
  v2 = *(a1 + 32);

  return [v2 _updateResidentFirstAccessoryCommunicationEnabled];
}

- (void)residentDeviceManager:(id)a3 didUpdatePrimaryResident:(id)a4 previousPrimaryResident:(id)a5
{
  v6 = [(HMDHome *)self workQueue:a3];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __82__HMDHome_residentDeviceManager_didUpdatePrimaryResident_previousPrimaryResident___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v6, block);
}

void __82__HMDHome_residentDeviceManager_didUpdatePrimaryResident_previousPrimaryResident___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _registerCameraReachabilityEventNotificationsWithCompletionHandler:0];
  [*(a1 + 32) migrateAfterResidentChange];
  [*(a1 + 32) reEvaluateHomeHubState];
  v2 = [*(a1 + 32) stagedRemoteReachabilityRegistration];
  [v2 resetAndStagePriorValue];
}

- (void)residentDeviceManager:(id)a3 didUpdateResidentAvailable:(BOOL)a4
{
  v6 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __60__HMDHome_residentDeviceManager_didUpdateResidentAvailable___block_invoke;
  v7[3] = &unk_279735D28;
  v7[4] = self;
  v8 = a4;
  dispatch_async(v6, v7);
}

uint64_t __60__HMDHome_residentDeviceManager_didUpdateResidentAvailable___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 32) shortDescription];
    v7 = v6;
    v8 = *(a1 + 40);
    *buf = 138543874;
    v25 = v5;
    if (v8)
    {
      v9 = @"available";
    }

    else
    {
      v9 = @"unavailable";
    }

    v26 = 2112;
    v27 = v6;
    v28 = 2112;
    v29 = v9;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@[%@] Resident devices are %@ for this home", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v2);
  if ((*(a1 + 40) & 1) == 0)
  {
    [*(a1 + 32) migrateAfterResidentChange];
    if ((*(a1 + 40) & 1) == 0)
    {
      v21 = 0u;
      v22 = 0u;
      v19 = 0u;
      v20 = 0u;
      v10 = [*(a1 + 32) _residentUsers];
      v11 = [v10 countByEnumeratingWithState:&v19 objects:v23 count:16];
      if (v11)
      {
        v12 = v11;
        v13 = *v20;
        do
        {
          v14 = 0;
          do
          {
            if (*v20 != v13)
            {
              objc_enumerationMutation(v10);
            }

            [*(a1 + 32) _notifyClientsOfUpdatedResidentUser:*(*(&v19 + 1) + 8 * v14++)];
          }

          while (v12 != v14);
          v12 = [v10 countByEnumeratingWithState:&v19 objects:v23 count:16];
        }

        while (v12);
      }

      v15 = [*(a1 + 32) homeManager];
      v16 = [*(a1 + 32) uuid];
      [v15 electRemoteAccessPeerForHome:v16];
    }
  }

  result = [*(a1 + 32) reEvaluateHomeHubState];
  v18 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)retrieveOperationalCertificatesForFabricID:(id)a3 commissionerNodeID:(id)a4 commissioneeNodeID:(id)a5 publicKey:(id)a6 completion:(id)a7
{
  v48 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v37 = a4;
  v38 = a5;
  v39 = a6;
  v13 = a7;
  v14 = [(HMDHome *)self primaryResident];
  v15 = v14;
  if (v14 && ([v14 device], (v16 = objc_claimAutoreleasedReturnValue()) != 0) && (-[HMDHome primaryResident](self, "primaryResident"), v17 = objc_claimAutoreleasedReturnValue(), v18 = objc_msgSend(v17, "isReachable"), v17, v16, (v18 & 1) != 0))
  {
    v19 = [HMDRemoteDeviceMessageDestination alloc];
    v20 = [(HMDHome *)self uuid];
    v21 = [v15 device];
    v22 = [(HMDRemoteDeviceMessageDestination *)v19 initWithTarget:v20 device:v21];

    v23 = [MEMORY[0x277CBEB38] dictionary];
    [v23 setObject:v38 forKeyedSubscript:@"HMDHomeCommissioningDeviceNodeIDMessageKey"];
    [v23 setObject:v12 forKeyedSubscript:@"HMDHomeCommissioningFabricIDMessageKey"];
    [v23 setObject:v12 forKeyedSubscript:@"HMDHomeCommissioningFabricIndexMessageKey"];
    [v23 setObject:v39 forKeyedSubscript:@"HMDHomeCommissioningPublicKeyMessageKey"];
    if (isFeatureMatterLocalFabricConfigEnabled())
    {
      [v23 setObject:v37 forKeyedSubscript:@"HMDHomeCommissioningCommissionerNodeIDMessageKey"];
    }

    v24 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeRequestCommissioningCertificatesMessage" destination:v22 payload:v23];
    [v24 setRemote:1];
    [v24 setSecureRemote:1];
    objc_initWeak(&location, self);
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __113__HMDHome_retrieveOperationalCertificatesForFabricID_commissionerNodeID_commissioneeNodeID_publicKey_completion___block_invoke;
    v40[3] = &unk_2797355F8;
    objc_copyWeak(&v42, &location);
    v41 = v13;
    [v24 setResponseHandler:v40];
    context = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [v24 shortDescription];
      *buf = 138543618;
      v45 = v27;
      v46 = 2112;
      v47 = v28;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Sending message %@ to fetch Matter operational certificates from the primary resident", buf, 0x16u);
    }

    objc_autoreleasePoolPop(context);
    v29 = [(HMDHome *)v25 msgDispatcher];
    [v29 sendMessage:v24];

    objc_destroyWeak(&v42);
    objc_destroyWeak(&location);
  }

  else
  {
    v30 = objc_autoreleasePoolPush();
    v31 = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
    {
      v33 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v33;
      _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not available or it is unreachable", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v30);
    v34 = MEMORY[0x277CCA9B8];
    v22 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
    v23 = [v34 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v22];
    (*(v13 + 2))(v13, 0, 0, 0, 0, v23);
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __113__HMDHome_retrieveOperationalCertificatesForFabricID_commissionerNodeID_commissioneeNodeID_publicKey_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v11;
        v29 = 2112;
        v30 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for operational certificates failed with %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:@"HMDHomeCommissioningRootCertMessageKey"];
      v13 = [v6 hmf_dataForKey:@"HMDHomeCommissioningOperationalCertMessageKey"];
      v14 = [v6 hmf_numberForKey:@"HMDHomeCommissioningOwnerNodeIDMessageKey"];
      v15 = [v6 hmf_dataForKey:@"HMDHomeCommissioningIPKMessageKey"];
      context = objc_autoreleasePoolPush();
      v16 = WeakRetained;
      v17 = HMFGetOSLogHandle();
      v18 = v17;
      if (v12 && v13)
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v19 = v24 = v15;
          *buf = 138544130;
          v28 = v19;
          v29 = 2112;
          v30 = v12;
          v31 = 2112;
          v32 = v13;
          v33 = 2112;
          v34 = v14;
          _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Request for operational certificates successful. rootCertificate %@, operationalCert %@, ownerNodeID %@", buf, 0x2Au);

          v15 = v24;
        }

        objc_autoreleasePoolPop(context);
        (*(*(a1 + 32) + 16))();
      }

      else
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v20 = v25 = v15;
          *buf = 138544130;
          v28 = v20;
          v29 = 2112;
          v30 = v12;
          v31 = 2112;
          v32 = v13;
          v33 = 2112;
          v34 = v14;
          _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Primary resident returned unexpected values for rootCertificate %@, operationalCert %@, ownerNodeID %@", buf, 0x2Au);

          v15 = v25;
        }

        objc_autoreleasePoolPop(context);
        v21 = *(a1 + 32);
        v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        (*(v21 + 16))(v21, 0, 0, 0, 0, v22);
      }
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_fetchMetadataFromPrimaryResidentWithCompletion:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self primaryResident];
  v6 = [(HMDHome *)self _checkResidentCapabilitiesForCredentialSharing:v5];
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v25 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@Couldn't find compatible resident to fetch Thread network credentials", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v4[2](v4, 0, v6);
  }

  else
  {
    v11 = [HMDRemoteDeviceMessageDestination alloc];
    v12 = [(HMDHome *)self uuid];
    v13 = [v5 device];
    v14 = [(HMDRemoteDeviceMessageDestination *)v11 initWithTarget:v12 device:v13];

    v15 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeThreadNetworkCredentialsRequestKey" destination:v14 payload:0];
    [v15 setRemote:1];
    [v15 setSecureRemote:1];
    objc_initWeak(buf, self);
    v18 = MEMORY[0x277D85DD0];
    v19 = 3221225472;
    v20 = __59__HMDHome__fetchMetadataFromPrimaryResidentWithCompletion___block_invoke;
    v21 = &unk_2797355F8;
    objc_copyWeak(&v23, buf);
    v22 = v4;
    [v15 setResponseHandler:&v18];
    v16 = [(HMDHome *)self msgDispatcher:v18];
    [v16 sendMessage:v15 completionHandler:0];

    objc_destroyWeak(&v23);
    objc_destroyWeak(buf);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __59__HMDHome__fetchMetadataFromPrimaryResidentWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v47 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v11;
        v43 = 2112;
        v44 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for Thread Network credentials failed with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:*MEMORY[0x277CD0620]];
      v40 = 0;
      v13 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v12 error:&v40];
      v38 = v40;
      v14 = [v6 hmf_dataForKey:@"HMHomeThreadNetworkCredentialsMasterKeyMessageKey"];
      v15 = objc_autoreleasePoolPush();
      v16 = WeakRetained;
      v17 = HMFGetOSLogHandle();
      v18 = v17;
      v39 = v14;
      if (v13)
      {
        v19 = v14 == 0;
      }

      else
      {
        v19 = 1;
      }

      if (v19)
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v21 = v20 = v12;
          v22 = [v39 length];
          *buf = 138543874;
          v42 = v21;
          v43 = 2112;
          v44 = v13;
          v45 = 2048;
          v46 = v22;
          _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Missing metadata (%@)/masterKeyData (length %zu) in response", buf, 0x20u);

          v12 = v20;
        }

        objc_autoreleasePoolPop(v15);
        v23 = *(a1 + 32);
        v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        (*(v23 + 16))(v23, 0, v24);
        v14 = v39;
      }

      else
      {
        v36 = v6;
        v37 = v12;
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          v26 = HMFGetLogIdentifier();
          *buf = 138543362;
          v42 = v26;
          _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Request for Thread Network Metadata successful", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v15);
        v35 = objc_alloc(MEMORY[0x277CD1EA8]);
        v33 = [v13 name];
        v34 = [v13 channel];
        v32 = [v13 PANID];
        v27 = [v13 extendedPANID];
        v28 = [v13 passPhrase];
        v29 = [v13 PSKc];
        v30 = [v13 operationalDataset];
        v24 = [v35 initWithName:v33 channel:v34 PANID:v32 extendedPANID:v27 masterKey:v14 passPhrase:v28 PSKc:v29 operationalDataset:v30];

        (*(*(a1 + 32) + 16))();
        v6 = v36;
        v12 = v37;
      }
    }
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (id)_checkResidentCapabilitiesForCredentialSharing:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = v4;
  if (v4 && ([v4 device], v6 = objc_claimAutoreleasedReturnValue(), v6, v6))
  {
    v7 = [v5 capabilities];
    v8 = [v7 supportsThreadNetworkCredentialSharing];

    if (v8)
    {
      v9 = 0;
      goto LABEL_12;
    }

    v10 = objc_autoreleasePoolPush();
    v15 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v16;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Primary resident doesn't support Thread Network Credential sharing", &v19, 0xCu);
    }

    v14 = 92;
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v13;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request thread credentials from", &v19, 0xCu);
    }

    v14 = 91;
  }

  objc_autoreleasePoolPop(v10);
  v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:v14];
LABEL_12:

  v17 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)removeThreadNetworkPreferredNetworkWithCompletion:(id)a3
{
  v3 = a3;
  v4 = +[HMDThreadNetworkMetadataStore defaultStore];
  [v4 removePreferredNetworkWithCompletion:v3];
}

- (void)retrieveThreadNetworkMetadataWithNoFallbackWithCompletion:(id)a3
{
  v31 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (![(HMDHome *)self isSharedAdmin]&& ![(HMDHome *)self isOwnerUser])
  {
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543362;
      v30 = v20;
      _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_ERROR, "%{public}@Unexpected user. Returning without retrieving thread network credentials", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:47];
    v4[2](v4, 0, v6);
    goto LABEL_23;
  }

  if (![(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v5 = [(HMDHome *)self residentDeviceManager];
    v6 = [v5 residentDevices];

    if ([v6 count])
    {
      v7 = [(HMDHome *)self primaryResident];
      v8 = [v7 isReachable];

      if (v8)
      {
        v27[0] = MEMORY[0x277D85DD0];
        v27[1] = 3221225472;
        v27[2] = __69__HMDHome_retrieveThreadNetworkMetadataWithNoFallbackWithCompletion___block_invoke;
        v27[3] = &unk_27972EFA0;
        v27[4] = self;
        v28 = v4;
        [(HMDHome *)self _fetchMetadataFromPrimaryResidentWithCompletion:v27];

LABEL_23:
        goto LABEL_24;
      }
    }

    if ([(HMDHome *)self isSharedAdmin])
    {
      v9 = objc_autoreleasePoolPush();
      v10 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 138543362;
        v30 = v12;
        _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@No resident available. Returning without retrieving thread network credentials", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
      v13 = [v6 count];
      v14 = MEMORY[0x277CCA9B8];
      if (!v13)
      {
        v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
        v4[2](v4, 0, v15);
        goto LABEL_22;
      }

      v15 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
      v16 = [v14 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v15];
      v4[2](v4, 0, v16);
    }

    else
    {
      if (![v6 count])
      {
        [(HMDHome *)self _fetchMetadataOnCurrentDeviceWithCompletion:v4];
        goto LABEL_23;
      }

      v21 = objc_autoreleasePoolPush();
      v22 = self;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        *buf = 138543362;
        v30 = v24;
        _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not reachable. Returning without retrieving thread network credentials", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
      v25 = MEMORY[0x277CCA9B8];
      v15 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
      v16 = [v25 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v15];
      v4[2](v4, 0, v16);
    }

LABEL_22:
    goto LABEL_23;
  }

  [(HMDHome *)self _fetchMetadataOnCurrentDeviceWithCompletion:v4];
LABEL_24:

  v26 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome_retrieveThreadNetworkMetadataWithNoFallbackWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (!v5 || v6)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v13 = 138543618;
      v14 = v11;
      v15 = 2112;
      v16 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to get thread network credentials from resident. Not falling back. Error: %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  (*(*(a1 + 40) + 16))();

  v12 = *MEMORY[0x277D85DE8];
}

- (void)retrieveThreadNetworkMetadataWithCompletion:(id)a3
{
  v14 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (![(HMDHome *)self isSharedAdmin])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      v10 = +[HMDThreadNetworkMetadataStore defaultStore];
      [v10 retrieveMetadataWithCompletion:v4];
LABEL_12:

      goto LABEL_13;
    }

    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v8;
      v9 = "%{public}@Unexpected user. Returning without retrieving thread network credentials";
      goto LABEL_10;
    }

LABEL_11:

    objc_autoreleasePoolPop(v5);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:47];
    v4[2](v4, 0, v10);
    goto LABEL_12;
  }

  if ([(HMDHome *)self isCurrentDevicePrimaryResident])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v8;
      v9 = "%{public}@Running as a shared admin on primary resident; This is unexpected. Returning without retrieving thread network credentials";
LABEL_10:
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, v9, &v12, 0xCu);

      goto LABEL_11;
    }

    goto LABEL_11;
  }

  [(HMDHome *)self _fetchMetadataFromPrimaryResidentWithCompletion:v4];
LABEL_13:

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_fetchMetadataOnCurrentDeviceWithCompletion:(id)a3
{
  v4 = a3;
  v6 = +[HMDThreadNetworkMetadataStore defaultStore];
  v5 = [(HMDHome *)self threadOperationalDataset];
  [v6 retrieveMetadata:v5 homeHasResident:-[HMDHome doesHomeContainResident](self completion:{"doesHomeContainResident"), v4}];
}

- (void)_unconfigurePairedAccessoriesForServer:(id)a3 updateReachability:(BOOL)a4
{
  v4 = a4;
  v24 = *MEMORY[0x277D85DE8];
  v6 = a3;
  if ([v6 isPaired])
  {
    if (v4)
    {
      v7 = objc_autoreleasePoolPush();
      v8 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543618;
        v21 = v10;
        v22 = 2112;
        v23 = v6;
        _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Setting reachability to false for all paired accessories associated with %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
    }

    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    v12 = [v6 identifier];
    v13 = [v6 linkType];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __69__HMDHome__unconfigurePairedAccessoriesForServer_updateReachability___block_invoke;
    v16[3] = &unk_279722B60;
    v17 = v12;
    v18 = v13;
    v19 = v4;
    v14 = v12;
    [(HMDHome *)self _notifyRetrievalError:v11 accessoryServer:v14 linkType:v13 accessoryOperationBlock:v16];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_processUpdatedAccessoryServer:(id)a3 reAddServices:(BOOL)a4
{
  v303 = *MEMORY[0x277D85DE8];
  v186 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v292 = v8;
    v293 = 2112;
    v294 = v186;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Updating existing HMDAccessory objects from HAPAccessory objects for server: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v212 = [(HMDHome *)v6 _primaryAccessoryForServer:v186];
  v191 = [MEMORY[0x277CBEB18] array];
  v190 = [MEMORY[0x277CBEB18] array];
  v185 = [v212 configNumber];
  v9 = MEMORY[0x277CBEB18];
  v10 = [v186 accessories];
  v195 = [v9 arrayWithArray:v10];

  v11 = MEMORY[0x277CBEB18];
  v12 = [(HMDHome *)v6 hapAccessoriesForServer:v186];
  v208 = [v11 arrayWithArray:v12];

  v13 = objc_autoreleasePoolPush();
  v226 = v6;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    v16 = [v208 count];
    v17 = [v186 identifier];
    v18 = [v186 accessories];
    v19 = [v18 count];
    *buf = 138544130;
    v292 = v15;
    v293 = 2050;
    v294 = v16;
    v295 = 2114;
    v296 = v17;
    v297 = 2050;
    v298 = v19;
    _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Found %{public}tu existing HMDAccessory objects associated with the server: '%{public}@' and discovered %{public}tu HAPAccessory objects", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v13);
  v192 = [MEMORY[0x277CBEB18] array];
  v193 = [MEMORY[0x277CBEB18] array];
  v187 = [MEMORY[0x277CBEB18] array];
  v223 = [MEMORY[0x277CBEB18] array];
  v220 = [MEMORY[0x277CBEB18] array];
  context = [MEMORY[0x277CBEB18] array];
  v272 = 0u;
  v273 = 0u;
  v270 = 0u;
  v271 = 0u;
  obj = [v186 accessories];
  v214 = [obj countByEnumeratingWithState:&v270 objects:v289 count:16];
  if (v214)
  {
    v209 = *v271;
    do
    {
      for (i = 0; i != v214; ++i)
      {
        if (*v271 != v209)
        {
          objc_enumerationMutation(obj);
        }

        v21 = *(*(&v270 + 1) + 8 * i);
        v266 = 0u;
        v267 = 0u;
        v268 = 0u;
        v269 = 0u;
        v22 = v208;
        v23 = [v22 countByEnumeratingWithState:&v266 objects:v288 count:16];
        if (!v23)
        {
          goto LABEL_21;
        }

        v24 = *v267;
        while (2)
        {
          for (j = 0; j != v23; ++j)
          {
            if (*v267 != v24)
            {
              objc_enumerationMutation(v22);
            }

            v26 = *(*(&v266 + 1) + 8 * j);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v27 = v26;
            }

            else
            {
              v27 = 0;
            }

            v28 = v27;

            if ([v28 matchesHAPAccessory:v21])
            {

              if (!v28)
              {
                goto LABEL_56;
              }

              if (([v28 isPrimary] & 1) == 0 && (objc_msgSend(v28, "isPaired") & 1) == 0)
              {
                v60 = objc_autoreleasePoolPush();
                v61 = v226;
                v62 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
                {
                  v63 = HMFGetLogIdentifier();
                  v64 = [v28 shortDescription];
                  *buf = 138543618;
                  v292 = v63;
                  v293 = 2114;
                  v294 = v64;
                  _os_log_impl(&dword_2531F8000, v62, OS_LOG_TYPE_INFO, "%{public}@Skipping configuring unpaired secondary accessory with identifier: %{public}@", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v60);
                goto LABEL_55;
              }

              [v191 addObject:v21];
              [v190 addObject:v28];
              v29 = [v28 uuid];
              v30 = [v28 hostAccessory];
              v31 = [v30 uuid];
              v32 = [(HMDHome *)v226 getTransactionFromHAPAccessory:v21 hmdAccessory:v28 uuid:v29 hostAccessoryUUID:v31 objectChangeType:2];

              v33 = v21;
              v34 = v28;
              v35 = v32;
              v36 = [v34 initialManufacturer];
              if (v36)
              {
LABEL_28:
              }

              else
              {
                v37 = [v33 manufacturer];
                v38 = v37 == 0;

                if (!v38)
                {
                  v36 = [v33 manufacturer];
                  [v35 setInitialManufacturer:v36];
                  goto LABEL_28;
                }
              }

              v39 = [v34 initialModel];
              if (v39)
              {
LABEL_32:
              }

              else
              {
                v40 = [v33 model];
                v41 = v40 == 0;

                if (!v41)
                {
                  v39 = [v33 model];
                  [v35 setInitialModel:v39];
                  goto LABEL_32;
                }
              }

              v42 = [v34 initialCategoryIdentifier];
              if (v42)
              {
LABEL_36:
              }

              else
              {
                v43 = [v33 category];
                v44 = v43 == 0;

                if (!v44)
                {
                  v42 = [v33 category];
                  [v35 setInitialCategoryIdentifier:v42];
                  goto LABEL_36;
                }
              }

              v45 = [v34 initialServiceTypeUUIDs];
              v46 = v45 == 0;

              if (v46)
              {
                v47 = serviceTypeUUIDsForAccessory(v33);
                if (v47)
                {
                  [v35 setInitialServiceTypeUUIDs:v47];
                }
              }

              v265 = v223;
              v264 = v220;
              v263 = context;
              [(HMDHome *)v226 getUpdateTransactionForAccessory:v34 hapAccessory:v33 accessoryTransaction:v35 addSvcTransactions:&v265 updateSvcTransactions:&v264 removeSvcTransactions:&v263];
              val = v265;

              v224 = v264;
              v221 = v263;

              if ([v33 isPrimary])
              {
                v48 = [v186 setupHash];
                if (v48)
                {
                  contexta = objc_autoreleasePoolPush();
                  v49 = v226;
                  v50 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
                  {
                    v51 = HMFGetLogIdentifier();
                    v52 = [v34 shortDescription];
                    *buf = 138543874;
                    v292 = v51;
                    v293 = 2112;
                    v294 = v48;
                    v295 = 2112;
                    v296 = v52;
                    _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_INFO, "%{public}@Saving setup hash '%@ for accessory %@", buf, 0x20u);
                  }

                  objc_autoreleasePoolPop(contexta);
                  [v35 setAccessorySetupHash:v48];
                }

                [(HMDHome *)v226 _processUpdatedProductDataForAccessory:v34 hapAccessory:v33 transaction:v35];
              }

              v53 = [v34 modelObjectWithChangeType:1];
              v262 = 0;
              [v53 diff:v35 differingFields:&v262];
              v54 = v262;

              if ([(__CFString *)v54 count])
              {
                v55 = objc_autoreleasePoolPush();
                v56 = v226;
                v57 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
                {
                  v58 = HMFGetLogIdentifier();
                  v59 = [v212 shortDescription];
                  *buf = 138544130;
                  v292 = v58;
                  v293 = 2114;
                  v294 = v59;
                  v295 = 2114;
                  v296 = v35;
                  v297 = 2114;
                  v298 = v54;
                  _os_log_impl(&dword_2531F8000, v57, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Received accessory update %{public}@ due to diff %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v55);
                [v193 addObject:v35];
              }

              context = v221;
              v220 = v224;
              v223 = val;
              goto LABEL_55;
            }
          }

          v23 = [v22 countByEnumeratingWithState:&v266 objects:v288 count:16];
          if (v23)
          {
            continue;
          }

          break;
        }

LABEL_21:
        v26 = v22;
LABEL_55:

LABEL_56:
        ;
      }

      v214 = [obj countByEnumeratingWithState:&v270 objects:v289 count:16];
    }

    while (v214);
  }

  v65 = objc_autoreleasePoolPush();
  vala = v226;
  v66 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
  {
    v67 = HMFGetLogIdentifier();
    *buf = 138543618;
    v292 = v67;
    v293 = 2112;
    v294 = v186;
    _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_INFO, "%{public}@Finished updating paired accessories for server: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v65);
  [v195 removeObjectsInArray:v191];
  [v208 removeObjectsInArray:v190];
  v202 = [(HMDHome *)vala accessories];
  v260 = 0u;
  v261 = 0u;
  v258 = 0u;
  v259 = 0u;
  v194 = v195;
  obja = [v194 countByEnumeratingWithState:&v258 objects:v287 count:16];
  if (obja)
  {
    v200 = *v259;
    do
    {
      v68 = 0;
      do
      {
        if (*v259 != v200)
        {
          v69 = v68;
          objc_enumerationMutation(v194);
          v68 = v69;
        }

        v210 = v68;
        v70 = *(*(&v258 + 1) + 8 * v68);
        v254 = 0u;
        v255 = 0u;
        v256 = 0u;
        v257 = 0u;
        v71 = v202;
        v72 = [v71 countByEnumeratingWithState:&v254 objects:v286 count:16];
        if (v72)
        {
          v73 = *v255;
LABEL_67:
          v74 = 0;
          while (1)
          {
            if (*v255 != v73)
            {
              objc_enumerationMutation(v71);
            }

            v75 = *(*(&v254 + 1) + 8 * v74);
            objc_opt_class();
            v76 = (objc_opt_isKindOfClass() & 1) != 0 ? v75 : 0;
            v77 = v76;

            v78 = [v70 identifier];
            v79 = [v70 instanceID];
            v80 = [v77 matchesHAPAccessoryWithServerIdentifier:v78 instanceID:v79];

            if (v80)
            {
              break;
            }

            if (v72 == ++v74)
            {
              v72 = [v71 countByEnumeratingWithState:&v254 objects:v286 count:16];
              if (v72)
              {
                goto LABEL_67;
              }

              goto LABEL_76;
            }
          }

          v227 = objc_autoreleasePoolPush();
          v215 = vala;
          v81 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v81, OS_LOG_TYPE_INFO))
          {
            v196 = HMFGetLogIdentifier();
            v198 = [v70 server];
            v82 = [v198 identifier];
            v83 = [v70 instanceID];
            v84 = [v70 linkType];
            v85 = @"Undefined";
            if (v84 <= 2)
            {
              v85 = off_279727440[v84];
            }

            v86 = v85;
            v87 = [v77 name];
            v88 = [v77 uniqueIdentifier];
            *buf = 138544642;
            v292 = v196;
            v293 = 2114;
            v294 = v82;
            v295 = 2114;
            v296 = v83;
            v297 = 2112;
            v298 = v86;
            v299 = 2112;
            v300 = v87;
            v301 = 2112;
            v302 = v88;
            _os_log_impl(&dword_2531F8000, v81, OS_LOG_TYPE_INFO, "%{public}@HAPAccessory %{public}@/%{public}@/%@ matches existing HMDAccessory %@(%@)", buf, 0x3Eu);
          }

          objc_autoreleasePoolPop(v227);
          if (v77)
          {
            [v208 removeObject:v77];
            v89 = [v77 uuid];
            v90 = [v77 hostAccessory];
            v91 = [v90 uuid];
            v228 = [(HMDHome *)v215 getTransactionFromHAPAccessory:v70 hmdAccessory:v77 uuid:v89 hostAccessoryUUID:v91 objectChangeType:2];

            v253 = v223;
            v252 = v220;
            v251 = context;
            [(HMDHome *)v215 getUpdateTransactionForAccessory:v77 hapAccessory:v70 accessoryTransaction:v228 addSvcTransactions:&v253 updateSvcTransactions:&v252 removeSvcTransactions:&v251];
            v92 = v253;

            v93 = v252;
            v94 = v251;

            v95 = [v77 modelObjectWithChangeType:1];
            v250 = 0;
            [v95 diff:v228 differingFields:&v250];
            v96 = v250;

            if ([(__CFString *)v96 count])
            {
              v97 = objc_autoreleasePoolPush();
              v98 = v215;
              v99 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v99, OS_LOG_TYPE_INFO))
              {
                v100 = HMFGetLogIdentifier();
                v101 = [v212 uuid];
                *buf = 138544130;
                v292 = v100;
                v293 = 2114;
                v294 = v101;
                v295 = 2114;
                v296 = v228;
                v297 = 2114;
                v298 = v96;
                _os_log_impl(&dword_2531F8000, v99, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Received accessory update %{public}@ due to diff %{public}@", buf, 0x2Au);
              }

              objc_autoreleasePoolPop(v97);
              [v193 addObject:v228];
            }

            goto LABEL_94;
          }
        }

        else
        {
LABEL_76:
        }

        if (v212)
        {
          v102 = [v70 instanceID];
          v103 = [v102 stringValue];
          v285 = v103;
          v75 = [MEMORY[0x277CBEA60] arrayWithObjects:&v285 count:1];

          v104 = MEMORY[0x277CCAD78];
          v105 = [v212 uuid];
          v228 = [v104 hm_deriveUUIDFromBaseUUID:v105 withSalts:v75];

          if (!v228)
          {
            v106 = objc_autoreleasePoolPush();
            v107 = vala;
            v108 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v108, OS_LOG_TYPE_ERROR))
            {
              v109 = HMFGetLogIdentifier();
              v110 = [v212 shortDescription];
              *buf = 138543618;
              v292 = v109;
              v293 = 2112;
              v294 = v110;
              _os_log_impl(&dword_2531F8000, v108, OS_LOG_TYPE_ERROR, "%{public}@Error during _processUpdatedAccessoryServer: Primary Accessory for Server has nil UUID: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v106);
            v111 = +[HMDTTRManager sharedManager];
            [v111 requestRadarWithDisplayReason:@"accessory has null identifier" radarTitle:@"PrimaryAccessoryForServer results in nil uuid during processUpdatedAccessoryServer"];
          }

          v112 = objc_autoreleasePoolPush();
          v113 = vala;
          v114 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v114, OS_LOG_TYPE_INFO))
          {
            v115 = HMFGetLogIdentifier();
            v116 = [v212 shortDescription];
            v117 = [v70 instanceID];
            v118 = [v228 UUIDString];
            *buf = 138544130;
            v292 = v115;
            v293 = 2114;
            v294 = v116;
            v295 = 2114;
            v296 = v117;
            v297 = 2114;
            v298 = v118;
            _os_log_impl(&dword_2531F8000, v114, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Adding a new bridged accessory instanceID %{public}@ and uuid %{public}@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v112);
          v119 = [v212 uuid];
          v96 = [(HMDHome *)v113 getTransactionFromHAPAccessory:v70 hmdAccessory:0 uuid:v228 hostAccessoryUUID:v119 objectChangeType:1];

          v249 = v223;
          v248 = v220;
          v247 = context;
          [(HMDHome *)v113 getUpdateTransactionForAccessory:0 hapAccessory:v70 accessoryTransaction:v96 addSvcTransactions:&v249 updateSvcTransactions:&v248 removeSvcTransactions:&v247];
          v92 = v249;

          v93 = v248;
          v94 = v247;

          v120 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v212, "certificationStatus")}];
          [(__CFString *)v96 setCertificationStatus:v120];

          v121 = [(HMDHome *)v113 uuidToHAPAccessoryConfigTable];
          [v121 setObject:v70 forKey:v228];

          [v192 addObject:v96];
LABEL_94:

          context = v94;
          v220 = v93;
          v223 = v92;
        }

        v68 = v210 + 1;
      }

      while ((v210 + 1) != obja);
      obja = [v194 countByEnumeratingWithState:&v258 objects:v287 count:16];
    }

    while (obja);
  }

  if ([v208 count])
  {
    v245 = 0u;
    v246 = 0u;
    v243 = 0u;
    v244 = 0u;
    v122 = v208;
    v123 = [v122 countByEnumeratingWithState:&v243 objects:v284 count:16];
    if (v123)
    {
      v124 = *v244;
      do
      {
        for (k = 0; k != v123; ++k)
        {
          if (*v244 != v124)
          {
            objc_enumerationMutation(v122);
          }

          v126 = *(*(&v243 + 1) + 8 * k);
          if (([v126 isPrimary] & 1) == 0)
          {
            v127 = [v126 transactionWithObjectChangeType:3];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v128 = v127;
            }

            else
            {
              v128 = 0;
            }

            v129 = v128;

            v130 = objc_autoreleasePoolPush();
            v131 = vala;
            v132 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v132, OS_LOG_TYPE_INFO))
            {
              v133 = HMFGetLogIdentifier();
              v134 = [v212 shortDescription];
              *buf = 138543874;
              v292 = v133;
              v293 = 2114;
              v294 = v134;
              v295 = 2114;
              v296 = v129;
              _os_log_impl(&dword_2531F8000, v132, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Removing a secondary accessory %{public}@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v130);
            if (v129)
            {
              [v187 addObject:v129];
            }
          }
        }

        v123 = [v122 countByEnumeratingWithState:&v243 objects:v284 count:16];
      }

      while (v123);
    }
  }

  v135 = dispatch_group_create();
  v211 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v216 = v186;
  v136 = v212;
  v225 = v223;
  v222 = v220;
  v229 = context;
  contextb = v136;
  v137 = [v136 configNumber];
  if ([v216 configNumber] != v137)
  {

LABEL_123:
    v146 = @"Add Accessory";
    goto LABEL_124;
  }

  if (![v229 count] && !objc_msgSend(v225, "count"))
  {
    v280 = 0u;
    v281 = 0u;
    v278 = 0u;
    v279 = 0u;
    v199 = v222;
    v197 = [v199 countByEnumeratingWithState:&v278 objects:buf count:16];
    if (v197)
    {
      v167 = *v279;
      v213 = *MEMORY[0x277CD2138];
      objb = *MEMORY[0x277CD21A8];
      v188 = *v279;
      while (2)
      {
        v168 = 0;
        do
        {
          if (*v279 != v167)
          {
            v169 = v168;
            objc_enumerationMutation(v199);
            v168 = v169;
          }

          v189 = v168;
          v170 = *(*(&v278 + 1) + 8 * v168);
          v171 = [v170 instanceID];
          v172 = [contextb findService:v171];

          v173 = [v172 serviceType];
          v174 = [v170 serviceType];
          v175 = [v173 isEqualToString:v174];

          if (!v175)
          {
LABEL_157:

            goto LABEL_119;
          }

          v276 = 0u;
          v277 = 0u;
          v274 = 0u;
          v275 = 0u;
          v201 = [v170 characteristics];
          v176 = [v201 countByEnumeratingWithState:&v274 objects:v290 count:16];
          if (v176)
          {
            v177 = *v275;
            while (2)
            {
              for (m = 0; m != v176; ++m)
              {
                if (*v275 != v177)
                {
                  objc_enumerationMutation(v201);
                }

                v179 = *(*(&v274 + 1) + 8 * m);
                v180 = [v179 objectForKeyedSubscript:v213];
                v181 = [v179 objectForKeyedSubscript:objb];
                v182 = [v172 findCharacteristic:v180];
                v183 = [v182 characteristicType];
                v184 = [v183 isEqualToString:v181];

                if (!v184)
                {

                  goto LABEL_157;
                }
              }

              v176 = [v201 countByEnumeratingWithState:&v274 objects:v290 count:16];
              if (v176)
              {
                continue;
              }

              break;
            }
          }

          v168 = v189 + 1;
          v167 = v188;
        }

        while (v189 + 1 != v197);
        v197 = [v199 countByEnumeratingWithState:&v278 objects:buf count:16];
        v167 = v188;
        if (v197)
        {
          continue;
        }

        break;
      }
    }

    goto LABEL_123;
  }

LABEL_119:
  v138 = objc_autoreleasePoolPush();
  v139 = vala;
  v140 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v140, OS_LOG_TYPE_ERROR))
  {
    v141 = HMFGetLogIdentifier();
    v142 = [contextb shortDescription];
    v143 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v185];
    *buf = 138543874;
    v292 = v141;
    v293 = 2112;
    v294 = v142;
    v295 = 2112;
    v296 = v143;
    _os_log_impl(&dword_2531F8000, v140, OS_LOG_TYPE_ERROR, "%{public}@Only storing the update locally since the accessory %@ didn't update its config number: %@ after updating its services/characteristics.", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v138);
  v144 = @"Add Accessory Locally";
  v145 = +[HMDBackingStoreTransactionOptions defaultLocalOptions];

  v146 = @"Add Accessory Locally";
  v211 = v145;
LABEL_124:
  v147 = [(HMDHome *)vala backingStore];
  v148 = [v147 transaction:v146 options:v211];

  v149 = [v193 arrayByAddingObjectsFromArray:v192];
  v150 = [v149 arrayByAddingObjectsFromArray:v187];

  v241 = 0u;
  v242 = 0u;
  v239 = 0u;
  v240 = 0u;
  v151 = v150;
  v152 = [v151 countByEnumeratingWithState:&v239 objects:v283 count:16];
  if (v152)
  {
    v153 = *v240;
    do
    {
      for (n = 0; n != v152; ++n)
      {
        if (*v240 != v153)
        {
          objc_enumerationMutation(v151);
        }

        v155 = *(*(&v239 + 1) + 8 * n);
        [v155 setConfigurationTracker:v135];
        [v148 add:v155 withMessage:0];
      }

      v152 = [v151 countByEnumeratingWithState:&v239 objects:v283 count:16];
    }

    while (v152);
  }

  v156 = [v222 arrayByAddingObjectsFromArray:v225];
  v157 = [v156 arrayByAddingObjectsFromArray:v229];

  v237 = 0u;
  v238 = 0u;
  v235 = 0u;
  v236 = 0u;
  v158 = v157;
  v159 = [v158 countByEnumeratingWithState:&v235 objects:v282 count:16];
  if (v159)
  {
    v160 = *v236;
    do
    {
      for (ii = 0; ii != v159; ++ii)
      {
        if (*v236 != v160)
        {
          objc_enumerationMutation(v158);
        }

        v162 = *(*(&v235 + 1) + 8 * ii);
        [v162 setConfigurationTracker:v135];
        [v148 add:v162 withMessage:0];
      }

      v159 = [v158 countByEnumeratingWithState:&v235 objects:v282 count:16];
    }

    while (v159);
  }

  objc_initWeak(buf, vala);
  v230[0] = MEMORY[0x277D85DD0];
  v230[1] = 3221225472;
  v230[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke;
  v230[3] = &unk_27972F820;
  objc_copyWeak(&v234, buf);
  v163 = v216;
  v231 = v163;
  v164 = v135;
  v232 = v164;
  v165 = v192;
  v233 = v165;
  [v148 run:v230];

  objc_destroyWeak(&v234);
  objc_destroyWeak(buf);

  v166 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke(uint64_t a1)
{
  v54 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v29 = a1;
    v3 = [*(a1 + 32) accessories];
    v31 = WeakRetained;
    v30 = [WeakRetained accessories];
    v4 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v47 = 0u;
    v48 = 0u;
    v49 = 0u;
    v50 = 0u;
    obj = v3;
    v32 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
    if (v32)
    {
      v28 = *v48;
      do
      {
        v5 = 0;
        do
        {
          if (*v48 != v28)
          {
            objc_enumerationMutation(obj);
          }

          v6 = *(*(&v47 + 1) + 8 * v5);
          v43 = 0u;
          v44 = 0u;
          v45 = 0u;
          v46 = 0u;
          v7 = v30;
          v8 = [v7 countByEnumeratingWithState:&v43 objects:v52 count:16];
          if (v8)
          {
            v9 = v8;
            v10 = *v44;
            do
            {
              v11 = 0;
              do
              {
                if (*v44 != v10)
                {
                  objc_enumerationMutation(v7);
                }

                v12 = *(*(&v43 + 1) + 8 * v11);
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v13 = v12;
                }

                else
                {
                  v13 = 0;
                }

                v14 = v13;

                if (v14 && [v14 matchesHAPAccessory:v6])
                {
                  [v4 setObject:v6 forKey:v14];
                }

                ++v11;
              }

              while (v9 != v11);
              v9 = [v7 countByEnumeratingWithState:&v43 objects:v52 count:16];
            }

            while (v9);
          }

          ++v5;
        }

        while (v5 != v32);
        v32 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
      }

      while (v32);
    }

    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v15 = v4;
    v16 = [v15 countByEnumeratingWithState:&v39 objects:v51 count:16];
    if (v16)
    {
      v17 = v16;
      v33 = *v40;
      do
      {
        v18 = 0;
        do
        {
          if (*v40 != v33)
          {
            objc_enumerationMutation(v15);
          }

          v19 = *(*(&v39 + 1) + 8 * v18);
          dispatch_group_enter(*(v29 + 40));
          v20 = [v15 objectForKey:v19];
          v21 = [v31 notificationRegistrations];
          v22 = [v21 count] != 0;
          v23 = [v31 workQueue];
          v37[0] = MEMORY[0x277D85DD0];
          v37[1] = 3221225472;
          v37[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_2;
          v37[3] = &unk_2797359B0;
          v37[4] = v19;
          v38 = *(v29 + 40);
          [v19 configureWithAccessory:v20 homeNotificationsEnabled:v22 queue:v23 completion:v37];

          ++v18;
        }

        while (v17 != v18);
        v17 = [v15 countByEnumeratingWithState:&v39 objects:v51 count:16];
      }

      while (v17);
    }

    v24 = *(v29 + 40);
    WeakRetained = v31;
    v25 = [v31 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_3;
    block[3] = &unk_279734960;
    block[4] = v31;
    v35 = *(v29 + 32);
    v36 = *(v29 + 48);
    dispatch_group_notify(v24, v25, block);
  }

  v26 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_2(uint64_t a1)
{
  logAndPostNotification(@"HMDAccessoryConnectedNotification", *(a1 + 32), 0);
  [*(a1 + 32) updateLightProfilesSettings];
  v2 = *(a1 + 40);

  dispatch_group_leave(v2);
}

uint64_t __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_3(uint64_t a1)
{
  v1 = a1;
  v46 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) identifier];
  v4 = [v1[5] linkType];
  v38[0] = MEMORY[0x277D85DD0];
  v38[1] = 3221225472;
  v38[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_4;
  v38[3] = &unk_27972F628;
  v38[4] = v1[4];
  [v2 _notifyRetrievalError:0 accessoryServer:v3 linkType:v4 accessoryOperationBlock:v38];

  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = v1[6];
  v5 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
  if (v5)
  {
    v7 = v5;
    v8 = *v35;
    v9 = v32;
    *&v6 = 138543874;
    v27 = v6;
    v28 = *v35;
    do
    {
      v10 = 0;
      do
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v11 = v1[4];
        v12 = [*(*(&v34 + 1) + 8 * v10) uuid];
        v13 = [v11 accessoryWithUUID:v12];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if (v15)
        {
          v16 = objc_autoreleasePoolPush();
          v17 = v1[4];
          v18 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
          {
            v19 = HMFGetLogIdentifier();
            v20 = [v15 shortDescription];
            [v15 supportsTargetController];
            HMFBooleanToString();
            v30 = v16;
            v21 = v7;
            v22 = v1;
            v24 = v23 = v9;
            *buf = v27;
            v40 = v19;
            v41 = 2112;
            v42 = v20;
            v43 = 2112;
            v44 = v24;
            _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Bridged accessory %@ (supportsTargetController %@) being added to home", buf, 0x20u);

            v8 = v28;
            v9 = v23;
            v1 = v22;
            v7 = v21;
            v16 = v30;
          }

          objc_autoreleasePoolPop(v16);
          v31[0] = MEMORY[0x277D85DD0];
          v31[1] = 3221225472;
          v32[0] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_1823;
          v32[1] = &unk_2797359D8;
          v33 = v15;
          [v33 readInitialRequiredCharacteristicsForAccessory:v31];
        }

        ++v10;
      }

      while (v7 != v10);
      v7 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
    }

    while (v7);
  }

  result = [v1[4] _evaluateShouldRelaunchAndSetRelaunch];
  v26 = *MEMORY[0x277D85DE8];
  return result;
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_4(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 isPrimary])
  {
    v4 = MEMORY[0x277D85DD0];
    v5 = 3221225472;
    v6 = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_5;
    v7 = &unk_2797358C8;
    v8 = *(a1 + 32);
    v9 = v3;
    [v9 maybeCommissionToThreadNetworkWithCompletion:&v4];
  }

  [v3 handleUpdatedServicesForThreadManagementWithCompletion:{0, v4, v5, v6, v7, v8}];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_5(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) shortDescription];
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Commissioning finished for %@ with error: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
}

- (void)_processUpdatedProductDataForAccessory:(id)a3 hapAccessory:(id)a4 transaction:(id)a5
{
  v54 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v8 productData];
  v12 = [(HMDHome *)self _productDataFromHAPAccessory:v9];
  v13 = v12;
  if (v11)
  {
    if (v12)
    {
      if (([v12 isEqualToString:v11] & 1) == 0)
      {
        v14 = +[HMDVendorDataManager sharedVendorDataManager];
        v15 = [v14 vendorModelEntryForProductData:v11];

        if (v15)
        {
          v16 = [v15 productDataAlternates];
          v17 = [v16 containsObject:v13];

          v18 = objc_autoreleasePoolPush();
          v19 = self;
          v20 = HMFGetOSLogHandle();
          v21 = v20;
          if (v17)
          {
            if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
            {
              HMFGetLogIdentifier();
              v22 = v41 = v18;
              v23 = [v8 shortDescription];
              *buf = 138544130;
              v45 = v22;
              v46 = 2112;
              v47 = v23;
              v48 = 2112;
              v49 = v11;
              v50 = 2112;
              v51 = v13;
              _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ has changed its product data to a value that is allowed, binding: %@ -> %@", buf, 0x2Au);

              v18 = v41;
            }

            objc_autoreleasePoolPop(v18);
            [v10 setProductDataV2:v13];
            goto LABEL_22;
          }

          if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
          {
            v34 = HMFGetLogIdentifier();
            [v8 shortDescription];
            v38 = v43 = v18;
            *buf = 138544130;
            v45 = v34;
            v46 = 2112;
            v47 = v38;
            v48 = 2112;
            v49 = v11;
            v50 = 2112;
            v51 = v13;
            _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has changed its productData to a value that is not allowed, keeping previous product data: %@ -> %@", buf, 0x2Au);

            v18 = v43;
            goto LABEL_20;
          }
        }

        else
        {
          v18 = objc_autoreleasePoolPush();
          v19 = self;
          v21 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            v35 = [v8 shortDescription];
            [v8 manufacturer];
            v36 = v40 = v19;
            [v8 model];
            v37 = v42 = v18;
            *buf = 138544386;
            v45 = v34;
            v46 = 2112;
            v47 = v35;
            v48 = 2112;
            v49 = v36;
            v50 = 2112;
            v51 = v37;
            v52 = 2112;
            v53 = v11;
            _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ could not be found in the VIDB, keeping previous product data (manufacturer: '%@', model: '%@', productData: '%@')", buf, 0x34u);

            v18 = v42;
            v19 = v40;

            v15 = 0;
LABEL_20:
          }
        }

        objc_autoreleasePoolPop(v18);
LABEL_22:
      }
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      v30 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        v33 = [v8 shortDescription];
        *buf = 138543874;
        v45 = v32;
        v46 = 2112;
        v47 = v33;
        v48 = 2112;
        v49 = v11;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ is no longer advertising product data, keeping previous product data %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
    }
  }

  else if (v12)
  {
    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [v8 shortDescription];
      *buf = 138543874;
      v45 = v27;
      v46 = 2112;
      v47 = v28;
      v48 = 2112;
      v49 = v13;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ is now bound to product data %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v24);
    [v10 setProductDataV2:v13];
    [v10 setProductData:v13];
  }

  v39 = *MEMORY[0x277D85DE8];
}

- (void)_processProductDataForNewlyAddedAccessory:(id)a3 transaction:(id)a4
{
  v21 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self _productDataFromHAPAccessory:v6];
  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v6 shortDescription];
      v15 = 138543874;
      v16 = v12;
      v17 = 2112;
      v18 = v13;
      v19 = 2112;
      v20 = v8;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ is now bound to productData %@", &v15, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [v7 setProductDataV2:v8];
    [v7 setProductData:v8];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)_productDataFromHAPAccessory:(id)a3
{
  v61 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 server];
  v6 = [v5 productData];

  if (v6)
  {
    v7 = [v5 productData];
    v8 = [HMDAccessory validateProductData:v7];

    if (v8)
    {
      v9 = [v4 productData];
      if (v9)
      {
        v10 = v9;
        v11 = [v5 productData];
        v12 = [v4 productData];
        v13 = [v11 isEqualToString:v12];

        if ((v13 & 1) == 0)
        {
          v14 = objc_autoreleasePoolPush();
          v15 = self;
          v16 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            v17 = HMFGetLogIdentifier();
            v18 = [v4 shortDescription];
            v19 = [v5 productData];
            v20 = [v4 productData];
            v53 = 138544130;
            v54 = v17;
            v55 = 2112;
            v56 = v18;
            v57 = 2112;
            v58 = v19;
            v59 = 2112;
            v60 = v20;
            _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ is using productData from pair setup that differs from productData published on AIS: %@ != %@", &v53, 0x2Au);
          }

          objc_autoreleasePoolPop(v14);
        }
      }

      v21 = v5;
      goto LABEL_15;
    }

    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      v26 = [v4 shortDescription];
      v27 = [v5 productData];
      v53 = 138543874;
      v54 = v25;
      v55 = 2112;
      v56 = v26;
      v57 = 2112;
      v58 = v27;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has invalid productData from pair setup: %@", &v53, 0x20u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v28 = [v4 productData];

  if (v28)
  {
    v29 = [v4 productData];
    v30 = [HMDAccessory validateProductData:v29];

    if (v30)
    {
      v21 = v4;
LABEL_15:
      v31 = [v21 productData];
      goto LABEL_29;
    }

    v32 = objc_autoreleasePoolPush();
    v33 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      v36 = [v4 shortDescription];
      v37 = [v4 productData];
      v53 = 138543874;
      v54 = v35;
      v55 = 2112;
      v56 = v36;
      v57 = 2112;
      v58 = v37;
      _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has invalid productData published on AIS: %@", &v53, 0x20u);
    }

    objc_autoreleasePoolPop(v32);
  }

  v38 = +[HMDVendorDataManager sharedVendorDataManager];
  v39 = [v4 manufacturer];
  v40 = [v4 model];
  v41 = [v38 vendorModelEntryForManufacturer:v39 model:v40];

  if (!v41)
  {
    v43 = objc_autoreleasePoolPush();
    v44 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      v47 = [v4 shortDescription];
      v48 = [v4 manufacturer];
      v49 = [v4 model];
      v53 = 138544130;
      v54 = v46;
      v55 = 2112;
      v56 = v47;
      v57 = 2112;
      v58 = v48;
      v59 = 2112;
      v60 = v49;
      v50 = "%{public}@Accessory %@ could not be found in the VIDB (manufacturer: '%@', model: '%@')";
LABEL_26:
      _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_ERROR, v50, &v53, 0x2Au);
    }

LABEL_27:

    objc_autoreleasePoolPop(v43);
    v31 = 0;
    goto LABEL_28;
  }

  v42 = [v41 productData];

  if (!v42)
  {
    v43 = objc_autoreleasePoolPush();
    v44 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      v47 = [v4 shortDescription];
      v48 = [v4 manufacturer];
      v49 = [v4 model];
      v53 = 138544130;
      v54 = v46;
      v55 = 2112;
      v56 = v47;
      v57 = 2112;
      v58 = v48;
      v59 = 2112;
      v60 = v49;
      v50 = "%{public}@Accessory %@ does not have productData in the VIDB (manufacturer: '%@', model: '%@')";
      goto LABEL_26;
    }

    goto LABEL_27;
  }

  v31 = [v41 productData];
LABEL_28:

LABEL_29:
  v51 = *MEMORY[0x277D85DE8];

  return v31;
}

- (void)filterServiceTransactions:(id)a3 removedServiceUUIDs:(id)a4
{
  v41 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (v6 && [v6 count] && objc_msgSend(v7, "count"))
  {
    v8 = [MEMORY[0x277CCAB58] indexSet];
    v30 = 0u;
    v31 = 0u;
    v32 = 0u;
    v33 = 0u;
    v26 = v6;
    v9 = v6;
    v10 = [v9 countByEnumeratingWithState:&v30 objects:v40 count:16];
    if (v10)
    {
      v11 = v10;
      v12 = *v31;
      v27 = *v31;
      v28 = v9;
      do
      {
        v13 = 0;
        v29 = v11;
        do
        {
          if (*v31 != v12)
          {
            objc_enumerationMutation(v9);
          }

          v14 = *(*(&v30 + 1) + 8 * v13);
          v15 = [v14 uuid];
          v16 = [v7 containsObject:v15];

          if (v16)
          {
            [v8 addIndex:{objc_msgSend(v9, "indexOfObject:", v14)}];
            v17 = objc_autoreleasePoolPush();
            v18 = self;
            v19 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
            {
              v20 = HMFGetLogIdentifier();
              [v14 uuid];
              v21 = v8;
              v22 = self;
              v24 = v23 = v7;
              *buf = 138543874;
              v35 = v20;
              v36 = 2114;
              v37 = v24;
              v38 = 2114;
              v39 = v14;
              _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_ERROR, "%{public}@[Pair-Verify %{public}@] Removing duplicate service transaction %{public}@", buf, 0x20u);

              v7 = v23;
              self = v22;
              v8 = v21;
              v9 = v28;

              v12 = v27;
            }

            objc_autoreleasePoolPop(v17);
            v11 = v29;
          }

          ++v13;
        }

        while (v11 != v13);
        v11 = [v9 countByEnumeratingWithState:&v30 objects:v40 count:16];
      }

      while (v11);
    }

    [v9 removeObjectsAtIndexes:v8];
    v6 = v26;
  }

  v25 = *MEMORY[0x277D85DE8];
}

- (BOOL)getUpdateTransactionForAccessory:(id)a3 hapAccessory:(id)a4 accessoryTransaction:(id)a5 addSvcTransactions:(id *)a6 updateSvcTransactions:(id *)a7 removeSvcTransactions:(id *)a8
{
  v170 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = [v10 services];
  v14 = [v13 mutableCopy];

  v155 = 0u;
  v156 = 0u;
  v153 = 0u;
  v154 = 0u;
  v116 = v11;
  v15 = [v11 services];
  v16 = [v15 countByEnumeratingWithState:&v153 objects:v169 count:16];
  v126 = v10;
  v122 = v12;
  if (!v16)
  {
    goto LABEL_65;
  }

  v17 = v16;
  v18 = *v154;
  v134 = 138544130;
  v121 = v15;
  v123 = *v154;
  while (2)
  {
    v19 = 0;
    v124 = v17;
    do
    {
      v127 = v14;
      if (*v154 != v18)
      {
        objc_enumerationMutation(v15);
      }

      v125 = v19;
      v20 = *(*(&v153 + 1) + 8 * v19);
      v21 = [(HMDHome *)self dataSource];
      v22 = [v21 hapMetadata];
      v23 = [v20 type];
      v24 = [v22 shouldFilterServiceOfType:v23];

      if (v24)
      {
        v14 = v127;
        goto LABEL_63;
      }

      v151 = 0u;
      v152 = 0u;
      v149 = 0u;
      v150 = 0u;
      v25 = [v10 services];
      v26 = [v25 countByEnumeratingWithState:&v149 objects:v168 count:16];
      if (v26)
      {
        v27 = v26;
        v28 = *v150;
        while (2)
        {
          for (i = 0; i != v27; ++i)
          {
            if (*v150 != v28)
            {
              objc_enumerationMutation(v25);
            }

            v30 = *(*(&v149 + 1) + 8 * i);
            v31 = [v30 instanceID];
            v32 = [v20 instanceID];
            v33 = [v31 isEqual:v32];

            if (v33)
            {
              v34 = v30;
              goto LABEL_18;
            }
          }

          v27 = [v25 countByEnumeratingWithState:&v149 objects:v168 count:16];
          if (v27)
          {
            continue;
          }

          break;
        }

        v34 = 0;
LABEL_18:
        v15 = v121;
        v12 = v122;
      }

      else
      {
        v34 = 0;
      }

      v35 = [v12 uuid];
      if (v34)
      {
        v36 = 2;
      }

      else
      {
        v36 = 1;
      }

      v37 = [(HMDHome *)self getServiceTransaction:v20 parentUUID:v35 changeType:v36];

      v38 = [(HMDServiceTransaction *)v34 type];
      if (v38)
      {
        v39 = v38;
        v40 = [(HMDServiceTransaction *)v34 type];
        v41 = [(HMDServiceTransaction *)v37 serviceType];
        v42 = [v40 isEqualToString:v41];

        if ((v42 & 1) == 0)
        {

          v111 = 0;
          v94 = v127;
          goto LABEL_82;
        }
      }

      [(HMDHome *)self __updateServiceTransaction:v37 accessoryTransaction:v12 service:v34 accessory:v10 hapService:v20];
      v43 = [(HMDServiceTransaction *)v34 accessory];
      v44 = [v43 shortDescription];
      v45 = v44;
      v46 = v37;
      if (v44)
      {
        v135 = v44;
      }

      else
      {
        v47 = [(HMDBackingStoreModelObject *)v37 parentUUID];
        v135 = [v47 UUIDString];
      }

      if (!v34)
      {
        goto LABEL_59;
      }

      v48 = [(HMDBackingStoreModelObject *)v34 uuid];
      v49 = [(HMDBackingStoreModelObject *)v37 uuid];
      v50 = [v48 isEqual:v49];

      if ((v50 & 1) == 0)
      {
        v84 = objc_autoreleasePoolPush();
        v85 = self;
        v86 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v86, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v88 = v87 = v37;
          v89 = [(HMDBackingStoreModelObject *)v37 uuid];
          *buf = 138544130;
          v161 = v88;
          v162 = 2114;
          v163 = v89;
          v164 = 2114;
          v165 = v34;
          v166 = 2114;
          v167 = v87;
          _os_log_impl(&dword_2531F8000, v86, OS_LOG_TYPE_ERROR, "%{public}@[Pair-Verify %{public}@] matched service %{public}@ doesn't match the service transaction: %{public}@. Removing it to re-add.", buf, 0x2Au);

          v46 = v87;
        }

        objc_autoreleasePoolPop(v84);
LABEL_59:
        v90 = objc_autoreleasePoolPush();
        v91 = self;
        v92 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v92, OS_LOG_TYPE_INFO))
        {
          v93 = HMFGetLogIdentifier();
          *buf = 138543874;
          v161 = v93;
          v162 = 2114;
          v163 = v135;
          v164 = 2114;
          v165 = v46;
          _os_log_impl(&dword_2531F8000, v92, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Adding service %{public}@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v90);
        [*a6 addObject:v46];
        v14 = v127;
        goto LABEL_62;
      }

      v51 = [(HMDServiceTransaction *)v34 modelObjectWithChangeType:1];
      v148 = 0;
      v131 = v51;
      [v51 diff:v37 differingFields:&v148];
      v52 = v148;
      v119 = v52;
      v132 = v37;
      if (a7)
      {
        v53 = v52;
        if ([(HMDServiceTransaction *)v52 count])
        {
          v117 = v34;
          v54 = objc_autoreleasePoolPush();
          v55 = self;
          v56 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
          {
            v57 = HMFGetLogIdentifier();
            *buf = 138544130;
            v161 = v57;
            v162 = 2112;
            v163 = v135;
            v164 = 2114;
            v165 = v46;
            v166 = 2114;
            v167 = v53;
            _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %@] Received service update %{public}@ due to diff %{public}@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v54);
          v146 = 0u;
          v147 = 0u;
          v144 = 0u;
          v145 = 0u;
          obj = v53;
          v58 = [(HMDServiceTransaction *)obj countByEnumeratingWithState:&v144 objects:v159 count:16];
          if (v58)
          {
            v59 = v58;
            v60 = *v145;
            do
            {
              for (j = 0; j != v59; ++j)
              {
                if (*v145 != v60)
                {
                  objc_enumerationMutation(obj);
                }

                v62 = *(*(&v144 + 1) + 8 * j);
                v63 = objc_autoreleasePoolPush();
                v64 = v55;
                v65 = v55;
                v66 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
                {
                  v67 = HMFGetLogIdentifier();
                  v68 = [v131 valueForKeyPath:v62];
                  *buf = 138544130;
                  v161 = v67;
                  v162 = 2114;
                  v163 = v135;
                  v164 = 2114;
                  v165 = v62;
                  v166 = 2114;
                  v167 = v68;
                  _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_INFO, "%{public}@[%{public}@] LOCAL %{public}@: %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v63);
                v69 = objc_autoreleasePoolPush();
                v70 = v65;
                v71 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v71, OS_LOG_TYPE_INFO))
                {
                  v72 = HMFGetLogIdentifier();
                  v73 = [(HMDServiceTransaction *)v132 valueForKeyPath:v62];
                  *buf = 138544130;
                  v161 = v72;
                  v162 = 2114;
                  v163 = v135;
                  v164 = 2114;
                  v165 = v62;
                  v166 = 2114;
                  v167 = v73;
                  _os_log_impl(&dword_2531F8000, v71, OS_LOG_TYPE_INFO, "%{public}@[%{public}@] UPDATE %{public}@: %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v69);
                v55 = v64;
              }

              v59 = [(HMDServiceTransaction *)obj countByEnumeratingWithState:&v144 objects:v159 count:16];
            }

            while (v59);
          }

          [*a7 addObject:v132];
          v34 = v117;
        }
      }

      v74 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v127, "count")}];
      v140 = 0u;
      v141 = 0u;
      v142 = 0u;
      v143 = 0u;
      v75 = v127;
      v76 = [v75 countByEnumeratingWithState:&v140 objects:v158 count:16];
      if (v76)
      {
        v77 = v76;
        v78 = *v141;
        do
        {
          for (k = 0; k != v77; ++k)
          {
            if (*v141 != v78)
            {
              objc_enumerationMutation(v75);
            }

            v80 = *(*(&v140 + 1) + 8 * k);
            v81 = [v80 uuid];
            v82 = [(HMDBackingStoreModelObject *)v34 uuid];
            v83 = [v81 isEqual:v82];

            if ((v83 & 1) == 0)
            {
              [v74 addObject:v80];
            }
          }

          v77 = [v75 countByEnumeratingWithState:&v140 objects:v158 count:16];
        }

        while (v77);
      }

      v135 = v132;
      v46 = v34;
      v14 = v74;
      v10 = v126;
      v15 = v121;
      v12 = v122;
LABEL_62:
      v18 = v123;
      v17 = v124;

LABEL_63:
      v19 = v125 + 1;
    }

    while (v125 + 1 != v17);
    v17 = [v15 countByEnumeratingWithState:&v153 objects:v169 count:16];
    if (v17)
    {
      continue;
    }

    break;
  }

LABEL_65:

  v138 = 0u;
  v139 = 0u;
  v136 = 0u;
  v137 = 0u;
  v94 = v14;
  v95 = [v94 countByEnumeratingWithState:&v136 objects:v157 count:16];
  if (v95)
  {
    v96 = v95;
    v128 = v94;
    v97 = *v137;
    do
    {
      for (m = 0; m != v96; ++m)
      {
        if (*v137 != v97)
        {
          objc_enumerationMutation(v128);
        }

        v99 = *(*(&v136 + 1) + 8 * m);
        v100 = [HMDServiceTransaction alloc];
        v101 = [v99 uuid];
        v102 = [v10 uuid];
        v103 = [(HMDBackingStoreModelObject *)v100 initWithObjectChangeType:3 uuid:v101 parentUUID:v102];

        v104 = objc_autoreleasePoolPush();
        v105 = self;
        v106 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v106, OS_LOG_TYPE_INFO))
        {
          v107 = HMFGetLogIdentifier();
          v108 = [v99 accessory];
          v109 = [v108 shortDescription];
          v110 = v109;
          if (!v109)
          {
            v134 = [(HMDBackingStoreModelObject *)v103 parentUUID];
            v110 = v134;
          }

          *buf = 138543874;
          v161 = v107;
          v162 = 2114;
          v163 = v110;
          v164 = 2114;
          v165 = v103;
          _os_log_impl(&dword_2531F8000, v106, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Removing service %{public}@", buf, 0x20u);
          if (!v109)
          {
          }

          v10 = v126;
        }

        objc_autoreleasePoolPop(v104);
        [*a8 addObject:v103];
      }

      v96 = [v128 countByEnumeratingWithState:&v136 objects:v157 count:16];
    }

    while (v96);
    v94 = v128;

    v12 = v122;
    goto LABEL_81;
  }

  if (a8)
  {
LABEL_81:
    v112 = MEMORY[0x277CBEB98];
    v113 = [*a8 na_map:&__block_literal_global_1811];
    v15 = [v112 setWithArray:v113];

    [(HMDHome *)self filterServiceTransactions:*a6 removedServiceUUIDs:v15];
    [(HMDHome *)self filterServiceTransactions:*a7 removedServiceUUIDs:v15];
    v111 = 1;
LABEL_82:
  }

  else
  {
    v111 = 1;
  }

  v114 = *MEMORY[0x277D85DE8];
  return v111;
}

- (void)__updateServiceTransaction:(id)a3 accessoryTransaction:(id)a4 service:(id)a5 accessory:(id)a6 hapService:(id)a7
{
  v102 = *MEMORY[0x277D85DE8];
  v74 = a3;
  v73 = a4;
  v12 = a5;
  v77 = a6;
  v13 = a7;
  v14 = MEMORY[0x277CBEB18];
  v72 = v13;
  v15 = [v13 characteristics];
  v16 = [v14 arrayWithArray:v15];

  if ([v16 count])
  {
    v17 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v16, "count")}];
    v94 = 0u;
    v95 = 0u;
    v96 = 0u;
    v97 = 0u;
    v69 = v16;
    obj = v16;
    v18 = [obj countByEnumeratingWithState:&v94 objects:v101 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = 0x277CBE000uLL;
      v80 = *MEMORY[0x277CD2138];
      v79 = *MEMORY[0x277CD21A8];
      v85 = *MEMORY[0x277CD2190];
      v86 = *v95;
      v78 = *MEMORY[0x277CD2148];
      v70 = *MEMORY[0x277CD2100];
      v71 = v12;
      v81 = v17;
      v82 = self;
      do
      {
        v21 = 0;
        v83 = v19;
        do
        {
          if (*v95 != v86)
          {
            objc_enumerationMutation(obj);
          }

          v87 = v21;
          v22 = *(*(&v94 + 1) + 8 * v21);
          v23 = [(HMDHome *)self dataSource];
          v24 = [v23 hapMetadata];
          v25 = [v22 type];
          v26 = [v24 shouldFilterCharacteristicOfType:v25];

          if ((v26 & 1) == 0)
          {
            v27 = [v22 metadata];
            v28 = [*(v20 + 2872) dictionaryWithCapacity:8];
            v29 = [v27 format];
            [v28 setObject:v29 forKeyedSubscript:@"metadataFormat"];

            v30 = [v27 units];
            [v28 setObject:v30 forKeyedSubscript:@"metadataUnits"];

            v31 = [v27 manufacturerDescription];
            [v28 setObject:v31 forKeyedSubscript:@"metadataUserDescription"];

            v32 = [v27 constraints];

            if (v32)
            {
              v33 = [v27 constraints];
              v34 = [v33 minimumValue];
              [v28 setObject:v34 forKeyedSubscript:@"metadataMinimumValue"];

              v35 = [v27 constraints];
              v36 = [v35 maximumValue];
              [v28 setObject:v36 forKeyedSubscript:@"metadataMaximumValue"];

              v37 = [v27 constraints];
              v38 = [v37 stepValue];
              [v28 setObject:v38 forKeyedSubscript:@"metadataStepValue"];

              v39 = [v27 constraints];
              v40 = [v39 maxLength];
              [v28 setObject:v40 forKeyedSubscript:@"metadataMaxLength"];

              v41 = [v27 constraints];
              v42 = [v41 validValues];
              [v28 setObject:v42 forKeyedSubscript:@"metadataValidValues"];
            }

            v43 = *(v20 + 2872);
            v99[0] = v80;
            v44 = [v22 instanceID];
            v100[0] = v44;
            v99[1] = v79;
            v45 = [v22 type];
            v100[1] = v45;
            v99[2] = v85;
            v46 = [MEMORY[0x277CCABB0] numberWithUnsignedShort:{objc_msgSend(v22, "properties")}];
            v99[3] = v78;
            v100[2] = v46;
            v100[3] = v28;
            v47 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v100 forKeys:v99 count:4];
            v48 = [v43 dictionaryWithDictionary:v47];

            if (v12)
            {
              v92 = 0u;
              v93 = 0u;
              v90 = 0u;
              v91 = 0u;
              v49 = [v12 characteristics];
              v50 = [v49 countByEnumeratingWithState:&v90 objects:v98 count:16];
              if (v50)
              {
                v75 = v48;
                v76 = v27;
                v51 = *v91;
LABEL_13:
                v52 = 0;
                while (1)
                {
                  if (*v91 != v51)
                  {
                    objc_enumerationMutation(v49);
                  }

                  v53 = *(*(&v90 + 1) + 8 * v52);
                  v54 = [v53 instanceID];
                  v55 = [v22 instanceID];
                  v56 = [v54 isEqual:v55];

                  if (v56)
                  {
                    break;
                  }

                  if (v50 == ++v52)
                  {
                    v50 = [v49 countByEnumeratingWithState:&v90 objects:v98 count:16];
                    if (v50)
                    {
                      goto LABEL_13;
                    }

                    v12 = v71;
                    v48 = v75;
                    v27 = v76;
                    goto LABEL_25;
                  }
                }

                v50 = v53;

                if (v50)
                {
                  v57 = [v50 authorizationData];

                  v12 = v71;
                  v48 = v75;
                  v27 = v76;
                  if (v57)
                  {
                    v58 = [v50 authorizationData];
                    [v75 setObject:v58 forKeyedSubscript:v70];
                  }

                  v59 = [v77 findServiceWithServiceType:@"00000701-0000-1000-8000-0026BB765291"];

                  if (v59)
                  {
                    v60 = [v22 properties];
                    v61 = [v50 properties];
                    v49 = [MEMORY[0x277CCABB0] numberWithUnsignedShort:v61 & 0x80 | v60];
                    [v75 setObject:v49 forKeyedSubscript:v85];
                    goto LABEL_25;
                  }
                }

                else
                {
                  v12 = v71;
                  v48 = v75;
                  v27 = v76;
                }
              }

              else
              {
LABEL_25:
              }
            }

            v17 = v81;
            [v81 addObject:v48];
            v62 = [v22 value];

            if (v62)
            {
              aBlock[0] = MEMORY[0x277D85DD0];
              aBlock[1] = 3221225472;
              aBlock[2] = __88__HMDHome___updateServiceTransaction_accessoryTransaction_service_accessory_hapService___block_invoke;
              aBlock[3] = &unk_2797288A8;
              v89 = v74;
              v63 = _Block_copy(aBlock);
              v64 = [v22 type];
              v65 = [v22 value];
              v66 = [v72 type];
              [HMDService processUpdateForCharacteristicType:v64 value:v65 serviceType:v66 service:v12 serviceTransactionGetter:v63 accessory:v77 accessoryTransaction:v73 accessoryTransactionChanged:0];
            }

            self = v82;
            v19 = v83;
            v20 = 0x277CBE000;
          }

          v21 = v87 + 1;
        }

        while (v87 + 1 != v19);
        v19 = [obj countByEnumeratingWithState:&v94 objects:v101 count:16];
      }

      while (v19);
    }

    v16 = v69;
  }

  else
  {
    v17 = 0;
  }

  v67 = +[HMDCharacteristic sortComparatorForCharacteristicDictionary];
  [v17 sortUsingComparator:v67];

  [v74 setCharacteristics:v17];
  v68 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didFinishPairingForAccessoryServer:(id)a4
{
  v53 = *MEMORY[0x277D85DE8];
  v43 = a3;
  v6 = a4;
  v7 = [(HMDHome *)self primaryResident];
  v8 = v7;
  if (v7 && ([v7 device], v9 = objc_claimAutoreleasedReturnValue(), v9, v9))
  {
    v10 = objc_alloc(MEMORY[0x277D0F820]);
    v11 = [(HMDHome *)self uuid];
    v42 = [v10 initWithTarget:v11];

    v12 = v6;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v13 = v12;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    v15 = [MEMORY[0x277CBEB38] dictionary];
    v16 = [v14 nodeID];
    [v15 setObject:v16 forKeyedSubscript:@"HMDHomePairingCompletionNodeIDMessageKey"];

    v17 = [v14 fabricID];
    [v15 setObject:v17 forKeyedSubscript:@"HMDHomePairingCompletionFabricIDMessageKey"];

    v18 = [v14 fabricID];
    [v15 setObject:v18 forKeyedSubscript:@"HMDHomePairingCompletionFabricIndexMessageKey"];

    v19 = [v14 vendorID];
    [v15 setObject:v19 forKeyedSubscript:@"HMDHomePairingCompletionVendorIDMessageKey"];

    v20 = [v14 productID];
    [v15 setObject:v20 forKeyedSubscript:@"HMDHomePairingCompletionProductIDMessageKey"];

    v21 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v14, "configNumber")}];
    [v15 setObject:v21 forKeyedSubscript:@"HMDHomePairingCompletionConfigNumberMessageKey"];

    v22 = [v14 category];
    [v15 setObject:v22 forKeyedSubscript:@"HMDHomePairingCompletionCategoryMessageKey"];

    v23 = [v14 topology];
    [v15 setObject:v23 forKeyedSubscript:@"HMDHomePairingCompletionTopologyMessageKey"];

    v24 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeNotificationPairingCompletionMessage" destination:v42 payload:v15];
    objc_initWeak(&location, self);
    v45[0] = MEMORY[0x277D85DD0];
    v45[1] = 3221225472;
    v45[2] = __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke;
    v45[3] = &unk_279733AE8;
    objc_copyWeak(&v47, &location);
    v46 = v12;
    [v24 setResponseHandler:v45];
    v25 = objc_autoreleasePoolPush();
    v26 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
    {
      v28 = HMFGetLogIdentifier();
      v29 = [v24 shortDescription];
      *buf = 138543618;
      v50 = v28;
      v51 = 2112;
      v52 = v29;
      _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Sending message %@ to notify pairing completion", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v25);
    v30 = [(HMDHome *)v26 primaryResidentMessageRouter];
    v31 = v30;
    if (v30)
    {
      v44[0] = MEMORY[0x277D85DD0];
      v44[1] = 3221225472;
      v44[2] = __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke_1806;
      v44[3] = &unk_279733FD8;
      v44[4] = v26;
      [v30 routeMessage:v24 localHandler:v44];
    }

    else
    {
      v36 = objc_autoreleasePoolPush();
      v37 = v26;
      v38 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        v39 = HMFGetLogIdentifier();
        *buf = 138543362;
        v50 = v39;
        _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to send HMDHomeNotificationPairingCompletionMessage", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v36);
      v40 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v24 respondWithError:v40];
    }

    objc_destroyWeak(&v47);
    objc_destroyWeak(&location);
  }

  else
  {
    v32 = objc_autoreleasePoolPush();
    v33 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      *buf = 138543362;
      v50 = v35;
      _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not available", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v32);
  }

  v41 = *MEMORY[0x277D85DE8];
}

void __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = v10;
    if (v5)
    {
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        v20 = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = v5;
        v14 = "%{public}@Failed to notify pairing completion for accessory server %@ to the primary resident with error %@";
        v15 = v11;
        v16 = OS_LOG_TYPE_ERROR;
        v17 = 32;
LABEL_7:
        _os_log_impl(&dword_2531F8000, v15, v16, v14, &v20, v17);
      }
    }

    else if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v18 = *(a1 + 32);
      v20 = 138543618;
      v21 = v12;
      v22 = 2112;
      v23 = v18;
      v14 = "%{public}@Successfully notified the primary resident of pairing completion for accessory server %@";
      v15 = v11;
      v16 = OS_LOG_TYPE_INFO;
      v17 = 22;
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v19 = *MEMORY[0x277D85DE8];
}

uint64_t __89__HMDHome_accessoryBrowser_didUpdateReachability_forBTLEAccessoriesWithServerIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 identifier];
  v4 = [v3 isEqualToString:*(a1 + 32)];

  return v4;
}

id __89__HMDHome_accessoryBrowser_didUpdateReachability_forBTLEAccessoriesWithServerIdentifier___block_invoke_1801(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 hasBTLELink])
  {
    v3 = [v2 identifier];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateCategory:(id)a5
{
  v25 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v9 identifier];
  v12 = [(HMDHome *)self hapAccessoryWithIdentifier:v11];

  if (v12)
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v12 shortDescription];
      v19 = 138543874;
      v20 = v16;
      v21 = 2112;
      v22 = v17;
      v23 = 2112;
      v24 = v10;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Paired Accessory: %@, Updated Category to %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    [v12 updateCategory:v10];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateHasPairings:(BOOL)a5
{
  v5 = a5;
  v25 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = [v9 identifier];
  v11 = [(HMDHome *)self hapAccessoryWithIdentifier:v10];

  if (v11)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v9 identifier];
      v19 = 138543874;
      v20 = v15;
      v21 = 2112;
      v22 = v16;
      v23 = 1024;
      v24 = v5;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Updating accessory server %@ with new value of hasPairings: %d", &v19, 0x1Cu);
    }

    objc_autoreleasePoolPop(v12);
    if ([v9 isPaired] == v5)
    {
      v17 = [(HMDHome *)v13 accessoryBrowser];
      [v17 resurrectAccessoryServer:v9];
    }

    else
    {
      [(HMDHome *)v13 _unconfigurePairedAccessoriesForServer:v9 updateReachability:1];
      v17 = [(HMDHome *)v13 accessoryBrowser];
      [v17 tombstoneAccessoryServer:v9];
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isSecureClassTriggeredByCharacteristics:(id)a3
{
  v70 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = MEMORY[0x277CBEB18];
  v6 = [(HMDHome *)self triggers];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(v6, "count")}];

  v58 = 0u;
  v59 = 0u;
  v56 = 0u;
  v57 = 0u;
  v38 = self;
  obj = [(HMDHome *)self triggers];
  v41 = [obj countByEnumeratingWithState:&v56 objects:v69 count:16];
  if (v41)
  {
    v40 = *v57;
    do
    {
      for (i = 0; i != v41; ++i)
      {
        if (*v57 != v40)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v56 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v54 = 0u;
        v55 = 0u;
        v52 = 0u;
        v53 = 0u;
        v42 = v11;
        v12 = [v11 characteristicBaseEvents];
        v13 = [v12 countByEnumeratingWithState:&v52 objects:v68 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v53;
          do
          {
            for (j = 0; j != v14; ++j)
            {
              if (*v53 != v15)
              {
                objc_enumerationMutation(v12);
              }

              v17 = [*(*(&v52 + 1) + 8 * j) characteristic];
              v18 = [v4 containsObject:v17];

              if (v18)
              {
                [v7 addObject:v9];
              }
            }

            v14 = [v12 countByEnumeratingWithState:&v52 objects:v68 count:16];
          }

          while (v14);
        }
      }

      v41 = [obj countByEnumeratingWithState:&v56 objects:v69 count:16];
    }

    while (v41);
  }

  v50 = 0u;
  v51 = 0u;
  v48 = 0u;
  v49 = 0u;
  v19 = v7;
  v20 = [v19 countByEnumeratingWithState:&v48 objects:v67 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v49;
    v43 = *v49;
    do
    {
      for (k = 0; k != v21; ++k)
      {
        if (*v49 != v22)
        {
          objc_enumerationMutation(v19);
        }

        v24 = *(*(&v48 + 1) + 8 * k);
        v44 = 0u;
        v45 = 0u;
        v46 = 0u;
        v47 = 0u;
        v25 = [v24 actionSets];
        v26 = [v25 countByEnumeratingWithState:&v44 objects:v66 count:16];
        if (v26)
        {
          v27 = v26;
          v28 = *v45;
          while (2)
          {
            for (m = 0; m != v27; ++m)
            {
              if (*v45 != v28)
              {
                objc_enumerationMutation(v25);
              }

              v30 = *(*(&v44 + 1) + 8 * m);
              if ([v30 containsSecureCharacteristic])
              {
                v32 = objc_autoreleasePoolPush();
                v33 = v38;
                v34 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v34, OS_LOG_TYPE_DEBUG))
                {
                  v35 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v61 = v35;
                  v62 = 2112;
                  v63 = v24;
                  v64 = 2112;
                  v65 = v30;
                  _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_DEBUG, "%{public}@Trigger %@ has action set %@ with security class", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v32);
                v31 = 1;
                goto LABEL_40;
              }
            }

            v27 = [v25 countByEnumeratingWithState:&v44 objects:v66 count:16];
            if (v27)
            {
              continue;
            }

            break;
          }
        }

        v22 = v43;
      }

      v21 = [v19 countByEnumeratingWithState:&v48 objects:v67 count:16];
      v31 = 0;
    }

    while (v21);
  }

  else
  {
    v31 = 0;
  }

LABEL_40:

  v36 = *MEMORY[0x277D85DE8];
  return v31;
}

- (void)handleUpdatedCharacteristics:(id)a3 accessoryServer:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_handleUpdatedCharacteristics_accessoryServer___block_invoke;
  block[3] = &unk_279734960;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(v8, block);
}

- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didUpdateValuesForCharacteristics:(id)a5 stateNumber:(id)a6 broadcast:(BOOL)a7
{
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v14 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __100__HMDHome_accessoryBrowser_accessoryServer_didUpdateValuesForCharacteristics_stateNumber_broadcast___block_invoke;
  block[3] = &unk_279731590;
  block[4] = self;
  v19 = v12;
  v20 = v11;
  v21 = v13;
  v22 = a7;
  v15 = v13;
  v16 = v11;
  v17 = v12;
  dispatch_async(v14, block);
}

- (id)_changedHMDCharacteristicsForHAPCharacteristics:(id)a3 stateNumber:(id)a4 broadcast:(BOOL)a5 accessoryServer:(id)a6
{
  v7 = a5;
  v182 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v143 = a4;
  v137 = a6;
  v148 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v159 = 0u;
  v160 = 0u;
  v161 = 0u;
  v162 = 0u;
  obj = v10;
  v140 = self;
  v149 = [obj countByEnumeratingWithState:&v159 objects:v181 count:16];
  if (v149)
  {
    context = *v160;
    v141 = v7;
    do
    {
      for (i = 0; i != v149; ++i)
      {
        if (*v160 != context)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v159 + 1) + 8 * i);
        v13 = [v12 service];
        v14 = [v13 accessory];
        v15 = [(HMDHome *)self dataSource];
        v16 = [v15 hapMetadata];
        if (v7)
        {
          v17 = [v12 type];
          v18 = [v16 shouldFilterCharacteristicOfType:v17];

          if (v18)
          {
            goto LABEL_16;
          }

          v19 = [v137 primaryAccessory];

          v14 = v19;
        }

        else
        {
          v20 = [v13 type];
          v21 = [v16 shouldFilterServiceOfType:v20];

          if (v21)
          {
            goto LABEL_16;
          }
        }

        v22 = [(HMDHome *)self hmdHAPAccessoryWithHAPAccessory:v14];
        v23 = [v12 instanceID];
        v24 = [v22 hmdCharacteristicForInstanceId:v23];

        if (v24)
        {
          [v148 setObject:v24 forKey:v12];
        }

        else
        {
          v25 = objc_autoreleasePoolPush();
          v26 = self;
          v27 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
          {
            HMFGetLogIdentifier();
            v28 = v132 = v26;
            [v137 identifier];
            v29 = loga = v27;
            v30 = [v13 instanceID];
            [v12 instanceID];
            v31 = v135 = v25;
            v32 = [v12 type];
            *buf = 138544386;
            v165 = v28;
            v166 = 2112;
            v167 = v29;
            v168 = 2112;
            v169 = v30;
            v170 = 2112;
            v171 = v31;
            v172 = 2112;
            v173 = v32;
            _os_log_impl(&dword_2531F8000, loga, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot map HAPCharacteristic %@/%@/%@/%@ to a HMDCharacteristic", buf, 0x34u);

            v25 = v135;
            v27 = loga;

            v26 = v132;
          }

          objc_autoreleasePoolPop(v25);
          self = v140;
        }

        v7 = v141;
LABEL_16:
      }

      v149 = [obj countByEnumeratingWithState:&v159 objects:v181 count:16];
    }

    while (v149);
  }

  v136 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(obj, "count")}];
  v127 = [MEMORY[0x277CBEB58] set];
  v155 = 0u;
  v156 = 0u;
  v157 = 0u;
  v158 = 0u;
  v33 = [v148 keyEnumerator];
  v34 = [v33 allObjects];

  v133 = v34;
  v142 = [v34 countByEnumeratingWithState:&v155 objects:v180 count:16];
  v36 = 0;
  if (!v142)
  {
    v37 = v143;
    goto LABEL_71;
  }

  log = *v156;
  *&v35 = 138543618;
  v126 = v35;
  v37 = v143;
  do
  {
    v38 = 0;
    do
    {
      if (*v156 != log)
      {
        objc_enumerationMutation(v133);
      }

      v39 = *(*(&v155 + 1) + 8 * v38);
      v40 = [v148 objectForKey:{v39, v126}];
      v41 = [v40 stateNumber];
      v42 = HMFEqualObjects();

      if (v42)
      {
        v150 = v38;
        v43 = [v39 value];
        v44 = [v40 lastKnownValue];
        v45 = [HMDCharacteristic value:v43 differentThan:v44];

        if (v37 && v45)
        {
          contexta = objc_autoreleasePoolPush();
          v46 = self;
          v47 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
          {
            v129 = HMFGetLogIdentifier();
            v48 = [v40 type];
            v49 = [v40 instanceID];
            v50 = [v40 lastKnownValue];
            v51 = [v40 stateNumber];
            v52 = [v39 value];
            v53 = [v137 identifier];
            *buf = 138545154;
            v165 = v129;
            v166 = 2112;
            v167 = v48;
            v168 = 2112;
            v169 = v49;
            v54 = v49;
            v170 = 2112;
            v171 = v50;
            v172 = 2112;
            v173 = v51;
            v174 = 2112;
            v175 = v52;
            v176 = 2112;
            v177 = v143;
            v178 = 2112;
            v179 = v53;
            _os_log_impl(&dword_2531F8000, v47, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value at same state number from %@/%@ to %@/%@ for accessory: %@", buf, 0x52u);

            self = v140;
          }

          goto LABEL_32;
        }

        if ([v40 shouldUpdateValueFromHAPCharacteristic:v39] && (objc_msgSend(v39, "value"), v76 = objc_claimAutoreleasedReturnValue(), v76, v76))
        {
          v77 = objc_autoreleasePoolPush();
          v78 = self;
          v79 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v79, OS_LOG_TYPE_DEFAULT))
          {
            v80 = HMFGetLogIdentifier();
            v81 = [v40 type];
            [v40 instanceID];
            v82 = v130 = v78;
            [v40 lastKnownValue];
            v83 = contextb = v77;
            v84 = [v39 value];
            v85 = [v137 identifier];
            *buf = 138544898;
            v165 = v80;
            v166 = 2112;
            v167 = v81;
            v168 = 2112;
            v169 = v82;
            v170 = 2112;
            v171 = v83;
            v172 = 2112;
            v173 = v84;
            v174 = 2112;
            v175 = v143;
            v176 = 2112;
            v177 = v85;
            _os_log_impl(&dword_2531F8000, v79, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value from %@ to %@ at same state number %@ for accessory: %@", buf, 0x48u);

            v77 = contextb;
            v78 = v130;
          }

          objc_autoreleasePoolPop(v77);
          [v136 addObject:v40];
          v86 = [v40 accessory];
          if (([v86 supportsWoL] & 1) == 0 && !objc_msgSend(v86, "custom1WoBLE"))
          {
            goto LABEL_48;
          }

          v87 = objc_autoreleasePoolPush();
          v88 = v78;
          v89 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v89, OS_LOG_TYPE_INFO))
          {
            v90 = HMFGetLogIdentifier();
            v91 = [v137 identifier];
            *buf = 138544130;
            v165 = v90;
            v166 = 2112;
            v167 = v39;
            v168 = 2112;
            v169 = v40;
            v170 = 2112;
            v171 = v91;
            _os_log_impl(&dword_2531F8000, v89, OS_LOG_TYPE_INFO, "%{public}@Checking if we should update value hapCharacteristic %@ to hmdCharacteristic %@ for accessory: %@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v87);
          if (v45 || ([v40 lastKnownValueUpdateTime], v92 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v39, "valueUpdatedTime"), v93 = objc_claimAutoreleasedReturnValue(), v94 = objc_msgSend(v92, "compare:", v93), v93, v92, v94))
          {
LABEL_48:

            self = v140;
            goto LABEL_33;
          }

          v113 = objc_autoreleasePoolPush();
          v114 = v88;
          v115 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v115, OS_LOG_TYPE_INFO))
          {
            v116 = HMFGetLogIdentifier();
            v117 = [v137 identifier];
            *buf = v126;
            v165 = v116;
            v166 = 2112;
            v167 = v117;
            _os_log_impl(&dword_2531F8000, v115, OS_LOG_TYPE_INFO, "%{public}@Not updating value because update times and values are the same for accessory: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v113);
          v37 = v143;
          [v40 setStateNumber:v143];
          v36 = 1;
        }

        else
        {
          v95 = objc_autoreleasePoolPush();
          v96 = self;
          v97 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v97, OS_LOG_TYPE_DEBUG))
          {
            v128 = HMFGetLogIdentifier();
            v98 = [v40 type];
            v99 = [v40 instanceID];
            [v40 stateNumber];
            v100 = v131 = v36;
            [v40 lastKnownValue];
            v101 = contextc = v95;
            v102 = [v39 value];
            v103 = [v137 identifier];
            *buf = 138544898;
            v165 = v128;
            v166 = 2112;
            v167 = v98;
            v104 = v98;
            v168 = 2112;
            v169 = v99;
            v170 = 2112;
            v171 = v100;
            v172 = 2112;
            v173 = v101;
            v174 = 2112;
            v175 = v102;
            v176 = 2112;
            v177 = v103;
            _os_log_impl(&dword_2531F8000, v97, OS_LOG_TYPE_DEBUG, "%{public}@Ignoring the update for characteristic: '%@'/%@/%@ from %@ to %@ for accessory: %@", buf, 0x48u);

            v95 = contextc;
            v36 = v131;

            v37 = v143;
          }

          objc_autoreleasePoolPop(v95);
        }

        self = v140;
LABEL_53:
        v38 = v150;
        if (!v37)
        {
          goto LABEL_59;
        }

LABEL_54:
        if ((v36 & 1) != 0 && ([v40 shouldIgnoreCacheValueForRead] & 1) == 0)
        {
          v105 = [v40 accessory];
          if (v105)
          {
            [v127 addObject:v105];
          }
        }

        goto LABEL_59;
      }

      v55 = [v39 value];
      if (!v55 || (v56 = v55, v57 = [v40 shouldUpdateValueFromHAPCharacteristic:v39], v56, (v57 & 1) != 0))
      {
        contexta = objc_autoreleasePoolPush();
        v58 = self;
        v47 = HMFGetOSLogHandle();
        v150 = v38;
        if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
        {
          v59 = HMFGetLogIdentifier();
          v60 = [v40 type];
          v61 = [v40 instanceID];
          v62 = [v40 lastKnownValue];
          v63 = [v40 stateNumber];
          v64 = [v39 value];
          v65 = [v137 identifier];
          *buf = 138545154;
          v165 = v59;
          v166 = 2112;
          v167 = v60;
          v168 = 2112;
          v169 = v61;
          v170 = 2112;
          v171 = v62;
          v172 = 2112;
          v173 = v63;
          v174 = 2112;
          v175 = v64;
          v176 = 2112;
          v177 = v143;
          v178 = 2112;
          v179 = v65;
          _os_log_impl(&dword_2531F8000, v47, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value / state number from %@/%@ to %@/%@ for accessory: %@", buf, 0x52u);

          self = v140;
        }

LABEL_32:

        objc_autoreleasePoolPop(contexta);
        [v136 addObject:v40];
LABEL_33:
        v37 = v143;
        [v40 setStateNumber:v143];
        v66 = [v39 notificationContext];

        if (v66)
        {
          v67 = objc_autoreleasePoolPush();
          v68 = self;
          v69 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
          {
            v70 = HMFGetLogIdentifier();
            v71 = [v39 value];
            v72 = [v39 notificationContext];
            *buf = 138543874;
            v165 = v70;
            v166 = 2112;
            v167 = v71;
            v168 = 2112;
            v169 = v72;
            _os_log_impl(&dword_2531F8000, v69, OS_LOG_TYPE_INFO, "%{public}@Updating HMD characteristic with value: %@ and notification context: %@", buf, 0x20u);

            self = v140;
          }

          objc_autoreleasePoolPop(v67);
        }

        v73 = [v39 value];
        v74 = [v39 valueUpdatedTime];
        v75 = [v39 notificationContext];
        [v40 updateValue:v73 updatedTime:v74 stateNumber:v143 notificationContext:v75];

        v36 = 1;
        goto LABEL_53;
      }

      v106 = objc_autoreleasePoolPush();
      v107 = self;
      v108 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v108, OS_LOG_TYPE_INFO))
      {
        v109 = HMFGetLogIdentifier();
        v110 = [v39 value];
        v111 = [v40 shortDescription];
        v112 = [v137 identifier];
        *buf = 138544130;
        v165 = v109;
        v166 = 2112;
        v167 = v110;
        v168 = 2112;
        v169 = v111;
        v170 = 2112;
        v171 = v112;
        _os_log_impl(&dword_2531F8000, v108, OS_LOG_TYPE_INFO, "%{public}@Ignoring same value %@ updates from local for characteristic: '%@' for accessory: %@", buf, 0x2Au);

        v37 = v143;
        self = v140;
      }

      objc_autoreleasePoolPop(v106);
      [v40 setStateNumber:v37];
      v36 = 1;
      if (v37)
      {
        goto LABEL_54;
      }

LABEL_59:

      ++v38;
    }

    while (v142 != v38);
    v118 = [v133 countByEnumeratingWithState:&v155 objects:v180 count:16];
    v142 = v118;
  }

  while (v118);
LABEL_71:

  v153 = 0u;
  v154 = 0u;
  v151 = 0u;
  v152 = 0u;
  v119 = v127;
  v120 = [v119 countByEnumeratingWithState:&v151 objects:v163 count:16];
  if (v120)
  {
    v121 = v120;
    v122 = *v152;
    do
    {
      for (j = 0; j != v121; ++j)
      {
        if (*v152 != v122)
        {
          objc_enumerationMutation(v119);
        }

        [*(*(&v151 + 1) + 8 * j) notifyingCharacteristicStateNumberUpdated:v37];
      }

      v121 = [v119 countByEnumeratingWithState:&v151 objects:v163 count:16];
    }

    while (v121);
  }

  if (v37 != 0 && (v36 & 1) != 0)
  {
    [(HMDHome *)self saveToCurrentAccountWithReason:*MEMORY[0x277CD21D0]];
  }

  v124 = *MEMORY[0x277D85DE8];

  return v136;
}

- (id)_hmdCharacteristicsForUpdatedHAPCharacteristics:(id)a3 accessoryServer:(id)a4
{
  v39 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v25 = a4;
  v28 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
  v24 = [(HMDHome *)self accessories];
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  obj = v6;
  v26 = [obj countByEnumeratingWithState:&v33 objects:v38 count:16];
  if (v26)
  {
    v23 = *v34;
    do
    {
      v7 = 0;
      do
      {
        if (*v34 != v23)
        {
          objc_enumerationMutation(obj);
        }

        v27 = v7;
        v8 = *(*(&v33 + 1) + 8 * v7);
        v9 = [v25 primaryAccessory];
        v29 = 0u;
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v10 = v24;
        v11 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
        if (v11)
        {
          v12 = v11;
          v13 = *v30;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v30 != v13)
              {
                objc_enumerationMutation(v10);
              }

              v15 = *(*(&v29 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v16 = v15;
              }

              else
              {
                v16 = 0;
              }

              v17 = v16;

              if ([v17 matchesHAPAccessory:v9])
              {
                v18 = [v8 instanceID];
                v19 = [v17 hmdCharacteristicForInstanceId:v18];

                if ([v19 shouldUpdateValueFromHAPCharacteristic:v8])
                {
                  [v28 addObject:v19];
                }
              }
            }

            v12 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
          }

          while (v12);
        }

        v7 = v27 + 1;
      }

      while (v27 + 1 != v26);
      v26 = [obj countByEnumeratingWithState:&v33 objects:v38 count:16];
    }

    while (v26);
  }

  v20 = *MEMORY[0x277D85DE8];

  return v28;
}

- (void)accessoryBrowser:(id)a3 didUpdateEndpoint:(id)a4
{
  v87 = *MEMORY[0x277D85DE8];
  v54 = a3;
  v6 = a4;
  v7 = MEMORY[0x277CBEB18];
  v58 = self;
  v8 = [(HMDHome *)self accessories];
  v9 = [v7 arrayWithCapacity:{objc_msgSend(v8, "count")}];

  v55 = v6;
  [v6 advertisements];
  v70 = 0u;
  v71 = 0u;
  v72 = 0u;
  obj = v73 = 0u;
  v59 = [obj countByEnumeratingWithState:&v70 objects:v86 count:16];
  if (v59)
  {
    v57 = *v71;
    do
    {
      v10 = 0;
      do
      {
        if (*v71 != v57)
        {
          objc_enumerationMutation(obj);
        }

        v60 = v10;
        v11 = [*(*(&v70 + 1) + 8 * v10) identifier];
        v66 = 0u;
        v67 = 0u;
        v68 = 0u;
        v69 = 0u;
        v12 = [(HMDHome *)v58 accessories];
        v13 = [v12 countByEnumeratingWithState:&v66 objects:v85 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v67;
          do
          {
            for (i = 0; i != v14; ++i)
            {
              if (*v67 != v15)
              {
                objc_enumerationMutation(v12);
              }

              v17 = *(*(&v66 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v18 = v17;
              }

              else
              {
                v18 = 0;
              }

              v19 = v18;

              v20 = [v19 identifier];
              v21 = [v20 isEqual:v11];

              if (v21)
              {
                [v9 addObject:v19];
              }
            }

            v14 = [v12 countByEnumeratingWithState:&v66 objects:v85 count:16];
          }

          while (v14);
        }

        v10 = v60 + 1;
      }

      while (v60 + 1 != v59);
      v59 = [obj countByEnumeratingWithState:&v70 objects:v86 count:16];
    }

    while (v59);
  }

  v22 = objc_autoreleasePoolPush();
  v23 = v58;
  v24 = HMFGetOSLogHandle();
  v25 = v55;
  if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
  {
    v26 = HMFGetLogIdentifier();
    v27 = [v55 sessionIdentifier];
    *buf = 138544130;
    v76 = v26;
    v77 = 2112;
    v78 = v27;
    v79 = 2112;
    v80 = obj;
    v81 = 2112;
    v82 = v9;
    _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Endpoint %@ with advertisements %@ matches accessories %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v22);
  if ([v9 count])
  {
    v28 = [v55 sessionIdentifier];
    if (!v28)
    {
      v39 = objc_autoreleasePoolPush();
      v40 = v23;
      v41 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
      {
        v42 = HMFGetLogIdentifier();
        *buf = 138543618;
        v76 = v42;
        v77 = 2112;
        v78 = 0;
        _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Nil session identifier - dropping update for endpoint %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v39);
      goto LABEL_46;
    }

    v29 = [(HMDHome *)v23 mediaSessionWithIdentifier:v28];
    v61 = v28;
    if (v29)
    {
      v30 = v29;
      v31 = objc_autoreleasePoolPush();
      v32 = v23;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        v35 = [v30 uuid];
        v36 = [v35 UUIDString];
        v37 = [v9 count];
        *buf = 138544386;
        v76 = v34;
        v77 = 2112;
        v78 = v36;
        v79 = 2112;
        v80 = v28;
        v81 = 2112;
        v82 = obj;
        v83 = 2048;
        v84 = v37;
        v38 = "%{public}@Updated the endpoint for mediaSession %@ with sessionIdentifier %@ (%@ advertisements for %tu accessories) ";
LABEL_32:
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, v38, buf, 0x34u);
      }
    }

    else
    {
      v30 = [(HMDHome *)v23 _createMediaSessionWithEndpoint:v55];
      v31 = objc_autoreleasePoolPush();
      v43 = v23;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        v35 = [v30 uuid];
        v36 = [v35 UUIDString];
        v44 = [v9 count];
        *buf = 138544386;
        v76 = v34;
        v77 = 2112;
        v78 = v36;
        v79 = 2112;
        v80 = v28;
        v81 = 2112;
        v82 = obj;
        v83 = 2048;
        v84 = v44;
        v38 = "%{public}@Creating mediaSession %@ for sessionIdentifier %@ (%@ advertisements for %tu accessories) ";
        goto LABEL_32;
      }
    }

    objc_autoreleasePoolPop(v31);
    v64 = 0u;
    v65 = 0u;
    v62 = 0u;
    v63 = 0u;
    v45 = v9;
    v46 = [v45 countByEnumeratingWithState:&v62 objects:v74 count:16];
    if (v46)
    {
      v47 = v46;
      v48 = *v63;
      do
      {
        for (j = 0; j != v47; ++j)
        {
          if (*v63 != v48)
          {
            objc_enumerationMutation(v45);
          }

          v50 = *(*(&v62 + 1) + 8 * j);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v51 = v50;
          }

          else
          {
            v51 = 0;
          }

          v52 = v51;

          if (!v52)
          {
            [v50 setReachable:1];
          }

          [v50 updateMediaSession:v30];
        }

        v47 = [v45 countByEnumeratingWithState:&v62 objects:v74 count:16];
      }

      while (v47);
    }

    v25 = v55;
    v28 = v61;
LABEL_46:
  }

  v53 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didDiscoverAccessories:(id)a5 transaction:(id)a6 error:(id)a7
{
  v43 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v17 = [v13 identifier];
  v18 = [(HMDHome *)self hapAccessoryWithIdentifier:v17];

  if (v18)
  {
    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    v22 = v21;
    if (v16)
    {
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543874;
        v38 = v23;
        v39 = 2112;
        v40 = v13;
        v41 = 2114;
        v42 = v16;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Failed HAP service discovery on accessory server %@ with error: %{public}@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v19);
      v24 = [v13 identifier];
      v25 = [v13 linkType];
      v33[0] = MEMORY[0x277D85DD0];
      v33[1] = 3221225472;
      v33[2] = __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke;
      v33[3] = &unk_279722B18;
      v26 = v24;
      v35 = v20;
      v36 = v25;
      v34 = v26;
      [(HMDHome *)v20 _notifyRetrievalError:v16 accessoryServer:v26 linkType:v25 accessoryOperationBlock:v33];
      v27 = [v16 domain];
      if ([v27 isEqualToString:*MEMORY[0x277CCFD28]])
      {
        v28 = [v16 code];

        if (v28 == 66)
        {
          [v18 didEncounterError:v16];
LABEL_15:

          goto LABEL_16;
        }
      }

      else
      {
      }

      v30 = v13;
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();

      if (v30 && (isKindOfClass & 1) != 0)
      {
        [v18 _forceEnableReachabilityPingForPrimaryResident:v30];
      }

      goto LABEL_15;
    }

    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v29 = HMFGetLogIdentifier();
      *buf = 138543618;
      v38 = v29;
      v39 = 2112;
      v40 = v13;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Completed HAP service discovery on accessory server %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    [v18 setLastPairingFailureTime:0.0];
    [v18 setConsecutivePairingFailures:0];
    -[HMDHome _configurePairedAccessoriesForServer:reAddServices:](v20, "_configurePairedAccessoriesForServer:reAddServices:", v13, [v14 count] == 0);
  }

LABEL_16:

  v32 = *MEMORY[0x277D85DE8];
}

void __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke(uint64_t a1, void *a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v3 = a2;
  [v3 setReachability:0 serverIdentifier:*(a1 + 32) linkType:*(a1 + 48)];
  if ([v3 hasBTLELink] && *(a1 + 48) == 2)
  {
    v4 = [*(a1 + 40) accessoryBrowser];
    v9[0] = *(a1 + 32);
    v5 = [MEMORY[0x277CBEA60] arrayWithObjects:v9 count:1];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke_2;
    v7[3] = &unk_279722AF0;
    v8 = v3;
    [v4 probeReachabilityForBTLEAccessoryServersWithIdentifiers:v5 forceScan:1 withCompletion:v7];
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 accessoryServer:(id)a4 didStopPairingWithError:(id)a5
{
  v44 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v9 identifier];
  v12 = [(HMDHome *)self hapAccessoryWithIdentifier:v11];

  if (v12)
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v9 shortDescription];
      *buf = 138543874;
      v39 = v16;
      v40 = 2112;
      v41 = v17;
      v42 = 2112;
      v43 = v10;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ stopped pairing with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v18 = objc_autoreleasePoolPush();
    v19 = v14;
    v20 = HMFGetOSLogHandle();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_INFO);
    if (v10)
    {
      if (v21)
      {
        v22 = HMFGetLogIdentifier();
        v23 = [v9 shortDescription];
        *buf = 138543874;
        v39 = v22;
        v40 = 2112;
        v41 = v23;
        v42 = 2112;
        v43 = v10;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ failed to pair with error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v18);
      v24 = [v10 userInfo];
      v25 = [v24 objectForKeyedSubscript:*MEMORY[0x277CCA7E8]];

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v26 = v25;
      }

      else
      {
        v26 = 0;
      }

      v27 = v26;

      v28 = [v27 domain];
      v29 = *MEMORY[0x277CCA590];
      v30 = HMFEqualObjects();

      if (!v30 || [v27 code] != -6754)
      {
        [v12 setLastPairingFailureTime:CFAbsoluteTimeGetCurrent()];
        [v12 setConsecutivePairingFailures:{objc_msgSend(v12, "consecutivePairingFailures") + 1}];
      }

      v31 = [v9 identifier];
      v32 = [v9 linkType];
      v36[0] = MEMORY[0x277D85DD0];
      v36[1] = 3221225472;
      v36[2] = __68__HMDHome_accessoryBrowser_accessoryServer_didStopPairingWithError___block_invoke;
      v36[3] = &unk_279733780;
      v37 = v10;
      [(HMDHome *)v19 _notifyRetrievalError:v37 accessoryServer:v31 linkType:v32 accessoryOperationBlock:v36];
    }

    else
    {
      if (v21)
      {
        v33 = HMFGetLogIdentifier();
        v34 = [v9 shortDescription];
        *buf = 138543618;
        v39 = v33;
        v40 = 2112;
        v41 = v34;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ pairing completed successfully", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
      v27 = [(HMDHome *)v19 accessoryBrowser];
      [v27 discoverAccessories:v9];
    }
  }

  v35 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 discoveryFailedWithError:(id)a4 accessoryServer:(id)a5 linkType:(int64_t)a6
{
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self hapAccessoryWithIdentifier:v10];
  if (v11)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __78__HMDHome_accessoryBrowser_discoveryFailedWithError_accessoryServer_linkType___block_invoke;
    v12[3] = &unk_279722AC8;
    v14 = a6;
    v13 = v10;
    [(HMDHome *)self _notifyRetrievalError:v9 accessoryServer:v13 linkType:a6 accessoryOperationBlock:v12];
  }
}

void __78__HMDHome_accessoryBrowser_discoveryFailedWithError_accessoryServer_linkType___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (*(a1 + 40) != 2)
  {
    v6 = v3;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v4 = v6;
    }

    else
    {
      v4 = 0;
    }

    v5 = v4;
    [v5 setReachability:0 serverIdentifier:*(a1 + 32) linkType:*(a1 + 40)];

    v3 = v6;
  }
}

- (void)accessoryBrowser:(id)a3 didFinishWACForAccessoryWithIdentifier:(id)a4 error:(id)a5
{
  v10 = a4;
  v7 = a5;
  v8 = [(HMDHome *)self accessoryWithIdentifier:v10];
  if (v8)
  {
    v9 = [(HMDHome *)self homeReprovisionHandler];
    [v9 handleReprovionedAccessory:v8 identifier:v10 error:v7];
  }
}

- (void)accessoryBrowser:(id)a3 didFindAccessoryServerNeedingReprovisioning:(id)a4 error:(id)a5
{
  v24 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if ([v9 isPaired])
  {
    v11 = [v9 identifier];
    v12 = [(HMDHome *)self hapAccessoryWithIdentifier:v11];

    if (v12)
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        v17 = [v12 shortDescription];
        v20 = 138543618;
        v21 = v16;
        v22 = 2112;
        v23 = v17;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ needs reprovisioning is found", &v20, 0x16u);
      }

      objc_autoreleasePoolPop(v13);
      v18 = [(HMDHome *)v14 homeReprovisionHandler];
      [v18 handleFoundAccessoryNeedingReprovisioning:v12 error:v10];
    }
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didTombstoneAccessoryServer:(id)a4
{
  v22 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 identifier];
  v9 = [(HMDHome *)self hapAccessoryWithIdentifier:v8];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [v9 shortDescription];
      v16 = 138543874;
      v17 = v13;
      v18 = 2112;
      v19 = v7;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@AccessoryServer %@ tombstoned - unconfiguring all paired accessories for %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    [(HMDHome *)v11 _unconfigurePairedAccessoriesForServer:v7 updateReachability:1];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didRemoveAccessoryServer:(id)a4 error:(id)a5
{
  v30 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v9 identifier];
  v12 = [(HMDHome *)self hapAccessoryWithIdentifier:v11];

  if (v12)
  {
    if ([v9 linkType] == 1)
    {
      [v12 _wol_processDidRemoveHPAccessoryServer:v9];
    }

    v13 = [v9 linkType];
    if (v10)
    {
      v14 = 0;
    }

    else
    {
      v14 = v13 == 2;
    }

    v15 = !v14;
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = @"not updating";
      v24 = 138543874;
      v25 = v19;
      v26 = 2112;
      if (v15)
      {
        v20 = @"updating";
      }

      v27 = v9;
      v28 = 2112;
      v29 = v20;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@AccessoryServer %@ removed - %@ reachability", &v24, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    [(HMDHome *)v17 _unconfigurePairedAccessoriesForServer:v9 updateReachability:v15];
    v21 = objc_alloc_init(HMDHAPMetricsLogEvent);
    [(HMDHAPMetricsLogEvent *)v21 updateWithHAPAccessoryServer:v9];
    v22 = [(HMDHome *)v17 logEventSubmitter];
    [v22 submitLogEvent:v21];
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didFindAccessoryServer:(id)a4 stateChanged:(BOOL)a5 stateNumber:(id)a6 completion:(id)a7
{
  v9 = a5;
  v164 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a6;
  v149 = a7;
  v15 = objc_autoreleasePoolPush();
  v16 = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    v19 = [v13 shortDescription];
    v20 = HMFBooleanToString();
    *buf = 138544130;
    v153 = v18;
    v154 = 2112;
    v155 = v19;
    v156 = 2112;
    v157 = v14;
    v158 = 2112;
    v159 = v20;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Found paired accessory server %@. State: %@/%@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v15);
  v21 = [v13 identifier];
  v22 = [(HMDHome *)v16 hapAccessoryWithIdentifier:v21];

  v23 = [(HMDHome *)v16 _shouldAvoidTombstoningAccessoryServer:v13 accessory:v22];
  v24 = v23;
  if (!v22)
  {
    v45 = 0;
    v33 = v149;
LABEL_84:
    v33[2](v33, v24, v45 & 1);
    goto LABEL_85;
  }

  v143 = v9;
  v147 = v23;
  v25 = [(HMDHome *)v16 residentDeviceManager];
  v144 = [v25 isCurrentDeviceAvailableResident];

  v26 = objc_autoreleasePoolPush();
  v27 = v16;
  v28 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
  {
    v29 = HMFGetLogIdentifier();
    v30 = [v22 shortDescription];
    HMFBooleanToString();
    v32 = v31 = v22;
    *buf = 138543874;
    v153 = v29;
    v154 = 2112;
    v155 = v30;
    v156 = 2112;
    v157 = v32;
    _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Performing accessory/service discovery on paired accessory %@. isResidentDevice: %@", buf, 0x20u);

    v22 = v31;
  }

  objc_autoreleasePoolPop(v26);
  v148 = v14;
  v33 = v149;
  if ((![v22 canWakeUpViaWoL] || objc_msgSend(v22, "shouldDiscoverSuspendCapableAccessoryServer:", v13)) && !objc_msgSend(v13, "wakeNumber"))
  {
    v141 = v12;
    v46 = v13;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v47 = v46;
    }

    else
    {
      v47 = 0;
    }

    v142 = v47;

    if ([v46 isReachable] && (objc_msgSend(v142, "isCached") & 1) == 0)
    {
      v48 = [MEMORY[0x277CBEB18] arrayWithObject:v22];
      v150[0] = MEMORY[0x277D85DD0];
      v150[1] = 3221225472;
      v150[2] = __87__HMDHome_accessoryBrowser_didFindAccessoryServer_stateChanged_stateNumber_completion___block_invoke;
      v150[3] = &unk_279733780;
      v151 = v46;
      [v48 na_each:v150];
    }

    v49 = objc_autoreleasePoolPush();
    v50 = v27;
    v51 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v52 = contexta = v46;
      v53 = [v22 shortDescription];
      [(HMDHome *)v50 isCurrentDevicePrimaryResident];
      v54 = HMFBooleanToString();
      [(HMDHome *)v50 isCurrentDeviceAvailableResident];
      HMFBooleanToString();
      v56 = v55 = v22;
      [(HMDHome *)v50 areAllResidentsUnreachable];
      v57 = HMFBooleanToString();
      *buf = 138544386;
      v153 = v52;
      v154 = 2112;
      v155 = v53;
      v156 = 2114;
      v157 = v54;
      v158 = 2114;
      v159 = v56;
      v160 = 2114;
      v161 = *&v57;
      _os_log_impl(&dword_2531F8000, v51, OS_LOG_TYPE_INFO, "%{public}@Evaluating disconnect on idle status for %@ using - isCurrentDevicePrimaryResident = %{public}@, isCurrentDeviceAvailableResident = %{public}@, areAllResidentsUnreachable = %{public}@", buf, 0x34u);

      v22 = v55;
      v33 = v149;

      v46 = contexta;
    }

    objc_autoreleasePoolPop(v49);
    v58 = shouldDisconnectOnIdleForAccessory(v22);
    if (v58 != [v22 shouldDisconnectOnIdle])
    {
      [v22 setShouldDisconnectOnIdle:v58];
    }

    [v46 setShouldDisconnectOnIdle:v58];
    v59 = [v46 identifier];
    v60 = [v22 supportedTransports];
    v61 = [v46 setupHash];
    [(HMDHome *)v50 _registerPairedAccessory:v59 transports:v60 setupHash:v61];

    DiscoveryBackoffPeriod = 0.0;
    v63 = v143;
    if (v144)
    {
      v14 = v148;
      goto LABEL_41;
    }

    Current = CFAbsoluteTimeGetCurrent();
    [v22 lastPairingFailureTime];
    v66 = Current - v65;
    v67 = [v22 consecutivePairingFailures];
    v14 = v148;
    if (v66 < getDiscoveryBackoffPeriod() || v67 >= 6)
    {
      if (v67 <= 5)
      {
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
      }

      else
      {
        DiscoveryBackoffPeriod = 1800.0;
      }

      [v22 setResetOnBackoffExpiry:v67 > 5];
      v75 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
      v76 = [v46 identifier];
      [(HMDHome *)v50 _notifyRetrievalError:v75 accessoryServer:v76 linkType:0 accessoryOperationBlock:0];

      goto LABEL_38;
    }

    if (!v142 || !v143)
    {
      goto LABEL_41;
    }

    if ([(HMDHome *)v50 _isRegisteredForNotificationsWithRemoteGateway:v22])
    {
      v68 = objc_autoreleasePoolPush();
      v69 = v50;
      v70 = v50;
      v71 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v71, OS_LOG_TYPE_INFO))
      {
LABEL_33:

        objc_autoreleasePoolPop(v68);
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
        v50 = v69;
LABEL_38:
        if (DiscoveryBackoffPeriod != 0.0)
        {
          v45 = 0;
LABEL_79:

          v12 = v141;
          if (DiscoveryBackoffPeriod > 0.0)
          {
            v126 = objc_autoreleasePoolPush();
            v127 = v50;
            v128 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v128, OS_LOG_TYPE_INFO))
            {
              v129 = HMFGetLogIdentifier();
              v130 = [v22 shortDescription];
              HMFBooleanToString();
              v132 = v131 = v22;
              *buf = 138544386;
              v153 = v129;
              v154 = 2112;
              v155 = v130;
              v156 = 2112;
              v157 = v148;
              v158 = 2112;
              v159 = v132;
              v160 = 2048;
              v161 = DiscoveryBackoffPeriod;
              _os_log_impl(&dword_2531F8000, v128, OS_LOG_TYPE_INFO, "%{public}@Backing off discovery for accessory %@ with s# %@, state changed: %@ for %.2f sec", buf, 0x34u);

              v14 = v148;
              v22 = v131;
              v33 = v149;
            }

            objc_autoreleasePoolPop(v126);
            [v22 backOffAccessoryForStateNumber:v14 backoffPeriod:DiscoveryBackoffPeriod];
          }

LABEL_83:
          v24 = v147;
          goto LABEL_84;
        }

        v63 = v143;
LABEL_41:
        if ([v22 shouldAutoDiscoverAccessoryServer])
        {
          v146 = 1;
        }

        else
        {
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) != 0 && ([v22 hasIPLink] & 1) == 0)
          {
            v77 = objc_autoreleasePoolPush();
            v137 = v50;
            v78 = v50;
            v79 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v79, OS_LOG_TYPE_INFO))
            {
              v80 = HMFGetLogIdentifier();
              v81 = [v46 linkType];
              v82 = v33;
              if (v81 > 2)
              {
                v83 = @"Undefined";
              }

              else
              {
                v83 = off_279727440[v81];
              }

              v98 = v83;
              [v22 shortDescription];
              v100 = v99 = v22;
              *buf = 138543874;
              v153 = v80;
              v154 = 2112;
              v155 = v98;
              v156 = 2112;
              v157 = v100;
              _os_log_impl(&dword_2531F8000, v79, OS_LOG_TYPE_INFO, "%{public}@Adding %@ transport for Thread accessory: %@", buf, 0x20u);

              v22 = v99;
              v33 = v82;
              v63 = v143;
            }

            objc_autoreleasePoolPop(v77);
            v101 = MEMORY[0x277CFE9F8];
            v102 = [v22 uniqueIdentifier];
            v103 = [v101 instanceIDForUniqueIdentifier:v102];

            v104 = [HMDAccessoryTransportInformation alloc];
            v105 = [v46 identifier];
            v106 = -[HMDAccessoryTransportInformation initWithServerIdentifier:instanceID:linkType:](v104, "initWithServerIdentifier:instanceID:linkType:", v105, v103, [v46 linkType]);
            [v22 addTransportInformationInstance:v106];

            if ([v46 isReachable])
            {
              v107 = [v46 identifier];
              [v22 setReachability:1 serverIdentifier:v107 linkType:{objc_msgSend(v46, "linkType")}];
            }

            v14 = v148;
            v50 = v137;
          }

          if (v142)
          {
            v108 = v144;
          }

          else
          {
            v108 = 0;
          }

          if (v108 == 1 && (v63 || [v142 connectReason] == 2))
          {
            v109 = objc_autoreleasePoolPush();
            v110 = v50;
            v111 = v50;
            v112 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v112, OS_LOG_TYPE_INFO))
            {
              v113 = HMFGetLogIdentifier();
              v114 = [v22 shortDescription];
              *buf = 138543618;
              v153 = v113;
              v154 = 2112;
              v155 = v114;
              _os_log_impl(&dword_2531F8000, v112, OS_LOG_TYPE_INFO, "%{public}@Enabling auto discovery for BTLE accessory: %@", buf, 0x16u);

              v14 = v148;
            }

            objc_autoreleasePoolPop(v109);
            v146 = 1;
            v50 = v110;
          }

          else
          {
            v146 = 0;
          }
        }

        v115 = [v22 enhancedAuthMethod];
        v116 = -[HMDHome _isRetrievalInProgressForPrimaryAccessory:linkType:](v50, "_isRetrievalInProgressForPrimaryAccessory:linkType:", v22, [v46 linkType]);
        context = objc_autoreleasePoolPush();
        v117 = v50;
        v118 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v118, OS_LOG_TYPE_INFO))
        {
          v138 = v50;
          v134 = HMFGetLogIdentifier();
          v119 = [v46 identifier];
          v120 = [v46 linkType];
          v135 = v117;
          v136 = v22;
          if (v120 > 2)
          {
            v121 = @"Undefined";
          }

          else
          {
            v121 = off_279727440[v120];
          }

          v122 = v121;
          v123 = HMFBooleanToString();
          v124 = HMFBooleanToString();
          v125 = HMFBooleanToString();
          *buf = 138544642;
          v153 = v134;
          v154 = 2112;
          v155 = v119;
          v156 = 2112;
          v157 = v122;
          v158 = 2112;
          v159 = v123;
          v160 = 2112;
          v161 = *&v124;
          v162 = 2112;
          v163 = v125;
          _os_log_impl(&dword_2531F8000, v118, OS_LOG_TYPE_INFO, "%{public}@Evaluating need to discover accessories from found accessory server %@/%@, autoDiscoveryEnabled =  %@, hasExplicitRetrieveRequest = %@ discoverForEAuth = %@", buf, 0x3Eu);

          v14 = v148;
          v33 = v149;
          v22 = v136;
          v50 = v138;
          v117 = v135;
        }

        objc_autoreleasePoolPop(context);
        v45 = v146 | v116 | (v115 == 0);
        goto LABEL_79;
      }

      v72 = HMFGetLogIdentifier();
      v73 = [v22 shortDescription];
      *buf = 138543618;
      v153 = v72;
      v154 = 2112;
      v155 = v73;
      v74 = "%{public}@Backing off since notifications for %@ are registered with remote gateway";
    }

    else
    {
      if (![(HMDHome *)v50 _isEventTriggerOnRemoteGatewayForAccessory:v22]|| [(HMDHome *)v50 _isRegisteredForNotificationsForClients:v22]|| [(HMDHome *)v50 _isEventTriggerOnLocalDeviceForAccessory:v22])
      {
        v84 = [(HMDHome *)v50 _isEventTriggerOnRemoteGatewayForAccessory:v22];
        v85 = objc_autoreleasePoolPush();
        v86 = v50;
        v87 = HMFGetOSLogHandle();
        v88 = os_log_type_enabled(v87, OS_LOG_TYPE_INFO);
        if (!v84)
        {
          if (v88)
          {
            v91 = HMFGetLogIdentifier();
            v92 = [v22 shortDescription];
            v93 = v85;
            v94 = [v142 stateNumber];
            [v142 stateChanged];
            HMFBooleanToString();
            v95 = v33;
            v97 = v96 = v22;
            *buf = 138544130;
            v153 = v91;
            v154 = 2112;
            v155 = v92;
            v156 = 2112;
            v157 = v94;
            v158 = 2112;
            v159 = v97;
            _os_log_impl(&dword_2531F8000, v87, OS_LOG_TYPE_INFO, "%{public}@Discovering BLE Accessory: %@, State Number: %@, State Changed: %@", buf, 0x2Au);

            v14 = v148;
            v22 = v96;
            v33 = v95;
            v85 = v93;
          }

          objc_autoreleasePoolPop(v85);
          v45 = 1;
          v12 = v141;
          goto LABEL_83;
        }

        if (v88)
        {
          v89 = HMFGetLogIdentifier();
          v90 = [v22 shortDescription];
          *buf = 138543618;
          v153 = v89;
          v154 = 2112;
          v155 = v90;
          _os_log_impl(&dword_2531F8000, v87, OS_LOG_TYPE_INFO, "%{public}@Backing off since triggers are on resident and have clients interested for accessory: %@", buf, 0x16u);

          v14 = v148;
        }

        objc_autoreleasePoolPop(v85);
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
        goto LABEL_38;
      }

      v68 = objc_autoreleasePoolPush();
      v69 = v50;
      v70 = v50;
      v71 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v71, OS_LOG_TYPE_INFO))
      {
        goto LABEL_33;
      }

      v72 = HMFGetLogIdentifier();
      v73 = [v22 shortDescription];
      *buf = 138543618;
      v153 = v72;
      v154 = 2112;
      v155 = v73;
      v74 = "%{public}@Not discovering accessory (%@) as trigger is active on resident and no clients and no local triggers locally";
    }

    _os_log_impl(&dword_2531F8000, v71, OS_LOG_TYPE_INFO, v74, buf, 0x16u);

    v14 = v148;
    goto LABEL_33;
  }

  v34 = objc_autoreleasePoolPush();
  v35 = v27;
  v36 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
  {
    v37 = HMFGetLogIdentifier();
    v38 = [v13 shortDescription];
    v39 = [v22 lpmProfile];
    [v22 connectivityInfo];
    v145 = v13;
    v41 = v40 = v12;
    v42 = [v41 woWLANInfo];
    *buf = 138544130;
    v153 = v37;
    v154 = 2112;
    v155 = v38;
    v156 = 2112;
    v157 = v39;
    v158 = 2112;
    v159 = v42;
    _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_INFO, "%{public}@Not discovering the suspended accessory server: %@ with LPM Profile: %@ and WoWInfo: %@.", buf, 0x2Au);

    v12 = v40;
    v13 = v145;

    v33 = v149;
  }

  objc_autoreleasePoolPop(v34);
  v43 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
  v44 = [v13 identifier];
  -[HMDHome _notifyRetrievalError:accessoryServer:linkType:accessoryOperationBlock:](v35, "_notifyRetrievalError:accessoryServer:linkType:accessoryOperationBlock:", v43, v44, [v13 linkType], 0);

  v33[2](v33, v147, 0);
  v14 = v148;
LABEL_85:

  v133 = *MEMORY[0x277D85DE8];
}

void __87__HMDHome_accessoryBrowser_didFindAccessoryServer_stateChanged_stateNumber_completion___block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v6;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [*(a1 + 32) identifier];
  [v4 setReachability:1 serverIdentifier:v5 linkType:{objc_msgSend(*(a1 + 32), "linkType")}];
}

- (void)handleRemovedMediaSessions:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __38__HMDHome_handleRemovedMediaSessions___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __38__HMDHome_handleRemovedMediaSessions___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_arrayForKey:@"kRemovedMediaSessionIdentifiersKey"];

  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  v4 = v3;
  v5 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v11;
    do
    {
      v8 = 0;
      do
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(v4);
        }

        [*(a1 + 40) _removeMediaSessionWithIdentifier:{*(*(&v10 + 1) + 8 * v8++), v10}];
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didRemoveAccessoryAdvertisement:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 identifier];
  v9 = [(HMDHome *)self accessoryWithIdentifier:v8];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = v7;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Handling removed advertisement: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    [v9 removeAdvertisement:v7];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)a3 didAddAccessoryAdvertisement:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 identifier];
  v9 = [(HMDHome *)self accessoryWithIdentifier:v8];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = v7;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Handling added advertisement: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    [v9 addAdvertisement:v7];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceAvailableResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 isCurrentDeviceAvailableResident];

  return v3;
}

- (BOOL)_shouldAvoidTombstoningAccessoryServer:(id)a3 accessory:(id)a4
{
  v42 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = v7;
  v9 = 0;
  if (v6 && v7)
  {
    v10 = [(HMDHome *)self removeAccessoryInProgressForHMDAccessories];
    v11 = [v10 containsObject:v8];

    if (v11)
    {
      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v16 = [v6 name];
        v17 = [v6 identifier];
        *buf = 138543874;
        v37 = v15;
        v38 = 2112;
        v39 = v16;
        v40 = 2112;
        v41 = v17;
        v18 = "%{public}@Accessory %@/%@ being removed from home - not tombstoning";
LABEL_9:
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, v18, buf, 0x20u);
      }
    }

    else
    {
      v19 = [(HMDHome *)self addPendingAccessorySetupCodeHandlers];
      v20 = [v8 uuid];
      v21 = [v19 objectForKey:v20];

      if (!v21)
      {
        v24 = [(HMDHome *)self addPendingAccessories];
        v25 = [v24 hm_allKeys];
        v34[0] = MEMORY[0x277D85DD0];
        v34[1] = 3221225472;
        v34[2] = __60__HMDHome__shouldAvoidTombstoningAccessoryServer_accessory___block_invoke;
        v34[3] = &unk_279722568;
        v26 = v8;
        v35 = v26;
        v27 = [v25 na_any:v34];

        if (!v27)
        {

          v9 = -[HMDHome _isRetrievalInProgressForPrimaryAccessory:linkType:](self, "_isRetrievalInProgressForPrimaryAccessory:linkType:", v26, [v6 linkType]);
          goto LABEL_12;
        }

        v28 = objc_autoreleasePoolPush();
        v29 = self;
        v30 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
        {
          v31 = HMFGetLogIdentifier();
          v32 = [v6 name];
          v33 = [v6 identifier];
          *buf = 138543874;
          v37 = v31;
          v38 = 2112;
          v39 = v32;
          v40 = 2112;
          v41 = v33;
          _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ being added to home (via setupDescription) - not tombstoning", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v28);
        goto LABEL_11;
      }

      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v16 = [v6 name];
        v17 = [v6 identifier];
        *buf = 138543874;
        v37 = v15;
        v38 = 2112;
        v39 = v16;
        v40 = 2112;
        v41 = v17;
        v18 = "%{public}@Accessory %@/%@ being added to home - not tombstoning";
        goto LABEL_9;
      }
    }

    objc_autoreleasePoolPop(v12);
LABEL_11:
    v9 = 1;
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
  return v9;
}

uint64_t __60__HMDHome__shouldAvoidTombstoningAccessoryServer_accessory___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 accessoryUUID];
  v4 = [*(a1 + 32) uuid];
  v5 = [v3 isEqual:v4];

  return v5;
}

- (BOOL)_isEventTriggerOnLocalDeviceForAccessory:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [(HMDHome *)self triggers];
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 isEventTriggerOnLocalDeviceForAccessory:v4];
        if (v12)
        {
          LOBYTE(v6) = 1;
          goto LABEL_14;
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_14:

  v13 = *MEMORY[0x277D85DE8];
  return v6;
}

- (BOOL)_isEventTriggerOnRemoteGatewayForAccessory:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [(HMDHome *)self triggers];
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 isEventTriggerOnRemoteGatewayForAccessory:v4];
        if (v12)
        {
          LOBYTE(v6) = 1;
          goto LABEL_14;
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_14:

  v13 = *MEMORY[0x277D85DE8];
  return v6;
}

- (BOOL)_isRegisteredForNotificationsForClients:(id)a3
{
  v3 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 isClientRegisteredForNotifications];

  return v6;
}

- (BOOL)_isRegisteredForNotificationsWithRemoteGateway:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  v29 = 0u;
  v6 = [v5 services];
  v7 = [v6 copy];

  v8 = [v7 countByEnumeratingWithState:&v26 objects:v31 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v27;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v27 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v26 + 1) + 8 * i);
        v22 = 0u;
        v23 = 0u;
        v24 = 0u;
        v25 = 0u;
        v13 = [v12 characteristics];
        v14 = [v13 copy];

        v15 = [v14 countByEnumeratingWithState:&v22 objects:v30 count:16];
        if (v15)
        {
          v16 = v15;
          v17 = *v23;
          while (2)
          {
            for (j = 0; j != v16; ++j)
            {
              if (*v23 != v17)
              {
                objc_enumerationMutation(v14);
              }

              if ([*(*(&v22 + 1) + 8 * j) notificationRegisteredWithRemoteGateway])
              {

                v19 = 1;
                goto LABEL_22;
              }
            }

            v16 = [v14 countByEnumeratingWithState:&v22 objects:v30 count:16];
            if (v16)
            {
              continue;
            }

            break;
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v26 objects:v31 count:16];
      v19 = 0;
    }

    while (v9);
  }

  else
  {
    v19 = 0;
  }

LABEL_22:

  v20 = *MEMORY[0x277D85DE8];
  return v19;
}

- (void)retrieveHAPAccessoryForHMDAccessory:(id)a3 linkType:(int64_t)a4 forceRetrieve:(BOOL)a5 queue:(id)a6 completion:(id)a7
{
  v12 = a3;
  v13 = a6;
  v14 = a7;
  v15 = [(HMDHome *)self workQueue];
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke;
  v19[3] = &unk_2797268F8;
  v19[4] = self;
  v20 = v12;
  v22 = v14;
  v23 = a4;
  v24 = a5;
  v21 = v13;
  v16 = v13;
  v17 = v14;
  v18 = v12;
  dispatch_async(v15, v19);
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v3 = *(a1 + 72);
  v4 = *(a1 + 64);
  if (*(a1 + 56))
  {
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_2;
    v7[3] = &unk_279733F30;
    v8 = *(a1 + 48);
    v9 = *(a1 + 56);
    [v1 _retrieveHAPAccessoryForHMDHAPAccessory:v2 linkType:v4 forceRetrieve:v3 completion:v7];
  }

  else
  {
    v6 = *(a1 + 32);

    [v6 _retrieveHAPAccessoryForHMDHAPAccessory:v2 linkType:v4 forceRetrieve:v3 completion:0];
  }
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  if (v4)
  {
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_3;
    v7[3] = &unk_279735738;
    v9 = *(a1 + 40);
    v8 = v3;
    dispatch_async(v4, v7);
  }

  else
  {
    v5 = _Block_copy(*(a1 + 40));
    v6 = v5;
    if (v5)
    {
      (*(v5 + 2))(v5, v3);
    }
  }
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_3(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  if (v2)
  {
    v3 = v2;
    (*(v2 + 2))(v2, *(a1 + 32));
    v2 = v3;
  }
}

- (HMFMessageDestination)messageDestination
{
  v3 = objc_alloc(MEMORY[0x277D0F820]);
  v4 = [(HMDHome *)self messageTargetUUID];
  v5 = [v3 initWithTarget:v4];

  return v5;
}

- (void)_removeCorruptAccessories
{
  v2 = self;
  v43 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self accessories];
  v26 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v3, "count")}];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v4 = v3;
  v29 = [v4 countByEnumeratingWithState:&v30 objects:v42 count:16];
  if (v29)
  {
    v6 = *v31;
    *&v5 = 138544130;
    v23 = v5;
    v24 = v4;
    v25 = v2;
    do
    {
      v7 = 0;
      do
      {
        if (*v31 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v30 + 1) + 8 * v7);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        v11 = [v8 identifier];
        if (v11)
        {
          v12 = v11;
          if (!v10)
          {

LABEL_16:
            [v26 addObject:{v8, v23}];
            goto LABEL_17;
          }

          v13 = [v10 uniqueIdentifier];

          if (v13)
          {
            goto LABEL_16;
          }
        }

        v14 = objc_autoreleasePoolPush();
        v15 = v2;
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
        {
          v27 = HMFGetLogIdentifier();
          v17 = [v8 uuid];
          v18 = [v17 UUIDString];
          v19 = [v8 identifier];
          [v10 uniqueIdentifier];
          v28 = v14;
          v21 = v20 = v6;
          *buf = v23;
          v35 = v27;
          v36 = 2112;
          v37 = v18;
          v38 = 2112;
          v39 = v19;
          v40 = 2112;
          v41 = v21;
          _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_DEBUG, "%{public}@Incomplete accessory: %@ (%@ / %@)", buf, 0x2Au);

          v6 = v20;
          v14 = v28;

          v4 = v24;
          v2 = v25;
        }

        objc_autoreleasePoolPop(v14);
LABEL_17:

        ++v7;
      }

      while (v29 != v7);
      v29 = [v4 countByEnumeratingWithState:&v30 objects:v42 count:16];
    }

    while (v29);
  }

  [(HMDHome *)v2 setAccessories:v26];
  v22 = *MEMORY[0x277D85DE8];
}

- (void)_encodeActionSets:(id)a3 coder:(id)a4
{
  v12 = a3;
  v6 = a4;
  if ([(HMDHome *)self shouldWeSendAutomationsToClients])
  {
    v7 = [MEMORY[0x277CBEB18] arrayWithArray:v12];
    v8 = [MEMORY[0x277CCAC30] predicateWithFormat:@"type == %@", *MEMORY[0x277CCF1A8]];
    v9 = [v7 filteredArrayUsingPredicate:v8];
    if ([v9 count])
    {
      v10 = [v9 copy];
      [v6 encodeObject:v10 forKey:@"actionSets"];
    }

    if (([v6 hmd_isForRemoteGatewayCoder] & 1) == 0)
    {
      v11 = [v7 arrayByExcludingObjectsInArray:v9];
      [v6 encodeObject:v11 forKey:@"builtinActionSets"];
    }
  }
}

- (void)encodeMediaSystemsWithCoder:(id)a3 modifiedOptions:(unint64_t)a4
{
  v4 = a4;
  v6 = a3;
  if ((v4 & 0xC0) != 0)
  {
    v9 = v6;
    if ([v6 hmd_isForXPCTransport])
    {
      v7 = [(HMDHome *)self mediaSystems];
      v8 = MEMORY[0x277CD2480];
    }

    else
    {
      v7 = [(HMDHome *)self mediaSystemController];
      v8 = MEMORY[0x277CD2448];
    }

    [v9 encodeObject:v7 forKey:*v8];

    v6 = v9;
  }
}

- (void)_encodeObjectsWithAccessoriesWithCoder:(id)a3
{
  v120 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 hmd_isForXPCTransport];
  v6 = [v4 hmd_isForLocalStore];
  v7 = [v4 hmd_isForRemoteTransport];
  v8 = [v4 hmd_isForRemoteTransportOnSameAccount];
  v9 = [v4 hmd_isForRemoteGatewayCoder];
  v10 = [v4 hmd_isForXPCTransportEntitledForSPIAccess];
  v11 = [v4 hmd_homeManagerOptions];
  v12 = v11;
  if (v11)
  {
    v13 = v11 | 0x9FD0;
    if (!v10)
    {
      v13 = v11;
    }

    if (v8)
    {
      v14 = v11;
    }

    else
    {
      v14 = -1;
    }

    if (!v7)
    {
      v14 = v11;
    }

    if (v5)
    {
      v15 = v13;
    }

    else
    {
      v15 = v14;
    }

    [(HMDHome *)self __encodeAccessoriesWithCoder:v4 options:v15];
    [(HMDHome *)self encodeMediaSystemsWithCoder:v4 modifiedOptions:v15];
    if (([v4 hmd_isForRemoteGatewayCoder] & 1) == 0)
    {
      v16 = [(HMDHome *)self serviceGroups];
      [v4 encodeObject:v16 forKey:*MEMORY[0x277CD25E8]];
    }

    v17 = [(HMDHome *)self actionSets];
    v79 = self;
    [(HMDHome *)self _encodeActionSets:v17 coder:v4];

    if ((((v5 | v6) & 1) != 0 || ((v7 ^ 1 | v8) & 1) == 0 || ((v8 ^ 1 | v9) & 1) == 0) && [(HMDHome *)self shouldWeSendAutomationsToClients])
    {
      v18 = [(HMDHome *)self triggerOwnedActionSets];
      [v4 encodeObject:v18 forKey:@"HM.triggerOwnedActionSets"];
    }

    if (!isWatch())
    {
      v84 = v4;
      if (v5 && v10 & 1 | !isAppleTV())
      {
        v19 = MEMORY[0x277CBEB18];
        v20 = [(HMDHome *)self triggers];
        v21 = [v19 arrayWithCapacity:{objc_msgSend(v20, "count")}];

        v111 = 0u;
        v112 = 0u;
        v109 = 0u;
        v110 = 0u;
        v22 = [(HMDHome *)self triggers];
        v23 = [v22 countByEnumeratingWithState:&v109 objects:v119 count:16];
        if (v23)
        {
          v24 = v23;
          v25 = *v110;
          do
          {
            for (i = 0; i != v24; ++i)
            {
              if (*v110 != v25)
              {
                objc_enumerationMutation(v22);
              }

              v27 = *(*(&v109 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v28 = v27;
              }

              else
              {
                v28 = 0;
              }

              v29 = v28;

              if (v29)
              {
                [v21 addObject:v27];
              }

              else
              {
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v30 = v27;
                  v31 = [v30 significantEvent];

                  if ((v31 == 0) | v10 & 1)
                  {
                    [v21 addObject:v30];
                  }
                }
              }
            }

            v24 = [v22 countByEnumeratingWithState:&v109 objects:v119 count:16];
          }

          while (v24);
        }

        v4 = v84;
        if ([(HMDHome *)self shouldWeSendAutomationsToClients])
        {
          v32 = [v21 copy];
          [v84 encodeObject:v32 forKey:@"triggers"];
        }
      }

      else if (([v4 hmd_isForLocalStore] & 1) != 0 || objc_msgSend(v4, "hmd_isForRemoteTransport") && (objc_msgSend(v4, "hmd_isForRemoteTransportOnSameAccount") & 1) == 0 && (objc_msgSend(v4, "hmd_isForRemoteUserAdministrator") & 1) != 0 || objc_msgSend(v4, "hmd_isForRemoteTransportOnSameAccount") && (objc_msgSend(v4, "hmd_isForRemoteGatewayCoder") & 1) == 0)
      {
        v85 = [MEMORY[0x277CBEB18] array];
        v89 = [MEMORY[0x277CBEB18] array];
        v80 = [MEMORY[0x277CBEB18] array];
        v87 = [MEMORY[0x277CBEB18] array];
        v105 = 0u;
        v106 = 0u;
        v107 = 0u;
        v108 = 0u;
        obj = [(HMDHome *)self triggers];
        v33 = [obj countByEnumeratingWithState:&v105 objects:v118 count:16];
        if (v33)
        {
          v34 = v33;
          v35 = *v106;
          v81 = *v106;
          do
          {
            v36 = 0;
            v82 = v34;
            do
            {
              if (*v106 != v35)
              {
                objc_enumerationMutation(obj);
              }

              v37 = *(*(&v105 + 1) + 8 * v36);
              v38 = [v37 owningDevice];

              if (v38)
              {
                v39 = v37;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v40 = v39;
                }

                else
                {
                  v40 = 0;
                }

                v41 = v40;

                if (([v4 hmd_isForLocalStore] & 1) == 0)
                {
                  v103 = 0u;
                  v104 = 0u;
                  v101 = 0u;
                  v102 = 0u;
                  v42 = [v41 characteristicBaseEvents];
                  v43 = [v42 countByEnumeratingWithState:&v101 objects:v117 count:16];
                  if (v43)
                  {
                    v44 = v43;
                    v45 = *v102;
                    while (2)
                    {
                      for (j = 0; j != v44; ++j)
                      {
                        if (*v102 != v45)
                        {
                          objc_enumerationMutation(v42);
                        }

                        v47 = [*(*(&v101 + 1) + 8 * j) characteristic];
                        v48 = [v47 accessory];

                        objc_opt_class();
                        LOBYTE(v47) = objc_opt_isKindOfClass();

                        if ((v47 & 1) != 0 && v48)
                        {

                          v49 = v80;
                          v35 = v81;
                          v34 = v82;
                          v4 = v84;
                          goto LABEL_68;
                        }
                      }

                      v44 = [v42 countByEnumeratingWithState:&v101 objects:v117 count:16];
                      if (v44)
                      {
                        continue;
                      }

                      break;
                    }
                  }

                  v34 = v82;
                  v4 = v84;
                  v35 = v81;
                }

                if ([v39 requiresDataVersion4])
                {
                  v49 = v87;
                }

                else
                {
                  v49 = v89;
                }

LABEL_68:
                [v49 addObject:v39];
              }

              else
              {
                [v85 addObject:v37];
              }

              ++v36;
            }

            while (v36 != v34);
            v34 = [obj countByEnumeratingWithState:&v105 objects:v118 count:16];
          }

          while (v34);
        }

        v50 = [v89 copy];
        [v4 encodeObject:v50 forKey:@"HM.triggers"];

        v51 = [v80 copy];
        [v4 encodeObject:v51 forKey:@"HM.homePodTriggers"];

        v52 = [v87 copy];
        [v4 encodeObject:v52 forKey:@"HM.sharedActivationTriggers"];

        if ([v4 hmd_isForLocalStore])
        {
          v53 = [v85 copy];
          [v4 encodeObject:v53 forKey:@"triggers"];

          v54 = [(HMDHome *)v79 _updateAndGetOwnedTriggers];
          [v4 encodeObject:v54 forKey:@"HM.deviceOwnedTriggers"];
        }
      }

      else if ([v4 hmd_isForNonAdminSharedUser])
      {
        v56 = objc_autoreleasePoolPush();
        v57 = self;
        v58 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
        {
          v59 = HMFGetLogIdentifier();
          *buf = 138543362;
          v116 = v59;
          _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_INFO, "%{public}@Syncing triggers to remote transport", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v56);
        v83 = [MEMORY[0x277CBEB18] array];
        v86 = [MEMORY[0x277CBEB18] array];
        v97 = 0u;
        v98 = 0u;
        v99 = 0u;
        v100 = 0u;
        v88 = [(HMDHome *)v57 triggers];
        obja = [v88 countByEnumeratingWithState:&v97 objects:v114 count:16];
        if (obja)
        {
          v90 = *v98;
          do
          {
            for (k = 0; k != obja; k = k + 1)
            {
              if (*v98 != v90)
              {
                objc_enumerationMutation(v88);
              }

              v61 = *(*(&v97 + 1) + 8 * k);
              v62 = [v61 owningDevice];

              if (v62)
              {
                v63 = v61;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v64 = v63;
                }

                else
                {
                  v64 = 0;
                }

                v65 = v64;

                v95 = 0u;
                v96 = 0u;
                v93 = 0u;
                v94 = 0u;
                v66 = [v65 characteristicBaseEvents];
                v67 = [v66 countByEnumeratingWithState:&v93 objects:v113 count:16];
                if (v67)
                {
                  v68 = v67;
                  v69 = *v94;
                  while (2)
                  {
                    for (m = 0; m != v68; ++m)
                    {
                      if (*v94 != v69)
                      {
                        objc_enumerationMutation(v66);
                      }

                      v71 = [*(*(&v93 + 1) + 8 * m) characteristic];
                      v72 = [v71 accessory];

                      objc_opt_class();
                      LOBYTE(v71) = objc_opt_isKindOfClass();

                      if ((v71 & 1) != 0 && v72)
                      {

                        v76 = v86;
                        goto LABEL_104;
                      }
                    }

                    v68 = [v66 countByEnumeratingWithState:&v93 objects:v113 count:16];
                    if (v68)
                    {
                      continue;
                    }

                    break;
                  }
                }

                v73 = [v84 hmd_supportedFeatures];
                v74 = [v84 hmd_user];
                v75 = [v63 compatible:v73 user:v74];

                v76 = v83;
                if (v75)
                {
LABEL_104:
                  [v76 addObject:v63];
                }
              }
            }

            obja = [v88 countByEnumeratingWithState:&v97 objects:v114 count:16];
          }

          while (obja);
        }

        v77 = [v83 copy];
        v4 = v84;
        [v84 encodeObject:v77 forKey:@"HM.triggers"];

        v78 = [v86 copy];
        [v84 encodeObject:v78 forKey:@"HM.homePodTriggers"];
      }
    }
  }

  else
  {
    [(HMDHome *)self __encodeAccessoriesWithCoder:v4 options:v11];
    [(HMDHome *)self encodeMediaSystemsWithCoder:v4 modifiedOptions:v12];
  }

  v55 = *MEMORY[0x277D85DE8];
}

- (void)__encodeAccessoriesWithCoder:(id)a3 options:(unint64_t)a4
{
  v87 = a4;
  v112 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v78 = self;
  v6 = [(HMDHome *)self accessories];
  v83 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
  v7 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
  v79 = v5;
  v8 = [v5 hmd_isForXPCTransport];
  v9 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
  v10 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
  v80 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
  v97 = 0u;
  v98 = 0u;
  v99 = 0u;
  v100 = 0u;
  obj = v6;
  v11 = [obj countByEnumeratingWithState:&v97 objects:v111 count:16];
  v84 = v7;
  v85 = v9;
  v86 = v10;
  if (v11)
  {
    v12 = v11;
    v13 = *v98;
    do
    {
      v14 = 0;
      do
      {
        if (*v98 != v13)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v97 + 1) + 8 * v14);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v16 = v15;
        }

        else
        {
          v16 = 0;
        }

        v17 = v16;

        v18 = v15;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (!((v20 == 0) | v8 & 1))
        {
          v22 = v10;
          v23 = v20;
          goto LABEL_19;
        }

        if (!((v17 == 0) | v8 & 1))
        {
          v22 = v9;
          v23 = v17;
          goto LABEL_19;
        }

        v21 = [v18 isCurrentAccessory];
        if ((v87 & 0x10) != 0 && v21)
        {
          v22 = v7;
          v23 = v18;
LABEL_19:
          [v22 addObject:v23];
          goto LABEL_20;
        }

        v24 = v18;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v25 = v24;
        }

        else
        {
          v25 = 0;
        }

        v26 = v25;

        if (v26)
        {
          v10 = v86;
          if ((v87 & 0x100) != 0)
          {
            [v83 addObject:v26];
          }

          goto LABEL_63;
        }

        v27 = v24;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v28 = v27;
        }

        else
        {
          v28 = 0;
        }

        v29 = v28;

        if (v29)
        {
          v7 = v84;
          if ((v87 & 0x40) != 0 || (v87 & 0x800) != 0 && ([v29 device], v30 = objc_claimAutoreleasedReturnValue(), v30, v30))
          {
            [v84 addObject:v29];
          }

          goto LABEL_62;
        }

        v31 = v27;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v32 = v31;
        }

        else
        {
          v32 = 0;
        }

        v33 = v32;
        v81 = v31;

        if (v33)
        {
          v82 = v33;
          v34 = v33;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();
          if (isKindOfClass)
          {
            v36 = v34;
          }

          else
          {
            v36 = 0;
          }

          v37 = v36;

          if (isKindOfClass)
          {
            if (v8)
            {
              v38 = [v34 hostAccessory];

              if (!v38)
              {
                goto LABEL_46;
              }

LABEL_60:

              v33 = v82;
              goto LABEL_61;
            }

            v40 = v80;
            v41 = v34;
          }

          else
          {
LABEL_46:
            if ([v34 hasTelevisionService])
            {
              if ((v87 & 0x400) == 0)
              {
                goto LABEL_60;
              }
            }

            else
            {
              v39 = [v34 networkRouterController];

              if (v39)
              {
                if ((v87 & 0x1000) == 0)
                {
                  goto LABEL_60;
                }
              }

              else if ((v87 & 0x200) == 0)
              {
                v42 = [v34 hasSmartSpeakerService];
                if ((v87 & 0x100) == 0 || !v42)
                {
                  v43 = [v34 siriEndpointProfile];

                  if ((v87 & 0x8000) == 0 || !v43)
                  {
                    goto LABEL_60;
                  }
                }
              }
            }

            v40 = v84;
            v41 = v81;
          }

          [v40 addObject:v41];
          goto LABEL_60;
        }

LABEL_61:

        v7 = v84;
        v29 = 0;
LABEL_62:

        v10 = v86;
LABEL_63:

        v9 = v85;
LABEL_20:

        ++v14;
      }

      while (v12 != v14);
      v44 = [obj countByEnumeratingWithState:&v97 objects:v111 count:16];
      v12 = v44;
    }

    while (v44);
  }

  v45 = objc_autoreleasePoolPush();
  v46 = v78;
  v47 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v47, OS_LOG_TYPE_DEBUG))
  {
    v48 = HMFGetLogIdentifier();
    v49 = [v79 hmd_clientIdentifier];
    v50 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v84, "count")}];
    v51 = [v84 shortDescription];
    *buf = 138544130;
    v104 = v48;
    v105 = 2112;
    v106 = v49;
    v107 = 2112;
    v108 = v50;
    v109 = 2112;
    v110 = v51;
    _os_log_impl(&dword_2531F8000, v47, OS_LOG_TYPE_DEBUG, "%{public}@encoded Accessories [%@]: %@, %@", buf, 0x2Au);

    v7 = v84;
    v9 = v85;
  }

  objc_autoreleasePoolPop(v45);
  v52 = [v7 copy];
  [v79 encodeObject:v52 forKey:@"accessories"];

  v53 = v7;
  v54 = [v83 copy];
  [v79 encodeObject:v54 forKey:@"accessories.airplay"];

  v55 = [v9 copy];
  [v79 encodeObject:v55 forKey:@"accessories.homepod"];

  v56 = v86;
  v57 = [v86 copy];
  [v79 encodeObject:v57 forKey:@"accessories.homepod_6_1"];

  v58 = [v80 copy];
  [v79 encodeObject:v58 forKey:@"HM.AppleMediaAccessorySensor"];

  if ((v87 & 5) == 0)
  {
    v59 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(obj, "count")}];
    v93 = 0u;
    v94 = 0u;
    v95 = 0u;
    v96 = 0u;
    v60 = v7;
    v61 = [v60 countByEnumeratingWithState:&v93 objects:v102 count:16];
    if (v61)
    {
      v62 = v61;
      v63 = *v94;
      do
      {
        for (i = 0; i != v62; ++i)
        {
          if (*v94 != v63)
          {
            objc_enumerationMutation(v60);
          }

          v65 = *(*(&v93 + 1) + 8 * i);
          v66 = [v65 room];

          if (v66)
          {
            v67 = [v65 room];
            [v59 addObject:v67];
          }
        }

        v62 = [v60 countByEnumeratingWithState:&v93 objects:v102 count:16];
      }

      while (v62);
    }

    v91 = 0u;
    v92 = 0u;
    v89 = 0u;
    v90 = 0u;
    v68 = v83;
    v69 = [v68 countByEnumeratingWithState:&v89 objects:v101 count:16];
    if (v69)
    {
      v70 = v69;
      v71 = *v90;
      do
      {
        for (j = 0; j != v70; ++j)
        {
          if (*v90 != v71)
          {
            objc_enumerationMutation(v68);
          }

          v73 = *(*(&v89 + 1) + 8 * j);
          v74 = [v73 room];

          if (v74)
          {
            v75 = [v73 room];
            [v59 addObject:v75];
          }
        }

        v70 = [v68 countByEnumeratingWithState:&v89 objects:v101 count:16];
      }

      while (v70);
    }

    v76 = [v59 allObjects];
    [v79 encodeObject:v76 forKey:@"rooms"];

    v53 = v84;
    v9 = v85;
    v56 = v86;
  }

  v77 = *MEMORY[0x277D85DE8];
}

- (void)_encodeWithCoder:(id)a3
{
  v314 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 hmd_isForXPCTransport];
  v6 = [v4 hmd_isForLocalStore];
  v244 = [v4 hmd_isForXPCTransportEntitledForSPIAccess];
  v243 = [v4 hmd_isForRemoteTransportOnSameAccount];
  v245 = [v4 hmd_homeManagerOptions];
  v246 = v6;
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
    {
      v10 = HMFGetLogIdentifier();
      [(HMDHome *)v8 isOwnerUser];
      v11 = HMFBooleanToString();
      *buf = 138543618;
      v298 = v10;
      v299 = 2112;
      v300 = v11;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Encoding isOwnerUser : %@ for HH2 migration", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    [v4 encodeBool:-[HMDHome isOwnerUser](v8 forKey:{"isOwnerUser"), @"HM.Owner.HH2.MI"}];
  }

  v12 = [(HMDHome *)self uuid];
  v13 = [v12 UUIDString];
  [v4 encodeObject:v13 forKey:@"homeUUID"];

  v14 = [(HMDHome *)self ownerName];
  [v4 encodeObject:v14 forKey:@"homeAdmin"];

  v15 = [(HMDHome *)self owner];
  v16 = [v15 uuid];
  v17 = [v16 UUIDString];
  [v4 encodeObject:v17 forKey:@"kHomeOwnerUUID"];

  v18 = [(HMDHome *)self creationDate];
  [v4 encodeObject:v18 forKey:@"creationDate"];

  v19 = [(HMDHome *)self firstHAPAccessoryAddedDate];
  [v4 encodeObject:v19 forKey:@"firstHAPAccessoryAddedDate"];

  v20 = [(HMDHome *)self configurationVersion];
  v21 = [v4 hmd_supportedFeatures];
  LODWORD(v17) = [v21 containsObject:&unk_286627898];

  if (v17)
  {
    v22 = [MEMORY[0x277D0F8D0] sharedPreferences];
    v23 = [v22 preferenceForKey:@"homeHH2MigrationConfigurationVersionIncrement"];
    v24 = [v23 numberValue];

    if (v24)
    {
      v25 = v24;
    }

    else
    {
      v25 = &unk_2866278B0;
    }

    v20 += [v25 intValue];
  }

  v26 = [MEMORY[0x277CCABB0] numberWithInteger:v20];
  [v4 encodeObject:v26 forKey:@"homeConfigVersion"];

  v27 = [(HMDHome *)self name];
  [v4 encodeObject:v27 forKey:@"homeName"];

  v28 = [(HMDHome *)self homeHubState];
  [v4 encodeInteger:v28 forKey:*MEMORY[0x277CCFFE8]];
  v29 = [(HMDHome *)self isMultiUserEnabled];
  [v4 encodeBool:v29 forKey:*MEMORY[0x277CD0450]];
  if (isFeatureHomeTheaterQFAEnabledForTests)
  {
    v30 = [isFeatureHomeTheaterQFAEnabledForTests BOOLValue];
  }

  else
  {
    v30 = 0;
  }

  [v4 encodeBool:v30 forKey:*MEMORY[0x277CD0618]];
  v31 = [(HMDHome *)self soundCheckEnabled];
  [v4 encodeBool:v31 forKey:*MEMORY[0x277CD05F0]];
  v32 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome siriPhraseOptions](self, "siriPhraseOptions")}];
  [v4 encodeObject:v32 forKey:*MEMORY[0x277CD05E0]];

  v33 = [(HMDHome *)self locationServicesEnabled];
  [v4 encodeBool:v33 forKey:*MEMORY[0x277CD0050]];
  v34 = [(HMDHome *)self didOnboardLocationServices];
  [v4 encodeBool:v34 forKey:*MEMORY[0x277CCFEB0]];
  v35 = [(HMDHome *)self hasAnyUserAcknowledgedCameraRecordingOnboarding];
  [v4 encodeBool:v35 forKey:*MEMORY[0x277CCFFD0]];
  v36 = [(HMDHome *)self hasOnboardedForAccessCode];
  [v4 encodeBool:v36 forKey:*MEMORY[0x277CCFFD8]];
  v37 = [(HMDHome *)self hasOnboardedForWalletKey];
  [v4 encodeBool:v37 forKey:*MEMORY[0x277CCFFE0]];
  v38 = [v4 hmd_supportedFeatures];
  v39 = [v38 containsObject:&unk_286627898];

  v40 = objc_autoreleasePoolPush();
  v41 = self;
  v42 = HMFGetOSLogHandle();
  v43 = os_log_type_enabled(v42, OS_LOG_TYPE_INFO);
  if (v39)
  {
    if (v43)
    {
      v44 = HMFGetLogIdentifier();
      *buf = 138543362;
      v298 = v44;
      _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_INFO, "%{public}@Forcing isUpdatedToHH2 to YES", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v40);
    v45 = 1;
  }

  else
  {
    if (v43)
    {
      v46 = HMFGetLogIdentifier();
      [(HMDHome *)v41 isUpdatedToHH2];
      v47 = HMFBooleanToString();
      *buf = 138543618;
      v298 = v46;
      v299 = 2112;
      v300 = v47;
      _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_INFO, "%{public}@isUpdatedToHH2 is set to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v40);
    v45 = [(HMDHome *)v41 isUpdatedToHH2];
  }

  [v4 encodeBool:v45 forKey:*MEMORY[0x277CD0698]];
  if ([v4 hmd_isForXPCTransportEntitledForSPIAccess])
  {
    v48 = [(HMDHome *)v41 bulletinNotificationsSupported];
    [v4 encodeBool:v48 forKey:*MEMORY[0x277CCFE90]];
  }

  if (([v4 hmd_isForRemoteGatewayCoder] & 1) == 0)
  {
    if ((v5 & v244) != 1)
    {
      v55 = [(HMDHome *)v41 homeLocationHandler];
      v56 = &kHomeLocationHandlerCodingKey;
      goto LABEL_30;
    }

    if ([v4 hmd_isForXPCTransportAuthorizedForLocationAccess])
    {
      v49 = [(HMDHome *)v41 homeLocationHandler];
      v50 = [v49 location];
      [v4 encodeObject:v50 forKey:@"homeLocation"];

      if ([v4 hmd_isForXPCTransportEntitledForHomeLocationAccess])
      {
        v51 = [(HMDHome *)v41 homeLocation];
        [v4 encodeInteger:v51 forKey:*MEMORY[0x277CD0060]];
      }
    }

    v52 = [(HMDHome *)v41 primaryResident];
    v53 = [v52 capabilities];
    v54 = [v53 supportsSiriEndpointSetup];

    if (v54)
    {
      v55 = [objc_alloc(MEMORY[0x277D0F940]) initWithMajorVersion:7 minorVersion:2 updateVersion:2];
      v56 = MEMORY[0x277CD05D8];
LABEL_30:
      [v4 encodeObject:v55 forKey:*v56];
    }
  }

  if (v246)
  {
    v57 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome lastSyncedConfigurationVersion](v41, "lastSyncedConfigurationVersion")}];
    [v4 encodeObject:v57 forKey:@"lastSyncedHomeConfigVersion"];

    v58 = [(HMDHome *)v41 reachabilityNotificationManager];
    v59 = [v58 reachabilityContext];
    [v4 encodeObject:v59 forKey:@"HMHH.residentReachabilityContext"];
  }

  v60 = v245;
  v250 = v41;
  if ((v245 & 9) != 0)
  {
    v241 = v5;
    v255 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v292 = 0u;
    v293 = 0u;
    v294 = 0u;
    v295 = 0u;
    v61 = [(HMDHome *)v41 _residentUsers];
    v62 = [v61 countByEnumeratingWithState:&v292 objects:v313 count:16];
    if (v62)
    {
      v63 = v62;
      v64 = *v293;
      do
      {
        for (i = 0; i != v63; ++i)
        {
          if (*v293 != v64)
          {
            objc_enumerationMutation(v61);
          }

          v66 = *(*(&v292 + 1) + 8 * i);
          v67 = [v66 userID];
          v68 = [HMDDevice deviceWithDestination:v67];

          if (v68)
          {
            [v255 setObject:v66 forKey:v68];
          }
        }

        v63 = [v61 countByEnumeratingWithState:&v292 objects:v313 count:16];
      }

      while (v63);
    }

    v290 = 0u;
    v291 = 0u;
    v288 = 0u;
    v289 = 0u;
    v69 = [(HMDHome *)v41 residentDeviceManager];
    v70 = [v69 residentDevices];

    v71 = [v70 countByEnumeratingWithState:&v288 objects:v312 count:16];
    if (v71)
    {
      v72 = v71;
      v73 = *v289;
      do
      {
        for (j = 0; j != v72; ++j)
        {
          if (*v289 != v73)
          {
            objc_enumerationMutation(v70);
          }

          v75 = *(*(&v288 + 1) + 8 * j);
          v76 = [v75 device];
          v77 = [v76 capabilities];
          v78 = [v77 isRemoteGatewayCapable];

          if (v78)
          {
            v79 = [(HMDHome *)v41 _residentUserForResidentDevice:v75];
            if (v79)
            {
              v80 = [v75 device];
              [v255 setObject:v79 forKey:v80];
            }
          }
        }

        v72 = [v70 countByEnumeratingWithState:&v288 objects:v312 count:16];
      }

      while (v72);
    }

    v81 = [v255 objectEnumerator];
    v242 = [v81 allObjects];

    v5 = v241;
    if (!v241 || !(v244 & 1 | !isAppleTV()))
    {
      v60 = v245;
      if ((v246 | v243))
      {
        v105 = MEMORY[0x277CBEB18];
        v106 = [(HMDHome *)v41 users];
        v107 = [v105 arrayWithArray:v106];

        if ([v4 hmd_isForRemoteTransportOnSameAccount])
        {
          v108 = [v4 hmd_supportedFeatures];
          v109 = [v108 containsObject:&unk_2866278C8];

          if ((v109 & 1) == 0)
          {
            v278 = 0u;
            v279 = 0u;
            v276 = 0u;
            v277 = 0u;
            v110 = [(HMDHome *)v41 users];
            v111 = [v110 copy];

            v112 = [v111 countByEnumeratingWithState:&v276 objects:v309 count:16];
            if (v112)
            {
              v113 = v112;
              v114 = *v277;
              do
              {
                for (k = 0; k != v113; ++k)
                {
                  if (*v277 != v114)
                  {
                    objc_enumerationMutation(v111);
                  }

                  v116 = *(*(&v276 + 1) + 8 * k);
                  if ([v116 requiresMakoSupport])
                  {
                    [v107 removeObject:v116];
                  }
                }

                v113 = [v111 countByEnumeratingWithState:&v276 objects:v309 count:16];
              }

              while (v113);
            }
          }
        }

        v117 = [v242 mutableCopy];
        [v107 removeObjectsInArray:v242];
        if (([v4 hmd_isForRemoteGatewayCoder] & 1) == 0)
        {
          v118 = [(HMDHome *)v41 usersPendingUserManagementOperations];
          [v107 removeObjectsInArray:v118];

          v119 = [(HMDHome *)v41 usersPendingUserManagementOperations];
          [v117 removeObjectsInArray:v119];
        }

        v274 = 0u;
        v275 = 0u;
        v272 = 0u;
        v273 = 0u;
        v120 = v117;
        v121 = [v120 countByEnumeratingWithState:&v272 objects:v308 count:16];
        if (v121)
        {
          v122 = v121;
          v123 = *v273;
          do
          {
            for (m = 0; m != v122; ++m)
            {
              if (*v273 != v123)
              {
                objc_enumerationMutation(v120);
              }

              v125 = [*(*(&v272 + 1) + 8 * m) legacyUser];
              [v107 addObject:v125];
            }

            v122 = [v120 countByEnumeratingWithState:&v272 objects:v308 count:16];
          }

          while (v122);
        }

        v126 = [v107 copy];
        [v4 encodeObject:v126 forKey:@"users"];

        v127 = [v120 copy];
        [v4 encodeObject:v127 forKey:@"residentDevices"];
      }

      else
      {
        if (![v4 hmd_isForRemoteTransport])
        {
LABEL_152:

          goto LABEL_153;
        }

        v107 = [MEMORY[0x277CBEB18] array];
        v128 = [(HMDHome *)v41 owner];

        if (v128)
        {
          v129 = [(HMDHome *)v41 owner];
          [v107 addObject:v129];

          v130 = [v4 hmd_user];

          if (v130)
          {
            v131 = [v4 hmd_user];
            [v107 addObject:v131];
          }
        }

        v270 = 0u;
        v271 = 0u;
        v268 = 0u;
        v269 = 0u;
        v132 = v242;
        v133 = [v132 countByEnumeratingWithState:&v268 objects:v307 count:16];
        if (v133)
        {
          v134 = v133;
          v135 = *v269;
          do
          {
            for (n = 0; n != v134; ++n)
            {
              if (*v269 != v135)
              {
                objc_enumerationMutation(v132);
              }

              v137 = [*(*(&v268 + 1) + 8 * n) legacyUser];
              [v107 addObject:v137];
            }

            v134 = [v132 countByEnumeratingWithState:&v268 objects:v307 count:16];
          }

          while (v134);
        }

        v138 = [v107 copy];
        [v4 encodeObject:v138 forKey:@"users"];

        [v4 encodeObject:v132 forKey:@"residentDevices"];
        v252 = v107;
        if ([v4 hmd_isForRemoteUserAdministrator])
        {
          v139 = MEMORY[0x277CBEB18];
          v140 = [(HMDHome *)v41 users];
          v141 = [v139 arrayWithCapacity:{objc_msgSend(v140, "count")}];

          v266 = 0u;
          v267 = 0u;
          v264 = 0u;
          v265 = 0u;
          v142 = [(HMDHome *)v41 users];
          v143 = [v142 countByEnumeratingWithState:&v264 objects:v306 count:16];
          if (v143)
          {
            v144 = v143;
            v145 = *v265;
            do
            {
              for (ii = 0; ii != v144; ++ii)
              {
                if (*v265 != v145)
                {
                  objc_enumerationMutation(v142);
                }

                v147 = *(*(&v264 + 1) + 8 * ii);
                if (([v147 isRemoteGateway] & 1) == 0 && (objc_msgSend(v147, "privilege") == 4 || !objc_msgSend(v147, "privilege")))
                {
                  if (![v147 requiresMakoSupport] || (objc_msgSend(v4, "hmd_supportedFeatures"), v148 = objc_claimAutoreleasedReturnValue(), v149 = objc_msgSend(v148, "containsObject:", &unk_2866278C8), v148, v149))
                  {
                    [v141 addObject:v147];
                  }
                }
              }

              v144 = [v142 countByEnumeratingWithState:&v264 objects:v306 count:16];
            }

            while (v144);
          }

          v150 = [v141 copy];
          [v4 encodeObject:v150 forKey:@"HM.sharedUsers"];

          v5 = v241;
          v41 = v250;
          v107 = v252;
        }

        v151 = objc_autoreleasePoolPush();
        v152 = v41;
        v153 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v153, OS_LOG_TYPE_INFO))
        {
          v154 = HMFGetLogIdentifier();
          v155 = [(HMDHome *)v152 users];
          v156 = [v4 hmd_user];
          *buf = 138543874;
          v298 = v154;
          v299 = 2112;
          v300 = v155;
          v301 = 2112;
          v302 = v156;
          _os_log_impl(&dword_2531F8000, v153, OS_LOG_TYPE_INFO, "%{public}@encode users: %@, coder username: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v151);
        v262 = 0u;
        v263 = 0u;
        v260 = 0u;
        v261 = 0u;
        v120 = [(HMDHome *)v152 users];
        v254 = [v120 countByEnumeratingWithState:&v260 objects:v305 count:16];
        if (v254)
        {
          v157 = *v261;
          v247 = v120;
          v249 = *v261;
          do
          {
            for (jj = 0; jj != v254; ++jj)
            {
              if (*v261 != v157)
              {
                objc_enumerationMutation(v120);
              }

              v159 = *(*(&v260 + 1) + 8 * jj);
              v160 = [v4 hmd_user];
              v161 = [v159 isEqual:v160];

              if (v161)
              {
                v162 = objc_autoreleasePoolPush();
                v163 = v152;
                v164 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v164, OS_LOG_TYPE_INFO))
                {
                  HMFGetLogIdentifier();
                  v165 = v248 = v162;
                  v166 = [(HMDHome *)v163 users];
                  [v4 hmd_user];
                  v167 = v152;
                  v169 = v168 = v4;
                  v170 = [v159 presenceAuthStatus];
                  *buf = 138544130;
                  v298 = v165;
                  v299 = 2112;
                  v300 = v166;
                  v301 = 2112;
                  v302 = v169;
                  v303 = 2112;
                  v304 = v170;
                  _os_log_impl(&dword_2531F8000, v164, OS_LOG_TYPE_INFO, "%{public}@encode users: %@, coder username: %@, %@", buf, 0x2Au);

                  v107 = v252;
                  v4 = v168;
                  v152 = v167;

                  v120 = v247;
                  v162 = v248;
                }

                objc_autoreleasePoolPop(v162);
                v171 = [v159 presenceAuthStatus];
                [v171 addToCoder:v4];

                v157 = v249;
                v41 = v250;
              }
            }

            v254 = [v120 countByEnumeratingWithState:&v260 objects:v305 count:16];
          }

          while (v254);
          v5 = v241;
        }
      }

      v60 = v245;
      goto LABEL_150;
    }

    v251 = [MEMORY[0x277CBEB18] array];
    if (v244)
    {
      v253 = v4;
      v82 = [(HMDHome *)v41 owner];
      v83 = [(HMDHome *)v41 isOwnerUser];
      v284 = 0u;
      v285 = 0u;
      v286 = 0u;
      v287 = 0u;
      v84 = [(HMDHome *)v41 users];
      v85 = [v84 countByEnumeratingWithState:&v284 objects:v311 count:16];
      if (v85)
      {
        v86 = v85;
        v87 = *v285;
        do
        {
          for (kk = 0; kk != v86; ++kk)
          {
            if (*v285 != v87)
            {
              objc_enumerationMutation(v84);
            }

            v89 = *(*(&v284 + 1) + 8 * kk);
            if (!v83 || ([*(*(&v284 + 1) + 8 * kk) isEqual:v82] & 1) == 0)
            {
              v90 = [v89 userID];
              if (!v90)
              {
                continue;
              }

              v91 = v90;
              v92 = [v89 isRemoteGateway];

              if (v92)
              {
                continue;
              }
            }

            [v251 addObject:v89];
          }

          v86 = [v84 countByEnumeratingWithState:&v284 objects:v311 count:16];
        }

        while (v86);
      }

      v41 = v250;
      v4 = v253;
      v5 = v241;
      v60 = v245;
      if (![(HMDHome *)v250 isAdminUser])
      {
        goto LABEL_146;
      }

      v93 = MEMORY[0x277CBEB18];
      v94 = [(HMDHome *)v250 outgoingInvitations];
      v95 = [v93 arrayWithCapacity:{objc_msgSend(v94, "count")}];

      v282 = 0u;
      v283 = 0u;
      v280 = 0u;
      v281 = 0u;
      v96 = [(HMDHome *)v250 outgoingInvitations];
      v97 = [v96 countByEnumeratingWithState:&v280 objects:v310 count:16];
      if (v97)
      {
        v98 = v97;
        v99 = *v281;
        do
        {
          for (mm = 0; mm != v98; ++mm)
          {
            if (*v281 != v99)
            {
              objc_enumerationMutation(v96);
            }

            v101 = *(*(&v280 + 1) + 8 * mm);
            v102 = [v101 user];
            v103 = [v102 isRemoteGateway];

            if ((v103 & 1) == 0)
            {
              [v95 addObject:v101];
            }
          }

          v98 = [v96 countByEnumeratingWithState:&v280 objects:v310 count:16];
        }

        while (v98);
      }

      v104 = [v95 copy];
      [v253 encodeObject:v104 forKey:@"HM.invitations"];

      v5 = v241;
    }

    else
    {
      [(HMDHome *)v41 isAdminUser];
    }

    v60 = v245;
LABEL_146:
    v107 = v251;
    v172 = [v251 copy];
    [v4 encodeObject:v172 forKey:@"users"];

    [v4 encodeBool:-[HMDHome isAdminUser](v41 forKey:{"isAdminUser"), @"isAdminUser"}];
    [v4 encodeBool:-[HMDHome isOwnerUser](v41 forKey:{"isOwnerUser"), @"HM.isOwnerUser"}];
    v173 = [(HMDHome *)v41 isAccessToHomeAllowed];
    [v4 encodeBool:v173 forKey:*MEMORY[0x277CD0018]];
    if ((v173 & 1) == 0)
    {
      v174 = [(HMDHome *)v41 accessNotAllowedReasonCode];
      [v4 encodeInteger:v174 forKey:*MEMORY[0x277CCFD90]];
    }

    v175 = [(HMDHome *)v41 overriddenHomeAccessControl];

    if (!v175)
    {
      goto LABEL_151;
    }

    v120 = [(HMDHome *)v41 overriddenHomeAccessControl];
    v176 = [v120 unsignedIntegerValue];
    [v4 encodeInteger:v176 forKey:*MEMORY[0x277CCFD88]];
LABEL_150:

LABEL_151:
    goto LABEL_152;
  }

LABEL_153:
  if ((v60 & 0x9FD1) != 0)
  {
    [(HMDHome *)v41 _encodeObjectsWithAccessoriesWithCoder:v4];
  }

  v177 = [(HMDHome *)v41 roomForEntireHome];
  [v4 encodeObject:v177 forKey:@"roomForEntireHome"];

  if ((v60 & 5) != 0 && ([v4 hmd_isForRemoteGatewayCoder] & 1) == 0)
  {
    v178 = [(HMDHome *)v41 rooms];
    [v4 encodeObject:v178 forKey:@"rooms"];

    v179 = [(HMDHome *)v41 zones];
    [v4 encodeObject:v179 forKey:@"zones"];
  }

  if ((v60 & 0x801) != 0)
  {
    if (v5)
    {
      if (!v244)
      {
        goto LABEL_164;
      }

      v180 = [(HMDHome *)v41 residentDeviceManager];
      v181 = [v180 residentDevices];

      v182 = @"residentDevices";
    }

    else
    {
      v183 = [(HMDHome *)v41 residentDeviceManager];
      [v4 encodeObject:v183 forKey:@"HM.residentDeviceManager"];

      v184 = [(HMDHome *)v41 enabledResidents];
      v185 = [v184 na_filter:&__block_literal_global_1782];

      [v4 encodeInteger:objc_msgSend(v185 forKey:{"count"), @"HMD.nonIPadResidentDeviceCount"}];
      v181 = [(HMDHome *)v41 primaryNetworkRouterManagingDeviceUUID];
      v182 = @"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey";
    }

    [v4 encodeObject:v181 forKey:v182];
  }

LABEL_164:
  if ((v60 & 0x85D1) != 0 && (![v4 hmd_isForXPCTransport] || objc_msgSend(v4, "hmd_isForXPCTransportEntitledForSPIAccess")))
  {
    v186 = [(HMDHome *)v41 minimumMediaUserPrivilege];
    [v4 encodeInteger:v186 forKey:*MEMORY[0x277CD03F8]];
    v187 = [(HMDHome *)v41 isMediaPeerToPeerEnabled];
    [v4 encodeBool:v187 forKey:*MEMORY[0x277CD0410]];
    if (([v4 hmd_isForNonAdminSharedUser] & 1) == 0)
    {
      v188 = [(HMDHome *)v41 mediaPassword];
      [v4 encodeObject:v188 forKey:*MEMORY[0x277CD0400]];
    }
  }

  if ((v60 & 0x11) != 0 && (![v4 hmd_isForXPCTransport] || objc_msgSend(v4, "hmd_isForXPCTransportEntitledForSPIAccess")))
  {
    v189 = [(HMDHome *)v41 isAutomaticSoftwareUpdateEnabled];
    [v4 encodeBool:v189 forKey:*MEMORY[0x277CCFE80]];
    v190 = [(HMDHome *)v41 isAutomaticThirdPartyAccessorySoftwareUpdateEnabled];
    [v4 encodeBool:v190 forKey:*MEMORY[0x277CCFE88]];
  }

  v191 = [(HMDHome *)v41 matterFabricID];
  [v4 encodeObject:v191 forKey:@"HM.matterFabricID"];

  if (v60)
  {
    if (v246)
    {
      v192 = [(HMDHome *)v41 presenceMonitor];
      [v4 encodeObject:v192 forKey:@"kHMDHomePresenceMonitorCodingKey"];

      v193 = [(HMDHome *)v41 unfilteredThreadNetworkID];
      [v4 encodeObject:v193 forKey:@"HMHM.threadNetworkID"];
    }

    if ([v4 hmd_isForRemoteGatewayCoder])
    {
      if (!v5)
      {
        goto LABEL_184;
      }
    }

    else
    {
      if ((v5 & 1) == 0)
      {
        v197 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome allowsRemoteAccess](v41, "allowsRemoteAccess")}];
        [v4 encodeObject:v197 forKey:@"HM.allowsRemoteAccess"];

        v198 = [(HMDHome *)v41 networkProtectionGroupRegistry];
        v199 = [v198 persistedGroups];
        [v4 encodeObject:v199 forKey:*MEMORY[0x277CCFDB0]];

LABEL_184:
        v196 = [(HMDHome *)v41 appData];
        [v4 encodeObject:v196 forKey:@"HM.appDataRepository"];
LABEL_185:

        if (v246)
        {
          v200 = [(HMDHome *)v41 removedUsers];
          [v4 encodeObject:v200 forKey:@"HM.removedUsersCodingKey"];
        }

        else if (!v243)
        {
          goto LABEL_189;
        }

        v201 = [(HMDHome *)v41 presenceAuthStatus];
        [v201 addToCoder:v4];

        v202 = [(HMDHome *)v41 presenceComputeStatus];
        [v202 addToCoder:v4];

LABEL_189:
        if ((v246 | v243))
        {
          if (!isWatch() && ([v4 hmd_isForRemoteTransportOnSameAccount] & 1) == 0)
          {
            v203 = [(HMDHome *)v41 notificationRegistry];
            [v4 encodeObject:v203 forKey:@"characteristicNotificationRegistryCodingKey"];
          }

          if (!isWatch() && ([v4 hmd_isForRemoteGatewayCoder] & 1) == 0)
          {
            v204 = MEMORY[0x277CBEB18];
            v205 = [(HMDHome *)v41 outgoingInvitations];
            v206 = [v204 arrayWithArray:v205];

            if ([v4 hmd_isForRemoteTransportOnSameAccount])
            {
              v207 = [v4 hmd_supportedFeatures];
              v208 = [v207 containsObject:&unk_2866278C8];

              if ((v208 & 1) == 0)
              {
                v209 = v41;
                v210 = v5;
                v258 = 0u;
                v259 = 0u;
                v256 = 0u;
                v257 = 0u;
                v211 = [(HMDHome *)v209 outgoingInvitations];
                v212 = [v211 countByEnumeratingWithState:&v256 objects:v296 count:16];
                if (v212)
                {
                  v213 = v212;
                  v214 = *v257;
                  do
                  {
                    for (nn = 0; nn != v213; ++nn)
                    {
                      if (*v257 != v214)
                      {
                        objc_enumerationMutation(v211);
                      }

                      v216 = *(*(&v256 + 1) + 8 * nn);
                      v217 = [v216 user];
                      if ([v217 requiresMakoSupport])
                      {
                        [v206 removeObject:v216];
                      }
                    }

                    v213 = [v211 countByEnumeratingWithState:&v256 objects:v296 count:16];
                  }

                  while (v213);
                }

                v5 = v210;
                v41 = v250;
              }
            }

            v218 = [v206 copy];
            [v4 encodeObject:v218 forKey:@"HM.invitations"];
          }
        }

        if (![v4 hmd_isForXPCTransport] || objc_msgSend(v4, "hmd_isForXPCTransportEntitledForSPIAccess"))
        {
          v219 = [(HMDHome *)v41 protectionMode];
          [v4 encodeInteger:v219 forKey:*MEMORY[0x277CD0458]];
        }

        if ([v4 hmd_isForXPCTransport])
        {
          if ([v4 hmd_isForXPCTransportEntitledForSPIAccess])
          {
            v220 = [(HMDHome *)v41 networkRouterSupportDisableReason];
            [v4 encodeInteger:v220 forKey:*MEMORY[0x277CD0460]];
          }

          v221 = [(HMDHome *)v41 networkRouterSupport];
          [v4 encodeBool:(v221 >> 2) & 1 forKey:*MEMORY[0x277CCFE10]];
        }

        v222 = [(HMDHome *)v41 threadNetworkID];
        if (v222 && [v4 hmd_isForXPCTransport])
        {
          v223 = [v4 hmd_isForXPCTransportEntitledForSPIAccess];

          if (!v223)
          {
            goto LABEL_220;
          }

          v222 = [(HMDHome *)v41 threadNetworkID];
          [v4 encodeObject:v222 forKey:*MEMORY[0x277CD0628]];
        }

LABEL_220:
        if (([v4 hmd_isForXPCTransport] & 1) == 0)
        {
          v224 = [(HMDHome *)v41 activeNetworkRouterUUID];
          v225 = [v224 UUIDString];
          [v4 encodeObject:v225 forKey:@"HMHM.activeNetworkRouter"];

          v226 = [(HMDHome *)v41 minimumNetworkRouterSupportHomeKitVersion];
          v227 = [v226 versionString];
          [v4 encodeObject:v227 forKey:@"HMHM.minimumNetworkRouterSupportHomeKitVersion"];

          v228 = [(HMDHome *)v41 minHomeKitVersionForAccessoryNetworkProtectionChange];
          v229 = [v228 versionString];
          [v4 encodeObject:v229 forKey:@"HMHM.minHomeKitVersionForAccessoryNetworkProtectionChangeCodingKey"];
        }

        if (v5)
        {
          if (![v4 hmd_isForXPCTransportEntitledForSPIAccess])
          {
LABEL_230:
            if ((v246 | v243))
            {
              v238 = [(HMDHome *)v41 chipStorage];
              [v4 encodeObject:v238 forKey:@"HMHM.chipStorage"];
            }

            if (!-[HMDHome isOwnerUser](v41, "isOwnerUser") && (([v4 hmd_isForLocalStore] & 1) != 0 || objc_msgSend(v4, "hmd_isForRemoteTransportOnSameAccount")))
            {
              v239 = [(HMDHome *)v41 sharedHomeSourceVersion];
              [v4 encodeObject:v239 forKey:@"kHomeKitVersionStringKey"];
            }

            goto LABEL_236;
          }

          v230 = [(HMDHome *)v41 personManagerSettings];
          [v4 encodeObject:v230 forKey:*MEMORY[0x277CD04A0]];

          v231 = [(HMDHome *)v41 personManagerZoneUUID];
          v232 = *MEMORY[0x277CD04B8];
        }

        else
        {
          v233 = [(HMDHome *)v41 personManagerSettings];
          [v4 encodeObject:v233 forKey:*MEMORY[0x277CD04A0]];

          v234 = [(HMDHome *)v41 personManagerZoneUUID];
          [v4 encodeObject:v234 forKey:*MEMORY[0x277CD04B8]];

          v235 = [(HMDHome *)v41 naturalLightingContext];
          [v4 encodeObject:v235 forKey:@"HM.nlcck"];

          if (([v4 hmd_isForLocalStore] & 1) != 0 || objc_msgSend(v4, "hmd_isForRemoteUserAdministrator"))
          {
            v236 = [(HMDHome *)v41 labelsByAccessCode];
            [v4 encodeObject:v236 forKey:@"HMDHomeLabelsByAccessCodeCodingKey"];

            v237 = [(HMDHome *)v41 removedUserInfoByAccessCode];
            [v4 encodeObject:v237 forKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"];
          }

          v231 = [(HMDHome *)v41 nfcReaderKey];
          v232 = @"HMDHomeNFCReaderKeyCodingKey";
        }

        [v4 encodeObject:v231 forKey:v232];

        goto LABEL_230;
      }

      if (v244)
      {
        v194 = [(HMDHome *)v41 networkProtectionGroupRegistry];
        v195 = [v194 activeGroups];
        [v4 encodeObject:v195 forKey:*MEMORY[0x277CCFDB0]];
      }
    }

    v196 = [(HMDHome *)v41 appData];
    [v196 encodeForXPCTransportWithCoder:v4 key:@"HM.appData"];
    goto LABEL_185;
  }

LABEL_236:

  v240 = *MEMORY[0x277D85DE8];
}

BOOL __28__HMDHome__encodeWithCoder___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 device];
  v3 = [v2 productInfo];
  v4 = [v3 productClass] != 3;

  return v4;
}

- (void)encodeWithCoder:(id)a3
{
  v5 = a3;
  v4 = objc_autoreleasePoolPush();
  [(HMDHome *)self _encodeWithCoder:v5];
  objc_autoreleasePoolPop(v4);
}

- (id)_initWithCoder:(id)a3
{
  v372[2] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"homeName"];
  v6 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"homeUUID"];
  v7 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v6];
  v8 = objc_alloc_init(HMDHomeDefaultDataSource);
  v312 = v7;
  v9 = [(HMDHome *)self initWithName:v5 uuid:v7 defaultRoomUUID:0 owner:0 homeManager:0 presenceAuth:0 dataSource:v8];

  if (!v9)
  {
    goto LABEL_213;
  }

  v309 = v6;
  v310 = v5;
  v10 = [HMDHome zoneIDFromHomeUUID:v9->_uuid];
  zoneID = v9->_zoneID;
  v9->_zoneID = v10;

  v316 = v9;
  v12 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"creationDate"];
  creationDate = v9->_creationDate;
  v9->_creationDate = v12;

  v14 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"firstHAPAccessoryAddedDate"];
  firstHAPAccessoryAddedDate = v9->_firstHAPAccessoryAddedDate;
  v9->_firstHAPAccessoryAddedDate = v14;

  v16 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"homeAdmin"];
  ownerName = v9->_ownerName;
  v9->_ownerName = v16;

  v18 = [HMDHomeManager isThisDeviceAdminOfHome:v9];
  v9->_ownerUser = v18;
  v313 = v4;
  if (v18)
  {
    v19 = [(HMDHome *)v9 localCapabilitiesDataSource];
    v20 = [v19 isResidentCapable];

    v9 = v316;
    if (v20)
    {
      v21 = [v4 decodeObjectOfClass:objc_opt_class() forKey:@"kHMDHomePresenceMonitorCodingKey"];
      v22 = v21;
      if (!v21)
      {
        v20 = [(HMDHome *)v316 dataSource];
        v22 = [v20 makeHomePresenceMonitor];
      }

      objc_storeStrong(&v316->_presenceMonitor, v22);
      if (!v21)
      {
      }

      v23 = objc_alloc_init(HMDHomePeriodicReader);
      periodicReader = v316->_periodicReader;
      v316->_periodicReader = v23;

      v4 = v313;
      v9 = v316;
    }
  }

  v25 = [[HMDHomeAdministratorHandler alloc] initWithHome:v9];
  administratorHandler = v9->_administratorHandler;
  v9->_administratorHandler = v25;

  if (v9->_ownerUser || isWatch())
  {
    sharedHomeUpdateHandler = v9->_sharedHomeUpdateHandler;
    v9->_sharedHomeUpdateHandler = 0;
  }

  else
  {
    v129 = objc_alloc_init(HMDSharedHomeUpdateHandler);
    v130 = v9->_sharedHomeUpdateHandler;
    v9->_sharedHomeUpdateHandler = v129;

    [(HMDSharedHomeUpdateHandler *)v9->_sharedHomeUpdateHandler configureWithHome:v9];
  }

  v28 = [v4 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD2448]];
  mediaSystemController = v28;
  v30 = v4;
  if (!v28)
  {
    mediaSystemController = v316->_mediaSystemController;
  }

  objc_storeStrong(&v316->_mediaSystemController, mediaSystemController);

  rooms = v316->_rooms;
  v32 = MEMORY[0x277CBEB98];
  v372[0] = objc_opt_class();
  v372[1] = objc_opt_class();
  v33 = [MEMORY[0x277CBEA60] arrayWithObjects:v372 count:2];
  v34 = [v32 setWithArray:v33];
  v35 = [v30 decodeObjectOfClasses:v34 forKey:@"rooms"];
  [(NSMutableArray *)rooms setArray:v35];

  zones = v316->_zones;
  v37 = MEMORY[0x277CBEB98];
  v371[0] = objc_opt_class();
  v371[1] = objc_opt_class();
  v38 = [MEMORY[0x277CBEA60] arrayWithObjects:v371 count:2];
  v39 = [v37 setWithArray:v38];
  v40 = [v30 decodeObjectOfClasses:v39 forKey:@"zones"];
  [(NSMutableArray *)zones setArray:v40];

  if ([v30 containsValueForKey:@"accessories"])
  {
    v41 = +[HMDHome supportedAccessoryClasses];
    v42 = [v30 decodeObjectOfClasses:v41 forKey:@"accessories"];
    [(HMDHome *)v316 _addAccessories:v42];
  }

  if ([v30 containsValueForKey:@"accessories.airplay"])
  {
    v43 = +[HMDHome supportedAccessoryClasses];
    v44 = [v30 decodeObjectOfClasses:v43 forKey:@"accessories.airplay"];
    [(HMDHome *)v316 _addAccessories:v44];
  }

  if ([v30 containsValueForKey:@"accessories.homepod"])
  {
    v45 = +[HMDHome supportedAccessoryClasses];
    v46 = [v30 decodeObjectOfClasses:v45 forKey:@"accessories.homepod"];
    [(HMDHome *)v316 _addAccessories:v46];
  }

  if ([v30 containsValueForKey:@"accessories.homepod_6_1"])
  {
    v47 = +[HMDHome supportedAccessoryClasses];
    v48 = [v30 decodeObjectOfClasses:v47 forKey:@"accessories.homepod_6_1"];
    [(HMDHome *)v316 _addAccessories:v48];
  }

  if ([v30 containsValueForKey:@"HM.AppleMediaAccessorySensor"])
  {
    v49 = +[HMDHome supportedAccessoryClasses];
    v50 = [v30 decodeObjectOfClasses:v49 forKey:@"HM.AppleMediaAccessorySensor"];
    [(HMDHome *)v316 _addAccessories:v50];
  }

  v51 = *MEMORY[0x277CD0450];
  if ([v30 containsValueForKey:*MEMORY[0x277CD0450]])
  {
    -[HMDHome setMultiUserEnabled:](v316, "setMultiUserEnabled:", [v30 decodeBoolForKey:v51]);
  }

  v316->_soundCheckEnabled = [v30 decodeBoolForKey:*MEMORY[0x277CD05F0]];
  v52 = [v30 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD05E0]];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v53 = v52;
  }

  else
  {
    v53 = 0;
  }

  v54 = v53;

  v316->_siriPhraseOptions = [v54 unsignedIntegerValue];
  v316->_locationServicesEnabled = [v30 decodeBoolForKey:*MEMORY[0x277CD0050]];
  v316->_didOnboardLocationServices = [v30 decodeBoolForKey:*MEMORY[0x277CCFEB0]];
  v55 = *MEMORY[0x277CCFFD0];
  if ([v30 containsValueForKey:*MEMORY[0x277CCFFD0]])
  {
    -[HMDHome setHasAnyUserAcknowledgedCameraRecordingOnboarding:](v316, "setHasAnyUserAcknowledgedCameraRecordingOnboarding:", [v30 decodeBoolForKey:v55]);
  }

  v56 = *MEMORY[0x277CCFFD8];
  if ([v30 containsValueForKey:*MEMORY[0x277CCFFD8]])
  {
    v316->_hasOnboardedForAccessCode = [v30 decodeBoolForKey:v56];
  }

  v57 = *MEMORY[0x277CCFFE0];
  if ([v30 containsValueForKey:*MEMORY[0x277CCFFE0]])
  {
    v316->_hasOnboardedForWalletKey = [v30 decodeBoolForKey:v57];
  }

  else
  {
    v316->_shouldEncodeHasOnboardedForWalletKey = 0;
  }

  serviceGroups = v316->_serviceGroups;
  v59 = MEMORY[0x277CBEB98];
  v370[0] = objc_opt_class();
  v370[1] = objc_opt_class();
  v60 = [MEMORY[0x277CBEA60] arrayWithObjects:v370 count:2];
  v61 = [v59 setWithArray:v60];
  v62 = [v30 decodeObjectOfClasses:v61 forKey:*MEMORY[0x277CD25E8]];
  [(NSMutableArray *)serviceGroups setArray:v62];

  v63 = MEMORY[0x277CBEB98];
  v369[0] = objc_opt_class();
  v369[1] = objc_opt_class();
  v64 = [MEMORY[0x277CBEA60] arrayWithObjects:v369 count:2];
  v65 = [v63 setWithArray:v64];

  actionSets = v316->_actionSets;
  v67 = [v30 decodeObjectOfClasses:v65 forKey:@"actionSets"];
  [(NSMutableArray *)actionSets setArray:v67];

  triggerOwnedActionSets = v316->_triggerOwnedActionSets;
  v69 = [v30 decodeObjectOfClasses:v65 forKey:@"HM.triggerOwnedActionSets"];
  [(NSMutableArray *)triggerOwnedActionSets setArray:v69];

  v70 = [MEMORY[0x277CBEB18] array];
  v308 = v65;
  v71 = [v30 decodeObjectOfClasses:v65 forKey:@"builtinActionSets"];
  [v70 setArray:v71];

  v307 = v70;
  if ([v70 count])
  {
    [(NSMutableArray *)v316->_actionSets addObjectsFromArray:v70];
  }

  else if ([(HMDHome *)v316 isOwnerUser])
  {
    v72 = objc_autoreleasePoolPush();
    v73 = v316;
    v74 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v74, OS_LOG_TYPE_INFO))
    {
      v75 = HMFGetLogIdentifier();
      v76 = [(NSMutableArray *)v316->_actionSets count];
      *buf = 138543618;
      v366 = v75;
      v367 = 2048;
      v368 = v76;
      _os_log_impl(&dword_2531F8000, v74, OS_LOG_TYPE_INFO, "%{public}@init: %ld user-defined actionSets; no builtin actionSets - creating....", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v72);
    v77 = v316->_actionSets;
    v78 = [(HMDHome *)v73 _createBuiltinActionSets];
    [(NSMutableArray *)v77 addObjectsFromArray:v78];
  }

  removedUsers = v316->_removedUsers;
  v80 = MEMORY[0x277CBEB98];
  v364[0] = objc_opt_class();
  v364[1] = objc_opt_class();
  v81 = [MEMORY[0x277CBEA60] arrayWithObjects:v364 count:2];
  v82 = [v80 setWithArray:v81];
  v83 = v313;
  v84 = [v313 decodeObjectOfClasses:v82 forKey:@"HM.removedUsersCodingKey"];
  [(NSMutableArray *)removedUsers setArray:v84];

  v321 = [MEMORY[0x277CBEB58] set];
  v85 = [MEMORY[0x277CBEB58] set];
  if ([v313 containsValueForKey:@"residentDevices"])
  {
    v86 = MEMORY[0x277CBEB98];
    v363[0] = objc_opt_class();
    v363[1] = objc_opt_class();
    v87 = [MEMORY[0x277CBEA60] arrayWithObjects:v363 count:2];
    v88 = [v86 setWithArray:v87];
    v89 = [v313 decodeObjectOfClasses:v88 forKey:@"residentDevices"];
    [v321 addObjectsFromArray:v89];

    v83 = v313;
  }

  if ([v83 containsValueForKey:@"HM.sharedUsers"])
  {
    v90 = MEMORY[0x277CBEB98];
    v362[0] = objc_opt_class();
    v362[1] = objc_opt_class();
    v91 = [MEMORY[0x277CBEA60] arrayWithObjects:v362 count:2];
    v92 = [v90 setWithArray:v91];
    v93 = [v83 decodeObjectOfClasses:v92 forKey:@"HM.sharedUsers"];
    [v85 addObjectsFromArray:v93];
  }

  v94 = MEMORY[0x277CBEB98];
  v361[0] = objc_opt_class();
  v361[1] = objc_opt_class();
  v95 = [MEMORY[0x277CBEA60] arrayWithObjects:v361 count:2];
  v96 = [v94 setWithArray:v95];
  v97 = [v83 decodeObjectOfClasses:v96 forKey:@"users"];
  [v85 addObjectsFromArray:v97];

  v344 = 0u;
  v345 = 0u;
  v342 = 0u;
  v343 = 0u;
  obj = v85;
  v98 = [obj countByEnumeratingWithState:&v342 objects:v360 count:16];
  if (v98)
  {
    v99 = v98;
    v317 = *v343;
    do
    {
      for (i = 0; i != v99; ++i)
      {
        if (*v343 != v317)
        {
          objc_enumerationMutation(obj);
        }

        v101 = *(*(&v342 + 1) + 8 * i);
        v338 = 0u;
        v339 = 0u;
        v340 = 0u;
        v341 = 0u;
        v102 = v321;
        v103 = [v102 countByEnumeratingWithState:&v338 objects:v359 count:16];
        if (v103)
        {
          v104 = v103;
          v105 = *v339;
          while (2)
          {
            for (j = 0; j != v104; ++j)
            {
              if (*v339 != v105)
              {
                objc_enumerationMutation(v102);
              }

              v107 = [*(*(&v338 + 1) + 8 * j) userID];
              v108 = [v101 userID];
              v109 = [v107 isEqualToString:v108];

              if (v109)
              {

                goto LABEL_61;
              }
            }

            v104 = [v102 countByEnumeratingWithState:&v338 objects:v359 count:16];
            if (v104)
            {
              continue;
            }

            break;
          }
        }

        [(NSMutableArray *)v316->_users addObject:v101];
LABEL_61:
        ;
      }

      v99 = [obj countByEnumeratingWithState:&v342 objects:v360 count:16];
    }

    while (v99);
  }

  users = v316->_users;
  v111 = [v321 allObjects];
  [(NSMutableArray *)users addObjectsFromArray:v111];

  v112 = objc_autoreleasePoolPush();
  v113 = v316;
  v114 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v114, OS_LOG_TYPE_DEBUG))
  {
    v115 = HMFGetLogIdentifier();
    v116 = v316->_users;
    *buf = 138543618;
    v366 = v115;
    v367 = 2112;
    v368 = v116;
    _os_log_impl(&dword_2531F8000, v114, OS_LOG_TYPE_DEBUG, "%{public}@Received users in the home data: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v112);
  v117 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"roomForEntireHome"];
  v118 = HMDDefaultRoomName();
  v311 = v118;
  if (v117)
  {
    [(HMDRoom *)v117 setName:v118];
  }

  else
  {
    v119 = objc_autoreleasePoolPush();
    v120 = v113;
    v121 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v121, OS_LOG_TYPE_INFO))
    {
      v122 = HMFGetLogIdentifier();
      *buf = 138543362;
      v366 = v122;
      _os_log_impl(&dword_2531F8000, v121, OS_LOG_TYPE_INFO, "%{public}@Missing roomForEntireHome - creating one", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v119);
    v117 = [[HMDRoom alloc] initWithName:v311 uuid:0 home:v120];
  }

  v306 = v117;
  objc_storeStrong(v113 + 147, v117);
  if (!isWatch())
  {
    v123 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"homeLocationHandler"];
    if (v123)
    {
      objc_storeStrong(v113 + 70, v123);
    }
  }

  v124 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"homeConfigVersion"];
  v113[148] = [v124 integerValue];

  if ([v313 containsValueForKey:@"lastSyncedHomeConfigVersion"])
  {
    v125 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"lastSyncedHomeConfigVersion"];
    v113[149] = [v125 integerValue];
  }

  if (!isWatch())
  {
    v126 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"characteristicNotificationRegistryCodingKey"];
    v127 = v126;
    if (v126)
    {
      v128 = v126;
    }

    else
    {
      v128 = objc_alloc_init(HMDNotificationRegistry);
    }

    v131 = v113[154];
    v113[154] = v128;

    [v113[154] configureWithHome:v113];
  }

  if (isiOSDevice() || isTVOSDevice())
  {
    v132 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HM.allowsRemoteAccess"];
    v133 = v132;
    if (v132)
    {
      *(v113 + 306) = [v132 BOOLValue];
    }
  }

  if (!isWatch())
  {
    v134 = v113[7];
    v135 = MEMORY[0x277CBEB98];
    v358[0] = objc_opt_class();
    v358[1] = objc_opt_class();
    v136 = [MEMORY[0x277CBEA60] arrayWithObjects:v358 count:2];
    v137 = [v135 setWithArray:v136];
    v138 = [v313 decodeObjectOfClasses:v137 forKey:@"HM.invitations"];
    [v134 setArray:v138];

    v336 = 0u;
    v337 = 0u;
    v334 = 0u;
    v335 = 0u;
    v318 = [v113[7] copy];
    v139 = [v318 countByEnumeratingWithState:&v334 objects:v357 count:16];
    if (v139)
    {
      v140 = v139;
      v141 = *v335;
      do
      {
        for (k = 0; k != v140; ++k)
        {
          if (*v335 != v141)
          {
            objc_enumerationMutation(v318);
          }

          v143 = *(*(&v334 + 1) + 8 * k);
          v330 = 0u;
          v331 = 0u;
          v332 = 0u;
          v333 = 0u;
          v144 = [v143 operations];
          v145 = [v144 countByEnumeratingWithState:&v330 objects:v356 count:16];
          if (v145)
          {
            v146 = v145;
            v147 = *v331;
            do
            {
              for (m = 0; m != v146; ++m)
              {
                if (*v331 != v147)
                {
                  objc_enumerationMutation(v144);
                }

                [*(*(&v330 + 1) + 8 * m) setDelegate:v113];
              }

              v146 = [v144 countByEnumeratingWithState:&v330 objects:v356 count:16];
            }

            while (v146);
          }

          v149 = [v143 user];
          v150 = v149;
          if (v149)
          {
            v151 = v316->_users;
            v152 = [v149 userID];
            v153 = [(NSMutableArray *)v151 hmf_firstObjectWithValue:v152 forKeyPath:@"userID"];

            if (v153 && [v143 isComplete])
            {
              [v113[7] removeObject:v143];
            }

            else if ([v143 isAccepted])
            {
              [(NSMutableArray *)v316->_users addObject:v150];
              [v113[4] addObject:v150];
              [v150 setHome:v113];
            }
          }
        }

        v140 = [v318 countByEnumeratingWithState:&v334 objects:v357 count:16];
      }

      while (v140);
    }
  }

  v154 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HM.residentDeviceManager"];
  if (v154)
  {
    objc_storeStrong(v113 + 159, v154);
    [v113 _purgeResidentUsers];
  }

  v305 = v154;
  v113[171] = [v313 decodeIntegerForKey:@"HMD.nonIPadResidentDeviceCount"];
  if ([v113 isOwnerUser])
  {
    v155 = [v113 dataSource];
    v156 = [v155 makeCurrentUserWithUserPrivilege:3 home:v113];

    v157 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeOwnerUUID"];
    if (v157)
    {
      v158 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v157];
      [v156 setUUID:v158];
    }

    v303 = v157;
    v159 = [MEMORY[0x277CBEB18] array];
    v326 = 0u;
    v327 = 0u;
    v328 = 0u;
    v329 = 0u;
    v160 = v316->_users;
    v161 = [(NSMutableArray *)v160 countByEnumeratingWithState:&v326 objects:v355 count:16];
    if (v161)
    {
      v162 = v161;
      v163 = 0;
      v164 = *v327;
      v319 = v160;
      do
      {
        for (n = 0; n != v162; ++n)
        {
          if (*v327 != v164)
          {
            objc_enumerationMutation(v160);
          }

          v166 = *(*(&v326 + 1) + 8 * n);
          if ([v166 privilege] == 3 && (objc_msgSend(v166, "isRemoteGateway") & 1) == 0)
          {
            if (v163)
            {
              goto LABEL_125;
            }

            v167 = [v166 pairingUsername];
            [v156 pairingUsername];
            v168 = v159;
            v170 = v169 = v156;
            v171 = [v167 isEqual:v170];

            v156 = v169;
            v159 = v168;
            v163 = 0;

            v160 = v319;
            if (!v171)
            {
LABEL_125:
              [v159 addObject:v166];
            }

            else
            {
              v163 = v166;
            }
          }
        }

        v162 = [(NSMutableArray *)v160 countByEnumeratingWithState:&v326 objects:v355 count:16];
      }

      while (v162);
    }

    else
    {
      v163 = 0;
    }

    [(NSMutableArray *)v316->_users removeObjectsInArray:v159];
    v304 = v156;
    v302 = v159;
    v314 = v163;
    if (v163)
    {
      [v113 setOwner:v163];
    }

    else
    {
      [v113 setOwner:v156];
      [(NSMutableArray *)v316->_users addObject:v156];
      [v156 setHome:v113];
    }

    v181 = [v113 owner];
    [v113 setCurrentUser:v181];

    v182 = [MEMORY[0x277CBEB18] array];
    v322 = 0u;
    v323 = 0u;
    v324 = 0u;
    v325 = 0u;
    v320 = v316->_users;
    v183 = [(NSMutableArray *)v320 countByEnumeratingWithState:&v322 objects:v354 count:16];
    if (v183)
    {
      v184 = v183;
      v185 = *v323;
      do
      {
        for (ii = 0; ii != v184; ++ii)
        {
          if (*v323 != v185)
          {
            objc_enumerationMutation(v320);
          }

          v187 = *(*(&v322 + 1) + 8 * ii);
          v188 = [v187 pairingUsername];
          v189 = [v113 owner];
          v190 = [v189 pairingUsername];
          if ([v188 isEqual:v190])
          {
            if (![v187 privilege])
            {

              goto LABEL_155;
            }

            v191 = [v187 privilege];

            if (v191 == 4)
            {
              goto LABEL_155;
            }
          }

          else
          {
          }

          if ([v187 isValid])
          {
            continue;
          }

          v192 = objc_autoreleasePoolPush();
          v193 = v113;
          v194 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v194, OS_LOG_TYPE_DEFAULT))
          {
            v195 = HMFGetLogIdentifier();
            *buf = 138543618;
            v366 = v195;
            v367 = 2112;
            v368 = v187;
            _os_log_impl(&dword_2531F8000, v194, OS_LOG_TYPE_DEFAULT, "%{public}@Removing invalid user %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v192);
LABEL_155:
          [v182 addObject:v187];
        }

        v184 = [(NSMutableArray *)v320 countByEnumeratingWithState:&v322 objects:v354 count:16];
      }

      while (v184);
    }

    [(NSMutableArray *)v316->_users removeObjectsInArray:v182];
    v179 = v303;
    v178 = v304;
LABEL_159:

    goto LABEL_160;
  }

  v172 = [v113 currentUser];

  if (!v172)
  {
    v173 = objc_autoreleasePoolPush();
    v174 = v113;
    v175 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v175, OS_LOG_TYPE_DEFAULT))
    {
      v176 = HMFGetLogIdentifier();
      *buf = 138543362;
      v366 = v176;
      _os_log_impl(&dword_2531F8000, v175, OS_LOG_TYPE_DEFAULT, "%{public}@Current user not found, creating", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v173);
    v177 = [v174 dataSource];
    v178 = [v177 makeCurrentUserWithUserPrivilege:0 home:v174];

    if (!v178)
    {
      v298 = objc_autoreleasePoolPush();
      v299 = v174;
      v300 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v300, OS_LOG_TYPE_ERROR))
      {
        v301 = HMFGetLogIdentifier();
        *buf = 138543362;
        v366 = v301;
        _os_log_impl(&dword_2531F8000, v300, OS_LOG_TYPE_ERROR, "%{public}@Current user cannot be found or created, failing to deserialize home", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v298);
      v293 = 0;
      v6 = v309;
      goto LABEL_211;
    }

    v179 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeOwnerUUID"];
    if (v179)
    {
      v180 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v179];
      [v178 setUUID:v180];
    }

    [v174 setCurrentUser:v178];
    [(NSMutableArray *)v316->_users addObject:v178];
    [v178 setHome:v174];
    goto LABEL_159;
  }

LABEL_160:
  v196 = [MEMORY[0x277CD1F00] authWithCoder:v313];
  v197 = v113[71];
  v113[71] = v196;

  v198 = v113[71];
  v199 = [v113 currentUser];
  [v199 setPresenceAuthStatus:v198];

  v200 = [MEMORY[0x277CD1F08] computeWithCoder:v313];
  v201 = v113[72];
  v113[72] = v200;

  v202 = objc_autoreleasePoolPush();
  v203 = v113;
  v204 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v204, OS_LOG_TYPE_INFO))
  {
    v205 = HMFGetLogIdentifier();
    v206 = [v203 currentUser];
    *buf = 138543618;
    v366 = v205;
    v367 = 2112;
    v368 = v206;
    _os_log_impl(&dword_2531F8000, v204, OS_LOG_TYPE_INFO, "%{public}@Current user is %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v202);
  v207 = [MEMORY[0x277CBEB18] array];
  if ([v313 containsValueForKey:@"triggers"])
  {
    v208 = MEMORY[0x277CBEB98];
    v353[0] = objc_opt_class();
    v353[1] = objc_opt_class();
    v353[2] = objc_opt_class();
    v353[3] = objc_opt_class();
    v209 = [MEMORY[0x277CBEA60] arrayWithObjects:v353 count:4];
    v210 = [v208 setWithArray:v209];
    v211 = [v313 decodeObjectOfClasses:v210 forKey:@"triggers"];
    [v207 addObjectsFromArray:v211];
  }

  if ([v313 containsValueForKey:@"HM.triggers"])
  {
    v212 = MEMORY[0x277CBEB98];
    v352[0] = objc_opt_class();
    v352[1] = objc_opt_class();
    v352[2] = objc_opt_class();
    v352[3] = objc_opt_class();
    v213 = [MEMORY[0x277CBEA60] arrayWithObjects:v352 count:4];
    v214 = [v212 setWithArray:v213];
    v215 = [v313 decodeObjectOfClasses:v214 forKey:@"HM.triggers"];
    [v207 addObjectsFromArray:v215];
  }

  if ([v313 containsValueForKey:@"HM.homePodTriggers"])
  {
    v216 = MEMORY[0x277CBEB98];
    v351[0] = objc_opt_class();
    v351[1] = objc_opt_class();
    v217 = [MEMORY[0x277CBEA60] arrayWithObjects:v351 count:2];
    v218 = [v216 setWithArray:v217];
    v219 = [v313 decodeObjectOfClasses:v218 forKey:@"HM.homePodTriggers"];
    [v207 addObjectsFromArray:v219];
  }

  if ([v313 containsValueForKey:@"HM.sharedActivationTriggers"])
  {
    v220 = MEMORY[0x277CBEB98];
    v350[0] = objc_opt_class();
    v350[1] = objc_opt_class();
    v350[2] = objc_opt_class();
    v350[3] = objc_opt_class();
    v221 = [MEMORY[0x277CBEA60] arrayWithObjects:v350 count:4];
    v222 = [v220 setWithArray:v221];
    v223 = [v313 decodeObjectOfClasses:v222 forKey:@"HM.sharedActivationTriggers"];
    [v207 addObjectsFromArray:v223];
  }

  [v203[55] setArray:v207];
  v224 = v203[12];
  v225 = MEMORY[0x277CBEB98];
  v349[0] = objc_opt_class();
  v349[1] = objc_opt_class();
  v226 = [MEMORY[0x277CBEA60] arrayWithObjects:v349 count:2];
  v227 = [v225 setWithArray:v226];
  v228 = [v313 decodeObjectOfClasses:v227 forKey:@"HM.deviceOwnedTriggers"];
  [v224 setArray:v228];

  v229 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HM.appDataRepository"];
  v230 = v203[131];
  v203[131] = v229;

  [v203[131] updateParentUUIDIfNil:v316->_uuid];
  v231 = *MEMORY[0x277CCFE80];
  if ([v313 containsValueForKey:*MEMORY[0x277CCFE80]])
  {
    *(v203 + 128) = [v313 decodeBoolForKey:v231];
  }

  v232 = *MEMORY[0x277CCFE88];
  if ([v313 containsValueForKey:*MEMORY[0x277CCFE88]])
  {
    *(v203 + 129) = [v313 decodeBoolForKey:v232];
  }

  v233 = *MEMORY[0x277CD03F8];
  if ([v313 containsValueForKey:*MEMORY[0x277CD03F8]])
  {
    v203[17] = [v313 decodeIntegerForKey:v233];
  }

  v234 = *MEMORY[0x277CD0410];
  if ([v313 containsValueForKey:*MEMORY[0x277CD0410]])
  {
    *(v203 + 144) = [v313 decodeBoolForKey:v234];
  }

  v235 = *MEMORY[0x277CD0400];
  if ([v313 containsValueForKey:*MEMORY[0x277CD0400]])
  {
    v236 = [v313 decodeObjectOfClass:objc_opt_class() forKey:v235];
    v237 = v203[19];
    v203[19] = v236;
  }

  v238 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeKitVersionStringKey"];
  v239 = v203[166];
  v203[166] = v238;

  v240 = v203[166];
  if (v240)
  {
    v241 = +[HMDHomeKitVersion version6];
    v242 = [v240 isAtLeastVersion:v241];

    if (v242)
    {
      *(v203 + 283) = 1;
    }
  }

  v243 = *MEMORY[0x277CD0458];
  if ([v313 containsValueForKey:*MEMORY[0x277CD0458]])
  {
    v244 = [v313 decodeIntegerForKey:v243];
  }

  else
  {
    v244 = 0;
  }

  v203[42] = v244;
  v245 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.minimumNetworkRouterSupportHomeKitVersion"];
  if (v245)
  {
    v246 = [[HMDHomeKitVersion alloc] initWithString:v245];
    v247 = v203[50];
    v203[50] = v246;
  }

  v248 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.minHomeKitVersionForAccessoryNetworkProtectionChangeCodingKey"];

  if (v248)
  {
    v249 = [[HMDHomeKitVersion alloc] initWithString:v248];
    v250 = v203[51];
    v203[51] = v249;
  }

  v6 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.activeNetworkRouter"];

  if (v6)
  {
    v251 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v6];
    v252 = v203[45];
    v203[45] = v251;
  }

  if ([v313 containsValueForKey:@"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey"])
  {
    v253 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey"];
    v254 = v203[48];
    v203[48] = v253;
  }

  v255 = MEMORY[0x277CBEB98];
  v348[0] = objc_opt_class();
  v348[1] = objc_opt_class();
  v256 = [MEMORY[0x277CBEA60] arrayWithObjects:v348 count:2];
  v257 = [v255 setWithArray:v256];
  v258 = [v313 decodeObjectOfClasses:v257 forKey:*MEMORY[0x277CCFDB0]];

  v259 = [HMDAccessoryNetworkProtectionGroupRegistry alloc];
  v260 = [v203 notificationCenter];
  v261 = [(HMDAccessoryNetworkProtectionGroupRegistry *)v259 initWithHome:v203 notificationCenter:v260 persistedGroups:v258];
  v262 = v203[44];
  v203[44] = v261;

  v263 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHH.residentReachabilityContext"];
  v264 = v263;
  if (v263)
  {
    v265 = v263;
  }

  else
  {
    v265 = objc_alloc_init(HMDResidentReachabilityContext);
  }

  v266 = [[HMDResidentReachabilityNotificationManager alloc] initWithResidentReachabilityContext:v265 workQueue:v203[138]];
  v267 = v203[169];
  v203[169] = v266;

  if ([v313 containsValueForKey:@"HMHM.threadNetworkID"])
  {
    v268 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.threadNetworkID"];
    v269 = v203[56];
    v203[56] = v268;
  }

  v270 = [v313 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD04A0]];
  v271 = v203[64];
  v203[64] = v270;

  v272 = [v313 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD04B8]];
  v273 = v203[168];
  v203[168] = v272;

  v274 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HM.nlcck"];
  v275 = v203[65];
  v203[65] = v274;

  if ([v313 containsValueForKey:@"HMDHomeLabelsByAccessCodeCodingKey"])
  {
    v276 = MEMORY[0x277CBEB98];
    v347[0] = objc_opt_class();
    v347[1] = objc_opt_class();
    v277 = [MEMORY[0x277CBEA60] arrayWithObjects:v347 count:2];
    v278 = [v276 setWithArray:v277];
    v279 = [v313 decodeObjectOfClasses:v278 forKey:@"HMDHomeLabelsByAccessCodeCodingKey"];

    v280 = [v279 mutableCopy];
    v281 = v203[89];
    v203[89] = v280;
  }

  if ([v313 containsValueForKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"])
  {
    v282 = MEMORY[0x277CBEB98];
    v346[0] = objc_opt_class();
    v346[1] = objc_opt_class();
    v346[2] = objc_opt_class();
    v283 = [MEMORY[0x277CBEA60] arrayWithObjects:v346 count:3];
    v284 = [v282 setWithArray:v283];
    v285 = [v313 decodeObjectOfClasses:v284 forKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"];

    v286 = [v285 mutableCopy];
    v287 = v203[90];
    v203[90] = v286;
  }

  if ([v313 containsValueForKey:@"HMDHomeNFCReaderKeyCodingKey"])
  {
    v288 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMDHomeNFCReaderKeyCodingKey"];
    v289 = v203[59];
    v203[59] = v288;
  }

  else
  {
    *(v203 + 298) = 0;
  }

  v290 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.chipStorage"];
  if (v290)
  {
    objc_storeStrong(v203 + 173, v290);
    if (isFeatureMatterLocalFabricConfigEnabled())
    {
      v291 = [v290 fabricID];

      if (v291)
      {
        v292 = [v290 fabricID];
        [v203[175] setFabricID:v292];
      }
    }
  }

  *(v203 + 309) = [v313 decodeBoolForKey:*MEMORY[0x277CD0698]];

  v293 = 1;
LABEL_211:
  v5 = v310;

  if (!v293)
  {
    v295 = 0;
    v4 = v313;
    v294 = v316;
    goto LABEL_215;
  }

  v4 = v313;
  v9 = v316;
LABEL_213:
  v294 = v9;
  v295 = v9;
LABEL_215:

  v296 = *MEMORY[0x277D85DE8];
  return v295;
}

- (HMDHome)initWithCoder:(id)a3
{
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = [(HMDHome *)self _initWithCoder:v4];
  objc_autoreleasePoolPop(v5);

  return v6;
}

- (void)fixupHomeAfterDecoding
{
  v125 = *MEMORY[0x277D85DE8];
  v92 = +[HMDProcessInfo privateClientIdentifierSalt];
  v95 = [MEMORY[0x277CBEB38] dictionary];
  v89 = self;
  if ([(HMDHome *)self isOwnerUser])
  {
    v110 = 0u;
    v111 = 0u;
    v108 = 0u;
    v109 = 0u;
    v3 = [(HMDHome *)self accessories];
    v4 = [v3 countByEnumeratingWithState:&v108 objects:v124 count:16];
    if (v4)
    {
      v6 = v4;
      v7 = *v109;
      v8 = HMDIDSActivityMonitorHomeManagerDataSource;
      *&v5 = 138543874;
      v80 = v5;
      v84 = v3;
      v85 = *v109;
      do
      {
        v9 = 0;
        v86 = v6;
        do
        {
          if (*v109 != v7)
          {
            objc_enumerationMutation(v3);
          }

          v10 = *(*(&v108 + 1) + 8 * v9);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v11 = v10;
          }

          else
          {
            v11 = 0;
          }

          v12 = v11;

          v13 = [v12 bridge];
          v14 = v13;
          if (v12)
          {
            v15 = v13 == 0;
          }

          else
          {
            v15 = 1;
          }

          if (!v15)
          {
            v16 = [v12 uniqueIdentifier];

            if (v16)
            {
              v87 = v14;
              v88 = v9;
              v17 = MEMORY[0x277CCAD78];
              v18 = [v14 uuid];
              v19 = MEMORY[0x277CFE9F8];
              v20 = [v12 uniqueIdentifier];
              v21 = [v19 instanceIDForUniqueIdentifier:v20];
              v22 = [v21 stringValue];
              v123 = v22;
              v23 = [MEMORY[0x277CBEA60] arrayWithObjects:&v123 count:1];
              v24 = [v17 hm_deriveUUIDFromBaseUUID:v18 withSalts:v23];

              v25 = [v12 uuid];
              LOBYTE(v17) = [v24 isEqual:v25];

              if (v17)
              {

                v6 = v86;
                v14 = v87;
                v9 = v88;
                v7 = v85;
              }

              else
              {
                v36 = objc_autoreleasePoolPush();
                v37 = v89;
                v38 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v38, OS_LOG_TYPE_DEFAULT))
                {
                  v39 = HMFGetLogIdentifier();
                  v40 = [v12 uuid];
                  *buf = v80;
                  v118 = v39;
                  v119 = 2112;
                  v120 = v40;
                  v121 = 2112;
                  v122 = v24;
                  _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_DEFAULT, "%{public}@Fixup of accessory uuid from legacy archive %@ -> %@", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v36);
                v41 = [v12 uuid];
                [v12 setUuid:v24];
                v42 = [v12 appData];

                if (v42)
                {
                  v43 = [v12 uuid];
                  v44 = [v12 appData];
                  [v44 setParentUUID:v43];
                }

                v81 = v41;
                v94 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:v41 identifierSalt:v92 withSalts:{0, v80}];
                v82 = v24;
                v93 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:v24 identifierSalt:v92 withSalts:0];
                v104 = 0u;
                v105 = 0u;
                v106 = 0u;
                v107 = 0u;
                v83 = v12;
                obj = [v12 services];
                v45 = [obj countByEnumeratingWithState:&v104 objects:v116 count:16];
                if (v45)
                {
                  v46 = v45;
                  v91 = *v105;
                  do
                  {
                    for (i = 0; i != v46; ++i)
                    {
                      if (*v105 != v91)
                      {
                        objc_enumerationMutation(obj);
                      }

                      v48 = *(*(&v104 + 1) + 8 * i);
                      [v48 _recalculateUUID];
                      v49 = MEMORY[0x277CCAD78];
                      v50 = [v48 instanceID];
                      v51 = [v50 stringValue];
                      v115 = v51;
                      v52 = [MEMORY[0x277CBEA60] arrayWithObjects:&v115 count:1];
                      v53 = [v49 hm_deriveUUIDFromBaseUUID:v94 identifierSalt:v92 withSalts:v52];

                      v54 = MEMORY[0x277CCAD78];
                      v55 = [v48 instanceID];
                      v56 = [v55 stringValue];
                      v114 = v56;
                      v57 = [MEMORY[0x277CBEA60] arrayWithObjects:&v114 count:1];
                      v58 = [v54 hm_deriveUUIDFromBaseUUID:v93 identifierSalt:v92 withSalts:v57];

                      v59 = [v58 UUIDString];
                      v60 = [v53 UUIDString];
                      [v95 setObject:v59 forKey:v60];

                      v61 = [v48 appData];

                      if (v61)
                      {
                        v62 = [v48 uuid];
                        v63 = [v48 appData];
                        [v63 setParentUUID:v62];
                      }
                    }

                    v46 = [obj countByEnumeratingWithState:&v104 objects:v116 count:16];
                  }

                  while (v46);
                }

                v3 = v84;
                v7 = v85;
                v8 = HMDIDSActivityMonitorHomeManagerDataSource;
                v6 = v86;
                v14 = v87;
                v9 = v88;
                v12 = v83;
              }
            }

            else
            {
              v26 = v14;
              v27 = objc_autoreleasePoolPush();
              v28 = v89;
              v29 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
              {
                v30 = HMFGetLogIdentifier();
                v31 = [v12 uuid];
                [v31 UUIDString];
                v32 = v8;
                v33 = v12;
                v35 = v34 = v9;
                *buf = 138543618;
                v118 = v30;
                v119 = 2112;
                v120 = v35;
                _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to check validity of uuid %@ (accessory has nil uniqueIdentifier)", buf, 0x16u);

                v9 = v34;
                v12 = v33;
                v8 = v32;

                v6 = v86;
                v7 = v85;
              }

              objc_autoreleasePoolPop(v27);
              v14 = v26;
              v3 = v84;
            }
          }

          ++v9;
        }

        while (v9 != v6);
        v6 = [v3 countByEnumeratingWithState:&v108 objects:v124 count:16];
      }

      while (v6);
    }

    v102 = 0u;
    v103 = 0u;
    v100 = 0u;
    v101 = 0u;
    v64 = [(HMDHome *)v89 rooms];
    v65 = [v64 countByEnumeratingWithState:&v100 objects:v113 count:16];
    if (v65)
    {
      v66 = v65;
      v67 = *v101;
      do
      {
        for (j = 0; j != v66; ++j)
        {
          if (*v101 != v67)
          {
            objc_enumerationMutation(v64);
          }

          v69 = *(*(&v100 + 1) + 8 * j);
          v70 = [v69 appData];

          if (v70)
          {
            v71 = [v69 appData];
            [(HMDHome *)v89 updateAppData:v71 identifierKey:@"HFSortedIdentifierStrings_roomServices" lookup:v95];
          }
        }

        v66 = [v64 countByEnumeratingWithState:&v100 objects:v113 count:16];
      }

      while (v66);
    }

    v72 = [(HMDHome *)v89 appData];

    if (v72)
    {
      v73 = [(HMDHome *)v89 appData];
      [(HMDHome *)v89 updateAppData:v73 identifierKey:@"HFSortedIdentifierStrings_homeServices" lookup:v95];
    }

    [(HMDHome *)v89 computeBridgedAccessoriesForAllBridges];
  }

  v98 = 0u;
  v99 = 0u;
  v96 = 0u;
  v97 = 0u;
  v74 = [(HMDHome *)v89 serviceGroups];
  v75 = [v74 countByEnumeratingWithState:&v96 objects:v112 count:16];
  if (v75)
  {
    v76 = v75;
    v77 = *v97;
    do
    {
      for (k = 0; k != v76; ++k)
      {
        if (*v97 != v77)
        {
          objc_enumerationMutation(v74);
        }

        [*(*(&v96 + 1) + 8 * k) fixupServiceGroup];
      }

      v76 = [v74 countByEnumeratingWithState:&v96 objects:v112 count:16];
    }

    while (v76);
  }

  v79 = *MEMORY[0x277D85DE8];
}

- (void)updateAppData:(id)a3 identifierKey:(id)a4 lookup:(id)a5
{
  v53 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v8 dictionary];
  v12 = [v11 hmf_dictionaryForKey:@"com.apple.homekit-entitledclient.identifer"];

  v37 = v9;
  v13 = [v12 objectForKey:v9];
  v14 = v13;
  if (v13 && [v13 count])
  {
    v34 = v12;
    v35 = v8;
    v32 = [v12 mutableCopy];
    v15 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v14, "count")}];
    v40 = 0u;
    v41 = 0u;
    v42 = 0u;
    v43 = 0u;
    v33 = v14;
    obj = v14;
    v39 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
    if (v39)
    {
      v16 = *v41;
      v36 = *v41;
      do
      {
        for (i = 0; i != v39; ++i)
        {
          if (*v41 != v16)
          {
            objc_enumerationMutation(obj);
          }

          v18 = *(*(&v40 + 1) + 8 * i);
          v19 = [v10 objectForKey:v18];
          if (v19)
          {
            v20 = objc_autoreleasePoolPush();
            v21 = self;
            v22 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
            {
              HMFGetLogIdentifier();
              v23 = v15;
              v24 = self;
              v26 = v25 = v10;
              *buf = 138544130;
              v45 = v26;
              v46 = 2112;
              v47 = v37;
              v48 = 2112;
              v49 = v18;
              v50 = 2112;
              v51 = v19;
              _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Fixup of service uuid list %@ from legacy archive %@ -> %@", buf, 0x2Au);

              v10 = v25;
              self = v24;
              v15 = v23;
              v16 = v36;
            }

            objc_autoreleasePoolPop(v20);
            v27 = v15;
            v28 = v19;
          }

          else
          {
            v27 = v15;
            v28 = v18;
          }

          [v27 addObject:v28];
        }

        v39 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
      }

      while (v39);
    }

    v29 = [v15 copy];
    [v32 setObject:v29 forKey:v37];

    v30 = [v32 copy];
    v8 = v35;
    [v35 setApplicationData:v30 forIdentifier:@"com.apple.homekit-entitledclient.identifer"];

    v14 = v33;
    v12 = v34;
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateMediaPassword:(id)a3
{
  v39 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = [v5 objectForKeyedSubscript:*MEMORY[0x277CD0408]];

  if (!v6)
  {
    goto LABEL_5;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v34 = v16;
      v35 = 2112;
      v36 = v6;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Invalid password: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [v4 responseHandler];

    if (!v17)
    {
      goto LABEL_18;
    }

    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:22];
LABEL_16:
    v30 = [v4 responseHandler];
    (v30)[2](v30, v9, 0);

    goto LABEL_17;
  }

  v32 = 0;
  v7 = [MEMORY[0x277CD1A60] isValidMediaPassword:v6 error:&v32];
  v8 = v32;
  v9 = v8;
  if ((v7 & 1) == 0)
  {
    v25 = objc_autoreleasePoolPush();
    v26 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543874;
      v34 = v28;
      v35 = 2112;
      v36 = v6;
      v37 = 2112;
      v38 = v9;
      _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to validate password, %@, with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v25);
    v29 = [v4 responseHandler];

    if (!v29)
    {
      goto LABEL_17;
    }

    goto LABEL_16;
  }

LABEL_5:
  v10 = [(HMDHome *)self mediaPassword];
  v11 = HMFEqualObjects();

  if (!v11)
  {
    v18 = [HMDHomeMediaSettingsModel alloc];
    v19 = [(HMDHome *)self uuid];
    v20 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:v19];
    v21 = [(HMDHome *)self uuid];
    v9 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:2 uuid:v20 parentUUID:v21];

    [(HMDHomeMediaSettingsModel *)v9 setMediaPassword:v6];
    v22 = [(HMDHome *)self backingStore];
    v23 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v24 = [v22 transaction:@"Update Media Password" options:v23];

    [v24 add:v9 withMessage:v4];
    [v24 run];

    goto LABEL_17;
  }

  v12 = [v4 responseHandler];

  if (v12)
  {
    v9 = [v4 responseHandler];
    (*&v9->super.super._bsoDataVersionOverride)(v9, 0, 0);
LABEL_17:
  }

LABEL_18:

  v31 = *MEMORY[0x277D85DE8];
}

- (void)setMediaPassword:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 copy];
  os_unfair_recursive_lock_lock_with_options();
  mediaPassword = self->_mediaPassword;
  if (HMFEqualObjects())
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    objc_storeStrong(&self->_mediaPassword, v5);
    os_unfair_recursive_lock_unlock();
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543618;
      v16 = v10;
      v17 = 2112;
      v18 = v5;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Updated media password to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    workQueue = v8->_workQueue;
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __28__HMDHome_setMediaPassword___block_invoke;
    v13[3] = &unk_2797359B0;
    v13[4] = v8;
    v14 = v5;
    dispatch_async(workQueue, v13);
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __28__HMDHome_setMediaPassword___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [*(a1 + 32) accessories];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    do
    {
      v6 = 0;
      do
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * v6);
        if ([v7 conformsToProtocol:&unk_286698188])
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        if (v9 && [v9 supportsMinimumUserPrivilege])
        {
          [v9 handleUpdatedPassword:*(a1 + 40)];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (id)mediaPassword
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_mediaPassword;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleUpdateMediaPeerToPeerEnabled:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v24 = 0;
  v5 = [v4 BOOLForKey:@"kEnabledKey" keyPresent:&v24];
  if (v24)
  {
    v6 = v5;
    if (v5 != [(HMDHome *)self isMediaPeerToPeerEnabled])
    {
      v7 = [HMDHomeMediaSettingsModel alloc];
      v8 = [(HMDHome *)self uuid];
      v9 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:v8];
      v10 = [(HMDHome *)self uuid];
      v11 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:2 uuid:v9 parentUUID:v10];

      v12 = [MEMORY[0x277CCABB0] numberWithBool:v6];
      [(HMDHomeMediaSettingsModel *)v11 setMediaPeerToPeerEnabled:v12];

      v13 = [(HMDHome *)self backingStore];
      v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v15 = [v13 transaction:@"Update Media Peer-to-peer Enabled" options:v14];

      [v15 add:v11 withMessage:v4];
      [v15 run];

LABEL_10:
      goto LABEL_11;
    }

    v22 = [v4 responseHandler];

    if (v22)
    {
      v11 = [v4 responseHandler];
      (*&v11->super.super._bsoDataVersionOverride)(v11, 0, 0);
      goto LABEL_10;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [v4 responseHandler];

    if (v20)
    {
      v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      v21 = [v4 responseHandler];
      (v21)[2](v21, v11, 0);

      goto LABEL_10;
    }
  }

LABEL_11:

  v23 = *MEMORY[0x277D85DE8];
}

- (void)setMediaPeerToPeerEnabled:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_mediaPeerToPeerEnabled = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isMediaPeerToPeerEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  mediaPeerToPeerEnabled = self->_mediaPeerToPeerEnabled;
  os_unfair_recursive_lock_unlock();
  return mediaPeerToPeerEnabled;
}

- (void)_handleUpdateMinimumMediaUserPrivilege:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 numberForKey:@"kUserPrivilegeLevelKey"];
  v6 = v5;
  if (v5)
  {
    v7 = [v5 integerValue];
    if ([(HMDHome *)self minimumMediaUserPrivilege]!= v7)
    {
      v16 = [HMDHomeMediaSettingsModel alloc];
      v17 = [(HMDHome *)self uuid];
      v18 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:v17];
      v19 = [(HMDHome *)self uuid];
      v20 = [(HMDBackingStoreModelObject *)v16 initWithObjectChangeType:2 uuid:v18 parentUUID:v19];

      v21 = [MEMORY[0x277CCABB0] numberWithInteger:v7];
      [(HMDHomeMediaSettingsModel *)v20 setMinimumMediaUserPrivilege:v21];

      v22 = [(HMDHome *)self backingStore];
      v23 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v24 = [v22 transaction:@"Update Minimum User Privilege" options:v23];

      [v24 add:v20 withMessage:v4];
      [v24 run];

      goto LABEL_11;
    }

    v8 = [v4 responseHandler];

    if (v8)
    {
      v9 = [v4 responseHandler];
      v9[2](v9, 0, 0);
LABEL_9:
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v26 = 138543362;
      v27 = v13;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", &v26, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [v4 responseHandler];

    if (v14)
    {
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      v15 = [v4 responseHandler];
      v15[2](v15, v9, 0);

      goto LABEL_9;
    }
  }

LABEL_11:

  v25 = *MEMORY[0x277D85DE8];
}

- (void)setMinimumMediaUserPrivilege:(int64_t)a3
{
  v22 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (self->_minimumMediaUserPrivilege == a3)
  {
    os_unfair_recursive_lock_unlock();
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = HMUserPrivilegeToString();
      *buf = 138543618;
      v19 = v8;
      v20 = 2112;
      v21 = v9;
    }

    objc_autoreleasePoolPop(v5);
  }

  else
  {
    self->_minimumMediaUserPrivilege = a3;
    os_unfair_recursive_lock_unlock();
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMUserPrivilegeToString();
      *buf = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Updated minimum user privilege to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    workQueue = v11->_workQueue;
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __40__HMDHome_setMinimumMediaUserPrivilege___block_invoke;
    v17[3] = &unk_279734BB8;
    v17[4] = v11;
    v17[5] = a3;
    dispatch_async(workQueue, v17);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome_setMinimumMediaUserPrivilege___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [*(a1 + 32) accessories];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    do
    {
      v6 = 0;
      do
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * v6);
        if ([v7 conformsToProtocol:&unk_286698188])
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        if (v9 && [v9 supportsMinimumUserPrivilege])
        {
          [v9 handleUpdatedMinimumUserPrivilege:*(a1 + 40)];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (int64_t)minimumMediaUserPrivilege
{
  os_unfair_recursive_lock_lock_with_options();
  minimumMediaUserPrivilege = self->_minimumMediaUserPrivilege;
  os_unfair_recursive_lock_unlock();
  return minimumMediaUserPrivilege;
}

- (void)queryPrimaryResidentReachabilityForAccessories:(id)a3 completion:(id)a4
{
  v49 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident];
  v9 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
  if (v8)
  {
    v32 = v7;
    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v10 = v6;
    v11 = [v10 countByEnumeratingWithState:&v39 objects:v48 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v40;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v40 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v39 + 1) + 8 * i);
          v46 = @"kAccessoryIsReachableKey";
          v16 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v15, "isReachable", v32)}];
          v47 = v16;
          v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v47 forKeys:&v46 count:1];

          [v9 addObject:v17];
        }

        v12 = [v10 countByEnumeratingWithState:&v39 objects:v48 count:16];
      }

      while (v12);
    }

    v7 = v32;
    v32[2](v32, v9);
  }

  else
  {
    v37 = 0u;
    v38 = 0u;
    v35 = 0u;
    v36 = 0u;
    v18 = v6;
    v19 = [v18 countByEnumeratingWithState:&v35 objects:v45 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v36;
      do
      {
        for (j = 0; j != v20; ++j)
        {
          if (*v36 != v21)
          {
            objc_enumerationMutation(v18);
          }

          v23 = [*(*(&v35 + 1) + 8 * j) uuid];
          v24 = [v23 UUIDString];
          [v9 addObject:v24];
        }

        v20 = [v18 countByEnumeratingWithState:&v35 objects:v45 count:16];
      }

      while (v20);
    }

    v43 = @"kAccessoriesUUIDKey";
    v44 = v9;
    v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v44 forKeys:&v43 count:1];
    v26 = MEMORY[0x277D0F818];
    v27 = [MEMORY[0x277CCAD78] UUID];
    v28 = [v26 messageWithName:@"HMDHomeQueryResidentReachabilityForAccessoriesMessageKey" identifier:v27 messagePayload:v25];

    v33[0] = MEMORY[0x277D85DD0];
    v33[1] = 3221225472;
    v33[2] = __69__HMDHome_queryPrimaryResidentReachabilityForAccessories_completion___block_invoke;
    v33[3] = &unk_279732CF0;
    v33[4] = self;
    v34 = v7;
    [v28 setResponseHandler:v33];
    v29 = [(HMDHome *)self uuid];
    v30 = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v28 target:v29 responseQueue:v30];
  }

  v31 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome_queryPrimaryResidentReachabilityForAccessories_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (v5)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v11;
      v18 = 2112;
      v19 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Query reachability response error: %@", &v16, 0x16u);
    }

    v12 = 0;
LABEL_5:

    objc_autoreleasePoolPop(v8);
    goto LABEL_6;
  }

  v14 = [v6 hmf_arrayForKey:@"kAccessoriesInfoDictionaryKey"];
  v12 = v14;
  if (!v14 || ![v14 count])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v15;
      v18 = 2112;
      v19 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@No reachability setting in query reachability response: %@", &v16, 0x16u);
    }

    goto LABEL_5;
  }

LABEL_6:
  (*(*(a1 + 40) + 16))();

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleQueryResidentReachabilityForAccessories:(id)a3
{
  v39 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = [v5 hmf_arrayForKey:@"kAccessoriesUUIDKey"];
  v7 = v6;
  if (v6)
  {
    v26 = v4;
    v8 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    v25 = v7;
    obj = v7;
    v9 = [obj countByEnumeratingWithState:&v28 objects:v36 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v29;
      v12 = *MEMORY[0x277CCF0B0];
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v29 != v11)
          {
            objc_enumerationMutation(obj);
          }

          v14 = *(*(&v28 + 1) + 8 * i);
          v15 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v14];
          v16 = [(HMDHome *)self accessoryWithUUID:v15];

          if (v16)
          {
            v34[0] = v12;
            v34[1] = @"kAccessoryIsReachableKey";
            v35[0] = v14;
            v17 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v16, "isReachable")}];
            v35[1] = v17;
            v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:2];

            [v8 addObject:v18];
          }
        }

        v10 = [obj countByEnumeratingWithState:&v28 objects:v36 count:16];
      }

      while (v10);
    }

    v32 = @"kAccessoriesInfoDictionaryKey";
    v33 = v8;
    v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v33 forKeys:&v32 count:1];
    v4 = v26;
    [v26 respondWithPayload:v19];

    v7 = v25;
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v38 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Query reachability request is missing accessory UUID in payload", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v8 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
    [v4 respondWithError:v8];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v24 = 0;
  v5 = [v4 BOOLForKey:@"kEnabledKey" keyPresent:&v24];
  if (v24)
  {
    v6 = v5;
    if (v5 != [(HMDHome *)self isAutomaticThirdPartyAccessorySoftwareUpdateEnabled])
    {
      v7 = [HMDHomeSettingsModel alloc];
      v8 = [(HMDHome *)self uuid];
      v9 = [HMDHomeSettingsModel modelIDForHomeUUID:v8];
      v10 = [(HMDHome *)self uuid];
      v11 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:2 uuid:v9 parentUUID:v10];

      v12 = [MEMORY[0x277CCABB0] numberWithBool:v6];
      [(HMDHomeSettingsModel *)v11 setAutomaticThirdPartyAccessorySoftwareUpdateEnabled:v12];

      v13 = [(HMDHome *)self backingStore];
      v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v15 = [v13 transaction:@"Update Automatic Accessory Firmware Update" options:v14];

      [v15 add:v11 withMessage:v4];
      [v15 run];

LABEL_10:
      goto LABEL_11;
    }

    v22 = [v4 responseHandler];

    if (v22)
    {
      v11 = [v4 responseHandler];
      (*&v11->super.super._bsoDataVersionOverride)(v11, 0, 0);
      goto LABEL_10;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [v4 responseHandler];

    if (v20)
    {
      v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      v21 = [v4 responseHandler];
      (v21)[2](v21, v11, 0);

      goto LABEL_10;
    }
  }

LABEL_11:

  v23 = *MEMORY[0x277D85DE8];
}

- (BOOL)isAutomaticThirdPartyAccessorySoftwareUpdateEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  automaticThirdPartyAccessorySoftwareUpdateEnabled = self->_automaticThirdPartyAccessorySoftwareUpdateEnabled;
  os_unfair_recursive_lock_unlock();
  return automaticThirdPartyAccessorySoftwareUpdateEnabled;
}

- (void)_handleUpdateAutomaticSoftwareUpdate:(id)a3
{
  v44 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v41 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling update automatic software update message", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v39 = 0;
  v9 = [v4 BOOLForKey:@"kEnabledKey" keyPresent:&v39];
  if (v39)
  {
    v10 = v9;
    v11 = [(HMDHome *)v6 isAutomaticSoftwareUpdateEnabled];
    v12 = objc_autoreleasePoolPush();
    v13 = v6;
    v14 = HMFGetOSLogHandle();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_INFO);
    if (v10 != v11)
    {
      if (v15)
      {
        v16 = HMFGetLogIdentifier();
        v17 = HMFBooleanToString();
        *buf = 138543618;
        v41 = v16;
        v42 = 2112;
        v43 = v17;
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Updating automatic software update to: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v12);
      v18 = [HMDSoftwareUpdateAutomaticUpdateToggledEvent eventWithAutomaticUpdateEnabled:v10];
      v19 = [(HMDHome *)v13 logEventSubmitter];
      [v19 submitLogEvent:v18];

      v20 = [HMDHomeSettingsModel alloc];
      v21 = [(HMDHome *)v13 uuid];
      v22 = [HMDHomeSettingsModel modelIDForHomeUUID:v21];
      v23 = [(HMDHome *)v13 uuid];
      v24 = [(HMDBackingStoreModelObject *)v20 initWithObjectChangeType:2 uuid:v22 parentUUID:v23];

      v25 = [MEMORY[0x277CCABB0] numberWithBool:v10];
      [(HMDHomeSettingsModel *)v24 setAutomaticSoftwareUpdateEnabled:v25];

      v26 = [(HMDHome *)v13 backingStore];
      v27 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v28 = [v26 transaction:@"Update Automatic Software Update" options:v27];

      [v28 add:v24 withMessage:v4];
      [v28 run];

      goto LABEL_16;
    }

    if (v15)
    {
      v35 = HMFGetLogIdentifier();
      v36 = HMFBooleanToString();
      *buf = 138543618;
      v41 = v35;
      v42 = 2112;
      v43 = v36;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Not changing the setting because it is already set to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v37 = [v4 responseHandler];

    if (v37)
    {
      v18 = [v4 responseHandler];
      v18[2](v18, 0, 0);
      goto LABEL_16;
    }
  }

  else
  {
    v29 = objc_autoreleasePoolPush();
    v30 = v6;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v32;
      _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v29);
    v33 = [v4 responseHandler];

    if (v33)
    {
      v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      v34 = [v4 responseHandler];
      v34[2](v34, v18, 0);

LABEL_16:
    }
  }

  v38 = *MEMORY[0x277D85DE8];
}

- (void)setAutomaticSoftwareUpdateEnabled:(BOOL)a3
{
  v3 = a3;
  v17 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (self->_automaticSoftwareUpdateEnabled == v3)
  {
    v5 = *MEMORY[0x277D85DE8];

    os_unfair_recursive_lock_unlock();
  }

  else
  {
    self->_automaticSoftwareUpdateEnabled = v3;
    os_unfair_recursive_lock_unlock();
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = HMFGetLogIdentifier();
      v10 = v9;
      v11 = @"disabled";
      if (v3)
      {
        v11 = @"enabled";
      }

      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Automatic software updates %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    [(HMDHome *)v7 _reevaluateAccessoryInfoWithBadgeRefresh:1];
    v12 = *MEMORY[0x277D85DE8];
  }
}

- (BOOL)isAutomaticSoftwareUpdateEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  automaticSoftwareUpdateEnabled = self->_automaticSoftwareUpdateEnabled;
  os_unfair_recursive_lock_unlock();
  return automaticSoftwareUpdateEnabled;
}

- (void)_handleHomeLocationUpdateFromSharedAdmin:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dataForKey:@"kHomeLocationDataKey"];
  if (v5)
  {
    v25 = 0;
    v6 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v5 error:&v25];
    v7 = v25;
    if (!v6)
    {
      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543618;
        v27 = v21;
        v28 = 2112;
        v29 = v7;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive location from data: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
      goto LABEL_13;
    }

    v8 = [v4 numberForKey:@"HMD.LOC.SRC"];
    v9 = [v8 intValue];

    v10 = isInternalBuild();
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_INFO);
    if (v10)
    {
      if (v14)
      {
        v15 = HMFGetLogIdentifier();
        v16 = HMDHomeLocationSourceToString(v9);
        *buf = 138543874;
        v27 = v15;
        v28 = 2112;
        v29 = v6;
        v30 = 2112;
        v31 = v16;
        v17 = "%{public}@Received new home location from shared admin: %@, source : %@";
LABEL_11:
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, v17, buf, 0x20u);
      }
    }

    else if (v14)
    {
      v15 = HMFGetLogIdentifier();
      v16 = HMDHomeLocationSourceToString(v9);
      *buf = 138543875;
      v27 = v15;
      v28 = 2117;
      v29 = v6;
      v30 = 2112;
      v31 = v16;
      v17 = "%{public}@Received new home location from shared admin: %{sensitive}@, source : %@";
      goto LABEL_11;
    }

    objc_autoreleasePoolPop(v11);
    v22 = [(HMDHome *)v12 homeLocationHandler];
    v23 = [MEMORY[0x277CBEAA8] date];
    [v22 runTransactionWithLocation:v6 updatedTime:v23 source:v9];

LABEL_13:
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_updateHomeLocation
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self homeLocationHandler];
  if (![v3 regionStateAtHome])
  {

    goto LABEL_8;
  }

  v4 = [(HMDHome *)self homeLocationHandler];
  v5 = [v4 regionStateNearbyHome];

  if (!v5)
  {
LABEL_8:
    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v31 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@No reachable accessories found and not all regions are determined. Setting Home location to unknown & home level to Not at Home.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v19 = 0;
    v18 = 0;
    goto LABEL_11;
  }

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    HMFGetLogIdentifier();
    v9 = v29 = v6;
    v10 = [(HMDHome *)v7 homeLocationHandler];
    [v10 regionStateAtHome];
    v11 = HMRegionStateString();
    v12 = [(HMDHome *)v7 homeLocationHandler];
    [v12 regionStateNearbyHome];
    v13 = HMRegionStateString();
    v14 = [(HMDHome *)v7 reachableAccessoriesCount];
    v15 = HMFBooleanToString();
    *buf = 138544386;
    v31 = v9;
    v32 = 2112;
    v33 = v11;
    v34 = 2112;
    v35 = v13;
    v36 = 2048;
    v37 = v14;
    v38 = 2112;
    v39 = v15;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@RegionStateAtHome : %@, RegionStateNearbyHome : %@, reachableAccessoriesCount : %lu/%@", buf, 0x34u);

    v6 = v29;
  }

  objc_autoreleasePoolPop(v6);
  v16 = [(HMDHome *)v7 homeLocationHandler];
  v17 = [v16 regionStateAtHome];

  if (v17 == 1)
  {
    v18 = 2;
    v19 = 1;
  }

  else
  {
    v25 = [(HMDHome *)v7 homeLocationHandler];
    v26 = [v25 regionStateNearbyHome];

    if (v26 == 1)
    {
      v18 = 1;
      v19 = 3;
    }

    else
    {
      v27 = [(HMDHome *)v7 homeLocationHandler];
      v28 = [v27 regionStateNearbyHome];

      if (v28 != 2)
      {
        v18 = 0;
        goto LABEL_12;
      }

      v18 = 1;
      v19 = 2;
    }
  }

LABEL_11:
  [(HMDHome *)self setHomeLocation:v19];
LABEL_12:
  [(HMDHome *)self setAtHomeLevel:v18];
  v24 = *MEMORY[0x277D85DE8];
}

- (void)updateHomeLocation
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_updateHomeLocation__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)setHomeLocation:(int64_t)a3
{
  v23 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  v5 = 0;
  homeLocation = self->_homeLocation;
  if (homeLocation != a3)
  {
    self->_homeLocation = a3;
    v5 = !self->_overrideHomeLocation;
  }

  os_unfair_recursive_lock_unlock();
  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    if (v5)
    {
      v11 = @"Updated";
    }

    else
    {
      v11 = @"Did not update";
    }

    v12 = HMStringFromHomeLocation();
    v13 = HMStringFromHomeLocation();
    v15 = 138544130;
    v16 = v10;
    v17 = 2112;
    v18 = v11;
    v19 = 2112;
    v20 = v12;
    v21 = 2112;
    v22 = v13;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ home location from %@ to %@", &v15, 0x2Au);
  }

  objc_autoreleasePoolPop(v7);
  if (v5)
  {
    [(HMDHome *)v8 _handleHomeLocationChange:a3 previousLocation:homeLocation];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeLocationChange:(int64_t)a3 previousLocation:(int64_t)a4
{
  v41[1] = *MEMORY[0x277D85DE8];
  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [(HMDHome *)v8 name];
    v12 = [(HMDHome *)v8 shortDescription];
    v13 = HMStringFromHomeLocation();
    v14 = HMStringFromHomeLocation();
    *buf = 138544386;
    *&buf[4] = v10;
    v33 = 2112;
    v34 = v11;
    v35 = 2112;
    v36 = v12;
    v37 = 2112;
    v38 = v13;
    v39 = 2112;
    v40 = v14;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Location status for home %@/%@ changing from %@ to %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v7);
  v15 = [(HMDHome *)v8 notificationCenter];
  [v15 postNotificationName:@"HMDHomeLocationChangedNotification" object:v8];

  v16 = [(HMDHome *)v8 homeManager];
  v17 = [(HMDHome *)v8 uuid];
  [v16 updateGenerationCounterWithReason:@"HomeLocationChanged" sourceUUID:v17 shouldNotifyClients:0];

  v18 = MEMORY[0x277D0F818];
  v19 = *MEMORY[0x277CD0058];
  v20 = v8;
  v21 = [(HMDHome *)v20 uuid];
  v41[0] = *MEMORY[0x277CD0068];
  v22 = [MEMORY[0x277CCABB0] numberWithInteger:a3];
  *buf = v22;
  v23 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:buf forKeys:v41 count:1];
  v24 = [v18 homeLocationAuthorizedAndEntitledMessageWithName:v19 target:v21 messagePayload:v23];

  v25 = [(HMDHome *)v20 msgDispatcher];

  [v25 sendMessage:v24 completionHandler:0];
  if (a3 == 1)
  {
    v26 = [(HMDHome *)v20 workQueue];
    v27 = v26;
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke;
    v31[3] = &unk_279735D00;
    v31[4] = v20;
    v28 = v31;
LABEL_10:
    dispatch_async(v26, v28);

    goto LABEL_11;
  }

  if (a3 == 3 && a4 != 2 || a3 == 2 && a4 != 3)
  {
    v26 = [(HMDHome *)v20 workQueue];
    v27 = v26;
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke_1708;
    v30[3] = &unk_279735D00;
    v30[4] = v20;
    v28 = v30;
    goto LABEL_10;
  }

LABEL_11:
  v29 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Did arrive home", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeDidArriveHomeNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke_1708(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Did leave home", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeDidLeaveHomeNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

- (int64_t)homeLocation
{
  os_unfair_recursive_lock_lock_with_options();
  if (self->_overrideHomeLocation)
  {
    v3 = &OBJC_IVAR___HMDHome__overriddenHomeLocation;
  }

  else
  {
    v3 = &OBJC_IVAR___HMDHome__homeLocation;
  }

  v4 = *(&self->super.super.isa + *v3);
  os_unfair_recursive_lock_unlock();
  return v4;
}

- (void)setAtHomeLevel:(int64_t)a3
{
  v26 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  atHomeLevel = self->_atHomeLevel;
  if (atHomeLevel != a3)
  {
    self->_atHomeLevel = a3;
  }

  os_unfair_recursive_lock_unlock();
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = v9;
    v11 = @"Updated";
    if (atHomeLevel == a3)
    {
      v11 = @"Did not update";
    }

    if (atHomeLevel > 3)
    {
      v12 = @"HMDAtHomeLevelNotAtHome";
    }

    else
    {
      v12 = off_279722F30[atHomeLevel];
    }

    if (a3 > 3)
    {
      v13 = @"HMDAtHomeLevelNotAtHome";
    }

    else
    {
      v13 = off_279722F30[a3];
    }

    v18 = 138544130;
    v19 = v9;
    v20 = 2112;
    v21 = v11;
    v22 = 2112;
    v23 = v12;
    v24 = 2112;
    v25 = v13;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@%@ atHomeLevel from %@ to %@", &v18, 0x2Au);
  }

  objc_autoreleasePoolPop(v6);
  if (atHomeLevel != a3)
  {
    v14 = [(HMDHome *)v7 residentDeviceManager];
    [v14 atHomeLevelChanged:a3];

    v15 = [(HMDHome *)v7 homeManager];
    v16 = [(HMDHome *)v7 uuid];
    [v15 atHomeLevelChanged:a3 formerLevel:atHomeLevel home:v16];
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (int64_t)atHomeLevel
{
  os_unfair_recursive_lock_lock_with_options();
  atHomeLevel = self->_atHomeLevel;
  os_unfair_recursive_lock_unlock();
  return atHomeLevel;
}

- (BOOL)enabledResidentsSupportsHomeHub
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 availableResidentDevices];
  v4 = [v3 na_any:&__block_literal_global_1698];

  return v4;
}

uint64_t __42__HMDHome_enabledResidentsSupportsHomeHub__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 capabilities];
  v3 = [v2 supportsHomeHub];

  return v3;
}

- (BOOL)currentDeviceSupportsSidekickSettings
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 capabilitiesController];
  v4 = [v3 currentResidentCapabilities];
  v5 = [v4 supportsSiriEndpointSetup];

  return v5;
}

- (BOOL)supportsSiriEndpointOnBoarding
{
  v34 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self primaryResident];
  v4 = [v3 capabilities];
  v5 = [v4 supportsSiriEndpointSetup];

  if (v5)
  {
    v6 = [MEMORY[0x277CBEB18] array];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    v7 = [(HMDHome *)self appleMediaAccessories];
    v8 = [v7 countByEnumeratingWithState:&v28 objects:v33 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v29;
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v29 != v10)
          {
            objc_enumerationMutation(v7);
          }

          v12 = [*(*(&v28 + 1) + 8 * i) device];
          if (v12)
          {
            [v6 addObject:v12];
          }
        }

        v9 = [v7 countByEnumeratingWithState:&v28 objects:v33 count:16];
      }

      while (v9);
    }

    v26 = 0u;
    v27 = 0u;
    v24 = 0u;
    v25 = 0u;
    v13 = [(HMDHome *)self residentDeviceManager];
    v14 = [v13 residentDevices];

    v15 = [v14 countByEnumeratingWithState:&v24 objects:v32 count:16];
    if (v15)
    {
      v16 = *v25;
      do
      {
        for (j = 0; j != v15; ++j)
        {
          if (*v25 != v16)
          {
            objc_enumerationMutation(v14);
          }

          v18 = *(*(&v24 + 1) + 8 * j);
          v19 = [v18 device];
          v20 = [v18 capabilities];
          if ([v20 supportsHomeHub])
          {
            v21 = [v6 containsObject:v19];

            if (v21)
            {

              LOBYTE(v15) = 1;
              goto LABEL_24;
            }
          }

          else
          {
          }
        }

        v15 = [v14 countByEnumeratingWithState:&v24 objects:v32 count:16];
      }

      while (v15);
    }

LABEL_24:
  }

  else
  {
    LOBYTE(v15) = 0;
  }

  v22 = *MEMORY[0x277D85DE8];
  return v15;
}

- (void)handleSiriEndPointAddedNotification:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (!v7)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v12;
      v23 = 2112;
      v24 = v4;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@Unable to synchronize settings after receiving endpoint added notification with no HAP accessory. %@", &v21, 0x16u);
      goto LABEL_10;
    }

LABEL_11:

    objc_autoreleasePoolPop(v9);
    goto LABEL_12;
  }

  v8 = [v7 home];

  if (v8 != self)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v7 home];
      v21 = 138543874;
      v22 = v12;
      v23 = 2112;
      v24 = v7;
      v25 = 2112;
      v26 = v13;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@New accessory is added for another home for HAP accessory: %@ home:%@", &v21, 0x20u);

LABEL_10:
      goto LABEL_11;
    }

    goto LABEL_11;
  }

  v15 = [v7 siriEndpointProfile];

  if (v15)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      v19 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v19;
      v23 = 2112;
      v24 = v7;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_DEFAULT, "%{public}@A siri endpoint accessory is added. Confirm resident device: %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [(HMDHome *)v17 residentDeviceManager];
    [v20 confirmWithCompletionHandler:0];
  }

LABEL_12:

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleEnableNotifications:(id)a3
{
  v50 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v43 = 0;
  v6 = [v4 BOOLForKey:*MEMORY[0x277CD2158] keyPresent:&v43];
  v42 = 0;
  v7 = [v4 BOOLForKey:*MEMORY[0x277CCFED8] keyPresent:&v42];
  if (v43 == 1 && (v42 & 1) != 0)
  {
    v8 = v7;
    v9 = [v4 clientIdentifier];
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    v13 = v12;
    if (v9)
    {
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v15 = HMFBooleanToString();
        *buf = 138543874;
        v45 = v14;
        v46 = 2112;
        v47 = v9;
        v48 = 2112;
        v49 = v15;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Handling Enable Notifications from ClientIdentifier: %@, setting: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v10);
      if (v6)
      {
        [(HMDHome *)v11 removeNotificationDeregistrationForClientIdentifier:v9];
        v16 = [(HMDHome *)v11 notificationRegistrations];
        v17 = [v16 count];

        v18 = [(HMDHome *)v11 notificationRegistrationsForAppleMediaAccessories];
        v19 = ([v18 count] == 0) & v8;

        [(HMDHome *)v11 addNotificationRegistrationForClientIdentifier:v9 includesAppleMediaAccessories:v8];
        if (v19 == 1)
        {
          v20 = objc_autoreleasePoolPush();
          v21 = v11;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
          {
            v23 = HMFGetLogIdentifier();
            *buf = 138543362;
            v45 = v23;
            _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Modifying direct Apple Media notification registrations with resident due to HomeKit client request", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v20);
          [(HMDHome *)v21 _subscribeForHomeAppleMediaNotificationsOnDirectTransports:?];
        }

        if (!v17)
        {
          v24 = objc_autoreleasePoolPush();
          v25 = v11;
          v26 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
          {
            v27 = HMFGetLogIdentifier();
            *buf = 138543362;
            v45 = v27;
            _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to HomeKit client request", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          [(HMDHome *)v25 _subscribeForHomeNotificationsFromRemoteGateway:1];
          [(HMDHome *)v25 _subscribeForHomeNotificationsOnDirectTransports:?];
          v28 = [MEMORY[0x277CBEAA8] date];
          [(HMDHome *)v25 setNotificationsUpdatedTime:v28];
        }

        v29 = [(HMDHome *)v11 homeManager];
        v30 = [v29 chipDataSource];
        [v30 updateNotificationsEnabled:1 forHome:v11 keepAliveOnly:0];

        logAndPostNotification(@"HMDHomeDidEnableCharacteristicNotifyEventNotification", v11, 0);
        [(HMDHome *)v11 _refreshCharacteristicValuesOnHomeNotificationEnable];
        if (v8)
        {
          [(HMDHome *)v11 _refreshMediaProfilesOnHomeNotificationEnable];
        }
      }

      else
      {
        [(HMDHome *)v11 addNotificationDeregistrationForClientIdentifier:v9];
        [(HMDHome *)v11 _startHomeNotificationDeregistrationTimer];
      }

      v41 = [MEMORY[0x277D0F8C0] sharedPowerLogger];
      [v41 reportCharacteristicNotificationRegistrationEvent:v6 clientIdentifier:v9];

      [v4 respondWithSuccess];
    }

    else
    {
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v38 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v38;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Unable to look up the client identifier from request to enable home notifications", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v10);
      v9 = [v4 responseHandler];

      if (v9)
      {
        v39 = [v4 responseHandler];
        v40 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
        (v39)[2](v39, v40, 0);

        v9 = 0;
      }
    }
  }

  else
  {
    v31 = objc_autoreleasePoolPush();
    v32 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
    {
      v34 = HMFGetLogIdentifier();
      v35 = HMFBooleanToString();
      v36 = HMFBooleanToString();
      *buf = 138543874;
      v45 = v34;
      v46 = 2112;
      v47 = v35;
      v48 = 2112;
      v49 = v36;
      _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key (hasHAPKey: %@, hasAppleMediaKey: %@) to enable home notifications", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v31);
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [v4 respondWithError:v9];
  }

  v37 = *MEMORY[0x277D85DE8];
}

- (void)_refreshMediaProfilesOnHomeNotificationEnable
{
  v37 = *MEMORY[0x277D85DE8];
  v25 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v3 = [MEMORY[0x277CBEB18] array];
  v4 = [(HMDHome *)self supportsUnifiedMediaNotificationsOnResidents];
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v24 = self;
  obj = [(HMDHome *)self accessories];
  v5 = [obj countByEnumeratingWithState:&v31 objects:v36 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v32;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v32 != v7)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v31 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          v12 = [v11 device];
          if ((v12 == 0) | v4 & 1)
          {
            v13 = [v11 mediaProfile];
            [v3 addObject:v13];
          }

          else
          {
            v14 = v3;
            v13 = [v25 objectForKey:v12];
            if (!v13)
            {
              v13 = [MEMORY[0x277CBEB18] array];
              [v25 setObject:v13 forKey:v12];
            }

            v15 = [v11 mediaProfile];
            [v13 addObject:v15];

            v3 = v14;
          }
        }
      }

      v6 = [obj countByEnumeratingWithState:&v31 objects:v36 count:16];
    }

    while (v6);
  }

  if ([v3 count])
  {
    [(HMDHome *)v24 _readProfileState:v3 viaDevice:0];
  }

  v29 = 0u;
  v30 = 0u;
  v27 = 0u;
  v28 = 0u;
  v16 = v25;
  v17 = [v16 countByEnumeratingWithState:&v27 objects:v35 count:16];
  if (v17)
  {
    v18 = v17;
    v19 = *v28;
    do
    {
      for (j = 0; j != v18; ++j)
      {
        if (*v28 != v19)
        {
          objc_enumerationMutation(v16);
        }

        v21 = *(*(&v27 + 1) + 8 * j);
        v22 = [v16 objectForKey:v21];
        if ([v22 count])
        {
          [(HMDHome *)v24 _readProfileState:v22 viaDevice:v21];
        }
      }

      v18 = [v16 countByEnumeratingWithState:&v27 objects:v35 count:16];
    }

    while (v18);
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_readProfileState:(void *)a3 viaDevice:
{
  v30 = *MEMORY[0x277D85DE8];
  v19 = a2;
  v17 = a3;
  val = a1;
  if (a1)
  {
    v5 = MEMORY[0x277CBEB18];
    v6 = [v19 count];
    v7 = +[HMDMediaSession mediaPropertyMessageKeys];
    v8 = [v5 arrayWithCapacity:{objc_msgSend(v7, "count") * v6}];

    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    obj = v19;
    v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
    if (v9)
    {
      v10 = *v26;
      v11 = MEMORY[0x277D85DD0];
      do
      {
        v12 = 0;
        do
        {
          if (*v26 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v13 = *(*(&v25 + 1) + 8 * v12);
          v14 = +[HMDMediaSession mediaPropertyMessageKeys];
          v24[0] = v11;
          v24[1] = 3221225472;
          v24[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke;
          v24[3] = &unk_2797330F0;
          v24[4] = v13;
          v15 = [v14 na_map:v24];

          [v8 addObjectsFromArray:v15];
          ++v12;
        }

        while (v9 != v12);
        v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
      }

      while (v9);
    }

    objc_initWeak(&location, val);
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke_2;
    v21[3] = &unk_279735360;
    objc_copyWeak(&v22, &location);
    [val redispatchMediaReadRequests:v8 viaDevice:v17 completion:v21];
    objc_destroyWeak(&v22);
    objc_destroyWeak(&location);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __39__HMDHome__readProfileState_viaDevice___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke_3;
    v7[3] = &unk_2797359B0;
    v8 = v3;
    v9 = v5;
    dispatch_async(v6, v7);
  }
}

void __39__HMDHome__readProfileState_viaDevice___block_invoke_3(uint64_t a1)
{
  v1 = a1;
  v148 = *MEMORY[0x277D85DE8];
  v2 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(*(a1 + 32), "count")}];
  v120 = 0u;
  v121 = 0u;
  v122 = 0u;
  v123 = 0u;
  obj = *(v1 + 32);
  v95 = v1;
  v100 = v2;
  v98 = [obj countByEnumeratingWithState:&v120 objects:v147 count:16];
  if (v98)
  {
    v97 = *v121;
    v115 = *MEMORY[0x277CD0910];
    v112 = *MEMORY[0x277CD0938];
    v110 = *MEMORY[0x277CD0990];
    v108 = *MEMORY[0x277CD0960];
    v106 = *MEMORY[0x277CD09B0];
    v104 = *MEMORY[0x277CD0920];
    *&v3 = 138544130;
    v93 = v3;
    do
    {
      v4 = 0;
      do
      {
        if (*v121 != v97)
        {
          objc_enumerationMutation(obj);
        }

        v103 = v4;
        v5 = *(*(&v120 + 1) + 8 * v4);
        v116 = 0u;
        v117 = 0u;
        v118 = 0u;
        v119 = 0u;
        v6 = v5;
        v7 = [v6 countByEnumeratingWithState:&v116 objects:v146 count:16];
        if (!v7)
        {

          v9 = 0;
          v111 = 0;
          v109 = 0;
          v107 = 0;
          v105 = 0;
LABEL_56:
          v32 = [v9 mediaSession];
          v38 = [v32 state];
          v8 = 0;
          goto LABEL_57;
        }

        v105 = 0;
        v107 = 0;
        v109 = 0;
        v111 = 0;
        v113 = 0;
        v8 = 0;
        v9 = 0;
        v10 = *v117;
        do
        {
          for (i = 0; i != v7; i = i + 1)
          {
            if (*v117 != v10)
            {
              objc_enumerationMutation(v6);
            }

            v12 = *(*(&v116 + 1) + 8 * i);
            v13 = [v12 error];

            if (!v13)
            {
              v14 = [v12 request];
              v15 = [v14 mediaProfile];

              v16 = [v14 property];
              v17 = [v16 isEqual:v115];

              if (v17)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v8;
                v8 = v19;
                goto LABEL_42;
              }

              v21 = [v14 property];
              v22 = [v21 isEqual:v112];

              if (v22)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v113;
                v113 = v19;
                goto LABEL_42;
              }

              v23 = [v14 property];
              v24 = [v23 isEqual:v110];

              if (v24)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v111;
                v111 = v19;
                goto LABEL_42;
              }

              v25 = [v14 property];
              v26 = [v25 isEqual:v108];

              if (v26)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v109;
                v109 = v19;
                goto LABEL_42;
              }

              v27 = [v14 property];
              v28 = [v27 isEqual:v106];

              if (v28)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v107;
                v107 = v19;
                goto LABEL_42;
              }

              v29 = [v14 property];
              v30 = [v29 isEqual:v104];

              if (v30)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v105;
                v105 = v19;
LABEL_42:
                v31 = v19;
              }

              v9 = v15;
              continue;
            }
          }

          v7 = [v6 countByEnumeratingWithState:&v116 objects:v146 count:16];
        }

        while (v7);

        v2 = v100;
        if (!v8)
        {
          v1 = v95;
          v7 = v113;
          goto LABEL_56;
        }

        v32 = [v9 accessory];
        v33 = [v9 uniqueIdentifier];
        v34 = [v33 UUIDString];
        v35 = [v8 isEqualToString:v34];

        v1 = v95;
        v7 = v113;
        if (v35)
        {
          v36 = [v32 identifier];

          v8 = v36;
        }

        v37 = [v32 home];
        v38 = [v37 mediaSessionStateWithIdentifier:v8];
        if (!v38)
        {
          v39 = objc_autoreleasePoolPush();
          v40 = *(v95 + 40);
          v41 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v42 = v101 = v39;
            v43 = [v32 identifier];
            v44 = *(v95 + 32);
            *buf = v93;
            v139 = v42;
            v140 = 2112;
            v141 = v8;
            v142 = 2112;
            v143 = v43;
            v144 = 2112;
            v145 = v44;
            _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Creating a media session state for a remote session (sessionIdentifier %@; accessoryIdentifier %@) update - responses %@", buf, 0x2Au);

            v39 = v101;
          }

          objc_autoreleasePoolPop(v39);
          v38 = [[HMDMediaSessionState alloc] initWithSessionIdentifier:v8];
          [v37 addMediaSessionState:v38];
          v7 = v113;
          v1 = v95;
        }

LABEL_57:
        v45 = [v9 accessory];
        v46 = [v45 uuid];
        v47 = [v46 UUIDString];

        if (v47 && v38)
        {
          v96 = v45;
          v48 = MEMORY[0x277CBEB38];
          v99 = v47;
          v49 = [v2 hmf_dictionaryForKey:v47];
          v50 = [v48 dictionaryWithDictionary:v49];

          v51 = v7 != 0;
          v114 = v7;
          v102 = v38;
          v52 = v50;
          if (v7)
          {
            v53 = [v7 unsignedIntegerValue];
            [(HMDMediaSessionState *)v38 setPlaybackState:v53];
            v54 = objc_autoreleasePoolPush();
            v55 = *(v1 + 40);
            v56 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
            {
              v57 = HMFGetLogIdentifier();
              *buf = 138543618;
              v139 = v57;
              v140 = 2048;
              v141 = v53;
              _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_INFO, "%{public}@Read the profile playback state as %tu", buf, 0x16u);

              v38 = v102;
            }

            objc_autoreleasePoolPop(v54);
            v136 = v112;
            v137 = v114;
            v58 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v137 forKeys:&v136 count:1];
            v50 = v52;
            [v52 addEntriesFromDictionary:v58];
          }

          if (v111)
          {
            v59 = [v111 unsignedIntegerValue];
            [(HMDMediaSessionState *)v38 setShuffleState:v59];
            v60 = objc_autoreleasePoolPush();
            v61 = *(v1 + 40);
            v62 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
            {
              v63 = HMFGetLogIdentifier();
              *buf = 138543618;
              v139 = v63;
              v140 = 2048;
              v141 = v59;
              _os_log_impl(&dword_2531F8000, v62, OS_LOG_TYPE_INFO, "%{public}@Read the profile shuffle state as %tu", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v60);
            v134 = v110;
            v135 = v111;
            v51 = 1;
            v64 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v135 forKeys:&v134 count:1];
            v50 = v52;
            [v52 addEntriesFromDictionary:v64];
          }

          if (v109)
          {
            v65 = [v109 unsignedIntegerValue];
            [(HMDMediaSessionState *)v102 setRepeatState:v65];
            v66 = objc_autoreleasePoolPush();
            v67 = *(v1 + 40);
            v68 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v68, OS_LOG_TYPE_INFO))
            {
              v69 = HMFGetLogIdentifier();
              *buf = 138543618;
              v139 = v69;
              v140 = 2048;
              v141 = v65;
              _os_log_impl(&dword_2531F8000, v68, OS_LOG_TYPE_INFO, "%{public}@Read the profile repeat state as %tu", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v66);
            v132 = v108;
            v133 = v109;
            v51 = 1;
            v70 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v133 forKeys:&v132 count:1];
            v50 = v52;
            [v52 addEntriesFromDictionary:v70];
          }

          v7 = v114;
          if (v107)
          {
            [(HMDMediaSessionState *)v102 setVolume:v107];
            v71 = objc_autoreleasePoolPush();
            v72 = *(v1 + 40);
            v73 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v73, OS_LOG_TYPE_INFO))
            {
              v74 = HMFGetLogIdentifier();
              *buf = 138543618;
              v139 = v74;
              v140 = 2112;
              v141 = v107;
              _os_log_impl(&dword_2531F8000, v73, OS_LOG_TYPE_INFO, "%{public}@Read the profile volume as %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v71);
            v130 = v106;
            v131 = v107;
            v75 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v131 forKeys:&v130 count:1];
            v50 = v52;
            [v52 addEntriesFromDictionary:v75];

            v38 = v102;
            v47 = v99;
            if (!v105)
            {
LABEL_80:
              [v100 setObject:v50 forKey:v47];
              goto LABEL_81;
            }

LABEL_77:
            [(HMDMediaSessionState *)v38 setMediaUniqueIdentifier:v105];
            v76 = objc_autoreleasePoolPush();
            v77 = *(v1 + 40);
            v78 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v78, OS_LOG_TYPE_INFO))
            {
              v79 = HMFGetLogIdentifier();
              *buf = 138543618;
              v139 = v79;
              v140 = 2112;
              v141 = v105;
              _os_log_impl(&dword_2531F8000, v78, OS_LOG_TYPE_INFO, "%{public}@Read the profile mediaUniqueIdentifier state as %@", buf, 0x16u);

              v38 = v102;
            }

            objc_autoreleasePoolPop(v76);
            v128 = v104;
            v129 = v105;
            v80 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v129 forKeys:&v128 count:1];
            v50 = v52;
            [v52 addEntriesFromDictionary:v80];

            v47 = v99;
            goto LABEL_80;
          }

          v38 = v102;
          v47 = v99;
          if (v105)
          {
            goto LABEL_77;
          }

          if (v51)
          {
            goto LABEL_80;
          }

LABEL_81:

          v2 = v100;
          v45 = v96;
        }

        v4 = v103 + 1;
      }

      while (v103 + 1 != v98);
      v81 = [obj countByEnumeratingWithState:&v120 objects:v147 count:16];
      v98 = v81;
    }

    while (v81);
  }

  if ([v2 count])
  {
    v82 = [*(v1 + 40) uuid];
    v83 = [v82 UUIDString];
    v126 = v83;
    v124 = *MEMORY[0x277CCE7A8];
    v84 = [v100 copy];
    v125 = v84;
    v85 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v125 forKeys:&v124 count:1];
    v127 = v85;
    v86 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v127 forKeys:&v126 count:1];

    v87 = [MEMORY[0x277D0F848] entitledMessageWithName:*MEMORY[0x277CD0340] messagePayload:v86];
    v88 = [[HMDHomeManagerXPCMessageSendPolicy alloc] initWithEntitlements:0 options:-1 active:1];
    [v87 setSendPolicy:v88];

    v89 = [*(v95 + 40) msgDispatcher];
    v90 = [*(v95 + 40) homeManager];
    v91 = [v90 uuid];
    [v89 sendMessage:v87 target:v91];

    v1 = v95;
    v2 = v100;
  }

  [(HMDHome *)*(v1 + 40) updateMediaStateWithResponses:0 requestMessageInformation:?];

  v92 = *MEMORY[0x277D85DE8];
}

- (void)updateMediaStateWithResponses:(void *)a3 requestMessageInformation:
{
  v43 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (a1)
  {
    v30 = v6;
    v32 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v37 = 0u;
    v38 = 0u;
    v39 = 0u;
    v40 = 0u;
    v29 = v5;
    obj = v5;
    v8 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v38;
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v38 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v37 + 1) + 8 * i);
          v13 = [v12 firstObject];
          v14 = [v13 request];
          v15 = [v14 mediaProfile];
          v16 = v15;
          if (v15)
          {
            v17 = [v15 mediaSession];
            if (v17)
            {
              v18 = [v32 objectForKey:v17];
              v19 = [v18 mutableCopy];

              if (v19)
              {
                [v19 addObjectsFromArray:v12];
              }

              else
              {
                v19 = [v12 mutableCopy];
              }

              v20 = [v19 copy];
              [v32 setObject:v20 forKey:v17];
            }

            else
            {
              [v16 updateWithResponses:v12 requestMessageInformation:v30];
            }
          }
        }

        v9 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
      }

      while (v9);
    }

    v35 = 0u;
    v36 = 0u;
    v33 = 0u;
    v34 = 0u;
    v21 = [v32 hm_allKeys];
    v22 = [v21 countByEnumeratingWithState:&v33 objects:v41 count:16];
    v7 = v30;
    if (v22)
    {
      v23 = v22;
      v24 = *v34;
      do
      {
        for (j = 0; j != v23; ++j)
        {
          if (*v34 != v24)
          {
            objc_enumerationMutation(v21);
          }

          v26 = *(*(&v33 + 1) + 8 * j);
          v27 = [v32 objectForKey:{v26, v29}];
          [v26 updateWithResponses:v27 requestMessageInformation:v30];
        }

        v23 = [v21 countByEnumeratingWithState:&v33 objects:v41 count:16];
      }

      while (v23);
    }

    v5 = v29;
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_refreshCharacteristicValuesOnHomeNotificationEnable
{
  v76 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  v49 = [MEMORY[0x277CBEB58] set];
  v63 = 0u;
  v64 = 0u;
  v65 = 0u;
  v66 = 0u;
  v45 = self;
  obj = [(HMDHome *)self accessories];
  v46 = [obj countByEnumeratingWithState:&v63 objects:v75 count:16];
  if (v46)
  {
    v44 = *v64;
    do
    {
      v4 = 0;
      do
      {
        if (*v64 != v44)
        {
          objc_enumerationMutation(obj);
        }

        v48 = v4;
        v5 = *(*(&v63 + 1) + 8 * v4);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v6 = v5;
        }

        else
        {
          v6 = 0;
        }

        v7 = v6;

        v62[0] = MEMORY[0x277D85DD0];
        v62[1] = 3221225472;
        v62[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke;
        v62[3] = &unk_279733D48;
        v62[4] = v45;
        v8 = [v7 characteristicsPassingTest:v62];
        v58 = 0u;
        v59 = 0u;
        v60 = 0u;
        v61 = 0u;
        v9 = [v8 countByEnumeratingWithState:&v58 objects:v74 count:16];
        if (v9)
        {
          v10 = v9;
          v11 = *v59;
          do
          {
            for (i = 0; i != v10; ++i)
            {
              if (*v59 != v11)
              {
                objc_enumerationMutation(v8);
              }

              v13 = [HMDCharacteristicRequest requestWithCharacteristic:*(*(&v58 + 1) + 8 * i)];
              [v3 addObject:v13];
            }

            v10 = [v8 countByEnumeratingWithState:&v58 objects:v74 count:16];
          }

          while (v10);
        }

        v56 = 0u;
        v57 = 0u;
        v54 = 0u;
        v55 = 0u;
        v47 = v7;
        v14 = [v7 lightProfiles];
        v15 = [v14 allObjects];

        v16 = [v15 countByEnumeratingWithState:&v54 objects:v73 count:16];
        if (v16)
        {
          v17 = v16;
          v18 = *v55;
          do
          {
            for (j = 0; j != v17; ++j)
            {
              if (*v55 != v18)
              {
                objc_enumerationMutation(v15);
              }

              v20 = *(*(&v54 + 1) + 8 * j);
              v21 = [v20 readCharacteristicRequests];
              if ([v21 count])
              {
                v22 = [v21 allObjects];
                [v3 addObjectsFromArray:v22];

                [v49 addObject:v20];
              }
            }

            v17 = [v15 countByEnumeratingWithState:&v54 objects:v73 count:16];
          }

          while (v17);
        }

        v4 = v48 + 1;
      }

      while (v48 + 1 != v46);
      v46 = [obj countByEnumeratingWithState:&v63 objects:v75 count:16];
    }

    while (v46);
  }

  v23 = [v3 hmf_isEmpty];
  v24 = objc_autoreleasePoolPush();
  v25 = v45;
  v26 = HMFGetOSLogHandle();
  v27 = os_log_type_enabled(v26, OS_LOG_TYPE_INFO);
  if (v23)
  {
    v28 = v49;
    if (v27)
    {
      v29 = HMFGetLogIdentifier();
      *buf = 138543362;
      v70 = v29;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Not refreshing characteristics as read requests are empty", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v24);
  }

  else
  {
    v28 = v49;
    if (v27)
    {
      v30 = HMFGetLogIdentifier();
      v31 = [v3 count];
      *buf = 138543618;
      v70 = v30;
      v71 = 2048;
      v72 = v31;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Issuing %ld characteristic read requests when Home app enabled notifications", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    v32 = MEMORY[0x277D0F818];
    v33 = [MEMORY[0x277D0F820] allMessageDestinations];
    v67 = @"kMultiPartResponseKey";
    v68 = MEMORY[0x277CBEC38];
    v34 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v68 forKeys:&v67 count:1];
    v35 = [v32 messageWithName:@"kMultipleCharacteristicReadRequestKey" destination:v33 payload:v34];

    v36 = objc_autoreleasePoolPush();
    v37 = v25;
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
    {
      v39 = HMFGetLogIdentifier();
      v40 = [v35 identifier];
      *buf = 138543618;
      v70 = v39;
      v71 = 2114;
      v72 = v40;
      _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: App enabled notifications", buf, 0x16u);

      v28 = v49;
    }

    objc_autoreleasePoolPop(v36);
    v41 = [v3 copy];
    v50[0] = MEMORY[0x277D85DD0];
    v50[1] = 3221225472;
    v50[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1695;
    v50[3] = &unk_279730A88;
    v51 = v3;
    v52 = v37;
    v53 = v28;
    [(HMDHome *)v37 _readCharacteristicValues:v41 requestMessage:v35 source:1120 withCompletionHandler:v50];
  }

  v42 = *MEMORY[0x277D85DE8];
}

uint64_t __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 type];
  v5 = [v3 service];

  v6 = [v5 type];

  v7 = [*(a1 + 32) dataSource];
  v8 = [v7 hapMetadata];
  v9 = [v8 shouldRefreshValueForCharacteristicWithType:v4 serviceType:v6];

  return v9;
}

void __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1695(uint64_t a1, void *a2, void *a3)
{
  v59 = *MEMORY[0x277D85DE8];
  v36 = a2;
  v37 = a3;
  v47 = 0u;
  v48 = 0u;
  v49 = 0u;
  v50 = 0u;
  v5 = a1;
  obj = *(a1 + 32);
  v6 = [obj countByEnumeratingWithState:&v47 objects:v58 count:16];
  if (v6)
  {
    v8 = v6;
    v9 = *v48;
    *&v7 = 138543874;
    v33 = v7;
    v34 = *v48;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v48 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v47 + 1) + 8 * i);
        v12 = [v11 characteristic];
        v46 = 0;
        v13 = [v37 hmd_valueOfCharacteristic:v12 error:&v46];
        v14 = v46;

        v15 = objc_autoreleasePoolPush();
        v16 = *(v5 + 40);
        v17 = HMFGetOSLogHandle();
        v18 = v17;
        if (v13)
        {
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
            goto LABEL_12;
          }

          v19 = HMFGetLogIdentifier();
          *buf = v33;
          v53 = v19;
          v54 = 2112;
          v55 = v11;
          v56 = 2112;
          v57 = v13;
          v20 = v18;
          v21 = OS_LOG_TYPE_INFO;
          v22 = "%{public}@Characteristic read request succeeded when Home app enabled notifications %@:%@";
        }

        else
        {
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_12;
          }

          v19 = HMFGetLogIdentifier();
          *buf = v33;
          v53 = v19;
          v54 = 2112;
          v55 = v11;
          v56 = 2112;
          v57 = v14;
          v20 = v18;
          v21 = OS_LOG_TYPE_ERROR;
          v22 = "%{public}@Characteristic read request when Home app enabled notification failed %@:%@";
        }

        _os_log_impl(&dword_2531F8000, v20, v21, v22, buf, 0x20u);

        v9 = v34;
LABEL_12:

        objc_autoreleasePoolPop(v15);
      }

      v8 = [obj countByEnumeratingWithState:&v47 objects:v58 count:16];
    }

    while (v8);
  }

  v44 = 0u;
  v45 = 0u;
  v42 = 0u;
  v43 = 0u;
  v23 = *(v5 + 48);
  v24 = [v23 countByEnumeratingWithState:&v42 objects:v51 count:16];
  if (v24)
  {
    v25 = v24;
    v26 = *v43;
    do
    {
      for (j = 0; j != v25; ++j)
      {
        if (*v43 != v26)
        {
          objc_enumerationMutation(v23);
        }

        v28 = *(*(&v42 + 1) + 8 * j);
        v29 = [v28 workQueue];
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1696;
        block[3] = &unk_279734870;
        block[4] = v28;
        v30 = v37;
        v31 = *(v5 + 40);
        v39 = v30;
        v40 = v31;
        v41 = v36;
        dispatch_async(v29, block);
      }

      v25 = [v23 countByEnumeratingWithState:&v42 objects:v51 count:16];
    }

    while (v25);
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1696(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v18 = 0;
  v4 = [v2 updateSettingsWithReadCharacteristicResponsePayload:v3 error:&v18];
  v5 = v18;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 48);
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v4)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 32);
      *buf = 138543874;
      v20 = v10;
      v21 = 2112;
      v22 = v11;
      v23 = 2112;
      v24 = v4;
      v12 = "%{public}@Successfully updated light profile settings %@:%@";
      v13 = v9;
      v14 = OS_LOG_TYPE_INFO;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v13, v14, v12, buf, 0x20u);
    }
  }

  else if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v15 = *(a1 + 32);
    v16 = *(a1 + 56);
    *buf = 138543874;
    v20 = v10;
    v21 = 2112;
    v22 = v15;
    v23 = 2112;
    v24 = v16;
    v12 = "%{public}@Failed to update light profile settings %@:%@";
    v13 = v9;
    v14 = OS_LOG_TYPE_ERROR;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v6);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForWalletKeyChange:(id)a3 message:(id)a4
{
  v17 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543362;
    v16 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has onboarded for wallet key value changed, sending notification", &v15, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [v6 hasOnboardedForWalletKey];
  -[HMDHome setHasOnboardedForWalletKey:](v9, "setHasOnboardedForWalletKey:", [v12 BOOLValue]);

  v13 = [(HMDHome *)v9 notificationCenter];
  [v13 postNotificationName:@"HMDHomeHasOnboardedForWalletKeyChangeNotification" object:v9];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForAccessCodeChange:(id)a3 message:(id)a4
{
  v17 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543362;
    v16 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has onboarded for access code value changed, sending notification", &v15, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [v6 hasOnboardedForAccessCode];
  -[HMDHome setHasOnboardedForAccessCode:](v9, "setHasOnboardedForAccessCode:", [v12 BOOLValue]);

  v13 = [(HMDHome *)v9 notificationCenter];
  [v13 postNotificationName:@"HMDHomeHasOnboardedForAccessCodeChangeNotification" object:v9];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:(id)a3 message:(id)a4
{
  v16 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v14 = 138543362;
    v15 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has any user acknowledged camera recording onboarding value changed, sending notification", &v14, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [v6 hasAnyUserAcknowledgedCameraRecordingOnboarding];
  -[HMDHome setHasAnyUserAcknowledgedCameraRecordingOnboarding:](v9, "setHasAnyUserAcknowledgedCameraRecordingOnboarding:", [v12 BOOLValue]);

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleResolveThreadNetworkRequest:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v21 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve thread network credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = +[HMDThreadNetworkMetadataStore defaultStore];
  if (v9)
  {
    v10 = [(HMDHome *)v6 threadOperationalDataset];
    objc_initWeak(buf, v6);
    v11 = [(HMDHome *)v6 doesHomeContainResident];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __46__HMDHome__handleResolveThreadNetworkRequest___block_invoke;
    v17[3] = &unk_279723910;
    objc_copyWeak(&v19, buf);
    v18 = v4;
    [v9 retrieveMetadata:v10 homeHasResident:v11 completion:v17];

    objc_destroyWeak(&v19);
    objc_destroyWeak(buf);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = v6;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v21 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v10 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v4 respondWithError:v10];
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleResolveThreadNetworkRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v34 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = WeakRetained;
  if (v5 && WeakRetained)
  {
    v25 = 0;
    v9 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v5 requiringSecureCoding:1 error:&v25];
    v10 = v25;
    if (v9)
    {
      v11 = *(a1 + 32);
      v26 = *MEMORY[0x277CD0620];
      v27 = v9;
      v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
      [v11 respondWithPayload:v12];
    }

    else
    {
      v19 = objc_autoreleasePoolPush();
      v20 = v8;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138543618;
        v29 = v22;
        v30 = 2112;
        v31 = v10;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Unable to encode credentials: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v19);
      v23 = *(a1 + 32);
      v12 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
      [v23 respondWithError:v12];
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = v8;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v14 threadNetworkID];
      *buf = 138543874;
      v29 = v16;
      v30 = 2112;
      v31 = v17;
      v32 = 2112;
      v33 = v6;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network '%@': %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v18 = *(a1 + 32);
    v10 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v18 respondWithError:v10];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeUpdateDidOnboardLocationServicesRequest:(id)a3
{
  v35 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v32 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update did onboard locations services request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [v4 messagePayload];
  v11 = *MEMORY[0x277CCFEB0];
  v30 = 0;
  v12 = [v10 hmf_BOOLForKey:v11 error:&v30];
  v13 = v30;

  if (v13)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = v7;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v4 messagePayload];
      *buf = 138543618;
      v32 = v17;
      v33 = 2112;
      v34 = v18;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode did onboard location services from update request payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    [v4 respondWithError:v13];
  }

  else
  {
    v19 = [HMDHomeModel alloc];
    v20 = [(HMDHome *)v7 uuid];
    v21 = [(HMDHome *)v7 homeManager];
    v22 = [v21 uuid];
    v23 = [(HMDBackingStoreModelObject *)v19 initWithObjectChangeType:2 uuid:v20 parentUUID:v22];

    v24 = [MEMORY[0x277CCABB0] numberWithBool:v12];
    [(HMDHomeModel *)v23 setDidOnboardLocationServices:v24];

    v25 = [(HMDHome *)v7 backingStore];
    v26 = [v4 name];
    v27 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v28 = [v25 transaction:v26 options:v27];

    [v28 add:v23 withMessage:v4];
    [v28 run];
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleDidOnboardLocationServicesChange:(id)a3 message:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 didOnboardLocationServices];
  v9 = [v8 BOOLValue];

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    v16 = 138543618;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Updating did onboard location services: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  [(HMDHome *)v11 setDidOnboardLocationServices:v9];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeUpdateLocationServicesEnabledRequest:(id)a3
{
  v25 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v22 = v9;
    v23 = 2112;
    v24 = v4;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update location services enabled request message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [v4 messagePayload];
  v11 = *MEMORY[0x277CD0050];
  v20 = 0;
  v12 = [v10 hmf_BOOLForKey:v11 error:&v20];
  v13 = v20;

  if (v13)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = v7;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v4 messagePayload];
      *buf = 138543618;
      v22 = v17;
      v23 = 2112;
      v24 = v18;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode location services enabled from update request payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    [v4 respondWithError:v13];
  }

  else
  {
    [(HMDHome *)v7 runLocationServicesEnabledUpdateWithValue:v12 message:v4];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)_handleLocationServicesEnabledChange:(id)a3 message:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 locationServicesEnabled];
  v9 = [v8 BOOLValue];

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    v16 = 138543618;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Updating location services enabled: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  [(HMDHome *)v11 setLocationServicesEnabled:v9];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleSoundCheckUpdateRequest:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v27 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update soundCheck request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  v11 = [(HMDHome *)v7 uuid];
  v12 = [(HMDHome *)v7 homeManager];
  v13 = [v12 uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:v11 parentUUID:v13];

  v15 = [v4 messagePayload];
  v16 = *MEMORY[0x277CD05F0];
  v25 = 0;
  v17 = [v15 hmf_BOOLForKey:v16 error:&v25];
  v18 = v25;

  if (v18)
  {
    [v4 respondWithError:v18];
  }

  else
  {
    v19 = [MEMORY[0x277CCABB0] numberWithBool:v17];
    [(HMDHomeModel *)v14 setSoundCheckEnabled:v19];

    v20 = [(HMDHome *)v7 backingStore];
    v21 = [v4 name];
    v22 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v23 = [v20 transaction:v21 options:v22];

    [v23 add:v14 withMessage:v4];
    [v23 run];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleSoundCheckChange:(id)a3 message:(id)a4
{
  v5 = [a3 soundCheckEnabled];
  -[HMDHome setSoundCheckEnabled:](self, "setSoundCheckEnabled:", [v5 BOOLValue]);
}

- (void)enableUserListeningHistoryForAccessoryUUID:(id)a3 userUUID:(id)a4
{
  v22 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self userWithUUID:v7];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  v12 = v11;
  if (v8)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v13;
      v18 = 2112;
      v19 = v6;
      v20 = 2112;
      v21 = v8;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Enable ULH: accessoryUUID %@ user %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [(HMDHome *)v8 enableUserListeningHistoryForAccessory:v6];
  }

  else
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v14;
      v18 = 2112;
      v19 = v7;
      v20 = 2112;
      v21 = v10;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@No user exist for userUUID %@ in home %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:(id)a3
{
  v4 = a3;
  v5 = __decodeAndVerifyCurrentUser(self, v4);
  [v5 handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:v4];
}

- (void)_handleMediaContentProfileAccessControlUpdate:(id)a3
{
  v4 = a3;
  v5 = __decodeAndVerifyCurrentUser(self, v4);
  [v5 handleMediaContentProfileAccessControlUpdate:v4];
}

- (void)_handleAssistantAccessControlUpdate:(id)a3
{
  v4 = a3;
  v5 = __decodeAndVerifyCurrentUser(self, v4);
  [v5 handleAssistantAccessControlUpdate:v4];
}

- (void)_handleSiriPhraseOptionsUpdateRequest:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v24 = 138543362;
    v25 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update Siri phrase options request", &v24, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  v11 = [(HMDHome *)v7 uuid];
  v12 = [(HMDHome *)v7 homeManager];
  v13 = [v12 uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:v11 parentUUID:v13];

  v15 = [v4 messagePayload];
  v16 = [v15 hmf_numberForKey:*MEMORY[0x277CD05E0]];
  v17 = [v16 unsignedIntegerValue];

  v18 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v17];
  [(HMDHomeModel *)v14 setSiriPhraseOptions:v18];

  v19 = [(HMDHome *)v7 backingStore];
  v20 = [v4 name];
  v21 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v22 = [v19 transaction:v20 options:v21];

  [v22 add:v14 withMessage:v4];
  [v22 run];

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_handleSiriPhraseOptionsStatusChange:(id)a3 message:(id)a4
{
  v5 = [a3 siriPhraseOptions];
  -[HMDHome setSiriPhraseOptions:](self, "setSiriPhraseOptions:", [v5 unsignedIntegerValue]);
}

- (void)_handleMultiUserEnabledChange:(id)a3 message:(id)a4
{
  v23 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v21 = 138543362;
    v22 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Multi-user enabled changed, sending notification", &v21, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [v6 multiUserEnabled];
  -[HMDHome setMultiUserEnabled:](v9, "setMultiUserEnabled:", [v12 BOOLValue]);

  v13 = [(HMDHome *)v9 notificationCenter];
  v14 = *MEMORY[0x277CD0448];
  [v13 postNotificationName:*MEMORY[0x277CD0448] object:0];

  v15 = MEMORY[0x277D0F848];
  v16 = [(HMDHome *)v9 messageDestination];
  v17 = [v15 messageWithName:v14 destination:v16 payload:0];

  v18 = [v7 identifier];
  [v17 setIdentifier:v18];

  [v17 setRemote:{objc_msgSend(v7, "isRemote")}];
  v19 = [(HMDHome *)v9 msgDispatcher];
  [v19 sendMessage:v17 completionHandler:0];

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForAccessCodeMessage:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v19 = 138543618;
    v20 = v8;
    v21 = 2112;
    v22 = v4;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling message to set has onboarded for access code: %@", &v19, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDHomeModel alloc];
  v10 = [(HMDHome *)v6 uuid];
  v11 = [(HMDHome *)v6 homeManager];
  v12 = [v11 uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:v10 parentUUID:v12];

  [(HMDHomeModel *)v13 setHasOnboardedForAccessCode:MEMORY[0x277CBEC38]];
  v14 = [(HMDHome *)v6 backingStore];
  v15 = [v4 name];
  v16 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v17 = [v14 transaction:v15 options:v16];

  [v17 add:v13 withMessage:v4];
  [v17 run];

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest:(id)a3
{
  v24 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Received set has any user acknowledged camera recording onboarding request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDHomeModel alloc];
  v10 = [(HMDHome *)v6 uuid];
  v11 = [(HMDHome *)v6 homeManager];
  v12 = [v11 uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:v10 parentUUID:v12];

  [(HMDHomeModel *)v13 setHasAnyUserAcknowledgedCameraRecordingOnboarding:MEMORY[0x277CBEC38]];
  v14 = [(HMDHome *)v6 backingStore];
  v15 = [v4 name];
  v16 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v17 = [v14 transaction:v15 options:v16];

  [v17 add:v13 withMessage:v4];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __76__HMDHome__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest___block_invoke;
  v20[3] = &unk_2797359D8;
  v21 = v4;
  v18 = v4;
  [v17 run:v20];

  v19 = *MEMORY[0x277D85DE8];
}

uint64_t __76__HMDHome__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithSuccess];
  }
}

- (void)enableMultiUser
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v12 = 138543362;
    v13 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Received local request to enable Multi-User", &v12, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v7 = MEMORY[0x277D0F818];
  v8 = *MEMORY[0x277CCFEE8];
  v9 = [(HMDHome *)v4 messageDestination];
  v10 = [v7 messageWithName:v8 destination:v9 payload:MEMORY[0x277CBEC10]];

  [(HMDHome *)v4 _enableMultiUserWithMessage:v10];
  v11 = *MEMORY[0x277D85DE8];
}

- (void)_enableMultiUserWithMessage:(void *)a1
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (a1)
  {
    if ([a1 isMultiUserEnabled])
    {
      [v3 respondWithSuccess];
    }

    else
    {
      v4 = objc_autoreleasePoolPush();
      v5 = a1;
      v6 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = HMFGetLogIdentifier();
        v18 = 138543362;
        v19 = v7;
        _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Received enable multi-user request", &v18, 0xCu);
      }

      objc_autoreleasePoolPop(v4);
      v8 = [HMDHomeModel alloc];
      v9 = [v5 uuid];
      v10 = [v5 homeManager];
      v11 = [v10 uuid];
      v12 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v9 parentUUID:v11];

      [(HMDHomeModel *)v12 setMultiUserEnabled:MEMORY[0x277CBEC38]];
      v13 = [v5 backingStore];
      v14 = [v3 name];
      v15 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
      v16 = [v13 transaction:v14 options:v15];

      [v16 add:v12 withMessage:v3];
      [v16 run];
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleEnableMultiUserRequest:(id)a3
{
  v41 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isRemote] && (objc_msgSend(v4, "isSecureRemote") & 1) == 0)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v38 = v13;
      v39 = 2112;
      v40 = v4;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    [v4 respondWithError:v14];
  }

  else
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      [(HMDHome *)self _enableMultiUserWithMessage:v4];
      goto LABEL_16;
    }

    v5 = [(HMDHome *)self primaryResident];
    if (!v5)
    {
      v6 = objc_autoreleasePoolPush();
      v15 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v16;
        _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to forward message to home owner no resident found", buf, 0xCu);
      }

      goto LABEL_15;
    }

    if (([v4 isRemote] & 1) != 0 || objc_msgSend(v4, "BOOLForKey:", @"kDoNotForwardMessageKey"))
    {
      v6 = objc_autoreleasePoolPush();
      v7 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v9;
        _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Did not expect remote message.", buf, 0xCu);
      }

LABEL_15:

      objc_autoreleasePoolPop(v6);
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v17];

      goto LABEL_16;
    }

    v19 = [v4 mutableCopy];
    [v19 setRemote:1];
    [v19 setSecureRemote:1];
    v35 = @"kDoNotForwardMessageKey";
    v36 = MEMORY[0x277CBEC38];
    v20 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    [v19 setMessagePayload:v20];

    v21 = [HMDRemoteDeviceMessageDestination alloc];
    v22 = [v4 destination];
    v23 = [v22 target];
    v24 = [v5 device];
    v25 = [(HMDRemoteDeviceMessageDestination *)v21 initWithTarget:v23 device:v24];
    [v19 setDestination:v25];

    objc_initWeak(&location, self);
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __41__HMDHome__handleEnableMultiUserRequest___block_invoke;
    v31[3] = &unk_279733AE8;
    objc_copyWeak(&v33, &location);
    v32 = v4;
    [v19 setResponseHandler:v31];
    v26 = objc_autoreleasePoolPush();
    v27 = self;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
    {
      v29 = HMFGetLogIdentifier();
      *buf = 138543362;
      v38 = v29;
      _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Forwarding enable multi-user request to owner.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v26);
    v30 = [(HMDHome *)v27 msgDispatcher];
    [v30 sendMessage:v19];

    objc_destroyWeak(&v33);
    objc_destroyWeak(&location);
  }

LABEL_16:

  v18 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleEnableMultiUserRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v11;
    v17 = 2112;
    v18 = v5;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Enabled multi-user on the home error: %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [*(a1 + 32) responseHandler];

  if (v12)
  {
    v13 = [*(a1 + 32) responseHandler];
    (v13)[2](v13, v5, v6);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_configureConfiguredResident:(id)a3 desiredConfigState:(unint64_t)a4 message:(id)a5
{
  v32 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  if (a4 == 1)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v28 = 138543362;
      v29 = v13;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Unconfiguring residents is not supported", &v28, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [v9 responseHandler];

    if (v14)
    {
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48 description:0 reason:0 suggestion:0];
      v16 = [v9 responseHandler];
      (v16)[2](v16, v15, 0);
LABEL_17:
    }
  }

  else
  {
    v17 = [v8 configurationState];
    [(HMDHome *)self _updateConfigurationStateForResidentDevice:v8 desiredConfigState:a4 message:v9];
    if (v17 != a4)
    {
      v15 = [(HMDHome *)self homeManager];
      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      v21 = os_log_type_enabled(v20, OS_LOG_TYPE_INFO);
      if (a4 == 2)
      {
        if (v21)
        {
          v22 = HMFGetLogIdentifier();
          v23 = [v8 displayName];
          v28 = 138543618;
          v29 = v22;
          v30 = 2112;
          v31 = v23;
          _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Enabling resident device %@, checking if we need to go remote", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
      }

      else
      {
        if (v21)
        {
          v24 = HMFGetLogIdentifier();
          v25 = [v8 displayName];
          v28 = 138543618;
          v29 = v24;
          v30 = 2112;
          v31 = v25;
          _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Disabling resident device %@, checking if we need to go remote", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
        v26 = [(HMDHome *)v19 uuid];
        [v15 teardownRemoteAccessForHome:v26];
      }

      if (![(HMDHome *)v19 isResidentSupported])
      {
        [v15 checkForRemotePeers];
      }

      v16 = [v9 name];
      [(HMDHome *)v19 saveWithReason:v16 postSyncNotification:0];
      goto LABEL_17;
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_addResidentWithUsername:(id)a3 publicKey:(id)a4 destination:(id)a5
{
  v38 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v11);

  if (v8 && v9)
  {
    v12 = [(HMDHome *)self unconfiguredResidentDevices];
    v13 = [v12 hmf_firstObjectWithValue:v10 forKeyPath:@"userID"];

    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    v18 = v17;
    if (isKindOfClass)
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        *buf = 138543362;
        v33 = v19;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Found user as unconfigured resident, creating an accepted invitation to track adding the resident", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v15);
      v20 = [[HMDOutgoingHomeInvitation alloc] initWithInvitee:v13 invitationState:5 forHome:v16 expiryDate:0 messageIdentifier:0];
      [(HMDHome *)v16 addOutgoingInvitation:v20];
      objc_initWeak(buf, v16);
      v28[0] = MEMORY[0x277D85DD0];
      v28[1] = 3221225472;
      v28[2] = __58__HMDHome__addResidentWithUsername_publicKey_destination___block_invoke;
      v28[3] = &unk_279731988;
      objc_copyWeak(&v31, buf);
      v29 = v13;
      v21 = v20;
      v30 = v21;
      [(HMDHome *)v16 __handleAcceptedOutgoingInvitationResponse:v21 destinationAddress:v10 publicKey:v9 username:v8 issuerPublicKeyER:0 presenceAuthStatus:0 completionHandler:v28];

      objc_destroyWeak(&v31);
      objc_destroyWeak(buf);
    }

    else
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543618;
        v33 = v26;
        v34 = 2112;
        v35 = v10;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Attempt to pair an unknown resident user '%@', aborting", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
    }
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543874;
      v33 = v25;
      v34 = 2112;
      v35 = v8;
      v36 = 2112;
      v37 = v9;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Aborting adding resident due to missing userName '%@' and publicKey '%@'", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __58__HMDHome__addResidentWithUsername_publicKey_destination___block_invoke(id *a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (shouldLogPrivateInformation())
  {
    v5 = [a1[4] userID];
  }

  else
  {
    v5 = @"...";
    v6 = @"...";
  }

  v7 = objc_autoreleasePoolPush();
  v8 = WeakRetained;
  v9 = HMFGetOSLogHandle();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);
  if (v3)
  {
    if (v10)
    {
      v11 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = v5;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to add resident user '%@' invitation with error: %@", &v16, 0x20u);
    }
  }

  else if (v10)
  {
    v12 = HMFGetLogIdentifier();
    v13 = [a1[5] identifier];
    v14 = [v13 UUIDString];
    v16 = 138543874;
    v17 = v12;
    v18 = 2112;
    v19 = v5;
    v20 = 2112;
    v21 = v14;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@Tracking adding resident user '%@' with accepted and pending invitation '%@'", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v15 = *MEMORY[0x277D85DE8];
}

- (void)_sendResidentInviteWithDestination:(id)a3
{
  v47 = *MEMORY[0x277D85DE8];
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v6)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [v6 device];
      v13 = [v12 remoteDestinationString];
      *buf = 138543618;
      v42 = v11;
      v43 = 2112;
      v44 = v13;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Adding user %@ as remote access point", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    v14 = [(HMDHome *)v8 homeManager];
    v37 = 0;
    v38 = 0;
    v36 = 0;
    v15 = [v14 getOrCreateControllerPublicKey:&v38 controllerUsername:&v37 error:&v36];
    v16 = v38;
    v32 = v37;
    v31 = v36;
    if (v15)
    {
      v39[0] = *MEMORY[0x277CD23D0];
      v17 = [(HMDHome *)v8 name];
      v40[0] = v17;
      v39[1] = *MEMORY[0x277CD0640];
      v18 = [(HMDHome *)v8 uuid];
      v19 = [v18 UUIDString];
      v40[1] = v19;
      v39[2] = @"kControllerPublicKey";
      v20 = v16;
      if (!v16)
      {
        v20 = [MEMORY[0x277CBEB68] null];
      }

      v39[3] = @"kControllerPairingNameKey";
      v40[2] = v20;
      v40[3] = v32;
      v30 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v40 forKeys:v39 count:4];
      if (!v16)
      {
      }

      v21 = [MEMORY[0x277D0F818] internalMessageWithName:@"kAddRemoteAccessRequestKey" destination:v4 messagePayload:v30];
      objc_initWeak(buf, v8);
      v33[0] = MEMORY[0x277D85DD0];
      v33[1] = 3221225472;
      v33[2] = __46__HMDHome__sendResidentInviteWithDestination___block_invoke;
      v33[3] = &unk_279733AE8;
      objc_copyWeak(&v35, buf);
      v34 = v6;
      [v21 setResponseHandler:v33];
      v22 = [v14 messageDispatcher];
      [v22 sendMessage:v21 completionHandler:0];

      objc_destroyWeak(&v35);
      objc_destroyWeak(buf);
    }

    else
    {
      v25 = objc_autoreleasePoolPush();
      v26 = v8;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        *buf = 138543362;
        v42 = v28;
        _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Failed getting controller public key to add remote gateway", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
    }
  }

  else
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      v24 = [(HMDHome *)v8 shortDescription];
      *buf = 138543874;
      v42 = v23;
      v43 = 2112;
      v44 = v24;
      v45 = 2112;
      v46 = v4;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@[%@] Invalid resident invite destination: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__sendResidentInviteWithDestination___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = WeakRetained;
  if (v5 || !v6)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = v8;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) device];
      v15 = [v14 remoteDestinationString];
      *buf = 138543874;
      v22 = v13;
      v23 = 2112;
      v24 = v15;
      v25 = 2112;
      v26 = v5;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to receive controller info to auto add user %@ due to error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
  }

  else if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __46__HMDHome__sendResidentInviteWithDestination___block_invoke_1689;
    block[3] = &unk_279734960;
    v18 = v6;
    v19 = v8;
    v20 = *(a1 + 32);
    dispatch_async(v9, block);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__sendResidentInviteWithDestination___block_invoke_1689(uint64_t a1)
{
  v6 = [*(a1 + 32) hmf_stringForKey:@"kControllerPairingNameKey"];
  v2 = [*(a1 + 32) hmf_dataForKey:@"kControllerPublicKey"];
  v3 = *(a1 + 40);
  v4 = [*(a1 + 48) device];
  v5 = [v4 remoteDestinationString];
  [v3 _addResidentWithUsername:v6 publicKey:v2 destination:v5];
}

- (void)_configureUnconfiguredResident:(id)a3 desiredConfigState:(unint64_t)a4
{
  v77 = *MEMORY[0x277D85DE8];
  v59 = a3;
  v6 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v6);

  v7 = v59;
  v8 = [v59 configurationState];
  if (v8 != a4)
  {
    v58 = v8;
    v66 = 0u;
    v67 = 0u;
    v64 = 0u;
    v65 = 0u;
    v9 = [(HMDHome *)self outgoingInvitations];
    v10 = [v9 countByEnumeratingWithState:&v64 objects:v76 count:16];
    if (v10)
    {
      v11 = *v65;
      while (2)
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v65 != v11)
          {
            objc_enumerationMutation(v9);
          }

          v13 = [*(*(&v64 + 1) + 8 * i) user];
          v14 = [v13 userID];
          v15 = [v59 userID];
          v16 = [v14 isEqualToString:v15];

          if (v16)
          {
            v32 = objc_autoreleasePoolPush();
            v33 = self;
            v34 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
            {
              v35 = HMFGetLogIdentifier();
              v36 = [v59 userID];
              *buf = 138543618;
              v71 = v35;
              v72 = 2112;
              v73 = v36;
              _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_INFO, "%{public}@Already have a pending invitation for the resident user '%@', not setting up remote access", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v32);
            goto LABEL_34;
          }
        }

        v10 = [v9 countByEnumeratingWithState:&v64 objects:v76 count:16];
        if (v10)
        {
          continue;
        }

        break;
      }
    }

    if (a4 != 2 || v58 != 1)
    {
      v37 = objc_autoreleasePoolPush();
      v38 = self;
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
      {
        v40 = HMFGetLogIdentifier();
        v41 = [v59 displayName];
        *buf = 138543618;
        v71 = v40;
        v72 = 2112;
        v73 = v41;
        _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Cannot configure unconfigured resident %@ to desired state", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v37);
      goto LABEL_34;
    }

    v17 = [v59 userID];
    v18 = [(HMDHome *)self homeManager];
    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      v23 = [v59 displayName];
      *buf = 138543874;
      v71 = v22;
      v72 = 2112;
      v73 = v17;
      v74 = 2112;
      v75 = v23;
      _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Configuring unconfigured resident %@/%@ for remote access", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v19);
    v24 = [(HMDHome *)v20 hapAccessoryUniqueIdentifiers];
    v25 = [v24 allObjects];

    if ([v25 count])
    {
      v26 = [(HMDHome *)v20 pendingResponsesForRemoteAccessSetup];
      v27 = [v26 containsObject:v17];

      if (!v27)
      {
        v44 = [v18 uuid];
        v45 = [HMDMessageDispatcher destinationWithTarget:v44 userID:0 destination:v17 multicast:0];

        if (v45)
        {
          v46 = [(HMDHome *)v20 pendingResponsesForRemoteAccessSetup];
          [v46 addObject:v17];

          v69[0] = v25;
          v47 = *MEMORY[0x277CD0640];
          v68[0] = @"kAccessoryIdentitiesKey";
          v68[1] = v47;
          v48 = [(HMDHome *)v20 uuid];
          v49 = [v48 UUIDString];
          v69[1] = v49;
          v50 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v69 forKeys:v68 count:2];

          v51 = [MEMORY[0x277D0F818] internalMessageWithName:@"kDoYouSeeUnpairedAccessoriesKey" destination:v45 messagePayload:v50];
          objc_initWeak(buf, v20);
          v60[0] = MEMORY[0x277D85DD0];
          v60[1] = 3221225472;
          v60[2] = __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke;
          v60[3] = &unk_279735248;
          objc_copyWeak(&v63, buf);
          v61 = v17;
          v62 = v45;
          [v51 setResponseHandler:v60];
          v52 = [v18 messageDispatcher];
          [v52 sendMessage:v51 completionHandler:0];

          objc_destroyWeak(&v63);
          objc_destroyWeak(buf);
        }

        else
        {
          v53 = objc_autoreleasePoolPush();
          v54 = v20;
          v55 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v55, OS_LOG_TYPE_DEFAULT))
          {
            v56 = HMFGetLogIdentifier();
            *buf = 138543618;
            v71 = v56;
            v72 = 2112;
            v73 = v17;
            _os_log_impl(&dword_2531F8000, v55, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: could not create message destination for address: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v53);
        }

        goto LABEL_34;
      }

      v28 = objc_autoreleasePoolPush();
      v29 = v20;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v31 = HMFGetLogIdentifier();
        *buf = 138543362;
        v71 = v31;
        _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: there is already a pending request", buf, 0xCu);
      }
    }

    else
    {
      v28 = objc_autoreleasePoolPush();
      v42 = v20;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v43 = HMFGetLogIdentifier();
        *buf = 138543362;
        v71 = v43;
        _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: no accessory identifiers found", buf, 0xCu);
      }
    }

    objc_autoreleasePoolPop(v28);
LABEL_34:
    v7 = v59;
    goto LABEL_35;
  }

  [(HMDHome *)self _updateConfigurationStateForResidentDevice:v59 desiredConfigState:a4 message:0];
LABEL_35:

  v57 = *MEMORY[0x277D85DE8];
}

void __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v8 = WeakRetained;
  if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke_2;
    block[3] = &unk_2797352C0;
    block[4] = v8;
    v11 = a1[4];
    v12 = v5;
    v13 = v6;
    v14 = a1[5];
    dispatch_async(v9, block);
  }
}

void __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke_2(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) pendingResponsesForRemoteAccessSetup];
  [v2 removeObject:*(a1 + 40)];

  if (*(a1 + 48) || (v9 = *(a1 + 56)) == 0)
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 40);
      v8 = *(a1 + 48);
      v19 = 138543874;
      v20 = v6;
      v21 = 2112;
      v22 = v7;
      v23 = 2112;
      v24 = v8;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Remote peer %@ failed to look for accessories with error:%@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v3);
  }

  else
  {
    v10 = [v9 hmf_BOOLForKey:@"kAtHomeStateKey"];
    v11 = [*(a1 + 56) hmf_stringForKey:@"kDeviceNameKey"];
    v12 = v11;
    if (v10 && v11)
    {
      [*(a1 + 32) _sendResidentInviteWithDestination:*(a1 + 64)];
    }

    else
    {
      v13 = objc_autoreleasePoolPush();
      v14 = *(a1 + 32);
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        v17 = *(a1 + 40);
        v19 = 138543618;
        v20 = v16;
        v21 = 2112;
        v22 = v17;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Remote peer %@ is not at home", &v19, 0x16u);
      }

      objc_autoreleasePoolPop(v13);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_updateConfigurationStateForResidentDevice:(id)a3 desiredConfigState:(unint64_t)a4 message:(id)a5
{
  v22 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [v8 displayName];
    v16 = 138543874;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    v20 = 2048;
    v21 = a4;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Updated configuration state of resident %@ to %ld", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v10);
  if ([v8 configurationState] != a4)
  {
    [v8 setConfigurationState:a4];
    [(HMDHome *)v11 _notifyClientsOfUpdatedResidentUser:v8];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)notifyNewRemotePeersFound:(BOOL)a3 remoteUsersRemoved:(id)a4 forceRemoteNotificationRegistration:(BOOL)a5
{
  v8 = a4;
  v9 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __92__HMDHome_notifyNewRemotePeersFound_remoteUsersRemoved_forceRemoteNotificationRegistration___block_invoke;
  block[3] = &unk_27972EBD8;
  block[4] = self;
  v12 = v8;
  v13 = a3;
  v14 = a5;
  v10 = v8;
  dispatch_async(v9, block);
}

void __92__HMDHome_notifyNewRemotePeersFound_remoteUsersRemoved_forceRemoteNotificationRegistration___block_invoke(uint64_t a1)
{
  v54 = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277CBEB58];
  v3 = [*(a1 + 32) users];
  v40 = [v2 setWithArray:v3];

  v39 = [MEMORY[0x277CBEB58] setWithArray:*(a1 + 40)];
  [v40 intersectSet:v39];
  if ([v40 count])
  {
    v42 = [MEMORY[0x277CBEB18] array];
    v45 = 0u;
    v46 = 0u;
    v43 = 0u;
    v44 = 0u;
    obj = [v40 allObjects];
    v4 = [obj countByEnumeratingWithState:&v43 objects:v53 count:16];
    if (v4)
    {
      v5 = *v44;
      do
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v44 != v5)
          {
            objc_enumerationMutation(obj);
          }

          v7 = *(*(&v43 + 1) + 8 * i);
          if (shouldLogPrivateInformation())
          {
            v8 = [v7 userID];
          }

          else
          {
            v8 = @"...";
            v9 = @"...";
          }

          v10 = objc_autoreleasePoolPush();
          v11 = *(a1 + 32);
          v12 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
          {
            v13 = HMFGetLogIdentifier();
            *buf = 138543618;
            v50 = v13;
            v51 = 2112;
            v52 = v8;
            _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Removing remote user %@ since it has de-registered", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v10);
          v14 = [v7 userID];

          if (v14)
          {
            v15 = [v7 userID];
            [v42 addObject:v15];
          }

          [*(a1 + 32) _removeOutgoingInvitationForUser:v7];
          [*(a1 + 32) _removeUserFromContainer:v7];
        }

        v4 = [obj countByEnumeratingWithState:&v43 objects:v53 count:16];
      }

      while (v4);
    }

    v16 = *(a1 + 32);
    os_unfair_recursive_lock_lock_with_options();
    v17 = *(*(a1 + 32) + 32);
    v18 = [v40 allObjects];
    [v17 removeObjectsInArray:v18];

    os_unfair_recursive_lock_unlock();
    v47[0] = @"kUserIDsKey";
    v19 = [v42 copy];
    v47[1] = *MEMORY[0x277CD0640];
    v48[0] = v19;
    v20 = [*(a1 + 32) uuid];
    v21 = [v20 UUIDString];
    v48[1] = v21;
    v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v48 forKeys:v47 count:2];

    [*(a1 + 32) saveWithReason:@"kRemoteUsersDeregistered" information:v22 postSyncNotification:0];
  }

  v23 = [*(a1 + 32) localCapabilitiesDataSource];
  v24 = [v23 supportsRemoteAccess];

  if (v24)
  {
    v25 = [*(a1 + 32) homeManager];
    if (*(a1 + 48) == 1)
    {
      if ([*(a1 + 32) reachableAccessoriesCount])
      {
        if ([*(a1 + 32) allowsRemoteAccess])
        {
          v26 = [*(a1 + 32) currentUser];
          v27 = [v26 isRemoteAccessAllowed];

          if (v27)
          {
            v28 = objc_autoreleasePoolPush();
            v29 = *(a1 + 32);
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
            {
              v31 = HMFGetLogIdentifier();
              *buf = 138543362;
              v50 = v31;
              _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@We have potential remote gateways that can be auto setup, triggering detection", buf, 0xCu);
            }

            objc_autoreleasePoolPop(v28);
            v32 = [*(a1 + 32) uuid];
            [v25 accessoriesAreLocallyReachableOnTransientDevice:1 forHome:v32];
          }
        }
      }
    }

    if (([*(a1 + 32) remoteAccessIsEnabled] & 1) == 0 && (objc_msgSend(*(a1 + 32), "isResidentSupported") & 1) == 0)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = *(a1 + 32);
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543362;
        v50 = v36;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled, requesting electing a remote peer", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v33);
      v37 = [*(a1 + 32) uuid];
      [v25 electRemoteAccessPeerForHome:v37];
    }

    [(HMDHome *)*(a1 + 32) _subscribeForNotificationFromRemoteGateway:?];
  }

  v38 = *MEMORY[0x277D85DE8];
}

- (void)_subscribeForNotificationFromRemoteGateway:(void *)a1
{
  v24 = *MEMORY[0x277D85DE8];
  if (a1)
  {
    v4 = [a1 workQueue];
    dispatch_assert_queue_V2(v4);

    if ((a2 & 1) != 0 || ![a1 registeredNotificationWithRemoteGateway])
    {
      v9 = [a1 notificationRegistrations];
      v10 = [v9 count];

      v11 = objc_autoreleasePoolPush();
      v12 = a1;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v15 = [v12 notificationRegistrations];
        v16 = [v15 shortDescription];
        v18 = 138543874;
        v19 = v14;
        v20 = 2112;
        v21 = v16;
        v22 = 2048;
        v23 = v10;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with new remote gateway: %@/%lu", &v18, 0x20u);
      }

      objc_autoreleasePoolPop(v11);
      [v12 _subscribeForHomeNotificationsFromRemoteGateway:v10 != 0];
      [v12 setRegisteredNotificationWithRemoteGateway:1];
    }

    else
    {
      v5 = objc_autoreleasePoolPush();
      v6 = a1;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        v18 = 138543362;
        v19 = v8;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Already registered for notification with remote gateway, skipping", &v18, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_remoteAccessEnabled:(BOOL)a3
{
  v4 = [(HMDHome *)self hapAccessories];
  v5[0] = MEMORY[0x277D85DD0];
  v5[1] = 3221225472;
  v5[2] = __32__HMDHome__remoteAccessEnabled___block_invoke;
  v5[3] = &__block_descriptor_33_e25_v16__0__HMDHAPAccessory_8l;
  v6 = a3;
  [v4 na_each:v5];
}

- (void)remoteAccessEnabled:(BOOL)a3
{
  v5 = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __31__HMDHome_remoteAccessEnabled___block_invoke;
  v6[3] = &unk_279735D28;
  v6[4] = self;
  v7 = a3;
  dispatch_async(v5, v6);
}

uint64_t __31__HMDHome_remoteAccessEnabled___block_invoke(uint64_t a1)
{
  v48 = *MEMORY[0x277D85DE8];
  if (*(a1 + 40) == [*(a1 + 32) remoteAccessIsEnabled])
  {
    goto LABEL_25;
  }

  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v7 = HMFBooleanToString();
    *buf = 138543618;
    v45 = v5;
    v46 = 2112;
    v47 = v7;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Setting remote access enabled to %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  [*(a1 + 32) setRemoteAccessIsEnabled:*(a1 + 40)];
  if (*(a1 + 40) != 1)
  {
    v19 = [*(a1 + 32) WiFiAssertion];

    if (v19)
    {
      v20 = objc_autoreleasePoolPush();
      v21 = *(a1 + 32);
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v23;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Releasing WiFi assertion", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      v24 = [*(a1 + 32) wifiManager];
      v25 = [*(a1 + 32) WiFiAssertion];
      [v24 endActiveAssertion:v25];

      v26 = [*(a1 + 32) wifiManager];
      [v26 releaseWoWAssertion];

      [*(a1 + 32) setWiFiAssertion:0];
    }

    goto LABEL_16;
  }

  if (isWatch())
  {
    v8 = [*(a1 + 32) homeManager];
    if ([v8 isActive])
    {
      v9 = [*(a1 + 32) WiFiAssertion];

      if (v9)
      {
        goto LABEL_16;
      }

      v10 = objc_autoreleasePoolPush();
      v11 = *(a1 + 32);
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v13;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Taking WiFi assertion", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v10);
      v14 = [*(a1 + 32) wifiManager];
      v15 = MEMORY[0x277CCACA8];
      v16 = [*(a1 + 32) shortDescription];
      v17 = [v15 stringWithFormat:@"Remote Access for %@", v16];
      v18 = [v14 beginActiveAssertionWithOptions:0 reason:v17];
      [*(a1 + 32) setWiFiAssertion:v18];

      v8 = [*(a1 + 32) wifiManager];
      [v8 takeWoWAssertion];
    }
  }

LABEL_16:
  if (([*(a1 + 32) isResidentSupported] & 1) == 0)
  {
    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v27 = [*(a1 + 32) _residentUsers];
    v28 = [v27 countByEnumeratingWithState:&v39 objects:v43 count:16];
    if (v28)
    {
      v29 = v28;
      v30 = *v40;
      do
      {
        v31 = 0;
        do
        {
          if (*v40 != v30)
          {
            objc_enumerationMutation(v27);
          }

          [*(a1 + 32) _notifyClientsOfUpdatedResidentUser:*(*(&v39 + 1) + 8 * v31++)];
        }

        while (v29 != v31);
        v29 = [v27 countByEnumeratingWithState:&v39 objects:v43 count:16];
      }

      while (v29);
    }
  }

LABEL_25:
  v32 = objc_autoreleasePoolPush();
  v33 = *(a1 + 32);
  v34 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
  {
    v35 = HMFGetLogIdentifier();
    *buf = 138543362;
    v45 = v35;
    _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_INFO, "%{public}@Clearing history of all heartbeat queued messages to server", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v32);
  v36 = [*(a1 + 32) heartbeatPingMessagesQueuedWithServer];
  [v36 removeAllObjects];

  result = [*(a1 + 32) _remoteAccessEnabled:*(a1 + 40)];
  v38 = *MEMORY[0x277D85DE8];
  return result;
}

- (BOOL)remoteAccessIsEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  remoteAccessIsEnabled = self->_remoteAccessIsEnabled;
  os_unfair_recursive_lock_unlock();
  return remoteAccessIsEnabled;
}

- (void)setRemoteAccessEnabled:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_remoteAccessIsEnabled = a3;

  os_unfair_recursive_lock_unlock();
}

- (void)updateNetworkConnectivity:(BOOL)a3 companionReachable:(BOOL)a4
{
  v7 = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __56__HMDHome_updateNetworkConnectivity_companionReachable___block_invoke;
  v8[3] = &unk_27972C680;
  v8[4] = self;
  v9 = a3;
  v10 = a4;
  dispatch_async(v7, v8);
}

void __56__HMDHome_updateNetworkConnectivity_companionReachable___block_invoke(uint64_t a1)
{
  v14 = *MEMORY[0x277D85DE8];
  if (*(a1 + 40) != [*(a1 + 32) isNetworkAvailable])
  {
    [*(a1 + 32) setIsNetworkAvailable:?];
  }

  v2 = [*(a1 + 32) remoteEventRouterClientController];
  [v2 networkAvailabilityDidChange:*(a1 + 40)];

  if (isWatch() && *(a1 + 41) == 1)
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v6;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Companion is reachable, ignoring network connectivity update", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  else if ([*(a1 + 32) remoteAccessIsEnabled])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@We have no network connectivity, setting reachability state for all accessories to reflect their state", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    [*(a1 + 32) _remoteAccessEnabled:*(a1 + 40)];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)_residentDeviceAvailable
{
  v14 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isResidentSupported])
  {
    LOBYTE(v3) = 1;
  }

  else
  {
    v11 = 0u;
    v12 = 0u;
    v9 = 0u;
    v10 = 0u;
    v4 = [(HMDHome *)self _residentUsers];
    v3 = [v4 countByEnumeratingWithState:&v9 objects:v13 count:16];
    if (v3)
    {
      v5 = *v10;
      while (2)
      {
        for (i = 0; i != v3; ++i)
        {
          if (*v10 != v5)
          {
            objc_enumerationMutation(v4);
          }

          if ([*(*(&v9 + 1) + 8 * i) configurationState] == 2)
          {
            LOBYTE(v3) = 1;
            goto LABEL_13;
          }
        }

        v3 = [v4 countByEnumeratingWithState:&v9 objects:v13 count:16];
        if (v3)
        {
          continue;
        }

        break;
      }
    }

LABEL_13:
  }

  v7 = *MEMORY[0x277D85DE8];
  return v3;
}

- (id)_residentUsers
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = MEMORY[0x277CBEB18];
  v4 = [(HMDHome *)self users];
  v5 = [v3 arrayWithCapacity:{objc_msgSend(v4, "count")}];

  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v6 = [(HMDHome *)self users];
  v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v15;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v15 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v14 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [v5 addObject:v11];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v8);
  }

  v12 = *MEMORY[0x277D85DE8];

  return v5;
}

- (BOOL)isRemoteAccessDeviceReachable
{
  if (![(HMDHome *)self remoteAccessIsEnabled])
  {
    return 0;
  }

  v3 = [(HMDHome *)self primaryResident];
  v4 = ([v3 isReachable] & 1) != 0 || -[HMDHome isCompanionReachable](self, "isCompanionReachable");

  return v4;
}

- (void)handlePrimaryResidentChangeNotification:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 name];
    *buf = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = v9;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Received resident update notification: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [(HMDHome *)v6 workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __51__HMDHome_handlePrimaryResidentChangeNotification___block_invoke;
  v13[3] = &unk_2797359B0;
  v14 = v4;
  v15 = v6;
  v11 = v4;
  dispatch_async(v10, v13);

  v12 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome_handlePrimaryResidentChangeNotification___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_UUIDForKey:@"HMDResidentDeviceHomeUUIDNotificationKey"];

  v4 = [*(a1 + 40) uuid];
  v5 = [v4 hmf_isEqualToUUID:v3];

  if (v5)
  {
    if ([*(a1 + 40) isCurrentDeviceConfirmedPrimaryResident])
    {
      v6 = objc_autoreleasePoolPush();
      v7 = *(a1 + 40);
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = HMFGetLogIdentifier();
        v14 = 138543362;
        v15 = v9;
        _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Resetting accessory browsers", &v14, 0xCu);
      }

      objc_autoreleasePoolPop(v6);
      v10 = [*(a1 + 40) accessoryBrowser];
      [v10 restartBrowsers];

      [*(a1 + 40) _evaluateShouldRelaunchAndSetRelaunch];
      HMFUptime();
      v12 = *(a1 + 40);
    }

    else
    {
      v12 = *(a1 + 40);
      v11 = 0.0;
    }

    [v12 setCurrentDeviceBecamePrimaryTime:v11];
    [*(a1 + 40) _registerCameraReachabilityEventNotificationsWithCompletionHandler:0];
    HMFUptime();
    [*(a1 + 40) setPrimaryResidentChangedTime:?];
    [*(a1 + 40) _notifyThreadLayerOfResidentChange];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)handleRemoteDeviceBecameReachableNotification:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v8 = [(HMDHome *)self primaryResident];
    v9 = [v8 device];
    v10 = v9;
    if (v9 != v7)
    {

LABEL_14:
      goto LABEL_15;
    }

    v15 = [(HMDHome *)self supportsUnifiedMediaNotificationsOnResidents];

    if (v15)
    {
      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        *buf = 138543618;
        v23 = v19;
        v24 = 2112;
        v25 = v4;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Resubscribing for apple media accessory state on primary resident did become reachable notification %@ ", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      v8 = [(HMDHome *)v17 workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __57__HMDHome_handleRemoteDeviceBecameReachableNotification___block_invoke;
      block[3] = &unk_279735D00;
      block[4] = v17;
      dispatch_async(v8, block);
      goto LABEL_14;
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v23 = v14;
      v24 = 2112;
      v25 = v4;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Expected notification (%@) to contain device for reachability ", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
  }

LABEL_15:

  v20 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome_handleRemoteDeviceBecameReachableNotification___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v3 = [v1 primaryResident];
  v2 = [v3 device];
  [(HMDHome *)v1 _updateDirectAppleMediaNotificationsOnResidentChange:v2 previousResidentDevice:0];
}

- (void)_updateDirectAppleMediaNotificationsOnResidentChange:(void *)a3 previousResidentDevice:
{
  v47 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (a1)
  {
    v7 = [a1 workQueue];
    dispatch_assert_queue_V2(v7);

    v8 = [a1 notificationRegistrationsForAppleMediaAccessories];
    v9 = [v8 count];

    if (v9)
    {
      v10 = [a1 appleMediaAccessories];
      v11 = [v6 capabilities];
      if ([v11 supportsUnifiedMediaNotifications])
      {
      }

      else
      {
        v16 = [v5 capabilities];
        v17 = [v16 supportsUnifiedMediaNotifications];

        if (v17)
        {
          v41 = 0u;
          v42 = 0u;
          v39 = 0u;
          v40 = 0u;
          v34 = v10;
          v18 = v10;
          v19 = [v18 countByEnumeratingWithState:&v39 objects:v44 count:16];
          if (v19)
          {
            v20 = v19;
            v21 = *v40;
            do
            {
              for (i = 0; i != v20; ++i)
              {
                if (*v40 != v21)
                {
                  objc_enumerationMutation(v18);
                }

                v23 = *(*(&v39 + 1) + 8 * i);
                v24 = [v23 device];
                v25 = [v24 isEqual:v5];

                if ((v25 & 1) == 0)
                {
                  [(HMDHome *)a1 _enableMediaNotifications:v23 directlyOnMediaAccessory:0 completion:?];
                }
              }

              v20 = [v18 countByEnumeratingWithState:&v39 objects:v44 count:16];
            }

            while (v20);
          }

          v10 = v34;
          goto LABEL_29;
        }
      }

      v26 = [v6 capabilities];
      if ([v26 supportsUnifiedMediaNotifications])
      {
        v27 = [v5 capabilities];
        v28 = [v27 supportsUnifiedMediaNotifications];

        if (v28)
        {
LABEL_29:
          [a1 _refreshMediaProfilesOnHomeNotificationEnable];

          goto LABEL_30;
        }

        v37 = 0u;
        v38 = 0u;
        v35 = 0u;
        v36 = 0u;
        v26 = v10;
        v29 = [v26 countByEnumeratingWithState:&v35 objects:v43 count:16];
        if (v29)
        {
          v30 = v29;
          v31 = *v36;
          do
          {
            for (j = 0; j != v30; ++j)
            {
              if (*v36 != v31)
              {
                objc_enumerationMutation(v26);
              }

              [(HMDHome *)a1 _enableMediaNotifications:*(*(&v35 + 1) + 8 * j) directlyOnMediaAccessory:0 completion:?];
            }

            v30 = [v26 countByEnumeratingWithState:&v35 objects:v43 count:16];
          }

          while (v30);
        }
      }

      goto LABEL_29;
    }

    v12 = objc_autoreleasePoolPush();
    v13 = a1;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v46 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Skipping updated apple media notification registrations for remote devices because there are no clients registered.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

LABEL_30:

  v33 = *MEMORY[0x277D85DE8];
}

- (void)handleDeviceCapabilitiesUpdated:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v21 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Received notification to handle device capabilities update", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = v9;
  }

  else
  {
    v10 = 0;
  }

  v11 = v10;

  v12 = [(HMDHome *)v6 workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __43__HMDHome_handleDeviceCapabilitiesUpdated___block_invoke;
  block[3] = &unk_279734960;
  v17 = v4;
  v18 = v6;
  v19 = v11;
  v13 = v11;
  v14 = v4;
  dispatch_async(v12, block);

  v15 = *MEMORY[0x277D85DE8];
}

void __43__HMDHome_handleDeviceCapabilitiesUpdated___block_invoke(id *a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] userInfo];
  v3 = [v2 objectForKeyedSubscript:@"HMDDeviceCapabilitiesUpdatedDifferingFieldsNotificationKey"];

  v17 = 0u;
  v18 = 0u;
  v15 = 0u;
  v16 = 0u;
  v4 = v3;
  v5 = [v4 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v16;
    do
    {
      v8 = 0;
      do
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v4);
        }

        if ([*(*(&v15 + 1) + 8 * v8) isEqualToString:{@"supportsCameraRecordingReachabilityNotifications", v15}])
        {
          [a1[5] _registerCameraReachabilityEventNotificationsWithCompletionHandler:0];
        }

        ++v8;
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v6);
  }

  v9 = [a1[5] primaryResident];
  v10 = [v9 device];

  v11 = [v10 capabilities];
  v12 = v11;
  if (v11 == a1[6])
  {
    v13 = [v4 containsObject:@"supportsUnifiedMediaNotifications"];

    if (v13 && [a1[6] supportsUnifiedMediaNotifications])
    {
      [(HMDHome *)a1[5] _updateDirectAppleMediaNotificationsOnResidentChange:v10 previousResidentDevice:0];
    }
  }

  else
  {
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleResidentChange
{
  v35 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setMigratingAfterResidentChange:0];
  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v29 = 0u;
  v3 = [(HMDHome *)self triggers];
  v4 = [v3 countByEnumeratingWithState:&v28 objects:v34 count:16];
  if (v4)
  {
    v5 = *v29;
    v6 = MEMORY[0x277D85DD0];
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v29 != v5)
        {
          objc_enumerationMutation(v3);
        }

        v8 = *(*(&v28 + 1) + 8 * i);
        objc_initWeak(location, v8);
        v26[0] = v6;
        v26[1] = 3221225472;
        v26[2] = __32__HMDHome__handleResidentChange__block_invoke;
        v26[3] = &unk_279734708;
        objc_copyWeak(&v27, location);
        [v8 activateAfterResidentChangeWithCompletion:v26];
        objc_destroyWeak(&v27);
        objc_destroyWeak(location);
      }

      v4 = [v3 countByEnumeratingWithState:&v28 objects:v34 count:16];
    }

    while (v4);
  }

  if ([(HMDHome *)self isOwnerUser]&& ![(HMDHome *)self isResidentSupported]&& !isWatch())
  {
    v24 = 0u;
    v25 = 0u;
    v22 = 0u;
    v23 = 0u;
    v9 = [(HMDHome *)self users];
    v10 = [v9 countByEnumeratingWithState:&v22 objects:v33 count:16];
    if (v10)
    {
      v11 = *v23;
      do
      {
        for (j = 0; j != v10; ++j)
        {
          if (*v23 != v11)
          {
            objc_enumerationMutation(v9);
          }

          v13 = *(*(&v22 + 1) + 8 * j);
          if ([v13 isAdministrator] && objc_msgSend(v13, "updateAdministrator:", 0))
          {
            [(HMDHome *)self saveWithReason:@"migration" postSyncNotification:0];
          }
        }

        v10 = [v9 countByEnumeratingWithState:&v22 objects:v33 count:16];
      }

      while (v10);
    }
  }

  v14 = objc_autoreleasePoolPush();
  v15 = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    v17 = HMFGetLogIdentifier();
    LODWORD(location[0]) = 138543362;
    *(location + 4) = v17;
    _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Calling presence feeder to notify the presence status to the new resident", location, 0xCu);
  }

  objc_autoreleasePoolPop(v14);
  v18 = [(HMDHome *)v15 presenceMonitor];
  [v18 residentChanged];

  v19 = [(HMDHome *)v15 presenceFeeder];
  [v19 residentChanged];

  v20 = [(HMDHome *)v15 periodicReader];
  [v20 residentUpdated];

  [(HMDHome *)v15 _evaluateNetworkProtectionAndRouterManagement];
  v21 = *MEMORY[0x277D85DE8];
}

void __32__HMDHome__handleResidentChange__block_invoke(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543618;
      v11 = v8;
      v12 = 2112;
      v13 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Activating trigger after resident change finished with error (%@)", &v10, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)migrateAfterResidentChange
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v16 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@migrateAfterResidentChange", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  if ([(HMDHome *)v4 isMigratingAfterResidentChange])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = v4;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v16 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Migration after resident change is already running", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
  }

  else
  {
    [(HMDHome *)v4 setMigratingAfterResidentChange:1];
    objc_initWeak(buf, v4);
    v11 = [(HMDHome *)v4 backingStore];
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __37__HMDHome_migrateAfterResidentChange__block_invoke;
    v13[3] = &unk_279734708;
    objc_copyWeak(&v14, buf);
    [v11 submitBlock:v13];

    objc_destroyWeak(&v14);
    objc_destroyWeak(buf);
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __37__HMDHome_migrateAfterResidentChange__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _handleResidentChange];
}

- (void)removeResidentCapableDevice:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self isOwnerUser])
  {
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v5 = [(HMDHome *)self residentDeviceManager];
    v6 = [v5 residentDevices];

    v7 = [v6 countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (v7)
    {
      v8 = v7;
      v9 = *v22;
      while (2)
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v22 != v9)
          {
            objc_enumerationMutation(v6);
          }

          v11 = *(*(&v21 + 1) + 8 * i);
          v12 = [v11 device];
          v13 = [v12 isEqual:v4];

          if (v13)
          {
            v19 = [(HMDHome *)self residentDeviceManager];
            [v19 removeResidentDevice:v11];

            goto LABEL_16;
          }
        }

        v8 = [v6 countByEnumeratingWithState:&v21 objects:v25 count:16];
        if (v8)
        {
          continue;
        }

        break;
      }
    }

    if ([v4 isCurrentDevice])
    {
      v14 = [(HMDHome *)self notificationRegistry];
      [v14 clearAllRegistrations];
    }
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v18;
      v28 = 2112;
      v29 = v4;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Attempting to remove resident on non-owner home -- device: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
  }

LABEL_16:

  v20 = *MEMORY[0x277D85DE8];
}

- (void)addResidentCapableDevice:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [v4 capabilities];
    v6 = [v5 isResidentCapable];

    if (v6)
    {
      v33 = 0u;
      v34 = 0u;
      v31 = 0u;
      v32 = 0u;
      v7 = [(HMDHome *)self residentDeviceManager];
      v8 = [v7 residentDevices];

      v9 = [v8 countByEnumeratingWithState:&v31 objects:v39 count:16];
      if (v9)
      {
        v10 = v9;
        v11 = *v32;
        while (2)
        {
          for (i = 0; i != v10; ++i)
          {
            if (*v32 != v11)
            {
              objc_enumerationMutation(v8);
            }

            v13 = *(*(&v31 + 1) + 8 * i);
            v14 = [v13 device];
            v15 = [v14 isEqual:v4];

            if (v15)
            {
              v26 = objc_autoreleasePoolPush();
              v27 = self;
              v28 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v28, OS_LOG_TYPE_DEBUG))
              {
                v29 = HMFGetLogIdentifier();
                *buf = 138543618;
                v36 = v29;
                v37 = 2112;
                v38 = v13;
                _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_DEBUG, "%{public}@Resident device already exists, refraining from creating a new transaction: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v26);
              goto LABEL_17;
            }
          }

          v10 = [v8 countByEnumeratingWithState:&v31 objects:v39 count:16];
          if (v10)
          {
            continue;
          }

          break;
        }
      }

      v16 = [(HMDHome *)self uuid];
      v17 = [v4 identifier];
      v8 = [HMDResidentDevice deriveUUIDFromHomeUUID:v16 deviceUUID:v17];

      v18 = [HMDResidentDeviceModel alloc];
      v19 = [(HMDHome *)self uuid];
      v20 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:1 uuid:v8 parentUUID:v19];

      [(HMDResidentDeviceModel *)v20 setEnabled:MEMORY[0x277CBEC38]];
      v21 = [v4 identifier];
      v22 = [v21 UUIDString];
      [(HMDResidentDeviceModel *)v20 setDeviceUUID:v22];

      if ([v4 isCurrentDevice])
      {
        [(HMDResidentDeviceModel *)v20 setDevice:v4];
      }

      v23 = [(HMDHome *)self backingStore];
      v24 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v25 = [v23 transaction:@"addResidentCapableDevice" options:v24];

      [v25 add:v20 withMessage:0];
      [v25 run];

LABEL_17:
    }
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (NSArray)enabledResidents
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v4 = [(HMDHome *)self residentDeviceManager];
  v5 = [v4 residentDevices];

  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v13 + 1) + 8 * i);
        if ([v10 isEnabled])
        {
          [v3 addObject:v10];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return v3;
}

- (NSArray)residentEnabledDevices
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v4 = [(HMDHome *)self residentDeviceManager];
  v5 = [v4 residentDevices];

  v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v15;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v15 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v14 + 1) + 8 * i);
        if ([v10 isEnabled])
        {
          v11 = [v10 device];
          [v3 addObject:v11];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v7);
  }

  v12 = *MEMORY[0x277D85DE8];

  return v3;
}

- (NSArray)residentCapableDevices
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v4 = [(HMDHome *)self residentDeviceManager];
  v5 = [v4 residentDevices];

  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = [*(*(&v13 + 1) + 8 * i) device];
        [v3 addObject:v10];
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return v3;
}

- (BOOL)shouldEnableResidentFirstAccessoryCommunication
{
  v2 = [(HMDHome *)self residentEnabledDevices];
  v3 = [v2 na_any:&__block_literal_global_1675];

  return v3;
}

uint64_t __58__HMDHome_shouldEnableResidentFirstAccessoryCommunication__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 capabilities];
  v3 = [v2 supportsResidentFirstAccessoryCommunication];

  return v3;
}

- (void)_updateResidentFirstAccessoryCommunicationEnabled
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self shouldEnableResidentFirstAccessoryCommunication];
  if (v3 != [(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      [(HMDHome *)v5 isResidentFirstAccessoryCommunicationEnabled];
      v8 = HMFBooleanToString();
      v9 = HMFBooleanToString();
      v11 = 138543874;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      v15 = 2112;
      v16 = v9;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Updating isResidentFirstAccessoryCommunicationEnabled from %@ to %@", &v11, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    [(HMDHome *)v5 setResidentFirstAccessoryCommunicationEnabled:v3];
    logAndPostNotification(@"HMDHomeIsResidentFirstAccessoryCommunicationEnabledDidChangeNotification", v5, 0);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)doesHomeContainResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 residentDevices];
  v4 = [v3 count] != 0;

  return v4;
}

- (NSNumber)matterFabricID
{
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    [(HMDHome *)self fabric];
  }

  else
  {
    [(HMDHome *)self chipStorage];
  }
  v3 = ;
  v4 = [v3 fabricID];

  return v4;
}

- (BOOL)areAllResidentsUnreachable
{
  v2 = [(HMDHome *)self enabledResidents];
  v3 = [v2 na_allObjectsPassTest:&__block_literal_global_1672];

  return v3;
}

- (BOOL)isCurrentDeviceConfirmedPrimaryResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 isCurrentDeviceConfirmedPrimaryResident];

  return v3;
}

- (id)_hasConfirmedPrimaryResidentDevice
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 confirmedPrimaryResidentDevice];

  return v3;
}

- (BOOL)hasResidentDevicesForPrimaryResidentChangeMonitor:(id)a3
{
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 residentDevices];
  v5 = [v4 count] != 0;

  return v5;
}

- (BOOL)isCurrentDevicePrimaryResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 isCurrentDevicePrimaryResident];

  return v3;
}

- (id)primaryResident
{
  v2 = [(HMDHome *)self residentDeviceManager];
  v3 = [v2 primaryResidentDevice];

  return v3;
}

- (BOOL)isResidentSupported
{
  if (isWatch())
  {
    v3 = [(HMDHome *)self homeManager];
    v4 = [v3 companionReachable];

    if (v4)
    {
      return 0;
    }
  }

  v6 = [(HMDHome *)self residentDeviceManager];
  v7 = [v6 isResidentAvailable];

  return v7;
}

- (void)_handleCharacteristicEnableNotification:(id)a3
{
  v95 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v68 = v3;
  if ([v3 isRemote] && (objc_msgSend(v3, "isSecureRemote") & 1) == 0)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v13;
      *&buf[12] = 2112;
      *&buf[14] = v68;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [v68 responseHandler];

    if (v14)
    {
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      v16 = [v68 responseHandler];
      (v16)[2](v16, v15, 0);
    }
  }

  else
  {
    v4 = [v3 messagePayload];
    v66 = [v4 objectForKey:@"kNotificationEnablePayloadKey"];

    if (v66)
    {
      v5 = @"kNotificationEnablePayloadKey";
    }

    else
    {
      v6 = [v68 messagePayload];
      v7 = [v6 objectForKey:@"kNotificationDisablePayloadKey"];

      if (!v7)
      {
        v57 = [v68 responseHandler];
        v58 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        (v57)[2](v57, v58, 0);

        goto LABEL_49;
      }

      v5 = @"kNotificationDisablePayloadKey";
    }

    v67 = [v68 dictionaryForKey:v5];
    v8 = [v68 clientIdentifier];

    if (v8)
    {
      v9 = [v68 clientIdentifier];
      v65 = [@"com.apple.HomeKit.client." stringByAppendingString:v9];
    }

    else
    {
      v65 = @"com.apple.HomeKitDaemon";
      v17 = @"com.apple.HomeKitDaemon";
    }

    v62 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v86 = 0u;
    v87 = 0u;
    v84 = 0u;
    v85 = 0u;
    obj = [v67 allKeys];
    v71 = [obj countByEnumeratingWithState:&v84 objects:v94 count:16];
    if (v71)
    {
      v69 = *v85;
      v19 = @"disable";
      if (v66)
      {
        v19 = @"enable";
      }

      v60 = v19;
      *&v18 = 138544642;
      v59 = v18;
      do
      {
        for (i = 0; i != v71; ++i)
        {
          if (*v85 != v69)
          {
            objc_enumerationMutation(obj);
          }

          v21 = *(*(&v84 + 1) + 8 * i);
          v22 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v21];
          v23 = [(HMDHome *)self accessoryWithUUID:v22];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          if (v25)
          {
            v26 = [v67 hmf_arrayForKey:v21];
            if ([v26 count])
            {
              [v62 setObject:v26 forKey:v25];
            }

            else
            {
              context = objc_autoreleasePoolPush();
              v34 = self;
              v35 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
              {
                v61 = HMFGetLogIdentifier();
                v36 = [(HMDHome *)v34 name];
                v37 = [(HMDHome *)v34 uuid];
                v38 = [v37 UUIDString];
                v39 = [v25 name];
                *buf = v59;
                *&buf[4] = v61;
                *&buf[12] = 2112;
                *&buf[14] = v36;
                *&buf[22] = 2112;
                v90 = v38;
                *v91 = 2112;
                *&v91[2] = v60;
                *&v91[10] = 2112;
                *&v91[12] = v39;
                v92 = 2112;
                v93 = v21;
                _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@%@/%@: Received notification %@ for zero characteristics on accessory %@/%@", buf, 0x3Eu);
              }

              objc_autoreleasePoolPop(context);
            }
          }

          else
          {
            v27 = objc_autoreleasePoolPush();
            v28 = self;
            v29 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
            {
              v30 = HMFGetLogIdentifier();
              v31 = [(HMDHome *)v28 name];
              v32 = [(HMDHome *)v28 uuid];
              v33 = [v32 UUIDString];
              *buf = 138544386;
              *&buf[4] = v30;
              *&buf[12] = 2112;
              *&buf[14] = v31;
              *&buf[22] = 2112;
              v90 = v33;
              *v91 = 2112;
              *&v91[2] = v60;
              *&v91[10] = 2112;
              *&v91[12] = v21;
              _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_INFO, "%{public}@%@/%@: Received notification %@ for different accessory: %@", buf, 0x34u);
            }

            objc_autoreleasePoolPop(v27);
          }
        }

        v71 = [obj countByEnumeratingWithState:&v84 objects:v94 count:16];
      }

      while (v71);
    }

    v40 = [v62 count];
    if (v40)
    {
      v41 = dispatch_group_create();
      *buf = 0;
      *&buf[8] = buf;
      *&buf[16] = 0x3032000000;
      v90 = __Block_byref_object_copy__10664;
      *v91 = __Block_byref_object_dispose__10665;
      *&v91[8] = 0;
      v80 = 0u;
      v81 = 0u;
      v82 = 0u;
      v83 = 0u;
      v42 = v62;
      v43 = [v42 countByEnumeratingWithState:&v80 objects:v88 count:16];
      if (v43)
      {
        v44 = 0;
        v45 = *v81;
        v70 = v40 - 1;
        do
        {
          v46 = 0;
          v47 = v70 - v44;
          v72 = v44 + v43;
          do
          {
            if (*v81 != v45)
            {
              objc_enumerationMutation(v42);
            }

            v48 = *(*(&v80 + 1) + 8 * v46);
            dispatch_group_enter(v41);
            v49 = MEMORY[0x277D0F818];
            v77[0] = MEMORY[0x277D85DD0];
            v77[1] = 3221225472;
            v77[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke;
            v77[3] = &unk_279725FA0;
            v77[4] = self;
            v79 = buf;
            v78 = v41;
            v50 = [v49 messageWithMessage:v68 messagePayload:0 responseHandler:v77];
            v51 = [v50 mutableCopy];

            if (v47 != v46)
            {
              v52 = [MEMORY[0x277CCAD78] UUID];
              [v51 setIdentifier:v52];
            }

            v53 = [v42 objectForKey:{v48, v59}];
            [v48 enableNotification:v66 != 0 forCharacteristicIDs:v53 message:v51 clientIdentifier:v65];

            ++v46;
          }

          while (v43 != v46);
          v43 = [v42 countByEnumeratingWithState:&v80 objects:v88 count:16];
          v44 = v72;
        }

        while (v43);
      }

      v54 = [(HMDHome *)self workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_3;
      block[3] = &unk_279734898;
      v75 = v68;
      v76 = buf;
      dispatch_group_notify(v41, v54, block);

      _Block_object_dispose(buf, 8);
    }

    else
    {
      v41 = [v68 responseHandler];
      v55 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (*(v41 + 16))(v41, v55, 0);
    }
  }

LABEL_49:

  v56 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_2;
  block[3] = &unk_279735BC0;
  v9 = v3;
  v7 = *(a1 + 40);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  dispatch_async(v4, block);
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_3(uint64_t a1)
{
  v2 = [*(a1 + 32) responseHandler];

  if (v2)
  {
    v3 = [*(a1 + 32) responseHandler];
    (*(v3 + 2))(v3, *(*(*(a1 + 40) + 8) + 40), 0);
  }
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_2(uint64_t a1)
{
  v2 = *(*(a1 + 48) + 8);
  v4 = *(v2 + 40);
  v3 = (v2 + 40);
  if (!v4)
  {
    objc_storeStrong(v3, *(a1 + 32));
  }

  v5 = *(a1 + 40);

  dispatch_group_leave(v5);
}

HMDCharacteristicUpdateTuple *__45__HMDHome__handlePendingResponsesTimerFired___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 error];

  if (v3)
  {
    v4 = 0;
  }

  else
  {
    v5 = [HMDCharacteristicUpdateTuple alloc];
    v6 = [v2 request];
    v7 = [v6 characteristic];
    v8 = [v2 value];
    v4 = [(HMDCharacteristicUpdateTuple *)v5 initWithCharacteristic:v7 updatedValue:v8 isBroadcast:0];
  }

  return v4;
}

- (void)_handleSendingNotificationsForRequest:(id)a3 requestIdentifier:(id)a4 supportsMultiPartResponse:(BOOL)a5 characteristicUpdates:(id)a6 completion:(id)a7
{
  v9 = a5;
  v53 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a6;
  v15 = a7;
  v16 = [v12 destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = v16;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  if ([v12 isRemote] && (objc_msgSend(v18, "device"), v19 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v19, "remoteDestinationString"), v20 = objc_claimAutoreleasedReturnValue(), v20, v19, v20))
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      v38 = v24;
      v25 = [v12 shortDescription];
      v26 = "single";
      if (v9)
      {
        v26 = "multi";
      }

      v35 = v26;
      v36 = v25;
      v27 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v14, "count")}];
      v37 = [v18 device];
      [v37 remoteDestinationString];
      *buf = 138544898;
      v40 = v24;
      v41 = 2112;
      v42 = v36;
      v43 = 2080;
      v44 = v35;
      v45 = 2112;
      v46 = v27;
      v47 = 2112;
      v48 = v14;
      v49 = 2112;
      v50 = v13;
      v52 = v51 = 2112;
      v28 = v52;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Response notification for %@ (%s part) [%@] with chars: %@ with id: %@ to device: %@", buf, 0x48u);
    }

    objc_autoreleasePoolPop(v21);
    v29 = [MEMORY[0x277CCAD78] UUID];
    v30 = [v29 UUIDString];
    v31 = [v18 device];
    v32 = [v31 remoteDestinationString];
    [(HMDHome *)v22 _notifyUpdatedCharacteristic:v14 withRequestIdentifier:v13 notificationUpdateIdentifier:v30 toUserDeviceAddress:v32 completion:v15];
  }

  else if (v15)
  {
    v33 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    v15[2](v15, v33);
  }

  v34 = *MEMORY[0x277D85DE8];
}

- (void)_handleMultipleCharacteristicRead:(id)a3
{
  v38 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277D0F770] currentActivity];
  if ([v4 isRemote] && (objc_msgSend(v4, "isSecureRemote") & 1) == 0)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      goto LABEL_21;
    }

    v19 = HMFGetLogIdentifier();
    *buf = 138543618;
    v33 = v19;
    v34 = 2112;
    v35 = v4;
    v20 = "%{public}@Message not supported: %@";
    v21 = v18;
    v22 = 22;
    goto LABEL_20;
  }

  if ([v4 isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(v4, "isRemote"))
  {
    v31 = 0;
    v6 = [(HMDHome *)self _readRequestTuplesFromMessage:v4 outUnhandledRequests:&v31];
    v7 = v31;
    if ([v6 count])
    {
      if ([v7 count])
      {
        v8 = objc_autoreleasePoolPush();
        v9 = self;
        v10 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          v11 = HMFGetLogIdentifier();
          v12 = [v4 shortDescription];
          *buf = 138543874;
          v33 = v11;
          v34 = 2112;
          v35 = v12;
          v36 = 2112;
          v37 = v7;
          _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@%@ has characteristic requests that cannot be handled: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v8);
      }

      v13 = [v4 source];
      [v6 count];
      [v4 isRemote];
      v14 = HMDRequestSourceAsString(v13);
      [(HMDHome *)self startReportingSessionForMessage:v4];
      v15 = [(HMDHome *)self __readWriteResponseHandler:v4 unhandledRequests:v7];
      [(HMDHome *)self _readCharacteristicValues:v6 requestMessage:v4 source:v13 withCompletionHandler:v15];
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      v24 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543362;
        v33 = v26;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_DEFAULT, "%{public}@None of the characteristics/properties in multi-read are valid", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v23);
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v15 domain];

      [v15 code];
      v27 = [v4 responseHandler];

      if (v27)
      {
        v28 = [v4 responseHandler];
        (v28)[2](v28, v15, 0);
      }
    }

    goto LABEL_23;
  }

  v16 = objc_autoreleasePoolPush();
  v17 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
  {
    v19 = HMFGetLogIdentifier();
    *buf = 138543362;
    v33 = v19;
    v20 = "%{public}@Client does not have entitlement to use SPI";
    v21 = v18;
    v22 = 12;
LABEL_20:
    _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_DEFAULT, v20, buf, v22);
  }

LABEL_21:

  objc_autoreleasePoolPop(v16);
  v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
  [v7 domain];

  [v7 code];
  v29 = [v4 responseHandler];

  if (v29)
  {
    v6 = [v4 responseHandler];
    (v6)[2](v6, v7, 0);
LABEL_23:
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)_handleCharacteristicRead:(id)a3
{
  v51[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = [v5 hmf_UUIDForKey:*MEMORY[0x277CCF0B0]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  if (!v9)
  {
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v11];
LABEL_17:

    goto LABEL_18;
  }

  if ([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
  {
    v10 = [v4 messagePayload];
    v11 = [v10 objectForKeyedSubscript:*MEMORY[0x277CD25F8]];

    v12 = [v4 messagePayload];
    v13 = [v12 objectForKeyedSubscript:*MEMORY[0x277CD2140]];

    v14 = [v9 findService:v11];
    v15 = [v14 findCharacteristic:v13];
    v16 = v15;
    if (v15)
    {
      v36 = v11;
      v51[0] = v15;
      v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v51 count:1];
      v37 = 0;
      v18 = [(HMDHome *)self _isReadRequestAllowForCharacteristics:v17 message:v4 error:&v37];
      v19 = v37;

      if (v18)
      {
        v35 = v19;
        v33 = [HMDCharacteristicRequest requestWithCharacteristic:v16];
        v34 = [v4 source];
        v20 = objc_autoreleasePoolPush();
        v21 = self;
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          v32 = HMFGetLogIdentifier();
          v23 = [v4 shortDescription];
          [v6 UUIDString];
          v24 = v31 = v22;
          [v9 uniqueIdentifier];
          v25 = v30 = v20;
          *buf = 138544642;
          v40 = v32;
          v41 = 2112;
          v42 = v23;
          v43 = 2112;
          v44 = v24;
          v45 = 2112;
          v46 = v25;
          v47 = 2112;
          v48 = v36;
          v49 = 2112;
          v50 = v13;
          _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_INFO, "%{public}@Processing single characteristic read request: %@ (%@/%@/%@/%@) as a special case of multiple characteristic read requests", buf, 0x3Eu);

          v20 = v30;
          v22 = v31;
        }

        objc_autoreleasePoolPop(v20);
        v38 = v33;
        v26 = [MEMORY[0x277CBEA60] arrayWithObjects:&v38 count:1];
        v27 = [(HMDHome *)v21 __readWriteResponseHandler:v4 unhandledRequests:0];
        [(HMDHome *)v21 _readCharacteristicValues:v26 requestMessage:v4 source:v34 withCompletionHandler:v27];

        v19 = v35;
      }

      else
      {
        [v4 respondWithError:v19];
      }

      v11 = v36;
    }

    else
    {
      v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v28];
    }

    goto LABEL_17;
  }

  [v9 _handleCharacteristicRead:v4];
LABEL_18:

  v29 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isReadRequestAllowForCharacteristics:(id)a3 message:(id)a4 error:(id *)a5
{
  v8 = a4;
  if ([(HMDHome *)self requiresUnlockToAccessCharacteristics:a3 withMessage:v8]&& ![(HMDHome *)self isAccessAllowedForCharacteristicsWithMessage:v8])
  {
    if (a5)
    {
      HMDSecureAccessErrorCodeForMessage(v8, [v8 source]);
      *a5 = v9 = 0;
    }

    else
    {
      v9 = 0;
    }
  }

  else
  {
    v9 = 1;
  }

  return v9;
}

- (id)_readRequestTuplesFromMessage:(id)a3 outUnhandledRequests:(id *)a4
{
  v33 = a4;
  v66 = *MEMORY[0x277D85DE8];
  v34 = a3;
  v4 = [v34 dictionaryForKey:*MEMORY[0x277CCE7A8]];
  v5 = [MEMORY[0x277CBEB18] array];
  v48 = objc_alloc_init(MEMORY[0x277CBEB38]);
  v59 = 0u;
  v60 = 0u;
  v61 = 0u;
  v62 = 0u;
  obj = v4;
  v37 = [obj countByEnumeratingWithState:&v59 objects:v65 count:16];
  if (v37)
  {
    v35 = *v60;
    v47 = v5;
    do
    {
      v6 = 0;
      do
      {
        if (*v60 != v35)
        {
          objc_enumerationMutation(obj);
        }

        v39 = v6;
        v7 = *(*(&v59 + 1) + 8 * v6);
        v8 = [obj hmf_dictionaryForKey:{v7, v33}];
        v49 = v7;
        v9 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v7];
        v10 = [(HMDHome *)self accessoryWithUUID:v9];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v41 = v11;

        v57 = 0u;
        v58 = 0u;
        v55 = 0u;
        v56 = 0u;
        v12 = v8;
        v5 = v47;
        v43 = [v12 countByEnumeratingWithState:&v55 objects:v64 count:16];
        if (v43)
        {
          v42 = *v56;
          v40 = v12;
          do
          {
            for (i = 0; i != v43; ++i)
            {
              if (*v56 != v42)
              {
                objc_enumerationMutation(v12);
              }

              v14 = *(*(&v55 + 1) + 8 * i);
              v15 = [v12 hmf_arrayForKey:v14];
              v16 = [v15 na_map:&__block_literal_global_1642];

              v17 = HAPInstanceIDFromValue();
              if (v17)
              {
                v46 = i;
                v44 = v17;
                v18 = [v41 findService:v17];
                v51 = 0u;
                v52 = 0u;
                v53 = 0u;
                v54 = 0u;
                v45 = v16;
                v19 = v16;
                v20 = [v19 countByEnumeratingWithState:&v51 objects:v63 count:16];
                if (v20)
                {
                  v21 = v20;
                  v22 = *v52;
                  do
                  {
                    for (j = 0; j != v21; ++j)
                    {
                      if (*v52 != v22)
                      {
                        objc_enumerationMutation(v19);
                      }

                      v24 = *(*(&v51 + 1) + 8 * j);
                      v25 = [v18 findCharacteristic:v24];
                      if (v25)
                      {
                        [v5 addObject:v25];
                      }

                      else
                      {
                        v26 = [v48 hmf_mutableDictionaryForKey:v49];
                        if (!v26)
                        {
                          v26 = objc_alloc_init(MEMORY[0x277CBEB38]);
                          [v48 setObject:v26 forKeyedSubscript:v49];
                        }

                        v27 = [v26 hmf_mutableArrayForKey:v14];
                        if (!v27)
                        {
                          v27 = objc_alloc_init(MEMORY[0x277CBEB18]);
                          [v26 setObject:v27 forKeyedSubscript:v14];
                        }

                        [v27 addObject:v24];

                        v5 = v47;
                      }
                    }

                    v21 = [v19 countByEnumeratingWithState:&v51 objects:v63 count:16];
                  }

                  while (v21);
                }

                v12 = v40;
                v16 = v45;
                i = v46;
                v17 = v44;
              }
            }

            v43 = [v12 countByEnumeratingWithState:&v55 objects:v64 count:16];
          }

          while (v43);
        }

        v6 = v39 + 1;
      }

      while (v39 + 1 != v37);
      v37 = [obj countByEnumeratingWithState:&v59 objects:v65 count:16];
    }

    while (v37);
  }

  if (v33)
  {
    *v33 = [v48 copy];
  }

  v50 = 0;
  v28 = [(HMDHome *)self _isReadRequestAllowForCharacteristics:v5 message:v34 error:&v50, v33];
  v29 = v50;
  if (v28)
  {
    v30 = [v5 na_map:&__block_literal_global_1645];
  }

  else
  {
    [v34 respondWithError:v29];
    v30 = 0;
  }

  v31 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_readCharacteristicValues:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 withCompletionHandler:(id)a6
{
  v72 = *MEMORY[0x277D85DE8];
  v56 = a3;
  v11 = a4;
  v57 = a6;
  v12 = objc_alloc(MEMORY[0x277D0F770]);
  v13 = MEMORY[0x277CCACA8];
  v14 = MEMORY[0x259C01AE0](self, a2);
  v15 = [v13 stringWithFormat:@"%@, %s:%ld", v14, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 27461];
  v67 = [v12 initWithName:v15];

  if ([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
  {
    v16 = [(HMDHome *)self isCurrentDeviceAvailableResident];
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    if (v16)
    {
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        v21 = [v11 shortDescription];
        *buf = 138543618;
        v69 = v20;
        v70 = 2112;
        v71 = v21;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Running new accessory communication logic for resident. %@", buf, 0x16u);
      }
    }

    else
    {
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v43 = HMFGetLogIdentifier();
        v44 = [v11 shortDescription];
        *buf = 138543618;
        v69 = v43;
        v70 = 2112;
        v71 = v44;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Routing accessory read requests using Resident First logic. %@", buf, 0x16u);
      }
    }

    objc_autoreleasePoolPop(v17);
    v45 = [(HMDHome *)v18 _createMessageForReadWriteRequest:v11 source:a5 withCompletionHandler:v57];
    v46 = [(HMDHome *)v18 accessoryReaderWriter];
    [v46 submitReadRequests:v56 sourceType:a5 requestMessage:v45];
  }

  else
  {
    v54 = dispatch_group_create();
    v22 = [v11 identifier];
    v23 = [v11 BOOLForKey:@"kMultiPartResponseKey"];
    v24 = [v11 stringForKey:@"kRequestIdentifierKey"];
    v25 = [v22 UUIDString];
    v26 = [(HMDHome *)self _setupPendingResponseTimerIdentifier:v25 originalRequestIdentifier:v24];

    v27 = +[HMDPendingResponse tupleForMessage:originalRequestIdentifier:requestCount:withCompletionHandler:](HMDPendingResponse, "tupleForMessage:originalRequestIdentifier:requestCount:withCompletionHandler:", v11, v26, [v56 count], v57);
    v28 = [(HMDHome *)self pendingResponses];
    [v28 setObject:v27 forKeyedSubscript:v26];

    v29 = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
    v30 = [(HMDHome *)self _buildRequestMapTableFromRequests:v56 pendingResponses:v27];

    v53 = [MEMORY[0x277CBEB38] dictionary];
    if (isWatch() && [(HMDHome *)self _passReadRequestToCompanion:v30 requestMessage:v11 source:a5 pendingResponses:v27 remoteAccessories:v53 withCompletionHandler:v57])
    {
    }

    else
    {
      v50 = v23;
      v55 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v30, "count")}];
      [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v30, "count")}];
      v48 = v24;
      v51 = v49 = v22;
      v52 = dispatch_group_create();
      [(HMDHome *)self _sendReadRequestToAccessoryServer:v30 requestMessage:v11 source:a5 pendingResponses:v27 slowFailedAccessories:v55 fastFailedAccessories:v51 unreachableWaitGroup:v52 waitGroup:v54 activity:v67];
      v31 = dispatch_group_create();
      v32 = [MEMORY[0x277CBEB18] array];
      dispatch_group_enter(v31);
      [(HMDHome *)self _waitForEarlyDispatchTimeoutOnReadRequest:v30 requestMessage:v11 source:a5 pendingResponses:v27 activity:v67 slowFailedAccessories:v55 tmpErrorResponseTuples:v32 unreachableWaitGroup:v52 failureWaitGroup:v31];
      [(HMDHome *)self _handleFailedAccessories:v30 requestMessage:v11 source:a5 pendingResponses:v27 fastFailedAccessories:v51 slowFailedAccessories:v55 tmpErrorResponseTuples:v32 waitGroup:v54 failureWaitGroup:v31 activity:v67];
      v33 = objc_autoreleasePoolPush();
      v34 = self;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543362;
        v69 = v36;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Wait before final notification", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v33);
      v37 = [(HMDHome *)v34 workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __81__HMDHome__readCharacteristicValues_requestMessage_source_withCompletionHandler___block_invoke;
      block[3] = &unk_279722A38;
      v66 = v50;
      block[4] = v34;
      v59 = v27;
      v60 = v32;
      v61 = v49;
      v62 = v11;
      v63 = v48;
      v64 = v26;
      v65 = v57;
      v38 = v26;
      v39 = v48;
      v40 = v49;
      v41 = v32;
      v42 = v27;
      dispatch_group_notify(v31, v37, block);
    }
  }

  __HMFActivityScopeLeave();

  v47 = *MEMORY[0x277D85DE8];
}

void __81__HMDHome__readCharacteristicValues_requestMessage_source_withCompletionHandler___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = v5;
    v7 = "single";
    if (*(a1 + 96))
    {
      v7 = "multi";
    }

    v20 = 138543618;
    v21 = v5;
    v22 = 2080;
    v23 = v7;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Final notification for multi-read (%s part)", &v20, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v8 = [*(a1 + 40) retrieveAndClearAllResponses];
  v9 = v8;
  v10 = *(a1 + 48);
  if (v10)
  {
    if (v8)
    {
      v11 = [v8 mutableCopy];
      v12 = [v11 arrayByAddingObjectsFromArray:*(a1 + 48)];

      v9 = v12;
    }

    else
    {
      v9 = v10;
    }
  }

  [*(a1 + 32) _notifyChangedCharacteristics:v9 identifier:*(a1 + 56) multiPartResponse:*(a1 + 96) moreMessagesInMultipart:0 requestMessage:*(a1 + 64) withCompletionHandler:*(a1 + 88)];
  if (!*(a1 + 72))
  {
    v13 = objc_autoreleasePoolPush();
    v14 = *(a1 + 32);
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = *(a1 + 80);
      v20 = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = v17;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Remove tracking pending response for identifier %@ after final notification", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v18 = [*(a1 + 32) pendingResponses];
    [v18 removeObjectForKey:*(a1 + 80)];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)_sendReadRequestToAccessoryServer:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 pendingResponses:(id)a6 slowFailedAccessories:(id)a7 fastFailedAccessories:(id)a8 unreachableWaitGroup:(id)a9 waitGroup:(id)a10 activity:(id)a11
{
  v71 = *MEMORY[0x277D85DE8];
  v15 = a3;
  v16 = a4;
  v44 = a6;
  v43 = a7;
  v42 = a8;
  group = a9;
  v17 = a10;
  v18 = a11;
  v19 = [v16 BOOLForKey:@"kDoNotForwardMessageKey"];
  v37 = [v16 BOOLForKey:@"kMultiPartResponseKey"];
  v40 = v16;
  v41 = [v16 identifier];
  v60 = 0u;
  v61 = 0u;
  v62 = 0u;
  v63 = 0u;
  obj = v15;
  v45 = [obj countByEnumeratingWithState:&v60 objects:v70 count:16];
  if (v45)
  {
    v36 = v19 ^ 1;
    v35 = *v61;
    v34 = v18;
    do
    {
      for (i = 0; i != v45; ++i)
      {
        if (*v61 != v35)
        {
          objc_enumerationMutation(obj);
        }

        v21 = *(*(&v60 + 1) + 8 * i);
        dispatch_group_enter(v17);
        dispatch_group_enter(group);
        v22 = [obj objectForKey:v21];
        v23 = [v21 shortDescription];
        [v18 markWithFormat:@"Starting read for accessory: %@", v23];

        v24 = [v21 uuid];
        v25 = objc_autoreleasePoolPush();
        v26 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
        {
          v28 = HMFGetLogIdentifier();
          v29 = [v22 count];
          *buf = 138543874;
          v65 = v28;
          v66 = 2112;
          v67 = v24;
          v68 = 2048;
          v69 = v29;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Starting read for accessory %@ with %ld requests", buf, 0x20u);

          v18 = v34;
        }

        objc_autoreleasePoolPop(v25);
        [v22 count];
        v30 = [(HMDHome *)v26 workQueue];
        v48[0] = MEMORY[0x277D85DD0];
        v48[1] = 3221225472;
        v48[2] = __168__HMDHome__sendReadRequestToAccessoryServer_requestMessage_source_pendingResponses_slowFailedAccessories_fastFailedAccessories_unreachableWaitGroup_waitGroup_activity___block_invoke;
        v48[3] = &unk_279722A10;
        v48[4] = v26;
        v48[5] = v21;
        v49 = v18;
        v50 = v24;
        v58 = v36;
        v59 = v37;
        v51 = v43;
        v52 = v42;
        v53 = v44;
        v31 = v40;
        v54 = v31;
        v55 = v41;
        v56 = v17;
        v57 = group;
        v32 = v24;
        [v21 readCharacteristicValues:v22 source:a5 message:v31 queue:v30 logEvent:0 completionHandler:v48];
      }

      v45 = [obj countByEnumeratingWithState:&v60 objects:v70 count:16];
    }

    while (v45);
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __168__HMDHome__sendReadRequestToAccessoryServer_requestMessage_source_pendingResponses_slowFailedAccessories_fastFailedAccessories_unreachableWaitGroup_waitGroup_activity___block_invoke(uint64_t a1, void *a2)
{
  v63 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) name];
    v9 = [*(a1 + 40) uuid];
    v10 = [v9 UUIDString];
    v11 = [*(a1 + 40) uniqueIdentifier];
    *buf = 138544386;
    v54 = v7;
    v55 = 2112;
    v56 = v8;
    v57 = 2112;
    v58 = v10;
    v59 = 2112;
    v60 = v11;
    v61 = 2048;
    v62 = [v3 count];
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Completed read for accessory %@/%@/%@ with %ld responses", buf, 0x34u);
  }

  v47 = a1;

  objc_autoreleasePoolPop(v4);
  v50 = 0u;
  v51 = 0u;
  v48 = 0u;
  v49 = 0u;
  v12 = v3;
  v13 = [v12 countByEnumeratingWithState:&v48 objects:v52 count:16];
  if (!v13)
  {
    goto LABEL_22;
  }

  v14 = v13;
  v15 = *v49;
  v16 = *MEMORY[0x277CCA7E8];
  v17 = *MEMORY[0x277CCFD28];
  while (2)
  {
    for (i = 0; i != v14; ++i)
    {
      if (*v49 != v15)
      {
        objc_enumerationMutation(v12);
      }

      v19 = [*(*(&v48 + 1) + 8 * i) error];
      [v19 domain];

      [v19 code];
      v20 = [v19 userInfo];

      if (v20)
      {
        v21 = [v19 userInfo];
        v22 = [v21 objectForKey:v16];

        if (v22)
        {
          v23 = !+[HMDHAPAccessory suspendedPerErrorCode:](HMDHAPAccessory, "suspendedPerErrorCode:", [v22 code]);
        }

        else
        {
          LOBYTE(v23) = 1;
        }

        if (!v19)
        {
          goto LABEL_19;
        }
      }

      else
      {
        LOBYTE(v23) = 1;
        if (!v19)
        {
          goto LABEL_19;
        }
      }

      v24 = [v19 domain];
      if (([v24 isEqualToString:v17] & 1) == 0)
      {

LABEL_19:
        continue;
      }

      v25 = ([v19 code] == 4) & v23;

      if (v25 == 1)
      {

        v26 = v47;
        if ((*(v47 + 120) & 1) == 0)
        {
          goto LABEL_30;
        }

        if (*(v47 + 121))
        {
          v27 = [*(v47 + 32) primaryResident];
          v28 = [v27 device];
          v29 = [v28 version];
          v30 = +[HMDHomeKitVersion version4];
          if ([v29 isAtLeastVersion:v30])
          {
            v31 = *(v47 + 121);

            v32 = v31 == 1;
            v26 = v47;
            if (v32)
            {
              v33 = objc_autoreleasePoolPush();
              v34 = *(v47 + 32);
              v35 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
              {
                v36 = HMFGetLogIdentifier();
                *buf = 138543362;
                v54 = v36;
                _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Dispatching to resident with binning", buf, 0xCu);
LABEL_43:

                goto LABEL_44;
              }

              goto LABEL_44;
            }
          }

          else
          {
          }

          v41 = [*(v26 + 40) linkSpeed];
          v33 = objc_autoreleasePoolPush();
          v34 = *(v26 + 32);
          v35 = HMFGetOSLogHandle();
          v42 = os_log_type_enabled(v35, OS_LOG_TYPE_INFO);
          if ((v41 & 0x8000000000000000) == 0)
          {
            if (v42)
            {
              v43 = HMFGetLogIdentifier();
              v44 = [*(v26 + 40) name];
              *buf = 138543618;
              v54 = v43;
              v55 = 2112;
              v56 = v44;
              _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@adding accessory %@ to fast dispatch group (multi-part).", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v33);
            v45 = *(v26 + 72);
            goto LABEL_45;
          }

          if (v42)
          {
            v36 = HMFGetLogIdentifier();
            v39 = [*(v26 + 40) name];
            *buf = 138543618;
            v54 = v36;
            v55 = 2112;
            v56 = v39;
            v40 = "%{public}@adding accessory %@ to slow dispatch group (multi-part).";
            goto LABEL_42;
          }
        }

        else
        {
          v33 = objc_autoreleasePoolPush();
          v34 = *(v47 + 32);
          v35 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
          {
            v36 = HMFGetLogIdentifier();
            v39 = [*(v47 + 40) name];
            *buf = 138543618;
            v54 = v36;
            v55 = 2112;
            v56 = v39;
            v40 = "%{public}@adding accessory %@ to dispatch group (single-part).";
LABEL_42:
            _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, v40, buf, 0x16u);

            goto LABEL_43;
          }
        }

LABEL_44:

        objc_autoreleasePoolPop(v33);
        v45 = *(v26 + 64);
LABEL_45:
        [v45 addObject:*(v26 + 40)];
        goto LABEL_46;
      }
    }

    v14 = [v12 countByEnumeratingWithState:&v48 objects:v52 count:16];
    if (v14)
    {
      continue;
    }

    break;
  }

LABEL_22:

  v26 = v47;
LABEL_30:
  [*(v26 + 80) addResponsesToPendingResponse:v12];
  if (*(v26 + 121) == 1 && ([*(v26 + 88) isRemote] & 1) == 0)
  {
    v37 = *(v26 + 32);
    v38 = [*(v26 + 80) retrieveAndClearAllResponses];
    [v37 _notifyChangedCharacteristics:v38 identifier:*(v26 + 96) multiPartResponse:1 moreMessagesInMultipart:1 requestMessage:*(v26 + 88) withCompletionHandler:0];
  }

LABEL_46:
  dispatch_group_leave(*(v26 + 104));
  dispatch_group_leave(*(v26 + 112));

  v46 = *MEMORY[0x277D85DE8];
}

- (void)_waitForEarlyDispatchTimeoutOnReadRequest:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 pendingResponses:(id)a6 activity:(id)a7 slowFailedAccessories:(id)a8 tmpErrorResponseTuples:(id)a9 unreachableWaitGroup:(id)a10 failureWaitGroup:(id)a11
{
  v15 = a3;
  v16 = a4;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  v20 = a9;
  v21 = a10;
  v22 = a11;
  v23 = [v16 BOOLForKey:@"kMultiPartResponseKey"];
  v24 = dispatch_get_global_queue(0, 0);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __184__HMDHome__waitForEarlyDispatchTimeoutOnReadRequest_requestMessage_source_pendingResponses_activity_slowFailedAccessories_tmpErrorResponseTuples_unreachableWaitGroup_failureWaitGroup___block_invoke;
  block[3] = &unk_27972DC40;
  v36 = v21;
  v37 = self;
  v38 = v19;
  v39 = v18;
  v46 = v23;
  v40 = v17;
  v41 = v22;
  v42 = v15;
  v43 = v16;
  v44 = v20;
  v45 = a5;
  v25 = v20;
  v26 = v16;
  v27 = v15;
  v28 = v22;
  v29 = v17;
  v30 = v18;
  v31 = v19;
  v32 = v21;
  dispatch_async(v24, block);
}

void __184__HMDHome__waitForEarlyDispatchTimeoutOnReadRequest_requestMessage_source_pendingResponses_activity_slowFailedAccessories_tmpErrorResponseTuples_unreachableWaitGroup_failureWaitGroup___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = dispatch_time(0, 250000000);
  dispatch_group_wait(v2, v3);
  v4 = [*(a1 + 40) workQueue];
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __184__HMDHome__waitForEarlyDispatchTimeoutOnReadRequest_requestMessage_source_pendingResponses_activity_slowFailedAccessories_tmpErrorResponseTuples_unreachableWaitGroup_failureWaitGroup___block_invoke_2;
  v16[3] = &unk_2797245B0;
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v22 = *(a1 + 112);
  *&v7 = *(a1 + 64);
  *(&v7 + 1) = *(a1 + 40);
  *&v8 = v5;
  *(&v8 + 1) = v6;
  v17 = v8;
  v18 = v7;
  v9 = *(a1 + 72);
  v10 = *(a1 + 80);
  v11 = *(a1 + 88);
  v12 = *(a1 + 96);
  v21 = *(a1 + 104);
  v13 = v12;
  *&v14 = v11;
  *(&v14 + 1) = v13;
  *&v15 = v9;
  *(&v15 + 1) = v10;
  v19 = v15;
  v20 = v14;
  dispatch_async(v4, v16);
}

void __184__HMDHome__waitForEarlyDispatchTimeoutOnReadRequest_requestMessage_source_pendingResponses_activity_slowFailedAccessories_tmpErrorResponseTuples_unreachableWaitGroup_failureWaitGroup___block_invoke_2(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = [MEMORY[0x277CBEA60] arrayWithArray:*(a1 + 32)];
  if ([v2 count])
  {
    [v2 count];
    if (*(a1 + 104))
    {
      [MEMORY[0x277CBEB18] array];
    }

    else
    {
      [*(a1 + 48) allResponses];
    }
    v3 = ;
    [*(a1 + 40) begin];
    v9 = *(a1 + 40);
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 56);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543362;
      v11 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Beginning bulk redispatch for unreachable read accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 56) _redispatchReadForAccessories:v2 dispatchGroup:*(a1 + 64) requestMap:*(a1 + 72) requestMessage:*(a1 + 80) source:*(a1 + 96) responseTuples:v3 errorResponseTuples:*(a1 + 88)];
    __HMFActivityScopeLeave();

    [*(a1 + 32) removeObjectsInArray:v2];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_handleFailedAccessories:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 pendingResponses:(id)a6 fastFailedAccessories:(id)a7 slowFailedAccessories:(id)a8 tmpErrorResponseTuples:(id)a9 waitGroup:(id)a10 failureWaitGroup:(id)a11 activity:(id)a12
{
  v43 = a3;
  v17 = a4;
  v36 = a6;
  v18 = a7;
  v42 = a8;
  v39 = a9;
  v19 = a11;
  v20 = a12;
  group = a10;
  v37 = [v17 BOOLForKey:@"kMultiPartResponseKey"];
  v35 = self;
  v21 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __178__HMDHome__handleFailedAccessories_requestMessage_source_pendingResponses_fastFailedAccessories_slowFailedAccessories_tmpErrorResponseTuples_waitGroup_failureWaitGroup_activity___block_invoke;
  block[3] = &unk_2797245B0;
  v22 = v20;
  v57 = v22;
  v58 = v18;
  v66 = v37;
  v23 = v36;
  v59 = v23;
  v60 = self;
  v24 = v19;
  v61 = v24;
  v25 = v43;
  v62 = v25;
  v26 = v17;
  v63 = v26;
  v65 = a5;
  v27 = v39;
  v64 = v27;
  v44 = v18;
  dispatch_group_notify(group, v21, block);

  dispatch_group_enter(v24);
  v28 = [(HMDHome *)v35 workQueue];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __178__HMDHome__handleFailedAccessories_requestMessage_source_pendingResponses_fastFailedAccessories_slowFailedAccessories_tmpErrorResponseTuples_waitGroup_failureWaitGroup_activity___block_invoke_1624;
  v45[3] = &unk_2797245B0;
  v46 = v22;
  v47 = v42;
  v55 = v37;
  v48 = v23;
  v49 = v35;
  v50 = v24;
  v51 = v25;
  v53 = v27;
  v54 = a5;
  v52 = v26;
  v41 = v27;
  v29 = v26;
  v30 = v25;
  v31 = v24;
  v32 = v23;
  v33 = v42;
  v34 = v22;
  dispatch_group_notify(group, v28, v45);
}

uint64_t __178__HMDHome__handleFailedAccessories_requestMessage_source_pendingResponses_fastFailedAccessories_slowFailedAccessories_tmpErrorResponseTuples_waitGroup_failureWaitGroup_activity___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) begin];
  if ([*(a1 + 40) count])
  {
    [*(a1 + 40) count];
    if (*(a1 + 104))
    {
      [MEMORY[0x277CBEB18] array];
    }

    else
    {
      [*(a1 + 48) allResponses];
    }
    v2 = ;
    [*(a1 + 32) begin];
    v9 = *(a1 + 32);
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 56);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      *buf = 138543362;
      v11 = v6;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Beginning bulk redispatch for fast read failed accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 56) _redispatchReadForAccessories:*(a1 + 40) dispatchGroup:*(a1 + 64) requestMap:*(a1 + 72) requestMessage:*(a1 + 80) source:*(a1 + 96) responseTuples:v2 errorResponseTuples:*(a1 + 88)];
    __HMFActivityScopeLeave();

    [*(a1 + 40) removeAllObjects];
  }

  dispatch_group_leave(*(a1 + 64));
  result = [*(a1 + 32) end];
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

uint64_t __178__HMDHome__handleFailedAccessories_requestMessage_source_pendingResponses_fastFailedAccessories_slowFailedAccessories_tmpErrorResponseTuples_waitGroup_failureWaitGroup_activity___block_invoke_1624(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) begin];
  if ([*(a1 + 40) count])
  {
    if (*(a1 + 104))
    {
      [MEMORY[0x277CBEB18] array];
    }

    else
    {
      [*(a1 + 48) allResponses];
    }
    v2 = ;
    [*(a1 + 32) begin];
    v9 = *(a1 + 32);
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 56);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      *buf = 138543362;
      v11 = v6;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Beginning bulk redispatch for slow read failed accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 56) _redispatchReadForAccessories:*(a1 + 40) dispatchGroup:*(a1 + 64) requestMap:*(a1 + 72) requestMessage:*(a1 + 80) source:*(a1 + 96) responseTuples:v2 errorResponseTuples:*(a1 + 88)];
    __HMFActivityScopeLeave();

    [*(a1 + 40) removeAllObjects];
  }

  dispatch_group_leave(*(a1 + 64));
  result = [*(a1 + 32) end];
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (BOOL)_passReadRequestToCompanion:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 pendingResponses:(id)a6 remoteAccessories:(id)a7 withCompletionHandler:(id)a8
{
  v45 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a6;
  v17 = a7;
  v18 = a8;
  v33 = v15;
  v19 = [v15 BOOLForKey:@"kMultiPartResponseKey"];
  v32 = v14;
  if (isWatch() && [(HMDHome *)self remoteAccessIsEnabled])
  {
    v30 = v19;
    v31 = a5;
    v42 = 0u;
    v43 = 0u;
    v40 = 0u;
    v41 = 0u;
    v20 = v14;
    v21 = [v20 countByEnumeratingWithState:&v40 objects:v44 count:16];
    if (v21)
    {
      v22 = *v41;
      do
      {
        for (i = 0; i != v21; ++i)
        {
          if (*v41 != v22)
          {
            objc_enumerationMutation(v20);
          }

          v24 = [v20 objectForKey:*(*(&v40 + 1) + 8 * i)];
          v25 = [v16 allResponses];
          [HMDHome appendCharacteristicsToAccessoryList:v17 responseTuples:v25 forMultipleCharacteristicsRemoteRead:v24];
        }

        v21 = [v20 countByEnumeratingWithState:&v40 objects:v44 count:16];
      }

      while (v21);
    }

    v26 = [MEMORY[0x277CBEB18] array];
    objc_initWeak(&location, self);
    v34[0] = MEMORY[0x277D85DD0];
    v34[1] = 3221225472;
    v34[2] = __118__HMDHome__passReadRequestToCompanion_requestMessage_source_pendingResponses_remoteAccessories_withCompletionHandler___block_invoke;
    v34[3] = &unk_2797229E8;
    objc_copyWeak(&v37, &location);
    v35 = v33;
    v38 = v30;
    v36 = v18;
    [(HMDHome *)self _readCharacteristicValuesForAccessories:v17 readRequestMap:v20 responseTuples:v26 requestMessage:v35 source:v31 viaDevice:0 completionHandler:v34];

    objc_destroyWeak(&v37);
    objc_destroyWeak(&location);

    v27 = 1;
  }

  else
  {
    v27 = 0;
  }

  v28 = *MEMORY[0x277D85DE8];
  return v27;
}

void __118__HMDHome__passReadRequestToCompanion_requestMessage_source_pendingResponses_remoteAccessories_withCompletionHandler___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = [WeakRetained workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __118__HMDHome__passReadRequestToCompanion_requestMessage_source_pendingResponses_remoteAccessories_withCompletionHandler___block_invoke_2;
  v4[3] = &unk_279732430;
  v4[4] = WeakRetained;
  v5 = *(a1 + 32);
  v7 = *(a1 + 56);
  v6 = *(a1 + 40);
  dispatch_async(v3, v4);
}

void __118__HMDHome__passReadRequestToCompanion_requestMessage_source_pendingResponses_remoteAccessories_withCompletionHandler___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) identifier];
  [v2 _notifyChangedCharacteristics:MEMORY[0x277CBEBF8] identifier:v3 multiPartResponse:*(a1 + 56) moreMessagesInMultipart:0 requestMessage:*(a1 + 40) withCompletionHandler:*(a1 + 48)];
}

- (id)_buildRequestMapTableFromRequests:(id)a3 pendingResponses:(id)a4
{
  v43 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v31 = a4;
  v33 = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = v5;
  v6 = [obj countByEnumeratingWithState:&v34 objects:v42 count:16];
  if (v6)
  {
    v8 = v6;
    v9 = *v35;
    *&v7 = 138543618;
    v29 = v7;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v35 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v34 + 1) + 8 * i);
        v12 = [v11 characteristic];
        v13 = [v12 service];
        v14 = [v13 accessory];

        if (v14)
        {
          if (([v14 isPrimary] & 1) == 0)
          {
            v15 = [v14 bridge];

            v14 = v15;
          }

          v16 = [v33 objectForKey:v14];
          v17 = v16;
          v18 = MEMORY[0x277CBEBF8];
          if (v16)
          {
            v18 = v16;
          }

          v19 = v18;

          v20 = [HMDCharacteristicRequest requestWithCharacteristic:v12];
          v21 = [v19 arrayByAddingObject:v20];

          [v33 setObject:v21 forKey:v14];
        }

        else
        {
          v22 = v9;
          v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v23 = objc_autoreleasePoolPush();
          v24 = self;
          v25 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
          {
            v26 = HMFGetLogIdentifier();
            *buf = v29;
            v39 = v26;
            v40 = 2112;
            v41 = v11;
            _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Aborting characteristic request, accessory is nil %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v23);
          v21 = [HMDCharacteristicResponse responseWithRequest:v11 error:v14];
          [v31 addToPendingResponses:v21];
          v9 = v22;
        }
      }

      v8 = [obj countByEnumeratingWithState:&v34 objects:v42 count:16];
    }

    while (v8);
  }

  v27 = *MEMORY[0x277D85DE8];

  return v33;
}

- (id)_setupPendingResponseTimerIdentifier:(id)a3 originalRequestIdentifier:(id)a4
{
  v29 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = v7;
  if (v7)
  {
    v9 = v7;

    v10 = objc_alloc(MEMORY[0x277D0F920]);
    v11 = [v10 initWithTimeInterval:1 options:*&pendingResponseTickPeriod];
    [(HMDHome *)self setPendingResponsesTimer:v11];

    v12 = [(HMDHome *)self workQueue];
    v13 = [(HMDHome *)self pendingResponsesTimer];
    [v13 setDelegateQueue:v12];

    v14 = [(HMDHome *)self pendingResponsesTimer];
    [v14 setDelegate:self];

    v15 = [(HMDHome *)self pendingResponsesTimer];
    [v15 resume];

    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [(HMDHome *)v17 pendingResponsesTimer];
      v23 = 138543874;
      v24 = v19;
      v25 = 2048;
      v26 = v20;
      v27 = 2112;
      v28 = v9;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Started pending responses timer %p for request %@", &v23, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
  }

  else
  {
    v9 = v6;
  }

  v21 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)readCharacteristicValues:(id)a3 source:(unint64_t)a4 sourceForLogging:(id)a5 qualityOfService:(int64_t)a6 withCompletionHandler:(id)a7
{
  v13 = a3;
  v14 = a5;
  v15 = a7;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x259C01AE0](self, a2);
  v19 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 27070];
  v32 = [v16 initWithName:v19];

  v20 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __99__HMDHome_readCharacteristicValues_source_sourceForLogging_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_2797229C0;
  v25 = v32;
  v26 = self;
  v27 = v14;
  v28 = v13;
  v30 = a6;
  v31 = a4;
  v29 = v15;
  v21 = v15;
  v22 = v13;
  v23 = v14;
  dispatch_async(v20, block);

  __HMFActivityScopeLeave();
}

void __99__HMDHome_readCharacteristicValues_source_sourceForLogging_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  v21[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277D0F818];
  v3 = *(a1 + 72);
  v4 = [MEMORY[0x277D0F820] allMessageDestinations];
  v20 = @"kMultiPartResponseKey";
  v21[0] = MEMORY[0x277CBEC28];
  v5 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v21 forKeys:&v20 count:1];
  v6 = [v2 messageWithName:@"kMultipleCharacteristicReadRequestKey" qualityOfService:v3 destination:v4 payload:v5];

  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 40);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [v6 identifier];
    v12 = *(a1 + 48);
    v14 = 138543874;
    v15 = v10;
    v16 = 2114;
    v17 = v11;
    v18 = 2114;
    v19 = v12;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: %{public}@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  [*(a1 + 40) _readCharacteristicValues:*(a1 + 56) requestMessage:v6 source:*(a1 + 80) withCompletionHandler:*(a1 + 64)];

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_redispatchReadForAccessories:(id)a3 dispatchGroup:(id)a4 requestMap:(id)a5 requestMessage:(id)a6 source:(unint64_t)a7 responseTuples:(id)a8 errorResponseTuples:(id)a9
{
  v113 = *MEMORY[0x277D85DE8];
  v75 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a8;
  v19 = a9;
  v20 = objc_alloc(MEMORY[0x277D0F770]);
  v21 = MEMORY[0x277CCACA8];
  v22 = MEMORY[0x259C01AE0](self, a2);
  v23 = [v21 stringWithFormat:@"%@, %s:%ld", v22, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 26961];
  v24 = [v20 initWithName:v23];

  v25 = [(HMDHome *)self primaryResident];
  if (v25)
  {
    v81 = v18;
    v82 = v15;
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __123__HMDHome__redispatchReadForAccessories_dispatchGroup_requestMap_requestMessage_source_responseTuples_errorResponseTuples___block_invoke;
    aBlock[3] = &unk_279722830;
    v74 = v16;
    v78 = v16;
    v99 = v78;
    v72 = v19;
    v100 = v19;
    v103 = a7;
    v73 = v17;
    v89 = v17;
    v101 = v89;
    v102 = self;
    v87 = _Block_copy(aBlock);
    v26 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v86 = self;
    v79 = v25;
    v80 = v24;
    v88 = v26;
    if ([v25 isCurrentDevice])
    {
      v96 = 0u;
      v97 = 0u;
      v94 = 0u;
      v95 = 0u;
      v27 = v75;
      v28 = [v27 countByEnumeratingWithState:&v94 objects:v112 count:16];
      if (v28)
      {
        v29 = v28;
        v30 = *v95;
        v76 = v27;
        do
        {
          v31 = 0;
          obj = v29;
          do
          {
            if (*v95 != v30)
            {
              objc_enumerationMutation(v27);
            }

            v32 = *(*(&v94 + 1) + 8 * v31);
            v33 = [(HMDHome *)self homeManager];
            v34 = [v33 residentMesh];
            v35 = [v34 bestResidentDeviceForAccessory:v32];

            if (v35)
            {
              v36 = [v26 objectForKey:v35];
              v37 = v36;
              if (v36)
              {
                v38 = v36;
              }

              else
              {
                v38 = [MEMORY[0x277CBEB18] array];
              }

              v49 = v38;

              [v49 addObject:v32];
              [v26 setObject:v49 forKey:v35];
            }

            else
            {
              v39 = objc_autoreleasePoolPush();
              v40 = self;
              v41 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
              {
                v42 = HMFGetLogIdentifier();
                v43 = [v32 uuid];
                [v43 UUIDString];
                v44 = v77 = v39;
                [v32 uniqueIdentifier];
                v46 = v45 = v30;
                *buf = 138543874;
                v107 = v42;
                v108 = 2112;
                v109 = v44;
                v110 = 2112;
                v111 = v46;
                _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Read bulk redispatching failing for %@/%@ (No Mesh Redirect)", buf, 0x20u);

                v30 = v45;
                v39 = v77;

                v26 = v88;
                v27 = v76;
              }

              objc_autoreleasePoolPop(v39);
              v105 = v32;
              v47 = [MEMORY[0x277CBEA60] arrayWithObjects:&v105 count:1];
              v48 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
              v87[2](v87, v47, v48);

              v49 = [v32 uuid];
              v29 = obj;
              self = v86;
            }

            ++v31;
          }

          while (v29 != v31);
          v29 = [v27 countByEnumeratingWithState:&v94 objects:v112 count:16];
        }

        while (v29);
      }
    }

    else
    {
      [v26 setObject:v75 forKey:v25];
    }

    v53 = [v89 BOOLForKey:@"kMultiPartResponseKey"];
    v90 = 0u;
    v91 = 0u;
    v92 = 0u;
    v93 = 0u;
    obja = [v26 keyEnumerator];
    v54 = [obja countByEnumeratingWithState:&v90 objects:v104 count:16];
    if (v54)
    {
      v55 = v54;
      v56 = *v91;
      if (v53)
      {
        v57 = v89;
      }

      else
      {
        v57 = 0;
      }

      do
      {
        for (i = 0; i != v55; ++i)
        {
          if (*v91 != v56)
          {
            objc_enumerationMutation(obja);
          }

          v59 = *(*(&v90 + 1) + 8 * i);
          v60 = [v26 objectForKey:v59];
          v61 = [v89 remoteSourceDevice];
          v62 = [v59 device];
          v63 = [v61 isEqual:v62];

          if (v63)
          {
            v64 = objc_autoreleasePoolPush();
            v65 = self;
            v66 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v66, OS_LOG_TYPE_ERROR))
            {
              v67 = HMFGetLogIdentifier();
              *buf = 138543874;
              v107 = v67;
              v108 = 2112;
              v109 = v60;
              v110 = 2112;
              v111 = v89;
              _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_ERROR, "%{public}@Skipping read bulk redispatching for accessories %@ (Same source device). Message: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v64);
            v68 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
            v87[2](v87, v60, v68);

            self = v86;
          }

          else if (v59 == v79)
          {
            [(HMDHome *)self _reallyRedispatchReadsToDevice:0 accessories:v60 dispatchGroup:v82 requestMap:v78 requestMessage:v57 source:a7 responseTuples:v81 activity:v80];
          }

          else
          {
            v69 = [v59 device];
            [(HMDHome *)self _reallyRedispatchReadsToDevice:v69 accessories:v60 dispatchGroup:v82 requestMap:v78 requestMessage:v57 source:a7 responseTuples:v81 activity:v80];
          }

          v26 = v88;
        }

        v55 = [obja countByEnumeratingWithState:&v90 objects:v104 count:16];
      }

      while (v55);
    }

    v16 = v74;
    v51 = v75;
    v52 = v81;
    v15 = v82;
    v19 = v72;
    v17 = v73;
    v25 = v79;
    v24 = v80;
  }

  else
  {
    v71 = v18;
    v50 = v18;
    v51 = v75;
    [(HMDHome *)self _reallyRedispatchReadsToDevice:0 accessories:v75 dispatchGroup:v15 requestMap:v16 requestMessage:v17 source:a7 responseTuples:v71 activity:v24];
    v52 = v50;
  }

  v70 = *MEMORY[0x277D85DE8];
}

void __123__HMDHome__redispatchReadForAccessories_dispatchGroup_requestMap_requestMessage_source_responseTuples_errorResponseTuples___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v47 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v41 = 0u;
  v42 = 0u;
  v43 = 0u;
  v44 = 0u;
  obj = v5;
  v31 = [v5 countByEnumeratingWithState:&v41 objects:v46 count:16];
  if (v31)
  {
    v30 = *v42;
    do
    {
      v7 = 0;
      do
      {
        if (*v42 != v30)
        {
          objc_enumerationMutation(obj);
        }

        v35 = *(*(&v41 + 1) + 8 * v7);
        v36 = v7;
        v8 = [*(a1 + 32) objectForKey:?];
        v9 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v8, "count")}];
        v37 = 0u;
        v38 = 0u;
        v39 = 0u;
        v40 = 0u;
        v10 = v8;
        v11 = [v10 countByEnumeratingWithState:&v37 objects:v45 count:16];
        if (v11)
        {
          v12 = v11;
          v13 = *v38;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v38 != v13)
              {
                objc_enumerationMutation(v10);
              }

              v15 = *(*(&v37 + 1) + 8 * i);
              v16 = *(a1 + 40);
              v17 = [HMDCharacteristicResponse responseWithRequest:v15 error:v6];
              [v16 addObject:v17];

              v18 = [v15 characteristic];
              [v9 addObject:v18];
            }

            v12 = [v10 countByEnumeratingWithState:&v37 objects:v45 count:16];
          }

          while (v12);
        }

        v33 = [HMDCharacteristicReadWriteLogEvent alloc];
        v34 = *(a1 + 64);
        v32 = [*(a1 + 48) identifier];
        v19 = [*(a1 + 48) clientIdentifier];
        v20 = *(a1 + 48);
        v21 = [v35 home];
        v22 = [v20 userForHome:v21];
        v23 = [v22 uuid];
        LOBYTE(v28) = 0;
        LOBYTE(v27) = 1;
        v24 = [(HMDCharacteristicReadWriteLogEvent *)v33 initWithCharacteristics:v9 hmdAccessory:v35 hapAccessory:0 source:v34 isWriteOperation:0 isTimedWrite:0 isLocal:v27 transactionId:v32 isCached:v28 bundleId:v19 userUUID:v23 writtenValues:MEMORY[0x277CBEBF8]];

        v25 = [*(a1 + 56) logEventSubmitter];
        [v25 submitLogEvent:v24 error:v6];

        v7 = v36 + 1;
      }

      while (v36 + 1 != v31);
      v31 = [obj countByEnumeratingWithState:&v41 objects:v46 count:16];
    }

    while (v31);
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)_reallyRedispatchReadsToDevice:(id)a3 accessories:(id)a4 dispatchGroup:(id)a5 requestMap:(id)a6 requestMessage:(id)a7 source:(unint64_t)a8 responseTuples:(id)a9 activity:(id)a10
{
  v60 = *MEMORY[0x277D85DE8];
  v43 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v36 = a7;
  v18 = a9;
  v34 = v16;
  v35 = a10;
  dispatch_group_enter(v16);
  v19 = self;
  v20 = [(HMDHome *)self primaryResident];
  v21 = [v20 device];

  v44 = [MEMORY[0x277CBEB38] dictionary];
  v49 = 0u;
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  obj = v15;
  v45 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
  if (v45)
  {
    v22 = *v50;
    v40 = v21;
    v41 = v18;
    v39 = *v50;
    v38 = v19;
    do
    {
      for (i = 0; i != v45; ++i)
      {
        if (*v50 != v22)
        {
          objc_enumerationMutation(obj);
        }

        v24 = *(*(&v49 + 1) + 8 * i);
        context = objc_autoreleasePoolPush();
        v25 = v19;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
        {
          v27 = HMFGetLogIdentifier();
          v28 = [v24 uuid];
          v29 = [v28 UUIDString];
          v30 = [v24 uniqueIdentifier];
          *buf = 138543874;
          v54 = v27;
          v55 = 2112;
          v56 = v29;
          v57 = 2112;
          v58 = v30;
          _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Read bulk redispatching accessory %@/%@ to resident", buf, 0x20u);

          v19 = v38;
          v22 = v39;

          v18 = v41;
          v21 = v40;
        }

        objc_autoreleasePoolPop(context);
        [v21 isCurrentDevice];
        [v24 uuid];

        [v43 identifier];
        v31 = [v17 objectForKey:v24];
        [HMDHome appendCharacteristicsToAccessoryList:v44 responseTuples:v18 forMultipleCharacteristicsRemoteRead:v31];
      }

      v45 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
    }

    while (v45);
  }

  v47[0] = MEMORY[0x277D85DD0];
  v47[1] = 3221225472;
  v47[2] = __125__HMDHome__reallyRedispatchReadsToDevice_accessories_dispatchGroup_requestMap_requestMessage_source_responseTuples_activity___block_invoke;
  v47[3] = &unk_279734E00;
  v48 = v34;
  v32 = v34;
  [(HMDHome *)v19 _readCharacteristicValuesForAccessories:v44 readRequestMap:v17 responseTuples:v18 requestMessage:v36 source:a8 viaDevice:v43 completionHandler:v47];

  v33 = *MEMORY[0x277D85DE8];
}

- (void)_readCharacteristicValuesForAccessories:(id)a3 readRequestMap:(id)a4 responseTuples:(id)a5 requestMessage:(id)a6 source:(unint64_t)a7 viaDevice:(id)a8 completionHandler:(id)a9
{
  v106[3] = *MEMORY[0x277D85DE8];
  v16 = a3;
  v79 = a4;
  v73 = a5;
  v17 = a6;
  v78 = a8;
  v72 = a9;
  v18 = objc_alloc(MEMORY[0x277D0F770]);
  v19 = MEMORY[0x277CCACA8];
  v20 = MEMORY[0x259C01AE0](self, a2);
  v21 = [v19 stringWithFormat:@"%@, %s:%ld", v20, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 26763];
  v76 = [v18 initWithName:v21];

  v22 = dispatch_group_create();
  dispatch_group_enter(v22);
  v77 = [MEMORY[0x277CBEB18] array];
  v75 = [v17 BOOLForKey:@"kMultiPartResponseKey"];
  if (![v16 count])
  {
    dispatch_group_leave(v22);
    goto LABEL_27;
  }

  [MEMORY[0x277D17DC0] currentTime];
  v24 = v23;
  v25 = [v17 identifier];
  v26 = [v17 userForHome:self];
  v27 = [v26 uuid];
  v28 = [v17 clientIdentifier];
  v29 = [(HMDHome *)self _getLogEventsForOperation:0 startTime:v16 accessories:v79 requestMap:v25 identifier:v27 userUUID:a7 source:v24 biomeSource:0 bundleID:v28];

  v30 = [(HMDHome *)self uuid];
  v71 = [v30 UUIDString];

  v31 = MEMORY[0x277CBEB38];
  v32 = *MEMORY[0x277CD0640];
  v105[0] = *MEMORY[0x277CCE7A8];
  v105[1] = v32;
  v106[0] = v16;
  v106[1] = v71;
  v105[2] = @"kDoNotForwardMessageKey";
  v33 = [MEMORY[0x277CCABB0] numberWithInt:v78 != 0];
  v106[2] = v33;
  v34 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v106 forKeys:v105 count:3];
  v74 = [v31 dictionaryWithDictionary:v34];

  v70 = +[HMDHomeKitVersion version4];
  v35 = [(HMDHome *)self primaryResident];
  v36 = [v35 device];

  if (v36)
  {
    v37 = [(HMDHome *)self primaryResident];
    v38 = [v37 device];
    v39 = [v38 version];
    v40 = [v39 isAtLeastVersion:v70];

LABEL_7:
    goto LABEL_8;
  }

  if (isWatch())
  {
    v41 = [(HMDHome *)self homeManager];
    v37 = [v41 companionDevice];

    v38 = [v37 version];
    v40 = [v38 isAtLeastVersion:v70];
    goto LABEL_7;
  }

  v40 = 0;
LABEL_8:
  v42 = [v17 identifier];
  v43 = v42;
  if (((v42 != 0) & v40) != 1)
  {
LABEL_11:

    goto LABEL_12;
  }

  if (v75)
  {
    v103[0] = @"kMultiPartResponseKey";
    v103[1] = @"kRequestIdentifierKey";
    v104[0] = MEMORY[0x277CBEC38];
    v43 = [v17 identifier];
    v44 = [v43 UUIDString];
    v104[1] = v44;
    v45 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v104 forKeys:v103 count:2];
    [v74 addEntriesFromDictionary:v45];

    goto LABEL_11;
  }

LABEL_12:
  v46 = MEMORY[0x277D0F848];
  v47 = [v17 qualityOfService];
  v48 = [(HMDHome *)self messageDestination];
  v49 = [v74 copy];
  v50 = [v46 messageWithName:@"kMultipleCharacteristicReadRequestKey" qualityOfService:v47 destination:v48 payload:v49];

  objc_initWeak(&location, self);
  v91[0] = MEMORY[0x277D85DD0];
  v91[1] = 3221225472;
  v91[2] = __131__HMDHome__readCharacteristicValuesForAccessories_readRequestMap_responseTuples_requestMessage_source_viaDevice_completionHandler___block_invoke;
  v91[3] = &unk_2797227B8;
  objc_copyWeak(&v98, &location);
  v92 = v76;
  v93 = v16;
  v51 = v79;
  v94 = v51;
  v95 = v77;
  v52 = v29;
  v96 = v52;
  v97 = v22;
  [v50 setResponseHandler:v91];
  v53 = [(HMDHome *)self uuid];
  v54 = [(HMDHome *)self workQueue];
  [(HMDHome *)self redispatchToResidentMessage:v50 target:v53 responseQueue:v54 viaDevice:v78];

  if ([(HMDHome *)self remoteAccessIsEnabled])
  {
    v89 = 0u;
    v90 = 0u;
    v87 = 0u;
    v88 = 0u;
    v55 = v51;
    v56 = [v55 countByEnumeratingWithState:&v87 objects:v102 count:16];
    if (v56)
    {
      v57 = *v88;
      while (2)
      {
        for (i = 0; i != v56; ++i)
        {
          if (*v88 != v57)
          {
            objc_enumerationMutation(v55);
          }

          if ([*(*(&v87 + 1) + 8 * i) hasBTLELink])
          {
            context = objc_autoreleasePoolPush();
            v59 = self;
            v60 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v60, OS_LOG_TYPE_INFO))
            {
              v61 = HMFGetLogIdentifier();
              *buf = 138543362;
              v101 = v61;
              _os_log_impl(&dword_2531F8000, v60, OS_LOG_TYPE_INFO, "%{public}@There are BTLE accessories that are currently unreachable during the read, kicking scan to update reachability", buf, 0xCu);
            }

            objc_autoreleasePoolPop(context);
            v62 = [(HMDHome *)v59 accessoryBrowser];
            [v62 btleAccessoryReachabilityProbeTimer:1];

            goto LABEL_25;
          }
        }

        v56 = [v55 countByEnumeratingWithState:&v87 objects:v102 count:16];
        if (v56)
        {
          continue;
        }

        break;
      }
    }

LABEL_25:
  }

  objc_destroyWeak(&v98);
  objc_destroyWeak(&location);

LABEL_27:
  v63 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __131__HMDHome__readCharacteristicValuesForAccessories_readRequestMap_responseTuples_requestMessage_source_viaDevice_completionHandler___block_invoke_1610;
  block[3] = &unk_279725DE8;
  v81 = v73;
  v82 = v77;
  v83 = v17;
  v84 = self;
  v86 = v75;
  v85 = v72;
  v64 = v72;
  v65 = v17;
  v66 = v77;
  v67 = v73;
  dispatch_group_notify(v22, v63, block);

  v68 = *MEMORY[0x277D85DE8];
}

void __131__HMDHome__readCharacteristicValuesForAccessories_readRequestMap_responseTuples_requestMessage_source_viaDevice_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v64 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v45 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  if (WeakRetained)
  {
    [*(a1 + 32) begin];
    if (v5)
    {
      v6 = [MEMORY[0x277CBEB58] set];
      v54 = 0u;
      v55 = 0u;
      v56 = 0u;
      v57 = 0u;
      obj = *(a1 + 40);
      v7 = [obj countByEnumeratingWithState:&v54 objects:v63 count:16];
      if (!v7)
      {
        goto LABEL_31;
      }

      v9 = v7;
      v48 = *v55;
      *&v8 = 138543618;
      v43 = v8;
      v44 = v6;
      while (1)
      {
        v10 = 0;
        v47 = v9;
        do
        {
          if (*v55 != v48)
          {
            objc_enumerationMutation(obj);
          }

          v11 = *(*(&v54 + 1) + 8 * v10);
          v12 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v11];
          v13 = [WeakRetained accessoryWithUUID:v12];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v14 = v13;
          }

          else
          {
            v14 = 0;
          }

          v15 = v14;

          if ([v15 isPrimary])
          {
            v16 = v15;
LABEL_16:
            v17 = [*(a1 + 48) objectForKey:{v16, v43}];
            v18 = v17;
            if (v17)
            {
              v52 = 0u;
              v53 = 0u;
              v50 = 0u;
              v51 = 0u;
              v19 = [v17 countByEnumeratingWithState:&v50 objects:v58 count:16];
              if (v19)
              {
                v20 = v19;
                v21 = *v51;
                do
                {
                  v22 = 0;
                  do
                  {
                    if (*v51 != v21)
                    {
                      objc_enumerationMutation(v18);
                    }

                    v23 = [HMDCharacteristicResponse responseWithRequest:*(*(&v50 + 1) + 8 * v22) error:v5];
                    [*(a1 + 56) addObject:v23];

                    ++v22;
                  }

                  while (v20 != v22);
                  v20 = [v18 countByEnumeratingWithState:&v50 objects:v58 count:16];
                }

                while (v20);
              }

              v24 = *(a1 + 64);
              v25 = [v16 uuid];
              v26 = [v25 UUIDString];
              v27 = [v24 objectForKeyedSubscript:v26];
              [v27 setLocal:{objc_msgSend(v45, "hmf_BOOLForKey:", @"NoResident"}];

              v28 = *(a1 + 64);
              v29 = [v16 uuid];
              v30 = [v29 UUIDString];
              v31 = [v28 objectForKeyedSubscript:v30];
              v32 = [v45 objectForKeyedSubscript:@"kRemoteMessageTransportAttributionKey"];
              [v31 setTransportType:{objc_msgSend(v32, "intValue")}];

              v33 = [WeakRetained logEventSubmitter];
              v34 = *(a1 + 64);
              v35 = [v16 uuid];
              v36 = [v35 UUIDString];
              v37 = [v34 objectForKeyedSubscript:v36];
              [v33 submitLogEvent:v37 error:v5];

              v6 = v44;
              v9 = v47;
            }

            goto LABEL_29;
          }

          v16 = [v15 bridge];

          if (v16)
          {
            if ([v6 containsObject:v16])
            {
              goto LABEL_29;
            }

            [v6 addObject:v16];
            goto LABEL_16;
          }

          v38 = objc_autoreleasePoolPush();
          v39 = WeakRetained;
          v40 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v40, OS_LOG_TYPE_DEFAULT))
          {
            v41 = HMFGetLogIdentifier();
            *buf = v43;
            v60 = v41;
            v61 = 2112;
            v62 = v11;
            _os_log_impl(&dword_2531F8000, v40, OS_LOG_TYPE_DEFAULT, "%{public}@Dropping read responses for nil-ed out accessory with UUID %@", buf, 0x16u);

            v9 = v47;
          }

          objc_autoreleasePoolPop(v38);
          v16 = 0;
LABEL_29:

          ++v10;
        }

        while (v10 != v9);
        v9 = [obj countByEnumeratingWithState:&v54 objects:v63 count:16];
        if (!v9)
        {
LABEL_31:

          dispatch_group_leave(*(a1 + 72));
          goto LABEL_33;
        }
      }
    }

    [WeakRetained _addResponseTuplesFromDictionary:v45 accessoryRequestMapTable:*(a1 + 48) responseTuples:*(a1 + 56) completedGroup:*(a1 + 72) logEvents:*(a1 + 64)];
LABEL_33:
    [*(a1 + 32) end];
  }

  v42 = *MEMORY[0x277D85DE8];
}

void __131__HMDHome__readCharacteristicValuesForAccessories_readRequestMap_responseTuples_requestMessage_source_viaDevice_completionHandler___block_invoke_1610(uint64_t a1)
{
  v32 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) addObjectsFromArray:*(a1 + 40)];
  v2 = *(a1 + 48);
  if (v2)
  {
    v3 = [v2 stringForKey:@"kRequestIdentifierKey"];
    if (v3)
    {
      v4 = v3;
      v5 = [*(a1 + 56) pendingResponses];
      v6 = [v5 objectForKeyedSubscript:v4];

      [v6 addResponsesToPendingResponse:*(a1 + 40)];
    }

    else
    {
      v12 = [*(a1 + 48) identifier];
      v4 = [v12 UUIDString];

      v13 = [*(a1 + 56) pendingResponses];
      v14 = [v13 objectForKeyedSubscript:v4];

      if (v14)
      {
        [v14 setPendingResponseCount:0];
        v15 = objc_autoreleasePoolPush();
        v16 = *(a1 + 56);
        v17 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          v18 = HMFGetLogIdentifier();
          v28 = 138543618;
          v29 = v18;
          v30 = 2112;
          v31 = v4;
          _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Remove tracking pending response %@ because last response received", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v15);
        v19 = [*(a1 + 56) pendingResponses];
        [v19 removeObjectForKey:v4];
      }
    }

    v20 = objc_autoreleasePoolPush();
    v21 = *(a1 + 56);
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      v23 = HMFGetLogIdentifier();
      v28 = 138543362;
      v29 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Completed all the reads and sending notification.", &v28, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v24 = *(a1 + 56);
    v25 = *(a1 + 40);
    v26 = [*(a1 + 48) identifier];
    [v24 _notifyChangedCharacteristics:v25 identifier:v26 multiPartResponse:*(a1 + 72) moreMessagesInMultipart:*(a1 + 72) requestMessage:*(a1 + 48) withCompletionHandler:*(a1 + 64)];
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 56);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      v28 = 138543362;
      v29 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Completed all the reads and delaying notification.", &v28, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = *(a1 + 64);
    if (v11)
    {
      (*(v11 + 16))(v11, 0, 0);
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)readCharacteristicValues:(id)a3 identifier:(id)a4 source:(unint64_t)a5 qualityOfService:(int64_t)a6 withCompletionHandler:(id)a7
{
  v13 = a3;
  v14 = a4;
  v15 = a7;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x259C01AE0](self, a2);
  v19 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 26602];
  v20 = [v16 initWithName:v19];

  v21 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_2797229C0;
  v27 = v20;
  v28 = v13;
  v31 = v15;
  v32 = a5;
  v33 = a6;
  v29 = self;
  v30 = v14;
  v22 = v14;
  v23 = v15;
  v24 = v13;
  v25 = v20;
  dispatch_async(v21, block);
}

void __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  location[3] = *MEMORY[0x277D85DE8];
  if ([*(a1 + 40) count])
  {
    objc_initWeak(location, *(a1 + 48));
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke_1609;
    aBlock[3] = &unk_279722998;
    objc_copyWeak(&v18, location);
    v17 = *(a1 + 64);
    v14 = *(a1 + 32);
    v19 = *(a1 + 72);
    v15 = *(a1 + 56);
    v16 = *(a1 + 40);
    v2 = _Block_copy(aBlock);
    if ([*(a1 + 48) _shouldWaitForAccessoriesToBeReachable])
    {
      v3 = *(a1 + 40);
      v4 = [*(a1 + 48) workQueue];
      v5 = [HMDHomeAssistantOperation homeAssistantOperationWithReadRequests:v3 queue:v4];

      [*(a1 + 48) _performOperation:v5 completion:v2];
    }

    else
    {
      v2[2](v2);
    }

    objc_destroyWeak(&v18);
    objc_destroyWeak(location);
    v10 = 0;
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 48);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v9;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Empty characteristics array was given", location, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
    v10 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    v11 = *(a1 + 64);
    if (v11)
    {
      (*(v11 + 16))(v11, v10, 0);
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke_1609(uint64_t a1)
{
  v28[2] = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained)
  {
    [*(a1 + 32) begin];
    v27[0] = @"sourceType";
    v3 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 72)];
    v27[1] = @"kMultiPartResponseKey";
    v28[0] = v3;
    v28[1] = MEMORY[0x277CBEC38];
    v4 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];

    v5 = objc_alloc(MEMORY[0x277D0F848]);
    v6 = *(a1 + 80);
    v7 = [MEMORY[0x277D0F820] allMessageDestinations];
    v8 = [v5 initWithName:@"kMultipleCharacteristicReadRequestKey" qualityOfService:v6 destination:v7 payload:v4];

    [v8 setIdentifier:*(a1 + 40)];
    v9 = objc_autoreleasePoolPush();
    v10 = WeakRetained;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v8 identifier];
      v14 = HMDRequestSourceAsString(*(a1 + 72));
      v21 = 138543874;
      v22 = v12;
      v23 = 2114;
      v24 = v13;
      v25 = 2114;
      v26 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: %{public}@", &v21, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [v10 _readCharacteristicValues:*(a1 + 48) requestMessage:v8 source:*(a1 + 72) withCompletionHandler:*(a1 + 56)];
    [*(a1 + 32) end];
  }

  else
  {
    v15 = *(a1 + 56);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      (*(v15 + 16))(v15, v16, 0);
    }

    v17 = objc_autoreleasePoolPush();
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform read request", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_performOperation:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v8);

  v9 = [(HMDHome *)self assistantOperations];

  if (!v9)
  {
    v10 = [MEMORY[0x277CBEB18] array];
    [(HMDHome *)self setAssistantOperations:v10];
  }

  v11 = [(HMDHome *)self assistantOperations];
  [v11 addObject:v6];

  objc_initWeak(&location, self);
  objc_initWeak(&from, v6);
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __40__HMDHome__performOperation_completion___block_invoke;
  v13[3] = &unk_279722970;
  v12 = v7;
  v14 = v12;
  objc_copyWeak(&v15, &from);
  objc_copyWeak(&v16, &location);
  [v6 startWithCompletion:v13];
  objc_destroyWeak(&v16);
  objc_destroyWeak(&v15);

  objc_destroyWeak(&from);
  objc_destroyWeak(&location);
}

void __40__HMDHome__performOperation_completion___block_invoke(uint64_t a1)
{
  (*(*(a1 + 32) + 16))();
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = WeakRetained;
    v3 = objc_loadWeakRetained((a1 + 48));
    v4 = [v3 assistantOperations];
    [v4 removeObject:v5];

    WeakRetained = v5;
  }
}

- (BOOL)_shouldWaitForAccessoriesToBeReachable
{
  if (isWatch() && !isWatch())
  {
    v5 = 0;
  }

  else
  {
    if (!isWatch())
    {
      LOBYTE(v4) = 0;
      return v4;
    }

    v2 = +[HMDWatchSystemState sharedState];
    if ([v2 isCompanionReachable])
    {
      LOBYTE(v4) = 0;
LABEL_10:

      return v4;
    }

    v5 = 1;
  }

  v6 = [(HMDHome *)self residentDeviceManager];
  v7 = [v6 primaryResidentDevice];
  v4 = [v7 isReachable] ^ 1;

  if (v5)
  {
    goto LABEL_10;
  }

  return v4;
}

- (id)writeRequestTuplesFromMessage:(id)a3 outUnhandledRequests:(id *)a4
{
  v77 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = [v5 dictionaryForKey:*MEMORY[0x277CCE7A8]];
  v57 = [MEMORY[0x277CBEB18] array];
  v38 = a4;
  if (a4)
  {
    v7 = objc_alloc_init(MEMORY[0x277CBEB38]);
  }

  else
  {
    v7 = 0;
  }

  v8 = [v5 uuidForKey:*MEMORY[0x277CD2050]];
  if (v8)
  {
    v9 = 1;
  }

  else
  {
    v9 = [v5 BOOLForKey:*MEMORY[0x277CD2678]];
  }

  v56 = v9;

  v72 = 0u;
  v73 = 0u;
  v70 = 0u;
  v71 = 0u;
  obj = v6;
  v40 = [obj countByEnumeratingWithState:&v70 objects:v76 count:16];
  if (v40)
  {
    v39 = *v71;
    v50 = *MEMORY[0x277CD2120];
    v52 = v7;
    v55 = v5;
    do
    {
      v10 = 0;
      do
      {
        if (*v71 != v39)
        {
          objc_enumerationMutation(obj);
        }

        v42 = v10;
        v11 = *(*(&v70 + 1) + 8 * v10);
        v12 = [obj hmf_dictionaryForKey:v11];
        v53 = v11;
        v13 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v11];
        v14 = [(HMDHome *)self accessoryWithUUID:v13];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v44 = v15;

        v68 = 0u;
        v69 = 0u;
        v66 = 0u;
        v67 = 0u;
        v16 = v12;
        v46 = [v16 countByEnumeratingWithState:&v66 objects:v75 count:16];
        if (v46)
        {
          v45 = *v67;
          v43 = v16;
          do
          {
            for (i = 0; i != v46; ++i)
            {
              if (*v67 != v45)
              {
                objc_enumerationMutation(v16);
              }

              v18 = *(*(&v66 + 1) + 8 * i);
              v19 = [v16 hmf_dictionaryForKey:v18];
              v54 = v18;
              v20 = HAPInstanceIDFromValue();
              if (v20)
              {
                v49 = i;
                v47 = v20;
                v59 = [v44 findService:v20];
                v62 = 0u;
                v63 = 0u;
                v64 = 0u;
                v65 = 0u;
                v48 = v19;
                v21 = v19;
                v61 = [v21 countByEnumeratingWithState:&v62 objects:v74 count:16];
                if (v61)
                {
                  v22 = *v63;
                  v58 = *v63;
                  do
                  {
                    for (j = 0; j != v61; ++j)
                    {
                      if (*v63 != v22)
                      {
                        objc_enumerationMutation(v21);
                      }

                      v24 = *(*(&v62 + 1) + 8 * j);
                      v25 = HAPInstanceIDFromValue();
                      if (v25)
                      {
                        v26 = [v59 findCharacteristic:v25];
                        if (v26)
                        {
                          if ([v5 isRemote])
                          {
                            v27 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v24, @"kAuthorizationDataKey"];
                            v28 = [v21 hmf_dataForKey:v27];
                          }

                          else
                          {
                            v28 = [v26 authorizationData];
                          }

                          v60 = [v21 hmf_BOOLForKey:@"HMDCharacteristicWriteRequestIncludeResponseValueKey"];
                          if ([v5 isRemote])
                          {
                            v30 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v24, v50];
                            v29 = [v21 hmf_dataForKey:v30];
                          }

                          else
                          {
                            v30 = [(HMDHome *)self currentUser];
                            v31 = [v30 notificationContextHAPIdentifier];
                            v29 = [v26 contextDataForWriteRequestWithIdentifier:v31];
                          }

                          [v21 objectForKeyedSubscript:v24];
                          v33 = v32 = v21;
                          v5 = v55;
                          v34 = [v55 identifier];
                          v35 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:v26 value:v33 authorizationData:v28 identifier:v34 type:v56 includeResponseValue:v60 contextData:v29];

                          v21 = v32;
                          [v57 addObject:v35];

                          v22 = v58;
                        }

                        else
                        {
                          v28 = [v52 hmf_mutableDictionaryForKey:v53];
                          if (!v28)
                          {
                            v28 = objc_alloc_init(MEMORY[0x277CBEB38]);
                            [v52 setObject:v28 forKeyedSubscript:v53];
                          }

                          v29 = [v28 hmf_mutableArrayForKey:v54];
                          if (!v29)
                          {
                            v29 = objc_alloc_init(MEMORY[0x277CBEB18]);
                            [v28 setObject:v29 forKeyedSubscript:v54];
                          }

                          [v29 addObject:v25];
                        }
                      }
                    }

                    v61 = [v21 countByEnumeratingWithState:&v62 objects:v74 count:16];
                  }

                  while (v61);
                }

                v7 = v52;
                v16 = v43;
                v19 = v48;
                i = v49;
                v20 = v47;
              }
            }

            v46 = [v16 countByEnumeratingWithState:&v66 objects:v75 count:16];
          }

          while (v46);
        }

        v10 = v42 + 1;
      }

      while (v42 + 1 != v40);
      v40 = [obj countByEnumeratingWithState:&v70 objects:v76 count:16];
    }

    while (v40);
  }

  if (v38)
  {
    *v38 = [v7 copy];
  }

  v36 = *MEMORY[0x277D85DE8];

  return v57;
}

- (void)_areWriteRequestsAllowed:(id)a3 message:(id)a4 completion:(id)a5
{
  v12 = a3;
  v8 = a4;
  v9 = a5;
  v10 = [v8 source];
  if ([(HMDHome *)self applyDeviceLockStatus:v8])
  {
    [(HMDHome *)self _applyDeviceLockCheck:v12 forSource:v10 message:v8 completion:v9];
  }

  else
  {
    v11 = _Block_copy(v9);

    if (v11)
    {
      v11[2](v11, 1, 0);
      v9 = v11;
    }

    else
    {
      v9 = 0;
    }
  }
}

- (void)_applyDeviceLockCheck:(uint64_t)a3 forSource:(void *)a4 message:(void *)a5 completion:
{
  v77 = *MEMORY[0x277D85DE8];
  v51 = a2;
  v53 = a4;
  v50 = a5;
  if (a1)
  {
    v8 = [a1 synchronouslyFetchIsCarPlayConnectedStatus];
    v58 = a1;
    v9 = [a1 dataSource];
    v10 = [v9 deviceLockStateDataSource];
    v11 = [v10 isPasscodeEnabled];

    v66 = 0u;
    v67 = 0u;
    v64 = 0u;
    v65 = 0u;
    obj = v51;
    v57 = [(__CFString *)obj countByEnumeratingWithState:&v64 objects:v76 count:16];
    if (v57)
    {
      v56 = *v65;
      v52 = v11 & v8;
LABEL_4:
      v12 = 0;
      while (1)
      {
        if (*v65 != v56)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v64 + 1) + 8 * v12);
        v14 = [(__CFString *)v13 characteristic];
        v15 = [(__CFString *)v14 service];
        v16 = [v58 dataSource];
        v17 = [v16 hapMetadata];
        v18 = [(__CFString *)v14 type];
        v19 = [v15 type];
        v20 = [v17 requiresDeviceUnlock:v18 forService:v19];

        if (v20)
        {
          v21 = [v58 dataSource];
          v22 = [v21 hapMetadata];
          v23 = [(__CFString *)v14 type];
          v24 = [(__CFString *)v13 value];
          v25 = [v22 allowsSecuringWriteFor:v23 withValue:v24];

          if (((a3 == 1) & v25) == 0)
          {
            v26 = v52 ? [v58 isCarPlayAccessAllowedForCharacteristic:v14 withMessage:v53 fromSource:a3] : 0;
            if ((([v58 isAccessAllowedForCharacteristicsWithMessage:v53] | v26) & 1) == 0)
            {
              break;
            }
          }
        }

        if (v57 == ++v12)
        {
          v57 = [(__CFString *)obj countByEnumeratingWithState:&v64 objects:v76 count:16];
          if (v57)
          {
            goto LABEL_4;
          }

          goto LABEL_23;
        }
      }

      v27 = HMDSecureAccessErrorCodeForMessage(v53, a3);
      v28 = objc_autoreleasePoolPush();
      v29 = v58;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
      {
        v31 = HMFGetLogIdentifier();
        v32 = HMDRequestSourceAsString(a3);
        *buf = 138544130;
        v69 = v31;
        v70 = 2112;
        v71 = v13;
        v72 = 2112;
        v73 = v14;
        v74 = 2112;
        v75 = v32;
        _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@Write request (%@) for characteristic: %@ from source: %@ is attempting to perform a securing write", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v28);
      if (a3 != 1)
      {
        goto LABEL_28;
      }

      if (!v27)
      {
        goto LABEL_24;
      }

      v33 = objc_autoreleasePoolPush();
      v34 = v29;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543362;
        v69 = v36;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Checking siri unlock access for siri triggered write request", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v33);
      objc_initWeak(buf, v34);
      v37 = [v34 siriSecureAccessoryAccessController];
      v59[0] = MEMORY[0x277D85DD0];
      v59[1] = 3221225472;
      v59[2] = __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke;
      v59[3] = &unk_279732A70;
      objc_copyWeak(&v63, buf);
      v62 = v50;
      v60 = obj;
      v38 = v27;
      v61 = v38;
      [v37 isUnsecuringSiriActionAllowedWithCompletion:v59];

      objc_destroyWeak(&v63);
      objc_destroyWeak(buf);
    }

    else
    {
LABEL_23:

      if (a3 == 1)
      {
LABEL_24:
        v39 = objc_autoreleasePoolPush();
        v40 = v58;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          *buf = 138543874;
          v69 = v42;
          v70 = 2112;
          v71 = obj;
          v72 = 2112;
          v73 = @"Siri";
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Access is allowed for write requests (%@) from source: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v39);
        (*(v50 + 2))(v50, 1, 0);
      }

      else
      {
        v27 = 0;
LABEL_28:
        v43 = objc_autoreleasePoolPush();
        v44 = v58;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
        {
          v46 = HMFGetLogIdentifier();
          if (v27)
          {
            v47 = @"denied";
          }

          else
          {
            v47 = @"allowed";
          }

          v48 = HMDRequestSourceAsString(a3);
          *buf = 138544130;
          v69 = v46;
          v70 = 2112;
          v71 = v47;
          v72 = 2112;
          v73 = obj;
          v74 = 2112;
          v75 = v48;
          _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_INFO, "%{public}@Access is %@ for write requests (%@) from source: %@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v43);
        (*(v50 + 2))(v50, v27 == 0, v27);
      }
    }
  }

  v49 = *MEMORY[0x277D85DE8];
}

void __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke(uint64_t a1, int a2)
{
  v25 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = @"denied";
      v10 = *(a1 + 32);
      *buf = 138543874;
      v20 = v8;
      if (a2)
      {
        v9 = @"allowed";
      }

      v21 = 2112;
      v22 = v9;
      v23 = 2112;
      v24 = v10;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Access is %@ for write requests (%@) by siri watch authentication", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = [v6 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke_1550;
    block[3] = &unk_279733DB0;
    v17 = *(a1 + 48);
    v18 = a2;
    v16 = *(a1 + 40);
    dispatch_async(v11, block);
  }

  else
  {
    v12 = *(a1 + 48);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    (*(v12 + 16))(v12, 0, v13);
  }

  v14 = *MEMORY[0x277D85DE8];
}

uint64_t __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke_1550(uint64_t a1)
{
  v2 = *(a1 + 40);
  if ((*(a1 + 48) & 1) == 0)
  {
    v3 = *(a1 + 32);
  }

  return (*(v2 + 16))();
}

- (void)_handleMultipleCharacteristicWrite:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v23 = 0;
  v5 = [(HMDHome *)self writeRequestTuplesFromMessage:v4 outUnhandledRequests:&v23];
  v6 = v23;
  if ([v6 count])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [v4 shortDescription];
      *buf = 138543874;
      v25 = v10;
      v26 = 2112;
      v27 = v11;
      v28 = 2112;
      v29 = v6;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ has characteristic requests that cannot be handled: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v12 = [v4 source];
  [v5 count];
  [v4 isRemote];
  v13 = HMDRequestSourceAsString(v12);
  objc_initWeak(buf, self);
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __46__HMDHome__handleMultipleCharacteristicWrite___block_invoke;
  v18[3] = &unk_279722948;
  objc_copyWeak(v22, buf);
  v14 = v4;
  v19 = v14;
  v22[1] = v12;
  v15 = v5;
  v20 = v15;
  v16 = v6;
  v21 = v16;
  [(HMDHome *)self _areWriteRequestsAllowed:v15 message:v14 completion:v18];

  objc_destroyWeak(v22);
  objc_destroyWeak(buf);

  v17 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleMultipleCharacteristicWrite___block_invoke(uint64_t a1, char a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v7 = WeakRetained;
  if (a2)
  {
    v8 = *(a1 + 32);
    if (WeakRetained)
    {
      [WeakRetained startReportingSessionForMessage:*(a1 + 32)];
      v9 = objc_autoreleasePoolPush();
      v10 = v7;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 0;
        *&buf[8] = 0;
        v13 = [*(a1 + 32) identifier];

        if (v13)
        {
          v14 = [*(a1 + 32) identifier];
          [v14 getUUIDBytes:buf];
        }

        else
        {
          *buf = *MEMORY[0x277D0F960];
        }

        v21 = *buf;
        v16 = HMDRequestSourceAsString(*(a1 + 64));
        *buf = 138544130;
        *&buf[4] = v12;
        *&buf[12] = 1042;
        *&buf[14] = 16;
        v23 = 2098;
        v24 = &v21;
        v25 = 2114;
        v26 = v16;
        _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Handling multiple characteristics write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
      }

      objc_autoreleasePoolPop(v9);
      v18 = *(a1 + 32);
      v17 = *(a1 + 40);
      v19 = *(a1 + 64);
      v15 = [v10 __readWriteResponseHandler:v18 unhandledRequests:*(a1 + 48)];
      [v10 _writeCharacteristicValues:v17 requestMessage:v18 source:v19 biomeSource:0 withCompletionHandler:v15];
    }

    else
    {
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v8 respondWithError:v15];
    }
  }

  else
  {
    [*(a1 + 32) respondWithError:v5];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleCharacteristicWrite:(id)a3
{
  v37[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 messagePayload];
  v6 = [v5 hmf_UUIDForKey:*MEMORY[0x277CCF0B0]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  if (v9)
  {
    if ([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
    {
      v10 = [v4 messagePayload];
      v11 = [v10 objectForKeyedSubscript:*MEMORY[0x277CD25F8]];
      v27 = HAPInstanceIDFromValue();

      v12 = [v4 messagePayload];
      v13 = [v12 objectForKeyedSubscript:*MEMORY[0x277CD2140]];
      v14 = HAPInstanceIDFromValue();

      v26 = [v9 findService:v27];
      v15 = [v26 findCharacteristic:v14];
      if (v15)
      {
        if ([v4 isRemote])
        {
          [v4 dataForKey:@"kAuthorizationDataKey"];
        }

        else
        {
          [v15 authorizationData];
        }
        v25 = ;
        v18 = [v4 messagePayload];
        v19 = [v18 objectForKeyedSubscript:*MEMORY[0x277CD21B8]];
        v20 = [v4 identifier];
        v21 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:v15 value:v19 authorizationData:v25 identifier:v20 type:0 includeResponseValue:0];

        objc_initWeak(&location, self);
        v37[0] = v21;
        v22 = [MEMORY[0x277CBEA60] arrayWithObjects:v37 count:1];
        v28[0] = MEMORY[0x277D85DD0];
        v28[1] = 3221225472;
        v28[2] = __38__HMDHome__handleCharacteristicWrite___block_invoke;
        v28[3] = &unk_279722920;
        objc_copyWeak(&v35, &location);
        v29 = v4;
        v30 = v6;
        v31 = v9;
        v32 = v27;
        v33 = v14;
        v23 = v21;
        v34 = v23;
        [(HMDHome *)self _areWriteRequestsAllowed:v22 message:v29 completion:v28];

        objc_destroyWeak(&v35);
        objc_destroyWeak(&location);
      }

      else
      {
        v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        [v4 respondWithError:v17];
      }
    }

    else
    {
      [v9 _handleCharacteristicWrite:v4];
    }
  }

  else
  {
    v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v16];
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__handleCharacteristicWrite___block_invoke(uint64_t a1, char a2, void *a3)
{
  v38 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v7 = WeakRetained;
  if (a2)
  {
    if (WeakRetained)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = v7;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = [*(a1 + 32) shortDescription];
        v13 = [*(a1 + 40) UUIDString];
        v14 = [*(a1 + 48) uniqueIdentifier];
        v15 = *(a1 + 56);
        v16 = *(a1 + 64);
        *buf = 138544642;
        *&buf[4] = v11;
        *&buf[12] = 2112;
        *&buf[14] = v12;
        *&buf[22] = 2112;
        *&buf[24] = v13;
        *&buf[32] = 2112;
        *&buf[34] = v14;
        v34 = 2112;
        v35 = v15;
        v36 = 2112;
        v37 = v16;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Processing single characteristic write request: %@ (%@/%@/%@/%@) as a special case of multiple characteristic write requests", buf, 0x3Eu);
      }

      objc_autoreleasePoolPop(v8);
      v17 = [*(a1 + 32) source];
      v18 = objc_autoreleasePoolPush();
      v19 = v9;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 0;
        *&buf[8] = 0;
        v22 = [*(a1 + 32) identifier];

        if (v22)
        {
          v23 = [*(a1 + 32) identifier];
          [v23 getUUIDBytes:buf];
        }

        else
        {
          *buf = *MEMORY[0x277D0F960];
        }

        v32 = *buf;
        v26 = HMDRequestSourceAsString(v17);
        *buf = 138544130;
        *&buf[4] = v21;
        *&buf[12] = 1042;
        *&buf[14] = 16;
        *&buf[18] = 2098;
        *&buf[20] = &v32;
        *&buf[28] = 2114;
        *&buf[30] = v26;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Handling single characteristic write request with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
      }

      objc_autoreleasePoolPop(v18);
      v31 = *(a1 + 72);
      v27 = [MEMORY[0x277CBEA60] arrayWithObjects:&v31 count:1];
      v28 = *(a1 + 32);
      v29 = [v19 __readWriteResponseHandler:v28 unhandledRequests:0];
      [v19 _writeCharacteristicValues:v27 requestMessage:v28 source:v17 biomeSource:0 withCompletionHandler:v29];
    }

    else
    {
      v24 = *(a1 + 32);
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v24 respondWithError:v25];
    }
  }

  else
  {
    [*(a1 + 32) respondWithError:v5];
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (id)__readWriteResponseHandler:(id)a3 unhandledRequests:(id)a4
{
  v6 = a3;
  v7 = a4;
  objc_initWeak(&location, self);
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __56__HMDHome___readWriteResponseHandler_unhandledRequests___block_invoke;
  v12[3] = &unk_279735248;
  objc_copyWeak(&v15, &location);
  v13 = v7;
  v14 = v6;
  v8 = v6;
  v9 = v7;
  v10 = _Block_copy(v12);

  objc_destroyWeak(&v15);
  objc_destroyWeak(&location);

  return v10;
}

void __56__HMDHome___readWriteResponseHandler_unhandledRequests___block_invoke(id *a1, void *a2, void *a3)
{
  v23 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if ([a1[4] count])
  {
    v8 = [HMDCharacteristicResponseNotificationContext updateMultipleCharacteristicReadWriteResponsePayload:v6 withUnhandledRequests:a1[4]];

    v6 = v8;
  }

  v9 = objc_autoreleasePoolPush();
  v10 = WeakRetained;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [a1[5] shortDescription];
    v15 = 138544130;
    v16 = v12;
    v17 = 2112;
    v18 = v13;
    v19 = 2112;
    v20 = v6;
    v21 = 2112;
    v22 = v5;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Responding to the client: %@ with payload : %@, error: %@", &v15, 0x2Au);
  }

  objc_autoreleasePoolPop(v9);
  [a1[5] respondWithPayload:v6 error:v5];
  [a1[5] setResponseHandler:0];
  [v10 endReportingSessionForMessage:a1[5]];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_addResponseTuplesFromDictionary:(id)a3 accessoryRequestMapTable:(id)a4 responseTuples:(id)a5 completedGroup:(id)a6 logEvents:(id)a7
{
  v61 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = self;
  v40 = v13;
  v39 = a5;
  group = a6;
  v37 = a7;
  v41 = v12;
  [v12 hmf_dictionaryForKey:@"kModifiedCharacteristicsForAccessoryKey"];
  v56 = 0u;
  v57 = 0u;
  v58 = 0u;
  obj = v59 = 0u;
  v43 = [obj countByEnumeratingWithState:&v56 objects:v60 count:16];
  if (v43)
  {
    v42 = *v57;
    v36 = v47;
    do
    {
      for (i = 0; i != v43; ++i)
      {
        if (*v57 != v42)
        {
          objc_enumerationMutation(obj);
        }

        v16 = *(*(&v56 + 1) + 8 * i);
        v17 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:{v16, v36}];
        v18 = [(HMDHome *)v14 accessoryWithUUID:v17];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (v20)
        {
          v21 = [v20 bridge];
          v45 = v17;
          v22 = v21;
          if (v21)
          {
            v23 = v21;
          }

          else
          {
            v23 = v20;
          }

          v24 = v23;

          v25 = [v24 uuid];
          v26 = [v25 UUIDString];

          v27 = [v40 objectForKey:v24];
          v28 = [obj hmf_dictionaryForKey:v16];
          dispatch_group_enter(group);
          v29 = [(HMDHome *)v14 workQueue];
          v46[0] = MEMORY[0x277D85DD0];
          v46[1] = 3221225472;
          v47[0] = __109__HMDHome__addResponseTuplesFromDictionary_accessoryRequestMapTable_responseTuples_completedGroup_logEvents___block_invoke;
          v47[1] = &unk_2797228F8;
          v48 = v27;
          v30 = v14;
          v31 = v20;
          v49 = v31;
          v50 = v37;
          v51 = v26;
          v52 = v41;
          v53 = v30;
          v54 = v39;
          v55 = group;
          v32 = v26;
          v33 = v27;
          v34 = v31;
          v14 = v30;
          [v34 handleMultipleCharacteristicsUpdated:v28 message:0 completionQueue:v29 completionHandler:v46];

          v17 = v45;
        }
      }

      v43 = [obj countByEnumeratingWithState:&v56 objects:v60 count:16];
    }

    while (v43);
  }

  dispatch_group_leave(group);

  v35 = *MEMORY[0x277D85DE8];
}

void __109__HMDHome__addResponseTuplesFromDictionary_accessoryRequestMapTable_responseTuples_completedGroup_logEvents___block_invoke(uint64_t a1, void *a2)
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v4 = *(a1 + 32);
  v5 = [v4 countByEnumeratingWithState:&v34 objects:v38 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v35;
    v30 = v3;
    v31 = *v35;
    v29 = a1;
    do
    {
      v8 = 0;
      v33 = v6;
      do
      {
        if (*v35 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v34 + 1) + 8 * v8);
        v10 = [v9 characteristic];
        v11 = [v10 accessory];
        v12 = *(a1 + 40);

        if (v11 == v12)
        {
          v13 = [v9 characteristic];
          v14 = [v3 objectForKey:v13];

          v15 = [*(a1 + 48) objectForKeyedSubscript:*(a1 + 56)];
          v16 = v15;
          if (v15 && ([v15 isSubmitted] & 1) == 0)
          {
            v17 = [*(a1 + 64) objectForKeyedSubscript:@"kRemoteMessageTransportAttributionKey"];
            [v16 setTransportType:{objc_msgSend(v17, "intValue")}];

            v18 = [*(a1 + 72) logEventSubmitter];
            v19 = [v14 error];
            [v18 submitLogEvent:v16 error:v19];

            v6 = v33;
            v7 = v31;
          }

          if (v14 && *(a1 + 80))
          {
            v20 = [v14 error];
            v21 = [HMDCharacteristicResponse responseWithRequest:v9 error:v20];

            v32 = [v9 characteristic];
            v22 = [v32 value];
            v23 = [v14 valueUpdatedTime];
            v24 = [v14 valueUpdatedStateNumber];
            v25 = [v9 characteristic];
            [v25 notificationContext];
            v27 = v26 = v4;
            [v21 setValue:v22 updatedTime:v23 stateNumber:v24 notificationContext:v27];

            v4 = v26;
            v7 = v31;

            v3 = v30;
            a1 = v29;

            v6 = v33;
            [*(v29 + 80) addObject:v21];
          }
        }

        ++v8;
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v34 objects:v38 count:16];
    }

    while (v6);
  }

  dispatch_group_leave(*(a1 + 88));
  v28 = *MEMORY[0x277D85DE8];
}

- (void)_writeCharacteristicValues:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 biomeSource:(unint64_t)a6 withCompletionHandler:(id)a7
{
  v61 = *MEMORY[0x277D85DE8];
  v49 = a3;
  v13 = a4;
  v48 = a7;
  v14 = objc_alloc(MEMORY[0x277D0F770]);
  v15 = MEMORY[0x277CCACA8];
  v16 = MEMORY[0x259C01AE0](self, a2);
  v17 = [v15 stringWithFormat:@"%@, %s:%ld", v16, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 26007];
  v56 = [v14 initWithName:v17];

  if ([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
  {
    v18 = [(HMDHome *)self isCurrentDeviceAvailableResident];
    v19 = objc_autoreleasePoolPush();
    v20 = self;
    if (v18)
    {
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v22 = HMFGetLogIdentifier();
        v23 = [v13 shortDescription];
        *buf = 138543618;
        v58 = v22;
        v59 = 2112;
        v60 = v23;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Running new accessory communication logic for resident. %@", buf, 0x16u);
      }
    }

    else
    {
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        v31 = [v13 shortDescription];
        *buf = 138543618;
        v58 = v30;
        v59 = 2112;
        v60 = v31;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Routing accessory write requests using Resident First logic. %@", buf, 0x16u);
      }
    }

    objc_autoreleasePoolPop(v19);
    v32 = [(HMDHome *)v20 _createMessageForReadWriteRequest:v13 source:a5 withCompletionHandler:v48];
    v33 = [(HMDHome *)v20 accessoryReaderWriter];
    [v33 submitWriteRequests:v49 sourceType:a5 biomeSource:a6 requestMessage:v32];
  }

  else
  {
    v24 = [MEMORY[0x277CBEB18] array];
    v25 = [v13 identifier];
    v26 = [v13 BOOLForKey:@"kMultiPartResponseKey"];
    v47 = [v13 userForHome:self];
    v46 = dispatch_group_create();
    v27 = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
    v44 = v26;
    v45 = v25;
    v28 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v49, "count")}];
    [(HMDHome *)self _buildCharacteristicWriteRequest:v49 accessoryWriteRequestMapTable:v27 accessoryList:v28 responseTuples:v24 user:v47];
    v29 = [MEMORY[0x277CBEB38] dictionary];
    if (isWatch() && [(HMDHome *)self _passWriteRequestToCompanion:v27 requestMessage:v13 source:a5 biomeSource:a6 remoteAccessories:v29 responseTuples:v24 withCompletionHandler:v48]|| [(HMDHome *)self _loadBalanceWriteRequestOnResidentForAccessory:v28 accessoryWriteRequestMapTable:v27 requestMessage:v13 source:a5 biomeSource:a6 responseTuples:v24 withCompletionHandler:v48])
    {
    }

    else
    {
      v43 = v29;
      v34 = a6;
      v35 = [MEMORY[0x277CBEB18] array];
      v36 = dispatch_group_create();
      [(HMDHome *)self _sendWriteRequestToAccessoryServer:v27 requestMessage:v13 source:a5 failedAccessories:v35 responseTuples:v24 activity:v56 waitGroup:v46 unreachableWaitGroup:v36];
      v37 = dispatch_group_create();
      dispatch_group_enter(v37);
      v42 = v36;
      [(HMDHome *)self _waitForEarlyDispatchTimeout:v27 requestMessage:v13 source:a5 biomeSource:v34 failedAccessories:v35 responseTuples:v24 activity:v56 unreachableWaitGroup:v36 failureWaitGroup:v37];
      [(HMDHome *)self _waitForWriteRequestFanOut:v27 requestMessage:v13 source:a5 biomeSource:v34 responseTuples:v24 failedAccessories:v35 activity:v56 waitGroup:v46 failureWaitGroup:v37];
      v38 = [(HMDHome *)self workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __94__HMDHome__writeCharacteristicValues_requestMessage_source_biomeSource_withCompletionHandler___block_invoke;
      block[3] = &unk_279725DE8;
      v55 = v44;
      block[4] = self;
      v51 = v24;
      v52 = v45;
      v53 = v13;
      v54 = v48;
      v39 = v45;
      v40 = v24;
      dispatch_group_notify(v37, v38, block);
    }
  }

  __HMFActivityScopeLeave();

  v41 = *MEMORY[0x277D85DE8];
}

uint64_t __94__HMDHome__writeCharacteristicValues_requestMessage_source_biomeSource_withCompletionHandler___block_invoke(uint64_t a1)
{
  v14 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = v5;
    v7 = "single";
    if (*(a1 + 72))
    {
      v7 = "multi";
    }

    v10 = 138543618;
    v11 = v5;
    v12 = 2080;
    v13 = v7;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Final notification for multi-write (%s part)", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  result = [*(a1 + 32) _notifyChangedCharacteristics:*(a1 + 40) identifier:*(a1 + 48) multiPartResponse:*(a1 + 72) moreMessagesInMultipart:0 requestMessage:*(a1 + 56) withCompletionHandler:*(a1 + 64)];
  v9 = *MEMORY[0x277D85DE8];
  return result;
}

- (id)_createMessageForReadWriteRequest:(id)a3 source:(unint64_t)a4 withCompletionHandler:(id)a5
{
  v7 = a3;
  v8 = a5;
  v9 = [v7 internal];
  v10 = [v9 copy];

  v11 = [objc_alloc(objc_opt_class()) initWithInternalMessage:v10];
  objc_initWeak(&location, v11);
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __74__HMDHome__createMessageForReadWriteRequest_source_withCompletionHandler___block_invoke;
  v15[3] = &unk_2797328E8;
  objc_copyWeak(&v19, &location);
  v12 = v8;
  v18 = v12;
  v13 = v7;
  v16 = v13;
  v17 = self;
  [v11 setResponseHandler:v15];

  objc_destroyWeak(&v19);
  objc_destroyWeak(&location);

  return v11;
}

void __74__HMDHome__createMessageForReadWriteRequest_source_withCompletionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v8 = _Block_copy(*(a1 + 48));
  v9 = v8;
  if (v8)
  {
    (*(v8 + 2))(v8, v5, v6);
  }

  v10 = [*(a1 + 32) responseHandler];

  if (!v10)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [*(a1 + 32) shortDescription];
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = v15;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEBUG, "%{public}@The response handler became nil for read/write request message: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    [WeakRetained setResponseHandler:0];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_waitForWriteRequestFanOut:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 biomeSource:(unint64_t)a6 responseTuples:(id)a7 failedAccessories:(id)a8 activity:(id)a9 waitGroup:(id)a10 failureWaitGroup:(id)a11
{
  v15 = a3;
  v16 = a4;
  v17 = a7;
  v18 = a8;
  v19 = a9;
  v20 = a11;
  v21 = a10;
  v22 = [v16 BOOLForKey:@"kMultiPartResponseKey"];
  v23 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __141__HMDHome__waitForWriteRequestFanOut_requestMessage_source_biomeSource_responseTuples_failedAccessories_activity_waitGroup_failureWaitGroup___block_invoke;
  block[3] = &unk_2797228A8;
  v33 = v19;
  v34 = v18;
  v42 = v22;
  v35 = v17;
  v36 = self;
  v37 = v20;
  v38 = v15;
  v39 = v16;
  v40 = a5;
  v41 = a6;
  v24 = v16;
  v25 = v15;
  v26 = v20;
  v27 = v17;
  v28 = v18;
  v29 = v19;
  dispatch_group_notify(v21, v23, block);
}

uint64_t __141__HMDHome__waitForWriteRequestFanOut_requestMessage_source_biomeSource_responseTuples_failedAccessories_activity_waitGroup_failureWaitGroup___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) begin];
  if ([*(a1 + 40) count])
  {
    [*(a1 + 40) count];
    if (*(a1 + 104))
    {
      v2 = [MEMORY[0x277CBEB18] array];
    }

    else
    {
      v2 = *(a1 + 48);
    }

    v3 = v2;
    [*(a1 + 32) begin];
    v10 = *(a1 + 32);
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 56);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543362;
      v12 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Beginning bulk redispatch for write failed accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 56) _redispatchWriteForAccessories:*(a1 + 40) dispatchGroup:*(a1 + 64) requestMap:*(a1 + 72) requestMessage:*(a1 + 80) source:*(a1 + 88) biomeSource:*(a1 + 96) responseTuples:v3];
    __HMFActivityScopeLeave();

    [*(a1 + 40) removeAllObjects];
  }

  dispatch_group_leave(*(a1 + 64));
  result = [*(a1 + 32) end];
  v9 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_waitForEarlyDispatchTimeout:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 biomeSource:(unint64_t)a6 failedAccessories:(id)a7 responseTuples:(id)a8 activity:(id)a9 unreachableWaitGroup:(id)a10 failureWaitGroup:(id)a11
{
  v15 = a3;
  v16 = a4;
  v17 = a7;
  v18 = a8;
  v19 = a9;
  v20 = a10;
  v21 = a11;
  v22 = [v16 BOOLForKey:@"kMultiPartResponseKey"];
  v23 = dispatch_get_global_queue(0, 0);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __154__HMDHome__waitForEarlyDispatchTimeout_requestMessage_source_biomeSource_failedAccessories_responseTuples_activity_unreachableWaitGroup_failureWaitGroup___block_invoke;
  block[3] = &unk_2797228D0;
  v34 = v20;
  v35 = self;
  v36 = v19;
  v37 = v17;
  v44 = v22;
  v38 = v18;
  v39 = v21;
  v40 = v15;
  v41 = v16;
  v42 = a5;
  v43 = a6;
  v24 = v16;
  v25 = v15;
  v26 = v21;
  v27 = v18;
  v28 = v17;
  v29 = v19;
  v30 = v20;
  dispatch_async(v23, block);
}

void __154__HMDHome__waitForEarlyDispatchTimeout_requestMessage_source_biomeSource_failedAccessories_responseTuples_activity_unreachableWaitGroup_failureWaitGroup___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = dispatch_time(0, 250000000);
  dispatch_group_wait(v2, v3);
  v4 = [*(a1 + 40) workQueue];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __154__HMDHome__waitForEarlyDispatchTimeout_requestMessage_source_biomeSource_failedAccessories_responseTuples_activity_unreachableWaitGroup_failureWaitGroup___block_invoke_2;
  v9[3] = &unk_2797228A8;
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v16 = *(a1 + 112);
  *&v7 = *(a1 + 64);
  *(&v7 + 1) = *(a1 + 40);
  *&v8 = v5;
  *(&v8 + 1) = v6;
  v10 = v8;
  v11 = v7;
  v12 = *(a1 + 72);
  v13 = *(a1 + 80);
  v14 = *(a1 + 88);
  v15 = *(a1 + 96);
  dispatch_async(v4, v9);
}

void __154__HMDHome__waitForEarlyDispatchTimeout_requestMessage_source_biomeSource_failedAccessories_responseTuples_activity_unreachableWaitGroup_failureWaitGroup___block_invoke_2(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 40) copy];
  if ([v2 count])
  {
    [v2 count];
    if (*(a1 + 104))
    {
      v3 = [MEMORY[0x277CBEB18] array];
    }

    else
    {
      v3 = *(a1 + 48);
    }

    v4 = v3;
    [*(a1 + 32) begin];
    v10 = *(a1 + 32);
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 56);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v12 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Beginning bulk redispatch for unreachable write failed accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 56) _redispatchWriteForAccessories:v2 dispatchGroup:*(a1 + 64) requestMap:*(a1 + 72) requestMessage:*(a1 + 80) source:*(a1 + 88) biomeSource:*(a1 + 96) responseTuples:v4];
    __HMFActivityScopeLeave();

    [*(a1 + 40) removeObjectsInArray:v2];
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_sendWriteRequestToAccessoryServer:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 failedAccessories:(id)a6 responseTuples:(id)a7 activity:(id)a8 waitGroup:(id)a9 unreachableWaitGroup:(id)a10
{
  v69 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v42 = a6;
  v41 = a7;
  v45 = a8;
  v16 = a9;
  v17 = a10;
  v18 = [v15 BOOLForKey:@"kDoNotForwardMessageKey"];
  v36 = [v15 BOOLForKey:@"kMultiPartResponseKey"];
  v39 = v15;
  v40 = [v15 identifier];
  v58 = 0u;
  v59 = 0u;
  v60 = 0u;
  v61 = 0u;
  obj = v14;
  v43 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
  if (v43)
  {
    v35 = v18 ^ 1;
    v34 = *v59;
    v33 = v17;
    do
    {
      for (i = 0; i != v43; ++i)
      {
        if (*v59 != v34)
        {
          objc_enumerationMutation(obj);
        }

        v20 = *(*(&v58 + 1) + 8 * i);
        dispatch_group_enter(v16);
        dispatch_group_enter(v17);
        v21 = [obj objectForKey:v20];
        v22 = [v20 shortDescription];
        [v45 markWithFormat:@"Starting write for accessory: %@", v22];

        v23 = [v20 uuid];
        v24 = objc_autoreleasePoolPush();
        v25 = self;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
        {
          v27 = HMFGetLogIdentifier();
          v28 = [v21 count];
          *buf = 138543874;
          v63 = v27;
          v64 = 2112;
          v65 = v23;
          v66 = 2048;
          v67 = v28;
          _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_DEFAULT, "%{public}@Starting write for accessory %@ with %ld requests", buf, 0x20u);

          v17 = v33;
        }

        objc_autoreleasePoolPop(v24);
        [v21 count];
        v29 = [(HMDHome *)v25 workQueue];
        v46[0] = MEMORY[0x277D85DD0];
        v46[1] = 3221225472;
        v46[2] = __141__HMDHome__sendWriteRequestToAccessoryServer_requestMessage_source_failedAccessories_responseTuples_activity_waitGroup_unreachableWaitGroup___block_invoke;
        v46[3] = &unk_279722880;
        v46[4] = v25;
        v47 = v23;
        v48 = v20;
        v49 = v45;
        v56 = v35;
        v50 = v42;
        v57 = v36;
        v51 = v40;
        v30 = v39;
        v52 = v30;
        v53 = v41;
        v54 = v16;
        v55 = v17;
        v31 = v23;
        [v20 writeCharacteristicValues:v21 source:a5 message:v30 queue:v29 completionHandler:v46];
      }

      v43 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
    }

    while (v43);
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __141__HMDHome__sendWriteRequestToAccessoryServer_requestMessage_source_failedAccessories_responseTuples_activity_waitGroup_unreachableWaitGroup___block_invoke(uint64_t a1, void *a2)
{
  v41 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v9 = [*(a1 + 48) uniqueIdentifier];
    *buf = 138544130;
    v34 = v7;
    v35 = 2112;
    v36 = v8;
    v37 = 2112;
    v38 = v9;
    v39 = 2048;
    v40 = [v3 count];
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Completed write for accessory %@/%@ with %ld responses", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v29 = 0u;
  v10 = v3;
  v11 = [v10 countByEnumeratingWithState:&v28 objects:v32 count:16];
  if (!v11)
  {
LABEL_15:

    goto LABEL_20;
  }

  v12 = v11;
  v13 = *v29;
  v14 = *MEMORY[0x277CCFD28];
LABEL_5:
  v15 = 0;
  while (1)
  {
    if (*v29 != v13)
    {
      objc_enumerationMutation(v10);
    }

    v16 = [*(*(&v28 + 1) + 8 * v15) error];
    [v16 domain];

    [v16 code];
    if (!v16)
    {
      goto LABEL_13;
    }

    v17 = [v16 domain];
    if (([v17 isEqualToString:v14] & 1) == 0)
    {

      goto LABEL_13;
    }

    v18 = [v16 code];

    if (v18 == 4)
    {
      break;
    }

LABEL_13:

    if (v12 == ++v15)
    {
      v12 = [v10 countByEnumeratingWithState:&v28 objects:v32 count:16];
      if (v12)
      {
        goto LABEL_5;
      }

      goto LABEL_15;
    }
  }

  v19 = objc_autoreleasePoolPush();
  v20 = *(a1 + 32);
  v21 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
  {
    v23 = HMFGetLogIdentifier();
    v24 = *(a1 + 40);
    v25 = *(a1 + 112);
    v26 = HMFBooleanToString();
    *buf = 138543874;
    v34 = v23;
    v35 = 2112;
    v36 = v24;
    v37 = 2112;
    v38 = v26;
    _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Write for accessory with UUID: %@ failed with unreachable error, can forward to resident: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v19);
  if (*(a1 + 112))
  {
    [*(a1 + 64) addObject:*(a1 + 48)];
    goto LABEL_23;
  }

LABEL_20:
  if (*(a1 + 113) == 1)
  {
    [*(a1 + 32) _notifyChangedCharacteristics:v10 identifier:*(a1 + 72) multiPartResponse:1 moreMessagesInMultipart:1 requestMessage:*(a1 + 80) withCompletionHandler:0];
  }

  else
  {
    [*(a1 + 88) addObjectsFromArray:v10];
  }

LABEL_23:
  dispatch_group_leave(*(a1 + 96));
  dispatch_group_leave(*(a1 + 104));

  v27 = *MEMORY[0x277D85DE8];
}

- (BOOL)_passWriteRequestToCompanion:(id)a3 requestMessage:(id)a4 source:(unint64_t)a5 biomeSource:(unint64_t)a6 remoteAccessories:(id)a7 responseTuples:(id)a8 withCompletionHandler:(id)a9
{
  v43 = *MEMORY[0x277D85DE8];
  v29 = a3;
  v13 = a4;
  v14 = a7;
  v15 = a8;
  v27 = a9;
  v24 = [v13 BOOLForKey:@"kMultiPartResponseKey"];
  v28 = [v13 identifier];
  if (isWatch() && [(HMDHome *)self remoteAccessIsEnabled])
  {
    v40 = 0u;
    v41 = 0u;
    v38 = 0u;
    v39 = 0u;
    v16 = v29;
    v17 = [v16 countByEnumeratingWithState:&v38 objects:v42 count:16];
    if (v17)
    {
      v18 = *v39;
      do
      {
        for (i = 0; i != v17; ++i)
        {
          if (*v39 != v18)
          {
            objc_enumerationMutation(v16);
          }

          v20 = [v16 objectForKey:*(*(&v38 + 1) + 8 * i)];
          [HMDHome appendCharacteristicsToAccessoryList:v14 responseTuples:v15 forMultipleCharacteristicsRemoteWrite:v20 message:v13];
        }

        v17 = [v16 countByEnumeratingWithState:&v38 objects:v42 count:16];
      }

      while (v17);
    }

    objc_initWeak(&location, self);
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __129__HMDHome__passWriteRequestToCompanion_requestMessage_source_biomeSource_remoteAccessories_responseTuples_withCompletionHandler___block_invoke;
    v30[3] = &unk_279723378;
    objc_copyWeak(&v35, &location);
    v36 = v24;
    v31 = v15;
    v32 = v28;
    v33 = v13;
    v34 = v27;
    [(HMDHome *)self _writeCharacteristicValuesForAccessories:v14 writeRequestMap:v16 responseTuples:v31 requestMessage:v33 viaDevice:0 source:a5 biomeSource:a6 completionHandler:v30];

    objc_destroyWeak(&v35);
    objc_destroyWeak(&location);
    v21 = 1;
  }

  else
  {
    v21 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];
  return v21;
}

void __129__HMDHome__passWriteRequestToCompanion_requestMessage_source_biomeSource_remoteAccessories_responseTuples_withCompletionHandler___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v3 = WeakRetained;
  if (WeakRetained)
  {
    v4 = [WeakRetained workQueue];
    v11[0] = MEMORY[0x277D85DD0];
    v11[1] = 3221225472;
    v11[2] = __129__HMDHome__passWriteRequestToCompanion_requestMessage_source_biomeSource_remoteAccessories_responseTuples_withCompletionHandler___block_invoke_2;
    v11[3] = &unk_279725DE8;
    v11[4] = v3;
    v14 = *(a1 + 72);
    v5 = *(a1 + 32);
    v6 = *(a1 + 40);
    v7 = *(a1 + 48);
    v8 = *(a1 + 56);
    *&v9 = v7;
    *(&v9 + 1) = v8;
    *&v10 = v5;
    *(&v10 + 1) = v6;
    v12 = v10;
    v13 = v9;
    dispatch_async(v4, v11);
  }
}

uint64_t __129__HMDHome__passWriteRequestToCompanion_requestMessage_source_biomeSource_remoteAccessories_responseTuples_withCompletionHandler___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  if (*(a1 + 72))
  {
    v3 = 0;
  }

  else
  {
    v3 = *(a1 + 40);
  }

  v4 = *(a1 + 56);
  v5 = *(a1 + 64);
  return [v2 _notifyChangedCharacteristics:v3 identifier:*(a1 + 48) multiPartResponse:? moreMessagesInMultipart:? requestMessage:? withCompletionHandler:?];
}

- (BOOL)_loadBalanceWriteRequestOnResidentForAccessory:(id)a3 accessoryWriteRequestMapTable:(id)a4 requestMessage:(id)a5 source:(unint64_t)a6 biomeSource:(unint64_t)a7 responseTuples:(id)a8 withCompletionHandler:(id)a9
{
  v31 = a3;
  v14 = a4;
  v15 = a5;
  v16 = a8;
  v17 = a9;
  v18 = [v15 BOOLForKey:@"kMultiPartResponseKey"];
  v19 = [v15 identifier];
  [MEMORY[0x277D17DC0] currentTime];
  v21 = v20;
  v22 = [(HMDHome *)self primaryResident];
  v23 = [v22 isCurrentDevice];

  if (v23)
  {
    group = dispatch_group_create();
    [(HMDHome *)self _loadBalancedRedispatchForAccessories:v31 source:a6 biomeSource:a7 dispatchGroup:group writeRequestMap:v14 requestMessage:v15 responseTuples:v16];
    [(HMDHome *)self workQueue];
    v24 = v19;
    v25 = v14;
    v27 = v26 = v17;
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __159__HMDHome__loadBalanceWriteRequestOnResidentForAccessory_accessoryWriteRequestMapTable_requestMessage_source_biomeSource_responseTuples_withCompletionHandler___block_invoke;
    block[3] = &unk_279722858;
    block[4] = self;
    v40 = v18;
    v33 = v16;
    v34 = v15;
    v38 = v21;
    v35 = v25;
    v36 = v24;
    v39 = a6;
    v37 = v26;
    dispatch_group_notify(group, v27, block);

    v17 = v26;
    v14 = v25;
    v19 = v24;
  }

  return v23;
}

uint64_t __159__HMDHome__loadBalanceWriteRequestOnResidentForAccessory_accessoryWriteRequestMapTable_requestMessage_source_biomeSource_responseTuples_withCompletionHandler___block_invoke(uint64_t a1)
{
  v65 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = v5;
    v7 = "single";
    if (*(a1 + 96))
    {
      v7 = "multi";
    }

    *buf = 138543618;
    v62 = v5;
    v63 = 2080;
    v64 = v7;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Final notification for multi-write - loadBalanceGroup primary resident (%s part)", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  if ([*(a1 + 40) count])
  {
    v8 = [*(a1 + 48) dictionaryForKey:*MEMORY[0x277CCE7A8]];
    v9 = *(a1 + 32);
    v10 = *(a1 + 80);
    v12 = *(a1 + 56);
    v11 = *(a1 + 64);
    [*(a1 + 48) userForHome:v9];
    v14 = v13 = a1;
    v15 = [v14 uuid];
    v16 = *(v13 + 88);
    v17 = [*(v13 + 48) clientIdentifier];
    v49 = v8;
    v48 = [v9 _getLogEventsForOperation:1 startTime:v8 accessories:v12 requestMap:v11 identifier:v15 userUUID:v16 source:v10 bundleID:v17];

    v18 = [MEMORY[0x277CBEB38] dictionary];
    v55 = 0u;
    v56 = 0u;
    v57 = 0u;
    v58 = 0u;
    v50 = v13;
    v19 = *(v13 + 40);
    v20 = [v19 countByEnumeratingWithState:&v55 objects:v60 count:16];
    if (v20)
    {
      v21 = v20;
      v22 = *v56;
      do
      {
        for (i = 0; i != v21; ++i)
        {
          if (*v56 != v22)
          {
            objc_enumerationMutation(v19);
          }

          v24 = *(*(&v55 + 1) + 8 * i);
          v25 = [v24 request];
          v26 = [v25 characteristic];
          v27 = [v26 accessory];

          if (v27)
          {
            v28 = [v24 error];

            if (v28)
            {
              v29 = [v27 bridge];
              v30 = v29;
              if (v29)
              {
                v31 = v29;
              }

              else
              {
                v31 = v27;
              }

              v32 = v31;

              v33 = [v24 error];
              v34 = [v32 uuid];
              v35 = [v34 UUIDString];
              [v18 setObject:v33 forKeyedSubscript:v35];

              v27 = v32;
            }
          }
        }

        v21 = [v19 countByEnumeratingWithState:&v55 objects:v60 count:16];
      }

      while (v21);
    }

    v53 = 0u;
    v54 = 0u;
    v51 = 0u;
    v52 = 0u;
    v36 = v48;
    v37 = [v36 countByEnumeratingWithState:&v51 objects:v59 count:16];
    a1 = v50;
    if (v37)
    {
      v38 = v37;
      v39 = *v52;
      do
      {
        for (j = 0; j != v38; ++j)
        {
          if (*v52 != v39)
          {
            objc_enumerationMutation(v36);
          }

          v41 = *(*(&v51 + 1) + 8 * j);
          v42 = [*(a1 + 32) logEventSubmitter];
          v43 = [v36 objectForKeyedSubscript:v41];
          v44 = [v18 objectForKeyedSubscript:v41];
          if (v44)
          {
            v45 = [v18 objectForKeyedSubscript:v41];
            [v42 submitLogEvent:v43 error:v45];
          }

          else
          {
            [v42 submitLogEvent:v43 error:0];
          }

          a1 = v50;
        }

        v38 = [v36 countByEnumeratingWithState:&v51 objects:v59 count:16];
      }

      while (v38);
    }
  }

  result = [*(a1 + 32) _notifyChangedCharacteristics:*(a1 + 40) identifier:*(a1 + 64) multiPartResponse:*(a1 + 96) moreMessagesInMultipart:0 requestMessage:*(a1 + 48) withCompletionHandler:*(a1 + 72)];
  v47 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_buildCharacteristicWriteRequest:(id)a3 accessoryWriteRequestMapTable:(id)a4 accessoryList:(id)a5 responseTuples:(id)a6 user:(id)a7
{
  v63 = *MEMORY[0x277D85DE8];
  v11 = a3;
  v47 = a4;
  v48 = a5;
  v52 = a6;
  v50 = a7;
  v54 = 0u;
  v55 = 0u;
  v56 = 0u;
  v57 = 0u;
  obj = v11;
  v12 = [obj countByEnumeratingWithState:&v54 objects:v62 count:16];
  if (v12)
  {
    v14 = v12;
    v53 = *v55;
    *&v13 = 138543618;
    v46 = v13;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v55 != v53)
        {
          objc_enumerationMutation(obj);
        }

        v16 = *(*(&v54 + 1) + 8 * i);
        v17 = [v16 characteristic];
        v18 = [v17 service];
        v19 = [v18 accessory];

        if (!v19)
        {
          v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v34 = objc_autoreleasePoolPush();
          v35 = self;
          v36 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
          {
            v37 = HMFGetLogIdentifier();
            *buf = v46;
            v59 = v37;
            v60 = 2112;
            v61 = v16;
            _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_ERROR, "%{public}@Aborting characteristic write request: %@, accessory is nil", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v34);
          v31 = [HMDCharacteristicResponse responseWithRequest:v16 error:v19];
          v32 = v52;
          v33 = v31;
          goto LABEL_21;
        }

        v20 = [v16 characteristic];
        v21 = [v20 type];
        v22 = [v16 service];
        v23 = [v22 type];
        v24 = [HMDHAPMetadata isOwnerPrivilegeRequiredForWritingCharacteristicType:v21 serviceType:v23];

        if (v24 && ([v50 isOwner] & 1) == 0)
        {
          v38 = objc_autoreleasePoolPush();
          v39 = self;
          v40 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
          {
            v41 = HMFGetLogIdentifier();
            *buf = v46;
            v59 = v41;
            v60 = 2112;
            v61 = v16;
            v42 = v40;
            v43 = "%{public}@Aborting characteristic write request that requires owner privilege: %@";
LABEL_26:
            _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_ERROR, v43, buf, 0x16u);
          }
        }

        else
        {
          v25 = [v16 characteristic];
          v26 = [v25 type];
          v27 = [v16 service];
          v28 = [v27 type];
          v29 = [HMDHAPMetadata isAdminPrivilegeRequiredForWritingCharacteristicType:v26 serviceType:v28];

          if (!v29 || ([v50 isAdministrator] & 1) != 0)
          {
            if (([v19 isPrimary] & 1) == 0)
            {
              v30 = [v19 bridge];

              v19 = v30;
            }

            if (([v48 containsObject:v19] & 1) == 0)
            {
              [v48 addObject:v19];
            }

            v31 = [v47 objectForKey:v19];
            if (!v31)
            {
              v31 = [MEMORY[0x277CBEB18] array];
              [v47 setObject:v31 forKey:v19];
            }

            v32 = v31;
            v33 = v16;
LABEL_21:
            [v32 addObject:v33];
            goto LABEL_28;
          }

          v38 = objc_autoreleasePoolPush();
          v39 = self;
          v40 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
          {
            v41 = HMFGetLogIdentifier();
            *buf = v46;
            v59 = v41;
            v60 = 2112;
            v61 = v16;
            v42 = v40;
            v43 = "%{public}@Aborting characteristic write request that requires admin privilege: %@";
            goto LABEL_26;
          }
        }

        objc_autoreleasePoolPop(v38);
        v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:10];
        v44 = [HMDCharacteristicResponse responseWithRequest:v16 error:v31];
        [v52 addObject:v44];

LABEL_28:
      }

      v14 = [obj countByEnumeratingWithState:&v54 objects:v62 count:16];
    }

    while (v14);
  }

  v45 = *MEMORY[0x277D85DE8];
}

- (void)_redispatchWriteForAccessories:(id)a3 dispatchGroup:(id)a4 requestMap:(id)a5 requestMessage:(id)a6 source:(unint64_t)a7 biomeSource:(unint64_t)a8 responseTuples:(id)a9
{
  v110 = *MEMORY[0x277D85DE8];
  v15 = a3;
  v16 = a4;
  v17 = a5;
  v18 = a6;
  v19 = a9;
  v20 = [(HMDHome *)self primaryResident];
  v21 = [MEMORY[0x277D0F770] currentActivity];
  if (v20)
  {
    v78 = v21;
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __116__HMDHome__redispatchWriteForAccessories_dispatchGroup_requestMap_requestMessage_source_biomeSource_responseTuples___block_invoke;
    aBlock[3] = &unk_279722830;
    v75 = v17;
    v96 = v75;
    v74 = v19;
    v97 = v74;
    v100 = a7;
    v86 = v18;
    v98 = v86;
    v99 = self;
    v83 = self;
    v84 = _Block_copy(aBlock);
    v22 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v76 = a8;
    v77 = a7;
    v85 = v22;
    v69 = v17;
    v70 = v15;
    v79 = v20;
    v80 = v16;
    v67 = v19;
    v68 = v18;
    if ([v20 isCurrentDevice])
    {
      v93 = 0u;
      v94 = 0u;
      v91 = 0u;
      v92 = 0u;
      v23 = v15;
      obj = [v23 countByEnumeratingWithState:&v91 objects:v109 count:16];
      if (obj)
      {
        v24 = *v92;
        v25 = v83;
        v26 = (v84 + 2);
        v27 = v85;
        v71 = *v92;
        v72 = v23;
        do
        {
          for (i = 0; i != obj; i = i + 1)
          {
            if (*v92 != v24)
            {
              objc_enumerationMutation(v23);
            }

            v29 = *(*(&v91 + 1) + 8 * i);
            v30 = [(HMDHome *)v25 homeManager];
            v31 = [v30 residentMesh];
            v32 = [v31 bestResidentDeviceForAccessory:v29];

            if (v32)
            {
              v33 = [v27 objectForKey:v32];
              v34 = v33;
              if (v33)
              {
                v35 = v33;
              }

              else
              {
                v35 = [MEMORY[0x277CBEB18] array];
              }

              v46 = v35;

              [v46 addObject:v29];
              [v27 setObject:v46 forKey:v32];
            }

            else
            {
              v36 = objc_autoreleasePoolPush();
              v37 = v25;
              v38 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
              {
                v39 = HMFGetLogIdentifier();
                v40 = [v29 uuid];
                v41 = [v40 UUIDString];
                [v29 uniqueIdentifier];
                v73 = v36;
                v43 = v42 = v26;
                *buf = 138543874;
                v104 = v39;
                v105 = 2112;
                v106 = v41;
                v107 = 2112;
                v108 = v43;
                _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@Write bulk redispatching failing for %@/%@ (No Mesh Redirect)", buf, 0x20u);

                v26 = v42;
                v36 = v73;

                v27 = v85;
                v24 = v71;

                v23 = v72;
              }

              objc_autoreleasePoolPop(v36);
              v102 = v29;
              v44 = [MEMORY[0x277CBEA60] arrayWithObjects:&v102 count:1];
              v45 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
              v84[2](v84, v44, v45);

              v46 = [v29 uuid];
              v25 = v83;
            }
          }

          obj = [v23 countByEnumeratingWithState:&v91 objects:v109 count:16];
        }

        while (obj);
      }

      else
      {
        v25 = v83;
        v27 = v22;
      }
    }

    else
    {
      v23 = [v15 mutableCopy];
      [v22 setObject:v23 forKey:v20];
      v25 = v83;
      v27 = v22;
    }

    v48 = [v86 BOOLForKey:@"kMultiPartResponseKey"];
    v87 = 0u;
    v88 = 0u;
    v89 = 0u;
    v90 = 0u;
    obja = [v27 keyEnumerator];
    v49 = [obja countByEnumeratingWithState:&v87 objects:v101 count:16];
    if (v49)
    {
      v50 = v49;
      v51 = *v88;
      if (v48)
      {
        v52 = v86;
      }

      else
      {
        v52 = 0;
      }

      do
      {
        for (j = 0; j != v50; ++j)
        {
          if (*v88 != v51)
          {
            objc_enumerationMutation(obja);
          }

          v54 = *(*(&v87 + 1) + 8 * j);
          v55 = [v27 objectForKey:v54];
          v56 = [v86 remoteSourceDevice];
          v57 = [v54 device];
          v58 = [v56 isEqual:v57];

          if (v58)
          {
            v59 = objc_autoreleasePoolPush();
            v60 = v25;
            v61 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
            {
              v62 = HMFGetLogIdentifier();
              *buf = 138543874;
              v104 = v62;
              v105 = 2112;
              v106 = v55;
              v107 = 2112;
              v108 = v86;
              _os_log_impl(&dword_2531F8000, v61, OS_LOG_TYPE_ERROR, "%{public}@Skipping write bulk redispatching for %@ (Same source device). Message: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v59);
            v63 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
            v84[2](v84, v55, v63);

            v25 = v83;
          }

          else if (v54 == v79)
          {
            [(HMDHome *)v25 _reallyRedispatchWritesToDevice:0 accessories:v55 dispatchGroup:v80 requestMap:v75 requestMessage:v52 source:v77 biomeSource:v76 responseTuples:v74 activity:v78];
          }

          else
          {
            v64 = [v54 device];
            [(HMDHome *)v25 _reallyRedispatchWritesToDevice:v64 accessories:v55 dispatchGroup:v80 requestMap:v75 requestMessage:v52 source:v77 biomeSource:v76 responseTuples:v74 activity:v78];
          }

          v27 = v85;
        }

        v50 = [obja countByEnumeratingWithState:&v87 objects:v101 count:16];
      }

      while (v50);
    }

    v17 = v69;
    v15 = v70;
    v20 = v79;
    v16 = v80;
    v19 = v67;
    v18 = v68;
    v47 = v78;
  }

  else
  {
    v66 = a8;
    v47 = v21;
    [(HMDHome *)self _reallyRedispatchWritesToDevice:0 accessories:v15 dispatchGroup:v16 requestMap:v17 requestMessage:v18 source:a7 biomeSource:v66 responseTuples:v19 activity:v21];
  }

  v65 = *MEMORY[0x277D85DE8];
}

void __116__HMDHome__redispatchWriteForAccessories_dispatchGroup_requestMap_requestMessage_source_biomeSource_responseTuples___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v48 = *MEMORY[0x277D85DE8];
  v4 = a2;
  v5 = a3;
  v42 = 0u;
  v43 = 0u;
  v44 = 0u;
  v45 = 0u;
  obj = v4;
  v33 = [v4 countByEnumeratingWithState:&v42 objects:v47 count:16];
  if (v33)
  {
    v32 = *v43;
    do
    {
      v6 = 0;
      do
      {
        if (*v43 != v32)
        {
          objc_enumerationMutation(obj);
        }

        v35 = *(*(&v42 + 1) + 8 * v6);
        v36 = v6;
        v7 = [*(a1 + 32) objectForKey:?];
        v8 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v7, "count")}];
        v9 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v7, "count")}];
        v38 = 0u;
        v39 = 0u;
        v40 = 0u;
        v41 = 0u;
        v10 = v7;
        v11 = [v10 countByEnumeratingWithState:&v38 objects:v46 count:16];
        if (v11)
        {
          v12 = v11;
          v13 = *v39;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v39 != v13)
              {
                objc_enumerationMutation(v10);
              }

              v15 = *(*(&v38 + 1) + 8 * i);
              v16 = *(a1 + 40);
              v17 = [HMDCharacteristicResponse responseWithRequest:v15 error:v5];
              [v16 addObject:v17];

              v18 = [v15 characteristic];
              [v8 addObject:v18];

              v19 = [v15 value];
              if (v19)
              {
                [v9 addObject:v19];
              }

              else
              {
                v20 = [MEMORY[0x277CBEB68] null];
                [v9 addObject:v20];
              }
            }

            v12 = [v10 countByEnumeratingWithState:&v38 objects:v46 count:16];
          }

          while (v12);
        }

        v21 = [HMDCharacteristicReadWriteLogEvent alloc];
        v34 = *(a1 + 64);
        v22 = [*(a1 + 48) identifier];
        v23 = [*(a1 + 48) clientIdentifier];
        v24 = [*(a1 + 48) userForHome:*(a1 + 56)];
        v25 = [v24 uuid];
        LOBYTE(v30) = 0;
        LOBYTE(v29) = 1;
        v26 = [(HMDCharacteristicReadWriteLogEvent *)v21 initWithCharacteristics:v8 hmdAccessory:v35 hapAccessory:0 source:v34 isWriteOperation:1 isTimedWrite:0 isLocal:v29 transactionId:v22 isCached:v30 bundleId:v23 userUUID:v25 writtenValues:v9];

        v27 = [*(a1 + 56) logEventSubmitter];
        [v27 submitLogEvent:v26 error:v5];

        v6 = v36 + 1;
      }

      while (v36 + 1 != v33);
      v33 = [obj countByEnumeratingWithState:&v42 objects:v47 count:16];
    }

    while (v33);
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_reallyRedispatchWritesToDevice:(id)a3 accessories:(id)a4 dispatchGroup:(id)a5 requestMap:(id)a6 requestMessage:(id)a7 source:(unint64_t)a8 biomeSource:(unint64_t)a9 responseTuples:(id)a10 activity:(id)a11
{
  v65 = *MEMORY[0x277D85DE8];
  v40 = a3;
  v16 = a4;
  v17 = a5;
  v18 = a6;
  v19 = a7;
  v20 = a10;
  v37 = v17;
  v38 = a11;
  dispatch_group_enter(v17);
  v21 = [(HMDHome *)self primaryResident];
  v22 = [v21 device];

  v47 = [MEMORY[0x277CBEB38] dictionary];
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  v55 = 0u;
  obj = v16;
  v48 = [obj countByEnumeratingWithState:&v52 objects:v64 count:16];
  if (v48)
  {
    v23 = *v53;
    v44 = v20;
    v45 = v18;
    v42 = *v53;
    v43 = v22;
    v41 = self;
    do
    {
      for (i = 0; i != v48; ++i)
      {
        if (*v53 != v23)
        {
          objc_enumerationMutation(obj);
        }

        v25 = *(*(&v52 + 1) + 8 * i);
        context = objc_autoreleasePoolPush();
        v26 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          v29 = [v25 name];
          v30 = [v25 uuid];
          v31 = [v30 UUIDString];
          [v25 uniqueIdentifier];
          v33 = v32 = v19;
          *buf = 138544130;
          v57 = v28;
          v58 = 2112;
          v59 = v29;
          v60 = 2112;
          v61 = v31;
          v62 = 2112;
          v63 = v33;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Write bulk redispatching accessory %@/%@/%@ to resident", buf, 0x2Au);

          v19 = v32;
          self = v41;

          v23 = v42;
          v20 = v44;

          v22 = v43;
          v18 = v45;
        }

        objc_autoreleasePoolPop(context);
        [v22 isCurrentDevice];
        [v25 uuid];

        [v22 identifier];
        v34 = [v18 objectForKey:v25];
        [HMDHome appendCharacteristicsToAccessoryList:v47 responseTuples:v20 forMultipleCharacteristicsRemoteWrite:v34 message:v19];
      }

      v48 = [obj countByEnumeratingWithState:&v52 objects:v64 count:16];
    }

    while (v48);
  }

  v50[0] = MEMORY[0x277D85DD0];
  v50[1] = 3221225472;
  v50[2] = __138__HMDHome__reallyRedispatchWritesToDevice_accessories_dispatchGroup_requestMap_requestMessage_source_biomeSource_responseTuples_activity___block_invoke;
  v50[3] = &unk_279734E00;
  v51 = v37;
  v35 = v37;
  [(HMDHome *)self _writeCharacteristicValuesForAccessories:v47 writeRequestMap:v18 responseTuples:v20 requestMessage:v19 viaDevice:v40 source:a8 biomeSource:a9 completionHandler:v50];

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_loadBalancedRedispatchForAccessories:(id)a3 source:(unint64_t)a4 biomeSource:(unint64_t)a5 dispatchGroup:(id)a6 writeRequestMap:(id)a7 requestMessage:(id)a8 responseTuples:(id)a9
{
  v95 = *MEMORY[0x277D85DE8];
  v60 = a3;
  group = a6;
  v59 = a7;
  v62 = a8;
  v56 = a9;
  v87 = [MEMORY[0x277D0F770] currentActivity];
  v55 = [v62 BOOLForKey:@"kMultiPartResponseKey"];
  v63 = [v60 sortedArrayUsingComparator:&__block_literal_global_1556];
  v13 = [(HMDHome *)self homeManager];
  v14 = [v13 residentMesh];
  v68 = [v14 balancedResidentMapForAccessories:v63];

  v15 = objc_autoreleasePoolPush();
  v64 = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    v17 = HMFGetLogIdentifier();
    *buf = 138543874;
    v90 = v17;
    v91 = 2112;
    v92 = v63;
    v93 = 2112;
    v94 = v68;
    _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Balanced Resident Map for accessories: %@ -> %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  dispatch_group_enter(group);
  v66 = [(HMDHome *)v64 primaryResident];
  v65 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v63, "count")}];
  v18 = [(HMDHome *)v64 primaryResident];
  v19 = [v18 isCurrentDevice];

  if (v19)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = v64;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEBUG))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v90 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEBUG, "%{public}@Checking for local reachability on primary resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v85 = 0u;
    v86 = 0u;
    v83 = 0u;
    v84 = 0u;
    obj = v63;
    v24 = [obj countByEnumeratingWithState:&v83 objects:v88 count:16];
    if (v24)
    {
      v25 = *v84;
      do
      {
        v26 = 0;
        do
        {
          if (*v84 != v25)
          {
            objc_enumerationMutation(obj);
          }

          v27 = *(*(&v83 + 1) + 8 * v26);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v28 = v27;
          }

          else
          {
            v28 = 0;
          }

          v29 = v28;

          if (v29)
          {
            if ([v29 custom1WoBLE])
            {
              v30 = objc_autoreleasePoolPush();
              v31 = v21;
              v32 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
              {
                v33 = HMFGetLogIdentifier();
                *buf = 138543618;
                v90 = v33;
                v91 = 2112;
                v92 = v29;
                _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_INFO, "%{public}@Adding accessory %@ supporting custom1WoBLE to balanced resident map", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v30);
              [(HMDHome *)v31 _addAccessoryToBalancedResidentMap:v29 residentDevice:v66 balancedResidentMap:v68];
            }

            v34 = [(HMDHome *)v21 __residentDeviceForAccessory:v27 fromMap:v68];
            v35 = v34 == 0;

            if (v35)
            {
              if ([v29 hasBTLELink])
              {
                v82 = 0;
                v36 = [v29 identifier];
                [(HMDHome *)v21 retrieveStateForTrackedAccessory:v36 stateNumber:0 isReachable:&v82 linkQuality:0 lastSeen:0];

                if (v82 != 1)
                {
                  goto LABEL_31;
                }

                v37 = objc_autoreleasePoolPush();
                v38 = v21;
                v39 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
                {
                  v40 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v90 = v40;
                  v91 = 2112;
                  v92 = v29;
                  v93 = 2112;
                  v94 = v66;
                  _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Adding map for locally reachable accessory: %@ to resident: %@", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v37);
                [(HMDHome *)v38 _addAccessoryToBalancedResidentMap:v29 residentDevice:v66 balancedResidentMap:v68];
              }

              else
              {
                if (![v29 canWakeUpViaWoL])
                {
LABEL_31:
                  [v65 addObject:v29];
                  goto LABEL_20;
                }

                v41 = objc_autoreleasePoolPush();
                v42 = v21;
                v43 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
                {
                  v44 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v90 = v44;
                  v91 = 2112;
                  v92 = v29;
                  _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Adding accessory %@ supporting WakeUpViaWoL to balanced resident map", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v41);
                [(HMDHome *)v42 _addAccessoryToBalancedResidentMap:v29 residentDevice:v66 balancedResidentMap:v68];
              }
            }
          }

LABEL_20:

          ++v26;
        }

        while (v24 != v26);
        v45 = [obj countByEnumeratingWithState:&v83 objects:v88 count:16];
        v24 = v45;
      }

      while (v45);
    }
  }

  v46 = [(HMDHome *)v64 workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke_1557;
  block[3] = &unk_279722808;
  v70 = v87;
  v71 = v65;
  v72 = v59;
  v73 = v56;
  v74 = v68;
  v75 = v66;
  v76 = v62;
  v77 = v64;
  v78 = group;
  v79 = a4;
  v81 = v55;
  v80 = a5;
  v47 = group;
  v48 = v62;
  v49 = v66;
  v50 = v68;
  v51 = v56;
  v52 = v59;
  v53 = v65;
  dispatch_async(v46, block);

  __HMFActivityScopeLeave();
  v54 = *MEMORY[0x277D85DE8];
}

uint64_t __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke_1557(uint64_t a1)
{
  v98 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) begin];
  v86 = 0u;
  v87 = 0u;
  v84 = 0u;
  v85 = 0u;
  v2 = *(a1 + 40);
  v3 = [v2 countByEnumeratingWithState:&v84 objects:v97 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v85;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v85 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v84 + 1) + 8 * i);
        v8 = [*(a1 + 48) objectForKey:v7];
        [*(a1 + 48) removeObjectForKey:v7];
        v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
        v10 = [HMDCharacteristicResponse responsesWithRequests:v8 error:v9];

        [*(a1 + 56) addObjectsFromArray:v10];
      }

      v4 = [v2 countByEnumeratingWithState:&v84 objects:v97 count:16];
    }

    while (v4);
  }

  v82 = 0u;
  v83 = 0u;
  v80 = 0u;
  v81 = 0u;
  obj = [*(a1 + 64) keyEnumerator];
  v58 = [obj countByEnumeratingWithState:&v80 objects:v96 count:16];
  if (v58)
  {
    v57 = *v81;
    v11 = HMDIDSActivityMonitorHomeManagerDataSource;
    do
    {
      v12 = 0;
      do
      {
        if (*v81 != v57)
        {
          objc_enumerationMutation(obj);
        }

        v59 = v12;
        v13 = *(*(&v80 + 1) + 8 * v12);
        v14 = [MEMORY[0x277CBEB38] dictionary];
        v15 = [*(a1 + 64) objectForKey:*(a1 + 72)];
        v76 = 0u;
        v77 = 0u;
        v78 = 0u;
        v79 = 0u;
        v63 = v15;
        v16 = [v63 countByEnumeratingWithState:&v76 objects:v95 count:16];
        if (v16)
        {
          v17 = v16;
          v18 = *v77;
          do
          {
            for (j = 0; j != v17; ++j)
            {
              if (*v77 != v18)
              {
                objc_enumerationMutation(v63);
              }

              v20 = *(*(&v76 + 1) + 8 * j);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v21 = v20;
              }

              else
              {
                v21 = 0;
              }

              v22 = v21;

              v23 = [*(a1 + 48) objectForKey:v22];
              [&v11[48] appendCharacteristicsToAccessoryList:v14 responseTuples:*(a1 + 56) forMultipleCharacteristicsRemoteWrite:v23 message:*(a1 + 80)];
            }

            v17 = [v63 countByEnumeratingWithState:&v76 objects:v95 count:16];
          }

          while (v17);
        }

        v60 = v14;

        v24 = [v13 isCurrentDevice];
        v25 = objc_autoreleasePoolPush();
        v26 = *(a1 + 88);
        v27 = HMFGetOSLogHandle();
        v28 = os_log_type_enabled(v27, OS_LOG_TYPE_INFO);
        if (v24)
        {
          if (v28)
          {
            v29 = HMFGetLogIdentifier();
            *buf = 138543874;
            v90 = v29;
            v91 = 2112;
            v92 = v60;
            v93 = 2112;
            v94 = v13;
            _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Writing to accessories: %@ on current Device: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v25);
          [v60 count];
          v72 = 0u;
          v73 = 0u;
          v74 = 0u;
          v75 = 0u;
          v30 = v63;
          v31 = [v30 countByEnumeratingWithState:&v72 objects:v88 count:16];
          if (v31)
          {
            v32 = v31;
            v61 = v30;
            v33 = *v73;
            do
            {
              for (k = 0; k != v32; ++k)
              {
                if (*v73 != v33)
                {
                  objc_enumerationMutation(v61);
                }

                v35 = *(*(&v72 + 1) + 8 * k);
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v36 = v35;
                }

                else
                {
                  v36 = 0;
                }

                v37 = v36;

                v38 = [*(a1 + 48) objectForKey:v37];
                if (v38)
                {
                  dispatch_group_enter(*(a1 + 96));
                  v39 = *(a1 + 104);
                  v40 = *(a1 + 80);
                  v41 = [*(a1 + 88) workQueue];
                  v66[0] = MEMORY[0x277D85DD0];
                  v66[1] = 3221225472;
                  v66[2] = __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke_1562;
                  v66[3] = &unk_2797227E0;
                  v66[4] = *(a1 + 88);
                  v66[5] = v35;
                  v42 = v37;
                  v67 = v42;
                  v71 = *(a1 + 120);
                  v68 = *(a1 + 80);
                  v69 = *(a1 + 56);
                  v70 = *(a1 + 96);
                  [v42 writeCharacteristicValues:v38 source:v39 message:v40 queue:v41 completionHandler:v66];
                }
              }

              v32 = [v61 countByEnumeratingWithState:&v72 objects:v88 count:16];
            }

            while (v32);
            v11 = HMDIDSActivityMonitorHomeManagerDataSource;
            v30 = v61;
          }

LABEL_48:

          v45 = v60;
          goto LABEL_49;
        }

        if (v28)
        {
          v43 = HMFGetLogIdentifier();
          *buf = 138543874;
          v90 = v43;
          v91 = 2112;
          v92 = v60;
          v93 = 2112;
          v94 = v13;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Dispatching accessories: %@ to resident: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v25);
        v44 = *(a1 + 32);
        v45 = v60;
        [v60 count];
        v46 = [v13 identifier];

        if (*(a1 + 48))
        {
          dispatch_group_enter(*(a1 + 96));
          if (*(a1 + 120) == 1)
          {
            v62 = *(a1 + 80);
          }

          else
          {
            v62 = 0;
          }

          v47 = *(a1 + 88);
          v48 = *(a1 + 48);
          v49 = *(a1 + 56);
          v50 = [v47 primaryResident];
          v51 = [v50 device];
          if ([v13 isEqual:v51])
          {
            v13 = 0;
          }

          v53 = *(a1 + 104);
          v52 = *(a1 + 112);
          v64[0] = MEMORY[0x277D85DD0];
          v64[1] = 3221225472;
          v64[2] = __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke_1567;
          v64[3] = &unk_279734E00;
          v65 = *(a1 + 96);
          [v47 _writeCharacteristicValuesForAccessories:v60 writeRequestMap:v48 responseTuples:v49 requestMessage:v62 viaDevice:v13 source:v53 biomeSource:v52 completionHandler:v64];

          v30 = v65;
          v11 = HMDIDSActivityMonitorHomeManagerDataSource;
          goto LABEL_48;
        }

LABEL_49:

        v12 = v59 + 1;
      }

      while (v59 + 1 != v58);
      v58 = [obj countByEnumeratingWithState:&v80 objects:v96 count:16];
    }

    while (v58);
  }

  dispatch_group_leave(*(a1 + 96));
  result = [*(a1 + 32) end];
  v55 = *MEMORY[0x277D85DE8];
  return result;
}

void __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke_1562(uint64_t a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) name];
    v9 = [*(a1 + 40) uuid];
    v10 = [v9 UUIDString];
    v11 = [*(a1 + 48) uniqueIdentifier];
    v15 = 138544386;
    v16 = v7;
    v17 = 2112;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v21 = 2112;
    v22 = v11;
    v23 = 2048;
    v24 = [v3 count];
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Load Balance completed write for accessory %@/%@/%@ with %ld responses", &v15, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  if (*(a1 + 80) == 1)
  {
    v12 = *(a1 + 32);
    v13 = [*(a1 + 56) identifier];
    [v12 _notifyChangedCharacteristics:v3 identifier:v13 multiPartResponse:1 moreMessagesInMultipart:1 requestMessage:*(a1 + 56) withCompletionHandler:0];
  }

  else
  {
    [*(a1 + 64) addObjectsFromArray:v3];
  }

  dispatch_group_leave(*(a1 + 72));

  v14 = *MEMORY[0x277D85DE8];
}

uint64_t __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v4 = a3;
  v5 = [a2 uuid];
  v6 = [v5 UUIDString];
  v7 = [v4 uuid];

  v8 = [v7 UUIDString];
  v9 = [v6 compare:v8];

  return v9;
}

- (void)_addAccessoryToBalancedResidentMap:(id)a3 residentDevice:(id)a4 balancedResidentMap:(id)a5
{
  v15[1] = *MEMORY[0x277D85DE8];
  v7 = a3;
  v8 = a4;
  v9 = a5;
  v10 = [v9 objectForKey:v8];
  v11 = v10;
  if (v10)
  {
    if (([v10 containsObject:v7] & 1) == 0)
    {
      [v11 addObject:v7];
    }
  }

  else
  {
    v15[0] = v7;
    v12 = [MEMORY[0x277CBEA60] arrayWithObjects:v15 count:1];
    v13 = [v12 mutableCopy];
    [v9 setObject:v13 forKey:v8];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)__residentDeviceForAccessory:(id)a3 fromMap:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = a4;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v7 = [v6 keyEnumerator];
  v8 = [v7 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v8)
  {
    v9 = *v16;
    while (2)
    {
      for (i = 0; i != v8; i = i + 1)
      {
        if (*v16 != v9)
        {
          objc_enumerationMutation(v7);
        }

        v11 = *(*(&v15 + 1) + 8 * i);
        v12 = [v6 objectForKey:v11];
        if ([v12 containsObject:v5])
        {
          v8 = v11;

          goto LABEL_11;
        }
      }

      v8 = [v7 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v8)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)_writeCharacteristicValuesForAccessories:(id)a3 writeRequestMap:(id)a4 responseTuples:(id)a5 requestMessage:(id)a6 viaDevice:(id)a7 source:(unint64_t)a8 biomeSource:(unint64_t)a9 completionHandler:(id)a10
{
  v127 = *MEMORY[0x277D85DE8];
  v88 = a3;
  v86 = a4;
  v81 = a5;
  v17 = a6;
  v85 = a7;
  v80 = a10;
  v18 = objc_alloc(MEMORY[0x277D0F770]);
  v19 = MEMORY[0x277CCACA8];
  v20 = MEMORY[0x259C01AE0](self, a2);
  v21 = [v19 stringWithFormat:@"%@, %s:%ld", v20, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 25082];
  v83 = [v18 initWithName:v21];

  group = dispatch_group_create();
  dispatch_group_enter(group);
  v84 = [MEMORY[0x277CBEB18] array];
  if ([v88 count])
  {
    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_DEBUG))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543618;
      v124 = v25;
      v125 = 2048;
      v126 = a8;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_DEBUG, "%{public}@Write operation source: %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    [MEMORY[0x277D17DC0] currentTime];
    v27 = v26;
    v28 = [v17 identifier];
    v29 = [v17 userForHome:v23];
    v30 = [v29 uuid];
    v31 = [v17 clientIdentifier];
    v78 = [(HMDHome *)v23 _getLogEventsForOperation:1 startTime:v88 accessories:v86 requestMap:v28 identifier:v30 userUUID:a8 source:v27 biomeSource:a9 bundleID:v31];

    v77 = *MEMORY[0x277CD2678];
    LODWORD(v28) = [v17 BOOLForKey:?];
    v32 = [v17 uuidForKey:*MEMORY[0x277CD2050]];

    v33 = v32 != 0;
    v34 = [(HMDHome *)v23 uuid];
    v79 = [v34 UUIDString];

    v121[0] = *MEMORY[0x277CCE7A8];
    v35 = [v88 copy];
    v36 = *MEMORY[0x277CD0640];
    v122[0] = v35;
    v122[1] = v79;
    v121[1] = v36;
    v121[2] = @"kDoNotForwardMessageKey";
    v37 = [MEMORY[0x277CCABB0] numberWithInt:v85 != 0];
    v122[2] = v37;
    v38 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v122 forKeys:v121 count:3];
    v82 = [v38 mutableCopy];

    if ((v33 | v28))
    {
LABEL_26:
      v117 = v77;
      v118 = MEMORY[0x277CBEC38];
      v39 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v118 forKeys:&v117 count:1];
      [v82 addEntriesFromDictionary:v39];
    }

    else
    {
      v114 = 0u;
      v115 = 0u;
      v112 = 0u;
      v113 = 0u;
      v39 = v88;
      v76 = [v39 countByEnumeratingWithState:&v112 objects:v120 count:16];
      if (v76)
      {
        v40 = *v113;
        v75 = *v113;
        do
        {
          for (i = 0; i != v76; ++i)
          {
            if (*v113 != v40)
            {
              objc_enumerationMutation(v39);
            }

            v42 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:*(*(&v112 + 1) + 8 * i)];
            v43 = [(HMDHome *)v23 accessoryWithUUID:v42];

            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v44 = v43;
            }

            else
            {
              v44 = 0;
            }

            v45 = v44;

            v46 = [v86 objectForKey:v45];
            v110 = 0u;
            v111 = 0u;
            v108 = 0u;
            v109 = 0u;
            v47 = v46;
            v48 = [v47 countByEnumeratingWithState:&v108 objects:v119 count:16];
            if (v48)
            {
              v49 = *v109;
              while (2)
              {
                for (j = 0; j != v48; ++j)
                {
                  if (*v109 != v49)
                  {
                    objc_enumerationMutation(v47);
                  }

                  if ([*(*(&v108 + 1) + 8 * j) requestType] == 1)
                  {

                    goto LABEL_26;
                  }
                }

                v48 = [v47 countByEnumeratingWithState:&v108 objects:v119 count:16];
                if (v48)
                {
                  continue;
                }

                break;
              }
            }

            v40 = v75;
          }

          v76 = [v39 countByEnumeratingWithState:&v112 objects:v120 count:16];
          v40 = v75;
        }

        while (v76);
      }
    }

    v51 = MEMORY[0x277D0F848];
    v52 = [v17 qualityOfService];
    v53 = [(HMDHome *)v23 messageDestination];
    v54 = [v82 copy];
    v55 = [v51 messageWithName:@"kMultipleCharacteristicWriteRequestKey" qualityOfService:v52 destination:v53 payload:v54];

    objc_initWeak(&location, v23);
    v99[0] = MEMORY[0x277D85DD0];
    v99[1] = 3221225472;
    v99[2] = __145__HMDHome__writeCharacteristicValuesForAccessories_writeRequestMap_responseTuples_requestMessage_viaDevice_source_biomeSource_completionHandler___block_invoke;
    v99[3] = &unk_2797227B8;
    objc_copyWeak(&v106, &location);
    v100 = v83;
    v101 = v88;
    v56 = v86;
    v102 = v56;
    v103 = v84;
    v57 = v78;
    v104 = v57;
    v105 = group;
    [v55 setResponseHandler:v99];
    v58 = [(HMDHome *)v23 uuid];
    v59 = [(HMDHome *)v23 workQueue];
    [(HMDHome *)v23 redispatchToResidentMessage:v55 target:v58 responseQueue:v59 viaDevice:v85];

    if ([(HMDHome *)v23 remoteAccessIsEnabled])
    {
      v97 = 0u;
      v98 = 0u;
      v95 = 0u;
      v96 = 0u;
      v60 = v56;
      v61 = [v60 countByEnumeratingWithState:&v95 objects:v116 count:16];
      if (v61)
      {
        v62 = *v96;
        while (2)
        {
          for (k = 0; k != v61; ++k)
          {
            if (*v96 != v62)
            {
              objc_enumerationMutation(v60);
            }

            if ([*(*(&v95 + 1) + 8 * k) hasBTLELink])
            {
              v64 = objc_autoreleasePoolPush();
              v65 = v23;
              v66 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
              {
                v67 = HMFGetLogIdentifier();
                *buf = 138543362;
                v124 = v67;
                _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_INFO, "%{public}@There are BTLE accessories that are currently unreachable during the write, kicking scan to update reachability", buf, 0xCu);
              }

              objc_autoreleasePoolPop(v64);
              v68 = [(HMDHome *)v65 accessoryBrowser];
              [v68 btleAccessoryReachabilityProbeTimer:1];

              goto LABEL_40;
            }
          }

          v61 = [v60 countByEnumeratingWithState:&v95 objects:v116 count:16];
          if (v61)
          {
            continue;
          }

          break;
        }
      }

LABEL_40:
    }

    objc_destroyWeak(&v106);
    objc_destroyWeak(&location);
  }

  else
  {
    dispatch_group_leave(group);
  }

  v69 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __145__HMDHome__writeCharacteristicValuesForAccessories_writeRequestMap_responseTuples_requestMessage_viaDevice_source_biomeSource_completionHandler___block_invoke_1553;
  block[3] = &unk_279734668;
  v90 = v81;
  v91 = v84;
  v92 = v17;
  v93 = self;
  v94 = v80;
  v70 = v80;
  v71 = v17;
  v72 = v84;
  v73 = v81;
  dispatch_group_notify(group, v69, block);

  v74 = *MEMORY[0x277D85DE8];
}

void __145__HMDHome__writeCharacteristicValuesForAccessories_writeRequestMap_responseTuples_requestMessage_viaDevice_source_biomeSource_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v55 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v36 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  if (WeakRetained)
  {
    [*(a1 + 32) begin];
    if (v5)
    {
      v7 = [MEMORY[0x277CBEB58] set];
      v45 = 0u;
      v46 = 0u;
      v47 = 0u;
      v48 = 0u;
      obj = *(a1 + 40);
      v40 = [obj countByEnumeratingWithState:&v45 objects:v54 count:16];
      if (!v40)
      {
        goto LABEL_31;
      }

      v39 = *v46;
      *&v8 = 138543618;
      v34 = v8;
      v37 = v7;
      v35 = WeakRetained;
      while (1)
      {
        v9 = 0;
        do
        {
          if (*v46 != v39)
          {
            objc_enumerationMutation(obj);
          }

          v10 = *(*(&v45 + 1) + 8 * v9);
          v11 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v10];
          v12 = [WeakRetained accessoryWithUUID:v11];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v13 = v12;
          }

          else
          {
            v13 = 0;
          }

          v14 = v13;

          if ([v14 isPrimary])
          {
            v15 = v14;
LABEL_16:
            v16 = [*(a1 + 48) objectForKey:{v15, v34}];
            v17 = v16;
            if (v16)
            {
              v43 = 0u;
              v44 = 0u;
              v41 = 0u;
              v42 = 0u;
              v18 = [v16 countByEnumeratingWithState:&v41 objects:v49 count:16];
              if (v18)
              {
                v19 = v18;
                v20 = *v42;
                do
                {
                  v21 = 0;
                  do
                  {
                    if (*v42 != v20)
                    {
                      objc_enumerationMutation(v17);
                    }

                    v22 = [HMDCharacteristicResponse responseWithRequest:*(*(&v41 + 1) + 8 * v21) error:v5];
                    [*(a1 + 56) addObject:v22];

                    ++v21;
                  }

                  while (v19 != v21);
                  v19 = [v17 countByEnumeratingWithState:&v41 objects:v49 count:16];
                }

                while (v19);
              }

              v23 = *(a1 + 64);
              v24 = [v15 uuid];
              v25 = [v24 UUIDString];
              v26 = [v23 objectForKeyedSubscript:v25];

              v27 = [v36 objectForKeyedSubscript:@"kRemoteMessageTransportAttributionKey"];
              [v26 setTransportType:{objc_msgSend(v27, "intValue")}];

              WeakRetained = v35;
              v28 = [v35 logEventSubmitter];
              [v28 submitLogEvent:v26 error:v5];

              v7 = v37;
            }

            goto LABEL_29;
          }

          v15 = [v14 bridge];

          if (v15)
          {
            if ([v7 containsObject:v15])
            {
              goto LABEL_29;
            }

            [v7 addObject:v15];
            goto LABEL_16;
          }

          v29 = objc_autoreleasePoolPush();
          v30 = WeakRetained;
          v31 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT))
          {
            v32 = HMFGetLogIdentifier();
            *buf = v34;
            v51 = v32;
            v52 = 2112;
            v53 = v10;
            _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_DEFAULT, "%{public}@Dropping write responses for nil-ed out accessory with UUID %@", buf, 0x16u);

            v7 = v37;
          }

          objc_autoreleasePoolPop(v29);
          v15 = 0;
LABEL_29:

          ++v9;
        }

        while (v9 != v40);
        v40 = [obj countByEnumeratingWithState:&v45 objects:v54 count:16];
        if (!v40)
        {
LABEL_31:

          dispatch_group_leave(*(a1 + 72));
          goto LABEL_33;
        }
      }
    }

    [WeakRetained _addResponseTuplesFromDictionary:v36 accessoryRequestMapTable:*(a1 + 48) responseTuples:*(a1 + 56) completedGroup:*(a1 + 72) logEvents:*(a1 + 64)];
LABEL_33:
    [*(a1 + 32) end];
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __145__HMDHome__writeCharacteristicValuesForAccessories_writeRequestMap_responseTuples_requestMessage_viaDevice_source_biomeSource_completionHandler___block_invoke_1553(uint64_t a1)
{
  v17 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) addObjectsFromArray:*(a1 + 40)];
  v2 = *(a1 + 48);
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 56);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v7;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Completed all the writes and sending notification.", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v8 = [*(a1 + 48) BOOLForKey:@"kMultiPartResponseKey"];
    v9 = *(a1 + 56);
    v10 = *(a1 + 40);
    v11 = [*(a1 + 48) identifier];
    [v9 _notifyChangedCharacteristics:v10 identifier:v11 multiPartResponse:v8 moreMessagesInMultipart:v8 requestMessage:*(a1 + 48) withCompletionHandler:*(a1 + 64)];
  }

  else
  {
    if (v6)
    {
      v12 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v12;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Completed all the writes and delaying notification.", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v13 = *(a1 + 64);
    if (v13)
    {
      (*(v13 + 16))(v13, 0, 0);
    }
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)requiresUnlockToAccessCharacteristics:(id)a3 withMessage:(id)a4
{
  v6 = a3;
  if ([(HMDHome *)self applyDeviceLockStatus:a4])
  {
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __61__HMDHome_requiresUnlockToAccessCharacteristics_withMessage___block_invoke;
    v9[3] = &unk_279733D48;
    v9[4] = self;
    v7 = [v6 na_any:v9];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

uint64_t __61__HMDHome_requiresUnlockToAccessCharacteristics_withMessage___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = [v2 dataSource];
  v5 = [v4 hapMetadata];
  v6 = [v3 type];
  v7 = [v3 service];

  v8 = [v7 type];
  v9 = [v5 requiresDeviceUnlock:v6 forService:v8];

  return v9;
}

- (BOOL)isAccessAllowedForCharacteristicsWithMessage:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSecureAccess] && (objc_msgSend(v4, "isEntitledForSPIAccess") & 1) != 0)
  {
    v5 = 1;
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v4 shortDescription];
      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = v10;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Insufficient entitlements, access is not allowed for characteristic with message: %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v5 = 0;
  }

  v11 = *MEMORY[0x277D85DE8];
  return v5;
}

- (void)writeCharacteristicValues:(id)a3 source:(unint64_t)a4 message:(id)a5 identifier:(id)a6 qualityOfService:(int64_t)a7 withCompletionHandler:(id)a8
{
  v15 = a3;
  v16 = a5;
  v17 = a6;
  v18 = a8;
  v19 = objc_alloc(MEMORY[0x277D0F770]);
  v20 = MEMORY[0x277CCACA8];
  v21 = MEMORY[0x259C01AE0](self, a2);
  v22 = [v20 stringWithFormat:@"%@, %s:%ld", v21, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 24831];
  v23 = [v19 initWithName:v22];

  v24 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_279726A38;
  block[4] = self;
  v31 = v15;
  v32 = v23;
  v33 = v16;
  v34 = v17;
  v35 = v18;
  v36 = a4;
  v37 = a7;
  v25 = v17;
  v26 = v16;
  v27 = v23;
  v28 = v18;
  v29 = v15;
  dispatch_async(v24, block);
}

void __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke(id *a1)
{
  if ([a1[4] _shouldWaitForAccessoriesToBeReachable])
  {
    v2 = a1[5];
    v3 = [a1[4] workQueue];
    v4 = [HMDHomeAssistantOperation homeAssistantOperationWithWriteRequests:v2 queue:v3];

    objc_initWeak(&location, a1[4]);
    v5 = a1[4];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke_2;
    v20[3] = &unk_279722768;
    objc_copyWeak(v24, &location);
    v23 = a1[9];
    v6 = a1[6];
    v7 = a1[5];
    v24[1] = a1[10];
    v8 = a1[7];
    v9 = a1[8];
    *&v10 = v8;
    *(&v10 + 1) = v9;
    *&v11 = v6;
    *(&v11 + 1) = v7;
    v21 = v11;
    v22 = v10;
    v24[2] = a1[11];
    [v5 _performOperation:v4 completion:v20];

    objc_destroyWeak(v24);
    objc_destroyWeak(&location);
  }

  else
  {
    [a1[6] begin];
    v12 = a1[4];
    v13 = a1[5];
    v14 = a1[10];
    v15 = a1[11];
    v16 = a1[8];
    v17 = a1[9];
    v19 = a1[6];
    v18 = a1[7];

    [(HMDHome *)v12 _writeCharacteristicValues:v13 source:v14 message:v18 identifier:v16 qualityOfService:v15 withCompletionHandler:v17 activity:v19];
  }
}

void __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke_2(id *a1)
{
  v11 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 9);
  if (WeakRetained)
  {
    [a1[4] begin];
    [(HMDHome *)WeakRetained _writeCharacteristicValues:a1[10] source:a1[6] message:a1[7] identifier:a1[11] qualityOfService:a1[8] withCompletionHandler:a1[4] activity:?];
  }

  else
  {
    v3 = objc_autoreleasePoolPush();
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v5;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform write request", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v6 = _Block_copy(a1[8]);
    if (v6)
    {
      v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      v6[2](v6, v7, 0);
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_writeCharacteristicValues:(void *)a3 source:(void *)a4 message:(void *)a5 identifier:(void *)a6 qualityOfService:(void *)a7 withCompletionHandler:(void *)a8 activity:
{
  v60 = *MEMORY[0x277D85DE8];
  v42 = a2;
  v38 = a4;
  v39 = a5;
  v40 = a7;
  v41 = a8;
  val = a1;
  if (a1)
  {
    v44 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v42, "count")}];
    v55 = 0u;
    v56 = 0u;
    v53 = 0u;
    v54 = 0u;
    obj = v42;
    v13 = [obj countByEnumeratingWithState:&v53 objects:v59 count:16];
    if (v13)
    {
      v14 = *v54;
      do
      {
        for (i = 0; i != v13; ++i)
        {
          if (*v54 != v14)
          {
            objc_enumerationMutation(obj);
          }

          v16 = *(*(&v53 + 1) + 8 * i);
          v17 = [v16 characteristic];
          v18 = [v17 authorizationData];
          v19 = [val home];
          v20 = [v19 currentUser];
          v21 = [v20 notificationContextHAPIdentifier];
          v22 = [v17 contextDataForWriteRequestWithIdentifier:v21];

          v23 = [v16 value];
          v24 = +[HMDCharacteristicWriteRequest writeRequestWithCharacteristic:value:authorizationData:identifier:type:includeResponseValue:contextData:](HMDCharacteristicWriteRequest, "writeRequestWithCharacteristic:value:authorizationData:identifier:type:includeResponseValue:contextData:", v17, v23, v18, 0, [v16 requestType], objc_msgSend(v16, "includeResponseValue"), v22);

          [v44 addObject:v24];
        }

        v13 = [obj countByEnumeratingWithState:&v53 objects:v59 count:16];
      }

      while (v13);
    }

    v25 = [val dataSource];
    v26 = [v25 deviceLockStateDataSource];
    if ([v26 isPasscodeEnabled])
    {
      v27 = [val dataSource];
      v28 = [v27 deviceLockStateDataSource];
      v29 = [v28 isLocked];

      if (!v29)
      {
        v30 = objc_autoreleasePoolPush();
        v31 = val;
        v32 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
        {
          v33 = HMFGetLogIdentifier();
          *buf = 138543362;
          v58 = v33;
          _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_INFO, "%{public}@Allowing characteristic write because device lock check is not required", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v30);
        [(HMDHome *)v31 _performAllowedWriteCharacteristicValues:v44 source:a3 identifier:v39 qualityOfService:a6 withCompletionHandler:v40 activity:v41];
        goto LABEL_16;
      }
    }

    else
    {
    }

    objc_initWeak(buf, val);
    v46[0] = MEMORY[0x277D85DD0];
    v46[1] = 3221225472;
    v46[2] = __112__HMDHome__writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler_activity___block_invoke;
    v46[3] = &unk_279722790;
    objc_copyWeak(v51, buf);
    v34 = v40;
    v52 = 1;
    v50 = v34;
    v51[1] = a3;
    v47 = v41;
    v48 = v44;
    v49 = v39;
    v51[2] = a6;
    [(HMDHome *)val _applyDeviceLockCheck:v48 forSource:a3 message:v38 completion:v46];

    objc_destroyWeak(v51);
    objc_destroyWeak(buf);
LABEL_16:
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __112__HMDHome__writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler_activity___block_invoke(uint64_t a1, int a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      if (a2)
      {
        v11 = @"Allowing";
      }

      else
      {
        v11 = @"Denying";
      }

      v12 = *(a1 + 88);
      v13 = NSStringFromBOOL();
      v14 = *(a1 + 72);
      v22 = 138544386;
      v23 = v10;
      v24 = 2112;
      v25 = v11;
      v26 = 2112;
      v27 = v13;
      v28 = 2048;
      v29 = v14;
      v30 = 2112;
      v31 = v5;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ characteristic write passcode=%@, source=%lu : %@", &v22, 0x34u);
    }

    objc_autoreleasePoolPop(v7);
    if (a2)
    {
      [(HMDHome *)v8 _performAllowedWriteCharacteristicValues:*(a1 + 72) source:*(a1 + 48) identifier:*(a1 + 80) qualityOfService:*(a1 + 56) withCompletionHandler:*(a1 + 32) activity:?];
    }

    else
    {
      v20 = *(a1 + 56);
      if (v20)
      {
        (*(v20 + 16))(v20, v5, 0);
      }

      [*(a1 + 32) end];
    }
  }

  else
  {
    v15 = *(a1 + 56);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
      (*(v15 + 16))(v15, v16, 0);
    }

    v17 = objc_autoreleasePoolPush();
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform write request", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_performAllowedWriteCharacteristicValues:(uint64_t)a3 source:(void *)a4 identifier:(uint64_t)a5 qualityOfService:(void *)a6 withCompletionHandler:(void *)a7 activity:
{
  v38[2] = *MEMORY[0x277D85DE8];
  v30 = a2;
  v13 = a4;
  v14 = a6;
  v15 = a7;
  v37[0] = @"sourceType";
  v16 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:a3];
  v37[1] = @"kMultiPartResponseKey";
  v38[0] = v16;
  v38[1] = MEMORY[0x277CBEC38];
  v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:v37 count:2];

  v18 = objc_alloc(MEMORY[0x277D0F848]);
  v19 = [MEMORY[0x277D0F820] allMessageDestinations];
  v20 = [v18 initWithName:@"kMultipleCharacteristicWriteRequestKey" qualityOfService:a5 destination:v19 payload:v17];

  [v20 setIdentifier:v13];
  v21 = objc_autoreleasePoolPush();
  v22 = a1;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
  {
    v29 = v13;
    v24 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    v25 = [v20 identifier];

    if (v25)
    {
      v26 = [v20 identifier];
      [v26 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v31 = *buf;
    v27 = HMDRequestSourceAsString(a3);
    *buf = 138544130;
    *&buf[4] = v24;
    *&buf[12] = 1042;
    *&buf[14] = 16;
    v33 = 2098;
    v34 = &v31;
    v35 = 2114;
    v36 = v27;
    _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Performing allowed write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);

    v13 = v29;
  }

  objc_autoreleasePoolPop(v21);
  [v22 _writeCharacteristicValues:v30 requestMessage:v20 source:a3 biomeSource:0 withCompletionHandler:v14];
  [v15 end];

  v28 = *MEMORY[0x277D85DE8];
}

- (void)writeCharacteristicValues:(id)a3 message:(id)a4 withCompletionHandler:(id)a5
{
  v8 = a5;
  v9 = a4;
  v10 = a3;
  v11 = [v9 source];
  v12 = [v9 identifier];
  -[HMDHome writeCharacteristicValues:source:message:identifier:qualityOfService:withCompletionHandler:](self, "writeCharacteristicValues:source:message:identifier:qualityOfService:withCompletionHandler:", v10, v11, v9, v12, [v9 qualityOfService], v8);
}

void __131__HMDHome__notifyChangedCharacteristics_identifier_multiPartResponse_moreMessagesInMultipart_requestMessage_withCompletionHandler___block_invoke(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  if (v2)
  {
    v3 = v2;
    (*(v2 + 2))(v2, 0, *(a1 + 32));
    v2 = v3;
  }
}

void __131__HMDHome__notifyChangedCharacteristics_identifier_multiPartResponse_moreMessagesInMultipart_requestMessage_withCompletionHandler___block_invoke_1535(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  if (v2)
  {
    v3 = v2;
    (*(v2 + 2))(v2, 0, *(a1 + 32));
    v2 = v3;
  }
}

- (void)_sendClientCharacteristicsChangedNotificationWithIdentifier:(id)a3 requestMessage:(id)a4 multiPartResponse:(BOOL)a5 moreInMultiPartResponse:(BOOL)a6 characteristicChanges:(id)a7 completionHandler:(id)a8
{
  v53 = a6;
  v10 = a5;
  v83 = *MEMORY[0x277D85DE8];
  v54 = a3;
  v55 = a4;
  v13 = a7;
  v52 = a8;
  v56 = v13;
  v57 = [v13 characteristicUpdatesForAllClients];
  if (v10)
  {
    v14 = [MEMORY[0x277CCABB0] numberWithBool:v53];
    v51 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:v57 moreMessagesInMultipart:v14];
  }

  else
  {
    v51 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:v57 moreMessagesInMultipart:0];
  }

  if ([v56 hasEntitledClientOnlyChanges])
  {
    v15 = [v56 characteristicUpdatesForEntitledClients];
    if (v10)
    {
      v16 = [MEMORY[0x277CCABB0] numberWithBool:v53];
      v50 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:v15 moreMessagesInMultipart:v16];
    }

    else
    {
      v50 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:v15 moreMessagesInMultipart:0];
    }
  }

  else
  {
    v50 = 0;
  }

  v17 = [v55 proxyConnection];
  v58 = [MEMORY[0x277CBEB40] orderedSet];
  if (v17)
  {
    [v58 addObject:v17];
  }

  if ([v57 count] || objc_msgSend(v56, "hasEntitledClientOnlyChanges"))
  {
    v18 = [(HMDHome *)self dataSource];
    v19 = [v18 xpcMessageTransport];
    v20 = [v19 connections];
    [v58 addObjectsFromArray:v20];
  }

  if ([v55 qualityOfService] < 17)
  {
    v21 = 17;
  }

  else
  {
    v21 = [v55 qualityOfService];
  }

  v22 = objc_alloc(MEMORY[0x277D0F820]);
  v23 = [(HMDHome *)self uuid];
  v24 = [v22 initWithTarget:v23];

  v49 = v24;
  v25 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"kMultipleCharacteristicValuesUpdatedNotificationKey" qualityOfService:v21 destination:v24 payload:0];
  v26 = v25;
  if (v54)
  {
    [v25 setIdentifier:?];
  }

  v27 = objc_autoreleasePoolPush();
  v28 = self;
  v29 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
  {
    v30 = HMFGetLogIdentifier();
    v31 = [v58 count];
    *buf = 0;
    *&buf[8] = 0;
    v32 = [v26 identifier];

    if (v32)
    {
      v33 = [v26 identifier];
      [v33 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v70 = *buf;
    v34 = [v57 count] != 0;
    v35 = [v56 hasEntitledClientOnlyChanges];
    *buf = 138545154;
    *&buf[4] = v30;
    *&buf[12] = 2048;
    *&buf[14] = v31;
    *&buf[22] = 1040;
    v72 = 16;
    v73 = 2096;
    v74 = &v70;
    v75 = 1024;
    v76 = v34;
    v77 = 1024;
    v78 = v35;
    v79 = 1024;
    v80 = v10;
    v81 = 1024;
    v82 = v53;
    _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_INFO, "%{public}@Notifying %ld clients of characteristic changes with message identifier: %{uuid_t}.16P, allClients: %{BOOL}d, entitledClients: %{BOOL}d, multiPartResponse: %{BOOL}d, moreMessagesInMultipartResponse: %{BOOL}d", buf, 0x3Eu);
  }

  objc_autoreleasePoolPop(v27);
  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x2020000000;
  LOBYTE(v72) = v52 != 0;
  v36 = dispatch_group_create();
  v37 = [v58 array];
  v61[0] = MEMORY[0x277D85DD0];
  v61[1] = 3221225472;
  v61[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke;
  v61[3] = &unk_279722740;
  v38 = v50;
  v62 = v38;
  v39 = v26;
  v63 = v39;
  v40 = v51;
  v64 = v40;
  v41 = v17;
  v65 = v41;
  v68 = buf;
  v69 = 34305;
  v42 = v36;
  v66 = v42;
  v43 = v52;
  v67 = v43;
  [v37 na_each:v61];

  v44 = [(HMDHome *)v28 reportingSessionManager];
  v45 = [v39 messagePayload];
  v46 = [v39 identifier];
  [v44 addResponseMessagePayload:v45 toSessionWithUUID:v46];

  if (*(*&buf[8] + 24) == 1)
  {
    v47 = [(HMDHome *)v28 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_3;
    block[3] = &unk_2797348C0;
    v60 = v43;
    dispatch_group_notify(v42, v47, block);
  }

  _Block_object_dispose(buf, 8);
  v48 = *MEMORY[0x277D85DE8];
}

void __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = v3;
  v5 = (a1 + 32);
  if (*(a1 + 32) && ([v3 isEntitledForSPIAccess] & 1) != 0)
  {
    v6 = 1;
    v7 = 5;
  }

  else
  {
    v6 = 0;
    v5 = (a1 + 48);
    v7 = 1;
  }

  [*(a1 + 40) setMessagePayload:*v5];
  [*(a1 + 40) setRequiresSPIEntitlement:v6];
  if (*(a1 + 56) == v4)
  {
    *(*(*(a1 + 80) + 8) + 24) = 0;
  }

  else
  {
    [*(a1 + 40) setQualityOfService:17];
    v8 = [[HMDHomeManagerXPCMessageSendPolicy alloc] initWithEntitlements:v7 options:*(a1 + 88) active:1];
    [*(a1 + 40) setSendPolicy:v8];
  }

  dispatch_group_enter(*(a1 + 64));
  v9 = [*(a1 + 40) copy];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_2;
  v11[3] = &unk_279735BE8;
  v12 = v4;
  v13 = *(a1 + 56);
  v15 = *(a1 + 72);
  v14 = *(a1 + 64);
  v10 = v4;
  [v10 sendMessage:v9 completionHandler:v11];
}

void __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v4 = a2;
  if (*(a1 + 32) == *(a1 + 40))
  {
    v3 = *(a1 + 56);
    if (v3)
    {
      (*(v3 + 16))();
    }
  }

  dispatch_group_leave(*(a1 + 48));
}

- (void)notifyRemoteUsersOfChangedCharacteristics:(id)a3 message:(id)a4 broadcast:(BOOL)a5
{
  v8 = a3;
  v9 = a4;
  v10 = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __71__HMDHome_notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke;
  v13[3] = &unk_279731C38;
  v13[4] = self;
  v14 = v8;
  v15 = v9;
  v16 = a5;
  v11 = v9;
  v12 = v8;
  dispatch_async(v10, v13);
}

- (void)notifyOfChangedCharacteristic:(id)a3 changedByThisDevice:(BOOL)a4 residentShouldNotifyPeers:(BOOL)a5 message:(id)a6
{
  v10 = a3;
  v11 = a6;
  v12 = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __95__HMDHome_notifyOfChangedCharacteristic_changedByThisDevice_residentShouldNotifyPeers_message___block_invoke;
  v15[3] = &unk_27972EC78;
  v15[4] = self;
  v16 = v10;
  v18 = a4;
  v19 = a5;
  v17 = v11;
  v13 = v11;
  v14 = v10;
  dispatch_async(v12, v15);
}

void __95__HMDHome_notifyOfChangedCharacteristic_changedByThisDevice_residentShouldNotifyPeers_message___block_invoke(uint64_t a1)
{
  v6[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v6[0] = *(a1 + 40);
  v3 = [MEMORY[0x277CBEA60] arrayWithObjects:v6 count:1];
  LOBYTE(v5) = 0;
  [v2 _postInternalNotificationForChangedCharacteristics:v3 previouslyNilChangedCharacteristics:MEMORY[0x277CBEBF8] modifiedCharacteristics:0 changedByThisDevice:*(a1 + 56) residentShouldNotifyPeers:*(a1 + 57) message:*(a1 + 48) broadcast:v5];

  v4 = *MEMORY[0x277D85DE8];
}

- (void)_postInternalNotificationForChangedCharacteristics:(id)a3 previouslyNilChangedCharacteristics:(id)a4 modifiedCharacteristics:(id)a5 changedByThisDevice:(BOOL)a6 residentShouldNotifyPeers:(BOOL)a7 message:(id)a8 broadcast:(BOOL)a9
{
  v10 = a7;
  v81 = a6;
  v115 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v74 = a4;
  v80 = a5;
  v15 = a8;
  v16 = objc_autoreleasePoolPush();
  v17 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    [v15 shortDescription];
    v21 = v20 = v17;
    *buf = 138544642;
    v104 = v19;
    v105 = 1024;
    v106 = v81;
    v107 = 1024;
    v108 = v10;
    v109 = 1024;
    v110 = a9;
    v111 = 2112;
    v112 = v14;
    v113 = 2112;
    v114 = v21;
    _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Posting internal notification and notifying remote users with changedByThisDevice: %{BOOL}d residentShouldNotifyPeers: %{BOOL}d broadcast: %{BOOL}d about changed characteristics: %@ message: %@ ", buf, 0x32u);

    v17 = v20;
  }

  objc_autoreleasePoolPop(v16);
  if ([v14 count] || objc_msgSend(v74, "count"))
  {
    v22 = [v15 dictionaryForKey:@"kPresenceDictionaryForNotificationKey"];
    v23 = [v15 dictionaryForKey:@"kPresencePairingIdentifierDictionaryForNotificationKey"];
    v99[0] = MEMORY[0x277D85DD0];
    v99[1] = 3221225472;
    v99[2] = __186__HMDHome__postInternalNotificationForChangedCharacteristics_previouslyNilChangedCharacteristics_modifiedCharacteristics_changedByThisDevice_residentShouldNotifyPeers_message_broadcast___block_invoke;
    v99[3] = &unk_279733D48;
    v99[4] = v17;
    v24 = [v14 na_filter:v99];
    v78 = v23;
    v79 = v22;
    if (v23)
    {
      v25 = [[HMDHomePresenceRemote alloc] initWithPresenceByPairingIdentity:v23];
    }

    else
    {
      if (!v22)
      {
LABEL_10:
        v71 = v10;
        v72 = v15;
        v26 = [(HMDHome *)v17 localCapabilitiesDataSource];
        v27 = [v26 supportsBulletinBoard];

        if (v27)
        {
          v95[0] = MEMORY[0x277D85DD0];
          v95[1] = 3221225472;
          v95[2] = __186__HMDHome__postInternalNotificationForChangedCharacteristics_previouslyNilChangedCharacteristics_modifiedCharacteristics_changedByThisDevice_residentShouldNotifyPeers_message_broadcast___block_invoke_2;
          v95[3] = &unk_279722718;
          v95[4] = v17;
          v96 = v80;
          v97 = v81;
          v98 = 0;
          [(HMDHome *)v17 evaluateNotificationConditionForCharacteristics:v24 homePresence:v22 completion:v95];
        }

        v70 = v24;
        v77 = v17;

        v82 = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
        v91 = 0u;
        v92 = 0u;
        v93 = 0u;
        v94 = 0u;
        v73 = v14;
        obj = v14;
        v28 = [obj countByEnumeratingWithState:&v91 objects:v102 count:16];
        if (v28)
        {
          v29 = v28;
          v30 = *v92;
          do
          {
            for (i = 0; i != v29; ++i)
            {
              if (*v92 != v30)
              {
                objc_enumerationMutation(obj);
              }

              v32 = *(*(&v91 + 1) + 8 * i);
              v33 = [v32 accessory];
              if (v33)
              {
                v34 = [v82 objectForKey:v33];
                if (!v34)
                {
                  v34 = [MEMORY[0x277CBEB58] set];
                  [v82 setObject:v34 forKey:v33];
                }

                [v34 addObject:v32];
                v35 = [[HMDHAPAccessoryNotificationEvent alloc] initWithAccessory:v33 characteristic:v32];
                v36 = [(HMDHome *)v77 logEventSubmitter];
                [v36 submitLogEvent:v35 error:0];
              }
            }

            v29 = [obj countByEnumeratingWithState:&v91 objects:v102 count:16];
          }

          while (v29);
        }

        v37 = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
        v87 = 0u;
        v88 = 0u;
        v89 = 0u;
        v90 = 0u;
        v38 = v74;
        v39 = [v38 countByEnumeratingWithState:&v87 objects:v101 count:16];
        if (v39)
        {
          v40 = v39;
          v41 = *v88;
          do
          {
            for (j = 0; j != v40; ++j)
            {
              if (*v88 != v41)
              {
                objc_enumerationMutation(v38);
              }

              v43 = *(*(&v87 + 1) + 8 * j);
              v44 = [v43 accessory];
              if (v44)
              {
                v45 = [v37 objectForKey:v44];
                if (!v45)
                {
                  v45 = [MEMORY[0x277CBEB58] set];
                  [v37 setObject:v45 forKey:v44];
                }

                [v45 addObject:v43];
              }
            }

            v40 = [v38 countByEnumeratingWithState:&v87 objects:v101 count:16];
          }

          while (v40);
        }

        v46 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v37, "count") + objc_msgSend(v82, "count")}];
        v47 = [v82 hm_allKeys];
        [v46 addObjectsFromArray:v47];

        v48 = [v37 hm_allKeys];
        [v46 addObjectsFromArray:v48];

        v85 = 0u;
        v86 = 0u;
        v83 = 0u;
        v84 = 0u;
        v76 = v46;
        v49 = [v76 countByEnumeratingWithState:&v83 objects:v100 count:16];
        if (v49)
        {
          v50 = v49;
          v51 = MEMORY[0x277CBEBF8];
          v52 = *v84;
          do
          {
            for (k = 0; k != v50; ++k)
            {
              if (*v84 != v52)
              {
                objc_enumerationMutation(v76);
              }

              v54 = *(*(&v83 + 1) + 8 * k);
              v55 = [MEMORY[0x277CBEB38] dictionary];
              v56 = [v82 objectForKey:v54];
              v57 = [v56 allObjects];
              v58 = v57;
              if (v57)
              {
                v59 = v57;
              }

              else
              {
                v59 = v51;
              }

              [v55 setObject:v59 forKeyedSubscript:@"kModifiedCharacteristicsKey"];

              v60 = [v37 objectForKey:v54];
              v61 = [v60 allObjects];
              v62 = v61;
              if (v61)
              {
                v63 = v61;
              }

              else
              {
                v63 = v51;
              }

              [v55 setObject:v63 forKeyedSubscript:@"HMDModifiedPreviouslyNilValuedCharacteristicsKey"];

              [v55 setObject:v80 forKeyedSubscript:@"kModifiedCharacteristicsMapKey"];
              [v55 setObject:v79 forKeyedSubscript:@"kPresenceDictionaryForNotificationKey"];
              [v55 setObject:v78 forKeyedSubscript:@"kPresencePairingIdentifierDictionaryForNotificationKey"];
              v64 = [v55 copy];
              logAndPostNotification(@"HMDAccessoryCharacteristicsChangedNotification", v54, v64);
            }

            v50 = [v76 countByEnumeratingWithState:&v83 objects:v100 count:16];
          }

          while (v50);
        }

        v15 = v72;
        v14 = v73;
        if (v71 && [(HMDHome *)v77 shouldRelayNotificationToRegisteredDevicesForSource:v72])
        {
          v65 = objc_autoreleasePoolPush();
          v66 = v77;
          v67 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v67, OS_LOG_TYPE_INFO))
          {
            v68 = HMFGetLogIdentifier();
            *buf = 138543362;
            v104 = v68;
            _os_log_impl(&dword_2531F8000, v67, OS_LOG_TYPE_INFO, "%{public}@Posting notification to remote users since this is a resident device or is paired with a watch", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v65);
          [(HMDHome *)v66 notifyRemoteUsersOfChangedCharacteristics:obj message:v72 broadcast:a9];
        }

        goto LABEL_53;
      }

      v25 = [[HMDHomePresenceRemote alloc] initWithPresenceByUserId:v22];
    }

    v22 = v25;
    goto LABEL_10;
  }

LABEL_53:

  v69 = *MEMORY[0x277D85DE8];
}

- (id)_disablePayloadFromRemotelyUpdatedCharacteristicNotifications:(id)a3
{
  v59 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v33 = [MEMORY[0x277CBEB38] dictionary];
    v52 = 0u;
    v53 = 0u;
    v54 = 0u;
    v55 = 0u;
    obj = [v4 allKeys];
    v5 = [obj countByEnumeratingWithState:&v52 objects:v58 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v53;
      v8 = 0x277CBE000uLL;
      v9 = 0x277CCA000uLL;
      v35 = self;
      v36 = v4;
      v34 = *v53;
      do
      {
        v10 = 0;
        v37 = v6;
        do
        {
          if (*v53 != v7)
          {
            objc_enumerationMutation(obj);
          }

          v40 = v10;
          v11 = *(*(&v52 + 1) + 8 * v10);
          v12 = [*(v8 + 2840) array];
          v43 = [v4 hmf_dictionaryForKey:v11];
          v41 = [objc_alloc(*(v9 + 3448)) initWithUUIDString:v11];
          v13 = [(HMDHome *)self accessoryWithUUID:?];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v14 = v13;
          }

          else
          {
            v14 = 0;
          }

          v15 = v14;

          if (v15 && ([v15 hasBTLELink] & 1) == 0 && objc_msgSend(v15, "hasIPLink"))
          {
            v38 = v15;
            v50 = 0u;
            v51 = 0u;
            v48 = 0u;
            v49 = 0u;
            v42 = [v43 allKeys];
            v16 = [v42 countByEnumeratingWithState:&v48 objects:v57 count:16];
            if (v16)
            {
              v17 = v16;
              v18 = *v49;
              do
              {
                for (i = 0; i != v17; ++i)
                {
                  if (*v49 != v18)
                  {
                    objc_enumerationMutation(v42);
                  }

                  v20 = [v43 hmf_dictionaryForKey:*(*(&v48 + 1) + 8 * i)];
                  v44 = 0u;
                  v45 = 0u;
                  v46 = 0u;
                  v47 = 0u;
                  v21 = [v20 allKeys];
                  v22 = [v21 countByEnumeratingWithState:&v44 objects:v56 count:16];
                  if (v22)
                  {
                    v23 = v22;
                    v24 = *v45;
                    do
                    {
                      for (j = 0; j != v23; ++j)
                      {
                        if (*v45 != v24)
                        {
                          objc_enumerationMutation(v21);
                        }

                        v26 = *(*(&v44 + 1) + 8 * j);
                        v27 = HAPInstanceIDFromValue();
                        if (v27)
                        {
                          [v12 addObject:v27];
                        }
                      }

                      v23 = [v21 countByEnumeratingWithState:&v44 objects:v56 count:16];
                    }

                    while (v23);
                  }
                }

                v17 = [v42 countByEnumeratingWithState:&v48 objects:v57 count:16];
              }

              while (v17);
            }

            self = v35;
            v4 = v36;
            v7 = v34;
            v8 = 0x277CBE000;
            v9 = 0x277CCA000;
            v6 = v37;
            v15 = v38;
            if ([v12 count])
            {
              v28 = [v12 copy];
              v29 = [v41 UUIDString];
              [v33 setObject:v28 forKeyedSubscript:v29];

              v6 = v37;
              v15 = v38;
            }
          }

          v10 = v40 + 1;
        }

        while (v40 + 1 != v6);
        v6 = [obj countByEnumeratingWithState:&v52 objects:v58 count:16];
      }

      while (v6);
    }

    v30 = [v33 copy];
  }

  else
  {
    v30 = MEMORY[0x277CBEC10];
  }

  v31 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_handleCharacteristicsChangedNotification:(id)a3
{
  v124 = *MEMORY[0x277D85DE8];
  v89 = a3;
  v80 = [v89 dictionaryForKey:@"kCharacteristicNotificationsKey"];
  v81 = [v89 stringForKey:@"kRequestIdentifierKey"];
  v93 = [MEMORY[0x277CBEB18] array];
  if (v81)
  {
    v3 = self;
    if ([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
    {
      v4 = [(HMDHome *)self accessoryReaderWriter];
      [v4 handleRemotelyUpdatedCharacteristicsMessage:v89];

      v3 = self;
    }

    v77 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v81];
    v5 = [(HMDHome *)v3 pendingResponses];
    v87 = [v5 objectForKeyedSubscript:v81];

    v6 = [MEMORY[0x277CBEB18] array];
    if (v87)
    {
      v111 = 0u;
      v112 = 0u;
      v109 = 0u;
      v110 = 0u;
      obj = [v80 allKeys];
      v76 = [obj countByEnumeratingWithState:&v109 objects:v123 count:16];
      if (v76)
      {
        v74 = *v110;
        do
        {
          v7 = 0;
          do
          {
            if (*v110 != v74)
            {
              v8 = v7;
              objc_enumerationMutation(obj);
              v7 = v8;
            }

            v75 = v7;
            v9 = *(*(&v109 + 1) + 8 * v7);
            v10 = [v80 objectForKeyedSubscript:{v9, v74}];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v11 = v10;
            }

            else
            {
              v11 = 0;
            }

            v84 = v11;

            v79 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v9];
            v12 = [(HMDHome *)self accessoryWithUUID:v79];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v13 = v12;
            }

            else
            {
              v13 = 0;
            }

            v14 = v13;

            v107 = 0u;
            v108 = 0u;
            v105 = 0u;
            v106 = 0u;
            v82 = [v84 allKeys];
            v85 = [v82 countByEnumeratingWithState:&v105 objects:v122 count:16];
            if (v85)
            {
              v83 = *v106;
              do
              {
                v15 = 0;
                do
                {
                  if (*v106 != v83)
                  {
                    v16 = v15;
                    objc_enumerationMutation(v82);
                    v15 = v16;
                  }

                  v86 = v15;
                  v17 = [v84 objectForKeyedSubscript:*(*(&v105 + 1) + 8 * v15)];
                  objc_opt_class();
                  if (objc_opt_isKindOfClass())
                  {
                    v18 = v17;
                  }

                  else
                  {
                    v18 = 0;
                  }

                  v90 = v18;

                  v19 = HAPInstanceIDFromValue();
                  v20 = [v87 pendingResponseCount];
                  if (v20 >= [v90 count])
                  {
                    v22 = [v90 count];
                    v21 = [v87 pendingResponseCount] - v22;
                  }

                  else
                  {
                    v21 = 0;
                  }

                  [v87 setPendingResponseCount:v21];
                  v103 = 0u;
                  v104 = 0u;
                  v101 = 0u;
                  v102 = 0u;
                  v23 = [v90 allKeys];
                  v24 = [v23 countByEnumeratingWithState:&v101 objects:v121 count:16];
                  if (v24)
                  {
                    v25 = 0;
                    v26 = *v102;
                    do
                    {
                      v27 = 0;
                      v28 = v25;
                      do
                      {
                        if (*v102 != v26)
                        {
                          objc_enumerationMutation(v23);
                        }

                        v29 = *(*(&v101 + 1) + 8 * v27);
                        v30 = HAPInstanceIDFromValue();
                        v25 = [v14 findCharacteristic:v30 forService:v19];

                        if (v25)
                        {
                          [v6 addObject:v25];
                          if ([v25 isNotificationEnabledForClientIdentifierPrefix:@"com.apple.HomeKitDaemon.Local"])
                          {
                            [v93 addObject:v25];
                          }
                        }

                        ++v27;
                        v28 = v25;
                      }

                      while (v24 != v27);
                      v24 = [v23 countByEnumeratingWithState:&v101 objects:v121 count:16];
                    }

                    while (v24);
                  }

                  v15 = v86 + 1;
                }

                while (v86 + 1 != v85);
                v85 = [v82 countByEnumeratingWithState:&v105 objects:v122 count:16];
              }

              while (v85);
            }

            v7 = v75 + 1;
          }

          while (v75 + 1 != v76);
          v76 = [obj countByEnumeratingWithState:&v109 objects:v123 count:16];
        }

        while (v76);
      }

      v31 = objc_autoreleasePoolPush();
      v32 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_DEBUG))
      {
        v34 = HMFGetLogIdentifier();
        *buf = 138543874;
        v116 = v34;
        v117 = 2112;
        v118 = v81;
        v119 = 2112;
        v120 = v80;
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_DEBUG, "%{public}@Notifying changes for requestIdentifier %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v31);
      v35 = objc_autoreleasePoolPush();
      v36 = [(HMDHome *)v32 _splitCharacteristicChanges:v6 changedAccessories:v80];
      v37 = [v87 requestMessage];
      [(HMDHome *)v32 _sendClientCharacteristicsChangedNotificationWithIdentifier:v77 requestMessage:v37 multiPartResponse:1 moreInMultiPartResponse:1 characteristicChanges:v36 completionHandler:0];

      objc_autoreleasePoolPop(v35);
    }
  }

  else
  {
    v99 = 0u;
    v100 = 0u;
    v97 = 0u;
    v98 = 0u;
    v38 = v80;
    v39 = [v38 countByEnumeratingWithState:&v97 objects:v114 count:16];
    if (v39)
    {
      v40 = *v98;
      do
      {
        for (i = 0; i != v39; ++i)
        {
          if (*v98 != v40)
          {
            objc_enumerationMutation(v38);
          }

          v42 = *(*(&v97 + 1) + 8 * i);
          objc_initWeak(buf, self);
          v43 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v42];
          v44 = [(HMDHome *)self accessoryWithUUID:v43];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v45 = v44;
          }

          else
          {
            v45 = 0;
          }

          v46 = v45;

          v47 = [v38 hmf_dictionaryForKey:v42];
          v48 = [(HMDHome *)self workQueue];
          v94[0] = MEMORY[0x277D85DD0];
          v94[1] = 3221225472;
          v94[2] = __53__HMDHome__handleCharacteristicsChangedNotification___block_invoke;
          v94[3] = &unk_2797226F0;
          objc_copyWeak(&v96, buf);
          v95 = v89;
          [v46 handleMultipleCharacteristicsUpdated:v47 message:v95 completionQueue:v48 completionHandler:v94];

          objc_destroyWeak(&v96);
          objc_destroyWeak(buf);
        }

        v39 = [v38 countByEnumeratingWithState:&v97 objects:v114 count:16];
      }

      while (v39);
    }

    v49 = [(HMDHome *)self _unexpectedCharacteristicsFromCharacteristicNotifications:v38];
  }

  v50 = [MEMORY[0x277CBEB18] array];
  v91 = [v89 dictionaryForKey:@"kMediaNotificationsKey"];
  v88 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v91 requests:0 home:self];
  v51 = [[HMDMediaSessionRequestMessageInformation alloc] initWithMessage:v89];
  [(HMDHome *)self updateMediaStateWithResponses:v88 requestMessageInformation:v51];
  v52 = [v89 remoteSourceDevice];
  if ([(HMDHome *)self _shouldRegisterForNotificationsWithDevice:v52])
  {
    v53 = [(HMDHome *)self primaryResident];
    if ([v93 count])
    {
      if ([(HMDHome *)self isCurrentDeviceAvailableResident])
      {
        if (![(HMDHome *)self isCurrentDevicePrimaryResident])
        {
          v54 = [v53 device];
          v55 = [v52 isEqual:v54];

          if (v55)
          {
            v56 = objc_autoreleasePoolPush();
            v57 = self;
            v58 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
            {
              v59 = HMFGetLogIdentifier();
              v60 = [v93 count];
              *buf = 138543874;
              v116 = v59;
              v117 = 2048;
              v118 = v60;
              v119 = 2112;
              v120 = v93;
              _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_INFO, "%{public}@Disabling %tu notifications on primary resident: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v56);
            [(HMDHome *)v57 _remotelySetNotificationsEnabled:0 forCharacteristics:v93 characteristicChangeThresholds:0];
          }
        }
      }
    }

    v61 = [(HMDHome *)self _disablePayloadFromRemotelyUpdatedCharacteristicNotifications:v80];
    if ([v61 count] || objc_msgSend(v50, "count"))
    {
      v62 = objc_autoreleasePoolPush();
      v63 = self;
      v64 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v64, OS_LOG_TYPE_INFO))
      {
        v65 = HMFGetLogIdentifier();
        v66 = [v52 shortDescription];
        *buf = 138543618;
        v116 = v65;
        v117 = 2112;
        v118 = v66;
        _os_log_impl(&dword_2531F8000, v64, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations due to unexpected characteristic notification received on primary resident from remote device: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v62);
      [(HMDHome *)v63 _modifyCharacteristicNotifications:v61 mediaNotifications:MEMORY[0x277CBEC10] actionSetNotificationPayload:v50 enableNotification:0 withDevice:v52];
    }
  }

  else
  {
    v67 = objc_autoreleasePoolPush();
    v68 = self;
    v69 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
    {
      v70 = HMFGetLogIdentifier();
      *buf = 138543618;
      v116 = v70;
      v117 = 2112;
      v118 = v52;
      _os_log_impl(&dword_2531F8000, v69, OS_LOG_TYPE_INFO, "%{public}@Disabling notification registrations with resident: %@ due to unexpected characteristic notification received", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v67);
    v71 = [(HMDHome *)v68 logEventSubmitter];
    v72 = [[HMDUnexpectedNotificationLogEvent alloc] initWithCount:1];
    [v71 submitLogEvent:v72];

    v113 = v52;
    v53 = [MEMORY[0x277CBEA60] arrayWithObjects:&v113 count:1];
    [(HMDHome *)v68 _disableNotificationsForDevices:v53];
  }

  [v89 respondWithPayload:0];
  v73 = *MEMORY[0x277D85DE8];
}

void __53__HMDHome__handleCharacteristicsChangedNotification___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if ([v5 count])
  {
    v4 = [v5 hm_allKeys];
    [WeakRetained _notifyChangedCharacteristics:v4 message:*(a1 + 32) modifiedCharacteristics:v5 broadcast:0];
  }
}

- (void)_notifyChangedProperties:(id)a3 withRequestIdentifier:(id)a4 notificationUpdateIdentifier:(id)a5 toUserDeviceAddress:(id)a6
{
  v35 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  if (v13)
  {
    v14 = [(HMDHome *)self notificationHandlerMap];
    v15 = [v14 objectForKey:v13];

    if (!v15)
    {
      v16 = [(HMDHome *)self homeManager];
      v30 = 0u;
      v31 = 0u;
      v32 = 0u;
      v33 = 0u;
      v17 = [v16 watchManager];
      v18 = [v17 connectedWatches];

      v19 = [v18 countByEnumeratingWithState:&v30 objects:v34 count:16];
      if (v19)
      {
        v28 = v16;
        v29 = v10;
        v20 = *v31;
        while (2)
        {
          for (i = 0; i != v19; ++i)
          {
            if (*v31 != v20)
            {
              objc_enumerationMutation(v18);
            }

            v22 = [*(*(&v30 + 1) + 8 * i) remoteDestinationString];
            v23 = [v22 isEqual:v13];

            if (v23)
            {
              v19 = 1;
              goto LABEL_13;
            }
          }

          v19 = [v18 countByEnumeratingWithState:&v30 objects:v34 count:16];
          if (v19)
          {
            continue;
          }

          break;
        }

LABEL_13:
        v16 = v28;
        v10 = v29;
      }

      v24 = [HMDDeviceNotificationHandler alloc];
      v25 = [(HMDHome *)self msgDispatcher];
      v15 = [(HMDDeviceNotificationHandler *)v24 initWithDestination:v13 watchDevice:v19 withRequestIdentifier:v11 messageDispatcher:v25 home:self];

      v26 = [(HMDHome *)self notificationHandlerMap];
      [v26 setObject:v15 forKey:v13];
    }

    [(HMDDeviceNotificationHandler *)v15 sendNotificationForMediaProperties:v10 withRequestIdentifier:v11 notificationUpdateIdentifier:v12];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_notifyRemoteUsersOfChangedProperties:(id)a3 requestMessageInformation:(id)a4
{
  v69 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543362;
    v63 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Notifying users registered with resident of changes in properties", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v51 = v7;
  v12 = [v7 remoteSourceDevice];
  v13 = [(HMDHome *)v9 primaryResident];
  v50 = [v13 device];

  v14 = [(HMDHome *)v9 notificationRegistry];
  v15 = [v14 usersRegisteredForNotificationsForProperties:v6];

  v16 = [(HMDHome *)v9 residentDeviceManager];
  v48 = [v16 isCurrentDeviceAvailableResident];

  v17 = [MEMORY[0x277CBEB58] set];
  skippedInterDeviceChangeNotifications = v9->_skippedInterDeviceChangeNotifications;
  v18 = [MEMORY[0x277CCAD78] UUID];
  v55 = [v18 UUIDString];

  v60 = 0u;
  v61 = 0u;
  v58 = 0u;
  v59 = 0u;
  obj = v15;
  v19 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
  v54 = v12;
  if (v19)
  {
    v20 = v19;
    v21 = *v59;
    v22 = HMDIDSActivityMonitorHomeManagerDataSource;
    v52 = v6;
    v53 = v9;
    v56 = *v59;
    do
    {
      for (i = 0; i != v20; ++i)
      {
        if (*v59 != v21)
        {
          objc_enumerationMutation(obj);
        }

        v24 = *(*(&v58 + 1) + 8 * i);
        v25 = [&v22[93] deviceWithDestination:v24];
        if (v25)
        {
          [v17 addObject:v25];
          if ([(HMDHome *)v9 _shouldSendToDestination:v24 device:v25 remoteSourceDevice:v12])
          {
            v26 = v17;
            v27 = [(HMDHome *)v9 notificationRegistry];
            v28 = [v27 filterProperties:v6 forUser:v24];

            if ([v28 count])
            {
              v29 = objc_autoreleasePoolPush();
              v30 = v9;
              v31 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
              {
                v32 = HMFGetLogIdentifier();
                *buf = 138543874;
                v63 = v32;
                v64 = 2112;
                v65 = v24;
                v66 = 2112;
                v67 = v55;
                _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_INFO, "%{public}@Fanning out to device %@ with the properties that changed with notificationUpdateIdentifier: %@", buf, 0x20u);

                v6 = v52;
              }

              objc_autoreleasePoolPop(v29);
              [(HMDHome *)v30 _notifyChangedProperties:v28 withRequestIdentifier:0 notificationUpdateIdentifier:v55 toUserDeviceAddress:v24];
              v9 = v53;
              v12 = v54;
            }

            v17 = v26;
            v21 = v56;
            v22 = HMDIDSActivityMonitorHomeManagerDataSource;
          }
        }
      }

      v20 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
    }

    while (v20);
  }

  if (!v51 && [v6 count] && v50 && (objc_msgSend(v50, "isCurrentDevice") & 1) == 0 && (objc_msgSend(v17, "containsObject:", v50) & 1) == 0)
  {
    if (v48)
    {
      v40 = v17;
      v41 = objc_autoreleasePoolPush();
      v42 = v9;
      v43 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
      {
        v44 = HMFGetLogIdentifier();
        [v50 remoteDestinationString];
        v46 = v45 = v9;
        *buf = 138543874;
        v63 = v44;
        v64 = 2112;
        v65 = v46;
        v66 = 2112;
        v67 = v55;
        _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Fanning to primary resident destination %@ notificationUpdateIdentifier: %@", buf, 0x20u);

        v9 = v45;
        v12 = v54;
      }

      objc_autoreleasePoolPop(v41);
      v47 = [v50 remoteDestinationString];
      [(HMDHome *)v42 _notifyChangedProperties:v6 withRequestIdentifier:0 notificationUpdateIdentifier:v55 toUserDeviceAddress:v47];

      v17 = v40;
    }

    else
    {
      ++v9->_skippedInterDeviceChangeNotifications;
    }
  }

  if (isInternalBuild() && skippedInterDeviceChangeNotifications != v9->_skippedInterDeviceChangeNotifications)
  {
    v33 = v17;
    v34 = objc_autoreleasePoolPush();
    v35 = v9;
    v36 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
    {
      v37 = HMFGetLogIdentifier();
      v38 = v9->_skippedInterDeviceChangeNotifications;
      *buf = 138543618;
      v63 = v37;
      v64 = 2048;
      v65 = v38;
      _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_INFO, "%{public}@Skipped %lu spurious inter-device media property change notifications", buf, 0x16u);

      v12 = v54;
    }

    objc_autoreleasePoolPop(v34);
    v17 = v33;
  }

  v39 = *MEMORY[0x277D85DE8];
}

- (void)notifyRemoteUsersOfChangedProperties:(id)a3 requestMessageInformation:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __74__HMDHome_notifyRemoteUsersOfChangedProperties_requestMessageInformation___block_invoke;
  block[3] = &unk_279734960;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(v8, block);
}

- (void)_notifyUpdatedCharacteristic:(id)a3 withRequestIdentifier:(id)a4 notificationUpdateIdentifier:(id)a5 toUserDeviceAddress:(id)a6 completion:(id)a7
{
  v38 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  if (v15)
  {
    v17 = [(HMDHome *)self notificationHandlerMap];
    v18 = [v17 objectForKey:v15];

    if (!v18)
    {
      [(HMDHome *)self homeManager];
      v33 = 0u;
      v34 = 0u;
      v35 = 0u;
      v32 = v36 = 0u;
      v19 = [v32 watchManager];
      v20 = [v19 connectedWatches];

      v21 = [v20 countByEnumeratingWithState:&v33 objects:v37 count:16];
      if (v21)
      {
        v30 = v14;
        v31 = v12;
        v22 = *v34;
        while (2)
        {
          for (i = 0; i != v21; ++i)
          {
            if (*v34 != v22)
            {
              objc_enumerationMutation(v20);
            }

            v24 = [*(*(&v33 + 1) + 8 * i) remoteDestinationString];
            v25 = [v24 isEqual:v15];

            if (v25)
            {
              v21 = 1;
              goto LABEL_13;
            }
          }

          v21 = [v20 countByEnumeratingWithState:&v33 objects:v37 count:16];
          if (v21)
          {
            continue;
          }

          break;
        }

LABEL_13:
        v14 = v30;
        v12 = v31;
      }

      v26 = [HMDDeviceNotificationHandler alloc];
      v27 = [(HMDHome *)self msgDispatcher];
      v18 = [(HMDDeviceNotificationHandler *)v26 initWithDestination:v15 watchDevice:v21 withRequestIdentifier:v13 messageDispatcher:v27 home:self];

      v28 = [(HMDHome *)self notificationHandlerMap];
      [v28 setObject:v18 forKey:v15];
    }

    [(HMDDeviceNotificationHandler *)v18 sendNotificationForCharacteristicUpdates:v12 withRequestIdentifier:v13 notificationUpdateIdentifier:v14 completion:v16];
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_sendCoalescedRemoteNotificationsForRequestMessage:(id)a3 accessories:(id)a4
{
  v15 = a4;
  v6 = a3;
  v7 = [v6 destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  v10 = [v6 isRemote];
  if (v10)
  {
    v11 = [v9 device];
    v12 = [v11 remoteDestinationString];

    if (v12)
    {
      v13 = [(HMDHome *)self notificationHandlerMap];
      v14 = [v13 objectForKey:v12];

      [v14 sendCoalescedRemoteNotificationForAccessories:v15];
    }
  }
}

- (BOOL)_shouldSendToDestination:(id)a3 device:(id)a4 remoteSourceDevice:(id)a5
{
  v55 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [HMDDeviceHandle deviceHandleForDestination:v8];
  v12 = +[HMDAccountRegistry sharedRegistry];
  v13 = [v12 deviceForHandle:v11];

  v14 = [v13 account];

  if (!v14)
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      [v13 shortDescription];
      v28 = v27 = v10;
      *buf = 138543618;
      v52 = v26;
      v53 = 2112;
      v54 = v28;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Device %@ has no user attached to it", buf, 0x16u);

      v10 = v27;
    }

    goto LABEL_38;
  }

  if (![(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
  {
    v15 = [(HMDHome *)self _userForDevice:v13];
    if (!v15)
    {
      v50 = v10;
      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        [v13 shortDescription];
        v20 = v49 = v16;
        *buf = 138543618;
        v52 = v19;
        v53 = 2112;
        v54 = v20;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@No user found for the matching device: %@", buf, 0x16u);

        v16 = v49;
      }

      objc_autoreleasePoolPop(v16);
      v10 = v50;
    }

    if (([v15 isRemoteAccessAllowed] & 1) == 0)
    {
      v32 = objc_autoreleasePoolPush();
      v33 = self;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543618;
        v52 = v35;
        v53 = 2112;
        v54 = v9;
        _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_INFO, "%{public}@Skipping device %@ since the user lacks remote access", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v32);
      goto LABEL_39;
    }
  }

  if (v9 && [v10 isEqual:v9])
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v52 = v24;
      v53 = 2112;
      v54 = v8;
      v25 = "%{public}@Skipping device %@ since it is the original sender";
LABEL_18:
      v29 = v23;
      v30 = OS_LOG_TYPE_DEBUG;
LABEL_37:
      _os_log_impl(&dword_2531F8000, v29, v30, v25, buf, 0x16u);

      goto LABEL_38;
    }

    goto LABEL_38;
  }

  if ([v13 isCurrentDevice])
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v52 = v24;
      v53 = 2112;
      v54 = v8;
      v25 = "%{public}@Skipping device %@ - ourselves";
      goto LABEL_18;
    }

LABEL_38:

    objc_autoreleasePoolPop(v21);
LABEL_39:
    v46 = 0;
    goto LABEL_40;
  }

  v31 = [(HMDHome *)self localCapabilitiesDataSource];
  if ([v31 isCompanionCapable])
  {
  }

  else
  {
    v36 = [(HMDHome *)self residentDeviceManager];
    v37 = [v36 isCurrentDeviceAvailableResident];

    if ((v37 & 1) == 0)
    {
      ++self->_skippedInterDeviceChangeNotifications;
      v21 = objc_autoreleasePoolPush();
      v22 = self;
      v23 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        goto LABEL_38;
      }

      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v52 = v24;
      v53 = 2112;
      v54 = v8;
      v25 = "%{public}@Skipping device %@ since this device is not a companion or enabled resident";
      goto LABEL_36;
    }
  }

  v38 = [(HMDHome *)self localCapabilitiesDataSource];
  v39 = [v38 isCompanionCapable];

  if (v39)
  {
    v40 = [v13 productInfo];
    if (v40 && (v41 = v40, [v13 productInfo], v42 = objc_claimAutoreleasedReturnValue(), v43 = objc_msgSend(v42, "productClass"), v42, v41, v43 != 5))
    {
      ++self->_skippedInterDeviceChangeNotifications;
      v21 = objc_autoreleasePoolPush();
      v22 = self;
      v23 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        goto LABEL_38;
      }

      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v52 = v24;
      v53 = 2112;
      v54 = v8;
      v25 = "%{public}@Skipping device %@ since this device is a companion but sending to non-watch";
    }

    else
    {
      v44 = [(HMDHome *)self homeManager];
      v45 = [v44 isPairedWithWatch];

      if (v45)
      {
        goto LABEL_29;
      }

      ++self->_skippedInterDeviceChangeNotifications;
      v21 = objc_autoreleasePoolPush();
      v22 = self;
      v23 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        goto LABEL_38;
      }

      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v52 = v24;
      v53 = 2112;
      v54 = v8;
      v25 = "%{public}@Skipping device %@ since this device is a companion but not paired with a watch";
    }

LABEL_36:
    v29 = v23;
    v30 = OS_LOG_TYPE_INFO;
    goto LABEL_37;
  }

LABEL_29:
  v46 = 1;
LABEL_40:

  v47 = *MEMORY[0x277D85DE8];
  return v46;
}

- (id)_userForDevice:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self users];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __26__HMDHome__userForDevice___block_invoke;
  v9[3] = &unk_2797226C8;
  v10 = v4;
  v6 = v4;
  v7 = [v5 hmf_objectPassingTest:v9];

  return v7;
}

uint64_t __26__HMDHome__userForDevice___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 account];
  v4 = [*(a1 + 32) account];
  v5 = [v3 isEqual:v4];

  return v5;
}

- (BOOL)_shouldRateLimitChangeNotificationsForCharacteristic:(id)a3
{
  v3 = a3;
  v4 = [v3 service];
  v5 = [v3 type];
  if (([v5 isEqualToString:*MEMORY[0x277CFE628]] & 1) == 0)
  {

    goto LABEL_5;
  }

  v6 = [v4 type];
  if (![v6 isEqualToString:*MEMORY[0x277CFE900]])
  {
    v8 = [v4 type];
    v9 = [v8 isEqualToString:*MEMORY[0x277CFE860]];

    if (v9)
    {
      goto LABEL_7;
    }

LABEL_5:
    v7 = 0;
    goto LABEL_14;
  }

LABEL_7:
  v10 = [v3 previousValue];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v10;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;

  [v12 doubleValue];
  v27 = v13;

  v14 = [v3 value];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = v14;
  }

  else
  {
    v15 = 0;
  }

  v16 = v15;

  [v16 doubleValue];
  v26 = v17;

  v18.f64[0] = v27;
  v18.f64[1] = v26;
  __asm { FMOV            V1.2D, #0.5 }

  v24 = vmulq_f64(vrndaq_f64(vaddq_f64(v18, v18)), _Q1);
  v7 = fabs(vsubq_f64(v24, vdupq_laneq_s64(v24, 1)).f64[0]) < 2.22044605e-16;
LABEL_14:

  return v7;
}

- (void)_notifyRemoteUsersOfChangedCharacteristics:(id)a3 message:(id)a4 broadcast:(BOOL)a5
{
  v100 = a5;
  v128 = *MEMORY[0x277D85DE8];
  v7 = a3;
  v95 = a4;
  v101 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v7, "count")}];
  v96 = [MEMORY[0x277CBEB58] set];
  v115 = 0u;
  v116 = 0u;
  v117 = 0u;
  v118 = 0u;
  v8 = v7;
  v9 = [v8 countByEnumeratingWithState:&v115 objects:v127 count:16];
  obj = v8;
  v106 = self;
  if (v9)
  {
    v10 = v9;
    v11 = *v116;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v116 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v115 + 1) + 8 * i);
        v14 = [v13 accessory];
        v15 = [v13 stateNumber];
        [v14 updateTrackedAccessoryStateNumber:v15];

        v16 = [(HMDHome *)self dataSource];
        v17 = [v16 hapMetadata];
        v18 = [v13 type];
        v19 = [v13 service];
        v20 = [v19 type];
        v21 = [v17 shouldFilterChangeNotificationsForCharacteristicType:v18 serviceType:v20];

        self = v106;
        if ((v21 & 1) == 0)
        {
          if ([(HMDHome *)v106 _shouldRateLimitChangeNotificationsForCharacteristic:v13])
          {
            v22 = objc_autoreleasePoolPush();
            v23 = v106;
            v24 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
            {
              v25 = HMFGetLogIdentifier();
              *buf = 138543618;
              v120 = v25;
              v121 = 2112;
              v122 = v13;
              _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Filtering out characteristic for remote notification due to rate limiting: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v22);
          }

          else
          {
            v26 = [v13 accessory];
            if ([v26 hasBTLELink])
            {
              v27 = [v26 identifier];
              v28 = [v26 matchingTransportInformationWithServerIdentifier:v27 instanceID:0 linkType:1];

              if (([v28 isReachable] & 1) == 0)
              {
                [v96 addObject:v13];
              }
            }

            [v101 addObject:v13];
          }
        }
      }

      v8 = obj;
      v10 = [obj countByEnumeratingWithState:&v115 objects:v127 count:16];
    }

    while (v10);
  }

  v29 = v101;
  if ([v101 count])
  {
    v30 = v95;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v31 = v30;
    }

    else
    {
      v31 = 0;
    }

    v32 = v31;

    v93 = v32;
    v33 = [v32 destination];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v34 = v33;
    }

    else
    {
      v34 = 0;
    }

    v35 = v34;

    v92 = v35;
    v36 = [v35 device];
    v37 = [(HMDHome *)self primaryResident];
    v94 = [v37 device];

    v104 = [MEMORY[0x277CBEB58] set];
    v38 = [(HMDHome *)self notificationRegistry];
    v39 = [v38 usersRegisteredForNotificationsForCharacteristics:v101];
    v102 = [v39 mutableCopy];

    v40 = [(HMDHome *)self residentDeviceManager];
    LODWORD(v39) = [v40 isCurrentDeviceAvailableResident];

    v97 = v36;
    v90 = v39;
    if (v39)
    {
      v113 = 0u;
      v114 = 0u;
      v111 = 0u;
      v112 = 0u;
      v41 = [(HMDHome *)self residentEnabledDevices];
      v42 = [v41 countByEnumeratingWithState:&v111 objects:v126 count:16];
      if (!v42)
      {
        goto LABEL_37;
      }

      v43 = v42;
      v44 = *v112;
      while (1)
      {
        for (j = 0; j != v43; ++j)
        {
          if (*v112 != v44)
          {
            objc_enumerationMutation(v41);
          }

          v46 = *(*(&v111 + 1) + 8 * j);
          v47 = [(HMDHome *)self primaryResident];
          if (([v47 isCurrentDevice] & 1) == 0)
          {
            v48 = [(HMDHome *)self primaryResident];
            v49 = [v48 device];
            v50 = [v49 remoteDestinationString];
            v51 = [v102 containsObject:v50];

            if (v51)
            {
              goto LABEL_35;
            }

            v47 = [v46 remoteDestinationString];
            [v102 addObject:v47];
          }

LABEL_35:
          self = v106;
        }

        v43 = [v41 countByEnumeratingWithState:&v111 objects:v126 count:16];
        if (!v43)
        {
LABEL_37:

          v36 = v97;
          break;
        }
      }
    }

    v52 = [MEMORY[0x277CCAD78] UUID];
    v98 = [v52 UUIDString];

    skippedInterDeviceChangeNotifications = self->_skippedInterDeviceChangeNotifications;
    v107 = 0u;
    v108 = 0u;
    v109 = 0u;
    v110 = 0u;
    v103 = v102;
    v53 = [v103 countByEnumeratingWithState:&v107 objects:v125 count:16];
    v29 = v101;
    if (v53)
    {
      v54 = v53;
      v55 = *v108;
      v56 = HMDIDSActivityMonitorHomeManagerDataSource;
      v99 = *v108;
      do
      {
        for (k = 0; k != v54; ++k)
        {
          if (*v108 != v55)
          {
            objc_enumerationMutation(v103);
          }

          v58 = *(*(&v107 + 1) + 8 * k);
          v59 = [&v56[93] deviceWithDestination:v58];
          if (v59)
          {
            [v104 addObject:v59];
            if ([(HMDHome *)self _shouldSendToDestination:v58 device:v59 remoteSourceDevice:v36])
            {
              v60 = [(HMDHome *)self notificationRegistry];
              v61 = [v60 filterCharacteristics:v29 forUser:v58];

              v62 = [HMDCharacteristicUpdateTuple characteristicUpdateTuplesWithCharacteristics:v61 isBroadcast:v100];
              if ([v62 count])
              {
                v63 = objc_autoreleasePoolPush();
                v64 = self;
                v65 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v65, OS_LOG_TYPE_INFO))
                {
                  v66 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v120 = v66;
                  v121 = 2112;
                  v122 = v58;
                  v123 = 2112;
                  v124 = v98;
                  _os_log_impl(&dword_2531F8000, v65, OS_LOG_TYPE_INFO, "%{public}@Fanning out to device %@ with the characteristics that changed for notificationUpdateIdentifier: %@", buf, 0x20u);

                  v29 = v101;
                }

                objc_autoreleasePoolPop(v63);
                [(HMDHome *)v64 _notifyUpdatedCharacteristic:v62 withRequestIdentifier:0 notificationUpdateIdentifier:v98 toUserDeviceAddress:v58 completion:&__block_literal_global_1515];
                self = v106;
                v36 = v97;
              }

              v55 = v99;
              v56 = HMDIDSActivityMonitorHomeManagerDataSource;
            }
          }
        }

        v54 = [v103 countByEnumeratingWithState:&v107 objects:v125 count:16];
      }

      while (v54);
    }

    v8 = obj;
    v67 = v94;
    if (![v29 count] || !v94 || (objc_msgSend(v94, "isCurrentDevice") & 1) != 0 || (objc_msgSend(v104, "containsObject:", v94) & 1) != 0 || (objc_msgSend(v36, "isEqual:", v94) & 1) != 0)
    {
      goto LABEL_70;
    }

    if (v90)
    {
      v68 = objc_autoreleasePoolPush();
      v69 = self;
      v70 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v70, OS_LOG_TYPE_INFO))
      {
        v71 = HMFGetLogIdentifier();
        v72 = [v94 remoteDestinationString];
        *buf = 138543874;
        v120 = v71;
        v121 = 2112;
        v122 = v72;
        v123 = 2112;
        v124 = v98;
        _os_log_impl(&dword_2531F8000, v70, OS_LOG_TYPE_INFO, "%{public}@Fanning to primary resident destination %@ with notificationUpdateIdentifier: %@", buf, 0x20u);

        v67 = v94;
      }

      objc_autoreleasePoolPop(v68);
      v73 = [v67 remoteDestinationString];
      [(HMDHome *)v69 _notifyChangedCharacteristics:v29 withRequestIdentifier:0 notificationUpdateIdentifier:v98 toUserDeviceAddress:v73 broadcast:v100];
    }

    else
    {
      if (![v96 count])
      {
        ++self->_skippedInterDeviceChangeNotifications;
LABEL_70:
        if (isInternalBuild() && skippedInterDeviceChangeNotifications != self->_skippedInterDeviceChangeNotifications)
        {
          v84 = objc_autoreleasePoolPush();
          v85 = self;
          v86 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v86, OS_LOG_TYPE_INFO))
          {
            v87 = HMFGetLogIdentifier();
            v88 = self->_skippedInterDeviceChangeNotifications;
            *buf = 138543618;
            v120 = v87;
            v121 = 2048;
            v122 = v88;
            _os_log_impl(&dword_2531F8000, v86, OS_LOG_TYPE_INFO, "%{public}@Skipped %lu spurious inter-device characteristic change notifications", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v84);
          v36 = v97;
        }

        goto LABEL_76;
      }

      v78 = objc_autoreleasePoolPush();
      v79 = self;
      v80 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v80, OS_LOG_TYPE_INFO))
      {
        v81 = HMFGetLogIdentifier();
        v82 = [v94 remoteDestinationString];
        *buf = 138543874;
        v120 = v81;
        v121 = 2112;
        v122 = v82;
        v123 = 2112;
        v124 = v98;
        _os_log_impl(&dword_2531F8000, v80, OS_LOG_TYPE_INFO, "%{public}@Fanning the characteristics changed over BTLE to primary resident destination %@ with notificationUpdateIdentifier: %@", buf, 0x20u);

        v67 = v94;
      }

      objc_autoreleasePoolPop(v78);
      v73 = [v96 allObjects];
      v83 = [v67 remoteDestinationString];
      [(HMDHome *)v79 _notifyChangedCharacteristics:v73 withRequestIdentifier:0 notificationUpdateIdentifier:v98 toUserDeviceAddress:v83 broadcast:v100];
    }

    v36 = v97;
    goto LABEL_70;
  }

  if ([v8 count])
  {
    v74 = objc_autoreleasePoolPush();
    v75 = self;
    v76 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v76, OS_LOG_TYPE_DEBUG))
    {
      v77 = HMFGetLogIdentifier();
      *buf = 138543362;
      v120 = v77;
      _os_log_impl(&dword_2531F8000, v76, OS_LOG_TYPE_DEBUG, "%{public}@No changes to notify remote devices of changed characteristics after filtering", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v74);
  }

LABEL_76:

  v89 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldRegisterForNotificationsWithDevice:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self primaryResident];
  if (!isWatch())
  {
    if (v5)
    {
      v11 = [v5 device];
      v12 = [v11 isCurrentDevice];

      if (v12)
      {
        goto LABEL_8;
      }

      v9 = [v5 device];
      v13 = [v4 isEqual:v9];
    }

    else
    {
      v9 = [v4 capabilities];
      v13 = [v9 isRemoteGatewayCapable];
    }

    v10 = v13;
LABEL_14:

    goto LABEL_15;
  }

  if (!v5 || ([v5 device], v6 = objc_claimAutoreleasedReturnValue(), v7 = objc_msgSend(v4, "isEqual:", v6), v6, (v7 & 1) == 0))
  {
    v8 = [(HMDHome *)self homeManager];
    v9 = [v8 companionDevice];

    if ([v4 isEqual:v9])
    {
      v10 = 1;
    }

    else if (v9)
    {
      v10 = 0;
    }

    else
    {
      v15 = [v5 device];
      v10 = [v4 isEqual:v15];

      v9 = 0;
    }

    goto LABEL_14;
  }

LABEL_8:
  v10 = 1;
LABEL_15:

  return v10;
}

- (BOOL)shouldRelayNotificationToRegisteredDevicesForSource:(id)a3
{
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;
  v7 = [v4 destination];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (![v6 isRemote] || (isKindOfClass & 1) == 0 || !v7)
  {
    goto LABEL_16;
  }

  v9 = [v6 name];
  if (([v9 isEqualToString:@"kCharacteristicValueUpdatedNotificationKey"] & 1) == 0)
  {
    v10 = [v6 name];
    if ([v10 isEqualToString:@"kMultipleCharacteristicValuesUpdatedNotificationKey"])
    {

      goto LABEL_10;
    }

    v15 = [v6 name];
    v16 = [v15 isEqualToString:@"kCharacterisiticsChangedInternalNotificationKey"];

    if (v16)
    {
      goto LABEL_11;
    }

LABEL_16:
    if (!isWatch())
    {
      goto LABEL_17;
    }

    goto LABEL_14;
  }

LABEL_10:

LABEL_11:
  v11 = [(HMDHome *)self primaryResident];
  if ([v11 isCurrentDevice])
  {

LABEL_17:
    v14 = 1;
    goto LABEL_18;
  }

  v12 = [(HMDHome *)self homeManager];
  v13 = [v12 isPairedWithWatch];

  if (v13)
  {
    goto LABEL_17;
  }

LABEL_14:
  v14 = 0;
LABEL_18:

  return v14;
}

- (id)_splitCharacteristicChanges:(id)a3 changedAccessories:(id)a4
{
  v79 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v57 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v7, "count")}];
  v59 = v7;
  v58 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v7, "count")}];
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  v77 = 0u;
  obj = v6;
  v8 = [obj countByEnumeratingWithState:&v74 objects:v78 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v75;
    v61 = self;
    v62 = *v75;
    do
    {
      v11 = 0;
      v63 = v9;
      do
      {
        if (*v75 != v10)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v74 + 1) + 8 * v11);
        v13 = [v12 service];
        v14 = [v13 accessory];
        v15 = v14;
        if (v13)
        {
          v16 = v14 == 0;
        }

        else
        {
          v16 = 1;
        }

        if (!v16)
        {
          v17 = [(HMDHome *)self dataSource];
          v18 = [v17 hapMetadata];
          v19 = [v12 type];
          v73 = v18;
          if (([v18 shouldFilterCharacteristicOfTypeFromApp:v19] & 1) == 0)
          {
            v70 = v17;
            v72 = v19;
            v20 = [(HMDHome *)self dataSource];
            v21 = [v20 hapMetadata];
            v22 = [v13 type];
            if ([v21 shouldFilterServiceOfTypeFromApp:v22])
            {
              v67 = v21;
              goto LABEL_13;
            }

            v23 = [(HMDHome *)self dataSource];
            [v23 hapMetadata];
            v24 = v64 = v20;
            v25 = [v12 type];
            v26 = [v13 type];
            v68 = [v24 shouldFilterChangeNotificationsForCharacteristicType:v25 serviceType:v26];

            self = v61;
            v9 = v63;

            v10 = v62;
            if (v68)
            {
              goto LABEL_31;
            }

            v27 = [v15 uuid];
            v28 = [v27 UUIDString];

            v70 = v28;
            v29 = [v59 objectForKey:v28];
            v30 = [v13 instanceID];
            v31 = [v30 stringValue];

            v72 = v31;
            v73 = v29;
            v20 = [v29 objectForKey:v31];
            v32 = [v12 instanceID];
            v33 = [v32 stringValue];

            v34 = [v20 objectForKey:v33];
            v67 = v33;
            if (v34)
            {
              v60 = v34;
              v35 = v58;
              if (isAppleTV())
              {
                v65 = v20;
                v36 = [(HMDHome *)v61 dataSource];
                v37 = [v36 hapMetadata];
                v38 = [v12 type];
                v39 = [v13 type];
                v40 = [v37 requiresDeviceUnlock:v38 forService:v39];

                v17 = v70;
                if (v40)
                {
                  v41 = v57;

                  v35 = v41;
                }

                self = v61;
                v20 = v65;
              }

              else
              {
                v17 = v70;
              }

              v42 = accessoryToEncodeForXPCTransportForAccessory(v15);
              v66 = v42;
              if (v42 != v15)
              {
                v43 = [v42 uuid];
                v44 = [v43 UUIDString];

                v45 = v57;
                v17 = v44;
                v35 = v45;
              }

              v9 = v63;
              v46 = [v35 objectForKey:v17];
              if (!v46)
              {
                v47 = MEMORY[0x277CBEB38];
                v48 = [v73 count];
                v49 = v47;
                v9 = v63;
                v46 = [v49 dictionaryWithCapacity:v48];
                [v35 setObject:v46 forKey:v17];
              }

              v71 = v35;
              v50 = [v46 objectForKey:v72];
              if (!v50)
              {
                v51 = MEMORY[0x277CBEB38];
                v52 = [v20 count];
                v53 = v51;
                v9 = v63;
                v50 = [v53 dictionaryWithCapacity:v52];
                [v46 setObject:v50 forKey:v72];
              }

              v22 = v60;
              [v50 setObject:v60 forKey:v67];

              v10 = v62;
            }

            else
            {
              v22 = 0;
              v9 = v63;
LABEL_13:
              v17 = v70;
            }

            v19 = v72;
          }
        }

LABEL_31:

        ++v11;
      }

      while (v9 != v11);
      v9 = [obj countByEnumeratingWithState:&v74 objects:v78 count:16];
    }

    while (v9);
  }

  v54 = [[HMDCharacteristicUpdatesNotificationPayload alloc] initWithSPIEntitledClientUpdates:v57 allClientUpdates:v58];
  v55 = *MEMORY[0x277D85DE8];

  return v54;
}

- (void)_handleRequestHomeDataSync:(id)a3
{
  v60 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self isOwnerUser];
  v6 = MEMORY[0x277CCFD28];
  if (!v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [v4 identifier];
      v12 = [v11 UUIDString];
      *buf = 138543618;
      v57 = v10;
      v58 = 2112;
      v59 = v12;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Not owner, cannot send for message: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    v13 = [MEMORY[0x277CCA9B8] errorWithDomain:*v6 code:10 userInfo:0];
    v14 = [v4 responseHandler];

    if (v14)
    {
      v15 = [v4 responseHandler];
      (v15)[2](v15, v13, 0);
    }
  }

  v16 = [v4 stringForKey:@"pairingUsername"];
  if (!v16)
  {
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      v21 = [v4 identifier];
      v22 = [v21 UUIDString];
      *buf = 138543618;
      v57 = v20;
      v58 = 2112;
      v59 = v22;
      _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@User is not specified for message: %@", buf, 0x16u);

      v6 = MEMORY[0x277CCFD28];
    }

    objc_autoreleasePoolPop(v17);
    v23 = [MEMORY[0x277CCA9B8] errorWithDomain:*v6 code:2 userInfo:0];
    v24 = [v4 responseHandler];

    if (v24)
    {
      v25 = [v4 responseHandler];
      (v25)[2](v25, v23, 0);
    }
  }

  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  v26 = [(HMDHome *)self users];
  v27 = [v26 countByEnumeratingWithState:&v51 objects:v55 count:16];
  if (v27)
  {
    v28 = v27;
    v29 = *v52;
LABEL_15:
    v30 = 0;
    while (1)
    {
      if (*v52 != v29)
      {
        objc_enumerationMutation(v26);
      }

      v31 = *(*(&v51 + 1) + 8 * v30);
      if (([v31 isRemoteGateway] & 1) == 0)
      {
        v32 = [v31 pairingUsername];
        v33 = [v16 isEqualToString:v32];

        if (v33)
        {
          break;
        }
      }

      if (v28 == ++v30)
      {
        v28 = [v26 countByEnumeratingWithState:&v51 objects:v55 count:16];
        if (v28)
        {
          goto LABEL_15;
        }

        goto LABEL_22;
      }
    }

    v34 = v31;

    if (v34)
    {
      goto LABEL_29;
    }
  }

  else
  {
LABEL_22:
  }

  v35 = objc_autoreleasePoolPush();
  v36 = self;
  v37 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
  {
    v38 = HMFGetLogIdentifier();
    v39 = [v4 identifier];
    v40 = [v39 UUIDString];
    *buf = 138543618;
    v57 = v38;
    v58 = 2112;
    v59 = v40;
    _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@Unable to find user for message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v35);
  v41 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  v42 = [v4 responseHandler];

  if (v42)
  {
    v43 = [v4 responseHandler];
    (v43)[2](v43, v41, 0);
  }

  v34 = 0;
LABEL_29:
  v44 = [v4 destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v45 = v44;
  }

  else
  {
    v45 = 0;
  }

  v46 = v45;

  if (v46)
  {
    v47 = [(HMDHome *)self homeManager];
    v48 = [v46 device];
    v49 = [v48 remoteDestinationString];
    [v47 sendUserAdded:v34 destination:v49 toHome:self];
  }

  [v4 respondWithPayload:0];

  v50 = *MEMORY[0x277D85DE8];
}

- (void)_sendInvitationCancelationRequestToInvitee:(id)a3
{
  v19[2] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v18[0] = @"kInvitationIdentifierKey";
  v6 = [v4 identifier];
  v7 = [v6 UUIDString];
  v18[1] = @"kInvitationStateKey";
  v19[0] = v7;
  v19[1] = &unk_286627820;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v19 forKeys:v18 count:2];

  v9 = [v4 invitationData];
  v10 = [MEMORY[0x277D0F818] internalMessageWithName:@"kUpdateHomeInvitationStateInternalRequestKey" messagePayload:v8];
  v11 = [v5 uuid];
  v12 = [v9 inviteeUserID];
  v13 = [(HMDHome *)self workQueue];
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __54__HMDHome__sendInvitationCancelationRequestToInvitee___block_invoke;
  v16[3] = &unk_279733FB0;
  v16[4] = self;
  v17 = v4;
  v14 = v4;
  [v5 sendUnsecureMessage:v10 target:v11 userID:v12 responseQueue:v13 responseHandler:v16];

  v15 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome__sendInvitationCancelationRequestToInvitee___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v24 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v10)
    {
      v11 = HMFGetLogIdentifier();
      v12 = [*(a1 + 40) identifier];
      v13 = [v12 UUIDString];
      v18 = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = v13;
      v22 = 2112;
      v23 = v5;
      v14 = "%{public}@Failed to cancel invitation state for invitee with identifier %@ due to error %@";
      v15 = v9;
      v16 = 32;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, v14, &v18, v16);
    }
  }

  else if (v10)
  {
    v11 = HMFGetLogIdentifier();
    v12 = [*(a1 + 40) identifier];
    v13 = [v12 UUIDString];
    v18 = 138543618;
    v19 = v11;
    v20 = 2112;
    v21 = v13;
    v14 = "%{public}@Canceled invitation state for invitee with identifier %@";
    v15 = v9;
    v16 = 22;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v7);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)__handleCompletedOutgoingInvitation:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [v4 identifier];
    v10 = [v9 UUIDString];
    v13 = 138543618;
    v14 = v8;
    v15 = 2112;
    v16 = v10;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Removing outgoing invitation '%@' since it completed", &v13, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  [v4 updateInvitationState:3];
  v11 = [v4 user];
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)v6->_usersPendingUserManagementOperations removeObject:v11];
  os_unfair_recursive_lock_unlock();

  v12 = *MEMORY[0x277D85DE8];
}

- (void)__handleCancelledOutgoingInvitation:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  [v4 cancel];
  v23 = 0u;
  v24 = 0u;
  v21 = 0u;
  v22 = 0u;
  v20 = v4;
  v5 = [v4 operations];
  v6 = [v5 countByEnumeratingWithState:&v21 objects:v29 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v22;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v22 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v21 + 1) + 8 * i);
        if ([v10 isFinished] && (objc_msgSend(v10, "isCancelled") & 1) == 0)
        {
          v11 = [v10 user];
          v12 = [v10 accessory];
          v13 = [HMDUserManagementOperation removeUserManagementOperationForUser:v11 accessory:v12 model:0];

          v14 = objc_autoreleasePoolPush();
          v15 = self;
          v16 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
          {
            v17 = HMFGetLogIdentifier();
            *buf = 138543618;
            v26 = v17;
            v27 = 2112;
            v28 = v13;
            _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Adding remove operation for canceled invite: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v14);
          v18 = +[HMDUserManagementOperationManager sharedManager];
          [v18 addOperation:v13];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v21 objects:v29 count:16];
    }

    while (v7);
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)__handleAcceptedOutgoingInvitationResponse:(id)a3 destinationAddress:(id)a4 publicKey:(id)a5 username:(id)a6 issuerPublicKeyER:(id)a7 presenceAuthStatus:(id)a8 completionHandler:(id)a9
{
  v143 = *MEMORY[0x277D85DE8];
  v15 = a3;
  v102 = a4;
  v99 = a5;
  v101 = a6;
  v95 = a7;
  v98 = a8;
  aBlock = a9;
  v105 = v15;
  v109 = [v15 user];
  v16 = objc_autoreleasePoolPush();
  val = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    v19 = [(__CFString *)v109 privilege];
    if (v19 > 4)
    {
      v20 = @"None";
    }

    else
    {
      v20 = off_279730DF8[v19];
    }

    v21 = v20;
    *buf = 138543874;
    v136 = v18;
    v137 = 2112;
    v138 = v109;
    v139 = 2112;
    v140 = v21;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@User: %@, has accepted an invitation, processing acceptance. %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v16);
  [(__CFString *)v109 setHome:val];
  v107 = [(__CFString *)v109 modelObjectWithChangeType:1];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v22 = v107;
  }

  else
  {
    v22 = 0;
  }

  v23 = v22;

  if (v109 && v23)
  {
    v106 = v101;
    if ([(__CFString *)v109 isRemoteGateway])
    {
      v24 = [(HMDHome *)val keychainStore];
      v131 = 0;
      v132 = 0;
      v25 = [v24 getControllerPublicKey:0 secretKey:0 keyPair:0 username:&v132 allowCreation:0 error:&v131];
      v100 = v132;
      v104 = v131;

      if ((v25 & 1) == 0)
      {
        v50 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3 description:@"Failed to set resident pairing name" reason:0 suggestion:0];
        v53 = _Block_copy(aBlock);
        v54 = v53;
        if (v53)
        {
          (*(v53 + 2))(v53, v50);
        }

        goto LABEL_48;
      }

      if ([v100 isEqualToString:v106])
      {
        v26 = [HMDDevice deviceWithDestination:v102];
        v27 = [v26 identifier];
        v28 = [v27 UUIDString];

        v106 = v28;
      }
    }

    v104 = [objc_alloc(MEMORY[0x277D0F8B0]) initWithPairingKeyData:v99];
    v100 = [objc_alloc(MEMORY[0x277CFEC20]) initWithIdentifier:v106 publicKey:v104 privateKey:0 permissions:0];
    v29 = [(__CFString *)v109 userID];
    v30 = [(HMDHome *)val uuid];
    v94 = [HMDUser UUIDWithUserID:v29 forHomeIdentifier:v30 uuid:0 pairingIdentity:v100];

    v31 = [(__CFString *)v109 uuid];
    v32 = HMFEqualObjects();

    if ((v32 & 1) == 0)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = val;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        v37 = [(__CFString *)v109 uuid];
        v38 = [(__CFString *)v109 userID];
        *buf = 138544130;
        v136 = v36;
        v137 = 2112;
        v138 = v37;
        v139 = 2112;
        v140 = v94;
        v141 = 2112;
        v142 = v38;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Old invitee uuid %@, new invitee uuid %@ for userID %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v33);
      [(__CFString *)v109 setUUID:v94];
      v39 = [(__CFString *)v109 modelObjectWithChangeType:1];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v40 = v39;
      }

      else
      {
        v40 = 0;
      }

      v107 = v40;
    }

    v41 = [v100 hmd_dictionaryEncoding];
    [v107 setPairingIdentity:v41];

    v42 = [v98 number];
    [v107 setPresenceAuthorizationStatus:v42];

    [(__CFString *)v109 setPairingIdentity:v100];
    v43 = [(HMDHome *)val accessories];
    v130 = 0;
    v97 = [(HMDHome *)val prepareUserManagementOperationForUser:v109 accessories:v43 type:1 error:&v130];
    v92 = v130;

    if (!v97)
    {
      if (shouldLogPrivateInformation())
      {
        v44 = [(__CFString *)v109 userID];
      }

      else
      {
        v44 = @"...";
        v55 = @"...";
      }

      v56 = objc_autoreleasePoolPush();
      v57 = val;
      v58 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v59 = HMFGetLogIdentifier();
        *buf = 138543874;
        v136 = v59;
        v137 = 2112;
        v138 = v44;
        v139 = 2112;
        v140 = v92;
        _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_ERROR, "%{public}@Failed to prepare add user operations for recently accepted user '%@' with error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v56);
    }

    v60 = [HMDOutgoingHomeInvitationModel alloc];
    v61 = [v15 identifier];
    v62 = [(HMDHome *)val uuid];
    v96 = [(HMDBackingStoreModelObject *)v60 initWithObjectChangeType:3 uuid:v61 parentUUID:v62];

    [(HMDOutgoingHomeInvitationModel *)v96 setInvitationState:&unk_286627880];
    [(HMDOutgoingHomeInvitationModel *)v96 setInviteeDestinationAddress:v102];
    v113 = [(HMDHome *)val homeManager];
    v63 = [v113 backingStore];
    v64 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v112 = [v63 transaction:@"kUserManagementOperationAddedKey" options:v64];

    v65 = dispatch_group_create();
    v111 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v97, "count")}];
    if ([v97 count])
    {
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)val->_usersPendingUserManagementOperations addObject:v109];
      os_unfair_recursive_lock_unlock();
      [(HMDBackingStoreModelObject *)v96 setObjectChangeType:2];
      v128 = 0u;
      v129 = 0u;
      v126 = 0u;
      v127 = 0u;
      obj = v97;
      v66 = [obj countByEnumeratingWithState:&v126 objects:v134 count:16];
      if (v66)
      {
        v67 = *v127;
        do
        {
          for (i = 0; i != v66; ++i)
          {
            if (*v127 != v67)
            {
              objc_enumerationMutation(obj);
            }

            v69 = *(*(&v126 + 1) + 8 * i);
            dispatch_group_enter(v65);
            v70 = [v69 accessory];
            v71 = [v70 identifier];
            v72 = [v69 user];
            v73 = [v72 pairingIdentity];
            v124[0] = MEMORY[0x277D85DD0];
            v124[1] = 3221225472;
            v124[2] = __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1508;
            v124[3] = &unk_2797359D8;
            v125 = v65;
            [v113 cleanupOperationsForAccessory:v71 user:v73 completion:v124];

            v74 = [v69 modelObjectWithChangeType:1];
            [v112 add:v74];

            v75 = [v69 identifier];
            v76 = [v75 UUIDString];
            [v111 addObject:v76];
          }

          v66 = [obj countByEnumeratingWithState:&v126 objects:v134 count:16];
        }

        while (v66);
      }
    }

    else
    {
      v77 = objc_autoreleasePoolPush();
      v78 = val;
      v79 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v79, OS_LOG_TYPE_INFO))
      {
        v80 = HMFGetLogIdentifier();
        *buf = 138543362;
        v136 = v80;
        _os_log_impl(&dword_2531F8000, v79, OS_LOG_TYPE_INFO, "%{public}@Immediately processing outgoing invitation as there are no accessory operations to perform", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v77);
    }

    v81 = [(HMDHome *)val backingStore];
    v82 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v83 = [v81 transaction:@"kAddUserRequestKey" options:v82];

    v84 = MEMORY[0x277D0F818];
    v85 = [v105 identifier];
    v86 = [v84 messageWithName:@"kAddUserRequestKey" identifier:v85 messagePayload:0];
    [v83 add:v107 withMessage:v86];

    [v83 add:v96];
    objc_initWeak(buf, val);
    v114[0] = MEMORY[0x277D85DD0];
    v114[1] = 3221225472;
    v114[2] = __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1509;
    v114[3] = &unk_2797226A0;
    v114[4] = val;
    v115 = v109;
    v87 = v65;
    v116 = v87;
    v88 = v112;
    v117 = v88;
    objc_copyWeak(&v123, buf);
    v89 = v111;
    v118 = v89;
    v119 = v105;
    v120 = v102;
    v122 = aBlock;
    v50 = v93;
    v121 = v50;
    v90 = _Block_copy(v114);
    [v83 run:v90];

    objc_destroyWeak(&v123);
    objc_destroyWeak(buf);

    v54 = v94;
LABEL_48:

    v23 = v107;
    goto LABEL_49;
  }

  v45 = [(HMDHome *)val backingStore];
  v46 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v106 = [v45 transaction:@"kUpdateInvitationStateRequestKey" options:v46];

  v47 = [HMDOutgoingHomeInvitationModel alloc];
  v48 = [v15 identifier];
  v49 = [(HMDHome *)val uuid];
  v104 = [(HMDBackingStoreModelObject *)v47 initWithObjectChangeType:3 uuid:v48 parentUUID:v49];

  [v106 add:v104];
  v133[0] = MEMORY[0x277D85DD0];
  v133[1] = 3221225472;
  v133[2] = __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke;
  v133[3] = &unk_2797359D8;
  v133[4] = val;
  [v106 run:v133];
  v50 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3 description:@"Outgoing Invitation does not have a valid invitee. Cancelling the invite." reason:0 suggestion:0];
  v51 = _Block_copy(aBlock);
  v52 = v51;
  if (v51)
  {
    (*(v51 + 2))(v51, v50);
  }

LABEL_49:
  v91 = *MEMORY[0x277D85DE8];
}

void __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543618;
    v10 = v7;
    v11 = 2112;
    v12 = v3;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Finished deleting the outgoing invitation with error: %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

void __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1509(uint64_t a1, void *a2)
{
  v37 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = shouldLogPrivateInformation();
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 32);
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v4)
  {
    if (v8)
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 40) userID];
      v11 = [*(a1 + 40) displayName];
      *buf = 138544130;
      v30 = v9;
      v31 = 2112;
      v32 = v10;
      v33 = 2112;
      v34 = v11;
      v35 = 2112;
      v36 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Added user with userID: %@ and displayName: %@ with error: %@", buf, 0x2Au);
    }
  }

  else if (v8)
  {
    v12 = HMFGetLogIdentifier();
    *buf = 138544130;
    v30 = v12;
    v31 = 2112;
    v32 = @"...";
    v33 = 2112;
    v34 = @"...";
    v35 = 2112;
    v36 = v3;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Added user with userID: %@ and displayName: %@ with error: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v5);
  v13 = *(a1 + 48);
  v14 = [*(a1 + 32) workQueue];
  v21 = MEMORY[0x277D85DD0];
  v22 = 3221225472;
  v23 = __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1510;
  v24 = &unk_279733910;
  v25 = *(a1 + 56);
  objc_copyWeak(&v28, (a1 + 104));
  v26 = *(a1 + 64);
  v27 = *(a1 + 72);
  dispatch_group_notify(v13, v14, &v21);

  WeakRetained = objc_loadWeakRetained((a1 + 104));
  v16 = WeakRetained;
  if (WeakRetained)
  {
    v17 = [WeakRetained homeManager];
    [v17 sendUserAdded:*(a1 + 40) destination:*(a1 + 80) toHome:v16];
  }

  v18 = _Block_copy(*(a1 + 96));
  v19 = v18;
  if (v18)
  {
    (*(v18 + 2))(v18, *(a1 + 88));
  }

  objc_destroyWeak(&v28);
  v20 = *MEMORY[0x277D85DE8];
}

void __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1510(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_2;
  v3[3] = &unk_279731988;
  objc_copyWeak(&v6, (a1 + 56));
  v4 = *(a1 + 40);
  v5 = *(a1 + 48);
  [v2 run:v3];

  objc_destroyWeak(&v6);
}

uint64_t __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_2(id *a1)
{
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v11 = WeakRetained;
    if ([a1[4] count])
    {
      v3 = [v11 backingStore];
      v4 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v5 = [v3 transaction:@"kAddUserRequestKey" options:v4];

      v6 = [HMDOutgoingHomeInvitationModel alloc];
      v7 = [a1[5] identifier];
      v8 = [v11 uuid];
      v9 = [(HMDBackingStoreModelObject *)v6 initWithObjectChangeType:2 uuid:v7 parentUUID:v8];

      [(HMDOutgoingHomeInvitationModel *)v9 setOperationIdentifiers:a1[4]];
      [v5 add:v9];
      [v5 run];
    }
  }

  return MEMORY[0x2821F96F8]();
}

- (void)_handleRemoveUserModel:(id)a3 message:(id)a4
{
  v41 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 uuid];
  v9 = [(HMDHome *)self userWithUUID:v8];

  if (v9)
  {
    v10 = [(HMDHome *)self currentUser];

    if (v9 == v10)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v14;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Attempting to remove current user", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v11);
      [(HMDHome *)v12 setCurrentUser:0];
    }

    [(HMDHome *)self _removeUserFromContainer:v9];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_usersPendingUserManagementOperations removeObject:v9];
    os_unfair_recursive_lock_unlock();
    [v9 setHome:0];
    v15 = [v7 transactionResult];
    [v15 markChanged];
    if ([v15 source] == 1)
    {
      v16 = [HMDRemovedUser removedUserWithUser:v9];
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)self->_removedUsers addObject:v16];
      os_unfair_recursive_lock_unlock();
      v17 = objc_autoreleasePoolPush();
      v18 = self;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        *buf = 138543618;
        v38 = v20;
        v39 = 2112;
        v40 = v16;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Sending message to removed user: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v17);
      [v16 setRemovalInProgress:1];
      objc_initWeak(buf, v18);
      v21 = [(HMDHome *)v18 homeManager];
      v22 = [v9 pairingUsername];
      v34[0] = MEMORY[0x277D85DD0];
      v34[1] = 3221225472;
      v34[2] = __42__HMDHome__handleRemoveUserModel_message___block_invoke;
      v34[3] = &unk_279733AE8;
      objc_copyWeak(&v36, buf);
      v23 = v16;
      v35 = v23;
      [v21 sendUserRemoved:v9 fromHome:v18 pairingUsername:v22 pushToCloud:1 completionHandler:v34];

      objc_destroyWeak(&v36);
      objc_destroyWeak(buf);
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      v30 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_DEBUG))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v32;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_DEBUG, "%{public}@Skipping remove user due to non-xpc backingstore transaction", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v29);
      [v7 respondWithPayload:0];
    }
  }

  else
  {
    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [v6 uuid];
      *buf = 138543618;
      v38 = v27;
      v39 = 2112;
      v40 = v28;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Cannot find the user with UUID %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    v15 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v7 respondWithError:v15];
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __42__HMDHome__handleRemoveUserModel_message___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v29 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5 && [v5 code] != 2)
    {
      v20 = objc_autoreleasePoolPush();
      v21 = WeakRetained;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        v25 = 138543618;
        v26 = v23;
        v27 = 2112;
        v28 = v5;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unable to remove user: %@", &v25, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
    }

    else
    {
      if ([v5 code] == 2)
      {
        v8 = objc_autoreleasePoolPush();
        v9 = WeakRetained;
        v10 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          v11 = HMFGetLogIdentifier();
          v25 = 138543618;
          v26 = v11;
          v27 = 2112;
          v28 = v5;
          _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Treating user removed message error as success: %@", &v25, 0x16u);
        }

        objc_autoreleasePoolPop(v8);
      }

      v12 = objc_autoreleasePoolPush();
      v13 = WeakRetained;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v16 = *(a1 + 32);
        v25 = 138543618;
        v26 = v15;
        v27 = 2112;
        v28 = v16;
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Successfully sent removed user message for user: %@", &v25, 0x16u);
      }

      objc_autoreleasePoolPop(v12);
      os_unfair_recursive_lock_lock_with_options();
      [v13[5] removeObject:*(a1 + 32)];
      os_unfair_recursive_lock_unlock();
    }

    [*(a1 + 32) setRemovalInProgress:0];
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v25 = 138543362;
      v26 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Lost reference to home during user removal", &v25, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddUserModel:(id)a3 message:(id)a4
{
  v99 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 uuid];
  v9 = [(HMDHome *)self userWithUUID:v8];

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [v6 debugString:1];
    *buf = 138543618;
    v94 = v13;
    v95 = 2112;
    v96 = v14;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Adding HMDUserModel: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  if (!v9)
  {
    v85 = v11;
    v20 = [(HMDHome *)v11 homeManager];
    v21 = v6;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v22 = v21;
    }

    else
    {
      v22 = 0;
    }

    v23 = v22;

    if (v23)
    {
      v9 = [[HMDResidentUser alloc] initWithModelObject:v23];
    }

    else
    {
      v9 = [[HMDUser alloc] initWithModelObject:v21];
      [(HMDResidentUser *)v9 refreshDisplayName];
      v24 = [(HMDResidentUser *)v9 userID];

      if (!v24)
      {
        v68 = v20;
        v69 = v7;
        if (shouldLogPrivateInformation())
        {
          v36 = [v21 userID];
        }

        else
        {
          v36 = @"...";
          v75 = @"...";
        }

        v76 = objc_autoreleasePoolPush();
        v77 = v85;
        v78 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v78, OS_LOG_TYPE_ERROR))
        {
          v79 = HMFGetLogIdentifier();
          *buf = 138543618;
          v94 = v79;
          v95 = 2112;
          v96 = v36;
          _os_log_impl(&dword_2531F8000, v78, OS_LOG_TYPE_ERROR, "%{public}@User created from model no longer has userID, model userID invalid %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v76);
        v7 = v69;
        v20 = v68;
        v47 = 0;
LABEL_54:

        goto LABEL_55;
      }
    }

    if (v9)
    {
      v81 = v23;
      v82 = v6;
      v83 = v7;
      [(HMDResidentUser *)v9 configureWithHome:v85];
      [(HMDHome *)v85 _addUserToContainer:v9];
      [(HMDHome *)v85 _cleanRemovedUsers:v9];
      v84 = v20;
      [v20 reprocessUserManagementModels];
      v88 = 0u;
      v89 = 0u;
      v86 = 0u;
      v87 = 0u;
      v25 = [(HMDHome *)v85 outgoingInvitations];
      v26 = [v25 countByEnumeratingWithState:&v86 objects:v92 count:16];
      if (v26)
      {
        v27 = v26;
        v28 = *v87;
        while (2)
        {
          for (i = 0; i != v27; ++i)
          {
            if (*v87 != v28)
            {
              objc_enumerationMutation(v25);
            }

            v30 = *(*(&v86 + 1) + 8 * i);
            v31 = [v30 user];
            v32 = [v31 pairingIdentity];
            v33 = [(HMDUser *)v9 pairingIdentity];
            v34 = [v32 isEqual:v33];

            if (v34)
            {
              [v30 setUser:v9];
              goto LABEL_24;
            }
          }

          v27 = [v25 countByEnumeratingWithState:&v86 objects:v92 count:16];
          if (v27)
          {
            continue;
          }

          break;
        }
      }

LABEL_24:

      [(HMDHome *)v85 _addUserToIdentityRegistry:v9];
      v9 = v9;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v35 = v9;
      }

      else
      {
        v35 = 0;
      }

      v36 = v35;

      if (v36)
      {
        [(HMDHome *)v85 _updateConfigurationStateForResidentDevice:v36 desiredConfigState:2 message:0];
        v37 = objc_autoreleasePoolPush();
        v38 = v85;
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
        {
          v40 = HMFGetLogIdentifier();
          v41 = [(HMDResidentUser *)v9 userID];
          *buf = 138543618;
          v94 = v40;
          v95 = 2112;
          v96 = v41;
          _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Removing resident user %@ from unassociated list", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v37);
        v42 = [(__CFString *)v36 userID];
        [v84 removeFromUnassociatedPeers:v42 home:v38];

        v43 = objc_autoreleasePoolPush();
        v44 = v38;
        v45 = HMFGetOSLogHandle();
        v6 = v82;
        if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
        {
          v46 = HMFGetLogIdentifier();
          *buf = 138543362;
          v94 = v46;
          _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_DEBUG, "%{public}@Add resident device", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v43);
        v47 = v81;
      }

      else
      {
        if ([(HMDUser *)v9 isCurrentUser])
        {
          v49 = objc_autoreleasePoolPush();
          v50 = v85;
          v51 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
          {
            v52 = HMFGetLogIdentifier();
            v53 = [(HMDHome *)v50 currentUser];
            *buf = 138543874;
            v94 = v52;
            v95 = 2112;
            v96 = v53;
            v97 = 2112;
            v98 = v9;
            _os_log_impl(&dword_2531F8000, v51, OS_LOG_TYPE_INFO, "%{public}@Newly added user is current user, updating _currentUser from %@ to %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v49);
          v54 = [(HMDHome *)v50 presenceAuthStatus];
          [(HMDUser *)v9 setPresenceAuthStatus:v54];

          [(HMDHome *)v50 setCurrentUser:v9];
        }

        v90[0] = @"kUserUUIDKey";
        v55 = [(HMDUser *)v9 uuid];
        v56 = [v55 UUIDString];
        v91[0] = v56;
        v90[1] = @"kUserIDKey";
        v57 = [(HMDResidentUser *)v9 userID];
        v91[1] = v57;
        v90[2] = @"kUserDisplayNameKey";
        v58 = [(HMDResidentUser *)v9 displayName];
        v91[2] = v58;
        v59 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v91 forKeys:v90 count:3];

        v60 = [v59 mutableCopy];
        v61 = [(HMDResidentUser *)v9 userID];
        [v60 setObject:v61 forKeyedSubscript:@"kUserIDKey"];

        v62 = [v83 identifier];
        v47 = v81;
        v6 = v82;
        if (v62)
        {
          [v83 identifier];
        }

        else
        {
          [MEMORY[0x277CCAD78] UUID];
        }
        v70 = ;

        v71 = [MEMORY[0x277D0F818] entitledMessageWithName:@"kUserAddedNotificationKey" identifier:v70 messagePayload:v60];
        v72 = [(HMDHome *)v85 msgDispatcher];
        v73 = [(HMDHome *)v85 uuid];
        [v72 sendMessage:v71 target:v73];
      }

      v7 = v83;
      v74 = [v83 transactionResult];
      [v74 markChanged];

      v20 = v84;
    }

    else
    {
      v48 = v23;
      if (shouldLogPrivateInformation())
      {
        v36 = [v21 userID];
      }

      else
      {
        v36 = @"...";
        v63 = @"...";
      }

      v64 = objc_autoreleasePoolPush();
      v65 = v85;
      v66 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v66, OS_LOG_TYPE_ERROR))
      {
        v67 = HMFGetLogIdentifier();
        *buf = 138543618;
        v94 = v67;
        v95 = 2112;
        v96 = v36;
        _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_ERROR, "%{public}@Failed to create new user %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v64);
      v9 = 0;
      v47 = v48;
    }

    goto LABEL_54;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = v11;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
  {
    v18 = HMFGetLogIdentifier();
    v19 = [v6 uuid];
    *buf = 138543874;
    v94 = v18;
    v95 = 2112;
    v96 = v19;
    v97 = 2112;
    v98 = v9;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@HMDUserModel %@ passed as add for existing user %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  [(HMDResidentUser *)v9 transactionObjectUpdated:0 newValues:v6 message:v7];
LABEL_55:

  v80 = *MEMORY[0x277D85DE8];
}

- (void)_updateOutgoingInvitationsWithCompleteUserManagementOperation:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  v5 = [(HMDHome *)self outgoingInvitations];
  v6 = [v5 countByEnumeratingWithState:&v25 objects:v29 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v26;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v26 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v25 + 1) + 8 * i);
        v11 = [v10 operations];
        if ([v11 containsObject:v4])
        {
          v12 = [v10 isComplete];

          if (v12)
          {
            v17 = [(HMDHome *)self backingStore];
            v18 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
            v19 = [v17 transaction:@"kUpdateInvitationStateRequestKey" options:v18];

            v20 = [HMDOutgoingHomeInvitationModel alloc];
            v21 = [v10 identifier];
            v22 = [(HMDHome *)self uuid];
            v23 = [(HMDBackingStoreModelObject *)v20 initWithObjectChangeType:3 uuid:v21 parentUUID:v22];

            [v19 add:v23];
            [v19 run];

            goto LABEL_13;
          }
        }

        else
        {
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v25 objects:v29 count:16];
    }

    while (v7);
  }

  v13 = [(HMDHome *)self homeManager];
  v14 = [v13 backingStore];
  v15 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v5 = [v14 transaction:@"kUserManagementOperationRemovedKey" options:v15];

  v16 = [v4 modelObjectWithChangeType:3];
  [v5 add:v16];

  [v5 run];
LABEL_13:

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateRequestForHomeInvitation:(id)a3 controllerPublicKey:(id)a4 controllerUsername:(id)a5 invitationState:(int64_t)a6 presenceAuthStatus:(id)a7 preferredUserID:(id)a8 fromHandle:(id)a9 fromAddress:(id)a10 issuerPublicKeyER:(id)a11 message:(id)a12 messageResponseHandler:(id)a13
{
  v144 = *MEMORY[0x277D85DE8];
  v17 = a3;
  v18 = a4;
  v102 = a5;
  v99 = a7;
  v19 = a8;
  v100 = a9;
  v101 = a10;
  v96 = a11;
  v103 = a12;
  v109 = a13;
  v104 = v17;
  v97 = v19;
  v98 = v18;
  if ([v17 isExpired])
  {
    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      v24 = [v104 identifier];
      *buf = 138543618;
      v139 = v23;
      v140 = 2112;
      v141 = v24;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Invitation (%@) has already expired, invitee cannot accept or decline", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v25 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:1006 userInfo:0];
    if (v109)
    {
      v109[2](v109, v25, 0);
    }

LABEL_43:

LABEL_74:
    v62 = v109;
    goto LABEL_75;
  }

  if ([v17 responseReceived])
  {
    v26 = objc_autoreleasePoolPush();
    v27 = self;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
    {
      v29 = HMFGetLogIdentifier();
      v30 = [v104 identifier];
      v31 = [v104 isDeclined];
      v32 = @"accepted";
      *buf = 138543874;
      v139 = v29;
      v140 = 2112;
      if (v31)
      {
        v32 = @"declined";
      }

      v141 = v30;
      v142 = 2112;
      v143 = v32;
      _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Invitation (%@) has already been %@, invitee cannot accept or decline", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v26);
    v33 = MEMORY[0x277CCA9B8];
    if ([v104 isDeclined])
    {
      v34 = 1008;
    }

    else
    {
      v34 = 1007;
    }

    v25 = [v33 errorWithDomain:*MEMORY[0x277CCFD28] code:v34 userInfo:0];
    if (v109)
    {
      v109[2](v109, v25, 0);
    }

    goto LABEL_43;
  }

  if ((a6 - 3) > 1)
  {
    v55 = objc_autoreleasePoolPush();
    v56 = self;
    v57 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
    {
      v58 = HMFGetLogIdentifier();
      *buf = 138543618;
      v139 = v58;
      v140 = 2048;
      v141 = a6;
      _os_log_impl(&dword_2531F8000, v57, OS_LOG_TYPE_INFO, "%{public}@Failed to update invite state since the value %ld was incorrect", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v55);
    v25 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:43 userInfo:0];
    if (v109)
    {
      v109[2](v109, v25, 0);
    }

    goto LABEL_43;
  }

  if (a6 != 3)
  {
    if (shouldLogPrivateInformation())
    {
      v59 = [v17 user];
      v60 = [v59 userID];
    }

    else
    {
      v60 = @"...";
      v63 = @"...";
    }

    v64 = objc_autoreleasePoolPush();
    v65 = self;
    v66 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
    {
      v67 = HMFGetLogIdentifier();
      *buf = 138543618;
      v139 = v67;
      v140 = 2112;
      v141 = v60;
      _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_INFO, "%{public}@User %@ declined invite", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v64);
    v68 = [v103 name];
    v69 = v68;
    v70 = @"UpdateOutgoingInvitationToAccept";
    if (v68)
    {
      v70 = v68;
    }

    v71 = v70;

    v72 = [(HMDHome *)v65 backingStore];
    v73 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v74 = [v72 transaction:v71 options:v73];

    v75 = [v17 emptyModelObjectWithChangeType:2];
    v76 = [MEMORY[0x277CCABB0] numberWithInteger:a6];
    [v75 setInvitationState:v76];

    if (v103)
    {
      [v74 add:v75 withMessage:?];
    }

    else
    {
      [v74 add:v75];
    }

    [v74 run];

    goto LABEL_74;
  }

  if (v18 && v102)
  {
    if (v19)
    {
      v35 = +[HMDAccountHandleFormatter defaultFormatter];
      v19 = [v35 accountHandleFromString:v19];
    }

    v110[0] = MEMORY[0x277D85DD0];
    v110[1] = 3221225472;
    v111 = __211__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_issuerPublicKeyER_message_messageResponseHandler___block_invoke;
    v112 = &unk_279722678;
    v121 = v109;
    v113 = v100;
    v114 = self;
    v115 = v17;
    v116 = v19;
    v117 = v18;
    v118 = v102;
    v119 = v101;
    v120 = v99;
    vala = self;
    v36 = v115;
    v91 = v113;
    v94 = v116;
    v92 = v110;
    v37 = [v36 user];
    v93 = [v37 accountHandle];

    if (!v93)
    {
      v77 = objc_autoreleasePoolPush();
      v78 = vala;
      v79 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v79, OS_LOG_TYPE_ERROR))
      {
        v80 = HMFGetLogIdentifier();
        *buf = 138543362;
        v139 = v80;
        _os_log_impl(&dword_2531F8000, v79, OS_LOG_TYPE_ERROR, "%{public}@Invalid invitee destination", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v77);
      v108 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      v111(v92, v108);
      goto LABEL_73;
    }

    v38 = +[HMDAccountRegistry sharedRegistry];
    v108 = [v38 accountForHandle:v91];

    v90 = [MEMORY[0x277CBEB58] setWithCapacity:2];
    if ([v108 isAuthenticated])
    {
      v39 = [v108 handles];
      v40 = [v39 containsObject:v93];

      if ((v40 & 1) == 0)
      {
        v41 = objc_autoreleasePoolPush();
        v42 = vala;
        v43 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
        {
          v44 = HMFGetLogIdentifier();
          *buf = 138543618;
          v139 = v44;
          v140 = 2112;
          v141 = v93;
          _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Authenticating the invitation handle: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v41);
        [v90 addObject:v93];
      }

      if (v94)
      {
        v45 = [v108 handles];
        v46 = [v45 containsObject:v94];

        if ((v46 & 1) == 0)
        {
          v47 = objc_autoreleasePoolPush();
          v48 = vala;
          v49 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
          {
            v50 = HMFGetLogIdentifier();
            *buf = 138543618;
            v139 = v50;
            v140 = 2112;
            v141 = v94;
            _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_INFO, "%{public}@Authenticating the preferred account handle: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v47);
          [v90 addObject:v94];
        }
      }

      if (![v90 hmf_isEmpty])
      {
        v136[0] = 0;
        v136[1] = v136;
        v136[2] = 0x3032000000;
        v136[3] = __Block_byref_object_copy__10664;
        v136[4] = __Block_byref_object_dispose__10665;
        v137 = 0;
        v82 = dispatch_group_create();
        v132 = 0u;
        v133 = 0u;
        v134 = 0u;
        v135 = 0u;
        obj = v90;
        v83 = [obj countByEnumeratingWithState:&v132 objects:buf count:16];
        if (v83)
        {
          v84 = *v133;
          do
          {
            for (i = 0; i != v83; ++i)
            {
              if (*v133 != v84)
              {
                objc_enumerationMutation(obj);
              }

              v86 = *(*(&v132 + 1) + 8 * i);
              dispatch_group_enter(v82);
              objc_initWeak(location, vala);
              v87 = +[HMDAccountRegistry sharedRegistry];
              v126[0] = MEMORY[0x277D85DD0];
              v126[1] = 3221225472;
              v126[2] = ____authenticateAcceptedOutgoingInvitation_block_invoke;
              v126[3] = &unk_279722F10;
              objc_copyWeak(&v131, location);
              v127 = v82;
              v128 = v86;
              v130 = v136;
              v129 = v108;
              [v87 _resolveAccountForHandle:v86 completionHandler:v126];

              objc_destroyWeak(&v131);
              objc_destroyWeak(location);
            }

            v83 = [obj countByEnumeratingWithState:&v132 objects:buf count:16];
          }

          while (v83);
        }

        v88 = [(HMDHome *)vala workQueue];
        location[0] = MEMORY[0x277D85DD0];
        location[1] = 3221225472;
        location[2] = ____authenticateAcceptedOutgoingInvitation_block_invoke_4364;
        location[3] = &unk_279731DC8;
        v125 = v136;
        v123 = vala;
        v124 = v92;
        dispatch_group_notify(v82, v88, location);

        _Block_object_dispose(v136, 8);
        goto LABEL_72;
      }

      v51 = objc_autoreleasePoolPush();
      v52 = vala;
      v53 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v53, OS_LOG_TYPE_DEFAULT))
      {
        v54 = HMFGetLogIdentifier();
        *buf = 138543362;
        v139 = v54;
        _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_DEFAULT, "%{public}@Authenticated invitation without resolving", buf, 0xCu);
      }
    }

    else
    {
      v51 = objc_autoreleasePoolPush();
      v52 = vala;
      v53 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
      {
        v81 = HMFGetLogIdentifier();
        *buf = 138543362;
        v139 = v81;
        _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_INFO, "%{public}@Accepting invitation from unauthenticated user", buf, 0xCu);
      }
    }

    objc_autoreleasePoolPop(v51);
    v111(v92, 0);
LABEL_72:

LABEL_73:
    goto LABEL_74;
  }

  v61 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
  v62 = v109;
  if (v109)
  {
    v109[2](v109, v61, 0);
  }

LABEL_75:
  v89 = *MEMORY[0x277D85DE8];
}

void __211__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_issuerPublicKeyER_message_messageResponseHandler___block_invoke(uint64_t a1, void *a2)
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (!v3)
  {
    v5 = +[HMDAccountRegistry sharedRegistry];
    v6 = [v5 accountForHandle:*(a1 + 32)];

    if ([v6 isAuthenticated])
    {
      v7 = objc_autoreleasePoolPush();
      v8 = *(a1 + 40);
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v10;
        _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Received authenticated invitation response", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v7);
      v11 = [*(a1 + 48) user];
      v12 = [v6 identifier];
      [v11 setAccountIdentifier:v12];
    }

    if (*(a1 + 56))
    {
      v13 = [*(a1 + 48) user];
      v14 = [HMDUser userIDForAccountHandle:*(a1 + 56)];
      [v13 setUserID:v14];
    }

    v33 = [objc_alloc(MEMORY[0x277D0F8B0]) initWithPairingKeyData:*(a1 + 64)];
    v15 = [objc_alloc(MEMORY[0x277CFEC20]) initWithIdentifier:*(a1 + 72) publicKey:v33 privateKey:0 permissions:0];
    v16 = [*(a1 + 40) homeManager];
    v17 = [*(a1 + 48) user];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    v34 = v6;
    v31 = v16;
    v32 = v15;
    if (v19)
    {
      v20 = [v19 device];
      if (v20)
      {
        v21 = [v16 identityRegistry];
        v22 = [*(a1 + 48) user];
        [v21 registerIdentity:v15 device:v20 object:v22];

LABEL_18:
      }
    }

    else
    {
      v23 = [*(a1 + 48) user];
      v20 = [v23 account];

      if (v20)
      {
        v21 = [v16 identityRegistry];
        [v21 registerIdentity:v15 account:v20 object:*(a1 + 48)];
        goto LABEL_18;
      }
    }

    v24 = *(a1 + 40);
    v25 = *(a1 + 48);
    v27 = *(a1 + 64);
    v26 = *(a1 + 72);
    v29 = *(a1 + 80);
    v28 = *(a1 + 88);
    v35[0] = MEMORY[0x277D85DD0];
    v35[1] = 3221225472;
    v35[2] = __211__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1491;
    v35[3] = &unk_279735558;
    v36 = *(a1 + 96);
    [v24 __handleAcceptedOutgoingInvitationResponse:v25 destinationAddress:v29 publicKey:v27 username:v26 issuerPublicKeyER:0 presenceAuthStatus:v28 completionHandler:v35];

    goto LABEL_20;
  }

  v4 = *(a1 + 96);
  if (v4)
  {
    (*(v4 + 16))(v4, v3, 0);
  }

LABEL_20:

  v30 = *MEMORY[0x277D85DE8];
}

uint64_t __211__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1491(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, a2, 0);
  }

  return result;
}

- (void)_handleUpdateRequestForHomeInvitationFromInvitee:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:@"kInvitationIdentifierKey"];
  v35 = [v4 dataForKey:@"kControllerPublicKey"];
  v6 = [v4 stringForKey:@"kControllerPairingNameKey"];
  v7 = [v4 numberForKey:@"kInvitationStateKey"];
  v8 = [MEMORY[0x277CD1F00] authWithMessage:v4];
  v9 = [v4 stringForKey:@"kUserIDKey"];
  v10 = [v4 remoteSourceID];
  v11 = [HMDAccountHandle accountHandleForDestination:v10];
  if (v7)
  {
    v34 = v6;
    v12 = [v7 integerValue];
    v13 = [(HMDHome *)self outgoingInvitations];
    v33 = v5;
    v14 = [v13 hmf_firstObjectWithValue:v5 forKeyPath:@"identifier"];

    if (v14)
    {
      v15 = [v4 responseHandler];
      v16 = self;
      v17 = v35;
      [(HMDHome *)v16 _handleUpdateRequestForHomeInvitation:v14 controllerPublicKey:v35 controllerUsername:v34 invitationState:v12 presenceAuthStatus:v8 preferredUserID:v9 fromHandle:v11 fromAddress:v10 issuerPublicKeyER:0 message:v4 messageResponseHandler:v15];
    }

    else
    {
      v21 = objc_autoreleasePoolPush();
      v22 = self;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v24 = v31 = v8;
        v30 = [0 identifier];
        [v30 UUIDString];
        v25 = v32 = v21;
        *buf = 138543618;
        v37 = v24;
        v38 = 2112;
        v39 = v25;
        _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Invalid invite identifier %@ specified from remote user", buf, 0x16u);

        v21 = v32;
        v8 = v31;
      }

      objc_autoreleasePoolPop(v21);
      v26 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      v27 = [v4 responseHandler];

      if (v27)
      {
        v28 = [v4 responseHandler];
        (v28)[2](v28, v26, 0);
      }

      v17 = v35;
    }

    v5 = v33;
    v6 = v34;
  }

  else
  {
    v18 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    v19 = [v4 responseHandler];

    if (v19)
    {
      v20 = [v4 responseHandler];
      (v20)[2](v20, v18, 0);
    }

    v17 = v35;
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateOutgoingInvitationState:(id)a3
{
  v43 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:@"kInvitationIdentifierKey"];
  v6 = [v4 numberForKey:@"kInvitationStateKey"];
  v7 = v6;
  if (!v5 || !v6)
  {
    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543362;
      v38 = v25;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Unable to accept the invitation as could not find the invite", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v22);
    v9 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    v26 = [v4 responseHandler];
    (v26)[2](v26, v9, 0);
    goto LABEL_17;
  }

  v8 = [(HMDHome *)self outgoingInvitations];
  v9 = [v8 hmf_firstObjectWithValue:v5 forKeyPath:@"identifier"];

  if (v9)
  {
    if ([v7 integerValue] == 1)
    {
      v10 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v13 = HMFGetLogIdentifier();
        v14 = [v9 identifier];
        v15 = [v14 UUIDString];
        [MEMORY[0x277CD1A88] homeInvitationStateDescription:1];
        v16 = v36 = v10;
        *buf = 138543874;
        v38 = v13;
        v39 = 2112;
        v40 = v15;
        v41 = 2112;
        v42 = v16;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@[Home] Processing request to update invitation %@ to state %@", buf, 0x20u);

        v10 = v36;
      }

      objc_autoreleasePoolPop(v10);
      if (([v9 invitationState] & 0xFFFFFFFFFFFFFFFDLL) != 4)
      {
        [(HMDHome *)v11 _sendInvitationCancelationRequestToInvitee:v9];
      }

      v17 = [(HMDHome *)v11 backingStore];
      v18 = [v4 name];
      v19 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v20 = [v17 transaction:v18 options:v19];

      v21 = [v9 emptyModelObjectWithChangeType:3];
      [v20 add:v21 withMessage:v4];

      [v20 run];
      goto LABEL_18;
    }

    v26 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:43 userInfo:0];
    v34 = [v4 responseHandler];
    v34[2](v34, v26, 0);

LABEL_17:
    goto LABEL_18;
  }

  v27 = objc_autoreleasePoolPush();
  v28 = self;
  v29 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
  {
    v30 = HMFGetLogIdentifier();
    v31 = [v5 UUIDString];
    *buf = 138543618;
    v38 = v30;
    v39 = 2112;
    v40 = v31;
    _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Invalid invite identifier specified %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v27);
  v32 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  v33 = [v4 responseHandler];
  (v33)[2](v33, v32, 0);

  v9 = 0;
LABEL_18:

  v35 = *MEMORY[0x277D85DE8];
}

- (BOOL)doesThisHomeHaveCameras
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_any:&__block_literal_global_1481];

  return v3;
}

uint64_t __34__HMDHome_doesThisHomeHaveCameras__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = v4;
  if (v4)
  {
    v6 = [v4 hasCameraStreamService];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)_sendInvitation:(id)a3 message:(id)a4 shareURL:(id)a5 shareToken:(id)a6 suppressHomeInviteNotification:(BOOL)a7 logEventBuilder:(id)a8
{
  v62 = a7;
  v100[2] = *MEMORY[0x277D85DE8];
  v13 = a3;
  v14 = a4;
  v15 = a5;
  v16 = a6;
  v17 = a8;
  val = v13;
  v18 = [v13 user];
  v19 = [v18 accountHandle];

  v20 = [v13 identifier];
  v21 = [v13 endDate];
  objc_initWeak(&location, self);
  v22 = [v13 expirationHandler];
  v23 = v22 == 0;

  if (v23)
  {
    v24 = [(HMDHome *)self workQueue];
    [v13 setClientQueue:v24];

    objc_initWeak(from, v13);
    v82[0] = MEMORY[0x277D85DD0];
    v82[1] = 3221225472;
    v82[2] = __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke;
    v82[3] = &unk_279733938;
    objc_copyWeak(&v84, &location);
    objc_copyWeak(&v85, from);
    v83 = v14;
    [v13 setExpirationHandler:v82];

    objc_destroyWeak(&v85);
    objc_destroyWeak(&v84);
    objc_destroyWeak(from);
  }

  [v17 markSendInviteBegin];
  v25 = [v13 user];
  v75[0] = MEMORY[0x277D85DD0];
  v75[1] = 3221225472;
  v76 = __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke_1478;
  v77 = &unk_27972F820;
  objc_copyWeak(&v81, &location);
  v78 = v19;
  v64 = v17;
  v79 = v64;
  v63 = v14;
  v80 = v63;
  v26 = v78;
  v71 = v20;
  v72 = v21;
  v67 = v15;
  v68 = v16;
  v73 = v25;
  v69 = v75;
  if (self)
  {
    v27 = objc_autoreleasePoolPush();
    v28 = self;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
    {
      v30 = HMFGetLogIdentifier();
      *from = 138543874;
      *&from[4] = v30;
      *&from[12] = 2112;
      *&from[14] = v26;
      *&from[22] = 2112;
      v94 = v73;
      _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_INFO, "%{public}@Sending invite to: %@ for user: %@", from, 0x20u);
    }

    objc_autoreleasePoolPop(v27);
    v70 = [(HMDHome *)v28 homeManager];
    v31 = [v70 appleAccountManager];
    v32 = [v31 account];
    v33 = [v32 handles];
    v34 = [v33 containsObject:v26];

    if (v34)
    {
      v35 = objc_autoreleasePoolPush();
      v36 = v28;
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_DEFAULT))
      {
        v38 = HMFGetLogIdentifier();
        *from = 138543618;
        *&from[4] = v38;
        *&from[12] = 2112;
        *&from[14] = v26;
        _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_DEFAULT, "%{public}@Attempt to add local user: %@", from, 0x16u);
      }

      objc_autoreleasePoolPop(v35);
      v66 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      v76(v69, v66);
    }

    else
    {
      v39 = [(HMDHome *)v28 keychainStore];
      v91 = 0;
      v65 = [v39 getLocalPairingIdentity:&v91];
      v66 = v91;

      if (v65)
      {
        v99[0] = @"kHomedVersionKey";
        v40 = homedVersion;
        v99[1] = @"kHomedSupportedFeaturesKey";
        v100[0] = v40;
        v100[1] = &unk_286626C50;
        v60 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v100 forKeys:v99 count:2];

        v92[0] = *MEMORY[0x277CD23D0];
        v61 = [(HMDHome *)v28 name];
        *from = v61;
        v92[1] = *MEMORY[0x277CD0640];
        v41 = [(HMDHome *)v28 uuid];
        v42 = [v41 UUIDString];
        *&from[8] = v42;
        *&from[16] = v72;
        v92[2] = @"kInvitationExpiryDateKey";
        v92[3] = @"kControllerPublicKey";
        v43 = [v65 publicKey];
        v44 = [v43 data];
        v94 = v44;
        v92[4] = @"kControllerPairingNameKey";
        v45 = [v65 identifier];
        v95 = v45;
        v92[5] = @"kInvitationIdentifierKey";
        v46 = [v71 UUIDString];
        v96 = v46;
        v97 = v60;
        v92[6] = @"kRequestedCapabilitiesKey";
        v92[7] = @"HMDHomeSuppressInviteNotificationKey";
        v47 = [MEMORY[0x277CCABB0] numberWithBool:v62];
        v98 = v47;
        v48 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:from forKeys:v92 count:8];

        v49 = [HMDRemoteAccountMessageDestination alloc];
        v50 = objc_alloc(MEMORY[0x277CCAD78]);
        v51 = [v50 initWithUUIDString:*MEMORY[0x277CD23C8]];
        v52 = [(HMDRemoteAccountMessageDestination *)v49 initWithTarget:v51 handle:v26 multicast:1];

        v53 = [MEMORY[0x277D0F848] messageWithName:@"kAccessHomeInviteRequestKey" destination:v52 payload:v48];
        objc_initWeak(&v90, v28);
        v87[0] = MEMORY[0x277D85DD0];
        v87[1] = 3221225472;
        v87[2] = __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke;
        v87[3] = &unk_279735248;
        v87[4] = v28;
        v88 = v26;
        objc_copyWeak(&v89, &v90);
        [v53 setResponseHandler:v87];
        v54 = +[HMDSecureRemoteMessageTransport defaultTransport];
        [v54 sendMessage:v53 completionHandler:v69];

        objc_destroyWeak(&v89);
        objc_destroyWeak(&v90);
      }

      else
      {
        v55 = objc_autoreleasePoolPush();
        v56 = v28;
        v57 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v57, OS_LOG_TYPE_ERROR))
        {
          v58 = HMFGetLogIdentifier();
          *from = 138543362;
          *&from[4] = v58;
          _os_log_impl(&dword_2531F8000, v57, OS_LOG_TYPE_ERROR, "%{public}@Failed to get local identity", from, 0xCu);
        }

        objc_autoreleasePoolPop(v55);
        v76(v69, v66);
      }
    }
  }

  objc_destroyWeak(&v81);
  objc_destroyWeak(&location);

  v59 = *MEMORY[0x277D85DE8];
}

void __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke(id *a1)
{
  v15 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 5);
  v3 = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = WeakRetained;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [v3 identifier];
      v11 = 138543618;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Expiring invitation %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [v3 updateInvitationState:{objc_msgSend(v3, "invitationState")}];
    v9 = [a1[4] name];
    [v5 saveWithReason:v9 postSyncNotification:0];
  }

  v10 = *MEMORY[0x277D85DE8];
}

void __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke_1478(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v3)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 32);
      v18 = 138543874;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v3;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to send invite to user, %@, with error: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = *(a1 + 40);
    v12 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3503 underlyingError:v3];
    [v11 markError:v12];
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 32);
      v18 = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Successfully sent invite to user: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 40) markSendInviteEnd];
  }

  v15 = [*(a1 + 48) responseHandler];

  if (v15)
  {
    v16 = [*(a1 + 48) responseHandler];
    (v16)[2](v16, v3, 0);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = *(a1 + 40);
    v25 = 138543618;
    v26 = v10;
    v27 = 2112;
    v28 = v11;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Attempting to send home invitation: %@", &v25, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (v5 && [v5 code] != 8)
  {
    v13 = objc_autoreleasePoolPush();
    v22 = WeakRetained;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = HMFGetLogIdentifier();
      v23 = *(a1 + 40);
      v25 = 138543874;
      v26 = v16;
      v27 = 2112;
      v28 = v23;
      v29 = 2112;
      v30 = v5;
      v18 = "%{public}@Failed to send invitation request to user, %@, due to error: %@";
      v19 = v15;
      v20 = OS_LOG_TYPE_DEFAULT;
      v21 = 32;
      goto LABEL_9;
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = WeakRetained;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = *(a1 + 40);
      v25 = 138543618;
      v26 = v16;
      v27 = 2112;
      v28 = v17;
      v18 = "%{public}@Successfully sent invitation to: %@";
      v19 = v15;
      v20 = OS_LOG_TYPE_INFO;
      v21 = 22;
LABEL_9:
      _os_log_impl(&dword_2531F8000, v19, v20, v18, &v25, v21);
    }
  }

  objc_autoreleasePoolPop(v13);
  v24 = *MEMORY[0x277D85DE8];
}

- (void)_addOutgoingInvitations:(id)a3 message:(id)a4 transactionCompleted:(id)a5
{
  v33 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self backingStore];
  v12 = [v9 name];
  v13 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v14 = [v11 transaction:v12 options:v13];

  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v29 = 0u;
  v15 = v8;
  v16 = [v15 countByEnumeratingWithState:&v28 objects:v32 count:16];
  if (v16)
  {
    v17 = v16;
    v18 = *v29;
    do
    {
      for (i = 0; i != v17; ++i)
      {
        if (*v29 != v18)
        {
          objc_enumerationMutation(v15);
        }

        v20 = *(*(&v28 + 1) + 8 * i);
        [v20 setHome:self];
        v21 = [v20 modelObjectWithChangeType:1 version:4];
        [v14 add:v21 withMessage:v9];
      }

      v17 = [v15 countByEnumeratingWithState:&v28 objects:v32 count:16];
    }

    while (v17);
  }

  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __64__HMDHome__addOutgoingInvitations_message_transactionCompleted___block_invoke;
  v25[3] = &unk_279733F30;
  v26 = v9;
  v27 = v10;
  v22 = v9;
  v23 = v10;
  [v14 run:v25];

  v24 = *MEMORY[0x277D85DE8];
}

uint64_t __64__HMDHome__addOutgoingInvitations_message_transactionCompleted___block_invoke(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  v3 = v2;
  if (v2)
  {
    (*(v2 + 2))(v2);
  }

  v4 = *(a1 + 32);

  return [v4 respondWithPayload:0];
}

- (id)_outgoingInvitationForUserWithHandle:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [(HMDHome *)self outgoingInvitations];
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        v10 = [v9 user];
        v11 = [v10 accountHandle];
        v12 = [v11 isEqual:v4];

        if (v12)
        {
          v6 = v9;
          goto LABEL_11;
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)_processOutgoingInvitationsRequest:(id)a3
{
  v41[2] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dataForKey:@"HM.invitations"];
  if (v5)
  {
    v6 = MEMORY[0x277CCAAC8];
    v7 = MEMORY[0x277CBEB98];
    v41[0] = objc_opt_class();
    v41[1] = objc_opt_class();
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v41 count:2];
    v9 = [v7 setWithArray:v8];
    v34 = 0;
    v10 = [v6 unarchivedObjectOfClasses:v9 fromData:v5 error:&v34];
    v11 = v34;

    if (v10)
    {
      v30[0] = MEMORY[0x277D85DD0];
      v30[1] = 3221225472;
      v30[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke;
      v30[3] = &unk_279734960;
      v31 = v4;
      v32 = self;
      v33 = v10;
      v12 = _Block_copy(v30);
      v12[2](v12, v13, v14, v15);

      v16 = v31;
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      v24 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        v26 = HMFGetLogIdentifier();
        v27 = [v4 identifier];
        v28 = [v27 UUIDString];
        *buf = 138543874;
        v36 = v26;
        v37 = 2112;
        v38 = v28;
        v39 = 2112;
        v40 = v11;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_INFO, "%{public}@Failed to unarchive outgoing home invitations from serialized outgoing home invitation data: %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v23);
      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      [v4 respondWithError:v16];
    }
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      v21 = [v4 identifier];
      v22 = [v21 UUIDString];
      *buf = 138543618;
      v36 = v20;
      v37 = 2112;
      v38 = v22;
      _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Unable to find outgoing invitations to add for message: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
    v11 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    [v4 respondWithError:v11];
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__processOutgoingInvitationsRequest___block_invoke(id *a1)
{
  v2 = [a1[4] BOOLForKey:@"HMDHomeSuppressInviteNotificationKey"];
  objc_initWeak(&location, a1[5]);
  v4 = a1[5];
  v3 = a1[6];
  v5 = a1[4];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_2;
  v6[3] = &unk_27972F5B0;
  objc_copyWeak(&v8, &location);
  v7 = a1[6];
  v9 = v2;
  [v4 _addOutgoingInvitations:v3 message:v5 transactionCompleted:v6];

  objc_destroyWeak(&v8);
  objc_destroyWeak(&location);
}

void __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_3;
  block[3] = &unk_279734938;
  block[4] = WeakRetained;
  v5 = *(a1 + 32);
  v6 = *(a1 + 48);
  dispatch_async(v3, block);
}

- (void)setOverriddenHomeAccessControl:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  overriddenHomeAccessControl = self->_overriddenHomeAccessControl;
  self->_overriddenHomeAccessControl = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSNumber)overriddenHomeAccessControl
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_overriddenHomeAccessControl;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)handleCurrentUserPrivilegeChanged:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __45__HMDHome_handleCurrentUserPrivilegeChanged___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v4, block);
}

uint64_t __45__HMDHome_handleCurrentUserPrivilegeChanged___block_invoke(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 32);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 32) currentUser];
      v7 = [v6 privilege];
      if (v7 > 4)
      {
        v8 = @"None";
      }

      else
      {
        v8 = off_279730DF8[v7];
      }

      v9 = v8;
      v10 = [*(a1 + 32) fabric];
      v11 = [v10 accessControl];
      [v11 currentUserPrivilege];
      v12 = HMMTRUserPrivilegeAsString();
      v19 = 138543874;
      v20 = v5;
      v21 = 2112;
      v22 = v9;
      v23 = 2112;
      v24 = v12;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Updating Fabric user privilege to %@ from priv %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
    v13 = [*(a1 + 32) currentUser];
    v14 = +[HMDUser hmmtrUserPrivilegeFromHMDUserPrivilege:](HMDUser, "hmmtrUserPrivilegeFromHMDUserPrivilege:", [v13 privilege]);
    v15 = [*(a1 + 32) fabric];
    v16 = [v15 accessControl];
    [v16 setCurrentUserPrivilege:v14];
  }

  result = [*(a1 + 32) _evaluateNetworkProtectionAndRouterManagement];
  v18 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)removeRemovedUser:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_removedUsers removeObject:v4];
  os_unfair_recursive_lock_unlock();
}

- (BOOL)containsRemovedUser:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v5 = [(HMDHome *)self removedUsers];
  v6 = [v5 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v6)
  {
    v7 = *v12;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(v5);
        }

        if ([*(*(&v11 + 1) + 8 * i) isEqualToUser:v4])
        {
          LOBYTE(v6) = 1;
          goto LABEL_11;
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v9 = *MEMORY[0x277D85DE8];
  return v6;
}

- (void)_refreshUserDisplayNames
{
  v49 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB58] set];
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v34 = self;
  v4 = [(HMDHome *)self outgoingInvitations];
  v5 = [v4 countByEnumeratingWithState:&v39 objects:v48 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v40;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v40 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v39 + 1) + 8 * i);
        if ([v9 refreshDisplayName])
        {
          if (isInternalBuild())
          {
            v10 = MEMORY[0x277CCACA8];
            v11 = [v9 uuid];
            v12 = [v10 stringWithFormat:@"OutgoingInviteDisplayNameUpdate_%@", v11];
            [v3 addObject:v12];
          }

          else
          {
            [v3 addObject:@"OutgoingInviteDisplayNameUpdate"];
          }
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v39 objects:v48 count:16];
    }

    while (v6);
  }

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v13 = [(HMDHome *)v34 users];
  v14 = [v13 countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v36;
    do
    {
      for (j = 0; j != v15; ++j)
      {
        if (*v36 != v16)
        {
          objc_enumerationMutation(v13);
        }

        v18 = *(*(&v35 + 1) + 8 * j);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (!v20 && [v18 refreshDisplayName])
        {
          if (isInternalBuild())
          {
            v21 = MEMORY[0x277CCACA8];
            v22 = [v18 uuid];
            v23 = [v21 stringWithFormat:@"UserDisplayNameUpdate_%@", v22];
            [v3 addObject:v23];
          }

          else
          {
            [v3 addObject:@"UserDisplayNameUpdate"];
          }
        }
      }

      v15 = [v13 countByEnumeratingWithState:&v35 objects:v47 count:16];
    }

    while (v15);
  }

  if ([v3 count])
  {
    v24 = objc_autoreleasePoolPush();
    v25 = v34;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [v3 allObjects];
      v29 = [v28 componentsJoinedByString:{@", "}];
      *buf = 138543618;
      v44 = v27;
      v45 = 2112;
      v46 = v29;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@User display names updated: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    [(HMDHome *)v25 saveToCurrentAccountWithReason:@"userDisplayNameUpdated"];
    v30 = [(HMDHome *)v25 home];
    v31 = [v30 homeManager];
    v32 = [(HMDHome *)v25 uuid];
    [v31 updateGenerationCounterWithReason:@"userDisplayNameUpdated" sourceUUID:v32 shouldNotifyClients:1];
  }

  v33 = *MEMORY[0x277D85DE8];
}

- (void)refreshUserDisplayNames
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __34__HMDHome_refreshUserDisplayNames__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)_addUserToContainer:(id)a3
{
  v11[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  [(HMDHome *)self addUser:v4];
  v5 = [(HMDHome *)self presenceMonitor];
  [v5 addNewUser:v4];

  v6 = [(HMDHome *)self notificationCenter];
  v10 = @"HMDUserNotificationKey";
  v11[0] = v4;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v11 forKeys:&v10 count:1];

  [v6 postNotificationName:@"HMDHomeUserAddedNotification" object:self userInfo:v7];
  if ([(HMDHome *)self isOwnerUser])
  {
    v8 = [(HMDHome *)self homeManager];
    [v8 setLastUserAddRemoveTimestamp];
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_removeUserFromContainer:(id)a3
{
  v11[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self presenceMonitor];
  [v5 removeUser:v4];

  [v4 removeCloudData];
  [(HMDHome *)self _removeUser:v4];
  [v4 unconfigure];
  v6 = [(HMDHome *)self notificationCenter];
  v10 = @"HMDUserNotificationKey";
  v11[0] = v4;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v11 forKeys:&v10 count:1];

  [v6 postNotificationName:@"HMDHomeUserRemovedNotification" object:self userInfo:v7];
  if ([(HMDHome *)self isOwnerUser])
  {
    v8 = [(HMDHome *)self homeManager];
    [v8 setLastUserAddRemoveTimestamp];
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_removeUser:(id)a3 message:(id)a4
{
  v87 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = a4;
  if (shouldLogPrivateInformation())
  {
    v54 = [v5 userID];
  }

  else
  {
    v54 = @"...";
    v7 = @"...";
  }

  v8 = [v5 pairingIdentity];

  if (v8)
  {
    v9 = [(HMDHome *)self homeManager];
    if (isFeatureMatterLocalFabricConfigEnabled() && (![v5 privilege] || objc_msgSend(v5, "privilege") == 4))
    {
      v75[0] = MEMORY[0x277D85DD0];
      v75[1] = 3221225472;
      v75[2] = __31__HMDHome__removeUser_message___block_invoke;
      v75[3] = &unk_279731240;
      v75[4] = self;
      [(HMDHome *)self incrementOperatePrivilegeCATVersion:v75];
    }

    v10 = [v9 backingStore];
    v11 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v55 = [v10 transaction:@"kUserManagementOperationAddedKey" options:v11];

    v12 = [(HMDHome *)self accessories];
    v74 = 0;
    v13 = [(HMDHome *)self prepareUserManagementOperationForUser:v5 accessories:v12 type:2 error:&v74];
    v14 = v74;

    v52 = v13;
    v53 = v14;
    if (v14)
    {
      v15 = objc_autoreleasePoolPush();
      v16 = self;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        v18 = HMFGetLogIdentifier();
        v19 = objc_opt_class();
        v62 = v19;
        [(HMDHome *)v16 name];
        v21 = v20 = v9;
        *buf = 138544386;
        v78 = v18;
        v79 = 2112;
        v80 = v19;
        v81 = 2112;
        v82 = v21;
        v83 = 2112;
        v84 = v54;
        v85 = 2112;
        v86 = v53;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@[%@ %@] Failed to prepare remove operations for user '%@' with error: %@", buf, 0x34u);

        v9 = v20;
      }

      objc_autoreleasePoolPop(v15);
      v22 = [v6 responseHandler];
      v23 = v53;
      (v22)[2](v22, v53, 0);
      v24 = v55;
    }

    else
    {
      v50 = v6;
      v51 = v5;
      v29 = [(HMDHome *)self owner];
      v22 = [v29 pairingIdentity];

      group = dispatch_group_create();
      v70 = 0u;
      v71 = 0u;
      v72 = 0u;
      v73 = 0u;
      obj = v13;
      v24 = v55;
      v30 = self;
      v61 = [obj countByEnumeratingWithState:&v70 objects:v76 count:16];
      if (v61)
      {
        v58 = *v71;
        v59 = v22;
        do
        {
          for (i = 0; i != v61; ++i)
          {
            if (*v71 != v58)
            {
              objc_enumerationMutation(obj);
            }

            v32 = *(*(&v70 + 1) + 8 * i);
            if (shouldLogPrivateInformation())
            {
              v33 = [v32 user];
              v63 = [v33 userID];
            }

            else
            {
              v34 = @"...";
              v63 = @"...";
            }

            v35 = objc_autoreleasePoolPush();
            v36 = v30;
            v37 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
            {
              v38 = HMFGetLogIdentifier();
              [v32 identifier];
              v40 = v39 = v9;
              v41 = [v32 accessory];
              v42 = [v41 shortDescription];
              *buf = 138544130;
              v78 = v38;
              v79 = 2112;
              v80 = v40;
              v81 = 2112;
              v82 = v63;
              v83 = 2112;
              v84 = v42;
              _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@Adding operation '%@' to manager tracking remove user '%@' from accessory '%@'", buf, 0x2Au);

              v30 = self;
              v9 = v39;
              v24 = v55;
            }

            objc_autoreleasePoolPop(v35);
            dispatch_group_enter(group);
            v43 = [v32 accessory];
            v44 = [v43 identifier];
            v45 = [v32 user];
            v46 = [v45 pairingIdentity];
            v68[0] = MEMORY[0x277D85DD0];
            v68[1] = 3221225472;
            v68[2] = __31__HMDHome__removeUser_message___block_invoke_1460;
            v68[3] = &unk_2797359D8;
            v69 = group;
            [v9 cleanupOperationsForAccessory:v44 user:v46 completion:v68];

            v22 = v59;
            [v32 setOwnerPairingIdentity:v59];
            v47 = [v32 modelObjectWithChangeType:1];
            [v24 add:v47];
          }

          v61 = [obj countByEnumeratingWithState:&v70 objects:v76 count:16];
        }

        while (v61);
      }

      v48 = [(HMDHome *)v30 workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __31__HMDHome__removeUser_message___block_invoke_2;
      block[3] = &unk_279734870;
      block[4] = v30;
      v65 = v24;
      v5 = v51;
      v66 = v51;
      v6 = v50;
      v67 = v50;
      dispatch_group_notify(group, v48, block);

      v23 = 0;
    }

    goto LABEL_31;
  }

  v25 = objc_autoreleasePoolPush();
  v26 = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
  {
    v28 = HMFGetLogIdentifier();
    *buf = 138543618;
    v78 = v28;
    v79 = 2112;
    v80 = v54;
    _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve user with name: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v25);
  if (v6)
  {
    v9 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    v24 = [v6 responseHandler];
    (v24)[2](v24, v9, 0);
LABEL_31:
  }

  v49 = *MEMORY[0x277D85DE8];
}

void __31__HMDHome__removeUser_message___block_invoke_2(uint64_t a1)
{
  objc_initWeak(&location, *(a1 + 32));
  v2 = *(a1 + 40);
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __31__HMDHome__removeUser_message___block_invoke_3;
  v3[3] = &unk_279731988;
  objc_copyWeak(&v6, &location);
  v4 = *(a1 + 48);
  v5 = *(a1 + 56);
  [v2 run:v3];

  objc_destroyWeak(&v6);
  objc_destroyWeak(&location);
}

void __31__HMDHome__removeUser_message___block_invoke_3(id *a1, void *a2)
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v27 = v3;
    v6 = [WeakRetained backingStore];
    v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v8 = [v6 transaction:@"kRemoveUserRequestKey" options:v7];

    v9 = [v5 __modelObjectsForRemovingOutgoingInvitationForUser:a1[4]];
    [v8 addObjects:v9];

    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    v10 = [v5 triggers];
    v11 = [v10 countByEnumeratingWithState:&v30 objects:v34 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v31;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v31 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v30 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v16 = v15;
          }

          else
          {
            v16 = 0;
          }

          v17 = v16;

          [v17 handleRemovalOfUser:a1[4] transaction:v8];
        }

        v12 = [v10 countByEnumeratingWithState:&v30 objects:v34 count:16];
      }

      while (v12);
    }

    v18 = [HMDUserModel alloc];
    v19 = [a1[4] uuid];
    v20 = [v5 uuid];
    v21 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:3 uuid:v19 parentUUID:v20];

    [v8 add:v21];
    v28[0] = MEMORY[0x277D85DD0];
    v28[1] = 3221225472;
    v28[2] = __31__HMDHome__removeUser_message___block_invoke_1462;
    v28[3] = &unk_2797358C8;
    v28[4] = v5;
    v29 = a1[5];
    [v8 run:v28];

    v3 = v27;
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      v25 = a1[4];
      *buf = 138543618;
      v36 = v24;
      v37 = 2112;
      v38 = v25;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Home disappeared, cannot remove user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v26 = *MEMORY[0x277D85DE8];
}

void __31__HMDHome__removeUser_message___block_invoke_1462(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit removeUser transaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  [*(a1 + 40) respondWithPayload:0 error:v3];

  v8 = *MEMORY[0x277D85DE8];
}

- (id)__modelObjectsForRemovingOutgoingInvitationForUser:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4)
  {
    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    v5 = [(HMDHome *)self outgoingInvitations];
    v6 = [v5 countByEnumeratingWithState:&v25 objects:v29 count:16];
    if (v6)
    {
      v7 = v6;
      v24 = self;
      v8 = *v26;
LABEL_4:
      v9 = 0;
      while (1)
      {
        if (*v26 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v25 + 1) + 8 * v9);
        v11 = [v10 user];
        if (v11)
        {
          v12 = [v4 userID];
          v13 = [v11 userID];
          v14 = [v12 isEqualToString:v13];

          if (v14)
          {
            break;
          }
        }

        if (v7 == ++v9)
        {
          v7 = [v5 countByEnumeratingWithState:&v25 objects:v29 count:16];
          if (v7)
          {
            goto LABEL_4;
          }

          goto LABEL_11;
        }
      }

      v16 = v10;

      if (!v16)
      {
        goto LABEL_15;
      }

      v17 = [MEMORY[0x277CBEB18] arrayWithCapacity:2];
      v18 = [HMDOutgoingHomeInvitationModel alloc];
      v19 = [v16 identifier];
      v20 = [(HMDHome *)v24 uuid];
      v21 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:3 uuid:v19 parentUUID:v20];

      [v17 addObject:v21];
      v15 = [v17 copy];

      v5 = v16;
    }

    else
    {
LABEL_11:
      v15 = MEMORY[0x277CBEBF8];
    }
  }

  else
  {
LABEL_15:
    v15 = MEMORY[0x277CBEBF8];
  }

  v22 = *MEMORY[0x277D85DE8];

  return v15;
}

- (void)_removeOutgoingInvitationForUser:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self __modelObjectsForRemovingOutgoingInvitationForUser:v4];
  if (([v5 hmf_isEmpty] & 1) == 0)
  {
    v6 = [(HMDHome *)self backingStore];
    v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v8 = [v6 transaction:@"removeOutgoingInvitation" options:v7];

    [v8 addObjects:v5];
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __44__HMDHome__removeOutgoingInvitationForUser___block_invoke;
    v9[3] = &unk_279734D88;
    v9[4] = self;
    v10 = v4;
    v11 = v5;
    [v8 run:v9];
  }
}

void __44__HMDHome__removeOutgoingInvitationForUser___block_invoke(uint64_t a1, void *a2)
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 40);
      v9 = *(a1 + 48);
      v11 = 138544130;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      v15 = 2112;
      v16 = v9;
      v17 = 2112;
      v18 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to run transaction to remove the invitation for the user: %@ / %@ / %@", &v11, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)removeUser:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v13 = v8;
    v14 = 2112;
    v15 = v4;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to remove user: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __22__HMDHome_removeUser___block_invoke;
  v11[3] = &unk_279734E00;
  v11[4] = v6;
  v9 = [MEMORY[0x277D0F818] messageWithName:@"kDataSyncResponseNAckKey" messagePayload:0 responseHandler:v11];
  [(HMDHome *)v6 _removeUser:v4 message:v9];

  v10 = *MEMORY[0x277D85DE8];
}

void __22__HMDHome_removeUser___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v10;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Failed to remove user due to %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)removeUserWithUserID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __32__HMDHome_removeUserWithUserID___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __32__HMDHome_removeUserWithUserID___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) users];
  v4 = [v2 hmf_firstObjectWithValue:*(a1 + 40) forKeyPath:@"userID"];

  v3 = v4;
  if (v4)
  {
    [*(a1 + 32) removeUser:v4];
    v3 = v4;
  }
}

- (void)_handleRemoveUser:(id)a3
{
  v33 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(v4, "isRemote"))
  {
    v5 = [v4 uuidForKey:@"kUserUUIDKey"];
    if (!v5)
    {
      v18 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
      v19 = [v4 responseHandler];
      (v19)[2](v19, v18, 0);

      v6 = 0;
LABEL_20:

      goto LABEL_21;
    }

    v6 = v5;
    v7 = [(HMDHome *)self users];
    v8 = [v7 hmf_firstObjectWithUUID:v6];

    if (v8)
    {
      v9 = [v8 isOwner];
      v10 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      v13 = v12;
      if (!v9)
      {
        if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
        {
          v27 = HMFGetLogIdentifier();
          v29 = 138543618;
          v30 = v27;
          v31 = 2112;
          v32 = v8;
          _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEFAULT, "%{public}@Removing user: %@", &v29, 0x16u);
        }

        objc_autoreleasePoolPop(v10);
        [(HMDHome *)v11 _removeUser:v8 message:v4];
        goto LABEL_19;
      }

      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v29 = 138543362;
        v30 = v14;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Owner cannot be removed from home", &v29, 0xCu);
      }

      objc_autoreleasePoolPop(v10);
      v15 = MEMORY[0x277CCA9B8];
      v16 = *MEMORY[0x277CCFD28];
      v17 = 17;
    }

    else
    {
      v15 = MEMORY[0x277CCA9B8];
      v16 = *MEMORY[0x277CCFD28];
      v17 = 2;
    }

    v25 = [v15 errorWithDomain:v16 code:v17 userInfo:0];
    v26 = [v4 responseHandler];
    (v26)[2](v26, v25, 0);

LABEL_19:
    goto LABEL_20;
  }

  v20 = objc_autoreleasePoolPush();
  v21 = self;
  v22 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
  {
    v23 = HMFGetLogIdentifier();
    v29 = 138543362;
    v30 = v23;
    _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@User management (remove) not supported for non-SPI clients", &v29, 0xCu);
  }

  objc_autoreleasePoolPop(v20);
  v24 = [v4 responseHandler];

  if (v24)
  {
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    v8 = [v4 responseHandler];
    (v8)[2](v8, v6, 0);
    goto LABEL_19;
  }

LABEL_21:

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdatePresenceConsent:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277CD1F00] authWithMessage:v4];
  if (!v5)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v37 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Received nil presence auth", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v16 = [v4 responseHandler];
    v17 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
    goto LABEL_15;
  }

  v6 = [(HMDHome *)self presenceAuthStatus];
  v7 = HMFEqualObjects();

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v11;
      v38 = 2112;
      v39 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Presence auth status is already set to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
LABEL_14:
    v16 = [v4 responseHandler];
    v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
LABEL_15:
    v26 = v17;
    (*&v16->super._bsoDataVersionOverride)(v16, v17, 0);
    goto LABEL_16;
  }

  if (([v5 value] - 1) < 2)
  {
    v18 = [HMDHomeModel alloc];
    v19 = [(HMDHome *)self uuid];
    v20 = [(HMDHome *)self homeManager];
    v21 = [v20 uuid];
    v16 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:2 uuid:v19 parentUUID:v21];

    v22 = [v5 number];
    [(HMDHomeModel *)v16 setPresenceAuthorizationStatus:v22];

    v23 = [(HMDHome *)self backingStore];
    v24 = [v4 name];
    v25 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v26 = [v23 transaction:v24 options:v25];

    [v26 add:v16];
    v33[0] = MEMORY[0x277D85DD0];
    v33[1] = 3221225472;
    v33[2] = __40__HMDHome__handleUpdatePresenceConsent___block_invoke;
    v33[3] = &unk_2797358C8;
    v34 = v4;
    v35 = self;
    [v26 run:v33];

LABEL_16:
    goto LABEL_17;
  }

  v27 = objc_autoreleasePoolPush();
  v28 = self;
  v29 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
  {
    v30 = HMFGetLogIdentifier();
    *buf = 138543618;
    v37 = v30;
    v38 = 2112;
    v39 = v5;
    _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Received invalid parameter for presence authorization: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v27);
  v31 = [v4 responseHandler];

  if (v31)
  {
    goto LABEL_14;
  }

LABEL_17:

  v32 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome__handleUpdatePresenceConsent___block_invoke(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v8 = [MEMORY[0x277CBEB38] dictionary];
    v4 = [*(a1 + 40) currentUser];
    v5 = [v4 presenceAuthStatus];
    [v5 addToPayload:v8];

    v6 = *(a1 + 32);
    v7 = [v8 copy];
    [v6 respondWithPayload:v7];
  }
}

- (void)_handleUpdateUserAnnounceAccess:(id)a3
{
  v35 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(v4, "isRemote"))
  {
    v5 = [v4 stringForKey:@"kUserIDKey"];
    v6 = [(HMDHome *)self users];
    v7 = [v6 hmf_firstObjectWithValue:v5 forKeyPath:@"userID"];

    if (v7)
    {
      v8 = [(HMDHome *)self currentUser];
      if ([v8 isAdministrator])
      {
        v9 = [v7 newModelWithChangeType:2];
        v10 = [v4 numberForKey:*MEMORY[0x277CD06A0]];
        if (v10)
        {
          [v9 setAnnounceAccessAllowed:v10];
          if ([v10 BOOLValue])
          {
            v11 = &unk_286627850;
          }

          else
          {
            v11 = &unk_286627868;
          }

          [v9 setAnnounceAccessLevel:v11];
        }

        v12 = [(HMDHome *)self backingStore];
        v13 = [v4 name];
        v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v15 = [v12 transaction:v13 options:v14];

        [v15 add:v9 withMessage:v4];
        [v15 run];

        goto LABEL_21;
      }

      v25 = objc_autoreleasePoolPush();
      v26 = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        v31 = 138543618;
        v32 = v28;
        v33 = 2112;
        v34 = v8;
        _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Current user is not an administrator, cannot modify access: %@", &v31, 0x16u);
      }

      objc_autoreleasePoolPop(v25);
      v20 = [v4 responseHandler];
      v29 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
      (v20)[2](v20, v29, 0);
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        v31 = 138543618;
        v32 = v19;
        v33 = 2112;
        v34 = v5;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", &v31, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      v8 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      v20 = [v4 responseHandler];
      (v20)[2](v20, v8, 0);
    }

LABEL_21:
    goto LABEL_22;
  }

  v21 = objc_autoreleasePoolPush();
  v22 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    v31 = 138543362;
    v32 = v24;
    _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to update users to home", &v31, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  v5 = [v4 responseHandler];
  v7 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
  (v5)[2](v5, v7, 0);
LABEL_22:

  v30 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateUserAccess:(id)a3
{
  v62 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(v4, "isRemote"))
  {
    v5 = [v4 stringForKey:@"kUserIDKey"];
    v6 = [(HMDHome *)self users];
    v7 = [v6 hmf_firstObjectWithValue:v5 forKeyPath:@"userID"];

    if (!v7)
    {
      v15 = objc_autoreleasePoolPush();
      v16 = self;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v18;
        v58 = 2112;
        v59 = v5;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
      v12 = MEMORY[0x277CCA9B8];
      v13 = *MEMORY[0x277CCFD28];
      v14 = 2;
      goto LABEL_11;
    }

    if ([v7 isOwner])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v11;
        v58 = 2112;
        v59 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot modify the owner of the home: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      v12 = MEMORY[0x277CCA9B8];
      v13 = *MEMORY[0x277CCFD28];
      v14 = 17;
LABEL_11:
      v19 = [v12 errorWithDomain:v13 code:v14 userInfo:0];
      v20 = [v4 responseHandler];
      (v20)[2](v20, v19, 0);
LABEL_42:

      goto LABEL_43;
    }

    v19 = [(HMDHome *)self currentUser];
    if (([v19 isAdministrator] & 1) == 0)
    {
      v34 = objc_autoreleasePoolPush();
      v35 = self;
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
      {
        v37 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v37;
        v58 = 2112;
        v59 = v19;
        _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_ERROR, "%{public}@Current user is not an administrator, cannot modify access: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v34);
      v20 = [v4 responseHandler];
      v26 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
      (v20)[2](v20, v26, 0);
      goto LABEL_41;
    }

    v20 = [v7 newModelWithChangeType:2];
    v25 = [v4 numberForKey:@"kUserAdministratorInformationKey"];
    v26 = v25;
    if (!v25)
    {
      goto LABEL_25;
    }

    v27 = [v25 BOOLValue];
    if (v27 && ![(HMDHome *)self isResidentSupported])
    {
      v38 = objc_autoreleasePoolPush();
      v39 = self;
      v40 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
      {
        v41 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v41;
        v58 = 2112;
        v59 = v5;
        _os_log_impl(&dword_2531F8000, v40, OS_LOG_TYPE_INFO, "%{public}@Cannot update user %@ to administrator because it requires a resident", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v38);
      v42 = MEMORY[0x277CCA9B8];
      v43 = *MEMORY[0x277CCFD28];
      v44 = 48;
    }

    else
    {
      if (![v7 privilege] || objc_msgSend(v7, "privilege") == 4)
      {
        if (v27)
        {
          v28 = &unk_286627838;
        }

        else
        {
          v28 = &unk_286627808;
        }

        [v20 setPrivilege:v28];
        [v7 privilege];
LABEL_25:
        v51 = v26;
        v29 = [v4 numberForKey:@"kUserRemoteAccessInformationKey"];
        if (v29)
        {
          [v20 setRemoteAccessAllowed:v29];
        }

        v30 = [(HMDHome *)self backingStore];
        v31 = [v4 name];
        v32 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v33 = [v30 transaction:v31 options:v32];

        [v33 add:v20];
        v53[0] = MEMORY[0x277D85DD0];
        v53[1] = 3221225472;
        v53[2] = __35__HMDHome__handleUpdateUserAccess___block_invoke;
        v53[3] = &unk_2797358C8;
        v54 = v4;
        v55 = v7;
        [v33 run:v53];

        v26 = v51;
        goto LABEL_40;
      }

      v45 = objc_autoreleasePoolPush();
      v46 = self;
      v47 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v48 = v52 = v45;
        v49 = @"non-";
        *buf = 138543874;
        v57 = v48;
        v58 = 2112;
        if (v27)
        {
          v49 = &stru_286509E58;
        }

        v59 = v5;
        v60 = 2112;
        v61 = v49;
        _os_log_impl(&dword_2531F8000, v47, OS_LOG_TYPE_INFO, "%{public}@Failed to update user %@ to %@administrator", buf, 0x20u);

        v45 = v52;
      }

      objc_autoreleasePoolPop(v45);
      v42 = MEMORY[0x277CCA9B8];
      v43 = *MEMORY[0x277CCFD28];
      v44 = 10;
    }

    v29 = [v42 errorWithDomain:v43 code:v44 userInfo:0];
    v33 = [v4 responseHandler];
    (v33)[2](v33, v29, 0);
LABEL_40:

LABEL_41:
    goto LABEL_42;
  }

  v21 = objc_autoreleasePoolPush();
  v22 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    *buf = 138543362;
    v57 = v24;
    _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to update users to home", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  v5 = [v4 responseHandler];
  v7 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
  (v5)[2](v5, v7, 0);
LABEL_43:

  v50 = *MEMORY[0x277D85DE8];
}

void __35__HMDHome__handleUpdateUserAccess___block_invoke(uint64_t a1, uint64_t a2)
{
  v12[4] = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = *(a1 + 32);
    v4 = *MEMORY[0x277D85DE8];

    [v3 respondWithError:a2];
  }

  else
  {
    v11[0] = @"kUserAdministratorInformationKey";
    v5 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isAdministrator")}];
    v12[0] = v5;
    v11[1] = @"kUserRemoteAccessInformationKey";
    v6 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isRemoteAccessAllowed")}];
    v12[1] = v6;
    v11[2] = @"kUserCamerasAccessLevelInformationKey";
    v7 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(*(a1 + 40), "camerasAccessLevel")}];
    v12[2] = v7;
    v11[3] = *MEMORY[0x277CD06A0];
    v8 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isAnnounceAccessAllowed")}];
    v12[3] = v8;
    v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:v11 count:4];

    [*(a1 + 32) respondWithPayload:v9];
    v10 = *MEMORY[0x277D85DE8];
  }
}

- (void)_handleUpdateUserCamerasAccessLevel:(id)a3
{
  v53 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:@"kUserIDKey"];
  v6 = [(HMDHome *)self users];
  v7 = [v6 hmf_firstObjectWithValue:v5 forKeyPath:@"userID"];

  if (!v7)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543618;
      v48 = v17;
      v49 = 2112;
      v50 = v5;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v12 = MEMORY[0x277CCA9B8];
    v13 = 2;
    goto LABEL_9;
  }

  if (![v7 isOwner])
  {
    v18 = [v7 newModelWithChangeType:2];
    v19 = [v4 numberForKey:@"kUserCamerasAccessLevelInformationKey"];
    v20 = v19;
    if (v19)
    {
      v21 = [v19 integerValue];
      if (HMUserIsValidCameraAccessLevel())
      {
        v22 = [v7 camerasAccessLevel];
        v23 = objc_autoreleasePoolPush();
        v24 = self;
        v25 = HMFGetOSLogHandle();
        v26 = v25;
        if (v22 != v21)
        {
          if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
          {
            v39 = HMFGetLogIdentifier();
            v40 = HMUserCameraAccessLevelAsString();
            *buf = 138543874;
            v48 = v39;
            v49 = 2112;
            v50 = v40;
            v51 = 2112;
            v52 = v7;
            _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Updating cameras access level to %@ for user: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v23);
          [v18 setCamerasAccessLevel:v20];
          v41 = [(HMDHome *)v24 backingStore];
          v42 = [v4 name];
          v43 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v37 = [v41 transaction:v42 options:v43];

          [v37 add:v18];
          v44[0] = MEMORY[0x277D85DD0];
          v44[1] = 3221225472;
          v44[2] = __47__HMDHome__handleUpdateUserCamerasAccessLevel___block_invoke;
          v44[3] = &unk_2797358C8;
          v45 = v4;
          v46 = v20;
          [v37 run:v44];

          goto LABEL_24;
        }

        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          v27 = HMFGetLogIdentifier();
          v28 = HMUserCameraAccessLevelAsString();
          *buf = 138543618;
          v48 = v27;
          v49 = 2112;
          v50 = v28;
          _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Cameras access level: %@ already set", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
        v29 = MEMORY[0x277CCA9B8];
        v30 = 1;
LABEL_23:
        v37 = [v29 hmErrorWithCode:v30];
        [v4 respondWithError:v37];
LABEL_24:

        goto LABEL_25;
      }

      v31 = objc_autoreleasePoolPush();
      v32 = self;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543618;
        v48 = v36;
        v49 = 2048;
        v50 = v21;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_ERROR, "%{public}@Invalid cameras access level value: %ld", buf, 0x16u);
      }
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      v32 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
      {
        v34 = HMFGetLogIdentifier();
        *buf = 138543618;
        v48 = v34;
        v49 = 2112;
        v50 = @"kUserCamerasAccessLevelInformationKey";
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_ERROR, "%{public}@Missing value for key: %@", buf, 0x16u);
      }
    }

    objc_autoreleasePoolPop(v31);
    v29 = MEMORY[0x277CCA9B8];
    v30 = 3;
    goto LABEL_23;
  }

  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543618;
    v48 = v11;
    v49 = 2112;
    v50 = v5;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot modify cameras access level for owner of the home: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  v12 = MEMORY[0x277CCA9B8];
  v13 = 48;
LABEL_9:
  v18 = [v12 hmErrorWithCode:v13];
  [v4 respondWithError:v18];
LABEL_25:

  v38 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleUpdateUserCamerasAccessLevel___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = *(a1 + 32);
    v4 = *MEMORY[0x277D85DE8];

    [v3 respondWithError:a2];
  }

  else
  {
    v5 = *(a1 + 40);
    v8 = @"kUserCamerasAccessLevelInformationKey";
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [*(a1 + 32) respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (void)_addUsersWithInviteInformations:(id)a3 message:(id)a4
{
  v54 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v35 = a4;
  v7 = [MEMORY[0x277CBEB18] array];
  v37 = [MEMORY[0x277CBEB18] array];
  v49 = 0u;
  v50 = 0u;
  v48 = 0u;
  v47 = 0u;
  obj = v6;
  v8 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
  if (v8)
  {
    v9 = *v48;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v48 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v47 + 1) + 8 * i);
        v12 = [objc_opt_class() privilegeFromUserInviteInformation:v11];
        v13 = +[HMDAccountHandleFormatter defaultFormatter];
        v14 = [v11 userID];
        v15 = [v13 accountHandleFromString:v14];

        v16 = [[HMDUser alloc] initWithAccountHandle:v15 home:self pairingIdentity:0 privilege:v12];
        [(HMDUser *)v16 refreshDisplayName];
        -[HMDUser setRemoteAccessAllowed:](v16, "setRemoteAccessAllowed:", [v11 isRemoteAccessAllowed]);
        -[HMDUser setCamerasAccessLevel:](v16, "setCamerasAccessLevel:", [v11 camerasAccessLevel]);
        if ([v11 isAnnounceAccessAllowed])
        {
          v17 = 2;
        }

        else
        {
          v17 = 1;
        }

        [(HMDUser *)v16 setAnnounceAccessLevel:v17];
        v18 = [[HMDOutgoingHomeInvitation alloc] initWithInvitee:v16 invitationState:2 forHome:self expiryDate:0 messageIdentifier:0];
        [v7 addObject:v18];
        v19 = [(HMDHomeInvitation *)v18 invitationData];
        [v37 addObject:v19];
      }

      v8 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
    }

    while (v8);
  }

  v20 = _os_feature_enabled_impl();
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke;
  aBlock[3] = &unk_27972F5B0;
  objc_copyWeak(&v44, &location);
  v21 = v7;
  v43 = v21;
  v45 = v20;
  v22 = _Block_copy(aBlock);
  [(HMDHome *)self _addOutgoingInvitations:v21 message:v35 transactionCompleted:0];
  v23 = [(HMDHome *)self administratorHandler];
  if ([v23 shouldRelayMessages])
  {
    v34 = encodeRootObject();
    v51[0] = @"HM.invitations";
    v51[1] = @"HMDHomeSuppressInviteNotificationKey";
    v52[0] = v34;
    v24 = [MEMORY[0x277CCABB0] numberWithBool:v20];
    v52[1] = v24;
    v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v52 forKeys:v51 count:2];

    v26 = MEMORY[0x277D0F848];
    v39[0] = MEMORY[0x277D85DD0];
    v39[1] = 3221225472;
    v39[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_2;
    v39[3] = &unk_279733AE8;
    objc_copyWeak(&v41, &location);
    v40 = v21;
    v27 = [v26 messageWithName:@"kAddHomeInvitesInternalRequestKey" messagePayload:v25 responseHandler:v39];
    v28 = objc_alloc(MEMORY[0x277D0F820]);
    v29 = [(HMDHome *)self uuid];
    v30 = [v28 initWithTarget:v29];

    [v27 setDestination:v30];
    [v27 setQualityOfService:33];
    v38 = 0;
    v31 = [v23 operationForMessage:v27 error:&v38];
    v32 = v38;
    if (v31)
    {
      [v23 addOperation:v31];
    }

    objc_destroyWeak(&v41);
  }

  else
  {
    v22[2](v22);
  }

  objc_destroyWeak(&v44);
  objc_destroyWeak(&location);

  v33 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__addUsersWithInviteInformations_message___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained __sendOutgoingInvitations:*(a1 + 32) suppressHomeInviteNotification:*(a1 + 48)];
}

void __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = @"kAddHomeInvitesInternalRequestKey";
      v20 = 2112;
      v21 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Relayed message %@ with error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    if (v5)
    {
      v12 = [v9 workQueue];
      v14[0] = MEMORY[0x277D85DD0];
      v14[1] = 3221225472;
      v14[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_1446;
      v14[3] = &unk_2797359B0;
      v14[4] = v9;
      v15 = *(a1 + 32);
      dispatch_async(v12, v14);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_1446(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    *buf = 138543618;
    v20 = v5;
    v21 = 2112;
    v22 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Removing invites that were not added to resident: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v7 = *(a1 + 40);
  v8 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * i);
        [*(a1 + 32) removeOutgoingInvitation:{v12, v14}];
        [*(a1 + 32) __handleCancelledOutgoingInvitation:v12];
        [v12 updateInvitationState:1];
      }

      v9 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveOutgoingHomeInvitationModel:(id)a3 message:(id)a4
{
  v13 = a4;
  v6 = [a3 uuid];
  v7 = [(HMDHome *)self outgoingInvitationWithUUID:v6];

  if (v7)
  {
    [(HMDHome *)self removeOutgoingInvitation:v7];
    v8 = [v13 transactionResult];
    [v8 markChanged];
    v9 = [v7 user];
    v10 = [v9 uuid];
    v11 = [(HMDHome *)self userWithUUID:v10];

    if (v11)
    {
      [(HMDHome *)self __handleCompletedOutgoingInvitation:v7];
    }

    else
    {
      if ([v8 source] == 2 || objc_msgSend(v8, "source") == 3)
      {
        [v7 cancel];
      }

      else
      {
        [(HMDHome *)self __handleCancelledOutgoingInvitation:v7];
      }

      [v7 updateInvitationState:1];
    }

    if ([(HMDHome *)self isOwnerUser])
    {
      v12 = [(HMDHome *)self homeManager];
      [v12 setLastUserAddRemoveTimestamp];
    }
  }

  [v13 respondWithPayload:0];
}

- (void)_handleAddOutgoingHomeInvitationModel:(id)a3 message:(id)a4
{
  v48 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 uuid];
  v9 = [(HMDHome *)self outgoingInvitationWithUUID:v8];

  if (!v9)
  {
    v10 = [v6 user];
    v11 = [HMDUser userWithDictionary:v10 home:self];

    [v11 refreshDisplayName];
    v12 = [HMDOutgoingHomeInvitation alloc];
    v13 = [v6 uuid];
    v14 = [v6 invitationState];
    v15 = [v14 integerValue];
    v16 = [v6 expiryDate];
    v17 = [(HMDOutgoingHomeInvitation *)v12 initWithUUID:v13 invitee:v11 invitationState:v15 forHome:self expiryDate:v16 messageIdentifier:0];

    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138544130;
      v41 = v21;
      v42 = 2112;
      v43 = v11;
      v44 = 2112;
      v45 = 0;
      v46 = 2112;
      v47 = v17;
      _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Created user [%@] from outgoing invitation: %@ / %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v18);
    v22 = objc_alloc(MEMORY[0x277D0F818]);
    v23 = [MEMORY[0x277D0F820] allMessageDestinations];
    v24 = [v22 initWithName:@"kTransactionUpdate" destination:v23 payload:0];
    [(HMDOutgoingHomeInvitation *)v17 transactionObjectUpdated:0 newValues:v6 message:v24];

    v25 = [(HMDHome *)v19 workQueue];
    [(HMDHomeInvitation *)v17 setClientQueue:v25];

    objc_initWeak(buf, v19);
    objc_initWeak(&location, v17);
    v32 = MEMORY[0x277D85DD0];
    v33 = 3221225472;
    v34 = __57__HMDHome__handleAddOutgoingHomeInvitationModel_message___block_invoke;
    v35 = &unk_279733938;
    objc_copyWeak(&v37, buf);
    objc_copyWeak(&v38, &location);
    v26 = v7;
    v36 = v26;
    [(HMDHomeInvitation *)v17 setExpirationHandler:&v32];
    [(HMDHome *)v19 addOutgoingInvitation:v17, v32, v33, v34, v35];
    [(HMDHome *)v19 _cleanRemovedUsers:v11];
    [(HMDOutgoingHomeInvitation *)v17 notifyStateChangedForMessage:v26];
    if ([(HMDHome *)v19 isOwnerUser])
    {
      v27 = [(HMDHome *)v19 home];
      v28 = [v27 homeManager];
      [v28 updateCurrentUserEligibleForOwnerToAutoMigration];

      v29 = [(HMDHome *)v19 homeManager];
      [v29 setLastUserAddRemoveTimestamp];
    }

    v30 = [v26 transactionResult];
    [v30 markChanged];

    objc_destroyWeak(&v38);
    objc_destroyWeak(&v37);
    objc_destroyWeak(&location);
    objc_destroyWeak(buf);
  }

  v31 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome__handleAddOutgoingHomeInvitationModel_message___block_invoke(id *a1)
{
  v15 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 5);
  v3 = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = WeakRetained;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [v3 identifier];
      v11 = 138543618;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Expiring invitation %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [v5 removeOutgoingInvitation:v3];
    [v5 __handleCancelledOutgoingInvitation:v3];
    [v3 updateInvitationState:{objc_msgSend(v3, "invitationState")}];
    v9 = [a1[4] name];
    [v5 saveWithReason:v9 postSyncNotification:0];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserInvitations:(id)a3
{
  v84[2] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self featuresDataSource];
  v6 = [v5 isBlockHomeInvitationInHH1Enabled];

  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v79 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Home invitation is no longer supported in HH1.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [v4 respondWithError:v11];
    goto LABEL_43;
  }

  v11 = [v4 dataForKey:*MEMORY[0x277CD06B8]];
  if (!v11)
  {
    v43 = objc_autoreleasePoolPush();
    v44 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      v47 = [v4 messagePayload];
      *buf = 138543618;
      v79 = v46;
      v80 = 2112;
      v81 = v47;
      _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_ERROR, "%{public}@Failed to send invitations, missing user invite information: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v43);
    v17 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    [v4 respondWithError:v17];
    goto LABEL_42;
  }

  v12 = MEMORY[0x277CCAAC8];
  v13 = MEMORY[0x277CBEB98];
  v84[0] = objc_opt_class();
  v84[1] = objc_opt_class();
  v14 = [MEMORY[0x277CBEA60] arrayWithObjects:v84 count:2];
  v15 = [v13 setWithArray:v14];
  v76 = 0;
  v16 = [v12 unarchivedObjectOfClasses:v15 fromData:v11 error:&v76];
  v17 = v76;

  v18 = v16;
  v19 = objc_autoreleasePoolPush();
  v20 = self;
  v21 = HMFGetOSLogHandle();
  v22 = v21;
  if (!v16)
  {
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v48 = HMFGetLogIdentifier();
      *buf = 138543618;
      v79 = v48;
      v80 = 2112;
      v81 = v17;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode user invite information: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    v49 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    [v4 respondWithError:v49];
    goto LABEL_33;
  }

  if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
  {
    v23 = HMFGetLogIdentifier();
    v24 = [(HMDHome *)v20 users];
    v25 = [v24 count];
    *buf = 138543874;
    v79 = v23;
    v80 = 2048;
    v81 = v25;
    v82 = 2048;
    v83 = maximumUsersPerHome;
    _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Adding users; current user count is %ld and max is %ld", buf, 0x20u);

    v18 = v16;
  }

  objc_autoreleasePoolPop(v19);
  v26 = [(HMDHome *)v20 users];
  v27 = [v26 count];
  v28 = [v18 count] + v27;
  v29 = maximumUsersPerHome;

  if (v28 >= v29)
  {
    v50 = objc_autoreleasePoolPush();
    v51 = v20;
    v52 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v54 = v53 = v18;
      *buf = 138543362;
      v79 = v54;
      _os_log_impl(&dword_2531F8000, v52, OS_LOG_TYPE_INFO, "%{public}@Can't add users; already at maximum users for home", buf, 0xCu);

      v18 = v53;
    }

    objc_autoreleasePoolPop(v50);
    v49 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:49 userInfo:0];
    v55 = [v4 responseHandler];
    (v55)[2](v55, v49, 0);

LABEL_33:
    goto LABEL_41;
  }

  v69 = v17;
  v70 = v4;
  v74 = 0u;
  v75 = 0u;
  v72 = 0u;
  v73 = 0u;
  obj = v18;
  v30 = [obj countByEnumeratingWithState:&v72 objects:v77 count:16];
  if (!v30)
  {
    goto LABEL_23;
  }

  v31 = v30;
  v32 = *v73;
  v68 = v18;
  while (2)
  {
    for (i = 0; i != v31; ++i)
    {
      if (*v73 != v32)
      {
        objc_enumerationMutation(obj);
      }

      v34 = *(*(&v72 + 1) + 8 * i);
      v35 = objc_autoreleasePoolPush();
      v36 = v20;
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
      {
        v38 = HMFGetLogIdentifier();
        *buf = 138543618;
        v79 = v38;
        v80 = 2112;
        v81 = v34;
        _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@Processing invite information : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v35);
      v39 = [v34 userID];
      v40 = [(HMDHome *)v36 users];
      v41 = [v40 hmf_firstObjectWithValue:v39 forKeyPath:@"userID"];

      if (v41)
      {
        v56 = objc_autoreleasePoolPush();
        v57 = v36;
        v58 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
        {
          v59 = HMFGetLogIdentifier();
          *buf = 138543618;
          v79 = v59;
          v80 = 2112;
          v81 = v39;
          v60 = "%{public}@Failed to invite user %@ since the user is already part of the home";
LABEL_38:
          _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_INFO, v60, buf, 0x16u);
        }

LABEL_39:

        objc_autoreleasePoolPop(v56);
        v61 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:1 userInfo:0];
        v4 = v70;
        v62 = [v70 responseHandler];
        v62[2](v62, v61, 0);

LABEL_40:
        v17 = v69;

        v18 = v68;
        goto LABEL_41;
      }

      v42 = [(HMDHome *)v36 outgoingInvitations];
      v41 = [v42 hmf_firstObjectWithValue:v39 forKeyPath:@"user.userID"];

      if (v41)
      {
        v56 = objc_autoreleasePoolPush();
        v57 = v36;
        v58 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
        {
          v59 = HMFGetLogIdentifier();
          *buf = 138543618;
          v79 = v59;
          v80 = 2112;
          v81 = v39;
          v60 = "%{public}@Failed to invite user %@ since the user is already invited to the home";
          goto LABEL_38;
        }

        goto LABEL_39;
      }

      if ([v34 isAdministrator] && !-[HMDHome isResidentSupported](v36, "isResidentSupported"))
      {
        v64 = objc_autoreleasePoolPush();
        v65 = v36;
        v66 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
        {
          v67 = HMFGetLogIdentifier();
          *buf = 138543618;
          v79 = v67;
          v80 = 2112;
          v81 = v39;
          _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_INFO, "%{public}@Cannot invite admin user %@ because it requires a resident", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v64);
        v41 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:48 userInfo:0];
        v4 = v70;
        v61 = [v70 responseHandler];
        (v61)[2](v61, v41, 0);
        goto LABEL_40;
      }
    }

    v31 = [obj countByEnumeratingWithState:&v72 objects:v77 count:16];
    v18 = v68;
    if (v31)
    {
      continue;
    }

    break;
  }

LABEL_23:

  v4 = v70;
  [(HMDHome *)v20 _addUsersWithInviteInformations:obj message:v70];
  v17 = v69;
LABEL_41:

LABEL_42:
LABEL_43:

  v63 = *MEMORY[0x277D85DE8];
}

- (void)_cleanRemovedUsers:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277CBEB18] array];
  os_unfair_recursive_lock_lock_with_options();
  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  v6 = self->_removedUsers;
  v7 = [(NSMutableArray *)v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v7)
  {
    v8 = *v13;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(v6);
        }

        v10 = *(*(&v12 + 1) + 8 * i);
        if ([v10 isEqualToUser:{v4, v12}])
        {
          [v5 addObject:v10];
        }
      }

      v7 = [(NSMutableArray *)v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v7);
  }

  [(NSMutableArray *)self->_removedUsers removeObjectsInArray:v5];
  os_unfair_recursive_lock_unlock();

  v11 = *MEMORY[0x277D85DE8];
}

- (id)prepareUserManagementOperationForUser:(id)a3 accessory:(id)a4 type:(unint64_t)a5 model:(id)a6 error:(id *)a7
{
  v52 = *MEMORY[0x277D85DE8];
  v11 = a3;
  v12 = a4;
  v13 = a6;
  v41 = a7;
  if (shouldLogPrivateInformation())
  {
    v14 = [v11 userID];
  }

  else
  {
    v14 = @"...";
    v15 = @"...";
  }

  v16 = v13;
  v17 = objc_autoreleasePoolPush();
  v18 = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    if (a5 - 1 > 2)
    {
      v21 = @"unknown";
    }

    else
    {
      v21 = off_27972B528[a5 - 1];
    }

    v22 = v21;
    v23 = [v12 name];
    *buf = 138544130;
    v45 = v20;
    v46 = 2112;
    v47 = v22;
    v48 = 2112;
    v49 = v14;
    v50 = 2112;
    v51 = v23;
    _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Preparing %@ user operation for user '%@' and accessory '%@'", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v17);
  v43 = 0;
  v24 = [(HMDHome *)v18 _verifyUserManagementPermissionForAccessory:v12 error:&v43];
  v25 = v43;
  v26 = v25;
  if (!v24 || (v42 = v25, v27 = [(HMDHome *)v18 _isUserValid:v11 error:&v42], v28 = v42, v26, v26 = v28, !v27))
  {
    v29 = objc_autoreleasePoolPush();
    v30 = v18;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      v33 = [v12 name];
      *buf = 138544130;
      v45 = v32;
      v46 = 2112;
      v47 = v14;
      v48 = 2112;
      v49 = v33;
      v50 = 2112;
      v51 = v26;
      _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Unable to prepare user operation for user '%@' and accessory '%@' due to error: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v29);
  }

  if (v26)
  {
    v34 = 0;
    v35 = v16;
    v36 = v41;
    goto LABEL_22;
  }

  v35 = v16;
  if (a5 == 2)
  {
    v34 = [HMDUserManagementOperation removeUserManagementOperationForUser:v11 accessory:v12 model:v16];
    v36 = v41;
    if (v34)
    {
LABEL_19:
      v26 = 0;
      goto LABEL_22;
    }
  }

  else
  {
    v36 = v41;
    if (a5 == 1)
    {
      v34 = [HMDUserManagementOperation addUserManagementOperationForUser:v11 accessory:v12 model:v35];
      if (v34)
      {
        goto LABEL_19;
      }
    }
  }

  v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3 description:@"Failed to create user operation" reason:0 suggestion:{0, a5}];
  v34 = 0;
LABEL_22:
  if (v36)
  {
    v37 = v26;
    *v36 = v26;
  }

  v38 = *MEMORY[0x277D85DE8];

  return v34;
}

- (id)prepareUserManagementOperationForUser:(id)a3 accessories:(id)a4 type:(unint64_t)a5 error:(id *)a6
{
  v53 = *MEMORY[0x277D85DE8];
  v38 = a3;
  v9 = a4;
  v35 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v9, "count")}];
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v43 = 0u;
  obj = v9;
  v10 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
  if (v10)
  {
    v11 = v10;
    v34 = 0;
    v12 = *v41;
    v36 = self;
    v33 = a5;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v41 != v12)
        {
          objc_enumerationMutation(obj);
        }

        v14 = *(*(&v40 + 1) + 8 * i);
        if ([v14 supportsUserManagement])
        {
          v39 = 0;
          v15 = [(HMDHome *)self prepareUserManagementOperationForUser:v38 accessory:v14 type:a5 model:0 error:&v39];
          v16 = v39;
          if (v15)
          {
            [v35 addObject:v15];
          }

          else
          {
            v21 = objc_autoreleasePoolPush();
            v22 = self;
            v23 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
            {
              v24 = HMFGetLogIdentifier();
              [v38 userID];
              v25 = v32 = v21;
              v26 = [v14 name];
              *buf = 138544130;
              v45 = v24;
              v46 = 2112;
              v47 = v25;
              v48 = 2112;
              v49 = v26;
              v50 = 2112;
              v51 = v16;
              _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Failed to prepare user management operation for user '%@', accessory '%@ with error: %@", buf, 0x2Au);

              v21 = v32;
              self = v36;
            }

            objc_autoreleasePoolPop(v21);
            if (v16)
            {
              v27 = v16;

              v34 = v27;
            }

            a5 = v33;
          }
        }

        else
        {
          v17 = objc_autoreleasePoolPush();
          v18 = self;
          v19 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
          {
            v20 = HMFGetLogIdentifier();
            *buf = 138543618;
            v45 = v20;
            v46 = 2112;
            v47 = v14;
            _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Skipping creation of user management operation for unmanageable accessory: %@", buf, 0x16u);

            self = v36;
          }

          objc_autoreleasePoolPop(v17);
        }
      }

      v11 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
    }

    while (v11);
  }

  else
  {
    v34 = 0;
  }

  v28 = v34;
  if (a6)
  {
    v28 = v34;
    *a6 = v28;
  }

  v29 = *MEMORY[0x277D85DE8];

  return v35;
}

- (void)_addAllUsersToAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self users];
  [(HMDHome *)self _addUsers:v5 accessory:v4];
}

- (void)_addUsers:(id)a3 accessory:(id)a4
{
  v64 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v47 = a4;
  v7 = [(HMDHome *)self homeManager];
  v8 = [v7 backingStore];
  v9 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v44 = [v8 transaction:@"kUserManagementOperationAddedKey" options:v9];

  v10 = [(HMDHome *)self owner];
  v43 = [v10 pairingIdentity];

  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  obj = v6;
  v11 = [obj countByEnumeratingWithState:&v51 objects:v63 count:16];
  if (v11)
  {
    v13 = v11;
    v14 = *v52;
    *&v12 = 138543874;
    v38 = v12;
    v45 = *v52;
    v39 = self;
    do
    {
      v15 = 0;
      v46 = v13;
      do
      {
        if (*v52 != v14)
        {
          objc_enumerationMutation(obj);
        }

        v16 = *(*(&v51 + 1) + 8 * v15);
        v17 = [(HMDHome *)self currentUser];
        v18 = [v16 isEqual:v17];

        if ((v18 & 1) == 0)
        {
          v19 = objc_autoreleasePoolPush();
          v20 = self;
          v21 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            v22 = HMFGetLogIdentifier();
            v23 = [v16 userID];
            *buf = 138543618;
            v56 = v22;
            v57 = 2112;
            v58 = v23;
            _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Adding user '%@' to all accessories in the home", buf, 0x16u);

            v13 = v46;
            v14 = v45;
          }

          objc_autoreleasePoolPop(v19);
          v50 = 0;
          v24 = [(HMDHome *)v20 prepareUserManagementOperationForUser:v16 accessory:v47 type:1 model:0 error:&v50];
          v49 = v50;
          v25 = objc_autoreleasePoolPush();
          v26 = v20;
          v27 = HMFGetOSLogHandle();
          v28 = v27;
          if (v24)
          {
            if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
            {
              v40 = HMFGetLogIdentifier();
              v41 = [v24 identifier];
              [v41 UUIDString];
              v29 = v42 = v25;
              v30 = [v24 user];
              v31 = [v30 userID];
              v32 = [v24 accessory];
              v33 = [v32 shortDescription];
              *buf = 138544130;
              v56 = v40;
              v57 = 2112;
              v58 = v29;
              v59 = 2112;
              v60 = v31;
              v61 = 2112;
              v62 = v33;
              _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Adding operation '%@' to manager tracking adding user '%@' to accessory '%@'", buf, 0x2Au);

              self = v39;
              v14 = v45;

              v13 = v46;
              v25 = v42;
            }

            objc_autoreleasePoolPop(v25);
            [v24 setOwnerPairingIdentity:v43];
            v34 = [v24 modelObjectWithChangeType:1];
            [v44 add:v34];
          }

          else
          {
            if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
            {
              v35 = HMFGetLogIdentifier();
              v36 = [v16 userID];
              *buf = v38;
              v56 = v35;
              v57 = 2112;
              v58 = v36;
              v59 = 2112;
              v60 = v49;
              _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_ERROR, "%{public}@Failed to prepare add operations for user '%@' with error: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v25);
          }
        }

        ++v15;
      }

      while (v13 != v15);
      v13 = [obj countByEnumeratingWithState:&v51 objects:v63 count:16];
    }

    while (v13);
  }

  [v44 run];
  v37 = *MEMORY[0x277D85DE8];
}

- (void)removeAllUsersAndCloudDataFromAccessory:(id)a3 completionHandler:(id)a4
{
  v116 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self isOwnerUser];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v8)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v107 = v13;
      v108 = 2112;
      v109 = v6;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Removing cloud data from primary accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = v6;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;
    v82 = v14;

    v104 = 0u;
    v105 = 0u;
    v102 = 0u;
    v103 = 0u;
    v71 = v16;
    v17 = [v16 identifiersForBridgedAccessories];
    v18 = [v17 countByEnumeratingWithState:&v102 objects:v115 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = *v103;
      do
      {
        for (i = 0; i != v19; ++i)
        {
          if (*v103 != v20)
          {
            objc_enumerationMutation(v17);
          }

          v22 = [(HMDHome *)v10 accessoryWithUUID:*(*(&v102 + 1) + 8 * i)];
          [v22 removeCloudData];
        }

        v19 = [v17 countByEnumeratingWithState:&v102 objects:v115 count:16];
      }

      while (v19);
    }

    v72 = v7;
    v73 = v6;

    [v82 removeCloudData];
    v76 = [(HMDHome *)v10 homeManager];
    v23 = [v76 backingStore];
    v24 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v78 = [v23 transaction:@"kUserManagementOperationAddedKey" options:v24];

    v25 = objc_autoreleasePoolPush();
    v26 = v10;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543362;
      v107 = v28;
      _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Creating remove operation", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v25);
    v29 = [(HMDHome *)v26 currentUser];
    v101 = 0;
    v30 = [(HMDHome *)v26 prepareUserManagementOperationForUser:v29 accessory:v82 type:2 model:0 error:&v101];
    v70 = v101;

    v77 = v30;
    if (v30)
    {
      group = dispatch_group_create();
      v31 = [(HMDHome *)v26 owner];
      v74 = [v31 pairingIdentity];

      v99 = 0u;
      v100 = 0u;
      v97 = 0u;
      v98 = 0u;
      obj = [(HMDHome *)v26 users];
      v32 = v82;
      v81 = [obj countByEnumeratingWithState:&v97 objects:v114 count:16];
      if (v81)
      {
        v80 = *v98;
        do
        {
          for (j = 0; j != v81; ++j)
          {
            if (*v98 != v80)
            {
              objc_enumerationMutation(obj);
            }

            v34 = *(*(&v97 + 1) + 8 * j);
            v35 = [(HMDHome *)v26 currentUser];
            v36 = [v34 isEqual:v35];

            v37 = objc_autoreleasePoolPush();
            v38 = v26;
            v39 = HMFGetOSLogHandle();
            v40 = os_log_type_enabled(v39, OS_LOG_TYPE_INFO);
            if (v36)
            {
              if (v40)
              {
                v41 = HMFGetLogIdentifier();
                v42 = [v34 userID];
                v43 = [v32 name];
                *buf = 138543874;
                v107 = v41;
                v108 = 2112;
                v109 = v42;
                v110 = 2112;
                v111 = v43;
                _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Skipping removing current user %@ from accessory %@", buf, 0x20u);
              }

              objc_autoreleasePoolPop(v37);
            }

            else
            {
              if (v40)
              {
                v44 = HMFGetLogIdentifier();
                v45 = [v34 userID];
                v46 = [v32 shortDescription];
                *buf = 138543874;
                v107 = v44;
                v108 = 2112;
                v109 = v45;
                v110 = 2112;
                v111 = v46;
                _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Removing user %@ from accessory %@", buf, 0x20u);

                v32 = v82;
              }

              objc_autoreleasePoolPop(v37);
              v96 = 0;
              v47 = [(HMDHome *)v38 prepareUserManagementOperationForUser:v34 accessory:v32 type:2 model:0 error:&v96];
              v48 = v96;
              if (v47)
              {
                [v47 setOwnerPairingIdentity:v74];
                [v77 addDependency:v47];
                dispatch_group_enter(group);
                v49 = [v32 identifier];
                v50 = [v34 pairingIdentity];
                v89[0] = MEMORY[0x277D85DD0];
                v89[1] = 3221225472;
                v89[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke;
                v89[3] = &unk_2797248F0;
                v90 = v47;
                v91 = v38;
                v92 = v34;
                v93 = v82;
                v94 = v78;
                v95 = group;
                [v76 cleanupOperationsForAccessory:v49 user:v50 completion:v89];

                v32 = v82;
              }

              else
              {
                v51 = objc_autoreleasePoolPush();
                v52 = v38;
                v53 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
                {
                  v54 = HMFGetLogIdentifier();
                  v55 = [v34 userID];
                  v56 = [v82 shortDescription];
                  *buf = 138544130;
                  v107 = v54;
                  v108 = 2112;
                  v109 = v55;
                  v110 = 2112;
                  v111 = v56;
                  v112 = 2112;
                  v113 = v48;
                  _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_INFO, "%{public}@Failed to create remove user operation for user '%@' and accessory '%@': %@", buf, 0x2Au);

                  v32 = v82;
                }

                objc_autoreleasePoolPop(v51);
              }
            }
          }

          v81 = [obj countByEnumeratingWithState:&v97 objects:v114 count:16];
        }

        while (v81);
      }

      [v77 setOwnerPairingIdentity:v74];
      [(HMDHome *)v26 workQueue];
      v58 = v57 = v32;
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_1432;
      block[3] = &unk_279734668;
      v84 = v77;
      v85 = v26;
      v86 = v57;
      v87 = v78;
      v7 = v72;
      v88 = v72;
      dispatch_group_notify(group, v58, block);

      v6 = v73;
      v59 = v70;
    }

    else
    {
      v64 = objc_autoreleasePoolPush();
      v65 = v26;
      v66 = HMFGetOSLogHandle();
      v59 = v70;
      if (os_log_type_enabled(v66, OS_LOG_TYPE_ERROR))
      {
        v67 = HMFGetLogIdentifier();
        v68 = [v82 shortDescription];
        *buf = 138543874;
        v107 = v67;
        v108 = 2112;
        v109 = v68;
        v110 = 2112;
        v111 = v70;
        _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_ERROR, "%{public}@Failed to create remove operation for accessory %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v64);
      if (v7)
      {
        v7[2](v7);
      }
    }

    v63 = v71;
  }

  else
  {
    if (v12)
    {
      v60 = HMFGetLogIdentifier();
      v61 = [v6 shortDescription];
      *buf = 138543618;
      v107 = v60;
      v108 = 2112;
      v109 = v61;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Not owner of home - bypassing removing users from accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v62 = _Block_copy(v7);
    v63 = v62;
    if (v62)
    {
      (*(v62 + 2))(v62);
    }
  }

  v69 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke(id *a1)
{
  v2 = a1[4];
  v3 = [a1[5] workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2;
  v4[3] = &unk_2797248F0;
  v5 = *(a1 + 5);
  v6 = a1[7];
  v7 = a1[8];
  v8 = a1[4];
  v9 = a1[9];
  [v2 executeWithCompletionQueue:v3 completionHandler:v4];
}

void __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_1432(id *a1)
{
  v2 = a1[4];
  if (v2)
  {
    v3 = [a1[5] workQueue];
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2_1433;
    v13[3] = &unk_279732B10;
    v10 = *(a1 + 5);
    v4 = *(&v10 + 1);
    v5 = a1[7];
    v6 = a1[4];
    *&v7 = v5;
    *(&v7 + 1) = v6;
    v14 = v10;
    v15 = v7;
    v16 = a1[8];
    [v2 executeWithCompletionQueue:v3 completionHandler:v13];

    v8 = *(&v14 + 1);
  }

  else
  {
    v11[0] = MEMORY[0x277D85DD0];
    v11[1] = 3221225472;
    v11[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2_1435;
    v11[3] = &unk_279735558;
    v9 = a1[7];
    v12 = a1[8];
    [v9 run:v11];
    v8 = v12;
  }
}

void __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2_1433(uint64_t a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [*(a1 + 32) currentUser];
      v9 = [v8 userID];
      v10 = [*(a1 + 40) shortDescription];
      *buf = 138544130;
      v18 = v7;
      v19 = 2112;
      v20 = v9;
      v21 = 2112;
      v22 = v10;
      v23 = 2112;
      v24 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove user '%@' from accessory '%@': %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
    v11 = *(a1 + 48);
    v12 = [*(a1 + 56) modelObjectWithChangeType:1];
    [v11 add:v12];
  }

  v13 = *(a1 + 48);
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_1434;
  v15[3] = &unk_279735558;
  v16 = *(a1 + 64);
  [v13 run:v15];

  v14 = *MEMORY[0x277D85DE8];
}

uint64_t __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2_1435(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

uint64_t __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_1434(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

void __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [*(a1 + 40) userID];
      v9 = [*(a1 + 48) shortDescription];
      v13 = 138544130;
      v14 = v7;
      v15 = 2112;
      v16 = v8;
      v17 = 2112;
      v18 = v9;
      v19 = 2112;
      v20 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove user '%@' from accessory '%@': %@", &v13, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
    v10 = *(a1 + 56);
    v11 = [*(a1 + 64) modelObjectWithChangeType:1];
    [v10 add:v11];
  }

  dispatch_group_leave(*(a1 + 72));

  v12 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isUserValid:(id)a3 error:(id *)a4
{
  v24 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = v6;
  if (!v6)
  {
    if (a4)
    {
      v10 = MEMORY[0x277CCA9B8];
      v11 = @"Missing required parameter to validate user";
      v12 = 3;
LABEL_10:
      [v10 hmErrorWithCode:v12 description:v11 reason:0 suggestion:0];
      *a4 = v9 = 0;
      goto LABEL_12;
    }

LABEL_11:
    v9 = 0;
    goto LABEL_12;
  }

  v8 = [v6 pairingIdentity];

  if (!v8)
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v7 userID];
      v20 = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = v17;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Invalid user '%@', missing either pairing username or public key", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    if (a4)
    {
      v10 = MEMORY[0x277CCA9B8];
      v11 = @"Invalid user information";
      v12 = 21;
      goto LABEL_10;
    }

    goto LABEL_11;
  }

  v9 = 1;
LABEL_12:

  v18 = *MEMORY[0x277D85DE8];
  return v9;
}

- (BOOL)_verifyUserManagementPermissionForAccessory:(id)a3 error:(id *)a4
{
  v31 = *MEMORY[0x277D85DE8];
  v6 = a3;
  if (![(HMDHome *)self isAdminUser])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543362;
      v28 = v11;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_DEFAULT, "%{public}@Non administrator cannot perform user management", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    if (a4)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:17 description:@"Must be administrator to perform user management" reason:0 suggestion:0];
      *a4 = v7 = 0;
      goto LABEL_13;
    }

LABEL_12:
    v7 = 0;
    goto LABEL_13;
  }

  if (([v6 supportsUserManagement] & 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v6 name];
      *buf = 138543618;
      v28 = v15;
      v29 = 2112;
      v30 = v16;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Cannot perform user management on '%@' since it is does not support user management operations", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    if (a4)
    {
      v25[0] = *MEMORY[0x277CCA450];
      v17 = MEMORY[0x277CCACA8];
      v18 = [v6 name];
      v19 = [v17 stringWithFormat:@"Cannot perform user management on '%@'", v18];
      v26[0] = v19;
      v25[1] = *MEMORY[0x277CCA470];
      v20 = [MEMORY[0x277CCA8D8] mainBundle];
      v21 = [v20 localizedStringForKey:@"Accessory is not a primary accessory." value:&stru_286509E58 table:0];
      v26[1] = v21;
      v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v26 forKeys:v25 count:2];

      *a4 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:48 userInfo:v22];
    }

    goto LABEL_12;
  }

  v7 = 1;
LABEL_13:

  v23 = *MEMORY[0x277D85DE8];
  return v7;
}

- (void)_purgeResidentUsers
{
  v2 = self;
  v33 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self residentCapableDevices];
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v4 = [(HMDHome *)v2 _residentUsers];
  v5 = [v4 copy];

  v23 = [v5 countByEnumeratingWithState:&v24 objects:v32 count:16];
  if (v23)
  {
    v7 = *v25;
    v8 = HMDIDSActivityMonitorHomeManagerDataSource;
    *&v6 = 138543618;
    v21 = v6;
    v22 = *v25;
    do
    {
      for (i = 0; i != v23; ++i)
      {
        if (*v25 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v24 + 1) + 8 * i);
        v11 = [v10 userID];
        v12 = [&v8[93] deviceWithDestination:v11];

        if (v12 && [v3 containsObject:v12])
        {
          v13 = objc_autoreleasePoolPush();
          v14 = v2;
          v15 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v16 = v5;
            v17 = v3;
            v19 = v18 = v2;
            *buf = v21;
            v29 = v19;
            v30 = 2112;
            v31 = v10;
            _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Removing non-legacy resident user from home: %@", buf, 0x16u);

            v2 = v18;
            v3 = v17;
            v5 = v16;
            v7 = v22;
          }

          objc_autoreleasePoolPop(v13);
          [(HMDHome *)v14 _removeUser:v10];
          v8 = HMDIDSActivityMonitorHomeManagerDataSource;
        }
      }

      v23 = [v5 countByEnumeratingWithState:&v24 objects:v32 count:16];
    }

    while (v23);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientsOfUpdatedResidentUser:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self _residentDeviceForResidentUser:v4];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v10;
      v17 = 2112;
      v18 = v4;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Notifying clients of updated remote access gateway: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v11 = [(HMDHome *)v7 homeManager];
    v12 = [v5 identifier];
    [v11 updateGenerationCounterWithReason:@"ResidentUserUpdated" sourceUUID:v12 shouldNotifyClients:1];
  }

  else
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = v4;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to find resident for resident user: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)_residentDeviceForResidentUser:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 device];
  if (v5)
  {
    v6 = [HMDResidentDevice alloc];
    v7 = [v4 uuid];
    v8 = [(HMDResidentDevice *)v6 initWithDevice:v5 identifier:v7];

    if (-[HMDHome isResidentSupported](self, "isResidentSupported") || [v4 configurationState] != 2)
    {
      [(HMDResidentDevice *)v8 setEnabled:0];
    }

    v9 = [(HMDHome *)self homeManager];
    v10 = [v9 messageDispatcher];
    v11 = [v10 remoteAccessDeviceForHome:self];

    if (([v11 isEqual:v5] & 1) == 0)
    {
      [(HMDResidentDevice *)v8 setReachable:0];
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = v4;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Unable to find matching device for resident user: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v8 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v8;
}

- (id)_residentUserForResidentDevice:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self owner];
  v6 = [v5 pairingIdentity];

  if (v6)
  {
    v7 = [v4 device];
    if (v7)
    {
      v8 = objc_alloc(MEMORY[0x277CFEC20]);
      v9 = [v7 identifier];
      v10 = [v9 UUIDString];
      v11 = [v6 publicKey];
      v12 = [v6 privateKey];
      v13 = [v8 initWithIdentifier:v10 publicKey:v11 privateKey:v12 permissions:{objc_msgSend(v6, "permissions")}];

      if ([v4 isEnabled])
      {
        v14 = 2;
      }

      else
      {
        v14 = 3;
      }

      v15 = [HMDResidentUser alloc];
      v16 = [v4 home];
      v17 = [(HMDResidentUser *)v15 initWithDevice:v7 home:v16 pairingIdentity:v13 configurationState:v14];

      [(HMDUser *)v17 setHome:self];
      if ([(HMDResidentUser *)v17 isBlocked])
      {
        [(HMDResidentUser *)v17 setConfigurationState:3];
      }
    }

    else
    {
      v17 = 0;
    }
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
    {
      v21 = HMFGetLogIdentifier();
      v24 = 138543618;
      v25 = v21;
      v26 = 2112;
      v27 = v4;
      _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to retrieve owner's pairing identity to create legacy resident user for device: %@", &v24, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
    v17 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v17;
}

- (id)userWithMergeID:(id)a3
{
  v36 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4)
  {
    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    v5 = [(HMDHome *)self users];
    v6 = [v5 countByEnumeratingWithState:&v25 objects:v35 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v26;
      while (2)
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v26 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = *(*(&v25 + 1) + 8 * i);
          v11 = [v10 account];
          v12 = [v11 senderCorrelationIdentifier];
          v13 = [v12 isEqualToString:v4];

          if (v13)
          {
            v19 = objc_autoreleasePoolPush();
            v20 = self;
            v21 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
            {
              v22 = HMFGetLogIdentifier();
              *buf = 138543874;
              v30 = v22;
              v31 = 2112;
              v32 = v4;
              v33 = 2112;
              v34 = v10;
              _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_DEBUG, "%{public}@Found user with mergeID %@: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v19);
            v18 = v10;

            goto LABEL_17;
          }
        }

        v7 = [v5 countByEnumeratingWithState:&v25 objects:v35 count:16];
        if (v7)
        {
          continue;
        }

        break;
      }
    }
  }

  v14 = objc_autoreleasePoolPush();
  v15 = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
  {
    v17 = HMFGetLogIdentifier();
    *buf = 138543618;
    v30 = v17;
    v31 = 2112;
    v32 = v4;
    _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_DEBUG, "%{public}@No user found with mergeID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v14);
  v18 = 0;
LABEL_17:

  v23 = *MEMORY[0x277D85DE8];

  return v18;
}

- (id)userWithPairingIdentityIdentifier:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4)
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    v5 = [(HMDHome *)self users];
    v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v6)
    {
      v7 = *v13;
      while (2)
      {
        for (i = 0; i != v6; i = i + 1)
        {
          if (*v13 != v7)
          {
            objc_enumerationMutation(v5);
          }

          v9 = *(*(&v12 + 1) + 8 * i);
          if ([v9 matchingPairingIdentityIdentifier:v4])
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
        if (v6)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  else
  {
    v6 = 0;
  }

  v10 = *MEMORY[0x277D85DE8];

  return v6;
}

- (id)userWithPairingIdentity:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4)
  {
    v16 = 0u;
    v17 = 0u;
    v14 = 0u;
    v15 = 0u;
    v5 = [(HMDHome *)self users];
    v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
    if (v6)
    {
      v7 = *v15;
      while (2)
      {
        for (i = 0; i != v6; i = i + 1)
        {
          if (*v15 != v7)
          {
            objc_enumerationMutation(v5);
          }

          v9 = *(*(&v14 + 1) + 8 * i);
          v10 = [v9 pairingIdentity];
          v11 = [v4 isEqual:v10];

          if (v11)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
        if (v6)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  else
  {
    v6 = 0;
  }

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)_updateCurrentUserForSharedHome
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self currentUser];

  if (!v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Did not find the current user so adding user for shared home", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v8 = [(HMDHome *)v5 dataSource];
    v9 = [v8 makeCurrentUserWithUserPrivilege:0 home:v5];

    v10 = [(HMDHome *)v5 presenceAuthStatus];
    [v9 setPresenceAuthStatus:v10];

    [v9 setHome:v5];
    [(HMDHome *)v5 setCurrentUser:v9];
    [(HMDHome *)v5 addUser:v9];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)isSiriPhraseOptionsJustSiriEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = (self->_siriPhraseOptions >> 1) & 1;
  os_unfair_recursive_lock_unlock();
  return v3;
}

- (BOOL)isSiriPhraseOptionsHeySiriEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  siriPhraseOptions = self->_siriPhraseOptions;
  os_unfair_recursive_lock_unlock();
  return siriPhraseOptions & 1;
}

- (BOOL)isSmokeAlarmEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  audioAnalysisClassifierOptions = self->_audioAnalysisClassifierOptions;
  os_unfair_recursive_lock_unlock();
  return audioAnalysisClassifierOptions & 1;
}

- (NSArray)removedUsers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_removedUsers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSArray)usersPendingUserManagementOperations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_usersPendingUserManagementOperations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (BOOL)isOwnerUser
{
  os_unfair_recursive_lock_lock_with_options();
  ownerUser = self->_ownerUser;
  os_unfair_recursive_lock_unlock();
  return ownerUser;
}

- (void)setOwnerUser:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_ownerUser = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isSharedAdmin
{
  v3 = [(HMDHome *)self isAdminUser];
  if (v3)
  {
    LOBYTE(v3) = ![(HMDHome *)self isOwnerUser];
  }

  return v3;
}

- (BOOL)isAdminUser
{
  v2 = [(HMDHome *)self currentUser];
  v3 = [v2 isAdministrator];

  return v3;
}

- (HMDUser)currentUser
{
  v17 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (!self->_currentUser)
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    v3 = [(HMDHome *)self users];
    v4 = [v3 countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v4)
    {
      v5 = *v13;
      while (2)
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v13 != v5)
          {
            objc_enumerationMutation(v3);
          }

          v7 = *(*(&v12 + 1) + 8 * i);
          if ([v7 isCurrentUser])
          {
            objc_storeStrong(&self->_currentUser, v7);
            v8 = [(HMDHome *)self presenceAuthStatus];
            [(HMDUser *)self->_currentUser setPresenceAuthStatus:v8];

            goto LABEL_12;
          }
        }

        v4 = [v3 countByEnumeratingWithState:&v12 objects:v16 count:16];
        if (v4)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  os_unfair_recursive_lock_unlock();
  currentUser = self->_currentUser;
  v10 = *MEMORY[0x277D85DE8];

  return currentUser;
}

- (void)setCurrentUser:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  currentUser = self->_currentUser;
  self->_currentUser = v4;

  os_unfair_recursive_lock_unlock();
}

- (id)owner
{
  v16 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (!self->_owner)
  {
    v13 = 0u;
    v14 = 0u;
    v11 = 0u;
    v12 = 0u;
    v3 = [(HMDHome *)self users];
    v4 = [v3 countByEnumeratingWithState:&v11 objects:v15 count:16];
    if (v4)
    {
      v5 = *v12;
      while (2)
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v12 != v5)
          {
            objc_enumerationMutation(v3);
          }

          v7 = *(*(&v11 + 1) + 8 * i);
          if ([v7 privilege] == 3)
          {
            objc_storeStrong(&self->_owner, v7);
            goto LABEL_12;
          }
        }

        v4 = [v3 countByEnumeratingWithState:&v11 objects:v15 count:16];
        if (v4)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  os_unfair_recursive_lock_unlock();
  owner = self->_owner;
  v9 = *MEMORY[0x277D85DE8];

  return owner;
}

- (void)setOwner:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  owner = self->_owner;
  self->_owner = v4;

  os_unfair_recursive_lock_unlock();
}

- (void)_removeUser:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v5 = v4;
    os_unfair_recursive_lock_lock_with_options();
    if ([(NSMutableArray *)self->_users containsObject:v5])
    {
      [(NSMutableArray *)self->_users removeObject:v5];
    }

    os_unfair_recursive_lock_unlock();
    v4 = v5;
  }
}

- (void)addUser:(id)a3
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  if (v4)
  {
    os_unfair_recursive_lock_lock_with_options();
    if (([(NSMutableArray *)self->_users containsObject:v4]& 1) == 0)
    {
      v6 = objc_autoreleasePoolPush();
      v7 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = HMFGetLogIdentifier();
        v11 = 138543618;
        v12 = v9;
        v13 = 2112;
        v14 = v4;
        _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Adding a new user : %@", &v11, 0x16u);
      }

      objc_autoreleasePoolPop(v6);
      [(NSMutableArray *)self->_users addObject:v4];
    }

    os_unfair_recursive_lock_unlock();
    if ([(HMDHome *)self isOwnerUser])
    {
      [v5 updateCurrentUserEligibleForOwnerToAutoMigration];
    }
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (NSArray)usersSupportingPresence
{
  v2 = [(HMDHome *)self users];
  v3 = [HMDHome filterUsersSupportingPresence:v2];

  return v3;
}

- (id)sharedUsers
{
  v2 = [(HMDHome *)self users];
  v3 = [v2 na_map:&__block_literal_global_1410];

  return v3;
}

id __22__HMDHome_sharedUsers__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 privilege] == 3)
  {
    v3 = 0;
  }

  else
  {
    v3 = v2;
  }

  return v3;
}

- (NSArray)users
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_users copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleRemoveAppDataModel:(id)a3 message:(id)a4
{
  v5 = a4;
  [(HMDHome *)self setAppData:0];
  v6 = [v5 transactionResult];
  [v6 markChanged];
  [v5 respondWithPayload:0];
}

- (void)_handleUpdateAppDataModel:(id)a3 message:(id)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self appData];

  if (v8)
  {
    v9 = [(HMDHome *)self appData];
    [v9 updateWithModel:v6];
  }

  else
  {
    v10 = [HMDApplicationData alloc];
    v11 = [v6 appDataDictionary];
    v12 = [(HMDHome *)self uuid];
    v13 = [(HMDApplicationData *)v10 initWithDictionary:v11 parentUUID:v12];
    [(HMDHome *)self setAppData:v13];

    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v6 appDataDictionary];
      v21 = 138543618;
      v22 = v17;
      v23 = 2112;
      v24 = v18;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_DEBUG, "%{public}@Updating the application data : %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
  }

  v19 = [v7 transactionResult];
  [v19 markChanged];
  [v7 respondWithPayload:0];

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetAppData:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v21 = 0;
  v5 = [v4 appDataDictionaryWithError:&v21];
  v6 = v21;
  if (v5)
  {
    v7 = [(HMDHome *)self _appDataContainerForMessage:v4];
    if (v7)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543874;
        v23 = v11;
        v24 = 2112;
        v25 = v7;
        v26 = 2112;
        v27 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Going to update appData for %@ to: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v8);
      v12 = [v7 appData];
      v13 = [v7 uuid];
      v14 = [HMDApplicationDataModel modelWithAppDataPayload:v5 existingAppData:v12 parentUUID:v13];
      if (v14)
      {
        v15 = [(HMDHome *)v9 backingStore];
        v16 = [v4 name];
        v17 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        [v15 transaction:v16 options:v17];
        v18 = v20 = v6;

        [v18 add:v14 withMessage:v4];
        [v18 run];

        v6 = v20;
      }

      else
      {
        [v4 respondWithSuccess];
      }
    }

    else
    {
      v12 = [v4 responseHandler];
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (v12)[2](v12, v13, 0);
    }
  }

  else
  {
    [v4 respondWithError:v6];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (id)_appDataContainerForMessage:(id)a3
{
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD0D40]];
  if (v5)
  {
    v6 = [(HMDHome *)self roomWithUUID:v5];
  }

  else
  {
    v7 = [v4 uuidForKey:*MEMORY[0x277CD25E0]];
    if (v7)
    {
      v6 = [(HMDHome *)self serviceGroupWithUUID:v7];
    }

    else
    {
      v8 = [v4 uuidForKey:*MEMORY[0x277CD2050]];
      if (v8)
      {
        v9 = [(HMDHome *)self actionSetWithUUID:v8];
      }

      else
      {
        v9 = self;
      }

      v6 = v9;
    }
  }

  return v6;
}

- (void)_handleAllowUserManagementMessage:(id)a3
{
  v14 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self isAdminUser])
  {
    v5 = [v4 responseHandler];
    v5[2](v5, 0, MEMORY[0x277CBEC10]);
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v9;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to allow user management, insufficient privileges", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    v10 = [v4 responseHandler];
    v10[2](v10, v5, MEMORY[0x277CBEC10]);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleExecuteConfirmationOfTrigger:(id)a3
{
  v61 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (([(__CFString *)v4 isEntitledForSPIAccess]& 1) != 0 || ([(__CFString *)v4 isRemote]& 1) != 0)
  {
    v5 = [(__CFString *)v4 uuidForKey:*MEMORY[0x277CD2768]];
    v6 = [(HMDHome *)self triggers];
    v7 = [v6 hmf_firstObjectWithSPIUniqueIdentifier:v5];

    v8 = v7;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    if (isWatch() || isWatch() && ([v10 hasUserConfirmationSession] & 1) == 0)
    {
      v11 = objc_autoreleasePoolPush();
      v12 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v15 = isWatch();
        v16 = @"non-Tinker HH2";
        *buf = 138543874;
        v56 = v14;
        v57 = 2112;
        if (v15)
        {
          v16 = @"Legacy";
        }

        v58 = v16;
        v59 = 2112;
        v60 = v4;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Received trigger execution confirmation for relay in %@ Watch, %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v11);
      v17 = [(HMDHome *)v12 homeManager];
      v18 = [v17 companionDevice];
      if (v18 && [v17 companionReachable])
      {
        v48 = v10;
        v49 = v5;
        v19 = [HMDRemoteDeviceMessageDestination alloc];
        v20 = [(HMDHome *)v12 uuid];
        v21 = [(HMDRemoteDeviceMessageDestination *)v19 initWithTarget:v20 device:v18];

        v22 = MEMORY[0x277D0F818];
        v23 = [(__CFString *)v4 messagePayload];
        v24 = [v23 copy];
        v25 = [v22 messageWithName:@"kConfirmExecuteTriggerRequestKey" qualityOfService:25 destination:v21 payload:v24];

        v53[0] = MEMORY[0x277D85DD0];
        v53[1] = 3221225472;
        v53[2] = __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke;
        v53[3] = &unk_279734E00;
        v54 = v4;
        [v25 setResponseHandler:v53];
        v26 = objc_autoreleasePoolPush();
        v27 = v12;
        v28 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
        {
          v29 = HMFGetLogIdentifier();
          *buf = 138543362;
          v56 = v29;
          _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Sending confirmation to companion", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v26);
        v30 = [v17 messageDispatcher];
        [v30 sendMessage:v25 completionHandler:0];

        v10 = v48;
        v5 = v49;
      }

      else
      {
        v21 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:63 userInfo:0];
        v39 = [(__CFString *)v4 responseHandler];
        v25 = v39;
        if (v39)
        {
          (*(v39 + 16))(v39, v21, 0);
        }
      }
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      v32 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v35 = v34 = v10;
        *buf = 138543618;
        v56 = v35;
        v57 = 2112;
        v58 = v4;
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Received trigger execution confirmation on iOS or HH2 Watch: %@", buf, 0x16u);

        v10 = v34;
      }

      objc_autoreleasePoolPop(v31);
      if (v8)
      {
        v36 = v10;
        v37 = [(__CFString *)v4 BOOLForKey:*MEMORY[0x277CD2740]];
        v50[0] = MEMORY[0x277D85DD0];
        v50[1] = 3221225472;
        v50[2] = __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke_1405;
        v50[3] = &unk_2797358C8;
        v51 = v8;
        v52 = v4;
        v38 = v37;
        v10 = v36;
        [v51 userDidConfirmExecute:v38 completionHandler:v50];

        v17 = v51;
      }

      else
      {
        v17 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
        v46 = [(__CFString *)v4 responseHandler];
        v47 = v46;
        if (v46)
        {
          (*(v46 + 16))(v46, v17, 0);
        }
      }
    }

    goto LABEL_26;
  }

  v41 = objc_autoreleasePoolPush();
  v42 = self;
  v43 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v43, OS_LOG_TYPE_ERROR))
  {
    v44 = HMFGetLogIdentifier();
    *buf = 138543362;
    v56 = v44;
    _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI and it's not relayed from watch.", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v41);
  v45 = [(__CFString *)v4 responseHandler];

  if (v45)
  {
    v5 = [(__CFString *)v4 responseHandler];
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    (v5)[2](v5, v8, 0);
LABEL_26:
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  v3 = [*(a1 + 32) responseHandler];
  v4 = v3;
  if (v3)
  {
    (*(v3 + 16))(v3, v5, 0);
  }
}

void __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke_1405(uint64_t a1, void *a2)
{
  v5 = a2;
  if (v5 && isiOSDevice())
  {
    +[HMDBulletinUIManager presentExecutionErrorDialogForTrigger:partialSuccess:](HMDBulletinUIManager, "presentExecutionErrorDialogForTrigger:partialSuccess:", *(a1 + 32), [v5 code] == 64);
  }

  v3 = [*(a1 + 40) responseHandler];
  v4 = v3;
  if (v3)
  {
    (*(v3 + 16))(v3, v5, 0);
  }
}

- (void)_removeTrigger:(id)a3 message:(id)a4
{
  v34 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (v6)
  {
    [(HMDHome *)self removeTriggerNoNotification:v6];
    v8 = [v7 transactionResult];
    [v8 markChanged];
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v12;
      v32 = 2112;
      v33 = v6;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Remove trigger: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v13 = [(HMDHome *)v10 uuid];
    v14 = [v13 UUIDString];
    v29[0] = v14;
    v28[1] = *MEMORY[0x277CD2758];
    v15 = [v6 name];
    v29[1] = v15;
    v28[2] = *MEMORY[0x277CD2768];
    v16 = [v6 uuid];
    v17 = [v16 UUIDString];
    v29[2] = v17;
    v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:3];

    v19 = objc_autoreleasePoolPush();
    v20 = v10;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v22;
      v32 = 2112;
      v33 = v18;
      _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Successfully Removed trigger : sending back the result: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    [v7 respondWithPayload:v18];
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    v24 = self;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v26;
      v32 = 2112;
      v33 = 0;
      _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Could not find the Trigger : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    v8 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    [v7 respondWithError:v8];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)removeTriggerNoNotification:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v9 = v4;
    [v4 invalidate];
    v5 = [v9 name];
    v6 = [(HMDHome *)self removeName:v5];

    [(HMDHome *)self removeFromCurrentTriggers:v9];
    os_unfair_recursive_lock_lock_with_options();
    ownedTriggers = self->_ownedTriggers;
    v8 = [v9 uuid];
    [(NSMutableArray *)ownedTriggers removeObject:v8];

    os_unfair_recursive_lock_unlock();
    v4 = v9;
  }
}

- (void)removeTrigger:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __25__HMDHome_removeTrigger___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __25__HMDHome_removeTrigger___block_invoke(uint64_t a1)
{
  v12[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277D0F818];
  v3 = objc_alloc(MEMORY[0x277D0F820]);
  v4 = [*(a1 + 32) uuid];
  v5 = [v3 initWithTarget:v4];
  v11 = *MEMORY[0x277CD2768];
  v6 = [*(a1 + 40) uuid];
  v7 = [v6 UUIDString];
  v12[0] = v7;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:&v11 count:1];
  v9 = [v2 messageWithName:@"kRemoveTriggerRequestKey" destination:v5 payload:v8];

  [*(a1 + 32) _handleRemoveTrigger:v9];
  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveTriggerModel:(id)a3 message:(id)a4
{
  v21 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 uuid];
  v9 = [(HMDHome *)self triggerWithUUID:v8];

  if (v9)
  {
    [(HMDHome *)self _removeTrigger:v9 message:v7];
    v10 = [v7 transactionResult];
    [v10 markChanged];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v6 uuid];
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = v15;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Couldn't find trigger with UUID %@ to remove.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v7 respondWithError:v10];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveTrigger:(id)a3
{
  v25 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD2768]];
  v6 = [(HMDHome *)self triggerWithUUID:v5];
  if (v6)
  {
    v7 = [HMDTriggerModel alloc];
    v8 = [v6 uuid];
    v9 = [(HMDHome *)self uuid];
    v10 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v8 parentUUID:v9];

    v11 = [(HMDHome *)self backingStore];
    v12 = [v4 name];
    v13 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v14 = [v11 transaction:v12 options:v13];

    [v14 add:v10 withMessage:v4];
    [v14 run];
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v18;
      v23 = 2112;
      v24 = v5;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Cannot find the trigger with UUID %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v19];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_addNewTrigger:(id)a3 message:(id)a4 payloadAnnex:(id)a5 triggerModel:(id)a6
{
  v43 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  [(HMDHome *)self addToCurrentTriggers:v10];
  os_unfair_recursive_lock_lock_with_options();
  ownedTriggers = self->_ownedTriggers;
  v15 = [v10 uuid];
  if (([(NSMutableArray *)ownedTriggers containsObject:v15]& 1) == 0)
  {
    v16 = [v10 owner];
    v17 = [v16 isOwner];

    if (!v17)
    {
      goto LABEL_5;
    }

    v18 = self->_ownedTriggers;
    v15 = [v10 uuid];
    [(NSMutableArray *)v18 addObject:v15];
  }

LABEL_5:
  os_unfair_recursive_lock_unlock();
  v19 = [(HMDHome *)self msgDispatcher];
  v20 = [(HMDHome *)self workQueue];
  [v10 configure:self messageDispatcher:v19 queue:v20];

  v21 = [v11 transactionResult];
  [v21 markChanged];
  v22 = [v11 name];
  if ([v22 isEqualToString:@"kAddEventTriggerRequestKey"])
  {
  }

  else
  {
    v23 = [v11 name];
    v24 = [v23 isEqualToString:@"kAddTimerTriggerRequestKey"];

    if ((v24 & 1) == 0)
    {
      [v11 respondWithSuccess];
      goto LABEL_14;
    }
  }

  v25 = objc_autoreleasePoolPush();
  v26 = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
  {
    v28 = HMFGetLogIdentifier();
    v29 = [v10 name];
    v37 = 138543874;
    v38 = v28;
    v39 = 2112;
    v40 = v29;
    v41 = 2112;
    v42 = v11;
    _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Add trigger Transaction marked for change. The client will be updated next: %@, %@", &v37, 0x20u);
  }

  objc_autoreleasePoolPop(v25);
  v30 = MEMORY[0x277CBEB38];
  v31 = [v11 messagePayload];
  v32 = [v30 dictionaryWithDictionary:v31];

  v33 = HMDRemoteMessagePayloadKeysForTransportMetadata();
  [v32 removeObjectsForKeys:v33];

  v34 = [v10 uuid];
  v35 = [v34 UUIDString];
  [v32 setObject:v35 forKey:*MEMORY[0x277CD2768]];

  if (v12)
  {
    [v32 addEntriesFromDictionary:v12];
  }

  [v11 respondWithPayload:v32];

LABEL_14:
  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTriggers:(id)a3
{
  v105[2] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dataForKey:@"HM.triggers"];
  v71 = v4;
  if (v5)
  {
    v6 = MEMORY[0x277CCAAC8];
    v7 = MEMORY[0x277CBEB98];
    v105[0] = objc_opt_class();
    v105[1] = objc_opt_class();
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v105 count:2];
    v9 = [v7 setWithArray:v8];
    v95 = 0;
    v69 = v5;
    v10 = [v6 unarchivedObjectOfClasses:v9 fromData:v5 error:&v95];
    v70 = v95;

    v11 = v10;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v12 = v11;
    }

    else
    {
      v12 = 0;
    }

    v13 = v12;

    v14 = objc_autoreleasePoolPush();
    v80 = self;
    v15 = HMFGetOSLogHandle();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_INFO);
    v68 = v13;
    if (v13)
    {
      v67 = v11;
      if (v16)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543618;
        v100 = v17;
        v101 = 2112;
        v102 = v13;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Received triggers %@ from shared admin to add", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
      v18 = [(HMDHome *)v80 backingStore];
      v19 = [v71 name];
      v20 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v21 = [v18 transaction:v19 options:v20];

      v93 = 0u;
      v94 = 0u;
      v91 = 0u;
      v92 = 0u;
      obj = v13;
      v74 = [obj countByEnumeratingWithState:&v91 objects:v98 count:16];
      if (v74)
      {
        v73 = *v92;
        v79 = v21;
        do
        {
          v22 = 0;
          do
          {
            if (*v92 != v73)
            {
              objc_enumerationMutation(obj);
            }

            v76 = v22;
            v23 = *(*(&v91 + 1) + 8 * v22);
            [v23 setHome:{v80, v67}];
            v89 = 0u;
            v90 = 0u;
            v87 = 0u;
            v88 = 0u;
            v24 = [(HMDHome *)v80 accessories];
            v25 = [v24 countByEnumeratingWithState:&v87 objects:v97 count:16];
            if (v25)
            {
              v26 = v25;
              v27 = *v88;
              do
              {
                for (i = 0; i != v26; ++i)
                {
                  if (*v88 != v27)
                  {
                    objc_enumerationMutation(v24);
                  }

                  [v23 fixupForReplacementAccessory:*(*(&v87 + 1) + 8 * i) transaction:v21];
                }

                v26 = [v24 countByEnumeratingWithState:&v87 objects:v97 count:16];
              }

              while (v26);
            }

            v29 = [v23 modelObjectWithChangeType:1];
            [v21 add:v29 withMessage:0];
            v30 = v23;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v31 = v30;
            }

            else
            {
              v31 = 0;
            }

            v32 = v31;
            v77 = v30;

            v85 = 0u;
            v86 = 0u;
            v83 = 0u;
            v84 = 0u;
            v75 = v32;
            v78 = [v32 events];
            v33 = [v78 countByEnumeratingWithState:&v83 objects:v96 count:16];
            if (v33)
            {
              v34 = v33;
              v35 = *v84;
              do
              {
                v36 = 0;
                v37 = v29;
                do
                {
                  if (*v84 != v35)
                  {
                    objc_enumerationMutation(v78);
                  }

                  v38 = *(*(&v83 + 1) + 8 * v36);
                  v39 = objc_autoreleasePoolPush();
                  v40 = v80;
                  v41 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
                  {
                    HMFGetLogIdentifier();
                    v43 = v42 = v35;
                    v44 = [v77 name];
                    *buf = 138543874;
                    v100 = v43;
                    v101 = 2112;
                    v102 = v38;
                    v103 = 2112;
                    v104 = v44;
                    _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Adding %@ to trigger %@", buf, 0x20u);

                    v35 = v42;
                  }

                  objc_autoreleasePoolPop(v39);
                  v29 = [v38 modelObjectWithChangeType:1];

                  v21 = v79;
                  [v79 add:v29 withMessage:0];
                  ++v36;
                  v37 = v29;
                }

                while (v34 != v36);
                v34 = [v78 countByEnumeratingWithState:&v83 objects:v96 count:16];
              }

              while (v34);
            }

            v45 = [HomeKitEventTriggerAddLogEvent alloc];
            v46 = [(HMDHome *)v80 uuid];
            v47 = [(HomeKitEventTriggerAddLogEvent *)v45 initWithHomeUUID:v46];

            v48 = [[HMDAnalyticsEventTriggerData alloc] initWithEventTrigger:v75 isAdding:1];
            v49 = [(HomeKitEventTriggerAddLogEvent *)v47 analyticsData];
            [v49 setEventTrigger:v48];

            v50 = [(HomeKitEventTriggerAddLogEvent *)v47 analyticsData];
            [v50 setResultErrorCode:0];

            v51 = [(HomeKitEventTriggerAddLogEvent *)v47 analyticsData];
            [v51 setRequestOrigin:3];

            v52 = [(HMDHome *)v80 logEventSubmitter];
            [v52 submitLogEvent:v47];

            v22 = v76 + 1;
          }

          while (v76 + 1 != v74);
          v74 = [obj countByEnumeratingWithState:&v91 objects:v98 count:16];
        }

        while (v74);
      }

      v81[0] = MEMORY[0x277D85DD0];
      v81[1] = 3221225472;
      v81[2] = __30__HMDHome__handleAddTriggers___block_invoke;
      v81[3] = &unk_2797359D8;
      v4 = v71;
      v82 = v71;
      [v21 run:v81];
      v53 = v82;
      v11 = v67;
    }

    else
    {
      v4 = v71;
      if (v16)
      {
        v62 = HMFGetLogIdentifier();
        [v71 identifier];
        v64 = v63 = v11;
        v65 = [v64 UUIDString];
        *buf = 138543874;
        v100 = v62;
        v101 = 2112;
        v102 = v65;
        v103 = 2112;
        v104 = v70;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Failed to unarchive triggers from encoded triggers data: %@: %@", buf, 0x20u);

        v11 = v63;
        v4 = v71;
      }

      objc_autoreleasePoolPop(v14);
      v21 = [v4 responseHandler];
      v53 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (v21)[2](v21, v53, 0);
    }

    v5 = v69;
    v61 = v70;
    v60 = v68;
  }

  else
  {
    v54 = objc_autoreleasePoolPush();
    v55 = self;
    v56 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
    {
      v57 = HMFGetLogIdentifier();
      v58 = [v4 identifier];
      v59 = [v58 UUIDString];
      *buf = 138543618;
      v100 = v57;
      v101 = 2112;
      v102 = v59;
      _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_INFO, "%{public}@Unable to find triggers to add for message: %@", buf, 0x16u);

      v4 = v71;
      v5 = 0;
    }

    objc_autoreleasePoolPop(v54);
    v60 = [v4 responseHandler];
    v61 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (v60)[2](v60, v61, 0);
  }

  v66 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTimerTriggerModel:(id)a3 message:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [[HMDTimerTrigger alloc] initWithModel:v6 home:self];
  if (v8)
  {
    v9 = [v6 createPayload];
    [(HMDHome *)self _addNewTrigger:v8 message:v7 payloadAnnex:v9 triggerModel:v6];
LABEL_7:

    goto LABEL_8;
  }

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v17 = 138543362;
    v18 = v13;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Could not create timer trigger object from model", &v17, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  v14 = [v7 responseHandler];

  if (v14)
  {
    v9 = [v7 responseHandler];
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (v9)[2](v9, v15, 0);

    goto LABEL_7;
  }

LABEL_8:

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTimerTrigger:(id)a3
{
  v42 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 name];
  v6 = [v5 isEqualToString:*MEMORY[0x277CCF200]];

  v7 = [v4 stringForKey:*MEMORY[0x277CD2758]];
  if ([(HMDHome *)self _validateAddingNewTriggerWithName:v7 message:v4])
  {
    v8 = [v4 stringForKey:*MEMORY[0x277CD1250]];
    v9 = [MEMORY[0x277CCAD78] UUID];
    v10 = [HMDTimerTriggerModel alloc];
    v11 = [(HMDHome *)self uuid];
    v12 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:1 uuid:v9 parentUUID:v11];

    [(HMDTimerTriggerModel *)v12 setName:v7];
    [(HMDTimerTriggerModel *)v12 setConfiguredName:v8];
    [(HMDTimerTriggerModel *)v12 setActive:MEMORY[0x277CBEC28]];
    v13 = [HMDTimerTrigger validateTriggerModel:v12 message:v4 currentFireDate:0];

    if (!v13)
    {
LABEL_21:

      goto LABEL_22;
    }

    v35 = v9;
    v14 = v8;
    v15 = [(HMDHome *)self backingStore];
    v16 = [v4 name];
    v17 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v18 = [v15 transaction:v16 options:v17];

    v19 = v6;
    if (v6)
    {
      v20 = objc_alloc_init(MEMORY[0x277CBEB38]);
      v21 = [(HMDHome *)self _populateTriggerModel:v13 fromBuilderMessage:v4 transaction:v18 responsePayload:v20];
      v22 = v18;
      v8 = v14;
      v9 = v35;
      if (!v21)
      {
LABEL_20:

        goto LABEL_21;
      }
    }

    else
    {
      v20 = 0;
      v22 = v18;
      v8 = v14;
      v9 = v35;
    }

    v27 = [(HMDHome *)self currentUser];
    [v13 setOwner:v27];

    v28 = [(HMDHome *)self currentDevice];
    [v13 setOwningDevice:v28];

    if ([(HMDHome *)self isOwnerUser])
    {
      if (v19)
      {
        [v22 add:v13];
        v36[0] = MEMORY[0x277D85DD0];
        v36[1] = 3221225472;
        v36[2] = __34__HMDHome__handleAddTimerTrigger___block_invoke;
        v36[3] = &unk_279734D88;
        v37 = v4;
        v20 = v20;
        v38 = v20;
        v39 = v13;
        [v22 run:v36];
      }

      else
      {
        [v22 add:v13 withMessage:v4];
        [v22 run];
      }
    }

    else if ([(HMDHome *)self isAdminUser])
    {
      v29 = v22;
      [(HMDHome *)self transactionObjectUpdated:0 newValues:v13 message:v4];
      v30 = [v13 uuid];
      v31 = [(HMDHome *)self triggerWithUUID:v30];

      if (v31)
      {
        [(HMDHome *)self _relayAddTriggerToResident:v31];
      }

      v22 = v29;
    }

    else
    {
      v32 = [v4 responseHandler];

      if (v32)
      {
        v33 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
        [v4 respondWithError:v33];
      }
    }

    goto LABEL_20;
  }

  v23 = objc_autoreleasePoolPush();
  v24 = self;
  v25 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
  {
    v26 = HMFGetLogIdentifier();
    *buf = 138543362;
    v41 = v26;
    _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Trigger name is not valid", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v23);
LABEL_22:

  v34 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddTimerTrigger___block_invoke(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v4 = *(a1 + 40);
    v5 = [*(a1 + 48) createPayload];
    [v4 addEntriesFromDictionary:v5];

    v6 = *(a1 + 32);
    v7 = [*(a1 + 40) copy];
    [v6 respondWithPayload:v7];
  }
}

- (void)_relayAddTriggerToResident:(id)a3
{
  v24[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v24[0] = v4;
  v5 = [MEMORY[0x277CBEA60] arrayWithObjects:v24 count:1];
  v6 = encodeRootObject();

  v22 = @"HM.triggers";
  v23 = v6;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v23 forKeys:&v22 count:1];
  objc_initWeak(&location, self);
  v8 = MEMORY[0x277D0F848];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __38__HMDHome__relayAddTriggerToResident___block_invoke;
  v18[3] = &unk_279733AE8;
  objc_copyWeak(&v20, &location);
  v9 = v4;
  v19 = v9;
  v10 = [v8 messageWithName:@"kAddTriggersInternalRequestKey" messagePayload:v7 responseHandler:v18];
  v11 = objc_alloc(MEMORY[0x277D0F820]);
  v12 = [(HMDHome *)self uuid];
  v13 = [v11 initWithTarget:v12];

  [v10 setDestination:v13];
  [v10 setQualityOfService:33];
  v14 = [(HMDHome *)self administratorHandler];
  v15 = [v10 copy];
  v16 = [v14 operationForMessage:v15 error:0];

  if (v16)
  {
    [v14 addOperation:v16];
  }

  objc_destroyWeak(&v20);
  objc_destroyWeak(&location);

  v17 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__relayAddTriggerToResident___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = @"kAddTriggersInternalRequestKey";
      v20 = 2112;
      v21 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Relayed message %@ with error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    if (v5)
    {
      v12 = [v9 workQueue];
      v14[0] = MEMORY[0x277D85DD0];
      v14[1] = 3221225472;
      v14[2] = __38__HMDHome__relayAddTriggerToResident___block_invoke_1393;
      v14[3] = &unk_2797359B0;
      v14[4] = v9;
      v15 = *(a1 + 32);
      dispatch_async(v12, v14);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__relayAddTriggerToResident___block_invoke_1393(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v15 = 138543618;
    v16 = v5;
    v17 = 2112;
    v18 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Removing trigger that was not added to resident: %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = [HMDTriggerModel alloc];
  v8 = [*(a1 + 40) uuid];
  v9 = [*(a1 + 32) uuid];
  v10 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v8 parentUUID:v9];

  v11 = [*(a1 + 32) backingStore];
  v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v13 = [v11 transaction:@"relayAddTrigger" options:v12];

  [v13 add:v10 withMessage:0];
  [v13 run];

  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)_validateAddingNewTriggerWithName:(id)a3 message:(id)a4
{
  v34 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (v6)
  {
    if ([v6 length])
    {
      v8 = HMMaxLengthForNaming();
      if ([v6 length] > v8)
      {
        v9 = objc_autoreleasePoolPush();
        v10 = self;
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
        {
          v12 = HMFGetLogIdentifier();
          v30 = 138543362;
          v31 = v12;
          _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v30, 0xCu);
        }

        objc_autoreleasePoolPop(v9);
        v13 = MEMORY[0x277CCA9B8];
        v14 = 46;
        goto LABEL_9;
      }

      v19 = [(HMDHome *)self triggerWithName:v6];
      if (v19)
      {
        v20 = MEMORY[0x277CCA9B8];
        v21 = 1;
      }

      else
      {
        v22 = [(HMDHome *)self triggers];
        v23 = [v22 count];
        v24 = maximumTriggersPerHome;

        if (v23 < v24)
        {
          v16 = 1;
LABEL_19:

          goto LABEL_10;
        }

        v25 = objc_autoreleasePoolPush();
        v26 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          v30 = 138543618;
          v31 = v28;
          v32 = 2112;
          v33 = v6;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Can't add trigger %@; already at maximum triggers for home", &v30, 0x16u);
        }

        objc_autoreleasePoolPop(v25);
        v20 = MEMORY[0x277CCA9B8];
        v21 = 49;
      }

      v29 = [v20 hmErrorWithCode:v21];
      [v7 respondWithError:v29];

      v16 = 0;
      goto LABEL_19;
    }

    v13 = MEMORY[0x277CCA9B8];
    v14 = 3;
  }

  else
  {
    v13 = MEMORY[0x277CCA9B8];
    v14 = 20;
  }

LABEL_9:
  v15 = [v13 hmErrorWithCode:v14];
  [v7 respondWithError:v15];

  v16 = 0;
LABEL_10:

  v17 = *MEMORY[0x277D85DE8];
  return v16;
}

- (void)_handleAddEventTriggerModel:(id)a3 message:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [[HMDEventTrigger alloc] initWithModel:v6 home:self message:v7];
  if (v8)
  {
    v9 = [v6 createPayload];
    [(HMDHome *)self _addNewTrigger:v8 message:v7 payloadAnnex:v9 triggerModel:v6];
LABEL_7:

    goto LABEL_8;
  }

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v17 = 138543362;
    v18 = v13;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Could not create event trigger object from model", &v17, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  v14 = [v7 responseHandler];

  if (v14)
  {
    v9 = [v7 responseHandler];
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (v9)[2](v9, v15, 0);

    goto LABEL_7;
  }

LABEL_8:

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)_populateTriggerModel:(id)a3 fromBuilderMessage:(id)a4 transaction:(id)a5 responsePayload:(id)a6
{
  v76 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a4;
  v60 = a5;
  v62 = a6;
  v12 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v11, "BOOLForKey:", *MEMORY[0x277CD2730])}];
  [v10 setActive:v12];

  v13 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v11, "BOOLForKey:", *MEMORY[0x277CD1260])}];
  [v10 setAutoDelete:v13];

  v64 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  v70 = 0u;
  v61 = v11;
  obj = [v11 arrayForKey:*MEMORY[0x277CD2728]];
  v14 = [obj countByEnumeratingWithState:&v67 objects:v75 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v68;
    v59 = v10;
    while (2)
    {
      for (i = 0; i != v15; ++i)
      {
        if (*v68 != v16)
        {
          objc_enumerationMutation(obj);
        }

        v18 = *(*(&v67 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (!v20)
        {
          goto LABEL_18;
        }

        v21 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v20];
        if (!v21)
        {
          v20 = v18;
LABEL_18:
          v40 = objc_autoreleasePoolPush();
          v41 = self;
          v42 = HMFGetOSLogHandle();
          v29 = v60;
          v28 = v61;
          if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
          {
            v43 = HMFGetLogIdentifier();
            *buf = 138543618;
            v72 = v43;
            v73 = 2112;
            v74 = v20;
            _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_ERROR, "%{public}@Invalid ActionSet reference: '%@'", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v40);
          v44 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          [v61 respondWithError:v44];

          v45 = 0;
          v10 = v59;
          goto LABEL_29;
        }

        v22 = v21;
        v23 = [(HMDHome *)self actionSetWithUUID:v21];
        if (!v23)
        {
          v46 = objc_autoreleasePoolPush();
          v47 = self;
          v48 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
          {
            v49 = HMFGetLogIdentifier();
            *buf = 138543618;
            v72 = v49;
            v73 = 2112;
            v74 = v22;
            _os_log_impl(&dword_2531F8000, v48, OS_LOG_TYPE_ERROR, "%{public}@Failed to resolve ActionSet reference: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v46);
          v50 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v28 = v61;
          [v61 respondWithError:v50];

          v45 = 0;
          v10 = v59;
          v29 = v60;
          goto LABEL_29;
        }

        v24 = v23;
        v25 = [v23 uuid];
        v26 = [v25 UUIDString];
        [v64 addObject:v26];
      }

      v15 = [obj countByEnumeratingWithState:&v67 objects:v75 count:16];
      v10 = v59;
      if (v15)
      {
        continue;
      }

      break;
    }
  }

  v27 = *MEMORY[0x277CD2760];
  v28 = v61;
  [v61 dictionaryForKey:*MEMORY[0x277CD2760]];
  obj = v29 = v60;
  if (!obj)
  {
    goto LABEL_28;
  }

  v30 = [MEMORY[0x277CCAD78] UUID];
  v31 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:v30];
  v32 = [v31 UUIDString];

  v33 = *MEMORY[0x277CCF1A0];
  v65 = 0;
  v66 = 0;
  v34 = self;
  v35 = v32;
  v36 = [(HMDHome *)v34 _createActionSetWithUUID:v30 name:v32 type:v33 fromDictionary:obj transaction:v60 response:&v66 error:&v65];
  v37 = v66;
  v38 = v65;

  if (v36)
  {
    [v62 setObject:v37 forKeyedSubscript:v27];
    v39 = [v30 UUIDString];
    [v64 addObject:v39];
  }

  else
  {
    v58 = v35;
    v51 = v10;
    context = objc_autoreleasePoolPush();
    v52 = v34;
    v53 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v53, OS_LOG_TYPE_ERROR))
    {
      v54 = HMFGetLogIdentifier();
      *buf = 138543362;
      v72 = v54;
      _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_ERROR, "%{public}@Failed to create trigger-owned action set", buf, 0xCu);
    }

    objc_autoreleasePoolPop(context);
    [v61 respondWithError:v38];
    v10 = v51;
    v35 = v58;
  }

  if (!v36)
  {
    v45 = 0;
  }

  else
  {
LABEL_28:
    v20 = [v64 copy];
    [v10 setCurrentActionSets:v20];
    v45 = 1;
LABEL_29:
  }

  v55 = *MEMORY[0x277D85DE8];
  return v45;
}

- (HMDActionSet)_createActionSetWithUUID:(void *)a3 name:(void *)a4 type:(void *)a5 fromDictionary:(void *)a6 transaction:(void *)a7 response:(void *)a8 error:
{
  v69 = *MEMORY[0x277D85DE8];
  v13 = a2;
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v57 = v16;
  v59 = v17;
  if (a1)
  {
    v18 = v17;
    v55 = v15;
    v19 = [[HMDActionSet alloc] initWithName:v14 uuid:v13 type:v15 home:a1 queue:0];
    v20 = [(HMDActionSet *)v19 modelObjectWithChangeType:1];
    [v18 add:v20];

    v21 = [v16 hmf_arrayForKey:*MEMORY[0x277CD2030]];
    v22 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{objc_msgSend(v21, "count")}];
    v60 = 0u;
    v61 = 0u;
    v62 = 0u;
    v63 = 0u;
    obj = v21;
    v23 = [obj countByEnumeratingWithState:&v60 objects:v68 count:16];
    if (v23)
    {
      v24 = v23;
      v25 = *v61;
      v54 = v13;
LABEL_4:
      v26 = 0;
      while (1)
      {
        if (*v61 != v25)
        {
          objc_enumerationMutation(obj);
        }

        v27 = *(*(&v60 + 1) + 8 * v26);
        objc_opt_class();
        v28 = (objc_opt_isKindOfClass() & 1) != 0 ? v27 : 0;
        v29 = v28;

        if (!v29)
        {
          break;
        }

        v30 = [a1 actionWithDictionaryRepresentation:v29];
        if (!v30)
        {
          v43 = objc_autoreleasePoolPush();
          v44 = a1;
          v45 = HMFGetOSLogHandle();
          v13 = v54;
          v15 = v55;
          if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
          {
            v46 = HMFGetLogIdentifier();
            *buf = 138543618;
            v65 = v46;
            v66 = 2112;
            v67 = v29;
            _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_ERROR, "%{public}@Failed to deserialize action: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v43);
          if (a8)
          {
            *a8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          }

          v42 = obj;
LABEL_30:

          v37 = 0;
          goto LABEL_40;
        }

        v31 = v30;
        [v22 addObject:v30];
        [v31 updateActionSetIfNil:v19];
        v32 = [v31 modelObjectWithChangeType:1];
        [v59 add:v32];

        if (v24 == ++v26)
        {
          v24 = [obj countByEnumeratingWithState:&v60 objects:v68 count:16];
          v13 = v54;
          if (v24)
          {
            goto LABEL_4;
          }

          goto LABEL_14;
        }
      }

      v38 = objc_autoreleasePoolPush();
      v39 = a1;
      v40 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
      {
        v41 = HMFGetLogIdentifier();
        *buf = 138543618;
        v65 = v41;
        v66 = 2112;
        v67 = v14;
        _os_log_impl(&dword_2531F8000, v40, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; invalid serialized action", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v38);
      v13 = v54;
      v15 = v55;
      v42 = obj;
      if (a8)
      {
        *a8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      }

      goto LABEL_30;
    }

LABEL_14:

    [(HMDActionSet *)v19 setActions:v22];
    if ([a1 validateActionsDoNotConflict:v22])
    {
      v33 = [v57 hmd_appDataDictionaryWithError:a8];
      if (v33)
      {
        v34 = [HMDApplicationDataModel modelWithAppDataPayload:v33 existingAppData:0 parentUUID:v13];
        if (v34)
        {
          [v59 add:v34];
        }

        v15 = v55;
        if (a7)
        {
          v35 = [(HMDActionSet *)v19 createPayload];
          v36 = [v35 mutableCopy];

          [v36 setObject:v33 forKeyedSubscript:@"kAppDataInformationKey"];
          *a7 = [v36 copy];
        }

        v37 = v19;
      }

      else
      {
        v37 = 0;
        v15 = v55;
      }
    }

    else
    {
      v47 = objc_autoreleasePoolPush();
      v48 = a1;
      v49 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v49, OS_LOG_TYPE_ERROR))
      {
        v50 = HMFGetLogIdentifier();
        *buf = 138543618;
        v65 = v50;
        v66 = 2112;
        v67 = v14;
        _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; conflicting actions", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v47);
      if (a8)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        *a8 = v37 = 0;
      }

      else
      {
        v37 = 0;
      }

      v15 = v55;
    }

    v42 = obj;
LABEL_40:
  }

  else
  {
    v37 = 0;
  }

  v51 = *MEMORY[0x277D85DE8];

  return v37;
}

- (void)_handleAddEventTrigger:(id)a3
{
  v84 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v79 = v8;
    v80 = 2112;
    v81 = v4;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Received message %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = objc_autoreleasePoolPush();
  v10 = v6;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [v4 messagePayload];
    *buf = 138543618;
    v79 = v12;
    v80 = 2112;
    v81 = v13;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Add event trigger payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = [v4 name];
  v15 = [v14 isEqualToString:*MEMORY[0x277CCF1F0]];

  v16 = [v4 stringForKey:*MEMORY[0x277CD2758]];
  v58 = [v4 stringForKey:*MEMORY[0x277CD1250]];
  v59 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
  v62 = [v4 predicateForKey:*MEMORY[0x277CD2298]];
  v17 = *MEMORY[0x277CD22C8];
  v18 = [v4 numberForKey:*MEMORY[0x277CD22C8]];
  v19 = v18;
  if (v18)
  {
    [v18 unsignedIntegerValue];
    HMDaysOfTheWeekToDateComponents();
  }

  else
  {
    [v4 arrayOfDateComponentsForKey:v17];
  }
  v61 = ;
  v60 = [(HMDHome *)v10 currentUser];
  v20 = [HMDEventTriggerModel alloc];
  v21 = [(HMDHome *)v10 uuid];
  v22 = [(HMDBackingStoreModelObject *)v20 initWithObjectChangeType:1 uuid:v59 parentUUID:v21];

  [(HMDEventTriggerModel *)v22 setName:v16];
  [(HMDEventTriggerModel *)v22 setConfiguredName:v58];
  [(HMDEventTriggerModel *)v22 setActive:MEMORY[0x277CBEC28]];
  [(HMDEventTriggerModel *)v22 setOwner:v60];
  v23 = [(HMDHome *)v10 currentDevice];
  [(HMDEventTriggerModel *)v22 setOwningDevice:v23];

  if (v62)
  {
    v24 = [(HMDHome *)v10 predicateUtility];
    v25 = [v24 rewritePredicateForDaemon:v62 message:v4];

    v26 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v25 requiringSecureCoding:1 error:0];
    [(HMDEventTriggerModel *)v22 setEvaluationCondition:v26];
  }

  v27 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v61 requiringSecureCoding:1 error:0];
  [(HMDEventTriggerModel *)v22 setRecurrences:v27];

  v28 = [v4 mutableCopy];
  objc_initWeak(&location, v10);
  v72[0] = MEMORY[0x277D85DD0];
  v72[1] = 3221225472;
  v72[2] = __34__HMDHome__handleAddEventTrigger___block_invoke;
  v72[3] = &unk_279722608;
  objc_copyWeak(&v75, &location);
  v29 = v4;
  v73 = v29;
  v30 = v22;
  v74 = v30;
  v76 = v15;
  [v28 setResponseHandler:v72];
  if ([(HMDHome *)v10 _validateAddingNewTriggerWithName:v16 message:v28])
  {
    if (!v19 && ![HMDEventTrigger __validateRecurrences:v61])
    {
      v42 = objc_autoreleasePoolPush();
      v43 = v10;
      v44 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
      {
        v45 = HMFGetLogIdentifier();
        *buf = 138543618;
        v79 = v45;
        v80 = 2112;
        v81 = v61;
        _os_log_impl(&dword_2531F8000, v44, OS_LOG_TYPE_ERROR, "%{public}@Received invalid values for recurrences: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v42);
      v34 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v28 respondWithError:v34];
      goto LABEL_40;
    }

    v31 = [(HMDHome *)v10 backingStore];
    v32 = [v29 name];
    v33 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v57 = [v31 transaction:v32 options:v33];

    if (v15)
    {
      v34 = objc_alloc_init(MEMORY[0x277CBEB38]);
      if (![(HMDHome *)v10 _populateTriggerModel:v30 fromBuilderMessage:v28 transaction:v57 responsePayload:v34])
      {
LABEL_39:

LABEL_40:
        goto LABEL_41;
      }

      v35 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v29, "BOOLForKey:", *MEMORY[0x277CD22B8])}];
      [(HMDEventTriggerModel *)v30 setExecuteOnce:v35];
    }

    else
    {
      v34 = 0;
    }

    v36 = [[HMDEventTrigger alloc] initWithModel:v30 home:v10 message:v29];
    v37 = v36;
    if (v15)
    {
      v38 = v57;
    }

    else
    {
      v38 = 0;
    }

    v71 = 0;
    v39 = [(HMDEventTrigger *)v36 addEventsFromMessage:v29 preserveUUIDs:v15 ^ 1u transaction:v38 error:&v71];
    v40 = v71;
    v56 = v40;
    if (v39)
    {
      if ([(HMDEventTrigger *)v37 requiresDataVersion4]&& ![(HMDEventTrigger *)v37 checkSharedEventTriggerActivationResidentRequirement:v29])
      {
        v55 = v37;
        context = objc_autoreleasePoolPush();
        v47 = v10;
        v48 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
        {
          v53 = v34;
          v49 = HMFGetLogIdentifier();
          v50 = [(HMDHome *)v47 primaryResident];
          v51 = [v50 device];
          *buf = 138543874;
          v79 = v49;
          v80 = 2112;
          v81 = v51;
          v82 = 2112;
          v83 = v55;
          _os_log_impl(&dword_2531F8000, v48, OS_LOG_TYPE_INFO, "%{public}@Current resident device %@ does not support shared activation, cannot add the trigger %@", buf, 0x20u);

          v34 = v53;
        }

        objc_autoreleasePoolPop(context);
        v37 = v55;
        goto LABEL_38;
      }

      if ([(HMDHome *)v10 isOwnerUser])
      {
        if (!v15)
        {
          [v57 add:v30 withMessage:v28];
          [v57 run];
          goto LABEL_38;
        }

        [v57 add:v30];
        v63[0] = MEMORY[0x277D85DD0];
        v63[1] = 3221225472;
        v63[2] = __34__HMDHome__handleAddEventTrigger___block_invoke_1392;
        v63[3] = &unk_279722630;
        v64 = v28;
        v65 = v34;
        v66 = v30;
        v67 = v62;
        v68 = v10;
        v69 = v37;
        v70 = v60;
        [v57 run:v63];

        v41 = v64;
        goto LABEL_33;
      }

      if ([(HMDHome *)v10 isAdminUser])
      {
        [(HMDHome *)v10 transactionObjectUpdated:0 newValues:v30 message:v28];
        v46 = [(HMDBackingStoreModelObject *)v30 uuid];
        v41 = [(HMDHome *)v10 triggerWithUUID:v46];

        if (v41)
        {
          [(HMDHome *)v10 _relayAddTriggerToResident:v41];
        }

LABEL_33:
      }
    }

    else
    {
      [v28 respondWithError:v40];
    }

LABEL_38:

    goto LABEL_39;
  }

LABEL_41:

  objc_destroyWeak(&v75);
  objc_destroyWeak(&location);

  v52 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddEventTrigger___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v34 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v28 = 138543874;
    v29 = v11;
    v30 = 2112;
    v31 = v6;
    v32 = 2112;
    v33 = v5;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Responding to the client about add event trigger status : Payload : [%@], error : [%@]", &v28, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 32) respondWithPayload:v6 error:v5];
  if (v9)
  {
    v12 = [[HMDEventTrigger alloc] initWithModel:*(a1 + 40) home:v9 message:*(a1 + 32)];
    v13 = 1;
    [(HMDEventTrigger *)v12 addEventsFromMessage:*(a1 + 32) preserveUUIDs:(*(a1 + 56) & 1) == 0 transaction:0 error:0];
    v14 = [HomeKitEventTriggerAddLogEvent alloc];
    v15 = [v9 uuid];
    v16 = [(HomeKitEventTriggerAddLogEvent *)v14 initWithHomeUUID:v15];

    v17 = [[HMDAnalyticsEventTriggerData alloc] initWithEventTrigger:v12 isAdding:1];
    v18 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v18 setEventTrigger:v17];

    v19 = [v5 code];
    v20 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v20 setResultErrorCode:v19];

    if (([v9 isOwnerUser] & 1) == 0)
    {
      if (![v9 isAdminUser])
      {
LABEL_8:
        v22 = objc_autoreleasePoolPush();
        v23 = v9;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
        {
          v25 = HMFGetLogIdentifier();
          v28 = 138543618;
          v29 = v25;
          v30 = 2112;
          v31 = v16;
          _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Prepared the metric %@, submitting", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v22);
        v26 = [v23 logEventSubmitter];
        [v26 submitLogEvent:v16];

        goto LABEL_11;
      }

      v13 = 2;
    }

    v21 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v21 setRequestOrigin:v13];

    goto LABEL_8;
  }

LABEL_11:

  v27 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddEventTrigger___block_invoke_1392(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v4 = *(a1 + 40);
    v5 = [*(a1 + 48) createPayloadWithCondition:*(a1 + 56)];
    [v4 addEntriesFromDictionary:v5];

    v6 = *(a1 + 64);
    v7 = [*(a1 + 72) triggerEvents];
    v8 = [(HMDHome *)v6 _createEventsPayload:v7];
    [*(a1 + 40) setObject:v8 forKeyedSubscript:*MEMORY[0x277CD22B0]];

    v9 = *(a1 + 64);
    v10 = [*(a1 + 72) endEvents];
    v11 = [(HMDHome *)v9 _createEventsPayload:v10];
    [*(a1 + 40) setObject:v11 forKeyedSubscript:*MEMORY[0x277CD22A8]];

    v12 = [*(a1 + 80) uuid];
    v13 = [v12 UUIDString];
    [*(a1 + 40) setObject:v13 forKeyedSubscript:*MEMORY[0x277CD1268]];

    v14 = *(a1 + 32);
    v15 = [*(a1 + 40) copy];
    [v14 respondWithPayload:v15];
  }
}

- (id)_createEventsPayload:(uint64_t)a1
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (a1)
  {
    v4 = objc_alloc_init(MEMORY[0x277CBEB18]);
    v14 = 0u;
    v15 = 0u;
    v16 = 0u;
    v17 = 0u;
    v5 = v3;
    v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v15;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v15 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = [*(*(&v14 + 1) + 8 * i) createPayload];
          [v4 addObject:v10];
        }

        v7 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
      }

      while (v7);
    }

    v11 = [v4 copy];
  }

  else
  {
    v11 = 0;
  }

  v12 = *MEMORY[0x277D85DE8];

  return v11;
}

- (id)_updateAndGetOwnedTriggers
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  v4 = [(HMDHome *)self triggers];
  v5 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v5)
  {
    v6 = *v14;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v13 + 1) + 8 * i);
        if ([v8 isOwnedByThisDevice])
        {
          v9 = [v8 uuid];
          [v3 addObject:v9];
        }
      }

      v5 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v5);
  }

  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_ownedTriggers setArray:v3];
  os_unfair_recursive_lock_unlock();
  v10 = [v3 copy];

  v11 = *MEMORY[0x277D85DE8];

  return v10;
}

- (void)_handleExecuteActionSet:(id)a3
{
  v11 = a3;
  v4 = [v11 uuidForKey:*MEMORY[0x277CD2050]];
  v5 = [(HMDHome *)self actionSetWithUUID:v4];
  if (v5 || isInternalBuild() && ([(HMDHome *)self triggerOwnedActionSetWithUUID:v4], (v5 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v6 = v5;
    v7 = [v5 type];
    if ([v7 isEqualToString:*MEMORY[0x277CCF1A0]])
    {
      v8 = isInternalBuild();

      if ((v8 & 1) == 0)
      {
        v9 = [v11 responseHandler];
        v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
        (v9)[2](v9, v10, 0);

        goto LABEL_10;
      }
    }

    else
    {
    }

    v9 = +[HMDDonationHandler sharedDonationHandler];
    [v9 donateActionSet:v6 withMessage:v11];
    [v6 execute:v11];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    v9 = [v11 responseHandler];
    (v9)[2](v9, v6, 0);
  }

LABEL_10:
}

- (void)executeActionSet:(id)a3
{
  v5 = a3;
  v6 = objc_alloc(MEMORY[0x277D0F770]);
  v7 = MEMORY[0x277CCACA8];
  v8 = MEMORY[0x259C01AE0](self, a2);
  v9 = [v7 stringWithFormat:@"%@, %s:%ld", v8, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 17891];
  v10 = [v6 initWithName:v9];

  v11 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __28__HMDHome_executeActionSet___block_invoke;
  block[3] = &unk_279734960;
  block[4] = self;
  v15 = v5;
  v16 = v10;
  v12 = v10;
  v13 = v5;
  dispatch_async(v11, block);
}

void __28__HMDHome_executeActionSet___block_invoke(id *a1)
{
  objc_initWeak(&location, a1[4]);
  v7 = MEMORY[0x277D85DD0];
  v8 = 3221225472;
  v9 = __28__HMDHome_executeActionSet___block_invoke_2;
  v10 = &unk_279732670;
  objc_copyWeak(&v13, &location);
  v11 = a1[5];
  v12 = a1[6];
  v2 = _Block_copy(&v7);
  if ([a1[4] _shouldWaitForAccessoriesToBeReachable])
  {
    v3 = [a1[5] uuidForKey:*MEMORY[0x277CD2050]];
    v4 = [a1[4] actionSetWithUUID:v3];
    v5 = [a1[4] workQueue];
    v6 = [HMDHomeAssistantOperation homeAssistantOperationWithActionSet:v4 queue:v5];

    [a1[4] _performOperation:v6 completion:v2];
  }

  else
  {
    v2[2](v2);
  }

  objc_destroyWeak(&v13);
  objc_destroyWeak(&location);
}

void __28__HMDHome_executeActionSet___block_invoke_2(id *a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    [a1[5] begin];
    [WeakRetained _handleExecuteActionSet:a1[4]];
    [a1[5] end];
  }

  else
  {
    v3 = [a1[4] responseHandler];

    if (v3)
    {
      v4 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      v5 = [a1[4] responseHandler];
      (v5)[2](v5, v4, 0);
    }

    v6 = objc_autoreleasePoolPush();
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot execute action set", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveActionSetModel:(id)a3 message:(id)a4
{
  v57 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v44 = a4;
  v42 = v6;
  v45 = [v6 uuid];
  v7 = [(HMDHome *)self actionSetWithUUID:v45];
  if (v7 || ([(HMDHome *)self triggerOwnedActionSetWithUUID:v45], (v7 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v8 = [v7 name];
    v9 = [(HMDHome *)self removeName:v8];

    v48 = 0u;
    v49 = 0u;
    v46 = 0u;
    v47 = 0u;
    v10 = [(HMDHome *)self triggers];
    v11 = [v10 countByEnumeratingWithState:&v46 objects:v52 count:16];
    if (v11)
    {
      v12 = *v47;
      do
      {
        v13 = 0;
        do
        {
          if (*v47 != v12)
          {
            objc_enumerationMutation(v10);
          }

          [*(*(&v46 + 1) + 8 * v13++) removeActionSet:v7 postUpdate:1];
        }

        while (v11 != v13);
        v11 = [v10 countByEnumeratingWithState:&v46 objects:v52 count:16];
      }

      while (v11);
    }

    v43 = [v44 transactionResult];
    [v43 markChanged];
    v14 = [v7 type];
    v15 = [v14 isEqualToString:*MEMORY[0x277CCF1A0]];

    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_INFO);
    if (v15)
    {
      if (v19)
      {
        v20 = HMFGetLogIdentifier();
        v21 = [v7 name];
        *buf = 138543618;
        v54 = v20;
        v55 = 2112;
        v56 = v21;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Remove trigger owned action set: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)v17->_triggerOwnedActionSets removeObject:v7];
      os_unfair_recursive_lock_unlock();
    }

    else
    {
      if (v19)
      {
        v22 = HMFGetLogIdentifier();
        v23 = [v7 name];
        *buf = 138543618;
        v54 = v22;
        v55 = 2112;
        v56 = v23;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Remove action set: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)v17->_actionSets removeObject:v7];
      os_unfair_recursive_lock_unlock();
      [v43 markSaveToAssistant];
    }

    [v7 invalidate];
    v50[0] = *MEMORY[0x277CD0640];
    v24 = [(HMDHome *)v17 uuid];
    v25 = [v24 UUIDString];
    v51[0] = v25;
    v50[1] = *MEMORY[0x277CD2040];
    v26 = [v7 name];
    v51[1] = v26;
    v50[2] = *MEMORY[0x277CD2050];
    v27 = [v45 UUIDString];
    v51[2] = v27;
    v50[3] = *MEMORY[0x277CCF150];
    v28 = [v7 spiClientIdentifier];
    v29 = [v28 UUIDString];
    v51[3] = v29;
    v50[4] = *MEMORY[0x277CCF128];
    v30 = [v7 urlString];
    v51[4] = v30;
    v31 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v51 forKeys:v50 count:5];

    logAndPostNotification(@"HMDActionSetRemovedNotification", v17, v31);
    [v44 respondWithPayload:v31];
    v32 = objc_autoreleasePoolPush();
    v33 = v17;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
    {
      v35 = HMFGetLogIdentifier();
      *buf = 138543618;
      v54 = v35;
      v55 = 2112;
      v56 = v31;
      _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_INFO, "%{public}@Responding back to clients after removing actionSet: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v32);
  }

  else
  {
    v37 = objc_autoreleasePoolPush();
    v38 = self;
    v39 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v39, OS_LOG_TYPE_ERROR))
    {
      v40 = HMFGetLogIdentifier();
      v41 = [v45 UUIDString];
      *buf = 138543618;
      v54 = v40;
      v55 = 2112;
      v56 = v41;
      _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_ERROR, "%{public}@Count not find action set with UUID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v37);
    v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v44 respondWithError:v7];
  }

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveActionSet:(id)a3
{
  v41 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD2050]];
  v6 = [(HMDHome *)self actionSetWithUUID:v5];
  v7 = v6;
  if (!v6)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v19;
      v39 = 2112;
      v40 = v5;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Did not find the action set with UUID : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
    goto LABEL_9;
  }

  v8 = [v6 type];
  v9 = [v8 isEqualToString:*MEMORY[0x277CCF1A0]];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v13;
      v39 = 2112;
      v40 = v7;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Removing this action Set is not supported. : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 48;
LABEL_9:
    v20 = [v14 hmErrorWithCode:v15];
    [v4 respondWithError:v20];
    goto LABEL_16;
  }

  v20 = +[HMDHome getBuiltinActionSets];
  v21 = [v7 type];
  v22 = [v20 objectForKey:v21];

  if (v22)
  {
    v23 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:83 userInfo:0];
    v24 = [v4 responseHandler];
    (v24)[2](v24, v23, 0);

    v25 = objc_autoreleasePoolPush();
    v26 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      v29 = [v7 type];
      v37 = 138543618;
      v38 = v28;
      v39 = 2112;
      v40 = v29;
      _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Cannot remove built in action set : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v25);
    [v4 respondWithError:v23];
  }

  else
  {
    v30 = [HMDActionSetModel alloc];
    v31 = [(HMDHome *)self uuid];
    v23 = [(HMDBackingStoreModelObject *)v30 initWithObjectChangeType:3 uuid:v5 parentUUID:v31];

    v32 = [(HMDHome *)self backingStore];
    v33 = [v4 name];
    v34 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v35 = [v32 transaction:v33 options:v34];

    [v35 add:v23 withMessage:v4];
    [v35 run];
  }

LABEL_16:
  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddActionSetModel:(id)a3 message:(id)a4
{
  v56 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v47 = a4;
  v7 = self;
  v8 = v6;
  v9 = [v8 name];
  if (v9)
  {
    v10 = [v8 uuid];
    v11 = [v8 type];
    if (v11)
    {
      v12 = [v8 type];
    }

    else
    {
      v12 = *MEMORY[0x277CCF1A8];
    }

    v17 = v12;

    v48 = [(HMDHome *)v7 createActionSetWithName:v9 uuid:v10 type:v17];
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = v7;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v16;
      *&buf[12] = 2112;
      *&buf[14] = v8;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@ActionSet model does not have a name %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v48 = 0;
  }

  if (v48)
  {
    v46 = [v47 transactionResult];
    [v46 markChanged];
    v18 = [v8 type];
    v19 = [v18 isEqualToString:*MEMORY[0x277CCF1A0]];

    os_unfair_recursive_lock_lock_with_options();
    if (v19)
    {
      v20 = v48;
      [(NSMutableArray *)v7->_triggerOwnedActionSets addObject:v48];
      os_unfair_recursive_lock_unlock();
    }

    else
    {
      [(NSMutableArray *)v7->_actionSets addObject:v48];
      os_unfair_recursive_lock_unlock();
      v25 = [v48 actions];
      v26 = [v25 count];

      v20 = v48;
      if (v26)
      {
        [v46 markSaveToAssistant];
        v20 = v48;
      }
    }

    v27 = v7;
    v28 = v20;
    v45 = v47;
    context = objc_autoreleasePoolPush();
    v53[0] = *MEMORY[0x277CD0640];
    v29 = [(HMDHome *)v27 uuid];
    v30 = [v29 UUIDString];
    *buf = v30;
    v53[1] = *MEMORY[0x277CD2040];
    v31 = [v28 name];
    *&buf[8] = v31;
    v53[2] = *MEMORY[0x277CD2050];
    v32 = [v28 uuid];
    v33 = [v32 UUIDString];
    *&buf[16] = v33;
    v53[3] = *MEMORY[0x277CD2048];
    v34 = [v28 type];
    v55 = v34;
    v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:buf forKeys:v53 count:4];

    v36 = objc_autoreleasePoolPush();
    v37 = v27;
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
    {
      v39 = HMFGetLogIdentifier();
      *v49 = 138543618;
      v50 = v39;
      v51 = 2112;
      v52 = v35;
      _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@Add action set finished. Responding to clients with : %@", v49, 0x16u);
    }

    objc_autoreleasePoolPop(v36);
    v40 = [MEMORY[0x277CBEB38] dictionaryWithDictionary:v35];
    [v40 setObject:v28 forKeyedSubscript:@"HMDActionSetNotificationKey"];
    v41 = [(HMDHome *)v37 notificationCenter];
    v42 = [v40 copy];
    [v41 postNotificationName:@"HMDActionSetAddedNotification" object:v37 userInfo:v42];

    [v45 respondWithPayload:v35];
    objc_autoreleasePoolPop(context);
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = v7;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v24;
      *&buf[12] = 2112;
      *&buf[14] = v47;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to create action set model. %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v21);
  }

  v43 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddHomeOwnedActionSet:(id)a3
{
  v51 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v45 = 138543362;
    v46 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding Home owned action set", &v45, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = *MEMORY[0x277CD2040];
  v10 = [v4 stringForKey:*MEMORY[0x277CD2040]];
  v11 = [(HMDHome *)v6 actionSetWithName:v10];
  if (v11)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = v6;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v45 = 138543618;
      v46 = v15;
      v47 = 2112;
      v48 = v10;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@ as it already exists.", &v45, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v16 = MEMORY[0x277CCA9B8];
    v17 = 1;
LABEL_15:
    v22 = [v16 hmErrorWithCode:v17];
LABEL_16:
    [v4 respondWithError:v22];
    goto LABEL_17;
  }

  v18 = [(HMDHome *)v6 actionSets];
  v19 = [v18 count];
  v20 = maximumActionSetsPerHome;

  if (v19 >= v20)
  {
    v27 = objc_autoreleasePoolPush();
    v28 = v6;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      v30 = HMFGetLogIdentifier();
      v45 = 138543618;
      v46 = v30;
      v47 = 2112;
      v48 = v10;
      _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; already at maximum action sets for home", &v45, 0x16u);
    }

    objc_autoreleasePoolPop(v27);
    v16 = MEMORY[0x277CCA9B8];
    v17 = 49;
    goto LABEL_15;
  }

  v21 = [(HMDHome *)v6 addActionSetName:v10];
  if (v21)
  {
    v22 = v21;
    v23 = objc_autoreleasePoolPush();
    v24 = v6;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      v45 = 138543874;
      v46 = v26;
      v47 = 2112;
      v48 = v10;
      v49 = 2112;
      v50 = v22;
      _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; namespace error %@", &v45, 0x20u);
    }

    objc_autoreleasePoolPop(v23);
    goto LABEL_16;
  }

  v32 = [HMDActionSetModel alloc];
  v33 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
  v34 = [(HMDHome *)v6 uuid];
  v35 = [(HMDBackingStoreModelObject *)v32 initWithObjectChangeType:1 uuid:v33 parentUUID:v34];

  v36 = [v4 stringForKey:v9];
  [(HMDActionSetModel *)v35 setName:v36];

  v37 = [v4 stringForKey:*MEMORY[0x277CD2048]];
  v38 = v37;
  v39 = *MEMORY[0x277CCF1A8];
  if (v37)
  {
    v40 = v37;
  }

  else
  {
    v40 = *MEMORY[0x277CCF1A8];
  }

  [(HMDActionSetModel *)v35 setType:v40];
  v41 = [(HMDHome *)v6 backingStore];
  v42 = [v4 name];
  v43 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v44 = [v41 transaction:v42 options:v43];

  [v44 add:v35 withMessage:v4];
  [v44 run];

  v22 = 0;
LABEL_17:

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTriggerOwnedActionSet:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding trigger owned action set", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDActionSetModel alloc];
  v10 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
  v11 = [(HMDHome *)v6 uuid];
  v12 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:1 uuid:v10 parentUUID:v11];

  v13 = [v4 stringForKey:*MEMORY[0x277CD2040]];
  [(HMDActionSetModel *)v12 setName:v13];

  [(HMDActionSetModel *)v12 setType:*MEMORY[0x277CCF1A0]];
  v14 = [(HMDHome *)v6 backingStore];
  v15 = [v4 name];
  v16 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v17 = [v14 transaction:v15 options:v16];

  [v17 add:v12 withMessage:v4];
  [v17 run];

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddActionSetFromBuilder:(id)a3
{
  v58 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v53 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding Home owned action set (from builder)", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
  v10 = v9;
  if (v9)
  {
    v11 = v9;
  }

  else
  {
    v11 = [MEMORY[0x277CCAD78] UUID];
  }

  v12 = v11;

  v13 = [v4 stringForKey:*MEMORY[0x277CD2048]];
  v14 = v13;
  v15 = *MEMORY[0x277CCF1A8];
  if (v13)
  {
    v15 = v13;
  }

  v16 = v15;

  v17 = [v4 stringForKey:*MEMORY[0x277CD2040]];
  v18 = [(HMDHome *)v6 actionSetWithName:v17];
  if (!v18)
  {
    v25 = [(HMDHome *)v6 actionSets];
    v26 = [v25 count];
    v27 = maximumActionSetsPerHome;

    if (v26 >= v27)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = v6;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543618;
        v53 = v36;
        v54 = 2112;
        v55 = v17;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; already at maximum action sets for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v33);
      v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    }

    else
    {
      v28 = [(HMDHome *)v6 addActionSetName:v17];
      if (!v28)
      {
        v38 = [(HMDHome *)v6 backingStore];
        v39 = [v4 name];
        v40 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v41 = [v38 transaction:v39 options:v40];

        v42 = [v4 messagePayload];
        v50 = 0;
        v51 = 0;
        v43 = [(HMDHome *)v6 _createActionSetWithUUID:v12 name:v17 type:v16 fromDictionary:v42 transaction:v41 response:&v51 error:&v50];
        v44 = v51;
        v19 = v50;

        if (v43)
        {
          v46[0] = MEMORY[0x277D85DD0];
          v46[1] = 3221225472;
          v46[2] = __42__HMDHome__handleAddActionSetFromBuilder___block_invoke;
          v46[3] = &unk_279730430;
          v46[4] = v6;
          v47 = v17;
          v48 = v4;
          v49 = v44;
          [v41 run:v46];
        }

        else
        {
          v45 = [(HMDHome *)v6 removeName:v17];
          [v4 respondWithError:v19];
        }

        goto LABEL_21;
      }

      v19 = v28;
      v29 = objc_autoreleasePoolPush();
      v30 = v6;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543874;
        v53 = v32;
        v54 = 2112;
        v55 = v17;
        v56 = 2112;
        v57 = v19;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; namespace error %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
    }

    [v4 respondWithError:v19];
    goto LABEL_21;
  }

  v19 = v18;
  v20 = objc_autoreleasePoolPush();
  v21 = v6;
  v22 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
  {
    v23 = HMFGetLogIdentifier();
    *buf = 138543618;
    v53 = v23;
    v54 = 2112;
    v55 = v17;
    _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@ as it already exists.", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v20);
  v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:1];
  [v4 respondWithError:v24];

LABEL_21:
  v37 = *MEMORY[0x277D85DE8];
}

void __42__HMDHome__handleAddActionSetFromBuilder___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  if (v4)
  {
    v3 = [*(a1 + 32) removeName:*(a1 + 40)];
    [*(a1 + 48) respondWithError:v4];
  }

  else
  {
    [*(a1 + 48) respondWithPayload:*(a1 + 56)];
  }
}

- (void)_handleAddActionSet:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v23 = 138543618;
    v24 = v8;
    v25 = 2112;
    v26 = v4;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Received a request to add a new action set : %@", &v23, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 stringForKey:*MEMORY[0x277CD2048]];
  if (!v9)
  {
    v9 = *MEMORY[0x277CCF1A8];
  }

  v10 = [v4 stringForKey:*MEMORY[0x277CD2040]];
  v11 = HMMaxLengthForNaming();
  if ([v10 length] <= v11)
  {
    v17 = [(HMDHome *)v6 logEventSubmitter];
    v18 = [HMDAddActionSetLogEvent alloc];
    v19 = [(HMDHome *)v6 uuid];
    v20 = [(HMDAddActionSetLogEvent *)v18 initWithActionSetType:v9 homeUUID:v19];
    [v17 submitLogEvent:v20];

    v21 = [v4 name];
    LODWORD(v20) = [v21 isEqualToString:*MEMORY[0x277CCF1E8]];

    if (v20)
    {
      [(HMDHome *)v6 _handleAddActionSetFromBuilder:v4];
    }

    else if ([v9 isEqualToString:*MEMORY[0x277CCF1A0]])
    {
      [(HMDHome *)v6 _handleAddTriggerOwnedActionSet:v4];
    }

    else
    {
      [(HMDHome *)v6 _handleAddHomeOwnedActionSet:v4];
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = v6;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v23 = 138543362;
      v24 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v23, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
    [v4 respondWithError:v16];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (id)builtInActionSetInfo
{
  v3 = [MEMORY[0x277CBEB18] array];
  v4 = [(HMDHome *)self workQueue];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __31__HMDHome_builtInActionSetInfo__block_invoke;
  v9[3] = &unk_2797359B0;
  v9[4] = self;
  v5 = v3;
  v10 = v5;
  dispatch_sync(v4, v9);

  v6 = v10;
  v7 = v5;

  return v5;
}

void __31__HMDHome_builtInActionSetInfo__block_invoke(uint64_t a1)
{
  v29 = *MEMORY[0x277D85DE8];
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v1 = [*(a1 + 32) actionSets];
  v2 = [v1 countByEnumeratingWithState:&v22 objects:v28 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = *v23;
    v5 = *MEMORY[0x277CCF1A8];
    v19 = *MEMORY[0x277CD2048];
    v20 = *MEMORY[0x277CD2040];
    v18 = *MEMORY[0x277CD2050];
    do
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v23 != v4)
        {
          objc_enumerationMutation(v1);
        }

        v7 = *(*(&v22 + 1) + 8 * i);
        v8 = [v7 type];
        if (v8)
        {
          v9 = v8;
          v10 = [v7 type];
          v11 = [v10 isEqualToString:v5];

          if ((v11 & 1) == 0)
          {
            v26[0] = v20;
            v12 = [v7 name];
            v27[0] = v12;
            v26[1] = v19;
            v13 = [v7 type];
            v27[1] = v13;
            v26[2] = v18;
            v14 = [v7 uuid];
            v15 = [v14 UUIDString];
            v27[2] = v15;
            v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:v26 count:3];

            [*(a1 + 40) addObject:v16];
          }
        }
      }

      v3 = [v1 countByEnumeratingWithState:&v22 objects:v28 count:16];
    }

    while (v3);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)test_addTriggerOwnedActionSets:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_triggerOwnedActionSets addObjectsFromArray:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)triggerOwnedActionSets
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_triggerOwnedActionSets copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)test_addActionSets:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_actionSets addObjectsFromArray:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)actionSets
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_actionSets copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleRemoveServiceGroupModel:(id)a3 message:(id)a4
{
  v34 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v27 = v6;
  v8 = [v6 uuid];
  v9 = [(HMDHome *)self serviceGroupWithUUID:v8];
  v10 = v9;
  if (v9)
  {
    v11 = [v9 name];
    v12 = [(HMDHome *)self removeName:v11];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_serviceGroups removeObject:v10];
    os_unfair_recursive_lock_unlock();
    v13 = [v7 transactionResult];
    [v13 markChanged];
    [v13 markSaveToAssistant];
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v10 name];
      *buf = 138543618;
      v31 = v17;
      v32 = 2112;
      v33 = v18;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Removed service group: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v28[0] = *MEMORY[0x277CD25C0];
    v19 = [v10 name];
    v29[0] = v19;
    v28[1] = *MEMORY[0x277CD25E0];
    v20 = [v10 uuid];
    v21 = [v20 UUIDString];
    v29[1] = v21;
    v28[2] = *MEMORY[0x277CD0D58];
    v22 = [v10 spiClientIdentifier];
    v23 = [v22 UUIDString];
    v29[2] = v23;
    v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:3];

    logAndPostNotification(@"HMDServiceGroupRemovedNotification", v10, v24);
    [v7 respondWithSuccess];
  }

  else
  {
    v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v7 respondWithError:v25];
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveServiceGroup:(id)a3
{
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD25E0]];
  v6 = [(HMDHome *)self serviceGroupWithUUID:v5];
  if (v6)
  {
    v7 = [HMDServiceGroupModel alloc];
    v8 = [(HMDHome *)self uuid];
    v9 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v5 parentUUID:v8];

    v10 = [(HMDHome *)self backingStore];
    v11 = [v4 name];
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [v10 transaction:v11 options:v12];

    [v13 add:v9];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __37__HMDHome__handleRemoveServiceGroup___block_invoke;
    v14[3] = &unk_2797359D8;
    v15 = v4;
    [v13 run:v14];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v9];
  }
}

- (void)_handleAddServiceGroupModel:(id)a3 message:(id)a4
{
  v40 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 name];
  v9 = [v6 uuid];
  v10 = v9;
  if (v8 && v9)
  {
    v33 = [v8 hm_truncatedNameString];

    v11 = [HMDServiceGroup alloc];
    v12 = [(HMDHome *)self workQueue];
    v13 = [(HMDServiceGroup *)v11 initWithName:v33 uuid:v10 home:self queue:v12];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_serviceGroups addObject:v13];
    os_unfair_recursive_lock_unlock();
    v14 = [(HMDHome *)self msgDispatcher];
    v15 = [(HMDHome *)self workQueue];
    [(HMDServiceGroup *)v13 configure:v14 queue:v15];

    v16 = [(HMDServiceGroup *)v13 updateServiceGroupWithModel:v6 message:v7];
    v17 = [v7 transactionResult];
    [v17 markChanged];
    v18 = [(HMDServiceGroup *)v13 serviceUUIDs];
    v19 = [v18 count];

    if (v19)
    {
      [v17 markSaveToAssistant];
    }

    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v23;
      v38 = 2112;
      v39 = v33;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Added service group: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v34[0] = *MEMORY[0x277CD25C0];
    v24 = [(HMDServiceGroup *)v13 name];
    v35[0] = v24;
    v34[1] = *MEMORY[0x277CD25E0];
    v25 = [(HMDServiceGroup *)v13 uuid];
    v26 = [v25 UUIDString];
    v35[1] = v26;
    v27 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:2];

    logAndPostNotification(@"HMDServiceGroupAddedNotification", v13, v27);
    [v7 respondWithPayload:0 error:v16];

    v8 = v33;
  }

  else
  {
    v28 = objc_autoreleasePoolPush();
    v29 = self;
    v30 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
    {
      v31 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v31;
      v38 = 2112;
      v39 = v8;
      _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; invalid parameter", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v28);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v7 respondWithError:v13];
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddServiceGroup:(id)a3
{
  v47 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CD25C0]];
  if (v5)
  {
    v6 = HMMaxLengthForNaming();
    if ([v5 length] > v6)
    {
      v7 = objc_autoreleasePoolPush();
      v8 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543362;
        v42 = v10;
        _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v7);
      v11 = MEMORY[0x277CCA9B8];
      v12 = 46;
      goto LABEL_7;
    }

    v13 = [(HMDHome *)self serviceGroupWithName:v5];
    if (v13)
    {
      v14 = MEMORY[0x277CCA9B8];
      v15 = 1;
    }

    else
    {
      v16 = [(HMDHome *)self serviceGroups];
      v17 = [v16 count];
      v18 = maximumServiceGroupsPerHome;

      if (v17 < v18)
      {
        v19 = [(HMDHome *)self addName:v5];
        if (!v19)
        {
          v29 = [HMDServiceGroupModel alloc];
          v30 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
          v31 = [(HMDHome *)self uuid];
          v32 = [(HMDBackingStoreModelObject *)v29 initWithObjectChangeType:1 uuid:v30 parentUUID:v31];

          [(HMDServiceGroupModel *)v32 setName:v5];
          v33 = [(HMDHome *)self backingStore];
          v34 = [v4 name];
          v35 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v36 = [v33 transaction:v34 options:v35];

          [v36 add:v32];
          v38[0] = MEMORY[0x277D85DD0];
          v38[1] = 3221225472;
          v38[2] = __34__HMDHome__handleAddServiceGroup___block_invoke;
          v38[3] = &unk_2797358C8;
          v39 = v4;
          v40 = v32;
          v37 = v32;
          [v36 run:v38];

          goto LABEL_20;
        }

        v20 = objc_autoreleasePoolPush();
        v21 = self;
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
        {
          v23 = HMFGetLogIdentifier();
          *buf = 138543874;
          v42 = v23;
          v43 = 2112;
          v44 = v5;
          v45 = 2112;
          v46 = v19;
          _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; namespace error %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v20);
LABEL_19:
        [v4 respondWithError:v19];
LABEL_20:

        goto LABEL_21;
      }

      v24 = objc_autoreleasePoolPush();
      v25 = self;
      v26 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        v27 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v27;
        v43 = 2112;
        v44 = v5;
        _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; already at maximum service groups for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v24);
      v14 = MEMORY[0x277CCA9B8];
      v15 = 49;
    }

    v19 = [v14 hmErrorWithCode:v15];
    goto LABEL_19;
  }

  v11 = MEMORY[0x277CCA9B8];
  v12 = 20;
LABEL_7:
  v13 = [v11 hmErrorWithCode:v12];
  [v4 respondWithError:v13];
LABEL_21:

  v28 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddServiceGroup___block_invoke(uint64_t a1, uint64_t a2)
{
  v12[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v11[0] = *MEMORY[0x277CD25C0];
    v6 = [*(a1 + 40) name];
    v12[0] = v6;
    v11[1] = *MEMORY[0x277CD25E0];
    v7 = [*(a1 + 40) uuid];
    v8 = [v7 UUIDString];
    v12[1] = v8;
    v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:v11 count:2];
    [v2 respondWithPayload:v9];

    v10 = *MEMORY[0x277D85DE8];
  }
}

- (void)test_addServiceGroups:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_serviceGroups addObjectsFromArray:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)serviceGroups
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_serviceGroups copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)updateHomeFirstHAPAccessoryAddedDateToNow
{
  v3 = [HMDHomeModel alloc];
  v4 = [(HMDHome *)self uuid];
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 uuid];
  v11 = [(HMDBackingStoreModelObject *)v3 initWithObjectChangeType:2 uuid:v4 parentUUID:v6];

  v7 = objc_alloc_init(MEMORY[0x277CBEAA8]);
  [(HMDHomeModel *)v11 setFirstHAPAccessoryAddedDate:v7];

  v8 = [(HMDHome *)self backingStore];
  v9 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v10 = [v8 transaction:@"updateHomeFirstHAPAccessoryAddedDate" options:v9];

  [v10 add:v11];
  [v10 run];
}

- (void)_processAccessoriesToAddForUnpairedAccessory:(id)a3 certificationStatus:(int64_t)a4 accessoryServer:(id)a5 networkCredential:(id)a6 pairingEvent:(id)a7 message:(id)a8 completionHandler:(id)a9
{
  v225 = *MEMORY[0x277D85DE8];
  v15 = a3;
  v173 = a5;
  v174 = a6;
  v162 = a7;
  v165 = a8;
  v156 = a9;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x259C01AE0](self, a2);
  v19 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 16894];
  v211 = [v16 initWithName:v19];

  v20 = [v173 primaryAccessory];
  [v162 updateEventPropertiesWithHAPAccessory:v20];

  v172 = v15;
  if (self)
  {
    v21 = [(HMDHome *)self currentAccessory];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v22 = v21;
    }

    else
    {
      v22 = 0;
    }

    v23 = v22;

    v171 = 0;
    if (v172 && v23)
    {
      v24 = [v23 sensorAccessoryUUID];
      v25 = [v24 hmf_isEqualToUUID:v172];

      if (v25)
      {
        v171 = [v23 uuid];
      }

      else
      {
        v171 = 0;
      }
    }
  }

  else
  {
    v171 = 0;
  }

  v26 = objc_autoreleasePoolPush();
  v181 = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
  {
    v28 = HMFGetLogIdentifier();
    v29 = [v173 accessories];
    v30 = [v29 count];
    v31 = [v173 identifier];
    *buf = 138543874;
    v217 = v28;
    v218 = 2048;
    v219 = v30;
    v220 = 2112;
    v221 = v31;
    _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Creating %tu new accessory objects for a newly paired accessory server: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v26);
  v158 = [MEMORY[0x277CBEB18] array];
  v32 = MEMORY[0x277CBEB18];
  v33 = [v173 accessories];
  v166 = [v32 arrayWithCapacity:{objc_msgSend(v33, "count")}];

  v34 = MEMORY[0x277CBEB18];
  v35 = [v173 accessories];
  v178 = [v34 arrayWithCapacity:{objc_msgSend(v35, "count")}];

  v209 = 0u;
  v210 = 0u;
  v207 = 0u;
  v208 = 0u;
  v36 = [v173 accessories];
  v37 = [v36 countByEnumeratingWithState:&v207 objects:v224 count:16];
  if (v37)
  {
    v180 = 0;
    v168 = *v208;
    obj = v36;
    do
    {
      v38 = 0;
      v163 = v37;
      do
      {
        if (*v208 != v168)
        {
          objc_enumerationMutation(obj);
        }

        v39 = *(*(&v207 + 1) + 8 * v38);
        v40 = [v39 uniqueIdentifier];
        v41 = [v173 primaryAccessory];
        v42 = [v41 uniqueIdentifier];
        v43 = [v40 isEqual:v42];

        if (v43)
        {
          if (v180)
          {
            v44 = objc_autoreleasePoolPush();
            v45 = v181;
            v46 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v46, OS_LOG_TYPE_DEFAULT))
            {
              v47 = HMFGetLogIdentifier();
              v48 = [v180 uuid];
              v49 = [v173 primaryAccessory];
              *buf = 138543874;
              v217 = v47;
              v218 = 2112;
              v219 = v48;
              v220 = 2112;
              v221 = v49;
              _os_log_impl(&dword_2531F8000, v46, OS_LOG_TYPE_DEFAULT, "%{public}@#### Multiple primary accessories: %@  new %@", buf, 0x20u);

              v37 = v163;
            }

            objc_autoreleasePoolPop(v44);
          }

          v50 = v172;
          if (!v172)
          {
            v160 = [MEMORY[0x277CCAD78] UUID];
            v50 = v160;
          }

          v51 = [(HMDHome *)v181 getTransactionFromHAPAccessory:v39 hmdAccessory:0 uuid:v50 hostAccessoryUUID:v171 objectChangeType:1];
          if (!v172)
          {
          }

          v52 = v51;
          v53 = v39;
          v54 = [v53 manufacturer];
          [v52 setInitialManufacturer:v54];

          v55 = [v53 model];
          [v52 setInitialModel:v55];

          v56 = [v53 category];
          [v52 setInitialCategoryIdentifier:v56];

          v57 = serviceTypeUUIDsForAccessory(v53);
          [v52 setInitialServiceTypeUUIDs:v57];

          v58 = [v53 server];

          [HMDHome updateCHIPPropertiesOnAccessoryModel:v52 forAddedHAPAccessoryServer:v58];
          v59 = v173;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v60 = v59;
          }

          else
          {
            v60 = 0;
          }

          v175 = v60;

          v61 = [v174 clientIdentifier];
          [v52 setNetworkClientIdentifier:v61];

          [v52 setNetworkClientLAN:&unk_286627820];
          v62 = [v174 networkRouterUUID];
          v63 = [v62 UUIDString];
          [v52 setNetworkRouterUUID:v63];

          v64 = [v174 wiFiPSK];
          [v52 setWiFiUniquePreSharedKey:v64];

          v65 = [v174 wiFiPSK];

          if (v65)
          {
            v66 = 3;
          }

          else if ([v175 isWacComplete])
          {
            v66 = 2;
          }

          else
          {
            v66 = 0;
          }

          v72 = [MEMORY[0x277CCABB0] numberWithInteger:v66];
          [v52 setWiFiCredentialType:v72];

          v73 = [MEMORY[0x277CCABB0] numberWithInteger:a4];
          [v52 setCertificationStatus:v73];

          if (v171)
          {
            v74 = [v171 UUIDString];
            [v52 setHostAccessoryUUID:v74];
          }

          v75 = [(HMDHome *)v181 uuidToHAPAccessoryConfigTable];
          v76 = [v52 uuid];
          [v75 setObject:v53 forKey:v76];

          v77 = v52;
          v78 = [(HMDHome *)v181 homeManager];
          v79 = v78;
          if (v172)
          {
            v80 = objc_autoreleasePoolPush();
            v81 = v181;
            v82 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
            {
              v83 = HMFGetLogIdentifier();
              v84 = [v53 uniqueIdentifier];
              [v175 isWacComplete];
              v85 = HMFBooleanToString();
              v86 = [v77 wiFiCredentialType];
              *buf = 138544130;
              v217 = v83;
              v218 = 2112;
              v219 = v84;
              v220 = 2112;
              v221 = v85;
              v222 = 2112;
              v223 = v86;
              _os_log_impl(&dword_2531F8000, v82, OS_LOG_TYPE_INFO, "%{public}@Creating primary accessory for unpaired accessory with identifier %@ isWacComplete: %@ wiFiCredentialType: %@", buf, 0x2Au);

              v37 = v163;
            }
          }

          else
          {
            [v78 processAnyPendingRequestsForRemoteAccess];
            v80 = objc_autoreleasePoolPush();
            v87 = v181;
            v82 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
            {
              v88 = HMFGetLogIdentifier();
              v89 = [v53 uniqueIdentifier];
              [v175 isWacComplete];
              v90 = HMFBooleanToString();
              v91 = [v77 wiFiCredentialType];
              *buf = 138544130;
              v217 = v88;
              v218 = 2112;
              v219 = v89;
              v220 = 2112;
              v221 = v90;
              v222 = 2112;
              v223 = v91;
              _os_log_impl(&dword_2531F8000, v82, OS_LOG_TYPE_INFO, "%{public}@Creating primary accessory with identifier %@ isWacComplete: %@ wiFiCredentialType: %@", buf, 0x2Au);

              v37 = v163;
            }
          }

          objc_autoreleasePoolPop(v80);
          v206 = v178;
          [(HMDHome *)v181 getUpdateTransactionForAccessory:0 hapAccessory:v53 accessoryTransaction:v77 addSvcTransactions:&v206 updateSvcTransactions:0 removeSvcTransactions:0];
          v92 = v206;

          [(HMDHome *)v181 _processProductDataForNewlyAddedAccessory:v53 transaction:v77];
          if ([(HMDHome *)v181 hasNeverAddedAnyHAPAccessory])
          {
            [v162 setFirstHAPAccessoryInHome:1];
            [(HMDHome *)v181 updateHomeFirstHAPAccessoryAddedDateToNow];
            [v162 setFirstHAPAccessoryInAnyHome:1];
            if ([v79 hasHAPAccessoryInAnyHome])
            {
              [v162 setFirstHAPAccessoryInAnyHome:0];
            }
          }

          v178 = v92;
          v180 = v77;
        }

        else
        {
          v67 = objc_autoreleasePoolPush();
          v68 = v181;
          v69 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
          {
            v70 = HMFGetLogIdentifier();
            v71 = [v39 uniqueIdentifier];
            *buf = 138543618;
            v217 = v70;
            v218 = 2112;
            v219 = v71;
            _os_log_impl(&dword_2531F8000, v69, OS_LOG_TYPE_INFO, "%{public}@Non-primary accessory with identifier %@", buf, 0x16u);

            v37 = v163;
          }

          objc_autoreleasePoolPop(v67);
          [v158 addObject:v39];
        }

        ++v38;
      }

      while (v37 != v38);
      v36 = obj;
      v37 = [obj countByEnumeratingWithState:&v207 objects:v224 count:16];
    }

    while (v37);
  }

  else
  {
    v180 = 0;
  }

  v204 = 0u;
  v205 = 0u;
  v202 = 0u;
  v203 = 0u;
  v161 = v158;
  v93 = [v161 countByEnumeratingWithState:&v202 objects:v215 count:16];
  if (v93)
  {
    v164 = *v203;
    do
    {
      v169 = v93;
      v94 = 0;
      v176 = v178;
      do
      {
        if (*v203 != v164)
        {
          objc_enumerationMutation(v161);
        }

        v95 = *(*(&v202 + 1) + 8 * v94);
        v96 = objc_autoreleasePoolPush();
        v97 = v181;
        v98 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v98, OS_LOG_TYPE_INFO))
        {
          v99 = HMFGetLogIdentifier();
          v100 = [v95 uniqueIdentifier];
          *buf = 138543618;
          v217 = v99;
          v218 = 2112;
          v219 = v100;
          _os_log_impl(&dword_2531F8000, v98, OS_LOG_TYPE_INFO, "%{public}@Non-primary accessory with identifier %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v96);
        v101 = [v95 instanceID];
        v102 = [v101 stringValue];
        v214 = v102;
        v103 = [MEMORY[0x277CBEA60] arrayWithObjects:&v214 count:1];

        v104 = MEMORY[0x277CCAD78];
        v105 = [v180 uuid];
        v106 = [v104 hm_deriveUUIDFromBaseUUID:v105 withSalts:v103];

        v107 = objc_autoreleasePoolPush();
        v108 = v97;
        v109 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v109, OS_LOG_TYPE_INFO))
        {
          v110 = HMFGetLogIdentifier();
          v111 = [v95 uniqueIdentifier];
          v112 = [v106 UUIDString];
          *buf = 138543874;
          v217 = v110;
          v218 = 2112;
          v219 = v111;
          v220 = 2112;
          v221 = v112;
          _os_log_impl(&dword_2531F8000, v109, OS_LOG_TYPE_INFO, "%{public}@Creating secondary accessory with identifier %@ and uuid %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v107);
        v113 = [v180 uuid];
        v114 = [(HMDHome *)v108 getTransactionFromHAPAccessory:v95 hmdAccessory:0 uuid:v106 hostAccessoryUUID:v113 objectChangeType:1];

        [v114 setWiFiCredentialType:&unk_286627820];
        [v166 addObject:v114];
        v115 = [(HMDHome *)v108 uuidToHAPAccessoryConfigTable];
        [v115 setObject:v95 forKey:v106];

        v201 = v176;
        [(HMDHome *)v108 getUpdateTransactionForAccessory:0 hapAccessory:v95 accessoryTransaction:v114 addSvcTransactions:&v201 updateSvcTransactions:0 removeSvcTransactions:0];
        v178 = v201;

        ++v94;
        v176 = v178;
      }

      while (v169 != v94);
      v93 = [v161 countByEnumeratingWithState:&v202 objects:v215 count:16];
    }

    while (v93);
  }

  v116 = [(HMDHome *)v181 backingStore];
  v117 = [v165 name];
  v118 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v177 = [v116 transaction:v117 options:v118];

  [v177 add:v180 withMessage:v165];
  v119 = dispatch_group_create();
  [v180 setConfigurationTracker:v119];
  v199 = 0u;
  v200 = 0u;
  v197 = 0u;
  v198 = 0u;
  v167 = v166;
  v120 = [v167 countByEnumeratingWithState:&v197 objects:v213 count:16];
  if (v120)
  {
    v170 = *v198;
    do
    {
      for (i = 0; i != v120; ++i)
      {
        if (*v198 != v170)
        {
          objc_enumerationMutation(v167);
        }

        v122 = *(*(&v197 + 1) + 8 * i);
        [v122 setConfigurationTracker:v119];
        v123 = [v180 certificationStatus];
        [v122 setCertificationStatus:v123];

        v124 = [v180 uuid];
        v125 = [(HMDHome *)v181 accessoryWithUUID:v124];

        v126 = v125;
        objc_opt_class();
        LOBYTE(v125) = objc_opt_isKindOfClass();

        if ((v125 & (v126 != 0)) == 1)
        {
          v127 = [v180 uuid];
          v128 = [v127 UUIDString];
          [v122 setBridgeUUID:v128];
LABEL_73:

          goto LABEL_77;
        }

        v129 = v126;
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & (v126 != 0)) != 0)
        {
          v127 = [v180 uuid];
          v128 = [v127 UUIDString];
          [v122 setHostAccessoryUUID:v128];
          goto LABEL_73;
        }

        v131 = objc_autoreleasePoolPush();
        v132 = v181;
        v133 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v133, OS_LOG_TYPE_ERROR))
        {
          v134 = HMFGetLogIdentifier();
          *buf = 138543618;
          v217 = v134;
          v218 = 2112;
          v219 = v129;
          _os_log_impl(&dword_2531F8000, v133, OS_LOG_TYPE_ERROR, "%{public}@Unexpected type of host accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v131);
LABEL_77:
        [v177 add:v122 withMessage:v165];
      }

      v120 = [v167 countByEnumeratingWithState:&v197 objects:v213 count:16];
    }

    while (v120);
  }

  v195 = 0u;
  v196 = 0u;
  v193 = 0u;
  v194 = 0u;
  v135 = v178;
  v136 = [v135 countByEnumeratingWithState:&v193 objects:v212 count:16];
  if (v136)
  {
    v137 = *v194;
    do
    {
      for (j = 0; j != v136; ++j)
      {
        if (*v194 != v137)
        {
          objc_enumerationMutation(v135);
        }

        v139 = *(*(&v193 + 1) + 8 * j);
        [v139 setConfigurationTracker:v119];
        [v177 add:v139 withMessage:0];
      }

      v136 = [v135 countByEnumeratingWithState:&v193 objects:v212 count:16];
    }

    while (v136);
  }

  v140 = [(HMDHome *)v181 emptyModelObjectWithChangeType:2];
  if ([objc_opt_class() updateCHIPPropertiesOnHomeModel:v140 forAddedHAPAccessoryServer:v173])
  {
    v141 = v140;
    v142 = objc_autoreleasePoolPush();
    v143 = v181;
    v144 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v144, OS_LOG_TYPE_INFO))
    {
      v145 = HMFGetLogIdentifier();
      *buf = 138543618;
      v217 = v145;
      v218 = 2112;
      v219 = v141;
      _os_log_impl(&dword_2531F8000, v144, OS_LOG_TYPE_INFO, "%{public}@Adding updated home model for CHIP-related properties: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v142);
    v140 = v141;
    [v177 add:v141];
  }

  v179 = v140;
  v146 = [(HMDHome *)v181 wiFiRouterAccessories];
  objc_initWeak(buf, v181);
  v182[0] = MEMORY[0x277D85DD0];
  v182[1] = 3221225472;
  v182[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke;
  v182[3] = &unk_2797226A0;
  objc_copyWeak(&v192, buf);
  v147 = v156;
  v191 = v147;
  v148 = v119;
  v183 = v148;
  v149 = v180;
  v184 = v149;
  v150 = v173;
  v185 = v150;
  v151 = v167;
  v186 = v151;
  v152 = v165;
  v187 = v152;
  v188 = v211;
  v153 = v146;
  v189 = v153;
  v154 = v162;
  v190 = v154;
  [v177 run:v182];

  objc_destroyWeak(&v192);
  objc_destroyWeak(buf);

  __HMFActivityScopeLeave();
  v155 = *MEMORY[0x277D85DE8];
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v33 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 104));
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = *(a1 + 32);
    v7 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2;
    block[3] = &unk_2797225E0;
    block[4] = v5;
    v8 = *(a1 + 40);
    v9 = *(a1 + 48);
    v10 = *(a1 + 56);
    v11 = *(a1 + 64);
    *&v12 = v10;
    *(&v12 + 1) = v11;
    *&v13 = v8;
    *(&v13 + 1) = v9;
    v22 = v13;
    v23 = v12;
    v28 = *(a1 + 96);
    v24 = *(a1 + 72);
    v25 = *(a1 + 80);
    v26 = v3;
    v27 = *(a1 + 88);
    dispatch_group_notify(v6, v7, block);

    v14 = v22;
LABEL_7:

    goto LABEL_8;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
  {
    v17 = HMFGetLogIdentifier();
    *buf = 138543362;
    v32 = v17;
    _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Home missing; failed to add accessory", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v15);
  v18 = *(a1 + 96);
  if (v18)
  {
    v19 = dispatch_get_global_queue(0, 0);
    v29[0] = MEMORY[0x277D85DD0];
    v29[1] = 3221225472;
    v29[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1369;
    v29[3] = &unk_2797348C0;
    v30 = v18;
    dispatch_async(v19, v29);

    v14 = v30;
    goto LABEL_7;
  }

LABEL_8:

  v20 = *MEMORY[0x277D85DE8];
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1369(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
  (*(v1 + 16))(v1, v2);
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2(uint64_t a1)
{
  v110 = *MEMORY[0x277D85DE8];
  v3 = (a1 + 32);
  v2 = *(a1 + 32);
  v4 = (a1 + 40);
  v5 = [*(a1 + 40) uuid];
  v6 = [v2 accessoryWithUUID:v5];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v62 = v7;

  v8 = [*v3 notificationRegistrations];
  v65 = [v8 count];

  v9 = [*v4 hapAccessoryLocal];
  [v62 enableNotificationsWithHAPAccessory:v9 homeNotificationsEnabled:v65 != 0];

  logAndPostNotification(@"HMDAccessoryConnectedNotification", v62, 0);
  [v62 updateBridgedAccessoryLightProfilesSettings];
  [*v3 finishPairingForServer:*(a1 + 48)];
  v102 = 0u;
  v103 = 0u;
  v100 = 0u;
  v101 = 0u;
  v10 = *(a1 + 56);
  v11 = [v10 countByEnumeratingWithState:&v100 objects:v109 count:16];
  if (v11)
  {
    v12 = *v101;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v101 != v12)
        {
          objc_enumerationMutation(v10);
        }

        v14 = *(*(&v100 + 1) + 8 * i);
        v15 = *(a1 + 32);
        v16 = [v14 uuid];
        v17 = [v15 accessoryWithUUID:v16];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v18 = v17;
        }

        else
        {
          v18 = 0;
        }

        v19 = v18;

        v20 = [v14 hapAccessoryLocal];
        [v19 enableNotificationsWithHAPAccessory:v20 homeNotificationsEnabled:v65 != 0];

        logAndPostNotification(@"HMDAccessoryConnectedNotification", v19, 0);
      }

      v11 = [v10 countByEnumeratingWithState:&v100 objects:v109 count:16];
    }

    while (v11);
  }

  v21 = *(a1 + 32);
  v22 = [*(a1 + 64) identifier];
  v61 = [v21 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v22];

  if ([*(a1 + 32) isOwnerUser])
  {
    goto LABEL_25;
  }

  v94 = 0;
  v95 = &v94;
  v96 = 0x3032000000;
  v97 = __Block_byref_object_copy__10664;
  v98 = __Block_byref_object_dispose__10665;
  v99 = 0;
  v23 = dispatch_group_create();
  dispatch_group_enter(v23);
  v24 = [*(a1 + 32) homeManager];
  v25 = [v62 identifier];
  v88[0] = MEMORY[0x277D85DD0];
  v88[1] = 3221225472;
  v88[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_3;
  v88[3] = &unk_2797225B8;
  v26 = v62;
  v27 = *(a1 + 32);
  v89 = v26;
  v90 = v27;
  v93 = &v94;
  v28 = v61;
  v91 = v28;
  v29 = v23;
  v92 = v29;
  [v24 cleanupOperationsForAccessory:v25 user:0 completion:v88];

  v30 = dispatch_time(0, 180000000000);
  if (dispatch_group_wait(v29, v30))
  {
    v31 = objc_autoreleasePoolPush();
    v32 = *(a1 + 32);
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543618;
      v106 = v34;
      v107 = 2112;
      v108 = v26;
      _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_ERROR, "%{public}@Timed out waiting for resident to respond to add accessory request: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v31);
    v35 = [MEMORY[0x277CCA9B8] hmErrorWithCode:8];
    v36 = v95[5];
    v95[5] = v35;
  }

  v37 = v95[5];
  if (v37)
  {
    [*(a1 + 32) _sharedAdminDidFailToAddAccessories:v28];
    v38 = [*(a1 + 64) responseHandler];

    if (v38)
    {
      v39 = [*(a1 + 64) responseHandler];
      (v39)[2](v39, v95[5], 0);
    }

    v40 = *(a1 + 104);
    if (v40)
    {
      (*(v40 + 16))(v40, v95[5]);
    }
  }

  _Block_object_dispose(&v94, 8);
  if (!v37)
  {
LABEL_25:
    group = dispatch_group_create();
    if (v62)
    {
      dispatch_group_enter(group);
      v84[0] = MEMORY[0x277D85DD0];
      v84[1] = 3221225472;
      v84[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1370;
      v84[3] = &unk_279730430;
      v84[4] = *(a1 + 32);
      v41 = v62;
      v85 = v41;
      v86 = *(a1 + 72);
      v87 = group;
      [v41 readInitialRequiredCharacteristicsForAccessory:v84];
      v42 = [*(a1 + 40) hapAccessoryLocal];
      [v41 enableNotificationsWithHAPAccessory:v42 homeNotificationsEnabled:v65 != 0];
    }

    v82 = 0u;
    v83 = 0u;
    v80 = 0u;
    v81 = 0u;
    obj = *(a1 + 56);
    v43 = [obj countByEnumeratingWithState:&v80 objects:v104 count:16];
    if (v43)
    {
      v44 = *v81;
      do
      {
        for (j = 0; j != v43; ++j)
        {
          if (*v81 != v44)
          {
            objc_enumerationMutation(obj);
          }

          v46 = *(*(&v80 + 1) + 8 * j);
          v47 = *(a1 + 32);
          v48 = [v46 uuid];
          v49 = [v47 accessoryWithUUID:v48];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v50 = v49;
          }

          else
          {
            v50 = 0;
          }

          v51 = v50;

          if (v51)
          {
            dispatch_group_enter(group);
            v77[0] = MEMORY[0x277D85DD0];
            v77[1] = 3221225472;
            v77[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2_1372;
            v77[3] = &unk_279734D88;
            v77[4] = *(a1 + 32);
            v52 = v51;
            v78 = v52;
            v79 = group;
            [v52 readInitialRequiredCharacteristicsForAccessory:v77];
            v53 = [v46 hapAccessoryLocal];
            [v52 enableNotificationsWithHAPAccessory:v53 homeNotificationsEnabled:v65 != 0];
          }
        }

        v43 = [obj countByEnumeratingWithState:&v80 objects:v104 count:16];
      }

      while (v43);
    }

    v54 = dispatch_time(0, 3000000000);
    dispatch_group_wait(group, v54);
    if ([*(a1 + 32) isOwnerUser])
    {
      [*(a1 + 32) _setupActiveNetworkRouterAccessory:v61 existingRouterAccessories:*(a1 + 80)];
    }

    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1373;
    aBlock[3] = &unk_279734668;
    aBlock[4] = *(a1 + 32);
    v73 = v61;
    v74 = *(a1 + 64);
    v76 = *(a1 + 104);
    v75 = *(a1 + 88);
    v55 = _Block_copy(aBlock);
    v56 = v55;
    if (v62)
    {
      [*(a1 + 72) begin];
      v94 = *(a1 + 72);
      v57 = [MEMORY[0x277CBEAA8] date];
      v58 = *(a1 + 96);
      v66[0] = MEMORY[0x277D85DD0];
      v66[1] = 3221225472;
      v66[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2_1374;
      v66[3] = &unk_279732B10;
      v59 = v57;
      v67 = v59;
      v68 = *(a1 + 72);
      v69 = v62;
      v70 = *(a1 + 96);
      v71 = v56;
      [v69 commissionToThreadNetworkWithPairingEvent:v58 completion:v66];

      __HMFActivityScopeLeave();
    }

    else
    {
      (*(v55 + 2))(v55);
    }
  }

  v60 = *MEMORY[0x277D85DE8];
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_3(uint64_t a1)
{
  if (([*(a1 + 32) supportsCHIP] & 1) != 0 || (v3 = *(a1 + 32), v2 = *(a1 + 40), v4 = *(*(a1 + 64) + 8), v12 = *(v4 + 40), v5 = objc_msgSend(v2, "_addOwnerToPrimaryAccessory:error:", v3, &v12), objc_storeStrong((v4 + 40), v12), v5))
  {
    v6 = *(a1 + 40);
    v7 = *(a1 + 48);
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_4;
    v10[3] = &unk_27972C6F8;
    v9 = *(a1 + 56);
    v8 = v9;
    v11 = v9;
    [v6 _notifyOwnerOfAddedAccessories:v7 completion:v10];
  }

  else
  {
    dispatch_group_leave(*(a1 + 56));
  }
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1370(uint64_t a1, void *a2)
{
  v23 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) name];
    v9 = [*(a1 + 40) uuid];
    v10 = [v9 UUIDString];
    [*(a1 + 40) supportsTargetController];
    v11 = HMFBooleanToString();
    *buf = 138544130;
    *&buf[4] = v7;
    v17 = 2112;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v21 = 2112;
    v22 = v11;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Primary accessory %@/%@ (supportsTargetController %@) being added to home", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 40) autoConfigureTargetController];
  [*(a1 + 48) begin];
  *buf = *(a1 + 48);
  dispatch_group_enter(*(a1 + 56));
  v12 = *(a1 + 40);
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1371;
  v14[3] = &unk_279735D00;
  v15 = *(a1 + 56);
  [v12 handleUpdatedServicesForThreadManagementWithCompletion:v14];

  __HMFActivityScopeLeave();
  dispatch_group_leave(*(a1 + 56));

  v13 = *MEMORY[0x277D85DE8];
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2_1372(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) name];
    v9 = [*(a1 + 40) uuid];
    v10 = [v9 UUIDString];
    [*(a1 + 40) supportsTargetController];
    v11 = HMFBooleanToString();
    v13 = 138544130;
    v14 = v7;
    v15 = 2112;
    v16 = v8;
    v17 = 2112;
    v18 = v10;
    v19 = 2112;
    v20 = v11;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Bridged accessory %@/%@ (supportsTargetController %@) being added to home", &v13, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 40) autoConfigureTargetController];
  dispatch_group_leave(*(a1 + 48));

  v12 = *MEMORY[0x277D85DE8];
}

uint64_t __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1373(uint64_t a1)
{
  [*(a1 + 32) _notifyClientOfNewlyAddedAccessories:*(a1 + 40) requestMessage:*(a1 + 48)];
  result = *(a1 + 64);
  if (result)
  {
    v3 = *(a1 + 56);
    v4 = *(result + 16);

    return v4();
  }

  return result;
}

uint64_t __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2_1374(uint64_t a1, void *a2)
{
  v3 = MEMORY[0x277CBEAA8];
  v4 = a2;
  v5 = [v3 date];
  [v5 timeIntervalSinceDate:*(a1 + 32)];
  v7 = v6;

  [*(a1 + 48) uuid];
  v8 = [MEMORY[0x277CCABB0] numberWithDouble:v7];
  [v4 domain];

  [v4 code];
  [*(a1 + 56) setThreadCommissioningDuration:v7];
  [*(a1 + 56) setThreadCommissioningError:v4];

  v9 = *(*(a1 + 64) + 16);

  return v9();
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_4(uint64_t a1, void *a2)
{
  v4 = a2;
  if (v4)
  {
    objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
  }

  dispatch_group_leave(*(a1 + 32));
}

- (BOOL)hasNeverAddedAnyHAPAccessory
{
  v3 = [(HMDHome *)self firstHAPAccessoryAddedDate];
  if (v3)
  {
    v4 = 0;
  }

  else
  {
    v5 = [(HMDHome *)self hapAccessories];
    v4 = [v5 count] == 0;
  }

  return v4;
}

- (void)_processLegacyPairingRequestForMessage:(id)a3 cancelPairing:(BOOL)a4 context:(id)a5
{
  v6 = a4;
  v61 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v51 = a5;
  v9 = [v8 uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v9)
  {
    if (v6)
    {
      v10 = [v8 responseHandler];
      [(HMDHome *)self _cancelPairingWithAccessoryUUID:v9 context:v51 completionHandler:v10];
    }

    else
    {
      v50 = [v8 stringForKey:*MEMORY[0x277CD1FD8]];
      v49 = [v8 stringForKey:@"kAccessoryOnboardingSetupPayloadStringKey"];
      v54 = 0u;
      v55 = 0u;
      v52 = 0u;
      v53 = 0u;
      v17 = [(HMDHome *)self addPendingAccessories];
      v18 = [v17 hm_allKeys];

      v19 = [v18 countByEnumeratingWithState:&v52 objects:v56 count:16];
      if (v19)
      {
        v20 = *v53;
LABEL_9:
        v21 = 0;
        while (1)
        {
          if (*v53 != v20)
          {
            objc_enumerationMutation(v18);
          }

          v22 = *(*(&v52 + 1) + 8 * v21);
          v23 = [v22 accessoryUUID];
          v24 = [v23 isEqual:v9];

          if (v24)
          {
            break;
          }

          if (v19 == ++v21)
          {
            v19 = [v18 countByEnumeratingWithState:&v52 objects:v56 count:16];
            if (v19)
            {
              goto LABEL_9;
            }

            goto LABEL_15;
          }
        }

        v25 = v22;

        if (!v25)
        {
          goto LABEL_24;
        }

        v26 = objc_autoreleasePoolPush();
        v27 = self;
        v28 = HMFGetOSLogHandle();
        v29 = os_log_type_enabled(v28, OS_LOG_TYPE_INFO);
        if (v50)
        {
          if (v29)
          {
            v30 = HMFGetLogIdentifier();
            *buf = 138543618;
            v58 = v30;
            v59 = 2112;
            v60 = v9;
            _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Storing the setupCode for accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v26);
          v31 = [(HMDHome *)v27 addPendingAccessorySetupCodes];
          [v31 setObject:v50 forKey:v9];

          v32 = [(HMDHome *)v27 addPendingAccessoryOnboardingSetupPayloadStrings];
          [v32 setObject:v49 forKeyedSubscript:v9];

          v33 = [(HMDHome *)v27 accessoryBrowser];
          v34 = [v33 unpairedAccessoryWithUUID:v9];

          if (v34)
          {
            v35 = [(HMDHome *)v27 accessoryBrowser];
            [v35 handleSetupCodeAvailable:v34];
          }

          v36 = [(HMDHome *)v27 addPendingAccessorySetupCodeHandlers];
          v37 = [v36 objectForKeyedSubscript:v9];

          if (v37)
          {
            os_unfair_recursive_lock_lock_with_options();
            [(NSMutableDictionary *)v27->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v9];
            os_unfair_recursive_lock_unlock();
            (v37)[2](v37, v50, v49, 0);
          }

          else
          {
            v44 = objc_autoreleasePoolPush();
            v45 = v27;
            v46 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
            {
              v47 = HMFGetLogIdentifier();
              *buf = 138543618;
              v58 = v47;
              v59 = 2112;
              v60 = v9;
              _os_log_impl(&dword_2531F8000, v46, OS_LOG_TYPE_INFO, "%{public}@No handler to provide the setup code to for accessory: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v44);
          }

          [v8 respondWithSuccess];
        }

        else
        {
          if (v29)
          {
            v42 = HMFGetLogIdentifier();
            *buf = 138543618;
            v58 = v42;
            v59 = 2112;
            v60 = v9;
            _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@No setupCode specified to continue pairing with accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v26);
          v43 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          [v8 respondWithError:v43];
        }
      }

      else
      {
LABEL_15:

LABEL_24:
        v38 = objc_autoreleasePoolPush();
        v39 = self;
        v40 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
        {
          v41 = HMFGetLogIdentifier();
          *buf = 138543618;
          v58 = v41;
          v59 = 2112;
          v60 = v9;
          _os_log_impl(&dword_2531F8000, v40, OS_LOG_TYPE_INFO, "%{public}@Accessory with UUID %@ not being added to the home", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v38);
        v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:79];
        [v8 respondWithError:v25];
      }
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v8 messagePayload];
      *buf = 138543618;
      v58 = v14;
      v59 = 2112;
      v60 = v15;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@No accessory UUID found in payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v8 respondWithError:v16];
  }

  v48 = *MEMORY[0x277D85DE8];
}

- (void)_cancelPairingWithAccessoryUUID:(id)a3 context:(id)a4 completionHandler:(id)a5
{
  v48 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v39 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self accessoryBrowser];
  v11 = [v10 unassociatedAccessories];
  v12 = [v11 hmf_firstObjectWithUUID:v8];

  v13 = v12;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  v15 = v14;

  if (v15)
  {
    v42[0] = MEMORY[0x277D85DD0];
    v42[1] = 3221225472;
    v42[2] = __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke;
    v42[3] = &unk_2797348C0;
    v43 = v9;
    [v15 cancelConfigurationWithCompletionHandler:v42];
    v16 = v43;
  }

  else
  {
    v17 = [(HMDHome *)self accessoryBrowser];
    v38 = [v17 unpairedAccessoryWithUUID:v8];

    v18 = [(HMDHome *)self addPendingAccessorySetupCodeHandlers];
    v37 = [v18 objectForKeyedSubscript:v8];

    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      v23 = [v8 UUIDString];
      *buf = 138543618;
      v45 = v22;
      v46 = 2112;
      v47 = v23;
      _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Canceling pairing and removing all state for accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    os_unfair_recursive_lock_lock_with_options();
    v24 = [(NSMapTable *)v20->_addPendingAccessories hm_allKeys];
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke_1365;
    v40[3] = &unk_279722568;
    v25 = v8;
    v41 = v25;
    v26 = [v24 na_firstObjectPassingTest:v40];

    [(NSMutableDictionary *)v20->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v25];
    if (v26)
    {
      [(NSMapTable *)v20->_addPendingAccessories removeObjectForKey:v26];
    }

    os_unfair_recursive_lock_unlock();
    if (v38)
    {
      v27 = [(HMDHome *)v20 accessoryBrowser];
      v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      [v27 cancelPairingWithAccessory:v38 error:v28 context:v39];
    }

    if (v37)
    {
      v29 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      (v37)[2](v37, 0, 0, v29);

      if (v9)
      {
        (*(v9 + 2))(v9, 0, 0);
      }
    }

    else
    {
      context = objc_autoreleasePoolPush();
      v30 = v20;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
      {
        v32 = HMFGetLogIdentifier();
        v33 = [v25 UUIDString];
        *buf = 138543618;
        v45 = v32;
        v46 = 2112;
        v47 = v33;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_INFO, "%{public}@Unable to find setup available completion handler for accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(context);
      if (v9)
      {
        v34 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        (*(v9 + 2))(v9, v34, 0);
      }
    }

    v16 = v38;
  }

  v35 = *MEMORY[0x277D85DE8];
}

uint64_t __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0);
  }

  return result;
}

uint64_t __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke_1365(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 accessoryUUID];
  v4 = [v2 isEqual:v3];

  return v4;
}

- (void)_processPairingRequestForMessage:(id)a3 cancelPairing:(BOOL)a4 context:(id)a5
{
  v6 = a4;
  v24 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  v10 = [v8 dataForKey:*MEMORY[0x277CD1F90]];
  v19 = 0;
  v11 = [(HMDHome *)self _setupDescriptionFromData:v10 error:&v19];
  v12 = v19;
  if (v11)
  {
    if (v6)
    {
      [(HMDHome *)self _cancelPairingWithAccessoryDescription:v11 context:v9];
      [v8 respondWithPayload:0];
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = v12;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v8 respondWithError:v17];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_cancelPairingWithAccessoryDescription:(id)a3 context:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 accessoryUUID];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v12;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Canceling pairing and removing all state for accessory with description %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)v10->_addPendingAccessories removeObjectForKey:v6];
  if (v8)
  {
    [(NSMutableDictionary *)v10->_addPendingAccessorySetupCodes removeObjectForKey:v8];
    [(NSMutableDictionary *)v10->_addPendingAccessoryOnboardingSetupPayloadStrings removeObjectForKey:v8];
    [(NSMutableDictionary *)v10->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v8];
  }

  os_unfair_recursive_lock_unlock();
  v13 = [(HMDHome *)v10 accessoryBrowser];
  v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
  [v13 cancelPairingWithAccessoryDescription:v6 error:v14 context:v7];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleCancelPairingAccessory:(id)a3
{
  v4 = MEMORY[0x277CCA9B8];
  v5 = a3;
  v6 = [v4 hmInternalErrorWithCode:1090];
  v8 = [HMDMatterAccessoryPairingEndContext hmContextWithCancelledError:v6];

  v7 = [v5 dataForKey:*MEMORY[0x277CD1F90]];

  if (v7)
  {
    [(HMDHome *)self _processPairingRequestForMessage:v5 cancelPairing:1 context:v8];
  }

  else
  {
    [(HMDHome *)self _processLegacyPairingRequestForMessage:v5 cancelPairing:1 context:v8];
  }
}

- (id)_setupCodeProviderForMessage:(id)a3
{
  v4 = a3;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke;
  aBlock[3] = &unk_279722590;
  objc_copyWeak(&v11, &location);
  v5 = v4;
  v10 = v5;
  v6 = _Block_copy(aBlock);
  v7 = [v6 copy];

  objc_destroyWeak(&v11);
  objc_destroyWeak(&location);

  return v7;
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v11 = WeakRetained;
  if (WeakRetained)
  {
    v12 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_2;
    block[3] = &unk_279734668;
    block[4] = v11;
    v15 = v7;
    v16 = v8;
    v18 = v9;
    v17 = *(a1 + 32);
    dispatch_async(v12, block);
  }

  else
  {
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(v9 + 2))(v9, 0, 0, v13);
  }
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke_2(id *a1)
{
  v81 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] homeManager];
  v3 = [a1[5] uuid];
  v4 = [a1[5] name];
  v5 = v4;
  if (v3)
  {
    v6 = v4 == 0;
  }

  else
  {
    v6 = 1;
  }

  if (v6 || (v7 = a1[6]) == 0)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = a1[4];
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v3 UUIDString];
      *buf = 138543874;
      v74 = v19;
      v75 = 2112;
      v76 = v5;
      v77 = 2112;
      v78 = v20;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ went away while being added to home", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    v21 = a1[8];
    v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    (*(v21 + 2))(v21, 0, 0, v22);
  }

  else
  {
    if ([v7 isEqualToString:@"HMSetupCodeProviderReasonBadPassword"])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = a1[4];
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v74 = v11;
        v75 = 2112;
        v76 = v3;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Clearing previous password on bad-password error for accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      v12 = [a1[4] addPendingAccessorySetupCodes];
      [v12 removeObjectForKey:v3];

      v13 = [a1[4] addPendingAccessoryOnboardingSetupPayloadStrings];
      [v13 removeObjectForKey:v3];
    }

    v14 = *MEMORY[0x277CD1FD8];
    v15 = [a1[7] stringForKey:*MEMORY[0x277CD1FD8]];
    if (v15 && [a1[7] isEntitledForSPIAccess])
    {
      if ([a1[6] isEqualToString:@"HMSetupCodeProviderReasonBadPassword"])
      {

LABEL_27:
        v46 = objc_autoreleasePoolPush();
        v47 = a1[4];
        v48 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
        {
          v49 = HMFGetLogIdentifier();
          v50 = [a1[7] stringForKey:v14];
          v51 = [v3 UUIDString];
          *buf = 138544130;
          v74 = v49;
          v75 = 2112;
          v76 = v50;
          v77 = 2112;
          v78 = v5;
          v79 = 2112;
          v80 = v51;
          _os_log_impl(&dword_2531F8000, v48, OS_LOG_TYPE_INFO, "%{public}@Provided password %@ incorrect for accessory %@/%@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v46);
        v52 = a1[8];
        v22 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2002];
        (*(v52 + 2))(v52, 0, 0, v22);
        goto LABEL_17;
      }

      v45 = [a1[6] isEqualToString:@"HMSetupCodeProviderReasontTimeoutRetry"];

      if (v45)
      {
        goto LABEL_27;
      }
    }

    else
    {
    }

    v24 = a1[4];
    os_unfair_recursive_lock_lock_with_options();
    v25 = [a1[8] copy];
    v26 = _Block_copy(v25);
    [*(a1[4] + 100) setObject:v26 forKeyedSubscript:v3];

    os_unfair_recursive_lock_unlock();
    if ([a1[6] isEqualToString:@"HMSetupCodeProviderReasonInitial"])
    {
      v27 = [a1[4] addPendingAccessorySetupCodes];
      v22 = [v27 objectForKey:v3];

      v28 = [a1[4] addPendingAccessoryOnboardingSetupPayloadStrings];
      v29 = [v28 objectForKeyedSubscript:v3];

      v30 = objc_autoreleasePoolPush();
      v31 = a1[4];
      v32 = HMFGetOSLogHandle();
      v33 = os_log_type_enabled(v32, OS_LOG_TYPE_INFO);
      if (v22)
      {
        if (v33)
        {
          v34 = HMFGetLogIdentifier();
          v35 = a1[5];
          *buf = 138543618;
          v74 = v34;
          v75 = 2112;
          v76 = v35;
          _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_INFO, "%{public}@Providing setupCode for accessory %@ and removing from tracking", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v30);
        (*(a1[8] + 2))();
      }

      else
      {
        if (v33)
        {
          v53 = HMFGetLogIdentifier();
          *buf = 138543874;
          v74 = v53;
          v75 = 2112;
          v76 = v5;
          v77 = 2112;
          v78 = v3;
          _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ prompted for pairing setupCode but did not receive it from HomeUIService", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v30);
        if ([a1[7] BOOLForKey:*MEMORY[0x277CD2010]])
        {
          v54 = objc_autoreleasePoolPush();
          v55 = a1[4];
          v56 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
          {
            v57 = HMFGetLogIdentifier();
            v58 = [v3 UUIDString];
            *buf = 138543874;
            v74 = v57;
            v75 = 2112;
            v76 = v5;
            v77 = 2112;
            v78 = v58;
            _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_INFO, "%{public}@addAccessory request from HomeUIService - waiting for setupCode for accessory %@/%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v54);
        }

        else
        {
          v64 = [v2 accessorySetupManager];
          v65 = [a1[4] uuid];
          v66 = [a1[7] proxyConnection];
          v68[0] = MEMORY[0x277D85DD0];
          v68[1] = 3221225472;
          v68[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_1360;
          v68[3] = &unk_279735168;
          v68[4] = a1[4];
          v70 = a1[8];
          v69 = v3;
          [v64 launchAccessorySetupHostToRequestSetupCodeForAccessoryWithUUID:v69 accessoryName:v5 homeUUID:v65 clientConnection:v66 completionHandler:v68];
        }

        v22 = v29;
      }
    }

    else
    {
      v36 = objc_alloc(MEMORY[0x277D0F820]);
      v37 = [a1[4] uuid];
      v22 = [v36 initWithTarget:v37];

      v38 = objc_alloc(MEMORY[0x277D0F848]);
      v39 = a1[6];
      v71 = *MEMORY[0x277CD2018];
      v72 = v39;
      v40 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v72 forKeys:&v71 count:1];
      v41 = [v38 initWithName:*MEMORY[0x277CCFDB8] qualityOfService:33 destination:v22 payload:v40];

      v42 = [v2 accessorySetupManager];
      v43 = [v42 accessorySetupHostClientConnection];

      if (v43)
      {
        [v41 setTransport:v43];
        v44 = [a1[4] msgDispatcher];
        [v44 sendMessage:v41];
      }

      else
      {
        context = objc_autoreleasePoolPush();
        v59 = a1[4];
        v60 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v60, OS_LOG_TYPE_INFO))
        {
          v61 = HMFGetLogIdentifier();
          v62 = a1[5];
          *buf = 138543618;
          v74 = v61;
          v75 = 2112;
          v76 = v62;
          _os_log_impl(&dword_2531F8000, v60, OS_LOG_TYPE_INFO, "%{public}@No HomeUIService connection for accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(context);
        v63 = a1[8];
        v44 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2002];
        (*(v63 + 2))(v63, 0, 0, v44);
      }
    }
  }

LABEL_17:

  v23 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke_1360(id *a1, void *a2)
{
  v3 = a2;
  if (v3)
  {
    v4 = [a1[4] workQueue];
    v5[0] = MEMORY[0x277D85DD0];
    v5[1] = 3221225472;
    v5[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_2_1361;
    v5[3] = &unk_279734578;
    v5[4] = a1[4];
    v6 = v3;
    v8 = a1[6];
    v7 = a1[5];
    dispatch_async(v4, v5);
  }
}

uint64_t __40__HMDHome__setupCodeProviderForMessage___block_invoke_2_1361(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_ERROR))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    *buf = 138543618;
    v16 = v5;
    v17 = 2112;
    v18 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_ERROR, "%{public}@Failed to request setup code for accessory: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = *(a1 + 40);
  (*(*(a1 + 56) + 16))();
  v8 = *(a1 + 32);
  os_unfair_recursive_lock_lock_with_options();
  v9 = [*(*(a1 + 32) + 1032) hm_allKeys];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_1362;
  v13[3] = &unk_279722568;
  v14 = *(a1 + 48);
  v10 = [v9 na_firstObjectPassingTest:v13];

  if (v10)
  {
    [*(*(a1 + 32) + 1032) removeObjectForKey:v10];
  }

  [*(*(a1 + 32) + 800) removeObjectForKey:*(a1 + 48)];
  [*(*(a1 + 32) + 808) removeObjectForKey:*(a1 + 48)];
  [*(*(a1 + 32) + 816) removeObjectForKey:*(a1 + 48)];

  result = os_unfair_recursive_lock_unlock();
  v12 = *MEMORY[0x277D85DE8];
  return result;
}

uint64_t __40__HMDHome__setupCodeProviderForMessage___block_invoke_1362(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 accessoryUUID];
  v4 = [v2 isEqual:v3];

  return v4;
}

- (BOOL)hasAnyReachableAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_any:&__block_literal_global_1359];

  return v3;
}

- (void)retrieveStateForTrackedAccessory:(id)a3 stateNumber:(id *)a4 isReachable:(BOOL *)a5 linkQuality:(unint64_t *)a6 lastSeen:(id *)a7
{
  v12 = a3;
  v14 = [(HMDHome *)self accessoryBrowser];
  v13 = [v14 accessoryBrowserHapProtocol];
  [v13 retrieveCurrentStateForIdentifier:v12 stateNumber:a4 isReachable:a5 linkQuality:a6 lastSeen:a7];
}

- (void)getReachableIPAccessories:(unint64_t *)a3 btleAccessories:(unint64_t *)a4 mediaAccessories:(unint64_t *)a5
{
  v31 = *MEMORY[0x277D85DE8];
  if (a3 | a4)
  {
    v28 = 0u;
    v29 = 0u;
    v26 = 0u;
    v27 = 0u;
    obj = [(HMDHome *)self accessories];
    v5 = [obj countByEnumeratingWithState:&v26 objects:v30 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = 0;
      v8 = 0;
      v9 = 0;
      v10 = *v27;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v27 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v26 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v13 = v12;
          }

          else
          {
            v13 = 0;
          }

          v14 = v13;

          if (v14)
          {
            v15 = [v14 matchingHAPAccessoryWithLinkType:1];
            v9 += [v15 isReachable];
            v16 = [v14 matchingHAPAccessoryWithLinkType:2];

            v8 += [v16 isReachable];
          }

          v17 = v12;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v18 = v17;
          }

          else
          {
            v18 = 0;
          }

          v19 = v18;

          v20 = [v19 isReachable];
          v7 += v20;
        }

        v6 = [obj countByEnumeratingWithState:&v26 objects:v30 count:16];
      }

      while (v6);
    }

    else
    {
      v7 = 0;
      v8 = 0;
      v9 = 0;
    }

    if (a3)
    {
      *a3 = v9;
    }

    if (a4)
    {
      *a4 = v8;
    }

    if (a5)
    {
      *a5 = v7;
    }
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (int64_t)reachableAppleMediaAccessoriesCount
{
  v18 = *MEMORY[0x277D85DE8];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v14;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(v2);
        }

        v8 = *(*(&v13 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        if (v10)
        {
          v5 += [v8 isReachable];
        }
      }

      v4 = [v2 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  v11 = *MEMORY[0x277D85DE8];
  return v5;
}

- (int64_t)reachableAccessoriesCountExcludingMatter
{
  v2 = self;
  v41 = *MEMORY[0x277D85DE8];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v3 = [(HMDHome *)self accessories];
  v4 = [v3 countByEnumeratingWithState:&v30 objects:v40 count:16];
  if (v4)
  {
    v6 = v4;
    v29 = 0;
    v7 = *v31;
    *&v5 = 138543618;
    v26 = v5;
    v27 = v3;
    v28 = v2;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v31 != v7)
        {
          objc_enumerationMutation(v3);
        }

        v9 = *(*(&v30 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          if ([v11 isReachable] && (objc_msgSend(v11, "supportsCHIP") & 1) == 0)
          {
            v12 = objc_autoreleasePoolPush();
            v13 = v2;
            v14 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
            {
              v15 = HMFGetLogIdentifier();
              v16 = [v11 name];
              *buf = v26;
              v35 = v15;
              v36 = 2112;
              v37 = v16;
              _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Accessory: %@ is reachable", buf, 0x16u);

              v2 = v28;
              v3 = v27;
            }

            objc_autoreleasePoolPop(v12);
            ++v29;
          }

          if ([v11 supportsCHIP])
          {
            v17 = objc_autoreleasePoolPush();
            v18 = v2;
            v19 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
            {
              v20 = HMFGetLogIdentifier();
              v21 = [v11 name];
              v22 = [v11 isReachable];
              *buf = 138543874;
              v23 = @"NO";
              if (v22)
              {
                v23 = @"YES";
              }

              v35 = v20;
              v36 = 2112;
              v37 = v21;
              v38 = 2112;
              v39 = v23;
              _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Ignoring Matter Accessory: %@ isReachable: %@", buf, 0x20u);

              v3 = v27;
              v2 = v28;
            }

            objc_autoreleasePoolPop(v17);
          }
        }
      }

      v6 = [v3 countByEnumeratingWithState:&v30 objects:v40 count:16];
    }

    while (v6);
  }

  else
  {
    v29 = 0;
  }

  v24 = *MEMORY[0x277D85DE8];
  return v29;
}

- (int64_t)reachableAccessoriesCount
{
  v21 = *MEMORY[0x277D85DE8];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  obj = [(HMDHome *)self accessories];
  v2 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = 0;
    v5 = *v17;
    do
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v17 != v5)
        {
          objc_enumerationMutation(obj);
        }

        v7 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        v10 = v7;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v9 && [v9 isReachable])
        {
          ++v4;
        }

        else if (v12 && [v12 isCurrentAccessory])
        {
          v4 += [v12 isReachable];
        }
      }

      v3 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v3);
  }

  else
  {
    v4 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];
  return v4;
}

- (void)_reachabilityChangedForAccessory:(id)a3 reachable:(BOOL)a4
{
  v56 = a4;
  v71 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v6);

  v7 = [(HMDHome *)self reachableAccessoriesCount];
  v8 = [(HMDHome *)self previousReachableAccessoriesCount];
  v9 = [(HMDHome *)self reachableAppleMediaAccessoriesCount];
  v10 = [(HMDHome *)self previousReachableAppleMediaAccessoriesCount];
  [(HMDHome *)self setPreviousReachableAccessoriesCount:v7];
  [(HMDHome *)self setPreviousReachableAppleMediaAccessoriesCount:v9];
  v11 = v9 + v7 < 1;
  v57 = v8;
  v55 = v10 + v8;
  if ((v10 + v8 < 0) ^ __OFADD__(v10, v8) | (v10 + v8 == 0))
  {
    v12 = 0;
  }

  else
  {
    v12 = 1;
  }

  if ((v10 + v8 < 0) ^ __OFADD__(v10, v8) | (v10 + v8 == 0))
  {
    v13 = v9 + v7 < 1;
  }

  else
  {
    v13 = 1;
  }

  v14 = v11 ^ v12;
  if (((v11 ^ v12) & 1) == 0)
  {
    v53 = v11 ^ v12;
    v54 = v5;
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138544642;
      v60 = v18;
      v61 = 2048;
      v62 = v7;
      v63 = 2048;
      v64 = v9;
      v65 = 1024;
      v66 = v56;
      v67 = 2048;
      v68 = v57;
      v69 = 2048;
      v70 = v10;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Total reachable accessories %ld, apple media accessories: %ld, reachable = %d,                      last known reachable = %ld, last known apple media reachable = %ld", buf, 0x3Au);
    }

    objc_autoreleasePoolPop(v15);
    v5 = v54;
    v14 = v53;
  }

  v19 = [(HMDHome *)self localCapabilitiesDataSource];
  v20 = [v19 supportsRemoteAccess];

  if (v20)
  {
    v58 = 0;
    [(HMDHome *)self getReachableIPAccessories:&v58 btleAccessories:0 mediaAccessories:0];
    if (v13)
    {
      if (v9 + v7 > 0 || v55 < 1)
      {
        goto LABEL_18;
      }

      v21 = [(HMDHome *)self homeLocationHandler];
      [v21 accessoriesBecomeUnreachable];
    }

    else
    {
      v21 = [(HMDHome *)self homeLocationHandler];
      [v21 accessoriesBecomeReachable];
    }

LABEL_18:
    v22 = objc_autoreleasePoolPush();
    v23 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      v26 = v25;
      v27 = @"don't ";
      if (v7 > 0)
      {
        v27 = &stru_286509E58;
      }

      *buf = 138543618;
      v60 = v25;
      v61 = 2112;
      v62 = v27;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Notifying home manager that we %@have locally reachable accessories", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v28 = [(HMDHome *)v23 homeManager];
    v29 = [(HMDHome *)v23 uuid];
    [v28 accessoriesAreLocallyReachableOnTransientDevice:v7 > 0 forHome:v29];

    if ([v5 accessoryReprovisionState] && v56)
    {
      v30 = v14;
      v31 = objc_autoreleasePoolPush();
      v32 = v23;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        [v5 name];
        v36 = v35 = v5;
        *buf = 138543618;
        v60 = v34;
        v61 = 2112;
        v62 = v36;
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ reprovision state is updated to Not Required", buf, 0x16u);

        v5 = v35;
      }

      objc_autoreleasePoolPop(v31);
      [v5 setAccessoryReprovisionState:0];
      v37 = [v5 uuid];
      [v28 updateGenerationCounterWithReason:@"ReprovisionStateChange" sourceUUID:v37 shouldNotifyClients:0];

      v38 = [MEMORY[0x277CBEB38] dictionary];
      v39 = [v5 uuid];
      v40 = [v39 UUIDString];
      [v38 setObject:v40 forKeyedSubscript:*MEMORY[0x277CCF0B0]];

      [v38 setObject:&unk_286627808 forKeyedSubscript:*MEMORY[0x277CD2008]];
      v41 = MEMORY[0x277D0F848];
      v42 = *MEMORY[0x277CD1FF8];
      [(HMDHome *)v32 messageDestination];
      v44 = v43 = v5;
      v45 = [v41 messageWithName:v42 destination:v44 payload:v38];

      v5 = v43;
      v46 = [(HMDHome *)v32 msgDispatcher];
      [v46 sendMessage:v45 completionHandler:0];

      v14 = v30;
    }
  }

  if (v7 >= 1 && v57 <= 0)
  {
    v47 = objc_autoreleasePoolPush();
    v48 = self;
    v49 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
    {
      v50 = HMFGetLogIdentifier();
      *buf = 138543362;
      v60 = v50;
      _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_INFO, "%{public}@Notifying that we see at least one reachable accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v47);
    v51 = [(HMDHome *)v48 notificationCenter];
    [v51 postNotificationName:@"HMDHomeCurrentDeviceHasReachableAccessories" object:v48];
  }

  if ((v14 & 1) == 0)
  {
    [(HMFTimer *)self->_homeLocationTimer resume];
  }

  v52 = *MEMORY[0x277D85DE8];
}

- (void)_handleAccessoryReachabilityChange:(id)a3
{
  v100 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v64 = *MEMORY[0x277CD0640];
  v5 = [v4 stringForKey:?];
  v6 = [(HMDHome *)self uuid];
  v7 = [v6 UUIDString];
  v8 = [v5 isEqualToString:v7];

  v72 = self;
  v66 = v5;
  if (v8)
  {
    v65 = 0;
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [(HMDHome *)v10 uuid];
      v14 = [v13 UUIDString];
      *buf = 138543874;
      v91 = v12;
      v92 = 2112;
      v93 = v5;
      v94 = 2112;
      v95 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@Home does not match, received: %@, current: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    v65 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  }

  v67 = v4;
  v15 = [v4 messagePayload];
  v16 = [v15 hmf_arrayForKey:*MEMORY[0x277CCE7A8]];

  v86 = 0u;
  v87 = 0u;
  v84 = 0u;
  v85 = 0u;
  obj = v16;
  v17 = v72;
  v70 = [obj countByEnumeratingWithState:&v84 objects:v99 count:16];
  if (v70)
  {
    v69 = *v85;
    do
    {
      v18 = 0;
      do
      {
        if (*v85 != v69)
        {
          objc_enumerationMutation(obj);
        }

        v71 = v18;
        v19 = *(*(&v84 + 1) + 8 * v18);
        v80 = 0u;
        v81 = 0u;
        v82 = 0u;
        v83 = 0u;
        v75 = [(HMDHome *)v17 accessories];
        v79 = [v75 countByEnumeratingWithState:&v80 objects:v98 count:16];
        if (v79)
        {
          v78 = *v81;
          v76 = v19;
          do
          {
            for (i = 0; i != v79; ++i)
            {
              if (*v81 != v78)
              {
                objc_enumerationMutation(v75);
              }

              v21 = *(*(&v80 + 1) + 8 * i);
              v22 = [v21 uuid];
              v23 = [v22 UUIDString];

              v24 = [v19 objectForKeyedSubscript:v23];
              if (v24)
              {
                v25 = objc_autoreleasePoolPush();
                v26 = v17;
                v27 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
                {
                  v28 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v91 = v28;
                  v92 = 2112;
                  v93 = v23;
                  v94 = 2112;
                  v95 = v24;
                  _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Setting remote reachability for accessory: %@ to: %@", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v25);
                [v21 setRemotelyReachable:{objc_msgSend(v24, "BOOLValue")}];
              }

              v29 = v21;
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v30 = v29;
              }

              else
              {
                v30 = 0;
              }

              v31 = v30;

              v32 = [v31 identifier];

              if (v32)
              {
                v33 = [v31 identifier];
                v34 = [v19 objectForKeyedSubscript:v33];

                if (v34)
                {
                  v35 = [v34 unsignedIntegerValue];
                  context = objc_autoreleasePoolPush();
                  v36 = v17;
                  v37 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v37, OS_LOG_TYPE_DEBUG))
                  {
                    v38 = HMFGetLogIdentifier();
                    v39 = [v29 identifier];
                    [v31 suspendedState];
                    HAPAccessorySuspendedStateDescription();
                    v40 = v73 = v23;
                    HAPAccessorySuspendedStateDescription();
                    v41 = v74 = v35;
                    *buf = 138544130;
                    v91 = v38;
                    v92 = 2112;
                    v93 = v39;
                    v94 = 2112;
                    v95 = v40;
                    v96 = 2112;
                    v97 = v41;
                    _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_DEBUG, "%{public}@Handle Reachability change. Setting suspended state of accessory: %@ from '%@' to '%@'", buf, 0x2Au);

                    v35 = v74;
                    v23 = v73;

                    v17 = v72;
                  }

                  objc_autoreleasePoolPop(context);
                  [v31 setSuspendedState:v35 shouldNotify:0 saveToBackingStore:1];
                }

                v19 = v76;
              }
            }

            v79 = [v75 countByEnumeratingWithState:&v80 objects:v98 count:16];
          }

          while (v79);
        }

        v18 = v71 + 1;
      }

      while (v71 + 1 != v70);
      v70 = [obj countByEnumeratingWithState:&v84 objects:v99 count:16];
    }

    while (v70);
  }

  v42 = [v67 responseHandler];

  if (v42)
  {
    v43 = [v67 responseHandler];
    (v43)[2](v43, v65, 0);
  }

  v44 = [v67 remoteSourceDevice];
  v45 = [(HMDHome *)v72 primaryResident];
  v46 = [v45 device];
  if ([v44 isEqual:v46])
  {
    v47 = [(HMDHome *)v72 currentRemoteReachabilityRegistration];

    if (v47)
    {
      goto LABEL_42;
    }
  }

  else
  {
  }

  v48 = objc_autoreleasePoolPush();
  v49 = v72;
  v50 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
  {
    v51 = HMFGetLogIdentifier();
    *buf = 138543618;
    v91 = v51;
    v92 = 2112;
    v93 = v44;
    _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_INFO, "%{public}@De-registering stale remote reachability for accessories with device = %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v48);
  v52 = objc_alloc(MEMORY[0x277D0F818]);
  v53 = [MEMORY[0x277D0F820] allMessageDestinations];
  v88 = v64;
  v54 = [(HMDHome *)v49 uuid];
  v55 = [v54 UUIDString];
  v89 = v55;
  v56 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v89 forKeys:&v88 count:1];
  v57 = [v52 initWithName:@"kDisableAccessoryReachabilityNotificationRequestKey" destination:v53 payload:v56];

  v58 = [(HMDHome *)v49 homeManager];
  v59 = [v58 messageDispatcher];
  v60 = [(HMDHome *)v49 uuid];
  v61 = [v44 remoteDestinationString];
  v62 = [(HMDHome *)v49 workQueue];
  [v59 sendSecureMessage:v57 target:v60 userID:0 destination:v61 responseQueue:v62 responseHandler:0];

LABEL_42:
  v63 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoteReachabilityNotificationTimerFired
{
  v82 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = objc_autoreleasePoolPush();
  v5 = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [(HMDHome *)v5 remoteReachabilityNotificationPendingAccessories];
    *buf = 138543618;
    v75 = v7;
    v76 = 2112;
    v77 = v8;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Reachability notification timer fired, pending list: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v70 = 0u;
  v71 = 0u;
  v68 = 0u;
  v69 = 0u;
  obj = [(HMDHome *)v5 reachabilityRegisteredDevices];
  v58 = [obj countByEnumeratingWithState:&v68 objects:v81 count:16];
  if (v58)
  {
    v57 = *v69;
    v55 = *MEMORY[0x277CD0640];
    v56 = *MEMORY[0x277CCE7A8];
    *&v9 = 138543874;
    v53 = v9;
    v10 = 0x277CCA000uLL;
    v62 = v5;
    do
    {
      v11 = 0;
      do
      {
        if (*v69 != v57)
        {
          objc_enumerationMutation(obj);
        }

        v59 = *(*(&v68 + 1) + 8 * v11);
        v60 = v11;
        v12 = MEMORY[0x277CBEB18];
        v13 = [(HMDHome *)v5 remoteReachabilityNotificationPendingAccessories];
        v63 = [v12 arrayWithCapacity:{objc_msgSend(v13, "count")}];

        v66 = 0u;
        v67 = 0u;
        v64 = 0u;
        v65 = 0u;
        v61 = [(HMDHome *)v5 accessories];
        v14 = [v61 countByEnumeratingWithState:&v64 objects:v80 count:16];
        if (v14)
        {
          v15 = v14;
          v16 = *v65;
          do
          {
            for (i = 0; i != v15; ++i)
            {
              if (*v65 != v16)
              {
                objc_enumerationMutation(v61);
              }

              v18 = *(*(&v64 + 1) + 8 * i);
              v19 = [v18 uuid];
              v20 = [v19 UUIDString];
              v21 = [(HMDHome *)v5 _getReachabilityTupleForAccessoryUUID:v20];

              if (v21)
              {
                v22 = MEMORY[0x277CBEB38];
                v23 = [*(v10 + 2992) numberWithBool:{objc_msgSend(v21, "currentReachability")}];
                v24 = [v21 accessoryUUID];
                v25 = [v22 dictionaryWithObject:v23 forKey:v24];

                v26 = v18;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v27 = v26;
                }

                else
                {
                  v27 = 0;
                }

                v28 = v27;

                v29 = [v28 identifier];

                if (v29)
                {
                  v30 = [*(v10 + 2992) numberWithUnsignedInteger:{objc_msgSend(v28, "suspendedState")}];
                  v31 = [v28 identifier];
                  [v25 setObject:v30 forKey:v31];
                }

                [v63 addObject:v25];

                v5 = v62;
              }
            }

            v15 = [v61 countByEnumeratingWithState:&v64 objects:v80 count:16];
          }

          while (v15);
        }

        if ([v63 count])
        {
          v32 = v10;
          v33 = objc_autoreleasePoolPush();
          v34 = v5;
          v35 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
          {
            v36 = HMFGetLogIdentifier();
            v37 = [v63 count];
            v38 = [v59 device];
            v39 = [v38 remoteDestinationString];
            *buf = v53;
            v75 = v36;
            v76 = 2048;
            v77 = v37;
            v78 = 2112;
            v79 = v39;
            _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Sending current reachability for %tu accessories to destination:%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v33);
          v72[0] = v56;
          v40 = [v63 copy];
          v72[1] = v55;
          v73[0] = v40;
          v41 = [(HMDHome *)v34 uuid];
          v42 = [v41 UUIDString];
          v73[1] = v42;
          v43 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v73 forKeys:v72 count:2];

          v44 = [MEMORY[0x277D0F818] messageWithName:@"kRemoteReachabilityChangedNotificationKey" identifier:0 messagePayload:v43];
          v45 = [(HMDHome *)v34 homeManager];
          v46 = [v45 messageDispatcher];
          v47 = [(HMDHome *)v34 uuid];
          v48 = [v59 device];
          v49 = [v48 remoteDestinationString];
          v50 = [(HMDHome *)v34 workQueue];
          [v46 sendSecureMessage:v44 target:v47 userID:0 destination:v49 responseQueue:v50 responseHandler:0];

          v5 = v62;
          v10 = v32;
        }

        v11 = v60 + 1;
      }

      while (v60 + 1 != v58);
      v58 = [obj countByEnumeratingWithState:&v68 objects:v81 count:16];
    }

    while (v58);
  }

  v51 = [(HMDHome *)v5 remoteReachabilityNotificationPendingAccessories];
  [v51 removeAllObjects];

  [(HMDHome *)v5 setReachabilityNotificationTimer:0];
  v52 = *MEMORY[0x277D85DE8];
}

- (void)_updateReachabilityChangeToRegisteredDevices:(id)a3
{
  v43 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [v4 uuid];
  v7 = [v6 UUIDString];

  v8 = [(HMDHome *)self _getReachabilityTupleForAccessoryUUID:v7];
  if ([v4 isReachable])
  {
    v9 = 1;
  }

  else
  {
    v10 = [(HMDHome *)self homeManager];
    v11 = [v10 residentMesh];
    v12 = [v11 deviceForAccessory:v4 residentOrder:1 reachableResidents:0];
    v9 = v12 != 0;
  }

  v13 = v4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  v15 = v14;

  if (v15)
  {
    [v8 setPreviouslySentSuspendedState:{objc_msgSend(v8, "currentSuspendedState")}];
    [v8 setCurrentSuspendedState:{objc_msgSend(v15, "suspendedState")}];
  }

  if (!v8)
  {
    v23 = [HMDAccessoryReachabilityTuple tupleWithAccessoryUUID:v7 reachable:v9];
    [v23 setCurrentSuspendedState:{objc_msgSend(v15, "suspendedState")}];
    v24 = [(HMDHome *)self remoteReachabilityNotificationPendingAccessories];
    [v24 addObject:v23];

    v25 = [(HMDHome *)self reachabilityNotificationTimer];

    if (!v25)
    {
      v26 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:1 options:*&remoteReachabilityNotificationsDeferPeriod];
      [(HMDHome *)self setReachabilityNotificationTimer:v26];

      v27 = [(HMDHome *)self workQueue];
      v28 = [(HMDHome *)self reachabilityNotificationTimer];
      [v28 setDelegateQueue:v27];

      v29 = [(HMDHome *)self reachabilityNotificationTimer];
      [v29 setDelegate:self];

      v30 = [(HMDHome *)self reachabilityNotificationTimer];
      [v30 resume];

      v31 = objc_autoreleasePoolPush();
      v32 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        v35 = [(HMDHome *)v32 reachabilityNotificationTimer];
        v37 = 138543874;
        v38 = v34;
        v39 = 2048;
        v40 = v35;
        v41 = 2048;
        v42 = remoteReachabilityNotificationsDeferPeriod;
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Started reachability notification defer timer %p for %f sec", &v37, 0x20u);
      }

      objc_autoreleasePoolPop(v31);
    }

    goto LABEL_19;
  }

  [v8 setCurrentReachability:v9];
  v16 = [v8 previouslySentReachability];
  if (v16 == [v8 currentReachability])
  {
    v17 = [v8 previouslySentSuspendedState];
    if (v17 == [v8 currentSuspendedState])
    {
      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        v21 = HMFGetLogIdentifier();
        v22 = HMFBooleanToString();
        v37 = 138543874;
        v38 = v21;
        v39 = 2112;
        v40 = v13;
        v41 = 2112;
        v42 = v22;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ toggled reachability back to %@ ignoring", &v37, 0x20u);
      }

      objc_autoreleasePoolPop(v18);
      v23 = [(HMDHome *)v19 remoteReachabilityNotificationPendingAccessories];
      [v23 removeObject:v8];
LABEL_19:
    }
  }

  v36 = *MEMORY[0x277D85DE8];
}

- (id)_getReachabilityTupleForAccessoryUUID:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v17 = 0u;
  v18 = 0u;
  v15 = 0u;
  v16 = 0u;
  v6 = [(HMDHome *)self remoteReachabilityNotificationPendingAccessories];
  v7 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v7)
  {
    v8 = *v16;
    while (2)
    {
      for (i = 0; i != v7; i = i + 1)
      {
        if (*v16 != v8)
        {
          objc_enumerationMutation(v6);
        }

        v10 = *(*(&v15 + 1) + 8 * i);
        v11 = [v10 accessoryUUID];
        v12 = [v11 isEqual:v4];

        if (v12)
        {
          v7 = v10;
          goto LABEL_11;
        }
      }

      v7 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v7;
}

- (void)_deregisterDeviceForReachabilityNotification:(id)a3
{
  v30 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v27 = v9;
    v28 = 2112;
    v29 = v4;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@De-registering device %@ for reachability notification", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v23 = 0u;
  v24 = 0u;
  v21 = 0u;
  v22 = 0u;
  v10 = [(HMDHome *)v7 reachabilityRegisteredDevices];
  v11 = [v10 copy];

  v12 = [v11 countByEnumeratingWithState:&v21 objects:v25 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v22;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v22 != v14)
        {
          objc_enumerationMutation(v11);
        }

        v16 = *(*(&v21 + 1) + 8 * i);
        v17 = [v16 device];
        v18 = [v17 isEqual:v4];

        if (v18)
        {
          v19 = [(HMDHome *)v7 reachabilityRegisteredDevices];
          [v19 removeObject:v16];
        }
      }

      v13 = [v11 countByEnumeratingWithState:&v21 objects:v25 count:16];
    }

    while (v13);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_registerDeviceForReachabilityNotification:(id)a3 accessoryList:(id)a4
{
  v20 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v8);

  [(HMDHome *)self _deregisterDeviceForReachabilityNotification:v6];
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v12;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Registering device %@ for reachability notification", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v13 = [[HMDDeviceRegistrationEntry alloc] initWithDevice:v6 accessoryList:v7];
  if (v13)
  {
    v14 = [(HMDHome *)v10 reachabilityRegisteredDevices];
    [v14 addObject:v13];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)resetAccessoryHashedRouteIdentifiers
{
  v13 = *MEMORY[0x277D85DE8];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v9;
    do
    {
      v6 = 0;
      do
      {
        if (*v9 != v5)
        {
          objc_enumerationMutation(v2);
        }

        [*(*(&v8 + 1) + 8 * v6++) resetHashedRoute];
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v4);
  }

  v7 = *MEMORY[0x277D85DE8];
}

- (void)btleAccessoryReachabilityProbeTimer:(BOOL)a3
{
  v5 = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __47__HMDHome_btleAccessoryReachabilityProbeTimer___block_invoke;
  v6[3] = &unk_279735D28;
  v6[4] = self;
  v7 = a3;
  dispatch_async(v5, v6);
}

void __47__HMDHome_btleAccessoryReachabilityProbeTimer___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) accessoryBrowser];
  [v2 btleAccessoryReachabilityProbeTimer:*(a1 + 40)];
}

- (BOOL)evaluatePredicate:(id)a3
{
  v27[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self predicateUtility];
  v6 = [v5 rewritePredicate:v4 currentCharacteristicInPredicate:0 characteristicsToRead:0 homePresence:0];

  v26 = @"THIS_OBJECT";
  v7 = [(HMDHome *)self predicateUtility];
  v27[0] = v7;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];

  [v6 allowEvaluation];
  v9 = [(HMDHome *)self predicateUtility];
  v10 = [v6 evaluateWithObject:v9 substitutionVariables:v8];

  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = HMFBooleanToString();
    v18 = 138544130;
    v19 = v14;
    v20 = 2112;
    v21 = v4;
    v22 = 2112;
    v23 = v6;
    v24 = 2112;
    v25 = v15;
    _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Evaluating predicate %@ (rewritten %@) with result %@", &v18, 0x2Au);
  }

  objc_autoreleasePoolPop(v11);
  v16 = *MEMORY[0x277D85DE8];
  return v10;
}

- (void)handleEvaluatePredicateMessage:(id)a3
{
  v38[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 predicateForKey:*MEMORY[0x277CD24A8]];
  v6 = [v4 stringForKey:*MEMORY[0x277CD2660]];
  v7 = v6;
  if (v5)
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (v8)
  {
    v9 = [v4 responseHandler];

    if (v9)
    {
      v10 = [v4 responseHandler];
      v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      (v10)[2](v10, v11, 0);
    }
  }

  else
  {
    v31 = v5;
    v12 = [(HMDHome *)self evaluatePredicate:v5];
    v13 = [v4 responseHandler];

    if (v13)
    {
      v14 = [v4 responseHandler];
      v37 = *MEMORY[0x277CD24B8];
      v15 = [MEMORY[0x277CCABB0] numberWithBool:v12];
      v38[0] = v15;
      v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:&v37 count:1];
      (v14)[2](v14, 0, v16);
    }

    v17 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v7];
    v32 = 0u;
    v33 = 0u;
    v34 = 0u;
    v35 = 0u;
    v18 = [(HMDHome *)self accessories];
    v19 = [v18 countByEnumeratingWithState:&v32 objects:v36 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v33;
      while (2)
      {
        for (i = 0; i != v20; ++i)
        {
          if (*v33 != v21)
          {
            objc_enumerationMutation(v18);
          }

          v23 = *(*(&v32 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          v26 = [v25 serviceWithUUID:v17];
          if (v26)
          {
            v27 = v26;
            v28 = [v4 remoteSourceDevice];
            v29 = [v28 remoteDestinationString];
            [v27 updatePresenceRequestTimeForDeviceWithDestination:v29];

            goto LABEL_23;
          }
        }

        v20 = [v18 countByEnumeratingWithState:&v32 objects:v36 count:16];
        if (v20)
        {
          continue;
        }

        break;
      }
    }

LABEL_23:

    v5 = v31;
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)dispatchRequestToEvaluateCondition:(id)a3 forCharacteristics:(id)a4 completion:(id)a5
{
  v63 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if (v10 && [v9 count])
  {
    v11 = [(HMDHome *)self primaryResident];
    v12 = [v11 isCurrentDevice];

    if (v12)
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543362;
        v60 = v16;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Current device is the resident device itself, evaluating locally.", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
      if ([(HMDHome *)v14 evaluatePredicate:v8])
      {
        v10[2](v10, 0, v9);
      }
    }

    else
    {
      v17 = [(HMDHome *)self primaryResident];
      v49 = [v17 device];

      v18 = [(HMDHome *)self primaryResident];
      v19 = [v18 supportsSharedEventTriggerActivation];

      if (v19)
      {
        v20 = MEMORY[0x277CCACA8];
        v21 = [(HMDHome *)self logIdentifier];
        v48 = [v20 stringWithFormat:@"Bulletin-%@", v21];

        v45 = [[HMDPredicateUtilities alloc] initWithHome:self logIdentifier:v48];
        v47 = [(HMDPredicateUtilities *)v45 rewritePredicateForDaemon:v8 message:0];
        v57[0] = *MEMORY[0x277CD24A8];
        v22 = encodeRootObject();
        v58[0] = v22;
        v57[1] = *MEMORY[0x277CD2660];
        v23 = [v9 firstObject];
        v24 = [v23 service];
        v25 = [v24 uuid];
        v26 = [v25 UUIDString];
        v58[1] = v26;
        v46 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v58 forKeys:v57 count:2];

        v27 = [HMDRemoteDeviceMessageDestination alloc];
        v28 = [(HMDHome *)self uuid];
        v29 = [(HMDRemoteDeviceMessageDestination *)v27 initWithTarget:v28 device:v49];

        v30 = [HMDRemoteMessage secureMessageWithName:*MEMORY[0x277CD24B0] destination:v29 messagePayload:v46];
        v31 = [v30 identifier];
        objc_initWeak(&location, self);
        v50[0] = MEMORY[0x277D85DD0];
        v50[1] = 3221225472;
        v50[2] = __76__HMDHome_dispatchRequestToEvaluateCondition_forCharacteristics_completion___block_invoke;
        v50[3] = &unk_279723088;
        objc_copyWeak(&v55, &location);
        v32 = v31;
        v51 = v32;
        v52 = v8;
        v53 = v9;
        v54 = v10;
        [v30 setResponseHandler:v50];
        v33 = objc_autoreleasePoolPush();
        v34 = self;
        v35 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
        {
          v36 = HMFGetLogIdentifier();
          *buf = 138543618;
          v60 = v36;
          v61 = 2114;
          v62 = v32;
          _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Sending message with identifier %{public}@ to evaluate bulletin condition to resident", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v33);
        v37 = [(HMDHome *)v34 homeManager];
        v38 = [v37 messageDispatcher];

        [v38 sendMessage:v30 completionHandler:0];
        objc_destroyWeak(&v55);
        objc_destroyWeak(&location);
      }

      else
      {
        v39 = objc_autoreleasePoolPush();
        v40 = self;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          v43 = [(HMDHome *)v40 primaryResident];
          *buf = 138543618;
          v60 = v42;
          v61 = 2112;
          v62 = v43;
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Remote access device %@ is not capable of presence status. Directly send the notification.", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v39);
        v10[2](v10, 0, v9);
      }
    }
  }

  v44 = *MEMORY[0x277D85DE8];
}

void __76__HMDHome_dispatchRequestToEvaluateCondition_forCharacteristics_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    v13 = *(a1 + 40);
    v14 = *(a1 + 48);
    *buf = 138544386;
    v26 = v11;
    v27 = 2112;
    v28 = v12;
    v29 = 2112;
    v30 = v13;
    v31 = 2112;
    v32 = v14;
    v33 = 2112;
    v34 = v5;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Message with identifier %@ to evaluate condition %@ for characteristics %@ has been sent with error %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v8);
  if (v5)
  {
    goto LABEL_7;
  }

  v15 = [v6 hmf_BOOLForKey:*MEMORY[0x277CD24B8]];
  v16 = objc_autoreleasePoolPush();
  v17 = v9;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    v20 = *(a1 + 40);
    HMFBooleanToString();
    v21 = v24 = v15;
    *buf = 138543874;
    v26 = v19;
    v27 = 2112;
    v28 = v20;
    v29 = 2112;
    v30 = v21;
    _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Resident evaluate predicate %@ to %@.", buf, 0x20u);

    v15 = v24;
  }

  objc_autoreleasePoolPop(v16);
  if (v15)
  {
LABEL_7:
    v22 = *(a1 + 48);
    (*(*(a1 + 56) + 16))();
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)evaluateNotificationConditionForCharacteristics:(id)a3 homePresence:(id)a4 completion:(id)a5
{
  v91 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if (v10)
  {
    if ([(HMDHome *)self bulletinNotificationsSupported])
    {
      v63 = v10;
      v65 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v8, "count")}];
      v67 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v8, "count")}];
      v77 = 0u;
      v78 = 0u;
      v79 = 0u;
      v80 = 0u;
      v64 = v8;
      obj = v8;
      v11 = [obj countByEnumeratingWithState:&v77 objects:v90 count:16];
      v66 = v9;
      v72 = self;
      if (v11)
      {
        v12 = v11;
        v13 = *v78;
        v69 = *v78;
        do
        {
          v14 = 0;
          v70 = v12;
          do
          {
            if (*v78 != v13)
            {
              objc_enumerationMutation(obj);
            }

            v15 = *(*(&v77 + 1) + 8 * v14);
            v16 = [v15 service];
            v17 = [v16 bulletinBoardNotification];
            v18 = [v17 isEnabled];

            if (v18)
            {
              v19 = objc_autoreleasePoolPush();
              v20 = self;
              v21 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
              {
                v22 = HMFGetLogIdentifier();
                v23 = [v15 shortDescription];
                *buf = 138543618;
                v83 = v22;
                v84 = 2112;
                v85 = v23;
                _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Notification is enabled for characteristic: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v19);
              v24 = [v16 bulletinBoardNotification];
              v25 = [v24 condition];

              if (v25)
              {
                v26 = [(HMDHome *)v20 predicateUtility];
                v27 = [v26 containsPresenceEvents:v25];
                if (v9 || (v27 & 1) == 0)
                {
                  v33 = [v26 rewritePredicate:v25 currentCharacteristicInPredicate:0 characteristicsToRead:0 homePresence:v9];
                  v88 = @"THIS_OBJECT";
                  v89 = v26;
                  v39 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v89 forKeys:&v88 count:1];
                  [v33 allowEvaluation];
                  v40 = [v33 evaluateWithObject:v26 substitutionVariables:v39];
                  context = objc_autoreleasePoolPush();
                  v41 = v20;
                  v42 = HMFGetOSLogHandle();
                  v43 = os_log_type_enabled(v42, OS_LOG_TYPE_INFO);
                  if (v40)
                  {
                    if (v43)
                    {
                      v44 = HMFGetLogIdentifier();
                      *buf = 138543874;
                      v83 = v44;
                      v84 = 2112;
                      v85 = v25;
                      v86 = 2112;
                      v87 = v15;
                      _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_INFO, "%{public}@Condition %@ for characteristic (%@) evaluates to true, posting bulletin for it.", buf, 0x20u);
                    }

                    objc_autoreleasePoolPop(context);
                    [v67 addObject:v15];
                  }

                  else
                  {
                    if (v43)
                    {
                      v45 = HMFGetLogIdentifier();
                      *buf = 138543874;
                      v83 = v45;
                      v84 = 2112;
                      v85 = v25;
                      v86 = 2112;
                      v87 = v15;
                      _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_INFO, "%{public}@Condition %@ for characteristic (%@) evaluates to false, not posting bulletin for it.", buf, 0x20u);
                    }

                    objc_autoreleasePoolPop(context);
                  }

                  v9 = v66;
                }

                else
                {
                  v28 = objc_autoreleasePoolPush();
                  v29 = v20;
                  v30 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
                  {
                    v31 = HMFGetLogIdentifier();
                    *buf = 138543874;
                    v83 = v31;
                    v84 = 2112;
                    v85 = v25;
                    v86 = 2112;
                    v87 = v15;
                    _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@Condition %@ contains presence and no homePresence presents, delaying bulletin for characteristic %@", buf, 0x20u);

                    v9 = v66;
                  }

                  objc_autoreleasePoolPop(v28);
                  v32 = [v16 uuid];
                  v33 = [v65 objectForKeyedSubscript:v32];

                  if (!v33)
                  {
                    v33 = [MEMORY[0x277CBEB18] array];
                    v34 = [v16 uuid];
                    [v65 setObject:v33 forKeyedSubscript:v34];
                  }

                  [v33 addObject:v15];
                }

                v13 = v69;

                self = v72;
              }

              else
              {
                v35 = objc_autoreleasePoolPush();
                v36 = v20;
                v37 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
                {
                  v38 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v83 = v38;
                  v84 = 2112;
                  v85 = v15;
                  _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@No condition is present in chr (%@)", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v35);
                [v67 addObject:v15];
                v13 = v69;
              }

              v12 = v70;
            }

            ++v14;
          }

          while (v12 != v14);
          v12 = [obj countByEnumeratingWithState:&v77 objects:v90 count:16];
        }

        while (v12);
      }

      v46 = v67;
      v10 = v63;
      if ([v67 count])
      {
        (*(v63 + 2))(v63, 0, v67);
      }

      v47 = v65;
      if ([v65 count])
      {
        v75 = 0u;
        v76 = 0u;
        v73 = 0u;
        v74 = 0u;
        v48 = [v65 allValues];
        v49 = [v48 countByEnumeratingWithState:&v73 objects:v81 count:16];
        if (v49)
        {
          v50 = v49;
          v51 = *v74;
          do
          {
            for (i = 0; i != v50; ++i)
            {
              if (*v74 != v51)
              {
                objc_enumerationMutation(v48);
              }

              v53 = *(*(&v73 + 1) + 8 * i);
              v54 = [v53 firstObject];
              v55 = [v54 service];
              v56 = [v55 bulletinBoardNotification];
              v57 = [v56 condition];
              [(HMDHome *)v72 dispatchRequestToEvaluateCondition:v57 forCharacteristics:v53 completion:v63];
            }

            v50 = [v48 countByEnumeratingWithState:&v73 objects:v81 count:16];
          }

          while (v50);
        }

        v47 = v65;
        v9 = v66;
        v46 = v67;
      }

      v8 = v64;
    }

    else
    {
      v58 = objc_autoreleasePoolPush();
      v59 = self;
      v60 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v60, OS_LOG_TYPE_DEBUG))
      {
        v61 = HMFGetLogIdentifier();
        *buf = 138543618;
        v83 = v61;
        v84 = 2112;
        v85 = v8;
        _os_log_impl(&dword_2531F8000, v60, OS_LOG_TYPE_DEBUG, "%{public}@Bulletin notifications are not supported, skipping evaluating bulletin for characteristics: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v58);
      (*(v10 + 2))(v10, 0, MEMORY[0x277CBEBF8]);
    }
  }

  v62 = *MEMORY[0x277D85DE8];
}

- (void)reevaluateAccessoryInfo
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v11 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Re-evaluating accessory info", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v7 = [(HMDHome *)v4 workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __34__HMDHome_reevaluateAccessoryInfo__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = v4;
  dispatch_async(v7, block);

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_reevaluateAccessoryInfoWithBadgeRefresh:(BOOL)a3
{
  v3 = a3;
  v22 = *MEMORY[0x277D85DE8];
  v5 = [(HMDHome *)self isOwnerUser];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = HMFBooleanToString();
    v11 = HMFBooleanToString();
    v16 = 138543874;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Re-evaluating accessory info with shouldRefreshBadge: %@, isOwnerUser: %@, ", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v6);
  if (v5)
  {
    v12 = +[HMDBulletinBoard sharedBulletinBoard];
    v13 = [v12 updateBulletinForFirmwareUpdateInHome:v7];
  }

  if (v3)
  {
    v14 = +[HMDBulletinBoard sharedBulletinBoard];
    [v14 refreshHomeBadgeNumber];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)sendFirmwareUpdateUINotification:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self isOwnerUser];
  v6 = [(HMDHome *)self isSharedAdmin];
  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = HMFBooleanToString();
    v12 = HMFBooleanToString();
    v15 = 138543874;
    v16 = v10;
    v17 = 2112;
    v18 = v11;
    v19 = 2112;
    v20 = v12;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Firmware update UI notification is issued, isOwnerUser: %@, isSharedAdminUser:%@ ", &v15, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  if (v5 || v6)
  {
    v13 = +[HMDBulletinBoard sharedBulletinBoard];
    [v13 insertBulletinsForMatterFirmwareUpdateInstalledInHome:v8 hmdHAPAccessory:v4];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)a3 shouldRefreshBadge:(BOOL)a4 withCompletion:(id)a5
{
  v6 = a4;
  v84 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  if ([v8 count])
  {
    v64 = self;
    v65 = v6;
    v66 = v9;
    v70 = [MEMORY[0x277CBEB38] dictionary];
    v69 = [MEMORY[0x277CBEB38] dictionary];
    v73 = 0u;
    v74 = 0u;
    v75 = 0u;
    v76 = 0u;
    v67 = v8;
    obj = v8;
    v10 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
    v62 = v10;
    v11 = 0;
    if (!v10)
    {
      goto LABEL_36;
    }

    v71 = *v74;
    v72 = v10;
    while (1)
    {
      for (i = 0; i != v72; ++i)
      {
        if (*v74 != v71)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v73 + 1) + 8 * i);
        v14 = [v13 vendorInfo];
        v15 = [v13 firmwareVersion];
        if (v15)
        {
          v16 = [v14 firmwareVersion];
          v17 = [v13 firmwareVersion];
          v18 = [v16 isGreaterThanVersion:v17];
        }

        else
        {
          v18 = 0;
        }

        v19 = [MEMORY[0x277CBEB38] dictionary];
        v20 = [MEMORY[0x277CBEB38] dictionary];
        v21 = [v14 appBundleID];

        if (v21)
        {
          v22 = [v14 appBundleID];
          [v20 setObject:v22 forKeyedSubscript:@"kAccessoryVendorInfoBundleIDKey"];

          v11 = 1;
        }

        v23 = [v14 appStoreID];

        if (v23)
        {
          v24 = [v14 appStoreID];
          [v20 setObject:v24 forKeyedSubscript:@"kAccessoryVendorInfoStoreIDKey"];

          v11 = 1;
        }

        v25 = [MEMORY[0x277CCABB0] numberWithBool:v18];
        [v20 setObject:v25 forKeyedSubscript:@"kAccessoryVendorInfoFirmwareUpdateAvailableKey"];

        v26 = [v13 serialNumber];

        if (v26)
        {
          v27 = [v13 serialNumber];
          [v20 setObject:v27 forKeyedSubscript:@"kAccessoryInfoSerialNumberKey"];

          v11 = 1;
        }

        v28 = [v13 manufacturer];

        if (v28)
        {
          v29 = [v13 manufacturer];
          [v19 setObject:v29 forKeyedSubscript:@"kAccessoryInfoManufacturerKey"];

          v30 = [v13 manufacturer];
          [v20 setObject:v30 forKeyedSubscript:@"kAccessoryInfoManufacturerKey"];
        }

        v31 = [v13 model];

        if (v31)
        {
          v32 = [v13 model];
          [v19 setObject:v32 forKeyedSubscript:@"kAccessoryInfoModelKey"];

          v33 = [v13 model];
          [v20 setObject:v33 forKeyedSubscript:@"kAccessoryInfoModelKey"];
        }

        v34 = v13;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v35 = v34;
        }

        else
        {
          v35 = 0;
        }

        v36 = v35;

        if (v36 && [v36 supportsCHIP])
        {
          v37 = [v34 displayableFirmwareVersion];

          if (!v37)
          {
            goto LABEL_30;
          }

          v38 = [v34 displayableFirmwareVersion];
          [v19 setObject:v38 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];

          v39 = [v34 displayableFirmwareVersion];
          [v20 setObject:v39 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];
        }

        else
        {
          v40 = [v34 firmwareVersion];

          if (!v40)
          {
            goto LABEL_30;
          }

          v41 = [v34 firmwareVersion];
          v42 = [v41 shortVersionString];
          [v19 setObject:v42 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];

          v39 = [v34 firmwareVersion];
          v43 = [v39 shortVersionString];
          [v20 setObject:v43 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];
        }

LABEL_30:
        if ([v20 count])
        {
          v44 = [v34 uuid];
          v45 = [v44 UUIDString];
          [v69 setObject:v20 forKeyedSubscript:v45];
        }

        if ([v19 count])
        {
          v46 = [v34 uuid];
          v47 = [v46 UUIDString];
          [v70 setObject:v19 forKeyedSubscript:v47];
        }
      }

      v72 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
      if (!v72)
      {
LABEL_36:

        v48 = objc_autoreleasePoolPush();
        v49 = v64;
        v50 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
        {
          v51 = HMFGetLogIdentifier();
          *buf = 138543874;
          v78 = v51;
          v79 = 2112;
          v80 = v70;
          v81 = 2112;
          v82 = v69;
          _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_INFO, "%{public}@Notify clients that vendor info has updated: %@  entitledInfo %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v48);
        v52 = v70;
        v53 = [v70 count];
        v54 = MEMORY[0x277CD1F98];
        if (v53)
        {
          v55 = [MEMORY[0x277D0F818] messageWithName:*MEMORY[0x277CD1F98] messagePayload:v70];
          v56 = [(HMDHome *)v49 msgDispatcher];
          v57 = [(HMDHome *)v49 messageTargetUUID];
          [v56 sendMessage:v55 target:v57];

          v52 = v70;
        }

        if (v11)
        {
          v58 = [MEMORY[0x277D0F818] entitledMessageWithName:*v54 messagePayload:v69];
          v59 = [(HMDHome *)v49 msgDispatcher];
          v60 = [(HMDHome *)v49 messageTargetUUID];
          [v59 sendMessage:v58 target:v60];
        }

        [(HMDHome *)v49 _reevaluateAccessoryInfoWithBadgeRefresh:v65, v62];
        v9 = v66;
        if (v66)
        {
          (v66)[2](v66, v63 != 0);
        }

        v8 = v67;
        goto LABEL_47;
      }
    }
  }

  if (v9)
  {
    v9[2](v9, 0);
  }

LABEL_47:

  v61 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __61__HMDHome_notifyClientsOfAccessoryInfoUpdatedForAccessories___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)_removeCloudData
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = [HMDCameraProfileSettingsManager zoneNameForHome:self];
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v23 = v8;
    v24 = 2112;
    v25 = v4;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Removing camera profile settings manager zone named %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = +[HMDDatabase defaultDatabase];
  v10 = [v9 removePrivateZonesWithName:v4];
  v16 = MEMORY[0x277D85DD0];
  v17 = 3221225472;
  v18 = __27__HMDHome__removeCloudData__block_invoke;
  v19 = &unk_2797358C8;
  v20 = v6;
  v21 = v4;
  v11 = v4;
  v12 = [v10 addFailureBlock:&v16];

  v13 = [(HMDHome *)v6 userActionPredictionManager:v16];
  [v13 removeZones];

  v14 = [(HMDHome *)v6 personDataManager];
  [v14 removeCloudDataDueToHomeRemoval];

  v15 = *MEMORY[0x277D85DE8];
}

void __27__HMDHome__removeCloudData__block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove camera profile settings manager zone named %@: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
}

- (void)handleHomeWasRemoved
{
  v2 = [(HMDHome *)self walletKeyManager];
  [v2 handleHomeWasRemoved];
}

- (void)_removeAllHomeContentsAndAccessoryPairings:(BOOL)a3 queue:(id)a4 completionHandler:(id)a5
{
  v45 = a3;
  v76 = *MEMORY[0x277D85DE8];
  v42 = a4;
  v43 = a5;
  v7 = objc_autoreleasePoolPush();
  val = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v69 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Removing all home contents and accessory pairings", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v7);
  v10 = [(HMDHome *)val walletKeyManager];
  [v10 handleHomeWillBeRemoved];

  v66 = 0u;
  v67 = 0u;
  v64 = 0u;
  v65 = 0u;
  v11 = [(HMDHome *)val triggers];
  v12 = [v11 countByEnumeratingWithState:&v64 objects:v75 count:16];
  if (v12)
  {
    v13 = *v65;
    do
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v65 != v13)
        {
          objc_enumerationMutation(v11);
        }

        [*(*(&v64 + 1) + 8 * i) invalidate];
      }

      v12 = [v11 countByEnumeratingWithState:&v64 objects:v75 count:16];
    }

    while (v12);
  }

  v62 = 0u;
  v63 = 0u;
  v60 = 0u;
  v61 = 0u;
  v15 = [(HMDHome *)val actionSets];
  v16 = [v15 countByEnumeratingWithState:&v60 objects:v74 count:16];
  if (v16)
  {
    v17 = *v61;
    do
    {
      for (j = 0; j != v16; ++j)
      {
        if (*v61 != v17)
        {
          objc_enumerationMutation(v15);
        }

        [*(*(&v60 + 1) + 8 * j) invalidate];
      }

      v16 = [v15 countByEnumeratingWithState:&v60 objects:v74 count:16];
    }

    while (v16);
  }

  v58 = 0u;
  v59 = 0u;
  v56 = 0u;
  v57 = 0u;
  v19 = [(HMDHome *)val users];
  v20 = [v19 copy];

  v21 = [v20 countByEnumeratingWithState:&v56 objects:v73 count:16];
  if (v21)
  {
    v22 = *v57;
    do
    {
      for (k = 0; k != v21; ++k)
      {
        if (*v57 != v22)
        {
          objc_enumerationMutation(v20);
        }

        v24 = *(*(&v56 + 1) + 8 * k);
        [v24 removeCloudData];
        [v24 unconfigure];
      }

      v21 = [v20 countByEnumeratingWithState:&v56 objects:v73 count:16];
    }

    while (v21);
  }

  v25 = [(HMDHome *)val accessories];
  v44 = [v25 na_map:&__block_literal_global_1334];

  [(HMDHome *)val _registerResidentReachabilityNotificationWithEnableAccessories:MEMORY[0x277CBEBF8] disableAccessories:v44 completionHandler:0];
  objc_initWeak(&location, val);
  group = dispatch_group_create();
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  v26 = [(HMDHome *)val accessories];
  v27 = [v26 countByEnumeratingWithState:&v51 objects:v72 count:16];
  if (v27)
  {
    v28 = *v52;
    do
    {
      for (m = 0; m != v27; ++m)
      {
        if (*v52 != v28)
        {
          objc_enumerationMutation(v26);
        }

        v30 = *(*(&v51 + 1) + 8 * m);
        if ([v30 isPrimary])
        {
          v31 = objc_autoreleasePoolPush();
          v32 = val;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v69 = v34;
            v70 = 2112;
            v71 = v30;
            _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Removing primary accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          dispatch_group_enter(group);
          aBlock[0] = MEMORY[0x277D85DD0];
          aBlock[1] = 3221225472;
          aBlock[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1335;
          aBlock[3] = &unk_279732670;
          objc_copyWeak(&v50, &location);
          aBlock[4] = v30;
          v49 = group;
          v35 = _Block_copy(aBlock);
          v36 = v35;
          if (v45)
          {
            [(HMDHome *)v32 removeAllUsersAndCloudDataFromAccessory:v30 completionHandler:v35];
          }

          else
          {
            (*(v35 + 2))(v35);
          }

          objc_destroyWeak(&v50);
        }
      }

      v27 = [v26 countByEnumeratingWithState:&v51 objects:v72 count:16];
    }

    while (v27);
  }

  [(HMDHome *)val _removeCloudData];
  dispatch_group_notify(group, v42, v43);
  v37 = objc_autoreleasePoolPush();
  v38 = val;
  v39 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
  {
    v40 = HMFGetLogIdentifier();
    *buf = 138543362;
    v69 = v40;
    _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Removed all accessories", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v37);
  objc_destroyWeak(&location);

  v41 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1335(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v3 = *(a1 + 32);
    v5[0] = MEMORY[0x277D85DD0];
    v5[1] = 3221225472;
    v5[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_2;
    v5[3] = &unk_2797352E8;
    objc_copyWeak(&v7, (a1 + 48));
    v4 = *(a1 + 40);
    v5[4] = *(a1 + 32);
    v6 = v4;
    [WeakRetained _removeAccessory:v3 completionHandler:v5];

    objc_destroyWeak(&v7);
  }

  else
  {
    dispatch_group_leave(*(a1 + 40));
  }
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v30 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    *buf = 138543874;
    v25 = v11;
    v26 = 2112;
    v27 = v12;
    v28 = 2112;
    v29 = v6;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed primary accessory, %@, with error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  if (v9)
  {
    v13 = [v9 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1336;
    block[3] = &unk_2797352C0;
    v19 = v6;
    v20 = v9;
    v14 = v5;
    v15 = *(a1 + 32);
    v16 = *(a1 + 40);
    v21 = v14;
    v22 = v15;
    v23 = v16;
    dispatch_async(v13, block);
  }

  else
  {
    dispatch_group_leave(*(a1 + 40));
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1336(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  if (*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v6 = *(a1 + 56);
      v7 = *(a1 + 32);
      v9 = 138543874;
      v10 = v5;
      v11 = 2112;
      v12 = v6;
      v13 = 2112;
      v14 = v7;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove accessory %@ with error: %@", &v9, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
  }

  else
  {
    [*(a1 + 40) _removeAccessories:*(a1 + 48) message:0];
  }

  dispatch_group_leave(*(a1 + 64));
  v8 = *MEMORY[0x277D85DE8];
}

id __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 cameraProfiles];
  v6 = [v5 count];

  if (v6)
  {
    v7 = v4;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (void)_removeAccessories:(id)a3 message:(id)a4
{
  v56 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self _removeAccessoriesCommon:v6];
  v9 = [v7 name];
  v10 = [v9 isEqualToString:*MEMORY[0x277CD24F0]];

  if (v10)
  {
    v11 = [MEMORY[0x277CBEB38] dictionary];
    [v11 setObject:v8 forKeyedSubscript:*MEMORY[0x277CCE7A8]];
    v12 = [v11 copy];
    [v7 respondWithPayload:v12];
  }

  else
  {
    [v7 respondWithSuccess];
  }

  v47 = 0u;
  v48 = 0u;
  v45 = 0u;
  v46 = 0u;
  obj = v6;
  v13 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v46;
    do
    {
      v16 = 0;
      v43 = v14;
      do
      {
        if (*v46 != v15)
        {
          objc_enumerationMutation(obj);
        }

        v17 = *(*(&v45 + 1) + 8 * v16);
        v18 = objc_autoreleasePoolPush();
        v19 = self;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
        {
          v21 = HMFGetLogIdentifier();
          *buf = 138543618;
          v52 = v21;
          v53 = 2112;
          v54 = v17;
          _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Removing accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
        v22 = v17;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v23 = v22;
        }

        else
        {
          v23 = 0;
        }

        v24 = v23;

        if (v24)
        {
          if ([v24 isCurrentAccessory])
          {
            v25 = v15;
            v26 = self;
            v27 = objc_autoreleasePoolPush();
            v28 = v19;
            v29 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
            {
              v30 = HMFGetLogIdentifier();
              *buf = 138543618;
              v52 = v30;
              v53 = 2112;
              v54 = v22;
              _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Posting notification about current accessory removal %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v27);
            v31 = [(HMDHome *)v28 notificationCenter];
            v49 = @"HMDLastRemovedCurrentAccessoryUUIDKey";
            v32 = [v24 uuid];
            v50 = v32;
            v33 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v50 forKeys:&v49 count:1];
            [v31 postNotificationName:@"HMDHomeManagerDidRemoveCurrentAccessoryNotification" object:v28 userInfo:v33];

            self = v26;
            v15 = v25;
            v14 = v43;
          }

          v34 = [(HMDHome *)v19 homeManager];
          v35 = [(HMDHome *)v19 capabilitiesAggregator];
          v36 = [v24 uuid];
          [v35 didRemoveAccessory:v36];

          v37 = [v24 uuid];
          v38 = [v34 accessorySetupMetricDispatcherForAccessoryUUID:v37];

          [v38 markAccessoryRemoved];
        }

        if ([v22 isPrimary])
        {
          v39 = [v22 identifier];
          [(HMDHome *)v19 _deregisterPairedAccessory:v39];
        }

        [v22 setHome:0];
        [v22 unconfigure];

        ++v16;
      }

      while (v14 != v16);
      v14 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
    }

    while (v14);
  }

  v40 = *MEMORY[0x277D85DE8];
}

- (id)_removeAccessoriesCommon:(id)a3
{
  v44 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v30 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v4, "count")}];
  [(HMDHome *)self _removeAccessoriesFromContainers:v4];
  v38 = 0u;
  v39 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = v4;
  v31 = [obj countByEnumeratingWithState:&v36 objects:v43 count:16];
  if (v31)
  {
    v29 = *v37;
    v28 = *MEMORY[0x277CCF0B0];
    do
    {
      for (i = 0; i != v31; ++i)
      {
        if (*v37 != v29)
        {
          objc_enumerationMutation(obj);
        }

        v6 = *(*(&v36 + 1) + 8 * i);
        [(HMDHome *)self removeAccessory:v6];
        v7 = [v6 getConfiguredName];

        if (v7)
        {
          v8 = [v6 getConfiguredName];
          v9 = [(HMDHome *)self removeName:v8];
        }

        v10 = v6;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v12)
        {
          v34 = 0u;
          v35 = 0u;
          v32 = 0u;
          v33 = 0u;
          v13 = [v12 services];
          v14 = [v13 countByEnumeratingWithState:&v32 objects:v42 count:16];
          if (v14)
          {
            v15 = v14;
            v16 = *v33;
            do
            {
              for (j = 0; j != v15; ++j)
              {
                if (*v33 != v16)
                {
                  objc_enumerationMutation(v13);
                }

                v18 = *(*(&v32 + 1) + 8 * j);
                v19 = [v18 getConfiguredName];

                if (v19)
                {
                  v20 = [v18 getConfiguredName];
                  v21 = [(HMDHome *)self removeName:v20];
                }
              }

              v15 = [v13 countByEnumeratingWithState:&v32 objects:v42 count:16];
            }

            while (v15);
          }
        }

        v40 = v28;
        v22 = [v10 uuid];
        v23 = [v22 UUIDString];
        v41 = v23;
        v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v41 forKeys:&v40 count:1];
        [v30 addObject:v24];
      }

      v31 = [obj countByEnumeratingWithState:&v36 objects:v43 count:16];
    }

    while (v31);
  }

  v25 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_removeAccessoriesFromContainers:(id)a3
{
  v75 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 count])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v72 = v8;
      v73 = 2112;
      v74 = v4;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Removing accessories from containers : [%@]", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [(HMDHome *)v6 backingStore];
    v10 = *MEMORY[0x277CD24E8];
    v11 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v12 = [v9 transaction:v10 options:v11];

    v64 = 0u;
    v65 = 0u;
    v62 = 0u;
    v63 = 0u;
    v41 = v4;
    obj = v4;
    v13 = [obj countByEnumeratingWithState:&v62 objects:v70 count:16];
    if (v13)
    {
      v14 = v13;
      v43 = *v63;
      do
      {
        v15 = 0;
        do
        {
          if (*v63 != v43)
          {
            objc_enumerationMutation(obj);
          }

          v16 = *(*(&v62 + 1) + 8 * v15);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v17 = v16;
          }

          else
          {
            v17 = 0;
          }

          v18 = v17;

          if (v18)
          {
            v60 = 0u;
            v61 = 0u;
            v58 = 0u;
            v59 = 0u;
            v19 = [(HMDHome *)v6 serviceGroups];
            v20 = [v19 countByEnumeratingWithState:&v58 objects:v69 count:16];
            if (v20)
            {
              v21 = v20;
              v22 = *v59;
              do
              {
                v23 = 0;
                do
                {
                  if (*v59 != v22)
                  {
                    objc_enumerationMutation(v19);
                  }

                  [*(*(&v58 + 1) + 8 * v23++) removeServicesForAccessory:{v18, v41}];
                }

                while (v21 != v23);
                v21 = [v19 countByEnumeratingWithState:&v58 objects:v69 count:16];
              }

              while (v21);
            }
          }

          v56 = 0u;
          v57 = 0u;
          v54 = 0u;
          v55 = 0u;
          v24 = [(HMDHome *)v6 actionSets];
          v25 = [v24 countByEnumeratingWithState:&v54 objects:v68 count:16];
          if (v25)
          {
            v26 = v25;
            v27 = *v55;
            do
            {
              v28 = 0;
              do
              {
                if (*v55 != v27)
                {
                  objc_enumerationMutation(v24);
                }

                [*(*(&v54 + 1) + 8 * v28++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v26 != v28);
              v26 = [v24 countByEnumeratingWithState:&v54 objects:v68 count:16];
            }

            while (v26);
          }

          v52 = 0u;
          v53 = 0u;
          v50 = 0u;
          v51 = 0u;
          v29 = [(HMDHome *)v6 triggerOwnedActionSets];
          v30 = [v29 countByEnumeratingWithState:&v50 objects:v67 count:16];
          if (v30)
          {
            v31 = v30;
            v32 = *v51;
            do
            {
              v33 = 0;
              do
              {
                if (*v51 != v32)
                {
                  objc_enumerationMutation(v29);
                }

                [*(*(&v50 + 1) + 8 * v33++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v31 != v33);
              v31 = [v29 countByEnumeratingWithState:&v50 objects:v67 count:16];
            }

            while (v31);
          }

          v48 = 0u;
          v49 = 0u;
          v46 = 0u;
          v47 = 0u;
          v34 = [(HMDHome *)v6 triggers];
          v35 = [v34 countByEnumeratingWithState:&v46 objects:v66 count:16];
          if (v35)
          {
            v36 = v35;
            v37 = *v47;
            do
            {
              v38 = 0;
              do
              {
                if (*v47 != v37)
                {
                  objc_enumerationMutation(v34);
                }

                [*(*(&v46 + 1) + 8 * v38++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v36 != v38);
              v36 = [v34 countByEnumeratingWithState:&v46 objects:v66 count:16];
            }

            while (v36);
          }

          v44[0] = MEMORY[0x277D85DD0];
          v44[1] = 3221225472;
          v44[2] = __44__HMDHome__removeAccessoriesFromContainers___block_invoke;
          v44[3] = &unk_2797358C8;
          v44[4] = v6;
          v45 = v18;
          v39 = v18;
          [v12 run:v44];

          ++v15;
        }

        while (v15 != v14);
        v14 = [obj countByEnumeratingWithState:&v62 objects:v70 count:16];
      }

      while (v14);
    }

    [(HMDHome *)v6 _evaluateShouldRelaunchAndSetRelaunch];
    v4 = v41;
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__removeAccessoriesFromContainers___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 40);
      v16 = 138543874;
      v17 = v8;
      v18 = 2112;
      v19 = v9;
      v20 = 2112;
      v21 = v3;
      v10 = "%{public}@Failed to commit removeAccessoriesFromContainersTransaction [%@]: %@";
      v11 = v7;
      v12 = OS_LOG_TYPE_ERROR;
      v13 = 32;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v11, v12, v10, &v16, v13);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v14 = *(a1 + 40);
    v16 = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = v14;
    v10 = "%{public}@Successfully finished running removeAccessoriesFromContainersTransaction : %@";
    v11 = v7;
    v12 = OS_LOG_TYPE_INFO;
    v13 = 22;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v4);
  v15 = *MEMORY[0x277D85DE8];
}

- (void)_removeService:(id)a3
{
  v60 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self backingStore];
  v6 = *MEMORY[0x277CD2528];
  v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v8 = [v5 transaction:v6 options:v7];

  v52 = 0u;
  v53 = 0u;
  v50 = 0u;
  v51 = 0u;
  v9 = [(HMDHome *)self serviceGroups];
  v10 = [v9 countByEnumeratingWithState:&v50 objects:v59 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v51;
    do
    {
      v13 = 0;
      do
      {
        if (*v51 != v12)
        {
          objc_enumerationMutation(v9);
        }

        [*(*(&v50 + 1) + 8 * v13++) removeService:v4];
      }

      while (v11 != v13);
      v11 = [v9 countByEnumeratingWithState:&v50 objects:v59 count:16];
    }

    while (v11);
  }

  v48 = 0u;
  v49 = 0u;
  v46 = 0u;
  v47 = 0u;
  v14 = [(HMDHome *)self actionSets];
  v15 = [v14 countByEnumeratingWithState:&v46 objects:v58 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v47;
    do
    {
      v18 = 0;
      do
      {
        if (*v47 != v17)
        {
          objc_enumerationMutation(v14);
        }

        [*(*(&v46 + 1) + 8 * v18++) handleRemovalOfService:v4 transaction:v8];
      }

      while (v16 != v18);
      v16 = [v14 countByEnumeratingWithState:&v46 objects:v58 count:16];
    }

    while (v16);
  }

  v44 = 0u;
  v45 = 0u;
  v42 = 0u;
  v43 = 0u;
  v19 = [(HMDHome *)self triggerOwnedActionSets];
  v20 = [v19 countByEnumeratingWithState:&v42 objects:v57 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v43;
    do
    {
      v23 = 0;
      do
      {
        if (*v43 != v22)
        {
          objc_enumerationMutation(v19);
        }

        [*(*(&v42 + 1) + 8 * v23++) handleRemovalOfService:v4 transaction:v8];
      }

      while (v21 != v23);
      v21 = [v19 countByEnumeratingWithState:&v42 objects:v57 count:16];
    }

    while (v21);
  }

  v24 = [v4 getConfiguredName];

  if (v24)
  {
    v25 = [v4 getConfiguredName];
    v26 = [(HMDHome *)self removeName:v25];
  }

  v40 = 0u;
  v41 = 0u;
  v38 = 0u;
  v39 = 0u;
  v27 = [(HMDHome *)self triggers];
  v28 = [v27 countByEnumeratingWithState:&v38 objects:v56 count:16];
  if (v28)
  {
    v29 = v28;
    v30 = *v39;
    do
    {
      v31 = 0;
      do
      {
        if (*v39 != v30)
        {
          objc_enumerationMutation(v27);
        }

        [*(*(&v38 + 1) + 8 * v31++) handleRemovalOfService:v4 transaction:v8];
      }

      while (v29 != v31);
      v29 = [v27 countByEnumeratingWithState:&v38 objects:v56 count:16];
    }

    while (v29);
  }

  v37[0] = MEMORY[0x277D85DD0];
  v37[1] = 3221225472;
  v37[2] = __26__HMDHome__removeService___block_invoke;
  v37[3] = &unk_2797359D8;
  v37[4] = self;
  [v8 run:v37];
  v32 = [(HMDHome *)self notificationCenter];
  v54 = @"HMDServiceNotificationKey";
  v55 = v4;
  v33 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v55 forKeys:&v54 count:1];
  [v32 postNotificationName:@"HMDHomeServiceRemovedNotification" object:self userInfo:v33];

  v34 = [(HMDHome *)self notificationRegistry];
  v35 = [v4 characteristics];
  [v34 removeRegistrationsForCharacteristics:v35];

  v36 = *MEMORY[0x277D85DE8];
}

void __26__HMDHome__removeService___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit removeServiceTransaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_removeCharacteristic:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self backingStore];
  v6 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v7 = [v5 transaction:@"kRemoveCharacteristicRequestKey" options:v6];

  v35 = 0u;
  v36 = 0u;
  v33 = 0u;
  v34 = 0u;
  v8 = [(HMDHome *)self actionSets];
  v9 = [v8 countByEnumeratingWithState:&v33 objects:v39 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v34;
    do
    {
      v12 = 0;
      do
      {
        if (*v34 != v11)
        {
          objc_enumerationMutation(v8);
        }

        [*(*(&v33 + 1) + 8 * v12++) handleRemovalOfActionForCharacteristic:v4 transaction:v7];
      }

      while (v10 != v12);
      v10 = [v8 countByEnumeratingWithState:&v33 objects:v39 count:16];
    }

    while (v10);
  }

  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  v13 = [(HMDHome *)self triggerOwnedActionSets];
  v14 = [v13 countByEnumeratingWithState:&v29 objects:v38 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v30;
    do
    {
      v17 = 0;
      do
      {
        if (*v30 != v16)
        {
          objc_enumerationMutation(v13);
        }

        [*(*(&v29 + 1) + 8 * v17++) handleRemovalOfActionForCharacteristic:v4 transaction:v7];
      }

      while (v15 != v17);
      v15 = [v13 countByEnumeratingWithState:&v29 objects:v38 count:16];
    }

    while (v15);
  }

  v27 = 0u;
  v28 = 0u;
  v25 = 0u;
  v26 = 0u;
  v18 = [(HMDHome *)self triggers];
  v19 = [v18 countByEnumeratingWithState:&v25 objects:v37 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v26;
    do
    {
      v22 = 0;
      do
      {
        if (*v26 != v21)
        {
          objc_enumerationMutation(v18);
        }

        [*(*(&v25 + 1) + 8 * v22++) handleRemovalOfCharacteristic:v4 transaction:v7];
      }

      while (v20 != v22);
      v20 = [v18 countByEnumeratingWithState:&v25 objects:v37 count:16];
    }

    while (v20);
  }

  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __33__HMDHome__removeCharacteristic___block_invoke;
  v24[3] = &unk_2797359D8;
  v24[4] = self;
  [v7 run:v24];

  v23 = *MEMORY[0x277D85DE8];
}

void __33__HMDHome__removeCharacteristic___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit removeCharacteristicTransaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_removeAccessoryWithUUID:(id)a3 message:(id)a4
{
  v29 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  objc_initWeak(&location, self);
  v8 = [(HMDHome *)self accessoryWithUUID:v6];
  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v12;
      v27 = 2112;
      v28 = v8;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Remove accessory name: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v13 = v8;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    *buf = 0;
    v16 = [v15 preferredHAPAccessoryForOperation:8 linkType:buf];
    v17 = [HMDAccessoryPairingEvent removingAccessory:v13 hapAccessory:v16];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __44__HMDHome__removeAccessoryWithUUID_message___block_invoke;
    v20[3] = &unk_279722540;
    objc_copyWeak(&v24, &location);
    v21 = v7;
    v18 = v17;
    v22 = v18;
    v23 = v13;
    [(HMDHome *)v10 _removeAccessory:v23 completionHandler:v20];

    objc_destroyWeak(&v24);
  }

  else
  {
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v7 respondWithError:v15];
  }

  objc_destroyWeak(&location);
  v19 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__removeAccessoryWithUUID_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 7);
  v8 = WeakRetained;
  if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __44__HMDHome__removeAccessoryWithUUID_message___block_invoke_2;
    v12[3] = &unk_27972F208;
    v12[4] = v8;
    v13 = a1[5];
    v14 = v6;
    v15 = v5;
    v16 = a1[4];
    v17 = a1[6];
    dispatch_async(v9, v12);
  }

  else
  {
    v10 = a1[4];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
    [v10 respondWithError:v11];
  }
}

void __44__HMDHome__removeAccessoryWithUUID_message___block_invoke_2(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) logEventSubmitter];
  [v2 submitLogEvent:*(a1 + 40) error:*(a1 + 48)];

  if (*(a1 + 48))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      v6 = HMFGetLogIdentifier();
      v7 = [*(a1 + 72) name];
      v8 = *(a1 + 48);
      *buf = 138543874;
      v14 = v6;
      v15 = 2112;
      v16 = v7;
      v17 = 2112;
      v18 = v8;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove accessory %@ with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 64) respondWithError:*(a1 + 48)];
    v9 = *MEMORY[0x277D85DE8];
  }

  else
  {
    [*(a1 + 32) _removeAccessories:*(a1 + 56) message:*(a1 + 64)];
    [*(a1 + 32) updateHomeLocation];
    v10 = *(a1 + 32);
    v12 = [*(a1 + 64) name];
    [v10 saveWithReason:? postSyncNotification:?];
    v11 = *MEMORY[0x277D85DE8];
  }
}

- (void)_removeAccessory:(id)a3 completionHandler:(id)a4
{
  v42 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if ([v6 isPrimary])
  {
    v8 = [(HMDHome *)self removeAccessoryInProgressForHMDAccessories];
    v9 = [v8 containsObject:v6];

    if (v9)
    {
      v10 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543618;
        v39 = v13;
        v40 = 2112;
        v41 = v6;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Already have a remove operation queued for accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      v36[0] = *MEMORY[0x277CCA450];
      v14 = MEMORY[0x277CCACA8];
      v15 = [v6 name];
      v16 = [v6 uuid];
      v17 = [v14 stringWithFormat:@"Failed to remove accessory %@(%@)", v15, v16];
      v36[1] = *MEMORY[0x277CCA470];
      v37[0] = v17;
      v18 = MEMORY[0x277CCACA8];
      v19 = [MEMORY[0x277CCA9B8] hmStringFromErrorCode:15];
      v20 = [v18 stringWithFormat:@"%ld (%@) This accessory is already being removed from the home.", 15, v19];
      v37[1] = v20;
      v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v37 forKeys:v36 count:2];

      v22 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:15 userInfo:v21];
      if (v7)
      {
        v7[2](v7, 0, v22);
      }
    }

    else
    {
      v27 = v6;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v28 = v27;
      }

      else
      {
        v28 = 0;
      }

      v21 = v28;

      v29 = [v27 home];
      if ([v29 isAdminUser])
      {
        v30 = [v21 isPaired];

        if (v30)
        {
          os_unfair_recursive_lock_lock_with_options();
          [(NSHashTable *)self->_removeAccessoryInProgressForHMDAccessories addObject:v21];
          os_unfair_recursive_lock_unlock();
          v31 = objc_autoreleasePoolPush();
          v32 = self;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v39 = v34;
            v40 = 2112;
            v41 = v21;
            _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Removing accessory %@. Also added accessory in removal-in-progress array", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          [(HMDHome *)v32 _removeAccessoriesForPrimaryAccessory:v21 error:0 completionHandler:v7];
          goto LABEL_22;
        }
      }

      else
      {
      }

      [(HMDHome *)self _removeAccessoriesForPrimaryAccessory:v27 error:0 completionHandler:v7];
    }

LABEL_22:

    goto LABEL_23;
  }

  v23 = objc_autoreleasePoolPush();
  v24 = self;
  v25 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
  {
    v26 = HMFGetLogIdentifier();
    *buf = 138543618;
    v39 = v26;
    v40 = 2112;
    v41 = v6;
    _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@cannot remove non-primary accessory %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v23);
  if (v7)
  {
    v21 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:34 userInfo:0];
    v7[2](v7, 0, v21);
    goto LABEL_22;
  }

LABEL_23:

  v35 = *MEMORY[0x277D85DE8];
}

- (void)removeAccessory:(id)a3 completionHandler:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __45__HMDHome_removeAccessory_completionHandler___block_invoke;
  block[3] = &unk_2797355D0;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(v8, block);
}

- (void)_removeAccessoriesForPrimaryAccessory:(id)a3 error:(id)a4 completionHandler:(id)a5
{
  v83 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if (!v8)
  {
    v53 = objc_autoreleasePoolPush();
    v54 = self;
    v55 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v55, OS_LOG_TYPE_ERROR))
    {
      v56 = HMFGetLogIdentifier();
      *buf = 138543362;
      v77 = v56;
      _os_log_impl(&dword_2531F8000, v55, OS_LOG_TYPE_ERROR, "%{public}@Nil accessory was passed to remove it from the home.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v53);
    v57 = MEMORY[0x277CCA9B8];
    v58 = *MEMORY[0x277CCFD28];
    v59 = 20;
    goto LABEL_50;
  }

  if (([v8 isPrimary] & 1) == 0)
  {
    v60 = objc_autoreleasePoolPush();
    v54 = self;
    v61 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
    {
      v62 = HMFGetLogIdentifier();
      *buf = 138543618;
      v77 = v62;
      v78 = 2112;
      v79 = v8;
      _os_log_impl(&dword_2531F8000, v61, OS_LOG_TYPE_ERROR, "%{public}@Accessory is not primary (Bridged). Not moving further. [%@]", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v60);
    v57 = MEMORY[0x277CCA9B8];
    v58 = *MEMORY[0x277CCFD28];
    v59 = 34;
LABEL_50:
    v11 = [v57 errorWithDomain:v58 code:v59 userInfo:0];
    [(HMDHome *)v54 _sendRemoveCompletionStatusForHMDAccessories:0 withCompletion:v10 error:v11];
    goto LABEL_51;
  }

  v11 = [MEMORY[0x277CBEB18] array];
  [(HMDHome *)self removeAccessory:v8];
  [v11 addObject:v8];
  v12 = +[HMDBulletinBoard sharedBulletinBoard];
  [v12 removeBulletinsForAccessory:v8];

  v13 = v8;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  if (isKindOfClass)
  {
    v15 = v13;
  }

  else
  {
    v15 = 0;
  }

  v70 = v15;

  if (isKindOfClass)
  {
    v66 = v13;
    v67 = v9;
    v68 = self;
    v69 = v11;
    v64 = v10;
    v65 = v8;
    v74 = 0u;
    v75 = 0u;
    v72 = 0u;
    v73 = 0u;
    v16 = [(HMDHome *)self accessories];
    v17 = [v16 countByEnumeratingWithState:&v72 objects:v82 count:16];
    if (v17)
    {
      v18 = v17;
      v19 = *v73;
      do
      {
        for (i = 0; i != v18; ++i)
        {
          if (*v73 != v19)
          {
            objc_enumerationMutation(v16);
          }

          v21 = *(*(&v72 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v22 = v21;
          }

          else
          {
            v22 = 0;
          }

          v23 = v22;

          v24 = [v23 identifier];
          v25 = [v70 identifier];
          if (([v24 isEqualToString:v25] & 1) == 0)
          {

            goto LABEL_20;
          }

          v26 = [v23 hostAccessory];
          objc_opt_class();
          v27 = objc_opt_isKindOfClass();

          if ((v27 & 1) == 0 || !v26)
          {
            [(HMDHome *)v68 removeAccessory:v21];
            [v69 addObject:v21];
            v24 = +[HMDBulletinBoard sharedBulletinBoard];
            [v24 removeBulletinsForAccessory:v21];
LABEL_20:
          }
        }

        v18 = [v16 countByEnumeratingWithState:&v72 objects:v82 count:16];
      }

      while (v18);
    }

    v13 = v66;
    v28 = [v66 isReachable];
    v8 = v65;
    v9 = v67;
    self = v68;
    v11 = v69;
    if (v67 || !v28 || ([v66 home], v29 = objc_claimAutoreleasedReturnValue(), v30 = objc_msgSend(v29, "isAdminUser"), v29, (v30 & 1) == 0))
    {
      v31 = [(HMDHome *)v68 keychainStore];
      v32 = [v70 identifier];
      v71 = 0;
      [v31 removeAccessoryKeyForName:v32 error:&v71];
      v33 = v71;

      if (v33)
      {
        v34 = objc_autoreleasePoolPush();
        v35 = v68;
        v36 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          v37 = HMFGetLogIdentifier();
          v38 = [v66 name];
          v39 = [v70 identifier];
          *buf = 138543874;
          v77 = v37;
          v78 = 2112;
          v79 = v38;
          v80 = 2112;
          v81 = v39;
          _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove keychain entry for accessory %@ with identifier: %@", buf, 0x20u);

          v11 = v69;
          v13 = v66;
        }

        objc_autoreleasePoolPop(v34);
        v9 = v67;
      }
    }

    v40 = [v70 identifier];
    [(HMDHome *)v68 _deregisterPairedAccessory:v40];

    v10 = v64;
  }

  v41 = v13;
  objc_opt_class();
  v42 = objc_opt_isKindOfClass();
  if (v42)
  {
    v43 = v41;
  }

  else
  {
    v43 = 0;
  }

  v44 = v43;

  if (v42)
  {
    v45 = [v41 mediaProfile];
    if (v45)
    {
      v46 = [(HMDHome *)self notificationRegistry];
      [v46 removeRegistrationsForMediaProfile:v45];

      v47 = [v41 identifier];
      v48 = [(HMDHome *)self mediaSessionStateWithIdentifier:v47];

      if (v48)
      {
        [(HMDHome *)self removeMediaSessionState:v48];
      }
    }
  }

  v49 = objc_autoreleasePoolPush();
  v50 = self;
  v51 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
  {
    v52 = HMFGetLogIdentifier();
    *buf = 138543618;
    v77 = v52;
    v78 = 2112;
    v79 = v11;
    _os_log_impl(&dword_2531F8000, v51, OS_LOG_TYPE_INFO, "%{public}@removedAccessories %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v49);
  [(HMDHome *)v50 _sendRemoveCompletionStatusForHMDAccessories:v11 withCompletion:v10 error:0];

LABEL_51:
  v63 = *MEMORY[0x277D85DE8];
}

- (void)_sendRemoveCompletionStatusForHMDAccessories:(id)a3 withCompletion:(id)a4 error:(id)a5
{
  v42 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v28 = a4;
  v29 = a5;
  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v28)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543874;
      v37 = v13;
      v38 = 2112;
      v39 = v29;
      v40 = 2112;
      v41 = v8;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Sending removal completion with error %@, accessories %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    v28[2](v28, v8, v29);
  }

  else
  {
    if (v12)
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v37 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@sending removal completion for accessory removal: no completion found", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
  }

  v33 = 0u;
  v34 = 0u;
  v31 = 0u;
  v32 = 0u;
  obj = v8;
  v15 = [obj countByEnumeratingWithState:&v31 objects:v35 count:16];
  if (v15)
  {
    v16 = *v32;
    do
    {
      v17 = 0;
      do
      {
        if (*v32 != v16)
        {
          objc_enumerationMutation(obj);
        }

        v18 = *(*(&v31 + 1) + 8 * v17);
        os_unfair_recursive_lock_lock_with_options();
        [(NSHashTable *)v10->_removeAccessoryInProgressForHMDAccessories removeObject:v18];
        os_unfair_recursive_lock_unlock();
        v19 = v18;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v20 = v19;
        }

        else
        {
          v20 = 0;
        }

        v21 = v20;

        if (v21 && [v19 isPrimary])
        {
          v22 = [v21 getPrimaryHAPAccessories];
          v23 = [v22 firstObject];
          v24 = [v23 server];

          v25 = [(HMDHome *)v10 accessoryBrowser];
          v26 = [v21 identifier];
          [v25 addUnpairedAccessoryServer:v24 identifier:v26];
        }

        ++v17;
      }

      while (v15 != v17);
      v15 = [obj countByEnumeratingWithState:&v31 objects:v35 count:16];
    }

    while (v15);
  }

  if ([obj count])
  {
    [(HMDHome *)v10 _reevaluateAccessoryInfoWithBadgeRefresh:1];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientOfNewlyAddedAccessories:(id)a3 requestMessage:(id)a4
{
  v79 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v58 = a4;
  v59 = [MEMORY[0x277CBEB18] array];
  v62 = [MEMORY[0x277CBEB18] array];
  v66 = 0u;
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  obj = v6;
  v7 = [obj countByEnumeratingWithState:&v66 objects:v78 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v67;
    v61 = *MEMORY[0x277CCF0B0];
    v60 = *MEMORY[0x277CCEA00];
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v67 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v66 + 1) + 8 * i);
        v12 = accessoryToEncodeForXPCTransportForAccessory(v11);
        if (v12 == v11)
        {
          v72[0] = v61;
          v17 = [v11 uuid];
          v72[1] = v60;
          v73[0] = v17;
          v18 = encodeRootObjectForSPIClients(v11);
          v73[1] = v18;
          v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v73 forKeys:v72 count:2];

          v20 = [v19 copy];
          [v62 addObject:v20];

          v21 = v11;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v22 = v21;
          }

          else
          {
            v22 = 0;
          }

          v23 = v22;

          v24 = v21;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();

          if (v23 || (isKindOfClass & (v24 != 0)) != 0)
          {
            [v59 addObject:v19];
          }
        }

        else
        {
          v13 = objc_autoreleasePoolPush();
          v14 = self;
          v15 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
          {
            v16 = HMFGetLogIdentifier();
            *buf = 138543618;
            v75 = v16;
            v76 = 2112;
            v77 = v11;
            _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Skipping notifying clients of added accessory: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v13);
        }
      }

      v8 = [obj countByEnumeratingWithState:&v66 objects:v78 count:16];
    }

    while (v8);
  }

  v70 = *MEMORY[0x277CD0640];
  v26 = [(HMDHome *)self uuid];
  v71 = v26;
  v27 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v71 forKeys:&v70 count:1];

  if ([v59 count])
  {
    v28 = [v27 mutableCopy];
    v29 = [v59 copy];
    v30 = *MEMORY[0x277CCE7A8];
    [v28 setObject:v29 forKeyedSubscript:*MEMORY[0x277CCE7A8]];

    v31 = objc_autoreleasePoolPush();
    v32 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543618;
      v75 = v34;
      v76 = 2112;
      v77 = v28;
      _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Notifying non-SPI-entitled clients of added accessories using payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v31);
    v35 = [MEMORY[0x277D0F848] nonSPIEntitledMessageWithName:*MEMORY[0x277CCFD98] messagePayload:v28];
    v36 = v58;
    v37 = [v58 identifier];
    [v35 setIdentifier:v37];

    v38 = [(HMDHome *)v32 msgDispatcher];
    v39 = [(HMDHome *)v32 uuid];
    [v38 sendMessage:v35 target:v39];
  }

  else
  {
    v40 = objc_autoreleasePoolPush();
    v41 = self;
    v42 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v42, OS_LOG_TYPE_INFO))
    {
      v43 = HMFGetLogIdentifier();
      *buf = 138543362;
      v75 = v43;
      _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_INFO, "%{public}@Not notifying non-SPI-entitled clients of empty list of added accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v40);
    v30 = *MEMORY[0x277CCE7A8];
    v36 = v58;
  }

  v44 = [v27 mutableCopy];
  v45 = [v62 copy];
  [v44 setObject:v45 forKeyedSubscript:v30];

  v46 = objc_autoreleasePoolPush();
  v47 = self;
  v48 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
  {
    v49 = HMFGetLogIdentifier();
    *buf = 138543618;
    v75 = v49;
    v76 = 2112;
    v77 = v44;
    _os_log_impl(&dword_2531F8000, v48, OS_LOG_TYPE_INFO, "%{public}@Notifying SPI-entitled clients of added accessories using payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v46);
  v50 = MEMORY[0x277D0F848];
  v51 = *MEMORY[0x277CCFD98];
  v52 = [v36 identifier];
  v53 = [v50 entitledMessageWithName:v51 identifier:v52 messagePayload:v44];

  v54 = [(HMDHome *)v47 msgDispatcher];
  v55 = [(HMDHome *)v47 uuid];
  v64[0] = MEMORY[0x277D85DD0];
  v64[1] = 3221225472;
  v64[2] = __63__HMDHome__notifyClientOfNewlyAddedAccessories_requestMessage___block_invoke;
  v64[3] = &unk_279735D00;
  v65 = v36;
  v56 = v36;
  [v54 sendMessage:v53 target:v55 andInvokeCompletionHandler:v64];

  v57 = *MEMORY[0x277D85DE8];
}

- (void)_sharedAdminDidFailToAddAccessories:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke(uint64_t a1)
{
  v106 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v73 = a1;
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(v73 + 40);
    *buf = 138543618;
    v96 = v5;
    v97 = 2112;
    v98 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Removing accessories that were not added to resident: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v91 = 0u;
  v92 = 0u;
  v89 = 0u;
  v90 = 0u;
  obj = *(v73 + 40);
  v66 = [obj countByEnumeratingWithState:&v89 objects:v105 count:16];
  if (v66)
  {
    v65 = *v90;
    *&v7 = 138544386;
    v62 = v7;
    do
    {
      v8 = 0;
      do
      {
        if (*v90 != v65)
        {
          v9 = v8;
          objc_enumerationMutation(obj);
          v8 = v9;
        }

        v69 = v8;
        v10 = *(*(&v89 + 1) + 8 * v8);
        if ([v10 isPrimary])
        {
          v68 = [MEMORY[0x277CBEB18] arrayWithCapacity:2];
          v11 = *(v73 + 32);
          v12 = [v11 owner];
          v88 = 0;
          v67 = [v11 prepareUserManagementOperationForUser:v12 accessory:v10 type:2 model:0 error:&v88];
          v70 = v88;

          if (v70)
          {
            v13 = objc_autoreleasePoolPush();
            v14 = *(v73 + 32);
            v15 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
            {
              v16 = HMFGetLogIdentifier();
              v17 = *(v73 + 32);
              v18 = objc_opt_class();
              v19 = *(v73 + 32);
              v20 = v18;
              v21 = [v19 name];
              v22 = [*(v73 + 32) owner];
              v23 = [v22 userID];
              *buf = v62;
              v96 = v16;
              v97 = 2112;
              v98 = v18;
              v99 = 2112;
              v100 = v21;
              v101 = 2112;
              v102 = v23;
              v103 = 2112;
              v104 = v70;
              _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@[%@ %@] Failed to prepare remove operations for user '%@' with error: %@", buf, 0x34u);
            }

            objc_autoreleasePoolPop(v13);
          }

          else
          {
            [v68 addObject:v67];
            v24 = *(v73 + 32);
            v25 = [v24 currentUser];
            v87 = 0;
            v63 = [v24 prepareUserManagementOperationForUser:v25 accessory:v10 type:2 model:0 error:&v87];
            v70 = v87;

            if (v70)
            {
              v26 = objc_autoreleasePoolPush();
              v27 = *(v73 + 32);
              v28 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
              {
                v29 = HMFGetLogIdentifier();
                v30 = *(v73 + 32);
                v31 = objc_opt_class();
                v32 = *(v73 + 32);
                v33 = v31;
                v34 = [v32 name];
                v35 = [*(v73 + 32) currentUser];
                v36 = [v35 userID];
                *buf = v62;
                v96 = v29;
                v97 = 2112;
                v98 = v31;
                v99 = 2112;
                v100 = v34;
                v101 = 2112;
                v102 = v36;
                v103 = 2112;
                v104 = v70;
                _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_ERROR, "%{public}@[%@ %@] Failed to prepare remove operations for user '%@' with error: %@", buf, 0x34u);
              }

              objc_autoreleasePoolPop(v26);
            }

            else
            {
              [v63 addDependency:v67];
              [v68 addObject:v63];
            }

            v85 = 0u;
            v86 = 0u;
            v84 = 0u;
            v83 = 0u;
            v71 = v68;
            v74 = [v71 countByEnumeratingWithState:&v83 objects:v94 count:16];
            if (v74)
            {
              v72 = *v84;
              do
              {
                for (i = 0; i != v74; ++i)
                {
                  if (*v84 != v72)
                  {
                    objc_enumerationMutation(v71);
                  }

                  v38 = *(*(&v83 + 1) + 8 * i);
                  if (shouldLogPrivateInformation())
                  {
                    v39 = [v38 user];
                    v40 = [v39 userID];
                  }

                  else
                  {
                    v40 = @"...";
                    v41 = @"...";
                  }

                  v42 = objc_autoreleasePoolPush();
                  v43 = *(v73 + 32);
                  v44 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v44, OS_LOG_TYPE_INFO))
                  {
                    v45 = HMFGetLogIdentifier();
                    v46 = [v38 identifier];
                    v47 = [v38 accessory];
                    v48 = [v47 shortDescription];
                    *buf = 138544130;
                    v96 = v45;
                    v97 = 2112;
                    v98 = v46;
                    v99 = 2112;
                    v100 = v40;
                    v101 = 2112;
                    v102 = v48;
                    _os_log_impl(&dword_2531F8000, v44, OS_LOG_TYPE_INFO, "%{public}@Adding operation '%@' to manager tracking remove user '%@' from accessory '%@'", buf, 0x2Au);
                  }

                  objc_autoreleasePoolPop(v42);
                  v49 = +[HMDUserManagementOperationManager sharedManager];
                  [v49 addOperation:v38];
                }

                v74 = [v71 countByEnumeratingWithState:&v83 objects:v94 count:16];
              }

              while (v74);
            }
          }
        }

        v8 = v69 + 1;
      }

      while (v69 + 1 != v66);
      v66 = [obj countByEnumeratingWithState:&v89 objects:v105 count:16];
    }

    while (v66);
  }

  v81 = 0u;
  v82 = 0u;
  v79 = 0u;
  v80 = 0u;
  v50 = *(v73 + 40);
  v51 = [v50 countByEnumeratingWithState:&v79 objects:v93 count:16];
  if (!v51)
  {
    goto LABEL_47;
  }

  v52 = 0;
  v53 = *v80;
  do
  {
    for (j = 0; j != v51; ++j)
    {
      if (*v80 != v53)
      {
        objc_enumerationMutation(v50);
      }

      v55 = *(*(&v79 + 1) + 8 * j);
      if ([v55 isPrimary])
      {
        v56 = v55;

        v57 = [v56 networkClientIdentifier];

        if (v57)
        {
          v58 = *(v73 + 32);
          v59 = [v56 networkClientIdentifier];
          [v58 _removeClientConfigurationWithIdentifier:v59];
        }

        v52 = v56;
      }
    }

    v51 = [v50 countByEnumeratingWithState:&v79 objects:v93 count:16];
  }

  while (v51);

  if (v52)
  {
    objc_initWeak(buf, *(v73 + 32));
    v60 = *(v73 + 32);
    v75[0] = MEMORY[0x277D85DD0];
    v75[1] = 3221225472;
    v75[2] = __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke_1324;
    v75[3] = &unk_2797352E8;
    objc_copyWeak(&v78, buf);
    v76 = *(v73 + 40);
    v50 = v52;
    v77 = v50;
    [v60 _removeAccessory:v50 completionHandler:v75];

    objc_destroyWeak(&v78);
    objc_destroyWeak(buf);
LABEL_47:
  }

  v61 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke_1324(id *a1, uint64_t a2, void *a3)
{
  v4 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v6 = WeakRetained;
  if (WeakRetained)
  {
    v7 = [WeakRetained workQueue];
    v8[0] = MEMORY[0x277D85DD0];
    v8[1] = 3221225472;
    v8[2] = __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke_2;
    v8[3] = &unk_279734870;
    v9 = v4;
    v10 = v6;
    v11 = a1[4];
    v12 = a1[5];
    dispatch_async(v7, v8);
  }
}

void __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke_2(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  if (*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 56) name];
      v7 = *(a1 + 32);
      v12 = 138543874;
      v13 = v5;
      v14 = 2112;
      v15 = v6;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove accessory %@ with error: %@", &v12, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
    v8 = *MEMORY[0x277D85DE8];
  }

  else
  {
    v9 = *(a1 + 40);
    v10 = *(a1 + 48);
    v11 = *MEMORY[0x277D85DE8];

    [v9 _removeAccessories:v10 message:0];
  }
}

- (void)_notifyOwnerOfAddedAccessories:(id)a3 completion:(id)a4
{
  v43 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v32 = a4;
  v33 = objc_alloc_init(MEMORY[0x277CBEB38]);
  v7 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v8 = [v6 mutableCopy];
  v38 = 0u;
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v9 = v6;
  v10 = [v9 countByEnumeratingWithState:&v38 objects:v42 count:16];
  if (v10)
  {
    v11 = *v39;
    do
    {
      v12 = 0;
      do
      {
        if (*v39 != v11)
        {
          objc_enumerationMutation(v9);
        }

        v13 = *(*(&v38 + 1) + 8 * v12);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if (v15)
        {
          [v7 addObject:v15];
          [v8 removeObject:v15];
        }

        ++v12;
      }

      while (v10 != v12);
      v10 = [v9 countByEnumeratingWithState:&v38 objects:v42 count:16];
    }

    while (v10);
  }

  v16 = [v8 copy];
  [v33 setObject:v7 forKey:@"accessories.airplay"];
  v17 = encodeRootObject();
  [v33 setObject:v17 forKey:@"accessories"];
  v18 = [(HMDHome *)self chipStorage];
  v19 = [v18 fabricID];
  [v33 setObject:v19 forKeyedSubscript:@"HMDHomeCHIPFabricIndexMessageKey"];

  v20 = [(HMDHome *)self chipStorage];
  v21 = [v20 fabricID];
  [v33 setObject:v21 forKeyedSubscript:@"HMDHomeCHIPFabricIDMessageKey"];

  objc_initWeak(&location, self);
  v22 = MEMORY[0x277D0F848];
  v23 = [v33 copy];
  v34[0] = MEMORY[0x277D85DD0];
  v34[1] = 3221225472;
  v34[2] = __53__HMDHome__notifyOwnerOfAddedAccessories_completion___block_invoke;
  v34[3] = &unk_2797355F8;
  objc_copyWeak(&v36, &location);
  v24 = v32;
  v35 = v24;
  v25 = [v22 messageWithName:@"kAddAccessoriesInternalRequestKey" messagePayload:v23 responseHandler:v34];

  v26 = objc_alloc(MEMORY[0x277D0F820]);
  v27 = [(HMDHome *)self uuid];
  v28 = [v26 initWithTarget:v27];

  [v25 setDestination:v28];
  [v25 setQualityOfService:33];
  v29 = [(HMDHome *)self administratorHandler];
  v30 = [v29 operationForMessage:v25 error:0];
  if (v30)
  {
    [v29 addOperation:v30];
  }

  objc_destroyWeak(&v36);
  objc_destroyWeak(&location);

  v31 = *MEMORY[0x277D85DE8];
}

void __53__HMDHome__notifyOwnerOfAddedAccessories_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v14 = 138543874;
      v15 = v11;
      v16 = 2112;
      v17 = @"kAddAccessoriesInternalRequestKey";
      v18 = 2112;
      v19 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Relayed message %@ with error %@", &v14, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    v12 = *(a1 + 32);
    if (v12)
    {
      (*(v12 + 16))(v12, v5);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (BOOL)_addOwnerToPrimaryAccessory:(id)a3 error:(id *)a4
{
  v6 = a3;
  if ([v6 isPrimary])
  {
    v20 = 0;
    v21 = &v20;
    v22 = 0x3032000000;
    v23 = __Block_byref_object_copy__10664;
    v24 = __Block_byref_object_dispose__10665;
    v25 = 0;
    v7 = [(HMDHome *)self owner];
    v8 = (v21 + 5);
    obj = v21[5];
    v9 = [(HMDHome *)self prepareUserManagementOperationForUser:v7 accessory:v6 type:1 model:0 error:&obj];
    objc_storeStrong(v8, obj);

    v10 = v21[5];
    if (!v10)
    {
      v11 = dispatch_group_create();
      dispatch_group_enter(v11);
      v12 = dispatch_get_global_queue(0, 0);
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __45__HMDHome__addOwnerToPrimaryAccessory_error___block_invoke;
      v16[3] = &unk_27972C6F8;
      v18 = &v20;
      v13 = v11;
      v17 = v13;
      [v9 executeWithCompletionQueue:v12 completionHandler:v16];

      dispatch_group_wait(v13, 0xFFFFFFFFFFFFFFFFLL);
      v10 = v21[5];
    }

    v14 = v10 == 0;
    if (a4 && v10)
    {
      *a4 = v10;
    }

    _Block_object_dispose(&v20, 8);
  }

  else
  {
    v14 = 1;
  }

  return v14;
}

void __45__HMDHome__addOwnerToPrimaryAccessory_error___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  if (v4)
  {
    objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
  }

  dispatch_group_leave(*(a1 + 32));
}

- (void)_deregisterPairedAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self accessoryBrowser];
  [v5 deregisterPairedAccessory:v4];
}

- (void)_registerPairedAccessory:(id)a3 transports:(unint64_t)a4 setupHash:(id)a5
{
  v8 = a5;
  v9 = a3;
  v10 = [(HMDHome *)self accessoryBrowser];
  [v10 registerPairedAccessory:v9 transports:a4 setupHash:v8 delegate:self];
}

- (id)hapAccessoryUniqueIdentifiers
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = [(HMDHome *)self accessories];
  v3 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v2, "count")}];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v4 = v2;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          v12 = [v11 uniqueIdentifier];
          [v3 addObject:v12];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)hapAccessoryServerIdentifiers
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = [(HMDHome *)self accessories];
  v3 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v2, "count")}];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v4 = v2;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11 && [v11 isPrimary])
        {
          v12 = [v11 identifier];
          [v3 addObject:v12];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (unint64_t)accessoryCountForRoom:(id)a3
{
  v4 = [MEMORY[0x277CCAC30] predicateWithFormat:@"room == %@", a3];
  v5 = [(HMDHome *)self accessories];
  v6 = [v5 filteredArrayUsingPredicate:v4];

  v7 = [v6 count];
  return v7;
}

- (void)scheduleRemoval
{
  v4 = [(HMDHome *)self homeManager];
  v3 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  [v4 scheduleRemovalForHome:self message:0 options:v3];
}

- (id)hmdHAPAccessoryWithHAPAccessory:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [(HMDHome *)self accessories];
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v16;
LABEL_3:
    v9 = 0;
    while (1)
    {
      if (*v16 != v8)
      {
        objc_enumerationMutation(v5);
      }

      v10 = *(*(&v15 + 1) + 8 * v9);
      objc_opt_class();
      v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
      v12 = v11;

      if ([v12 matchesHAPAccessory:v4])
      {
        break;
      }

      if (v7 == ++v9)
      {
        v7 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
        if (v7)
        {
          goto LABEL_3;
        }

        goto LABEL_12;
      }
    }
  }

  else
  {
LABEL_12:
    v12 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)hapAccessoryWithIdentifier:(id)a3 instanceID:(id)a4
{
  v28 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v8 = [(HMDHome *)self accessories];
  v9 = [v8 countByEnumeratingWithState:&v23 objects:v27 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v24;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v24 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v23 + 1) + 8 * i);
        v14 = [v13 identifier];
        v15 = [v14 isEqualToString:v6];

        if (v15)
        {
          v16 = v13;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v17 = v16;
          }

          else
          {
            v17 = 0;
          }

          v18 = v17;

          if (v18)
          {
            if (!v7)
            {
              goto LABEL_17;
            }

            v19 = [v18 hapInstanceId];
            v20 = [v19 isEqualToNumber:v7];

            if (v20)
            {
              goto LABEL_17;
            }
          }
        }
      }

      v10 = [v8 countByEnumeratingWithState:&v23 objects:v27 count:16];
    }

    while (v10);
  }

  v16 = 0;
LABEL_17:

  v21 = *MEMORY[0x277D85DE8];

  return v16;
}

- (id)hapAccessoryWithIdentifier:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithIdentifier:a3];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (id)accessoryWithIdentifier:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v5 = [(HMDHome *)self accessories];
  v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v6)
  {
    v7 = *v15;
    do
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v15 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v14 + 1) + 8 * i);
        v10 = [v9 identifier];
        if ([v10 isEqualToString:v4])
        {
          v11 = [v9 isPrimary];

          if (v11)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        else
        {
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v6);
  }

LABEL_12:

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)_removeWithMergeSecondaryAccessory:(id)a3 removedFromBridgeAccessory:(id)a4 completionHandler:(id)a5
{
  v13[1] = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  [a4 removeHostedAccessory:v8];
  [(HMDHome *)self removeAccessory:v8];
  v10 = +[HMDBulletinBoard sharedBulletinBoard];
  [v10 removeBulletinsForAccessory:v8];

  [(HMDHome *)self _reevaluateAccessoryInfoWithBadgeRefresh:1];
  if (v9)
  {
    v13[0] = v8;
    v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
    v9[2](v9, v11, 0);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeWithMergeSecondaryAccessory:(id)a3 removedFromBridgeAccessory:(id)a4 completionHandler:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __90__HMDHome_removeWithMergeSecondaryAccessory_removedFromBridgeAccessory_completionHandler___block_invoke;
  v15[3] = &unk_279734578;
  v15[4] = self;
  v16 = v8;
  v17 = v9;
  v18 = v10;
  v12 = v10;
  v13 = v9;
  v14 = v8;
  dispatch_async(v11, v15);
}

- (void)notifyOfNewlyAddedAccessoryByThisOwnerDevice:(id)a3
{
  v17[1] = *MEMORY[0x277D85DE8];
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;
  if (v6)
  {
    v7 = v6;
    v8 = [(HMDHome *)self isOwnerUser];

    if (!v8)
    {
      goto LABEL_13;
    }

    goto LABEL_12;
  }

  v9 = v4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = v9;
  }

  else
  {
    v10 = 0;
  }

  v11 = v10;

  if (v11)
  {
    v12 = [(HMDHome *)self isOwnerUser];

    if (v12)
    {
LABEL_12:
      v13 = [(HMDHome *)self notificationCenter];
      v16 = @"HMDAccessoryNotificationKey";
      v17[0] = v4;
      v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:&v16 count:1];
      [v13 postNotificationName:@"HMDHomeThisOwnerDeviceAddedAccessoryNotification" object:self userInfo:v14];
    }
  }

LABEL_13:

  v15 = *MEMORY[0x277D85DE8];
}

- (void)notifyOfAddedAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __34__HMDHome_notifyOfAddedAccessory___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __34__HMDHome_notifyOfAddedAccessory___block_invoke(uint64_t a1)
{
  v6[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v1 = *(a1 + 40);
  v5[0] = @"HMDNotificationAddedAccessoryKey";
  v5[1] = @"HMDAccessoryKey";
  v6[0] = v1;
  v6[1] = v1;
  v3 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v6 forKeys:v5 count:2];
  logAndPostNotification(@"HMDNotificationHomeAddedAccessory", v2, v3);

  v4 = *MEMORY[0x277D85DE8];
}

- (void)notifyOfRemovedAccessory:(id)a3 source:(unint64_t)a4
{
  v6 = a3;
  v7 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __43__HMDHome_notifyOfRemovedAccessory_source___block_invoke;
  block[3] = &unk_279732F10;
  block[4] = self;
  v10 = v6;
  v11 = a4;
  v8 = v6;
  dispatch_async(v7, block);
}

void __43__HMDHome_notifyOfRemovedAccessory_source___block_invoke(uint64_t a1)
{
  v9[4] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) notificationCenter];
  v4 = *(a1 + 32);
  v3 = *(a1 + 40);
  v8[0] = @"HMDAccessoryNotificationKey";
  v8[1] = @"HMDAccessoryKey";
  v9[0] = v3;
  v9[1] = v3;
  v9[2] = v4;
  v8[2] = @"HMDHomeKey";
  v8[3] = @"HMDNotificationSourceKey";
  v5 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 48)];
  v9[3] = v5;
  v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:v8 count:4];
  [v2 postNotificationName:@"HMDHomeAccessoryRemovedNotification" object:v4 userInfo:v6];

  v7 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveAccessoryModel:(id)a3 message:(id)a4
{
  v47 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 uuid];

  if (v8)
  {
    v9 = [v7 transactionResult];
    v10 = [v6 uuid];
    v11 = [(HMDHome *)self accessoryWithUUID:v10];

    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v6 debugString:1];
      *buf = 138543618;
      v44 = v15;
      v45 = 2112;
      v46 = v16;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Going to remove accessory : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v17 = v11;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    if (v17)
    {
      if (isInternalBuild() && ([v17 shouldProcessTransactionRemoval] & 1) == 0)
      {
        v37 = objc_autoreleasePoolPush();
        v38 = v13;
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_ERROR))
        {
          v40 = HMFGetLogIdentifier();
          *buf = 138543362;
          v44 = v40;
          _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_ERROR, "%{public}@Failed to process transaction removal due to internal flag set to simulate this failure", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v37);
        [v7 respondWithSuccess];
        goto LABEL_20;
      }

      if ([v17 isPrimary])
      {
        v20 = [v6 uuid];
        [(HMDHome *)v13 _removeAccessoryWithUUID:v20 message:v7];

        v21 = [(HMDHome *)v13 networkProtectionGroupRegistry];
        [v21 handleRemovedAccessory:v17];

        v22 = [v17 uuid];
        v23 = [(HMDHome *)v13 activeNetworkRouterUUID];
        v24 = [v22 isEqual:v23];

        if (v24)
        {
          [(HMDHome *)v13 _evaluateNetworkRouterManagementForTransaction:v9];
        }
      }

      else
      {
        v25 = [v19 bridge];
        [v25 removeHostedAccessory:v17];
        [(HMDHome *)v13 removeAccessory:v17];
        v42 = v17;
        v26 = [MEMORY[0x277CBEA60] arrayWithObjects:&v42 count:1];
        [(HMDHome *)v13 _removeAccessories:v26 message:0];
      }

      v27 = [v7 transactionResult];
      -[HMDHome notifyOfRemovedAccessory:source:](v13, "notifyOfRemovedAccessory:source:", v17, [v27 source]);
      v28 = [(HMDHome *)v13 homeManager];
      if ([v19 isPrimary])
      {
        v29 = [v19 matterNodeID];
        v30 = [v29 unsignedIntValue];

        if (v30)
        {
          v41 = [v28 accessoryBrowser];
          v31 = [v41 chipAccessoryServerBrowser];
          v32 = [v19 matterNodeID];
          v33 = [(HMDHome *)v13 targetFabricUUID];
          [v31 handleHomeRemovedAccessoryWithNodeID:v32 fabricUUID:v33];
        }
      }

      v34 = [v28 lastEventStoreController];
      v35 = [v17 uuid];
      [v34 didRemoveAccessory:v35];
    }

    [v9 markChanged];
    [v9 markSaveToAssistant];
LABEL_20:

    goto LABEL_21;
  }

  v9 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
  v17 = [v7 responseHandler];
  (*(v17 + 2))(v17, v9, 0);
LABEL_21:

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveAccessoryAfterUserConsent:(id)a3 message:(id)a4
{
  v38 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if ([(HMDHome *)self isAdminUser])
  {
    v8 = [(HMDHome *)self administratorHandler];
    if (([v8 shouldRelayMessages] & 1) != 0 || objc_msgSend(v6, "requiresRemovalOnPrimaryResident") && !-[HMDHome isCurrentDevicePrimaryResident](self, "isCurrentDevicePrimaryResident"))
    {
      v9 = objc_autoreleasePoolPush();
      v10 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 138543362;
        v35 = v12;
        _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Sending remove accessory request to owner / primary resident", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
      v33 = 0;
      v13 = [v8 operationForMessage:v7 error:&v33];
      v14 = v33;
      if (v13)
      {
        [v8 addOperation:v13];
        v15 = objc_autoreleasePoolPush();
        v16 = v10;
        v17 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          v18 = HMFGetLogIdentifier();
          *buf = 138543362;
          v35 = v18;
          _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Also removing accessory locally", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v15);
        [HMDHome __removeAccessory:v16 isBeingReplaced:v6 isForceUpdate:0 message:v7];
        [(HMDHome *)v16 _submitRemovalLogEventForAccessory:v6 isLocalRemoval:1 isLocalFallback:1 isDuplicate:0 duplicateCount:0 error:v14];
      }

      else
      {
        v27 = objc_autoreleasePoolPush();
        v28 = v10;
        v29 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543618;
          v35 = v30;
          v36 = 2112;
          v37 = v14;
          _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Failed to create home administrator configuration operation for accessory removal: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v27);
        v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
        [v7 respondWithError:v31];
      }
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      v24 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543362;
        v35 = v26;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_INFO, "%{public}@Removing accessory locally", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v23);
      [HMDHome __removeAccessory:v24 isBeingReplaced:v6 isForceUpdate:0 message:v7];
      [(HMDHome *)v24 _submitRemovalLogEventForAccessory:v6 isLocalRemoval:1 isLocalFallback:0 isDuplicate:0 duplicateCount:0 error:0];
    }
  }

  else
  {
    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543362;
      v35 = v22;
      _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Not removing accessory due to insufficient privileges", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v19);
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    [v7 respondWithError:v8];
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)__removeAccessory:(void *)a1 isBeingReplaced:(void *)a2 isForceUpdate:(char)a3 message:(void *)a4
{
  v70 = *MEMORY[0x277D85DE8];
  v6 = a2;
  v7 = a4;
  if (a1)
  {
    v8 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v9 = [a1 backingStore];
    v10 = [v7 name];
    v41 = v8;
    v11 = [v9 transaction:v10 options:v8];

    v12 = [MEMORY[0x277CBEB18] arrayWithObject:v6];
    v43 = v6;
    v13 = v6;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v15)
    {
      v16 = [a1 accessories];
      v66[0] = MEMORY[0x277D85DD0];
      v66[1] = 3221225472;
      v66[2] = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke;
      v66[3] = &unk_27972C828;
      v67 = v15;
      v17 = [v16 na_filter:v66];

      [v12 addObjectsFromArray:v17];
    }

    v40 = v15;
    v45 = a1;
    v64 = 0u;
    v65 = 0u;
    v62 = 0u;
    v63 = 0u;
    v18 = v12;
    v19 = [v18 countByEnumeratingWithState:&v62 objects:v69 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v63;
      do
      {
        for (i = 0; i != v20; ++i)
        {
          if (*v63 != v21)
          {
            objc_enumerationMutation(v18);
          }

          v23 = [*(*(&v62 + 1) + 8 * i) transactionWithObjectChangeType:3];
          [v11 add:v23 withMessage:v7];
        }

        v20 = [v18 countByEnumeratingWithState:&v62 objects:v69 count:16];
      }

      while (v20);
    }

    v42 = v7;

    group = dispatch_group_create();
    v58 = 0u;
    v59 = 0u;
    v60 = 0u;
    v61 = 0u;
    obj = v18;
    v24 = a1;
    v49 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
    if (v49)
    {
      v25 = *v59;
      v44 = *v59;
      do
      {
        for (j = 0; j != v49; ++j)
        {
          if (*v59 != v25)
          {
            objc_enumerationMutation(obj);
          }

          v27 = *(*(&v58 + 1) + 8 * j);
          dispatch_group_enter(group);
          v52[0] = MEMORY[0x277D85DD0];
          v52[1] = 3221225472;
          v28 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_2;
          v53 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_2;
          v54 = &unk_279734960;
          v55 = v24;
          v56 = v27;
          v57 = group;
          v29 = v24;
          v30 = v27;
          v31 = v11;
          v32 = v11;
          v33 = v52;
          if ((a3 & 1) == 0)
          {
            v34 = [v30 uuid];
            v35 = [v29 activeNetworkRouterUUID];
            v36 = [v34 isEqual:v35];

            if (v36)
            {
              [v29 _updateActiveNetworkRouterAccessory:0 isReplacement:0 withTransaction:v32];
              [v29 _clearAccessoryNetworkProtectionStateWithTransaction:v32];
              [v29 _reconfigureAccessoriesOnRouterRemovalWithCompletion:v33];
              v25 = v44;
              v24 = v45;
              goto LABEL_24;
            }

            v28 = v53;
            v25 = v44;
            v24 = v45;
          }

          v28(v33);
LABEL_24:

          v11 = v31;
        }

        v49 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
      }

      while (v49);
    }

    v37 = [v24 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_4;
    block[3] = &unk_279735D00;
    v51 = v11;
    v38 = v11;
    dispatch_group_notify(group, v37, block);

    v7 = v42;
    v6 = v43;
  }

  v39 = *MEMORY[0x277D85DE8];
}

BOOL __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 hostAccessory];
  v4 = v3 == *(a1 + 32);

  return v4;
}

void __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_2(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v7 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_3;
  v8 = &unk_279735D00;
  v9 = *(a1 + 48);
  v3 = v1;
  v4 = v2;
  v5 = v6;
  if (([v4 isPrimary] & 1) != 0 || objc_msgSend(v4, "conformsToProtocol:", &unk_286699670) && objc_msgSend(v4, "supportsUserManagement"))
  {
    [v3 removeAllUsersAndCloudDataFromAccessory:v4 completionHandler:v5];
  }

  else
  {
    v7(v5);
  }
}

- (BOOL)shouldAccessoryRemovalFallbackToLocalRemovalOnError:(id)a3 accessory:(id)a4
{
  v6 = a3;
  v7 = a4;
  if ([v6 isHMError] && objc_msgSend(v6, "code") == 8 || objc_msgSend(v6, "isHMFError") && objc_msgSend(v6, "code") == 13 || objc_msgSend(v6, "isHMError") && objc_msgSend(v6, "code") == 91)
  {
    v8 = [(HMDHome *)self homeManager];
    if ([v8 isNetworkConnectionAvailable] && ((v9 = v7, objc_opt_class(), (objc_opt_isKindOfClass() & 1) == 0) ? (v10 = 0) : (v10 = v9), v11 = v10, v9, v11))
    {
      v12 = [(HMDHome *)self owner];
      v13 = [v12 isCurrentUser];
    }

    else
    {
      v13 = 0;
    }
  }

  else
  {
    v13 = 0;
  }

  return v13;
}

- (void)_handleRemoveAccessoryMessage:(id)a3
{
  v58 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [v4 uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v6)
  {
    v7 = [(HMDHome *)self accessoryWithUUID:v6];
    if (!v7)
    {
      v22 = objc_autoreleasePoolPush();
      v23 = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543618;
        v55 = v25;
        v56 = 2112;
        v57 = v6;
        _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to find accessory with UUID: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v22);
      v8 = [v4 responseHandler];

      if (v8)
      {
        v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        v27 = [v4 responseHandler];
        (v27)[2](v27, v26, 0);

        v8 = 0;
      }

      goto LABEL_22;
    }

    v8 = v7;
    v9 = [v7 isPrimary];
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    v13 = v12;
    if (v9)
    {
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        *buf = 138543618;
        v55 = v14;
        v56 = 2112;
        v57 = v8;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Received request to remove accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      if ([v4 isRemote] & 1) != 0 || (objc_msgSend(v4, "isEntitledForSPIAccess"))
      {
        goto LABEL_8;
      }

      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __41__HMDHome__handleRemoveAccessoryMessage___block_invoke;
      aBlock[3] = &unk_279723AB0;
      aBlock[4] = v11;
      v52 = v4;
      v32 = v8;
      v53 = v32;
      v33 = _Block_copy(aBlock);
      v34 = [v32 uuid];
      v35 = [(HMDHome *)v11 activeNetworkRouterUUID];
      v36 = [v34 isEqual:v35];

      if (v36)
      {
        v37 = [(HMDHome *)v11 accessoriesRequiringManualReconfigurationOnRouterRemoval];
        v38 = [v37 na_map:&__block_literal_global_1316];

        v39 = objc_autoreleasePoolPush();
        v40 = v11;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          *buf = 138543362;
          v55 = v42;
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Requesting permission to remove active network router accessory", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v39);
        v43 = +[HMDUIDialogPresenter sharedUIDialogPresenter];
        v44 = [v32 name];
        v45 = [v32 uuid];
        v46 = [(HMDHome *)v40 workQueue];
        [v43 requestUserPermissionForRemovalOfRouter:v44 accessoriesRequiringManualReconfiguration:v38 withContext:v45 queue:v46 completionHandler:v33];
      }

      else
      {
        if ([v32 wiFiCredentialType] != 3)
        {

LABEL_8:
          [(HMDHome *)v11 _handleRemoveAccessoryAfterUserConsent:v8 message:v4];
LABEL_22:

          goto LABEL_23;
        }

        v47 = objc_autoreleasePoolPush();
        v48 = v11;
        v49 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
        {
          v50 = HMFGetLogIdentifier();
          *buf = 138543362;
          v55 = v50;
          _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_INFO, "%{public}@Requesting permission to remove accessory with specific WiFi credential", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v47);
        v38 = +[HMDUIDialogPresenter sharedUIDialogPresenter];
        v43 = [v32 name];
        v44 = [v32 uuid];
        v45 = [(HMDHome *)v48 workQueue];
        [v38 requestUserPermissionForRemovalOfSpecificWiFiCredentialedAccessory:v43 withContext:v44 queue:v45 completionHandler:v33];
      }

      v8 = v32;
      goto LABEL_22;
    }

    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543618;
      v55 = v28;
      v56 = 2112;
      v57 = v8;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@cannot remove bridged accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v29 = [v4 responseHandler];

    if (!v29)
    {
      goto LABEL_22;
    }

    v21 = [v4 responseHandler];
    v30 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:34 userInfo:0];
    (v21)[2](v21, v30, 0);

LABEL_21:
    goto LABEL_22;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
  {
    v18 = HMFGetLogIdentifier();
    v19 = [v4 messagePayload];
    *buf = 138543618;
    v55 = v18;
    v56 = 2112;
    v57 = v19;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_DEFAULT, "%{public}@Missing target accessory UUID from message payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v15);
  v20 = [v4 responseHandler];

  if (v20)
  {
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v21 = [v4 responseHandler];
    (v21)[2](v21, v8, 0);
    goto LABEL_21;
  }

LABEL_23:

  v31 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleRemoveAccessoryMessage___block_invoke(uint64_t a1, int a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (a2)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@User canceled consent for removing accessory", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    [v9 respondWithError:v10];
  }

  else
  {
    if (v7)
    {
      v11 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v11;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@User accepted consent for removing accessory", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 32) _handleRemoveAccessoryAfterUserConsent:*(a1 + 48) message:*(a1 + 40)];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleRemoveAccessoryMessage:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __40__HMDHome_handleRemoveAccessoryMessage___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)handleRemoveAccessory:(id)a3 completion:(id)a4
{
  v26[1] = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = MEMORY[0x277D0F848];
  v8 = a3;
  v9 = [v7 alloc];
  v10 = *MEMORY[0x277CD24F0];
  v11 = objc_alloc(MEMORY[0x277D0F820]);
  v12 = [(HMDHome *)self uuid];
  v13 = [v11 initWithTarget:v12];
  v25 = *MEMORY[0x277CCF0B0];
  v14 = [v8 uuid];

  v15 = [v14 UUIDString];
  v26[0] = v15;
  v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v26 forKeys:&v25 count:1];
  v17 = [v9 initWithName:v10 destination:v13 payload:v16];

  [v17 setRemoteRestriction:9];
  v20 = MEMORY[0x277D85DD0];
  v21 = 3221225472;
  v22 = __44__HMDHome_handleRemoveAccessory_completion___block_invoke;
  v23 = &unk_279729A58;
  v24 = v6;
  v18 = v6;
  [v17 setResponseHandler:&v20];
  [(HMDHome *)self handleRemoveAccessoryMessage:v17, v20, v21, v22, v23];

  v19 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome_handleRemoveAccessory_completion___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  v3 = _Block_copy(*(a1 + 32));
  v4 = v3;
  if (v3)
  {
    (*(v3 + 2))(v3, v5);
  }
}

- (void)__handleAddMediaAccessoryModel:(id)a3 message:(id)a4
{
  v82 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = HMFGetOSLogHandle();
  if (os_signpost_enabled(v8))
  {
    v9 = [v6 uuid];
    v10 = [v6 parentUUID];
    v11 = [v6 bsoRecord];
    v12 = [v11 recordID];
    v13 = [v12 recordName];
    v14 = v13;
    v15 = &stru_286509E58;
    *buf = 138412802;
    v77 = v9;
    if (v13)
    {
      v15 = v13;
    }

    v78 = 2112;
    v79 = v10;
    v80 = 2112;
    v81 = v15;
    _os_signpost_emit_with_name_impl(&dword_2531F8000, v8, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "AddMediaAccessoryModel", "Identifier=%{signpost.description:attribute}@ parentUUID=%{signpost.description:attribute}@ recordName=%{signpost.description:attribute}@ ", buf, 0x20u);
  }

  v16 = objc_autoreleasePoolPush();
  v17 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    v20 = [v6 uuid];
    *buf = 138543618;
    v77 = v19;
    v78 = 2112;
    v79 = v20;
    _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Creating new media accessory from model with UUID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v16);
  v21 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v22 = v21;
  }

  else
  {
    v22 = 0;
  }

  v23 = v22;

  v24 = v21;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v25 = v24;
  }

  else
  {
    v25 = 0;
  }

  v26 = v25;

  if (v23)
  {
    v27 = v23;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v29 = v27;
    }

    else
    {
      v29 = 0;
    }

    if (isKindOfClass)
    {
      v30 = off_279719FF8;
    }

    else
    {
      v30 = off_27971A018;
    }

    v31 = v29;

    v32 = v27;
    objc_opt_class();
    v33 = objc_opt_isKindOfClass();
    if (v33)
    {
      v34 = v32;
    }

    else
    {
      v34 = 0;
    }

    if (v33)
    {
      v30 = off_27971A008;
    }

    v35 = v34;

    v36 = [objc_alloc(*v30) initWithTransaction:v32 home:v17];
    v37 = 0;
    if (!v36)
    {
      goto LABEL_39;
    }

LABEL_29:
    v64 = v26;
    v65 = v24;
    v66 = v23;
    v38 = v36;
    objc_opt_class();
    v39 = objc_opt_isKindOfClass();
    if (v39)
    {
      v40 = v38;
    }

    else
    {
      v40 = 0;
    }

    v41 = v40;

    [(HMDAirPlayAccessory *)v41 setDataSource:v17];
    [(HMDHome *)v17 addAccessory:v38];
    v42 = [(HMDHome *)v17 homeManager];
    v43 = [(HMDAccessory *)v38 uuid];
    v44 = [v42 accessorySetupMetricDispatcherForAccessoryUUID:v43];

    v63 = v44;
    [v44 markAccessoryAddCompleted];
    v45 = dispatch_group_create();
    v46 = [(HMDHome *)v17 msgDispatcher];
    [(HMDAirPlayAccessory *)v38 configureWithHome:v17 msgDispatcher:v46 configurationTracker:v45 initialConfiguration:0];

    v47 = [(HMDHome *)v17 homeManager];
    if ((v39 & 1) != 0 && [(HMDAccessory *)v38 isCurrentAccessory])
    {
      v48 = [v47 currentAccessorySetupMetricDispatcher];
      [v48 markSetupBeginStage:7 error:0];
    }

    v75 = v38;
    v49 = [MEMORY[0x277CBEA60] arrayWithObjects:&v75 count:1];
    v50 = [v7 identifier];
    [(HMDHome *)v17 addNewlyConfiguredAccessories:v49 addSessionIdentifier:v50];

    v51 = [v7 transactionResult];
    [v51 markChanged];
    [v51 markSaveToAssistant];
    v52 = [(HMDHome *)v17 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke;
    block[3] = &unk_279722518;
    block[4] = v17;
    v68 = v38;
    v69 = v7;
    v70 = v47;
    v23 = v66;
    v71 = v66;
    v72 = v41;
    v74 = v37;
    v73 = v51;
    v53 = v51;
    v54 = v41;
    v55 = v47;
    v56 = v38;
    dispatch_group_notify(v45, v52, block);

    v26 = v64;
    v24 = v65;
    goto LABEL_39;
  }

  if (v26)
  {
    v36 = [[HMDAirPlayAccessory alloc] initWithTransaction:v26 home:v17];
    v37 = [(HMDHome *)v17 isCurrentDevicePrimaryResident];
    if (!v36)
    {
      goto LABEL_39;
    }

    goto LABEL_29;
  }

  v57 = objc_autoreleasePoolPush();
  v58 = v17;
  v59 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v59, OS_LOG_TYPE_DEFAULT))
  {
    v60 = HMFGetLogIdentifier();
    *buf = 138543618;
    v77 = v60;
    v78 = 2112;
    v79 = v24;
    _os_log_impl(&dword_2531F8000, v59, OS_LOG_TYPE_DEFAULT, "%{public}@Invalid WHA accessory: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v57);
LABEL_39:
  v61 = HMFGetOSLogHandle();
  if (os_signpost_enabled(v61))
  {
    *buf = 0;
    _os_signpost_emit_with_name_impl(&dword_2531F8000, v61, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "AddMediaAccessoryModel", "", buf, 2u);
  }

  v62 = *MEMORY[0x277D85DE8];
}

void __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke(uint64_t a1)
{
  v85 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessoryBrowser];
  v3 = [*(a1 + 40) identifier];
  [v2 registerPairedAccessory:v3 transports:objc_msgSend(*(a1 + 40) setupHash:"supportedTransports") delegate:{0, *(a1 + 32)}];

  v71 = 0u;
  v72 = 0u;
  v69 = 0u;
  v70 = 0u;
  v4 = [*(a1 + 32) accessoryBrowser];
  v5 = [v4 mediaBrowser];
  v6 = [v5 accessoryAdvertisements];

  v7 = [v6 countByEnumeratingWithState:&v69 objects:v84 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v70;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v70 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v69 + 1) + 8 * i);
        v12 = [v11 identifier];
        v13 = [*(a1 + 40) identifier];
        v14 = [v12 isEqualToString:v13];

        if (v14)
        {
          [*(a1 + 40) addAdvertisement:v11];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v69 objects:v84 count:16];
    }

    while (v8);
  }

  [*(a1 + 32) _reachabilityChangedForAccessory:*(a1 + 40) reachable:{objc_msgSend(*(a1 + 40), "isReachable")}];
  if ([*(a1 + 32) remoteAccessIsEnabled])
  {
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 32);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [*(a1 + 40) name];
      *buf = 138543618;
      v77 = v18;
      v78 = 2112;
      v79 = v19;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ setting remote access enabled", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    [*(a1 + 40) remoteAccessEnabled:1];
  }

  v20 = [*(a1 + 48) transactionResult];
  v21 = [v20 source];

  if ((v21 & 0xFFFFFFFFFFFFFFFDLL) == 1 && [*(a1 + 32) isOwnerUser])
  {
    v22 = *(a1 + 56);
    v23 = [*(a1 + 40) identifier];
    v63 = MEMORY[0x277D85DD0];
    v64 = 3221225472;
    v65 = __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke_1312;
    v66 = &unk_2797358C8;
    v24 = *(a1 + 40);
    v67 = *(a1 + 32);
    v68 = v24;
    [v22 cleanupOperationsForAccessory:v23 user:0 completion:&v63];
  }

  v25 = objc_autoreleasePoolPush();
  v26 = *(a1 + 32);
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
  {
    v28 = HMFGetLogIdentifier();
    v29 = [*(a1 + 40) shortDescription];
    [*(a1 + 32) isCurrentDeviceConfirmedPrimaryResident];
    v30 = HMFBooleanToString();
    *buf = 138544130;
    v77 = v28;
    v78 = 2112;
    v79 = v29;
    v80 = 2048;
    v81 = v21;
    v82 = 2112;
    v83 = v30;
    _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Apple media accessory %@ being added to home - source %tu. IsPrimary: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v25);
  if ([*(a1 + 40) supportsTargetControl])
  {
    if (v21 <= 1)
    {
      if ([*(a1 + 40) isCurrentAccessory])
      {
        v31 = [MEMORY[0x277D0F8D0] sharedPreferences];
        v32 = [v31 preferenceForKey:@"autoConfigureNewTargets"];
        v33 = [v32 BOOLValue];

        if (v33)
        {
          [*(a1 + 40) autoConfigureTargetControllers];
        }
      }
    }
  }

  if (*(a1 + 64) && [*(a1 + 40) isCurrentAccessory])
  {
    v34 = objc_autoreleasePoolPush();
    v35 = *(a1 + 32);
    v36 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
    {
      v37 = HMFGetLogIdentifier();
      v38 = *(a1 + 40);
      *buf = 138543618;
      v77 = v37;
      v78 = 2112;
      v79 = v38;
      _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_INFO, "%{public}@Setting up media session for current accessory during add - %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v34);
    v39 = [*(a1 + 32) _addMediaSessionForCurrentAccessory:*(a1 + 40)];
  }

  v40 = *(a1 + 72);
  if (v40)
  {
    [v40 configureAudioDestinationController];
    if ([*(a1 + 72) isCurrentAccessory])
    {
      [*(a1 + 32) createRemoteEventRouterServerIfNeeded];
      v41 = [*(a1 + 32) notificationCenter];
      v42 = *(a1 + 32);
      v43 = *(a1 + 72);
      v74 = @"HMDAccessoryNotificationKey";
      v75 = v43;
      v44 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v75 forKeys:&v74 count:1];
      [v41 postNotificationName:@"HMDHomeManagerDidAddCurrentAccessoryNotification" object:v42 userInfo:v44];

      v45 = [*(a1 + 56) currentAccessorySetupMetricDispatcher];
      [v45 markSetupEndStage:7 error:0];
    }

    v46 = *(a1 + 32);
    v73 = *(a1 + 72);
    v47 = [MEMORY[0x277CBEA60] arrayWithObjects:&v73 count:{1, v63, v64, v65, v66, v67}];
    [v46 configureRemoteEventRouterClientControllerForAccessories:v47];

    v48 = [*(a1 + 32) capabilitiesAggregator];
    v49 = [*(a1 + 72) uuid];
    [v48 didAddAccessory:v49];
  }

  if ([*(a1 + 40) isCurrentAccessory])
  {
    v50 = objc_autoreleasePoolPush();
    v51 = *(a1 + 32);
    v52 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
    {
      v53 = HMFGetLogIdentifier();
      *buf = 138543362;
      v77 = v53;
      _os_log_impl(&dword_2531F8000, v52, OS_LOG_TYPE_INFO, "%{public}@Notifying that we are a reachable accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v50);
    v54 = [*(a1 + 32) notificationCenter];
    [v54 postNotificationName:@"HMDHomeCurrentDeviceHasReachableAccessories" object:*(a1 + 32)];

    v55 = *(a1 + 72);
    if (v55)
    {
      [v55 configureSensors];
    }
  }

  if (*(a1 + 88) == 1)
  {
    v56 = [*(a1 + 32) residentDeviceManager];
    [v56 confirmWithCompletionHandler:0];
  }

  v57 = *(a1 + 32);
  v58 = [*(a1 + 48) identifier];
  v59 = [v57 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v58];

  if ([*(a1 + 80) source] == 1)
  {
    [*(a1 + 32) _notifyClientOfNewlyAddedAccessories:v59 requestMessage:*(a1 + 48)];
    [*(a1 + 32) notifyOfNewlyAddedAccessoryByThisOwnerDevice:*(a1 + 40)];
  }

  else
  {
    [*(a1 + 48) respondWithPayload:0];
  }

  v60 = [*(a1 + 32) accessoryBrowser];
  v61 = [*(a1 + 40) identifier];
  [v60 removeUnassociatedAccessoryWithIdentifier:v61];

  [*(a1 + 32) notifyOfAddedAccessory:*(a1 + 40)];
  v62 = *MEMORY[0x277D85DE8];
}

- (void)__handleAddHAPAccessoryModel:(id)a3 message:(id)a4
{
  v85 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 bridgeUUID];
  if (!v8)
  {
    goto LABEL_3;
  }

  v9 = objc_alloc(MEMORY[0x277CCAD78]);
  v10 = [v6 bridgeUUID];
  v11 = [v9 initWithUUIDString:v10];
  v12 = [(HMDHome *)self accessoryWithUUID:v11];

  if (!v12)
  {
    v48 = objc_autoreleasePoolPush();
    v49 = self;
    v50 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
    {
      v51 = HMFGetLogIdentifier();
      v52 = [v6 bridgeUUID];
      v53 = [v6 uuid];
      *buf = 138543874;
      v76 = v51;
      v77 = 2112;
      v78 = v52;
      v79 = 2112;
      v80 = v53;
      _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_ERROR, "%{public}@No bridge accessory %@ for added bridged accessory %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v48);
  }

  else
  {
LABEL_3:
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v6 uuid];
      v18 = [v6 name];
      v19 = [v6 uniqueIdentifier];
      v20 = [v7 shortDescription];
      *buf = 138544386;
      v76 = v16;
      v77 = 2112;
      v78 = v17;
      v79 = 2112;
      v80 = v18;
      v81 = 2112;
      v82 = v19;
      v83 = 2112;
      v84 = v20;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Creating new HAP accessory from model with UUID %@/%@/%@ from message: %@", buf, 0x34u);
    }

    objc_autoreleasePoolPop(v13);
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) != 0 && (v21 = [(HMDHAPAccessory *)[HMDAppleMediaAccessorySensor alloc] initWithTransaction:v6 home:v14]) != 0 || (v21 = [[HMDHAPAccessory alloc] initWithTransaction:v6 home:v14]) != 0)
    {
      v22 = [v6 configurationTracker];
      if (!v22)
      {
        v22 = dispatch_group_create();
      }

      v23 = [(HMDHome *)v14 notificationRegistrations];
      v24 = [v23 count];
      v25 = v24 != 0;

      v26 = [(HMDHome *)v14 uuidToHAPAccessoryConfigTable];
      v27 = [v6 uuid];
      v28 = [v26 objectForKey:v27];

      if (v28)
      {
        v29 = [(HMDHome *)v14 uuidToHAPAccessoryConfigTable];
        v30 = [v6 uuid];
        [v29 removeObjectForKey:v30];

        dispatch_group_enter(v22);
        v31 = [(HMDHome *)v14 workQueue];
        v72[0] = MEMORY[0x277D85DD0];
        v72[1] = 3221225472;
        v72[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke;
        v72[3] = &unk_279735D00;
        v73 = v22;
        [(HMDHAPAccessory *)v21 configureWithAccessory:v28 homeNotificationsEnabled:v24 != 0 queue:v31 completion:v72];
      }

      if ([(HMDHAPAccessory *)v21 isPrimary])
      {
        v32 = [v7 name];
        v33 = [v32 isEqualToString:*MEMORY[0x277CD2070]];

        if ((v33 & 1) == 0)
        {
          [(HMDHAPAccessory *)v21 savePublicKeyToKeychain];
        }

        v34 = [(HMDAccessory *)v21 identifier];
        v35 = [(HMDHAPAccessory *)v21 supportedTransports];
        v36 = [(HMDHAPAccessory *)v21 setupHash];
        [(HMDHome *)v14 _registerPairedAccessory:v34 transports:v35 setupHash:v36];
      }

      [(HMDHome *)v14 addAccessory:v21];
      v37 = [(HMDHome *)v14 msgDispatcher];
      [(HMDHAPAccessory *)v21 configureWithHome:v14 msgDispatcher:v37 configurationTracker:v22 initialConfiguration:0];

      v74 = v21;
      v38 = [MEMORY[0x277CBEA60] arrayWithObjects:&v74 count:1];
      v39 = [v7 identifier];
      [(HMDHome *)v14 addNewlyConfiguredAccessories:v38 addSessionIdentifier:v39];

      v40 = [(HMDHome *)v14 accessoryBrowser];
      [v40 evaluateAccessoryDiscoveryState];

      v41 = [(HMDHAPAccessory *)v21 matterNodeID];
      if (v41)
      {
        v42 = [(HMDHAPAccessory *)v21 matterNodeID];
        v43 = [v42 isEqual:&unk_2866277F0];

        if ((v43 & 1) == 0)
        {
          if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
          {
            objc_initWeak(buf, v14);
            v69[0] = MEMORY[0x277D85DD0];
            v69[1] = 3221225472;
            v69[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1304;
            v69[3] = &unk_2797338E8;
            objc_copyWeak(&v71, buf);
            v70 = v21;
            [(HMDHome *)v14 setUpSharedUserFabricDataWithForceFetch:0 completion:v69];

            objc_destroyWeak(&v71);
            objc_destroyWeak(buf);
          }
        }
      }

      v44 = [v7 transactionResult];
      [v44 markChanged];
      [v44 markSaveToAssistant];
      v45 = [(HMDHome *)v14 workQueue];
      v63[0] = MEMORY[0x277D85DD0];
      v63[1] = 3221225472;
      v63[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_2;
      v63[3] = &unk_27972DBC8;
      v63[4] = v14;
      v64 = v21;
      v65 = v7;
      v66 = v28;
      v67 = v6;
      v68 = v25;
      v46 = v28;
      v47 = v21;
      dispatch_group_notify(v22, v45, v63);

      goto LABEL_21;
    }

    v54 = objc_autoreleasePoolPush();
    v55 = v14;
    v56 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v56, OS_LOG_TYPE_ERROR))
    {
      v57 = HMFGetLogIdentifier();
      v58 = [v6 uuid];
      v59 = [v58 UUIDString];
      *buf = 138543618;
      v76 = v57;
      v77 = 2112;
      v78 = v59;
      _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_ERROR, "%{public}@Unable to create accessory from object (null accessory) %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v54);
    v60 = [v7 responseHandler];
    v61 = v60 == 0;

    if (!v61)
    {
      v47 = [v7 responseHandler];
      v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      (*&v47->super.super._primary)(v47, v22, 0);
LABEL_21:
    }
  }

  v62 = *MEMORY[0x277D85DE8];
}

void __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1304(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v2 = [WeakRetained homeManager];
  v3 = [v2 accessoryBrowser];
  v4 = [v3 chipAccessoryServerBrowser];
  v5 = [*(a1 + 32) matterNodeID];
  v6 = [WeakRetained targetFabricUUID];
  [v4 handleHomeAddedAccessoryWithNodeID:v5 fabricUUID:v6 localControl:{objc_msgSend(WeakRetained, "isCurrentDevicePrimaryResident")}];
}

uint64_t __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_2(uint64_t a1)
{
  v43 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) remoteAccessIsEnabled])
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 32);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 40) shortDescription];
      *buf = 138543618;
      *&buf[4] = v5;
      v39 = 2112;
      v40 = v6;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@accessory %@ setting remote access enabled", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) remoteAccessEnabled:1];
  }

  [*(a1 + 32) _reachabilityChangedForAccessory:*(a1 + 40) reachable:{objc_msgSend(*(a1 + 40), "isReachable")}];
  v7 = [*(a1 + 48) transactionResult];
  v8 = [v7 source];

  if ([*(a1 + 40) isPrimary])
  {
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [*(a1 + 40) shortDescription];
      v14 = *(a1 + 56);
      *buf = 138543874;
      *&buf[4] = v12;
      v39 = 2112;
      v40 = v13;
      v41 = 2112;
      v42 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@accessory %@ handling added primary HAPAccessory: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    if (!*(a1 + 56))
    {
      v15 = [*(a1 + 40) identifier];
      *buf = 0;
      [*(a1 + 40) matchesHAPAccessoryWithServerIdentifier:v15 linkType:buf];
      v16 = [*(a1 + 32) accessoryBrowser];
      [v16 handleNewlyPairedAccessory:v15 linkType:*buf];

      if (!isWatch())
      {
        [*(a1 + 32) __requestAccessoryBrowsing];
      }
    }

    if ((v8 & 0xFFFFFFFFFFFFFFFDLL) == 1)
    {
      if ([*(a1 + 32) isOwnerUser])
      {
        v17 = [*(a1 + 64) sharedAdminAddedTimestamp];

        if (!v17)
        {
          v18 = [*(a1 + 32) homeManager];
          v19 = [*(a1 + 40) identifier];
          v35[0] = MEMORY[0x277D85DD0];
          v35[1] = 3221225472;
          v35[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1305;
          v35[3] = &unk_2797358C8;
          v20 = *(a1 + 40);
          v35[4] = *(a1 + 32);
          v36 = v20;
          [v18 cleanupOperationsForAccessory:v19 user:0 completion:v35];
        }
      }
    }

    v21 = [*(a1 + 32) accessoryBrowser];
    v22 = [*(a1 + 40) identifier];
    [v21 removeUnassociatedAccessoryWithIdentifier:v22];

    v23 = [*(a1 + 32) networkProtectionGroupRegistry];
    [v23 handleAddedAccessory:*(a1 + 40)];
  }

  v24 = *(a1 + 56);
  if (v24)
  {
    [*(a1 + 40) enableNotificationsWithHAPAccessory:v24 homeNotificationsEnabled:*(a1 + 72)];
  }

  else if (*(a1 + 72) == 1)
  {
    v25 = *(a1 + 32);
    v37 = *(a1 + 40);
    v26 = [MEMORY[0x277CBEA60] arrayWithObjects:&v37 count:1];
    [v25 _subscribeForHomeNotificationsFromRemoteGateway:1 accessories:v26];
  }

  v27 = [*(a1 + 48) name];
  if ([v27 isEqualToString:*MEMORY[0x277CD2070]])
  {
  }

  else
  {
    v28 = [*(a1 + 48) name];
    v29 = [v28 isEqualToString:@"kAddAccessoriesInternalRequestKey"];

    if ((v29 & 1) == 0)
    {
      v30 = *(a1 + 32);
      v31 = [*(a1 + 48) identifier];
      v32 = [v30 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v31];

      [*(a1 + 48) respondWithPayload:0];
    }
  }

  if (v8 == 1)
  {
    [*(a1 + 32) notifyOfNewlyAddedAccessoryByThisOwnerDevice:*(a1 + 40)];
  }

  [*(a1 + 32) notifyOfAddedAccessory:*(a1 + 40)];
  result = [*(a1 + 32) reevaluateAccessoryInfo];
  v34 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)__requestAccessoryBrowsing
{
  v2 = [(HMDHome *)self accessoryBrowser];
  [v2 startDiscoveringPairedAccessories];
}

- (void)_handleAddAccessoryModel:(id)a3 message:(id)a4
{
  v34 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v6;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;
  v10 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v10;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;

  v13 = [v10 identifier];

  if (!v13)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [v10 uuid];
      v19 = [v18 UUIDString];
      v30 = 138543618;
      v31 = v17;
      v32 = 2112;
      v33 = v19;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Unable to create accessory from object (null identifier) %@", &v30, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v7 respondWithError:v20];
    goto LABEL_21;
  }

  if (v9)
  {
    [(HMDHome *)self __handleAddHAPAccessoryModel:v9 message:v7];
  }

  else if (v12)
  {
    [(HMDHome *)self __handleAddMediaAccessoryModel:v12 message:v7];
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      v30 = 138543362;
      v31 = v24;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Only HAP accessories can be added to the home currently", &v30, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
    v25 = [v7 responseHandler];

    if (v25)
    {
      v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      v27 = [v7 responseHandler];
      (v27)[2](v27, v26, 0);
    }
  }

  if ([(HMDHome *)self isOwnerUser])
  {
    v20 = [(HMDHome *)self home];
    v28 = [v20 homeManager];
    [v28 updateCurrentUserEligibleForOwnerToAutoMigration];

LABEL_21:
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserConsentResponseForAccessory:(id)a3
{
  v35 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isEntitledForSPIAccess])
  {
    v5 = [v4 dataForKey:*MEMORY[0x277CD1F90]];
    v30 = 0;
    v6 = [(HMDHome *)self _setupDescriptionFromData:v5 error:&v30];
    v7 = v30;
    if (v6)
    {
      v8 = [v4 numberForKey:*MEMORY[0x277CD06B0]];
      if (v8)
      {
        v9 = [(HMDHome *)self addPendingAccessories];
        v10 = [v9 objectForKey:v6];

        v11 = [v8 integerValue];
        if (v11 > 1)
        {
          if ((v11 & 0xFFFFFFFFFFFFFFFELL) == 2)
          {
            [(HMDHome *)self _handleUserConsentForAccessoryReplacement:v6 consent:v11 == 3 message:v10];
          }

          else
          {
            v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];

            v7 = v26;
          }
        }

        else
        {
          v12 = v11 == 1;
          v13 = [(HMDHome *)self accessoryBrowser];
          [v13 didReceiveUserConsentResponseForSetupAccessoryDetail:v6 consent:v12];
        }

        v27 = [v4 responseHandler];

        if (v27)
        {
          v28 = [v4 responseHandler];
          (v28)[2](v28, v7, 0);
        }
      }

      else
      {
        v22 = objc_autoreleasePoolPush();
        v23 = self;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          *buf = 138543362;
          v32 = v25;
          _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@user consent response is absent", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v22);
      }
    }

    else
    {
      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543618;
        v32 = v21;
        v33 = 2112;
        v34 = v7;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v32 = v17;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI for user consent response", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserConsentForAccessoryReplacement:(id)a3 consent:(BOOL)a4 message:(id)a5
{
  v36 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_INFO);
  if (a4)
  {
    if (v13)
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v9 name];
      v16 = [v9 identifier];
      v17 = [v9 messagePayload];
      v28 = 138544130;
      v29 = v14;
      v30 = 2112;
      v31 = v15;
      v32 = 2112;
      v33 = v16;
      v34 = 2112;
      v35 = v17;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@User consented to Wi-Fi router replacement; continue to adding new Wi-Fi router - message %@/%@/%@", &v28, 0x2Au);
    }

    objc_autoreleasePoolPop(v10);
    [v8 setUserConsentedForReplace:1];
    v18 = [v8 accessoryUUID];

    if (v18)
    {
      v19 = [v8 accessoryUUID];
      [(HMDHome *)v11 _continuePairingAfterUserConsentWithAccessoryUUID:v19 orUnassociatedAccessory:0 message:v9];
    }

    else
    {
      [(HMDHome *)v11 _continuePairingAfterUserConsentWithAccessoryDescription:v8 progressHandlerDelegate:0 message:v9];
    }
  }

  else
  {
    if (v13)
    {
      v20 = HMFGetLogIdentifier();
      v21 = [v9 name];
      v22 = [v9 identifier];
      v23 = [v9 messagePayload];
      v28 = 138544130;
      v29 = v20;
      v30 = 2112;
      v31 = v21;
      v32 = 2112;
      v33 = v22;
      v34 = 2112;
      v35 = v23;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@User did not consent to Wi-Fi router replacement; cancelling adding new Wi-Fi router - message %@/%@/%@", &v28, 0x2Au);
    }

    objc_autoreleasePoolPop(v10);
    v24 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:1091];
    v25 = [HMDMatterAccessoryPairingEndContext hmContextWithCancelledError:v24];
    [(HMDHome *)v11 _cancelPairingWithAccessoryDescription:v8 context:v25];

    v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    [v9 respondWithError:v26];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessories:(id)a3
{
  v155[2] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self localCapabilitiesDataSource];
  v6 = [v5 supportsAddingAccessory];

  if (v6)
  {
    v7 = [v4 dataForKey:@"accessories"];
    if (!v7)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = [v4 identifier];
        v13 = [v12 UUIDString];
        *buf = 138543618;
        v145 = v11;
        v146 = 2112;
        v147 = v13;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Unable to find accessories to add for message: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      v14 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      v15 = [v4 responseHandler];
      (v15)[2](v15, v14, 0);
    }

    v143 = 0;
    v113 = v7;
    v16 = [objc_alloc(MEMORY[0x277CCAAC8]) initForReadingFromData:v7 error:&v143];
    v17 = v143;
    [v16 _allowDecodingCyclesInSecureMode];
    v18 = MEMORY[0x277CBEB98];
    v155[0] = objc_opt_class();
    v155[1] = objc_opt_class();
    v19 = [MEMORY[0x277CBEA60] arrayWithObjects:v155 count:2];
    v20 = [v18 setWithArray:v19];
    v21 = *MEMORY[0x277CCA308];
    v142 = v17;
    v112 = v16;
    v22 = [v16 decodeTopLevelObjectOfClasses:v20 forKey:v21 error:&v142];
    v114 = v142;

    v23 = v22;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v24 = v23;
    }

    else
    {
      v24 = 0;
    }

    v25 = v24;

    if (!v25)
    {
      v93 = objc_autoreleasePoolPush();
      v94 = self;
      v95 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v95, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v97 = v96 = v23;
        v98 = [v4 identifier];
        v99 = [v98 UUIDString];
        *buf = 138543874;
        v145 = v97;
        v146 = 2112;
        v147 = v99;
        v148 = 2112;
        v149 = v114;
        _os_log_impl(&dword_2531F8000, v95, OS_LOG_TYPE_INFO, "%{public}@Failed to unarchive accessories from encoded accessories data: %@: %@", buf, 0x20u);

        v23 = v96;
      }

      objc_autoreleasePoolPop(v93);
      v100 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      v101 = [v4 responseHandler];
      (v101)[2](v101, v100, 0);
      v89 = 0;
      v80 = v113;
      goto LABEL_67;
    }

    [v4 dataForKey:@"accessories.airplay"];
    v111 = v110 = v23;
    v26 = v23;
    if (v111)
    {
      v27 = MEMORY[0x277CCAAC8];
      v28 = MEMORY[0x277CBEB98];
      v154[0] = objc_opt_class();
      v154[1] = objc_opt_class();
      v29 = [MEMORY[0x277CBEA60] arrayWithObjects:v154 count:2];
      v30 = [v28 setWithArray:v29];
      v141 = 0;
      v31 = [v27 unarchivedObjectOfClasses:v30 fromData:v111 error:&v141];
      v32 = v141;

      if (!v31)
      {
        v120 = v32;
        v102 = objc_autoreleasePoolPush();
        v103 = self;
        v104 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v104, OS_LOG_TYPE_INFO))
        {
          v105 = HMFGetLogIdentifier();
          v106 = [v4 identifier];
          v107 = [v106 UUIDString];
          *buf = 138543874;
          v145 = v105;
          v146 = 2112;
          v147 = v107;
          v148 = 2112;
          v149 = v120;
          _os_log_impl(&dword_2531F8000, v104, OS_LOG_TYPE_INFO, "%{public}@Failed to unarchive airplay accessories from encoded airplay accessories data: %@: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v102);
        v77 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
        v78 = [v4 responseHandler];
        (v78)[2](v78, v77, 0);
        v23 = v110;
        v89 = v110;
        v80 = v7;
        goto LABEL_66;
      }

      v26 = [v25 arrayByAddingObjectsFromArray:v31];
    }

    v109 = [(HMDHome *)self wiFiRouterAccessories];
    v124 = dispatch_group_create();
    v33 = [(HMDHome *)self backingStore];
    v34 = [v4 name];
    v35 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v36 = [v33 transaction:v34 options:v35];

    v139 = 0u;
    v140 = 0u;
    v137 = 0u;
    v138 = 0u;
    obj = v26;
    v120 = v36;
    v117 = [obj countByEnumeratingWithState:&v137 objects:v153 count:16];
    if (v117)
    {
      v116 = *v138;
      v119 = self;
      do
      {
        v37 = 0;
        do
        {
          if (*v138 != v116)
          {
            objc_enumerationMutation(obj);
          }

          v118 = v37;
          v38 = *(*(&v137 + 1) + 8 * v37);
          [v38 setHome:self];
          v125 = v38;
          v39 = [v38 backingStoreObjects:4];
          v133 = 0u;
          v134 = 0u;
          v135 = 0u;
          v136 = 0u;
          v121 = v39;
          v127 = [v121 countByEnumeratingWithState:&v133 objects:v152 count:16];
          if (v127)
          {
            v126 = *v134;
            do
            {
              for (i = 0; i != v127; ++i)
              {
                if (*v134 != v126)
                {
                  objc_enumerationMutation(v121);
                }

                v41 = *(*(&v133 + 1) + 8 * i);
                [v41 setObjectChangeType:1];
                v42 = v41;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v43 = v42;
                }

                else
                {
                  v43 = 0;
                }

                v44 = v43;

                v45 = v42;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v46 = v45;
                }

                else
                {
                  v46 = 0;
                }

                v47 = v46;

                if (v44)
                {
                  [v44 setConfigurationTracker:v124];
                  v48 = [HMDUserManagementOperationTimestamp alloc];
                  v49 = [v4 remoteSourceDevice];
                  v50 = [(HMDUserManagementOperationTimestamp *)v48 initWithDevice:v49 state:0];
                  [v44 setSharedAdminAddedTimestamp:v50];

                  v51 = objc_autoreleasePoolPush();
                  v52 = self;
                  v53 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
                  {
                    HMFGetLogIdentifier();
                    v122 = v51;
                    v54 = v123 = v47;
                    v55 = [v125 name];
                    v56 = [v125 uuid];
                    v57 = [v56 UUIDString];
                    [v44 sharedAdminAddedTimestamp];
                    v59 = v58 = v4;
                    *buf = 138544130;
                    v145 = v54;
                    v146 = 2112;
                    v147 = v55;
                    v148 = 2112;
                    v149 = v57;
                    v150 = 2112;
                    v151 = v59;
                    _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ shared admin added %@", buf, 0x2Au);

                    v4 = v58;
                    self = v119;

                    v36 = v120;
                    v51 = v122;

                    v47 = v123;
                  }

                  objc_autoreleasePoolPop(v51);
                  [v36 add:v44 withMessage:v4];
                  v60 = v125;
                  objc_opt_class();
                  if (objc_opt_isKindOfClass())
                  {
                    v61 = v60;
                  }

                  else
                  {
                    v61 = 0;
                  }

                  v62 = v61;

                  if ([v62 isPrimary])
                  {
                    v63 = [HMDUserManagementOperation auditUserManagementOperationAccessory:v60 model:0];
                    v64 = [v44 uuid];
                    v65 = [v63 modelObjectWithChangeType:1 parentUUID:v64];

                    if (v65)
                    {
                      [v36 add:v65 withMessage:v4];
                    }
                  }
                }

                else if (v47)
                {
                  [v47 setConfigurationTracker:v124];
                  [v36 add:v45 withMessage:0];
                }
              }

              v127 = [v121 countByEnumeratingWithState:&v133 objects:v152 count:16];
            }

            while (v127);
          }

          v66 = objc_autoreleasePoolPush();
          v67 = self;
          v68 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v68, OS_LOG_TYPE_INFO))
          {
            v69 = HMFGetLogIdentifier();
            v70 = [v125 name];
            v71 = [v125 uuid];
            v72 = [v71 UUIDString];
            [v125 supportsTargetController];
            v73 = HMFBooleanToString();
            *buf = 138544130;
            v145 = v69;
            v146 = 2112;
            v147 = v70;
            v148 = 2112;
            v149 = v72;
            v150 = 2112;
            v151 = v73;
            _os_log_impl(&dword_2531F8000, v68, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ (supportsTargetController %@) being added to home through shared admin", buf, 0x2Au);

            v36 = v120;
          }

          objc_autoreleasePoolPop(v66);
          v74 = v125;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v75 = v74;
          }

          else
          {
            v75 = 0;
          }

          v76 = v75;

          [v76 autoConfigureTargetController];
          v37 = v118 + 1;
        }

        while (v118 + 1 != v117);
        v117 = [obj countByEnumeratingWithState:&v137 objects:v153 count:16];
      }

      while (v117);
    }

    v77 = [v4 numberForKey:@"HMDHomeCHIPFabricIDMessageKey"];
    v78 = [v4 numberForKey:@"HMDHomeCHIPFabricIndexMessageKey"];
    v79 = [(HMDHome *)self emptyModelObjectWithChangeType:2];
    v80 = v113;
    if (v77)
    {
      if (v78)
      {
        v81 = [(HMDHome *)self chipStorage];
        v82 = [v81 fabricID];

        if (!v82)
        {
          [v79 setChipFabricID:v77];
          [v79 setChipFabricIndex:v78];
          v83 = objc_autoreleasePoolPush();
          v84 = self;
          v85 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v85, OS_LOG_TYPE_INFO))
          {
            v86 = HMFGetLogIdentifier();
            *buf = 138543874;
            v145 = v86;
            v146 = 2112;
            v147 = v78;
            v148 = 2112;
            v149 = v77;
            _os_log_impl(&dword_2531F8000, v85, OS_LOG_TYPE_INFO, "%{public}@Updating home model with fabric index %@ and fabric ID %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v83);
          [v120 add:v79];
        }
      }
    }

    v128[0] = MEMORY[0x277D85DD0];
    v128[1] = 3221225472;
    v128[2] = __33__HMDHome__handleAddAccessories___block_invoke;
    v128[3] = &unk_279730430;
    v129 = v124;
    v130 = self;
    v131 = v4;
    v132 = v109;
    v87 = v109;
    v88 = v124;
    [v120 run:v128];

    v23 = v110;
    v89 = obj;
LABEL_66:

    v100 = v111;
    v101 = v120;
LABEL_67:

    goto LABEL_68;
  }

  v90 = [v4 responseHandler];

  if (v90)
  {
    v91 = [v4 responseHandler];
    v92 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (v91)[2](v91, v92, 0);
  }

LABEL_68:

  v108 = *MEMORY[0x277D85DE8];
}

void __33__HMDHome__handleAddAccessories___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __33__HMDHome__handleAddAccessories___block_invoke_2;
  block[3] = &unk_279734960;
  v4 = *(a1 + 48);
  v5 = *(a1 + 40);
  v7 = v4;
  v8 = v5;
  v9 = *(a1 + 56);
  dispatch_group_notify(v2, v3, block);
}

void __33__HMDHome__handleAddAccessories___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) respondWithPayload:0];
  v2 = *(a1 + 40);
  v3 = [*(a1 + 32) identifier];
  v4 = [v2 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v3];

  [*(a1 + 40) _setupActiveNetworkRouterAccessory:v4 existingRouterAccessories:*(a1 + 48)];
}

- (void)_pairAccessoryWithAccessoryDescription:(id)a3 configuration:(id)a4 pairingEvent:(id)a5 progressHandler:(id)a6 requestMessage:(id)a7
{
  v12 = a6;
  v13 = a4;
  v14 = a3;
  v16 = __createAccessoryBrowserAddAccessoryCompletionHandler(self, v14, v13, a5, a7);
  v15 = [(HMDHome *)self accessoryBrowser];
  [v15 pairAccessoryWithDescription:v14 configuration:v13 progressHandler:v12 completionHandler:v16];
}

- (void)_continuePairingAfterUserConsentWithAccessoryDescription:(id)a3 progressHandlerDelegate:(id)a4 message:(id)a5
{
  v59 = *MEMORY[0x277D85DE8];
  v9 = a3;
  v42 = a4;
  v43 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543618;
    *&buf[4] = v13;
    *&buf[12] = 2112;
    *&buf[14] = v9;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Continue pairing after user consent with accessoryDescription %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  v14 = objc_alloc_init(HMDUnpairedHAPAccessoryConfiguration);
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setRequiresUserConsent:1];
  v15 = [(HMDHome *)v11 homeLocationHandler];
  v16 = [v15 isoCountryCode];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setIsoCountryCode:v16];

  v17 = [(HMDHome *)v11 matterFabricID];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setChipFabricID:v17];

  v18 = [(HMDHome *)v11 uuid];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setHomeUUID:v18];

  v19 = [HMDAccessoryPairingEvent pairingAccessoryWithDescription:v9 home:v11];
  if ([v19 isMatterAccessory])
  {
    notifyMatterMetricPairingStep(v11, 2uLL);
  }

  v44 = [v9 setupAccessoryPayload];
  v20 = objc_alloc(MEMORY[0x277D0F770]);
  v21 = MEMORY[0x277CCACA8];
  v22 = MEMORY[0x259C01AE0](v11, a2);
  v23 = [v21 stringWithFormat:@"%@, %s:%ld", v22, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 12372];
  v24 = [v20 initWithName:v23];

  v45 = v24;
  [v9 accessoryUUID];

  [v44 categoryNumber];
  [v19 linkType];
  v25 = HAPLinkTypeDescription();
  [v19 communicationProtocol];
  v26 = HAPCommunicationProtocolDescription();
  [v44 supportsWAC];
  v27 = HMFBooleanToString();
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 requiresUserConsent];
  v28 = HMFBooleanToString();
  v29 = HMDNetworkRouterSupportAsString([(HMDHome *)v11 networkRouterSupport]);
  v30 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome networkRouterSupportDisableReason](v11, "networkRouterSupportDisableReason")}];
  [v9 appIdentifier];

  [v19 isThreadAccessory];
  v31 = HMFBooleanToString();

  if (v42)
  {
    v32 = v42;
    if (v11)
    {
      objc_initWeak(&location, v11);
      *buf = MEMORY[0x277D85DD0];
      *&buf[8] = 3221225472;
      *&buf[16] = __74__HMDHome_createLocalAddAccessoryProgressHandler_progressHandlerDelegate___block_invoke;
      v55 = &unk_279722400;
      objc_copyWeak(&v56[8], &location);
      *v56 = v32;
      v41 = _Block_copy(buf);

      objc_destroyWeak(&v56[8]);
      objc_destroyWeak(&location);
    }

    else
    {
      v41 = 0;
    }
  }

  else
  {
    v41 = HMDHomeCreateAddAccessoryProgressHandler(v11, v9, v43);
  }

  v33 = objc_autoreleasePoolPush();
  v34 = v11;
  v35 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
  {
    v36 = HMFGetLogIdentifier();
    [v9 supportsWAC];
    v37 = HMFBooleanToString();
    v38 = HMDNetworkRouterSupportAsString([(HMDHome *)v34 networkRouterSupport]);
    [(HMDHome *)v34 networkRouterSupportDisableReason];
    v39 = HMNetworkRouterSupportDisableReasonAsString();
    *buf = 138544386;
    *&buf[4] = v36;
    *&buf[12] = 2112;
    *&buf[14] = v9;
    *&buf[22] = 2112;
    v55 = v37;
    *v56 = 2112;
    *&v56[2] = v38;
    v57 = 2112;
    v58 = v39;
    _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Adding unpaired accessory with description: %@, supports WAC: %@, network router support: %@ (Reason: %@)", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v33);
  if ([v9 supportsWAC] && (-[HMDHome networkRouterSupport](v34, "networkRouterSupport") & 8) != 0)
  {
    v46[0] = MEMORY[0x277D85DD0];
    v46[1] = 3221225472;
    v46[2] = __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke;
    v46[3] = &unk_2797224F0;
    v46[4] = v34;
    v47 = v45;
    v48 = v9;
    v49 = v19;
    v50 = v43;
    v51 = v14;
    v52 = v41;
    [(HMDHome *)v34 _createUniquePSKClientConfigurationWithRequestMessage:v50 pairingEvent:v49 completion:v46];
  }

  else
  {
    [v45 begin];
    *buf = v45;
    [(HMDHome *)v34 _pairAccessoryWithAccessoryDescription:v9 configuration:v14 pairingEvent:v19 progressHandler:v41 requestMessage:v43];
    __HMFActivityScopeLeave();
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke_2;
  block[3] = &unk_27972EED8;
  v11 = a1[5];
  v12 = a1[6];
  v13 = v6;
  v14 = a1[4];
  v15 = a1[7];
  v16 = a1[8];
  v17 = a1[9];
  v18 = v5;
  v19 = a1[10];
  v8 = v5;
  v9 = v6;
  dispatch_async(v7, block);
}

void __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke_2(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 40);
  v3 = *(a1 + 32);
  [v2 accessoryUUID];

  [*(a1 + 48) domain];
  [*(a1 + 48) code];

  v4 = *(a1 + 48) == 0;
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 56);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *v15 = 138543362;
      *&v15[4] = v13;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Client configuration with WiFi unique PSK created successfully", v15, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 80) setNetworkCredential:*(a1 + 88)];
    [*(a1 + 64) setUsedWiFiPPSK:1];
    [*(a1 + 32) begin];
    *v15 = *(a1 + 32);
    [*(a1 + 56) _pairAccessoryWithAccessoryDescription:*(a1 + 40) configuration:*(a1 + 80) pairingEvent:*(a1 + 64) progressHandler:*(a1 + 96) requestMessage:*(a1 + 72)];
    __HMFActivityScopeLeave();
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 40);
      v11 = *(a1 + 48);
      *v15 = 138543874;
      *&v15[4] = v9;
      v16 = 2112;
      v17 = v10;
      v18 = 2112;
      v19 = v11;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate WiFi credential for accessory %@ with error: %@", v15, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v12 = [*(a1 + 56) logEventSubmitter];
    [v12 submitLogEvent:*(a1 + 64) error:*(a1 + 48)];

    [*(a1 + 72) respondWithError:*(a1 + 48)];
    [*(a1 + 56) _removePendingAccessoryAdd:*(a1 + 40)];
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __74__HMDHome_createLocalAddAccessoryProgressHandler_progressHandlerDelegate___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v7 = objc_autoreleasePoolPush();
  v8 = WeakRetained;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = HMSetupAccessoryProgressAsString();
    v16 = 138543618;
    v17 = v10;
    v18 = 2112;
    v19 = v11;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Local add accessory progress handler called with progress: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  if (v8)
  {
    if (*(a1 + 32))
    {
      v12 = [v5 accessoryUUID];

      if (a2 == 6)
      {
        if (v12)
        {
          v13 = *(a1 + 32);
          v14 = [v5 accessoryUUID];
          [v13 localAccessoryAddRequiresConsent:v14];
        }
      }
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessoryWithDescription:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 dataForKey:*MEMORY[0x277CD1F90]];
  v14 = 0;
  v6 = [(HMDHome *)self _setupDescriptionFromData:v5 error:&v14];
  v7 = v14;
  if (v6)
  {
    [(HMDHome *)&self->super.super.isa _handleAddAccessoryWithDescription:v6 progressHandlerDelegate:0 message:v4];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v16 = v11;
      v17 = 2112;
      v18 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v12];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessoryWithDescription:(void *)a3 progressHandlerDelegate:(void *)a4 message:
{
  v59 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = v9;
  if (a1)
  {
    if (([v9 isEntitledForSPIAccess] & 1) == 0)
    {
      v30 = objc_autoreleasePoolPush();
      v31 = a1;
      v32 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        v33 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v33;
        _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v30);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [v10 respondWithError:v16];
      goto LABEL_32;
    }

    v11 = [a1 accessories];
    v12 = [v11 count];
    v13 = maximumAccessoriesPerHome;

    if (v12 >= v13)
    {
      v34 = objc_autoreleasePoolPush();
      v35 = a1;
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
      {
        v37 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v37;
        _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_INFO, "%{public}@Can't add additional accessories; already at maximum accessories for home", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v34);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
      [v10 respondWithError:v16];
      goto LABEL_32;
    }

    v52 = 0;
    v14 = [a1 _shouldAllowAddingAccessoryWithDescription:v7 requestMessage:v10 error:&v52];
    v15 = v52;
    v16 = v15;
    if (v14)
    {
      goto LABEL_5;
    }

    v38 = [v15 domain];
    if ([v38 isEqualToString:*MEMORY[0x277CCFD28]])
    {
      v39 = [v16 code] == 97;

      if (v39)
      {
LABEL_5:
        v17 = [v7 appIdentifier];
        v18 = v17 == 0;

        if (v18)
        {
          v19 = [v10 clientIdentifier];
          v20 = v19;
          if (v19)
          {
            v21 = v19;
          }

          else
          {
            v21 = &stru_286509E58;
          }

          [v7 updateAppIdentifier:v21];
        }

        os_unfair_recursive_lock_lock_with_options();
        [a1[129] setObject:v10 forKey:v7];
        os_unfair_recursive_lock_unlock();
        v22 = [a1 accessoryBrowser];
        v23 = [v22 unpairedHAPAccessoryWithAccessoryDescription:v7];

        v24 = [v23 uuid];
        v25 = HMDHomeCreateAddAccessoryProgressHandler(a1, v7, v10);

        v26 = [a1 accessoryBrowser];
        v27 = [v23 uuid];
        [v26 registerProgressHandler:v25 unpairedAccessoryUUID:v27];

        if (v14)
        {
          v28 = [v7 accessoryUUID];

          if (v28)
          {
            v29 = [v7 accessoryUUID];
            [a1 _continuePairingAfterUserConsentWithAccessoryUUID:v29 orUnassociatedAccessory:0 message:v10];
          }

          else
          {
            [a1 _continuePairingAfterUserConsentWithAccessoryDescription:v7 progressHandlerDelegate:v8 message:v10];
          }
        }

        else
        {
          v40 = [v23 category];
          v41 = v40 == 0;

          if (v41)
          {
            v49 = [v7 setupAccessoryPayload];
            v42 = [v49 categoryNumber];
          }

          else
          {
            v42 = 0;
          }

          v50 = [[HMDAddAccessoryProgressState alloc] initWithUnpairedAccessory:v23 server:0 categoryIdentifier:v42 certificationStatus:0];
          (v25)[2](v25, 9, v50);
        }

LABEL_32:
        goto LABEL_33;
      }
    }

    else
    {
    }

    v43 = objc_autoreleasePoolPush();
    v44 = a1;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
    {
      v46 = HMFGetLogIdentifier();
      v47 = [v7 category];
      v48 = [v47 localizedDescription];
      *buf = 138543874;
      v54 = v46;
      v55 = 2112;
      v56 = v48;
      v57 = 2112;
      v58 = v16;
      _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_INFO, "%{public}@Cannot add an accessory of category '%@', error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v43);
    [v10 respondWithError:v16];
    goto LABEL_32;
  }

LABEL_33:

  v51 = *MEMORY[0x277D85DE8];
}

- (void)_addMediaAccessory:(id)a3 message:(id)a4
{
  v57 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v36 = a4;
  if (self && ([v6 identifier], v7 = objc_claimAutoreleasedReturnValue(), v8 = objc_msgSend(v7, "isEqualToString:", @"00000000-0000-0000-0000-C2EE6102B308"), v7, v8))
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v12;
      *&buf[12] = 2112;
      *&buf[14] = v6;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@The accessory %@ has an unknown media route identifier", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v13 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:9001];
    [v36 respondWithError:v13];
  }

  else
  {
    v41 = 0;
    v42 = &v41;
    v43 = 0x2020000000;
    v44 = 0;
    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v46 = __Block_byref_object_copy__10664;
    v47 = __Block_byref_object_dispose__10665;
    v48 = 0;
    v14 = [(HMDHome *)self appleMediaAccessories];
    v37[0] = MEMORY[0x277D85DD0];
    v37[1] = 3221225472;
    v37[2] = __38__HMDHome__addMediaAccessory_message___block_invoke;
    v37[3] = &unk_2797224C8;
    v15 = v6;
    v38 = v15;
    v39 = &v41;
    v40 = buf;
    [v14 na_each:v37];

    if (v42[3] >= 1)
    {
      v16 = *(*&buf[8] + 40);
      if (v16)
      {
        [HMDHome _submitRemovalLogEventForAccessory:"_submitRemovalLogEventForAccessory:isLocalRemoval:isLocalFallback:isDuplicate:duplicateCount:error:" isLocalRemoval:v16 isLocalFallback:0 isDuplicate:0 duplicateCount:1 error:?];
      }
    }

    v17 = v15;
    v18 = v36;
    if (self)
    {
      v19 = objc_autoreleasePoolPush();
      v20 = self;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v22 = HMFGetLogIdentifier();
        v23 = [v18 shortDescription];
        [(HMDHome *)v20 isCurrentDevicePrimaryResident];
        v24 = HMFBooleanToString();
        *v49 = 138544130;
        v50 = v22;
        v51 = 2112;
        v52 = v17;
        v53 = 2112;
        v54 = v23;
        v55 = 2112;
        v56 = v24;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Performing local add of media accessory: %@. Message: %@ - isPrimaryResident: %@", v49, 0x2Au);
      }

      objc_autoreleasePoolPop(v19);
      v25 = HMFGetOSLogHandle();
      if (os_signpost_enabled(v25))
      {
        v26 = [v17 uuid];
        *v49 = 138412290;
        v50 = v26;
        _os_signpost_emit_with_name_impl(&dword_2531F8000, v25, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "AddAccessory", "accessoryUUID=%{signpost.description:attribute}@ ", v49, 0xCu);
      }

      v27 = [v17 addTransactionForHome:v20];
      v28 = [(HMDHome *)v20 roomForEntireHome];
      v29 = [v28 uuid];
      v30 = [v29 UUIDString];
      [v27 setRoomUUID:v30];

      v31 = [(HMDHome *)v20 backingStore];
      v32 = [v18 name];
      v33 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v34 = [v31 transaction:v32 options:v33];

      [v34 add:v27 withMessage:v18];
      [v34 run];
      if (os_signpost_enabled(v25))
      {
        *v49 = 0;
        _os_signpost_emit_with_name_impl(&dword_2531F8000, v25, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "AddAccessory", "", v49, 2u);
      }
    }

    _Block_object_dispose(buf, 8);
    _Block_object_dispose(&v41, 8);
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__addMediaAccessory_message___block_invoke(uint64_t a1, void *a2)
{
  v7 = a2;
  if ([v7 isHomePod])
  {
    v4 = [*(a1 + 32) serialNumber];
    v5 = [v7 serialNumber];
    v6 = [v4 isEqualToString:v5];

    if (v6)
    {
      ++*(*(*(a1 + 40) + 8) + 24);
      objc_storeStrong((*(*(a1 + 48) + 8) + 40), a2);
    }
  }
}

- (void)_removePendingAccessoryAdd:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 accessoryUUID];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [v5 UUIDString];
    v12 = 138543618;
    v13 = v9;
    v14 = 2112;
    v15 = v10;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Removing accessoryDescription, setupCode and handlers for accessory %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)v7->_addPendingAccessories removeObjectForKey:v4];
  if (v5)
  {
    [(NSMutableDictionary *)v7->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v5];
    [(NSMutableDictionary *)v7->_addPendingAccessorySetupCodes removeObjectForKey:v5];
    [(NSMutableDictionary *)v7->_addPendingAccessoryOnboardingSetupPayloadStrings removeObjectForKey:v5];
  }

  os_unfair_recursive_lock_unlock();

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_accessoryPairingDidComplete:(id)a3 configuration:(id)a4 pairingEvent:(id)a5 accessoryServer:(id)a6 certificationStatus:(int64_t)a7 requestMessage:(id)a8
{
  v42 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v32 = a4;
  v15 = a5;
  v16 = a6;
  v33 = a8;
  [(HMDHome *)self _removePendingAccessoryAdd:v14];
  v17 = v16;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v18 = v17;
  }

  else
  {
    v18 = 0;
  }

  v19 = v18;

  v20 = 0;
  if ([v19 isWacComplete])
  {
    v21 = objc_autoreleasePoolPush();
    v22 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v24;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@WAC was completed as part of accessory pairing.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
    v20 = [v32 networkCredential];
  }

  if ([v15 isMatterAccessory])
  {
    notifyMatterMetricPairingStep(self, 0x18uLL);
  }

  v25 = [MEMORY[0x277D0F770] currentActivity];
  objc_initWeak(buf, self);
  v26 = [v14 accessoryUUID];
  v34[0] = MEMORY[0x277D85DD0];
  v34[1] = 3221225472;
  v34[2] = __118__HMDHome__accessoryPairingDidComplete_configuration_pairingEvent_accessoryServer_certificationStatus_requestMessage___block_invoke;
  v34[3] = &unk_279722478;
  objc_copyWeak(v39, buf);
  v27 = v17;
  v35 = v27;
  v28 = v15;
  v36 = v28;
  v29 = v14;
  v37 = v29;
  v30 = v25;
  v38 = v30;
  v39[1] = a7;
  [(HMDHome *)self _processAccessoriesToAddForUnpairedAccessory:v26 certificationStatus:a7 accessoryServer:v27 networkCredential:v20 pairingEvent:v28 message:v33 completionHandler:v34];

  objc_destroyWeak(v39);
  objc_destroyWeak(buf);

  v31 = *MEMORY[0x277D85DE8];
}

void __118__HMDHome__accessoryPairingDidComplete_configuration_pairingEvent_accessoryServer_certificationStatus_requestMessage___block_invoke(uint64_t a1, void *a2)
{
  v33 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v5 = [WeakRetained _primaryAccessoryForServer:*(a1 + 32)];
  v28 = 0;
  v6 = [v5 preferredHAPAccessoryForOperation:1 linkType:&v28];
  v7 = [*(a1 + 32) pairingMetricDictionary];
  v8 = [v7 copy];
  [*(a1 + 40) setMatterMetrics:v8];

  [*(a1 + 32) clearPairingMetrics];
  [*(a1 + 40) updateEventPropertiesWithPairedAccessory:v5];
  if ([*(a1 + 40) isMatterAccessory] && objc_msgSend(*(a1 + 40), "isAddOperation"))
  {
    if (v3)
    {
      [HMDMatterAccessoryPairingEndContext hmdContextWithError:v3];
    }

    else
    {
      +[HMDMatterAccessoryPairingEndContext pairingCompletedContext];
    }
    v9 = ;
    notifyMatterMetricPairingEnded(WeakRetained, v9);
  }

  else
  {
    v9 = [WeakRetained logEventSubmitter];
    [v9 submitLogEvent:*(a1 + 40) error:v3];
  }

  v10 = objc_autoreleasePoolPush();
  v11 = WeakRetained;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [*(a1 + 48) accessoryName];
    *buf = 138543618;
    v30 = v13;
    v31 = 2112;
    v32 = v14;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@_handleAddAccessory: added accessories for accessory %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  v15 = [v5 metricLoggingVendorDetails];
  v16 = [v6 server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = v16;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  v19 = *(a1 + 48);
  v20 = *(a1 + 56);
  [v19 accessoryUUID];

  [*(a1 + 32) category];
  [v15 model];

  [v15 manufacturer];
  [v15 firmwareVersion];

  v21 = HAPLinkTypeDescription();
  [v18 isWacAccessory];

  v22 = HMFBooleanToString();
  v23 = [MEMORY[0x277CCABB0] numberWithInteger:*(a1 + 72)];
  [*(a1 + 40) isThreadAccessory];
  v24 = HMFBooleanToString();
  [*(a1 + 40) accessorySupportsWoL];

  v25 = HMFBooleanToString();
  v26 = [v11 homeLocationHandler];
  [v26 updateHomeLocation];

  [v11 _evaluateShouldRelaunchAndSetRelaunch];
  v27 = *MEMORY[0x277D85DE8];
}

- (void)_pairAccessoryWithAccessoryDescription:(id)a3 unpairedAccessory:(id)a4 configuration:(id)a5 pairingEvent:(id)a6 requestMessage:(id)a7
{
  v12 = a7;
  v13 = a6;
  v14 = a5;
  v15 = a4;
  v16 = a3;
  v18 = [(HMDHome *)self accessoryBrowser];
  v17 = __createAccessoryBrowserAddAccessoryCompletionHandler(self, v16, v14, v13, v12);

  [v18 pairAccessory:v15 configuration:v14 completionHandler:v17];
}

- (void)_continuePairingAfterUserConsentWithAccessoryUUID:(id)a3 orUnassociatedAccessory:(id)a4 message:(id)a5
{
  v113 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v96 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543618;
    *&buf[4] = v13;
    *&buf[12] = 2112;
    *&buf[14] = v8;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Continue pairing after user consent with accessoryUUID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  if (v9)
  {
    goto LABEL_5;
  }

  v14 = [(HMDHome *)v11 accessoryBrowser];
  v15 = [v14 unassociatedAccessories];
  v9 = [v15 hmf_firstObjectWithUUID:v8];

  if (v9)
  {
LABEL_5:
    v95 = v9;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v17 = v95;
    }

    else
    {
      v17 = 0;
    }

    v94 = v17;

    if (isKindOfClass)
    {
      v107 = 0u;
      v105 = 0u;
      v106 = 0u;
      v104 = 0u;
      v18 = [(HMDHome *)v11 addPendingAccessories];
      v19 = [v18 hm_allKeys];

      v20 = [v19 countByEnumeratingWithState:&v104 objects:v109 count:16];
      if (v20)
      {
        v21 = *v105;
        while (2)
        {
          for (i = 0; i != v20; ++i)
          {
            if (*v105 != v21)
            {
              objc_enumerationMutation(v19);
            }

            v23 = *(*(&v104 + 1) + 8 * i);
            v24 = [v23 accessoryUUID];
            v25 = [v24 isEqual:v8];

            if (v25)
            {
              v93 = v23;
              v34 = [(HMDHome *)v11 addPendingAccessories];
              v35 = [v34 objectForKey:v93];

              v96 = v35;
              goto LABEL_27;
            }
          }

          v20 = [v19 countByEnumeratingWithState:&v104 objects:v109 count:16];
          if (v20)
          {
            continue;
          }

          break;
        }
      }

      v93 = 0;
LABEL_27:

      v91 = [v96 stringForKey:*MEMORY[0x277CD1FD8]];
      if (v91)
      {
        v36 = objc_autoreleasePoolPush();
        v37 = v11;
        v38 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
        {
          v39 = HMFGetLogIdentifier();
          *buf = 138543618;
          *&buf[4] = v39;
          *&buf[12] = 2112;
          *&buf[14] = v94;
          _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@Storing setupCode accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v36);
        v40 = [(HMDHome *)v37 addPendingAccessorySetupCodes];
        [v40 setObject:v91 forKey:v8];
      }

      else
      {
        v91 = [v93 setupCode];
      }

      v45 = [v93 appIdentifier];
      v92 = +[HMDAccessoryPairingEvent pairingAccessory:home:appIdentifier:retry:](HMDAccessoryPairingEvent, "pairingAccessory:home:appIdentifier:retry:", v94, v11, v45, [v93 retry]);

      if ([v92 isMatterAccessory])
      {
        notifyMatterMetricPairingStep(v11, 2uLL);
      }

      v46 = objc_alloc_init(HMDUnpairedHAPAccessoryConfiguration);
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setSetupCode:v91];
      v47 = [(HMDHome *)v11 _setupCodeProviderForMessage:v96];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setSetupCodeProvider:v47];

      v48 = [(HMDHome *)v11 homeLocationHandler];
      v49 = [v48 isoCountryCode];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setIsoCountryCode:v49];

      v50 = [(HMDHome *)v11 matterFabricID];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setChipFabricID:v50];

      v51 = [(HMDHome *)v11 uuid];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setHomeUUID:v51];

      v52 = [v94 preferredAccessoryServer];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v53 = v52;
      }

      else
      {
        v53 = 0;
      }

      v90 = v53;

      v54 = objc_autoreleasePoolPush();
      v55 = v11;
      v56 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
      {
        v57 = HMFGetLogIdentifier();
        v58 = [v8 UUIDString];
        [v90 isWacNeeded];
        v59 = HMFBooleanToString();
        v60 = HMDNetworkRouterSupportAsString([(HMDHome *)v55 networkRouterSupport]);
        [(HMDHome *)v55 networkRouterSupportDisableReason];
        v61 = HMNetworkRouterSupportDisableReasonAsString();
        *buf = 138544386;
        *&buf[4] = v57;
        *&buf[12] = 2112;
        *&buf[14] = v58;
        *&buf[22] = 2112;
        v111 = v59;
        *v112 = 2112;
        *&v112[2] = v60;
        *&v112[10] = 2112;
        *&v112[12] = v61;
        _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_INFO, "%{public}@Adding unpaired accessory with uuid: %@, WAC needed: %@, network router support: %@ (Reason %@)", buf, 0x34u);
      }

      objc_autoreleasePoolPop(v54);
      v62 = [MEMORY[0x277D0F770] currentActivity];
      [v93 accessoryUUID];

      v63 = [v94 preferredAccessoryServer];
      [v63 category];

      v64 = HMDNetworkRouterSupportAsString([(HMDHome *)v55 networkRouterSupport]);
      v65 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome networkRouterSupportDisableReason](v55, "networkRouterSupportDisableReason")}];
      [v92 linkType];
      v66 = HAPLinkTypeDescription();
      [v92 communicationProtocol];
      v67 = HAPCommunicationProtocolDescription();
      [v90 isWacNeeded];
      v68 = HMFBooleanToString();
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 requiresUserConsent];
      v69 = HMFBooleanToString();
      [v93 appIdentifier];

      [v92 isThreadAccessory];
      v70 = HMFBooleanToString();
      if ([v90 isWacNeeded] && (-[HMDHome networkRouterSupport](v55, "networkRouterSupport") & 8) != 0)
      {
        v97[0] = MEMORY[0x277D85DD0];
        v97[1] = 3221225472;
        v97[2] = __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke;
        v97[3] = &unk_279722450;
        v97[4] = v55;
        v98 = v62;
        v99 = v93;
        v100 = v92;
        v101 = v96;
        v102 = v46;
        v103 = v94;
        [(HMDHome *)v55 _createUniquePSKClientConfigurationWithRequestMessage:v101 pairingEvent:v100 completion:v97];
      }

      else
      {
        [v62 begin];
        *buf = v62;
        [(HMDHome *)v55 _pairAccessoryWithAccessoryDescription:v93 unpairedAccessory:v94 configuration:v46 pairingEvent:v92 requestMessage:v96];
        __HMFActivityScopeLeave();
      }
    }

    else
    {
      v95 = v95;
      v96 = v96;
      if (v11)
      {
        objc_initWeak(&location, v11);
        v26 = v95;
        objc_opt_class();
        v27 = objc_opt_isKindOfClass();
        if (v27)
        {
          v28 = v26;
        }

        else
        {
          v28 = 0;
        }

        v29 = v28;

        if (v27)
        {
          v30 = objc_autoreleasePoolPush();
          v31 = v11;
          v32 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
          {
            v33 = HMFGetLogIdentifier();
            *buf = 138543618;
            *&buf[4] = v33;
            *&buf[12] = 2112;
            *&buf[14] = v29;
            _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_DEFAULT, "%{public}@Starting WAC for %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v30);
          *buf = MEMORY[0x277D85DD0];
          *&buf[8] = 3221225472;
          *&buf[16] = __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke;
          v111 = &unk_2797224A0;
          objc_copyWeak(&v112[16], &location);
          *v112 = v96;
          *&v112[8] = v29;
          [*&v112[8] startConfigurationWithCompletionHandler:buf];

          objc_destroyWeak(&v112[16]);
        }

        else
        {
          v41 = v26;
          objc_opt_class();
          v42 = objc_opt_isKindOfClass();
          if (v42)
          {
            v43 = v41;
          }

          else
          {
            v43 = 0;
          }

          v44 = v43;

          if (v42)
          {
            [(HMDHome *)v11 _addAndMaybeAssociateMediaAccessory:v44 message:v96];
          }

          else
          {
            v84 = objc_autoreleasePoolPush();
            v85 = v11;
            v86 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v86, OS_LOG_TYPE_DEFAULT))
            {
              v87 = HMFGetLogIdentifier();
              *buf = 138543618;
              *&buf[4] = v87;
              *&buf[12] = 2112;
              *&buf[14] = v41;
              _os_log_impl(&dword_2531F8000, v86, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to add unknown unassociated accessory: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v84);
            v88 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
            [v96 respondWithError:v88];
          }
        }

        objc_destroyWeak(&location);
      }
    }

    goto LABEL_61;
  }

  v71 = objc_autoreleasePoolPush();
  v72 = v11;
  v73 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v73, OS_LOG_TYPE_DEFAULT))
  {
    v74 = HMFGetLogIdentifier();
    v75 = [v8 UUIDString];
    *buf = 138543618;
    *&buf[4] = v74;
    *&buf[12] = 2112;
    *&buf[14] = v75;
    _os_log_impl(&dword_2531F8000, v73, OS_LOG_TYPE_DEFAULT, "%{public}@Unknown accessory with identifier: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v71);
  v76 = objc_autoreleasePoolPush();
  v77 = v72;
  v78 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v78, OS_LOG_TYPE_DEFAULT))
  {
    v79 = HMFGetLogIdentifier();
    v80 = [(HMDHome *)v77 accessoryBrowser];
    v81 = [(HMDHome *)v77 accessoryBrowser];
    v82 = [v81 unassociatedAccessories];
    *buf = 138543874;
    *&buf[4] = v79;
    *&buf[12] = 2112;
    *&buf[14] = v80;
    *&buf[22] = 2112;
    v111 = v82;
    _os_log_impl(&dword_2531F8000, v78, OS_LOG_TYPE_DEFAULT, "%{public}@AccessoryBrowser %@, Unassociated accessories: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v76);
  v83 = [v96 responseHandler];

  if (v83)
  {
    v95 = [v96 responseHandler];
    v94 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(v95 + 2))(v95, v94, 0);
LABEL_61:
  }

  v89 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke_2;
  block[3] = &unk_279722428;
  v11 = a1[5];
  v12 = a1[6];
  v13 = v6;
  v14 = a1[4];
  v15 = a1[7];
  v16 = a1[8];
  v17 = a1[9];
  v18 = v5;
  v19 = a1[10];
  v8 = v5;
  v9 = v6;
  dispatch_async(v7, block);
}

void __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (!WeakRetained)
  {
    v13 = *(a1 + 32);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
LABEL_7:
    v16 = [v14 hmErrorWithCode:v15];
    [v13 respondWithError:v16];
    goto LABEL_8;
  }

  if (v5)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = *(a1 + 40);
      *buf = 138543618;
      v32 = v11;
      v33 = 2112;
      v34 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@WAC failed for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = *(a1 + 32);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 48;
    goto LABEL_7;
  }

  v18 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v19 = v18;
  }

  else
  {
    v19 = 0;
  }

  v16 = v19;

  if (v16)
  {
    v20 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke_1245;
    block[3] = &unk_279734960;
    block[4] = WeakRetained;
    v29 = v16;
    v30 = *(a1 + 32);
    dispatch_async(v20, block);
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = WeakRetained;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v32 = v24;
      v33 = 2112;
      v34 = objc_opt_class();
      v25 = v34;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Post-WAC not supported for type %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v21);
    v26 = *(a1 + 32);
    v27 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [v26 respondWithError:v27];
  }

LABEL_8:

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_addAndMaybeAssociateMediaAccessory:(void *)a3 message:
{
  v28 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (a1)
  {
    if ([a1 isOwnerUser])
    {
      v7 = [a1 homeManager];
      v8 = [v5 uuid];
      v9 = [v7 accessorySetupMetricDispatcherForAccessoryUUID:v8];

      [v9 addHome:a1];
      if ([v5 conformsToProtocol:&unk_286687F08] && objc_msgSend(v5, "supportsAssociation"))
      {
        objc_initWeak(&location, a1);
        v10 = objc_autoreleasePoolPush();
        v11 = a1;
        v12 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          v13 = HMFGetLogIdentifier();
          *buf = 138543618;
          v25 = v13;
          v26 = 2112;
          v27 = v5;
          _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Starting association for media accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v10);
        v19[0] = MEMORY[0x277D85DD0];
        v19[1] = 3221225472;
        v19[2] = __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke;
        v19[3] = &unk_279731988;
        objc_copyWeak(&v22, &location);
        v20 = v5;
        v21 = v6;
        [v20 associateToHome:v11 completionHandler:v19];

        objc_destroyWeak(&v22);
        objc_destroyWeak(&location);
      }

      else
      {
        [a1 _addMediaAccessory:v5 message:v6];
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      v15 = a1;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v25 = v17;
        _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_DEFAULT, "%{public}@Must be owner to add WHA accessory", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v14);
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [v6 respondWithError:v9];
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke(id *a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (v3)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = v5;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = HMFGetLogIdentifier();
      v10 = a1[4];
      *buf = 138543874;
      v20 = v9;
      v21 = 2112;
      v22 = v10;
      v23 = 2112;
      v24 = v3;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to add accessory, %@, with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    [a1[5] respondWithError:v3];
  }

  else if (WeakRetained)
  {
    v11 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke_1290;
    block[3] = &unk_279732670;
    objc_copyWeak(&v18, a1 + 6);
    v16 = a1[5];
    v17 = a1[4];
    dispatch_async(v11, block);

    objc_destroyWeak(&v18);
  }

  else
  {
    v12 = a1[5];
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v12 respondWithError:v13];
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke_1290(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v5 = WeakRetained;
  if (WeakRetained)
  {
    [WeakRetained _addMediaAccessory:*(a1 + 40) message:*(a1 + 32)];
  }

  else
  {
    v3 = *(a1 + 32);
    v4 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v3 respondWithError:v4];
  }
}

void __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke_1245(id *a1)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = a1[4];
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v7 = 138543362;
    v8 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Continuing to add accessory post-WAC", &v7, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  [(HMDHome *)a1[4] _addAndMaybeAssociateMediaAccessory:a1[6] message:?];
  v6 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke_2(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 40);
  v3 = *(a1 + 32);
  [v2 accessoryUUID];

  [*(a1 + 48) domain];
  [*(a1 + 48) code];

  v4 = *(a1 + 48) == 0;
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 56);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *v15 = 138543362;
      *&v15[4] = v13;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Client configuration with WiFi unique PSK created successfully", v15, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 80) setNetworkCredential:*(a1 + 88)];
    [*(a1 + 64) setUsedWiFiPPSK:1];
    [*(a1 + 32) begin];
    *v15 = *(a1 + 32);
    [*(a1 + 56) _pairAccessoryWithAccessoryDescription:*(a1 + 40) unpairedAccessory:*(a1 + 96) configuration:*(a1 + 80) pairingEvent:*(a1 + 64) requestMessage:*(a1 + 72)];
    __HMFActivityScopeLeave();
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 40);
      v11 = *(a1 + 48);
      *v15 = 138543874;
      *&v15[4] = v9;
      v16 = 2112;
      v17 = v10;
      v18 = 2112;
      v19 = v11;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate WiFi credential for accessory %@ with error: %@", v15, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v12 = [*(a1 + 56) logEventSubmitter];
    [v12 submitLogEvent:*(a1 + 64) error:*(a1 + 48)];

    [*(a1 + 72) respondWithError:*(a1 + 48)];
    [*(a1 + 56) _removePendingAccessoryAdd:*(a1 + 40)];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_continueLegacyAddAccessoryWithUUID:(id)a3 unassociatedAccessory:(id)a4 setupCode:(id)a5 appID:(id)a6 message:(id)a7
{
  v83 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v17 = [(HMDHome *)self accessoryWithUUID:v12];
  if (v17)
  {
    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543874;
      v78 = v21;
      v79 = 2112;
      v80 = v12;
      v81 = 2112;
      v82 = v17;
      _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_ERROR, "%{public}@Can't add unassociated accessory: this home already has an accessory with UUID %@: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v18);
    if (_os_feature_enabled_impl() && [v16 isEntitledForSPIAccess] && objc_msgSend(v16, "isEntitledToProvideAccessorySetupPayload"))
    {
      v22 = objc_autoreleasePoolPush();
      v23 = v19;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v25;
        _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Creating temporary progress handler to invoke with already-associated error", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v22);
      v26 = objc_alloc(MEMORY[0x277CD1DE8]);
      v27 = [(HMDHome *)v23 uuid];
      v28 = [v26 initWithAccessoryUUID:v12 accessoryName:0 appID:v15 homeUUID:v27];

      v29 = HMDHomeCreateAddAccessoryProgressHandler(v23, v28, v16);
      v30 = [[HMDAddAccessoryProgressState alloc] initWithPairedAccessory:v17];
      (v29)[2](v29, 47, v30);
    }

    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:13];
    [v16 respondWithError:v31];
    goto LABEL_47;
  }

  v32 = [(HMDHome *)self accessories];
  v33 = [v32 count];
  v34 = maximumAccessoriesPerHome;

  if (v33 >= v34)
  {
    v39 = objc_autoreleasePoolPush();
    v40 = self;
    v41 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
    {
      v42 = HMFGetLogIdentifier();
      *buf = 138543362;
      v78 = v42;
      _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_ERROR, "%{public}@Can't add unassociated accessory: already at maximum accessories for home", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v39);
    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    [v16 respondWithError:v31];
  }

  else if (([v13 associationOptions] & 2) != 0)
  {
    v43 = objc_autoreleasePoolPush();
    v44 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
    {
      v46 = HMFGetLogIdentifier();
      *buf = 138543362;
      v78 = v46;
      _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_INFO, "%{public}@Can't add unassociated accessory: software update needed on the accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v43);
    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [v16 respondWithError:v31];
  }

  else
  {
    v35 = [v13 category];
    v76 = 0;
    context = [(HMDHome *)self _shouldAllowAddingAccessoryOfCategory:v35 requestMessage:v16 error:&v76];
    v31 = v76;

    if (context)
    {
LABEL_14:
      v70 = v13;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v36 = v70;
      }

      else
      {
        v36 = 0;
      }

      v67 = v36;

      if (v67)
      {
        v37 = objc_alloc(MEMORY[0x277CD1DE8]);
        v38 = [(HMDHome *)self uuid];
        v68 = [v37 initWithAccessoryUUID:v12 accessoryName:0 appID:v15 homeUUID:v38];

        [v68 setSetupCode:v14];
        os_unfair_recursive_lock_lock_with_options();
        [(NSMapTable *)self->_addPendingAccessories setObject:v16 forKey:v68];
        os_unfair_recursive_lock_unlock();
      }

      else
      {
        v68 = 0;
      }

      if ([v16 isEntitledForSPIAccess] && objc_msgSend(v16, "isEntitledToProvideAccessorySetupPayload"))
      {
        v66 = objc_autoreleasePoolPush();
        v52 = self;
        v53 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v53, OS_LOG_TYPE_DEBUG))
        {
          v54 = HMFGetLogIdentifier();
          *buf = 138543362;
          v65 = v54;
          v78 = v54;
          _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_DEBUG, "%{public}@Registering Progress Handler", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v66);
        v55 = HMDHomeCreateAddAccessoryProgressHandler(v52, v68, v16);
        v56 = v52;
        v57 = v55;
        v58 = [(HMDHome *)v56 accessoryBrowser];
        [v58 registerProgressHandler:v57 unpairedAccessoryUUID:v12];
      }

      else
      {
        v57 = 0;
      }

      if (context)
      {
        [(HMDHome *)self _continuePairingAfterUserConsentWithAccessoryUUID:v12 orUnassociatedAccessory:v70 message:v16];
      }

      else if (v57)
      {
        v59 = [[HMDAddAccessoryProgressState alloc] initWithUnpairedAccessory:v67 server:0];
        (v57)[2](v57, 9, v59);
      }

      else
      {
        contextb = objc_autoreleasePoolPush();
        v60 = self;
        v61 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_INFO))
        {
          v62 = HMFGetLogIdentifier();
          *buf = 138543362;
          v72 = v62;
          v78 = v62;
          _os_log_impl(&dword_2531F8000, v61, OS_LOG_TYPE_INFO, "%{public}@No progress handler but need to request user consent to replace accessory in home", buf, 0xCu);
        }

        objc_autoreleasePoolPop(contextb);
        v63 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
        [v16 respondWithError:v63];
      }

      goto LABEL_47;
    }

    v47 = [v31 domain];
    if ([v47 isEqualToString:*MEMORY[0x277CCFD28]])
    {
      v48 = [v31 code] == 97;

      if (v48)
      {
        goto LABEL_14;
      }
    }

    else
    {
    }

    contexta = objc_autoreleasePoolPush();
    v49 = self;
    v50 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
    {
      v69 = HMFGetLogIdentifier();
      v71 = [v13 category];
      v51 = [v71 localizedDescription];
      *buf = 138543874;
      v78 = v69;
      v79 = 2112;
      v80 = v51;
      v81 = 2112;
      v82 = v31;
      _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_ERROR, "%{public}@Can't add an accessory of category %@: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(contexta);
    [v16 respondWithError:v31];
  }

LABEL_47:

  v64 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldUseDeprecatedAddAccessoryMessage:(id)a3 minimumVersion:(id)a4 primaryResident:(id)a5 shouldRelayMessages:(BOOL)a6
{
  v9 = a4;
  v10 = [a5 device];
  v11 = [v10 version];

  LOBYTE(v12) = 0;
  if (v9 && a5)
  {
    v12 = [v11 isAtLeastVersion:v9] ^ 1;
  }

  v13 = v12 & a6;
  if (a3)
  {
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  return v14;
}

- (void)_handleLegacyAddAccessory:(id)a3
{
  v43 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v37 = 138543362;
    v38 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling legacy add accessory", &v37, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v9)
  {
    v10 = [v4 stringForKey:*MEMORY[0x277CD1FD8]];
    if (v10 && ([v4 isEntitledForSPIAccess] & 1) == 0)
    {
      v29 = objc_autoreleasePoolPush();
      v30 = v6;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        v37 = 138543362;
        v38 = v32;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Client provided a setup code but does not have entitlement to use SPI", &v37, 0xCu);
      }

      objc_autoreleasePoolPop(v29);
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [v4 respondWithError:v13];
    }

    else
    {
      v11 = [(HMDHome *)v6 accessoryBrowser];
      v12 = [v11 unassociatedAccessories];
      v13 = [v12 hmf_firstObjectWithUUID:v9];

      v14 = objc_autoreleasePoolPush();
      v15 = v6;
      v16 = HMFGetOSLogHandle();
      v17 = v16;
      if (v13)
      {
        if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
        {
          v18 = HMFGetLogIdentifier();
          v37 = 138543618;
          v38 = v18;
          v39 = 2112;
          v40 = v13;
          _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Found matching unassociated accessory: %@", &v37, 0x16u);
        }

        objc_autoreleasePoolPop(v14);
        v19 = objc_autoreleasePoolPush();
        v20 = v15;
        v21 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          v22 = HMFGetLogIdentifier();
          v37 = 138543618;
          v38 = v22;
          v39 = 2112;
          v40 = v13;
          _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Continuing legacy add for unassociated accessory: %@", &v37, 0x16u);
        }

        objc_autoreleasePoolPop(v19);
        v23 = [v4 clientIdentifier];
        [(HMDHome *)v20 _continueLegacyAddAccessoryWithUUID:v9 unassociatedAccessory:v13 setupCode:v10 appID:v23 message:v4];
      }

      else
      {
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          v33 = HMFGetLogIdentifier();
          v34 = [(HMDHome *)v15 accessoryBrowser];
          v35 = [v34 unassociatedAccessories];
          v37 = 138543874;
          v38 = v33;
          v39 = 2112;
          v40 = v9;
          v41 = 2112;
          v42 = v35;
          _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Could not find unassociated accessory with UUID %@ for legacy add accessory flow. All unassociated accessories: %@", &v37, 0x20u);
        }

        objc_autoreleasePoolPop(v14);
        v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        [v4 respondWithError:v23];
      }
    }
  }

  else
  {
    v24 = objc_autoreleasePoolPush();
    v25 = v6;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [v4 shortDescription];
      v37 = 138543618;
      v38 = v27;
      v39 = 2112;
      v40 = v28;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Legacy add accessory message is missing accessory uuid: %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v4 respondWithError:v10];
  }

  v36 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldAllowAddingAccessoryWithDescription:(id)a3 requestMessage:(id)a4 error:(id *)a5
{
  v8 = a4;
  v9 = MEMORY[0x277CD1680];
  v10 = a3;
  v11 = [v10 setupAccessoryPayload];
  v12 = [v11 categoryNumber];
  v13 = [v9 categoryWithCategoryIdentifier:v12];

  v14 = [v10 category];

  if ([v14 isWiFiRouterAccessoryCategory])
  {
  }

  else
  {
    v15 = [v13 isWiFiRouterAccessoryCategory];

    if ((v15 & 1) == 0)
    {
      v16 = 1;
      goto LABEL_6;
    }
  }

  v16 = [(HMDHome *)self __shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:v8 error:a5];
LABEL_6:

  return v16;
}

- (BOOL)_shouldAllowAddingAccessoryOfCategory:(id)a3 requestMessage:(id)a4 error:(id *)a5
{
  v8 = a4;
  if ([a3 isWiFiRouterAccessoryCategory])
  {
    v9 = [(HMDHome *)self __shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:v8 error:a5];
  }

  else
  {
    v9 = 1;
  }

  return v9;
}

- (id)_setupDescriptionFromData:(id)a3 error:(id *)a4
{
  v35 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v6 error:a4];
  v8 = v7;
  if (v7)
  {
    v28 = [v7 addRequestIdentifier];
    v30 = 0u;
    v31 = 0u;
    v32 = 0u;
    v33 = 0u;
    v9 = [(HMDHome *)self addPendingAccessories];
    v10 = [v9 hm_allKeys];

    obj = v10;
    v26 = [v10 countByEnumeratingWithState:&v30 objects:v34 count:16];
    if (v26)
    {
      v27 = *v31;
      v24 = v6;
      while (2)
      {
        for (i = 0; i != v26; ++i)
        {
          if (*v31 != v27)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v30 + 1) + 8 * i);
          v13 = [v12 setupAccessoryPayload];
          v14 = [v13 setupID];
          v15 = [v8 setupAccessoryPayload];
          v16 = [v15 setupID];
          if ([v14 isEqual:v16])
          {
            goto LABEL_15;
          }

          v17 = [v12 accessoryUUID];
          v18 = [v8 accessoryUUID];
          if ([v17 isEqual:v18])
          {

LABEL_15:
LABEL_16:
            v21 = [v8 cancellationReason];
            [v12 setCancellationReason:v21];

            v20 = v12;
            v6 = v24;
            goto LABEL_17;
          }

          v19 = [v12 addRequestIdentifier];
          v29 = [v19 isEqual:v28];

          if (v29)
          {
            goto LABEL_16;
          }
        }

        v6 = v24;
        v26 = [obj countByEnumeratingWithState:&v30 objects:v34 count:16];
        if (v26)
        {
          continue;
        }

        break;
      }
    }

    v20 = v8;
LABEL_17:
  }

  else
  {
    v20 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v20;
}

- (BOOL)__shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:(id)a3 error:(id *)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  if (![(HMDHome *)self checkForNetworkRouterSupport:4 error:a4])
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMDNetworkRouterSupportAsString([(HMDHome *)v11 networkRouterSupport]);
      v15 = v14;
      if (a4)
      {
        v16 = *a4;
      }

      else
      {
        v16 = 0;
      }

      v19 = 138543874;
      v20 = v13;
      v21 = 2112;
      v22 = v14;
      v23 = 2112;
      v24 = v16;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Cannot add network router to the home - networkRouterSupport %@ error %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    goto LABEL_12;
  }

  v7 = [(HMDHome *)self wiFiRouterAccessories];
  v8 = [v7 count];

  if (!v8)
  {
    v9 = 1;
    goto LABEL_13;
  }

  if (!a4)
  {
LABEL_12:
    v9 = 0;
    goto LABEL_13;
  }

  [MEMORY[0x277CCA9B8] hmErrorWithCode:97];
  *a4 = v9 = 0;
LABEL_13:

  v17 = *MEMORY[0x277D85DE8];
  return v9;
}

- (void)performLocalAddAccessoryWithDescription:(id)a3 progressHandlerDelegate:(id)a4 completion:(id)a5
{
  v30 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self localCapabilitiesDataSource];
  v12 = [v11 supportsAddingAccessory];

  if (v12)
  {
    v13 = [(HMDHome *)self currentAccessory];
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    v17 = v16;
    if (v13)
    {
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        *buf = 138543618;
        v27 = v18;
        v28 = 2112;
        v29 = v8;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Performing local add accessory with setup description %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
      v19 = [MEMORY[0x277D0F848] internalMessageWithName:*MEMORY[0x277CD2070] messagePayload:0];
      [v19 setQualityOfService:25];
      objc_initWeak(buf, v15);
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __86__HMDHome_performLocalAddAccessoryWithDescription_progressHandlerDelegate_completion___block_invoke;
      v23[3] = &unk_2797355F8;
      objc_copyWeak(&v25, buf);
      v24 = v10;
      [v19 setResponseHandler:v23];
      [(HMDHome *)&v15->super.super.isa _handleAddAccessoryWithDescription:v8 progressHandlerDelegate:v9 message:v19];

      objc_destroyWeak(&v25);
      objc_destroyWeak(buf);
    }

    else
    {
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543618;
        v27 = v21;
        v28 = 2112;
        v29 = v8;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Will not perform local add accessory with setup description %@ without current accessory present", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
      if (!v10)
      {
        goto LABEL_13;
      }

      v19 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2020];
      (*(v10 + 2))(v10, v19);
    }

LABEL_13:
    goto LABEL_14;
  }

  if (v10)
  {
    v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(v10 + 2))(v10, v20);
  }

LABEL_14:

  v22 = *MEMORY[0x277D85DE8];
}

void __86__HMDHome_performLocalAddAccessoryWithDescription_progressHandlerDelegate_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    if (v5)
    {
      v12 = [MEMORY[0x277CCACA8] stringWithFormat:@"failed with error: %@", v5];
    }

    else
    {
      v12 = @"completed";
    }

    *buf = 138543618;
    v16 = v11;
    v17 = 2112;
    v18 = v12;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Perform local add accessory %@", buf, 0x16u);
    if (v5)
    {
    }
  }

  objc_autoreleasePoolPop(v8);
  v13 = *(a1 + 32);
  if (v13)
  {
    (*(v13 + 16))(v13, v5);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessory:(id)a3
{
  v10 = a3;
  v4 = [(HMDHome *)self localCapabilitiesDataSource];
  v5 = [v4 supportsAddingAccessory];

  if (v5)
  {
    v6 = [v10 dataForKey:*MEMORY[0x277CD1F90]];

    if (v6)
    {
      [(HMDHome *)self _handleAddAccessoryWithDescription:v10];
    }

    else
    {
      [(HMDHome *)self _handleLegacyAddAccessory:v10];
    }
  }

  else
  {
    v7 = [v10 responseHandler];

    if (v7)
    {
      v8 = [v10 responseHandler];
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      (v8)[2](v8, v9, 0);
    }
  }
}

- (BOOL)_removeAccessory:(id)a3
{
  v24 = *MEMORY[0x277D85DE8];
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  accessories = self->_accessories;
  v6 = [v4 uuid];
  v7 = [(NSMutableDictionary *)accessories objectForKeyedSubscript:v6];

  if (v7)
  {
    v8 = self->_accessories;
    v9 = [v4 uuid];
    [(NSMutableDictionary *)v8 setObject:0 forKeyedSubscript:v9];

    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [v4 uuid];
      v20 = 138543618;
      v21 = v13;
      v22 = 2112;
      v23 = v14;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Successfully removed accessory from list: %@", &v20, 0x16u);
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v15 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v4 shortDescription];
      v20 = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = v17;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Asked to remove accessory that doesn't exist in list of accessories: %@", &v20, 0x16u);
    }
  }

  objc_autoreleasePoolPop(v10);
  os_unfair_recursive_lock_unlock();

  v18 = *MEMORY[0x277D85DE8];
  return v7 != 0;
}

- (void)removeAccessory:(id)a3
{
  v29 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (v4 && [(HMDHome *)self _removeAccessory:v4])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v26 = v8;
      v27 = 2112;
      v28 = v4;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Removed accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    if ([v4 isPrimary])
    {
      v9 = v4;
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();
      if (isKindOfClass)
      {
        v11 = v9;
      }

      else
      {
        v11 = 0;
      }

      v12 = v11;

      v13 = v9;
      objc_opt_class();
      v14 = objc_opt_isKindOfClass();
      if (v14)
      {
        v15 = v13;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;

      if (isKindOfClass)
      {
        workQueue = v6->_workQueue;
        v23[0] = MEMORY[0x277D85DD0];
        v23[1] = 3221225472;
        v23[2] = __27__HMDHome_removeAccessory___block_invoke;
        v23[3] = &unk_2797359B0;
        v23[4] = v6;
        v18 = &v24;
        v24 = v13;
        v19 = v23;
      }

      else
      {
        if ((v14 & 1) == 0)
        {
LABEL_17:

          goto LABEL_18;
        }

        workQueue = v6->_workQueue;
        v21[0] = MEMORY[0x277D85DD0];
        v21[1] = 3221225472;
        v21[2] = __27__HMDHome_removeAccessory___block_invoke_2;
        v21[3] = &unk_2797359B0;
        v21[4] = v6;
        v18 = &v22;
        v22 = v13;
        v19 = v21;
      }

      dispatch_async(workQueue, v19);

      goto LABEL_17;
    }
  }

LABEL_18:

  v20 = *MEMORY[0x277D85DE8];
}

void __27__HMDHome_removeAccessory___block_invoke(uint64_t a1)
{
  v17 = *MEMORY[0x277D85DE8];
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23 description:@"Retrieval cancelled reason:accessory removed" suggestion:{0, 0}];
  v3 = *(a1 + 32);
  v4 = [*(a1 + 40) identifier];
  [v3 _notifyRetrievalError:v2 accessoryServer:v4 linkType:0 accessoryOperationBlock:0];

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  v5 = [*(a1 + 40) services];
  v6 = [v5 copy];

  v7 = [v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v13;
    do
    {
      v10 = 0;
      do
      {
        if (*v13 != v9)
        {
          objc_enumerationMutation(v6);
        }

        [*(a1 + 32) _removeService:*(*(&v12 + 1) + 8 * v10++)];
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v8);
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __27__HMDHome_removeAccessory___block_invoke_2(uint64_t a1)
{
  v3 = [*(a1 + 32) remoteEventRouterClientController];
  v2 = [*(a1 + 40) uuid];
  [v3 removeResidentRouterForAccessoryUUID:v2];
}

- (void)_addAccessories:(id)a3
{
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __27__HMDHome__addAccessories___block_invoke;
  v3[3] = &unk_279733780;
  v3[4] = self;
  [a3 na_each:v3];
}

- (BOOL)_addAccessory:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  accessories = self->_accessories;
  v6 = [v4 uuid];
  v7 = [(NSMutableDictionary *)accessories objectForKey:v6];

  if (!v7)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v12 = [v4 uuid];
      v17 = 138543618;
      v18 = v11;
      v19 = 2112;
      v20 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Added accessory to the home's list: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = self->_accessories;
    v14 = [v4 uuid];
    [(NSMutableDictionary *)v13 setObject:v4 forKey:v14];
  }

  os_unfair_recursive_lock_unlock();

  v15 = *MEMORY[0x277D85DE8];
  return v7 == 0;
}

- (void)addAccessory:(id)a3
{
  v29 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = v4;
  if (!v4)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v10;
      v11 = "%{public}@Attempting to add a nil accessory";
      v12 = v9;
      v13 = 12;
      goto LABEL_8;
    }

LABEL_9:

    objc_autoreleasePoolPop(v7);
    goto LABEL_11;
  }

  v6 = [v4 uuid];

  if (v6)
  {
    if (![(HMDHome *)self _addAccessory:v5])
    {
      v7 = objc_autoreleasePoolPush();
      v8 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543618;
        v26 = v10;
        v27 = 2112;
        v28 = v5;
        v11 = "%{public}@Attempted to add an accessory that is already present: %@";
        v12 = v9;
        v13 = 22;
LABEL_8:
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, v11, buf, v13);

        goto LABEL_9;
      }

      goto LABEL_9;
    }
  }

  else
  {
    v14 = [v5 uuid];

    if (!v14)
    {
      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_FAULT))
      {
        v19 = HMFGetLogIdentifier();
        v20 = [v5 shortDescription];
        *buf = 138543618;
        v26 = v19;
        v27 = 2112;
        v28 = v20;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_FAULT, "%{public}@Submitting ABC event for failure: Attempted to add an accessory that does not have an uuid: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      v21 = [HMDAssertionLogEvent alloc];
      v22 = [v5 shortDescription];
      v23 = [(HMDAssertionLogEvent *)v21 initWithReason:@"Attempted to add an accessory that does not have an uuid: %@", v22];

      v24 = +[HMDMetricsManager sharedLogEventSubmitter];
      [v24 submitLogEvent:v23];
    }
  }

LABEL_11:

  v15 = *MEMORY[0x277D85DE8];
}

- (unint64_t)assistantAccessCapableAccessoryCount
{
  v15 = *MEMORY[0x277D85DE8];
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v11;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v11 != v6)
        {
          objc_enumerationMutation(v2);
        }

        v5 += [HMDAssistantAccessControl isAccessorySupported:*(*(&v10 + 1) + 8 * i)];
      }

      v4 = [v2 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  v8 = *MEMORY[0x277D85DE8];
  return v5;
}

- (BOOL)shouldEncodeLegacyLocationServiceSettingForSettingsParentUUID:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self mediaSystemWithUUID:v4];
  v6 = v5;
  if (v5)
  {
    LODWORD(v7) = [v5 componentsSupportsHomeLevelLocationServiceSetting] ^ 1;
  }

  else
  {
    v8 = [(HMDHome *)self accessoryWithUUID:v4];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    if (v10)
    {
      LODWORD(v7) = [v10 supportsHomeLevelLocationServiceSetting] ^ 1;
    }

    else
    {
      v7 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        v16 = 138543618;
        v17 = v13;
        v18 = 2112;
        v19 = v4;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to filter legacy location service setting due to no parent found with uuid: %@", &v16, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      LOBYTE(v7) = 0;
    }
  }

  v14 = *MEMORY[0x277D85DE8];
  return v7;
}

- (id)destinationControllerWithCommittedDestinationIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __67__HMDHome_destinationControllerWithCommittedDestinationIdentifier___block_invoke;
  v9[3] = &unk_2797223B0;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __67__HMDHome_destinationControllerWithCommittedDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 committedData];
  v4 = [v3 destinationIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationControllerWithDestinationIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __58__HMDHome_destinationControllerWithDestinationIdentifier___block_invoke;
  v9[3] = &unk_2797223B0;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __58__HMDHome_destinationControllerWithDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 data];
  v4 = [v3 destinationIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationControllerWithIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __47__HMDHome_destinationControllerWithIdentifier___block_invoke;
  v9[3] = &unk_2797223B0;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __47__HMDHome_destinationControllerWithIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 identifier];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (id)destinationControllers
{
  v2 = [(HMDHome *)self appleMediaAccessories];
  v3 = [v2 na_map:&__block_literal_global_1203];

  return v3;
}

- (int64_t)destinationTypeForDestinationWithIdentifier:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v4 = a3;
  [(HMDHome *)self appleMediaAccessories];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v5 = v37 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v35;
    v9 = 3;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v11 = *(*(&v34 + 1) + 8 * i);
        v12 = [v11 uuid];
        v13 = [v12 hmf_isEqualToUUID:v4];

        if (v13)
        {
          v17 = v5;
          goto LABEL_26;
        }

        v14 = [v11 audioDestination];
        v15 = [v14 uniqueIdentifier];
        v16 = [v15 hmf_isEqualToUUID:v4];

        if (v16)
        {
          v17 = v5;
          v9 = 1;
          goto LABEL_26;
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  [(HMDHome *)self mediaSystems];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v17 = v33 = 0u;
  v18 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
  if (v18)
  {
    v19 = v18;
    v20 = *v31;
    while (2)
    {
      for (j = 0; j != v19; ++j)
      {
        if (*v31 != v20)
        {
          objc_enumerationMutation(v17);
        }

        v22 = *(*(&v30 + 1) + 8 * j);
        v23 = [v22 uuid];
        v24 = [v23 hmf_isEqualToUUID:v4];

        if (v24)
        {
          v9 = 4;
          goto LABEL_25;
        }

        v25 = [v22 audioDestination];
        v26 = [v25 uniqueIdentifier];
        v27 = [v26 hmf_isEqualToUUID:v4];

        if (v27)
        {
          v9 = 2;
          goto LABEL_25;
        }
      }

      v19 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
      v9 = 0;
      if (v19)
      {
        continue;
      }

      break;
    }
  }

  else
  {
    v9 = 0;
  }

LABEL_25:

LABEL_26:
  v28 = *MEMORY[0x277D85DE8];
  return v9;
}

- (id)mediaDestinationsInRoom:(id)a3
{
  v45 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self appleMediaAccessories];
  v6 = [(HMDHome *)self mediaSystems];
  v32 = v5;
  v34 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{objc_msgSend(v6, "count") + objc_msgSend(v5, "count")}];
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v7 = v6;
  v8 = [v7 countByEnumeratingWithState:&v39 objects:v44 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v40;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v40 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v39 + 1) + 8 * i);
        v13 = [v12 audioDestination];
        if (v13)
        {
          if (!v4)
          {
            goto LABEL_9;
          }

          v14 = [v12 room];
          v15 = [v14 uuid];
          v16 = [v4 uuid];
          v17 = [v15 hmf_isEqualToUUID:v16];

          if (v17)
          {
LABEL_9:
            [v34 addObject:v13];
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v39 objects:v44 count:16];
    }

    while (v9);
  }

  v33 = v7;

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v18 = v32;
  v19 = [v18 countByEnumeratingWithState:&v35 objects:v43 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v36;
    do
    {
      for (j = 0; j != v20; ++j)
      {
        if (*v36 != v21)
        {
          objc_enumerationMutation(v18);
        }

        v23 = *(*(&v35 + 1) + 8 * j);
        v24 = [v23 audioDestination];
        if (v24)
        {
          if (!v4)
          {
            if (_mediaSystemsContainsAccessory(v33, v23))
            {
              goto LABEL_25;
            }

LABEL_23:
            [v34 addObject:v24];
            goto LABEL_25;
          }

          v25 = [v23 room];
          v26 = [v25 uuid];
          v27 = [v4 uuid];
          if ([v26 hmf_isEqualToUUID:v27])
          {
            v28 = _mediaSystemsContainsAccessory(v33, v23);

            if ((v28 & 1) == 0)
            {
              goto LABEL_23;
            }
          }

          else
          {
          }
        }

LABEL_25:
      }

      v20 = [v18 countByEnumeratingWithState:&v35 objects:v43 count:16];
    }

    while (v20);
  }

  v29 = [v34 copy];
  v30 = *MEMORY[0x277D85DE8];

  return v29;
}

- (id)mediaDestinationManagersWithSupportedOptions:(unint64_t)a3
{
  v5 = [(HMDHome *)self appleMediaAccessories];
  v6 = [(HMDHome *)self mediaSystems];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke;
  v15[3] = &__block_descriptor_40_e54____HMDMediaDestinationManager__16__0__HMDMediaSystem_8l;
  v15[4] = a3;
  v7 = [v6 na_map:v15];
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke_2;
  v12[3] = &unk_279722368;
  v13 = v6;
  v14 = a3;
  v8 = v6;
  v9 = [v5 na_map:v12];
  v10 = [v9 arrayByAddingObjectsFromArray:v7];

  return v10;
}

id __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 audioDestinationManager];
  v4 = [v3 destination];
  LODWORD(a1) = [v4 containsSupportedOptions:*(a1 + 32)];

  if (a1)
  {
    v5 = v3;
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

id __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = [v4 destination];
  if ([v5 containsSupportedOptions:*(a1 + 40)])
  {
    v6 = _mediaSystemsContainsAccessory(*(a1 + 32), v3);

    if ((v6 & 1) == 0)
    {
      v7 = v4;
      goto LABEL_6;
    }
  }

  else
  {
  }

  v7 = 0;
LABEL_6:

  return v7;
}

- (id)mediaDestinationManagersWithHomeTheaterSupportedOptions
{
  v3 = [(HMDHome *)self appleMediaAccessories];
  v4 = [(HMDHome *)self mediaSystems];
  v5 = [v4 na_map:&__block_literal_global_1198];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke_2;
  v10[3] = &unk_279722320;
  v11 = v4;
  v6 = v4;
  v7 = [v3 na_map:v10];
  v8 = [v7 arrayByAddingObjectsFromArray:v5];

  return v8;
}

id __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = [v4 destination];
  if ([v5 containsHomeTheaterSupportedOptions])
  {
    v6 = _mediaSystemsContainsAccessory(*(a1 + 32), v3);

    if ((v6 & 1) == 0)
    {
      v7 = v4;
      goto LABEL_6;
    }
  }

  else
  {
  }

  v7 = 0;
LABEL_6:

  return v7;
}

id __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 audioDestinationManager];
  v3 = [v2 destination];
  v4 = [v3 containsHomeTheaterSupportedOptions];

  if (v4)
  {
    v5 = v2;
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)destinationManagerPassingTest:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  [(HMDHome *)self appleMediaAccessories];
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v5 = v25 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v22 objects:v27 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v23;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v23 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = [*(*(&v22 + 1) + 8 * i) audioDestinationManager];
        if (v10 && (v4[2](v4, v10) & 1) != 0)
        {
          v11 = v5;
          goto LABEL_22;
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v22 objects:v27 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  [(HMDHome *)self mediaSystems];
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v11 = v21 = 0u;
  v12 = [v11 countByEnumeratingWithState:&v18 objects:v26 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v19;
LABEL_12:
    v15 = 0;
    while (1)
    {
      if (*v19 != v14)
      {
        objc_enumerationMutation(v11);
      }

      v10 = [*(*(&v18 + 1) + 8 * v15) audioDestinationManager];
      if (v10)
      {
        if (v4[2](v4, v10))
        {
          break;
        }
      }

      if (v13 == ++v15)
      {
        v13 = [v11 countByEnumeratingWithState:&v18 objects:v26 count:16];
        if (v13)
        {
          goto LABEL_12;
        }

        goto LABEL_19;
      }
    }
  }

  else
  {
LABEL_19:
    v10 = 0;
  }

LABEL_22:
  v16 = *MEMORY[0x277D85DE8];

  return v10;
}

- (id)destinationManagerWithDestinationIdentifier:(id)a3
{
  v4 = a3;
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __55__HMDHome_destinationManagerWithDestinationIdentifier___block_invoke;
  v8[3] = &unk_27972A130;
  v9 = v4;
  v5 = v4;
  v6 = [(HMDHome *)self destinationManagerPassingTest:v8];

  return v6;
}

uint64_t __55__HMDHome_destinationManagerWithDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 destination];
  v4 = [v3 uniqueIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationManagerWithParentIdentifier:(id)a3
{
  v4 = a3;
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __50__HMDHome_destinationManagerWithParentIdentifier___block_invoke;
  v8[3] = &unk_27972A130;
  v9 = v4;
  v5 = v4;
  v6 = [(HMDHome *)self destinationManagerPassingTest:v8];

  return v6;
}

uint64_t __50__HMDHome_destinationManagerWithParentIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 destination];
  v4 = [v3 parentIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)rootDestinationManagerWithDescendantDestinationIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSystems];
  v10 = MEMORY[0x277D85DD0];
  v11 = 3221225472;
  v12 = __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke;
  v13 = &unk_279723F68;
  v14 = self;
  v15 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:&v10];
  v8 = [v7 audioDestinationManager];

  return v8;
}

uint64_t __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 components];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke_2;
  v7[3] = &unk_2797222D8;
  v4 = *(a1 + 40);
  v7[4] = *(a1 + 32);
  v8 = v4;
  v5 = [v3 na_any:v7];

  return v5;
}

uint64_t __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke_2(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 accessory];
  v5 = [v3 accessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v8 = *(a1 + 40);
    v9 = [v7 audioDestination];
    v10 = [v9 uniqueIdentifier];
    v11 = [v8 hmf_isEqualToUUID:v10];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = *(a1 + 32);
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543874;
      v19 = v15;
      v20 = 2112;
      v21 = v3;
      v22 = 2112;
      v23 = v4;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to apple media accessory from component: %@ accessory: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];
  return v11;
}

- (id)destinationManagersWithDestinationIdentifiers:(id)a3 supportedOptions:(unint64_t)a4
{
  v6 = a3;
  v7 = [(HMDHome *)self mediaDestinationManagersWithSupportedOptions:a4];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __74__HMDHome_destinationManagersWithDestinationIdentifiers_supportedOptions___block_invoke;
  v11[3] = &unk_27972A130;
  v12 = v6;
  v8 = v6;
  v9 = [v7 na_filter:v11];

  return v9;
}

uint64_t __74__HMDHome_destinationManagersWithDestinationIdentifiers_supportedOptions___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 identifier];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (id)targetAccessoriesWithDestinationIdentifiers:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self appleMediaAccessories];
  v6 = [(HMDHome *)self mediaSystems];
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke;
  v24[3] = &unk_279722288;
  v7 = v4;
  v25 = v7;
  v8 = [v6 na_map:v24];
  v19 = MEMORY[0x277D85DD0];
  v20 = 3221225472;
  v21 = __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke_2;
  v22 = &unk_2797222B0;
  v9 = v7;
  v23 = v9;
  v10 = [v5 na_map:&v19];
  v11 = [v8 arrayByAddingObjectsFromArray:{v10, v19, v20, v21, v22}];
  v12 = [v11 count];
  if (v12 != [v9 count])
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543874;
      v27 = v16;
      v28 = 2112;
      v29 = v9;
      v30 = 2112;
      v31 = v11;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to get target accessories for destination identifiers: %@ targets: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v11 = MEMORY[0x277CBEBF8];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

id __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = *(a1 + 32);
  v6 = [v4 identifier];
  LODWORD(v5) = [v5 containsObject:v6];

  if (v5)
  {
    v7 = [v3 targetAccessory];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

id __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = *(a1 + 32);
  v6 = [v4 identifier];
  LODWORD(v5) = [v5 containsObject:v6];

  if (v5)
  {
    v7 = v3;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)audioDestinationControllerDataForDestination:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self appleMediaAccessories];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __56__HMDHome_audioDestinationControllerDataForDestination___block_invoke;
  v10[3] = &unk_279734F10;
  v11 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v10];

  v8 = [v7 audioDestinationControllerData];

  return v8;
}

uint64_t __56__HMDHome_audioDestinationControllerDataForDestination___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 audioDestinationControllerData];
  v4 = [v3 destinationIdentifier];
  v5 = [*(a1 + 32) uniqueIdentifier];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

- (id)mediaSystemForAppleMediaAccessory:(id)a3
{
  v17 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v5 = [(HMDHome *)self mediaSystems];
  v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v6)
  {
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if (_mediaSystemContainsAccessory(v9, v4))
        {
          v6 = v9;
          goto LABEL_11;
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v10 = *MEMORY[0x277D85DE8];

  return v6;
}

- (NSArray)appleMediaAccessories
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_map:&__block_literal_global_1191];

  return v3;
}

void *__32__HMDHome_appleMediaAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)_setAccessories:(id)a3
{
  v7 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if (v7)
  {
    v4 = [v7 na_dictionaryWithKeyGenerator:&__block_literal_global_1189];
    v5 = [v4 mutableCopy];
    accessories = self->_accessories;
    self->_accessories = v5;
  }

  else
  {
    [(NSMutableDictionary *)self->_accessories removeAllObjects];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)setAccessories:(id)a3
{
  v29 = *MEMORY[0x277D85DE8];
  v4 = a3;
  [(HMDHome *)self _setAccessories:v4];
  v25 = 0u;
  v26 = 0u;
  v23 = 0u;
  v24 = 0u;
  v5 = v4;
  v6 = [v5 countByEnumeratingWithState:&v23 objects:v28 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v24;
    do
    {
      v9 = 0;
      do
      {
        if (*v24 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v23 + 1) + 8 * v9);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v12)
        {
          v21 = 0u;
          v22 = 0u;
          v19 = 0u;
          v20 = 0u;
          v13 = [(HMDHome *)self serviceGroups];
          v14 = [v13 countByEnumeratingWithState:&v19 objects:v27 count:16];
          if (v14)
          {
            v15 = v14;
            v16 = *v20;
            do
            {
              v17 = 0;
              do
              {
                if (*v20 != v16)
                {
                  objc_enumerationMutation(v13);
                }

                [*(*(&v19 + 1) + 8 * v17++) fixupServicesForReplacementAccessory:v12];
              }

              while (v15 != v17);
              v15 = [v13 countByEnumeratingWithState:&v19 objects:v27 count:16];
            }

            while (v15);
          }
        }

        ++v9;
      }

      while (v9 != v7);
      v7 = [v5 countByEnumeratingWithState:&v23 objects:v28 count:16];
    }

    while (v7);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (NSArray)accessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableDictionary *)self->_accessories allValues];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (HMDAccessory)currentAccessory
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 na_firstObjectPassingTest:&__block_literal_global_1187];

  return v3;
}

uint64_t __27__HMDHome_currentAccessory__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = v4;
  if (v4)
  {
    v6 = [v4 isCurrentAccessory];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)_handleRemoveZoneModel:(id)a3 message:(id)a4
{
  v35[5] = *MEMORY[0x277D85DE8];
  v27 = a3;
  v28 = a4;
  v29 = [v27 uuid];
  v6 = [(HMDHome *)self zoneWithUUID:v29];
  v7 = v6;
  if (v6)
  {
    v8 = [v6 name];
    v9 = [(HMDHome *)self removeName:v8];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_zones removeObject:v7];
    os_unfair_recursive_lock_unlock();
    v26 = [v28 transactionResult];
    [v26 markChanged];
    [v26 markSaveToAssistant];
    v34[0] = *MEMORY[0x277CD0640];
    v10 = [(HMDHome *)self uuid];
    v11 = [v10 UUIDString];
    v35[0] = v11;
    v34[1] = *MEMORY[0x277CD27B0];
    v12 = [v7 name];
    v35[1] = v12;
    v34[2] = *MEMORY[0x277CD27B8];
    v13 = [v7 uuid];
    v14 = [v13 UUIDString];
    v35[2] = v14;
    v34[3] = *MEMORY[0x277CD15F0];
    v15 = [v7 spiClientIdentifier];
    v16 = [v15 UUIDString];
    v35[3] = v16;
    v34[4] = *MEMORY[0x277CD15E8];
    v17 = [v7 urlString];
    v35[4] = v17;
    v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:5];

    logAndPostNotification(@"HMDZoneRemovedNotification", v7, v25);
    v18 = objc_autoreleasePoolPush();
    v19 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      v22 = [v7 name];
      *buf = 138543618;
      v31 = v21;
      v32 = 2112;
      v33 = v22;
      _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Removed zone: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
  }

  else
  {
    v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v28 respondWithError:v23];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveZone:(id)a3
{
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD27B8]];
  v6 = [(HMDHome *)self zoneWithUUID:v5];
  if (v6)
  {
    v7 = [HMDZoneModel alloc];
    v8 = [(HMDHome *)self uuid];
    v9 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v5 parentUUID:v8];

    v10 = [(HMDHome *)self backingStore];
    v11 = [v4 name];
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [v10 transaction:v11 options:v12];

    [v13 add:v9];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __29__HMDHome__handleRemoveZone___block_invoke;
    v14[3] = &unk_2797359D8;
    v15 = v4;
    [v13 run:v14];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v9];
  }
}

- (void)_handleAddZoneModel:(id)a3 message:(id)a4
{
  v35 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 name];
  v9 = [v8 hm_truncatedNameString];

  v28 = [v6 uuid];
  if (v9 && v28)
  {
    v10 = [[HMDZone alloc] initWithName:v9 uuid:v28 home:self];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_zones addObject:v10];
    os_unfair_recursive_lock_unlock();
    v11 = [(HMDHome *)self msgDispatcher];
    v12 = [(HMDHome *)self workQueue];
    [(HMDZone *)v10 configure:v11 queue:v12];

    [(HMDZone *)v10 updateZoneWithModel:v6 message:v7 error:0];
    v13 = [v7 transactionResult];
    [v13 markChanged];
    v14 = [(HMDZone *)v10 roomUUIDs];
    v15 = [v14 count];

    if (v15)
    {
      [v13 markSaveToAssistant];
    }

    v29[0] = *MEMORY[0x277CD0640];
    v16 = [(HMDHome *)self uuid];
    v17 = [v16 UUIDString];
    v18 = *MEMORY[0x277CD27B0];
    v30[0] = v17;
    v30[1] = v9;
    v19 = *MEMORY[0x277CD27B8];
    v29[1] = v18;
    v29[2] = v19;
    v20 = [(HMDZone *)v10 uuid];
    v21 = [v20 UUIDString];
    v30[2] = v21;
    v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:v29 count:3];

    logAndPostNotification(@"HMDZoneAddedNotification", v10, v22);
    [v7 respondWithPayload:0];
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    v24 = self;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v32 = v26;
      v33 = 2112;
      v34 = v9;
      _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; invalid parameter", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v7 respondWithError:v10];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddZone:(id)a3
{
  v47 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CD27B0]];
  v6 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
  v7 = v6;
  if (v5)
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (!v8)
  {
    v11 = HMMaxLengthForNaming();
    if ([v5 length] > v11)
    {
      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        v15 = HMFGetLogIdentifier();
        *buf = 138543362;
        v44 = v15;
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v12);
      v9 = MEMORY[0x277CCA9B8];
      v10 = 46;
      goto LABEL_11;
    }

    v16 = [(HMDHome *)self zoneWithName:v5];
    if (v16)
    {
      v17 = MEMORY[0x277CCA9B8];
      v18 = 1;
    }

    else
    {
      v19 = [(HMDHome *)self zones];
      v20 = [v19 count];
      v21 = maximumZonesPerHome;

      if (v20 < v21)
      {
        v22 = [(HMDHome *)self addName:v5];
        if (!v22)
        {
          v32 = [HMDZoneModel alloc];
          v33 = [(HMDHome *)self uuid];
          v34 = [(HMDBackingStoreModelObject *)v32 initWithObjectChangeType:1 uuid:v7 parentUUID:v33];

          [(HMDZoneModel *)v34 setName:v5];
          v35 = [(HMDHome *)self backingStore];
          v36 = [v4 name];
          v37 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v38 = [v35 transaction:v36 options:v37];

          [v38 add:v34];
          v39[0] = MEMORY[0x277D85DD0];
          v39[1] = 3221225472;
          v39[2] = __26__HMDHome__handleAddZone___block_invoke;
          v39[3] = &unk_279734D88;
          v40 = v4;
          v41 = v7;
          v42 = v5;
          [v38 run:v39];

          goto LABEL_24;
        }

        v23 = objc_autoreleasePoolPush();
        v24 = self;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          v26 = HMFGetLogIdentifier();
          *buf = 138543618;
          v44 = v26;
          v45 = 2112;
          v46 = v5;
          _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; invalid parameter", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
LABEL_23:
        [v4 respondWithError:v22];
LABEL_24:

        goto LABEL_25;
      }

      v27 = objc_autoreleasePoolPush();
      v28 = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543618;
        v44 = v30;
        v45 = 2112;
        v46 = v5;
        _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; already at maximum zones for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v27);
      v17 = MEMORY[0x277CCA9B8];
      v18 = 49;
    }

    v22 = [v17 hmErrorWithCode:v18];
    goto LABEL_23;
  }

  v9 = MEMORY[0x277CCA9B8];
  v10 = 20;
LABEL_11:
  v16 = [v9 hmErrorWithCode:v10];
  [v4 respondWithError:v16];
LABEL_25:

  v31 = *MEMORY[0x277D85DE8];
}

void __26__HMDHome__handleAddZone___block_invoke(uint64_t a1, uint64_t a2)
{
  v10[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v9[0] = *MEMORY[0x277CD27B8];
    v6 = [*(a1 + 40) UUIDString];
    v9[1] = *MEMORY[0x277CD27B0];
    v10[0] = v6;
    v10[1] = *(a1 + 48);
    v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v10 forKeys:v9 count:2];
    [v2 respondWithPayload:v7];

    v8 = *MEMORY[0x277D85DE8];
  }
}

- (void)test_addZones:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_zones addObjectsFromArray:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)zones
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_zones copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleRemoveRoomModel:(id)a3 message:(id)a4
{
  v67 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v50 = a4;
  v47 = v6;
  v48 = [v6 uuid];
  v7 = [(HMDHome *)self roomWithUUID:v48];
  v8 = v7;
  if (!v7)
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v50 respondWithError:v14];
    goto LABEL_6;
  }

  v9 = [v7 uuid];
  v10 = [(HMDHome *)self roomForEntireHome];
  v11 = [v10 uuid];
  v12 = [v9 isEqual:v11];

  if (v12)
  {
    v13 = [v50 responseHandler];

    if (v13)
    {
      v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:29];
      v15 = [v50 responseHandler];
      (v15)[2](v15, v14, 0);

LABEL_6:
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v49 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [v8 name];
      *buf = 138543618;
      v64 = v18;
      v65 = 2112;
      v66 = v19;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Remove room: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v61[0] = *MEMORY[0x277CD0640];
    v20 = [(HMDHome *)v49 uuid];
    v21 = [v20 UUIDString];
    v62[0] = v21;
    v61[1] = *MEMORY[0x277CD0D30];
    v22 = [v8 name];
    v62[1] = v22;
    v61[2] = *MEMORY[0x277CD0D40];
    v23 = [v48 UUIDString];
    v62[2] = v23;
    v61[3] = *MEMORY[0x277CD0D38];
    v24 = [v8 spiClientIdentifier];
    v25 = [v24 UUIDString];
    v62[3] = v25;
    v61[4] = *MEMORY[0x277CD0D28];
    v26 = [v8 urlString];
    v62[4] = v26;
    v46 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v62 forKeys:v61 count:5];

    logAndPostNotification(@"HMDRoomRemovedNotification", v8, v46);
    v57 = 0u;
    v58 = 0u;
    v55 = 0u;
    v56 = 0u;
    v27 = [(HMDHome *)v49 zones];
    v28 = [v27 countByEnumeratingWithState:&v55 objects:v60 count:16];
    if (v28)
    {
      v29 = *v56;
      do
      {
        for (i = 0; i != v28; ++i)
        {
          if (*v56 != v29)
          {
            objc_enumerationMutation(v27);
          }

          [*(*(&v55 + 1) + 8 * i) removeRoom:v8];
        }

        v28 = [v27 countByEnumeratingWithState:&v55 objects:v60 count:16];
      }

      while (v28);
    }

    v53 = 0u;
    v54 = 0u;
    v51 = 0u;
    v52 = 0u;
    v31 = [(HMDHome *)v49 accessories];
    v32 = [v31 countByEnumeratingWithState:&v51 objects:v59 count:16];
    if (v32)
    {
      v33 = *v52;
      do
      {
        for (j = 0; j != v32; ++j)
        {
          if (*v52 != v33)
          {
            objc_enumerationMutation(v31);
          }

          v35 = *(*(&v51 + 1) + 8 * j);
          v36 = [v8 uuid];
          v37 = [v35 room];
          v38 = [v37 uuid];
          v39 = [v36 isEqual:v38];

          if (v39)
          {
            v40 = [v50 transactionResult];
            v41 = [(HMDHome *)v49 roomForEntireHome];
            [v35 updateRoom:v41 source:{objc_msgSend(v40, "source")}];
          }
        }

        v32 = [v31 countByEnumeratingWithState:&v51 objects:v59 count:16];
      }

      while (v32);
    }

    v42 = [v8 name];
    v43 = [(HMDHome *)v49 removeName:v42];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)v49->_rooms removeObject:v8];
    os_unfair_recursive_lock_unlock();
    v44 = [v50 transactionResult];
    [v44 markChanged];
    [v44 markSaveToAssistant];
    [v50 respondWithPayload:v46];
  }

  v45 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveRoom:(id)a3
{
  v61 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 uuidForKey:*MEMORY[0x277CD0D40]];
  if (!v5)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v4 messagePayload];
      *buf = 138543618;
      v58 = v19;
      v59 = 2112;
      v60 = v20;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot find room UUID in remove room message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
    goto LABEL_9;
  }

  v6 = [(HMDHome *)self roomForEntireHome];
  v7 = [v6 uuid];
  v8 = [v5 isEqual:v7];

  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [(HMDHome *)v10 roomForEntireHome];
      *buf = 138543618;
      v58 = v12;
      v59 = 2112;
      v60 = v13;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle request to remove roomForEntireHome: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 29;
LABEL_9:
    v21 = [v14 hmErrorWithCode:v15];
    [v4 respondWithError:v21];
    goto LABEL_29;
  }

  v21 = [(HMDHome *)self roomWithUUID:v5];
  v22 = objc_autoreleasePoolPush();
  v51 = self;
  v23 = HMFGetOSLogHandle();
  v24 = v23;
  if (v21)
  {
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v25;
      v59 = 2112;
      v60 = v21;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Removing room: %@", buf, 0x16u);
    }

    v49 = v21;

    objc_autoreleasePoolPop(v22);
    v26 = [HMDRoomModel alloc];
    v27 = [(HMDHome *)v51 uuid];
    v28 = [(HMDBackingStoreModelObject *)v26 initWithObjectChangeType:3 uuid:v5 parentUUID:v27];

    v29 = [(HMDHome *)v51 backingStore];
    [v4 name];
    v31 = v30 = v4;
    v32 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v33 = [v29 transaction:v31 options:v32];

    v48 = v28;
    v50 = v30;
    [v33 add:v28 withMessage:v30];
    v54 = 0u;
    v55 = 0u;
    v52 = 0u;
    v53 = 0u;
    v34 = [(HMDHome *)v51 accessories];
    v35 = [v34 countByEnumeratingWithState:&v52 objects:v56 count:16];
    if (v35)
    {
      v36 = v35;
      v37 = *v53;
      do
      {
        for (i = 0; i != v36; ++i)
        {
          if (*v53 != v37)
          {
            objc_enumerationMutation(v34);
          }

          v39 = *(*(&v52 + 1) + 8 * i);
          v40 = [v39 room];
          v41 = [v40 uuid];
          v42 = [v5 isEqual:v41];

          if (v42)
          {
            v43 = [(HMDHome *)v51 roomForEntireHome];
            v44 = [v39 modelWithUpdatedRoom:v43];

            if (v44)
            {
              [v33 add:v44];
            }
          }
        }

        v36 = [v34 countByEnumeratingWithState:&v52 objects:v56 count:16];
      }

      while (v36);
    }

    [v33 run];
    v21 = v49;
    v4 = v50;
    v45 = v48;
  }

  else
  {
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v46;
      v59 = 2112;
      v60 = v5;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Could not find room to remove with UUID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v45 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v4 respondWithError:v45];
  }

LABEL_29:
  v47 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddRoomModel:(id)a3 message:(id)a4
{
  v40 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 name];
  v33 = [v6 uuid];
  if (v8 && v33)
  {
    v32 = [v8 hm_truncatedNameString];

    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v12;
      v38 = 2112;
      v39 = v32;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Add room: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v13 = [[HMDRoom alloc] initWithName:v32 uuid:v33 home:v10];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)v10->_rooms addObject:v13];
    os_unfair_recursive_lock_unlock();
    v14 = [(HMDHome *)v10 msgDispatcher];
    v15 = [(HMDHome *)v10 workQueue];
    [(HMDRoom *)v13 configure:v14 queue:v15];

    v16 = [v7 transactionResult];
    [v16 markChanged];
    [v16 markSaveToAssistant];
    v34[0] = *MEMORY[0x277CD0640];
    v17 = [(HMDHome *)v10 uuid];
    v18 = [v17 UUIDString];
    v19 = *MEMORY[0x277CD0D30];
    v35[0] = v18;
    v35[1] = v32;
    v20 = *MEMORY[0x277CD0D40];
    v34[1] = v19;
    v34[2] = v20;
    v21 = [(HMDRoom *)v13 uuid];
    v22 = [v21 UUIDString];
    v35[2] = v22;
    v23 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:3];

    logAndPostNotification(@"HMDRoomAddedNotification", v13, v23);
    [v7 respondWithPayload:v23];
    if ([(HMDHome *)v10 isOwnerUser])
    {
      v24 = [(HMDHome *)v10 home];
      v25 = [v24 homeManager];
      [v25 updateCurrentUserEligibleForOwnerToAutoMigration];
    }

    v8 = v32;
    goto LABEL_12;
  }

  v26 = objc_autoreleasePoolPush();
  v27 = self;
  v28 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
  {
    v29 = HMFGetLogIdentifier();
    *buf = 138543618;
    v37 = v29;
    v38 = 2112;
    v39 = v8;
    _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@; invalid parameter", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v26);
  v30 = [v7 responseHandler];

  if (v30)
  {
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v16 = [v7 responseHandler];
    (v16)[2](v16, v13, 0);
LABEL_12:
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddRoom:(id)a3
{
  v41 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CD0D30]];
  v6 = HMMaxLengthForNaming();
  if ([v5 length] <= v6)
  {
    v12 = [(HMDHome *)self roomWithName:v5];
    if (v12)
    {
      v11 = v12;
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:1];
      [v4 respondWithError:v13];

      goto LABEL_17;
    }

    v14 = [(HMDHome *)self rooms];
    v15 = [v14 count];
    v16 = maximumRoomsPerHome;

    if (v15 >= v16)
    {
      v22 = objc_autoreleasePoolPush();
      v23 = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        v25 = HMFGetLogIdentifier();
        v35 = 138543618;
        v36 = v25;
        v37 = 2112;
        v38 = v5;
        _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@ to home; already at maximum rooms for home", &v35, 0x16u);
      }

      objc_autoreleasePoolPop(v22);
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    }

    else
    {
      v17 = [(HMDHome *)self addName:v5];
      if (!v17)
      {
        v27 = [HMDRoomModel alloc];
        v28 = [v4 uuidForKey:*MEMORY[0x277CD0B10]];
        v29 = [(HMDHome *)self uuid];
        v30 = [(HMDBackingStoreModelObject *)v27 initWithObjectChangeType:1 uuid:v28 parentUUID:v29];

        [(HMDRoomModel *)v30 setName:v5];
        v31 = [(HMDHome *)self backingStore];
        v32 = [v4 name];
        v33 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v34 = [v31 transaction:v32 options:v33];

        [v34 add:v30 withMessage:v4];
        [v34 run];

        goto LABEL_16;
      }

      v18 = objc_autoreleasePoolPush();
      v19 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        v35 = 138543874;
        v36 = v21;
        v37 = 2112;
        v38 = v5;
        v39 = 2112;
        v40 = v17;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@ to home; namespace error %@", &v35, 0x20u);
      }

      objc_autoreleasePoolPop(v18);
    }

    [v4 respondWithError:v17];
LABEL_16:

    v11 = 0;
    goto LABEL_17;
  }

  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v35 = 138543362;
    v36 = v10;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v35, 0xCu);
  }

  objc_autoreleasePoolPop(v7);
  v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
  [v4 respondWithError:v11];
LABEL_17:

  v26 = *MEMORY[0x277D85DE8];
}

- (void)test_addRooms:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_rooms addObjectsFromArray:v4];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)rooms
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_rooms copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleHomeDataRequest:(id)a3
{
  v3 = MEMORY[0x277CCA9B8];
  v4 = a3;
  v5 = [v3 hmErrorWithCode:48];
  [v4 respondWithError:v5];
}

- (id)_handleRenameHomeModel:(id)a3 message:(id)a4
{
  v24[2] = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = [a3 name];
  v8 = [v7 hm_truncatedNameString];

  if (v8 && [v8 length])
  {
    v9 = [v6 transactionResult];
    v10 = [v9 label];
    v11 = [v10 isEqualToString:*MEMORY[0x277CD2540]];

    if ((v11 & 1) == 0)
    {
      v12 = [(HMDHome *)self homeManager];
      v13 = [(HMDHome *)self name];
      v14 = [v12 uuid];
      v24[0] = v14;
      v15 = [(HMDHome *)self uuid];
      v24[1] = v15;
      v16 = [MEMORY[0x277CBEA60] arrayWithObjects:v24 count:2];
      v17 = [v12 replaceName:v13 withNewName:v8 inNamespaces:v16];
    }

    [(HMDHome *)self setName:v8];
    v22 = @"HMDHomeNameNotificationKey";
    v23 = v8;
    v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v23 forKeys:&v22 count:1];
    logAndPostNotification(@"HMDHomeNameChangedNotification", self, v18);

    v19 = 0;
  }

  else
  {
    v19 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
  }

  v20 = *MEMORY[0x277D85DE8];

  return v19;
}

- (void)_handleRename:(id)a3
{
  v35 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CD23D0]];
  v6 = HMMaxLengthForNaming();
  if ([v5 length] <= v6)
  {
    v11 = [(HMDHome *)self homeManager];
    v12 = [(HMDHome *)self name];
    v13 = [v11 uuid];
    v32[0] = v13;
    v14 = [(HMDHome *)self uuid];
    v32[1] = v14;
    v15 = [MEMORY[0x277CBEA60] arrayWithObjects:v32 count:2];
    v16 = [v11 replaceName:v12 withNewName:v5 inNamespaces:v15];

    if (v16)
    {
      if ([(HMDHomeModel *)v16 code]== 31)
      {
        v17 = MEMORY[0x277CCA9B8];
        v18 = *MEMORY[0x277CCFD28];
        v19 = [(HMDHomeModel *)v16 userInfo];
        v20 = [v17 errorWithDomain:v18 code:32 userInfo:v19];

        v16 = v20;
      }

      [v4 respondWithError:v16];
    }

    else
    {
      v21 = [HMDHomeModel alloc];
      v22 = [(HMDHome *)self uuid];
      v23 = [v11 uuid];
      v16 = [(HMDBackingStoreModelObject *)v21 initWithObjectChangeType:2 uuid:v22 parentUUID:v23];

      [(HMDHomeModel *)v16 setName:v5];
      v24 = [(HMDHome *)self backingStore];
      v25 = [v4 name];
      v26 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v27 = [v24 transaction:v25 options:v26];

      [v27 add:v16];
      v29[0] = MEMORY[0x277D85DD0];
      v29[1] = 3221225472;
      v29[2] = __25__HMDHome__handleRename___block_invoke;
      v29[3] = &unk_2797358C8;
      v30 = v4;
      v31 = v5;
      [v27 run:v29];
    }
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v34 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
    [v4 respondWithError:v11];
  }

  v28 = *MEMORY[0x277D85DE8];
}

void __25__HMDHome__handleRename___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v5 = *(a1 + 40);
    v8 = *MEMORY[0x277CD23D0];
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [v2 respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (id)_unexpectedCharacteristicsFromCharacteristicNotifications:(id)a3
{
  v88 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self notificationRegistrations];
  v6 = [v5 count];

  if (v6)
  {
    v7 = MEMORY[0x277CBEBF8];
    goto LABEL_37;
  }

  v8 = [MEMORY[0x277CBEB18] array];
  context = objc_autoreleasePoolPush();
  v9 = [v4 allKeys];
  v76[0] = MEMORY[0x277D85DD0];
  v76[1] = 3221225472;
  v76[2] = __69__HMDHome__unexpectedCharacteristicsFromCharacteristicNotifications___block_invoke;
  v76[3] = &unk_279722260;
  v42 = v4;
  v45 = v4;
  v77 = v45;
  v78 = self;
  v40 = v9;
  v10 = [v9 na_map:v76];
  v74 = 0;
  v75 = 0;
  [(HMDHome *)self _notificationPayloadsForRemoteGateway:v10 accessories:&v75 enableCharacteristicNotificationPayload:0 characteristicNotificationThresholdsPayload:&v74 disableCharacteristicNotificationPayload:0 enableMediaNotificationPayload:0 disableMediaNotificationPayload:?];
  v47 = v75;
  v46 = v74;
  v70 = 0u;
  v71 = 0u;
  v72 = 0u;
  v73 = 0u;
  obj = v10;
  v48 = [obj countByEnumeratingWithState:&v70 objects:v87 count:16];
  if (!v48)
  {
    goto LABEL_36;
  }

  v44 = *v71;
  v56 = self;
  v55 = v8;
  do
  {
    v11 = 0;
    do
    {
      if (*v71 != v44)
      {
        objc_enumerationMutation(obj);
      }

      v49 = v11;
      v12 = *(*(&v70 + 1) + 8 * v11);
      v13 = [v12 uuid];
      v14 = [v13 UUIDString];

      v52 = [v45 hmf_dictionaryForKey:v14];
      v61 = [v47 hmf_arrayForKey:v14];
      v57 = v14;
      v58 = [v46 hmf_arrayForKey:v14];
      v66 = 0u;
      v67 = 0u;
      v68 = 0u;
      v69 = 0u;
      v50 = [v12 services];
      v53 = [v50 countByEnumeratingWithState:&v66 objects:v86 count:16];
      if (v53)
      {
        v51 = *v67;
        do
        {
          for (i = 0; i != v53; ++i)
          {
            if (*v67 != v51)
            {
              objc_enumerationMutation(v50);
            }

            v16 = *(*(&v66 + 1) + 8 * i);
            v17 = [v16 instanceID];
            v18 = [v17 stringValue];
            v19 = [v52 hmf_dictionaryForKey:v18];

            if (v19)
            {
              v54 = i;
              v64 = 0u;
              v65 = 0u;
              v62 = 0u;
              v63 = 0u;
              v60 = [v16 characteristics];
              v20 = [v60 countByEnumeratingWithState:&v62 objects:v85 count:16];
              if (!v20)
              {
                goto LABEL_31;
              }

              v21 = v20;
              v22 = *v63;
              v59 = v19;
              while (1)
              {
                for (j = 0; j != v21; ++j)
                {
                  if (*v63 != v22)
                  {
                    objc_enumerationMutation(v60);
                  }

                  v24 = *(*(&v62 + 1) + 8 * j);
                  v25 = [v24 instanceID];
                  v26 = [v25 stringValue];
                  v27 = [v19 objectForKey:v26];

                  if (v27)
                  {
                    if ([v61 containsObject:v25])
                    {
                      v28 = objc_autoreleasePoolPush();
                      v29 = self;
                      v30 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
                      {
                        v31 = HMFGetLogIdentifier();
                        v32 = [v24 shortDescription];
                        *buf = 138543874;
                        v80 = v31;
                        v81 = 2112;
                        v82 = v32;
                        v83 = 2112;
                        v84 = v57;
                        _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_DEBUG, "%{public}@Received persistent characteristic changed notification for characteristic (%@), accessoryUUID %@", buf, 0x20u);

                        self = v56;
                      }

                      objc_autoreleasePoolPop(v28);
                    }

                    else
                    {
                      if (![v58 containsObject:v25])
                      {
                        goto LABEL_29;
                      }

                      v33 = objc_autoreleasePoolPush();
                      v34 = self;
                      v35 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
                      {
                        v36 = HMFGetLogIdentifier();
                        v37 = [v24 shortDescription];
                        *buf = 138543874;
                        v80 = v36;
                        v81 = 2112;
                        v82 = v37;
                        v83 = 2112;
                        v84 = v57;
                        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_ERROR, "%{public}@Received unexpected characteristic changed notification for characteristic (%@), accessoryUUID %@", buf, 0x20u);

                        v8 = v55;
                        self = v56;
                      }

                      objc_autoreleasePoolPop(v33);
                      [v8 addObject:v24];
                    }

                    v19 = v59;
                  }

LABEL_29:
                }

                v21 = [v60 countByEnumeratingWithState:&v62 objects:v85 count:16];
                if (!v21)
                {
LABEL_31:

                  i = v54;
                  break;
                }
              }
            }
          }

          v53 = [v50 countByEnumeratingWithState:&v66 objects:v86 count:16];
        }

        while (v53);
      }

      v11 = v49 + 1;
    }

    while (v49 + 1 != v48);
    v48 = [obj countByEnumeratingWithState:&v70 objects:v87 count:16];
  }

  while (v48);
LABEL_36:

  objc_autoreleasePoolPop(context);
  v7 = [v8 copy];

  v4 = v42;
LABEL_37:

  v38 = *MEMORY[0x277D85DE8];

  return v7;
}

id __69__HMDHome__unexpectedCharacteristicsFromCharacteristicNotifications___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) objectForKeyedSubscript:v3];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  v6 = 0;
  if ((isKindOfClass & 1) != 0 && v4)
  {
    v7 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v3];
    v8 = [*(a1 + 40) accessoryWithUUID:v7];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v6 = v9;
  }

  return v6;
}

- (void)_notificationPayloadsForRemoteGateway:(void *)a3 accessories:(void *)a4 enableCharacteristicNotificationPayload:(void *)a5 characteristicNotificationThresholdsPayload:(void *)a6 disableCharacteristicNotificationPayload:(void *)a7 enableMediaNotificationPayload:(void *)a8 disableMediaNotificationPayload:
{
  v185 = *MEMORY[0x277D85DE8];
  v118 = a3;
  if (a1)
  {
    v9 = [MEMORY[0x277CBEB18] array];
    v168 = 0u;
    v169 = 0u;
    v170 = 0u;
    v171 = 0u;
    obj = [a1 triggers];
    v10 = [obj countByEnumeratingWithState:&v168 objects:v184 count:16];
    v137 = v9;
    v138 = a1;
    if (v10)
    {
      v11 = v10;
      v12 = *v169;
      v139 = *v169;
      do
      {
        v13 = 0;
        context = v11;
        do
        {
          if (*v169 != v12)
          {
            objc_enumerationMutation(obj);
          }

          v14 = *(*(&v168 + 1) + 8 * v13);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v15 = v14;
          }

          else
          {
            v15 = 0;
          }

          v16 = v15;

          if ([v16 shouldActivateOnLocalDevice])
          {
            v147 = v16;
            v149 = v13;
            v166 = 0u;
            v167 = 0u;
            v164 = 0u;
            v165 = 0u;
            v17 = [v16 characteristicEvents];
            v18 = [v17 countByEnumeratingWithState:&v164 objects:v183 count:16];
            if (v18)
            {
              v19 = v18;
              v20 = *v165;
              do
              {
                for (i = 0; i != v19; ++i)
                {
                  if (*v165 != v20)
                  {
                    objc_enumerationMutation(v17);
                  }

                  v22 = *(*(&v164 + 1) + 8 * i);
                  v23 = [v22 characteristic];

                  if (v23)
                  {
                    v24 = [v22 characteristic];
                    v9 = v137;
                    [v137 addObject:v24];
                  }

                  else
                  {
                    v25 = objc_autoreleasePoolPush();
                    v26 = a1;
                    v27 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
                    {
                      v28 = HMFGetLogIdentifier();
                      *buf = 138543618;
                      *&buf[4] = v28;
                      *&buf[12] = 2112;
                      *&buf[14] = v22;
                      _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Characteristic of HMDCharacteristicEvent %@ is nil!", buf, 0x16u);
                    }

                    objc_autoreleasePoolPop(v25);
                    v9 = v137;
                    a1 = v138;
                  }
                }

                v19 = [v17 countByEnumeratingWithState:&v164 objects:v183 count:16];
              }

              while (v19);
            }

            v12 = v139;
            v11 = context;
            v16 = v147;
            v13 = v149;
          }

          ++v13;
        }

        while (v13 != v11);
        v11 = [obj countByEnumeratingWithState:&v168 objects:v184 count:16];
      }

      while (v11);
    }

    v29 = 0x277CBE000uLL;
    v123 = [MEMORY[0x277CBEB38] dictionary];
    v121 = [MEMORY[0x277CBEB38] dictionary];
    v122 = [MEMORY[0x277CBEB38] dictionary];
    if (a7)
    {
      v119 = [MEMORY[0x277CBEB38] dictionary];
    }

    else
    {
      v119 = 0;
    }

    if (a8)
    {
      v115 = [MEMORY[0x277CBEB38] dictionary];
    }

    else
    {
      v115 = 0;
    }

    v30 = 0x277CBE000uLL;
    v162 = 0u;
    v163 = 0u;
    v160 = 0u;
    v161 = 0u;
    v124 = v118;
    v127 = [v124 countByEnumeratingWithState:&v160 objects:v182 count:16];
    if (v127)
    {
      v31 = v119;
      if (!a2)
      {
        v31 = v115;
      }

      v120 = v31;
      v126 = *v161;
      obja = *MEMORY[0x277CFE810];
      do
      {
        for (j = 0; j != v127; ++j)
        {
          if (*v161 != v126)
          {
            objc_enumerationMutation(v124);
          }

          v33 = *(*(&v160 + 1) + 8 * j);
          v34 = [*(v30 + 2840) array];
          v135 = [*(v30 + 2840) array];
          v136 = [*(v29 + 2872) dictionary];
          v35 = v33;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v36 = v35;
          }

          else
          {
            v36 = 0;
          }

          v37 = v36;

          v38 = v35;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v39 = v38;
          }

          else
          {
            v39 = 0;
          }

          v40 = v39;
          v129 = v38;

          v130 = v37;
          if (v37)
          {
            v128 = j;
            if (!shouldSkipRemoteAccessoryNotificationRegistration(a1, v37))
            {
              v125 = v40;
              v140 = v34;
              v158 = 0u;
              v159 = 0u;
              v156 = 0u;
              v157 = 0u;
              v131 = [v37 services];
              v133 = [v131 countByEnumeratingWithState:&v156 objects:v180 count:16];
              if (v133)
              {
                v132 = *v157;
                do
                {
                  v52 = 0;
                  do
                  {
                    if (*v157 != v132)
                    {
                      objc_enumerationMutation(v131);
                    }

                    v134 = v52;
                    v53 = *(*(&v156 + 1) + 8 * v52);
                    v151 = [v53 type];
                    v152 = 0u;
                    v153 = 0u;
                    v154 = 0u;
                    v155 = 0u;
                    v54 = [v53 characteristics];
                    v55 = [v54 countByEnumeratingWithState:&v152 objects:v179 count:16];
                    if (v55)
                    {
                      v56 = v55;
                      v57 = *v153;
                      v148 = *v153;
                      v150 = v54;
                      do
                      {
                        v58 = 0;
                        do
                        {
                          if (*v153 != v57)
                          {
                            objc_enumerationMutation(v54);
                          }

                          v59 = *(*(&v152 + 1) + 8 * v58);
                          if ([v59 supportsNotification])
                          {
                            v60 = [a1 dataSource];
                            v61 = [v60 hapMetadata];
                            v62 = [v61 shouldFilterEnableNotificationsForCharacteristicType:0 serviceType:v151];

                            if ((v62 & 1) == 0)
                            {
                              if ([v151 isEqualToString:obja])
                              {
                                v63 = [v59 type];
                                v64 = [v63 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"];
                              }

                              else
                              {
                                v64 = 0;
                              }

                              v65 = [a1 dataSource];
                              v66 = [v65 hapMetadata];
                              v67 = [v59 type];
                              v68 = [v66 shouldAutoEnableNotificationForCharacteristic:v67 ofService:v151];

                              v69 = [v59 isNonHomeNotificationsEnabled];
                              if (([v9 containsObject:v59] & 1) != 0 || (v69 & 1) != 0 || (v68 & 1) != 0 || v64)
                              {
                                contexta = objc_autoreleasePoolPush();
                                v75 = a1;
                                v76 = HMFGetOSLogHandle();
                                if (os_log_type_enabled(v76, OS_LOG_TYPE_DEBUG))
                                {
                                  v77 = HMFGetLogIdentifier();
                                  v78 = HMFBooleanToString();
                                  v79 = HMFBooleanToString();
                                  v80 = HMFBooleanToString();
                                  v81 = HMFBooleanToString();
                                  *buf = 138544642;
                                  *&buf[4] = v77;
                                  *&buf[12] = 2112;
                                  *&buf[14] = v59;
                                  *&buf[22] = 2112;
                                  *&buf[24] = v78;
                                  v173 = 2112;
                                  v174 = v79;
                                  v175 = 2112;
                                  v176 = v80;
                                  v177 = 2112;
                                  v178 = v81;
                                  _os_log_impl(&dword_2531F8000, v76, OS_LOG_TYPE_DEBUG, "%{public}@Enabling characteristic %@ because characteristicInEvent: %@ nonHomeNotificationsEnabled: %@ autoEnableNotification: %@ accessoryFlags: %@", buf, 0x3Eu);

                                  v9 = v137;
                                }

                                objc_autoreleasePoolPop(contexta);
                                v82 = [v59 changeThresholdForNonHomeClientEnabledNotifications];
                                v83 = [v75 dataSource];
                                v84 = [v83 hapMetadata];
                                v85 = [v59 type];
                                v86 = [v84 shouldEnableHomeNotificationForCharacteristicType:v85 serviceType:v151];

                                if (v82 && (v86 & a2 & 1) == 0)
                                {
                                  v87 = [v59 instanceID];
                                  v88 = [v87 stringValue];
                                  [v136 setObject:v82 forKeyedSubscript:v88];
                                }

                                v89 = [v59 instanceID];
                                [v140 addObject:v89];

                                a1 = v138;
                                v57 = v148;
                                v54 = v150;
                              }

                              else if (a2)
                              {
                                v70 = [v59 type];
                                v71 = [a1 dataSource];
                                v72 = [v71 hapMetadata];
                                v73 = [v72 shouldEnableHomeNotificationForCharacteristicType:v70 serviceType:v151];

                                v57 = v148;
                                if (v73)
                                {
                                  v74 = [v59 instanceID];
                                  [v140 addObject:v74];
                                }

                                v54 = v150;
                              }

                              else
                              {
                                v57 = v148;
                                v54 = v150;
                                if ([v59 isClientNotificationEnabled])
                                {
                                  v90 = objc_autoreleasePoolPush();
                                  v91 = a1;
                                  v92 = HMFGetOSLogHandle();
                                  if (os_log_type_enabled(v92, OS_LOG_TYPE_DEFAULT))
                                  {
                                    v93 = HMFGetLogIdentifier();
                                    v94 = [v59 notificationRegistrations];
                                    *buf = 138543874;
                                    *&buf[4] = v93;
                                    *&buf[12] = 2112;
                                    *&buf[14] = v59;
                                    *&buf[22] = 2112;
                                    *&buf[24] = v94;
                                    _os_log_impl(&dword_2531F8000, v92, OS_LOG_TYPE_DEFAULT, "%{public}@Not disabling characteristic %@ because client(s) are registered: %@", buf, 0x20u);

                                    v57 = v148;
                                    v54 = v150;
                                  }

                                  objc_autoreleasePoolPop(v90);
                                }

                                else
                                {
                                  v95 = [v59 instanceID];
                                  [v135 addObject:v95];
                                }
                              }
                            }
                          }

                          ++v58;
                        }

                        while (v56 != v58);
                        v96 = [v54 countByEnumeratingWithState:&v152 objects:v179 count:16];
                        v56 = v96;
                      }

                      while (v96);
                    }

                    v52 = v134 + 1;
                  }

                  while (v134 + 1 != v133);
                  v133 = [v131 countByEnumeratingWithState:&v156 objects:v180 count:16];
                }

                while (v133);
              }

              v97 = [v129 uuid];
              v98 = [v97 UUIDString];

              if ([v140 count])
              {
                v99 = [v140 copy];
                [v123 setObject:v99 forKeyedSubscript:v98];
              }

              v30 = 0x277CBE000;
              v29 = 0x277CBE000;
              j = v128;
              if ([v136 count])
              {
                v100 = [v136 copy];
                [v121 setObject:v100 forKeyedSubscript:v98];
              }

              v40 = v125;
              if ([v135 count])
              {
                v101 = [v135 copy];
                [v122 setObject:v101 forKeyedSubscript:v98];
              }

LABEL_101:
              v34 = v140;
              goto LABEL_111;
            }

            v41 = objc_autoreleasePoolPush();
            v42 = a1;
            v43 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
            {
              v44 = HMFGetLogIdentifier();
              *&buf[8] = 0;
              *buf = 0;
              v45 = [v130 uuid];

              if (v45)
              {
                v46 = [v130 uuid];
                [v46 getUUIDBytes:buf];
              }

              else
              {
                *buf = *MEMORY[0x277D0F960];
              }

              v181 = *buf;
              *buf = 138543874;
              *&buf[4] = v44;
              *&buf[12] = 1040;
              *&buf[14] = 16;
              *&buf[18] = 2096;
              *&buf[20] = &v181;
              _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Dropping all characteristics for %{uuid_t}.16P from remote notification as partitioned network is no longer supported by residents", buf, 0x1Cu);

              v30 = 0x277CBE000;
              v29 = 0x277CBE000;
            }

            objc_autoreleasePoolPop(v41);
            j = v128;
          }

          else
          {
            if (!v40)
            {
              goto LABEL_111;
            }

            if ([a1 isCurrentDeviceAvailableResident])
            {
              v140 = v34;
              v47 = j;
              v48 = objc_autoreleasePoolPush();
              v49 = a1;
              v50 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
              {
                v51 = HMFGetLogIdentifier();
                *buf = 138543618;
                *&buf[4] = v51;
                *&buf[12] = 2112;
                *&buf[14] = v40;
                _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_INFO, "%{public}@Skipping generating media notification payload for apple media accessory because current device is a resident: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v48);
              j = v47;
              goto LABEL_101;
            }

            v102 = [v40 mediaProfile];
            if (v102)
            {
              v103 = [(HMDHome *)a1 mediaNotificationPayloadForProfile:v102];
              [v120 addEntriesFromDictionary:v103];
            }

            else
            {
              v141 = v34;
              v104 = j;
              v105 = objc_autoreleasePoolPush();
              v106 = a1;
              v107 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v107, OS_LOG_TYPE_INFO))
              {
                v108 = HMFGetLogIdentifier();
                *buf = 138543618;
                *&buf[4] = v108;
                *&buf[12] = 2112;
                *&buf[14] = v40;
                _os_log_impl(&dword_2531F8000, v107, OS_LOG_TYPE_INFO, "%{public}@Skipping generating media notification payload for accessory with no media profile: %@", buf, 0x16u);

                v30 = 0x277CBE000;
              }

              objc_autoreleasePoolPop(v105);
              j = v104;
              v34 = v141;
            }
          }

LABEL_111:
        }

        v127 = [v124 countByEnumeratingWithState:&v160 objects:v182 count:16];
      }

      while (v127);
    }

    v109 = [v123 copy];
    v110 = a5;
    *a4 = v109;
    if (a5)
    {
      *v110 = [v121 copy];
    }

    *a6 = [v122 copy];
    if (a7)
    {
      *a7 = [v119 copy];
    }

    if (a8)
    {
      *a8 = [v115 copy];
    }
  }

  v111 = *MEMORY[0x277D85DE8];
}

- (void)_updateWoWState:(id)a3
{
  v21 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        v10 = [v9 identifier];
        v11 = [v9 matchingHAPAccessoryWithServerIdentifier:v10 linkType:1];

        if ([v9 isReachable])
        {
          v12 = v11 == 0;
        }

        else
        {
          v12 = 1;
        }

        if (v12 || ![v9 isNonClientNotificationEnabled])
        {
          v13 = [(HMDHome *)self dataSource];
          v14 = [v13 netManager];
          [v14 deregisterWoWAssertionForObject:v9];
        }

        else
        {
          v13 = [(HMDHome *)self dataSource];
          v14 = [v13 netManager];
          [v14 registerWoWAssertionForObject:v9];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_registerForNotifications
{
  v8 = [(HMDHome *)self notificationCenter];
  v3 = [(HMDHome *)self homeManager];
  v4 = [v3 connectionsManager];
  [v8 addObserver:self selector:sel_handleFirstProcessDidBecomeActiveNotification_ name:@"HMDHomeManagerFirstProcessDidBecomeActiveNotification" object:v4];

  v5 = [v3 connectionsManager];
  [v8 addObserver:self selector:sel_handleLastProcessDidBecomeInactiveNotification_ name:@"HMDHomeManagerLastProcessDidBecomeInactiveNotification" object:v5];

  [v8 addObserver:self selector:sel_handleClientProcessDisconnectedNotification_ name:@"HMDHomeManagerClientProcessDisconnectedNotification" object:0];
  [v8 addObserver:self selector:sel_handleAccessoryDidAddNetworkRouterControllerNotification_ name:@"HMDAccessoryDidAddNetworkRouterControllerNotification" object:self];
  [v8 addObserver:self selector:sel_handleAccessoryDidRemoveNetworkRouterControllerNotification_ name:@"HMDAccessoryDidRemoveNetworkRouterControllerNotification" object:self];
  v6 = [(HMDHome *)self currentUser];
  [v8 addObserver:self selector:sel_handleCurrentUserPrivilegeChanged_ name:@"HMDUserPrivilegeDidChangeNotification" object:v6];

  v7 = +[HMDAppleAccountManager sharedManager];
  [v8 addObserver:self selector:sel_handleActiveAccountChanged_ name:@"HMDAppleAccountManagerAccountUpdatedNotification" object:v7];

  [v8 addObserver:self selector:sel_handleAccountHandlesUpdated_ name:@"HMDAccountHandlesUpdatedNotification" object:0];
  [v8 addObserver:self selector:sel___handleProcessStateChange_ name:HMDProcessMonitorProcessStateDidChangeNotification object:0];
  [v8 addObserver:self selector:sel_handleAccessoryReachabilityChangeNotification_ name:@"HMDAccessoryIsReachableNotification" object:0];
  [v8 addObserver:self selector:sel_handleAccessoryReachabilityChangeNotification_ name:@"HMDAccessoryIsNotReachableNotification" object:0];
  [v8 addObserver:self selector:sel_handleRemovedMediaSessions_ name:@"HMDMediaSessionsRemovedNotification" object:0];
  [v8 addObserver:self selector:sel_handleXPCConnectionInvalidated_ name:@"HMDXPCClientConnectionDidInvalidateNotification" object:0];
  [v8 addObserver:self selector:sel_handleDeviceCapabilitiesUpdated_ name:@"HMDDeviceCapabilitiiesUpdatedNotification" object:0];
  [v8 addObserver:self selector:sel_handlePrimaryResidentChangeNotification_ name:@"HMDResidentDeviceConfirmedStateChangedNotification" object:0];
  if (isiOSDevice())
  {
    [v8 addObserver:self selector:sel_handleDidReceiveIDSMessageWithNoListener_ name:@"HMDDidReceiveRemoteMessageWithNoListenerNotification" object:0];
  }

  [v8 addObserver:self selector:sel_handleSiriEndPointAddedNotification_ name:@"HMDSiriEndpointProfileAddedNotification" object:0];
  [v8 addObserver:self selector:sel_handleRemoteDeviceBecameReachableNotification_ name:@"HMDRemoteDeviceIsReachableNotification" object:0];
}

- (void)_registerForMessages
{
  v504[2] = *MEMORY[0x277D85DE8];
  v3 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:3 remoteAccessRequired:0];
  v411 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:0 remoteAccessRequired:0];
  v410 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:0 remoteAccessRequired:1];
  v4 = [(HMDHome *)self administratorHandler];
  v5 = *MEMORY[0x277CD2540];
  v6 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v504[0] = v6;
  v7 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v504[1] = v7;
  v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v504 count:2];
  [v4 registerForMessage:v5 receiver:self policies:v8 selector:sel__handleRename_];

  v9 = [(HMDHome *)self msgDispatcher];
  v10 = *MEMORY[0x277CD1208];
  v11 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v503 = v11;
  v12 = [MEMORY[0x277CBEA60] arrayWithObjects:&v503 count:1];
  [v9 registerForMessage:v10 receiver:self policies:v12 selector:sel__handleHomeDataRequest_];

  v13 = [(HMDHome *)self administratorHandler];
  v14 = *MEMORY[0x277CCF1F8];
  v15 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v502[0] = v15;
  v16 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v502[1] = v16;
  v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v502 count:2];
  [v13 registerForMessage:v14 receiver:self policies:v17 selector:sel__handleAddRoom_];

  v18 = [(HMDHome *)self administratorHandler];
  v19 = *MEMORY[0x277CD0CA0];
  v20 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v501[0] = v20;
  v21 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v501[1] = v21;
  v22 = [MEMORY[0x277CBEA60] arrayWithObjects:v501 count:2];
  [v18 registerForMessage:v19 receiver:self policies:v22 selector:sel__handleRemoveRoom_];

  v23 = [(HMDHome *)self administratorHandler];
  v24 = *MEMORY[0x277CD20B0];
  v25 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v500[0] = v25;
  v26 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v500[1] = v26;
  v27 = [MEMORY[0x277CBEA60] arrayWithObjects:v500 count:2];
  [v23 registerForMessage:v24 receiver:self policies:v27 selector:sel__handleAddZone_];

  v28 = [(HMDHome *)self administratorHandler];
  v29 = *MEMORY[0x277CD2530];
  v30 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v499[0] = v30;
  v31 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v499[1] = v31;
  v32 = [MEMORY[0x277CBEA60] arrayWithObjects:v499 count:2];
  [v28 registerForMessage:v29 receiver:self policies:v32 selector:sel__handleRemoveZone_];

  v33 = [(HMDHome *)self administratorHandler];
  v34 = *MEMORY[0x277CD20A0];
  v35 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v498[0] = v35;
  v36 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v498[1] = v36;
  v37 = [MEMORY[0x277CBEA60] arrayWithObjects:v498 count:2];
  [v33 registerForMessage:v34 receiver:self policies:v37 selector:sel__handleAddServiceGroup_];

  v38 = [(HMDHome *)self administratorHandler];
  v39 = *MEMORY[0x277CD2520];
  v40 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v497[0] = v40;
  v41 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v497[1] = v41;
  v42 = [MEMORY[0x277CBEA60] arrayWithObjects:v497 count:2];
  [v38 registerForMessage:v39 receiver:self policies:v42 selector:sel__handleRemoveServiceGroup_];

  v43 = [(HMDHome *)self administratorHandler];
  v44 = *MEMORY[0x277CD2078];
  v45 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v496[0] = v45;
  v46 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v496[1] = v46;
  v47 = [MEMORY[0x277CBEA60] arrayWithObjects:v496 count:2];
  [v43 registerForMessage:v44 receiver:self policies:v47 selector:sel__handleAddActionSet_];

  v48 = [(HMDHome *)self administratorHandler];
  v49 = *MEMORY[0x277CD24F8];
  v50 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v495[0] = v50;
  v51 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v495[1] = v51;
  v52 = [MEMORY[0x277CBEA60] arrayWithObjects:v495 count:2];
  [v48 registerForMessage:v49 receiver:self policies:v52 selector:sel__handleRemoveActionSet_];

  v53 = [(HMDHome *)self administratorHandler];
  v54 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v494[0] = v54;
  v55 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v494[1] = v55;
  v56 = [MEMORY[0x277CBEA60] arrayWithObjects:v494 count:2];
  [v53 registerForMessage:@"kRemoveTriggerRequestKey" receiver:self policies:v56 selector:sel__handleRemoveTrigger_];

  v57 = [(HMDHome *)self administratorHandler];
  v58 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v493[0] = v58;
  v59 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v493[1] = v59;
  v60 = [MEMORY[0x277CBEA60] arrayWithObjects:v493 count:2];
  [v57 registerForMessage:@"kUpdateUserAccessRequestKey" receiver:self policies:v60 selector:sel__handleUpdateUserAccess_];

  v61 = [(HMDHome *)self administratorHandler];
  v62 = *MEMORY[0x277CD2788];
  v63 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v492[0] = v63;
  v64 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v492[1] = v64;
  v409 = v3;
  v492[2] = v3;
  v65 = [MEMORY[0x277CBEA60] arrayWithObjects:v492 count:3];
  [v61 registerForMessage:v62 receiver:self policies:v65 selector:sel__handleUpdateUserCamerasAccessLevel_];

  v66 = [(HMDHome *)self administratorHandler];
  v67 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v491[0] = v67;
  v68 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v491[1] = v68;
  v69 = [MEMORY[0x277CBEA60] arrayWithObjects:v491 count:2];
  [v66 registerForMessage:@"kRemoveUserRequestKey" receiver:self policies:v69 selector:sel__handleRemoveUser_];

  v70 = [(HMDHome *)self administratorHandler];
  v71 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v490[0] = v71;
  v72 = [HMDConfigurationMessagePolicy policyWithOperationTypes:7];
  v490[1] = v72;
  v73 = [MEMORY[0x277CBEA60] arrayWithObjects:v490 count:2];
  [v70 registerForMessage:@"kSetAppDataRequestKey" receiver:self policies:v73 selector:sel__handleSetAppData_];

  v74 = [(HMDHome *)self administratorHandler];
  v75 = *MEMORY[0x277CD0678];
  v76 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v489[0] = v76;
  v77 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v489[1] = v77;
  v78 = [MEMORY[0x277CBEA60] arrayWithObjects:v489 count:2];
  [v74 registerForMessage:v75 receiver:self policies:v78 selector:sel__handleUpdateMinimumMediaUserPrivilege_];

  v79 = [(HMDHome *)self administratorHandler];
  v80 = *MEMORY[0x277CD0670];
  v81 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v488[0] = v81;
  v82 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v488[1] = v82;
  v83 = [MEMORY[0x277CBEA60] arrayWithObjects:v488 count:2];
  [v79 registerForMessage:v80 receiver:self policies:v83 selector:sel__handleUpdateMediaPeerToPeerEnabled_];

  v84 = [(HMDHome *)self administratorHandler];
  v85 = *MEMORY[0x277CD0668];
  v86 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v487[0] = v86;
  v87 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v487[1] = v87;
  v88 = [MEMORY[0x277CBEA60] arrayWithObjects:v487 count:2];
  [v84 registerForMessage:v85 receiver:self policies:v88 selector:sel__handleUpdateMediaPassword_];

  v89 = [(HMDHome *)self administratorHandler];
  v90 = *MEMORY[0x277CD0580];
  v91 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v486[0] = v91;
  v92 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v486[1] = v92;
  v93 = [MEMORY[0x277CBEA60] arrayWithObjects:v486 count:2];
  [v89 registerForMessage:v90 receiver:self policies:v93 selector:sel__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest_];

  v94 = [(HMDHome *)self administratorHandler];
  v95 = *MEMORY[0x277CD0588];
  v96 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v485[0] = v96;
  v97 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v485[1] = v97;
  v98 = [MEMORY[0x277CBEA60] arrayWithObjects:v485 count:2];
  [v94 registerForMessage:v95 receiver:self policies:v98 selector:sel__handleSetHasOnboardedForAccessCodeMessage_];

  v99 = [(HMDHome *)self administratorHandler];
  v100 = *MEMORY[0x277CD0590];
  v101 = [HMDXPCMessagePolicy policyWithEntitlements:131077];
  v484[0] = v101;
  v102 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v484[1] = v102;
  v103 = [MEMORY[0x277CBEA60] arrayWithObjects:v484 count:2];
  [v99 registerForMessage:v100 receiver:self policies:v103 selector:sel__handleSetHasOnboardedForWalletKeyMessage_];

  v104 = [(HMDHome *)self administratorHandler];
  v105 = *MEMORY[0x277CD0680];
  v106 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v483[0] = v106;
  v107 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v483[1] = v107;
  v108 = [MEMORY[0x277CBEA60] arrayWithObjects:v483 count:2];
  [v104 registerForMessage:v105 receiver:self policies:v108 selector:sel__handleUpdateNetworkProtection_];

  v109 = [(HMDHome *)self administratorHandler];
  v110 = *MEMORY[0x277CD0690];
  v111 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v482[0] = v111;
  v112 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v482[1] = v112;
  v113 = [MEMORY[0x277CBEA60] arrayWithObjects:v482 count:2];
  [v109 registerForMessage:v110 receiver:self policies:v113 selector:sel__handleUpdateUserAnnounceAccess_];

  v114 = [(HMDHome *)self administratorHandler];
  v115 = *MEMORY[0x277CD0558];
  v116 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v481[0] = v116;
  v117 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v481[1] = v117;
  v118 = [MEMORY[0x277CBEA60] arrayWithObjects:v481 count:2];
  [v114 registerForMessage:v115 receiver:self policies:v118 selector:sel__handleResolveThreadNetworkRequest_];

  v119 = [(HMDHome *)self administratorHandler];
  v120 = *MEMORY[0x277CD05E8];
  v121 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v480[0] = v121;
  v122 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v480[1] = v122;
  v123 = [MEMORY[0x277CBEA60] arrayWithObjects:v480 count:2];
  [v119 registerForMessage:v120 receiver:self policies:v123 selector:sel__handleSiriPhraseOptionsUpdateRequest_];

  v124 = [(HMDHome *)self administratorHandler];
  v125 = *MEMORY[0x277CD05D0];
  v126 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v479[0] = v126;
  v127 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v479[1] = v127;
  v128 = [MEMORY[0x277CBEA60] arrayWithObjects:v479 count:2];
  [v124 registerForMessage:v125 receiver:self policies:v128 selector:sel__handleSoundCheckUpdateRequest_];

  v129 = [(HMDHome *)self administratorHandler];
  v130 = *MEMORY[0x277CD0660];
  v131 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v478[0] = v131;
  v132 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v478[1] = v132;
  v133 = [MEMORY[0x277CBEA60] arrayWithObjects:v478 count:2];
  [v129 registerForMessage:v130 receiver:self policies:v133 selector:sel__handleHomeUpdateLocationServicesEnabledRequest_];

  if (isInternalBuild())
  {
    v134 = [(HMDHome *)self administratorHandler];
    v135 = *MEMORY[0x277CD0658];
    v136 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v477[0] = v136;
    v137 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v477[1] = v137;
    v138 = [MEMORY[0x277CBEA60] arrayWithObjects:v477 count:2];
    [v134 registerForMessage:v135 receiver:self policies:v138 selector:sel__handleHomeUpdateDidOnboardLocationServicesRequest_];
  }

  if (!isWatch())
  {
    v139 = [(HMDHome *)self administratorHandler];
    v140 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v476[0] = v140;
    v141 = [HMDConfigurationMessagePolicy policyWithOperationTypes:6];
    v476[1] = v141;
    v142 = [MEMORY[0x277CBEA60] arrayWithObjects:v476 count:2];
    [v139 registerForMessage:@"kUpdateInvitationStateRequestKey" receiver:self policies:v142 selector:sel__handleUpdateOutgoingInvitationState_];
  }

  v143 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v143 setRoles:{objc_msgSend(v143, "roles") | 4}];
  v406 = v143;
  v144 = [v143 copy];
  v145 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:4 remoteAccessRequired:0];
  v146 = [(HMDHome *)self msgDispatcher];
  v147 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v475[0] = v147;
  v475[1] = v145;
  v148 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v475[2] = v148;
  v149 = [MEMORY[0x277CBEA60] arrayWithObjects:v475 count:3];
  [v146 registerForMessage:@"kAddEventTriggerRequestKey" receiver:self policies:v149 selector:sel__handleAddEventTrigger_];

  v150 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v474[0] = v150;
  v474[1] = v145;
  v151 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v474[2] = v151;
  v152 = [MEMORY[0x277CBEA60] arrayWithObjects:v474 count:3];
  v404 = v146;
  [v146 registerForMessage:@"kAddTimerTriggerRequestKey" receiver:self policies:v152 selector:sel__handleAddTimerTrigger_];

  v153 = [(HMDHome *)self msgDispatcher];
  v473[0] = v144;
  v473[1] = v145;
  v154 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v473[2] = v154;
  v155 = [MEMORY[0x277CBEA60] arrayWithObjects:v473 count:3];
  [v153 registerForMessage:@"kAddTriggersInternalRequestKey" receiver:self policies:v155 selector:sel__handleAddTriggers_];

  v156 = [MEMORY[0x277D0F8E8] productInfo];
  v157 = [v156 productPlatform];

  if (v157 == 1)
  {
    v158 = 5;
  }

  else
  {
    v158 = 1;
  }

  v159 = [(HMDHome *)self msgDispatcher];
  v160 = *MEMORY[0x277CD2070];
  v472[0] = v144;
  v472[1] = v145;
  v161 = [HMDXPCMessagePolicy policyWithEntitlements:v158];
  v472[2] = v161;
  v162 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v472[3] = v162;
  v163 = [MEMORY[0x277CBEA60] arrayWithObjects:v472 count:4];
  [v159 registerForMessage:v160 receiver:self policies:v163 selector:sel__handleAddAccessory_];

  v164 = [(HMDHome *)self msgDispatcher];
  v471[0] = v144;
  v471[1] = v145;
  v165 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v471[2] = v165;
  v166 = [MEMORY[0x277CBEA60] arrayWithObjects:v471 count:3];
  [v164 registerForMessage:@"kAddAccessoriesInternalRequestKey" receiver:self policies:v166 selector:sel__handleAddAccessories_];

  v167 = [(HMDHome *)self msgDispatcher];
  v168 = *MEMORY[0x277CD06A8];
  v169 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v470[0] = v169;
  v470[1] = v145;
  v170 = [MEMORY[0x277CBEA60] arrayWithObjects:v470 count:2];
  [v167 registerForMessage:v168 receiver:self policies:v170 selector:sel__handleUserConsentResponseForAccessory_];

  v171 = [(HMDHome *)self msgDispatcher];
  v172 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v469[0] = v172;
  v469[1] = v145;
  v173 = [MEMORY[0x277CBEA60] arrayWithObjects:v469 count:2];
  [v171 registerForMessage:@"kContinuePairingAccessoryRequestKey" receiver:self policies:v173 selector:sel__handleContinuePairingAccessory_];

  v174 = [(HMDHome *)self msgDispatcher];
  v175 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v468[0] = v175;
  v468[1] = v145;
  v176 = [MEMORY[0x277CBEA60] arrayWithObjects:v468 count:2];
  [v174 registerForMessage:@"kCancelPairingAccessoryRequestKey" receiver:self policies:v176 selector:sel__handleCancelPairingAccessory_];

  v177 = [(HMDHome *)self msgDispatcher];
  v178 = *MEMORY[0x277CD24F0];
  v179 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v467[0] = v179;
  v467[1] = v144;
  v467[2] = v145;
  v180 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v467[3] = v180;
  v181 = [MEMORY[0x277CBEA60] arrayWithObjects:v467 count:4];
  [v177 registerForMessage:v178 receiver:self policies:v181 selector:sel__handleRemoveAccessoryMessage_];

  v182 = [(HMDHome *)self administratorHandler];
  v183 = *MEMORY[0x277CD0518];
  v184 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v466[0] = v184;
  v466[1] = v144;
  v466[2] = v145;
  v185 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v466[3] = v185;
  v186 = [MEMORY[0x277CBEA60] arrayWithObjects:v466 count:4];
  [v182 registerForMessage:v183 receiver:self policies:v186 selector:sel_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage_];

  v187 = [(HMDHome *)self msgDispatcher];
  v465[0] = v144;
  v465[1] = v410;
  v188 = [MEMORY[0x277CBEA60] arrayWithObjects:v465 count:2];
  [v187 registerForMessage:@"HMDHomeRequestCommissioningCertificatesMessage" receiver:self policies:v188 selector:sel_handleCommissioningCertificateRequest_];

  v189 = [(HMDHome *)self msgDispatcher];
  v464[0] = v144;
  v464[1] = v145;
  v190 = [MEMORY[0x277CBEA60] arrayWithObjects:v464 count:2];
  [v189 registerForMessage:@"HMDHomeNotificationPairingCompletionMessage" receiver:self policies:v190 selector:sel_handleMatterPairingCompletionNotification_];

  v191 = [(HMDHome *)self msgDispatcher];
  v192 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v463[0] = v192;
  v463[1] = v145;
  v193 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v463[2] = v193;
  v194 = [MEMORY[0x277CBEA60] arrayWithObjects:v463 count:3];
  [v191 registerForMessage:@"kInviteUsersRequestKey" receiver:self policies:v194 selector:sel__handleUserInvitations_];

  v195 = [(HMDHome *)self administratorHandler];
  v196 = *MEMORY[0x277CCFEE8];
  v197 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v462[0] = v197;
  v198 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v462[1] = v198;
  v462[2] = v410;
  v462[3] = v144;
  v199 = [MEMORY[0x277CBEA60] arrayWithObjects:v462 count:4];
  [v195 registerForMessage:v196 receiver:self policies:v199 selector:sel__handleEnableMultiUserRequest_];

  v200 = [(HMDHome *)self localCapabilitiesDataSource];
  LODWORD(v196) = [v200 isResidentCapable];

  if (v196)
  {
    v201 = [(HMDHome *)self msgDispatcher];
    v461[0] = v144;
    v461[1] = v145;
    v202 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
    v461[2] = v202;
    v203 = [MEMORY[0x277CBEA60] arrayWithObjects:v461 count:3];
    [v201 registerForMessage:@"kAddHomeInvitesInternalRequestKey" receiver:self policies:v203 selector:sel__handleOutgoingInvitations_];

    v204 = [(HMDHome *)self msgDispatcher];
    v460[0] = v144;
    v460[1] = v145;
    v205 = [MEMORY[0x277CBEA60] arrayWithObjects:v460 count:2];
    [v204 registerForMessage:@"HMDHomeCreateUniquePSKClientConfigurationRequestKey" receiver:self policies:v205 selector:sel__handleCreateUniquePSKClientConfiguration_];

    v206 = [(HMDHome *)self msgDispatcher];
    v459[0] = v144;
    v459[1] = v145;
    v207 = [MEMORY[0x277CBEA60] arrayWithObjects:v459 count:2];
    [v206 registerForMessage:@"HMDHomeRemoveClientConfigurationRequestKey" receiver:self policies:v207 selector:sel__handleRemoveClientConfiguration_];
  }

  if (!isWatch())
  {
    v208 = [(HMDHome *)self msgDispatcher];
    v209 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
    v458[0] = v209;
    v458[1] = v145;
    v210 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v458[2] = v210;
    v211 = [MEMORY[0x277CBEA60] arrayWithObjects:v458 count:3];
    [v208 registerForMessage:@"kHomeLocationUpdatedNotificationKey" receiver:self policies:v211 selector:sel__handleHomeLocationUpdateFromSharedAdmin_];
  }

  if (isInternalBuild())
  {
    v212 = [(HMDHome *)self msgDispatcher];
    v213 = *MEMORY[0x277CD0008];
    v214 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v457[0] = v214;
    v215 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v457[1] = v215;
    v216 = [MEMORY[0x277CBEA60] arrayWithObjects:v457 count:2];
    [v212 registerForMessage:v213 receiver:self policies:v216 selector:sel__handleSetMinimumNetworkRouterHomeKitVersion_];

    v217 = [(HMDHome *)self msgDispatcher];
    v218 = *MEMORY[0x277CD0000];
    v219 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v456[0] = v219;
    v220 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v456[1] = v220;
    v221 = [MEMORY[0x277CBEA60] arrayWithObjects:v456 count:2];
    [v217 registerForMessage:v218 receiver:self policies:v221 selector:sel__handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange_];
  }

  v223 = v410;
  v222 = v411;
  if (isInternalBuild() && isiOSDevice())
  {
    v224 = [(HMDHome *)self msgDispatcher];
    v225 = *MEMORY[0x277CD0568];
    v226 = [HMDXPCMessagePolicy policyWithEntitlements:1049605];
    v455[0] = v226;
    v227 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v455[1] = v227;
    v228 = [MEMORY[0x277CBEA60] arrayWithObjects:v455 count:2];
    [v224 registerForMessage:v225 receiver:self policies:v228 selector:sel__handleRetrieveHomeLocationForFeedback_];

    v222 = v411;
    v223 = v410;
  }

  v229 = [(HMDHome *)self msgDispatcher];
  v230 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v454[0] = v230;
  v454[1] = v222;
  v231 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v454[2] = v231;
  v232 = [MEMORY[0x277CBEA60] arrayWithObjects:v454 count:3];
  [v229 registerForMessage:@"kUpdateUserPresenceStatusConsentRequestKey" receiver:self policies:v232 selector:sel__handleUpdatePresenceConsent_];

  v233 = [(HMDHome *)self msgDispatcher];
  v234 = *MEMORY[0x277CD0560];
  v235 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v453[0] = v235;
  v236 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v453[1] = v236;
  v237 = [MEMORY[0x277CBEA60] arrayWithObjects:v453 count:2];
  [v233 registerForMessage:v234 receiver:self policies:v237 selector:sel__handleRetrieveAsyncResults_];

  v238 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v238 setRoles:{objc_msgSend(v238, "roles") | 6}];
  v407 = v238;
  v239 = [v238 copy];
  v240 = [(HMDHome *)self msgDispatcher];
  v241 = *MEMORY[0x277CD2348];
  v242 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v452[0] = v242;
  v452[1] = v239;
  v452[2] = v223;
  v243 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v452[3] = v243;
  v244 = [MEMORY[0x277CBEA60] arrayWithObjects:v452 count:4];
  [v240 registerForMessage:v241 receiver:self policies:v244 selector:sel__handleExecuteActionSet_];

  v245 = [(HMDHome *)self msgDispatcher];
  v246 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v451[0] = v246;
  v451[1] = v239;
  v451[2] = v223;
  v247 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v451[3] = v247;
  v248 = [MEMORY[0x277CBEA60] arrayWithObjects:v451 count:4];
  [v245 registerForMessage:@"kMultipleCharacteristicWriteRequestKey" receiver:self policies:v248 selector:sel__handleMultipleCharacteristicWrite_];

  v249 = [(HMDHome *)self msgDispatcher];
  v250 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v450[0] = v250;
  v450[1] = v239;
  v450[2] = v223;
  v251 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v450[3] = v251;
  v252 = [MEMORY[0x277CBEA60] arrayWithObjects:v450 count:4];
  [v249 registerForMessage:@"kMultipleCharacteristicReadRequestKey" receiver:self policies:v252 selector:sel__handleMultipleCharacteristicRead_];

  v253 = [(HMDHome *)self msgDispatcher];
  v449[0] = v239;
  v449[1] = v223;
  v254 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v449[2] = v254;
  v255 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v449[3] = v255;
  v256 = [MEMORY[0x277CBEA60] arrayWithObjects:v449 count:4];
  [v253 registerForMessage:@"kCharacteristicWriteRequestKey" receiver:self policies:v256 selector:sel__handleCharacteristicWrite_];

  v257 = [(HMDHome *)self msgDispatcher];
  v448[0] = v239;
  v448[1] = v223;
  v258 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v448[2] = v258;
  v259 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v448[3] = v259;
  v260 = [MEMORY[0x277CBEA60] arrayWithObjects:v448 count:4];
  [v257 registerForMessage:@"kCharacteristicReadRequestKey" receiver:self policies:v260 selector:sel__handleCharacteristicRead_];

  v261 = [(HMDHome *)self msgDispatcher];
  v262 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v447[0] = v262;
  v447[1] = v239;
  v447[2] = v411;
  v263 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v447[3] = v263;
  v264 = [MEMORY[0x277CBEA60] arrayWithObjects:v447 count:4];
  [v261 registerForMessage:@"kCharacteristicEnableNotificationRequestKey" receiver:self policies:v264 selector:sel__handleCharacteristicEnableNotification_];

  if (!isWatch())
  {
    v265 = [(HMDHome *)self msgDispatcher];
    v446[0] = v239;
    v446[1] = v223;
    v266 = [MEMORY[0x277CBEA60] arrayWithObjects:v446 count:2];
    [v265 registerForMessage:@"kModifyCharacterisiticNotificationsRequestKey" receiver:self policies:v266 selector:sel__handleModifyCharacteristicNotifications_];
  }

  v267 = [(HMDHome *)self msgDispatcher];
  v445[0] = v239;
  v445[1] = v223;
  v268 = [MEMORY[0x277CBEA60] arrayWithObjects:v445 count:2];
  [v267 registerForMessage:@"kEnableAccessoryReachabilityNotificationRequestKey" receiver:self policies:v268 selector:sel__handleAccessoryReachabilityRegistrationAndEnable_];

  v269 = [(HMDHome *)self msgDispatcher];
  v444[0] = v239;
  v444[1] = v223;
  v270 = [MEMORY[0x277CBEA60] arrayWithObjects:v444 count:2];
  [v269 registerForMessage:@"kDisableAccessoryReachabilityNotificationRequestKey" receiver:self policies:v270 selector:sel__handleAccessoryReachabilityRegistration_];

  v271 = [(HMDHome *)self msgDispatcher];
  v443[0] = v239;
  v443[1] = v411;
  v272 = [MEMORY[0x277CBEA60] arrayWithObjects:v443 count:2];
  [v271 registerForMessage:@"kRequestHomeDataSyncRequestKey" receiver:self policies:v272 selector:sel__handleRequestHomeDataSync_];

  v273 = [(HMDHome *)self msgDispatcher];
  v274 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v442[0] = v274;
  v442[1] = v411;
  v275 = [MEMORY[0x277CBEA60] arrayWithObjects:v442 count:2];
  [v273 registerForMessage:@"kCharacterisiticsChangedInternalNotificationKey" receiver:self policies:v275 selector:sel__handleCharacteristicsChangedNotification_];

  v276 = [(HMDHome *)self msgDispatcher];
  v277 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v441[0] = v277;
  v441[1] = v411;
  v278 = [MEMORY[0x277CBEA60] arrayWithObjects:v441 count:2];
  [v276 registerForMessage:@"HMHomeAllowUserManagementMessage" receiver:self policies:v278 selector:sel__handleAllowUserManagementMessage_];

  v279 = [(HMDHome *)self msgDispatcher];
  v280 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v440[0] = v280;
  v440[1] = v411;
  v281 = [MEMORY[0x277CBEA60] arrayWithObjects:v440 count:2];
  [v279 registerForMessage:@"kRemoteReachabilityChangedNotificationKey" receiver:self policies:v281 selector:sel__handleAccessoryReachabilityChange_];

  v282 = [(HMDHome *)self msgDispatcher];
  v283 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v439[0] = v283;
  v439[1] = v411;
  v284 = [MEMORY[0x277CBEA60] arrayWithObjects:v439 count:2];
  [v282 registerForMessage:@"HMDAccessoryResidentReachabilityNotificationRegistrationMessage" receiver:self policies:v284 selector:sel__handleAccessoryReachabilityEventNotificationsRegistration_];

  v285 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v285 setRequiresSecureMessage:1];
  [v285 setRoles:3];
  v408 = v285;
  v286 = [v285 copy];
  v287 = [(HMDHome *)self msgDispatcher];
  v288 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v438[0] = v288;
  v438[1] = v286;
  v405 = v286;
  v438[2] = v223;
  v289 = [MEMORY[0x277CBEA60] arrayWithObjects:v438 count:3];
  [v287 registerForMessage:@"kConfirmExecuteTriggerRequestKey" receiver:self policies:v289 selector:sel__handleExecuteConfirmationOfTrigger_];

  v290 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v290 setRoles:4];
  v291 = [v290 copy];
  v292 = [(HMDHome *)self msgDispatcher];
  v293 = *MEMORY[0x277CD24B0];
  v437[0] = v291;
  v437[1] = v411;
  v294 = [MEMORY[0x277CBEA60] arrayWithObjects:v437 count:2];
  [v292 registerForMessage:v293 receiver:self policies:v294 selector:sel_handleEvaluatePredicateMessage_];

  v295 = [(HMDHome *)self msgDispatcher];
  v296 = *MEMORY[0x277CD0648];
  v297 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v436[0] = v297;
  v436[1] = v409;
  v298 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v436[2] = v298;
  v299 = [MEMORY[0x277CBEA60] arrayWithObjects:v436 count:3];
  [v295 registerForMessage:v296 receiver:self policies:v299 selector:sel__handleUpdateAutomaticSoftwareUpdate_];

  v300 = *MEMORY[0x277CD0650];
  v301 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v435[0] = v301;
  v435[1] = v409;
  v302 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v435[2] = v302;
  v303 = [MEMORY[0x277CBEA60] arrayWithObjects:v435 count:3];
  v403 = v295;
  v304 = v295;
  v305 = v410;
  [v304 registerForMessage:v300 receiver:self policies:v303 selector:sel__handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate_];

  v306 = [(HMDHome *)self msgDispatcher];
  v307 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v434[0] = v307;
  v434[1] = v410;
  v308 = [MEMORY[0x277CBEA60] arrayWithObjects:v434 count:2];
  [v306 registerForMessage:@"HMDHomeQueryResidentReachabilityForAccessoriesMessageKey" receiver:self policies:v308 selector:sel__handleQueryResidentReachabilityForAccessories_];

  v309 = [(HMDHome *)self msgDispatcher];
  v310 = *MEMORY[0x277CCFF40];
  v311 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v433[0] = v311;
  v433[1] = v411;
  v312 = [MEMORY[0x277CBEA60] arrayWithObjects:v433 count:2];
  [v309 registerForMessage:v310 receiver:self policies:v312 selector:sel_executeActionsFromMessage_];

  v313 = [(HMDHome *)self localCapabilitiesDataSource];
  LODWORD(v310) = [v313 supportsHomeInvitation];

  if (v310)
  {
    v314 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
    [v314 setRequiresSecureMessage:0];
    [v314 setRequiresAccountMessage:0];
    [v314 setTransportRestriction:-1];
    v315 = [v314 copy];
    v316 = [(HMDHome *)self msgDispatcher];
    v432[0] = v315;
    v317 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v432[1] = v317;
    v318 = [MEMORY[0x277CBEA60] arrayWithObjects:v432 count:2];
    [v316 registerForMessage:@"kUpdateHomeInvitationStateInternalRequestKey" receiver:self policies:v318 selector:sel__handleUpdateRequestForHomeInvitationFromInvitee_];

    v305 = v410;
  }

  v319 = [(HMDHome *)self localCapabilitiesDataSource];
  v320 = [v319 supportsHomeNotificationEnablement];

  if (v320)
  {
    v321 = [(HMDHome *)self msgDispatcher];
    v322 = *MEMORY[0x277CCFEE0];
    v323 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v431[0] = v323;
    v431[1] = v411;
    v324 = [MEMORY[0x277CBEA60] arrayWithObjects:v431 count:2];
    [v321 registerForMessage:v322 receiver:self policies:v324 selector:sel__handleEnableNotifications_];
  }

  v325 = [(HMDHome *)self msgDispatcher];
  v326 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v430[0] = v326;
  v430[1] = v305;
  v327 = [MEMORY[0x277CBEA60] arrayWithObjects:v430 count:2];
  [v325 registerForMessage:@"kMediaPropertiesWriteRequestKey" receiver:self policies:v327 selector:sel__handleMediaPropertiesWrite_];

  v328 = [(HMDHome *)self msgDispatcher];
  v329 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v429[0] = v329;
  v429[1] = v305;
  v330 = [MEMORY[0x277CBEA60] arrayWithObjects:v429 count:2];
  [v328 registerForMessage:@"kMediaPropertiesReadRequestKey" receiver:self policies:v330 selector:sel__handleMediaPropertiesRead_];

  v331 = [(HMDHome *)self msgDispatcher];
  v332 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v333 = v409;
  v428[0] = v332;
  v428[1] = v409;
  v334 = [MEMORY[0x277CBEA60] arrayWithObjects:v428 count:2];
  [v331 registerForMessage:@"kStartDiscoveringSymptomsForNearbyDevicesRequestKey" receiver:self policies:v334 selector:sel__handleStartDiscoveringSymptomsForNearbyDevicesMessage_];

  v335 = [(HMDHome *)self msgDispatcher];
  v336 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v427[0] = v336;
  v427[1] = v409;
  v337 = [MEMORY[0x277CBEA60] arrayWithObjects:v427 count:2];
  [v335 registerForMessage:@"kStopDiscoveringSymptomsForNearbyDevicesRequestKey" receiver:self policies:v337 selector:sel__handleStopDiscoveringSymptomsForNearbyDevicesMessage_];

  v338 = [(HMDHome *)self msgDispatcher];
  v339 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v426[0] = v339;
  v340 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v341 = v411;
  v426[1] = v340;
  v426[2] = v411;
  v342 = [MEMORY[0x277CBEA60] arrayWithObjects:v426 count:3];

  [v338 registerForMessage:*MEMORY[0x277CD1300] receiver:self policies:v342 selector:sel__handleAssistantAccessControlUpdate_];
  [v338 registerForMessage:*MEMORY[0x277CD13C0] receiver:self policies:v342 selector:sel__handleMediaContentProfileAccessControlUpdate_];
  v401 = v342;
  v402 = v338;
  [v338 registerForMessage:*MEMORY[0x277CD13A8] receiver:self policies:v342 selector:sel__handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs_];
  v343 = [(HMDHome *)self msgDispatcher];
  v344 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v425[0] = v344;
  v425[1] = v411;
  v345 = [MEMORY[0x277CBEA60] arrayWithObjects:v425 count:2];
  [v343 registerForMessage:@"HMDUCM.rsr" receiver:self policies:v345 selector:sel__handleRemoteUserClientCloudShareRequest_];

  v346 = [(HMDHome *)self msgDispatcher];
  v347 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v424[0] = v347;
  v424[1] = v411;
  v348 = [MEMORY[0x277CBEA60] arrayWithObjects:v424 count:2];
  [v346 registerForMessage:@"HMDUCM.rRepr" receiver:self policies:v348 selector:sel__handleRemoteUserClientCloudShareRepairRequest_];

  if (isInternalBuild())
  {
    v349 = [(HMDHome *)self msgDispatcher];
    v350 = *MEMORY[0x277CCFEA0];
    v351 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v423[0] = v351;
    v423[1] = v409;
    v352 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v423[2] = v352;
    v353 = [MEMORY[0x277CBEA60] arrayWithObjects:v423 count:3];
    [v349 registerForMessage:v350 receiver:self policies:v353 selector:sel__handleConfirmResidentRequest_];

    v341 = v411;
  }

  v354 = v341;
  [(HMDHome *)self _registerThreadResidentCommissioningMessageHandlers];
  if (isInternalBuild())
  {
    v355 = [(HMDHome *)self msgDispatcher];
    v356 = *MEMORY[0x277CD0610];
    v357 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v422 = v357;
    v358 = [MEMORY[0x277CBEA60] arrayWithObjects:&v422 count:1];
    [v355 registerForMessage:v356 receiver:self policies:v358 selector:sel__handleTestUpgradeToROAR_];
  }

  v359 = [(HMDHome *)self msgDispatcher];
  v360 = *MEMORY[0x277CCFF58];
  v361 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v421 = v361;
  v362 = [MEMORY[0x277CBEA60] arrayWithObjects:&v421 count:1];
  [v359 registerForMessage:v360 receiver:self policies:v362 selector:sel_handleFetchLightProfileSettingsMessage_];

  v363 = [(HMDHome *)self msgDispatcher];
  v364 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v420[0] = v364;
  v420[1] = v341;
  v365 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v420[2] = v365;
  v366 = [MEMORY[0x277CBEA60] arrayWithObjects:v420 count:3];
  [v363 registerForMessage:@"HMDHomeCHIPSendRemoteRequestMessage" receiver:self policies:v366 selector:sel_handleCHIPSendRemoteRequestMessage_];

  if (isInternalBuild())
  {
    v367 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:4 remoteAccessRequired:0];
    v368 = [(HMDHome *)self msgDispatcher];
    v369 = *MEMORY[0x277CD0548];
    v370 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
    v419[0] = v370;
    v419[1] = v367;
    v371 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v419[2] = v371;
    v372 = [MEMORY[0x277CBEA60] arrayWithObjects:v419 count:3];
    [v368 registerForMessage:v369 receiver:self policies:v372 selector:sel_handleResetMatterStorageRequest_];

    v373 = [(HMDHome *)self msgDispatcher];
    v374 = *MEMORY[0x277CCFE98];
    v375 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
    v418[0] = v375;
    v418[1] = v367;
    v376 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v418[2] = v376;
    v377 = [MEMORY[0x277CBEA60] arrayWithObjects:v418 count:3];
    [v373 registerForMessage:v374 receiver:self policies:v377 selector:sel_handleClearMatterControllerPrivateStorageRequest_];

    v333 = v409;
    v354 = v411;
  }

  v378 = [(HMDHome *)self msgDispatcher];
  v379 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v417[0] = v379;
  v417[1] = v354;
  v380 = [MEMORY[0x277CBEA60] arrayWithObjects:v417 count:2];
  [v378 registerForMessage:@"HMDHomeCHIPSendReportMessage" receiver:self policies:v380 selector:sel_handleCHIPSendReportMessage_];

  if (isInternalBuild())
  {
    v381 = [(HMDHome *)self msgDispatcher];
    v382 = *MEMORY[0x277CD05A0];
    v383 = [HMDXPCMessagePolicy policyWithEntitlements:1];
    v416[0] = v383;
    v384 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
    v416[1] = v384;
    v385 = [MEMORY[0x277CBEA60] arrayWithObjects:v416 count:2];
    [v381 registerForMessage:v382 receiver:self policies:v385 selector:sel_handleSetPreferredPrimaryMessage_];

    v333 = v409;
  }

  v386 = [(HMDHome *)self msgDispatcher];
  v387 = *MEMORY[0x277CCFF90];
  v388 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v415 = v388;
  v389 = [MEMORY[0x277CBEA60] arrayWithObjects:&v415 count:1];
  [v386 registerForMessage:v387 receiver:self policies:v389 selector:sel__handleFetchUniqueIdentifierForBundleIdentifier_];

  v390 = [(HMDHome *)self msgDispatcher];
  v391 = *MEMORY[0x277CCFF88];
  v392 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v414 = v392;
  v393 = [MEMORY[0x277CBEA60] arrayWithObjects:&v414 count:1];
  [v390 registerForMessage:v391 receiver:self policies:v393 selector:sel__handleFetchTriggerNameRequest_];

  isInternalBuild();
  if (isInternalBuild())
  {
    v394 = [(HMDHome *)self msgDispatcher];
    v395 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v413 = v395;
    v396 = [MEMORY[0x277CBEA60] arrayWithObjects:&v413 count:1];
    [v394 registerForMessage:@"HomeUtil.Command.Wallet.RollReaderKey" receiver:self policies:v396 selector:sel__handleRollReaderKey_];

    v397 = [(HMDHome *)self msgDispatcher];
    v398 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v412 = v398;
    v399 = [MEMORY[0x277CBEA60] arrayWithObjects:&v412 count:1];
    [v397 registerForMessage:@"HomeUtil.Command.Wallet.FetchOrCreateReaderKey" receiver:self policies:v399 selector:sel__handleFetchOrCreateReaderKey_];
  }

  v400 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientOfVendorInfoUpdatedForManufacturers:(id)a3 withCompletion:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __74__HMDHome_notifyClientOfVendorInfoUpdatedForManufacturers_withCompletion___block_invoke;
  block[3] = &unk_2797355D0;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(v8, block);
}

void __74__HMDHome_notifyClientOfVendorInfoUpdatedForManufacturers_withCompletion___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessories];
  v18 = [v2 copy];

  v3 = [MEMORY[0x277CBEB18] array];
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v15 = a1;
  obj = *(a1 + 40);
  v19 = [obj countByEnumeratingWithState:&v24 objects:v29 count:16];
  if (v19)
  {
    v17 = *v25;
    do
    {
      for (i = 0; i != v19; ++i)
      {
        if (*v25 != v17)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v24 + 1) + 8 * i);
        v20 = 0u;
        v21 = 0u;
        v22 = 0u;
        v23 = 0u;
        v6 = v18;
        v7 = [v6 countByEnumeratingWithState:&v20 objects:v28 count:16];
        if (v7)
        {
          v8 = v7;
          v9 = *v21;
          do
          {
            for (j = 0; j != v8; ++j)
            {
              if (*v21 != v9)
              {
                objc_enumerationMutation(v6);
              }

              v11 = *(*(&v20 + 1) + 8 * j);
              v12 = [v11 manufacturer];
              v13 = [v12 caseInsensitiveCompare:v5];

              if (!v13)
              {
                [v11 updateVendorInfo];
                [v3 addObject:v11];
              }
            }

            v8 = [v6 countByEnumeratingWithState:&v20 objects:v28 count:16];
          }

          while (v8);
        }
      }

      v19 = [obj countByEnumeratingWithState:&v24 objects:v29 count:16];
    }

    while (v19);
  }

  [*(v15 + 32) _notifyClientsOfAccessoryInfoUpdatedForAccessories:v3 shouldRefreshBadge:0 withCompletion:*(v15 + 48)];
  v14 = *MEMORY[0x277D85DE8];
}

- (void)resetConfiguration
{
  [(HMDHome *)self unconfigure];
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_resetConfiguration__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v3, block);
}

void __29__HMDHome_resetConfiguration__block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessories];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543618;
    v20 = v6;
    v21 = 2112;
    v22 = v2;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@resetConfiguration - removing accessories %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v7 = v2;
  v8 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * i);
        [*(a1 + 32) removeAccessory:{v12, v14}];
        [v12 unconfigure];
      }

      v9 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_evaluateShouldRelaunchAndSetRelaunch
{
  v17 = *MEMORY[0x277D85DE8];
  if (![(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    v3 = [(HMDHome *)self accessories];
    v4 = [v3 countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v4)
    {
      v5 = v4;
      v6 = 0;
      v7 = *v13;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v13 != v7)
          {
            objc_enumerationMutation(v3);
          }

          v6 |= [*(*(&v12 + 1) + 8 * i) shouldEnableDaemonRelaunch];
        }

        v5 = [v3 countByEnumeratingWithState:&v12 objects:v16 count:16];
      }

      while (v5);

      if (v6)
      {
        goto LABEL_10;
      }
    }

    else
    {
    }

    v9 = [(HMDHome *)self launchHandler];
    v10 = [(HMDHome *)self uuid];
    [v9 deregisterRelaunchClientWithUUID:v10];
    goto LABEL_13;
  }

LABEL_10:
  v9 = [(HMDHome *)self launchHandler];
  v10 = [(HMDHome *)self uuid];
  [v9 registerRelaunchClientWithUUID:v10];
LABEL_13:

  v11 = *MEMORY[0x277D85DE8];
}

- (void)evaluateShouldRelaunchAndSetRelaunch
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __47__HMDHome_evaluateShouldRelaunchAndSetRelaunch__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v3, block);
}

- (id)getTransactionFromHAPAccessory:(id)a3 hmdAccessory:(id)a4 uuid:(id)a5 hostAccessoryUUID:(id)a6 objectChangeType:(unint64_t)a7
{
  v103 = *MEMORY[0x277D85DE8];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = v16;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  v19 = v14;
  v20 = v19;
  if (v13)
  {
    v21 = [v13 transactionWithObjectChangeType:a7];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v22 = v21;
    }

    else
    {
      v22 = 0;
    }

    v23 = v22;
    goto LABEL_14;
  }

  if (!v19)
  {
    goto LABEL_13;
  }

  if (!v18)
  {
    goto LABEL_13;
  }

  v24 = [v18 sensorAccessoryUUID];
  v25 = [v24 hmf_isEqualToUUID:v20];

  if (!v25 || (v26 = [HMDAppleMediaAccessorySensorModel alloc], [(HMDHome *)self uuid], v27 = objc_claimAutoreleasedReturnValue(), v28 = [(HMDBackingStoreModelObject *)v26 initWithObjectChangeType:a7 uuid:v20 parentUUID:v27], v27, !v28))
  {
LABEL_13:
    v29 = [HMDHAPAccessoryTransaction alloc];
    v21 = [(HMDHome *)self uuid];
    v23 = [(HMDBackingStoreModelObject *)v29 initWithObjectChangeType:a7 uuid:v20 parentUUID:v21];
LABEL_14:
    v28 = v23;
  }

  [(HMDHAPAccessoryTransaction *)v28 setHapAccessoryLocal:v12];
  v30 = [v13 providedName];
  if (v30)
  {
LABEL_18:

    goto LABEL_19;
  }

  if ([v12 linkType] != 2)
  {
    v30 = [v12 name];
    v31 = [v30 copy];
    [(HMDAppleMediaAccessorySensorModel *)v28 setProvidedName:v31];

    goto LABEL_18;
  }

LABEL_19:
  v85 = v20;
  v81 = v15;
  v32 = [v12 uniqueIdentifier];
  [(HMDAppleMediaAccessorySensorModel *)v28 setUniqueIdentifier:v32];

  v33 = [v12 identifier];
  [(HMDAppleMediaAccessorySensorModel *)v28 setIdentifier:v33];

  v34 = [v12 identifier];
  v92 = 0;
  v35 = [(HMDHome *)self keychainStore];
  v91 = 0;
  v36 = [v35 readPublicKeyForAccessoryName:v34 registeredWithHomeKit:&v92 error:&v91];
  v82 = v91;

  v83 = v36;
  v84 = v34;
  if (v34 && v36 && v92 == 1)
  {
    v37 = objc_autoreleasePoolPush();
    v38 = self;
    v39 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
    {
      v40 = HMFGetLogIdentifier();
      [v12 name];
      v41 = v80 = v37;
      [v12 uniqueIdentifier];
      v42 = v13;
      v44 = v43 = v18;
      *buf = 138544386;
      v94 = v40;
      v95 = 2112;
      v96 = v41;
      v97 = 2112;
      v98 = v44;
      v99 = 2112;
      v100 = v84;
      v101 = 2112;
      v102 = v83;
      _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ setting pairing username and pubkey to ('%@', '%@')", buf, 0x34u);

      v18 = v43;
      v13 = v42;

      v37 = v80;
    }

    objc_autoreleasePoolPop(v37);
    [(HMDAppleMediaAccessorySensorModel *)v28 setPairingUsername:v84];
    [(HMDAppleMediaAccessorySensorModel *)v28 setPublicKey:v83];
  }

  else
  {
    v45 = objc_autoreleasePoolPush();
    v46 = self;
    v47 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v48 = v13;
      v50 = v49 = v18;
      v51 = [(HMDAppleMediaAccessorySensorModel *)v28 providedName];
      *buf = 138544130;
      v94 = v50;
      v95 = 2112;
      v96 = v51;
      v97 = 2112;
      v98 = v84;
      v99 = 2112;
      v100 = v82;
      _os_log_impl(&dword_2531F8000, v47, OS_LOG_TYPE_ERROR, "%{public}@Failed to read public key for accessory %@ with pairing username %@: %@", buf, 0x2Au);

      v18 = v49;
      v13 = v48;
    }

    objc_autoreleasePoolPop(v45);
  }

  if (v81)
  {
    v52 = [(HMDHome *)self accessoryWithUUID:v81];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    v54 = [v81 UUIDString];
    if ((isKindOfClass & 1) != 0 && v52)
    {
      [(HMDAppleMediaAccessorySensorModel *)v28 setHostAccessoryUUID:v54];
    }

    else
    {
      [(HMDAppleMediaAccessorySensorModel *)v28 setBridgeUUID:v54];
    }
  }

  v55 = [(HMDAppleMediaAccessorySensorModel *)v28 hostAccessoryUUID];
  v56 = v55;
  if (v85 && !v55 && v18)
  {
    v57 = [v18 sensorAccessoryUUID];
    v58 = [v57 hmf_isEqualToUUID:v85];

    if (!v58)
    {
      goto LABEL_40;
    }

    v56 = [v18 uuid];
    v59 = [v56 UUIDString];
    [(HMDAppleMediaAccessorySensorModel *)v28 setHostAccessoryUUID:v59];
  }

LABEL_40:
  v60 = [v13 category];

  if (!v60)
  {
    v61 = [v12 category];

    if (v61)
    {
      v62 = [v12 category];
      [(HMDAppleMediaAccessorySensorModel *)v28 setAccessoryCategory:v62];
    }

    else
    {
      v62 = [(HMDHome *)self dataSource];
      v63 = [v62 hapMetadata];
      v64 = [v63 categoryForOther];
      v65 = [v64 identifier];
      [(HMDAppleMediaAccessorySensorModel *)v28 setAccessoryCategory:v65];
    }
  }

  v66 = [MEMORY[0x277CBEB58] set];
  v67 = MEMORY[0x277CBEB58];
  v68 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v12, "linkType")}];
  v69 = [v67 setWithObject:v68];

  v70 = [v12 servicesOfType:@"00000701-0000-1000-8000-0026BB765291"];
  v71 = [v70 count];

  if (v71)
  {
    [v69 addObject:&unk_2866277D8];
  }

  v88[0] = MEMORY[0x277D85DD0];
  v88[1] = 3221225472;
  v88[2] = __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke;
  v88[3] = &unk_279722210;
  v72 = v66;
  v89 = v72;
  v90 = v12;
  v73 = v12;
  [v69 na_each:v88];
  v74 = [v13 transportInformationInstances];
  v86[0] = MEMORY[0x277D85DD0];
  v86[1] = 3221225472;
  v86[2] = __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke_2;
  v86[3] = &unk_279722238;
  v87 = v72;
  v75 = v72;
  [v74 na_each:v86];

  v76 = [v75 allObjects];
  [(HMDAppleMediaAccessorySensorModel *)v28 setTransportInformation:v76];

  v77 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v73, "communicationProtocol")}];
  [(HMDAppleMediaAccessorySensorModel *)v28 setCommunicationProtocol:v77];

  v78 = *MEMORY[0x277D85DE8];

  return v28;
}

void __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke(uint64_t a1, void *a2)
{
  v11[3] = *MEMORY[0x277D85DE8];
  v10[0] = @"HM.serverIdentifier";
  v3 = *(a1 + 32);
  v4 = *(a1 + 40);
  v5 = a2;
  v6 = [v4 serverIdentifier];
  v11[0] = v6;
  v10[1] = @"HM.instanceID";
  v7 = [*(a1 + 40) instanceID];
  v10[2] = @"linkType";
  v11[1] = v7;
  v11[2] = v5;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v11 forKeys:v10 count:3];
  [v3 addObject:v8];

  v9 = *MEMORY[0x277D85DE8];
}

void __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 transportInfoDictionary];
  [v2 addObject:v3];
}

- (id)getServiceTransaction:(id)a3 parentUUID:(id)a4 changeType:(unint64_t)a5
{
  v7 = a3;
  v8 = a4;
  v9 = [v7 instanceID];
  v10 = [HMDService generateUUIDWithAccessoryUUID:v8 serviceID:v9];

  v11 = [(HMDBackingStoreModelObject *)[HMDServiceTransaction alloc] initWithObjectChangeType:a5 uuid:v10 parentUUID:v8];
  if (v7)
  {
    v12 = [v7 instanceID];
    [(HMDServiceTransaction *)v11 setInstanceID:v12];

    v13 = [v7 type];
    [(HMDServiceTransaction *)v11 setServiceType:v13];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v7;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v15 = v14;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;

      v17 = [v16 endpoint];

      [(HMDServiceTransaction *)v11 setMatterEndpointID:v17];
    }

    v18 = [v7 linkedServices];

    if (v18)
    {
      v19 = [v7 linkedServices];
      v20 = [v19 copy];
      [(HMDServiceTransaction *)v11 setLinkedServices:v20];
    }

    v21 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v7, "serviceProperties")}];
    [(HMDServiceTransaction *)v11 setServiceProperties:v21];
  }

  return v11;
}

- (void)evaluateResidentUpdate
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __33__HMDHome_evaluateResidentUpdate__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)reEvaluateHomeHubState
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __33__HMDHome_reEvaluateHomeHubState__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v3, block);
}

void __33__HMDHome_reEvaluateHomeHubState__block_invoke(uint64_t a1)
{
  v17[1] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) residentDeviceManager];
  v3 = [v2 residentDevices];

  v4 = 2 * ([v3 count] != 0);
  v5 = [*(a1 + 32) residentDeviceManager];
  v6 = [v5 primaryResidentDevice];

  if ([v6 isEnabled] && objc_msgSend(v6, "isReachable"))
  {
    v4 = 1;
  }

  v7 = *(a1 + 32);
  if (*(v7 + 784) != v4)
  {
    *(v7 + 784) = v4;
    v8 = MEMORY[0x277D0F818];
    v9 = *MEMORY[0x277CCFFF8];
    v16 = *MEMORY[0x277CCFFF0];
    v10 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(*(a1 + 32), "homeHubState")}];
    v17[0] = v10;
    v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:&v16 count:1];
    v12 = [v8 messageWithName:v9 messagePayload:v11];

    v13 = [*(a1 + 32) msgDispatcher];
    v14 = [*(a1 + 32) uuid];
    [v13 sendMessage:v12 target:v14];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (id)matterAccessoriesWithNewFirmwareInstalledInHome
{
  v37 = *MEMORY[0x277D85DE8];
  v24 = [MEMORY[0x277CBEB18] array];
  if (([(HMDHome *)self isOwnerUser]|| [(HMDHome *)self isSharedAdmin]) && ![(HMDHome *)self isAutomaticThirdPartyAccessorySoftwareUpdateEnabled])
  {
    v28 = 0u;
    v29 = 0u;
    v26 = 0u;
    v27 = 0u;
    v3 = [(HMDHome *)self accessories];
    v4 = [v3 copy];

    v5 = [v4 countByEnumeratingWithState:&v26 objects:v36 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v27;
      v21 = self;
      v23 = v4;
      v20 = *v27;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v27 != v7)
          {
            objc_enumerationMutation(v4);
          }

          v9 = *(*(&v26 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v10 = v9;
          }

          else
          {
            v10 = 0;
          }

          v11 = v10;

          if ([v11 supportsCHIP])
          {
            v12 = [v9 softwareUpdate];
            v13 = v12;
            if (v12 && [v12 state] == 4)
            {
              context = objc_autoreleasePoolPush();
              v14 = self;
              v15 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
              {
                v16 = HMFGetLogIdentifier();
                v22 = [v9 uuid];
                v17 = [v22 UUIDString];
                *buf = 138543874;
                v31 = v16;
                v32 = 2114;
                v33 = v17;
                v34 = 2112;
                v35 = v13;
                _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ has a firmware recently installed, softwareUpdate %@", buf, 0x20u);

                self = v21;
                v7 = v20;
              }

              objc_autoreleasePoolPop(context);
              [v24 addObject:v9];
              v4 = v23;
            }
          }
        }

        v6 = [v4 countByEnumeratingWithState:&v26 objects:v36 count:16];
      }

      while (v6);
    }
  }

  v18 = *MEMORY[0x277D85DE8];

  return v24;
}

- (void)_handleConfirmResidentRequest:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self residentDeviceManager];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome__handleConfirmResidentRequest___block_invoke;
  v7[3] = &unk_2797359D8;
  v8 = v4;
  v6 = v4;
  [v5 confirmWithCompletionHandler:v7];
}

- (id)namesOfServicesWithNewFirmwareAvailableInHome
{
  v84 = *MEMORY[0x277D85DE8];
  v67 = [MEMORY[0x277CBEB18] array];
  if ([(HMDHome *)self isOwnerUser])
  {
    v73 = 0u;
    v74 = 0u;
    v71 = 0u;
    v72 = 0u;
    v3 = [(HMDHome *)self accessories];
    v4 = [v3 copy];

    obj = v4;
    v5 = [v4 countByEnumeratingWithState:&v71 objects:v83 count:16];
    if (!v5)
    {
      goto LABEL_56;
    }

    v7 = v5;
    v8 = *v72;
    *&v6 = 138544130;
    v59 = v6;
    v68 = *v72;
    while (1)
    {
      v9 = 0;
      v69 = v7;
      do
      {
        if (*v72 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v10 = *(*(&v71 + 1) + 8 * v9);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & 1) != 0 && v10)
        {
          if (!-[HMDHome isAutomaticThirdPartyAccessorySoftwareUpdateEnabled](self, "isAutomaticThirdPartyAccessorySoftwareUpdateEnabled") || (-[HMDHome residentDeviceManager](self, "residentDeviceManager"), v12 = objc_claimAutoreleasedReturnValue(), [v12 availableResidentDevices], v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "count"), v13, v12, !v14))
          {
            v15 = self;
            v16 = v10;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v17 = v16;
            }

            else
            {
              v17 = 0;
            }

            v18 = v17;

            if (![v18 supportsCHIP])
            {
              v20 = [v16 vendorInfo];
              v34 = [v16 firmwareVersion];
              if (v34 && [v16 isPrimary])
              {
                v35 = [v20 firmwareVersion];
                v36 = [v16 firmwareVersion];
                v37 = [v35 isGreaterThanVersion:v36];
              }

              else
              {
                v37 = 0;
              }

              if (v20 && ([v20 firmwareVersion], (v38 = objc_claimAutoreleasedReturnValue()) != 0) && (v39 = v38, v40 = objc_msgSend(v16, "isPrimary"), v39, (v40 & 1) != 0))
              {
                if (!v37)
                {
                  self = v15;
                  v8 = v68;
                  goto LABEL_51;
                }

                v41 = objc_autoreleasePoolPush();
                v42 = v15;
                v43 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
                {
                  v44 = HMFGetLogIdentifier();
                  v62 = [v16 uuid];
                  v45 = [v62 UUIDString];
                  [v20 firmwareVersion];
                  v46 = v65 = v41;
                  [v20 productData];
                  v47 = v60 = v42;
                  *buf = v59;
                  v76 = v44;
                  v77 = 2114;
                  v78 = v45;
                  v79 = 2114;
                  v80 = v46;
                  v81 = 2112;
                  v82 = v47;
                  _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ has a firmware update, vendor database indicates available firmware version %{public}@ for product data %@", buf, 0x2Au);

                  v42 = v60;
                  v41 = v65;
                }

                objc_autoreleasePoolPop(v41);
                v27 = [v16 namesOfServicesShowingTilesInHomeApp];
                [v67 addObjectsFromArray:v27];
              }

              else
              {
                v48 = [v16 softwareUpdate];
                v27 = v48;
                if (v48 && [v48 state] == 2)
                {
                  v49 = objc_autoreleasePoolPush();
                  v50 = v15;
                  v51 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
                  {
                    v61 = HMFGetLogIdentifier();
                    v63 = [v16 uuid];
                    [v63 UUIDString];
                    v52 = v66 = v49;
                    v53 = [v16 firmwareVersion];
                    *buf = 138543874;
                    v76 = v61;
                    v77 = 2114;
                    v78 = v52;
                    v79 = 2114;
                    v80 = v53;
                    v54 = v53;
                    _os_log_impl(&dword_2531F8000, v51, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ currentFirmwareVersion %{public}@ has a firmware update", buf, 0x20u);

                    v49 = v66;
                  }

                  objc_autoreleasePoolPop(v49);
                  v55 = [v16 name];
                  [v67 addObject:v55];
                }
              }

              self = v15;
              v8 = v68;
              goto LABEL_50;
            }

            v19 = [v16 softwareUpdate];
            v20 = v19;
            if (v19 && [v19 state] == 2)
            {
              v21 = objc_autoreleasePoolPush();
              v22 = v15;
              v23 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
              {
                v24 = HMFGetLogIdentifier();
                [v16 uuid];
                v25 = v64 = v21;
                v26 = [v25 UUIDString];
                *buf = 138543618;
                v76 = v24;
                v77 = 2114;
                v78 = v26;
                _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Matter accessory %{public}@ has a firmware update", buf, 0x16u);

                v21 = v64;
              }

              objc_autoreleasePoolPop(v21);
              v27 = [v16 name];
              [v67 addObject:v27];
              self = v15;
              v8 = v68;
              goto LABEL_50;
            }

            self = v15;
            v8 = v68;
LABEL_51:

            v7 = v69;
          }
        }

        else
        {
          v28 = v10;
          objc_opt_class();
          v29 = objc_opt_isKindOfClass();

          if ((v29 & 1) != 0 && v10 && ![(HMDHome *)self isAutomaticSoftwareUpdateEnabled])
          {
            v30 = v28;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v31 = v30;
            }

            else
            {
              v31 = 0;
            }

            v18 = v31;

            v32 = [v18 softwareUpdate];
            v20 = v32;
            if (!v32)
            {
              goto LABEL_51;
            }

            v33 = [v32 state];
            if (v33 >= 2)
            {
              if (v33 == 2)
              {
                goto LABEL_49;
              }
            }

            else
            {
              if (![v18 supportsTVOSUpdateManualUpdateAvailableNotification])
              {
                goto LABEL_51;
              }

LABEL_49:
              v27 = [v18 name];
              [v67 addObject:v27];
LABEL_50:
            }

            goto LABEL_51;
          }
        }

        ++v9;
      }

      while (v7 != v9);
      v56 = [obj countByEnumeratingWithState:&v71 objects:v83 count:16];
      v7 = v56;
      if (!v56)
      {
LABEL_56:

        break;
      }
    }
  }

  v57 = *MEMORY[0x277D85DE8];

  return v67;
}

- (BOOL)_hasPairedReachableBTLEAccessories
{
  v2 = [(HMDHome *)self hapAccessories];
  v3 = [v2 na_any:&__block_literal_global_938];

  return v3;
}

unint64_t __45__HMDHome__hasPairedReachableBTLEAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 hasBTLELink])
  {
    v3 = ([v2 reachableTransports] >> 1) & 1;
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)_registerForReachabilityChangeNotificationsEnabled:(BOOL)a3 completionHandler:(id)a4
{
  v4 = a3;
  v33 = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = [(HMDHome *)self isCurrentDevicePrimaryResident];
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  v11 = v10;
  if (v7)
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v30 = v12;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability notifications because we are the primary resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    v6[2](v6, 1);
  }

  else
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMFBooleanToString();
      *buf = 138543618;
      v30 = v13;
      v31 = 2112;
      v32 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Setting remote accessory reachability notifications enabled to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v15 = [(HMDHome *)v9 uuid];
    v16 = [v15 UUIDString];

    v27 = *MEMORY[0x277CD0640];
    v28 = v16;
    v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v28 forKeys:&v27 count:1];
    objc_initWeak(buf, v9);
    if (v4)
    {
      v18 = @"kEnableAccessoryReachabilityNotificationRequestKey";
    }

    else
    {
      v18 = @"kDisableAccessoryReachabilityNotificationRequestKey";
    }

    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __80__HMDHome__registerForReachabilityChangeNotificationsEnabled_completionHandler___block_invoke;
    v23[3] = &unk_2797221E8;
    objc_copyWeak(&v25, buf);
    v26 = v4;
    v24 = v6;
    v19 = [HMDRemoteMessage messageWithName:v18 messagePayload:v17 responseHandler:v23];
    v20 = [(HMDHome *)v9 uuid];
    v21 = [(HMDHome *)v9 workQueue];
    [(HMDHome *)v9 redispatchToResidentMessage:v19 target:v20 responseQueue:v21];

    objc_destroyWeak(&v25);
    objc_destroyWeak(buf);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome__registerForReachabilityChangeNotificationsEnabled_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v28 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (!WeakRetained)
  {
    goto LABEL_15;
  }

  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (!v11)
    {
      goto LABEL_13;
    }

    v12 = HMFGetLogIdentifier();
    v13 = *(a1 + 48);
    v22 = 138543874;
    v23 = v12;
    if (v13)
    {
      v14 = "register";
    }

    else
    {
      v14 = "de-register";
    }

    v24 = 2080;
    v25 = v14;
    v26 = 2112;
    v27 = v5;
    v15 = "%{public}@Failed to %s remote accessory reachability notification with error: %@";
    v16 = v10;
    v17 = 32;
  }

  else
  {
    if (!v11)
    {
      goto LABEL_13;
    }

    v18 = HMFGetLogIdentifier();
    v12 = v18;
    v19 = "de-registered";
    if (*(a1 + 48))
    {
      v19 = "registered";
    }

    v22 = 138543618;
    v23 = v18;
    v24 = 2080;
    v25 = v19;
    v15 = "%{public}@Successfully %s remote accessory reachability notification";
    v16 = v10;
    v17 = 22;
  }

  _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, v15, &v22, v17);

LABEL_13:
  objc_autoreleasePoolPop(v8);
  v20 = *(a1 + 32);
  if (v20)
  {
    (*(v20 + 16))(v20, v5 == 0);
  }

LABEL_15:

  v21 = *MEMORY[0x277D85DE8];
}

- (BOOL)currentRemoteReachabilityRegistration
{
  v2 = [(HMDHome *)self stagedRemoteReachabilityRegistration];
  v3 = [v2 value];

  LOBYTE(v2) = [v3 BOOLValue];
  return v2;
}

- (id)_primaryAccessoryForServer:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  [(HMDHome *)self hapAccessoriesForServer:v4];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v5 = v18 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        if ([v9 isPrimary])
        {
          v14 = 0;
          v10 = [v4 identifier];
          v11 = [v9 matchesHAPAccessoryWithServerIdentifier:v10 linkType:&v14];

          if (v11)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_12:

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (id)hapAccessoriesForServer:(id)a3
{
  v4 = a3;
  v5 = [v4 identifier];
  v6 = [v4 linkType];

  v7 = [(HMDHome *)self hapAccessoriesForServer:v5 linkType:v6];

  return v7;
}

- (id)hapAccessoriesForServer:(id)a3 linkType:(int64_t)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [(HMDHome *)self accessories];
  v8 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v7, "count")}];
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v9 = v7;
  v10 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v21;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v21 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = *(*(&v20 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v16 = v15;

        if (v16)
        {
          v19 = a4;
          if ([v16 matchesHAPAccessoryWithServerIdentifier:v6 linkType:&v19])
          {
            [v8 addObject:v16];
          }
        }
      }

      v11 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
    }

    while (v11);
  }

  v17 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)readProfileState:(id)a3 viaDevice:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __38__HMDHome_readProfileState_viaDevice___block_invoke;
  block[3] = &unk_279734960;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(v8, block);
}

- (void)_getRunTimeStateUpdateWithOptions:(unint64_t)a3 includeMediaAccessorySessionState:(BOOL)a4 includeResidentDeviceState:(BOOL)a5 completion:(id)a6
{
  v6 = a5;
  v93 = a4;
  v7 = a3;
  v112 = *MEMORY[0x277D85DE8];
  v9 = a6;
  v10 = v9;
  if (!v9)
  {
    goto LABEL_80;
  }

  v75 = v6;
  v76 = v9;
  v11 = [(HMDHome *)self accessories];
  v12 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v11, "count")}];
  v78 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v77 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v11, "count")}];
  v79 = [(HMDHome *)self supportsUnifiedMediaNotificationsOnResidents];
  v103 = 0u;
  v104 = 0u;
  v105 = 0u;
  v106 = 0u;
  obj = v11;
  v80 = self;
  v86 = v12;
  v92 = [obj countByEnumeratingWithState:&v103 objects:v111 count:16];
  if (!v92)
  {
    goto LABEL_59;
  }

  v91 = v7 & 0x201;
  v90 = v7 & 0x50;
  v89 = *v104;
  v85 = *MEMORY[0x277CD0938];
  v84 = *MEMORY[0x277CD0990];
  v83 = *MEMORY[0x277CD0960];
  v82 = *MEMORY[0x277CD09B0];
  v81 = *MEMORY[0x277CD0920];
  v88 = v7;
  do
  {
    for (i = 0; i != v92; ++i)
    {
      if (*v104 != v89)
      {
        objc_enumerationMutation(obj);
      }

      v14 = *(*(&v103 + 1) + 8 * i);
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v15 = v14;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;

      v17 = v16;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v18 = v17;
      }

      else
      {
        v18 = 0;
      }

      v19 = v18;

      v20 = v17;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v21 = v20;
      }

      else
      {
        v21 = 0;
      }

      v22 = v21;

      v23 = v14;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v24 = v23;
      }

      else
      {
        v24 = 0;
      }

      v25 = v24;

      if (v20)
      {
        v26 = v93;
      }

      else
      {
        v26 = 0;
      }

      if (v90)
      {
        v27 = v22 == 0;
      }

      else
      {
        v27 = 1;
      }

      v28 = !v27;
      v94 = v19;
      if (v91)
      {
        v29 = v25 == 0;
      }

      else
      {
        v29 = 1;
      }

      v30 = !v29;
      if (v26 || (v28 & 1) != 0 || ((v19 != 0) & (v7 >> 8)) != 0 || (v30 & 1) != 0 || (v7 & 0x400) != 0 && [v25 hasTelevisionService])
      {
        v31 = [v23 runtimeState];
        v32 = [v31 mutableCopy];

        if (v20 && v93)
        {
          v33 = [v20 mediaProfile];
          v34 = v33;
          if (v33)
          {
            v35 = [v33 mediaSession];
            v36 = [v35 state];
            if (v36)
            {
              v37 = v36;
              goto LABEL_46;
            }

            v38 = [v20 identifier];
            v37 = [(HMDHome *)v80 mediaSessionStateWithIdentifier:v38];

            if (v37)
            {
LABEL_46:
              v39 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v37, "playbackState")}];
              [v32 setObject:v39 forKeyedSubscript:v85];

              v40 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v37, "shuffleState")}];
              [v32 setObject:v40 forKeyedSubscript:v84];

              v41 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v37, "repeatState")}];
              [v32 setObject:v41 forKeyedSubscript:v83];

              v42 = [v37 volume];
              [v32 setObject:v42 forKeyedSubscript:v82];

              v43 = [v37 mediaUniqueIdentifier];
              [v32 setObject:v43 forKeyedSubscript:v81];
            }

            if (!v35)
            {
              v44 = [v22 device];
              if ((v44 == 0) | v79 & 1)
              {
                [v77 addObject:v34];
              }

              else
              {
                v45 = [v78 objectForKey:v44];
                if (!v45)
                {
                  v45 = [MEMORY[0x277CBEB18] array];
                  [v78 setObject:v45 forKey:v44];
                }

                [v45 addObject:v34];
              }
            }

            v12 = v86;
          }
        }

        v46 = [v32 copy];
        v47 = [v23 uuid];
        v48 = [v47 UUIDString];
        [v12 setObject:v46 forKeyedSubscript:v48];

        v7 = v88;
      }
    }

    v92 = [obj countByEnumeratingWithState:&v103 objects:v111 count:16];
  }

  while (v92);
LABEL_59:

  v109 = *MEMORY[0x277CCE7A8];
  v49 = [v12 copy];
  v110 = v49;
  v50 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v110 forKeys:&v109 count:1];
  v51 = [v50 mutableCopy];

  v10 = v76;
  v52 = v80;
  if (v75)
  {
    v53 = [(HMDHome *)v80 residentDeviceManager];
    v54 = [v53 residentDevices];

    v55 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(v54, "count")}];
    v99 = 0u;
    v100 = 0u;
    v101 = 0u;
    v102 = 0u;
    v56 = v54;
    v57 = [v56 countByEnumeratingWithState:&v99 objects:v108 count:16];
    if (v57)
    {
      v58 = v57;
      v59 = *v100;
      do
      {
        for (j = 0; j != v58; ++j)
        {
          if (*v100 != v59)
          {
            objc_enumerationMutation(v56);
          }

          v61 = *(*(&v99 + 1) + 8 * j);
          v62 = [v61 identifier];
          v63 = [v62 UUIDString];

          v64 = [v61 runtimeState];
          [v55 setObject:v64 forKey:v63];
        }

        v58 = [v56 countByEnumeratingWithState:&v99 objects:v108 count:16];
      }

      while (v58);
    }

    v65 = [v55 copy];
    [v51 setObject:v65 forKey:*MEMORY[0x277CD0550]];

    v52 = v80;
    v12 = v86;
  }

  v66 = [v51 copy];
  v76[2](v76, v66);

  if ([v77 count])
  {
    [(HMDHome *)v52 _readProfileState:v77 viaDevice:0];
  }

  v97 = 0u;
  v98 = 0u;
  v95 = 0u;
  v96 = 0u;
  v67 = v78;
  v68 = [v67 countByEnumeratingWithState:&v95 objects:v107 count:16];
  if (v68)
  {
    v69 = v68;
    v70 = *v96;
    do
    {
      for (k = 0; k != v69; ++k)
      {
        if (*v96 != v70)
        {
          objc_enumerationMutation(v67);
        }

        v72 = *(*(&v95 + 1) + 8 * k);
        v73 = [v67 objectForKey:v72];
        if ([v73 count])
        {
          [(HMDHome *)v52 _readProfileState:v73 viaDevice:v72];
        }
      }

      v69 = [v67 countByEnumeratingWithState:&v95 objects:v107 count:16];
    }

    while (v69);
  }

LABEL_80:
  v74 = *MEMORY[0x277D85DE8];
}

- (void)getRunTimeStateUpdateWithOptions:(unint64_t)a3 includeMediaAccessorySessionState:(BOOL)a4 includeResidentDeviceState:(BOOL)a5 completion:(id)a6
{
  v10 = a6;
  v11 = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __116__HMDHome_getRunTimeStateUpdateWithOptions_includeMediaAccessorySessionState_includeResidentDeviceState_completion___block_invoke;
  v13[3] = &unk_2797221C0;
  v14 = v10;
  v15 = a3;
  v16 = a4;
  v17 = a5;
  v13[4] = self;
  v12 = v10;
  dispatch_async(v11, v13);
}

- (void)checkTimerTriggers
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_checkTimerTriggers__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v3, block);
}

void __29__HMDHome_checkTimerTriggers__block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v1 = [*(a1 + 32) triggers];
  v2 = [v1 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = *v9;
    do
    {
      v5 = 0;
      do
      {
        if (*v9 != v4)
        {
          objc_enumerationMutation(v1);
        }

        v6 = *(*(&v8 + 1) + 8 * v5);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [v6 completeConfiguration];
        }

        ++v5;
      }

      while (v3 != v5);
      v3 = [v1 countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v3);
  }

  v7 = *MEMORY[0x277D85DE8];
}

- (id)migrateOwnedTriggers
{
  v40 = *MEMORY[0x277D85DE8];
  v27 = [MEMORY[0x277CBEB18] array];
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_ownedTriggers copy];
  os_unfair_recursive_lock_unlock();
  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  obj = [(HMDHome *)self triggers];
  v4 = [obj countByEnumeratingWithState:&v29 objects:v39 count:16];
  if (!v4)
  {
    goto LABEL_17;
  }

  v6 = *v30;
  *&v5 = 138543618;
  v26 = v5;
  do
  {
    for (i = 0; i != v4; ++i)
    {
      if (*v30 != v6)
      {
        objc_enumerationMutation(obj);
      }

      v8 = *(*(&v29 + 1) + 8 * i);
      v9 = [v8 uuid];
      if (([v3 containsObject:v9] & 1) == 0)
      {

        continue;
      }

      v10 = [v8 owningDevice];
      if (v10)
      {
        v11 = [v8 isOwnedByThisDevice];

        if (v11)
        {
          continue;
        }
      }

      else
      {
      }

      v12 = [(HMDHome *)self currentUser];
      [v8 setOwner:v12];

      v13 = [(HMDHome *)self currentDevice];
      [v8 setOwningDevice:v13];

      v14 = [v8 uuid];
      v15 = [v14 UUIDString];
      [v27 addObject:v15];

      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        *buf = v26;
        v36 = v19;
        v37 = 2112;
        v38 = v8;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Updating owning device for trigger %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
    }

    v4 = [obj countByEnumeratingWithState:&v29 objects:v39 count:16];
  }

  while (v4);
LABEL_17:

  if ([v27 count])
  {
    v34[0] = v27;
    v20 = *MEMORY[0x277CD0640];
    v33[0] = @"triggerUUID";
    v33[1] = v20;
    v21 = [(HMDHome *)self uuid];
    v22 = [v21 UUIDString];
    v34[1] = v22;
    v23 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v34 forKeys:v33 count:2];
  }

  else
  {
    v23 = 0;
  }

  v24 = *MEMORY[0x277D85DE8];

  return v23;
}

- (id)performReadRequests:(id)a3 withRetries:(int64_t)a4 timeInterval:(double)a5 loggingObject:(id)a6 flow:(id)a7
{
  v55 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v39 = a6;
  v38 = a7;
  v11 = [MEMORY[0x277CBEB38] dictionary];
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v12 = v10;
  v13 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v51;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v51 != v15)
        {
          objc_enumerationMutation(v12);
        }

        v17 = *(*(&v50 + 1) + 8 * i);
        v18 = [v17 characteristic];
        v19 = [v18 service];
        v20 = [v19 accessory];
        v21 = [v20 uuid];

        v22 = [v11 objectForKeyedSubscript:v21];

        if (v22)
        {
          v23 = [v11 objectForKeyedSubscript:v21];
          [v23 addObject:v17];
        }

        else
        {
          v23 = [MEMORY[0x277CBEB18] arrayWithObject:v17];
          [v11 setObject:v23 forKeyedSubscript:v21];
        }
      }

      v14 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
    }

    while (v14);
  }

  v24 = [v11 allValues];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke;
  v45[3] = &unk_279722178;
  v49 = a5;
  v48 = a4;
  v45[4] = self;
  v25 = v39;
  v46 = v25;
  v26 = v38;
  v47 = v26;
  v27 = [v24 na_map:v45];

  v28 = MEMORY[0x277D2C900];
  v29 = MEMORY[0x277D2C938];
  v30 = [(HMDHome *)self workQueue];
  v31 = [v29 schedulerWithDispatchQueue:v30];
  v32 = [v28 combineAllFutures:v27 ignoringErrors:1 scheduler:v31];
  v42[0] = MEMORY[0x277D85DD0];
  v42[1] = 3221225472;
  v42[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_922;
  v42[3] = &unk_279730870;
  v43 = v25;
  v44 = v26;
  v33 = v26;
  v34 = v25;
  v35 = [v32 flatMap:v42];

  v36 = *MEMORY[0x277D85DE8];

  return v35;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = MEMORY[0x277D2C900];
  v5 = *(a1 + 56);
  v6 = *(a1 + 64);
  v7 = [*(a1 + 32) workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2;
  v13[3] = &unk_279722150;
  v14 = *(a1 + 40);
  v8 = *(a1 + 48);
  v9 = *(a1 + 32);
  v15 = v8;
  v16 = v9;
  v17 = v3;
  v10 = v3;
  v11 = [v4 futureWithRetries:v5 timeInterval:v7 workQueue:v13 block:v6];

  return v11;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_922(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 na_map:&__block_literal_global_925];
  if ([v4 hmf_isEmpty])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 40) UUID];
      v17 = 138543618;
      v18 = v8;
      v19 = 2112;
      v20 = v9;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] All read request retries failed.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v12 = [v10 futureWithError:v11];
  }

  else
  {
    v13 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CBEAC0] dictionaryByCombiningNonOverlappingDictionaries:v4];
    v12 = [v13 futureWithResult:v11];
  }

  v14 = v12;

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

void *__75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2_923(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v12 = 138543874;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2048;
    v17 = a2;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Performing characteristic read requests with remaining retries: %ld", &v12, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = [*(a1 + 48) performReadRequests:*(a1 + 56) loggingObject:*(a1 + 32) flow:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)performWriteRequests:(id)a3 withRetries:(int64_t)a4 timeInterval:(double)a5 loggingObject:(id)a6 flow:(id)a7
{
  v55 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v39 = a6;
  v38 = a7;
  v11 = [MEMORY[0x277CBEB38] dictionary];
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v12 = v10;
  v13 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v51;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v51 != v15)
        {
          objc_enumerationMutation(v12);
        }

        v17 = *(*(&v50 + 1) + 8 * i);
        v18 = [v17 characteristic];
        v19 = [v18 service];
        v20 = [v19 accessory];
        v21 = [v20 uuid];

        v22 = [v11 objectForKeyedSubscript:v21];

        if (v22)
        {
          v23 = [v11 objectForKeyedSubscript:v21];
          [v23 addObject:v17];
        }

        else
        {
          v23 = [MEMORY[0x277CBEB18] arrayWithObject:v17];
          [v11 setObject:v23 forKeyedSubscript:v21];
        }
      }

      v14 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
    }

    while (v14);
  }

  v24 = [v11 allValues];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke;
  v45[3] = &unk_279722178;
  v49 = a5;
  v48 = a4;
  v45[4] = self;
  v25 = v39;
  v46 = v25;
  v26 = v38;
  v47 = v26;
  v27 = [v24 na_map:v45];

  v28 = MEMORY[0x277D2C900];
  v29 = MEMORY[0x277D2C938];
  v30 = [(HMDHome *)self workQueue];
  v31 = [v29 schedulerWithDispatchQueue:v30];
  v32 = [v28 combineAllFutures:v27 ignoringErrors:1 scheduler:v31];
  v42[0] = MEMORY[0x277D85DD0];
  v42[1] = 3221225472;
  v42[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_916;
  v42[3] = &unk_279730870;
  v43 = v25;
  v44 = v26;
  v33 = v26;
  v34 = v25;
  v35 = [v32 flatMap:v42];

  v36 = *MEMORY[0x277D85DE8];

  return v35;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = MEMORY[0x277D2C900];
  v5 = *(a1 + 56);
  v6 = *(a1 + 64);
  v7 = [*(a1 + 32) workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2;
  v13[3] = &unk_279722150;
  v14 = *(a1 + 40);
  v8 = *(a1 + 48);
  v9 = *(a1 + 32);
  v15 = v8;
  v16 = v9;
  v17 = v3;
  v10 = v3;
  v11 = [v4 futureWithRetries:v5 timeInterval:v7 workQueue:v13 block:v6];

  return v11;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_916(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 na_map:&__block_literal_global_920];
  if ([v4 hmf_isEmpty])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 40) UUID];
      v17 = 138543618;
      v18 = v8;
      v19 = 2112;
      v20 = v9;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] All write request retries failed.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v12 = [v10 futureWithError:v11];
  }

  else
  {
    v13 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CBEAC0] dictionaryByCombiningNonOverlappingDictionaries:v4];
    v12 = [v13 futureWithResult:v11];
  }

  v14 = v12;

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

void *__76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2_917(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v12 = 138543874;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2048;
    v17 = a2;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Performing characteristic write requests with remaining retries: %ld", &v12, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = [*(a1 + 48) performWriteRequests:*(a1 + 56) loggingObject:*(a1 + 32) flow:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)performReadRequests:(id)a3 loggingObject:(id)a4 flow:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_alloc_init(MEMORY[0x277D2C900]);
  v12 = [(HMDHome *)self description];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __50__HMDHome_performReadRequests_loggingObject_flow___block_invoke;
  v20[3] = &unk_27972CD68;
  v21 = v9;
  v22 = v10;
  v13 = v11;
  v23 = v13;
  v24 = v8;
  v14 = v8;
  v15 = v10;
  v16 = v9;
  [(HMDHome *)self readCharacteristicValues:v14 source:1120 sourceForLogging:v12 qualityOfService:-1 withCompletionHandler:v20];

  v17 = v24;
  v18 = v13;

  return v13;
}

void __50__HMDHome_performReadRequests_loggingObject_flow___block_invoke(id *a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = [a1[7] firstObject];
    v8 = [v7 characteristic];

    v24 = 0;
    v9 = [v6 hmd_valueOfCharacteristic:v8 error:&v24];
    v10 = v24;
    if (v9)
    {
      [a1[6] finishWithResult:v6];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = a1[4];
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        [a1[5] UUID];
        v21 = v23 = v17;
        *buf = 138543874;
        v26 = v20;
        v27 = 2112;
        v28 = v21;
        v29 = 2112;
        v30 = v10;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform read requests with error: %@", buf, 0x20u);

        v17 = v23;
      }

      objc_autoreleasePoolPop(v17);
      [a1[6] finishWithError:v10];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = a1[4];
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [a1[5] UUID];
      *buf = 138543874;
      v26 = v14;
      v27 = 2112;
      v28 = v15;
      v29 = 2112;
      v30 = v5;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform read requests (no response payload) with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = a1[6];
    v8 = [MEMORY[0x277CBEB68] null];
    [v16 finishWithResult:v8];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (id)performWriteRequests:(id)a3 loggingObject:(id)a4 flow:(id)a5
{
  v42 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_alloc_init(MEMORY[0x277D2C900]);
  v12 = [MEMORY[0x277CCAD78] UUID];
  v13 = objc_autoreleasePoolPush();
  v14 = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
  {
    v16 = HMFGetLogIdentifier();
    v17 = [v10 UUID];
    *buf = 0;
    *&buf[8] = 0;
    if (v12)
    {
      [v12 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v32 = *buf;
    v18 = [v8 count];
    *buf = 138544642;
    *&buf[4] = v16;
    *&buf[12] = 2112;
    *&buf[14] = v17;
    v34 = 1042;
    v35 = 16;
    v36 = 2098;
    v37 = &v32;
    v38 = 2114;
    v39 = v14;
    v40 = 2048;
    v41 = v18;
    _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Executing write requests with identifier: %{public,uuid_t}.16P from home: %{public}@ count: %lu for perform write requests", buf, 0x3Au);
  }

  objc_autoreleasePoolPop(v13);
  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __51__HMDHome_performWriteRequests_loggingObject_flow___block_invoke;
  v27[3] = &unk_27972CD68;
  v28 = v9;
  v29 = v10;
  v19 = v11;
  v30 = v19;
  v31 = v8;
  v20 = v8;
  v21 = v10;
  v22 = v9;
  [(HMDHome *)v14 writeCharacteristicValues:v20 source:1120 identifier:v12 transport:0 qualityOfService:-1 withCompletionHandler:v27];
  v23 = v31;
  v24 = v19;

  v25 = *MEMORY[0x277D85DE8];
  return v19;
}

void __51__HMDHome_performWriteRequests_loggingObject_flow___block_invoke(id *a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = [a1[7] firstObject];
    v8 = [v7 characteristic];

    v24 = 0;
    v9 = [v6 hmd_valueOfCharacteristic:v8 error:&v24];
    v10 = v24;
    if (v9)
    {
      [a1[6] finishWithResult:v6];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = a1[4];
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        [a1[5] UUID];
        v21 = v23 = v17;
        *buf = 138543874;
        v26 = v20;
        v27 = 2112;
        v28 = v21;
        v29 = 2112;
        v30 = v10;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform write requests with error: %@", buf, 0x20u);

        v17 = v23;
      }

      objc_autoreleasePoolPop(v17);
      [a1[6] finishWithError:v10];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = a1[4];
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [a1[5] UUID];
      *buf = 138543874;
      v26 = v14;
      v27 = 2112;
      v28 = v15;
      v29 = 2112;
      v30 = v5;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform write requests (no response payload) with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = a1[6];
    v8 = [MEMORY[0x277CBEB68] null];
    [v16 finishWithResult:v8];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (void)writeCharacteristicValues:(id)a3 source:(unint64_t)a4 biomeSource:(unint64_t)a5 identifier:(id)a6 transport:(id)a7 qualityOfService:(int64_t)a8 withCompletionHandler:(id)a9
{
  v15 = a3;
  v16 = a6;
  v17 = a7;
  v18 = a9;
  v19 = objc_alloc(MEMORY[0x277D0F770]);
  v20 = MEMORY[0x277CCACA8];
  v21 = MEMORY[0x259C01AE0](self, a2);
  v22 = [v20 stringWithFormat:@"%@, %s:%ld", v21, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 7421];
  v39 = [v19 initWithName:v22];

  v23 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __116__HMDHome_writeCharacteristicValues_source_biomeSource_identifier_transport_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_279722128;
  v36 = a4;
  v37 = a8;
  v30 = v39;
  v31 = v16;
  v32 = v17;
  v33 = self;
  v38 = a5;
  v34 = v15;
  v35 = v18;
  v24 = v18;
  v25 = v15;
  v26 = v17;
  v27 = v16;
  dispatch_async(v23, block);

  __HMFActivityScopeLeave();
}

void __116__HMDHome_writeCharacteristicValues_source_biomeSource_identifier_transport_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  v23[2] = *MEMORY[0x277D85DE8];
  v22[0] = @"sourceType";
  v2 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 80)];
  v22[1] = @"kMultiPartResponseKey";
  v23[0] = v2;
  v23[1] = MEMORY[0x277CBEC28];
  v3 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v23 forKeys:v22 count:2];

  v4 = objc_alloc(MEMORY[0x277D0F848]);
  v5 = *(a1 + 88);
  v6 = [MEMORY[0x277D0F820] allMessageDestinations];
  v7 = [v4 initWithName:@"kMultipleCharacteristicWriteRequestKey" qualityOfService:v5 destination:v6 payload:v3];

  [v7 setIdentifier:*(a1 + 40)];
  [v7 setTransport:*(a1 + 48)];
  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 56);
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    v12 = [v7 identifier];

    if (v12)
    {
      v13 = [v7 identifier];
      [v13 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v16 = *buf;
    v14 = HMDRequestSourceAsString(*(a1 + 80));
    *buf = 138544130;
    *&buf[4] = v11;
    *&buf[12] = 1042;
    *&buf[14] = 16;
    v18 = 2098;
    v19 = &v16;
    v20 = 2114;
    v21 = v14;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Issuing write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 56) _writeCharacteristicValues:*(a1 + 64) requestMessage:v7 source:*(a1 + 80) biomeSource:*(a1 + 96) withCompletionHandler:*(a1 + 72)];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)regionStateUpdated
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_regionStateUpdated__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v3, block);
}

uint64_t __29__HMDHome_regionStateUpdated__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) homeLocationHandler];
  v3 = [v2 regionStateAtHome];

  if (v3 == 1)
  {
    v4 = [*(a1 + 32) workQueue];
    v5 = v4;
    v8 = MEMORY[0x277D85DD0];
    v9 = 3221225472;
    v10 = __29__HMDHome_regionStateUpdated__block_invoke_905;
    v11 = &unk_279735D00;
    v12 = *(a1 + 32);
    v6 = &v8;
    goto LABEL_5;
  }

  if (v3 == 2)
  {
    v4 = [*(a1 + 32) workQueue];
    v5 = v4;
    v13 = MEMORY[0x277D85DD0];
    v14 = 3221225472;
    v15 = __29__HMDHome_regionStateUpdated__block_invoke_2;
    v16 = &unk_279735D00;
    v17 = *(a1 + 32);
    v6 = &v13;
LABEL_5:
    dispatch_async(v4, v6);
  }

  return [*(a1 + 32) _updateHomeLocation];
}

void __29__HMDHome_regionStateUpdated__block_invoke_2(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Did leave home region", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeRegionExitedNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

void __29__HMDHome_regionStateUpdated__block_invoke_905(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Did enter home region", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeRegionEnteredNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

- (void)suspendedStateChangedForAccessory:(id)a3 suspendedState:(unint64_t)a4
{
  v26 = *MEMORY[0x277D85DE8];
  v6 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  if (v8)
  {
    if (a4 == 2)
    {
      v9 = objc_autoreleasePoolPush();
      v10 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
      {
        v12 = HMFGetLogIdentifier();
        v13 = HAPAccessorySuspendedStateDescription();
        *buf = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = v6;
        _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEBUG, "%{public}@Skipping suspended state update: '%@' for accessory %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v9);
    }

    else
    {
      v14 = [(HMDHome *)self workQueue];
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __60__HMDHome_suspendedStateChangedForAccessory_suspendedState___block_invoke;
      v16[3] = &unk_279733188;
      v16[4] = self;
      v19 = a4;
      v17 = v8;
      v18 = v6;
      dispatch_async(v14, v16);
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

uint64_t __60__HMDHome_suspendedStateChangedForAccessory_suspendedState___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) reachabilityRegisteredDevices];
  v3 = [v2 count];

  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 56);
      v10 = HAPAccessorySuspendedStateDescription();
      v11 = *(a1 + 40);
      v18 = 138543874;
      v19 = v8;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v11;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Notify registered devices of suspended state change to '%@' for accessory: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 32) _updateReachabilityChangeToRegisteredDevices:*(a1 + 48)];
  }

  else
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
    {
      v12 = HMFGetLogIdentifier();
      v13 = *(a1 + 56);
      v14 = HAPAccessorySuspendedStateDescription();
      v15 = *(a1 + 48);
      v18 = 138543874;
      v19 = v12;
      v20 = 2112;
      v21 = v14;
      v22 = 2112;
      v23 = v15;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@No registered devices to send the suspended state change '%@' for accessory %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
  }

  result = [*(a1 + 32) notifyClientsOfReachabilityUpdateForAccessory:*(a1 + 48)];
  v17 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)reachabilityChangedForAccessory:(id)a3 reachable:(BOOL)a4
{
  v6 = a3;
  v7 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __53__HMDHome_reachabilityChangedForAccessory_reachable___block_invoke;
  block[3] = &unk_279734938;
  v10 = v6;
  v11 = self;
  v12 = a4;
  v8 = v6;
  dispatch_async(v7, block);
}

void __53__HMDHome_reachabilityChangedForAccessory_reachable___block_invoke(uint64_t a1)
{
  v22[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  if (v4)
  {
    v5 = *(a1 + 40);
    v22[0] = v4;
    v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v22 count:1];
    [v5 _updateWoWState:v6];
  }

  [*(a1 + 40) _reachabilityChangedForAccessory:*(a1 + 32) reachable:*(a1 + 48)];
  v7 = [*(a1 + 40) reachabilityRegisteredDevices];
  v8 = [v7 count];

  v9 = objc_autoreleasePoolPush();
  v10 = *(a1 + 40);
  v11 = HMFGetOSLogHandle();
  v12 = v11;
  if (v8)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 32);
      v18 = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Notify registered devices of reachability change for accessory: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    [*(a1 + 40) _updateReachabilityChangeToRegisteredDevices:*(a1 + 32)];
  }

  else
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      v16 = *(a1 + 32);
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = v16;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEBUG, "%{public}@No registered devices available to notify reachability change update for accessory: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (id)replaceActionSetName:(id)a3 withNewName:(id)a4
{
  v15[1] = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = a3;
  v8 = [(HMDHome *)self homeManager];
  v9 = [v8 nameValidator];
  v10 = [(HMDHome *)self uuid];
  v15[0] = v10;
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v15 count:1];
  v12 = [v9 replaceActionSetName:v7 withNewName:v6 inNamespaces:v11];

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)replaceName:(id)a3 withNewName:(id)a4
{
  v15[1] = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = a3;
  v8 = [(HMDHome *)self homeManager];
  v9 = [v8 nameValidator];
  v10 = [(HMDHome *)self uuid];
  v15[0] = v10;
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v15 count:1];
  v12 = [v9 replaceName:v7 withNewName:v6 inNamespaces:v11];

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)removeName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 nameValidator];
  v7 = [(HMDHome *)self uuid];
  v8 = [v6 removeName:v4 namespace:v7];

  return v8;
}

- (id)addActionSetName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 nameValidator];
  v7 = [(HMDHome *)self uuid];
  v8 = [v6 addActionSetName:v4 namespace:v7];

  return v8;
}

- (id)addName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 nameValidator];
  v7 = [(HMDHome *)self uuid];
  v8 = [v6 addName:v4 namespace:v7];

  return v8;
}

- (id)validateName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self homeManager];
  v6 = [v5 nameValidator];
  v7 = [v6 validateName:v4];

  return v7;
}

- (void)removeAllHomeContentsAndAccessoryPairings:(BOOL)a3 queue:(id)a4 completionHandler:(id)a5
{
  v24 = *MEMORY[0x277D85DE8];
  v8 = a4;
  v9 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v13;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Removed all home content and accessory pairings", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  v14 = [(HMDHome *)v11 workQueue];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __77__HMDHome_removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke;
  v18[3] = &unk_279732430;
  v21 = a3;
  v18[4] = v11;
  v19 = v8;
  v20 = v9;
  v15 = v9;
  v16 = v8;
  dispatch_async(v14, v18);

  v17 = *MEMORY[0x277D85DE8];
}

- (void)removeCharacteristic:(id)a3
{
  v4 = a3;
  objc_initWeak(&location, self);
  v5 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __32__HMDHome_removeCharacteristic___block_invoke;
  block[3] = &unk_279732E78;
  objc_copyWeak(&v9, &location);
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, block);

  objc_destroyWeak(&v9);
  objc_destroyWeak(&location);
}

void __32__HMDHome_removeCharacteristic___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained && *(a1 + 32))
  {
    v3 = WeakRetained;
    [WeakRetained _removeCharacteristic:?];
    WeakRetained = v3;
  }
}

- (void)removeService:(id)a3
{
  v5 = a3;
  objc_initWeak(&location, self);
  v6 = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __25__HMDHome_removeService___block_invoke;
  v8[3] = &unk_279731EE0;
  objc_copyWeak(v10, &location);
  v9 = v5;
  v10[1] = a2;
  v7 = v5;
  dispatch_async(v6, v8);

  objc_destroyWeak(v10);
  objc_destroyWeak(&location);
}

void __25__HMDHome_removeService___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained && *(a1 + 32))
  {
    v4 = WeakRetained;
    [WeakRetained _removeService:?];
    v3 = NSStringFromSelector(*(a1 + 48));
    [v4 saveWithReason:v3 postSyncNotification:1];

    WeakRetained = v4;
  }
}

- (void)handleSignificantTimeChange
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Going to re-evaluate all the triggers as time has changed significantly", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  v7 = [(HMDHome *)v4 triggers];
  v8 = [v7 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v14;
    do
    {
      v11 = 0;
      do
      {
        if (*v14 != v10)
        {
          objc_enumerationMutation(v7);
        }

        [*(*(&v13 + 1) + 8 * v11++) reEvaluate:1];
      }

      while (v9 != v11);
      v9 = [v7 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v9);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)reEvaluateTriggers
{
  v13 = *MEMORY[0x277D85DE8];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v2 = [(HMDHome *)self triggers];
  v3 = [v2 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v9;
    do
    {
      v6 = 0;
      do
      {
        if (*v9 != v5)
        {
          objc_enumerationMutation(v2);
        }

        [*(*(&v8 + 1) + 8 * v6++) reEvaluate:0];
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v4);
  }

  v7 = *MEMORY[0x277D85DE8];
}

- (id)mediaSystemWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSystems];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)mediaSystemsWithUUIDs:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __33__HMDHome_mediaSystemsWithUUIDs___block_invoke;
  v9[3] = &unk_279726148;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_filter:v9];

  return v7;
}

uint64_t __33__HMDHome_mediaSystemsWithUUIDs___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 uuid];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (void)removeOutgoingInvitation:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_outgoingInvitations removeObject:v4];
  os_unfair_recursive_lock_unlock();
}

- (void)addOutgoingInvitation:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_outgoingInvitations addObject:v4];
  os_unfair_recursive_lock_unlock();
}

- (void)setOutgoingInvitations:(id)a3
{
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [v6 mutableCopy];
  outgoingInvitations = self->_outgoingInvitations;
  self->_outgoingInvitations = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSArray)outgoingInvitations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_outgoingInvitations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (id)outgoingInvitationWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self outgoingInvitations];
  v6 = [v5 hmf_firstObjectWithValue:v4 forKeyPath:@"identifier"];

  return v6;
}

- (id)userWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self users];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)serviceGroupWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self serviceGroups];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)serviceGroupWithName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self serviceGroups];
  v6 = [v5 hmf_firstObjectWithName:v4];

  return v6;
}

- (id)triggerWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self triggers];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)triggerWithName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self triggers];
  v6 = [v5 hmf_firstObjectWithName:v4];

  return v6;
}

- (id)triggerOwnedActionSetWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self triggerOwnedActionSets];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)actionSetWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self actionSets];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)actionSetWithName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self actionSets];
  v6 = [v5 hmf_firstObjectWithName:v4];

  return v6;
}

- (void)_evaluateOwnerTrustZoneCapabilityAndNotify
{
  v13 = *MEMORY[0x277D85DE8];
  if (![(HMDHome *)self isOwnerTrustZoneCapable])
  {
    if (-[HMDHome _isSharedHomeVersionTrustZoneCapable](self, "_isSharedHomeVersionTrustZoneCapable") || (-[HMDHome residentDeviceManager](self, "residentDeviceManager"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 hasTrustZoneCapableResident], v3, v4))
    {
      v5 = objc_autoreleasePoolPush();
      v6 = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        v11 = 138543362;
        v12 = v8;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Owner became trust zone capable after evaluating owner trust zone capability", &v11, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
      [(HMDHome *)v6 setOwnerTrustZoneCapable:1];
      v9 = [(HMDHome *)v6 notificationCenter];
      [v9 postNotificationName:@"HMDHomeOwnerBecameTrustZoneCapableNotification" object:v6];
    }
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleReceivedNonCloudSourcedSharedHomeModel
{
  v13 = *MEMORY[0x277D85DE8];
  if (-[HMDHome _isSharedHomeVersionTrustZoneCapable](self, "_isSharedHomeVersionTrustZoneCapable") || (-[HMDHome residentDeviceManager](self, "residentDeviceManager"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 hasTrustZoneCapableResident], v3, v4))
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Owner became trust zone capable after receiving shared home model", &v11, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 setOwnerTrustZoneCapable:1];
    v9 = [(HMDHome *)v6 notificationCenter];
    [v9 postNotificationName:@"HMDHomeOwnerBecameTrustZoneCapableNotification" object:v6];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isSharedHomeVersionTrustZoneCapable
{
  v2 = [(HMDHome *)self sharedHomeSourceVersion];
  v3 = +[HMDHomeKitVersion version6];
  v4 = [v2 isAtLeastVersion:v3];

  return v4;
}

- (void)setOwnerTrustZoneCapable:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_ownerTrustZoneCapable = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)ownerTrustZoneCapable
{
  os_unfair_recursive_lock_lock_with_options();
  ownerTrustZoneCapable = self->_ownerTrustZoneCapable;
  os_unfair_recursive_lock_unlock();
  return ownerTrustZoneCapable;
}

- (id)zoneWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self zones];
  v6 = [v5 hmf_firstObjectWithUUID:v4];

  return v6;
}

- (id)zoneWithName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self zones];
  v6 = [v5 hmf_firstObjectWithName:v4];

  return v6;
}

- (id)mediaProfileWithUUID:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v5 = [(HMDHome *)self accessories];
  v6 = [v5 countByEnumeratingWithState:&v21 objects:v25 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v22;
LABEL_3:
    v9 = 0;
    while (1)
    {
      if (*v22 != v8)
      {
        objc_enumerationMutation(v5);
      }

      v10 = *(*(&v21 + 1) + 8 * v9);
      objc_opt_class();
      v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
      v12 = v11;

      if (v12)
      {
        v13 = [v12 mediaProfile];
      }

      else
      {
        v14 = v10;
        objc_opt_class();
        v15 = (objc_opt_isKindOfClass() & 1) != 0 ? v14 : 0;
        v16 = v15;

        v13 = [v16 mediaProfile];
      }

      v17 = [v13 uniqueIdentifier];
      v18 = [v17 isEqual:v4];

      if (v18)
      {
        break;
      }

      if (v7 == ++v9)
      {
        v7 = [v5 countByEnumeratingWithState:&v21 objects:v25 count:16];
        if (v7)
        {
          goto LABEL_3;
        }

        goto LABEL_18;
      }
    }
  }

  else
  {
LABEL_18:
    v13 = 0;
  }

  v19 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)accessoryWithSPIClientIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self accessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __44__HMDHome_accessoryWithSPIClientIdentifier___block_invoke;
  v9[3] = &unk_27972C828;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __44__HMDHome_accessoryWithSPIClientIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 spiClientIdentifier];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (id)accessoryWithDeviceIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self accessories];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __41__HMDHome_accessoryWithDeviceIdentifier___block_invoke;
  v11[3] = &unk_27972C828;
  v12 = v4;
  v6 = v4;
  v7 = [v5 na_firstObjectPassingTest:v11];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  return v8;
}

uint64_t __41__HMDHome_accessoryWithDeviceIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 deviceForDirectMessaging];

  v7 = [v6 identifier];
  v8 = [v7 hmf_isEqualToUUID:*(a1 + 32)];

  return v8;
}

- (id)accessoryWithEndpointIdentifier:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithSPIClientIdentifier:a3];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (id)accessoryWithUUID:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableDictionary *)self->_accessories objectForKeyedSubscript:v4];
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (id)roomWithUniqueIdentifier:(id)a3 forClientIdentifierSalt:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self rooms];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __60__HMDHome_roomWithUniqueIdentifier_forClientIdentifierSalt___block_invoke;
  v13[3] = &unk_279722100;
  v14 = v7;
  v15 = v6;
  v9 = v6;
  v10 = v7;
  v11 = [v8 na_firstObjectPassingTest:v13];

  return v11;
}

uint64_t __60__HMDHome_roomWithUniqueIdentifier_forClientIdentifierSalt___block_invoke(uint64_t a1, void *a2)
{
  v3 = MEMORY[0x277CCAD78];
  v4 = [a2 uuid];
  v5 = [v3 hm_deriveUUIDFromBaseUUID:v4 identifierSalt:*(a1 + 32)];

  v6 = [v5 isEqual:*(a1 + 40)];
  return v6;
}

- (id)roomWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self roomForEntireHome];
  v6 = [v5 uuid];
  v7 = [v6 isEqual:v4];

  if (v7)
  {
    v8 = [(HMDHome *)self roomForEntireHome];
  }

  else
  {
    v9 = [(HMDHome *)self rooms];
    v8 = [v9 hmf_firstObjectWithUUID:v4];
  }

  return v8;
}

- (id)roomWithName:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self rooms];
  v6 = [v5 hmf_firstObjectWithName:v4];

  return v6;
}

- (void)_configureBulletinNotification
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  v4 = [(HMDHome *)self hapAccessories];
  v5 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v11;
    do
    {
      v8 = 0;
      do
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(v4);
        }

        [*(*(&v10 + 1) + 8 * v8++) configureBulletinNotification];
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)configureBulletinNotification
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __40__HMDHome_configureBulletinNotification__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)_performPostSaveActionsWithReason:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self isOwnerUser])
  {
    if ([HMDHomeManager doesSaveReasonAffectOnlyLocalData:v4])
    {
      v5 = objc_autoreleasePoolPush();
      v6 = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
      {
        v8 = HMFGetLogIdentifier();
        v26 = 138543618;
        v27 = v8;
        v28 = 2112;
        v29 = v4;
        v9 = "%{public}@Saving with reason %@ for a local change.";
LABEL_19:
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEFAULT, v9, &v26, 0x16u);
      }
    }

    else
    {
      [(HMDHome *)self _updateConfigurationVersion];
      v5 = objc_autoreleasePoolPush();
      v24 = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
      {
        v8 = HMFGetLogIdentifier();
        v26 = 138543618;
        v27 = v8;
        v28 = 2112;
        v29 = v4;
        v9 = "%{public}@Saving with reason %@ for a non-local change";
        goto LABEL_19;
      }
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)self configureBulletinNotification];
    goto LABEL_21;
  }

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v26 = 138543618;
    v27 = v13;
    v28 = 2112;
    v29 = v4;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Dropping request to save due to %@ since the user is not owner of home", &v26, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  if ([(HMDHome *)v11 isAdminUser]&& ![HMDHomeManager doesSaveReasonAffectOnlyLocalData:v4]&& ![HMDHomeManager shouldIgnoreExpectedConfigurationVersionUpdateForReason:v4])
  {
    [(HMDHome *)v11 _updateExpectConfigurationVersion];
  }

  v14 = [HMDHomeManager shouldIncrementGenerationCounterForReason:v4];
  v15 = objc_autoreleasePoolPush();
  v16 = v11;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
  {
    v18 = HMFGetLogIdentifier();
    v19 = HMFBooleanToString();
    v26 = 138543874;
    v27 = v18;
    v28 = 2112;
    v29 = v4;
    v30 = 2112;
    v31 = v19;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_DEFAULT, "%{public}@Saving to persistent store due to reason: %@ (incrementing generation counter: %@)", &v26, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  v20 = [(HMDHome *)v16 homeManager];
  v21 = [v20 backingStore];
  v22 = v21;
  if (v4)
  {
    v23 = v4;
  }

  else
  {
    v23 = @"Unknown Reason";
  }

  [v21 saveToPersistentStoreWithReason:v23 incrementGeneration:v14];

LABEL_21:
  v25 = *MEMORY[0x277D85DE8];
}

- (void)performPostSaveActionsWithReason:(id)a3
{
  v4 = a3;
  [(HMDHome *)self _performPostSaveActionsWithReason:v4];
  v6 = [[HMDHomeSaveRequest alloc] initWithHome:self reason:v4 information:0 postSyncNotification:0 objectChange:1];

  v5 = [(HMDHome *)self homeManager];
  [v5 performPostSaveRequestActionsWithRequest:v6];
}

- (void)saveToCurrentAccountWithReason:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_saveToCurrentAccountWithReason___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

uint64_t __42__HMDHome_saveToCurrentAccountWithReason___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v9 = 138543618;
    v10 = v5;
    v11 = 2112;
    v12 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Saving to current account with reason: %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  [*(a1 + 32) saveWithReason:*(a1 + 40) information:0 postSyncNotification:0];
  result = [*(a1 + 32) _configureBulletinNotification];
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_saveSharedHomeToAccountWithReason:(id)a3 postSyncNotification:(BOOL)a4 options:(id)a5
{
  v32 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543618;
    v29 = v13;
    v30 = 2112;
    v31 = v8;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Received request to save to account with reason: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  if (-[HMDHome isOwnerUser](v11, "isOwnerUser") || +[HMDHomeManager doesSaveReasonAffectOnlyLocalData:](HMDHomeManager, "doesSaveReasonAffectOnlyLocalData:", v8) || ([MEMORY[0x277D0F8E8] productInfo], v14 = objc_claimAutoreleasedReturnValue(), v15 = objc_msgSend(v14, "productPlatform") == 3, v14, v15))
  {
    v16 = objc_autoreleasePoolPush();
    v17 = v11;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v19;
      v30 = 2112;
      v31 = v8;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot save home as a shared home to cloud for reason %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
  }

  else
  {
    v21 = [(HMDHome *)v11 sharedHomeModel];
    v22 = [(HMDHome *)v11 backingStore];
    v23 = [v22 transaction:v8 options:v9];

    [v23 add:v21];
    objc_initWeak(buf, v11);
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __75__HMDHome__saveSharedHomeToAccountWithReason_postSyncNotification_options___block_invoke;
    v24[3] = &unk_2797248C8;
    objc_copyWeak(&v26, buf);
    v25 = v8;
    v27 = a4;
    [v23 save:v24];
    [(HMDHome *)v11 configureBulletinNotification];

    objc_destroyWeak(&v26);
    objc_destroyWeak(buf);
  }

  v20 = *MEMORY[0x277D85DE8];
}

void __75__HMDHome__saveSharedHomeToAccountWithReason_postSyncNotification_options___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = WeakRetained;
    v3 = [[HMDHomeSaveRequest alloc] initWithHome:WeakRetained reason:*(a1 + 32) information:0 postSyncNotification:*(a1 + 48) objectChange:1];
    v4 = [v5 homeManager];
    [v4 saveWithRequest:v3];

    WeakRetained = v5;
  }
}

- (void)saveSharedHomeToAccountWithReason:(id)a3 postSyncNotification:(BOOL)a4 options:(id)a5
{
  v8 = a3;
  v9 = a5;
  objc_initWeak(&location, self);
  v10 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __74__HMDHome_saveSharedHomeToAccountWithReason_postSyncNotification_options___block_invoke;
  block[3] = &unk_279730EA0;
  objc_copyWeak(&v16, &location);
  v17 = a4;
  v14 = v8;
  v15 = v9;
  v11 = v9;
  v12 = v8;
  dispatch_async(v10, block);

  objc_destroyWeak(&v16);
  objc_destroyWeak(&location);
}

void __74__HMDHome_saveSharedHomeToAccountWithReason_postSyncNotification_options___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v3 = WeakRetained;
    [WeakRetained _saveSharedHomeToAccountWithReason:*(a1 + 32) postSyncNotification:*(a1 + 56) options:*(a1 + 40)];
    WeakRetained = v3;
  }
}

- (void)_updateExpectConfigurationVersion
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self expectedConfigurationVersion];
  if (v3 < [(HMDHome *)self configurationVersion])
  {
    [(HMDHome *)self setExpectedConfigurationVersion:[(HMDHome *)self configurationVersion]];
  }

  [(HMDHome *)self setExpectedConfigurationVersion:[(HMDHome *)self expectedConfigurationVersion]+ 1];
  v4 = objc_autoreleasePoolPush();
  v5 = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543874;
    v10 = v7;
    v11 = 2048;
    v12 = [(HMDHome *)v5 expectedConfigurationVersion];
    v13 = 2048;
    v14 = [(HMDHome *)v5 configurationVersion];
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Increased expected configuration counter to %lu (current configurationVersion: %lu).", &v9, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

- (void)_updateConfigurationVersion
{
  v12 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setConfigurationVersion:[(HMDHome *)self configurationVersion]+ 1];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
  {
    v6 = HMFGetLogIdentifier();
    v8 = 138543618;
    v9 = v6;
    v10 = 2048;
    v11 = [(HMDHome *)v4 configurationVersion];
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Incrementing configuration version to %lu", &v8, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  [(HMDHome *)v4 __saveConfigurationVersionTransaction];
  v7 = *MEMORY[0x277D85DE8];
}

- (void)__saveConfigurationVersionTransaction
{
  v3 = [(HMDHome *)self backingStore];
  v4 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v6 = [v3 transaction:@"kHomeConfigurationVersionKey" options:v4];

  v5 = [(HMDHome *)self homeConfigurationModelObjectWithChangeType:1];
  [v6 add:v5 withMessage:0];
  [v6 save];
}

- (void)_handleModifyCharacteristicNotifications:(id)a3
{
  v87 = *MEMORY[0x277D85DE8];
  v3 = a3;
  if ([v3 isRemote] && (objc_msgSend(v3, "isSecureRemote") & 1) == 0)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v80 = v19;
      v81 = 2112;
      v82 = v3;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v4 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    [v3 respondWithError:v4];
  }

  else
  {
    v4 = [v3 dictionaryForKey:@"kCharacteristicNotificationsKey"];
    v5 = [v3 dictionaryForKey:@"kMediaNotificationsKey"];
    v77 = 0;
    v6 = [v3 BOOLForKey:*MEMORY[0x277CD2158] keyPresent:&v77];
    v7 = [v3 remoteSourceDevice];
    v8 = [v7 remoteDestinationString];

    if (v4 | v5 && v8 && (v77 & 1) != 0)
    {
      if (v6)
      {
        v9 = [(HMDHome *)self notificationRegistry];
        [v9 setNotificationsEnabled:1 forUserID:v8 characteristicsPayload:v4 mediaPropertiesPayload:v5];
LABEL_50:

        [v3 respondWithSuccess];
      }

      else
      {
        v20 = objc_alloc_init(MEMORY[0x277CBEB18]);
        [v3 remoteSourceDevice];
        v73 = 0u;
        v74 = 0u;
        v75 = 0u;
        v61 = v76 = 0u;
        v21 = [v61 handles];
        v22 = [v21 countByEnumeratingWithState:&v73 objects:v86 count:16];
        if (v22)
        {
          v23 = v22;
          v24 = *v74;
          do
          {
            for (i = 0; i != v23; ++i)
            {
              if (*v74 != v24)
              {
                objc_enumerationMutation(v21);
              }

              v26 = [*(*(&v73 + 1) + 8 * i) destination];
              [v20 addObject:v26];
            }

            v23 = [v21 countByEnumeratingWithState:&v73 objects:v86 count:16];
          }

          while (v23);
        }

        v60 = v8;

        v27 = [v61 globalHandles];
        v28 = [v27 firstObject];

        v62 = v28;
        if (v28)
        {
          v57 = v5;
          v58 = v4;
          v59 = v3;
          v71 = 0u;
          v72 = 0u;
          v69 = 0u;
          v70 = 0u;
          v29 = [v61 account];
          v30 = [v29 handles];

          obj = v30;
          v31 = [v30 countByEnumeratingWithState:&v69 objects:v85 count:16];
          if (v31)
          {
            v32 = v31;
            v33 = *v70;
            do
            {
              for (j = 0; j != v32; ++j)
              {
                if (*v70 != v33)
                {
                  objc_enumerationMutation(obj);
                }

                v35 = *(*(&v69 + 1) + 8 * j);
                v36 = [v28 pushToken];
                v37 = [v35 URI];
                v38 = [v37 prefixedURI];
                v39 = MEMORY[0x259C01FD0](v36, v38);

                if (v39)
                {
                  if (([v20 containsObject:v39] & 1) == 0)
                  {
                    [v20 addObject:v39];
                  }
                }

                else
                {
                  v40 = objc_autoreleasePoolPush();
                  v41 = self;
                  v42 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
                  {
                    v43 = HMFGetLogIdentifier();
                    *buf = 138543874;
                    v80 = v43;
                    v81 = 2112;
                    v82 = v62;
                    v83 = 2112;
                    v84 = v35;
                    _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_ERROR, "%{public}@Failed to create destination with globalHandle: %@, accountHandle: %@", buf, 0x20u);

                    v28 = v62;
                  }

                  objc_autoreleasePoolPop(v40);
                }
              }

              v32 = [obj countByEnumeratingWithState:&v69 objects:v85 count:16];
            }

            while (v32);
          }

          v4 = v58;
          v3 = v59;
          v5 = v57;
        }

        v44 = [v3 remoteSourceID];
        if (([v20 containsObject:v44] & 1) == 0)
        {
          [v20 addObject:v44];
        }

        v67 = 0u;
        v68 = 0u;
        v65 = 0u;
        v66 = 0u;
        v9 = v20;
        v45 = [v9 countByEnumeratingWithState:&v65 objects:v78 count:16];
        if (v45)
        {
          v46 = v45;
          v47 = *v66;
          while (2)
          {
            for (k = 0; k != v46; ++k)
            {
              if (*v66 != v47)
              {
                objc_enumerationMutation(v9);
              }

              v49 = *(*(&v65 + 1) + 8 * k);
              v50 = [(HMDHome *)self notificationRegistry];
              LOBYTE(v49) = [v50 setNotificationsEnabled:0 forUserID:v49 characteristicsPayload:v4 mediaPropertiesPayload:v5];

              if (v49)
              {

                v8 = v60;
                goto LABEL_50;
              }
            }

            v46 = [v9 countByEnumeratingWithState:&v65 objects:v78 count:16];
            if (v46)
            {
              continue;
            }

            break;
          }
        }

        v51 = objc_autoreleasePoolPush();
        v52 = self;
        v53 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v53, OS_LOG_TYPE_ERROR))
        {
          v54 = HMFGetLogIdentifier();
          *buf = 138543618;
          v80 = v54;
          v81 = 2112;
          v82 = v9;
          _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_ERROR, "%{public}@Failed to disable notification with destinations: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v51);
        v55 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2 description:@"Failed to disable notification because registration was not found" reason:@"Could not find matching registration" suggestion:0];
        [v3 respondWithError:v55];

        v8 = v60;
      }
    }

    else
    {
      v10 = objc_autoreleasePoolPush();
      v11 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        v14 = [v3 messagePayload];
        *buf = 138543618;
        v80 = v13;
        v81 = 2112;
        v82 = v14;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle modify characteristic notifications message payload: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      [v3 respondWithError:v15];
    }
  }

  v56 = *MEMORY[0x277D85DE8];
}

- (void)_handleAccessoryReachabilityEventNotificationsRegistration:(id)a3
{
  v38 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v33 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Received message to handle accessory reachability event notification registration", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [v4 messagePayload];
  v11 = [v10 hmf_arrayForKey:@"HMDAccessoryResidentReachabilityNotificationEnableAccessoryUUIDsMessageKey"];

  v12 = [v4 messagePayload];
  v13 = [v12 hmf_arrayForKey:@"HMDAccessoryResidentReachabilityNotificationDisableAccessoryUUIDsMessageKey"];

  if ([v11 count] || objc_msgSend(v13, "count"))
  {
    v14 = [v11 na_map:&__block_literal_global_887];
    v31 = [v13 na_map:&__block_literal_global_889];
    v15 = [v4 messagePayload];
    v16 = [v15 hmf_stringForKey:@"HMDAccessoryResidentReachabilityNotificationUserIDMessageKey"];

    if (!v16)
    {
      v16 = [v4 remoteSourceID];
    }

    v17 = [(HMDHome *)v7 notificationRegistry];
    if ([v17 enableReachabilityEventNotificationForAccessoryUUIDs:v14 forUserID:v16])
    {
      v18 = 1;
    }

    else
    {
      v19 = [(HMDHome *)v7 notificationRegistry];
      v18 = [v19 disableReachabilityEventNotificationForAccessoryUUIDs:v31 forUserID:v16];
    }

    v20 = objc_autoreleasePoolPush();
    v21 = v7;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      HMFGetLogIdentifier();
      v23 = v11;
      v25 = v24 = v13;
      *buf = 138543874;
      v33 = v25;
      v34 = 2112;
      v35 = v14;
      v36 = 2112;
      v37 = v31;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Changed reachability event notification registration for enableAccessoryUUIDs : %@ and disableAccessoryUUIDs : %@", buf, 0x20u);

      v13 = v24;
      v11 = v23;
    }

    objc_autoreleasePoolPop(v20);
    if (v18)
    {
      [(HMDHome *)v21 saveToCurrentAccountWithReason:@"HMDAccessoryResidentReachabilityNotificationRegistrationMessage"];
    }

    [v4 respondWithSuccess];
  }

  else
  {
    v27 = objc_autoreleasePoolPush();
    v28 = v7;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
    {
      v30 = HMFGetLogIdentifier();
      *buf = 138543362;
      v33 = v30;
      _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@No accessories passed in for remote reachability event registration/deregistration", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v27);
    v14 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    [v4 respondWithError:v14];
  }

  v26 = *MEMORY[0x277D85DE8];
}

id __70__HMDHome__handleAccessoryReachabilityEventNotificationsRegistration___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = MEMORY[0x277CCAD78];
  v3 = a2;
  v4 = [[v2 alloc] initWithUUIDString:v3];

  return v4;
}

id __70__HMDHome__handleAccessoryReachabilityEventNotificationsRegistration___block_invoke(uint64_t a1, void *a2)
{
  v2 = MEMORY[0x277CCAD78];
  v3 = a2;
  v4 = [[v2 alloc] initWithUUIDString:v3];

  return v4;
}

- (void)auditUsersForNotifications:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __38__HMDHome_auditUsersForNotifications___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __38__HMDHome_auditUsersForNotifications___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) notificationRegistry];
  [v2 auditUsersForNotifications:*(a1 + 40) forHome:*(a1 + 32)];
}

void __135__HMDHome__modifyCharacteristicNotifications_mediaNotifications_actionSetNotificationPayload_enableNotification_withDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v8 = WeakRetained;
  if (WeakRetained)
  {
    if (v5)
    {
      v9 = objc_autoreleasePoolPush();
      v10 = v8;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        *buf = 138543874;
        v26 = v12;
        v27 = 2112;
        v28 = v13;
        v29 = 2112;
        v30 = v5;
        _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Failed to modify notifications with remote gateway %@ due to error %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v9);
      v14 = *(a1 + 48);
      if (v14)
      {
        (*(v14 + 16))(v14, v5);
      }
    }

    else
    {
      v17 = [WeakRetained workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __135__HMDHome__modifyCharacteristicNotifications_mediaNotifications_actionSetNotificationPayload_enableNotification_withDevice_completion___block_invoke_884;
      block[3] = &unk_2797220B0;
      objc_copyWeak(&v23, (a1 + 56));
      v20 = *(a1 + 32);
      v21 = *(a1 + 40);
      v24 = *(a1 + 64);
      v22 = *(a1 + 48);
      dispatch_async(v17, block);

      objc_destroyWeak(&v23);
    }
  }

  else
  {
    v15 = *(a1 + 48);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
      (*(v15 + 16))(v15, v16);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __135__HMDHome__modifyCharacteristicNotifications_mediaNotifications_actionSetNotificationPayload_enableNotification_withDevice_completion___block_invoke_884(uint64_t a1)
{
  v14 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v3 = objc_autoreleasePoolPush();
  v4 = WeakRetained;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v7 = *(a1 + 32);
    v10 = 138543618;
    v11 = v6;
    v12 = 2112;
    v13 = v7;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Modified notifications with remote gateway %@", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  [v4 _handleRemoteGatewayNotificationRegistration:*(a1 + 40) enable:*(a1 + 64)];
  v8 = *(a1 + 48);
  if (v8)
  {
    (*(v8 + 16))(v8, 0);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)modifyCharacteristicNotifications:(id)a3 mediaNotifications:(id)a4 actionSetNotificationPayload:(id)a5 enableNotification:(BOOL)a6 withDevice:(id)a7
{
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a7;
  v16 = [(HMDHome *)self workQueue];
  v21[0] = MEMORY[0x277D85DD0];
  v21[1] = 3221225472;
  v21[2] = __123__HMDHome_modifyCharacteristicNotifications_mediaNotifications_actionSetNotificationPayload_enableNotification_withDevice___block_invoke;
  v21[3] = &unk_27972DBC8;
  v21[4] = self;
  v22 = v12;
  v23 = v13;
  v24 = v14;
  v26 = a6;
  v25 = v15;
  v17 = v15;
  v18 = v14;
  v19 = v13;
  v20 = v12;
  dispatch_async(v16, v21);
}

- (BOOL)shouldRestrictAllMessagingToLocalTransportsForUser:(id)a3
{
  v4 = a3;
  if (isiOSDevice())
  {
    v5 = [(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled];
    LOBYTE(self) = 0;
    if (v4 && v5)
    {
      LODWORD(self) = [v4 isRemoteAccessAllowed] ^ 1;
    }
  }

  else
  {
    LOBYTE(self) = 0;
  }

  return self;
}

- (void)_resubscribeForNotificationsOnResident:(id)a3
{
  v56 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [(HMDHome *)self primaryResident];
  v7 = [v6 device];

  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543874;
    v51 = v11;
    v52 = 2112;
    v53 = v4;
    v54 = 2112;
    v55 = v7;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Resubscribing for notifications - previousResidentDevice: %@, current primaryResident: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  v44 = v4;
  if (isWatch() && (-[HMDHome homeManager](v9, "homeManager"), v12 = objc_claimAutoreleasedReturnValue(), v13 = [v12 companionReachable], v12, v13))
  {
    v14 = objc_autoreleasePoolPush();
    v15 = v9;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v51 = v17;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Subscribing to companion", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
    v43 = 0;
  }

  else
  {
    v43 = v7;
  }

  v42 = [(HMDHome *)v9 residentEnabledDevices];
  v18 = [MEMORY[0x277CBEB18] array];
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v48 = 0u;
  v19 = [(HMDHome *)v9 _residentUsers];
  v20 = [v19 countByEnumeratingWithState:&v45 objects:v49 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v46;
    do
    {
      for (i = 0; i != v21; ++i)
      {
        if (*v46 != v22)
        {
          objc_enumerationMutation(v19);
        }

        v24 = *(*(&v45 + 1) + 8 * i);
        if ([v24 configurationState] == 2)
        {
          v25 = [v24 userID];
          v26 = [HMDDevice deviceWithDestination:v25];

          if (v26 && ([v26 isCurrentDevice] & 1) == 0)
          {
            [v18 addObject:v26];
          }
        }
      }

      v21 = [v19 countByEnumeratingWithState:&v45 objects:v49 count:16];
    }

    while (v21);
  }

  if ([v42 count] || objc_msgSend(v18, "count"))
  {
    v27 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v18, "count") + objc_msgSend(v42, "count")}];
    v28 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v18, "count") + objc_msgSend(v42, "count")}];
    v29 = v43;
    if ([v43 isCurrentDevice])
    {
      [v27 addObjectsFromArray:v42];
      [v27 addObjectsFromArray:v18];
      v30 = v44;
    }

    else
    {
      v30 = v44;
      if (v44)
      {
        [v28 addObject:v44];
      }

      else
      {
        [v28 addObjectsFromArray:v18];
      }

      if (v43)
      {
        [v27 addObject:v43];
      }

      else
      {
        [v27 addObjectsFromArray:v18];
      }
    }

    [v28 minusSet:v27];
    v31 = objc_autoreleasePoolPush();
    v32 = v9;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543362;
      v51 = v34;
      _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to initial home launch or change in primary resident.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v31);
    if ([v28 count])
    {
      v35 = [v28 allObjects];
      [(HMDHome *)v32 _disableNotificationsForDevices:v35];
    }

    if ([v27 count])
    {
      v36 = [v27 allObjects];
      [(HMDHome *)v32 _enableNotificationsForDevices:v36];
    }

    [(HMDHome *)v32 _updateDirectAppleMediaNotificationsOnResidentChange:v43 previousResidentDevice:v30];
  }

  else
  {
    v38 = objc_autoreleasePoolPush();
    v39 = v9;
    v40 = HMFGetOSLogHandle();
    v29 = v43;
    if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
    {
      v41 = HMFGetLogIdentifier();
      *buf = 138543362;
      v51 = v41;
      _os_log_impl(&dword_2531F8000, v40, OS_LOG_TYPE_INFO, "%{public}@There are no resident devices or remote gateways to register with", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v38);
    v30 = v44;
  }

  v37 = *MEMORY[0x277D85DE8];
}

- (void)resubscribeForNotificationsOnResident:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_resubscribeForNotificationsOnResident___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)_registerResidentReachabilityNotificationWithEnableAccessories:(id)a3 disableAccessories:(id)a4 completionHandler:(id)a5
{
  v70 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v11);

  if (![(HMDHome *)self _canCurrentDeviceRegisterForReachabilityEventNotification])
  {
    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
    {
      goto LABEL_13;
    }

    v22 = HMFGetLogIdentifier();
    *buf = 138543362;
    v63 = v22;
    v23 = "%{public}@Current device is either watch or resident, do not have to send remote message for remote reachability event notification registration";
    v24 = v21;
    v25 = OS_LOG_TYPE_DEBUG;
    goto LABEL_12;
  }

  v12 = [(HMDHome *)self residentDeviceManager];
  v13 = [v12 availableResidentDevices];
  v14 = [v13 count];

  if (!v14)
  {
    v19 = objc_autoreleasePoolPush();
    v20 = self;
    v21 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_13;
    }

    v22 = HMFGetLogIdentifier();
    *buf = 138543362;
    v63 = v22;
    v23 = "%{public}@There is no resident available to register for reachability event notification";
    v24 = v21;
    v25 = OS_LOG_TYPE_ERROR;
LABEL_12:
    _os_log_impl(&dword_2531F8000, v24, v25, v23, buf, 0xCu);

LABEL_13:
    objc_autoreleasePoolPop(v19);
    v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    if (v10)
    {
      v10[2](v10, v26);
    }

    goto LABEL_26;
  }

  if (![(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v26 = [(HMDHome *)self primaryResident];
    v27 = [v26 isConfirmed];
    v28 = [(HMDHome *)self primaryResident];
    v29 = [v28 capabilities];
    v30 = [v29 supportsCameraRecordingReachabilityNotifications];

    if (v26 && v27 && (v30 & 1) != 0)
    {
      v31 = [v8 na_map:&__block_literal_global_880];
      v32 = [v31 copy];

      v33 = [v9 na_map:&__block_literal_global_882];
      v34 = [v33 copy];

      v60[0] = @"HMDAccessoryResidentReachabilityNotificationEnableAccessoryUUIDsMessageKey";
      v60[1] = @"HMDAccessoryResidentReachabilityNotificationDisableAccessoryUUIDsMessageKey";
      v56 = v34;
      v57 = v32;
      v61[0] = v32;
      v61[1] = v34;
      [MEMORY[0x277CBEAC0] dictionaryWithObjects:v61 forKeys:v60 count:2];
      v36 = v35 = v26;
      v37 = [HMDRemoteDeviceMessageDestination alloc];
      v38 = [(HMDHome *)self uuid];
      v55 = v35;
      v39 = [v35 device];
      v40 = [(HMDRemoteDeviceMessageDestination *)v37 initWithTarget:v38 device:v39];
      v41 = [HMDRemoteMessage secureMessageWithName:@"HMDAccessoryResidentReachabilityNotificationRegistrationMessage" destination:v40 messagePayload:v36];

      v58[0] = MEMORY[0x277D85DD0];
      v58[1] = 3221225472;
      v58[2] = __111__HMDHome__registerResidentReachabilityNotificationWithEnableAccessories_disableAccessories_completionHandler___block_invoke_3;
      v58[3] = &unk_279732CF0;
      v58[4] = self;
      v59 = v10;
      [v41 setResponseHandler:v58];
      v42 = objc_autoreleasePoolPush();
      v43 = self;
      v44 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v44, OS_LOG_TYPE_INFO))
      {
        v45 = HMFGetLogIdentifier();
        *buf = 138543874;
        v63 = v45;
        v64 = 2112;
        v65 = v41;
        v66 = 2112;
        v67 = v36;
        _os_log_impl(&dword_2531F8000, v44, OS_LOG_TYPE_INFO, "%{public}@Sending reachability notification registration message %@ with payload: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v42);
      v46 = [(HMDHome *)v43 msgDispatcher];
      [v46 sendMessage:v41];

      v47 = v57;
      v26 = v55;
    }

    else
    {
      v48 = objc_autoreleasePoolPush();
      v49 = self;
      v50 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
      {
        v51 = HMFGetLogIdentifier();
        v52 = HMFBooleanToString();
        v53 = HMFBooleanToString();
        *buf = 138544130;
        v63 = v51;
        v64 = 2112;
        v65 = v52;
        v66 = 2112;
        v67 = v53;
        v68 = 2112;
        v69 = v26;
        _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not confirmed (%@) or does not support camera recording reachability notifications (%@): %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v48);
      v47 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      if (v10)
      {
        v10[2](v10, v47);
      }
    }

LABEL_26:
    goto LABEL_27;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
  {
    v18 = HMFGetLogIdentifier();
    *buf = 138543362;
    v63 = v18;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_DEFAULT, "%{public}@Current device is confirmed primary resident, do not need to register for notification on confirmed primary resident itself", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v15);
  if (v10)
  {
    v10[2](v10, 0);
  }

LABEL_27:

  v54 = *MEMORY[0x277D85DE8];
}

void __111__HMDHome__registerResidentReachabilityNotificationWithEnableAccessories_disableAccessories_completionHandler___block_invoke_3(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v5)
  {
    if (!os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v11 = HMFGetLogIdentifier();
    v18 = 138543618;
    v19 = v11;
    v20 = 2112;
    v21 = v5;
    v12 = "%{public}@Failed to update accessory reachability event notification registry due to error: %@";
    v13 = v10;
    v14 = OS_LOG_TYPE_ERROR;
    v15 = 22;
  }

  else
  {
    if (!os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      goto LABEL_7;
    }

    v11 = HMFGetLogIdentifier();
    v18 = 138543362;
    v19 = v11;
    v12 = "%{public}@Successfully updated accessory reachability event notification registry";
    v13 = v10;
    v14 = OS_LOG_TYPE_INFO;
    v15 = 12;
  }

  _os_log_impl(&dword_2531F8000, v13, v14, v12, &v18, v15);

LABEL_7:
  objc_autoreleasePoolPop(v7);
  v16 = *(a1 + 40);
  if (v16)
  {
    (*(v16 + 16))(v16, v5);
  }

  v17 = *MEMORY[0x277D85DE8];
}

id __111__HMDHome__registerResidentReachabilityNotificationWithEnableAccessories_disableAccessories_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = [a2 uuid];
  v3 = [v2 UUIDString];

  return v3;
}

id __111__HMDHome__registerResidentReachabilityNotificationWithEnableAccessories_disableAccessories_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 uuid];
  v3 = [v2 UUIDString];

  return v3;
}

- (BOOL)_canCurrentDeviceRegisterForReachabilityEventNotification
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  if (isWatch() || isAppleTV() || isHomePod())
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEBUG, "%{public}@Skipping registering for reachability notification on watch / ATV / HomePod", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    result = 0;
  }

  else
  {
    result = 1;
  }

  v9 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)setCameraReachabilityEventNotificationsEnabled:(BOOL)a3 forAccessory:(id)a4 completionHandler:(id)a5
{
  v8 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __89__HMDHome_setCameraReachabilityEventNotificationsEnabled_forAccessory_completionHandler___block_invoke;
  v13[3] = &unk_279732430;
  v16 = a3;
  v13[4] = self;
  v14 = v8;
  v15 = v9;
  v11 = v9;
  v12 = v8;
  dispatch_async(v10, v13);
}

void __89__HMDHome_setCameraReachabilityEventNotificationsEnabled_forAccessory_completionHandler___block_invoke(uint64_t a1)
{
  v8[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 56);
  if (v3 == 1)
  {
    v8[0] = *(a1 + 40);
    v4 = [MEMORY[0x277CBEA60] arrayWithObjects:v8 count:1];
    if (*(a1 + 56))
    {
      [v2 _registerResidentReachabilityNotificationWithEnableAccessories:v4 disableAccessories:MEMORY[0x277CBEBF8] completionHandler:*(a1 + 48)];
LABEL_6:

      goto LABEL_7;
    }
  }

  else
  {
    v4 = MEMORY[0x277CBEBF8];
  }

  v7 = *(a1 + 40);
  v5 = [MEMORY[0x277CBEA60] arrayWithObjects:&v7 count:1];
  [v2 _registerResidentReachabilityNotificationWithEnableAccessories:v4 disableAccessories:v5 completionHandler:*(a1 + 48)];

  if (v3)
  {
    goto LABEL_6;
  }

LABEL_7:
  v6 = *MEMORY[0x277D85DE8];
}

- (void)_registerCameraReachabilityEventNotificationsWithCompletionHandler:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v30 = a3;
  v4 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v4);

  v5 = objc_alloc(MEMORY[0x277CBEB18]);
  v6 = [(HMDHome *)self accessories];
  v32 = [v5 initWithCapacity:{objc_msgSend(v6, "count")}];

  v7 = objc_alloc(MEMORY[0x277CBEB18]);
  v8 = [(HMDHome *)self accessories];
  v33 = [v7 initWithCapacity:{objc_msgSend(v8, "count")}];

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  obj = [(HMDHome *)self accessories];
  v9 = [obj countByEnumeratingWithState:&v35 objects:v39 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v36;
    v12 = HMDIDSActivityMonitorHomeManagerDataSource;
    v31 = *v36;
    do
    {
      v13 = 0;
      do
      {
        if (*v36 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v14 = *(*(&v35 + 1) + 8 * v13);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v16 = v15;

        v17 = [v16 cameraProfiles];
        v18 = [v17 count];

        if (v18)
        {
          v19 = [(HMDHome *)self accountSettings];
          if ([v19 isHomeEnabled])
          {
            v20 = [v16 cameraProfileSettingsManager];
            [v20 currentSettings];
            v22 = v21 = self;
            [v22 notificationSettings];
            v24 = v23 = v12;
            v25 = [v24 isReachabilityEventNotificationEnabled];

            v12 = v23;
            self = v21;
            v11 = v31;

            v26 = v32;
            if (v25)
            {
              goto LABEL_15;
            }
          }

          else
          {
          }

          v26 = v33;
LABEL_15:
          [v26 addObject:v16];
        }

        ++v13;
      }

      while (v10 != v13);
      v10 = [obj countByEnumeratingWithState:&v35 objects:v39 count:16];
    }

    while (v10);
  }

  v27 = [v32 copy];
  v28 = [v33 copy];
  [(HMDHome *)self _registerResidentReachabilityNotificationWithEnableAccessories:v27 disableAccessories:v28 completionHandler:v30];

  v29 = *MEMORY[0x277D85DE8];
}

- (void)registerCameraReachabilityEventNotificationsWithCompletionHandler:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __77__HMDHome_registerCameraReachabilityEventNotificationsWithCompletionHandler___block_invoke;
  v7[3] = &unk_279735738;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)_disableNotificationsForDevices:(id)a3
{
  v110 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  if ([v4 count])
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v107 = v9;
      v108 = 2112;
      v109 = v4;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Disabling Notifications on %@", buf, 0x16u);
    }

    v64 = v4;

    objc_autoreleasePoolPop(v6);
    v76 = [MEMORY[0x277CBEB38] dictionary];
    v67 = [MEMORY[0x277CBEB18] array];
    v79 = [(HMDHome *)v7 supportsUnifiedMediaNotificationsOnResidents];
    v97 = 0u;
    v98 = 0u;
    v99 = 0u;
    v100 = 0u;
    v80 = v7;
    obj = [(HMDHome *)v7 accessories];
    v68 = [obj countByEnumeratingWithState:&v97 objects:v105 count:16];
    if (v68)
    {
      v66 = *v98;
      do
      {
        v10 = 0;
        do
        {
          if (*v98 != v66)
          {
            objc_enumerationMutation(obj);
          }

          v11 = *(*(&v97 + 1) + 8 * v10);
          v12 = [MEMORY[0x277CBEB18] array];
          v13 = v11;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v14 = v13;
          }

          else
          {
            v14 = 0;
          }

          v15 = v14;

          v16 = v13;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v17 = v16;
          }

          else
          {
            v17 = 0;
          }

          v18 = v17;

          if (v15)
          {
            v70 = v16;
            v72 = v18;
            v77 = v10;
            v95 = 0u;
            v96 = 0u;
            v93 = 0u;
            v94 = 0u;
            v74 = v15;
            v19 = [v15 services];
            v20 = [v19 countByEnumeratingWithState:&v93 objects:v104 count:16];
            if (v20)
            {
              v21 = v20;
              v22 = *v94;
              do
              {
                for (i = 0; i != v21; ++i)
                {
                  if (*v94 != v22)
                  {
                    objc_enumerationMutation(v19);
                  }

                  v24 = *(*(&v93 + 1) + 8 * i);
                  v89 = 0u;
                  v90 = 0u;
                  v91 = 0u;
                  v92 = 0u;
                  v25 = [v24 characteristics];
                  v26 = [v25 countByEnumeratingWithState:&v89 objects:v103 count:16];
                  if (v26)
                  {
                    v27 = v26;
                    v28 = *v90;
                    do
                    {
                      for (j = 0; j != v27; ++j)
                      {
                        if (*v90 != v28)
                        {
                          objc_enumerationMutation(v25);
                        }

                        v30 = *(*(&v89 + 1) + 8 * j);
                        if ([v30 supportsNotification])
                        {
                          v31 = [v30 instanceID];
                          [v12 addObject:v31];
                        }
                      }

                      v27 = [v25 countByEnumeratingWithState:&v89 objects:v103 count:16];
                    }

                    while (v27);
                  }
                }

                v21 = [v19 countByEnumeratingWithState:&v93 objects:v104 count:16];
              }

              while (v21);
            }

            v32 = [v70 uuid];
            v33 = [v32 UUIDString];

            if ([v12 count])
            {
              v34 = [v12 copy];
              [v76 setObject:v34 forKeyedSubscript:v33];
            }

            v10 = v77;
            v18 = v72;
            v15 = v74;
LABEL_35:

            goto LABEL_36;
          }

          if (v18)
          {
            v35 = [v18 mediaProfile];
            if (v35)
            {
              v33 = v35;
              [v67 addObject:v35];
            }

            else
            {
              v36 = objc_autoreleasePoolPush();
              v37 = v80;
              v38 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
              {
                v39 = HMFGetLogIdentifier();
                *buf = 138543618;
                v107 = v39;
                v108 = 2112;
                v109 = v18;
                _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@skipping disabling notifications for apple media accessory without media profile: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v36);
              v33 = 0;
            }

            goto LABEL_35;
          }

LABEL_36:

          v10 = v10 + 1;
        }

        while (v10 != v68);
        v40 = [obj countByEnumeratingWithState:&v97 objects:v105 count:16];
        v68 = v40;
      }

      while (v40);
    }

    v73 = [MEMORY[0x277CBEB18] array];
    if ([v76 count] || objc_msgSend(v67, "count"))
    {
      v87 = 0u;
      v88 = 0u;
      v85 = 0u;
      v86 = 0u;
      v69 = v64;
      v75 = [v69 countByEnumeratingWithState:&v85 objects:v102 count:16];
      if (v75)
      {
        v71 = *v86;
        do
        {
          v41 = 0;
          do
          {
            if (*v86 != v71)
            {
              objc_enumerationMutation(v69);
            }

            v78 = v41;
            v42 = *(*(&v85 + 1) + 8 * v41);
            v43 = [MEMORY[0x277CBEB38] dictionary];
            v81 = 0u;
            v82 = 0u;
            v83 = 0u;
            v84 = 0u;
            v44 = v67;
            v45 = [v44 countByEnumeratingWithState:&v81 objects:v101 count:16];
            if (v45)
            {
              v46 = v45;
              v47 = *v82;
              do
              {
                for (k = 0; k != v46; ++k)
                {
                  if (*v82 != v47)
                  {
                    objc_enumerationMutation(v44);
                  }

                  v49 = *(*(&v81 + 1) + 8 * k);
                  v50 = [v49 accessory];
                  objc_opt_class();
                  if (objc_opt_isKindOfClass())
                  {
                    v51 = v50;
                  }

                  else
                  {
                    v51 = 0;
                  }

                  v52 = v51;

                  if (!v52 || ([v52 device], v53 = objc_claimAutoreleasedReturnValue(), v54 = (v53 != v42) | v79, v53, (v54 & 1) != 0))
                  {
                    v55 = [(HMDHome *)v80 mediaNotificationPayloadForProfile:v49];
                    [v43 addEntriesFromDictionary:v55];
                  }
                }

                v46 = [v44 countByEnumeratingWithState:&v81 objects:v101 count:16];
              }

              while (v46);
            }

            v56 = [v76 copy];
            v57 = [v43 copy];
            v58 = [v73 copy];
            [(HMDHome *)v80 _modifyCharacteristicNotifications:v56 mediaNotifications:v57 actionSetNotificationPayload:v58 enableNotification:0 withDevice:v42];

            v41 = v78 + 1;
          }

          while (v78 + 1 != v75);
          v75 = [v69 countByEnumeratingWithState:&v85 objects:v102 count:16];
        }

        while (v75);
      }

      v4 = v64;
    }

    else
    {
      v60 = objc_autoreleasePoolPush();
      v61 = v80;
      v62 = HMFGetOSLogHandle();
      v4 = v64;
      if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
      {
        v63 = HMFGetLogIdentifier();
        *buf = 138543362;
        v107 = v63;
        _os_log_impl(&dword_2531F8000, v62, OS_LOG_TYPE_INFO, "%{public}@There are no characteristics requiring deregistration", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v60);
    }
  }

  v59 = *MEMORY[0x277D85DE8];
}

- (void)disableNotificationsForDevices:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_disableNotificationsForDevices___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)_enableNotificationsForDevices:(id)a3
{
  v196 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v119 = v4;
  if ([v4 count])
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v193 = v9;
      v194 = 2112;
      v195 = v119;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Enabling Notifications on %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v10 = [(HMDHome *)v7 notificationRegistrations];
    v140 = [v10 count];

    v11 = [(HMDHome *)v7 primaryResident];
    v144 = [v11 device];

    if ([(HMDHome *)v7 isCurrentDeviceAvailableResident]&& ![(HMDHome *)v7 isCurrentDevicePrimaryResident])
    {
      v182 = 0u;
      v183 = 0u;
      v180 = 0u;
      v181 = 0u;
      v12 = v119;
      v13 = [v12 countByEnumeratingWithState:&v180 objects:v191 count:16];
      if (v13)
      {
        v14 = v13;
        v15 = *v181;
        while (2)
        {
          for (i = 0; i != v14; ++i)
          {
            if (*v181 != v15)
            {
              objc_enumerationMutation(v12);
            }

            if ([*(*(&v180 + 1) + 8 * i) isEqual:v144])
            {
              v143 = 1;
              goto LABEL_17;
            }
          }

          v14 = [v12 countByEnumeratingWithState:&v180 objects:v191 count:16];
          if (v14)
          {
            continue;
          }

          break;
        }
      }

      v143 = 0;
LABEL_17:
    }

    else
    {
      v143 = 0;
    }

    v145 = [MEMORY[0x277CBEB18] array];
    v176 = 0u;
    v177 = 0u;
    v178 = 0u;
    v179 = 0u;
    obj = [(HMDHome *)v7 triggers];
    v148 = v7;
    v149 = [obj countByEnumeratingWithState:&v176 objects:v190 count:16];
    if (v149)
    {
      v146 = *v177;
      do
      {
        v17 = 0;
        do
        {
          if (*v177 != v146)
          {
            objc_enumerationMutation(obj);
          }

          v153 = v17;
          v18 = *(*(&v176 + 1) + 8 * v17);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v19 = v18;
          }

          else
          {
            v19 = 0;
          }

          v20 = v19;

          v174 = 0u;
          v175 = 0u;
          v172 = 0u;
          v173 = 0u;
          v151 = v20;
          v21 = [v20 characteristicEvents];
          v22 = [v21 countByEnumeratingWithState:&v172 objects:v189 count:16];
          if (v22)
          {
            v23 = v22;
            v24 = *v173;
            do
            {
              for (j = 0; j != v23; ++j)
              {
                if (*v173 != v24)
                {
                  objc_enumerationMutation(v21);
                }

                v26 = *(*(&v172 + 1) + 8 * j);
                v27 = [v26 characteristic];

                if (v27)
                {
                  v28 = [v26 characteristic];
                  [v145 addObject:v28];
                }

                else
                {
                  v29 = objc_autoreleasePoolPush();
                  v30 = v7;
                  v31 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
                  {
                    v32 = HMFGetLogIdentifier();
                    *buf = 138543618;
                    v193 = v32;
                    v194 = 2112;
                    v195 = v26;
                    _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Characteristic of HMDCharacteristicEvent %@ is nil!", buf, 0x16u);
                  }

                  objc_autoreleasePoolPop(v29);
                  v7 = v148;
                }
              }

              v23 = [v21 countByEnumeratingWithState:&v172 objects:v189 count:16];
            }

            while (v23);
          }

          v17 = v153 + 1;
        }

        while ((v153 + 1) != v149);
        v149 = [obj countByEnumeratingWithState:&v176 objects:v190 count:16];
      }

      while (v149);
    }

    v127 = [MEMORY[0x277CBEB38] dictionary];
    v120 = [MEMORY[0x277CBEB38] dictionary];
    v124 = [MEMORY[0x277CBEB38] dictionary];
    v123 = [(HMDHome *)v7 supportsUnifiedMediaNotificationsOnResidents];
    v168 = 0u;
    v169 = 0u;
    v170 = 0u;
    v171 = 0u;
    v125 = [(HMDHome *)v7 accessories];
    v33 = [v125 countByEnumeratingWithState:&v168 objects:v188 count:16];
    if (v33)
    {
      v34 = v33;
      v35 = *v169;
      v135 = *MEMORY[0x277CFE810];
      v121 = *v169;
      do
      {
        v36 = 0;
        v122 = v34;
        do
        {
          if (*v169 != v35)
          {
            objc_enumerationMutation(v125);
          }

          v37 = *(*(&v168 + 1) + 8 * v36);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v38 = v37;
          }

          else
          {
            v38 = 0;
          }

          v39 = v38;

          v40 = v37;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v41 = v40;
          }

          else
          {
            v41 = 0;
          }

          v42 = v41;
          v128 = v40;

          v130 = v39;
          if (!v39)
          {
            if (((v42 != 0) & v123) != 1)
            {
              goto LABEL_121;
            }

            v129 = v42;
            v47 = [v42 mediaProfile];
            if (v47)
            {
              if (v140)
              {
                v48 = [(HMDHome *)v7 mediaNotificationPayloadForProfile:v47];
                [v124 addEntriesFromDictionary:v48];

LABEL_119:
                goto LABEL_120;
              }

              v93 = objc_autoreleasePoolPush();
              v100 = v7;
              v95 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v95, OS_LOG_TYPE_DEBUG))
              {
                v96 = HMFGetLogIdentifier();
                *buf = 138543618;
                v193 = v96;
                v194 = 2112;
                v195 = v129;
                v97 = v95;
                v98 = OS_LOG_TYPE_DEBUG;
                v99 = "%{public}@Skipping enabling notifications for apple media accessory %@ because home notifications are disabled";
LABEL_117:
                _os_log_impl(&dword_2531F8000, v97, v98, v99, buf, 0x16u);
              }
            }

            else
            {
              v93 = objc_autoreleasePoolPush();
              v94 = v7;
              v95 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v95, OS_LOG_TYPE_INFO))
              {
                v96 = HMFGetLogIdentifier();
                *buf = 138543618;
                v193 = v96;
                v194 = 2112;
                v195 = v129;
                v97 = v95;
                v98 = OS_LOG_TYPE_INFO;
                v99 = "%{public}@Skipping enabling notifications for apple media accessory without media profile: %@";
                goto LABEL_117;
              }
            }

            objc_autoreleasePoolPop(v93);
            goto LABEL_119;
          }

          v129 = v42;
          if (shouldSkipRemoteAccessoryNotificationRegistration(v7, v39))
          {
            v43 = objc_autoreleasePoolPush();
            v44 = v7;
            v45 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
            {
              v46 = HMFGetLogIdentifier();
              *buf = 138543618;
              v193 = v46;
              v194 = 2112;
              v195 = v130;
              _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_INFO, "%{public}@Dropping all characteristics for %@ from remote notification as partitioned network is no longer supported by residents", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v43);
            goto LABEL_120;
          }

          v126 = v36;
          obja = [MEMORY[0x277CBEB18] array];
          v49 = [MEMORY[0x277CBEB38] dictionary];
          v164 = 0u;
          v165 = 0u;
          v166 = 0u;
          v167 = 0u;
          v131 = [v39 services];
          v133 = [v131 countByEnumeratingWithState:&v164 objects:v187 count:16];
          if (!v133)
          {
            goto LABEL_108;
          }

          v132 = *v165;
          v147 = v49;
          do
          {
            v50 = 0;
            do
            {
              if (*v165 != v132)
              {
                objc_enumerationMutation(v131);
              }

              v134 = v50;
              v51 = *(*(&v164 + 1) + 8 * v50);
              v160 = 0u;
              v161 = 0u;
              v162 = 0u;
              v163 = 0u;
              v152 = v51;
              v150 = [v51 characteristics];
              v52 = [v150 countByEnumeratingWithState:&v160 objects:v186 count:16];
              if (v52)
              {
                v53 = v52;
                v155 = *v161;
                do
                {
                  v54 = 0;
                  do
                  {
                    if (*v161 != v155)
                    {
                      objc_enumerationMutation(v150);
                    }

                    v55 = *(*(&v160 + 1) + 8 * v54);
                    if ([v55 supportsNotification])
                    {
                      v56 = [(HMDHome *)v7 dataSource];
                      v57 = [v56 hapMetadata];
                      v58 = [v55 type];
                      v59 = [v152 type];
                      v60 = [v57 shouldFilterEnableNotificationsForCharacteristicType:v58 serviceType:v59];

                      if ((v60 & 1) == 0)
                      {
                        v154 = [v55 type];
                        v61 = [v152 type];
                        v62 = [(HMDHome *)v7 notificationRegistry];
                        v185 = v55;
                        v63 = [MEMORY[0x277CBEA60] arrayWithObjects:&v185 count:1];
                        v64 = [v62 usersRegisteredForNotificationsForCharacteristics:v63];
                        v65 = [v64 mutableCopy];

                        v66 = [v144 remoteDestinationString];
                        if (v66)
                        {
                          [v65 removeObject:v66];
                        }

                        v67 = [v65 count];
                        v68 = v67 != 0;
                        v69 = v154;
                        if ([v145 containsObject:v55] & 1) != 0 || (objc_msgSend(v55, "isNonHomeNotificationsEnabled"))
                        {
                          goto LABEL_80;
                        }

                        v70 = [(HMDHome *)v148 dataSource];
                        v71 = [v70 hapMetadata];
                        if ([v71 requiresDeviceUnlock:v154 forService:v61])
                        {
                          goto LABEL_79;
                        }

                        v138 = v71;
                        v139 = v70;
                        v72 = [(HMDHome *)v148 dataSource];
                        v73 = [v72 hapMetadata];
                        if ([v73 shouldAutoEnableNotificationForCharacteristic:v154 ofService:?])
                        {

                          v70 = v139;
                          v71 = v138;
LABEL_79:

                          v69 = v154;
LABEL_80:
                          if (v143 && [v55 isNotificationEnabledForClientIdentifierPrefix:@"com.apple.HomeKitDaemon.Local"])
                          {
                            v74 = objc_autoreleasePoolPush();
                            v75 = v148;
                            v76 = HMFGetOSLogHandle();
                            if (os_log_type_enabled(v76, OS_LOG_TYPE_INFO))
                            {
                              v77 = HMFGetLogIdentifier();
                              *buf = 138543618;
                              v193 = v77;
                              v194 = 2112;
                              v195 = v55;
                              _os_log_impl(&dword_2531F8000, v76, OS_LOG_TYPE_INFO, "%{public}@Dropping characteristic for remote notifications from primary resident because it should be local only: %@", buf, 0x16u);
                            }

                            objc_autoreleasePoolPop(v74);
                            v69 = v154;
                          }

                          else
                          {
                            v78 = [v55 instanceID];
                            [obja addObject:v78];

                            v79 = [v55 changeThresholdForEnabledNotifications];
                            if (v79 && !v140)
                            {
                              v80 = [v55 instanceID];
                              v81 = [v80 stringValue];
                              [v147 setObject:v79 forKeyedSubscript:v81];

                              v69 = v154;
                            }
                          }

LABEL_89:

                          v49 = v147;
                          v7 = v148;
                          goto LABEL_90;
                        }

                        v136 = v73;
                        v137 = v72;
                        if ([v154 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"])
                        {
                          v82 = [v61 isEqualToString:v135];
                          if (v67)
                          {
                            v68 = 1;
                          }

                          else
                          {
                            v68 = v82;
                          }

                          if (v82 & 1 | (v140 == 0))
                          {
LABEL_103:

                            v69 = v154;
                            if (v68)
                            {
                              goto LABEL_80;
                            }

                            goto LABEL_89;
                          }
                        }

                        else if (!v140)
                        {
                          goto LABEL_103;
                        }

                        v83 = [(HMDHome *)v148 dataSource];
                        v84 = [v83 hapMetadata];
                        v85 = [v84 shouldEnableHomeNotificationForCharacteristicType:v154 serviceType:v61];
                        if (v67)
                        {
                          v68 = 1;
                        }

                        else
                        {
                          v68 = v85;
                        }

                        goto LABEL_103;
                      }
                    }

LABEL_90:
                    ++v54;
                  }

                  while (v53 != v54);
                  v86 = [v150 countByEnumeratingWithState:&v160 objects:v186 count:16];
                  v53 = v86;
                }

                while (v86);
              }

              v50 = v134 + 1;
            }

            while (v134 + 1 != v133);
            v133 = [v131 countByEnumeratingWithState:&v164 objects:v187 count:16];
          }

          while (v133);
LABEL_108:

          v87 = [v128 uuid];
          v88 = [v87 UUIDString];

          if ([obja count])
          {
            v89 = [obja copy];
            [v127 setObject:v89 forKeyedSubscript:v88];
          }

          v90 = [v49 count];
          v91 = v49;
          v35 = v121;
          v34 = v122;
          v36 = v126;
          if (v90)
          {
            v92 = [v91 copy];
            [v120 setObject:v92 forKeyedSubscript:v88];
          }

LABEL_120:
          v42 = v129;
LABEL_121:

          ++v36;
        }

        while (v36 != v34);
        v34 = [v125 countByEnumeratingWithState:&v168 objects:v188 count:16];
      }

      while (v34);
    }

    v101 = [MEMORY[0x277CBEB18] array];
    [v127 count];
    if ([v127 count] || objc_msgSend(v124, "count"))
    {
      v158 = 0u;
      v159 = 0u;
      v156 = 0u;
      v157 = 0u;
      v102 = v119;
      v103 = [v102 countByEnumeratingWithState:&v156 objects:v184 count:16];
      if (v103)
      {
        v104 = v103;
        v105 = *v157;
        do
        {
          for (k = 0; k != v104; ++k)
          {
            if (*v157 != v105)
            {
              objc_enumerationMutation(v102);
            }

            v107 = *(*(&v156 + 1) + 8 * k);
            v108 = [v107 capabilities];
            v109 = [v108 supportsUnifiedMediaNotifications];

            if (v109)
            {
              v110 = [v124 copy];
            }

            else
            {
              v110 = 0;
            }

            v111 = [v127 copy];
            v112 = [v110 copy];
            v113 = [v101 copy];
            [(HMDHome *)v148 _modifyCharacteristicNotifications:v111 mediaNotifications:v112 actionSetNotificationPayload:v113 enableNotification:1 withDevice:v107];
          }

          v104 = [v102 countByEnumeratingWithState:&v156 objects:v184 count:16];
        }

        while (v104);
      }
    }

    else
    {
      v115 = objc_autoreleasePoolPush();
      v116 = v7;
      v117 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v117, OS_LOG_TYPE_INFO))
      {
        v118 = HMFGetLogIdentifier();
        *buf = 138543362;
        v193 = v118;
        _os_log_impl(&dword_2531F8000, v117, OS_LOG_TYPE_INFO, "%{public}@There are no characteristics/media properties requiring registration", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v115);
    }
  }

  v114 = *MEMORY[0x277D85DE8];
}

- (void)enableNotificationsForDevices:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome_enableNotificationsForDevices___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

- (void)_modifyCharacteristicNotificationsOnResident:(id)a3 mediaNotifications:(id)a4 actionSetNotificationPayload:(id)a5 enableNotification:(BOOL)a6
{
  v42 = a6;
  v55 = *MEMORY[0x277D85DE8];
  v40 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v11);

  v43 = self;
  v12 = [(HMDHome *)self primaryResident];
  if (isWatch())
  {
    v13 = [(HMDHome *)v43 homeManager];
    v14 = [v13 companionReachable];

    if (v14)
    {

      v12 = 0;
LABEL_11:
      v17 = v40;
      goto LABEL_12;
    }
  }

  if (!v12)
  {
    goto LABEL_11;
  }

  v15 = [v12 device];
  v16 = [v15 isCurrentDevice];

  v17 = v40;
  if (v16)
  {
LABEL_12:
    v24 = [v12 device];
    v25 = [v24 isCurrentDevice];

    if (v25)
    {
      v38 = v12;
      v46 = 0u;
      v47 = 0u;
      v44 = 0u;
      v45 = 0u;
      obj = [(HMDHome *)v43 residentEnabledDevices];
      v26 = [obj countByEnumeratingWithState:&v44 objects:v48 count:16];
      if (v26)
      {
        v27 = v26;
        v28 = *v45;
        v29 = "Disabling";
        if (v42)
        {
          v29 = "Enabling";
        }

        v39 = v29;
        do
        {
          for (i = 0; i != v27; ++i)
          {
            v31 = v9;
            if (*v45 != v28)
            {
              objc_enumerationMutation(obj);
            }

            v32 = *(*(&v44 + 1) + 8 * i);
            v33 = objc_autoreleasePoolPush();
            v34 = v43;
            v35 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
            {
              v36 = HMFGetLogIdentifier();
              *buf = 138543874;
              v50 = v36;
              v51 = 2080;
              v52 = v39;
              v53 = 2112;
              v54 = v32;
              _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@%s notifications with secondary resident %@", buf, 0x20u);

              v17 = v40;
            }

            objc_autoreleasePoolPop(v33);
            v9 = v31;
            [(HMDHome *)v34 _modifyCharacteristicNotifications:v17 mediaNotifications:v31 actionSetNotificationPayload:v10 enableNotification:v42 withDevice:v32 completion:0];
          }

          v27 = [obj countByEnumeratingWithState:&v44 objects:v48 count:16];
        }

        while (v27);
      }

      v12 = v38;
    }

    [(HMDHome *)v43 _modifyCharacteristicNotificationsOnResidentUsers:v17 mediaNotifications:v9 actionSetNotificationPayload:v10 enableNotification:v42];
    goto LABEL_26;
  }

  v18 = [v12 device];
  v19 = objc_autoreleasePoolPush();
  v20 = v43;
  v21 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
  {
    v22 = HMFGetLogIdentifier();
    v23 = "Disabling";
    *buf = 138543874;
    v50 = v22;
    if (v42)
    {
      v23 = "Enabling";
    }

    v51 = 2080;
    v52 = v23;
    v53 = 2112;
    v54 = v18;
    _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@%s notifications with resident %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v19);
  [(HMDHome *)v20 _modifyCharacteristicNotifications:v40 mediaNotifications:v9 actionSetNotificationPayload:v10 enableNotification:v42 withDevice:v18 completion:0];

LABEL_26:
  v37 = *MEMORY[0x277D85DE8];
}

- (void)enableMediaNotifications:(BOOL)a3 directlyOnMediaAccessory:(id)a4 completion:(id)a5
{
  v8 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __72__HMDHome_enableMediaNotifications_directlyOnMediaAccessory_completion___block_invoke;
  v13[3] = &unk_279732430;
  v16 = a3;
  v13[4] = self;
  v14 = v8;
  v15 = v9;
  v11 = v9;
  v12 = v8;
  dispatch_async(v10, v13);
}

- (void)enableHomeNotificationsForMediaAccessory:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __52__HMDHome_enableHomeNotificationsForMediaAccessory___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __52__HMDHome_enableHomeNotificationsForMediaAccessory___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) notificationRegistrationsForAppleMediaAccessories];
  v3 = [v2 count];

  if (v3)
  {
    v4 = *(a1 + 32);
    v5 = *(a1 + 40);

    [(HMDHome *)v4 _enableMediaNotifications:v5 forMediaAccessory:?];
  }
}

- (void)_subscribeForHomeNotificationsFromRemoteGateway:(BOOL)a3 accessories:(id)a4
{
  v4 = a3;
  v58 = *MEMORY[0x277D85DE8];
  v6 = a4;
  v7 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v7);

  v48 = 0;
  v49 = 0;
  v46 = 0;
  v47 = 0;
  v45 = 0;
  [(HMDHome *)self _notificationPayloadsForRemoteGateway:v4 accessories:v6 enableCharacteristicNotificationPayload:&v49 characteristicNotificationThresholdsPayload:&v48 disableCharacteristicNotificationPayload:&v47 enableMediaNotificationPayload:&v46 disableMediaNotificationPayload:&v45];
  v8 = v49;
  v9 = v48;
  v10 = v47;
  v11 = v46;
  v12 = v45;
  if ([v10 count] || objc_msgSend(v8, "count") || objc_msgSend(v12, "count") || objc_msgSend(v11, "count"))
  {
    if ([v8 count] || objc_msgSend(v11, "count"))
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v38 = v13;
        v17 = v16 = v11;
        HMFBooleanToString();
        v18 = v39 = v12;
        [v8 shortDescription];
        v40 = v8;
        v42 = v10;
        v20 = v19 = v6;
        [v16 shortDescription];
        v22 = v21 = v9;
        *buf = 138544130;
        v51 = v17;
        v52 = 2112;
        v53 = v18;
        v54 = 2112;
        v55 = v20;
        v56 = 2112;
        v57 = v22;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Registering notifications with remote gateway when notificationEnabled: %@, characteristics: %@, properties: %@", buf, 0x2Au);

        v9 = v21;
        v6 = v19;
        v8 = v40;
        v10 = v42;

        v12 = v39;
        v11 = v16;
        v13 = v38;
      }

      objc_autoreleasePoolPop(v13);
      [(HMDHome *)v14 _modifyCharacteristicNotificationsOnResident:v8 mediaNotifications:v11 actionSetNotificationPayload:MEMORY[0x277CBEBF8] enableNotification:1];
    }

    if ([v10 count] || objc_msgSend(v12, "count"))
    {
      v23 = objc_autoreleasePoolPush();
      v24 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v26 = v43 = v11;
        HMFBooleanToString();
        v27 = v44 = v6;
        [v10 shortDescription];
        v28 = v41 = v9;
        [v12 shortDescription];
        v30 = v29 = v12;
        *buf = 138544130;
        v51 = v26;
        v52 = 2112;
        v53 = v27;
        v54 = 2112;
        v55 = v28;
        v56 = 2112;
        v57 = v30;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_INFO, "%{public}@De-registering notifications with remote gateway when notificationEnabled: %@, characteristics: %@, properties: %@", buf, 0x2Au);

        v12 = v29;
        v9 = v41;

        v6 = v44;
        v11 = v43;
      }

      objc_autoreleasePoolPop(v23);
      [(HMDHome *)v24 _modifyCharacteristicNotificationsOnResident:v10 mediaNotifications:v12 actionSetNotificationPayload:MEMORY[0x277CBEBF8] enableNotification:0];
    }
  }

  else
  {
    v32 = v12;
    v33 = v11;
    v34 = objc_autoreleasePoolPush();
    v35 = self;
    v36 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
    {
      v37 = HMFGetLogIdentifier();
      *buf = 138543362;
      v51 = v37;
      _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_INFO, "%{public}@Not registering notifications with remote gateway since we have no modifications", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v34);
    v11 = v33;
    v12 = v32;
  }

  v31 = *MEMORY[0x277D85DE8];
}

uint64_t __59__HMDHome__subscribeForHomeNotificationsFromRemoteGateway___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  v3 = (v2 == 0) | ~objc_opt_isKindOfClass();

  return v3 & 1;
}

- (void)subscribeForNotificationsFromRemoteGateway
{
  v3 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __53__HMDHome_subscribeForNotificationsFromRemoteGateway__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v3, block);
}

- (void)_createModifyNotificationsCoalesceTimerIfNeeded
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = [(HMDHome *)self modifyNotificationsCoalesceTimer];

  if (!v4)
  {
    v5 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:0 options:0.5];
    [(HMDHome *)self setModifyNotificationsCoalesceTimer:v5];

    v6 = [(HMDHome *)self workQueue];
    v7 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [v7 setDelegateQueue:v6];

    v8 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [v8 setDelegate:self];

    v9 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [v9 resume];

    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = v11;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@%@ Kicked off the modify notifications on resident request timer", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_remotelySetNotificationsEnabled:(BOOL)a3 forCharacteristics:(id)a4 characteristicChangeThresholds:(id)a5
{
  v49 = *MEMORY[0x277D85DE8];
  v8 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v10);

  v31 = v9;
  if (a3)
  {
    v11 = [(HMDHome *)self enableNotificationPayload];
    [(HMDHome *)self disableNotificationPayload];
  }

  else
  {
    v11 = [(HMDHome *)self disableNotificationPayload];
    [(HMDHome *)self enableNotificationPayload];
  }
  v35 = ;
  v40 = 0u;
  v41 = 0u;
  v38 = 0u;
  v39 = 0u;
  obj = v8;
  v37 = [obj countByEnumeratingWithState:&v38 objects:v48 count:16];
  if (v37)
  {
    v36 = *v39;
    v32 = v11;
    v33 = self;
    do
    {
      for (i = 0; i != v37; ++i)
      {
        if (*v39 != v36)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v38 + 1) + 8 * i);
        v14 = [v13 accessory];
        v15 = [v14 uuid];
        v16 = [v15 UUIDString];

        if (v16)
        {
          v17 = [v11 objectForKeyedSubscript:v16];
          if (!v17)
          {
            v17 = [MEMORY[0x277CBEB18] array];
            [v11 setObject:v17 forKeyedSubscript:v16];
          }

          v18 = [v13 instanceID];
          v19 = [v17 containsObject:v18];

          if ((v19 & 1) == 0)
          {
            v20 = [v13 instanceID];
            [v17 addObject:v20];
          }

          v21 = [v35 objectForKeyedSubscript:v16];

          v22 = [v13 instanceID];
          v23 = [v21 containsObject:v22];

          if (v23)
          {
            v24 = [v13 instanceID];
            [v21 removeObject:v24];

            v25 = objc_autoreleasePoolPush();
            v26 = self;
            v27 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
            {
              v28 = HMFGetLogIdentifier();
              v29 = HMFBooleanToString();
              *buf = 138543874;
              v43 = v28;
              v44 = 2112;
              v45 = v29;
              v46 = 2112;
              v47 = v13;
              _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Function call to set notification to %@, removing the entry %@ from the other payload", buf, 0x20u);

              self = v33;
              v11 = v32;
            }

            objc_autoreleasePoolPop(v25);
            if (![v21 count])
            {
              [v35 removeObjectForKey:v16];
            }
          }
        }
      }

      v37 = [obj countByEnumeratingWithState:&v38 objects:v48 count:16];
    }

    while (v37);
  }

  if ([v11 count] || objc_msgSend(v35, "count"))
  {
    [(HMDHome *)self _createModifyNotificationsCoalesceTimerIfNeeded];
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)remotelySetNotificationsEnabled:(BOOL)a3 forCharacteristics:(id)a4 characteristicChangeThresholds:(id)a5
{
  v8 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __93__HMDHome_remotelySetNotificationsEnabled_forCharacteristics_characteristicChangeThresholds___block_invoke;
  v13[3] = &unk_279731C38;
  v16 = a3;
  v13[4] = self;
  v14 = v8;
  v15 = v9;
  v11 = v9;
  v12 = v8;
  dispatch_async(v10, v13);
}

- (void)redispatchToResidentMessage:(id)a3 target:(id)a4 responseQueue:(id)a5 viaDevice:(id)a6
{
  v103 = *MEMORY[0x277D85DE8];
  v93 = a3;
  v10 = a4;
  v11 = a5;
  v12 = a6;
  v92 = v10;
  if (v10)
  {
    v13 = v93;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v15)
    {
      v16 = v13;
    }

    else
    {
      v16 = [v13 mutableCopy];
    }

    v17 = v16;

    v18 = [(HMDAssertionLogEvent *)v17 responseHandler];
    if (v18)
    {
      v94[0] = MEMORY[0x277D85DD0];
      v94[1] = 3221225472;
      v94[2] = __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke;
      v94[3] = &unk_279732CF0;
      v95 = v11;
      v96 = v18;
      [(HMDAssertionLogEvent *)v17 setResponseHandler:v94];
    }

    v19 = [(HMDAssertionLogEvent *)v17 name];
    v20 = [v19 isEqualToString:@"kMultipleCharacteristicWriteRequestKey"];

    if (!isiOSDevice())
    {
      goto LABEL_15;
    }

    if (redispatchToResidentMessage_target_responseQueue_viaDevice__pred != -1)
    {
      dispatch_once(&redispatchToResidentMessage_target_responseQueue_viaDevice__pred, &__block_literal_global_858);
    }

    v21 = redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages;
    v22 = [(HMDAssertionLogEvent *)v17 name];
    LODWORD(v21) = [v21 containsObject:v22];

    if (!v21)
    {
      goto LABEL_15;
    }

    v23 = [(HMDHome *)self currentUser];
    v24 = [v23 isRemoteAccessAllowed];

    if ((v24 & 1) == 0)
    {
      v91 = v11;
      v70 = [(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled];
      v71 = objc_autoreleasePoolPush();
      v72 = self;
      v73 = HMFGetOSLogHandle();
      v74 = os_log_type_enabled(v73, OS_LOG_TYPE_INFO);
      if (!v70)
      {
        if (v74)
        {
          v78 = HMFGetLogIdentifier();
          v79 = [(HMDHome *)v72 currentUser];
          v80 = [v79 shortDescription];
          *buf = 138543618;
          v98 = v78;
          v99 = 2112;
          v100 = v80;
          _os_log_impl(&dword_2531F8000, v73, OS_LOG_TYPE_INFO, "%{public}@Remote access is disabled for the current user: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v71);
        v27 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
        [(HMDAssertionLogEvent *)v17 respondWithError:v27];
        v11 = v91;
        goto LABEL_40;
      }

      if (v74)
      {
        HMFGetLogIdentifier();
        v75 = v88 = v71;
        v76 = [(HMDHome *)v72 currentUser];
        v77 = [v76 displayName];
        *buf = 138543618;
        v98 = v75;
        v99 = 2112;
        v100 = v77;
        _os_log_impl(&dword_2531F8000, v73, OS_LOG_TYPE_INFO, "%{public}@Remote access is disabled for the user %@, restricting to local transports...", buf, 0x16u);

        v71 = v88;
      }

      objc_autoreleasePoolPop(v71);
      v25 = 1;
      v11 = v91;
    }

    else
    {
LABEL_15:
      v25 = 0;
    }

    v26 = [(HMDAssertionLogEvent *)v17 messagePayload];
    v27 = [v26 mutableCopy];

    if (v25)
    {
      [(HMDAssertionLogEvent *)v17 setRemoteDisallowsIDSRacing:1];
    }

    v28 = [MEMORY[0x277D0F770] currentActivity];
    v29 = v28;
    if (v12)
    {
      [(HMDAssertionLogEvent *)v17 setSecureRemote:1];
      v30 = [[HMDRemoteDeviceMessageDestination alloc] initWithTarget:v92 device:v12];
      [(HMDAssertionLogEvent *)v17 setDestination:v30];

      [v27 setObject:0 forKeyedSubscript:@"kIDSMessageSourceIDKey"];
      if (([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled]& v20) == 1)
      {
        v31 = [v12 capabilities];
        v32 = [v31 supportsResidentFirstAccessoryCommunication];

        if ((v32 & 1) == 0)
        {
          [v27 setObject:0 forKeyedSubscript:@"kMultiPartResponseKey"];
        }
      }

      [(HMDAssertionLogEvent *)v17 setMessagePayload:v27];
      v33 = objc_autoreleasePoolPush();
      v34 = self;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v86 = v27;
        v89 = v18;
        v37 = v36 = v11;
        v38 = [(HMDAssertionLogEvent *)v17 shortDescription];
        [v12 shortDescription];
        v40 = v39 = v29;
        *buf = 138543874;
        v98 = v37;
        v99 = 2112;
        v100 = v38;
        v101 = 2112;
        v102 = v40;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to device: %@", buf, 0x20u);

        v29 = v39;
        v11 = v36;
        v27 = v86;
        v18 = v89;
      }

      objc_autoreleasePoolPop(v33);
      [(HMDAssertionLogEvent *)v17 name];

      [(HMDAssertionLogEvent *)v17 identifier];
      [v12 identifier];

      v41 = +[HMDSecureRemoteMessageTransport defaultTransport];
      v42 = [(HMDAssertionLogEvent *)v17 copy];
      [v41 sendMessage:v42 completionHandler:0];
    }

    else
    {
      v85 = v28;
      v90 = v11;
      v43 = objc_autoreleasePoolPush();
      v44 = self;
      v45 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
      {
        v46 = HMFGetLogIdentifier();
        v47 = [(HMDAssertionLogEvent *)v17 shortDescription];
        *buf = 138543618;
        v98 = v46;
        v99 = 2112;
        v100 = v47;
        _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to resident", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v43);
      v48 = [(HMDHome *)v44 homeManager];
      v49 = [v48 messageDispatcher];
      v41 = [v49 residentCommunicationHandlerForHome:v44];

      v50 = [v41 preferredDevice];
      if (v50)
      {
        v42 = v50;
        if (v20)
        {
          if ([(HMDHome *)v44 isResidentFirstAccessoryCommunicationEnabled])
          {
            v51 = [v42 capabilities];
            v52 = [v51 supportsResidentFirstAccessoryCommunication];

            if ((v52 & 1) == 0)
            {
              [v27 setObject:0 forKeyedSubscript:@"kMultiPartResponseKey"];
            }
          }
        }

        [(HMDAssertionLogEvent *)v17 setMessagePayload:v27];
        v53 = objc_autoreleasePoolPush();
        v54 = v44;
        v55 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v55, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          [(HMDAssertionLogEvent *)v17 shortDescription];
          v87 = v27;
          v58 = v57 = v18;
          v59 = [v42 shortDescription];
          *buf = 138543874;
          v98 = v56;
          v99 = 2112;
          v100 = v58;
          v101 = 2112;
          v102 = v59;
          _os_log_impl(&dword_2531F8000, v55, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to remote device: %@", buf, 0x20u);

          v12 = 0;
          v18 = v57;
          v27 = v87;
        }

        objc_autoreleasePoolPop(v53);
        v11 = v90;
        [v41 redispatchMessage:v17 target:v92 responseQueue:v90];
      }

      else
      {
        v60 = objc_autoreleasePoolPush();
        v61 = v44;
        v62 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
        {
          v63 = HMFGetLogIdentifier();
          v64 = [(HMDAssertionLogEvent *)v17 shortDescription];
          [(HMDHome *)v61 shortDescription];
          v65 = v27;
          v67 = v66 = v18;
          *buf = 138543874;
          v98 = v63;
          v99 = 2112;
          v100 = v64;
          v101 = 2112;
          v102 = v67;
          _os_log_impl(&dword_2531F8000, v62, OS_LOG_TYPE_INFO, "%{public}@Cannot redispatch message %@ because there is no resident configured for home: %@", buf, 0x20u);

          v18 = v66;
          v27 = v65;

          v12 = 0;
        }

        objc_autoreleasePoolPop(v60);
        [(HMDHome *)v61 uuid];

        v68 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
        [(HMDAssertionLogEvent *)v17 respondWithError:v68];

        v42 = 0;
        v11 = v90;
      }

      v29 = v85;
    }

LABEL_40:
    goto LABEL_41;
  }

  v81 = objc_autoreleasePoolPush();
  v82 = self;
  v83 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v83, OS_LOG_TYPE_FAULT))
  {
    v84 = HMFGetLogIdentifier();
    *buf = 138543362;
    v98 = v84;
    _os_log_impl(&dword_2531F8000, v83, OS_LOG_TYPE_FAULT, "%{public}@Submitting ABC event for failure: TargetUUID cannot be nil", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v81);
  v17 = [[HMDAssertionLogEvent alloc] initWithReason:@"TargetUUID cannot be nil"];
  v18 = +[HMDMetricsManager sharedLogEventSubmitter];
  [v18 submitLogEvent:v17];
LABEL_41:

  v69 = *MEMORY[0x277D85DE8];
}

void __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke_2;
  block[3] = &unk_2797355D0;
  v7 = *(a1 + 32);
  v8 = *(a1 + 40);
  v13 = v6;
  v14 = v8;
  v12 = v5;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);
}

void __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke_3()
{
  v3[8] = *MEMORY[0x277D85DE8];
  v3[0] = @"kCharacteristicWriteRequestKey";
  v3[1] = @"kCharacteristicReadRequestKey";
  v3[2] = @"kMultipleCharacteristicWriteRequestKey";
  v3[3] = @"kMultipleCharacteristicReadRequestKey";
  v3[4] = @"kIdentifyAccessoryRequestKey";
  v3[5] = @"kMediaPropertiesWriteRequestKey";
  v3[6] = @"kMediaPropertiesReadRequestKey";
  v3[7] = @"HMDHomeSetNaturalLightingEnabledForLightProfilesMessage";
  v0 = [MEMORY[0x277CBEA60] arrayWithObjects:v3 count:8];
  v1 = redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages;
  redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages = v0;

  v2 = *MEMORY[0x277D85DE8];
}

- (void)addCompanionAsResidentUser:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __38__HMDHome_addCompanionAsResidentUser___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __38__HMDHome_addCompanionAsResidentUser___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) users];
  v3 = [*(a1 + 40) userID];
  v4 = [v2 hmf_firstObjectWithValue:v3 forKeyPath:@"userID"];

  if (!v4)
  {
    [*(a1 + 32) _addUserToContainer:*(a1 + 40)];
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Added a new resident user", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  [(HMDHome *)*(a1 + 32) _subscribeForNotificationFromRemoteGateway:?];

  v9 = *MEMORY[0x277D85DE8];
}

- (id)_characteristicNotificationPayloadsOnDirectTransports:(BOOL)a3
{
  v69 = a3;
  v103 = *MEMORY[0x277D85DE8];
  v70 = [MEMORY[0x277CBEB18] array];
  v93 = 0u;
  v94 = 0u;
  v95 = 0u;
  v96 = 0u;
  v74 = self;
  obj = [(HMDHome *)self triggers];
  v4 = [obj countByEnumeratingWithState:&v93 objects:v102 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v94;
    do
    {
      v7 = 0;
      v72 = v5;
      do
      {
        if (*v94 != v6)
        {
          objc_enumerationMutation(obj);
        }

        v8 = *(*(&v93 + 1) + 8 * v7);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        if ([v10 shouldActivateOnLocalDevice])
        {
          v91 = 0u;
          v92 = 0u;
          v89 = 0u;
          v90 = 0u;
          v11 = [v10 characteristicEvents];
          v12 = [v11 countByEnumeratingWithState:&v89 objects:v101 count:16];
          if (v12)
          {
            v13 = v12;
            v14 = *v90;
            do
            {
              for (i = 0; i != v13; ++i)
              {
                if (*v90 != v14)
                {
                  objc_enumerationMutation(v11);
                }

                v16 = *(*(&v89 + 1) + 8 * i);
                v17 = [v16 characteristic];

                if (v17)
                {
                  v18 = [v16 characteristic];
                  [v70 addObject:v18];
                }
              }

              v13 = [v11 countByEnumeratingWithState:&v89 objects:v101 count:16];
            }

            while (v13);
          }

          v5 = v72;
        }

        ++v7;
      }

      while (v7 != v5);
      v5 = [obj countByEnumeratingWithState:&v93 objects:v102 count:16];
    }

    while (v5);
  }

  v58 = [MEMORY[0x277CBEB38] dictionary];
  v57 = [MEMORY[0x277CBEB38] dictionary];
  v19 = self;
  [(HMDHome *)self accessories];
  v85 = 0u;
  v86 = 0u;
  v87 = 0u;
  v56 = v88 = 0u;
  v60 = [v56 countByEnumeratingWithState:&v85 objects:v100 count:16];
  if (v60)
  {
    v59 = *v86;
    v73 = *MEMORY[0x277CFE810];
    do
    {
      for (j = 0; j != v60; ++j)
      {
        if (*v86 != v59)
        {
          objc_enumerationMutation(v56);
        }

        v21 = *(*(&v85 + 1) + 8 * j);
        v22 = [MEMORY[0x277CBEB18] array];
        v23 = [MEMORY[0x277CBEB18] array];
        v24 = v21;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v25 = v24;
        }

        else
        {
          v25 = 0;
        }

        v26 = v25;

        if (v26)
        {
          v61 = v24;
          v62 = v26;
          v68 = v23;
          v71 = v22;
          v63 = j;
          v83 = 0u;
          v84 = 0u;
          v81 = 0u;
          v82 = 0u;
          v64 = [v26 services];
          v66 = [v64 countByEnumeratingWithState:&v81 objects:v99 count:16];
          if (!v66)
          {
            goto LABEL_61;
          }

          v65 = *v82;
          while (1)
          {
            v27 = 0;
            do
            {
              if (*v82 != v65)
              {
                objc_enumerationMutation(v64);
              }

              v67 = v27;
              v28 = *(*(&v81 + 1) + 8 * v27);
              v29 = [v28 type];
              v77 = 0u;
              v78 = 0u;
              v79 = 0u;
              v80 = 0u;
              obja = [v28 characteristics];
              v30 = [obja countByEnumeratingWithState:&v77 objects:v98 count:16];
              if (v30)
              {
                v31 = v30;
                v32 = *v78;
                do
                {
                  v33 = 0;
                  do
                  {
                    if (*v78 != v32)
                    {
                      objc_enumerationMutation(obja);
                    }

                    v34 = *(*(&v77 + 1) + 8 * v33);
                    if ([v34 supportsNotification])
                    {
                      v35 = [(HMDHome *)v19 dataSource];
                      v36 = [v35 hapMetadata];
                      v37 = [v34 type];
                      v38 = [v36 shouldFilterEnableNotificationsForCharacteristicType:v37 serviceType:v29];

                      if ((v38 & 1) == 0)
                      {
                        if ([v29 isEqualToString:v73])
                        {
                          v39 = [v34 type];
                          v40 = [v39 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"];
                        }

                        else
                        {
                          v40 = 0;
                        }

                        v41 = [(HMDHome *)v19 dataSource];
                        v42 = [v41 hapMetadata];
                        v43 = [v34 type];
                        v44 = [v42 shouldAutoEnableNotificationForCharacteristic:v43 ofService:v29];

                        if ([v34 isClientNotificationEnabled] & 1) != 0 || (objc_msgSend(v70, "containsObject:", v34) & 1) != 0 || ((objc_msgSend(v34, "isNonHomeNotificationsEnabled") | v40 | v44))
                        {
                          v45 = v71;
LABEL_50:
                          [v45 addObject:v34];
                          v19 = v74;
                          goto LABEL_51;
                        }

                        if (!v69)
                        {
                          v45 = v68;
                          goto LABEL_50;
                        }

                        v46 = [v34 type];
                        v19 = v74;
                        v47 = [(HMDHome *)v74 dataSource];
                        v48 = [v47 hapMetadata];
                        v49 = [v48 shouldEnableHomeNotificationForCharacteristicType:v46 serviceType:v29];

                        if (v49)
                        {
                          [v71 addObject:v34];
                        }
                      }
                    }

LABEL_51:
                    ++v33;
                  }

                  while (v31 != v33);
                  v50 = [obja countByEnumeratingWithState:&v77 objects:v98 count:16];
                  v31 = v50;
                }

                while (v50);
              }

              v27 = v67 + 1;
            }

            while (v67 + 1 != v66);
            v66 = [v64 countByEnumeratingWithState:&v81 objects:v99 count:16];
            if (!v66)
            {
LABEL_61:

              v26 = v62;
              j = v63;
              v22 = v71;
              v23 = v68;
              v24 = v61;
              break;
            }
          }
        }

        v51 = [v24 uuid];
        v52 = [v51 UUIDString];

        if ([v22 count])
        {
          [v58 setObject:v22 forKeyedSubscript:v52];
        }

        if ([v23 count])
        {
          [v57 setObject:v23 forKeyedSubscript:v52];
        }
      }

      v60 = [v56 countByEnumeratingWithState:&v85 objects:v100 count:16];
    }

    while (v60);
  }

  v97[0] = v57;
  v97[1] = v58;
  v53 = [MEMORY[0x277CBEA60] arrayWithObjects:v97 count:2];

  v54 = *MEMORY[0x277D85DE8];

  return v53;
}

- (void)_handleRemoteGatewayNotificationRegistration:(id)a3 enable:(BOOL)a4
{
  v18 = a4;
  v25 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v19 = [MEMORY[0x277CBEAA8] date];
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v6 = v5;
  v7 = [v6 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v21;
    do
    {
      v10 = 0;
      do
      {
        if (*v21 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v20 + 1) + 8 * v10);
        v12 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v11];
        v13 = [(HMDHome *)self accessoryWithUUID:v12];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if (v15)
        {
          v16 = [v6 hmf_arrayForKey:v11];
          if ([v16 count])
          {
            [v15 handleRemoteGatewayNotificationRegistration:v16 enable:v18 enableTime:v19];
          }
        }

        ++v10;
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v20 objects:v24 count:16];
    }

    while (v8);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (BOOL)applyDeviceLockStatus:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 isRemote])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [v4 shortDescription];
      v19 = 138543618;
      v20 = v8;
      v21 = 2112;
      v22 = v9;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@%@ is from remote source; ignoring this device's lock status", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = 0;
  }

  else if ([v4 BOOLForKey:@"kApplyDeviceUnlockKey"])
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Treating device as always locked.", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v10 = 1;
  }

  else
  {
    v15 = [(HMDHome *)self dataSource];
    v16 = [v15 deviceLockStateDataSource];
    v10 = [v16 isLocked];
  }

  v17 = *MEMORY[0x277D85DE8];
  return v10;
}

- (void)configureMediaGroupsAggregateConsumer
{
  v33 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) != 0)
  {
    v3 = [(HMDHome *)self homeManager];
    v4 = [(HMDHome *)self uuid];
    v5 = [(HMDHome *)self notificationCenter];
    v6 = [v3 localAndRemoteSubscriptionProvider];
    v7 = [v3 userDefaults];
    v8 = v7;
    if (v6 && v4 && v5 && v7)
    {
      v9 = [[HMDMediaGroupsStageManager alloc] initWithIdentifier:v4 userDefaults:v7];
      v10 = [[HMDMediaGroupsAggregateConsumer alloc] initWithIdentifier:v4 subscriptionProvider:v6 notificationCenter:v5 stageManager:v9];
      mediaGroupsAggregateConsumer = self->_mediaGroupsAggregateConsumer;
      self->_mediaGroupsAggregateConsumer = v10;

      [(HMDMediaGroupsStageManager *)v9 setDelegate:self->_mediaGroupsAggregateConsumer];
      [(HMDMediaGroupsAggregateConsumer *)self->_mediaGroupsAggregateConsumer setDelegate:self];
      [(HMDMediaGroupsAggregateConsumer *)self->_mediaGroupsAggregateConsumer configureWithHome:self];
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v19 = HMFGetLogIdentifier();
        v21 = 138544642;
        v22 = v19;
        v23 = 2112;
        v24 = v4;
        v25 = 2112;
        v26 = v6;
        v27 = 2112;
        v28 = v5;
        v29 = 2112;
        v30 = v8;
        v31 = 2112;
        v32 = v3;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups aggregate consumer with dependencies homeUUID: %@ subscriptionProvider: %@ notificationCenter: %@ userDefaults: %@ homeManager: %@", &v21, 0x3Eu);
      }

      objc_autoreleasePoolPop(v16);
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is disabled", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (id)roomForAllDestinationParentIdentifiers:(id)a3
{
  v36 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 count])
  {
    v5 = [(HMDHome *)self accessoriesWithUUIDs:v4];
    v6 = [(HMDHome *)self mediaSystemsWithUUIDs:v4];
    v7 = [v4 count];
    v8 = [v5 count];
    if (v7 == [v6 count] + v8)
    {
      v9 = [v5 firstObject];
      v10 = [v9 room];
      v11 = v10;
      if (v10)
      {
        v12 = v10;
      }

      else
      {
        v18 = [v6 firstObject];
        v12 = [v18 room];
      }

      v26[0] = MEMORY[0x277D85DD0];
      v26[1] = 3221225472;
      v26[2] = __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke;
      v26[3] = &unk_27972C828;
      v19 = v12;
      v27 = v19;
      if ([v5 na_allObjectsPassTest:v26])
      {
        v24[0] = MEMORY[0x277D85DD0];
        v24[1] = 3221225472;
        v24[2] = __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke_2;
        v24[3] = &unk_279726148;
        v20 = v19;
        v25 = v20;
        if ([v6 na_allObjectsPassTest:v24])
        {
          v21 = v20;
        }

        else
        {
          v21 = 0;
        }

        v13 = v21;
      }

      else
      {
        v13 = 0;
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      v15 = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138544130;
        v29 = v17;
        v30 = 2112;
        v31 = v4;
        v32 = 2112;
        v33 = v5;
        v34 = 2112;
        v35 = v6;
        _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to find room due to missing destination parent identifiers: %@ found accessories: %@ found media systems: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v14);
      v13 = 0;
    }
  }

  else
  {
    v13 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v13;
}

uint64_t __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 room];
  v4 = [v3 uuid];
  v5 = [*(a1 + 32) uuid];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

uint64_t __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 room];
  v4 = [v3 uuid];
  v5 = [*(a1 + 32) uuid];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

- (id)roomForAccessoryUUID:(id)a3
{
  v3 = [(HMDHome *)self accessoryWithUUID:a3];
  v4 = [v3 room];

  return v4;
}

- (id)sameRoomAccessoryUUIDsForDestinationControllerData:(id)a3 mediaGroupsAggregator:(id)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 parentIdentifier];
  v9 = [(HMDHome *)self roomForAccessoryUUID:v8];

  if (v9)
  {
    v10 = [(HMDHome *)self accessories];
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __84__HMDHome_sameRoomAccessoryUUIDsForDestinationControllerData_mediaGroupsAggregator___block_invoke;
    v19[3] = &unk_279722060;
    v20 = v9;
    v11 = [v10 na_map:v19];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v6 parentIdentifier];
      *buf = 138543618;
      v22 = v15;
      v23 = 2112;
      v24 = v16;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to get available destinations due to no room for accessory uuid: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = MEMORY[0x277CBEBF8];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

id __84__HMDHome_sameRoomAccessoryUUIDsForDestinationControllerData_mediaGroupsAggregator___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 room];
  v5 = [v4 uuid];
  v6 = [*(a1 + 32) uuid];
  if ([v5 hmf_isEqualToUUID:v6])
  {
    v7 = [v3 uuid];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)eventSourceForMediaGroupsAggregator:(id)a3
{
  v3 = [(HMDHome *)self homeManager];
  v4 = [v3 currentEventSource];

  return v4;
}

- (id)participantDataTopicForAccessory:(id)a3 mediaGroupsAggregator:(id)a4
{
  v5 = MEMORY[0x277CD16F0];
  v6 = *MEMORY[0x277CCEA70];
  v7 = a3;
  v8 = [(HMDHome *)self uuid];
  v9 = [v7 uuid];

  v10 = [v5 topicFromSuffixID:v6 homeUUID:v8 accessoryUUID:v9];

  return v10;
}

- (void)configureMediaGroupsAggregator
{
  v51 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) != 0)
  {
    v3 = [(HMDHome *)self uuid];
    v4 = [(HMDHome *)self homeManager];
    v5 = [v4 uuid];
    v30 = [(HMDHome *)self notificationCenter];
    v29 = [(HMDHome *)self primaryResidentChangeMonitor];
    v6 = [v4 eventForwarder];
    v7 = [v4 localAndRemoteSubscriptionProvider];
    v8 = [v4 eventStoreReadHandle];
    v9 = [(HMDHome *)self msgDispatcher];
    v28 = v9;
    if (v3 && v30 && v29 && v6 && v7 && v8 && v9)
    {
      v10 = [[HMDMediaGroupsAggregatorBackupSender alloc] initWithIdentifier:v3];
      v24 = [[HMDMediaGroupsLocalDataStorage alloc] initWithIdentifier:v3 backupSender:v10];
      v11 = objc_alloc_init(HMDMediaGroupsAggregatorMessenger);
      v26 = v5;
      v12 = [[HMDMediaGroupsAggregator alloc] initWithIdentifier:v3 messenger:v11 eventForwarder:v6 subscriptionProvider:v7 eventStoreReadHandle:v8 groupsLocalDataStorage:v24];
      [(HMDMediaGroupsAggregatorBackupSender *)v10 setDataSource:v24];
      [(HMDMediaGroupsLocalDataStorage *)v24 setDataSource:self];
      [(HMDMediaGroupsAggregatorMessenger *)v11 setDataSource:self];
      [(HMDMediaGroupsAggregatorMessenger *)v11 setDelegate:v12];
      [(HMDMediaGroupsAggregator *)v12 setDataSource:self];
      [(HMDHome *)self setMediaGroupsAggregator:v12];
      v13 = [(HMDHome *)self mediaGroupsAggregator];
      v14 = self;
      v15 = v28;
      [v13 configureWithHome:v14 messageDispatcher:v28 notificationCenter:v30 primaryResidentChangeMonitor:v29];

      v5 = v26;
    }

    else
    {
      v27 = v8;
      context = objc_autoreleasePoolPush();
      v20 = self;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138545666;
        v32 = v22;
        v33 = 2112;
        v34 = v3;
        v35 = 2112;
        v36 = v5;
        v37 = 2112;
        v38 = v30;
        v39 = 2112;
        v40 = v29;
        v41 = 2112;
        v42 = v6;
        v43 = 2112;
        v44 = v7;
        v45 = 2112;
        v46 = v27;
        v47 = 2112;
        v48 = v4;
        v49 = 2112;
        v50 = v28;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups aggregator with dependencies homeUUID: %@ homeManagerUUID: %@ notificationCenter: %@ primaryChangeMonitor: %@ eventForwarder: %@ subscriptionProvider: %@ eventStoreReadHandle: %@ homeManager: %@ message dispatcher: %@", buf, 0x66u);
      }

      objc_autoreleasePoolPop(context);
      v8 = v27;
      v15 = v28;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v32 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)configureMediaGroupsUnconfiguredParticipantOnboardingManager
{
  v23 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) != 0)
  {
    v3 = [(HMDHome *)self uuid];
    v4 = [(HMDHome *)self notificationCenter];
    v5 = v4;
    if (v3 && v4)
    {
      v6 = [[HMDMediaGroupsUnconfiguredParticipantOnboardingManager alloc] initWithIdentifier:v3];
      [(HMDMediaGroupsUnconfiguredParticipantOnboardingManager *)v6 setDataSource:self];
      [(HMDHome *)self setMediaGroupsUnconfiguredParticipantOnboardingManager:v6];
      v7 = [(HMDHome *)self mediaGroupsUnconfiguredParticipantOnboardingManager];
      [v7 configureWithNotificationCenter:v5];
    }

    else
    {
      v12 = objc_autoreleasePoolPush();
      v13 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        v15 = HMFGetLogIdentifier();
        v17 = 138543874;
        v18 = v15;
        v19 = 2112;
        v20 = v3;
        v21 = 2112;
        v22 = v5;
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups unconfigured participant onboarding manager with dependencies homeUUID: %@ notificationCenter: %@", &v17, 0x20u);
      }

      objc_autoreleasePoolPop(v12);
    }
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v11;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", &v17, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (id)receiverForParticipantAccessoryUUID:(id)a3 mediaGroupsLocalDataStorage:(id)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self homeManager];
  v9 = [v8 mediaGroupParticipantDataLocalStorage];
  v10 = [v9 groupsBackupReceiver];
  v11 = v10;
  if (v10)
  {
    v12 = v10;
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543874;
      v20 = v16;
      v21 = 2112;
      v22 = v8;
      v23 = 2112;
      v24 = v9;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to get groups backup receiver with homeManager: %@ participantStorage: %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

- (id)routerForParticipantAccessoryUUID:(id)a3 mediaGroupsLocalDataStorage:(id)a4
{
  v22 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  if (v10)
  {
    v11 = [v10 messageRouter];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = v6;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to get router for unknown accessory uuid: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v11;
}

- (void)mergeMediaDestinationsWithConsumer:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self appleMediaAccessories];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke;
  v11[3] = &unk_279731490;
  v6 = v4;
  v12 = v6;
  [v5 na_each:v11];

  v7 = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke_2;
  v9[3] = &unk_279722038;
  v10 = v6;
  v8 = v6;
  [v7 na_each:v9];
}

void __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestination:v6];
  }
}

void __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestination:v6];
  }
}

- (void)mergeMediaDestinationControllerDataWithConsumer:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self appleMediaAccessories];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __59__HMDHome_mergeMediaDestinationControllerDataWithConsumer___block_invoke;
  v7[3] = &unk_279731490;
  v8 = v4;
  v6 = v4;
  [v5 na_each:v7];
}

void __59__HMDHome_mergeMediaDestinationControllerDataWithConsumer___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationControllerDataWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestinationControllerData:v6];
  }
}

- (void)mergeMediaGroupsAggregateDataWithConsumer:(id)a3
{
  v4 = a3;
  [(HMDHome *)self mergeMediaDestinationsWithConsumer:v4];
  [(HMDHome *)self mergeMediaDestinationControllerDataWithConsumer:v4];
  v6 = [(HMDHome *)self mediaSystemController];
  v5 = [v4 allMediaSystemData];

  [v6 mergeMediaSystemData:v5];
}

- (void)didUpdateAggregateDataForMediaGroupsAggregateConsumer:(id)a3
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Updating home graph due to updated media groups aggregate data", &v16, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  [(HMDHome *)v6 mergeMediaGroupsAggregateDataWithConsumer:v4];
  v9 = [(HMDHome *)v6 homeManager];
  if (v9)
  {
    v10 = [(HMDHome *)v6 uuid];
    [v9 updateGenerationCounterWithReason:@"HMDMediaGroupsAggregateConsumerDelegateUpdatedAggregateData" sourceUUID:v10 shouldNotifyClients:1];

    [v9 assistantSyncDataChanged:@"HMDMediaGroupsAggregateConsumerDelegateUpdatedAggregateData"];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = v6;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v16 = 138543362;
      v17 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Failed to update home graph for media groups due to no home manager", &v16, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (HMDDevice)currentDevice
{
  v2 = +[HMDAppleAccountManager sharedManager];
  v3 = [v2 device];

  return v3;
}

- (HMFWiFiManager)wifiManager
{
  v2 = [(HMDHome *)self dataSource];
  v3 = [v2 wifiManager];

  return v3;
}

- (void)_handleFetchUniqueIdentifierForBundleIdentifier:(id)a3
{
  v27 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:*MEMORY[0x277CCFE48]];
  if (v5)
  {
    v18 = 0;
    v6 = [HMDApplicationInfo clientIdentifierSaltForBundleIdentifier:v5 error:&v18];
    v7 = v18;
    if (v6)
    {
      v8 = MEMORY[0x277CCAD78];
      v9 = [(HMDHome *)self uuid];
      v10 = [v8 hm_deriveUUIDFromBaseUUID:v9 identifierSalt:v6];

      v19 = *MEMORY[0x277CD0570];
      v20 = v10;
      v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v20 forKeys:&v19 count:1];
      [v4 respondWithPayload:v11];
    }

    else
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543874;
        v22 = v16;
        v23 = 2112;
        v24 = v5;
        v25 = 2112;
        v26 = v7;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Failed to get client identifier salt for bundle identifier: %@, error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
      if (v7)
      {
        [v4 respondWithError:v7];
        goto LABEL_10;
      }

      v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v4 respondWithError:v10];
    }

LABEL_10:
    goto LABEL_11;
  }

  v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2 description:0 reason:@"Payload is missing the bundle identifier." suggestion:0];
  [v4 respondWithError:v12];

LABEL_11:
  v17 = *MEMORY[0x277D85DE8];
}

- (void)configureMediaGroupObjects
{
  v11 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) != 0)
  {
    [(HMDHome *)self configureMediaGroupsUnconfiguredParticipantOnboardingManager];
    [(HMDHome *)self configureMediaGroupsAggregator];
    v3 = *MEMORY[0x277D85DE8];

    [(HMDHome *)self configureMediaGroupsAggregateConsumer];
  }

  else
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v8 = *MEMORY[0x277D85DE8];
  }
}

- (id)accessoriesWithUUIDs:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self accessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __32__HMDHome_accessoriesWithUUIDs___block_invoke;
  v9[3] = &unk_27972C828;
  v10 = v4;
  v6 = v4;
  v7 = [v5 na_filter:v9];

  return v7;
}

uint64_t __32__HMDHome_accessoriesWithUUIDs___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 uuid];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (void)configureNaturalLightingWithDemoModeEnabled:(BOOL)a3
{
  v5 = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __55__HMDHome_configureNaturalLightingWithDemoModeEnabled___block_invoke;
  v6[3] = &unk_279735D28;
  v6[4] = self;
  v7 = a3;
  dispatch_async(v5, v6);
}

void __55__HMDHome_configureNaturalLightingWithDemoModeEnabled___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) localCapabilitiesDataSource];
  if ([v2 isResidentCapable])
  {
  }

  else
  {
    v3 = *(a1 + 40);

    if ((v3 & 1) == 0)
    {
      return;
    }
  }

  v4 = [[HMDHomeNaturalLightingContextUpdater alloc] initWithHome:*(a1 + 32) demoModeEnabled:*(a1 + 40)];
  [*(a1 + 32) setNaturalLightingContextUpdater:v4];

  v5 = [*(a1 + 32) naturalLightingContextUpdater];
  [v5 configure];
}

- (void)configureMediaDestinationControllersForAccessories:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [v4 na_map:&__block_literal_global_821];

  [v6 na_each:&__block_literal_global_824];
}

void *__62__HMDHome_configureMediaDestinationControllersForAccessories___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)configureMediaSystems
{
  v6 = [(HMDHome *)self mediaSystemController];
  v3 = [(HMDHome *)self workQueue];
  v4 = [(HMDHome *)self msgDispatcher];
  v5 = [(HMDHome *)self notificationCenter];
  [v6 configure:self delegate:self dataSource:self queue:v3 messageDispatcher:v4 notificationCenter:v5];
}

- (BOOL)hasSiriEndpointAccessory
{
  v17 = *MEMORY[0x277D85DE8];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v3)
  {
    v4 = *v13;
    while (2)
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v13 != v4)
        {
          objc_enumerationMutation(v2);
        }

        v6 = *(*(&v12 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v7 = v6;
        }

        else
        {
          v7 = 0;
        }

        v8 = v7;

        if (v8)
        {
          v9 = [v8 siriEndpointProfile];

          if (v9)
          {
            LOBYTE(v3) = 1;
            goto LABEL_15;
          }
        }
      }

      v3 = [v2 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v3)
      {
        continue;
      }

      break;
    }
  }

LABEL_15:

  v10 = *MEMORY[0x277D85DE8];
  return v3;
}

- (BOOL)supportsDeviceWithCapabilities:(id)a3
{
  v4 = a3;
  if (-[HMDHome hasSiriEndpointAccessory](self, "hasSiriEndpointAccessory") && ![v4 supportsSiriEndpointSetup])
  {
    v5 = 0;
  }

  else
  {
    v5 = [v4 supportsResidentFirstAccessoryCommunication];
  }

  return v5;
}

- (void)registerForDeviceWithCapabilities
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v10 = 138543362;
    v11 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Registering for device with capabilities and confirming resident device", &v10, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v7 = [(HMDHome *)v4 residentDeviceManager];
  [v7 addDataSource:v4];

  v8 = [(HMDHome *)v4 residentDeviceManager];
  [v8 confirmWithCompletionHandler:0];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)migrateLegacyLocationServiceSettings
{
  v11 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isOwnerUser]&& ![(HMDHome *)self didOnboardLocationServices])
  {
    v3 = [(HMDHome *)self appleMediaAccessories];
    if ([v3 count])
    {
      v4 = objc_autoreleasePoolPush();
      v5 = self;
      v6 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = HMFGetLogIdentifier();
        v9 = 138543362;
        v10 = v7;
        _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Migrating legacy location service setting", &v9, 0xCu);
      }

      objc_autoreleasePoolPop(v4);
      if ([v3 na_allObjectsPassTest:&__block_literal_global_818])
      {
        [(HMDHome *)v5 runLocationServicesEnabledUpdateWithValue:1];
      }
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (id)eventRouterServerDiagnosticInfo
{
  v2 = [(HMDHome *)self remoteEventRouterServer];
  v3 = [v2 diagnosticInfo];

  return v3;
}

- (void)createRemoteEventRouterServerIfNeeded
{
  v65 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self homeManager];
  v4 = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  v7 = [(HMDHome *)self remoteEventRouterServer];
  v8 = [v7 residentModeUUID];

  if (v6)
  {
    v9 = [(HMDHome *)self localCapabilitiesDataSource];
    if ([v9 isResidentCapable])
    {
      if (!v8)
      {

LABEL_14:
        v18 = [v6 uuid];
        v19 = [v8 isEqual:v18];

        if ((v19 & 1) == 0)
        {
          v20 = objc_autoreleasePoolPush();
          v21 = self;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
          {
            v23 = HMFGetLogIdentifier();
            v24 = [v6 uuid];
            *buf = 138543874;
            v58 = v23;
            v59 = 2112;
            v60 = v8;
            v61 = 2112;
            v62 = v24;
            _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Overwriting stale remote event router server with uuid: %@ to current accessory uuid: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v20);
        }

        v25 = objc_autoreleasePoolPush();
        v26 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          *buf = 138543618;
          v58 = v28;
          v59 = 2112;
          v60 = v6;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Creating remote event router server with current accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v25);
        v29 = [v3 localOnlySubscriptionProvider];
        if (objc_opt_respondsToSelector())
        {
          v30 = [(HMDHome *)v26 serverDelegatingEventRouter];
          v31 = [v29 synchronousSubscriptionProvider];
          [v30 registerSubRouter:v31];

          v32 = [(HMDHome *)v26 serverDelegatingEventRouter];

          v29 = v32;
        }

        v54 = v29;
        v55 = v8;
        v33 = [(HMDHome *)v26 remoteEventRouterClientController];
        v34 = [v33 residentDelegatingEventRouter];

        if (v34)
        {
          v35 = [(HMDHome *)v26 serverDelegatingEventRouter];
          [v35 registerSubRouter:v34];
        }

        v53 = v34;
        v51 = [HMDRemoteEventRouterServer alloc];
        v50 = [(HMDHome *)v26 uuid];
        v36 = [v6 uuid];
        [v3 workQueue];
        v37 = v52 = v6;
        v38 = [(HMDHome *)v26 msgDispatcher];
        v39 = [(HMDHome *)v26 notificationCenter];
        v40 = [(HMDHome *)v26 serverDelegatingEventRouter];
        v41 = [v3 eventForwarder];
        v42 = [v3 eventStoreReadHandle];
        v43 = [(HMDRemoteEventRouterServer *)v51 initWithPrimaryModeUUID:v50 residentModeUUID:v36 queue:v37 messageDispatcher:v38 dataSource:v26 notificationCenter:v39 requestMessageName:@"RemoteEventRouterRequestMessage" updateMessageName:@"RemoteEventRouterUpdateMessageName" multiHopFetchResponseMessageName:@"RER.MHF.ResponseMessageName" subscriptionProvider:v40 registrationEventRouter:v41 storeReadHandle:v42];
        [(HMDHome *)v26 setRemoteEventRouterServer:v43];

        v6 = v52;
        v44 = [HMDUserMessagePolicy userMessagePolicyWithHome:v26 userPrivilege:0 remoteAccessRequired:0];
        v45 = isTVOSDevice();
        v46 = [(HMDHome *)v26 remoteEventRouterServer];
        v47 = [(HMDHome *)v26 isCurrentDevicePrimaryResident];
        v56 = v44;
        v48 = [MEMORY[0x277CBEA60] arrayWithObjects:&v56 count:1];
        [v46 configureWithHome:v26 isPrimaryResident:v47 isResidentEventProviding:v45 additionalPolicies:v48];

        v8 = v55;
        goto LABEL_25;
      }

      v10 = [v6 uuid];
      v11 = [v8 isEqual:v10];

      if ((v11 & 1) == 0)
      {
        goto LABEL_14;
      }
    }

    else
    {
    }
  }

  v12 = objc_autoreleasePoolPush();
  v13 = self;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    v16 = [(HMDHome *)v13 localCapabilitiesDataSource];
    [v16 isResidentCapable];
    v17 = HMFBooleanToString();
    *buf = 138544130;
    v58 = v15;
    v59 = 2112;
    v60 = v6;
    v61 = 2112;
    v62 = v17;
    v63 = 2112;
    v64 = v8;
    _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Cannot create remote event router server with currentAccessory: %@ isResidentCapable: %@ serverAccessoryUUID: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v12);
LABEL_25:

  v49 = *MEMORY[0x277D85DE8];
}

- (void)configureRemoteEventRouterClientControllerForAccessories:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (_os_feature_enabled_impl())
  {
    v20 = 0u;
    v21 = 0u;
    v18 = 0u;
    v19 = 0u;
    v17 = v4;
    v5 = v4;
    v6 = [v5 countByEnumeratingWithState:&v18 objects:v22 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v19;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v19 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = *(*(&v18 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v11 = v10;
          }

          else
          {
            v11 = 0;
          }

          v12 = v11;

          if (v12)
          {
            v13 = [v10 isCurrentAccessory];
            v14 = [(HMDHome *)self remoteEventRouterClientController];
            v15 = [v10 uuid];
            if (v13)
            {
              [v14 updateCurrentAccessoryUUID:v15];
            }

            else
            {
              [v14 createResidentRouterForAccessoryUUID:v15];
            }
          }
        }

        v7 = [v5 countByEnumeratingWithState:&v18 objects:v22 count:16];
      }

      while (v7);
    }

    v4 = v17;
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:(id)a3 accessories:(id)a4 uncommittedTransactions:(id)a5
{
  v91 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    *buf = 138543362;
    v85 = v14;
    _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Configuring after accessories configuration tracker notifications", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v11);
  v15 = [(HMDHome *)v12 workQueue];
  dispatch_assert_queue_V2(v15);

  [(HMDHome *)v12 configureBulletinNotification];
  [(HMDHome *)v12 _evaluateNetworkProtectionAndRouterManagement];
  if (v8)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = v12;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v85 = v19;
      v86 = 2112;
      v87 = v8;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Setting up media session for current accessory during configure - %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [(HMDHome *)v17 _addMediaSessionForCurrentAccessory:v8];
    v21 = v8;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v23 = v21;
    }

    else
    {
      v23 = 0;
    }

    v24 = v23;

    if (isKindOfClass)
    {
      [v21 configureSensors];
    }
  }

  v25 = [(HMDHome *)v12 localCapabilitiesDataSource];
  v26 = [v25 isResidentCapable];

  if (v26)
  {
    v27 = [(HMDHome *)v12 mediaStateManager];
    v28 = [(HMDHome *)v12 notificationRegistry];
    v29 = [(HMDHome *)v12 notificationCenter];
    [v27 configureWithNotificationRegistry:v28 notificationCenter:v29];
  }

  [(HMDHome *)v12 configureMediaSystems];
  [(HMDHome *)v12 configureMediaDestinationControllersForAccessories:v9];
  [(HMDHome *)v12 registerForDeviceWithCapabilities];
  [(HMDHome *)v12 configureAppleMediaAccessoriesStateManagerWithStateManagerWithFactory:v12 messengerFactory:v12 metricsDispatcherFactory:v12];
  v30 = objc_autoreleasePoolPush();
  if ([v10 count])
  {
    v31 = [(HMDHome *)v12 backingStore];
    v32 = [v31 root];
    v33 = [v32 encodeForKey];

    v82[0] = MEMORY[0x277D85DD0];
    v82[1] = 3221225472;
    v82[2] = __126__HMDHome_configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory_accessories_uncommittedTransactions___block_invoke;
    v82[3] = &unk_279721FF0;
    v34 = v33;
    v83 = v34;
    v35 = [v10 na_filter:v82];
    if ([v35 count])
    {
      v66 = v34;
      v67 = v30;
      v69 = v10;
      v70 = v9;
      v71 = v8;
      v36 = objc_autoreleasePoolPush();
      v68 = v12;
      v37 = v12;
      v38 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_DEFAULT))
      {
        v39 = HMFGetLogIdentifier();
        *buf = 138543618;
        v85 = v39;
        v86 = 2112;
        v87 = v35;
        _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_DEFAULT, "%{public}@Obtained uncommitted transactions that need to be applied: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v36);
      v72 = [MEMORY[0x277CBEB18] array];
      v78 = 0u;
      v79 = 0u;
      v80 = 0u;
      v81 = 0u;
      v65 = v35;
      obj = v35;
      v74 = [obj countByEnumeratingWithState:&v78 objects:v90 count:16];
      if (v74)
      {
        v40 = *v79;
        p_cache = HMDDataSyncStateLogEvent.cache;
        do
        {
          for (i = 0; i != v74; ++i)
          {
            if (*v79 != v40)
            {
              objc_enumerationMutation(obj);
            }

            v43 = *(*(&v78 + 1) + 8 * i);
            v44 = [v43 data];
            v45 = [v43 encoding];
            v46 = [v43 rowID];
            v77 = 0;
            v47 = [p_cache + 433 objectFromData:v44 encoding:v45 rowID:v46 error:&v77];
            v48 = v77;

            [v47 setObjectChangeType:{objc_msgSend(v43, "type")}];
            if (v48)
            {
              v49 = objc_autoreleasePoolPush();
              v50 = v37;
              v51 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v51, OS_LOG_TYPE_ERROR))
              {
                HMFGetLogIdentifier();
                v52 = v40;
                v54 = v53 = v37;
                *buf = 138543874;
                v85 = v54;
                v86 = 2112;
                v87 = v43;
                v88 = 2112;
                v89 = v48;
                _os_log_impl(&dword_2531F8000, v51, OS_LOG_TYPE_ERROR, "%{public}@Error decoding log record %@: %@", buf, 0x20u);

                v37 = v53;
                v40 = v52;
                p_cache = (HMDDataSyncStateLogEvent + 16);
              }

              objc_autoreleasePoolPop(v49);
            }

            else
            {
              [v72 addObject:v47];
            }
          }

          v74 = [obj countByEnumeratingWithState:&v78 objects:v90 count:16];
        }

        while (v74);
      }

      v55 = objc_autoreleasePoolPush();
      v56 = v37;
      v57 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v57, OS_LOG_TYPE_DEFAULT))
      {
        v58 = HMFGetLogIdentifier();
        *buf = 138543618;
        v85 = v58;
        v86 = 2112;
        v87 = v72;
        _os_log_impl(&dword_2531F8000, v57, OS_LOG_TYPE_DEFAULT, "%{public}@Rerunning uncommitted transaction models %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v55);
      v59 = [(HMDHome *)v56 backingStore];
      v60 = +[HMDBackingStoreTransactionOptions defaultLocalOptions];
      v61 = [v59 transaction:@"RerunUncommitted" options:v60];

      [v61 addObjects:v72];
      v75[0] = MEMORY[0x277D85DD0];
      v75[1] = 3221225472;
      v75[2] = __126__HMDHome_configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory_accessories_uncommittedTransactions___block_invoke_809;
      v75[3] = &unk_2797358C8;
      v75[4] = v56;
      v76 = v72;
      v62 = v72;
      [v61 runWithoutSave:v75];

      v9 = v70;
      v8 = v71;
      v12 = v68;
      v10 = v69;
      v34 = v66;
      v30 = v67;
      v35 = v65;
    }
  }

  objc_autoreleasePoolPop(v30);
  [(HMDHome *)v12 migrateLegacyLocationServiceSettings];
  [(HMDHome *)v12 configureMediaGroupObjects];
  v63 = [(HMDHome *)v12 accessories];
  [(HMDHome *)v12 configureRemoteEventRouterClientControllerForAccessories:v63];

  v64 = *MEMORY[0x277D85DE8];
}

uint64_t __126__HMDHome_configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory_accessories_uncommittedTransactions___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 root];
  v4 = [v3 encodeForKey];
  v5 = [v2 isEqualToString:v4];

  return v5;
}

void __126__HMDHome_configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory_accessories_uncommittedTransactions___block_invoke_809(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Saved uncommitted transaction models %@ with error: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
}

- (BOOL)configureWithHomeManager:(id)a3 accessoriesPresent:(id)a4 uncommittedTransactions:(id)a5 source:(unint64_t)a6
{
  v553 = *MEMORY[0x277D85DE8];
  v436 = a3;
  v450 = a4;
  v431 = a5;
  HMFUptime();
  v10 = v9;
  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = [(HMDHome *)v12 uuid];
    [(HMDHome *)v12 locationServicesEnabled];
    v16 = HMFBooleanToString();
    *buf = 138545410;
    v511 = v14;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configuring home with location service enabled";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"start";
    v520 = 2114;
    v521 = @"homeUUID";
    v522 = 2112;
    v523 = v15;
    v524 = 2114;
    v525 = @"status";
    v526 = 2112;
    v527 = v16;
    _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v11);
  v17 = [MEMORY[0x277D17DE8] sharedInstance];
  v18 = objc_alloc(MEMORY[0x277D17DF8]);
  v19 = [(HMDHome *)v12 uuid];
  [(HMDHome *)v12 locationServicesEnabled];
  v20 = HMFBooleanToString();
  v21 = HMDTaggedLoggingCreateDictionary();
  v22 = [v18 initWithTag:@"homeConfigureStart" data:{v21, @"state", @"start", @"homeUUID", v19, @"status", v20}];
  v23 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v17 submitTaggedEvent:v22 processorList:v23];

  [(HMDHome *)v12 setHomeManager:v436];
  v24 = [v436 messageDispatcher];
  [(HMDHome *)v12 setMsgDispatcher:v24];

  v25 = [v436 accessoryBrowser];
  [(HMDHome *)v12 setAccessoryBrowser:v25];

  v26 = [v436 metricsManager];
  v27 = [v26 logEventSubmitter];
  logEventSubmitter = v12->_logEventSubmitter;
  v12->_logEventSubmitter = v27;

  if (!v12->_metricsDispatcher)
  {
    v29 = [(HMDHome *)v12 dataSource];
    uuid = v12->_uuid;
    v31 = [(HMDHome *)v12 logEventSubmitter];
    v32 = [v29 makeHomeMetricsDispatcherWithIdentifier:uuid logEventSubmitter:v31];
    metricsDispatcher = v12->_metricsDispatcher;
    v12->_metricsDispatcher = v32;
  }

  v34 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:8 options:7.0];
  homeLocationTimer = v12->_homeLocationTimer;
  v12->_homeLocationTimer = v34;

  [(HMFTimer *)v12->_homeLocationTimer setDelegateQueue:v12->_workQueue];
  [(HMFTimer *)v12->_homeLocationTimer setDelegate:v12];
  v36 = [MEMORY[0x277D0F8D0] sharedPreferences];
  v37 = [v36 preferenceForKey:@"accessoryReachabilityCoalescePeriod"];
  v435 = [v37 numberValue];

  LODWORD(v36) = [v435 unsignedIntValue];
  v38 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:0 options:v36];
  accessoryReachabilityUpdatesTimer = v12->_accessoryReachabilityUpdatesTimer;
  v12->_accessoryReachabilityUpdatesTimer = v38;

  [(HMFTimer *)v12->_accessoryReachabilityUpdatesTimer setDelegate:v12];
  [(HMFTimer *)v12->_accessoryReachabilityUpdatesTimer setDelegateQueue:v12->_workQueue];
  v40 = [(HMDHome *)v12 roomForEntireHome];
  v41 = [(HMDHome *)v12 msgDispatcher];
  v42 = [(HMDHome *)v12 workQueue];
  [v40 configure:v41 queue:v42];

  [(HMDHome *)v12 setOwnerUser:[HMDHomeManager isThisDeviceAdminOfHome:v12]];
  [(HMDHome *)v12 setupBackingStore];
  v43 = [(HMDHome *)v12 periodicReader];
  [v43 configure:v12];

  v44 = [(HMDHome *)v12 presenceMonitor];
  v45 = [(HMDHome *)v12 msgDispatcher];
  [v44 configure:v12 messageDispatcher:v45];

  v46 = [(HMDHome *)v12 presenceFeeder];
  v47 = [(HMDHome *)v12 msgDispatcher];
  [v46 configure:v12 messageDispatcher:v47];

  v48 = objc_autoreleasePoolPush();
  v49 = v12;
  v50 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
  {
    v51 = HMFGetLogIdentifier();
    v52 = [(HMDHome *)v49 presenceFeeder];
    *buf = 138543618;
    v511 = v51;
    v512 = 2112;
    v513 = v52;
    _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_INFO, "%{public}@Configured presenceFeeder: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v48);
  v53 = [(HMDHome *)v49 homeLocationHandler];
  v54 = [(HMDHome *)v49 workQueue];
  v55 = [(HMDHome *)v49 msgDispatcher];
  [v53 configure:v49 queue:v54 messageDispatcher:v55];

  v56 = [(HMDHome *)v49 homeReprovisionHandler];
  v57 = [(HMDHome *)v49 workQueue];
  v58 = [(HMDHome *)v49 msgDispatcher];
  [v56 configure:v49 queue:v57 messageDispatcher:v58];

  v59 = [(HMDHome *)v49 sharedHomeUpdateHandler];
  [v59 registerForMessages];

  v60 = [(HMDHome *)v49 reachabilityChangedLogEventManager];
  [v60 configure];

  [(HMDHome *)v49 updateHomeLocation];
  v61 = [(HMDHome *)v49 residentDeviceManager];
  v62 = +[HMDMessageDispatcher defaultDispatcher];
  [v61 configureWithHome:v49 messageDispatcher:v62];

  v63 = [(HMDHome *)v49 residentDeviceManager];
  [v63 setDelegate:v49];

  v64 = [(HMDHome *)v49 primaryResidentChangeMonitor];
  [v64 configureWithHome:v49];

  [(HMDHome *)v49 setResidentFirstAccessoryCommunicationEnabled:[(HMDHome *)v49 shouldEnableResidentFirstAccessoryCommunication]];
  [(HMDHome *)v49 _purgeResidentUsers];
  if ([(HMDHome *)v49 isOwnerUser])
  {
    v65 = [(HMDHome *)v49 primaryResident];
    v66 = [v65 device];
    v67 = [v66 isCurrentDevice];

    v68 = [(HMDHome *)v49 accessoryBrowser];
    [v68 setQOS:v67];
  }

  v69 = [(HMDHome *)v49 name];
  v70 = [(HMDHome *)v49 addName:v69];

  v71 = [(HMDHome *)v49 roomForEntireHome];
  v72 = [v71 name];
  v73 = [(HMDHome *)v49 addName:v72];

  v74 = [(HMDHome *)v49 notificationRegistrations];
  LOBYTE(v72) = [v74 count] == 0;

  if ((v72 & 1) == 0)
  {
    v508 = 0u;
    v509 = 0u;
    v506 = 0u;
    v507 = 0u;
    v75 = [(HMDHome *)v49 mediaSessions];
    v76 = [v75 countByEnumeratingWithState:&v506 objects:v552 count:16];
    if (v76)
    {
      v77 = *v507;
      do
      {
        for (i = 0; i != v76; ++i)
        {
          if (*v507 != v77)
          {
            objc_enumerationMutation(v75);
          }

          [*(*(&v506 + 1) + 8 * i) registerForSessionUpdates:1];
        }

        v76 = [v75 countByEnumeratingWithState:&v506 objects:v552 count:16];
      }

      while (v76);
    }
  }

  group = dispatch_group_create();
  [(HMDHome *)v49 setBulletinNotificationsSupported:1];
  v79 = [(HMDHome *)v49 accessories];
  v442 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v79, "count")}];
  HMFUptime();
  v81 = v80;
  v82 = objc_autoreleasePoolPush();
  v83 = v49;
  v84 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v84, OS_LOG_TYPE_DEBUG))
  {
    v85 = HMFGetLogIdentifier();
    v86 = [(HMDHome *)v83 uuid];
    *buf = 138544898;
    v511 = v85;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configuring accessories";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfigureAccessories";
    v520 = 2114;
    v521 = @"homeUUID";
    v522 = 2112;
    v523 = v86;
    _os_log_impl(&dword_2531F8000, v84, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v82);
  v87 = [MEMORY[0x277D17DE8] sharedInstance];
  v88 = objc_alloc(MEMORY[0x277D17DF8]);
  v89 = [(HMDHome *)v83 uuid];
  v90 = HMDTaggedLoggingCreateDictionary();
  v91 = [v88 initWithTag:@"homeConfigureStart" data:{v90, @"state", @"homeConfigureAccessories", @"homeUUID", v89}];
  v92 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v87 submitTaggedEvent:v91 processorList:v92];

  v504 = 0u;
  v505 = 0u;
  v502 = 0u;
  v503 = 0u;
  obj = v79;
  v93 = [obj countByEnumeratingWithState:&v502 objects:v551 count:16];
  if (v93)
  {
    v443 = 0;
    v452 = *v503;
    do
    {
      for (j = 0; j != v93; ++j)
      {
        if (*v503 != v452)
        {
          objc_enumerationMutation(obj);
        }

        v95 = *(*(&v502 + 1) + 8 * j);
        v96 = objc_autoreleasePoolPush();
        v97 = v95;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v98 = v97;
        }

        else
        {
          v98 = 0;
        }

        v99 = v98;

        [v99 setDataSource:v83];
        v100 = v97;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v101 = v100;
        }

        else
        {
          v101 = 0;
        }

        v102 = v101;

        if (v102)
        {
          if ([v102 isPrimary])
          {
            v103 = [v102 identifier];
            v104 = [v102 supportedTransports];
            v105 = [v102 setupHash];
            [(HMDHome *)v83 _registerPairedAccessory:v103 transports:v104 setupHash:v105];
          }

          [v442 addObject:v102];
        }

        v106 = v100;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v107 = v106;
        }

        else
        {
          v107 = 0;
        }

        v108 = v107;

        if (v108)
        {
          if (v99)
          {
            v109 = [(HMDHome *)v83 capabilitiesAggregator];
            v110 = [v99 uuid];
            [v109 didAddAccessory:v110];
          }

          if ([v99 isCurrentAccessory])
          {
            v111 = v99;

            v443 = v111;
          }

          v112 = [v108 identifier];
          -[HMDHome _registerPairedAccessory:transports:setupHash:](v83, "_registerPairedAccessory:transports:setupHash:", v112, [v108 supportedTransports], 0);
        }

        v113 = [(HMDHome *)v83 msgDispatcher];
        [v106 configureWithHome:v83 msgDispatcher:v113 configurationTracker:group initialConfiguration:1];

        v114 = [v106 uuid];
        v115 = [v114 UUIDString];
        [v450 addObject:v115];

        objc_autoreleasePoolPop(v96);
      }

      v93 = [obj countByEnumeratingWithState:&v502 objects:v551 count:16];
    }

    while (v93);
  }

  else
  {
    v443 = 0;
  }

  v116 = objc_autoreleasePoolPush();
  v117 = v83;
  v118 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v118, OS_LOG_TYPE_INFO))
  {
    v119 = HMFGetLogIdentifier();
    v120 = MEMORY[0x277CCACA8];
    HMFUptime();
    v122 = [v120 stringWithFormat:@"%.3f", v121 - v81];
    v123 = [(HMDHome *)v117 uuid];
    v124 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(obj, "count")}];
    *buf = 138545922;
    v511 = v119;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configured accessories";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfiguredAccessories";
    v520 = 2114;
    v521 = @"duration";
    v522 = 2112;
    v523 = v122;
    v524 = 2114;
    v525 = @"homeUUID";
    v526 = 2112;
    v527 = v123;
    v528 = 2114;
    v529 = @"accessoriesCount";
    v530 = 2112;
    v531 = v124;
    _os_log_impl(&dword_2531F8000, v118, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x70u);
  }

  objc_autoreleasePoolPop(v116);
  v125 = [MEMORY[0x277D17DE8] sharedInstance];
  v126 = objc_alloc(MEMORY[0x277D17DF8]);
  v127 = MEMORY[0x277CCACA8];
  HMFUptime();
  v129 = [v127 stringWithFormat:@"%.3f", v128 - v81];
  v130 = [(HMDHome *)v117 uuid];
  v131 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(obj, "count")}];
  v132 = HMDTaggedLoggingCreateDictionary();
  v133 = [v126 initWithTag:@"homeConfigureStart" data:{v132, @"state", @"homeConfiguredAccessories", @"duration", v129, @"homeUUID", v130, @"accessoriesCount", v131}];
  v134 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v125 submitTaggedEvent:v133 processorList:v134];

  HMFUptime();
  v136 = v135;
  v137 = objc_autoreleasePoolPush();
  v138 = v117;
  v139 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v139, OS_LOG_TYPE_DEBUG))
  {
    v140 = HMFGetLogIdentifier();
    v141 = [(HMDHome *)v138 uuid];
    *buf = 138544898;
    v511 = v140;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configuring rooms, zones, groups, etc";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfigureProperties";
    v520 = 2114;
    v521 = @"homeUUID";
    v522 = 2112;
    v523 = v141;
    _os_log_impl(&dword_2531F8000, v139, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v137);
  v142 = [MEMORY[0x277D17DE8] sharedInstance];
  v143 = objc_alloc(MEMORY[0x277D17DF8]);
  v144 = [(HMDHome *)v138 uuid];
  v145 = HMDTaggedLoggingCreateDictionary();
  v146 = [v143 initWithTag:@"homeConfigureStart" data:{v145, @"state", @"homeConfigureProperties", @"homeUUID", v144}];
  v147 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v142 submitTaggedEvent:v146 processorList:v147];

  v500 = 0u;
  v501 = 0u;
  v498 = 0u;
  v499 = 0u;
  v148 = [(HMDHome *)v138 rooms];
  v149 = [v148 countByEnumeratingWithState:&v498 objects:v550 count:16];
  if (v149)
  {
    v150 = *v499;
    do
    {
      for (k = 0; k != v149; ++k)
      {
        if (*v499 != v150)
        {
          objc_enumerationMutation(v148);
        }

        v152 = *(*(&v498 + 1) + 8 * k);
        v153 = [(HMDHome *)v138 msgDispatcher];
        v154 = [(HMDHome *)v138 workQueue];
        [v152 configure:v153 queue:v154];

        v155 = [v152 name];
        v156 = [(HMDHome *)v138 addName:v155];
      }

      v149 = [v148 countByEnumeratingWithState:&v498 objects:v550 count:16];
    }

    while (v149);
  }

  v496 = 0u;
  v497 = 0u;
  v494 = 0u;
  v495 = 0u;
  v157 = [(HMDHome *)v138 zones];
  v158 = [v157 countByEnumeratingWithState:&v494 objects:v549 count:16];
  if (v158)
  {
    v159 = *v495;
    do
    {
      for (m = 0; m != v158; ++m)
      {
        if (*v495 != v159)
        {
          objc_enumerationMutation(v157);
        }

        v161 = *(*(&v494 + 1) + 8 * m);
        v162 = [(HMDHome *)v138 msgDispatcher];
        v163 = [(HMDHome *)v138 workQueue];
        [v161 configure:v162 queue:v163];

        v164 = [v161 name];
        v165 = [(HMDHome *)v138 addName:v164];
      }

      v158 = [v157 countByEnumeratingWithState:&v494 objects:v549 count:16];
    }

    while (v158);
  }

  v492 = 0u;
  v493 = 0u;
  v490 = 0u;
  v491 = 0u;
  v166 = [(HMDHome *)v138 serviceGroups];
  v167 = [v166 countByEnumeratingWithState:&v490 objects:v548 count:16];
  if (v167)
  {
    v168 = *v491;
    do
    {
      for (n = 0; n != v167; ++n)
      {
        if (*v491 != v168)
        {
          objc_enumerationMutation(v166);
        }

        v170 = *(*(&v490 + 1) + 8 * n);
        v171 = [(HMDHome *)v138 msgDispatcher];
        v172 = [(HMDHome *)v138 workQueue];
        [v170 configure:v171 queue:v172];

        v173 = [v170 name];
        v174 = [(HMDHome *)v138 addName:v173];
      }

      v167 = [v166 countByEnumeratingWithState:&v490 objects:v548 count:16];
    }

    while (v167);
  }

  v488 = 0u;
  v489 = 0u;
  v486 = 0u;
  v487 = 0u;
  v175 = [(HMDHome *)v138 actionSets];
  v176 = [v175 countByEnumeratingWithState:&v486 objects:v547 count:16];
  if (v176)
  {
    v453 = 0;
    v177 = *v487;
    do
    {
      for (ii = 0; ii != v176; ++ii)
      {
        if (*v487 != v177)
        {
          objc_enumerationMutation(v175);
        }

        v179 = *(*(&v486 + 1) + 8 * ii);
        v180 = objc_autoreleasePoolPush();
        v181 = [(HMDHome *)v138 msgDispatcher];
        v182 = [(HMDHome *)v138 workQueue];
        v183 = [v179 configure:v138 messageDispatcher:v181 queue:v182];

        v184 = [v179 name];
        v185 = [(HMDHome *)v138 addName:v184];

        objc_autoreleasePoolPop(v180);
        v453 |= v183;
      }

      v176 = [v175 countByEnumeratingWithState:&v486 objects:v547 count:16];
    }

    while (v176);
  }

  else
  {
    v453 = 0;
  }

  v484 = 0u;
  v485 = 0u;
  v482 = 0u;
  v483 = 0u;
  v186 = [(HMDHome *)v138 triggerOwnedActionSets];
  v187 = [v186 countByEnumeratingWithState:&v482 objects:v546 count:16];
  if (v187)
  {
    v188 = *v483;
    do
    {
      for (jj = 0; jj != v187; ++jj)
      {
        if (*v483 != v188)
        {
          objc_enumerationMutation(v186);
        }

        v190 = *(*(&v482 + 1) + 8 * jj);
        v191 = objc_autoreleasePoolPush();
        v192 = [(HMDHome *)v138 msgDispatcher];
        v193 = [(HMDHome *)v138 workQueue];
        LOBYTE(v190) = [v190 configure:v138 messageDispatcher:v192 queue:v193];

        objc_autoreleasePoolPop(v191);
        v453 |= v190;
      }

      v187 = [v186 countByEnumeratingWithState:&v482 objects:v546 count:16];
    }

    while (v187);
  }

  if (a6 <= 1)
  {
    v194 = [(HMDHome *)v138 actionSets];
    v195 = [(HMDHome *)v138 filterBuiltinActionSets:v194];
    v196 = [v195 count] == 0;

    if (v196)
    {
      v197 = [(HMDHome *)v138 isOwnerUser];
      v198 = objc_autoreleasePoolPush();
      v199 = v138;
      v200 = HMFGetOSLogHandle();
      v201 = os_log_type_enabled(v200, OS_LOG_TYPE_INFO);
      if (v197)
      {
        if (v201)
        {
          v202 = HMFGetLogIdentifier();
          v203 = [v199 actionSets];
          v204 = [v203 count];
          *buf = 138543618;
          v511 = v202;
          v512 = 2048;
          v513 = v204;
          _os_log_impl(&dword_2531F8000, v200, OS_LOG_TYPE_INFO, "%{public}@%ld user-defined actionSets; no builtin actionSets - creating....", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v198);
        v205 = [v199 _createBuiltinActionSets];
        os_unfair_recursive_lock_lock_with_options();
        [v199[11] addObjectsFromArray:v205];
        os_unfair_recursive_lock_unlock();

        v453 = 1;
      }

      else
      {
        if (v201)
        {
          v206 = HMFGetLogIdentifier();
          v207 = v199[151];
          *buf = 138543618;
          v511 = v206;
          v512 = 2112;
          v513 = v207;
          _os_log_impl(&dword_2531F8000, v200, OS_LOG_TYPE_INFO, "%{public}@Shared home - not creating builtin actionSets %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v198);
      }
    }
  }

  v480 = 0u;
  v481 = 0u;
  v478 = 0u;
  v479 = 0u;
  v208 = [(HMDHome *)v138 triggers];
  v209 = [v208 countByEnumeratingWithState:&v478 objects:v545 count:16];
  if (v209)
  {
    v210 = *v479;
    do
    {
      for (kk = 0; kk != v209; ++kk)
      {
        if (*v479 != v210)
        {
          objc_enumerationMutation(v208);
        }

        v212 = *(*(&v478 + 1) + 8 * kk);
        v213 = [(HMDHome *)v138 msgDispatcher];
        v214 = [(HMDHome *)v138 workQueue];
        [v212 configure:v138 messageDispatcher:v213 queue:v214];

        v215 = [v212 owner];
        LODWORD(v213) = v215 == 0;

        if (v213)
        {
          v216 = [(HMDHome *)v138 currentUser];
          [v212 setOwner:v216];
        }

        v217 = [v212 owner];
        if ([v217 isCurrentUser])
        {
          v218 = [v212 owningDevice];
          v219 = v218 == 0;

          if (v219)
          {
            v220 = [(HMDHome *)v138 currentDevice];
            [v212 setOwningDevice:v220];

            v221 = [v212 owningDevice];

            if (v221)
            {
              v222 = objc_autoreleasePoolPush();
              v223 = v138;
              v224 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v224, OS_LOG_TYPE_INFO))
              {
                v225 = HMFGetLogIdentifier();
                v226 = [v212 name];
                *buf = 138543618;
                v511 = v225;
                v512 = 2112;
                v513 = v226;
                _os_log_impl(&dword_2531F8000, v224, OS_LOG_TYPE_INFO, "%{public}@Configuration changed: Trigger %@ owner updated to current device", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v222);
              v453 = 1;
            }
          }
        }

        else
        {
        }
      }

      v209 = [v208 countByEnumeratingWithState:&v478 objects:v545 count:16];
    }

    while (v209);
  }

  v227 = objc_autoreleasePoolPush();
  v228 = v138;
  v229 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v229, OS_LOG_TYPE_INFO))
  {
    v230 = HMFGetLogIdentifier();
    v231 = MEMORY[0x277CCACA8];
    HMFUptime();
    v233 = [v231 stringWithFormat:@"%.3f", v232 - v136];
    v234 = [(HMDHome *)v228 uuid];
    *buf = 138545410;
    v511 = v230;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configured rooms, zones, triggers, etc.";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfiguredProperties";
    v520 = 2114;
    v521 = @"duration";
    v522 = 2112;
    v523 = v233;
    v524 = 2114;
    v525 = @"homeUUID";
    v526 = 2112;
    v527 = v234;
    _os_log_impl(&dword_2531F8000, v229, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v227);
  v235 = [MEMORY[0x277D17DE8] sharedInstance];
  v236 = objc_alloc(MEMORY[0x277D17DF8]);
  v237 = MEMORY[0x277CCACA8];
  HMFUptime();
  v239 = [v237 stringWithFormat:@"%.3f", v238 - v136];
  v240 = [(HMDHome *)v228 uuid];
  v241 = HMDTaggedLoggingCreateDictionary();
  v242 = [v236 initWithTag:@"homeConfigureStart" data:{v241, @"state", @"homeConfiguredProperties", @"duration", v239, @"homeUUID", v240}];
  v243 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v235 submitTaggedEvent:v242 processorList:v243];

  HMFUptime();
  v245 = v244;
  v246 = objc_autoreleasePoolPush();
  v247 = v228;
  v248 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v248, OS_LOG_TYPE_DEBUG))
  {
    v249 = HMFGetLogIdentifier();
    v250 = [(HMDHome *)v247 uuid];
    *buf = 138544898;
    v511 = v249;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configuring users";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfigureUsers";
    v520 = 2114;
    v521 = @"homeUUID";
    v522 = 2112;
    v523 = v250;
    _os_log_impl(&dword_2531F8000, v248, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v246);
  v251 = [MEMORY[0x277D17DE8] sharedInstance];
  v252 = objc_alloc(MEMORY[0x277D17DF8]);
  v253 = [(HMDHome *)v247 uuid];
  v254 = HMDTaggedLoggingCreateDictionary();
  v255 = [v252 initWithTag:@"homeConfigureStart" data:{v254, @"state", @"homeConfigureUsers", @"homeUUID", v253}];
  v256 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v251 submitTaggedEvent:v255 processorList:v256];

  v476 = 0u;
  v477 = 0u;
  v474 = 0u;
  v475 = 0u;
  v257 = [(HMDHome *)v247 removedUsers];
  v258 = [v257 countByEnumeratingWithState:&v474 objects:v544 count:16];
  if (v258)
  {
    v259 = *v475;
    do
    {
      for (mm = 0; mm != v258; ++mm)
      {
        if (*v475 != v259)
        {
          objc_enumerationMutation(v257);
        }

        v261 = [*(*(&v474 + 1) + 8 * mm) user];
        [(HMDHome *)v247 _addUserToIdentityRegistry:v261];
      }

      v258 = [v257 countByEnumeratingWithState:&v474 objects:v544 count:16];
    }

    while (v258);
  }

  v472 = 0u;
  v473 = 0u;
  v470 = 0u;
  v471 = 0u;
  v438 = [(HMDHome *)v247 users];
  v262 = [v438 countByEnumeratingWithState:&v470 objects:v543 count:16];
  if (v262)
  {
    v446 = *v471;
    do
    {
      for (nn = 0; nn != v262; ++nn)
      {
        if (*v471 != v446)
        {
          objc_enumerationMutation(v438);
        }

        v264 = *(*(&v470 + 1) + 8 * nn);
        v265 = [(__CFString *)v264 userID];
        v266 = [(__CFString *)v264 isRemoteGateway];
        if (v265)
        {
          v267 = v266;
        }

        else
        {
          v267 = 1;
        }

        if ((v267 & 1) == 0)
        {
          v268 = [HMDDeviceHandle deviceHandleForDestination:v265];
          if (v268)
          {
            v269 = objc_autoreleasePoolPush();
            v270 = v247;
            v271 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v271, OS_LOG_TYPE_DEFAULT))
            {
              v272 = HMFGetLogIdentifier();
              *buf = 138543618;
              v511 = v272;
              v512 = 2112;
              v513 = v264;
              _os_log_impl(&dword_2531F8000, v271, OS_LOG_TYPE_DEFAULT, "%{public}@Migrating invalid resident user: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v269);
            [(HMDHome *)v270 _removeUser:v264];
            v273 = +[HMDAccountRegistry sharedRegistry];
            v274 = [v273 deviceForHandle:v268];

            v275 = [HMDResidentUser alloc];
            v276 = [(__CFString *)v264 pairingIdentity];
            v277 = [(HMDResidentUser *)v275 initWithDevice:v274 home:v270 pairingIdentity:v276 configurationState:0];

            v278 = [(__CFString *)v264 uuid];
            [(HMDUser *)v277 setUUID:v278];

            [(HMDHome *)v270 addUser:v277];
          }
        }

        [(HMDHome *)v247 _addUserToIdentityRegistry:v264];
        [(__CFString *)v264 configureWithHome:v247];
        if ([(__CFString *)v264 isOwner]&& ![(HMDHome *)v247 isOwnerUser])
        {
          v279 = dispatch_time(0, 300000000000);
          v280 = [(HMDHome *)v247 workQueue];
          block[0] = MEMORY[0x277D85DD0];
          block[1] = 3221225472;
          block[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke;
          block[3] = &unk_2797359B0;
          block[4] = v264;
          block[5] = v247;
          dispatch_after(v279, v280, block);
        }
      }

      v262 = [v438 countByEnumeratingWithState:&v470 objects:v543 count:16];
    }

    while (v262);
  }

  v281 = objc_autoreleasePoolPush();
  v282 = v247;
  v283 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v283, OS_LOG_TYPE_INFO))
  {
    v284 = HMFGetLogIdentifier();
    v285 = MEMORY[0x277CCACA8];
    HMFUptime();
    v287 = [v285 stringWithFormat:@"%.3f", v286 - v245];
    v288 = MEMORY[0x277CCABB0];
    v289 = [(HMDHome *)v282 users];
    v290 = [v288 numberWithUnsignedInteger:{objc_msgSend(v289, "count")}];
    *buf = 138545410;
    v511 = v284;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configured users";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfiguredUsers";
    v520 = 2114;
    v521 = @"duration";
    v522 = 2112;
    v523 = v287;
    v524 = 2114;
    v525 = @"usersCount";
    v526 = 2112;
    v527 = v290;
    _os_log_impl(&dword_2531F8000, v283, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v281);
  v291 = [MEMORY[0x277D17DE8] sharedInstance];
  v292 = objc_alloc(MEMORY[0x277D17DF8]);
  v293 = MEMORY[0x277CCACA8];
  HMFUptime();
  v295 = [v293 stringWithFormat:@"%.3f", v294 - v245];
  v296 = MEMORY[0x277CCABB0];
  v297 = [(HMDHome *)v282 users];
  v298 = [v296 numberWithUnsignedInteger:{objc_msgSend(v297, "count")}];
  v299 = HMDTaggedLoggingCreateDictionary();
  v300 = [v292 initWithTag:@"homeConfigureStart" data:{v299, @"state", @"homeConfiguredUsers", @"duration", v295, @"usersCount", v298}];
  v301 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v291 submitTaggedEvent:v300 processorList:v301];

  v302 = [(HMDHome *)v282 networkProtectionGroupRegistry];
  [v302 configure];

  v303 = [(HMDHome *)v282 localCapabilitiesDataSource];
  LODWORD(v295) = [v303 isResidentCapable];

  if (v295)
  {
    v304 = [(HMDHome *)v282 uuid];
    v305 = [v304 UUIDString];
    v306 = [@"Home.EventRouter.Server.Delegating." stringByAppendingString:v305];

    v307 = objc_alloc(MEMORY[0x277D17498]);
    v308 = [v436 workQueue];
    v309 = v306;
    v310 = [v306 UTF8String];
    v311 = [(HMDHome *)v282 uuid];
    v312 = [v307 initWithQueue:v308 dataSource:v282 storeReadHandle:0 logCategory:v310 identifier:v311];
    serverDelegatingEventRouter = v282->_serverDelegatingEventRouter;
    v282->_serverDelegatingEventRouter = v312;

    [(HMDHome *)v282 createRemoteEventRouterServerIfNeeded];
  }

  v437 = [HMDUserMessagePolicy userMessagePolicyWithHome:v282 userPrivilege:3 remoteAccessRequired:0];
  v434 = [v436 eventRouterAssertionController];
  v314 = [HMDHomeRemoteEventRouterClientController alloc];
  v315 = [(HMDHome *)v282 messageTargetUUID];
  v316 = [v436 workQueue];
  v317 = [v443 uuid];
  v318 = [(HMDHomeRemoteEventRouterClientController *)v314 initWithMessageTargetUUID:v315 workQueue:v316 dataSource:v282 requestMessageName:@"RemoteEventRouterRequestMessage" updateMessageName:@"RemoteEventRouterUpdateMessageName" multiHopFetchResponseMessageName:@"RER.MHF.ResponseMessageName" clientUserMessagePolicy:v437 currentAccessoryUUID:v317 assertionController:v434];
  [(HMDHome *)v282 setRemoteEventRouterClientController:v318];

  v319 = [(HMDHome *)v282 remoteEventRouterClientController];
  [v319 setHomeManager:v436];

  v320 = [v436 localAndRemoteSubscriptionProvider];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v321 = v320;
  }

  else
  {
    v321 = 0;
  }

  v433 = v321;

  v322 = [(HMDHome *)v282 remoteEventRouterClientController];
  v439 = [v322 residentDelegatingEventRouter];

  if (v439)
  {
    [v433 registerSubRouter:v439];
  }

  v323 = [(HMDHome *)v282 swiftExtensions];
  [v323 configureWithHome:v282];

  objc_initWeak(&location, v282);
  v324 = [(HMDHome *)v282 workQueue];
  v463[0] = MEMORY[0x277D85DD0];
  v463[1] = 3221225472;
  v463[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_788;
  v463[3] = &unk_279733910;
  objc_copyWeak(&v467, &location);
  v430 = v443;
  v464 = v430;
  obja = obj;
  v465 = obja;
  v432 = v431;
  v466 = v432;
  dispatch_group_notify(group, v324, v463);

  v461 = 0u;
  v462 = 0u;
  v459 = 0u;
  v460 = 0u;
  v325 = [(HMDHome *)v282 outgoingInvitations];
  v326 = [v325 countByEnumeratingWithState:&v459 objects:v542 count:16];
  if (v326)
  {
    v444 = v325;
    v447 = *v460;
    do
    {
      for (i1 = 0; i1 != v326; ++i1)
      {
        if (*v460 != v447)
        {
          objc_enumerationMutation(v444);
        }

        v328 = *(*(&v459 + 1) + 8 * i1);
        v455 = 0u;
        v456 = 0u;
        v457 = 0u;
        v458 = 0u;
        v329 = [v328 operations];
        v330 = [v329 countByEnumeratingWithState:&v455 objects:v541 count:16];
        if (v330)
        {
          v331 = *v456;
          do
          {
            for (i2 = 0; i2 != v330; ++i2)
            {
              if (*v456 != v331)
              {
                objc_enumerationMutation(v329);
              }

              v333 = *(*(&v455 + 1) + 8 * i2);
              if (([v333 isFinished] & 1) == 0)
              {
                [v333 setDelegate:v282];
                v334 = +[HMDUserManagementOperationManager sharedManager];
                [v334 addOperation:v333];
              }
            }

            v330 = [v329 countByEnumeratingWithState:&v455 objects:v541 count:16];
          }

          while (v330);
        }
      }

      v325 = v444;
      v326 = [v444 countByEnumeratingWithState:&v459 objects:v542 count:16];
    }

    while (v326);
  }

  HMFUptime();
  v336 = v335;
  v337 = objc_autoreleasePoolPush();
  v338 = v282;
  v339 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v339, OS_LOG_TYPE_DEBUG))
  {
    v340 = HMFGetLogIdentifier();
    v341 = [(HMDHome *)v338 uuid];
    *buf = 138544898;
    v511 = v340;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configuring profiles and settings";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfigureProfiles";
    v520 = 2114;
    v521 = @"homeUUID";
    v522 = 2112;
    v523 = v341;
    _os_log_impl(&dword_2531F8000, v339, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v337);
  v342 = [MEMORY[0x277D17DE8] sharedInstance];
  v343 = objc_alloc(MEMORY[0x277D17DF8]);
  v344 = [(HMDHome *)v338 uuid];
  v345 = HMDTaggedLoggingCreateDictionary();
  v346 = [v343 initWithTag:@"homeConfigureStart" data:{v345, @"state", @"homeConfigureProfiles", @"homeUUID", v344}];
  v347 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v342 submitTaggedEvent:v346 processorList:v347];

  v348 = objc_autoreleasePoolPush();
  [(HMDHome *)v338 _registerForMessages];
  objc_autoreleasePoolPop(v348);
  [(HMDHome *)v338 _registerForNotifications];
  [(HMDHome *)v338 resubscribeForNotificationsOnResident:0];
  [(HMDHome *)v338 configureMultiuserSettingsMessengerWithMessengerFactory:v338];
  [(HMDHome *)v338 _evaluateShouldRelaunchAndSetRelaunch];
  [(HMDHome *)v338 reEvaluateHomeHubState];
  v349 = objc_autoreleasePoolPush();
  v350 = v338;
  v351 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v351, OS_LOG_TYPE_INFO))
  {
    v352 = HMFGetLogIdentifier();
    v353 = [v350 triggers];
    *buf = 138543618;
    v511 = v352;
    v512 = 2112;
    v513 = v353;
    _os_log_impl(&dword_2531F8000, v351, OS_LOG_TYPE_INFO, "%{public}@Triggers: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v349);
  [v350 migrateAfterResidentChange];
  [v350 _updateWoWState:v442];
  if ((v453 & 1) != 0 && [v350 isOwnerUser])
  {
    [v350 _updateConfigurationVersion];
  }

  v354 = [[HMDMediaActionRouter alloc] initWithDataSource:v350];
  [v350 setMediaActionRouter:v354];

  v355 = [v350 personDataManager];
  [v355 configure];

  v356 = [[HMDUserActionPredictionManager alloc] initWithHome:v350];
  [v350 setUserActionPredictionManager:v356];

  v357 = [v350 userActionPredictionManager];
  [v357 configure];

  v358 = [v350 reachabilityNotificationManager];
  v359 = [v436 messageDispatcher];
  v360 = [v359 secureRemoteTransport];
  v361 = [v360 deviceMonitor];
  [v358 configureWithHome:v350 deviceMonitor:v361];

  [v350 configureNaturalLightingWithDemoModeEnabled:0];
  v362 = [v350 walletKeyManager];
  [v362 configureWithHome:v350];

  v363 = [v350 nfcReaderKeyManager];
  [v363 configureWithHome:v350];

  v364 = [v350 lockNotificationManager];
  [v364 configureWithHome:v350];

  v365 = [v350 analysisStatePublisher];
  [v365 configureWithHome:v350];

  [v350 configurePrimaryResidentMessageRouterWithFactory:v350 metricsDispatcherFactory:v350];
  v366 = [HMDAppleMediaAccessoryMessageRouter alloc];
  v367 = [v350 uuid];
  v368 = [v350 msgDispatcher];
  v369 = [(HMDAppleMediaAccessoryMessageRouter *)v366 initWithIdentifier:v367 messageDispatcher:v368];
  [v350 setAppleDeviceRouter:v369];

  v370 = [v350 appleDeviceRouter];
  [v370 setDataSource:v350];

  v371 = [HMDDelegatingMessageRouter alloc];
  v372 = [v350 msgDispatcher];
  v373 = [v350 appleDeviceRouter];
  v540[0] = v373;
  v374 = [v350 primaryResidentMessageRouter];
  v540[1] = v374;
  v375 = [MEMORY[0x277CBEA60] arrayWithObjects:v540 count:2];
  v376 = [(HMDDelegatingMessageRouter *)v371 initWithMessageDispatcher:v372 routers:v375];
  [v350 setAccessoryMessageRouterViaPrimary:v376];

  v377 = [v350 accessoryMessageRouterViaPrimary];
  [v377 setDataSource:v350];

  [v350 configureUnifiedLanguageValueListSettingDataProviderWithFactory:v350];
  [v350 configureAccessorySettingsMessengerWithMessengerFactory:v350 messageHandlerFactory:v350];
  [v350 configureSiriEndpointProfilesMessengerWithMessengerFactory:v350 messageHandlerFactory:v350];
  v378 = [v350 accessoryConnectionCoordinator];
  v379 = [v350 localCapabilitiesDataSource];
  [v378 configureWithIsResidentCapable:{objc_msgSend(v379, "isResidentCapable")}];

  v380 = [v350 workQueue];
  v454[0] = MEMORY[0x277D85DD0];
  v454[1] = 3221225472;
  v454[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_796;
  v454[3] = &unk_279735D00;
  v454[4] = v350;
  dispatch_async(v380, v454);

  v381 = objc_autoreleasePoolPush();
  v382 = v350;
  v383 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v383, OS_LOG_TYPE_INFO))
  {
    v384 = HMFGetLogIdentifier();
    v385 = MEMORY[0x277CCACA8];
    HMFUptime();
    v387 = [v385 stringWithFormat:@"%.3f", v386 - v336];
    v388 = [v382 uuid];
    *buf = 138545410;
    v511 = v384;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configured profiles and settings";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfiguredProfiles";
    v520 = 2114;
    v521 = @"duration";
    v522 = 2112;
    v523 = v387;
    v524 = 2114;
    v525 = @"homeUUID";
    v526 = 2112;
    v527 = v388;
    _os_log_impl(&dword_2531F8000, v383, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v381);
  v389 = [MEMORY[0x277D17DE8] sharedInstance];
  v390 = objc_alloc(MEMORY[0x277D17DF8]);
  v391 = MEMORY[0x277CCACA8];
  HMFUptime();
  v393 = [v391 stringWithFormat:@"%.3f", v392 - v336];
  v394 = [v382 uuid];
  v395 = HMDTaggedLoggingCreateDictionary();
  v396 = [v390 initWithTag:@"homeConfigureStart" data:{v395, @"state", @"homeConfiguredProfiles", @"duration", v393, @"homeUUID", v394}];
  v397 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v389 submitTaggedEvent:v396 processorList:v397];

  v398 = objc_autoreleasePoolPush();
  v399 = v382;
  v400 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v400, OS_LOG_TYPE_INFO))
  {
    v448 = v398;
    v401 = HMFGetLogIdentifier();
    v402 = MEMORY[0x277CCACA8];
    HMFUptime();
    v404 = [v402 stringWithFormat:@"%.3f", v403 - v10];
    v405 = [v399 uuid];
    v406 = HMFBooleanToString();
    v407 = MEMORY[0x277CCABB0];
    v408 = [v399 accessories];
    v409 = [v407 numberWithUnsignedInteger:{objc_msgSend(v408, "count")}];
    v410 = MEMORY[0x277CCABB0];
    v411 = [v399 users];
    v412 = [v410 numberWithUnsignedInteger:{objc_msgSend(v411, "count")}];
    *buf = 138546946;
    v511 = v401;
    v512 = 2114;
    v513 = @"homeConfigureDone";
    v514 = 2112;
    v515 = @"Configured home";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"end";
    v520 = 2114;
    v521 = @"duration";
    v522 = 2112;
    v523 = v404;
    v524 = 2114;
    v525 = @"homeUUID";
    v526 = 2112;
    v527 = v405;
    v528 = 2114;
    v529 = @"configChanged";
    v530 = 2112;
    v531 = v406;
    v532 = 2114;
    v533 = @"accessoriesCount";
    v534 = 2112;
    v535 = v409;
    v536 = 2114;
    v537 = @"usersCount";
    v538 = 2112;
    v539 = v412;
    _os_log_impl(&dword_2531F8000, v400, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x98u);

    v398 = v448;
  }

  objc_autoreleasePoolPop(v398);
  v449 = [MEMORY[0x277D17DE8] sharedInstance];
  v413 = objc_alloc(MEMORY[0x277D17DF8]);
  v414 = MEMORY[0x277CCACA8];
  HMFUptime();
  v416 = [v414 stringWithFormat:@"%.3f", v415 - v10];
  v417 = [v399 uuid];
  v418 = HMFBooleanToString();
  v419 = MEMORY[0x277CCABB0];
  v420 = [v399 accessories];
  v421 = [v419 numberWithUnsignedInteger:{objc_msgSend(v420, "count")}];
  v422 = MEMORY[0x277CCABB0];
  v423 = [v399 users];
  v424 = [v422 numberWithUnsignedInteger:{objc_msgSend(v423, "count")}];
  v425 = HMDTaggedLoggingCreateDictionary();
  v426 = [v413 initWithTag:@"homeConfigureDone" data:{v425, @"state", @"end", @"duration", v416, @"homeUUID", v417, @"configChanged", v418, @"accessoriesCount", v421, @"usersCount", v424}];
  v427 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [v449 submitTaggedEvent:v426 processorList:v427];

  objc_destroyWeak(&v467);
  objc_destroyWeak(&location);

  v428 = *MEMORY[0x277D85DE8];
  return v453 & 1;
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) account];
  v3 = [v2 senderCorrelationIdentifier];

  if (!v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 40);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 32);
      *buf = 138543618;
      v15 = v7;
      v16 = 2112;
      v17 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Owner for home %@ does not have a merge ID, resolving handle", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v9 = +[HMDRemoteAccountManager sharedManager];
    v10 = [*(a1 + 32) accountHandle];
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_777;
    v12[3] = &unk_279721FC8;
    v13 = vextq_s8(*(a1 + 32), *(a1 + 32), 8uLL);
    [v9 _resolveAccountForHandle:v10 completionHandler:v12];
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_788(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:*(a1 + 32) accessories:*(a1 + 40) uncommittedTransactions:*(a1 + 48)];
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_796(uint64_t a1)
{
  v3 = [*(a1 + 32) accessCodeManager];
  v2 = [*(a1 + 32) msgDispatcher];
  [v3 configureWithMessageDispatcher:v2];
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_777(uint64_t a1, void *a2, void *a3)
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [*(a1 + 40) accountHandle];
      v13 = 138543618;
      v14 = v10;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to resolve account handle for account with no merge ID %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_setupActiveNetworkRouterAccessory:(id)a3 existingRouterAccessories:(id)a4
{
  v63 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  v8 = v6;
  v9 = [v8 countByEnumeratingWithState:&v51 objects:v62 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v52;
    while (2)
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v52 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v51 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if ([v15 isPrimary])
        {
          v16 = [v15 networkRouterController];

          if (v16)
          {
            v42 = v8;
            v43 = v7;
            v49 = 0u;
            v50 = 0u;
            v47 = 0u;
            v48 = 0u;
            v17 = v7;
            v18 = [v17 countByEnumeratingWithState:&v47 objects:v61 count:16];
            v19 = v15;
            v46 = v15;
            if (v18)
            {
              v20 = v18;
              v21 = *v48;
              v44 = v17;
              v45 = *v48;
              do
              {
                for (j = 0; j != v20; ++j)
                {
                  if (*v48 != v21)
                  {
                    objc_enumerationMutation(v17);
                  }

                  v23 = *(*(&v47 + 1) + 8 * j);
                  if (([v23 isEqual:{v19, v42, v43}] & 1) == 0)
                  {
                    v24 = objc_autoreleasePoolPush();
                    v25 = self;
                    v26 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
                    {
                      HMFGetLogIdentifier();
                      v28 = v27 = self;
                      [v23 shortDescription];
                      v30 = v29 = v20;
                      v31 = [v19 shortDescription];
                      *buf = 138543874;
                      v56 = v28;
                      v57 = 2112;
                      v58 = v30;
                      v59 = 2112;
                      v60 = v31;
                      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Removing existing Wi-Fi router accessory '%@' while adding a new Wi-Fi router accessory '%@'", buf, 0x20u);

                      v19 = v46;
                      v20 = v29;

                      self = v27;
                      v17 = v44;
                      v21 = v45;
                    }

                    objc_autoreleasePoolPop(v24);
                    [HMDHome __removeAccessory:v25 isBeingReplaced:v23 isForceUpdate:1 message:0];
                  }
                }

                v20 = [v17 countByEnumeratingWithState:&v47 objects:v61 count:16];
              }

              while (v20);
            }

            v32 = [v19 uuid];
            v33 = [(HMDHome *)self activeNetworkRouterUUID];
            v34 = [v32 isEqual:v33];

            if (v34)
            {
              [(HMDHome *)self _evaluateNetworkProtectionAndRouterManagement];
              v8 = v42;
              v7 = v43;
              v35 = v46;
            }

            else
            {
              v36 = objc_autoreleasePoolPush();
              v37 = self;
              v38 = HMFGetOSLogHandle();
              v8 = v42;
              v7 = v43;
              if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
              {
                v39 = HMFGetLogIdentifier();
                v40 = [v46 shortDescription];
                *buf = 138543618;
                v56 = v39;
                v57 = 2112;
                v58 = v40;
                _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@Adding transaction to set %@ as active network router accessory", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v36);
              v35 = v46;
              -[HMDHome _addTransactionForActiveNetworkRouterAccessory:isReplacement:](v37, "_addTransactionForActiveNetworkRouterAccessory:isReplacement:", v46, [v17 count] != 0);
            }

            goto LABEL_31;
          }
        }
      }

      v10 = [v8 countByEnumeratingWithState:&v51 objects:v62 count:16];
      if (v10)
      {
        continue;
      }

      break;
    }
  }

LABEL_31:

  v41 = *MEMORY[0x277D85DE8];
}

- (void)setupBackingStore
{
  v3 = [(HMDHome *)self uuid];
  if (v3)
  {
    v4 = v3;
    v5 = [(HMDHome *)self backingStore];

    if (!v5)
    {
      v6 = [HMDBackingStore alloc];
      v7 = [(HMDHome *)self uuid];
      v8 = [(HMDBackingStore *)v6 initWithUUID:v7 home:self];
      [(HMDHome *)self setBackingStore:v8];

      v9 = [(HMDHome *)self backingStore];
      [v9 setDelegate:self];
    }
  }
}

- (void)setBackingStore:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  backingStore = self->_backingStore;
  self->_backingStore = v4;

  os_unfair_recursive_lock_unlock();
}

- (HMDBackingStore)backingStore
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_backingStore;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setWatchSkipVersionCheck:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_watchSkipVersionCheck = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)watchSkipVersionCheck
{
  os_unfair_recursive_lock_lock_with_options();
  watchSkipVersionCheck = self->_watchSkipVersionCheck;
  os_unfair_recursive_lock_unlock();
  return watchSkipVersionCheck;
}

- (void)_addUserToIdentityRegistry:(id)a3
{
  v12 = a3;
  v3 = [v12 userID];
  v4 = v12;
  if (v3)
  {
    v5 = [v12 pairingIdentity];

    v4 = v12;
    if (v5)
    {
      v6 = v12;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v7 = v6;
      }

      else
      {
        v7 = 0;
      }

      v8 = v7;

      if (v8)
      {
        v9 = [v8 device];
        if (v9)
        {
          v10 = +[HMDIdentityRegistry sharedRegistry];
          v11 = [v6 pairingIdentity];
          [v10 registerIdentity:v11 device:v9 object:v6];
LABEL_11:
        }
      }

      else
      {
        v9 = [v6 account];
        if (v9)
        {
          v10 = +[HMDIdentityRegistry sharedRegistry];
          v11 = [v6 pairingIdentity];
          [v10 registerIdentity:v11 account:v9 object:v6];
          goto LABEL_11;
        }
      }

      v4 = v12;
    }
  }
}

- (void)_removeMediaSessionWithIdentifier:(id)a3
{
  v4 = [(HMDHome *)self mediaSessionWithIdentifier:a3];
  if (v4)
  {
    v5 = v4;
    [v4 registerForSessionUpdates:0];
    [(HMDHome *)self removeMediaSession:v5];
    v4 = v5;
  }
}

- (id)_createMediaSessionWithEndpoint:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 sessionIdentifier];
  if (v5)
  {
    v6 = [(HMDHome *)self mediaSessionStateWithIdentifier:v5];
    if (!v6)
    {
      v6 = [[HMDMediaSessionState alloc] initWithSessionIdentifier:v5];
      [(HMDHome *)self addMediaSessionState:v6];
    }

    v7 = [HMDMediaSession alloc];
    v8 = [MEMORY[0x277CBEA60] array];
    v9 = [(HMDMediaSession *)v7 initWithEndpoint:v4 mediaProfiles:v8 state:v6];

    [(HMDHome *)self __addMediaSession:v9];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = v4;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Cannot create a mediaSession with nil sessionIdentifier for endpoint %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v9 = 0;
  }

  v14 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)_addMediaSessionForCurrentAccessory:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  v7 = [v6 mediaProfile];
  if (v7)
  {
    v8 = [v4 identifier];
    v9 = [HMDMediaSession sessionForCurrentAccessoryWithSessionIdentifier:v8 mediaProfile:v7];

    if (v9)
    {
      v10 = [v9 state];
      [(HMDHome *)self addMediaSessionState:v10];

      [(HMDHome *)self __addMediaSession:v9];
      [v4 updateMediaSession:v9];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v4 name];
      v18 = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v15;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEFAULT, "%{public}@Current accessory '%@' not an Apple media accessory or no media profile", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v9 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)__addMediaSession:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v7 = v4;
    v5 = [(HMDHome *)self notificationRegistrations];
    v6 = [v5 count];

    if (v6)
    {
      [v7 registerForSessionUpdates:1];
    }

    [(HMDHome *)self addMediaSession:v7];
    v4 = v7;
  }
}

- (id)_createBuiltinActionSets
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] array];
  +[HMDHome getBuiltinActionSets];
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v4 = v28 = 0u;
  v24 = [v4 countByEnumeratingWithState:&v25 objects:v35 count:16];
  if (v24)
  {
    v23 = *v26;
    *&v5 = 138543874;
    v20 = v5;
    v21 = self;
    v22 = v4;
    do
    {
      for (i = 0; i != v24; ++i)
      {
        if (*v26 != v23)
        {
          objc_enumerationMutation(v4);
        }

        v7 = *(*(&v25 + 1) + 8 * i);
        v8 = [v4 objectForKeyedSubscript:{v7, v20}];
        v9 = HMDLocalizedStringForKey(v8);

        v10 = [(HMDHome *)self addName:v9];
        if (v10)
        {
          v11 = objc_autoreleasePoolPush();
          v12 = self;
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
          {
            v14 = HMFGetLogIdentifier();
            [(HMDHome *)v12 name];
            v16 = v15 = v3;
            *buf = v20;
            v30 = v14;
            v31 = 2112;
            v32 = v9;
            v33 = 2112;
            v34 = v16;
            _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEFAULT, "%{public}@Could not add builtin actionSet '%@' to home '%@' namespace", buf, 0x20u);

            v3 = v15;
            self = v21;
          }

          objc_autoreleasePoolPop(v11);
          v4 = v22;
        }

        v17 = [(HMDHome *)self createActionSetWithName:v9 uuid:0 type:v7];
        [v3 addObject:v17];
      }

      v24 = [v4 countByEnumeratingWithState:&v25 objects:v35 count:16];
    }

    while (v24);
  }

  v18 = *MEMORY[0x277D85DE8];

  return v3;
}

- (id)createActionSetWithName:(id)a3 uuid:(id)a4 type:(id)a5
{
  v8 = a5;
  v9 = a4;
  v10 = a3;
  v11 = [HMDActionSet alloc];
  v12 = [(HMDHome *)self workQueue];
  v13 = [(HMDActionSet *)v11 initWithName:v10 uuid:v9 type:v8 home:self queue:v12];

  v14 = [(HMDHome *)self msgDispatcher];
  v15 = [(HMDHome *)self workQueue];
  [(HMDActionSet *)v13 configure:self messageDispatcher:v14 queue:v15];

  return v13;
}

- (id)filterBuiltinActionSets:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v4 = +[HMDHome getBuiltinActionSets];
  v5 = [v4 allKeys];

  v6 = [MEMORY[0x277CBEB18] array];
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v7 = v3;
  v8 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v18;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v18 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v17 + 1) + 8 * i);
        v13 = [v12 type];
        v14 = [v5 containsObject:v13];

        if (v14)
        {
          [v6 addObject:v12];
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
    }

    while (v9);
  }

  v15 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)computeBridgedAccessoriesForAllBridges
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB38] dictionary];
  v4 = [(HMDHome *)self accessories];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v5 = [v4 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v35;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v35 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v34 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 bridge];
        v13 = v12;
        if (v12)
        {
          v14 = [v12 uuid];
          v15 = [v3 hmf_mutableSetForKey:v14];

          if (!v15)
          {
            v15 = [MEMORY[0x277CBEB58] set];
            v16 = [v13 uuid];
            [v3 setObject:v15 forKey:v16];
          }

          v17 = [v9 uuid];
          [v15 addObject:v17];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v34 objects:v39 count:16];
    }

    while (v6);
  }

  v32 = 0u;
  v33 = 0u;
  v30 = 0u;
  v31 = 0u;
  v18 = v3;
  v19 = [v18 countByEnumeratingWithState:&v30 objects:v38 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v31;
    do
    {
      for (j = 0; j != v20; ++j)
      {
        if (*v31 != v21)
        {
          objc_enumerationMutation(v18);
        }

        v23 = *(*(&v30 + 1) + 8 * j);
        v24 = [v18 hmf_mutableSetForKey:{v23, v30}];
        v25 = [v4 hmf_firstObjectWithUUID:v23];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v26 = v25;
        }

        else
        {
          v26 = 0;
        }

        v27 = v26;

        if (v27)
        {
          v28 = v24 == 0;
        }

        else
        {
          v28 = 1;
        }

        if (!v28)
        {
          [v27 setIdentifiersForBridgedAccessories:v24];
        }
      }

      v20 = [v18 countByEnumeratingWithState:&v30 objects:v38 count:16];
    }

    while (v20);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)__handleProcessStateChange:(id)a3
{
  v4 = [a3 userInfo];
  v5 = [v4 objectForKeyedSubscript:@"processInfo"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v8 = [v7 bundleIdentifier];
    v9 = [v7 state];
    if (v8)
    {
      v10 = v9 > 4;
    }

    else
    {
      v10 = 1;
    }

    if (!v10 && ((1 << v9) & 0x1A) != 0)
    {
      v12 = [(HMDHome *)self workQueue];
      v14 = MEMORY[0x277D85DD0];
      v15 = 3221225472;
      v16 = __38__HMDHome___handleProcessStateChange___block_invoke;
      v17 = &unk_2797359B0;
      v18 = v8;
      v19 = self;
      dispatch_async(v12, &v14);
    }

    v13 = [(HMDHome *)self hapAccessories:v14];
    [v13 hmf_enumerateWithAutoreleasePoolUsingBlock:&__block_literal_global_735];
  }
}

uint64_t __38__HMDHome___handleProcessStateChange___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = +[HMDAccessorySetupManager accessorySetupHostBundleIdentifier];
  LODWORD(v2) = [v2 isEqualToString:v3];

  if (v2)
  {
    [*(a1 + 40) _cleanAddAccessoryOperations];
  }

  v5 = *(a1 + 32);
  v4 = *(a1 + 40);

  return [v4 _disableNotificationsForClient:v5];
}

- (void)_startHomeNotificationDeregistrationTimer
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self disableNotificationTimer];

  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [(HMDHome *)v5 disableNotificationTimer];
      v22 = 138543618;
      v23 = v7;
      v24 = 2112;
      v25 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Kicking notification disable timer: %@", &v22, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v9 = [(HMDHome *)v5 disableNotificationTimer];
    [v9 kick];
  }

  else
  {
    v10 = objc_alloc(MEMORY[0x277D0F920]);
    v11 = [v10 initWithTimeInterval:1 options:*&disableNotificationsDeferPeriod];
    [(HMDHome *)self setDisableNotificationTimer:v11];

    v12 = [(HMDHome *)self workQueue];
    v13 = [(HMDHome *)self disableNotificationTimer];
    [v13 setDelegateQueue:v12];

    v14 = [(HMDHome *)self disableNotificationTimer];
    [v14 setDelegate:self];

    v15 = [(HMDHome *)self disableNotificationTimer];
    [v15 resume];

    v16 = objc_autoreleasePoolPush();
    v17 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [(HMDHome *)v17 disableNotificationTimer];
      v22 = 138543618;
      v23 = v19;
      v24 = 2112;
      v25 = v20;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Started notification disable timer: %@", &v22, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_disableDirectCharacteristicNotificationsForClient:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v25[0] = 0;
  v25[1] = v25;
  v25[2] = 0x2020000000;
  v26 = 0;
  v5 = dispatch_group_create();
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v6 = [(HMDHome *)self accessories];
  v7 = [v6 copy];

  v8 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
  if (v8)
  {
    v9 = *v22;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v22 != v9)
        {
          objc_enumerationMutation(v7);
        }

        v11 = *(*(&v21 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = v11;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if (v13)
        {
          dispatch_group_enter(v5);
          aBlock[0] = MEMORY[0x277D85DD0];
          aBlock[1] = 3221225472;
          aBlock[2] = __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke;
          aBlock[3] = &unk_279732558;
          v20 = v25;
          v19 = v5;
          v14 = _Block_copy(aBlock);
          [v13 disableNotificationsForBundleID:v4 completionHandler:v14];
        }
      }

      v8 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
    }

    while (v8);
  }

  v15 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke_2;
  block[3] = &unk_279734898;
  block[4] = self;
  block[5] = v25;
  dispatch_group_notify(v5, v15, block);

  _Block_object_dispose(v25, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke(uint64_t a1, int a2)
{
  if (a2)
  {
    *(*(*(a1 + 40) + 8) + 24) = 1;
  }

  dispatch_group_leave(*(a1 + 32));
}

uint64_t __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke_2(uint64_t result)
{
  if (*(*(*(result + 40) + 8) + 24) == 1)
  {
    return [*(result + 32) saveToCurrentAccountWithReason:@"HMDApplicationTerminatedSaveReason"];
  }

  return result;
}

- (void)_disableNotificationsForClient:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v9;
    v17 = 2112;
    v18 = v4;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Disabling notification for client %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [(HMDHome *)v7 notificationRegistrations];
  if ([v10 containsObject:v4])
  {
    v11 = [(HMDHome *)v7 notificationDeregistrations];
    v12 = [v11 containsObject:v4];

    if ((v12 & 1) == 0)
    {
      [(HMDHome *)v7 addNotificationDeregistrationForClientIdentifier:v4];
      [(HMDHome *)v7 _startHomeNotificationDeregistrationTimer];
    }
  }

  else
  {
  }

  v13 = [@"com.apple.HomeKit.client." stringByAppendingString:v4];
  [(HMDHome *)v7 _disableDirectCharacteristicNotificationsForClient:v13];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_cleanAddAccessoryOperations
{
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)self->_addPendingAccessories removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessorySetupCodeHandlers removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessorySetupCodes removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessoryOnboardingSetupPayloadStrings removeAllObjects];

  os_unfair_recursive_lock_unlock();
}

- (void)handleAccessoryReachabilityChangeNotification:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __57__HMDHome_handleAccessoryReachabilityChangeNotification___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v4, block);
}

uint64_t __57__HMDHome_handleAccessoryReachabilityChangeNotification___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) _hasPairedReachableBTLEAccessories];
  v3 = *(a1 + 32);

  return [v3 setAnyBTLEAccessoryReachable:v2];
}

- (void)handleClientProcessDisconnectedNotification:(id)a3
{
  v4 = [a3 object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  if (v6)
  {
    v7 = [v6 bundleIdentifier];
    if (v7)
    {
      v8 = [(HMDHome *)self workQueue];
      v9[0] = MEMORY[0x277D85DD0];
      v9[1] = 3221225472;
      v9[2] = __55__HMDHome_handleClientProcessDisconnectedNotification___block_invoke;
      v9[3] = &unk_2797359B0;
      v9[4] = self;
      v10 = v7;
      dispatch_async(v8, v9);
    }
  }
}

- (void)_registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5
{
  v6 = a3;
  v49 = *MEMORY[0x277D85DE8];
  v8 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v10);

  if ([(HMDHome *)self isFeatureMatteriPhoneOnlyPairingControlEnabled])
  {
    if (v9)
    {
      v11 = v9;
    }

    else
    {
      v11 = v8;
    }

    v12 = v11;
    if (([v12 isEqualToString:*MEMORY[0x277CCFE40]] & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD09C8]) & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD11A0]) & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD06C8]) & 1) != 0 || objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD0638]))
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG);
      if (v6)
      {
        if (v16)
        {
          v17 = HMFGetLogIdentifier();
          v43 = 138543874;
          v44 = v17;
          v45 = 2112;
          v46 = v9;
          v47 = 2112;
          v48 = v8;
          _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEBUG, "%{public}@registerForMatterFabricNotifications:YES - skip registering client %@, registrationIdentifier = %@", &v43, 0x20u);
        }

        objc_autoreleasePoolPop(v13);
        goto LABEL_35;
      }

      if (v16)
      {
        v18 = HMFGetLogIdentifier();
        v43 = 138543874;
        v44 = v18;
        v45 = 2112;
        v46 = v9;
        v47 = 2112;
        v48 = v8;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEBUG, "%{public}@registerForMatterFabricNotifications:NO - allow deregistration for client %@, registrationIdentifier = %@", &v43, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
    }

    else if (v6)
    {
      v41 = [(HMDHome *)self matterFabricEnabledClients];
      v42 = [v41 containsObject:v8];

      if (v42)
      {
LABEL_19:
        v20 = [(HMDHome *)self homeManager];
        v21 = [(HMDHome *)self matterFabricEnabledClients];
        v22 = [v21 count];

        if (v22)
        {
          v23 = [(HMDHome *)self currentMatterClientRegistration];
          v24 = objc_autoreleasePoolPush();
          v25 = self;
          v26 = HMFGetOSLogHandle();
          v27 = v26;
          if (v23)
          {
            if (!os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
            {
LABEL_24:

              objc_autoreleasePoolPop(v24);
LABEL_34:

LABEL_35:
              goto LABEL_36;
            }

            v28 = HMFGetLogIdentifier();
            v29 = [(HMDHome *)v25 matterFabricEnabledClients];
            v43 = 138543618;
            v44 = v28;
            v45 = 2112;
            v46 = v29;
            _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEBUG, "%{public}@Not updating matter fabric registration as we are registered and have the clients %@", &v43, 0x16u);

LABEL_23:
            goto LABEL_24;
          }

          if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
          {
            v38 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v38;
            _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Updating matter fabric registration as we are not registered but have clients", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          v39 = [v20 chipDataSource];
          [v39 updateNotificationsEnabled:1 forHome:v25 keepAliveOnly:1];

          v36 = v25;
          v37 = 1;
        }

        else
        {
          v30 = [(HMDHome *)self matterFabricEnabledClients];
          v31 = [v30 count];

          if (v31)
          {
            goto LABEL_34;
          }

          v32 = [(HMDHome *)self currentMatterClientRegistration];
          v24 = objc_autoreleasePoolPush();
          v25 = self;
          v33 = HMFGetOSLogHandle();
          v27 = v33;
          if (!v32)
          {
            if (!os_log_type_enabled(v33, OS_LOG_TYPE_DEBUG))
            {
              goto LABEL_24;
            }

            v28 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v28;
            _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEBUG, "%{public}@Not updating matter fabric registration as we are not registered and have no clients", &v43, 0xCu);
            goto LABEL_23;
          }

          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            v34 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v34;
            _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Updating matter fabric registration as we are registered but have no clients", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          v35 = [v20 chipDataSource];
          [v35 updateNotificationsEnabled:0 forHome:v25 keepAliveOnly:1];

          v36 = v25;
          v37 = 0;
        }

        [(HMDHome *)v36 setCurrentMatterClientRegistration:v37];
        goto LABEL_34;
      }

      v19 = [(HMDHome *)self matterFabricEnabledClients];
      [v19 addObject:v8];
LABEL_18:

      goto LABEL_19;
    }

    v19 = [(HMDHome *)self matterFabricEnabledClients];
    [v19 removeObject:v8];
    goto LABEL_18;
  }

LABEL_36:

  v40 = *MEMORY[0x277D85DE8];
}

- (void)registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5
{
  v8 = a5;
  v9 = a4;
  v10 = [(HMDHome *)self workQueue];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __88__HMDHome_registerForMatterFabricNotifications_registrationIdentifier_clientIdentifier___block_invoke;
  v11[3] = &unk_279731C38;
  v12 = a3;
  v11[4] = self;
  v11[5] = v9;
  v11[6] = v8;
  dispatch_async(v10, v11);
}

- (void)registerForMatterFabricNotifications:(BOOL)a3 registrationIdentifier:(id)a4
{
  v6 = a4;
  v7 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __71__HMDHome_registerForMatterFabricNotifications_registrationIdentifier___block_invoke;
  block[3] = &unk_279734938;
  v9 = a3;
  block[4] = self;
  block[5] = v6;
  dispatch_async(v7, block);
}

- (void)_registerForAccessoryReachabilityNotifications:(BOOL)a3 registrationIdentifier:(id)a4 clientIdentifier:(id)a5
{
  v6 = a3;
  v40 = *MEMORY[0x277D85DE8];
  v8 = a4;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v10);

  v11 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  v12 = v11;
  if (v6)
  {
    v13 = [v11 containsObject:v8];

    if (v13)
    {
      goto LABEL_6;
    }

    v12 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
    [v12 addObject:v8];
  }

  else
  {
    [v11 removeObject:v8];
  }

LABEL_6:
  v14 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  v15 = [v14 count];

  if (v15)
  {
    v16 = [(HMDHome *)self currentRemoteReachabilityRegistration];
    v17 = objc_autoreleasePoolPush();
    v18 = self;
    v19 = HMFGetOSLogHandle();
    v20 = v19;
    if (v16)
    {
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        v21 = HMFGetLogIdentifier();
        v22 = [(HMDHome *)v18 accessoryRemoteReachabilityEnabledClients];
        v36 = 138543618;
        v37 = v21;
        v38 = 2112;
        v39 = v22;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability registration as we are registered and have the clients %@", &v36, 0x16u);
      }

      objc_autoreleasePoolPop(v17);
    }

    else
    {
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v23;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_DEFAULT, "%{public}@Updating remote accessory reachability registration as we are not registered but have clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      if (v9)
      {
        v24 = v9;
      }

      else
      {
        v24 = v8;
      }

      [(HMDHome *)v18 __registerForRemoteAccessoryReachabilityNotifications:1 clientIdentifier:v24];
    }
  }

  v25 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  v26 = [v25 count];

  if (!v26)
  {
    v27 = [(HMDHome *)self currentRemoteReachabilityRegistration];
    v28 = objc_autoreleasePoolPush();
    v29 = self;
    v30 = HMFGetOSLogHandle();
    v31 = v30;
    if (v27)
    {
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v32 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v32;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_DEFAULT, "%{public}@Updating remote accessory reachability registration as we are registered but have no clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v28);
      if (v9)
      {
        v33 = v9;
      }

      else
      {
        v33 = v8;
      }

      [(HMDHome *)v29 __registerForRemoteAccessoryReachabilityNotifications:0 clientIdentifier:v33];
    }

    else
    {
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
      {
        v34 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v34;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability registration as we are not registered and have no clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v28);
    }
  }

  v35 = *MEMORY[0x277D85DE8];
}

- (void)registerForAccessoryReachabilityNotifications:(BOOL)a3 registrationIdentifier:(id)a4
{
  v6 = a4;
  v7 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __80__HMDHome_registerForAccessoryReachabilityNotifications_registrationIdentifier___block_invoke;
  block[3] = &unk_279734938;
  v9 = a3;
  block[4] = self;
  block[5] = v6;
  dispatch_async(v7, block);
}

- (void)handleLastProcessDidBecomeInactiveNotification:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __58__HMDHome_handleLastProcessDidBecomeInactiveNotification___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __58__HMDHome_handleLastProcessDidBecomeInactiveNotification___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_stringForKey:@"HMDXPCConnectionClientIdentifierKey"];

  [*(a1 + 40) _registerForAccessoryReachabilityNotifications:0 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v3];
  [*(a1 + 40) _registerForMatterFabricNotifications:0 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v3];
  v4 = [*(a1 + 40) WiFiAssertion];

  if (v4)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 40);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Releasing WiFi assertion", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [*(a1 + 40) wifiManager];
    v10 = [*(a1 + 40) WiFiAssertion];
    [v9 endActiveAssertion:v10];

    v11 = [*(a1 + 40) wifiManager];
    [v11 releaseWoWAssertion];

    [*(a1 + 40) setWiFiAssertion:0];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleFirstProcessDidBecomeActiveNotification:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __57__HMDHome_handleFirstProcessDidBecomeActiveNotification___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __57__HMDHome_handleFirstProcessDidBecomeActiveNotification___block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  if (isWatch())
  {
    if ([*(a1 + 32) remoteAccessIsEnabled])
    {
      v2 = [*(a1 + 32) WiFiAssertion];

      if (!v2)
      {
        v3 = objc_autoreleasePoolPush();
        v4 = *(a1 + 32);
        v5 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
        {
          v6 = HMFGetLogIdentifier();
          *buf = 138543362;
          v17 = v6;
          _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Taking WiFi assertion", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v3);
        v7 = [*(a1 + 32) wifiManager];
        v8 = MEMORY[0x277CCACA8];
        v9 = [*(a1 + 32) shortDescription];
        v10 = [v8 stringWithFormat:@"Remote Access for %@", v9];
        v11 = [v7 beginActiveAssertionWithOptions:0 reason:v10];
        [*(a1 + 32) setWiFiAssertion:v11];

        v12 = [*(a1 + 32) wifiManager];
        [v12 takeWoWAssertion];
      }
    }
  }

  v13 = [*(a1 + 40) userInfo];
  v14 = [v13 hmf_stringForKey:@"HMDXPCConnectionClientIdentifierKey"];

  [*(a1 + 32) _registerForAccessoryReachabilityNotifications:1 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v14];
  [*(a1 + 32) _registerForMatterFabricNotifications:1 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v14];

  v15 = *MEMORY[0x277D85DE8];
}

- (HMMDailyScheduler)dailyScheduler
{
  v2 = [(HMDHome *)self homeManager];
  v3 = [v2 metricsManager];
  v4 = [v3 dailyScheduler];

  return v4;
}

- (void)setThreadOperationalDataset:(id)a3
{
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [v6 copy];
  threadOperationalDataset = self->_threadOperationalDataset;
  self->_threadOperationalDataset = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSData)threadOperationalDataset
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSData *)self->_threadOperationalDataset copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setPrimaryNetworkRouterManagingDeviceUUID:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  primaryNetworkRouterManagingDeviceUUID = self->_primaryNetworkRouterManagingDeviceUUID;
  self->_primaryNetworkRouterManagingDeviceUUID = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSUUID)primaryNetworkRouterManagingDeviceUUID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_primaryNetworkRouterManagingDeviceUUID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setActiveNetworkRouterInitialSetupNeeded:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_activeNetworkRouterInitialSetupNeeded = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isActiveNetworkRouterInitialSetupNeeded
{
  os_unfair_recursive_lock_lock_with_options();
  activeNetworkRouterInitialSetupNeeded = self->_activeNetworkRouterInitialSetupNeeded;
  os_unfair_recursive_lock_unlock();
  return activeNetworkRouterInitialSetupNeeded;
}

- (void)setActiveNetworkRouterUUID:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  activeNetworkRouterUUID = self->_activeNetworkRouterUUID;
  self->_activeNetworkRouterUUID = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSUUID)activeNetworkRouterUUID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_activeNetworkRouterUUID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setRouterClientManager:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  routerClientManager = self->_routerClientManager;
  self->_routerClientManager = v4;

  os_unfair_recursive_lock_unlock();
}

- (HMDNetworkRouterClientManager)routerClientManager
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_routerClientManager;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  minHomeKitVersionForAccessoryNetworkProtectionChange = self->_minHomeKitVersionForAccessoryNetworkProtectionChange;
  self->_minHomeKitVersionForAccessoryNetworkProtectionChange = v4;

  os_unfair_recursive_lock_unlock();
}

- (HMDHomeKitVersion)minHomeKitVersionForAccessoryNetworkProtectionChange
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_minHomeKitVersionForAccessoryNetworkProtectionChange;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setMinimumNetworkRouterSupportHomeKitVersion:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  minimumNetworkRouterSupportHomeKitVersion = self->_minimumNetworkRouterSupportHomeKitVersion;
  self->_minimumNetworkRouterSupportHomeKitVersion = v4;

  os_unfair_recursive_lock_unlock();
}

- (HMDHomeKitVersion)minimumNetworkRouterSupportHomeKitVersion
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_minimumNetworkRouterSupportHomeKitVersion;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNetworkRouterSupport:(unint64_t)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_networkRouterSupport = a3;

  os_unfair_recursive_lock_unlock();
}

- (unint64_t)networkRouterSupport
{
  os_unfair_recursive_lock_lock_with_options();
  networkRouterSupport = self->_networkRouterSupport;
  os_unfair_recursive_lock_unlock();
  return networkRouterSupport;
}

- (void)setNetworkRouterSupportDisableReason:(unint64_t)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_networkRouterSupportDisableReason = a3;

  os_unfair_recursive_lock_unlock();
}

- (unint64_t)networkRouterSupportDisableReason
{
  os_unfair_recursive_lock_lock_with_options();
  networkRouterSupportDisableReason = self->_networkRouterSupportDisableReason;
  os_unfair_recursive_lock_unlock();
  return networkRouterSupportDisableReason;
}

- (void)setProtectionMode:(int64_t)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_protectionMode = a3;

  os_unfair_recursive_lock_unlock();
}

- (int64_t)protectionMode
{
  os_unfair_recursive_lock_lock_with_options();
  protectionMode = self->_protectionMode;
  os_unfair_recursive_lock_unlock();
  return protectionMode;
}

- (id)retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableDictionary *)self->_newlyConfiguredAccessories objectForKeyedSubscript:v4];
  v6 = [v5 copy];

  if (v6)
  {
    [(NSMutableDictionary *)self->_newlyConfiguredAccessories removeObjectForKey:v4];
    v7 = v6;
  }

  else
  {
    v7 = MEMORY[0x277CBEBF8];
  }

  v8 = v7;

  os_unfair_recursive_lock_unlock();

  return v8;
}

- (NSMapTable)addPendingAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMapTable *)self->_addPendingAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSMutableDictionary)addPendingAccessorySetupCodeHandlers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableDictionary *)self->_addPendingAccessorySetupCodeHandlers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSHashTable)removeAccessoryInProgressForHMDAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSHashTable *)self->_removeAccessoryInProgressForHMDAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)removeFromCurrentTriggers:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_currentTriggers containsObject:v4])
  {
    [(NSMutableArray *)self->_currentTriggers removeObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addToCurrentTriggers:(id)a3
{
  v4 = a3;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_currentTriggers containsObject:v4]& 1) == 0)
  {
    [(NSMutableArray *)self->_currentTriggers addObject:v4];
  }

  os_unfair_recursive_lock_unlock();
}

- (NSArray)triggers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_currentTriggers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)addNewlyConfiguredAccessories:(id)a3 addSessionIdentifier:(id)a4
{
  v8 = a3;
  v6 = a4;
  os_unfair_recursive_lock_lock_with_options();
  v7 = [(NSMutableDictionary *)self->_newlyConfiguredAccessories objectForKeyedSubscript:v6];
  if (!v7)
  {
    v7 = [MEMORY[0x277CBEB18] arrayWithCapacity:1];
    [(NSMutableDictionary *)self->_newlyConfiguredAccessories setObject:v7 forKeyedSubscript:v6];
  }

  [v7 addObjectsFromArray:v8];

  os_unfair_recursive_lock_unlock();
}

- (id)allNewlyConfiguredAccessories
{
  v16 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  v3 = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  v4 = [(NSMutableDictionary *)self->_newlyConfiguredAccessories allValues];
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = *v12;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(v4);
        }

        [v3 addObjectsFromArray:*(*(&v11 + 1) + 8 * i)];
      }

      v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v5);
  }

  v8 = [v3 copy];
  os_unfair_recursive_lock_unlock();
  v9 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)setAnyBTLEAccessoryReachable:(BOOL)a3
{
  os_unfair_recursive_lock_lock_with_options();
  self->_anyBTLEAccessoryReachable = a3;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isAnyBTLEAccessoryReachable
{
  os_unfair_recursive_lock_lock_with_options();
  anyBTLEAccessoryReachable = self->_anyBTLEAccessoryReachable;
  os_unfair_recursive_lock_unlock();
  return anyBTLEAccessoryReachable;
}

- (void)setName:(id)a3
{
  v6 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [v6 hm_truncatedNameString];
  name = self->_name;
  self->_name = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSString)name
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_name;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (HMDFeaturesDataSource)featuresDataSource
{
  v2 = [(HMDHome *)self dataSource];
  v3 = [v2 featuresDataSource];

  return v3;
}

- (id)dumpStateWithPrivacyLevel:(unint64_t)a3
{
  v188 = *MEMORY[0x277D85DE8];
  v148 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:12];
  v142 = MEMORY[0x277CCACA8];
  v140 = [(HMDHome *)self name];
  v149 = [(HMDHome *)self uuid];
  v5 = [v149 UUIDString];
  v145 = [(HMDHome *)self spiClientIdentifier];
  v6 = [v145 UUIDString];
  v7 = [(HMDHome *)self zoneID];
  v8 = [v7 UUIDString];
  [(HMDHome *)self isMultiUserEnabled];
  v9 = HMFBooleanToString();
  [(HMDHome *)self hasAnyUserAcknowledgedCameraRecordingOnboarding];
  v10 = HMFBooleanToString();
  v11 = [(HMDHome *)self urlString];
  v12 = [v142 stringWithFormat:@"name: %@, uuid: %@, spiClientIdentifier: %@, zoneID: %@, multiUserEnabled: %@, acknowledgedCameraOnboarding: %@, assistantIdentifier: %@", v140, v5, v6, v8, v9, v10, v11];

  v136 = v12;
  [v148 setObject:v12 forKeyedSubscript:*MEMORY[0x277D0F170]];
  v13 = [(HMDHome *)self appData];
  v14 = [v13 dumpStateWithPrivacyLevel:a3];
  [v148 setObject:v14 forKeyedSubscript:*MEMORY[0x277D0F050]];

  v15 = [(HMDHome *)self homeLocationWithPrivacyLevel:a3];
  v16 = v15;
  v17 = MEMORY[0x277CCACA8];
  if (v15)
  {
    v18 = v15;
  }

  else
  {
    v18 = @"Unknown";
  }

  v19 = [(HMDHome *)self homeLocationHandler];
  [v19 regionStateAtHome];
  v20 = HMRegionStateString();
  v21 = [(HMDHome *)self homeLocationHandler];
  [v21 regionStateNearbyHome];
  v22 = HMRegionStateString();
  v150 = self;
  v23 = [(HMDHome *)self atHomeLevel];
  v135 = v16;
  v143 = v21;
  v146 = v19;
  v24 = v20;
  if (v23 > 3)
  {
    v25 = @"HMDAtHomeLevelNotAtHome";
  }

  else
  {
    v25 = off_279722F30[v23];
  }

  [(HMDHome *)self homeLocation];
  v26 = HMStringFromHomeLocation();
  v27 = [(HMDHome *)self homeLocationHandler];
  v28 = HMDHomeLocationSourceToString([v27 locationSource]);
  v29 = [v17 stringWithFormat:@"Location: %@, At Home Region State: %@, Nearby Home Region State: %@, At Home Level: %@, State: %@, Source: %@", v18, v24, v22, v25, v26, v28];

  v30 = self;
  v31 = v148;
  v134 = v29;
  [v148 setObject:v29 forKeyedSubscript:*MEMORY[0x277D0F0F8]];
  v32 = MEMORY[0x277CCACA8];
  [(HMDHome *)self minimumMediaUserPrivilege];
  v33 = HMUserPrivilegeToString();
  [(HMDHome *)self isMediaPeerToPeerEnabled];
  v34 = HMFBooleanToString();
  v35 = [(HMDHome *)self mediaPassword];
  v36 = @"<set>";
  if (!v35)
  {
    v36 = @"<null>";
  }

  v37 = [v32 stringWithFormat:@"Minimum Media User Privilege: %@, Media Peer to Peer Enabled: %@, has Media Password: %@", v33, v34, v36];

  v133 = v37;
  [v148 setObject:v37 forKeyedSubscript:@"User Privilege"];
  v38 = [(HMDHome *)v150 rooms];
  v39 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v38, "count") + 1}];
  v40 = [(HMDHome *)v150 roomForEntireHome];

  if (v40)
  {
    v41 = [(HMDHome *)v150 roomForEntireHome];
    v42 = [v41 dumpStateWithPrivacyLevel:a3];
    [v39 addObject:v42];
  }

  v177 = 0u;
  v178 = 0u;
  v175 = 0u;
  v176 = 0u;
  v43 = v38;
  v44 = [v43 countByEnumeratingWithState:&v175 objects:v187 count:16];
  if (v44)
  {
    v45 = v44;
    v46 = *v176;
    do
    {
      for (i = 0; i != v45; ++i)
      {
        if (*v176 != v46)
        {
          objc_enumerationMutation(v43);
        }

        v48 = [*(*(&v175 + 1) + 8 * i) dumpStateWithPrivacyLevel:a3];
        [v39 addObject:v48];
      }

      v45 = [v43 countByEnumeratingWithState:&v175 objects:v187 count:16];
    }

    while (v45);
  }

  if ([v39 count])
  {
    [v148 setObject:v39 forKeyedSubscript:*MEMORY[0x277D0F140]];
  }

  v147 = [(HMDHome *)v150 zones];
  if ([v147 count])
  {
    v49 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v147, "count")}];
    v171 = 0u;
    v172 = 0u;
    v173 = 0u;
    v174 = 0u;
    v50 = v147;
    v51 = [v50 countByEnumeratingWithState:&v171 objects:v186 count:16];
    if (v51)
    {
      v52 = v51;
      v53 = *v172;
      do
      {
        for (j = 0; j != v52; ++j)
        {
          if (*v172 != v53)
          {
            objc_enumerationMutation(v50);
          }

          v55 = [*(*(&v171 + 1) + 8 * j) dumpStateWithPrivacyLevel:a3];
          [v49 addObject:v55];
        }

        v52 = [v50 countByEnumeratingWithState:&v171 objects:v186 count:16];
      }

      while (v52);
    }

    [v148 setObject:v49 forKeyedSubscript:*MEMORY[0x277D0F198]];
    v30 = v150;
  }

  v56 = [(HMDHome *)v30 accessories];
  v57 = [v56 copy];

  v144 = v57;
  if ([v57 count])
  {
    v58 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v57, "count")}];
    v167 = 0u;
    v168 = 0u;
    v169 = 0u;
    v170 = 0u;
    v59 = v57;
    v60 = [v59 countByEnumeratingWithState:&v167 objects:v185 count:16];
    if (v60)
    {
      v61 = v60;
      v62 = *v168;
      do
      {
        for (k = 0; k != v61; ++k)
        {
          if (*v168 != v62)
          {
            objc_enumerationMutation(v59);
          }

          v64 = *(*(&v167 + 1) + 8 * k);
          v65 = objc_autoreleasePoolPush();
          v66 = [v64 dumpStateWithPrivacyLevel:a3];
          [v58 addObject:v66];

          objc_autoreleasePoolPop(v65);
        }

        v61 = [v59 countByEnumeratingWithState:&v167 objects:v185 count:16];
      }

      while (v61);
    }

    v31 = v148;
    [v148 setObject:v58 forKeyedSubscript:*MEMORY[0x277D0F028]];

    v30 = v150;
  }

  v141 = [(HMDHome *)v30 serviceGroups];
  if ([v141 count])
  {
    v67 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v141, "count")}];
    v163 = 0u;
    v164 = 0u;
    v165 = 0u;
    v166 = 0u;
    v68 = v141;
    v69 = [v68 countByEnumeratingWithState:&v163 objects:v184 count:16];
    if (v69)
    {
      v70 = v69;
      v71 = *v164;
      do
      {
        for (m = 0; m != v70; ++m)
        {
          if (*v164 != v71)
          {
            objc_enumerationMutation(v68);
          }

          v73 = [*(*(&v163 + 1) + 8 * m) dumpStateWithPrivacyLevel:a3];
          [v67 addObject:v73];
        }

        v70 = [v68 countByEnumeratingWithState:&v163 objects:v184 count:16];
      }

      while (v70);
    }

    [v31 setObject:v67 forKeyedSubscript:*MEMORY[0x277D0F148]];
    v30 = v150;
  }

  v139 = [(HMDHome *)v30 triggers];
  if ([v139 count])
  {
    v74 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v139, "count")}];
    v159 = 0u;
    v160 = 0u;
    v161 = 0u;
    v162 = 0u;
    v75 = v139;
    v76 = [v75 countByEnumeratingWithState:&v159 objects:v183 count:16];
    if (v76)
    {
      v77 = v76;
      v78 = *v160;
      do
      {
        for (n = 0; n != v77; ++n)
        {
          if (*v160 != v78)
          {
            objc_enumerationMutation(v75);
          }

          v80 = [*(*(&v159 + 1) + 8 * n) dumpStateWithPrivacyLevel:a3];
          [v74 addObject:v80];
        }

        v77 = [v75 countByEnumeratingWithState:&v159 objects:v183 count:16];
      }

      while (v77);
    }

    [v31 setObject:v74 forKeyedSubscript:*MEMORY[0x277D0F188]];
    v30 = v150;
  }

  v81 = [(HMDHome *)v30 currentUser];
  v82 = [v81 dumpStateWithPrivacyLevel:a3];
  [v31 setObject:v82 forKeyedSubscript:*MEMORY[0x277D0F090]];

  v83 = [(HMDHome *)v30 users];
  v84 = [v83 copy];

  v138 = v84;
  if ([v84 count])
  {
    v85 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v84, "count")}];
    v155 = 0u;
    v156 = 0u;
    v157 = 0u;
    v158 = 0u;
    v86 = v84;
    v87 = [v86 countByEnumeratingWithState:&v155 objects:v182 count:16];
    if (v87)
    {
      v88 = v87;
      v89 = *v156;
      do
      {
        for (ii = 0; ii != v88; ++ii)
        {
          if (*v156 != v89)
          {
            objc_enumerationMutation(v86);
          }

          v91 = [*(*(&v155 + 1) + 8 * ii) dumpStateWithPrivacyLevel:a3];
          [v85 addObject:v91];
        }

        v88 = [v86 countByEnumeratingWithState:&v155 objects:v182 count:16];
      }

      while (v88);
    }

    [v31 setObject:v85 forKeyedSubscript:*MEMORY[0x277D0F190]];
    v30 = v150;
  }

  v137 = [(HMDHome *)v30 removedUsers];
  if ([v137 count])
  {
    v92 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v137, "count")}];
    v151 = 0u;
    v152 = 0u;
    v153 = 0u;
    v154 = 0u;
    v93 = v137;
    v94 = [v93 countByEnumeratingWithState:&v151 objects:v181 count:16];
    if (v94)
    {
      v95 = v94;
      v96 = *v152;
      do
      {
        for (jj = 0; jj != v95; ++jj)
        {
          if (*v152 != v96)
          {
            objc_enumerationMutation(v93);
          }

          v98 = [*(*(&v151 + 1) + 8 * jj) user];
          v99 = [v98 dumpStateWithPrivacyLevel:a3];
          [v92 addObject:v99];
        }

        v95 = [v93 countByEnumeratingWithState:&v151 objects:v181 count:16];
      }

      while (v95);
    }

    v31 = v148;
    [v148 setObject:v92 forKeyedSubscript:*MEMORY[0x277D0F130]];

    v30 = v150;
  }

  v100 = [(HMDHome *)v30 residentDeviceManager];

  if (v100)
  {
    v101 = [(HMDHome *)v30 residentDeviceManager];
    v102 = [v101 dumpState];
    [v31 setObject:v102 forKeyedSubscript:*MEMORY[0x277D0F138]];
  }

  v131 = MEMORY[0x277CBEB38];
  v179[0] = @"Registered";
  v132 = [(HMDHome *)v30 notificationRegistrations];
  v103 = [v132 allObjects];
  v180[0] = v103;
  v179[1] = @"Apple Media Registered";
  v104 = [(HMDHome *)v150 notificationRegistrationsForAppleMediaAccessories];
  v105 = [v104 allObjects];
  v180[1] = v105;
  v179[2] = @"Deregistered";
  v106 = [(HMDHome *)v150 notificationDeregistrations];
  v107 = [v106 allObjects];
  v180[2] = v107;
  v108 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v180 forKeys:v179 count:3];
  v109 = [v131 dictionaryWithDictionary:v108];

  v110 = [(HMDHome *)v150 notificationsUpdatedTime];

  if (v110)
  {
    v111 = [(HMDHome *)v150 notificationsUpdatedTime];
    v112 = [v111 shortDescription];
    [v109 setObject:v112 forKey:@"UpdateTime"];
  }

  [v148 setObject:v109 forKeyedSubscript:*MEMORY[0x277D0F0C8]];
  v113 = [(HMDHome *)v150 pendingResponses];
  v114 = [v113 description];
  [v148 setObject:v114 forKeyedSubscript:*MEMORY[0x277D0F118]];

  v115 = [(HMDHome *)v150 sharedHomeUpdateHandler];
  v116 = [v115 dumpStateWithPrivacyLevel:a3];
  [v148 setObject:v116 forKeyedSubscript:*MEMORY[0x277D0F160]];

  v117 = [(HMDHome *)v150 sharedHomeSourceVersion];
  v118 = [v117 versionString];
  [v148 setObject:v118 forKeyedSubscript:*MEMORY[0x277D0F158]];

  v119 = MEMORY[0x277CCACA8];
  v120 = [(HMDHome *)v150 unfilteredThreadNetworkID];
  v121 = [v119 stringWithFormat:@"threadNetworkID=%@", v120];
  [v148 setObject:v121 forKeyedSubscript:@"ThreadNetwork"];

  v122 = [(HMDHome *)v150 personManagerSettings];
  v123 = [v122 description];
  [v148 setObject:v123 forKeyedSubscript:@"Person Manager Settings"];

  v124 = [(HMDHome *)v150 labelsByAccessCode];
  v125 = [v124 description];
  [v148 setObject:v125 forKeyedSubscript:@"Simple Label Access Codes"];

  v126 = [(HMDHome *)v150 chipStorage];
  v127 = [v126 debugDictionaryRepresentation];
  [v148 setObject:v127 forKeyedSubscript:@"CHIP Home Storage"];

  [(HMDHome *)v150 isResidentFirstAccessoryCommunicationEnabled];
  v128 = HMFBooleanToString();
  [v148 setObject:v128 forKeyedSubscript:@"Is Resident First Accessory Communication Enabled"];

  v129 = *MEMORY[0x277D85DE8];

  return v148;
}

- (id)homeLocationWithPrivacyLevel:(unint64_t)a3
{
  if (a3 == 2)
  {
    v3 = [(HMDHome *)self homeLocationHandler];
    v4 = [v3 location];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)descriptionWithPointer:(BOOL)a3
{
  v3 = a3;
  v5 = MEMORY[0x277CCACA8];
  v6 = [objc_opt_class() shortDescription];
  if (v3)
  {
    v7 = [MEMORY[0x277CCACA8] stringWithFormat:@" %p", self];
  }

  else
  {
    v7 = &stru_286509E58;
  }

  v8 = [(HMDHome *)self uuid];
  v9 = [v8 UUIDString];
  v10 = [(HMDHome *)self spiClientIdentifier];
  v11 = [v10 UUIDString];
  v12 = [(HMDHome *)self name];
  v13 = [v5 stringWithFormat:@"<%@%@, ID = %@, spiID = %@, NM = %@>", v6, v7, v9, v11, v12];

  if (v3)
  {
  }

  return v13;
}

- (id)shortDescription
{
  if (isInternalBuild())
  {
    v3 = MEMORY[0x277CCACA8];
    v4 = [(HMDHome *)self name];
    v5 = [(HMDHome *)self uuid];
    v6 = [v3 stringWithFormat:@"%@/%@", v4, v5];
  }

  else
  {
    v4 = [(HMDHome *)self uuid];
    v6 = [v4 UUIDString];
  }

  return v6;
}

- (void)dealloc
{
  [(HMDHome *)self unconfigure];
  v3.receiver = self;
  v3.super_class = HMDHome;
  [(HMDHome *)&v3 dealloc];
}

- (void)unconfigure
{
  v3 = [(HMDHome *)self notificationCenter];
  [v3 removeObserver:self];

  v4 = [(HMDHome *)self msgDispatcher];
  [v4 deregisterReceiver:self];

  v5 = [(HMDHome *)self mediaGroupsAggregateConsumer];
  [v5 unconfigure];

  v6 = [(HMDHome *)self accessCodeManager];
  [v6 unconfigure];
}

- (HMDHome)initWithName:(id)a3 uuid:(id)a4 defaultRoomUUID:(id)a5 owner:(id)a6 homeManager:(id)a7 presenceAuth:(id)a8 dataSource:(id)a9 logEventSubmitter:(id)a10 carPlayDataSource:(id)a11 administratorHandlerFactory:(id)a12 localCapabilitiesDataSource:(id)a13 notificationCenter:(id)a14 keychainStore:(id)a15
{
  v290 = *MEMORY[0x277D85DE8];
  v271 = a3;
  v274 = a4;
  v270 = a5;
  v278 = a6;
  obj = a7;
  v273 = a8;
  v279 = a9;
  v276 = a10;
  v265 = a11;
  v269 = a12;
  v266 = a13;
  v272 = a14;
  v267 = a15;
  v285.receiver = self;
  v285.super_class = HMDHome;
  v20 = [(HMDHome *)&v285 init];
  v21 = v20;
  if (!v20)
  {
    goto LABEL_47;
  }

  objc_storeStrong(&v20->_dataSource, a9);
  +[HMDHome _initialize];
  v264 = [obj sharedUserAcceptEventBuilderForHomeUuid:v274];
  [v264 markCreatedHome];
  objc_storeStrong(&v21->_localCapabilitiesDataSource, a13);
  v22 = HMFGetOSLogHandle();
  logger = v21->_logger;
  v21->_logger = v22;

  if (v274)
  {
    v263 = [v274 copy];
  }

  else
  {
    v263 = [MEMORY[0x277CCAD78] UUID];
  }

  v24 = [MEMORY[0x277D0F890] hmf_cachedInstanceForNSUUID:v263];
  uuid = v21->_uuid;
  v21->_uuid = v24;

  v262 = spiClientIdentifierForUUID(v21->_uuid);
  v26 = [MEMORY[0x277D0F890] hmf_cachedInstanceForNSUUID:v262];
  spiClientIdentifier = v21->_spiClientIdentifier;
  v21->_spiClientIdentifier = v26;

  v28 = [(NSUUID *)v21->_uuid UUIDString];
  v268 = [@"com.apple.hmd.home" stringByAppendingString:v28];

  v29 = v268;
  v30 = [v268 UTF8String];
  v31 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
  v32 = dispatch_queue_create(v30, v31);
  workQueue = v21->_workQueue;
  v21->_workQueue = v32;

  [MEMORY[0x277D0F7A8] blessWithImplicitContext:v21->_workQueue];
  objc_storeStrong(&v21->_notificationCenter, a14);
  v34 = [[HMDPrimaryResidentChangeMonitor alloc] initWithIdentifier:v21->_uuid notificationCenter:v272];
  primaryResidentChangeMonitor = v21->_primaryResidentChangeMonitor;
  v21->_primaryResidentChangeMonitor = v34;

  [(HMDPrimaryResidentChangeMonitor *)v21->_primaryResidentChangeMonitor setDataSource:v21];
  objc_storeStrong(&v21->_logEventSubmitter, a10);
  objc_storeStrong(&v21->_keychainStore, a15);
  v36 = [v279 makeReportingSessionManager];
  reportingSessionManager = v21->_reportingSessionManager;
  v21->_reportingSessionManager = v36;

  if (v276)
  {
    v38 = [v279 makeHomeMetricsDispatcherWithIdentifier:v21->_uuid logEventSubmitter:v276];
    metricsDispatcher = v21->_metricsDispatcher;
    v21->_metricsDispatcher = v38;
  }

  v40 = [v271 hm_truncatedNameString];
  v41 = [v40 copy];
  name = v21->_name;
  v21->_name = v41;

  v43 = [HMDHome zoneIDFromHomeUUID:v21->_uuid];
  zoneID = v21->_zoneID;
  v21->_zoneID = v43;

  objc_storeWeak(&v21->_homeManager, obj);
  v45 = [obj messageDispatcher];
  msgDispatcher = v21->_msgDispatcher;
  v21->_msgDispatcher = v45;

  objc_storeStrong(&v21->_owner, a6);
  v21->_ownerTrustZoneCapable = [v278 isCurrentUser];
  v47 = [v278 pairingUsername];
  ownerName = v21->_ownerName;
  v21->_ownerName = v47;

  v49 = v278;
  if (v278)
  {
    v49 = [v278 isCurrentUser];
  }

  v21->_ownerUser = v49;
  v21->_allowsRemoteAccess = 1;
  v50 = +[HMDHomeKitVersion currentVersion];
  currentHomeKitVersion = v21->_currentHomeKitVersion;
  v21->_currentHomeKitVersion = v50;

  v52 = objc_autoreleasePoolPush();
  v53 = v21;
  v54 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v54, OS_LOG_TYPE_INFO))
  {
    v55 = HMFGetLogIdentifier();
    *buf = 138543618;
    v287 = v55;
    v288 = 2112;
    v289 = v273;
    _os_log_impl(&dword_2531F8000, v54, OS_LOG_TYPE_INFO, "%{public}@Home Presence auth : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v52);
  if (v273)
  {
    v56 = v273;
    presenceAuthStatus = v53->_presenceAuthStatus;
    v53->_presenceAuthStatus = v56;
  }

  else
  {
    v58 = [HMDHomeManager isThisDeviceAdminOfHome:v53];
    if (v58)
    {
      presenceAuthStatus = [MEMORY[0x277CD1F00] authWithValue:1];
    }

    else
    {
      presenceAuthStatus = 0;
    }

    objc_storeStrong(&v53->_presenceAuthStatus, presenceAuthStatus);
    if (!v58)
    {
      goto LABEL_18;
    }
  }

LABEL_18:
  presenceComputeStatus = v53->_presenceComputeStatus;
  v53->_presenceComputeStatus = 0;

  v53->_homeLocation = 0;
  v60 = [MEMORY[0x277CBEB58] set];
  reachabilityUpdatedAccessories = v53->_reachabilityUpdatedAccessories;
  v53->_reachabilityUpdatedAccessories = v60;

  v62 = [[HMDHomeObjectChangeHandler alloc] initWithHome:v53];
  homeObjectChangeHandler = v53->_homeObjectChangeHandler;
  v53->_homeObjectChangeHandler = v62;

  v64 = [obj accessoryBrowser];
  accessoryBrowser = v53->_accessoryBrowser;
  v53->_accessoryBrowser = v64;

  v66 = [MEMORY[0x277CBEB18] array];
  rooms = v53->_rooms;
  v53->_rooms = v66;

  v68 = [MEMORY[0x277CBEB18] array];
  zones = v53->_zones;
  v53->_zones = v68;

  v70 = [MEMORY[0x277CBEB38] dictionary];
  accessories = v53->_accessories;
  v53->_accessories = v70;

  v72 = [MEMORY[0x277CBEB18] array];
  serviceGroups = v53->_serviceGroups;
  v53->_serviceGroups = v72;

  v74 = [MEMORY[0x277CBEB18] array];
  actionSets = v53->_actionSets;
  v53->_actionSets = v74;

  v76 = [MEMORY[0x277CBEB18] array];
  currentTriggers = v53->_currentTriggers;
  v53->_currentTriggers = v76;

  v78 = [MEMORY[0x277CBEB18] array];
  triggerOwnedActionSets = v53->_triggerOwnedActionSets;
  v53->_triggerOwnedActionSets = v78;

  v80 = [MEMORY[0x277CBEB18] array];
  users = v53->_users;
  v53->_users = v80;

  v82 = [MEMORY[0x277CBEB18] array];
  usersPendingUserManagementOperations = v53->_usersPendingUserManagementOperations;
  v53->_usersPendingUserManagementOperations = v82;

  v84 = [MEMORY[0x277CBEB18] array];
  removedUsers = v53->_removedUsers;
  v53->_removedUsers = v84;

  v86 = [MEMORY[0x277CBEB18] array];
  outgoingInvitations = v53->_outgoingInvitations;
  v53->_outgoingInvitations = v86;

  v88 = [MEMORY[0x277CBEB18] array];
  ownedTriggers = v53->_ownedTriggers;
  v53->_ownedTriggers = v88;

  v90 = [MEMORY[0x277CBEB58] set];
  pendingResponsesForRemoteAccessSetup = v53->_pendingResponsesForRemoteAccessSetup;
  v53->_pendingResponsesForRemoteAccessSetup = v90;

  v92 = [MEMORY[0x277CBEB38] dictionary];
  enableNotificationPayload = v53->_enableNotificationPayload;
  v53->_enableNotificationPayload = v92;

  v94 = [MEMORY[0x277CBEB38] dictionary];
  disableNotificationPayload = v53->_disableNotificationPayload;
  v53->_disableNotificationPayload = v94;

  v96 = [MEMORY[0x277CBEB38] dictionary];
  notificationHandlerMap = v53->_notificationHandlerMap;
  v53->_notificationHandlerMap = v96;

  v98 = [MEMORY[0x277CBEB58] set];
  notificationRegistrations = v53->_notificationRegistrations;
  v53->_notificationRegistrations = v98;

  v100 = [MEMORY[0x277CBEB58] set];
  notificationRegistrationsForAppleMediaAccessories = v53->_notificationRegistrationsForAppleMediaAccessories;
  v53->_notificationRegistrationsForAppleMediaAccessories = v100;

  v102 = [MEMORY[0x277CBEB58] set];
  notificationDeregistrations = v53->_notificationDeregistrations;
  v53->_notificationDeregistrations = v102;

  v104 = [MEMORY[0x277CBEAA8] distantFuture];
  notificationsUpdatedTime = v53->_notificationsUpdatedTime;
  v53->_notificationsUpdatedTime = v104;

  v106 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  uuidToHAPAccessoryConfigTable = v53->_uuidToHAPAccessoryConfigTable;
  v53->_uuidToHAPAccessoryConfigTable = v106;

  v108 = +[HMDAppleAccountSettings sharedSettings];
  accountSettings = v53->_accountSettings;
  v53->_accountSettings = v108;

  objc_storeStrong(&v53->_carPlayDataSource, a11);
  if (isiOSDevice())
  {
    v110 = [MEMORY[0x277CBEB58] set];
    heartbeatPingMessagesQueuedWithServer = v53->_heartbeatPingMessagesQueuedWithServer;
    v53->_heartbeatPingMessagesQueuedWithServer = v110;
  }

  if (v278)
  {
    [(NSMutableArray *)v53->_users addObject:v278];
    [v278 setHome:v53];
    if (!v21->_ownerUser)
    {
      [(HMDHome *)v53 _updateCurrentUserForSharedHome];
    }
  }

  v112 = [HMDRoom alloc];
  v113 = HMDDefaultRoomName();
  v114 = [(HMDRoom *)v112 initWithName:v113 uuid:v270 home:v53];
  roomForEntireHome = v53->_roomForEntireHome;
  v53->_roomForEntireHome = v114;

  v53->_configurationVersion = 0;
  v53->_previousReachableAccessoriesCount = 0;
  v53->_previousReachableAppleMediaAccessoriesCount = 0;
  v116 = [MEMORY[0x277CBEB18] array];
  unconfiguredResidentDevices = v53->_unconfiguredResidentDevices;
  v53->_unconfiguredResidentDevices = v116;

  v118 = [MEMORY[0x277CCAA50] weakObjectsHashTable];
  removeAccessoryInProgressForHMDAccessories = v53->_removeAccessoryInProgressForHMDAccessories;
  v53->_removeAccessoryInProgressForHMDAccessories = v118;

  v120 = [MEMORY[0x277CBEB18] array];
  retrievalAccessoryCompletionTuples = v53->_retrievalAccessoryCompletionTuples;
  v53->_retrievalAccessoryCompletionTuples = v120;

  v122 = [MEMORY[0x277CBEB18] array];
  accessoryRemoteReachabilityEnabledClients = v53->_accessoryRemoteReachabilityEnabledClients;
  v53->_accessoryRemoteReachabilityEnabledClients = v122;

  objc_initWeak(&location, v53);
  v124 = [HMDManagedStagedValue alloc];
  v125 = [MEMORY[0x277D0F788] BOOLeanWithBool:0];
  v282[0] = MEMORY[0x277D85DD0];
  v282[1] = 3221225472;
  v282[2] = __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke;
  v282[3] = &unk_279721F58;
  objc_copyWeak(&v283, &location);
  v126 = [(HMDManagedStagedValue *)v124 initWithValue:v125 commitBlock:v282];
  stagedRemoteReachabilityRegistration = v53->_stagedRemoteReachabilityRegistration;
  v53->_stagedRemoteReachabilityRegistration = v126;

  v128 = [MEMORY[0x277CBEB18] array];
  reachabilityRegisteredDevices = v53->_reachabilityRegisteredDevices;
  v53->_reachabilityRegisteredDevices = v128;

  v130 = [MEMORY[0x277CBEB18] array];
  remoteReachabilityNotificationPendingAccessories = v53->_remoteReachabilityNotificationPendingAccessories;
  v53->_remoteReachabilityNotificationPendingAccessories = v130;

  v132 = [MEMORY[0x277CBEB38] dictionary];
  pendingResponses = v53->_pendingResponses;
  v53->_pendingResponses = v132;

  v134 = [v279 makeHomeLocationHandler];
  homeLocationHandler = v53->_homeLocationHandler;
  v53->_homeLocationHandler = v134;

  v136 = [v279 makeHomeReprovisionHandler];
  homeReprovisionHandler = v53->_homeReprovisionHandler;
  v53->_homeReprovisionHandler = v136;

  v138 = [MEMORY[0x277CBEB38] dictionary];
  newlyConfiguredAccessories = v53->_newlyConfiguredAccessories;
  v53->_newlyConfiguredAccessories = v138;

  v140 = [MEMORY[0x277CCAB00] mapTableWithKeyOptions:512 valueOptions:0];
  addPendingAccessories = v53->_addPendingAccessories;
  v53->_addPendingAccessories = v140;

  v142 = [MEMORY[0x277CBEB38] dictionary];
  addPendingAccessorySetupCodes = v53->_addPendingAccessorySetupCodes;
  v53->_addPendingAccessorySetupCodes = v142;

  v144 = [MEMORY[0x277CBEB38] dictionary];
  addPendingAccessoryOnboardingSetupPayloadStrings = v53->_addPendingAccessoryOnboardingSetupPayloadStrings;
  v53->_addPendingAccessoryOnboardingSetupPayloadStrings = v144;

  v146 = [MEMORY[0x277CBEB38] dictionary];
  addPendingAccessorySetupCodeHandlers = v53->_addPendingAccessorySetupCodeHandlers;
  v53->_addPendingAccessorySetupCodeHandlers = v146;

  v53->_anyBTLEAccessoryReachable = 0;
  v148 = [v279 makeResidentDeviceManagerWithHomeUUID:v21->_uuid];
  residentDeviceManager = v53->_residentDeviceManager;
  v53->_residentDeviceManager = v148;

  if (!v21->_ownerUser && !isWatch())
  {
    v150 = objc_alloc_init(HMDSharedHomeUpdateHandler);
    sharedHomeUpdateHandler = v53->_sharedHomeUpdateHandler;
    v53->_sharedHomeUpdateHandler = v150;

    [(HMDSharedHomeUpdateHandler *)v53->_sharedHomeUpdateHandler configureWithHome:v53];
  }

  v152 = v269[2](v269, v53);
  administratorHandler = v53->_administratorHandler;
  v53->_administratorHandler = v152;

  v154 = [HMDHomeMediaSystemHandler alloc];
  v155 = [(HMDHomeMediaSystemHandler *)v154 initWithMediaSystems:MEMORY[0x277CBEBF8]];
  mediaSystemController = v53->_mediaSystemController;
  v53->_mediaSystemController = v155;

  v53->_automaticSoftwareUpdateEnabled = 1;
  v53->_automaticThirdPartyAccessorySoftwareUpdateEnabled = 0;
  v53->_protectionMode = 0;
  v53->_networkRouterSupportDisableReason = 0;
  v53->_networkRouterSupport = [(HMDHome *)v53 deriveNetworkRouterSupport:0];
  v53->_mediaPeerToPeerEnabled = 0;
  v53->_soundCheckEnabled = 1;
  v157 = [v279 makeNotificationRegistry];
  notificationRegistry = v53->_notificationRegistry;
  v53->_notificationRegistry = v157;

  [(HMDNotificationRegistry *)v53->_notificationRegistry configureWithHome:v53];
  if ([(HMDHomeLocalDeviceCapabilitiesDataSource *)v21->_localCapabilitiesDataSource isResidentCapable])
  {
    v159 = [[HMDResidentAppleMediaStateManager alloc] initWithDataSource:v53 delegate:v53];
    mediaStateManager = v53->_mediaStateManager;
    v53->_mediaStateManager = v159;
  }

  v161 = [MEMORY[0x277CBEB18] array];
  mediaSessions = v53->_mediaSessions;
  v53->_mediaSessions = v161;

  v163 = [MEMORY[0x277CBEB18] array];
  mediaSessionStates = v53->_mediaSessionStates;
  v53->_mediaSessionStates = v163;

  v165 = [MEMORY[0x277CCAA50] weakObjectsHashTable];
  connectionsDiscoveringSymptomsForNearbyDevices = v53->_connectionsDiscoveringSymptomsForNearbyDevices;
  v53->_connectionsDiscoveringSymptomsForNearbyDevices = v165;

  if (!isWatch())
  {
    if (v278 && [(HMDHomeLocalDeviceCapabilitiesDataSource *)v21->_localCapabilitiesDataSource isResidentCapable])
    {
      v167 = [(HMDHome *)v53 dataSource];
      v168 = [v167 makeHomePresenceMonitor];
      presenceMonitor = v53->_presenceMonitor;
      v53->_presenceMonitor = v168;

      v170 = objc_alloc_init(HMDHomePeriodicReader);
      periodicReader = v53->_periodicReader;
      v53->_periodicReader = v170;
    }

    v172 = objc_alloc_init(HMDUserPresenceFeeder);
    presenceFeeder = v53->_presenceFeeder;
    v53->_presenceFeeder = v172;

    v174 = objc_autoreleasePoolPush();
    v175 = v53;
    v176 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v176, OS_LOG_TYPE_INFO))
    {
      v177 = HMFGetLogIdentifier();
      v178 = [(HMDHome *)v175 presenceFeeder];
      *buf = 138543618;
      v287 = v177;
      v288 = 2112;
      v289 = v178;
      _os_log_impl(&dword_2531F8000, v176, OS_LOG_TYPE_INFO, "%{public}@Allocated presenceFeeder on HMDHome: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v174);
  }

  v179 = [HMDPredicateUtilities alloc];
  v180 = [(HMDHome *)v53 name];
  v181 = [(HMDPredicateUtilities *)v179 initWithHome:v53 logIdentifier:v180];
  predicateUtility = v53->_predicateUtility;
  v53->_predicateUtility = v181;

  v183 = [[HMDMediaActionRouter alloc] initWithDataSource:v53];
  mediaActionRouter = v53->_mediaActionRouter;
  v53->_mediaActionRouter = v183;

  v53->_multiUserEnabled = 1;
  v53->_hasAnyUserAcknowledgedCameraRecordingOnboarding = 0;
  v185 = [HMDAccessoryNetworkProtectionGroupRegistry alloc];
  v186 = [(HMDHome *)v53 notificationCenter];
  v187 = [(HMDAccessoryNetworkProtectionGroupRegistry *)v185 initWithHome:v53 notificationCenter:v186];
  networkProtectionGroupRegistry = v53->_networkProtectionGroupRegistry;
  v53->_networkProtectionGroupRegistry = v187;

  v189 = [HMDResidentReachabilityNotificationManager alloc];
  v190 = objc_alloc_init(HMDResidentReachabilityContext);
  v191 = [(HMDResidentReachabilityNotificationManager *)v189 initWithResidentReachabilityContext:v190 workQueue:v21->_workQueue];
  reachabilityNotificationManager = v53->_reachabilityNotificationManager;
  v53->_reachabilityNotificationManager = v191;

  v193 = [[HMDAccessoryReachabilityChangedLogEventManager alloc] initWithHome:v53];
  reachabilityChangedLogEventManager = v53->_reachabilityChangedLogEventManager;
  v53->_reachabilityChangedLogEventManager = v193;

  v195 = [v279 makeNaturalLightingCurveWriterWithHome:v53];
  naturalLightingCurveWriter = v53->_naturalLightingCurveWriter;
  v53->_naturalLightingCurveWriter = v195;

  v197 = [HMDHAPAccessoryConnectionCoordinator alloc];
  v198 = [(HMDHome *)v53 notificationCenter];
  v199 = [(HMDHAPAccessoryConnectionCoordinator *)v197 initWithHome:v53 notificationCenter:v198];
  accessoryConnectionCoordinator = v53->_accessoryConnectionCoordinator;
  v53->_accessoryConnectionCoordinator = v199;

  v201 = [[HMDHAPAccessoryReaderWriter alloc] initWithHome:v53];
  accessoryReaderWriter = v53->_accessoryReaderWriter;
  v53->_accessoryReaderWriter = v201;

  v203 = [[HMDHomePersonDataManager alloc] initWithHome:v53 workQueue:v21->_workQueue];
  personDataManager = v53->_personDataManager;
  v53->_personDataManager = v203;

  v205 = [[HMDHomeWalletKeyManager alloc] initWithUUID:v21->_uuid workQueue:v21->_workQueue];
  walletKeyManager = v53->_walletKeyManager;
  v53->_walletKeyManager = v205;

  v207 = objc_autoreleasePoolPush();
  v208 = v53;
  v209 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v209, OS_LOG_TYPE_DEFAULT))
  {
    v210 = HMFGetLogIdentifier();
    *buf = 138543362;
    v287 = v210;
    _os_log_impl(&dword_2531F8000, v209, OS_LOG_TYPE_DEFAULT, "%{public}@Created wallet key manager", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v207);
  v211 = [v279 makeNFCReaderKeyManagerWithHomeUUID:v21->_uuid workQueue:v21->_workQueue];
  nfcReaderKeyManager = v208->_nfcReaderKeyManager;
  v208->_nfcReaderKeyManager = v211;

  v213 = objc_autoreleasePoolPush();
  v214 = v208;
  v215 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v215, OS_LOG_TYPE_DEFAULT))
  {
    v216 = HMFGetLogIdentifier();
    *buf = 138543362;
    v287 = v216;
    _os_log_impl(&dword_2531F8000, v215, OS_LOG_TYPE_DEFAULT, "%{public}@Created nfc reader key manager", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v213);
  v214->_shouldEncodeHasOnboardedForWalletKey = 1;
  v214->_shouldEncodeNFCReaderKey = 1;
  v217 = [MEMORY[0x277CBEB38] dictionary];
  labelsByAccessCode = v214->_labelsByAccessCode;
  v214->_labelsByAccessCode = v217;

  v219 = [MEMORY[0x277CBEB38] dictionary];
  removedUserInfoByAccessCode = v214->_removedUserInfoByAccessCode;
  v214->_removedUserInfoByAccessCode = v219;

  v221 = [HMDAccessCodeManagerContext alloc];
  v222 = [(HMDHome *)v214 workQueue];
  v223 = [(HMDAccessCodeManagerContext *)v221 initWithHome:v214 workQueue:v222];

  v224 = [[HMDAccessCodeManager alloc] initWithContext:v223];
  accessCodeManager = v214->_accessCodeManager;
  v214->_accessCodeManager = v224;

  v226 = [(HMDHome *)v214 uuid];
  v227 = [(HMDHome *)v214 workQueue];
  v228 = [v279 makeLockNotificationManagerWithHomeUUID:v226 workQueue:v227];
  lockNotificationManager = v214->_lockNotificationManager;
  v214->_lockNotificationManager = v228;

  v230 = [[HMDCameraAnalysisStatePublisher alloc] initWithHome:v214];
  analysisStatePublisher = v214->_analysisStatePublisher;
  v214->_analysisStatePublisher = v230;

  if ([(HMDHomeLocalDeviceCapabilitiesDataSource *)v21->_localCapabilitiesDataSource isResidentCapable])
  {
    v232 = [[HMDHomeRemoteEventAccessController alloc] initWithDataSource:v214];
    homeRemoteEventAccessController = v214->_homeRemoteEventAccessController;
    v214->_homeRemoteEventAccessController = v232;
  }

  v234 = objc_autoreleasePoolPush();
  v235 = v214;
  v236 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v236, OS_LOG_TYPE_DEFAULT))
  {
    v237 = HMFGetLogIdentifier();
    *buf = 138543362;
    v287 = v237;
    _os_log_impl(&dword_2531F8000, v236, OS_LOG_TYPE_DEFAULT, "%{public}@Creating setup metric dispatchers for media system and home theater", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v234);
  v238 = [[HMDMediaGroupSetupMetricDispatcher alloc] initWithDataSource:v235 logEventSubmitter:v276];
  v239 = v235[182];
  v235[182] = v238;

  v240 = [[HMDMediaGroupSetupMetricDispatcher alloc] initWithDataSource:v235 logEventSubmitter:v276];
  v241 = v235[183];
  v235[183] = v240;

  v242 = objc_alloc_init(HMDCHIPHomeStorage);
  v243 = v235[173];
  v235[173] = v242;

  if ([v235 isFeatureMatterLocalFabricConfigEnabled])
  {
    v244 = [MEMORY[0x277CBEB18] array];
    v245 = v235[130];
    v235[130] = v244;

    v246 = objc_alloc(MEMORY[0x277D17AE8]);
    v247 = [v235 workQueue];
    v248 = [v246 initWithDelegate:v235 queue:v247];
    v249 = v235[175];
    v235[175] = v248;

    [v235[175] setControllerEntityIdentifier:v21->_uuid];
    LODWORD(v246) = [v278 isCurrentUser];
    v250 = [v235[175] accessControl];
    [v250 setCurrentUserPrivilege:v246];

    v251 = [v235[175] accessControl];
    v252 = [v251 currentUserPrivilege] == 0;

    if (v252)
    {
      objc_initWeak(buf, v235);
      v280[0] = MEMORY[0x277D85DD0];
      v280[1] = 3221225472;
      v280[2] = __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke_670;
      v280[3] = &unk_279721F80;
      objc_copyWeak(&v281, buf);
      v253 = [v235[175] accessControl];
      [v253 setPrivilegeGetter:v280];

      objc_destroyWeak(&v281);
      objc_destroyWeak(buf);
    }
  }

  v235[187] = 0;
  v235[188] = 0;
  v254 = [MEMORY[0x277CCAD78] UUID];
  v255 = v235[178];
  v235[178] = v254;

  v256 = [MEMORY[0x277CBEB18] array];
  v257 = v235[179];
  v235[179] = v256;

  v258 = [v279 makeSwiftExtensionsWithHome:v235];
  v259 = v235[96];
  v235[96] = v258;

  objc_destroyWeak(&v283);
  objc_destroyWeak(&location);

LABEL_47:
  v260 = *MEMORY[0x277D85DE8];
  return v21;
}

void __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v7 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (v7)
  {
    [WeakRetained _registerForReachabilityChangeNotificationsEnabled:objc_msgSend(v7 completionHandler:{"BOOLValue"), v5}];
  }
}

unint64_t __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke_670(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained)
  {
    v3 = [WeakRetained currentUser];
    v4 = +[HMDUser hmmtrUserPrivilegeFromHMDUserPrivilege:](HMDUser, "hmmtrUserPrivilegeFromHMDUserPrivilege:", [v3 privilege]);
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (HMDHome)initWithName:(id)a3 uuid:(id)a4 defaultRoomUUID:(id)a5 owner:(id)a6 homeManager:(id)a7 presenceAuth:(id)a8 dataSource:(id)a9
{
  v15 = a9;
  v29 = a8;
  v16 = a7;
  v26 = a6;
  v17 = a5;
  v18 = a4;
  v19 = a3;
  v30 = [v16 metricsManager];
  v20 = [v30 logEventSubmitter];
  v25 = objc_alloc_init(HMDCarPlayDataSource);
  v24 = objc_alloc_init(HMDHomeLocalDeviceCapabilitiesDataSource);
  v21 = [MEMORY[0x277CCAB98] defaultCenter];
  v22 = [MEMORY[0x277CFEC78] systemStore];
  v28 = [(HMDHome *)self initWithName:v19 uuid:v18 defaultRoomUUID:v17 owner:v26 homeManager:v16 presenceAuth:v29 dataSource:v15 logEventSubmitter:v20 carPlayDataSource:v25 administratorHandlerFactory:&__block_literal_global_622 localCapabilitiesDataSource:v24 notificationCenter:v21 keychainStore:v22];

  return v28;
}

HMDHomeAdministratorHandler *__87__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [[HMDHomeAdministratorHandler alloc] initWithHome:v2];

  return v3;
}

uint64_t __58__HMDHome_filterAllowedToPostBulletinFromCharacteristics___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 service];
  v3 = [v2 accessory];
  v4 = [v3 home];
  v5 = [v4 shouldPostBulletin];

  return v5;
}

+ (id)logCategory
{
  if (logCategory__hmf_once_t1382 != -1)
  {
    dispatch_once(&logCategory__hmf_once_t1382, &__block_literal_global_1845);
  }

  v3 = logCategory__hmf_once_v1383;

  return v3;
}

uint64_t __22__HMDHome_logCategory__block_invoke()
{
  v0 = *MEMORY[0x277D0F1A8];
  logCategory__hmf_once_v1383 = HMFCreateOSLogHandle();

  return MEMORY[0x2821F96F8]();
}

+ (id)supportedAccessoryClasses
{
  if (supportedAccessoryClasses_onceToken != -1)
  {
    dispatch_once(&supportedAccessoryClasses_onceToken, &__block_literal_global_1756);
  }

  v3 = supportedAccessoryClasses_supportedAccessoryClasses;

  return v3;
}

void __36__HMDHome_supportedAccessoryClasses__block_invoke()
{
  v5[2] = *MEMORY[0x277D85DE8];
  v0 = MEMORY[0x277CBEB98];
  v5[0] = objc_opt_class();
  v5[1] = objc_opt_class();
  v1 = [MEMORY[0x277CBEA60] arrayWithObjects:v5 count:2];
  v2 = [v0 setWithArray:v1];
  v3 = supportedAccessoryClasses_supportedAccessoryClasses;
  supportedAccessoryClasses_supportedAccessoryClasses = v2;

  v4 = *MEMORY[0x277D85DE8];
}

+ (void)appendCharacteristicsToAccessoryList:(id)a3 responseTuples:(id)a4 forMultipleCharacteristicsRemoteRead:(id)a5
{
  v39 = *MEMORY[0x277D85DE8];
  v33 = a3;
  v30 = a4;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = a5;
  v7 = [obj countByEnumeratingWithState:&v34 objects:v38 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v35;
    v29 = *MEMORY[0x277CCFD28];
    do
    {
      v10 = 0;
      v31 = v8;
      do
      {
        if (*v35 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v34 + 1) + 8 * v10);
        v12 = [v11 characteristic];
        v13 = [v12 service];
        v14 = [v13 accessory];
        v15 = v14;
        if (v12)
        {
          v16 = v13 == 0;
        }

        else
        {
          v16 = 1;
        }

        if (v16 || v14 == 0)
        {
          v20 = [MEMORY[0x277CCA9B8] errorWithDomain:v29 code:4 userInfo:0];
          v18 = [HMDCharacteristicResponse responseWithRequest:v11 error:v20];
          [v30 addObject:v18];
        }

        else
        {
          v19 = [v14 uuid];
          v20 = [v19 UUIDString];

          v21 = [v33 hmf_mutableDictionaryForKey:v20];
          v18 = v21;
          if (!v21)
          {
            v18 = [MEMORY[0x277CBEB38] dictionary];
            [v33 setObject:v18 forKey:v20];
          }

          v22 = [v13 instanceID];
          v23 = [v22 stringValue];
          v24 = [v18 hmf_mutableArrayForKey:v23];

          if (!v24)
          {
            v24 = [MEMORY[0x277CBEB18] array];
            v25 = [v13 instanceID];
            v26 = [v25 stringValue];
            [v18 setObject:v24 forKey:v26];
          }

          v27 = [v12 instanceID];
          [v24 addObject:v27];

          v8 = v31;
        }

        ++v10;
      }

      while (v8 != v10);
      v8 = [obj countByEnumeratingWithState:&v34 objects:v38 count:16];
    }

    while (v8);
  }

  v28 = *MEMORY[0x277D85DE8];
}

+ (void)appendCharacteristicsToAccessoryList:(id)a3 responseTuples:(id)a4 forMultipleCharacteristicsRemoteWrite:(id)a5 message:(id)a6
{
  v64 = *MEMORY[0x277D85DE8];
  v53 = a3;
  v49 = a4;
  v9 = a5;
  v48 = a6;
  v59 = 0u;
  v60 = 0u;
  v61 = 0u;
  v62 = 0u;
  obj = v9;
  v10 = [v9 countByEnumeratingWithState:&v59 objects:v63 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v60;
    v46 = *MEMORY[0x277CCFD28];
    v13 = *MEMORY[0x277CD2120];
    v44 = *MEMORY[0x277CD2120];
    v45 = *MEMORY[0x277CD2050];
    v52 = *MEMORY[0x277CD2678];
    v47 = *v60;
    do
    {
      v14 = 0;
      v50 = v11;
      do
      {
        if (*v60 != v12)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v59 + 1) + 8 * v14);
        v16 = [v15 characteristic];
        v17 = [v16 service];
        v18 = [v17 accessory];
        v19 = v18;
        if (v16)
        {
          v20 = v17 == 0;
        }

        else
        {
          v20 = 1;
        }

        if (v20 || v18 == 0)
        {
          v22 = [MEMORY[0x277CCA9B8] errorWithDomain:v46 code:4 userInfo:0];
          v23 = [HMDCharacteristicResponse responseWithRequest:v15 error:v22];
          [v49 addObject:v23];
        }

        else
        {
          v24 = [v18 uuid];
          v25 = [v24 UUIDString];

          v26 = [v17 instanceID];
          v27 = [v26 stringValue];

          v28 = [v16 instanceID];
          v58 = [v28 stringValue];

          v29 = [v53 hmf_mutableDictionaryForKey:v25];
          v30 = v29;
          if (!v29)
          {
            v30 = [MEMORY[0x277CBEB38] dictionary];
            [v53 setObject:v30 forKeyedSubscript:v25];
          }

          v57 = v25;
          v31 = [v30 hmf_mutableDictionaryForKey:v27];
          if (!v31)
          {
            v31 = [MEMORY[0x277CBEB38] dictionary];
            [v30 setObject:v31 forKeyedSubscript:v27];
          }

          v55 = v30;
          v56 = v27;
          v32 = [v16 authorizationData];
          if (v32)
          {
            v33 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v58, @"kAuthorizationDataKey"];
            [v31 setObject:v32 forKeyedSubscript:v33];
          }

          v54 = v32;
          v34 = [v19 home];
          v35 = [v34 currentUser];
          v36 = [v35 notificationContextHAPIdentifier];
          v37 = [v16 contextDataForWriteRequestWithIdentifier:v36];

          if (v37)
          {
            v38 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v58, v44];
            [v31 setObject:v37 forKeyedSubscript:v38];
          }

          v39 = [v48 uuidForKey:v45];
          v40 = [v48 BOOLForKey:v52];
          if (v39 || v40)
          {
            [v53 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:v52];
          }

          v41 = [v15 value];
          [v31 setObject:v41 forKeyedSubscript:v58];

          v42 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v15, "includeResponseValue")}];
          [v31 setObject:v42 forKeyedSubscript:@"HMDCharacteristicWriteRequestIncludeResponseValueKey"];

          v12 = v47;
          v23 = v56;
          v22 = v57;
          v11 = v50;
        }

        ++v14;
      }

      while (v11 != v14);
      v11 = [obj countByEnumeratingWithState:&v59 objects:v63 count:16];
    }

    while (v11);
  }

  v43 = *MEMORY[0x277D85DE8];
}

+ (id)notificationPayloadForChangedCharacteristics:(id)a3 destinationIsXPCTransport:(BOOL)a4
{
  v69 = a4;
  v84 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v59 = [MEMORY[0x277CBEB38] dictionary];
  v5 = +[HMDHAPMetadata getSharedInstance];
  v73 = 0u;
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  obj = v4;
  v6 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
  if (v6)
  {
    v8 = v6;
    v9 = *v74;
    v56 = *MEMORY[0x277CD21B8];
    v53 = *MEMORY[0x277CD21E0];
    v51 = *MEMORY[0x277CD2150];
    v52 = *MEMORY[0x277CD21D0];
    v55 = *MEMORY[0x277CD2110];
    *&v7 = 138543618;
    v49 = v7;
    v67 = v5;
    v63 = *v74;
    do
    {
      v10 = 0;
      v65 = v8;
      do
      {
        if (*v74 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v73 + 1) + 8 * v10);
        v12 = [v11 characteristic];
        v13 = [v12 service];
        v14 = [v13 accessory];
        v15 = [v14 home];
        v16 = v15;
        if (v12)
        {
          v17 = v13 == 0;
        }

        else
        {
          v17 = 1;
        }

        if (!v17 && v14 != 0 && v15 != 0)
        {
          v20 = [v11 updatedValue];
          v21 = v20;
          if (v20)
          {
            v22 = !v69;
          }

          else
          {
            v22 = 1;
          }

          if (!v22)
          {
            v23 = v20;
            objc_opt_class();
            isKindOfClass = objc_opt_isKindOfClass();

            if (isKindOfClass)
            {
              goto LABEL_44;
            }

LABEL_24:
            if (v69)
            {
              v25 = [v12 type];
              if ([v67 shouldFilterCharacteristicOfTypeFromApp:v25])
              {

                goto LABEL_44;
              }

              v26 = [v13 type];
              v27 = [v67 shouldFilterServiceOfTypeFromApp:v26];

              if (v27)
              {
                goto LABEL_44;
              }
            }

            v28 = [v14 uuid];
            v29 = [v28 UUIDString];

            v30 = [v59 hmf_mutableDictionaryForKey:v29];
            if (!v30)
            {
              v30 = [MEMORY[0x277CBEB38] dictionary];
              [v59 setObject:v30 forKey:v29];
            }

            v62 = v29;
            v31 = [v13 instanceID];
            v32 = [v31 stringValue];
            v61 = v30;
            v33 = [v30 hmf_mutableDictionaryForKey:v32];

            v34 = v33;
            if (!v33)
            {
              v34 = [MEMORY[0x277CBEB38] dictionary];
              v35 = [v13 instanceID];
              v36 = [v35 stringValue];
              [v61 setObject:v34 forKey:v36];
            }

            v81 = v56;
            v82 = v21;
            v37 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v82 forKeys:&v81 count:1];
            v38 = [v37 mutableCopy];

            v71 = 0;
            v72 = 0;
            v70 = 0;
            [v12 getLastKnownValueUpdateTime:&v72 stateNumber:&v71 notificationContext:&v70];
            v39 = v72;
            v64 = v71;
            v68 = v70;
            if (v39)
            {
              [v38 setObject:v39 forKey:v53];
            }

            v60 = v39;
            if (v64)
            {
              [v38 setObject:v64 forKey:v52];
            }

            if (v68)
            {
              v58 = v34;
              context = objc_autoreleasePoolPush();
              v40 = a1;
              v41 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
              {
                v50 = HMFGetLogIdentifier();
                *buf = v49;
                v78 = v50;
                v79 = 2112;
                v80 = v68;
                _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Setting notification context in notification payload to %@ ", buf, 0x16u);
              }

              objc_autoreleasePoolPop(context);
              [v38 setObject:v68 forKey:v51];
              v34 = v58;
            }

            v42 = [v11 isBroadcast];
            v43 = MEMORY[0x277CBEC38];
            if ((v42 & 1) != 0 || (v44 = [v14 isBLELinkConnected], v43 = MEMORY[0x277CBEC28], v44))
            {
              [v38 setObject:v43 forKey:v55];
            }

            v45 = [v12 instanceID];
            v46 = [v45 stringValue];
            [v34 setObject:v38 forKey:v46];

            goto LABEL_44;
          }

          if (v20)
          {
            goto LABEL_24;
          }

LABEL_44:

          v5 = v67;
          v9 = v63;
          v8 = v65;
        }

        ++v10;
      }

      while (v8 != v10);
      v8 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
    }

    while (v8);
  }

  v47 = *MEMORY[0x277D85DE8];

  return v59;
}

+ (unint64_t)privilegeFromUserInviteInformation:(id)a3
{
  if ([a3 isAdministrator])
  {
    return 4;
  }

  else
  {
    return 0;
  }
}

+ (id)filterUsersSupportingPresence:(id)a3
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v4 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v3, "count")}];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v5 = v3;
  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v13 + 1) + 8 * i);
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          [v4 addObject:{v10, v13}];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return v4;
}

+ (id)shortDescription
{
  v2 = objc_opt_class();

  return NSStringFromClass(v2);
}

+ (id)zoneIDFromHomeUUID:(id)a3
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = MEMORY[0x277CCAD78];
  v10 = *MEMORY[0x277CD23C8];
  v4 = MEMORY[0x277CBEA60];
  v5 = a3;
  v6 = [v4 arrayWithObjects:&v10 count:1];
  v7 = [v3 hm_deriveUUIDFromBaseUUID:v5 identifierSalt:0 withSalts:{v6, v10, v11}];

  v8 = *MEMORY[0x277D85DE8];

  return v7;
}

+ (BOOL)isObjectContainedInHome:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a3;
  +[HMDHome _initialize];
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  v4 = allowedClasses;
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = *v12;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v11 + 1) + 8 * i);
        if (objc_opt_isKindOfClass())
        {
          LOBYTE(v5) = 1;
          goto LABEL_11;
        }
      }

      v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v5)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v9 = *MEMORY[0x277D85DE8];
  return v5;
}

+ (id)getBuiltinActionSets
{
  if (getBuiltinActionSets_onceToken != -1)
  {
    dispatch_once(&getBuiltinActionSets_onceToken, &__block_literal_global_616);
  }

  v3 = getBuiltinActionSets_builtinActionSets;

  return v3;
}

void __31__HMDHome_getBuiltinActionSets__block_invoke()
{
  v9[4] = *MEMORY[0x277D85DE8];
  v0 = *MEMORY[0x277CCF148];
  v1 = *MEMORY[0x277CCF198];
  v8[0] = *MEMORY[0x277CCF1B0];
  v8[1] = v1;
  v2 = *MEMORY[0x277CCF140];
  v9[0] = v0;
  v9[1] = v2;
  v3 = *MEMORY[0x277CCF188];
  v8[2] = *MEMORY[0x277CCF180];
  v8[3] = v3;
  v4 = *MEMORY[0x277CCF138];
  v9[2] = *MEMORY[0x277CCF130];
  v9[3] = v4;
  v5 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:v8 count:4];
  v6 = getBuiltinActionSets_builtinActionSets;
  getBuiltinActionSets_builtinActionSets = v5;

  v7 = *MEMORY[0x277D85DE8];
}

+ (void)_initialize
{
  if (_initialize_onceToken != -1)
  {
    dispatch_once(&_initialize_onceToken, &__block_literal_global_10958);
  }
}

void __22__HMDHome__initialize__block_invoke()
{
  v16 = *MEMORY[0x277D85DE8];
  v0 = MEMORY[0x277CBEB98];
  v5 = objc_opt_class();
  v6 = objc_opt_class();
  v7 = objc_opt_class();
  v8 = objc_opt_class();
  v9 = objc_opt_class();
  v10 = objc_opt_class();
  v11 = objc_opt_class();
  v12 = objc_opt_class();
  v13 = objc_opt_class();
  v14 = objc_opt_class();
  v15 = objc_opt_class();
  v1 = [MEMORY[0x277CBEA60] arrayWithObjects:&v5 count:11];
  v2 = [v0 setWithArray:{v1, v5, v6, v7, v8, v9, v10, v11, v12, v13, v14}];
  v3 = allowedClasses;
  allowedClasses = v2;

  v4 = *MEMORY[0x277D85DE8];
}

- (void)_notifyThreadLayerOfResidentChange
{
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = [(HMDHome *)self home];
  if (v4)
  {
    v12 = v4;
    if ([v4 isCurrentDeviceAvailableResident])
    {
      v5 = +[HMDThreadResidentCommissioner sharedCommissioner];
      v6 = [v12 primaryResident];
      v7 = [v6 isCurrentDevice];
      v8 = [v12 primaryResident];
      v9 = [v8 capabilities];
      [v5 informThreadLayerOfResidentChange:v7 primaryResidentIsThreadCapable:{objc_msgSend(v9, "supportsThreadBorderRouter")}];

      if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
      {
        v10 = [(HMDHome *)self threadOperationalDataset];

        if (v10)
        {
          v11 = [(HMDHome *)self threadOperationalDataset];
          [(HMDHome *)self saveAndSyncWithThreadOperationalDataset:v11 forceUpdate:1];
        }
      }
    }
  }

  MEMORY[0x2821F96F8]();
}

- (void)_updateThreadNetworkWithModel:(id)a3 message:(id)a4
{
  v32 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v6 setProperties];
  v9 = [v8 containsObject:@"threadNetworkID"];

  if (!v9)
  {
LABEL_13:
    [v7 respondWithPayload:0];
    goto LABEL_14;
  }

  v10 = [(HMDHome *)self unfilteredThreadNetworkID];
  v11 = [v6 threadNetworkID];
  v12 = [(HMDHome *)self threadNetworkID];

  if (!v12)
  {
    v18 = [v7 transactionResult];
    v19 = [v18 source];

    if (v19 == 2 && v11 && [(HMDHome *)self attemptToUpdateThreadNetworkID:v11])
    {
      v20 = objc_autoreleasePoolPush();
      v21 = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v23;
        v28 = 2112;
        v29 = v10;
        v30 = 2112;
        v31 = v11;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@threadNetworkID updated from cloud: %@ -> %@", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v20);
      [(HMDHome *)v21 startThreadNetwork:0];
    }

    v24 = [v7 transactionResult];
    [v24 markChanged];

    goto LABEL_13;
  }

  v13 = objc_autoreleasePoolPush();
  v14 = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
  {
    v16 = HMFGetLogIdentifier();
    v26 = 138543874;
    v27 = v16;
    v28 = 2112;
    v29 = v10;
    v30 = 2112;
    v31 = v11;
    _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Ignoring threadNetworkID update from cloud: %@ -> %@", &v26, 0x20u);
  }

  objc_autoreleasePoolPop(v13);
  v17 = [v7 transactionResult];
  [v17 markChanged];

  [v7 respondWithPayload:0];
LABEL_14:

  v25 = *MEMORY[0x277D85DE8];
}

- (void)saveAndSyncWithThreadOperationalDataset:(id)a3 forceUpdate:(BOOL)a4
{
  v37 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = [(HMDHome *)self home];
  v8 = v7;
  if (v6)
  {
    v9 = [v7 residentDeviceManager];
    v10 = [v9 residentDevices];
    if ([v10 count] && !-[HMDHome isCurrentDeviceConfirmedPrimaryResident](self, "isCurrentDeviceConfirmedPrimaryResident"))
    {
      v26 = objc_autoreleasePoolPush();
      v27 = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
      {
        v29 = HMFGetLogIdentifier();
        *buf = 138543618;
        v34 = v29;
        v35 = 2112;
        v36 = v8;
        _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@There are residents for home: %@, but we are not the primary. Updated locally but not syncing ThreadOperationalDataset.", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v26);
      [(HMDHome *)v27 setThreadOperationalDataset:v6];
      goto LABEL_19;
    }

    v11 = [(HMDHome *)self threadOperationalDataset];
    v12 = HMFEqualObjects();

    if (v12)
    {
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      v16 = os_log_type_enabled(v15, OS_LOG_TYPE_INFO);
      if (!a4)
      {
        if (v16)
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543362;
          v34 = v30;
          _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Thread operational dataset has not changed, ignoring request to save and sync", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v13);
        goto LABEL_19;
      }

      if (v16)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v34 = v17;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Thread operational dataset has not changed, but pushing out update because forceUpdate is true", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
    }

    v18 = [(HMDHome *)self emptyModelObjectWithChangeType:2];
    [v18 setThreadOperationalDataset:v6];
    [(HMDHome *)self setThreadOperationalDataset:v6];
    v19 = [(HMDHome *)self backingStore];
    v20 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v21 = [v19 transaction:@"Update thread operational dataset" options:v20];

    [v21 add:v18];
    v32[0] = MEMORY[0x277D85DD0];
    v32[1] = 3221225472;
    v32[2] = __92__HMDHome_ThreadResidentCommissioning__saveAndSyncWithThreadOperationalDataset_forceUpdate___block_invoke;
    v32[3] = &unk_2797359D8;
    v32[4] = self;
    [v21 run:v32];
    [(HMDHome *)self setThreadOperationalDataset:v6];

LABEL_19:
    goto LABEL_20;
  }

  v22 = objc_autoreleasePoolPush();
  v23 = self;
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
  {
    v25 = HMFGetLogIdentifier();
    *buf = 138543618;
    v34 = v25;
    v35 = 2112;
    v36 = v8;
    _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@threadOperationalDataset is null for home %@, not saving...", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v22);
LABEL_20:

  v31 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome_ThreadResidentCommissioning__saveAndSyncWithThreadOperationalDataset_forceUpdate___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to sync thread operational dataset, error: %@", &v12, 0x16u);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [*(a1 + 32) threadOperationalDataset];
    v12 = 138543618;
    v13 = v9;
    v14 = 2048;
    v15 = [v10 length];
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Successfully sync'ed thread operational dataset, Length: %lu", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
}

- (void)updateThreadOperationalDatasetWithHomeModel:(id)a3 message:(id)a4
{
  v19 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    v8 = [v6 threadOperationalDataset];
    [(HMDHome *)self setThreadOperationalDataset:v8];

    v9 = objc_autoreleasePoolPush();
    v10 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [(HMDHome *)v10 threadOperationalDataset];
      v15 = 138543618;
      v16 = v12;
      v17 = 2048;
      v18 = [v13 length];
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Updated thread operational dataset, Length: %lu", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)stopThreadAccessoryFirmwareUpdateWithCompletion:(id)a3
{
  v3 = a3;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v4 = objc_claimAutoreleasedReturnValue(), v5 = [v4 supportsThreadService], v4, (v5 & 1) != 0))
  {
    v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __88__HMDHome_ThreadResidentCommissioning__stopThreadAccessoryFirmwareUpdateWithCompletion___block_invoke;
    v7[3] = &unk_279735558;
    v8 = v3;
    [v6 stopThreadAccessoryFirmwareUpdateWithCompletion:v7];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(v3 + 2))(v3, v6);
  }
}

- (void)stopThreadAccessoryPairingWithCompletion:(id)a3
{
  v3 = a3;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v4 = objc_claimAutoreleasedReturnValue(), v5 = [v4 supportsThreadService], v4, (v5 & 1) != 0))
  {
    v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __81__HMDHome_ThreadResidentCommissioning__stopThreadAccessoryPairingWithCompletion___block_invoke;
    v7[3] = &unk_279735558;
    v8 = v3;
    [v6 stopThreadAccessoryPairingWithCompletion:v7];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(v3 + 2))(v3, v6);
  }
}

- (void)onThreadNetworkCallStateChange:(BOOL)a3
{
  v11 = *MEMORY[0x277D85DE8];
  if (!a3 && [(HMDHome *)self threadNetworkShouldRestartOnNetworkChange])
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Restarting thread network after call end", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [(HMDHome *)v5 startThreadNetwork:1];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)onThreadNetworkPeripheralDeviceNodeTypeChange:(id)a3
{
  v3 = MEMORY[0x277CCAB98];
  v4 = a3;
  v5 = [v3 defaultCenter];
  [v5 postNotificationName:@"HMDHomeThreadNetworkPeripheralDeviceNodeTypeChangedNotification" object:v4];
}

- (void)onThreadNetworkWakeOnDeviceConnectionStateChange:(id)a3
{
  v3 = MEMORY[0x277CCAB98];
  v4 = a3;
  v5 = [v3 defaultCenter];
  [v5 postNotificationName:@"HMDHomeThreadNetworkWakeOnConnectionStateChangeNotification" object:v4];
}

- (void)onThreadNetworkNodeTypeStateChange:(int64_t)a3
{
  v15 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self threadNetworkNodeType]!= a3)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2048;
      v14 = a3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread network node type changed to %ld", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 setThreadNetworkNodeType:a3];
    v9 = [MEMORY[0x277CCAB98] defaultCenter];
    [v9 postNotificationName:@"HMDHomeThreadNetworkNodeTypeChangeNotification" object:v6];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)onThreadNetworkConnectionStateChange:(int64_t)a3
{
  v15 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self threadNetworkConnectionState]!= a3)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2048;
      v14 = a3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread network connection state changed to %ld", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 setThreadNetworkConnectionState:a3];
    v9 = [MEMORY[0x277CCAB98] defaultCenter];
    [v9 postNotificationName:@"HMDHomeThreadNetworkConnectionStateChangeNotification" object:v6];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)connectToThreadAccessoryWithExtendedMACAddress:(id)a3 completion:(id)a4
{
  v5 = a3;
  v6 = a4;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v7 = objc_claimAutoreleasedReturnValue(), v8 = [v7 supportsThreadService], v7, (v8 & 1) != 0))
  {
    v9 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __98__HMDHome_ThreadResidentCommissioning__connectToThreadAccessoryWithExtendedMACAddress_completion___block_invoke;
    v10[3] = &unk_279735558;
    v11 = v6;
    [v9 connectToThreadAccessoryWithExtendedMACAddress:v5 completion:v10];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(v6 + 2))(v6, v9);
  }
}

- (void)_unjoinThreadNetworkWithCompletion:(id)a3
{
  v19 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [(HMDHome *)v7 threadNetworkID];
    *buf = 138543618;
    v16 = v9;
    v17 = 2112;
    v18 = v10;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Request to unjoin previous thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  [(HMDHome *)v7 setThreadNetworkID:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __75__HMDHome_ThreadResidentCommissioning___unjoinThreadNetworkWithCompletion___block_invoke;
  v13[3] = &unk_279733F30;
  v13[4] = v7;
  v14 = v4;
  v11 = v4;
  [(HMDHome *)v7 _stopThreadNetworkWithCompletion:v13];

  v12 = *MEMORY[0x277D85DE8];
}

void __75__HMDHome_ThreadResidentCommissioning___unjoinThreadNetworkWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v8;
      v18 = 2112;
      v19 = v3;
      v9 = "%{public}@Failed to leave previous thread network: %@";
      v10 = v7;
      v11 = OS_LOG_TYPE_ERROR;
      v12 = 22;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v10, v11, v9, &v16, v12);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    v9 = "%{public}@Successfully left previous thread network";
    v10 = v7;
    v11 = OS_LOG_TYPE_DEFAULT;
    v12 = 12;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v4);
  (*(*(a1 + 40) + 16))(*(a1 + 40), v3, v13, v14);

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_stopThreadNetworkWithCompletion:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  [(HMDHome *)self setThreadNetworkShouldRestartOnNetworkChange:0];
  [(HMDHome *)self _incrementCurrentSequenceNumber];
  [(HMDHome *)self _unregisterForThreadNetworkEvents];
  v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __73__HMDHome_ThreadResidentCommissioning___stopThreadNetworkWithCompletion___block_invoke;
  v8[3] = &unk_279735558;
  v9 = v4;
  v7 = v4;
  [v6 stopThreadNetworkWithCompletion:v8];
}

- (void)stopThreadNetworkWithCompletion:(BOOL)a3 completion:(id)a4
{
  v5 = a4;
  v6 = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke;
  v8[3] = &unk_279735738;
  v8[4] = self;
  v9 = v5;
  v7 = v5;
  dispatch_async(v6, v8);
}

void __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 32) threadNetworkID];
    *buf = 138543618;
    v12 = v5;
    v13 = 2112;
    v14 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Stop thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = *(a1 + 32);
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke_61;
  v9[3] = &unk_279733F30;
  v9[4] = v7;
  v10 = *(a1 + 40);
  [v7 _stopThreadNetworkWithCompletion:v9];

  v8 = *MEMORY[0x277D85DE8];
}

void __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke_61(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = v3;
    v9 = "%{public}@Failed to stop thread network: %@";
    v10 = v7;
    v11 = OS_LOG_TYPE_ERROR;
    v12 = 22;
  }

  else
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    v9 = "%{public}@Successfully stopped thread network";
    v10 = v7;
    v11 = OS_LOG_TYPE_DEFAULT;
    v12 = 12;
  }

  _os_log_impl(&dword_2531F8000, v10, v11, v9, &v16, v12);

LABEL_7:
  objc_autoreleasePoolPop(v4);
  v13 = _Block_copy(*(a1 + 40));
  v14 = v13;
  if (v13)
  {
    (*(v13 + 2))(v13);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkWithCompletion:(id)a3
{
  v5 = a3;
  v4 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v4);

  [(HMDHome *)self _startThreadNetworkOnControllerWithCompletion:v5];
}

- (void)_startThreadNetworkOnResidentWithCompletion:(id)a3
{
  v14 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v8;
    v12 = 2112;
    v13 = v6;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread start starting for home %@ using ThreadUUID", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  [(HMDHome *)v6 setStartThreadNetworkInProgress:1];
  [(HMDHome *)v6 _startThreadNetworkOnCommissionerWithCompletion:v4];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkOnControllerWithCompletion:(id)a3
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled())
  {
    v5 = objc_autoreleasePoolPush();
    v6 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2112;
      v14 = v6;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread start starting for home %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 setStartThreadNetworkInProgress:1];
    [(HMDHome *)v6 setThreadNetworkShouldRestartOnNetworkChange:1];
    [(HMDHome *)v6 _fetchThreadCredentialsAndStartThreadNetworkWithCompletion:v4];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    v4[2](v4, v9);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_fetchThreadCredentialsAndStartThreadNetworkWithCompletion:(id)a3
{
  v4 = a3;
  v20[0] = 0;
  v20[1] = v20;
  v20[2] = 0x2020000000;
  v21 = 0;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke;
  aBlock[3] = &unk_279731E18;
  objc_copyWeak(&v18, &location);
  v17 = v20;
  v5 = v4;
  v16 = v5;
  v6 = _Block_copy(aBlock);
  if (![(HMDHome *)self _overrideStartThreadTimeout])
  {
    v7 = dispatch_time(0, 20000000000);
    v8 = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_2;
    block[3] = &unk_2797348C0;
    v14 = v6;
    dispatch_after(v7, v8, block);
  }

  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_3;
  v10[3] = &unk_279734508;
  objc_copyWeak(&v12, &location);
  v9 = v6;
  v11 = v9;
  [(HMDHome *)self _retrievePreferredNetworkWithCompletion:v10];

  objc_destroyWeak(&v12);
  objc_destroyWeak(&v18);
  objc_destroyWeak(&location);
  _Block_object_dispose(v20, 8);
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v42 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (v3)
  {
    if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
    {
      v5 = objc_autoreleasePoolPush();
      v6 = WeakRetained;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543874;
        v37 = v8;
        v38 = 2112;
        v39 = v6;
        v40 = 2112;
        v41 = v3;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Error starting thread for home %@, resetting state: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v5);
      if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
      {
        v9 = objc_autoreleasePoolPush();
        v10 = v6;
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          v12 = HMFGetLogIdentifier();
          *buf = 138543874;
          v37 = v12;
          v38 = 2112;
          v39 = v10;
          v40 = 2112;
          v41 = v3;
          _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Thread start completed for home %@, error = %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v9);
        [v10 setStartThreadNetworkInProgress:0];
        *(*(*(a1 + 40) + 8) + 24) = 1;
        v13 = [v10 workQueue];
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_59;
        block[3] = &unk_279735738;
        v31 = *(a1 + 32);
        v30 = v3;
        dispatch_async(v13, block);

        v14 = v31;
LABEL_18:
      }
    }
  }

  else
  {
    if (!*(*(*(a1 + 40) + 8) + 24))
    {
      goto LABEL_13;
    }

    v15 = objc_autoreleasePoolPush();
    v16 = WeakRetained;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v18;
      v38 = 2112;
      v39 = v16;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Starting thread took longer than expected for home %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
    {
LABEL_13:
      v19 = [WeakRetained threadOperationalDataset];

      if (v19)
      {
        v20 = [WeakRetained threadOperationalDataset];
        v34[0] = MEMORY[0x277D85DD0];
        v34[1] = 3221225472;
        v34[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_56;
        v34[3] = &unk_27972D6C8;
        v34[4] = WeakRetained;
        v28 = *(a1 + 32);
        v21 = v28;
        v35 = v28;
        [WeakRetained _startThreadNetworkOnCommissionerWithOperationalDataset:v20 completion:v34];

        v14 = v35;
      }

      else
      {
        v22 = objc_autoreleasePoolPush();
        v23 = WeakRetained;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          *buf = 138543618;
          v37 = v25;
          v38 = 2112;
          v39 = v23;
          _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Thread operational dataset not available. Cancelling thread start for home %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v22);
        [v23 setStartThreadNetworkInProgress:0];
        *(*(*(a1 + 40) + 8) + 24) = 1;
        v26 = [v23 workQueue];
        v32[0] = MEMORY[0x277D85DD0];
        v32[1] = 3221225472;
        v32[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_58;
        v32[3] = &unk_2797348C0;
        v33 = *(a1 + 32);
        dispatch_async(v26, v32);

        v14 = v33;
      }

      goto LABEL_18;
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_2(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:8];
  (*(v1 + 16))(v1, v2);
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_3(uint64_t a1, void *a2)
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = WeakRetained;
  if (v3 || !WeakRetained)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = v5;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v9;
      v30 = 2112;
      v31 = v3;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve preferred thread network: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v10 = [v7 threadOperationalDataset];

    if (!v10)
    {
      v24 = *(a1 + 32);
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      (*(v24 + 16))(v24, v25);

      goto LABEL_12;
    }

    v11 = objc_autoreleasePoolPush();
    v12 = v7;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v12 threadOperationalDataset];
      v16 = [v12 threadNetworkID];
      v17 = [v12 home];
      *buf = 138544130;
      v29 = v14;
      v30 = 2112;
      v31 = v15;
      v32 = 2112;
      v33 = v16;
      v34 = 2112;
      v35 = v17;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Using cached threadOperationalDataset %@ and uuid %@ from home %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v11);
  }

  v18 = objc_autoreleasePoolPush();
  v19 = v5;
  v20 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
  {
    v21 = HMFGetLogIdentifier();
    *buf = 138543618;
    v29 = v21;
    v30 = 2112;
    v31 = v19;
    _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Successfully fetched preferred network, scheduling startThread for home %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v18);
  v22 = [v19 workQueue];
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_60;
  v26[3] = &unk_279735738;
  v26[4] = v19;
  v27 = *(a1 + 32);
  dispatch_async(v22, v26);

LABEL_12:
  v23 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_60(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) startThreadNetworkInProgress])
  {
    v2 = *(*(a1 + 40) + 16);
    v3 = *MEMORY[0x277D85DE8];

    v2();
  }

  else
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 32);
      v12 = 138543618;
      v13 = v7;
      v14 = 2112;
      v15 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Thread network stop was requested by the time preferred network was fetched to start Thread for home %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    (*(v9 + 16))(v9, v10);

    v11 = *MEMORY[0x277D85DE8];
  }
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_56(uint64_t a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543618;
      v21 = v7;
      v22 = 2112;
      v23 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Unable to start thread with operational dataset: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 32);
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    *buf = 138543874;
    v21 = v11;
    v22 = 2112;
    v23 = v12;
    v24 = 2112;
    v25 = v3;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Thread start completed for home %@, error = %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  *(*(*(a1 + 48) + 8) + 24) = 1;
  v13 = [*(a1 + 32) workQueue];
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_57;
  v17[3] = &unk_279735738;
  v14 = *(a1 + 40);
  v18 = v3;
  v19 = v14;
  v15 = v3;
  dispatch_async(v13, v17);

  v16 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_58(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
  (*(v1 + 16))(v1, v2);
}

- (void)_retrievePreferredNetworkOnControllerWithCompletion:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v27 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve request for Thread Network Credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = +[HMDThreadNetworkMetadataStore defaultStore];
  if (v9)
  {
    if ([(HMDHome *)v6 isOwnerUser])
    {
      objc_initWeak(buf, v6);
      v10 = [(HMDHome *)v6 threadOperationalDataset];
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __92__HMDHome_ThreadResidentCommissioning___retrievePreferredNetworkOnControllerWithCompletion___block_invoke;
      v23[3] = &unk_27972A918;
      objc_copyWeak(&v25, buf);
      v24 = v4;
      [v9 retrievePreferredNetwork:v10 completion:v23];

      objc_destroyWeak(&v25);
      objc_destroyWeak(buf);
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = v6;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        v20 = [(HMDHome *)v17 threadOperationalDataset];
        v21 = [(HMDHome *)v17 home];
        *buf = 138543874;
        v27 = v19;
        v28 = 2112;
        v29 = v20;
        v30 = 2112;
        v31 = v21;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Shared user -  always use cached threadOperationalDataset %@ for home %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v16);
      (*(v4 + 2))(v4, 0);
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = v6;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v27 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:58];
    (*(v4 + 2))(v4, v15);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome_ThreadResidentCommissioning___retrievePreferredNetworkOnControllerWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5)
{
  v40 = *MEMORY[0x277D85DE8];
  v9 = a2;
  v10 = a3;
  v11 = a4;
  v12 = a5;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v14 = objc_autoreleasePoolPush();
  v15 = WeakRetained;
  if (!v12 && v9 && WeakRetained)
  {
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138544130;
      v33 = v17;
      v34 = 2112;
      v35 = v9;
      v36 = 2112;
      v37 = v10;
      v38 = 2112;
      v39 = v11;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Successfully retrieved preferred thread credentials %@ with UUID %@ and operationalDataset %@ from network metadata store", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v14);
    if (v11)
    {
      v18 = [v11 copy];
      [v15 saveAndSyncWithThreadOperationalDataset:v18];

      v19 = objc_autoreleasePoolPush();
      v20 = v15;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v22 = v30 = v9;
        [v20 threadOperationalDataset];
        v23 = v29 = v10;
        [v20 home];
        v24 = v31 = v19;
        *buf = 138543874;
        v33 = v22;
        v34 = 2112;
        v35 = v23;
        v36 = 2112;
        v37 = v24;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@threadOperationalDataset set to %@ for home %@", buf, 0x20u);

        v19 = v31;
        v10 = v29;

        v9 = v30;
      }

      objc_autoreleasePoolPop(v19);
    }

    if (v10)
    {
      v25 = [v10 copy];
      [v15 setThreadNetworkID:v25];
    }
  }

  else
  {
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v27;
      v34 = 2112;
      v35 = v12;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
  }

  (*(*(a1 + 32) + 16))();

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkOnCommissionerWithOperationalDataset:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v8);

  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke;
  aBlock[3] = &unk_27972F8D8;
  aBlock[4] = self;
  v9 = v6;
  v19 = v9;
  v10 = v7;
  v20 = v10;
  v11 = _Block_copy(aBlock);
  v12 = [(HMDHome *)self homeManager];
  v13 = [v12 chipDataSource];

  if (v13)
  {
    v14 = [(HMDHome *)self home];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_53;
    v16[3] = &unk_279732788;
    v17 = v11;
    [v13 hasValidGeoOrPreferredNetworkForHome:v14 completion:v16];

    v15 = v17;
  }

  else
  {
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(v11 + 2))(v11, 0, v15);
  }
}

void __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [*(a1 + 32) threadNetworkID];
    v11 = *(a1 + 40);
    v12 = HMFBooleanToString();
    *buf = 138544386;
    v22 = v9;
    v23 = 2112;
    v24 = v10;
    v25 = 2112;
    v26 = v11;
    v27 = 2112;
    v28 = v12;
    v29 = 2112;
    v30 = v5;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Start thread network with uuid: %@, credentials: %@, geoAvailable: %@, error %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v6);
  v13 = +[HMDThreadResidentCommissioner sharedCommissioner];
  [v13 setGeoAvailable:a2];
  v14 = *(a1 + 40);
  v15 = [*(a1 + 32) isOwnerUser];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_50;
  v18[3] = &unk_279735168;
  v16 = *(a1 + 40);
  v18[4] = *(a1 + 32);
  v19 = v16;
  v20 = *(a1 + 48);
  [v13 startThreadNetworkWithOperationalDataset:v14 threadNetworkID:@"770E5B2E-0A0D-0A0D-0A0D-EE86505EFF8F" isOwnerUser:v15 completion:v18];

  v17 = *MEMORY[0x277D85DE8];
}

void __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_50(uint64_t a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [*(a1 + 32) threadNetworkID];
      v9 = *(a1 + 40);
      *buf = 138544130;
      v19 = v7;
      v20 = 2112;
      v21 = v8;
      v22 = 2112;
      v23 = v9;
      v24 = 2112;
      v25 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to attach to thread network %@ with operational data set%@: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
  }

  v10 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_51;
  block[3] = &unk_2797355D0;
  v11 = *(a1 + 32);
  v15 = v3;
  v16 = v11;
  v17 = *(a1 + 48);
  v12 = v3;
  dispatch_async(v10, block);

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_51(uint64_t a1)
{
  v11 = *MEMORY[0x277D85DE8];
  if (!*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v5;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Attached to thread network using operational dataset", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) setThreadNetworkID:@"770E5B2E-0A0D-0A0D-0A0D-EE86505EFF8F"];
  }

  [*(a1 + 40) _registerForThreadNetworkEvents];
  [*(a1 + 40) setStartThreadNetworkInProgress:0];
  [*(a1 + 40) _scheduleThreadNetworkUpdate];
  v6 = *(a1 + 32);
  result = (*(*(a1 + 48) + 16))();
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_startThreadNetworkOnCommissionerWithCompletion:(id)a3
{
  v28 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v18 = 0;
  v19 = &v18;
  v20 = 0x3032000000;
  v21 = __Block_byref_object_copy__14888;
  v22 = __Block_byref_object_dispose__14889;
  v23 = [(HMDHome *)self threadNetworkID];
  v6 = objc_autoreleasePoolPush();
  v7 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    v9 = HMFGetLogIdentifier();
    v10 = v19[5];
    *buf = 138543618;
    v25 = v9;
    v26 = 2112;
    v27 = v10;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Start thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = +[HMDThreadResidentCommissioner sharedCommissioner];
  v12 = v19[5];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke;
  v15[3] = &unk_279723440;
  v15[4] = v7;
  v13 = v4;
  v16 = v13;
  v17 = &v18;
  [v11 startThreadNetworkWithID:v12 completion:v15];

  _Block_object_dispose(&v18, 8);
  v14 = *MEMORY[0x277D85DE8];
}

void __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v38 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = *(*(*(a1 + 48) + 8) + 40);
    if (v7 && ![v7 isEqualToString:v5])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_12;
      }

      v11 = HMFGetLogIdentifier();
      v24 = *(*(*(a1 + 48) + 8) + 40);
      *buf = 138543874;
      v33 = v11;
      v34 = 2112;
      v35 = v5;
      v36 = 2112;
      v37 = v24;
      v12 = "%{public}@Attached to thread network %@, but expected to attach to %@";
      v13 = v10;
      v14 = OS_LOG_TYPE_ERROR;
      v15 = 32;
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_12;
      }

      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v11;
      v34 = 2112;
      v35 = v5;
      v12 = "%{public}@Attached to thread network %@";
      v13 = v10;
      v14 = OS_LOG_TYPE_DEFAULT;
      v15 = 22;
    }

    _os_log_impl(&dword_2531F8000, v13, v14, v12, buf, v15);

LABEL_12:
    objc_autoreleasePoolPop(v8);
    if (!*(*(*(a1 + 48) + 8) + 40) || ([v5 isEqualToString:?] & 1) == 0)
    {
      [*(a1 + 32) setThreadNetworkID:v5];
    }

    v23 = [*(a1 + 32) workQueue];
    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_48;
    v27[3] = &unk_279735738;
    v25 = *(a1 + 40);
    v27[4] = *(a1 + 32);
    v22 = &v28;
    v28 = v25;
    dispatch_async(v23, v27);
    goto LABEL_16;
  }

  v16 = objc_autoreleasePoolPush();
  v17 = *(a1 + 32);
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
  {
    v19 = HMFGetLogIdentifier();
    *buf = 138543874;
    v33 = v19;
    v34 = 2112;
    v35 = 0;
    v36 = 2112;
    v37 = v6;
    _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to attach to thread network %@: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v16);
  v20 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_47;
  block[3] = &unk_2797355D0;
  v21 = *(a1 + 40);
  block[4] = *(a1 + 32);
  v22 = &v31;
  v31 = v21;
  v30 = v6;
  dispatch_async(v20, block);

  v23 = v30;
LABEL_16:

  v26 = *MEMORY[0x277D85DE8];
}

uint64_t __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_47(uint64_t a1)
{
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  v2 = *(a1 + 40);
  v3 = *(*(a1 + 48) + 16);

  return v3();
}

uint64_t __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_48(uint64_t a1)
{
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  [*(a1 + 32) _scheduleThreadNetworkUpdate];
  v2 = *(*(a1 + 40) + 16);

  return v2();
}

- (void)_retryStartThreadNetwork:(double)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = 30.0;
  if (a3 > 0.0)
  {
    v7 = fmin(a3 + a3, 1800.0);
    if (a3 < 2.22044605e-16)
    {
      v6 = 30.0;
    }

    else
    {
      v6 = v7;
    }
  }

  v8 = [(HMDHome *)self threadNetworkSequenceNumber];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke;
  aBlock[3] = &unk_279723418;
  objc_copyWeak(v20, &location);
  v20[1] = *&a3;
  v20[2] = v8;
  v20[3] = *&v6;
  v9 = _Block_copy(aBlock);
  v10 = v9;
  v11 = a3 <= 0.0;
  if (a3 < 2.22044605e-16)
  {
    v11 = 1;
  }

  if (v11)
  {
    (*(v9 + 2))(v9);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v23 = v15;
      v24 = 2048;
      v25 = a3;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Next resident commissioning attempt will happen in %lu seconds", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v16 = dispatch_time(0, (a3 * 1000000000.0));
    v17 = [(HMDHome *)v13 workQueue];
    dispatch_after(v16, v17, v10);
  }

  objc_destroyWeak(v20);
  objc_destroyWeak(&location);
  v18 = *MEMORY[0x277D85DE8];
}

void __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke(uint64_t a1)
{
  v28 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (!WeakRetained)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v13;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEBUG, "%{public}@Home has died, resident commissioning canceled", buf, 0xCu);
    }

    v14 = v11;
    goto LABEL_17;
  }

  v3 = *(a1 + 40);
  if (v3 > 0.0 && v3 >= 2.22044605e-16)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning timer expired", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = [WeakRetained threadNetworkSequenceNumber];
  v10 = v9;
  if (v9 != *(a1 + 48))
  {
    v15 = objc_autoreleasePoolPush();
    v16 = WeakRetained;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = *(a1 + 48);
      *buf = 138543874;
      v23 = v18;
      v24 = 2048;
      v25 = v19;
      v26 = 2048;
      v27 = v10;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning sequence number no longer matches: %lu != %lu", buf, 0x20u);
    }

    v14 = v15;
LABEL_17:
    objc_autoreleasePoolPop(v14);
    goto LABEL_18;
  }

  v21[0] = MEMORY[0x277D85DD0];
  v21[1] = 3221225472;
  v21[2] = __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke_45;
  v21[3] = &unk_2797233F0;
  v21[4] = WeakRetained;
  v21[5] = v9;
  v21[6] = *(a1 + 56);
  [WeakRetained _startThreadNetworkWithCompletion:v21];
LABEL_18:

  v20 = *MEMORY[0x277D85DE8];
}

void __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke_45(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (v3)
  {
    v5 = [v3 domain];
    if ([v5 isEqualToString:*MEMORY[0x277CCFD28]])
    {
      if ([v4 code] == 48)
      {

        goto LABEL_12;
      }

      v13 = [v4 code];

      if (v13 == 23)
      {
        goto LABEL_12;
      }
    }

    else
    {
    }

    v6 = [*(a1 + 32) threadNetworkSequenceNumber];
    if (v6 == *(a1 + 40))
    {
      [*(a1 + 32) _retryStartThreadNetwork:*(a1 + 48)];
    }

    else
    {
      v7 = v6;
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = *(a1 + 40);
        v15 = 138543874;
        v16 = v11;
        v17 = 2048;
        v18 = v12;
        v19 = 2048;
        v20 = v7;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning sequence number no longer matches: %lu != %lu", &v15, 0x20u);
      }

      objc_autoreleasePoolPop(v8);
    }
  }

LABEL_12:

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_incrementCurrentSequenceNumber
{
  v3 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v3);

  v4 = [(HMDHome *)self threadNetworkSequenceNumber];
  [(HMDHome *)self setThreadNetworkSequenceNumber:v4 + 1];
  if (v4 == -1)
  {
    v5 = [(HMDHome *)self threadNetworkSequenceNumber]+ 1;

    [(HMDHome *)self setThreadNetworkSequenceNumber:v5];
  }
}

- (void)startThreadNetwork:(BOOL)a3
{
  v21 = *MEMORY[0x277D85DE8];
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 supportsThreadService], v5, (v6 & 1) != 0))
  {
    v7 = objc_autoreleasePoolPush();
    v8 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v20 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Starting resident commissioning timer", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [(HMDHome *)v8 workQueue];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __59__HMDHome_ThreadResidentCommissioning__startThreadNetwork___block_invoke;
    v17[3] = &unk_279735D28;
    v17[4] = v8;
    v18 = a3;
    dispatch_async(v11, v17);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v20 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Thread commissioning is not supported on this platform", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __59__HMDHome_ThreadResidentCommissioning__startThreadNetwork___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) homeManager];
  if ([v2 isStartThreadNetworkInProgress])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v6;
      v7 = "%{public}@Not starting thread network, start already in progress for another network";
LABEL_4:
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, v7, &v11, 0xCu);
    }
  }

  else
  {
    if (*(a1 + 40) & 1) != 0 || ([*(a1 + 32) threadNetworkID], v8 = objc_claimAutoreleasedReturnValue(), v9 = objc_msgSend(v2, "isCurrentResidentDeviceRunningThreadNetwork:", v8), v8, (v9))
    {
      [*(a1 + 32) _incrementCurrentSequenceNumber];
      [*(a1 + 32) _retryStartThreadNetwork:0.0];
      goto LABEL_9;
    }

    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v6;
      v7 = "%{public}@Not starting thread network, not associated with thread network homes";
      goto LABEL_4;
    }
  }

  objc_autoreleasePoolPop(v3);
LABEL_9:

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleUnjoinThreadNetworkMessage:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke(uint64_t a1)
{
  v2[0] = MEMORY[0x277D85DD0];
  v2[1] = 3221225472;
  v2[2] = __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke_2;
  v2[3] = &unk_2797359D8;
  v1 = *(a1 + 32);
  v3 = *(a1 + 40);
  [v1 _unjoinThreadNetworkWithCompletion:v2];
}

- (void)_handleJoinOrFormThreadNetworkMessage:(id)a3
{
  v25 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = _os_feature_enabled_impl();
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled())
  {
    v6 = +[HMDDeviceCapabilities deviceCapabilities];
    v7 = [v6 supportsThreadService];

    if (((v7 | v5) & 1) == 0)
    {
LABEL_3:
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543362;
        v24 = v11;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Resident commissioning is disabled", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
      v12 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:5];
      [v4 respondWithPayload:0 error:v12];
      goto LABEL_13;
    }
  }

  else if ((v5 & 1) == 0)
  {
    goto LABEL_3;
  }

  v13 = [v4 messagePayload];

  if (v13)
  {
    v14 = [v4 messagePayload];
    v15 = [v14 objectForKey:*MEMORY[0x277CD0628]];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v16 = v15;
    }

    else
    {
      v16 = 0;
    }

    v13 = v16;
  }

  v17 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke;
  block[3] = &unk_279734960;
  v20 = v13;
  v21 = self;
  v22 = v4;
  v12 = v13;
  dispatch_async(v17, block);

LABEL_13:
  v18 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  if (*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 40) threadNetworkID];
      v7 = *(a1 + 32);
      *buf = 138543874;
      v13 = v5;
      v14 = 2112;
      v15 = v6;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Updating thread network %@ -> %@ and starting", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) setThreadNetworkID:*(a1 + 32)];
  }

  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke_43;
  v10[3] = &unk_2797359D8;
  v8 = *(a1 + 40);
  v11 = *(a1 + 48);
  [v8 _startThreadNetworkWithCompletion:v10];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_handleThreadNetworkCredentialsRequest:(id)a3
{
  v24 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve request for Thread Network Credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [(HMDHome *)v6 threadNetworkMetadataStore];
  if (v9)
  {
    objc_initWeak(buf, v6);
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke;
    aBlock[3] = &unk_2797233C8;
    aBlock[4] = v6;
    objc_copyWeak(&v21, buf);
    v20 = v4;
    v10 = _Block_copy(aBlock);
    v11 = [(HMDHome *)v6 threadOperationalDataset];
    v12 = [(HMDHome *)v6 home];
    [v9 retrieveMetadata:v11 homeHasResident:objc_msgSend(v12 completion:{"doesHomeContainResident"), v10}];

    objc_destroyWeak(&v21);
    objc_destroyWeak(buf);
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = v6;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v16;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v4 respondWithError:v17];
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke_2;
  v10[3] = &unk_279733910;
  objc_copyWeak(&v14, a1 + 6);
  v11 = v5;
  v12 = v6;
  v13 = a1[5];
  v8 = v6;
  v9 = v5;
  dispatch_async(v7, v10);

  objc_destroyWeak(&v14);
}

void __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke_2(uint64_t a1)
{
  v36 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained && *(a1 + 32))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = WeakRetained;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 32);
      *buf = 138543618;
      v31 = v6;
      v32 = 2112;
      v33 = v7;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Successfully retrieved thread credentials %@ from network metadata store", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v8 = [*(a1 + 32) operationalDataset];

    if (v8)
    {
      v9 = [*(a1 + 32) operationalDataset];
      v10 = [v9 copy];
      [v4 saveAndSyncWithThreadOperationalDataset:v10];
    }

    v11 = *(a1 + 32);
    v29 = 0;
    v12 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v11 requiringSecureCoding:1 error:&v29];
    v13 = v29;
    if (v12)
    {
      v14 = [MEMORY[0x277CBEB38] dictionary];
      [v14 setObject:v12 forKeyedSubscript:*MEMORY[0x277CD0620]];
      v15 = [*(a1 + 32) masterKey];
      [v14 setObject:v15 forKeyedSubscript:@"HMHomeThreadNetworkCredentialsMasterKeyMessageKey"];

      [*(a1 + 48) respondWithPayload:v14];
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      v24 = v4;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543618;
        v31 = v26;
        v32 = 2112;
        v33 = v13;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Unable to encode credentials: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v23);
      v27 = *(a1 + 48);
      v14 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
      [v27 respondWithError:v14];
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = WeakRetained;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v17 threadNetworkID];
      v21 = *(a1 + 40);
      *buf = 138543874;
      v31 = v19;
      v32 = 2112;
      v33 = v20;
      v34 = 2112;
      v35 = v21;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network '%@': %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    v22 = *(a1 + 48);
    v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v22 respondWithError:v13];
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)handleCurrentWiFiNetworkChangedNotification:(id)a3
{
  v4 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __84__HMDHome_ThreadResidentCommissioning__handleCurrentWiFiNetworkChangedNotification___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v4, block);
}

void __84__HMDHome_ThreadResidentCommissioning__handleCurrentWiFiNetworkChangedNotification___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) threadNetworkShouldRestartOnNetworkChange];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_INFO);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v7;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Restarting Thread network upon WiFi network changed notification", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 32) startThreadNetwork:1];
  }

  else
  {
    if (v6)
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Ignoring WiFi network changed notification when Thread is not up", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_registerThreadResidentCommissioningMessageHandlers
{
  v11 = *MEMORY[0x277D85DE8];
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    v3 = objc_autoreleasePoolPush();
    v4 = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v6;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Registering for HMFWiFiManagerCurrentNetworkDidChangeNotification", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v7 = [MEMORY[0x277CCAB98] defaultCenter];
    [v7 addObserver:v4 selector:sel_handleCurrentWiFiNetworkChangedNotification_ name:*MEMORY[0x277D0F768] object:0];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceThreadPreferredPrimaryResident
{
  v2 = +[HMDDeviceCapabilities deviceCapabilities];
  v3 = [v2 supportsThreadBorderRouter];

  return v3;
}

- (void)setThreadNetworkID:(id)a3
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = [(HMDHome *)self threadNetworkID];
  if (v6 && (v7 = v6, v8 = [v5 isEqualToString:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"], v7, (v8 & 1) == 0))
  {
    v14 = objc_autoreleasePoolPush();
    v15 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v18 = [(HMDHome *)v15 unfilteredThreadNetworkID];
      v20 = 138543874;
      v21 = v17;
      v22 = 2112;
      v23 = v5;
      v24 = 2112;
      v25 = v18;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Unable to set threadNetworkID to %@. (current value=%@)", &v20, 0x20u);
    }

    objc_autoreleasePoolPop(v14);
  }

  else if ([(HMDHome *)self attemptToUpdateThreadNetworkID:v5])
  {
    v9 = [HMDHomeThreadNetworkModel defaultModelForHome:self];
    [v9 setThreadNetworkID:v5];
    v10 = [(HMDHome *)self backingStore];
    v11 = NSStringFromSelector(a2);
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [v10 transaction:v11 options:v12];

    [v13 add:v9 withMessage:0];
    [v13 run];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (NSString)threadNetworkID
{
  v2 = [(HMDHome *)self unfilteredThreadNetworkID];
  if ([v2 isEqualToString:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"])
  {
    v3 = 0;
  }

  else
  {
    v3 = v2;
  }

  return v3;
}

- (void)_unregisterForThreadNetworkEvents
{
  objc_initWeak(&location, self);
  v3 = [(HMDHome *)self workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __73__HMDHome_ThreadResidentCommissioning___unregisterForThreadNetworkEvents__block_invoke;
  v4[3] = &unk_279732FD8;
  objc_copyWeak(&v5, &location);
  dispatch_async(v3, v4);

  objc_destroyWeak(&v5);
  objc_destroyWeak(&location);
}

void __73__HMDHome_ThreadResidentCommissioning___unregisterForThreadNetworkEvents__block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained && ([WeakRetained threadNetworkPeriodicStatusReporter], v3 = objc_claimAutoreleasedReturnValue(), v3, v3))
  {
    v4 = [v2 threadNetworkPeriodicStatusReporter];
    [v4 unregisterForThreadNetworkEvents];

    [v2 setThreadNetworkPeriodicStatusReporter:0];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = v2;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@_unregisterForThreadNetworkEvents already unregistered", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_registerForThreadNetworkEvents
{
  objc_initWeak(&location, self);
  v3 = [(HMDHome *)self workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __71__HMDHome_ThreadResidentCommissioning___registerForThreadNetworkEvents__block_invoke;
  v4[3] = &unk_279732FD8;
  objc_copyWeak(&v5, &location);
  dispatch_async(v3, v4);

  objc_destroyWeak(&v5);
  objc_destroyWeak(&location);
}

void __71__HMDHome_ThreadResidentCommissioning___registerForThreadNetworkEvents__block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained)
  {
    v3 = [WeakRetained threadNetworkPeriodicStatusReporter];

    if (!v3)
    {
      v4 = [[HMDThreadNetworkStatusReporter alloc] initWithHome:v2];
      [v2 setThreadNetworkPeriodicStatusReporter:v4];
    }

    v5 = [v2 threadNetworkPeriodicStatusReporter];
    [v5 registerForThreadNetworkEvents];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@_registerForThreadNetworkEvents could not get a strong reference to self", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceThreadBorderRouterCapable
{
  v2 = +[HMDDeviceCapabilities deviceCapabilities];
  v3 = [v2 supportsThreadBorderRouter];

  return v3;
}

- (BOOL)isThreadNetworkUp
{
  [(HMDHome *)self _scheduleThreadNetworkUpdate];

  return [(HMDHome *)self threadNetworkIsUp];
}

- (BOOL)isThreadCapable
{
  v3 = [(HMDHome *)self threadNetworkID];

  if (v3)
  {
    return 1;
  }

  [(HMDHome *)self _scheduleThreadNetworkUpdate];

  return [(HMDHome *)self threadPreferredNetworkExists];
}

- (id)actionWithDictionaryRepresentation:(id)a3
{
  v25 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = v4;
  if (!v4)
  {
    v11 = 0;
    goto LABEL_14;
  }

  v6 = [v4 hmf_numberForKey:*MEMORY[0x277CD2058]];
  v7 = v6;
  if (!v6)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v15;
      v16 = "%{public}@Unable to determine the action type";
      v17 = v14;
      v18 = 12;
      goto LABEL_11;
    }

LABEL_12:

    objc_autoreleasePoolPop(v12);
    v11 = 0;
    goto LABEL_13;
  }

  v8 = [v6 integerValue];
  if (v8 > 3 || (v9 = *off_279724020[v8], objc_opt_class(), (v10 = objc_claimAutoreleasedReturnValue()) == 0))
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v15;
      v23 = 2112;
      v24 = v7;
      v16 = "%{public}@Unknown action type: %@";
      v17 = v14;
      v18 = 22;
LABEL_11:
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, v16, &v21, v18);

      goto LABEL_12;
    }

    goto LABEL_12;
  }

  v11 = [v10 actionWithDictionaryRepresentation:v5 home:self];
LABEL_13:

LABEL_14:
  v19 = *MEMORY[0x277D85DE8];

  return v11;
}

- (id)createAppleMediaAccessoriesStateManagerWithIdentifier:(id)a3 messenger:(id)a4 metricsDispatcher:(id)a5
{
  v7 = a5;
  v8 = a4;
  v9 = a3;
  v10 = [[HMDAppleMediaAccessoriesStateManager alloc] initWithIdentifier:v9 messenger:v8 metricsDispatcher:v7];

  return v10;
}

- (void)configureAppleMediaAccessoriesStateManagerWithStateManagerWithFactory:(id)a3 messengerFactory:(id)a4 metricsDispatcherFactory:(id)a5
{
  v25 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = objc_autoreleasePoolPush();
  v12 = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v23 = 138543362;
    v24 = v14;
    _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Configuring apple media accessories state manager", &v23, 0xCu);
  }

  objc_autoreleasePoolPop(v11);
  v15 = [(HMDHome *)v12 uuid];
  v16 = [(HMDHome *)v12 msgDispatcher];
  v17 = +[HMDMetricsManager sharedLogEventSubmitter];
  if (!v15)
  {
    _HMFPreconditionFailure();
    goto LABEL_8;
  }

  if (!v16)
  {
LABEL_8:
    _HMFPreconditionFailure();
LABEL_9:
    _HMFPreconditionFailure();
  }

  v18 = v17;
  if (!v17)
  {
    goto LABEL_9;
  }

  v19 = [v9 createAppleMediaAccessoriesStateMessengerWithIdentifier:v15 messageDispatcher:v16];
  v20 = [v10 createAppleMediaAccessoriesStateManagerMetricsDispatcherWithIdentifier:v15 logEventSubmitter:v18];
  v21 = [v8 createAppleMediaAccessoriesStateManagerWithIdentifier:v15 messenger:v19 metricsDispatcher:v20];
  [v19 setDelegate:v21];
  [v21 setDataSource:v12];
  [v19 registerForMessagesWithHome:v12];
  [v21 run];
  [(HMDHome *)v12 setAppleMediaAccessoriesStateManager:v21];

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_auditChangedCharacteristics:(id)a3
{
  v40 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v4 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(v3, "count")}];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v5 = v3;
  v6 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v35;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v34 + 1) + 8 * i);
        v11 = [v10 notificationRegistrations];
        v12 = [v11 count];

        if (!v12)
        {
          v13 = [v10 accessory];
          v14 = [v13 uuid];
          [v4 addObject:v14];

          if (([v13 isPrimary] & 1) == 0)
          {
            v15 = [v13 bridge];
            v16 = [v15 identifiersForBridgedAccessories];
            [v4 unionSet:v16];
          }
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
    }

    while (v7);
  }

  if ([v4 count] == 1)
  {
    v17 = [v5 firstObject];
    v18 = [v17 accessory];
    [(HMDHome *)self _auditAndDeregisterCharacteristicsForHAPAccessory:v18];
  }

  else
  {
    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    v17 = [(HMDHome *)self accessories];
    v19 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v31;
      do
      {
        for (j = 0; j != v20; ++j)
        {
          if (*v31 != v21)
          {
            objc_enumerationMutation(v17);
          }

          v23 = *(*(&v30 + 1) + 8 * j);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          if (v25)
          {
            v26 = [v25 uuid];
            v27 = [v4 containsObject:v26];

            if (v27)
            {
              [(HMDHome *)self _auditAndDeregisterCharacteristicsForHAPAccessory:v25];
            }
          }
        }

        v20 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
      }

      while (v20);
    }
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_auditAndDeregisterCharacteristicsForHAPAccessory:(id)a3
{
  v24 = self;
  v46 = *MEMORY[0x277D85DE8];
  v3 = a3;
  v4 = [MEMORY[0x277CBEB18] array];
  v5 = [MEMORY[0x277CCAB68] string];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v25 = v3;
  obj = [v3 services];
  v28 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
  if (v28)
  {
    v27 = *v35;
    do
    {
      v6 = 0;
      do
      {
        if (*v35 != v27)
        {
          objc_enumerationMutation(obj);
        }

        v29 = v6;
        v7 = *(*(&v34 + 1) + 8 * v6);
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v33 = 0u;
        v8 = [v7 characteristics];
        v9 = [v8 countByEnumeratingWithState:&v30 objects:v44 count:16];
        if (v9)
        {
          v10 = v9;
          v11 = *v31;
          do
          {
            for (i = 0; i != v10; ++i)
            {
              if (*v31 != v11)
              {
                objc_enumerationMutation(v8);
              }

              v13 = *(*(&v30 + 1) + 8 * i);
              v14 = [v13 notificationRegistrations];
              v15 = [v14 count];

              if (!v15)
              {
                [v4 addObject:v13];
                v16 = [v13 shortDescription];
                [v5 appendString:v16];

                [v5 appendString:@"\n"];
              }
            }

            v10 = [v8 countByEnumeratingWithState:&v30 objects:v44 count:16];
          }

          while (v10);
        }

        v6 = v29 + 1;
      }

      while (v29 + 1 != v28);
      v28 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
    }

    while (v28);
  }

  v17 = objc_autoreleasePoolPush();
  v18 = v24;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    v21 = [v25 uuid];

    if (v21)
    {
      v22 = [v25 uuid];
      [v22 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v38 = *buf;
    *buf = 138544130;
    *&buf[4] = v20;
    *&buf[12] = 1040;
    *&buf[14] = 16;
    v40 = 2096;
    v41 = &v38;
    v42 = 2112;
    v43 = v5;
    _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Audit de-registering notifications accessory %{uuid_t}.16P characteristics %@", buf, 0x26u);
  }

  objc_autoreleasePoolPop(v17);
  [v25 enableNotification:0 forCharacteristics:v4 message:0 clientIdentifier:0];

  v23 = *MEMORY[0x277D85DE8];
}

- (void)updateLightProfilesSettings:(id)a3
{
  v38 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [MEMORY[0x277CBEB58] set];
  v6 = [MEMORY[0x277CBEB58] set];
  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  v7 = v4;
  v8 = [v7 countByEnumeratingWithState:&v29 objects:v37 count:16];
  if (v8)
  {
    v9 = *v30;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v30 != v9)
        {
          objc_enumerationMutation(v7);
        }

        v11 = *(*(&v29 + 1) + 8 * i);
        v12 = [v11 readCharacteristicRequests];
        if ([v12 count])
        {
          v13 = [v12 allObjects];
          [v5 addObjectsFromArray:v13];

          [v6 addObject:v11];
        }
      }

      v8 = [v7 countByEnumeratingWithState:&v29 objects:v37 count:16];
    }

    while (v8);
  }

  v14 = [v5 count] == 0;
  v15 = objc_autoreleasePoolPush();
  if (v14)
  {
    v22 = [(HMDHome *)self lightLogCategory];
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v34 = v24;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_DEBUG, "%{public}@No characteristic read requests for light profiles", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  else
  {
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [v5 count];
      *buf = 138543618;
      v34 = v18;
      v35 = 2048;
      v36 = v19;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@update light profiles settings, read characteristic count %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    objc_initWeak(buf, v16);
    v20 = [v5 allObjects];
    v21 = [(HMDHome *)v16 description];
    v26[0] = MEMORY[0x277D85DD0];
    v26[1] = 3221225472;
    v26[2] = __46__HMDHome_Light__updateLightProfilesSettings___block_invoke;
    v26[3] = &unk_279733AE8;
    objc_copyWeak(&v28, buf);
    v27 = v6;
    [(HMDHome *)v16 readCharacteristicValues:v20 source:1140 sourceForLogging:v21 qualityOfService:-1 withCompletionHandler:v26];

    objc_destroyWeak(&v28);
    objc_destroyWeak(buf);
  }

  v25 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome_Light__updateLightProfilesSettings___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v36 = *MEMORY[0x277D85DE8];
  v20 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v7 = v5;
    if ([v5 count])
    {
      v27 = 0u;
      v28 = 0u;
      v25 = 0u;
      v26 = 0u;
      obj = *(a1 + 32);
      v8 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
      if (v8)
      {
        v9 = v8;
        v10 = *v26;
        do
        {
          for (i = 0; i != v9; ++i)
          {
            if (*v26 != v10)
            {
              objc_enumerationMutation(obj);
            }

            v12 = *(*(&v25 + 1) + 8 * i);
            v13 = [v12 workQueue];
            block[0] = MEMORY[0x277D85DD0];
            block[1] = 3221225472;
            block[2] = __46__HMDHome_Light__updateLightProfilesSettings___block_invoke_15;
            block[3] = &unk_279734870;
            block[4] = v12;
            v5 = v7;
            v22 = v7;
            v23 = WeakRetained;
            v24 = v20;
            dispatch_async(v13, block);
          }

          v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
        }

        while (v9);
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      v15 = [WeakRetained lightLogCategory];
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543874;
        v31 = v17;
        v32 = 2112;
        v33 = v7;
        v34 = 2112;
        v35 = v20;
        _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Received empty response payload for light profile charactersitic read requests %@:%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v14);
      v5 = v7;
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome_Light__updateLightProfilesSettings___block_invoke_15(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v18 = 0;
  v4 = [v2 updateSettingsWithReadCharacteristicResponsePayload:v3 error:&v18];
  v5 = v18;
  v6 = objc_autoreleasePoolPush();
  v7 = [*(a1 + 48) lightLogCategory];
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v4)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 32);
      *buf = 138543874;
      v20 = v10;
      v21 = 2112;
      v22 = v11;
      v23 = 2112;
      v24 = v4;
      v12 = "%{public}@Successfully updated light profile settings %@:%@";
      v13 = v9;
      v14 = OS_LOG_TYPE_INFO;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v13, v14, v12, buf, 0x20u);
    }
  }

  else if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v15 = *(a1 + 32);
    v16 = *(a1 + 56);
    *buf = 138543874;
    v20 = v10;
    v21 = 2112;
    v22 = v15;
    v23 = 2112;
    v24 = v16;
    v12 = "%{public}@Failed to update light profile settings %@:%@";
    v13 = v9;
    v14 = OS_LOG_TYPE_ERROR;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v6);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled:(BOOL)a3
{
  v3 = a3;
  v24 = *MEMORY[0x277D85DE8];
  v5 = [MEMORY[0x277CBEB58] set];
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v6 = [(HMDHome *)self accessories];
  v7 = [v6 countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v20;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v20 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v19 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = v11;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if (v13)
        {
          v14 = [v13 lightProfiles];
          v15 = v14;
          if (v3)
          {
            v16 = [v14 na_filter:&__block_literal_global_44789];

            v15 = v16;
          }

          v17 = [v15 allObjects];
          [v5 addObjectsFromArray:v17];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v19 objects:v23 count:16];
    }

    while (v8);
  }

  [(HMDHome *)self updateLightProfilesSettings:v5];
  v18 = *MEMORY[0x277D85DE8];
}

BOOL __82__HMDHome_Light__updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 notificationEnabledCharacteristics];
  v3 = [v2 count] != 0;

  return v3;
}

- (void)respondMessage:(id)a3 withSettingResults:(id)a4
{
  v27 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v18 = 0;
  v8 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v7 requiringSecureCoding:1 error:&v18];
  v9 = v18;
  v10 = objc_autoreleasePoolPush();
  v11 = [(HMDHome *)self lightLogCategory];
  v12 = HMFGetOSLogHandle();
  v13 = v12;
  if (v8)
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v22 = v14;
      v23 = 2112;
      v24 = v7;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Responding with light profile settings: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v19 = *MEMORY[0x277CD0438];
    v20 = v8;
    v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v20 forKeys:&v19 count:1];
    [v6 respondWithPayload:v15];
  }

  else
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543874;
      v22 = v16;
      v23 = 2112;
      v24 = v7;
      v25 = 2112;
      v26 = v9;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to encode profile setting results: %@ with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
    [v6 respondWithError:v15];
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)handleFetchLightProfileSettingsMessage:(id)a3 withLightProfileUUIDs:(id)a4
{
  v55 = *MEMORY[0x277D85DE8];
  v36 = a3;
  v6 = a4;
  v7 = objc_autoreleasePoolPush();
  v37 = self;
  v8 = [(HMDHome *)self lightLogCategory];
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543618;
    v52 = v10;
    v53 = 2112;
    v54 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Handling fetch light profiles settings for profiles: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = [MEMORY[0x277CBEB38] dictionary];
  v40 = [MEMORY[0x277CBEB58] set];
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v48 = 0u;
  obj = v6;
  v12 = [obj countByEnumeratingWithState:&v45 objects:v50 count:16];
  v13 = self;
  if (v12)
  {
    v14 = v12;
    v15 = *v46;
    do
    {
      v16 = 0;
      v38 = v14;
      do
      {
        if (*v46 != v15)
        {
          objc_enumerationMutation(obj);
        }

        v17 = *(*(&v45 + 1) + 8 * v16);
        v18 = [(HMDHome *)v13 lightProfileWithUUID:v17];
        if (v18)
        {
          [v40 addObject:v18];
        }

        else
        {
          v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          v20 = [objc_alloc(MEMORY[0x277CD1A80]) initWithError:v19];
          v21 = v11;
          [v11 setObject:v20 forKeyedSubscript:v17];

          v22 = objc_autoreleasePoolPush();
          v23 = [(HMDHome *)v13 lightLogCategory];
          v24 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
          {
            v25 = HMFGetLogIdentifier();
            *buf = 138543618;
            v52 = v25;
            v53 = 2112;
            v54 = v17;
            _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Could not find light profile with uuid: %@", buf, 0x16u);

            v13 = v37;
          }

          objc_autoreleasePoolPop(v22);
          v11 = v21;
          v14 = v38;
        }

        ++v16;
      }

      while (v14 != v16);
      v14 = [obj countByEnumeratingWithState:&v45 objects:v50 count:16];
    }

    while (v14);
  }

  v43 = 0u;
  v44 = 0u;
  v41 = 0u;
  v42 = 0u;
  v26 = v40;
  v27 = [v26 countByEnumeratingWithState:&v41 objects:v49 count:16];
  if (v27)
  {
    v28 = v27;
    v29 = *v42;
    do
    {
      for (i = 0; i != v28; ++i)
      {
        if (*v42 != v29)
        {
          objc_enumerationMutation(v26);
        }

        v31 = *(*(&v41 + 1) + 8 * i);
        v32 = [v31 settings];
        v33 = [objc_alloc(MEMORY[0x277CD1A80]) initWithSettings:v32];
        v34 = [v31 uniqueIdentifier];
        [v11 setObject:v33 forKeyedSubscript:v34];
      }

      v28 = [v26 countByEnumeratingWithState:&v41 objects:v49 count:16];
    }

    while (v28);
  }

  [(HMDHome *)v37 respondMessage:v36 withSettingResults:v11];
  v35 = *MEMORY[0x277D85DE8];
}

- (void)handleFetchLightProfileSettingsMessage:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [v4 setForKey:*MEMORY[0x277CD0430]];
  [(HMDHome *)self handleFetchLightProfileSettingsMessage:v4 withLightProfileUUIDs:v6];
}

- (id)lightProfileWithUUID:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self accessories];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __39__HMDHome_Light__lightProfileWithUUID___block_invoke;
  v10[3] = &unk_279726250;
  v11 = v4;
  v6 = v4;
  v7 = [v5 na_map:v10];

  v8 = [v7 firstObject];

  return v8;
}

id __39__HMDHome_Light__lightProfileWithUUID___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = v5;
  if (v5)
  {
    v7 = [v5 lightProfiles];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __39__HMDHome_Light__lightProfileWithUUID___block_invoke_2;
    v10[3] = &unk_2797285D0;
    v11 = *(a1 + 32);
    v8 = [v7 na_firstObjectPassingTest:v10];
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

uint64_t __39__HMDHome_Light__lightProfileWithUUID___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 uniqueIdentifier];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (id)createPrimaryResidentMessageRouterWithHomeUUID:(id)a3 messageDispatcher:(id)a4 metricsDispatcher:(id)a5
{
  v7 = a5;
  v8 = a4;
  v9 = a3;
  v10 = [[HMDPrimaryResidentMessageRouter alloc] initWithHomeUUID:v9 messageDispatcher:v8 metricsDispatcher:v7];

  return v10;
}

- (void)configurePrimaryResidentMessageRouterWithFactory:(id)a3 metricsDispatcherFactory:(id)a4
{
  v21 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring primary resident message router", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [(HMDHome *)v9 msgDispatcher];
  v13 = [(HMDHome *)v9 msgDispatcher];

  if (!v13)
  {
    _HMFPreconditionFailure();
  }

  v14 = +[HMDMetricsManager sharedLogEventSubmitter];
  v15 = [v7 createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:v14];
  v16 = [(HMDHome *)v9 uuid];
  v17 = [v6 createPrimaryResidentMessageRouterWithHomeUUID:v16 messageDispatcher:v12 metricsDispatcher:v15];

  [v17 setDataSource:v9];
  [(HMDHome *)v9 setPrimaryResidentMessageRouter:v17];

  v18 = *MEMORY[0x277D85DE8];
}

- (id)createAccessorySettingsLocalMessageHandlerWithHomeUUID:(id)a3 languageValuesDataProvider:(id)a4
{
  v5 = a4;
  v6 = a3;
  v7 = [[HMDAccessorySettingsLocalMessageHandler alloc] initWithHomeUUID:v6 languageValuesDataProvider:v5];

  return v7;
}

- (HMDAccessoryCount)accessoryCount
{
  v2 = [[HMDAccessoryCount alloc] initWithHome:self];

  return v2;
}

- (id)createSiriEndpointProfileMessageHandlerWithHomeUUID:(id)a3
{
  v3 = a3;
  v4 = [[HMDSiriEndpointProfileMessageHandler alloc] initWithHomeUUID:v3];

  return v4;
}

- (id)createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:(id)a3
{
  v3 = a3;
  v4 = [[HMDPrimaryResidentMessageRouterMetricsDispatcher alloc] initWithLogEventSubmitter:v3];

  return v4;
}

- (void)_reconfigureAccessoriesOnRouterRemovalWithCompletion:(id)a3
{
  v46 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v5);

  v6 = [(HMDHome *)self accessories];
  v7 = [v6 hmf_objectsPassingTest:&__block_literal_global_2];

  if ([v7 count])
  {
    v8 = [(HMDHome *)self activeNetworkRouterAccessory];
    v9 = [v8 networkRouterController];
    v10 = [v9 wiFiSSID];

    v11 = [HMDWiFiManagementController sharedPSKForNetworkWithSSID:v10];
    v12 = v11;
    v32 = v10;
    if (v10 && v11)
    {
      block = v4;
      v31 = v11;
      v13 = objc_autoreleasePoolPush();
      v14 = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543874;
        v41 = v16;
        v42 = 2048;
        v43 = [v7 count];
        v44 = 2112;
        v45 = v32;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Reconfiguring %ld accessories on '%@' due to router removal", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
      v17 = dispatch_group_create();
      v35 = 0u;
      v36 = 0u;
      v37 = 0u;
      v38 = 0u;
      v18 = v7;
      v19 = [v18 countByEnumeratingWithState:&v35 objects:v39 count:16];
      if (v19)
      {
        v20 = v19;
        v21 = *v36;
        do
        {
          for (i = 0; i != v20; ++i)
          {
            if (*v36 != v21)
            {
              objc_enumerationMutation(v18);
            }

            v23 = *(*(&v35 + 1) + 8 * i);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v24 = v23;
            }

            else
            {
              v24 = 0;
            }

            v25 = v24;

            v26 = [v25 wiFiManagementController];

            if (v26)
            {
              dispatch_group_enter(v17);
              v27 = objc_alloc_init(HMDWiFiReconfigurationLogEvent);
              [(HMDWiFiReconfigurationLogEvent *)v27 setCredentialType:2];
              v33[0] = MEMORY[0x277D85DD0];
              v33[1] = 3221225472;
              v33[2] = __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke_5;
              v33[3] = &unk_2797358C8;
              v33[4] = v23;
              v34 = v17;
              [v26 reconfigureWithSSID:v32 PSK:v31 logEvent:v27 completion:v33];
            }
          }

          v20 = [v18 countByEnumeratingWithState:&v35 objects:v39 count:16];
        }

        while (v20);
      }

      v28 = [(HMDHome *)v14 workQueue];
      v4 = block;
      dispatch_group_notify(v17, v28, block);

      v12 = v31;
    }

    else
    {
      v4[2](v4);
    }
  }

  else
  {
    v4[2](v4);
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke_5(uint64_t a1, uint64_t a2)
{
  [*(a1 + 32) saveWiFiUniquePreSharedKey:0 credentialType:2 * (a2 == 0)];
  v3 = *(a1 + 40);

  dispatch_group_leave(v3);
}

uint64_t __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 wiFiCredentialType] == 3)
  {
    v3 = isReconfigurationPossible(v2);
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (NSArray)accessoriesRequiringManualReconfigurationOnRouterRemoval
{
  v2 = [(HMDHome *)self accessories];
  v3 = [v2 hmf_objectsPassingTest:&__block_literal_global_76098];

  return v3;
}

uint64_t __83__HMDHome_WiFiManagement__accessoriesRequiringManualReconfigurationOnRouterRemoval__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 wiFiCredentialType] == 3)
  {
    v3 = isReconfigurationPossible(v2) ^ 1;
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)playbackArchiveWithSessionIdentifier:(id)a3
{
  v39 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self actionSets];
  v6 = [(HMDHome *)self triggerOwnedActionSets];
  v7 = [v5 arrayByAddingObjectsFromArray:v6];

  v35 = 0u;
  v36 = 0u;
  v33 = 0u;
  v34 = 0u;
  v8 = v7;
  v26 = [v8 countByEnumeratingWithState:&v33 objects:v38 count:16];
  if (v26)
  {
    v9 = *v34;
    v28 = v8;
    v25 = *v34;
    do
    {
      v10 = 0;
      do
      {
        if (*v34 != v9)
        {
          objc_enumerationMutation(v8);
        }

        v27 = v10;
        v11 = *(*(&v33 + 1) + 8 * v10);
        v29 = 0u;
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v12 = [v11 actions];
        v13 = [v12 countByEnumeratingWithState:&v29 objects:v37 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v30;
          while (2)
          {
            for (i = 0; i != v14; ++i)
            {
              if (*v30 != v15)
              {
                objc_enumerationMutation(v12);
              }

              v17 = *(*(&v29 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v18 = v17;
              }

              else
              {
                v18 = 0;
              }

              v19 = v18;

              v20 = [v19 playbackArchive];
              v21 = [v20 playbackSessionIdentifier];
              v22 = [v21 isEqualToString:v4];

              if (v22)
              {

                v8 = v28;
                goto LABEL_22;
              }
            }

            v14 = [v12 countByEnumeratingWithState:&v29 objects:v37 count:16];
            if (v14)
            {
              continue;
            }

            break;
          }
        }

        v10 = v27 + 1;
        v8 = v28;
        v9 = v25;
      }

      while (v27 + 1 != v26);
      v20 = 0;
      v26 = [v28 countByEnumeratingWithState:&v33 objects:v38 count:16];
    }

    while (v26);
  }

  else
  {
    v20 = 0;
  }

LABEL_22:

  v23 = *MEMORY[0x277D85DE8];

  return v20;
}

- (id)createAccessorySettingsMessengerWithMessageTargetUUID:(id)a3 messageDispatcher:(id)a4 messageRouter:(id)a5 messageHandler:(id)a6 logEventSubmitter:(id)a7 legacyMessageReceiver:(id)a8
{
  v37 = *MEMORY[0x277D85DE8];
  v14 = a3;
  v15 = a4;
  v16 = a5;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  v20 = objc_autoreleasePoolPush();
  v21 = self;
  v22 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
  {
    v23 = HMFGetLogIdentifier();
    v27 = 138544386;
    v28 = v23;
    v29 = 2112;
    v30 = v14;
    v31 = 2112;
    v32 = v15;
    v33 = 2112;
    v34 = v16;
    v35 = 2112;
    v36 = v17;
    _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Creating accessory settings messenger with message target UUID: %@ message dispatcher: %@ message router: %@ message handler: %@", &v27, 0x34u);
  }

  objc_autoreleasePoolPop(v20);
  v24 = [[HMDAccessorySettingsMessenger alloc] initWithMessageTargetUUID:v14 messageDispatcher:v15 messageRouter:v16 messageHandler:v17 logEventSubmitter:v18 legacyMessageReceiver:v19];

  v25 = *MEMORY[0x277D85DE8];

  return v24;
}

- (void)configureAccessorySettingsMessengerWithMessengerFactory:(id)a3 messageHandlerFactory:(id)a4
{
  v33 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543362;
    v32 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring accessory settings messenger", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [(HMDHome *)v9 msgDispatcher];
  v13 = [(HMDHome *)v9 accessoryMessageRouterViaPrimary];
  v14 = [(HMDHome *)v9 unifiedLanguageValueListSettingDataProvider];
  if (!v12)
  {
    _HMFPreconditionFailure();
    goto LABEL_8;
  }

  if (!v13)
  {
LABEL_8:
    _HMFPreconditionFailure();
LABEL_9:
    _HMFPreconditionFailure();
  }

  v15 = v14;
  if (!v14)
  {
    goto LABEL_9;
  }

  v16 = [(HMDHome *)v9 uuid];
  v17 = [v7 createAccessorySettingsLocalMessageHandlerWithHomeUUID:v16 languageValuesDataProvider:v15];

  [v17 setDataSource:v9];
  v18 = [(HMDHome *)v9 homeManager];
  v19 = [v18 compositeSettingsControllerManager];
  [v17 setDelegate:v19];

  v20 = MEMORY[0x277CD17B0];
  v21 = [(HMDHome *)v9 uuid];
  v22 = [v20 legacyMessageTargetUUIDWithHomeUUID:v21];

  v23 = [[HMDAccessorySettingsLegacyMessageReceiver alloc] initWithMessageTargetUUID:v22 messageDispatcher:v12];
  v24 = [(HMDHome *)v9 accessorySettingsMessengerMessageTargetUUID];
  [(HMDHome *)v9 logEventSubmitter];
  v29 = v15;
  v26 = v25 = v6;
  [v25 createAccessorySettingsMessengerWithMessageTargetUUID:v24 messageDispatcher:v12 messageRouter:v13 messageHandler:v17 logEventSubmitter:v26 legacyMessageReceiver:v23];
  v27 = v30 = v7;

  [(HMDAccessorySettingsLegacyMessageReceiver *)v23 setMessenger:v27];
  [v27 registerForMessagesWithHome:v9];
  [(HMDHome *)v9 setAccessorySettingsMessenger:v27];

  v28 = *MEMORY[0x277D85DE8];
}

- (id)accessorySettingsMessengerMessageTargetUUID
{
  v2 = MEMORY[0x277CD17B0];
  v3 = [(HMDHome *)self uuid];
  v4 = [v2 messageTargetUUIDWithHomeUUID:v3];

  return v4;
}

- (id)hubAccessories
{
  v2 = [(HMDHome *)self appleMediaAccessories];
  v3 = [v2 na_filter:&__block_literal_global_104469];

  return v3;
}

- (id)createAppleMediaAccessoriesStateMessengerWithIdentifier:(id)a3 messageDispatcher:(id)a4
{
  v5 = a4;
  v6 = a3;
  v7 = [[HMDAppleMediaAccessoriesStateMessenger alloc] initWithIdentifier:v6 messageDispatcher:v5];

  return v7;
}

- (BOOL)isCarPlayAccessAllowedForActionSet:(id)a3 withMessage:(id)a4 fromSource:(unint64_t)a5
{
  v21 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  if (([(HMDHome *)self isMessageEntitledForCarPlayAccess:v9 source:a5]& 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *v18 = 138543874;
      *&v18[4] = v15;
      *&v18[12] = 2112;
      *&v18[14] = v8;
      *&v18[22] = 2048;
      v19 = a5;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@CarPlay access is not allowed for action set: %@ because message from source: %lu does not have sufficient entitlements", v18, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
    goto LABEL_9;
  }

  if (self)
  {
    if ([(HMDHome *)self homeLocation]== 1 || [(HMDHome *)self homeLocation]== 3)
    {
      v10 = [v8 actions];
      v11 = [v10 na_filter:&__block_literal_global_107220];

      *v18 = MEMORY[0x277D85DD0];
      *&v18[8] = 3221225472;
      *&v18[16] = __55__HMDHome_CarPlay__isActionSetAllowedForCarPlayAccess___block_invoke_2;
      v19 = &unk_27972AF48;
      v20 = self;
      LOBYTE(self) = [v11 na_all:v18];

      goto LABEL_10;
    }

LABEL_9:
    LOBYTE(self) = 0;
  }

LABEL_10:

  v16 = *MEMORY[0x277D85DE8];
  return self;
}

- (uint64_t)isMessageEntitledForCarPlayAccess:(uint64_t)a3 source:
{
  v5 = a2;
  v6 = v5;
  if (!a1)
  {
    goto LABEL_5;
  }

  if (a3 != 1)
  {
    if ([v5 isEntitledForSecureAccess])
    {
      a3 = [v6 isEntitledForSPIAccess];
      goto LABEL_6;
    }

LABEL_5:
    a3 = 0;
  }

LABEL_6:

  return a3;
}

uint64_t __55__HMDHome_CarPlay__isActionSetAllowedForCarPlayAccess___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = v3;
  if (v2 && ![v3 type])
  {
    v6 = v4;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = v6;
    }

    else
    {
      v7 = 0;
    }

    v8 = v7;

    if (v8)
    {
      v9 = [v8 characteristic];
      v5 = [HMDHome isCharacteristicAllowedForCarPlayAccess:v9];
    }

    else
    {
      v5 = 0;
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (uint64_t)isCharacteristicAllowedForCarPlayAccess:(void *)a1
{
  v1 = [a1 service];
  v2 = [v1 serviceType];

  if ([v2 isEqualToString:*MEMORY[0x277CD0E58]])
  {
    v3 = 1;
  }

  else
  {
    v3 = [v2 isEqualToString:*MEMORY[0x277CD0EB0]];
  }

  return v3;
}

- (BOOL)isCarPlayAccessAllowedForCharacteristic:(id)a3 withMessage:(id)a4 fromSource:(unint64_t)a5
{
  v23 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a4;
  if (([(HMDHome *)self isMessageEntitledForCarPlayAccess:v9 source:a5]& 1) == 0)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v17 = 138543874;
      v18 = v14;
      v19 = 2112;
      v20 = v8;
      v21 = 2048;
      v22 = a5;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@CarPlay access is not allowed for characteristic: %@ because message from source: %lu does not have sufficient entitlements", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    goto LABEL_9;
  }

  if (!self || [(HMDHome *)self homeLocation]!= 1 && [(HMDHome *)self homeLocation]!= 3)
  {
LABEL_9:
    v10 = 0;
    goto LABEL_10;
  }

  v10 = [HMDHome isCharacteristicAllowedForCarPlayAccess:v8];
LABEL_10:

  v15 = *MEMORY[0x277D85DE8];
  return v10;
}

- (BOOL)synchronouslyFetchIsConnectedToCarPlayNetwork
{
  v2 = [(HMDHome *)self carPlayDataSource];
  v3 = [v2 synchronouslyFetchIsConnectedToCarPlayNetwork];

  return v3;
}

- (BOOL)synchronouslyFetchIsCarPlayConnectedStatus
{
  v2 = [(HMDHome *)self carPlayDataSource];
  v3 = [v2 synchronouslyFetchIsCarPlayConnectedStatus];

  return v3;
}

- (NSDictionary)assistantObject
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self name];

  if (v3)
  {
    v16[0] = *MEMORY[0x277D48158];
    v4 = [(HMDHome *)self name:@"objectType"];
    v16[1] = v4;
    v15[2] = @"objectIdentifier";
    v5 = [(HMDHome *)self urlString];
    v16[2] = v5;
    v15[3] = @"objectHomeIdentifier";
    v6 = [(HMDHome *)self urlString];
    v15[4] = @"objectReference";
    v16[3] = v6;
    v16[4] = self;
    v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v16 forKeys:v15 count:5];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [(HMDHome *)self uuid];
      v12 = [v11 UUIDString];
      *buf = 138543618;
      v18 = v10;
      v19 = 2112;
      v20 = v12;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Skipping because home.name is nil for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v7 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];

  return v7;
}

- (NSString)urlString
{
  v2 = *MEMORY[0x277CCF290];
  v3 = [(HMDHome *)self uuid];
  v4 = hm_assistantIdentifier();

  return v4;
}

- (id)multiUserSettings
{
  v47 = *MEMORY[0x277D85DE8];
  v42 = 0;
  v43 = &v42;
  v44 = 0x2020000000;
  v45 = 0;
  v38 = 0;
  v39 = &v38;
  v40 = 0x2020000000;
  v41 = 0;
  v2 = [(HMDHome *)self users];
  v3 = [v2 count];
  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = v2;
  v4 = [obj countByEnumeratingWithState:&v34 objects:v46 count:16];
  v27 = v3;
  v5 = 0;
  v6 = 0;
  if (v4)
  {
    v28 = 0;
    v29 = 0;
    v7 = 0;
    v30 = 0;
    v32 = 0;
    v8 = *v35;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v10 = *(*(&v34 + 1) + 8 * i);
        if (([v10 isOwner] & 1) == 0)
        {
          v11 = [v10 sharedSettingValuesByKeyPath];
          v12 = [v11 mutableCopy];

          if ([v12 count])
          {
            v33[0] = MEMORY[0x277D85DD0];
            v33[1] = 3221225472;
            v33[2] = __54__HMDHome_MultiUserSettingsMetrics__multiUserSettings__block_invoke;
            v33[3] = &unk_27972BBF8;
            v33[4] = &v42;
            v33[5] = &v38;
            [v12 enumerateKeysAndObjectsUsingBlock:v33];
            ++v32;
          }

          else
          {
            v13 = [v10 cloudShareTrustManager];
            v14 = [v13 isTrustConfigured];

            v15 = [v10 sharedUserSettingsLogEventBackingStoreControllerRunState];
            v16 = v28;
            v29 += v14 ^ 1u;
            if (v15 == 5)
            {
              v17 = v6 + 1;
            }

            else
            {
              v17 = v6;
            }

            if (v15 == 4)
            {
              v18 = v5 + 1;
            }

            else
            {
              v18 = v5;
            }

            if (v15 == 4)
            {
              v17 = v6;
            }

            if (v15 == 3)
            {
              v18 = v5;
              v17 = v6;
              v19 = v28 + 1;
            }

            else
            {
              v19 = v28;
            }

            if (v15 == 2)
            {
              v20 = v7 + 1;
            }

            else
            {
              v20 = v7;
            }

            if (v15 < 2)
            {
              v20 = v7;
            }

            v21 = v30;
            if (v15 >= 2)
            {
              v22 = v30;
            }

            else
            {
              v22 = v30 + 1;
            }

            if (v15 > 2)
            {
              v5 = v18;
              v6 = v17;
              v16 = v19;
            }

            v28 = v16;
            if (v15 <= 2)
            {
              v7 = v20;
              v21 = v22;
            }

            v30 = v21;
          }
        }
      }

      v4 = [obj countByEnumeratingWithState:&v34 objects:v46 count:16];
    }

    while (v4);
  }

  else
  {
    v28 = 0;
    v29 = 0;
    v7 = 0;
    v30 = 0;
    v32 = 0;
  }

  v23 = objc_alloc(MEMORY[0x277CD1C20]);
  v24 = [v23 initWithNumSharedUsers:(v27 - 1) & ~((v27 - 1) >> 63) numUsersWithSettings:v32 numUsersWithIdentifyVoiceOff:v43[3] numUsersWithPlayBackInfluencesForYouOff:v39[3] numUsersCloudShareTrustNotConfigured:v29 numUsersSharedBackingStoreNotStarted:v30 numUsersSharedBackingStoreRunning:v7 numUsersSharedBackingStoreNotRunningDueToError:v28 numUsersSharedBackingStoreNotRunningDueToStopped:v5 numUsersSharedBackingStoreSharedZoneWaitingForShareInvitation:v6];

  _Block_object_dispose(&v38, 8);
  _Block_object_dispose(&v42, 8);
  v25 = *MEMORY[0x277D85DE8];

  return v24;
}

void __54__HMDHome_MultiUserSettingsMetrics__multiUserSettings__block_invoke(uint64_t a1, void *a2, void *a3)
{
  v14 = a2;
  v5 = a3;
  if ([v14 isEqualToString:@"shared.root.siri.identifyVoice"])
  {
    v6 = v5;
    objc_opt_class();
    v7 = (objc_opt_isKindOfClass() & 1) != 0 ? v6 : 0;
    v8 = v7;

    v9 = [v8 intValue];
    if (!v9)
    {
      ++*(*(*(a1 + 32) + 8) + 24);
    }
  }

  if ([v14 isEqualToString:@"shared.root.music.playbackInfluencesForYou"])
  {
    v10 = v5;
    objc_opt_class();
    v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
    v12 = v11;

    v13 = [v12 intValue];
    if (!v13)
    {
      ++*(*(*(a1 + 40) + 8) + 24);
    }
  }
}

- (void)_evaluateNetworkProtectionSupport
{
  v2 = self;
  v86 = *MEMORY[0x277D85DE8];
  v66 = 0u;
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  v3 = [(HMDHome *)self residentDeviceManager];
  v4 = [v3 residentDevices];

  v5 = [v4 countByEnumeratingWithState:&v66 objects:v85 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v67;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v67 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v66 + 1) + 8 * i);
        v10 = [v9 device];
        if ([v9 isEnabled])
        {
          v11 = [v9 capabilities];
          v12 = [v11 supportsRouterManagement];

          if (v12)
          {
            v13 = [(HMDHome *)v2 minimumNetworkRouterSupportHomeKitVersion];
            if (!v13)
            {
              goto LABEL_13;
            }

            v14 = v13;
            v15 = [v10 version];
            [(HMDHome *)v2 minimumNetworkRouterSupportHomeKitVersion];
            v16 = v7;
            v17 = v4;
            v19 = v18 = v2;
            v64 = [v15 isAtLeastVersion:v19];

            v2 = v18;
            v4 = v17;
            v7 = v16;

            if (v64)
            {
LABEL_13:
              v21 = objc_autoreleasePoolPush();
              v22 = v2;
              v23 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
              {
                HMFGetLogIdentifier();
                v25 = v24 = v2;
                *buf = 138543618;
                v76 = v25;
                v77 = 2112;
                v78 = v9;
                _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Found resident with router management support: %@", buf, 0x16u);

                v2 = v24;
              }

              objc_autoreleasePoolPop(v21);
              v20 = 1;
              goto LABEL_16;
            }
          }
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v66 objects:v85 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v20 = 0;
LABEL_16:

  v26 = [(HMDHome *)v2 activeNetworkRouterAccessory];

  v27 = [(HMDHome *)v2 _isNetworkRouterSupportEnabledForCurrentDevice];
  v28 = objc_autoreleasePoolPush();
  v29 = v2;
  v30 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
  {
    v31 = v27;
    v32 = HMFGetLogIdentifier();
    v33 = [(HMDHome *)v29 name];
    v34 = HMFBooleanToString();
    v35 = HMFBooleanToString();
    HMFBooleanToString();
    v36 = v65 = v28;
    *buf = 138544386;
    v76 = v32;
    v77 = 2112;
    v78 = v33;
    v79 = 2112;
    v80 = v34;
    v81 = 2112;
    v82 = v35;
    v83 = 2112;
    v84 = v36;
    _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@Evaluating network protection support for home %@, Router Managing Device: %@, Active Network Router Accessory: %@, Router support enabled: %@", buf, 0x34u);

    v28 = v65;
    v27 = v31;
  }

  objc_autoreleasePoolPop(v28);
  v37 = [(HMDHome *)v29 minHomeKitVersionForAccessoryNetworkProtectionChange];
  if (v37)
  {
    v38 = v37;
    v39 = [(HMDHome *)v29 minHomeKitVersionForAccessoryNetworkProtectionChange];
    v40 = +[HMDHomeKitVersion currentVersion];
    v41 = [v39 isGreaterThanVersion:v40];

    v42 = v41 ^ 1;
  }

  else
  {
    v42 = 1;
  }

  v43 = [(HMDHome *)v29 isAdminUser];
  v44 = 4;
  if (v43)
  {
    v44 = 0;
  }

  if (!v26)
  {
    v44 |= 8uLL;
  }

  v45 = v44 | v20 ^ 1u;
  if (!v27)
  {
    v45 |= 2uLL;
  }

  if (v42)
  {
    v46 = v45;
  }

  else
  {
    v46 = v45 | 0x10;
  }

  if ([(HMDHome *)v29 networkRouterSupportDisableReason]!= v46)
  {
    [(HMDHome *)v29 setNetworkRouterSupportDisableReason:v46];
    [(HMDHome *)v29 setNetworkRouterSupport:[(HMDHome *)v29 deriveNetworkRouterSupport:v46]];
    v47 = ([(HMDHome *)v29 networkRouterSupport]>> 2) & 1;
    v48 = MEMORY[0x277D0F848];
    v49 = *MEMORY[0x277CD0470];
    v50 = [(HMDHome *)v29 messageDestination];
    v72 = *MEMORY[0x277CD0468];
    v51 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v46];
    v74[0] = v51;
    v73 = *MEMORY[0x277CCFE18];
    v52 = v73;
    v53 = [MEMORY[0x277CCABB0] numberWithBool:v47];
    v74[1] = v53;
    v54 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v74 forKeys:&v72 count:2];
    v55 = [v48 messageWithName:v49 destination:v50 payload:v54];

    [v55 setRequiresSPIEntitlement];
    v56 = [(HMDHome *)v29 msgDispatcher];
    [v56 sendMessage:v55 completionHandler:0];

    v57 = MEMORY[0x277D0F848];
    v58 = [(HMDHome *)v29 messageDestination];
    v70 = v52;
    v59 = [MEMORY[0x277CCABB0] numberWithBool:v47];
    v71 = v59;
    v60 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v71 forKeys:&v70 count:1];
    v61 = [v57 messageWithName:v49 destination:v58 payload:v60];

    [v61 setRequiresNoSPIEntitlement];
    v62 = [(HMDHome *)v29 msgDispatcher];
    [v62 sendMessage:v61 completionHandler:0];
  }

  v63 = *MEMORY[0x277D85DE8];
}

- (void)_requestRemoveClientConfigurationWithIdentifier:(id)a3
{
  location[3] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self residentDeviceManager];
  v6 = [v5 primaryResidentDevice];
  v7 = [v6 device];

  if (v7)
  {
    v8 = [HMDRemoteDeviceMessageDestination alloc];
    v9 = [(HMDHome *)self uuid];
    v10 = [(HMDRemoteDeviceMessageDestination *)v8 initWithTarget:v9 device:v7];

    v11 = objc_alloc(MEMORY[0x277D0F848]);
    v26 = @"HMDH.NetworkClientIdentifierMessageKey";
    v27 = v4;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
    v13 = [v11 initWithName:@"HMDHomeRemoveClientConfigurationRequestKey" destination:v10 payload:v12];

    [v13 setSecureRemote:1];
    objc_initWeak(location, self);
    v20 = MEMORY[0x277D85DD0];
    v21 = 3221225472;
    v22 = __82__HMDHome_NetworkRouterInternal___requestRemoveClientConfigurationWithIdentifier___block_invoke;
    v23 = &unk_279733AE8;
    objc_copyWeak(&v25, location);
    v24 = v4;
    [v13 setResponseHandler:&v20];
    v14 = [(HMDHome *)self msgDispatcher:v20];
    [v14 sendMessage:v13 completionHandler:0];

    objc_destroyWeak(&v25);
    objc_destroyWeak(location);
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v18;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request to remove client configuration", location, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  v19 = *MEMORY[0x277D85DE8];
}

void __82__HMDHome_NetworkRouterInternal___requestRemoveClientConfigurationWithIdentifier___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = v10;
    if (v5)
    {
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        v20 = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = v5;
        v14 = "%{public}@Request to remove client configuration %@ failed with error: %@";
        v15 = v11;
        v16 = OS_LOG_TYPE_ERROR;
        v17 = 32;
LABEL_7:
        _os_log_impl(&dword_2531F8000, v15, v16, v14, &v20, v17);
      }
    }

    else if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v18 = *(a1 + 32);
      v20 = 138543618;
      v21 = v12;
      v22 = 2112;
      v23 = v18;
      v14 = "%{public}@Request remove client configuration %@ successful";
      v15 = v11;
      v16 = OS_LOG_TYPE_INFO;
      v17 = 22;
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)_removeClientConfigurationWithIdentifier:(id)a3 completion:(id)a4
{
  v28 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [(HMDHome *)self activeNetworkRouterAccessory];
  v9 = [v8 networkRouterController];

  if (v9)
  {
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __86__HMDHome_NetworkRouterInternal___removeClientConfigurationWithIdentifier_completion___block_invoke;
    v19[3] = &unk_279735168;
    v19[4] = self;
    v20 = v6;
    v21 = v7;
    [v9 removeClientConfigurationWithClientIdentifier:v20 completion:v19];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [(HMDHome *)v11 activeNetworkRouterAccessory];
      v15 = [v14 uuid];
      v16 = [v15 UUIDString];
      *buf = 138543874;
      v23 = v13;
      v24 = 2112;
      v25 = v6;
      v26 = 2112;
      v27 = v16;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove client configuration %@ due to no router controller found on the active network router %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    if (v7)
    {
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (*(v7 + 2))(v7, v17);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __86__HMDHome_NetworkRouterInternal___removeClientConfigurationWithIdentifier_completion___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 40);
      v16 = 138543874;
      v17 = v8;
      v18 = 2112;
      v19 = v9;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove client configuration %@ due to error %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = *(v10 + 16);
LABEL_10:
      v11();
    }
  }

  else
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = *(a1 + 40);
      v16 = 138543618;
      v17 = v12;
      v18 = 2112;
      v19 = v13;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Removed client configuration %@ successfully", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v14 = *(a1 + 48);
    if (v14)
    {
      v11 = *(v14 + 16);
      goto LABEL_10;
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_removeClientConfigurationWithIdentifier:(id)a3
{
  v4 = a3;
  if ([(HMDHome *)self isOwnerUser])
  {
    [(HMDHome *)self _removeClientConfigurationWithIdentifier:v4 completion:0];
  }

  else
  {
    [(HMDHome *)self _requestRemoveClientConfigurationWithIdentifier:v4];
  }
}

- (void)_requestUniquePSKClientConfigurationWithCompletion:(id)a3
{
  location[3] = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [(HMDHome *)self residentDeviceManager];
  v6 = [v5 primaryResidentDevice];
  v7 = [v6 device];

  if (v7)
  {
    v8 = [HMDRemoteDeviceMessageDestination alloc];
    v9 = [(HMDHome *)self uuid];
    v10 = [(HMDRemoteDeviceMessageDestination *)v8 initWithTarget:v9 device:v7];

    v11 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeCreateUniquePSKClientConfigurationRequestKey" destination:v10 payload:0];
    [v11 setSecureRemote:1];
    objc_initWeak(location, self);
    v18 = MEMORY[0x277D85DD0];
    v19 = 3221225472;
    v20 = __85__HMDHome_NetworkRouterInternal___requestUniquePSKClientConfigurationWithCompletion___block_invoke;
    v21 = &unk_2797355F8;
    objc_copyWeak(&v23, location);
    v22 = v4;
    [v11 setResponseHandler:&v18];
    v12 = [(HMDHome *)self msgDispatcher:v18];
    [v12 sendMessage:v11 completionHandler:0];

    objc_destroyWeak(&v23);
    objc_destroyWeak(location);
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v16;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request unique PSK from", location, 0xCu);
    }

    objc_autoreleasePoolPop(v13);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    (*(v4 + 2))(v4, 0, v10);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __85__HMDHome_NetworkRouterInternal___requestUniquePSKClientConfigurationWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v45 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v38 = v11;
        v39 = 2112;
        v40 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for unique PSK failed with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:@"HMDH.UniquePSKMessageKey"];
      v13 = [v6 hmf_numberForKey:@"HMDH.NetworkClientIdentifierMessageKey"];
      v14 = objc_alloc(MEMORY[0x277CCAD78]);
      v15 = [v6 hmf_stringForKey:@"HMDH.NetworkRouterUUIDMessageKey"];
      v16 = [v14 initWithUUIDString:v15];

      v17 = objc_autoreleasePoolPush();
      v18 = WeakRetained;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        HMFGetLogIdentifier();
        v33 = v17;
        v21 = v20 = v13;
        HMFBooleanToString();
        v22 = v34 = v12;
        [v16 UUIDString];
        v23 = v35 = v16;
        *buf = 138544130;
        v38 = v21;
        v39 = 2112;
        v40 = v22;
        v41 = 2112;
        v42 = v20;
        v43 = 2112;
        v44 = v23;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Request for unique PSK results successful. PSK: %@, Client Identifier: %@, Network Router UUID: %@", buf, 0x2Au);

        v16 = v35;
        v12 = v34;

        v13 = v20;
        v17 = v33;
      }

      objc_autoreleasePoolPop(v17);
      if (v12 && v13 && v16)
      {
        v24 = [[HMDAccessoryNetworkCredential alloc] initWithNetworkRouterUUID:v16 clientIdentifier:v13 wiFiPSK:v12];
        v25 = *(*(a1 + 32) + 16);
      }

      else
      {
        v26 = objc_autoreleasePoolPush();
        v27 = v18;
        v28 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v36 = v16;
          v30 = v29 = v13;
          *buf = 138543362;
          v38 = v30;
          _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_ERROR, "%{public}@Missing info in response", buf, 0xCu);

          v13 = v29;
          v16 = v36;
        }

        objc_autoreleasePoolPop(v26);
        v31 = *(a1 + 32);
        v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        v25 = *(v31 + 16);
      }

      v25();
    }
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)_createUniquePSKClientConfigurationWithRequestMessage:(id)a3 pairingEvent:(id)a4 completion:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __112__HMDHome_NetworkRouterInternal___createUniquePSKClientConfigurationWithRequestMessage_pairingEvent_completion___block_invoke;
  aBlock[3] = &unk_27972CA80;
  objc_copyWeak(&v19, &location);
  v11 = v9;
  v16 = v11;
  v12 = v8;
  v17 = v12;
  v13 = v10;
  v18 = v13;
  v14 = _Block_copy(aBlock);
  [(HMDHome *)self _requestUniquePSKClientConfigurationWithCompletion:v14];

  objc_destroyWeak(&v19);
  objc_destroyWeak(&location);
}

void __112__HMDHome_NetworkRouterInternal___createUniquePSKClientConfigurationWithRequestMessage_pairingEvent_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v11 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v7 = *(a1 + 48);
    if (v5)
    {
      v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:98 description:0 reason:0 suggestion:0 underlyingError:v5];
      (*(v7 + 16))(v7, v11, v8);
    }

    else
    {
      (*(v7 + 16))(v7, v11, 0);
    }
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];

    if (*(a1 + 32))
    {
      v10 = +[HMDMetricsManager sharedLogEventSubmitter];
      [v10 submitLogEvent:*(a1 + 32) error:v9];
    }

    [*(a1 + 40) respondWithError:v9];
  }
}

- (void)_evaluateNetworkProtectionAndRouterManagement
{
  v23 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self _evaluateNetworkProtectionSupport];
  v3 = [(HMDHome *)self activeNetworkRouterAccessory];
  v4 = [v3 networkRouterController];

  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v4)
  {
    if (v8)
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v3 uuid];
      v11 = [v10 UUIDString];
      v12 = [v3 name];
      v17 = 138543874;
      v18 = v9;
      v19 = 2112;
      v20 = v11;
      v21 = 2112;
      v22 = v12;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Found active network router accessory %@/%@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 _configureNetworkRouterClientManager:v3];
  }

  else
  {
    if (v8)
    {
      v13 = HMFGetLogIdentifier();
      v14 = [(HMDHome *)v6 activeNetworkRouterUUID];
      v15 = [v3 name];
      v17 = 138543874;
      v18 = v13;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = v15;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@No active network router accessory with router info %@/%@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)v6 _unconfigureNetworkRouterClientManager];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleNetworkProtectionModeChangeForTransaction:(id)a3
{
  v5 = a3;
  v4 = [v5 userInfo];
  [v4 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"NetworkProtectionModeChanged"];

  [(HMDHome *)self _scheduleApplyNetworkRouterSettingsAction:v5];
}

- (void)_evaluateNetworkRouterManagementForTransaction:(id)a3
{
  v5 = a3;
  v4 = [v5 userInfo];
  [v4 setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"EvaluateRouterManagement"];

  [(HMDHome *)self _scheduleApplyNetworkRouterSettingsAction:v5];
}

- (void)_scheduleApplyNetworkRouterSettingsAction:(id)a3
{
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke;
  v3[3] = &unk_27972CA58;
  v3[4] = self;
  [a3 addPostApplyActionIfNotPresent:@"HMDNetworkRouterApplySettingsAction" usingBlock:v3];
}

void __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke_2;
  v7[3] = &unk_2797359B0;
  v5 = *(a1 + 32);
  v8 = v3;
  v9 = v5;
  v6 = v3;
  dispatch_async(v4, v7);
}

void __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"EvaluateRouterManagement"];

  if (v3)
  {
    [*(a1 + 40) _evaluateNetworkProtectionAndRouterManagement];
  }

  v4 = [*(a1 + 32) userInfo];
  v5 = [v4 objectForKeyedSubscript:@"NetworkProtectionModeChanged"];

  if (v5)
  {
    v6 = [MEMORY[0x277CCAB98] defaultCenter];
    [v6 postNotificationName:@"HMDHomeNetworkProtectionUpdatedNotificationKey" object:*(a1 + 40)];
  }
}

- (void)handleAccessoryDidRemoveNetworkRouterControllerNotification:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __94__HMDHome_NetworkRouterInternal__handleAccessoryDidRemoveNetworkRouterControllerNotification___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __94__HMDHome_NetworkRouterInternal__handleAccessoryDidRemoveNetworkRouterControllerNotification___block_invoke(uint64_t a1)
{
  v17 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"HMDNetworkRouterAccessoryNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (!v5)
  {
    _HMFPreconditionFailure();
  }

  v6 = [*(a1 + 40) activeNetworkRouterAccessory];
  v7 = [v6 isEqual:v5];
  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 40);
  v10 = HMFGetOSLogHandle();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
  if (v7)
  {
    if (v11)
    {
      v12 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed network router profile for active network router accessory", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    [*(a1 + 40) _addTransactionForActiveNetworkRouterAccessory:0 isReplacement:0];
  }

  else
  {
    if (v11)
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v13;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed network router profile for non-active network router accessory", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)handleAccessoryDidAddNetworkRouterControllerNotification:(id)a3
{
  v4 = a3;
  v5 = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __91__HMDHome_NetworkRouterInternal__handleAccessoryDidAddNetworkRouterControllerNotification___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = v4;
  v9 = self;
  v6 = v4;
  dispatch_async(v5, v7);
}

void __91__HMDHome_NetworkRouterInternal__handleAccessoryDidAddNetworkRouterControllerNotification___block_invoke(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"HMDNetworkRouterAccessoryNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (!v5)
  {
    _HMFPreconditionFailure();
  }

  v6 = [v5 uuid];
  v7 = [*(a1 + 40) activeNetworkRouterUUID];
  v8 = [v6 isEqual:v7];

  v9 = objc_autoreleasePoolPush();
  v10 = *(a1 + 40);
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v8)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      v14 = [v5 uuid];
      v19 = 138543618;
      v20 = v13;
      v21 = 2112;
      v22 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Added network router controller is for active network router accessory %@", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    [*(a1 + 40) _evaluateNetworkProtectionAndRouterManagement];
  }

  else
  {
    if (v12)
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v5 uuid];
      v17 = [*(a1 + 40) activeNetworkRouterUUID];
      v19 = 138543874;
      v20 = v15;
      v21 = 2112;
      v22 = v16;
      v23 = 2112;
      v24 = v17;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Ignoring added network router controller for accessory %@ since it is not for the active network router accessory %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_unconfigureNetworkRouterClientManager
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self routerClientManager];
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Shutting down firewall rule manager and network router client manager", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [v3 stop];
    [(HMDHome *)v5 setRouterClientManager:0];
    v8 = +[HMDNetworkRouterFirewallRuleManager sharedInstance];
    [v8 shutdownForClient:v3];
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_configureNetworkRouterClientManager:(id)a3
{
  v32 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([(HMDHome *)self supportsRouterManagement])
  {
    v5 = [(HMDHome *)self routerClientManager];

    if (v5)
    {
      v6 = [(HMDHome *)self routerClientManager];
      [v6 replaceActiveNetworkRouterAccessory:v4];
    }

    else
    {
      v7 = objc_autoreleasePoolPush();
      v8 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        v11 = [v4 name];
        v12 = [v4 uuid];
        v13 = [v12 UUIDString];
        *buf = 138543874;
        v27 = v10;
        v28 = 2112;
        v29 = v11;
        v30 = 2112;
        v31 = v13;
        _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Creating network router client manager with accessory %@/%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v7);
      v14 = +[HMDNetworkRouterFirewallRuleManager sharedInstance];
      v15 = [HMDNetworkRouterClientManager alloc];
      v16 = [(HMDHome *)v8 workQueue];
      v17 = [MEMORY[0x277CCAB98] defaultCenter];
      v18 = [(HMDNetworkRouterClientManager *)v15 initWithNetworkRouterAccessory:v4 workQueue:v16 firewallRuleManager:v14 notificationCenter:v17];
      [(HMDHome *)v8 setRouterClientManager:v18];

      v19 = [(HMDHome *)v8 routerClientManager];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke;
      v25[3] = &unk_2797359D8;
      v25[4] = v8;
      [v14 startupForClient:v19 completion:v25];

      v20 = [(HMDHome *)v8 residentDeviceManager];
      v21 = [(HMDHome *)v8 routerClientManager];
      [v20 addDataSource:v21];

      v22 = [(HMDHome *)v8 residentDeviceManager];
      v24[0] = MEMORY[0x277D85DD0];
      v24[1] = 3221225472;
      v24[2] = __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke_84;
      v24[3] = &unk_2797359D8;
      v24[4] = v8;
      [v22 confirmWithCompletionHandler:v24];
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543618;
      v11 = v7;
      v12 = 2112;
      v13 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Firewall rule manager failed to start with error %@", &v10, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  else
  {
    v8 = [*(a1 + 32) routerClientManager];
    [v8 evaluateManagement];
  }

  v9 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke_84(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543618;
    v10 = v7;
    v11 = 2112;
    v12 = v3;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Confirming primary resident with active network router in the home completed with %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveClientConfiguration:(id)a3
{
  v16 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v15 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Received request to remove a client configuration", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 numberForKey:@"HMDH.NetworkClientIdentifierMessageKey"];
  if (v9)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __67__HMDHome_NetworkRouterInternal___handleRemoveClientConfiguration___block_invoke;
    v12[3] = &unk_2797359D8;
    v13 = v4;
    [(HMDHome *)v6 _removeClientConfigurationWithIdentifier:v9 completion:v12];
    v10 = v13;
  }

  else
  {
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [v4 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

uint64_t __67__HMDHome_NetworkRouterInternal___handleRemoveClientConfiguration___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithPayload:0];
  }
}

- (void)_handleCreateUniquePSKClientConfiguration:(id)a3
{
  v41 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    *&buf[4] = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Received request to create a unique PSK client configuration", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [(HMDHome *)v6 activeNetworkRouterAccessory];
  v28 = MEMORY[0x277D85DD0];
  v29 = 3221225472;
  v30 = __76__HMDHome_NetworkRouterInternal___handleCreateUniquePSKClientConfiguration___block_invoke;
  v31 = &unk_27972CA30;
  v32 = v6;
  v33 = v4;
  v10 = v4;
  v11 = v9;
  v12 = &v28;
  v13 = generateWiFiUniquePreSharedKey();
  v14 = [v13 dataUsingEncoding:{1, v28, v29}];

  v15 = [v11 networkRouterController];
  v16 = v15;
  if (v14 && v15)
  {
    v17 = [HMDNetworkRouterClientConfiguration configurationForOpenProtectionWithClientIdentifier:0];
    v18 = objc_alloc_init(HMDNetworkRouterCredential);
    [v17 setCredential:v18];

    v19 = [v17 credential];
    [v19 setPsk:v14];

    *buf = MEMORY[0x277D85DD0];
    *&buf[8] = 3221225472;
    *&buf[16] = __HMDCreateUniquePSKClientConfiguration_block_invoke;
    v35 = &unk_279732B10;
    v40 = v12;
    v20 = v16;
    v36 = v20;
    v37 = v17;
    v38 = v11;
    v39 = v14;
    v21 = v17;
    [v20 writeManagedNetworkEnable:1 completion:buf];
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      v25 = v24;
      v26 = @"no router controller found";
      if (v16)
      {
        v26 = @"PSK generation";
      }

      *buf = 138543618;
      *&buf[4] = v24;
      *&buf[12] = 2112;
      *&buf[14] = v26;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Failed to create unique PSK client configuration due to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
    v30(v12, 0, v21);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __76__HMDHome_NetworkRouterInternal___handleCreateUniquePSKClientConfiguration___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v6)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v26 = v11;
      v27 = 2112;
      v28 = v6;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to create a unique PSK client configuration with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    [*(a1 + 40) respondWithError:v6];
  }

  else
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v5 clientIdentifier];
      v14 = [v5 networkRouterUUID];
      v15 = [v14 UUIDString];
      *buf = 138543874;
      v26 = v12;
      v27 = 2112;
      v28 = v13;
      v29 = 2112;
      v30 = v15;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Created unique PSK client configuration with client identifier %@ on network router %@ for remote request", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
    v16 = *(a1 + 40);
    v17 = [v5 clientIdentifier];
    v24[0] = v17;
    v23[1] = @"HMDH.UniquePSKMessageKey";
    v18 = [v5 wiFiPSK];
    v24[1] = v18;
    v23[2] = @"HMDH.NetworkRouterUUIDMessageKey";
    v19 = [v5 networkRouterUUID];
    v20 = [v19 UUIDString];
    v24[2] = v20;
    v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v24 forKeys:v23 count:3];
    [v16 respondWithPayload:v21];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3
{
  v7 = a3;
  v4 = [v7 stringForKey:@"kHomedVersionKey"];
  if (v4)
  {
    v5 = [[HMDHomeKitVersion alloc] initWithString:v4];
    if (v5)
    {
      [(HMDHome *)self _addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:v5 message:v7];
    }

    else
    {
      v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v7 respondWithError:v6];
    }
  }

  else
  {
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v7 respondWithError:v5];
  }
}

- (void)_handleSetMinimumNetworkRouterHomeKitVersion:(id)a3
{
  v23 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 stringForKey:@"kHomedVersionKey"];
  v6 = [[HMDHomeKitVersion alloc] initWithString:v5];
  if (v6)
  {
    v7 = +[HMDHomeKitVersion currentVersion];
    if ([v7 isGreaterThanVersion:v6])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = [(HMDHomeKitVersion *)v6 versionString];
        [v7 versionString];
        v13 = v16 = v8;
        *buf = 138543874;
        v18 = v11;
        v19 = 2112;
        v20 = v12;
        v21 = 2112;
        v22 = v13;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Attempting to set the network router support HomeKit version to %@ - lower than version of HomeKit on this device - %@", buf, 0x20u);

        v8 = v16;
      }

      objc_autoreleasePoolPop(v8);
    }

    [(HMDHome *)self _addTransactionForMinimumNetworkRouterHomeKitVersion:v6 message:v4];
  }

  else
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v14];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateNetworkProtection:(id)a3
{
  v22 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = [v4 numberForKey:*MEMORY[0x277CD23D8]];
  if (!v5)
  {
    v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
LABEL_9:
    [v4 respondWithError:v7];
    goto LABEL_10;
  }

  v15 = 0;
  v6 = [(HMDHome *)self checkForNetworkRouterSupport:1 error:&v15];
  v7 = v15;
  if (!v6)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v12 = HMDNetworkRouterSupportAsString([(HMDHome *)v9 networkRouterSupport]);
      *buf = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = v12;
      v20 = 2112;
      v21 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot update home network protection mode - networkRouterSupport %@ error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    goto LABEL_9;
  }

  if ([v5 integerValue] > 1)
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v4 respondWithError:v14];
  }

  else
  {
    [(HMDHome *)self _addTransactionWithProtectionMode:v5 message:v4];
  }

LABEL_10:

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:(id)a3 message:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [HMDHomeNetworkRouterSettingsModel alloc];
  v9 = [(HMDHome *)self uuid];
  v10 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:v9];
  v11 = [(HMDHome *)self uuid];
  v16 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v10 parentUUID:v11];

  v12 = [v7 versionString];

  [(HMDHomeNetworkRouterSettingsModel *)v16 setMinHomeKitVersionForAccessoryNetworkProtectionChange:v12];
  v13 = [(HMDHome *)self backingStore];
  v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v15 = [v13 transaction:@"Update Minimum HomeKit Version For Accessory Network Protection Change" options:v14];

  [v15 add:v16 withMessage:v6];
  [v15 run];
}

- (void)_addTransactionForMinimumNetworkRouterHomeKitVersion:(id)a3 message:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [HMDHomeNetworkRouterSettingsModel alloc];
  v9 = [(HMDHome *)self uuid];
  v10 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:v9];
  v11 = [(HMDHome *)self uuid];
  v16 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v10 parentUUID:v11];

  v12 = [v7 versionString];

  [(HMDHomeNetworkRouterSettingsModel *)v16 setMinimumNetworkRouterSupportHomeKitVersion:v12];
  v13 = [(HMDHome *)self backingStore];
  v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v15 = [v13 transaction:@"Update Minimum Network Router Support HomeKit Version" options:v14];

  [v15 add:v16 withMessage:v6];
  [v15 run];
}

- (void)_clearAccessoryNetworkProtectionStateWithTransaction:(id)a3
{
  v20 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v5 = [(HMDHome *)self accessories];
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v16;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v16 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v15 + 1) + 8 * i);
        v11 = [v10 networkRouterUUID];
        if (v11)
        {
        }

        else
        {
          v12 = [v10 networkClientIdentifier];

          if (!v12)
          {
            continue;
          }
        }

        v13 = [v10 transactionWithObjectChangeType:2];
        [v13 setNetworkRouterUUID:0];
        [v13 setNetworkClientIdentifier:0];
        [v13 setNetworkClientProfileFingerprint:0];
        [v13 setAppliedFirewallWANRules:0];
        [v13 setNetworkClientLAN:&unk_286629008];
        [v13 setCurrentNetworkProtectionMode:&unk_286629020];
        [v4 add:v13];
      }

      v7 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v7);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_updateActiveNetworkRouterAccessory:(id)a3 isReplacement:(BOOL)a4 withTransaction:(id)a5
{
  v5 = a4;
  v22 = a5;
  v8 = a3;
  v9 = [HMDHomeNetworkRouterSettingsModel alloc];
  v10 = [(HMDHome *)self uuid];
  v11 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:v10];
  v12 = [(HMDHome *)self uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:v11 parentUUID:v12];

  v14 = [v8 uuid];

  v15 = [v14 UUIDString];

  [(HMDHomeNetworkRouterSettingsModel *)v13 setActiveNetworkRouterAccessoryUUID:v15];
  if (v5)
  {
    v16 = 0;
  }

  else
  {
    v16 = v15;
  }

  [(HMDHomeNetworkRouterSettingsModel *)v13 setActiveNetworkRouterInitialSetupNeededUUID:v16];
  [v22 add:v13];
  if (!v5)
  {
    v17 = [HMDHomeModel alloc];
    v18 = [(HMDHome *)self uuid];
    v19 = [(HMDHome *)self homeManager];
    v20 = [v19 uuid];
    v21 = [(HMDBackingStoreModelObject *)v17 initWithObjectChangeType:2 uuid:v18 parentUUID:v20];

    [(HMDHomeModel *)v21 setNetworkProtectionMode:&unk_286628FF0];
    [v22 add:v21];
  }
}

- (void)_addTransactionWithProtectionMode:(id)a3 message:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [HMDHomeModel alloc];
  v9 = [(HMDHome *)self uuid];
  v10 = [(HMDHome *)self homeManager];
  v11 = [v10 uuid];
  v12 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v9 parentUUID:v11];

  [(HMDHomeModel *)v12 setNetworkProtectionMode:v7];
  v13 = [(HMDHome *)self backingStore];
  v14 = [v6 name];
  v15 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v16 = [v13 transaction:v14 options:v15];

  [v16 add:v12 withMessage:v6];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __76__HMDHome_NetworkRouterInternal___addTransactionWithProtectionMode_message___block_invoke;
  v18[3] = &unk_2797358C8;
  v19 = v6;
  v20 = self;
  v17 = v6;
  [v16 run:v18];
}

void __76__HMDHome_NetworkRouterInternal___addTransactionWithProtectionMode_message___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v8 = *MEMORY[0x277CD23D8];
    v5 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(*(a1 + 40), "protectionMode")}];
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [v2 respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (unint64_t)deriveNetworkRouterSupport:(unint64_t)a3
{
  v3 = a3;
  v4 = 4;
  if ((a3 & 8) == 0)
  {
    v4 = 15;
  }

  if (a3)
  {
    v5 = v4 & 8;
    if ([(HMDHome *)self isOwnerUser])
    {
      v4 = v5;
    }

    else
    {
      v4 = 0;
    }
  }

  if ((v3 & 2) != 0)
  {
    v4 = 0;
  }

  if ((v3 & 4) != 0)
  {
    v4 &= 9u;
  }

  if ((v3 & 0x10) != 0)
  {
    return v4 & 0xFFFFFFFFFFFFFFFDLL;
  }

  else
  {
    return v4;
  }
}

- (BOOL)checkForNetworkRouterSupport:(unint64_t)a3 error:(id *)a4
{
  v5 = a3;
  v6 = [(HMDHome *)self networkRouterSupportDisableReason];
  if ((v5 & 4) != 0)
  {
    if ((v6 & 4) != 0)
    {
      goto LABEL_16;
    }

    if ((v6 & 2) != 0)
    {
      goto LABEL_22;
    }

    if (v6)
    {
      goto LABEL_14;
    }
  }

  if ((v5 & 3) == 0)
  {
    goto LABEL_7;
  }

  if ((v6 & 4) == 0)
  {
    if ((v6 & 8) != 0 || (v6 & 2) != 0)
    {
      goto LABEL_22;
    }

    if (v6)
    {
      goto LABEL_14;
    }

LABEL_7:
    if ((v5 & 2) == 0 || (v6 & 0x10) == 0)
    {
      if ((v5 & 8) == 0)
      {
        return 1;
      }

      if ((v6 & 8) == 0 && (v6 & 2) == 0)
      {
        if ((v6 & 1) == 0)
        {
          return 1;
        }

LABEL_14:
        if (a4)
        {
          v8 = 92;
LABEL_24:
          v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:v8];
          v10 = v9;
          result = 0;
          *a4 = v9;
          return result;
        }

        return 0;
      }
    }

LABEL_22:
    if (a4)
    {
      v8 = 48;
      goto LABEL_24;
    }

    return 0;
  }

LABEL_16:
  if (a4)
  {
    v8 = 17;
    goto LABEL_24;
  }

  return 0;
}

- (HMDHAPAccessory)activeNetworkRouterAccessory
{
  v3 = [(HMDHome *)self activeNetworkRouterUUID];
  v4 = [(HMDHome *)self accessoryWithUUID:v3];

  v5 = v4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  return v6;
}

- (NSArray)wiFiRouterAccessories
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] arrayWithCapacity:1];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v4 = [(HMDHome *)self accessories];
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 networkRouterController];

        if (v12)
        {
          [v3 addObject:v11];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (BOOL)supportsRouterManagement
{
  if (![(HMDHome *)self _isNetworkRouterSupportEnabledForCurrentDevice]|| ![(HMDHome *)self isOwnerUser])
  {
    return 0;
  }

  v3 = [(HMDHome *)self _currentDeviceCapabilities];
  v4 = [v3 supportsRouterManagement];

  return v4;
}

- (BOOL)_isNetworkRouterSupportEnabledForCurrentDevice
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = +[HMDHomeKitVersion currentVersion];
  v4 = [(HMDHome *)self minimumNetworkRouterSupportHomeKitVersion];
  if (v4)
  {
    v5 = v4;
    v6 = [(HMDHome *)self minimumNetworkRouterSupportHomeKitVersion];
    v7 = [v6 isGreaterThanVersion:v3];

    if (v7)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = [(HMDHome *)v9 minimumNetworkRouterSupportHomeKitVersion];
        v13 = [v12 versionString];
        v14 = [v3 versionString];
        v30 = 138543874;
        v31 = v11;
        v32 = 2112;
        v33 = v13;
        v34 = 2112;
        v35 = v14;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Network router support requires minimum HomeKit version of %@ - current %@; disabling", &v30, 0x20u);

LABEL_9:
        goto LABEL_10;
      }

      goto LABEL_10;
    }
  }

  v15 = [(HMDHome *)self activeNetworkRouterAccessory];
  v16 = [v15 primaryProfileVersion];
  if (v16)
  {
    v17 = v16;
    v18 = [(HMDHome *)self activeNetworkRouterAccessory];
    v19 = [v18 primaryProfileVersion];
    v20 = [v19 majorVersion];

    if (v20 >= 2)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v21 = MEMORY[0x277CCABB0];
        v22 = [(HMDHome *)v9 activeNetworkRouterAccessory];
        v23 = [v22 primaryProfileVersion];
        v24 = [v21 numberWithUnsignedInteger:{objc_msgSend(v23, "majorVersion")}];
        v30 = 138543874;
        v31 = v11;
        v32 = 2112;
        v33 = v24;
        v34 = 2112;
        v35 = &unk_286628FD8;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Network router major version %@ not supported on this device - only supports up to major version %@; disabling", &v30, 0x20u);

        goto LABEL_9;
      }

LABEL_10:

      objc_autoreleasePoolPop(v8);
      v25 = 0;
      goto LABEL_17;
    }
  }

  else
  {
  }

  v26 = [MEMORY[0x277D0F8D0] sharedPreferences];
  v27 = [v26 preferenceForKey:@"enableNetworkRouterSupport"];

  v25 = !v27 || [v27 BOOLValue];
LABEL_17:

  v28 = *MEMORY[0x277D85DE8];
  return v25;
}

- (id)createAppleMediaAccessoriesStateManagerMetricsDispatcherWithIdentifier:(id)a3 logEventSubmitter:(id)a4
{
  v5 = a4;
  v6 = a3;
  v7 = [[HMDAppleMediaAccessoriesStateManagerMetricsDispatcher alloc] initWithIdentifier:v6 logEventSubmitter:v5];

  return v7;
}

- (id)createMultiuserSettingsMessenger:(id)a3 messageDispatcher:(id)a4
{
  v22 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = [v6 uuid];
    v16 = 138543874;
    v17 = v11;
    v18 = 2112;
    v19 = v12;
    v20 = 2112;
    v21 = v7;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Creating Multiuser settings messenger with current home UUID: %@ message dispatcher: %@", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  v13 = [[HMDMultiuserSettingsMessenger alloc] initWithHome:v6 messageDispatcher:v7];

  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (void)configureMultiuserSettingsMessengerWithMessengerFactory:(id)a3
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = [(HMDHome *)v6 home];
    v14 = 138543618;
    v15 = v8;
    v16 = 2112;
    v17 = v9;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Configuring Multiuser settings messenger %@", &v14, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [(HMDHome *)v6 home];
  v11 = [(HMDHome *)v6 msgDispatcher];
  v12 = [v4 createMultiuserSettingsMessenger:v10 messageDispatcher:v11];

  [v12 registerForMessages];
  [(HMDHome *)v6 setMultiuserSettingsMessenger:v12];

  v13 = *MEMORY[0x277D85DE8];
}

- (BOOL)_processTestModeSkipHH2MigrationOverride:(id)a3 error:(id *)a4
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = [v5 hmf_BOOLForKey:@"kConfigTestingSkipMigrationCheckOverrideKey"];
  v7 = objc_autoreleasePoolPush();
  v8 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v13 = 138543618;
    v14 = v10;
    v15 = 1024;
    v16 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Setting for HH2 skip migration check override to %{BOOL}d", &v13, 0x12u);
  }

  objc_autoreleasePoolPop(v7);
  [(HMDHome *)v8 setOverrideSentinelZoneForConvergencePeriod:v6];

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)isThisHomeMigratedToHH2
{
  v37 = *MEMORY[0x277D85DE8];
  v3 = [(HMDHome *)self homeManager];
  v4 = v3;
  if (!v3 || ([v3 hh2FrameworkSwitch], v5 = objc_claimAutoreleasedReturnValue(), v5, !v5))
  {
    v20 = objc_autoreleasePoolPush();
    v21 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v28 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to find a valid instance of homeManager or this OS is not capable of running ROAR. Marking this home as not migrated to ROAR", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    goto LABEL_11;
  }

  v6 = [(HMDHome *)self owner];
  v7 = [v6 isCurrentUser];

  v8 = [v4 hh2FrameworkSwitch];
  v9 = [v8 checkExistenceOfHH2SentinelZone];

  v10 = objc_autoreleasePoolPush();
  v11 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
  {
    v13 = HMFGetLogIdentifier();
    HMFBooleanToString();
    v14 = v26 = v9;
    v15 = HMFBooleanToString();
    [(HMDHome *)v11 isUpdatedToHH2];
    v16 = HMFBooleanToString();
    HMFBooleanToString();
    v18 = v17 = v10;
    *buf = 138544386;
    v28 = v13;
    v29 = 2112;
    v30 = v14;
    v31 = 2112;
    v32 = v15;
    v33 = 2112;
    v34 = v16;
    v35 = 2112;
    v36 = v18;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEBUG, "%{public}@[HH2 Sentinel zone exist : %@], [isOwner: %@], [Is Shared Home Updated to HH2: %@], [Running in HH2 daemon: %@]", buf, 0x34u);

    v10 = v17;
    v9 = v26;
  }

  objc_autoreleasePoolPop(v10);
  if ((v9 & 1) == 0)
  {
    if ((v7 & 1) == 0)
    {
      goto LABEL_13;
    }

LABEL_11:
    v19 = 0;
    goto LABEL_14;
  }

  if ((v7 & 1) == 0)
  {
LABEL_13:
    v19 = [(HMDHome *)v11 isUpdatedToHH2];
    goto LABEL_14;
  }

  v19 = 1;
LABEL_14:

  v24 = *MEMORY[0x277D85DE8];
  return v19;
}

- (unint64_t)accessNotAllowedReasonCode
{
  v19 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isAccessToHomeAllowed])
  {
    v3 = 1;
  }

  else
  {
    v4 = [(HMDHome *)self homeManager];
    v5 = [v4 isHH1EOLEnabled];

    if (v5)
    {
      v3 = 8;
    }

    else
    {
      v6 = [(HMDHome *)self currentHomeKitVersion];
      v7 = HMDMinimumHomeKitVersionSupportingHH2();
      v8 = [v6 isAtLeastVersion:v7];

      if (v8)
      {
        v3 = 4;
      }

      else
      {
        v3 = 2;
      }
    }
  }

  v9 = objc_autoreleasePoolPush();
  v10 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
  {
    v12 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v12;
    v17 = 2048;
    v18 = v3;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Home access is not allowed with reason code : %lu", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v13 = *MEMORY[0x277D85DE8];
  return v3;
}

- (BOOL)_isAccessToHomeAllowed
{
  if ([(HMDHome *)self isThisHomeMigratedToHH2])
  {
    LOBYTE(v3) = 0;
  }

  else
  {
    v4 = [(HMDHome *)self homeManager];
    v3 = [v4 isHH1EOLEnabled] ^ 1;
  }

  return v3;
}

- (void)storeMigrationCharacteristicsAuthorizationData
{
  v47 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = [(HMDHome *)self currentUser];
  v5 = [v4 isOwner];

  if (v5)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [(HMDHome *)v7 name];
      *buf = 138543618;
      v42 = v9;
      v43 = 2112;
      v44 = v10;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Skipping characteristic authorization archiving for home: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  else
  {
    v11 = [MEMORY[0x277CBEB38] dictionary];
    v12 = [(HMDHome *)self hapAccessories];
    v39[0] = MEMORY[0x277D85DD0];
    v39[1] = 3221225472;
    v39[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke;
    v39[3] = &unk_27972F628;
    v13 = v11;
    v40 = v13;
    [v12 na_each:v39];

    v14 = [v13 count];
    v15 = objc_autoreleasePoolPush();
    v16 = self;
    v17 = HMFGetOSLogHandle();
    v18 = v17;
    if (v14)
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        v20 = [(HMDHome *)v16 name];
        *buf = 138543874;
        v42 = v19;
        v43 = 2112;
        v44 = v20;
        v45 = 2112;
        v46 = v13;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Archiving characteristic authorization data for migration for home: %@, [%@]", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
      v21 = [objc_alloc(MEMORY[0x277CCAAB0]) initRequiringSecureCoding:1];
      [v21 encodeObject:v13 forKey:*MEMORY[0x277CCA308]];
      [v21 finishEncoding];
      v22 = [v21 encodedData];
      if (v22)
      {
        v23 = [(HMDHome *)v16 uuid];
        v24 = MEMORY[0x277CCACA8];
        v25 = hh1ToHH2PerDeviceMigrationDirectoryPath;
        v26 = [v24 stringWithFormat:@"%@/HMDHome-Authorization-Data-%@.plist", v25, v23];

        v27 = [HMDPersistentStore writeData:v22 toStorePath:v26 dataLabel:@"CharacteristicAuthorizationData"];
        v28 = objc_autoreleasePoolPush();
        v29 = v16;
        v30 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
        {
          v31 = HMFGetLogIdentifier();
          *buf = 138543874;
          v42 = v31;
          v43 = 2112;
          v44 = v27;
          v45 = 2112;
          v46 = v26;
          _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_DEBUG, "%{public}@Stored characteristic authorization data ([%@] bytes) to [%@]", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v28);
      }

      else
      {
        v34 = objc_autoreleasePoolPush();
        v35 = v16;
        v36 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          v37 = HMFGetLogIdentifier();
          *buf = 138543362;
          v42 = v37;
          _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_ERROR, "%{public}@Unable to store characteristic authorization data during migration, archived data is nil", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v34);
      }
    }

    else
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
      {
        v32 = HMFGetLogIdentifier();
        v33 = [(HMDHome *)v16 name];
        *buf = 138543618;
        v42 = v32;
        v43 = 2112;
        v44 = v33;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_DEBUG, "%{public}@No characteristic authorization data to migrate for home: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
    }
  }

  objc_autoreleasePoolPop(v3);
  v38 = *MEMORY[0x277D85DE8];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 services];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_2;
  v6[3] = &unk_27972F600;
  v7 = *(a1 + 32);
  v8 = v3;
  v5 = v3;
  [v4 na_each:v6];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 characteristics];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_3;
  v4[3] = &unk_27972F5D8;
  v5 = *(a1 + 32);
  v6 = *(a1 + 40);
  [v3 na_each:v4];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_3(uint64_t a1, void *a2)
{
  v15 = a2;
  v3 = [v15 getCharacteristicDictionary];
  v4 = [v3 objectForKeyedSubscript:*MEMORY[0x277CD2100]];

  if (v4)
  {
    v5 = *(a1 + 32);
    v6 = [*(a1 + 40) uuid];
    v7 = [v5 objectForKeyedSubscript:v6];

    if (!v7)
    {
      v8 = [MEMORY[0x277CBEB38] dictionary];
      v9 = *(a1 + 32);
      v10 = [*(a1 + 40) uuid];
      [v9 setObject:v8 forKeyedSubscript:v10];
    }

    v11 = *(a1 + 32);
    v12 = [*(a1 + 40) uuid];
    v13 = [v11 objectForKeyedSubscript:v12];
    v14 = [v15 instanceID];
    [v13 setObject:v4 forKeyedSubscript:v14];
  }
}

- (id)createSiriEndpointProfilesMessengerWithMessageTargetUUID:(id)a3 messageDispatcher:(id)a4 messageRouter:(id)a5 messageHandler:(id)a6
{
  v9 = a6;
  v10 = a5;
  v11 = a4;
  v12 = a3;
  v13 = [[HMDSiriEndpointProfilesMessenger alloc] initWithMessageTargetUUID:v12 messageDispatcher:v11 messageRouter:v10 messageHandler:v9];

  return v13;
}

- (void)configureSiriEndpointProfilesMessengerWithMessengerFactory:(id)a3 messageHandlerFactory:(id)a4
{
  v25 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v9 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v23 = 138543362;
    v24 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring siri endpoint profiles messenger", &v23, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [(HMDHome *)v9 msgDispatcher];
  v13 = [(HMDHome *)v9 primaryResidentMessageRouter];
  if (!v12)
  {
    _HMFPreconditionFailure();
LABEL_7:
    _HMFPreconditionFailure();
  }

  v14 = v13;
  if (!v13)
  {
    goto LABEL_7;
  }

  v15 = MEMORY[0x277CD1E30];
  v16 = [(HMDHome *)v9 uuid];
  v17 = [v15 messageTargetUUIDWithHomeUUID:v16];

  v18 = [(HMDHome *)v9 uuid];
  v19 = [v7 createSiriEndpointProfileMessageHandlerWithHomeUUID:v18];

  v20 = [(HMDHome *)v9 homeManager];
  [v19 setDataSource:v20];

  v21 = [v6 createSiriEndpointProfilesMessengerWithMessageTargetUUID:v17 messageDispatcher:v12 messageRouter:v14 messageHandler:v19];
  [v21 registerForMessagesWithHome:v9];
  [(HMDHome *)v9 setSiriEndpointProfilesMessenger:v21];

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_unitTest_setRetrievalCompletionsTimeout:(double)a3
{
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  v6 = [v5 copy];

  os_unfair_recursive_lock_unlock();
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke;
  v7[3] = &unk_279733200;
  v7[4] = self;
  *&v7[5] = a3;
  [v6 na_each:v7];
}

void __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke_2;
  v6[3] = &unk_279734BB8;
  v7 = v3;
  v8 = *(a1 + 40);
  v5 = v3;
  dispatch_async(v4, v6);
}

uint64_t __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) stop];
  [*(a1 + 32) setRetrievalTimeout:*(a1 + 40)];
  v2 = *(a1 + 32);

  return [v2 start];
}

- (void)_notifyRetrievalError:(id)a3 accessoryServer:(id)a4 linkType:(int64_t)a5 accessoryOperationBlock:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a6;
  v13 = [(HMDHome *)self hapAccessories];
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke;
  v17[3] = &unk_2797331D8;
  v18 = v11;
  v19 = self;
  v21 = v12;
  v22 = a5;
  v20 = v10;
  v14 = v10;
  v15 = v12;
  v16 = v11;
  [v13 na_each:v17];
}

void __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 matchesHAPAccessoryWithServerIdentifier:*(a1 + 32) linkType:0])
  {
    v4 = _Block_copy(*(a1 + 56));
    v5 = v4;
    if (v4)
    {
      (*(v4 + 2))(v4, v3);
    }

    v6 = [*(a1 + 40) workQueue];
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke_2;
    v9[3] = &unk_279733188;
    v9[4] = *(a1 + 40);
    v7 = v3;
    v8 = *(a1 + 64);
    v10 = v7;
    v12 = v8;
    v11 = *(a1 + 48);
    dispatch_async(v6, v9);
  }
}

- (void)_retrieveHAPAccessoryForHMDHAPAccessory:(id)a3 linkType:(int64_t)a4 forceRetrieve:(BOOL)a5 completion:(id)a6
{
  v7 = a5;
  v73 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a6;
  v12 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v12);

  v13 = [v10 bridge];
  v14 = v13;
  if (v13)
  {
    v15 = v13;
  }

  else
  {
    v15 = v10;
  }

  v16 = v15;

  v17 = [(HMDHome *)self accessoryBrowser];
  v18 = [v17 isBrowsingAllowed];

  if (v18)
  {
    v19 = [(HMDHome *)self accessories];
    v20 = [v19 containsObject:v10];

    if (v20)
    {
      v21 = [v16 matchingHAPAccessoryServerIdentifierWithLinkType:a4];
      v62 = 0;
      v22 = [(HMDHome *)self _enqueueRetrievalTupleForAccessory:v16 linkType:a4 inProgress:&v62 completion:v11];
      v23 = v22;
      if (v62 == 1 && !v7)
      {
        goto LABEL_24;
      }

      v58 = v22;
      v37 = objc_autoreleasePoolPush();
      v38 = self;
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
      {
        v56 = HMFGetLogIdentifier();
        v53 = [v16 shortDescription];
        if (a4 > 2)
        {
          v40 = @"Undefined";
        }

        else
        {
          v40 = off_279727440[a4];
        }

        v51 = v40;
        v41 = HMFBooleanToString();
        *buf = 138544130;
        v64 = v56;
        v65 = 2112;
        v66 = v53;
        v67 = 2112;
        v68 = v51;
        v69 = 2112;
        v70 = v41;
        _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Retrieving accessory %@/%@. Force: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v37);
      v23 = v58;
      [v58 start];
      v42 = [(HMDHome *)v38 accessoryBrowser];
      v59[0] = MEMORY[0x277D85DD0];
      v59[1] = 3221225472;
      v59[2] = __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke;
      v59[3] = &unk_2797331B0;
      v59[4] = v38;
      v60 = v16;
      v61 = a4;
      [v42 discoverAccessoryServer:v21 linkType:a4 errorHandler:v59];

      if (v62)
      {
LABEL_24:
        v43 = objc_autoreleasePoolPush();
        v44 = self;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
        {
          v55 = HMFGetLogIdentifier();
          v54 = [v16 shortDescription];
          v57 = v43;
          if (a4 > 2)
          {
            v46 = @"Undefined";
          }

          else
          {
            v46 = off_279727440[a4];
          }

          v47 = v46;
          v48 = MEMORY[0x277CCABB0];
          log = [v23 completions];
          v49 = [v48 numberWithUnsignedInteger:{-[NSObject count](log, "count")}];
          *buf = 138544386;
          v64 = v55;
          v65 = 2112;
          v66 = v54;
          v67 = 2112;
          v68 = v21;
          v69 = 2112;
          v70 = v47;
          v71 = 2112;
          v72 = v49;
          _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_DEBUG, "%{public}@Retrieval already in progress for accessory (%@) with server %@/%@ and %@ completions.", buf, 0x34u);

          v43 = v57;
        }

        objc_autoreleasePoolPop(v43);
      }

      goto LABEL_31;
    }

    v31 = objc_autoreleasePoolPush();
    v32 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
    {
      v34 = HMFGetLogIdentifier();
      v35 = [v10 shortDescription];
      *buf = 138543618;
      v64 = v34;
      v65 = 2112;
      v66 = v35;
      _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_ERROR, "%{public}@Cannot retrieve HAP accessory: %@. Requested accessory not part of this home", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v31);
    v21 = _Block_copy(v11);
    if (v21)
    {
      v29 = MEMORY[0x277CCA9B8];
      v30 = 3;
      goto LABEL_17;
    }
  }

  else
  {
    v24 = objc_autoreleasePoolPush();
    v25 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      v28 = [v16 shortDescription];
      *buf = 138543618;
      v64 = v27;
      v65 = 2112;
      v66 = v28;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Ignoring request to retrieve HAP accessory: %@. Browsing not allowed (companion is connected or no app)", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    v21 = _Block_copy(v11);
    if (v21)
    {
      v29 = MEMORY[0x277CCA9B8];
      v30 = 48;
LABEL_17:
      v36 = [v29 hmErrorWithCode:v30];
      (v21->data)(v21, v36);
    }
  }

LABEL_31:

  v50 = *MEMORY[0x277D85DE8];
}

void __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (v3)
  {
    v4 = [*(a1 + 32) workQueue];
    v8[0] = MEMORY[0x277D85DD0];
    v8[1] = 3221225472;
    v8[2] = __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke_2;
    v8[3] = &unk_279733188;
    v5 = *(a1 + 40);
    v8[4] = *(a1 + 32);
    v6 = v5;
    v7 = *(a1 + 48);
    v9 = v6;
    v11 = v7;
    v10 = v3;
    dispatch_async(v4, v8);
  }
}

- (void)_dequeueRetrievalForAccessory:(id)a3 linkType:(int64_t)a4 error:(id)a5
{
  v43 = *MEMORY[0x277D85DE8];
  v8 = a3;
  v9 = a5;
  v10 = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(v10);

  v11 = [v8 bridge];
  v12 = v11;
  if (v11)
  {
    v13 = v11;
  }

  else
  {
    v13 = v8;
  }

  v14 = v13;

  v15 = [(HMDHome *)self _retrieveTupleForPrimaryAccessory:v14 linkType:a4];
  if (v15)
  {
    [(HMDHome *)self _removeRetrievalCompletionTuple:v15];
    [v15 stop];
    if (v9)
    {
      v16 = objc_autoreleasePoolPush();
      v17 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        v28 = [v14 shortDescription];
        v29 = v16;
        if (a4 > 2)
        {
          v19 = @"Undefined";
        }

        else
        {
          v19 = off_279727440[a4];
        }

        v20 = v19;
        v21 = [MEMORY[0x277CCA9B8] hmStringFromErrorCode:{objc_msgSend(v9, "code")}];
        v22 = MEMORY[0x277CCABB0];
        v27 = [v15 completions];
        v23 = [v22 numberWithUnsignedInteger:{objc_msgSend(v27, "count")}];
        *buf = 138544386;
        v34 = v30;
        v35 = 2112;
        v36 = v28;
        v37 = 2112;
        v38 = v20;
        v39 = 2112;
        v40 = v21;
        v41 = 2112;
        v42 = v23;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Calling accessory retrieval for %@/%@ with error: %@ and %@ completions.", buf, 0x34u);

        v16 = v29;
      }

      objc_autoreleasePoolPop(v16);
    }

    v24 = [v15 completions];
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __76__HMDHome_AccessoryRetrieval___dequeueRetrievalForAccessory_linkType_error___block_invoke;
    v31[3] = &unk_279733160;
    v32 = v9;
    [v24 na_each:v31];

    v25 = [v15 completions];
    [v25 removeAllObjects];
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (id)_enqueueRetrievalTupleForAccessory:(id)a3 linkType:(int64_t)a4 inProgress:(BOOL *)a5 completion:(id)a6
{
  v39 = *MEMORY[0x277D85DE8];
  v10 = a3;
  v11 = a6;
  v12 = [v10 bridge];
  v13 = v12;
  if (v12)
  {
    v14 = v12;
  }

  else
  {
    v14 = v10;
  }

  v15 = v14;

  v16 = objc_autoreleasePoolPush();
  v17 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
  {
    v28 = v16;
    v19 = HMFGetLogIdentifier();
    if (v11)
    {
      v20 = @" with completion";
    }

    else
    {
      v20 = &stru_286509E58;
    }

    v21 = [v15 shortDescription];
    v30 = a5;
    if (a4 > 2)
    {
      v22 = @"Undefined";
    }

    else
    {
      v22 = off_279727440[a4];
    }

    v23 = v22;
    *buf = 138544130;
    v32 = v19;
    v33 = 2112;
    v34 = v20;
    v35 = 2112;
    v36 = v21;
    v37 = 2112;
    v38 = v23;
    _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_DEBUG, "%{public}@Enqueueing retrieval tuple%@ for %@/%@.", buf, 0x2Au);

    v16 = v29;
    a5 = v30;
  }

  objc_autoreleasePoolPop(v16);
  v24 = [(HMDHome *)v17 _retrieveTupleForPrimaryAccessory:v15 linkType:a4];
  if (v24)
  {
    v25 = v24;
    if (a5)
    {
      *a5 = 1;
    }

    if (v11)
    {
      goto LABEL_16;
    }
  }

  else
  {
    v25 = [[HMDAccessoryRetrievalCompletionTuple alloc] initWithHome:v17 accessory:v15 linkType:a4];
    [(HMDHome *)v17 _addRetrievalCompletionTuple:v25];
    if (v11)
    {
LABEL_16:
      [(HMDAccessoryRetrievalCompletionTuple *)v25 addCompletion:v11];
    }
  }

  v26 = *MEMORY[0x277D85DE8];

  return v25;
}

- (BOOL)_isRetrievalInProgressForPrimaryAccessory:(id)a3 linkType:(int64_t)a4
{
  v4 = [(HMDHome *)self _retrieveTupleForPrimaryAccessory:a3 linkType:a4];
  v5 = v4 != 0;

  return v5;
}

- (void)_removeRetrievalCompletionTuple:(id)a3
{
  v5 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  [v4 removeObject:v5];

  os_unfair_recursive_lock_unlock();
}

- (void)_addRetrievalCompletionTuple:(id)a3
{
  v5 = a3;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  [v4 addObject:v5];

  os_unfair_recursive_lock_unlock();
}

- (id)_retrieveTupleForPrimaryAccessory:(id)a3 linkType:(int64_t)a4
{
  v6 = a3;
  v7 = [v6 bridge];
  v8 = v7;
  if (v7)
  {
    v9 = v7;
  }

  else
  {
    v9 = v6;
  }

  v10 = v9;

  os_unfair_recursive_lock_lock_with_options();
  v11 = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __74__HMDHome_AccessoryRetrieval___retrieveTupleForPrimaryAccessory_linkType___block_invoke;
  v15[3] = &unk_279733138;
  v12 = v10;
  v16 = v12;
  v17 = a4;
  v13 = [v11 na_firstObjectPassingTest:v15];

  os_unfair_recursive_lock_unlock();

  return v13;
}

BOOL __74__HMDHome_AccessoryRetrieval___retrieveTupleForPrimaryAccessory_linkType___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 accessory];
  v5 = [v4 uuid];
  v6 = [*(a1 + 32) uuid];
  if ([v5 isEqual:v6])
  {
    v7 = [v3 linkType] == *(a1 + 40);
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (unint64_t)accessorySettingsLocalMessageHandler:(id)a3 callerPrivilegeWithMessage:(id)a4
{
  v21 = *MEMORY[0x277D85DE8];
  v6 = a3;
  v7 = a4;
  v8 = [v7 userForHome:self];
  v9 = v8;
  if (v8)
  {
    v10 = [v8 privilege];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = v7;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to get accessory settings local message handler caller privilege from message: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v10 = 2;
  }

  v15 = *MEMORY[0x277D85DE8];
  return v10;
}

- (id)createUnifiedLanguageValueListSettingDataProvider
{
  v2 = objc_alloc_init(HMDUnifiedLanguageValueListSettingDataProvider);

  return v2;
}

- (void)configureUnifiedLanguageValueListSettingDataProviderWithFactory:(id)a3
{
  v13 = *MEMORY[0x277D85DE8];
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v11 = 138543362;
    v12 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Configuring unified language value list setting data provider", &v11, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [v4 createUnifiedLanguageValueListSettingDataProvider];
  [v9 setDataSource:v6];
  [(HMDHome *)v6 setUnifiedLanguageValueListSettingDataProvider:v9];

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)validateActionsDoNotConflict:(id)a3
{
  v55 = *MEMORY[0x277D85DE8];
  v4 = a3;
  if ([v4 count])
  {
    v5 = [MEMORY[0x277CBEB58] set];
    v6 = [MEMORY[0x277CBEB58] set];
    v45 = 0u;
    v46 = 0u;
    v47 = 0u;
    v48 = 0u;
    v7 = v4;
    v8 = [v7 countByEnumeratingWithState:&v45 objects:v54 count:16];
    if (v8)
    {
      v9 = v8;
      v36 = self;
      v37 = v4;
      v39 = v7;
      v40 = *v46;
      v38 = v5;
      while (2)
      {
        v10 = 0;
        v11 = v40;
        do
        {
          if (*v46 != v11)
          {
            objc_enumerationMutation(v7);
          }

          v12 = *(*(&v45 + 1) + 8 * v10);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v13 = v12;
          }

          else
          {
            v13 = 0;
          }

          v14 = v13;

          if (v14)
          {
            v15 = [v14 characteristic];
            if ([v5 containsObject:v15])
            {
              v32 = objc_autoreleasePoolPush();
              v33 = v36;
              v34 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
              {
                v35 = HMFGetLogIdentifier();
                *buf = 138543618;
                v51 = v35;
                v52 = 2112;
                v53 = v12;
                _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v32);
LABEL_34:

              v25 = 0;
              v4 = v37;
              v7 = v39;
              goto LABEL_36;
            }

            [v5 addObject:v15];
          }

          else
          {
            v16 = v12;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v17 = v16;
            }

            else
            {
              v17 = 0;
            }

            v15 = v17;

            if (v15)
            {
              v43 = 0u;
              v44 = 0u;
              v41 = 0u;
              v42 = 0u;
              v18 = [v15 mediaProfiles];
              v19 = [v18 countByEnumeratingWithState:&v41 objects:v49 count:16];
              if (v19)
              {
                v20 = v19;
                v21 = *v42;
                while (2)
                {
                  for (i = 0; i != v20; ++i)
                  {
                    if (*v42 != v21)
                    {
                      objc_enumerationMutation(v18);
                    }

                    v23 = *(*(&v41 + 1) + 8 * i);
                    if ([v6 containsObject:v23])
                    {
                      v26 = objc_autoreleasePoolPush();
                      v27 = v36;
                      v28 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
                      {
                        v29 = HMFGetLogIdentifier();
                        *buf = 138543618;
                        v51 = v29;
                        v52 = 2112;
                        v53 = v16;
                        _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", buf, 0x16u);
                      }

                      objc_autoreleasePoolPop(v26);
                      v14 = 0;
                      v5 = v38;
                      goto LABEL_34;
                    }

                    [v6 addObject:v23];
                  }

                  v20 = [v18 countByEnumeratingWithState:&v41 objects:v49 count:16];
                  if (v20)
                  {
                    continue;
                  }

                  break;
                }
              }

              v14 = 0;
              v5 = v38;
              v7 = v39;
              v11 = v40;
            }
          }

          ++v10;
        }

        while (v10 != v9);
        v24 = [v7 countByEnumeratingWithState:&v45 objects:v54 count:16];
        v9 = v24;
        v25 = 1;
        v4 = v37;
        if (v24)
        {
          continue;
        }

        break;
      }
    }

    else
    {
      v25 = 1;
    }

LABEL_36:
  }

  else
  {
    v25 = 1;
  }

  v30 = *MEMORY[0x277D85DE8];
  return v25;
}

- (void)executeActionsFromMessage:(id)a3
{
  v166 = *MEMORY[0x277D85DE8];
  v102 = a3;
  v93 = [v102 arrayForKey:*MEMORY[0x277CCFF38]];
  if ([v93 count])
  {
    if ([v93 hmf_objectsAreKindOfClass:objc_opt_class()])
    {
      v103 = [MEMORY[0x277CBEAA8] date];
      v92 = [v102 source];
      v91 = [v102 transport];
      v94 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v93, "count")}];
      v145 = 0u;
      v146 = 0u;
      v143 = 0u;
      v144 = 0u;
      v4 = v93;
      v5 = [v4 countByEnumeratingWithState:&v143 objects:v165 count:16];
      if (!v5)
      {
        goto LABEL_17;
      }

      v6 = *v144;
      while (2)
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v144 != v6)
          {
            objc_enumerationMutation(v4);
          }

          v8 = *(*(&v143 + 1) + 8 * i);
          v9 = [(HMDHome *)self actionWithDictionaryRepresentation:v8];
          if (!v9)
          {
            v74 = objc_autoreleasePoolPush();
            v75 = self;
            v76 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v76, OS_LOG_TYPE_ERROR))
            {
              v77 = HMFGetLogIdentifier();
              *buf = 138543618;
              v153 = v77;
              v154 = 2112;
              *v155 = v8;
              _os_log_impl(&dword_2531F8000, v76, OS_LOG_TYPE_ERROR, "%{public}@Failed to deserialize action: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v74);
            v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
            [v102 respondWithError:v10];
LABEL_91:

            goto LABEL_99;
          }

          v10 = v9;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();
          if (isKindOfClass)
          {
            v12 = v10;
          }

          else
          {
            v12 = 0;
          }

          v13 = v12;

          if (isKindOfClass)
          {
            v14 = [v102 proxyConnection];
            if (v14)
            {
              v15 = [v102 isEntitledForShortcutsAutomationAccess];

              if ((v15 & 1) == 0)
              {
                v80 = objc_autoreleasePoolPush();
                v81 = self;
                v82 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v82, OS_LOG_TYPE_ERROR))
                {
                  v83 = HMFGetLogIdentifier();
                  *buf = 138543362;
                  v153 = v83;
                  _os_log_impl(&dword_2531F8000, v82, OS_LOG_TYPE_ERROR, "%{public}@Missing ShortcutsAutomationAccess Entitlement for Execute", buf, 0xCu);
                }

                objc_autoreleasePoolPop(v80);
                v84 = [MEMORY[0x277CCA9B8] hmErrorWithCode:80 description:@"Missing Entitlement" reason:0 suggestion:0];
                [v102 respondWithError:v84];

                goto LABEL_91;
              }
            }
          }

          [v94 addObject:v10];
        }

        v5 = [v4 countByEnumeratingWithState:&v143 objects:v165 count:16];
        if (v5)
        {
          continue;
        }

        break;
      }

LABEL_17:

      v16 = [(HMDHome *)self validateActionsDoNotConflict:v94];
      v17 = objc_autoreleasePoolPush();
      val = self;
      v18 = HMFGetOSLogHandle();
      v19 = v18;
      if (v16)
      {
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          v20 = HMFGetLogIdentifier();
          *buf = 138543618;
          v153 = v20;
          v154 = 2112;
          *v155 = v94;
          _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_DEFAULT, "%{public}@Executing actions: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v17);
        v137 = 0;
        v138 = &v137;
        v139 = 0x3032000000;
        v140 = __Block_byref_object_copy__194645;
        v141 = __Block_byref_object_dispose__194646;
        v142 = 0;
        v95 = [(HMDHome *)val workQueue];
        group = dispatch_group_create();
        v105 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v94, "count")}];
        v101 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
        v98 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
        v135 = 0u;
        v136 = 0u;
        v133 = 0u;
        v134 = 0u;
        obj = v94;
        v21 = [obj countByEnumeratingWithState:&v133 objects:v164 count:16];
        if (!v21)
        {
LABEL_72:

          if ([v105 count])
          {
            objc_initWeak(&location, val);
            dispatch_group_enter(group);
            v61 = [MEMORY[0x277CCAD78] UUID];
            v62 = objc_autoreleasePoolPush();
            v63 = val;
            v64 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v64, OS_LOG_TYPE_INFO))
            {
              v65 = HMFGetLogIdentifier();
              v150 = 0uLL;
              if (v61)
              {
                [v61 getUUIDBytes:&v150];
              }

              else
              {
                v150 = *MEMORY[0x277D0F960];
              }

              v148 = v150;
              v150 = 0uLL;
              v85 = [v102 identifier];

              if (v85)
              {
                v86 = [v102 identifier];
                [v86 getUUIDBytes:&v150];
              }

              else
              {
                v150 = *MEMORY[0x277D0F960];
              }

              v147 = v150;
              v87 = [v105 count];
              *buf = 138544898;
              v153 = v65;
              v154 = 1042;
              *v155 = 16;
              *&v155[4] = 2098;
              *&v155[6] = &v148;
              v156 = 1042;
              v157 = 16;
              v158 = 2098;
              v159 = &v147;
              v160 = 2114;
              v161 = v63;
              v162 = 2048;
              v163 = v87;
              _os_log_impl(&dword_2531F8000, v64, OS_LOG_TYPE_INFO, "%{public}@Executing write requests with identifier: %{public,uuid_t}.16P for request identifier %{public,uuid_t}.16P from home: %{public}@ count: %lu for characteristic write actions", buf, 0x40u);
            }

            objc_autoreleasePoolPop(v62);
            v88 = [v102 qualityOfService];
            v113[0] = MEMORY[0x277D85DD0];
            v113[1] = 3221225472;
            v113[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_29;
            v113[3] = &unk_279735B98;
            v114 = v95;
            objc_copyWeak(&v120, &location);
            v115 = v105;
            v116 = v98;
            v117 = v101;
            v119 = &v137;
            v118 = group;
            [(HMDHome *)v63 writeCharacteristicValues:v115 source:v92 biomeSource:0 identifier:v61 transport:v91 qualityOfService:v88 withCompletionHandler:v113];

            objc_destroyWeak(&v120);
            objc_destroyWeak(&location);
          }

          v89 = [(HMDHome *)val workQueue];
          block[0] = MEMORY[0x277D85DD0];
          block[1] = 3221225472;
          block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_31;
          block[3] = &unk_279735BC0;
          v110 = v102;
          v112 = &v137;
          v111 = obj;
          dispatch_group_notify(group, v89, block);

          _Block_object_dispose(&v137, 8);
          goto LABEL_99;
        }

        v106 = *v134;
        while (2)
        {
          v107 = v21;
          v22 = 0;
LABEL_23:
          if (*v134 != v106)
          {
            objc_enumerationMutation(obj);
          }

          v23 = *(*(&v133 + 1) + 8 * v22);
          [v23 configureWithHome:val];
          v24 = v23;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v25 = v24;
          }

          else
          {
            v25 = 0;
          }

          v26 = v25;

          if (v26)
          {
            v27 = [v26 characteristic];
            v28 = [v26 targetValue];
            v29 = [v27 authorizationData];
            v30 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:v27 value:v28 authorizationData:v29 type:1];

            if (v30)
            {
              [v105 addObject:v30];
              [v101 setObject:v26 forKey:v30];
              goto LABEL_70;
            }
          }

          v31 = v24;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v32 = v31;
          }

          else
          {
            v32 = 0;
          }

          v27 = v32;

          v30 = [v27 lightProfile];
          if (v30)
          {
            v33 = [v27 writeRequestForTransitionStartWithLightProfile:v30 startDate:v103 type:1];
            if (v33)
            {
              [v98 setObject:v27 forKey:v33];
              [v105 addObject:v33];
            }

            else
            {
              v39 = objc_autoreleasePoolPush();
              v40 = val;
              v41 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
              {
                v42 = HMFGetLogIdentifier();
                *buf = 138543618;
                v153 = v42;
                v154 = 2112;
                *v155 = v27;
                _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_ERROR, "%{public}@Failed to create characteristic write request for natural lighting action: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v39);
              v33 = 0;
            }

LABEL_69:

LABEL_70:
            if (v107 == ++v22)
            {
              v21 = [obj countByEnumeratingWithState:&v133 objects:v164 count:16];
              if (!v21)
              {
                goto LABEL_72;
              }

              continue;
            }

            goto LABEL_23;
          }

          break;
        }

        if (v27)
        {
          v34 = objc_autoreleasePoolPush();
          v35 = val;
          v36 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
          {
            v37 = HMFGetLogIdentifier();
            *buf = 138543618;
            v153 = v37;
            v154 = 2112;
            *v155 = v27;
            _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_ERROR, "%{public}@Skipping executing natural lighting action, missing light profile: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v34);
          v38 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          v33 = v138[5];
          v138[5] = v38;
          goto LABEL_69;
        }

        v33 = v31;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v43 = v33;
        }

        else
        {
          v43 = 0;
        }

        v44 = v43;
        v97 = v33;

        if (v44)
        {
          v45 = [v44 convertedCharacteristicWriteRequests];
          v46 = v45;
          if (v45)
          {
            v33 = [v45 residualAction];

            v100 = [v46 characteristicWriteRequests];
            if (!v33)
            {
LABEL_55:

              goto LABEL_56;
            }
          }

          else
          {
            v100 = 0;
          }

          [v33 setEncodePlaybackArchiveForExecution:1];
          goto LABEL_55;
        }

        v100 = 0;
        v33 = 0;
LABEL_56:
        objc_initWeak(&location, val);
        if ([v100 count])
        {
          dispatch_group_enter(group);
          v96 = [MEMORY[0x277CCAD78] UUID];
          v47 = objc_autoreleasePoolPush();
          v48 = val;
          v49 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
          {
            v50 = HMFGetLogIdentifier();
            v150 = 0uLL;
            if (v96)
            {
              [v96 getUUIDBytes:&v150];
            }

            else
            {
              v150 = *MEMORY[0x277D0F960];
            }

            v151 = v150;
            v150 = 0uLL;
            v51 = [v102 identifier];

            if (v51)
            {
              v52 = [v102 identifier];
              [v52 getUUIDBytes:&v150];
            }

            else
            {
              v150 = *MEMORY[0x277D0F960];
            }

            v149 = v150;
            v53 = [v100 count];
            *buf = 138544898;
            v153 = v50;
            v154 = 1042;
            *v155 = 16;
            *&v155[4] = 2098;
            *&v155[6] = &v151;
            v156 = 1042;
            v157 = 16;
            v158 = 2098;
            v159 = &v149;
            v160 = 2114;
            v161 = val;
            v162 = 2048;
            v163 = v53;
            _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_INFO, "%{public}@Executing write requests with identifier: %{public,uuid_t}.16P for request identifier %{public,uuid_t}.16P from home: %{public}@ count: %lu for media actions", buf, 0x40u);
          }

          objc_autoreleasePoolPop(v47);
          v54 = [v102 source];
          v55 = [v102 qualityOfService];
          v126[0] = MEMORY[0x277D85DD0];
          v126[1] = 3221225472;
          v126[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke;
          v126[3] = &unk_279735AF8;
          v127 = v95;
          objc_copyWeak(&v131, &location);
          v56 = v100;
          v128 = v56;
          v130 = &v137;
          v129 = group;
          [(HMDHome *)v48 writeCharacteristicValues:v56 source:v54 biomeSource:0 identifier:v96 transport:v91 qualityOfService:v55 withCompletionHandler:v126];

          objc_destroyWeak(&v131);
        }

        v57 = [v102 clientName];
        v58 = v57;
        v59 = @"Unknown";
        if (v57)
        {
          v59 = v57;
        }

        v60 = v59;

        dispatch_group_enter(group);
        v121[0] = MEMORY[0x277D85DD0];
        v121[1] = 3221225472;
        v121[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_26;
        v121[3] = &unk_279735B48;
        v122 = v95;
        objc_copyWeak(&v125, &location);
        v124 = &v137;
        v123 = group;
        [v97 executeWithSource:v92 clientName:v60 completionHandler:v121];

        objc_destroyWeak(&v125);
        objc_destroyWeak(&location);

        goto LABEL_69;
      }

      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v78 = HMFGetLogIdentifier();
        *buf = 138543362;
        v153 = v78;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_ERROR, "%{public}@Failed to validate actions", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      v79 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v102 respondWithError:v79];

LABEL_99:
    }

    else
    {
      v70 = objc_autoreleasePoolPush();
      v71 = self;
      v72 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v72, OS_LOG_TYPE_ERROR))
      {
        v73 = HMFGetLogIdentifier();
        *buf = 138543618;
        v153 = v73;
        v154 = 2112;
        *v155 = v102;
        _os_log_impl(&dword_2531F8000, v72, OS_LOG_TYPE_ERROR, "%{public}@Invalid actions payload: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v70);
      v103 = [MEMORY[0x277CCA9B8] hmErrorWithCode:22];
      [v102 respondWithError:v103];
    }
  }

  else
  {
    v66 = objc_autoreleasePoolPush();
    v67 = self;
    v68 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v68, OS_LOG_TYPE_ERROR))
    {
      v69 = HMFGetLogIdentifier();
      *buf = 138543618;
      v153 = v69;
      v154 = 2112;
      *v155 = v102;
      _os_log_impl(&dword_2531F8000, v68, OS_LOG_TYPE_ERROR, "%{public}@No Actions in message:(%@)", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v66);
    v103 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [v102 respondWithError:v103];
  }

  v90 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2;
  block[3] = &unk_279735AD0;
  objc_copyWeak(&v17, (a1 + 64));
  v13 = v5;
  v14 = *(a1 + 40);
  v15 = v6;
  v11 = *(a1 + 48);
  v8 = v11;
  v16 = v11;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);

  objc_destroyWeak(&v17);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_26(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_27;
  block[3] = &unk_279735B20;
  objc_copyWeak(&v11, (a1 + 56));
  v9 = v3;
  v7 = *(a1 + 40);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  dispatch_async(v4, block);

  objc_destroyWeak(&v11);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_29(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_30;
  block[3] = &unk_279735B70;
  objc_copyWeak(&v19, (a1 + 80));
  v13 = v5;
  v14 = *(a1 + 40);
  v15 = *(a1 + 48);
  v16 = v6;
  v17 = *(a1 + 56);
  v11 = *(a1 + 64);
  v8 = v11;
  v18 = v11;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);

  objc_destroyWeak(&v19);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_31(uint64_t a1)
{
  v2 = [*(a1 + 32) responseHandler];

  if (v2)
  {
    v3 = [*(a1 + 32) responseHandler];
    (*(v3 + 2))(v3, *(*(*(a1 + 48) + 8) + 40), 0);
  }
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_30(uint64_t a1)
{
  v56 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 88));
  v3 = *(a1 + 32);
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v48 = 0u;
  obj = *(a1 + 40);
  v42 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
  if (v42)
  {
    v41 = *v46;
    v38 = WeakRetained;
    do
    {
      for (i = 0; i != v42; ++i)
      {
        if (*v46 != v41)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v45 + 1) + 8 * i);
        v6 = [*(a1 + 48) objectForKey:v5];
        v7 = v6;
        if (v6)
        {
          v8 = *(a1 + 56);
          v9 = [v6 isNaturalLightingEnabled];
          v44 = 0;
          v10 = [v8 hmd_isValidResponseForWriteRequest:v5 naturalLightingEnabled:v9 error:&v44];
          v11 = v44;
          v12 = objc_autoreleasePoolPush();
          v13 = WeakRetained;
          v14 = HMFGetOSLogHandle();
          v15 = v14;
          if (v10)
          {
            if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
            {
              v16 = HMFGetLogIdentifier();
              *buf = 138543618;
              v50 = v16;
              v51 = 2112;
              v52 = v7;
              v17 = v15;
              v18 = OS_LOG_TYPE_INFO;
              v19 = "%{public}@Successfully executed natural lighting action: %@";
              v20 = 22;
              goto LABEL_15;
            }
          }

          else if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
          {
            v16 = HMFGetLogIdentifier();
            *buf = 138543874;
            v50 = v16;
            v51 = 2112;
            v52 = v7;
            v53 = 2112;
            v54 = v11;
            v17 = v15;
            v18 = OS_LOG_TYPE_ERROR;
            v19 = "%{public}@Failed to execute natural lighting action %@:%@";
            v20 = 32;
LABEL_15:
            _os_log_impl(&dword_2531F8000, v17, v18, v19, buf, v20);
          }

          objc_autoreleasePoolPop(v12);
          if (v3)
          {
            goto LABEL_24;
          }

          goto LABEL_22;
        }

        v40 = v3;
        v21 = [*(a1 + 64) objectForKey:v5];
        v22 = *(a1 + 56);
        v23 = [v5 characteristic];
        v43 = 0;
        v24 = [v22 hmd_valueOfCharacteristic:v23 error:&v43];
        v11 = v43;

        v25 = objc_autoreleasePoolPush();
        v26 = WeakRetained;
        v27 = HMFGetOSLogHandle();
        v28 = v27;
        if (v24)
        {
          if (!os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
          {
            goto LABEL_21;
          }

          v29 = HMFGetLogIdentifier();
          *buf = 138543618;
          v50 = v29;
          v51 = 2112;
          v52 = v21;
          v30 = v28;
          v31 = OS_LOG_TYPE_INFO;
          v32 = "%{public}@Successfully executed characteristic write action: %@";
          v33 = 22;
        }

        else
        {
          if (!os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_21;
          }

          v29 = HMFGetLogIdentifier();
          *buf = 138543874;
          v50 = v29;
          v51 = 2112;
          v52 = v21;
          v53 = 2112;
          v54 = v11;
          v30 = v28;
          v31 = OS_LOG_TYPE_ERROR;
          v32 = "%{public}@Failed to execute characteristic write action %@:%@";
          v33 = 32;
        }

        _os_log_impl(&dword_2531F8000, v30, v31, v32, buf, v33);

        WeakRetained = v38;
LABEL_21:

        objc_autoreleasePoolPop(v25);
        v3 = v40;
        if (v40)
        {
          goto LABEL_24;
        }

LABEL_22:
        if (v11)
        {
          v3 = v11;
        }

LABEL_24:
      }

      v42 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
    }

    while (v42);
  }

  if (v3)
  {
    v34 = *(*(a1 + 80) + 8);
    v36 = *(v34 + 40);
    v35 = (v34 + 40);
    if (!v36)
    {
      objc_storeStrong(v35, v3);
    }
  }

  dispatch_group_leave(*(a1 + 72));

  v37 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_27(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (*(a1 + 32))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = WeakRetained;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 32);
      v12 = 138543618;
      v13 = v6;
      v14 = 2112;
      v15 = v7;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute action with error: %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v8 = *(*(a1 + 48) + 8);
    v10 = *(v8 + 40);
    v9 = (v8 + 40);
    if (!v10)
    {
      objc_storeStrong(v9, *(a1 + 32));
    }
  }

  dispatch_group_leave(*(a1 + 40));

  v11 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2(id *a1)
{
  v73 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 9);
  v3 = a1[4];
  v34 = a1;
  if (v3)
  {
    v4 = v3;
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v61 = v8;
      v62 = 2112;
      v63 = v4;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute write requests for converted media action with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  else
  {
    v31 = [a1[5] count];
    v56 = 0u;
    v57 = 0u;
    v58 = 0u;
    v59 = 0u;
    v12 = a1[6];
    v35 = [v12 countByEnumeratingWithState:&v56 objects:v72 count:16];
    if (!v35)
    {

      v4 = 0;
      v11 = 0;
      goto LABEL_37;
    }

    v13 = 0;
    v4 = 0;
    obj = v12;
    v33 = *v57;
    v45 = *MEMORY[0x277CD2128];
    do
    {
      v14 = 0;
      do
      {
        if (*v57 != v33)
        {
          v15 = v14;
          objc_enumerationMutation(obj);
          v14 = v15;
        }

        v36 = v14;
        v41 = *(*(&v56 + 1) + 8 * v14);
        v16 = [v34[6] hmf_dictionaryForKey:v31];
        v52 = 0u;
        v53 = 0u;
        v54 = 0u;
        v55 = 0u;
        v39 = v16;
        v38 = [v39 countByEnumeratingWithState:&v52 objects:v71 count:16];
        if (v38)
        {
          v37 = *v53;
          do
          {
            v17 = 0;
            do
            {
              if (*v53 != v37)
              {
                objc_enumerationMutation(v39);
              }

              v40 = v17;
              v42 = *(*(&v52 + 1) + 8 * v17);
              v18 = [v39 hmf_dictionaryForKey:?];
              v48 = 0u;
              v49 = 0u;
              v50 = 0u;
              v51 = 0u;
              v19 = v18;
              v47 = [v19 countByEnumeratingWithState:&v48 objects:v70 count:16];
              if (v47)
              {
                v46 = *v49;
                v44 = v19;
                do
                {
                  for (i = 0; i != v47; ++i)
                  {
                    if (*v49 != v46)
                    {
                      objc_enumerationMutation(v19);
                    }

                    v21 = *(*(&v48 + 1) + 8 * i);
                    v22 = [v19 hmf_dictionaryForKey:v21];
                    v23 = [v22 hmf_dataForKey:v45];
                    if (v23)
                    {
                      v24 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v23 error:0];

                      v25 = objc_autoreleasePoolPush();
                      v26 = WeakRetained;
                      v27 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
                      {
                        HMFGetLogIdentifier();
                        v43 = v13;
                        v29 = v28 = WeakRetained;
                        *buf = 138544386;
                        v61 = v29;
                        v62 = 2112;
                        v63 = v41;
                        v64 = 2112;
                        v65 = v42;
                        v66 = 2112;
                        v67 = v21;
                        v68 = 2112;
                        v69 = v24;
                        _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute write requests for %@/%@/%@ with error: %@", buf, 0x34u);

                        WeakRetained = v28;
                        v13 = v43;
                      }

                      ++v13;

                      objc_autoreleasePoolPop(v25);
                      v4 = v24;
                      v19 = v44;
                    }
                  }

                  v47 = [v19 countByEnumeratingWithState:&v48 objects:v70 count:16];
                }

                while (v47);
              }

              v17 = v40 + 1;
            }

            while (v40 + 1 != v38);
            v38 = [v39 countByEnumeratingWithState:&v52 objects:v71 count:16];
          }

          while (v38);
        }

        v14 = v36 + 1;
      }

      while (v36 + 1 != v35);
      v35 = [obj countByEnumeratingWithState:&v56 objects:v72 count:16];
    }

    while (v35);

    v11 = 0;
    if (!v31 || v31 != v13)
    {
      goto LABEL_37;
    }

    if (!v4)
    {
      goto LABEL_38;
    }
  }

  v9 = v34;
  v10 = *(v34[8] + 1);
  if (!*(v10 + 40))
  {
    v11 = v4;
    v4 = *(v10 + 40);
    *(v10 + 40) = v11;
LABEL_37:

    v4 = v11;
LABEL_38:
    v9 = v34;
  }

  dispatch_group_leave(v9[7]);

  v30 = *MEMORY[0x277D85DE8];
}

@end